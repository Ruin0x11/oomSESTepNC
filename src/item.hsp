#deffunc getinheritance int __ccc, array __ddd, var __eee
	randomize iSubname(__ccc)
	dim __ddd, 15
	__ddd = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
	__eee = 0
	cibk2 = ci
	ci = 5480
	dbid = iId(__ccc)
	if (dbid == 743) {
		inv(31, ci) = inv(31, __ccc)
	}
	dbmode = 3
	gosub *label_2426
	iNumber(ci) = 0
	ci = cibk2
	repeat 10
		p@m42 = rnd(15)
		if (iEnchantmentId(__ccc, p@m42) == 0) {
			continue
		}
		f@m42 = 0
		repeat __eee + 1
			if (p@m42 == __ddd(cnt)) {
				f@m42 = 1
				break
			}
		loop
		if (f@m42 == 0) {
			i = iMaterial(__ccc)
			repeat 8
				if (mtenc(cnt * 2, i) == 0) {
					break
				}
				mtencid = mtenc(cnt * 2, i)
				if (mtencid == 0) {
					break
				}
				if (iEnchantmentId(__ccc, p@m42) == mtencid) {
					if (iEnchantmentPower(__ccc, p@m42) - mtenc(cnt * 2 + 1, i) <= 0) {
						f@m42 = 1
						break
					}
				}
			loop
		}
		if (f@m42 == 0) {
			repeat length(fixeditemenc)
				if (fixeditemenc(cnt * 2) == 0) {
					break
				}
				if (iEnchantmentId(__ccc, p@m42) != fixeditemenc(cnt * 2)) {
					continue
				}
				if (iEnchantmentPower(__ccc, p@m42) - fixeditemenc(cnt * 2 + 1) <= 0) {
					f@m42 = 1
					break
				}
			loop
		}
		if (f@m42 == 1) {
			continue
		}
		if (rnd(4) > __eee | iEnchantmentPower(__ccc, p@m42) < 0) {
			__ddd(__eee) = p@m42
			__eee++
		}
	loop
	randomize
	return 1



#defcfunc calcobjlv int __fff
	if (__fff <= 0) {
		objlv@m43 = gCurrentDungeonLevel
	} else {
		objlv@m43 = __fff
	}
	if (gCurrentMap == 30) {
		objlv@m43 = 1
	}
	repeat 3, 1
		p@m43 = rnd(30 + cnt * 5)
		if (p@m43 == 0) {
			objlv@m43 += rnd(10 * cnt)
			continue
		}
		break
	loop
	if (__fff <= 3) {
		if (rnd(4) != 0) {
			objlv@m43 = rnd(3) + 1
		}
	}
	return objlv@m43



#defcfunc calcfixlv int __ggg
	if (__ggg == 0) {
		fixlv@m43 = 2
	} else {
		fixlv@m43 = __ggg
	}
	repeat 3, 1
		p@m43 = rnd(30 + cnt * 5)
		if (p@m43 == 0) {
			fixlv@m43++
			continue
		}
		if (p@m43 < 3) {
			fixlv@m43--
			continue
		}
		break
	loop
	if (fixlv@m43 < 1) {
		fixlv@m43 = 1
	}
	if (fixlv@m43 > 5) {
		fixlv@m43 = 5
	}
	return fixlv@m43



#deffunc flt int __hhh, int __iii
	filtermax = 0
	fltselect = 0
	flttypemajor = 0
	flttypeminor = 0
	fltnrace = ""
	fltnclass = ""
	rank = 0
	ally = 0
	if (__hhh == 0) {
		objlv = calcobjlv(gCurrentDungeonLevel)
	} else {
		objlv = __hhh
	}
	if (__iii == 0) {
		fixlv = calcfixlv(2)
	} else {
		fixlv = __iii
	}
	return



#deffunc fltn str __jjj
	s2@m44 = __jjj
	p@m44 = 0
	repeat 5
		getstr filtern(cnt), s2@m44, p@m44, 47
		if (strsize == 0) {
			break
		}
		filtern(cnt) = "/" + filtern(cnt) + "/"
		p@m44 += strsize
		filtermax++
	loop
	return
*label_0288



#defcfunc discsetmc
	return rnd(95 - 50 - 2)



#defcfunc fltsetdungeon
	if (rnd(20) == 0) {
		return fsetrare(rnd(length(fsetrare)))
	}
	if (rnd(3) == 0) {
		return fsetwear(rnd(length(fsetwear)))
	}
	return fsetitem(rnd(length(fsetitem)))



#defcfunc randomele
	p@m45 = rnd(61 - 50) + 50
	if (sdataref(3, p@m45) != 1) {
		p(96) = 2 + encpfix * rnd(limit(objlv / 16, 0, 3) + 1)
		repeat sdataref(3, p@m45) - 1
			i@m45 = rnd(61 - 50) + 50
			if (sdataref(3, i@m45) < sdataref(3, p@m45)) {
				if (rnd(p(96)) == 0) {
					p@m45 = i@m45
				}
			}
		loop
	}
	return p@m45
*label_0292



#deffunc putenclv int __kkk
	if ((abs(__kkk) + 1 - (strict != 0)) / 30 >= 1) {
		p(80) = limitmax((abs(__kkk) + 1 - (strict != 0)) / 30, 5)
		repeat p(80)
			s += ">"
		loop
		repeat limitmax((abs(__kkk) + 1 - (strict != 0)) \ 30 / 6, 6 - p(80))
			s += "+"
		loop
	} else {
		p(80) = limitmax((abs(__kkk) + 1 - (strict != 0)) / 6, 5)
		repeat p(80)
			s += "+"
		loop
		repeat limitmax((abs(__kkk) + 1 - (strict != 0)) \ 6, 6 - p(80))
			s += lang("*", "#")
		loop
	}
	return



#defcfunc encflt int __lll, int __mmm
	if (__mmm == 2) {
		if ((__lll >= 12000 & __lll < 24000) == 0) {
			return 0
		} else {
			return 1
		}
	}
	if (__mmm == 1) {
		if ((__lll >= 30000 & __lll < 50000) == 0) {
			return 0
		} else {
			return 1
		}
	}
	if (__mmm == 3) {
		if ((__lll >= 12000 & __lll < 24000) == 1 | __lll == 10000) {
			return 1
		} else {
			return 0
		}
	}
	if (__lll == __mmm) {
		return 1
	} else {
		return 0
	}
*label_0295
	dim encref, 8, 70
	dim enclist, 2, 70
	dim encammoref, 3, 6
	sdim ammoname, 6
	encammoref(0, 0) = 30, 70, 1
	encammoref(0, 1) = 5, 15, 10
	encammoref(0, 3) = 20, 35, 2
	encammoref(0, 2) = 15, 30, 2
	encammoref(0, 4) = 2, 5, 25
	encammoref(0, 5) = 2, 5, 15
	ammoname = lang("òAéÀíe", "rapid ammo"), lang("‡yóÙíe", "explosive ammo"), lang("ä—í íe", "piercing ammo"), lang("ñÇíe", "magic ammo"), lang("éûé~íe", "time stop ammo"), lang("ÉoÅ[ÉXÉg", "burst ammo")
	encref(0, 21) = -1, 50, 75, 0
	encref(0, 45) = -1, 50, 100, 0
	encref(0, 46) = -1, 50, 100, 0
	encref(0, 47) = -1, 50, 50, 0
	encref(0, 56) = 0, 200, 30, 0
	encref(0, 59) = 0, 200, 30, 0
	encref(0, 3) = 0, 120, 4500, 0
	encref(0, 6) = 0, 120, 4500, 0
	encref(0, 7) = 2, 120, 900, 10000, 24000
	encref(0, 9) = 1, 120, 50000, 25000
	encref(0, 23) = 1, 120, 400, 0
	encref(0, 1) = 1, 120, 3000, 0
	encref(0, 22) = 1, 150, 150, 0
	encref(0, 25) = 1, 120, 400, 0
	encref(0, 2) = 3, 150, 7500, 0
	encref(0, 24) = 2, 120, 300, 0
	encref(0, 26) = 1, 120, 600, 0
	encref(0, 27) = 1, 120, 600, 0
	encref(0, 28) = 2, 120, 500, 0
	encref(0, 29) = 3, 200, 25, 18000
	encref(0, 30) = 3, 200, 25, 20000
	encref(0, 31) = 2, 200, 40, 32000
	encref(0, 48) = 1, 120, 300, 0
	encref(0, 50) = 3, 180, 150, 32000, 34000
	encref(0, 51) = 3, 180, 150, 32000, 34000
	encref(0, 32) = 1, 130, 250, 0
	encref(0, 55) = 3, 130, 40, 19000, 34000
	encref(0, 33) = 3, 160, 200, 0
	encref(0, 34) = 3, 170, 250, 10000
	encref(0, 57) = 2, 170, 200, 10000, 24000
	encref(0, 58) = 2, 170, 200, 10000, 24000
	encref(0, 52) = 1, 140, 750, 14000
	encref(0, 53) = 2, 160, 500, 14000
	encref(0, 54) = 3, 180, 250, 14000, 16000
	encref(0, 35) = 2, 170, 100, 12000, 32000
	encref(0, 44) = 99, 300, 10000, 10000, 34000
	encref(0, 42) = 99, 300, 2000, 0
	encref(0, 36) = 99, 450, 1000, 10000, 24000
	encref(0, 38) = 99, 450, 1000, 10000, 24000
	encref(0, 37) = 99, 100, 1000, 10000, 24000
	encref(0, 39) = 99, 500, 500, 10000, 22000
	encref(0, 40) = 99, 550, 500, 10000, 24000
	encref(0, 41) = 99, 300, 1500, 0
	encref(0, 43) = 99, 150, 2000, 0
	encref(0, 8) = 99, 300, 15000, 0
	encref(0, 49) = 100, 120, 300, 60000
	encref(0, 60) = 100, 120, 300, 60000
	encref(0, 61) = 2, 170, 150, 10000, 24000
	encref(0, 62) = 2, 170, 150, 10000, 24000
	encref(0, 63) = 99, 150, 100, 32000, 34000
	dim encprocref, 6, 30
	encprocref(0, 0) = 450, 2000, 1000, 10000, 24000, 10
	encprocref(0, 1) = 620, 2000, 6000, 24000, 0, 50
	encprocref(0, 2) = 452, 2000, 1000, 10000, 24000, 10
	encprocref(0, 3) = 434, 2000, 800, 10000, 24000, 12
	encprocref(0, 4) = 433, 2000, 600, 10000, 24000, 12
	encprocref(0, 5) = 625, 3000, 400, 10000, 24000, 2
	encprocref(0, 6) = 627, 3000, 1000, 10000, 24000, 50
	encprocref(0, 7) = 619, 2000, 4000, 24000, 0, 50
	encprocref(0, 8) = 604, 2000, 1000, 10000, 24000, 15
	encprocref(0, 9) = 609, 2000, 1000, 10000, 24000, 15
	encprocref(0, 10) = 608, 2000, 1000, 10000, 24000, 15
	encprocref(0, 11) = 453, 3000, 1000, 10000, 24000, 4
	encprocref(0, 12) = 451, 3000, 1000, 10000, 24000, 4
	encprocref(0, 13) = 448, 3000, 1000, 10000, 24000, 4
	encprocref(0, 14) = 446, 3000, 400, 10000, 24000, 1
	encprocref(0, 15) = 444, 3000, 1000, 10000, 24000, 3
	encprocref(0, 16) = 442, 3000, 1000, 10000, 24000, 2
	encprocref(0, 17) = 443, 2000, 800, 10000, 24000, 10
	encprocref(0, 18) = 436, 2000, 1000, 10000, 24000, 10
	encprocref(0, 19) = 421, 2000, 1000, 10000, 24000, 15
	encprocref(0, 20) = 422, 2000, 1000, 10000, 24000, 15
	encprocref(0, 21) = 423, 2000, 1000, 10000, 24000, 15
	encprocref(0, 22) = 419, 2000, 1000, 10000, 24000, 15
	encprocref(0, 23) = 404, 3000, 800, 10000, 24000, 2
	encprocref(0, 24) = 655, 2000, 200, 10000, 24000, 90
	encprocref(0, 25) = 658, 2000, 1000, 10000, 0, 100
	encprocref(0, 26) = 405, 2000, 200, 10000, 24000, 5
	encprocref(0, 27) = 631, 2000, 100, 10000, 0, 10
	encprocref(0, 28) = 661, 2000, 100, 24000, 0, 5
	encprocref(0, 29) = 621, 3000, 200, 10000, 24000, 5
	dim encetc, 43
	sdim encetcn, 100, 2, 43
	encetc(0) = 21
	encetc(1) = 22
	encetc(2) = 23
	encetc(3) = 24
	encetc(4) = 25
	encetc(5) = 26
	encetc(6) = 27
	encetc(7) = 28
	encetc(8) = 29
	encetc(9) = 30
	encetc(10) = 31
	encetc(11) = 32
	encetc(12) = 33
	encetc(13) = 34
	encetc(14) = 35
	encetc(15) = 36
	encetc(16) = 37
	encetc(17) = 38
	encetc(18) = 39
	encetc(19) = 40
	encetc(20) = 41
	encetc(21) = 42
	encetc(22) = 43
	encetc(23) = 44
	encetc(24) = 45
	encetc(25) = 46
	encetc(26) = 47
	encetc(27) = 48
	encetc(28) = 49
	encetc(29) = 50
	encetc(30) = 51
	encetc(31) = 52
	encetc(32) = 53
	encetc(33) = 54
	encetc(34) = 55
	encetc(35) = 56
	encetc(36) = 57
	encetc(37) = 58
	encetc(38) = 59
	encetc(39) = 60
	encetc(40) = 61
	encetc(41) = 62
	encetc(42) = 63

	// OOM enchantment filter
	if (jp) {
		encetcn(0, 0) = "ÉâÉìÉ_ÉÄÇ»ÉeÉåÉ|Å[ÉgÇà¯Ç´ãNÇ±Ç∑", "ÉâÉìÉ_ÉÄÉeÉåÉ|"
		encetcn(0, 1) = "ÉeÉåÉ|Å[ÉgÇñWäQÇ∑ÇÈ", "ÉeÉåÉ|ñWäQ"
		encetcn(0, 2) = "ñ”ñ⁄Çñ≥å¯Ç…Ç∑ÇÈ", "ñ”ñ⁄ñ≥å¯"
		encetcn(0, 3) = "ñÉ·ÉÇñ≥å¯Ç…Ç∑ÇÈ", "ñÉ·Éñ≥å¯"
		encetcn(0, 4) = "ç¨óêÇñ≥å¯Ç…Ç∑ÇÈ", "ç¨óêñ≥å¯"
		encetcn(0, 5) = "ã∞ï|Çñ≥å¯Ç…Ç∑ÇÈ", "ã∞ï|ñ≥å¯"
		encetcn(0, 6) = "êáñ∞Çñ≥å¯Ç…Ç∑ÇÈ", "êáñ∞ñ≥å¯"
		encetcn(0, 7) = "ì≈Çñ≥å¯Ç…Ç∑ÇÈ", "ì≈ñ≥å¯"
		encetcn(0, 8) = "ë¨ìxÇè„Ç∞ÅAÉèÅ[ÉãÉhÉ}ÉbÉvÇ≈ÇÃà⁄ìÆéûä‘ÇíZÇ≠Ç∑ÇÈ", "à⁄ìÆíZèk"
		encetcn(0, 9) = "ÉGÅ[ÉeÉãÇÃïóÇ©ÇÁÇ†Ç»ÇΩÇï€åÏÇ∑ÇÈ", "ÉGÅ[ÉeÉãï€åÏ"
		encetcn(0, 10) = "óãâJÇ∆ê·Ç…ÇÊÇÈë´é~ÇﬂÇñ≥å¯Ç…Ç∑ÇÈ", "ÉIÅ[ÉçÉâå¯â "
		encetcn(0, 11) = "Ç†Ç»ÇΩÇïÇóVÇ≥ÇπÇÈ", "ïÇóV"
		encetcn(0, 12) = "Ç†Ç»ÇΩÇïœàŸÇ©ÇÁï€åÏÇ∑ÇÈ", "ïœàŸï€åÏ"
		encetcn(0, 13) = "ñÇñ@ÇÃà–óÕÇçÇÇﬂÇÈ", "ñÇñ@à–óÕ"
		encetcn(0, 14) = "ìßñæÇ»ë∂ç›Çå©ÇÈÇ±Ç∆Çâ¬î\Ç…Ç∑ÇÈ", "ìßñæéã"
		encetcn(0, 15) = "çUåÇëŒè€Ç©ÇÁÉXÉ^É~ÉiÇãzé˚Ç∑ÇÈ", "ÉXÉ^É~Éiãzé˚"
		encetcn(0, 16) = "ëSÇƒÇèIåãÇ≥ÇπÇÈ", "èIåã"
		encetcn(0, 17) = "çUåÇëŒè€Ç©ÇÁÉ}ÉiÇãzé˚Ç∑ÇÈ", "É}Éiãzé˚"
		encetcn(0, 18) = "äÆëSä—í çUåÇî≠ìÆÇÃã@âÔÇëùÇ‚Ç∑", "äÆëSä—í "
		encetcn(0, 19) = "ãHÇ…éûÇé~ÇﬂÇÈ", "éûé~Çﬂ"
		encetcn(0, 20) = "ÉAÉCÉeÉÄÇìêÇ‹ÇÍÇ»Ç≠Ç∑ÇÈ", "ìêìÔñhé~"
		encetcn(0, 21) = "ïÖÇ¡ÇΩÇ‡ÇÃÇìÔÇ»Ç≠è¡âªÇ≥ÇπÇÈ", "ìÔè¡âª"
		encetcn(0, 22) = "éÙÇ¢ÇÃåæótÇ©ÇÁï€åÏÇ∑ÇÈ", "éÙÇ¢ï€åÏ"
		encetcn(0, 23) = "ÉNÉäÉeÉBÉJÉãÉqÉbÉgÇÃã@âÔÇëùÇ‚Ç∑", "ÉNÉäÉeÉBÉJÉã"
		encetcn(0, 24) = "égópé“ÇÃê∂Ç´ååÇãzÇ§", "ãzåå"
		encetcn(0, 25) = "Ç†Ç»ÇΩÇÃê¨í∑ÇñWÇ∞ÇÈ", "ê¨í∑ëjäQ"
		encetcn(0, 26) = "ñÇï®ÇåƒÇ—äÒÇπÇÈ", "ñÇï®"
		encetcn(0, 27) = "àŸï®ÇÃëÃì‡Ç÷ÇÃêNì¸ÇñhÇÆ", "êNì¸ñhé~"
		encetcn(0, 28) = "ââëtïÒèVÇÃïiéøÇè„Ç∞ÇÈ", "ââëtïÒèVå¸è„"
		encetcn(0, 29) = "í«â¡ë≈åÇÇÃã@âÔÇëùÇ‚Ç∑", "í«â¡ë≈åÇ"
		encetcn(0, 30) = "í«â¡éÀåÇÇÃã@âÔÇëùÇ‚Ç∑", "í«â¡éÀåÇ"
		encetcn(0, 31) = "îÌÇÈï®óùÉ_ÉÅÅ[ÉWÇåyå∏Ç∑ÇÈ", "É_ÉÅåyå∏"
		encetcn(0, 32) = "îÌÇÈÉ_ÉÅÅ[ÉWÇãHÇ…ñ≥å¯Ç…Ç∑ÇÈ", "É_ÉÅñ≥å¯"
		encetcn(0, 33) = "çUåÇÇ≥ÇÍÇΩéûÅAëäéËÇ…êÿÇËèùÇÃÉ_ÉÅÅ[ÉWÇó^Ç¶ÇÈ", "êÿèùÉJÉEÉìÉ^Å["
		encetcn(0, 34) = "èoååÇó}Ç¶ÇÈ", "èoååó}é~"
		encetcn(0, 35) = "ê_Ç™î≠Ç∑ÇÈìdîgÇÉLÉÉÉbÉ`Ç∑ÇÈ", "ìdîgéÛêM"
		encetcn(0, 36) = "ó≥ë∞Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "ó≥ì¡çU"
		encetcn(0, 37) = "ïséÄé“Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "ïséÄì¡çU"
		encetcn(0, 38) = "ëºé“ÇÃêMã¬ÇñæÇÁÇ©Ç…Ç∑ÇÈ", "êMã¬â¬éã"
		encetcn(0, 39) = "ê[Ç¢âπêFÇ≈íÆèOÇêåÇÌÇ∑", "ÉOÅ[ÉãÉhå¯â "
		encetcn(0, 40) = "ê_Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "ê_ì¡çU"
		encetcn(0, 41) = "êlä‘Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "êlì¡çU"
		encetcn(0, 42) = "ÉXÉ^É~ÉiÇÇ†Ç∞ÇÈ", "STè„è∏"
	}
	else {
		encetcn(0, 0) = "causes random teleport.", "random teleport"
		encetcn(0, 1) = "prevents you from teleporting.", "no teleport"
		encetcn(0, 2) = "negates the effect of blindness.", "no blindness"
		encetcn(0, 3) = "negates the effect of paralysis.", "no paralysis"
		encetcn(0, 4) = "negates the effect of confusion.", "no confusion"
		encetcn(0, 5) = "negates the effect of fear.", "no fear"
		encetcn(0, 6) = "negates the effect of sleep.", "no sleep"
		encetcn(0, 7) = "negates the effect of poison.", "no poison"
		encetcn(0, 8) = "speeds up your travel progress.", "7 L boots effect"
		encetcn(0, 9) = "protects you from Etherwind.", "protects from etherwind"
		encetcn(0, 10) = "protects you from bad weather.", "aurora ring effect"
		encetcn(0, 11) = "floats you.", "floating"
		encetcn(0, 12) = "protects you from mutation.", "protects from mutation"
		encetcn(0, 13) = "enhances your spells.", "spell enhancement"
		encetcn(0, 14) = "allows you to see invisible creaturers.", "can see invisible"
		encetcn(0, 15) = "absorbs stamina from an enemy.", "absorbs stamina"
		encetcn(0, 16) = "brings an end.", "Ragnarok"
		encetcn(0, 17) = "absorbs MP from an enemy.", "absorbs MP"
		encetcn(0, 18) = "increases chance of absolute piercing.", "absolute piercing"
		encetcn(0, 19) = "occasionally stops time.", "time stop"
		encetcn(0, 20) = "protects you from thieves.", "protects from thieves"
		encetcn(0, 21) = "allows you to digest rotten food.", "can digest rotten"
		encetcn(0, 22) = "protects you from cursing words.", "protects from curse"
		encetcn(0, 23) = "increases chance of critical hits.", "critical hits"
		encetcn(0, 24) = "sucks blood of the wielder.", "sucks blood"
		encetcn(0, 25) = "disturbs your growth.", "disturbs growth"
		encetcn(0, 26) = "attracts monsters.", "attracts monsters"
		encetcn(0, 27) = "prevents aliens from enterng your body.", "protects from aliens"
		encetcn(0, 28) = "increases the quality of rewards.", "performance rewards"
		encetcn(0, 29) = "increases chance of extra melee attack.", "extra melee attack"
		encetcn(0, 30) = "increases chance of extra ranged attack.", "extra ranged attack"
		encetcn(0, 31) = "decreases physical damage you take.", "decreases dmg"
		encetcn(0, 32) = "sometimes nullifies damage you take.", "nullifies dmg"
		encetcn(0, 33) = "deals cut damage to the attacker", "cut counterattack"
		encetcn(0, 34) = "diminishes bleeding.", "diminishes bleeding"
		encetcn(0, 35) = "catches signals from God.", "god's signal"
		encetcn(0, 36) = "inflicts massive damage to dragons.", "slays dragons"
		encetcn(0, 37) = "inflicts massive damage to undeads.", "slays undeads"
		encetcn(0, 38) = "reveals religion.", "reveals religion"
		encetcn(0, 39) = "makes audience drunk with haunting tones.", "Gould's Piano effect"
		encetcn(0, 40) = "inflicts massive damage to Gods.", "slays Gods"
		encetcn(0, 41) = "inflicts massive damage to Humans.", "slays Humans"
		encetcn(0, 42) = "Increase stamina.", "up SP"
	}
	return
*label_0297
	rtval = 4, 0
	s = "error:" + val + "/" + val(1)
	val(10) = val / 10000
	if (val(10) != 0) {
		if (val(2) == 1) {
			s = ""
			return
		}
		sid = val \ 10000
		if (val(10) == 1) {
			rtval = 2
			if (val(1) / 50 + 1 < 0) {
				rtval = 9
				s = lang("" + skillname(sid) + "Ç" + abs(val(1) / 50 + 1 - (strict != 0)) + "â∫Ç∞ÇÈ", "decreases your " + skillname(sid) + " by " + abs(val(1) / 50 + 1) + ".")
				if (val(3) == 57000) {
					s = lang("" + skillname(sid) + "Çå∏êäÇ≥ÇπÇÈì≈ëfÇä‹ÇÒÇ≈Ç¢ÇÈ", "has which deteriorates your " + skillname(sid) + ".") + " ["
					putenclv val(1) / 50
					s += "]"
				}
			} else {
				s = lang("" + skillname(sid) + "Ç" + abs(val(1) / 50 + 1 - (strict != 0)) + "è„Ç∞ÇÈ", "increases your " + skillname(sid) + " by " + abs(val(1) / 50 + 1) + ".")
				if (val(3) == 57000) {
					s = lang("" + skillname(sid) + "Çëùã≠Ç≥ÇπÇÈâhó{ÇÇ‡Ç¡ÇƒÇ¢ÇÈ", "has essential nutrients to enhance your " + skillname(sid) + ".") + " ["
					putenclv val(1) / 50
					s += "]"
				}
			}
		}
		if (val(10) == 2) {
			rtval = 3
			i = val(1) / 2 / 50
			if (val(1) / 2 < 0) {
				rtval = 9
				s = lang("" + skillname(sid) + "Ç÷ÇÃëœê´Çé„âªÇ∑ÇÈ", "weakens your resistance to " + skillname(sid) + ".")
				if (val(3) == 57000) {
					s = lang("" + skillname(sid) + "Ç÷ÇÃëœê´Çå∏êäÇ≥ÇπÇÈì≈ëfÇä‹ÇÒÇ≈Ç¢ÇÈ", "has which deteriorates your " + skillname(sid) + ".")
				}
			} else {
				s = skillencdesc(sid)
				if (s == "") {
					s = lang("" + skillname(sid) + "Ç÷ÇÃëœê´ÇéˆÇØÇÈ", "grants your resistance to " + skillname(sid) + ".")
				}
				if (val(3) == 57000) {
					s = lang("" + skillname(sid) + "Ç÷ÇÃëœê´Çëùã≠Ç≥ÇπÇÈâhó{ÇÇ‡Ç¡ÇƒÇ¢ÇÈ", "has essential nutrients to enhance your " + skillname(sid) + ".")
				}
			}
			s += " ["
			putenclv i
			s += "]"
		}
		if (val(10) == 3) {
			rtval = 1
			i = val(1) / 50 + 1
			if (val(1) / 50 + 1 < 0) {
				rtval = 9
				if (cfg_ST_enchantmentHumanreadable) {
					s = strf(lang("" + skillname(sid) + "ÇÃãZî\Ç%dâ∫Ç∞ÇÈ", "decreases your " + skillname(sid) + " skill by %d."), abs(i))
				} else {
					s = lang("" + skillname(sid) + "ÇÃãZî\Çâ∫Ç∞ÇÈ", "decreases your " + skillname(sid) + " skill.")
				}
				if (val(3) == 57000) {
					s = lang("" + skillname(sid) + "ÇÃãZî\Çå∏êäÇ≥ÇπÇÈì≈ëfÇä‹ÇÒÇ≈Ç¢ÇÈ", "has which deteriorates your " + skillname(sid) + ".")
				}
			} else {
				if (cfg_ST_enchantmentHumanreadable) {
					s = strf(lang("" + skillname(sid) + "ÇÃãZî\Ç%dè„Ç∞ÇÈ", "improves your " + skillname(sid) + " skill by %d."), i)
				} else {
					s = skillencdesc(sid)
					if (s == "") {
						s = lang("" + skillname(sid) + "ÇÃãZî\Çè„Ç∞ÇÈ", "improves your " + skillname(sid) + " skill.")
					}
				}
				if (val(3) == 57000) {
					s = lang("" + skillname(sid) + "ÇÃãZî\Çëùã≠Ç≥ÇπÇÈâhó{ÇÇ‡Ç¡ÇƒÇ¢ÇÈ", "has essential nutrients to enhance your " + skillname(sid) + ".")
				}
			}
			s += " ["
			putenclv i / 5
			s += "]"
		}
		if (val(10) == 6) {
			rtval = 8
			s = lang(skillname(sid) + "Çà€éùÇ∑ÇÈ", "maintains " + skillname(sid) + ".")
			if (val(3) == 57000) {
				s = lang("" + skillname(sid) + "ÇÃê¨í∑ÇèïÇØÇÈâhó{ÇÇ‡Ç¡ÇƒÇ¢ÇÈ", "can help you exercise your " + skillname(sid) + " faster.") + " ["
				putenclv val(1) / 50
				s += "]"
			}
		}
		if (val(10) == 7) {
			rtval = 4
			i = val(1) / 2 / 50
			s = skillencdesc(sid)
			if (s == "") {
				s = lang("" + skillname(sid) + "ëÆê´ÇÃí«â¡É_ÉÅÅ[ÉWÇó^Ç¶ÇÈ", "deals " + skillname(sid) + " damage.")
			}
			if (val(3) != 10000 & val(3) != 24000) {
				s = lang("çUåÇÇ…" + skillname(sid) + "ëÆê´ÇÃí«â¡É_ÉÅÅ[ÉWÇïtó^Ç∑ÇÈ", "add attack deals " + skillname(sid) + " damage.")
			}
			s += " ["
			putenclv i
			s += "]"
		}
		if (val(10) == 8) {
			rtval = 4
			i = val(1) / 50
			sid = encprocref(0, sid)
			if (encprocref2) {
				sid = encprocref2(0)
			}
			if (sid < 0 || length(skillname) <= sid) {
				s = lang("âΩÇÁÇ©ÇÃå¯â ", "some effect")
			} else {
				s = skillname(sid)
			}
			s = lang(s + "Çî≠ìÆÇ∑ÇÈ", "invokes " + s + ".")
			s += " ["
			putenclv i
			s += "]"
		}
		if (val(10) == 9) {
			rtval = 4
			s = lang("" + ammoname(sid) + "ÇëïìUÇ≈Ç´ÇÈ", "can be loaded with " + ammoname(sid) + ".")
			s += lang(" [ç≈ëÂ", " [Max ") + val(1) / 1000 + lang("î≠]", "]")
		}
		if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
			s += "(" + val(1) + ")"
		}
		return
	}
	if (val == 0) {
		s = "?????"
	}
	if (val == 21) {
		rtval = 9
		s = lang("ÉâÉìÉ_ÉÄÇ»ÉeÉåÉ|Å[ÉgÇà¯Ç´ãNÇ±Ç∑", "causes random teleport.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 45) {
		rtval = 9
		s = lang("égópé“ÇÃê∂Ç´ååÇãzÇ§", "sucks blood of the wielder.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 46) {
		rtval = 9
		s = lang("Ç†Ç»ÇΩÇÃê¨í∑ÇñWÇ∞ÇÈ", "disturbs your growth.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 47) {
		rtval = 9
		s = lang("ñÇï®ÇåƒÇ—äÒÇπÇÈ", "attracts monsters.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 22) {
		rtval = 4
		s = lang("ÉeÉåÉ|Å[ÉgÇñWäQÇ∑ÇÈ", "prevents you from teleporting.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 23) {
		rtval = 4
		s = lang("ñ”ñ⁄Çñ≥å¯Ç…Ç∑ÇÈ", "negates the effect of blindness.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 24) {
		rtval = 4
		s = lang("ñÉ·ÉÇñ≥å¯Ç…Ç∑ÇÈ", "negates the effect of paralysis.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 25) {
		rtval = 4
		s = lang("ç¨óêÇñ≥å¯Ç…Ç∑ÇÈ", "negates the effect of confusion.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 26) {
		rtval = 4
		s = lang("ã∞ï|Çñ≥å¯Ç…Ç∑ÇÈ", "negates the effect of fear.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 27) {
		rtval = 4
		s = lang("êáñ∞Çñ≥å¯Ç…Ç∑ÇÈ", "negates the effect of sleep.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 28) {
		rtval = 4
		s = lang("ì≈Çñ≥å¯Ç…Ç∑ÇÈ", "negates the effect of poison.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 41) {
		rtval = 4
		s = lang("ÉAÉCÉeÉÄÇìêÇ‹ÇÍÇ»Ç≠Ç∑ÇÈ", "protects you from thieves.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 42) {
		rtval = 4
		s = lang("ïÖÇ¡ÇΩÇ‡ÇÃÇìÔÇ»Ç≠è¡âªÇ≥ÇπÇÈ", "allows you to digest rotten food.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 29) {
		rtval = 4
		s = lang("ë¨ìxÇè„Ç∞ÅAÉèÅ[ÉãÉhÉ}ÉbÉvÇ≈ÇÃà⁄ìÆéûä‘ÇíZÇ≠Ç∑ÇÈ", "speeds up your travel progress.")
		if (val(1) / 100 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 100
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 100
				return
			}
		}
	}
	if (val == 30) {
		rtval = 4
		s = lang("ÉGÅ[ÉeÉãÇÃïóÇ©ÇÁÇ†Ç»ÇΩÇï€åÏÇ∑ÇÈ", "protects you from Etherwind.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 31) {
		rtval = 4
		s = lang("óãâJÇ∆ê·Ç…ÇÊÇÈë´é~ÇﬂÇñ≥å¯Ç…Ç∑ÇÈ", "negates the effect of being stranded by bad weather.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 48) {
		rtval = 4
		s = lang("àŸï®ÇÃëÃì‡Ç÷ÇÃêNì¸ÇñhÇÆ", "prevents aliens from entering your body.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 32) {
		rtval = 4
		s = lang("Ç†Ç»ÇΩÇïÇóVÇ≥ÇπÇÈ", "floats you.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 33) {
		rtval = 4
		s = lang("Ç†Ç»ÇΩÇïœàŸÇ©ÇÁï€åÏÇ∑ÇÈ", "protects you from mutation.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 34) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("ñÇñ@ÇÃà–óÕÇ%d%%çÇÇﬂÇÈ", "enhances your spells by %d%%."), val(1) / 10)
		} else {
			s = lang("ñÇñ@ÇÃà–óÕÇçÇÇﬂÇÈ", "enhances your spells.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 35) {
		rtval = 4
		s = lang("ìßñæÇ»ë∂ç›Çå©ÇÈÇ±Ç∆Çâ¬î\Ç…Ç∑ÇÈ", "allows you to see invisible creatures.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 36) {
		rtval = 4
		s = lang("çUåÇëŒè€Ç©ÇÁÉXÉ^É~ÉiÇãzé˚Ç∑ÇÈ", "absorbs stamina from an enemy.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 37) {
		rtval = 4
		s = lang("ëSÇƒÇèIåãÇ≥ÇπÇÈ", "brings an end.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 38) {
		rtval = 4
		s = lang("çUåÇëŒè€Ç©ÇÁÉ}ÉiÇãzé˚Ç∑ÇÈ", "absorbs MP from an enemy.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 39) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("äÆëSä—í çUåÇî≠ìÆÇÃã@âÔÇ%d%%ëùÇ‚Ç∑", "gives you a %d%% chance to throw an absolute piercing attack."), val(1) / 50)
		} else {
			s = lang("äÆëSä—í çUåÇî≠ìÆÇÃã@âÔÇëùÇ‚Ç∑", "gives you a chance to throw an absolute piercing attack.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 44) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("ÉNÉäÉeÉBÉJÉãÉqÉbÉgÇÃã@âÔÇ%d%%ëùÇ‚Ç∑", "increases your chance to deliver critical hits by %d%%."), val(1) / 50)
		} else {
			s = lang("ÉNÉäÉeÉBÉJÉãÉqÉbÉgÇÃã@âÔÇëùÇ‚Ç∑", "increases your chance to deliver critical hits.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 50) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("í«â¡ë≈åÇÇÃã@âÔÇ%d%%ëùÇ‚Ç∑", "increases the chance of extra melee attack by %d%%."), val(1) / 15)
		} else {
			s = lang("í«â¡ë≈åÇÇÃã@âÔÇëùÇ‚Ç∑", "increases the chance of extra melee attack.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 51) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("í«â¡éÀåÇÇÃã@âÔÇ%d%%ëùÇ‚Ç∑", "increases the chance of extra ranged attack by %d%%."), val(1) / 15)
		} else {
			s = lang("í«â¡éÀåÇÇÃã@âÔÇëùÇ‚Ç∑", "increases the chance of extra ranged attack.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 40) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("ãHÇ…éûÇ%dÉ^Å[Éìé~ÇﬂÇÈ", "occasionally stops time in %d turn(s)."), val(1) / 100)
		} else {
			s = lang("ãHÇ…éûÇé~ÇﬂÇÈ", "occasionally stops time.")
		}
		if (val(1) == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 100
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 100
				return
			}
		}
	}
	if (val == 43) {
		rtval = 4
		s = lang("éÙÇ¢ÇÃåæótÇ©ÇÁï€åÏÇ∑ÇÈ", "protects you from cursing words.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 49) {
		rtval = 4
		s = lang("ââëtïÒèVÇÃïiéøÇè„Ç∞ÇÈ", "increases the quality of reward.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 52) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("îÌÇÈï®óùÉ_ÉÅÅ[ÉWÇ%d%%åyå∏Ç∑ÇÈ", "decreases physical damage you take by %d%%."), val(1) / 40 + 5)
		} else {
			s = lang("îÌÇÈï®óùÉ_ÉÅÅ[ÉWÇåyå∏Ç∑ÇÈ", "decreases physical damage you take.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 53) {
		rtval = 4
		if (cfg_ST_enchantmentHumanreadable) {
			s = strf(lang("îÌÇÈÉ_ÉÅÅ[ÉWÇ%d%%ÇÃämó¶Ç≈ñ≥å¯Ç…Ç∑ÇÈ", "nullifies damage you take %d%%."), val(1) / 60 + 3)
		} else {
			s = lang("îÌÇÈÉ_ÉÅÅ[ÉWÇãHÇ…ñ≥å¯Ç…Ç∑ÇÈ", "sometimes nullifies damage you take.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 54) {
		rtval = 4
		s = lang("çUåÇÇ≥ÇÍÇΩéûÅAëäéËÇ…êÿÇËèùÇÃÉ_ÉÅÅ[ÉWÇó^Ç¶ÇÈ", "deals cut damage to the attacker.")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 55) {
		rtval = 4
		s = lang("èoååÇó}Ç¶ÇÈ", "diminishes bleeding.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 56) {
		rtval = 4
		s = lang("ê_Ç™î≠Ç∑ÇÈìdîgÇÉLÉÉÉbÉ`Ç∑ÇÈ", "catches signals from God.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 57) {
		rtval = 4
		s = lang("ó≥ë∞Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "inflicts massive damage to dragons.")
		if (val(3) != 10000 & val(3) != 24000) {
			s = lang("çUåÇÇ…ó≥ë∞Ç…ëŒÇµÇƒÇÃí«â¡É_ÉÅÅ[ÉWÇïtó^Ç∑ÇÈ", "inflicts massive damage to dragons.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 58) {
		rtval = 4
		s = lang("ïséÄé“Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "inflicts massive damage to undeads.")
		if (val(3) != 10000 & val(3) != 24000) {
			s = lang("çUåÇÇ…ïséÄé“Ç…ëŒÇµÇƒÇÃí«â¡É_ÉÅÅ[ÉWÇïtó^Ç∑ÇÈ", "inflicts massive damage to undeads.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 59) {
		rtval = 4
		s = lang("ëºé“ÇÃêMã¬ÇñæÇÁÇ©Ç…Ç∑ÇÈ", "reveals religion.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 60) {
		rtval = 4
		s = lang("ê[Ç¢âπêFÇ≈íÆèOÇêåÇÌÇ∑", "makes audience drunk with haunting tones.")
		if (gWizard == 0 & godcheck(0) != "mayumaka" & cfg_enchantvisualization == 0) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv -1
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = -1
				return
			}
		}
	}
	if (val == 61) {
		rtval = 4
		s = lang("ê_Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "inflicts massive damage to Gods.")
		if (val(3) != 10000 & val(3) != 24000) {
			s = lang("çUåÇÇ…ê_Ç…ëŒÇµÇƒÇÃí«â¡É_ÉÅÅ[ÉWÇïtó^Ç∑ÇÈ", "inflicts massive damage to Gods.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 62) {
		rtval = 4
		s = lang("êlä‘Ç…ëŒÇµÇƒã≠óÕÇ»à–óÕÇî≠äˆÇ∑ÇÈ", "inflicts massive damage to Humans.")
		if (val(3) != 10000 & val(3) != 24000) {
			s = lang("çUåÇÇ…êlä‘Ç…ëŒÇµÇƒÇÃí«â¡É_ÉÅÅ[ÉWÇïtó^Ç∑ÇÈ", "inflicts massive damage to Humans.")
		}
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				s += " ["
				putenclv val(1) / 50
				s += "]"
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 50
				return
			}
		}
	}
	if (val == 63) {
		rtval = 4
		s = lang("ÉXÉ^É~ÉiÇ" + abs(val(1) / 10) + "è„Ç∞ÇÈ", "increases your SP by " + abs(val(1) / 10) + ".")
		if (val(1) / 50 == (-1)) {
			return
		} else {
			if (val(2) == 0) {
				if (gWizard | godcheck(0) == "mayumaka" | cfg_enchantvisualization) {
					s += "(" + val(1) + ")"
				}
				return
			} else {
				rtval(1) = val(1) / 10
				return
			}
		}
	}
	return



#defcfunc randomenc int __nnn, int __ooo
	sum@m47 = 0
	max@m47 = 0
	repeat 64
		if (encref(0, cnt) > __nnn) {
			continue
		}
		if (__nnn >= 0) {
			if (encref(0, cnt) < 0) {
				continue
			}
		}
		if (__ooo == 0 | __ooo == cnt) {
			if (encref(3, cnt) != 0) {
				if (encflt(reftype, encref(3, cnt)) == 0) {
					if (encref(4, cnt) == 0) {
						continue
					} else {
						if (encflt(reftype, encref(4, cnt)) == 0) {
							continue
						}
					}
				}
			}
		}
		sum@m47 += encref(2, cnt)
		enclist(0, max@m47) = cnt, sum@m47
		max@m47++
	loop
	if (max@m47 == 0) {
		return 0
	}
	i@m47 = 0
	exrand_rnd p@m47, sum@m47
	repeat max@m47
		if (p@m47 < enclist(1, cnt)) {
			i@m47 = enclist(0, cnt)
			break
		}
	loop
	return i@m47



#defcfunc randomenclv int __ppp
	enclv@m47 = limit(__ppp, 0, 4)
	enclv@m47 = rnd(enclv@m47 + 1)
	return enclv@m47



#defcfunc randomencp int __qqq, int __rrr
	if (encbmboost) {
		encp@m47 = rndex2(rndex2(500 + ((ogdata(519) == 2) * 4) + (gettrait(0, 163) != 0) * 50 + encbmboost) + 1) + 1
	} else {
		if (__rrr) {
			encp@m47 = rndex2(rndex2((500 + ((ogdata(519) == 2) * 4) + (gettrait(0, 163) != 0) * 50) * limitmax(1 + ogdata(427) * ogdata(427), 50)) + 1) + 1
		} else {
			encp@m47 = rnd(rnd(500 + ((ogdata(519) == 2) * 4) + (gettrait(0, 163) != 0) * 50 + encpfix * limit(objlv * 50 / 8, 0, 900)) + 1) + 1
		}
	}
	if (__qqq != 0) {
		encp@m47 = encp@m47 * __qqq / 100
	}
	return encp@m47



#deffunc sortenc int __sss
	repeat
		f@m47 = 0
		repeat 15 - 1
			cnt2@m47 = cnt + 1
			if (iEnchantmentId(__sss, cnt) < iEnchantmentId(__sss, cnt2@m47)) {
				p@m47 = iEnchantmentId(__sss, cnt), iEnchantmentPower(__sss, cnt)
				iEnchantmentId(__sss, cnt) = iEnchantmentId(__sss, cnt2@m47)
				iEnchantmentId(__sss, cnt2@m47) = p@m47
				iEnchantmentPower(__sss, cnt) = iEnchantmentPower(__sss, cnt2@m47)
				iEnchantmentPower(__sss, cnt2@m47) = p@m47(1)
				f@m47 = 1
			}
		loop
		if (f@m47 == 0) {
			break
		}
	loop
	return



// @param __ci Item index
// @param __encId Enchantment ID
// @param __encPower Enchantment power
// @param __flipPercentage Percentage of power flip
// @param __force Force to add if true
// @param __onlyCheck If true, this function only checks whether the
//        enchantment can be added to the item or not. Otherwise, it does add
//        the enchantment.
// @param __skipStrictCheck If true, skip strict check whether the
//        enchantment can be added to the item.
#deffunc encadd int __ci, int __encId, int __encPower, int __flipPercentage, int __force, int __onlyCheck, int __skipStrictCheck
	if (__encId == 0) {
		return
	}
	if (__encId >= 10000) {
		enc@m48 = __encId / 10000
	} else {
		enc@m48 = __encId
	}
	if (__skipStrictCheck == 0) {
		if (encref(3, enc@m48) != 0) {
			if (encflt(reftype, encref(3, enc@m48)) == 0) {
				if (encref(4, enc@m48) == 0) {
					return
				} else {
					if (encflt(reftype, encref(4, enc@m48)) == 0) {
						return
					}
				}
			}
		} else {
			if (reftype == 25000) {
				if (__force == 0) {
					return
				}
			}
		}
	}
	enc@m48 = __encId
	encp@m48 = __encPower
	if (enc@m48 < 20) {
		if (enc@m48 == 1) {
			if (__onlyCheck) {
				enc@m48 = rnd(20 - 10) + 10
			} else {
				enc@m48 = rnd(12) + 2
				if (enc@m48 > 3) {
					enc@m48 += 6
				}
				if (enc@m48 <= 3) {
					if (rnd(10)) {
						enc@m48 = rnd(20 - 10) + 10
					}
				}
			}
			enc@m48 += 1 * 10000
			if (__flipPercentage != 0) {
				if (rnd(100) < __flipPercentage) {
					encp@m48 = __encPower * (-2)
				}
			}
		}
		if (enc@m48 == 2) {
			enc@m48 = randomele()
			enc@m48 += 2 * 10000
			if (__flipPercentage != 0) {
				if (rnd(100) < __flipPercentage) {
					encp@m48 = __encPower * (-2)
				}
			}
			if (encp@m48 > 0) {
				if (__skipStrictCheck == 0 & nc_intb_living == 0) {
					if (objlv >= 40) {
						if (refitem(iId(__ci), 5, __ci) != 10000 & refitem(iId(__ci), 5, __ci) != 24000 & refitem(iId(__ci), 5, __ci) != 25000) {
							if (rnd(200) == 0) {
								enc@m48 += 50000
								encp@m48 = encp@m48 / 2 + 1
							}
						}
					}
				}
			}
		}
		if (enc@m48 == 3) {
			if (__onlyCheck) {
				enc@m48 = rnd(190 - 150) + 150
			} else {
				enc@m48 = rnd(42)
				if (enc@m48 < 40) {
					enc@m48 += 150
				} else {
					enc@m48 += 260
				}
			}
			enc@m48 += 3 * 10000
			if (__flipPercentage != 0) {
				if (rnd(100) < __flipPercentage) {
					encp@m48 = __encPower * (-2)
				}
			}
		}
		if (enc@m48 == 6) {
			enc@m48 = rnd(20 - 10) + 10
			enc@m48 += 6 * 10000
		}
		if (enc@m48 == 7) {
			enc@m48 = randomele()
			enc@m48 += 7 * 10000
		}
		if (enc@m48 == 8) {
			sum@m48 = 0
			max@m48 = 0
			repeat 30
				if (__skipStrictCheck == 0) {
					if (encprocref(3, cnt) != 0) {
						if (encflt(reftype, encprocref(3, cnt)) == 0) {
							if (encprocref(4, cnt) == 0) {
								continue
							} else {
								if (encflt(reftype, encprocref(4, cnt)) == 0) {
									continue
								}
							}
						}
					}
				}
				sum@m48 += encprocref(2, cnt)
				enclist(0, max@m48) = cnt, sum@m48
				max@m48++
			loop
			if (max@m48 == 0) {
				return
			}
			i@m48 = 0
			exrand_rnd p@m48, sum@m48
			repeat max@m48
				if (p@m48 < enclist(1, cnt)) {
					i@m48 = enclist(0, cnt)
					break
				}
			loop
			enc@m48 = 8 * 10000 + i@m48
		}
		if (enc@m48 == 9) {
			enc@m48 = rnd(rnd(6) + 1)
			encp@m48 = limit(encp@m48, 0, 500) * encammoref(1, enc@m48) / 500 + encammoref(0, enc@m48)
			enc@m48 += 9 * 10000
			encp@m48 += encp@m48 * 1000
		}
	}
	if (iQuality(__ci) == 6) {
		if (encp@m48 <= 0 & __flipPercentage == 10) {
			return
		}
	}
	i@m48 = -1
	repeat 15
		if (iEnchantmentId(__ci, cnt) == enc@m48) {
			i@m48 = cnt
			continue
		}
		if (i@m48 == (-1)) {
			if (iEnchantmentId(__ci, cnt) == 0) {
				i@m48 = cnt
			}
		}
	loop
	if (i@m48 == (-1)) {
		return 0
	}
	if (iEnchantmentId(__ci, i@m48) == enc@m48) {
		if (__force == 0) {
			if (reftype == 25000) {
				return
			}
			encp@m48 /= 2
		}
	}
	if (__onlyCheck) {
		rtval = enc@m48, encp@m48
		return
	}
	if (iEnchantmentId(__ci, i@m48) == enc@m48) {
		encp@m48 += iEnchantmentPower(__ci, i@m48)
	}
	iEnchantmentId(__ci, i@m48) = enc@m48, encp@m48
	if (__encId < 10000) {
		p@m48 = __encId
	} else {
		p@m48 = __encId / 10000
	}
	if (iValue(__ci) * encref(1, p@m48) / 100 > 0) {
		iValue(__ci) = iValue(__ci) * encref(1, p@m48) / 100
	}
	sortenc __ci
	return 1



#deffunc egoadd int __ddd, int __eee
	repeat 10
		if (egoenc(cnt * 2, __eee) == 0) {
			break
		}
		encadd __ddd, egoenc(cnt * 2, __eee), randomencp(egoenc(cnt * 2 + 1, __eee))
	loop
	return
*label_0308
	sdim egoname
	dim egoenc, 10 * 2, 11
	dim egoref, 2, 11
	dim egolist, 11
	egoname(1) = lang("ê√é‚ÇÃ", "of silence")
	egoref(0, 1) = 0, 1
	p = 1
	egoenc(0, p) = 3 * 10000 + 157, 100, 22, 100
	egoname(6) = lang("ëœñ”ñ⁄ÇÃ", "of resist blind")
	egoref(0, 6) = 1, 1
	p = 6
	egoenc(0, p) = 23, 100
	egoname(8) = lang("ëœç¨óêÇÃ", "of resist confusion")
	egoref(0, 8) = 1, 1
	p = 8
	egoenc(0, p) = 25, 100
	egoname(0) = lang("óÛâŒÇÃ", "of fire")
	egoref(0, 0) = 1, 3
	p = 0
	egoenc(0, p) = 2 * 10000 + 50, 150, 7 * 10000 + 50, 150
	egoname(2) = lang("ïXåãÇÃ", "of cold")
	egoref(0, 2) = 1, 3
	p = 2
	egoenc(0, p) = 2 * 10000 + 51, 150, 7 * 10000 + 51, 150
	egoname(3) = lang("àÓç»ÇÃ", "of lightning")
	egoref(0, 3) = 1, 3
	p = 3
	egoenc(0, p) = 2 * 10000 + 52, 150, 7 * 10000 + 52, 150
	egoname(5) = lang("ñ¸ÇµéËÇÃ", "of healing")
	egoref(0, 5) = 1, 1
	p = 5
	egoenc(0, p) = 3 * 10000 + 154, 100
	egoname(7) = lang("ëœñÉ·ÉÇÃ", "of resist paralysis")
	egoref(0, 7) = 2, 1
	p = 7
	egoenc(0, p) = 24, 100
	egoname(9) = lang("ëœã∞ï|ÇÃ", "of resist fear")
	egoref(0, 9) = 0, 1
	p = 9
	egoenc(0, p) = 26, 100
	egoname(10) = lang("êáñ∞ñhé~ÇÃ", "of resist sleep")
	egoref(0, 10) = 0, 1
	p = 10
	egoenc(0, p) = 27, 100
	egoname(4) = lang("ñhâqé“ÇÃ", "of defender")
	egoref(0, 4) = 3, 10000
	p = 4
	egoenc(0, p) = 2 * 10000 + 50, 100, 2 * 10000 + 51, 100, 2 * 10000 + 52, 100
	egominorn(0) = lang("âSÇ§", "singing"), lang("è¢égÇÃ", "servant's"), lang("è]é“ÇÃ", "follower's"), lang("ôÔÇ≠", "howling"), lang("ãPÇ≠", "glowing")
	egominorn(5) = lang("àŸç ÇÃ", "conspicuous"), lang("ñÇóÕÇë—Ç—ÇΩ", "magical"), lang("à≈Çç”Ç≠", "enchanted"), lang("ã≠óÕÇ»", "mighty"), lang("óäÇÍÇÈ", "trustworthy")
	maxegominorn = length(egominorn)
	egominorn(10) = lang("å÷ÇËÇÃ", "pride"), lang("åàà”ÇÃ", "decision"), lang("à´ñ≤ÇÃ", "nightmares"), lang("ñ≤ñÇÇÃ", "dreamer"), lang("ñÇìπémÇÃ", "sorcerer's")
	return
*label_0309
	repeat rnd(rnd(5) + 1) + 1
		encadd ci, randomenc(randomenclv(egolv)), randomencp(), 8
	loop
	iSubname(ci) = 20000 + rnd(maxegominorn)
	return
*label_0310
	p = 0
	repeat 11
		if (egoref(0, cnt) != egolv) {
			continue
		}
		if (egoref(1, cnt) != 0) {
			if (encflt(reftype, egoref(1, cnt)) == 0) {
				continue
			}
		}
		egolist(p) = cnt
		p++
	loop
	if (p == 0) {
		return
	}
	p = egolist(rnd(p))
	iSubname(ci) = 10000 + p
	egoadd ci, p
	if (rnd(2) == 0) {
		encadd ci, randomenc(randomenclv(egolv)), randomencp(), 20
	}
	if (rnd(4) == 0) {
		encadd ci, randomenc(randomenclv(egolv)), randomencp(), 25
	}
	return



*label_0311
	if (reftype == 25000) {
		iCount(ci) = -1
	}
	if (fixlv <= 2) {
		return
	}
	if (fixlv == 6) {
		egolv = 4
	} else {
		egolv = limit(rnd(objlv / 15 + 3) + 1, 0, 4)
		iValue(ci) = limit(iValue(ci), 0, 2147483647 / 3) * 3
		if (iId(ci) != 743) {
			iDifficultyToIdentify(ci) = 50 + rnd(abs(fixlv - 2) * 100 + 100)
		}
	}
	if (reftypeminor == 10006) {
		repeat 1
			if (rnd(10) == 0) {
				encadd ci, 34, randomencp()
			}
			if (rnd(10) == 0) {
				encadd ci, 1 * 10000 + 16, randomencp()
			}
			if (rnd(10) == 0) {
				encadd ci, 3 * 10000 + 172, randomencp()
				break
			}
			if (rnd(10) == 0) {
				encadd ci, 1 * 10000 + 3, randomencp()
				break
			}
			if (rnd(10) == 0) {
				encadd ci, 3 * 10000 + 164, randomencp()
				break
			}
		loop
	}
	if (reftype == 10000 | reftype == 24000) {
		if (rnd(10) == 0) {
			encadd ci, 3 * 10000 + iSkill(ci), randomencp()
		}
	}
	if (fixlv < 4) {
		if (rnd(2)) {
			gosub *label_0309
		} else {
			gosub *label_0310
		}
	}
	if (fixlv == 4 | fixlv == 5) {
		iSubname(ci) = 40000 + rnd(30000)
		if (fixlv == 5 | (fixlv == 4 & rnd(10) == 0)) {
			encadd ci, randomenc(99), randomencp()
		}
		if (rnd(100) == 0 | weaponjasei | weaponalive) {
			if (reftype == 24000 | reftype == 10000) {
				ibitmod 10, ci, 1
				iParam1(ci) = 1
				if (mode != 6) {
					if (fixlv == 5) {
						if (rnd(10) == 0 | weaponjasei) {
							if (weaponjus == 0) {
								if (rnd(2)) {
									iCurseState(ci) = 1
								} else {
									iCurseState(ci) = -2
									encadd ci, 45, 50
								}
							} else {
								if (weaponjus == 1) {
									iCurseState(ci) = 1
								} else {
									iCurseState(ci) = -2
									encadd ci, 45, 50
								}
							}
							ibitmod 18, ci, 1
							if (iId(ci) == 759 | iId(ci) == 633 | (iId(ci) != 781 & rnd(2))) {
								ibitmod 19, ci, 1
							}
						}
					}
				}
				gosub *label_1780
				return
			}
			gosub *label_1780
		}
		if (fixlv == 4) {
			p = rnd(rnd(rnd(10) + 1) + 3) + 3
		}
		if (fixlv == 5) {
			p = rnd(rnd(rnd(10) + 1) + 3) + 6
		}
		if (p > 11) {
			if (reftype == 10000 | reftype == 24000) {
				if (rnd(10) == 0) {
					ibitmod 15, ci, 1
					encadd ci, randomenc(99), randomencp()
					iCurseState(ci) = 1
				}
			}
		}
		repeat p
			encadd ci, randomenc(randomenclv(egolv)), randomencp() + (fixlv == 5) * 100 + (ibit(15, ci) == 1) * 100, 20 - (fixlv == 5) * 10 - (ibit(15, ci) == 1) * 20
		loop
	}
	if (fixlv == 6) {
		repeat rnd(3)
			encadd ci, randomenc(randomenclv(egolv)), randomencp(), 10
		loop
	}
	if (iCurseState(ci) <= (-1)) {
		encadd ci, randomenc(randomenclv(egolv)), limit(randomencp(), 250, 10000) * (125 + (iCurseState(ci) == (-2)) * 25) / 100
		repeat 1 + (iCurseState(ci) == (-2)) + rnd(2)
			if (rnd(3) == 0) {
				encadd ci, 2, randomencp() * 3 / 2, 100
				continue
			}
			if (rnd(3) == 0) {
				encadd ci, 1, randomencp() * 5 / 2, 100
				continue
			}
			encadd ci, randomenc(-1), randomencp()
		loop
	}
	if (iId(ci) == 483) {
		repeat 15
			if (iEnchantmentId(ci, cnt) == 0) {
				break
			}
			if (iEnchantmentId(ci, cnt) / 10000 != 9) {
				continue
			}
			iEnchantmentPower(ci, cnt) = iEnchantmentPower(ci, cnt) * 2
		loop
	}
	return



*label_0312
	sdim mtname, 18, 2, 50
	dim mtref, 10, 50
	dim mtenc, 8 * 2, 50
	dim mtbit, 10, 50
	if (jp) {
		mtname(0, 36) = "ñÏçÿ"
		mtname(0, 37) = "â é¿"
		mtname(0, 38) = "ÉnÅ[Éu"
		mtname(0, 39) = "ì‰ÇÃï®ëÃ"
		mtname(0, 40) = "ÉAÅ[ÉeÉBÉtÉ@ÉNÉg"
		mtname(0, 41) = "ïÛêŒ"
		mtname(0, 42) = "ñÇñ@ÇÃñÿ"
	} else {
		mtname(0, 36) = "ñÏçÿ"
		mtname(0, 37) = "â é¿"
		mtname(0, 38) = "ÉnÅ[Éu"
		mtname(0, 39) = "ì‰ÇÃï®ëÃ"
		mtname(0, 40) = "ÉAÅ[ÉeÉBÉtÉ@ÉNÉg"
		mtname(0, 41) = "ïÛêŒ"
		mtname(0, 42) = "ñÇñ@ÇÃñÿ"
	}
	p = 0
	if (jp) {
		mtname(0, p) = "çª", "éqãüÇÃÇ®Ç‡ÇøÇ·ÇÃ"
	} else {
		mtname(0, p) = "sand", "toy"
	}
	mtref(0, p) = 10, 80, -5, -5, -5, -5, 100
	mtenc(0, p) = 0
	p = 35
	if (jp) {
		mtname(0, p) = "ê∂Ç‡ÇÃ", "êHóp"
	} else {
		mtname(0, p) = "raw", "candy"
	}
	mtref(0, p) = 100, 50, -5, -5, -5, -5, 100, 0
	mtenc(0, p) = 0
	p = 43
	if (jp) {
		mtname(0, p) = "ñÿ", "å√Ç´"
	} else {
		mtname(0, p) = "wood", "old"
	}
	mtref(0, p) = 150, 50, -5, -5, -5, -5, 100, 0
	mtenc(0, p) = 0
	p = 34
	if (jp) {
		mtname(0, p) = "âî", "èdÇ´"
	} else {
		mtname(0, p) = "iron", "heavy"
	}
	mtref(0, p) = 300, 50, 3, 4, -3, 11, 100, 0
	mtenc(0, p) = 0
	mtbit(0, p) = 1
	p = 12
	if (jp) {
		mtname(0, p) = "ÉuÉçÉìÉY", "ãCçÇÇ´"
	} else {
		mtname(0, p) = "bronze", "noble"
	}
	mtref(0, p) = 200, 70, 2, 5, 1, 5, 100, 6
	mtenc(0, p) = 2 * 10000 + 52, 100
	p = 21
	if (jp) {
		mtname(0, p) = "É~ÉJ", "ôRÇ´"
	} else {
		mtname(0, p) = "mica", "ephemeral"
	}
	mtref(0, p) = 40, 150, 10, -2, 12, 0, 100, 0
	mtenc(0, p) = 1 * 10000 + 19, 100
	p = 33
	if (jp) {
		mtname(0, p) = "éXåË", "äCÇ©ÇÁÇ‡ÇΩÇÁÇ≥ÇÍÇµ"
	} else {
		mtname(0, p) = "coral", "ocean"
	}
	mtref(0, p) = 180, 240, 7, 2, 10, 7, 120, 5
	mtenc(0, p) = 56, 100
	p = 10
	if (jp) {
		mtname(0, p) = "ìS", "ìSâÚÇ∆åƒÇŒÇÍÇÈ"
	} else {
		mtname(0, p) = "metal", "mass"
	}
	mtref(0, p) = 280, 190, 8, 8, 3, 14, 130, 0
	mtenc(0, p) = 2 * 10000 + 50, 25
	mtbit(0, p) = 2
	p = 25
	if (jp) {
		mtname(0, p) = "ÉVÉãÉoÅ[", "à≈Çç”Ç≠"
	} else {
		mtname(0, p) = "silver", "dreadbane"
	}
	mtref(0, p) = 230, 250, 10, 7, 7, 11, 130, 0
	mtenc(0, p) = 2 * 10000 + 53, 50
	mtbit(0, p) = 2
	p = 5
	if (jp) {
		mtname(0, p) = "è…éq", "ìßÇ´í ÇÈ"
	} else {
		mtname(0, p) = "glass", "transparent"
	}
	mtref(0, p) = 180, 150, 19, 0, 17, 0, 100, 4
	mtenc(0, p) = 1 * 10000 + 18, 150
	mtbit(0, p) = 2
	p = 20
	if (jp) {
		mtname(0, p) = "ÉIÉuÉVÉfÉBÉAÉì", "ê_éEÇµÇÃ"
	} else {
		mtname(0, p) = "obsidian", "godbane"
	}
	mtref(0, p) = 160, 350, 16, 10, 13, 14, 130, 0
	mtenc(0, p) = 2 * 10000 + 59, 100
	p = 9
	if (jp) {
		mtname(0, p) = "ÉXÉeÉBÅ[Éã", "óRèèÇ†ÇÈ"
	} else {
		mtname(0, p) = "steel", "historic"
	}
	mtref(0, p) = 270, 280, 12, 13, 8, 18, 140, 0
	mtenc(0, p) = 0
	mtbit(0, p) = 2
	p = 26
	if (jp) {
		mtname(0, p) = "îíã‚", "åıÇìZÇ¢Çµ"
	} else {
		mtname(0, p) = "platinum", "brilliant"
	}
	mtref(0, p) = 260, 350, 16, 11, 14, 17, 140, 0
	mtenc(0, p) = 2 * 10000 + 53, 100
	mtbit(0, p) = 2
	p = 22
	if (jp) {
		mtname(0, p) = "ê^éÏ", "à≈Çè∆ÇÁÇ∑"
	} else {
		mtname(0, p) = "pearl", "shining"
	}
	mtref(0, p) = 240, 400, 18, 6, 18, 12, 140, 10
	mtenc(0, p) = 1 * 10000 + 13, 100
	p = 7
	if (jp) {
		mtname(0, p) = "É~ÉXÉäÉã", "å√Ç»ÇÈ"
	} else {
		mtname(0, p) = "mithril", "ancient"
	}
	mtref(0, p) = 240, 750, 20, 18, 17, 25, 190, 2
	mtenc(0, p) = 3 * 10000 + 172, 100, 2 * 10000 + 60, 50
	mtbit(0, p) = 1, 2
	p = 30
	if (jp) {
		mtname(0, p) = "ÉNÉçÉÄ", "ê^é¿Çñ\Ç≠"
	} else {
		mtname(0, p) = "chrome", "pure"
	}
	mtref(0, p) = 320, 500, 15, 17, 12, 22, 150, 0
	mtenc(0, p) = 0
	p = 11
	if (jp) {
		mtname(0, p) = "êÖèª", "àŸåıÇï˙Ç¬"
	} else {
		mtname(0, p) = "crystal", "rainbow"
	}
	mtref(0, p) = 200, 800, 19, 14, 16, 19, 150, 12
	mtenc(0, p) = 1 * 10000 + 16, 100
	p = 23
	if (jp) {
		mtname(0, p) = "ÉGÉÅÉâÉãÉh", "äÔê’ÇåƒÇ‘"
	} else {
		mtname(0, p) = "emerald", "miracle"
	}
	mtref(0, p) = 240, 1050, 22, 23, 18, 28, 190, 2
	mtenc(0, p) = 2 * 10000 + 58, 100
	p = 31
	if (jp) {
		mtname(0, p) = "ÉAÉ_É}ÉìÉ^ÉCÉg", "ëÂínÇóhÇÈÇ™Ç∑"
	} else {
		mtname(0, p) = "adamantium", "earth"
	}
	mtref(0, p) = 360, 1150, 11, 38, 8, 42, 240, 10
	mtenc(0, p) = 1 * 10000 + 11, 100
	mtbit(0, p) = 1, 2
	p = 29
	if (jp) {
		mtname(0, p) = "É`É^Éì", "êFÂÚÇπÇ "
	} else {
		mtname(0, p) = "titanium", "fadeless"
	}
	mtref(0, p) = 200, 750, 21, 18, 19, 22, 160, 0
	mtenc(0, p) = 1 * 10000 + 10, 100
	mtbit(0, p) = 2
	p = 13
	if (jp) {
		mtname(0, p) = "É_ÉCÉÑ", "Ç§Ç¬ÇÎÇ¢Ç»Ç´"
	} else {
		mtname(0, p) = "diamond", "ever lasting"
	}
	mtref(0, p) = 330, 1100, 19, 27, 13, 31, 220, 0
	mtenc(0, p) = 2 * 10000 + 52, 150
	p = 15
	if (jp) {
		mtname(0, p) = "ÉãÉrÉiÉX", "ê‘Ç≠êıÇ‹Ç¡ÇΩ"
	} else {
		mtname(0, p) = "rubynus", "crimson"
	}
	mtref(0, p) = 250, 1000, 38, 18, 31, 24, 190, 3
	mtenc(0, p) = 1 * 10000 + 2, 125
	mtbit(0, p) = 1, 2
	p = 8
	if (jp) {
		mtname(0, p) = "ÉGÅ[ÉeÉã", "âiâìÇ»ÇÈ"
	} else {
		mtname(0, p) = "ether", "eternal"
	}
	mtref(0, p) = 80, 1200, 8, 45, 35, 8, 250, 4
	mtenc(0, p) = 1 * 10000 + 18, 200
	mtbit(0, p) = 1, 2
	p = 3
	if (jp) {
		mtname(0, p) = "ïz", "âêÇ‚Ç©Ç»ÇÈ"
	} else {
		mtname(0, p) = "cloth", "charming"
	}
	mtref(0, p) = 20, 30, 6, -5, 7, 2, 100, 10
	mtenc(0, p) = 0
	p = 2
	if (jp) {
		mtname(0, p) = "ÉVÉãÉN", "î¸ÇµÇ´"
	} else {
		mtname(0, p) = "silk", "beautiful"
	}
	mtref(0, p) = 40, 190, 9, -2, 10, 2, 100, 5
	mtenc(0, p) = 2 * 10000 + 54, 50
	p = 16
	if (jp) {
		mtname(0, p) = "éÜ", "Ç”Ç¥ÇØÇΩ"
	} else {
		mtname(0, p) = "paper", "silly"
	}
	mtref(0, p) = 10, 20, 15, -10, 12, 0, 100, 0
	mtenc(0, p) = 3 * 10000 + 173, 100
	p = 18
	if (jp) {
		mtname(0, p) = "É{Å[Éì", "ïséÄÇ»ÇÈ"
	} else {
		mtname(0, p) = "bone", "immortal"
	}
	mtref(0, p) = 120, 300, 10, 6, 12, 11, 140, 0
	mtenc(0, p) = 2 * 10000 + 56, 100
	mtbit(0, p) = 2
	p = 1
	if (jp) {
		mtname(0, p) = "äv", "ëSÇƒÇïÔÇﬁ"
	} else {
		mtname(0, p) = "leather", "mysterious"
	}
	mtref(0, p) = 100, 150, 12, 2, 13, 6, 100, 6
	mtenc(0, p) = 0
	p = 4
	if (jp) {
		mtname(0, p) = "óÿ", "ãtóÿÇ…êGÇÍÇµ"
	} else {
		mtname(0, p) = "scale", "wrath"
	}
	mtref(0, p) = 180, 250, 14, 6, 12, 11, 120, 10
	mtenc(0, p) = 2 * 10000 + 50, 50
	p = 19
	if (jp) {
		mtname(0, p) = "ìSçΩ", "òAçΩÇπÇµ"
	} else {
		mtname(0, p) = "chain", "spiral"
	}
	mtref(0, p) = 200, 300, 11, 8, 17, 14, 100, 0
	mtenc(0, p) = 2 * 10000 + 53, 50
	mtbit(0, p) = 2
	p = 27
	if (jp) {
		mtname(0, p) = "ÉUÉCÉçÉì", "àŸçëÇ©ÇÁÇ‡ÇΩÇÁÇ≥ÇÍÇµ"
	} else {
		mtname(0, p) = "zylon", "foreign"
	}
	mtref(0, p) = 50, 500, 5, 4, 21, 16, 100, 4
	mtenc(0, p) = 2 * 10000 + 56, 50
	p = 32
	if (jp) {
		mtname(0, p) = "ÉSÅ[ÉãÉfÉì", "â©ã‡Ç…ãPÇ≠"
	} else {
		mtname(0, p) = "gold", "golden"
	}
	mtref(0, p) = 300, 800, 13, 18, 14, 22, 140, 5
	mtenc(0, p) = 1 * 10000 + 10, 100
	mtbit(0, p) = 2
	p = 14
	if (jp) {
		mtname(0, p) = "óÏïz", "Ç±ÇÃê¢Ç»ÇÁÇ¥ÇÈ"
	} else {
		mtname(0, p) = "spirit cloth", "amazing"
	}
	mtref(0, p) = 40, 750, 3, 2, 34, 6, 100, 4
	mtenc(0, p) = 1 * 10000 + 18, 200
	mtbit(0, p) = 1
	p = 24
	if (jp) {
		mtname(0, p) = "ó≥óÿ", "ó≥ÇìùÇ◊Çµ"
	} else {
		mtname(0, p) = "dragon scale", "dragonbane"
	}
	mtref(0, p) = 220, 800, 28, 27, 32, 27, 180, 2
	mtenc(0, p) = 2 * 10000 + 50, 100, 2 * 10000 + 51, 100
	mtbit(0, p) = 1, 2
	p = 17
	if (jp) {
		mtname(0, p) = "è™éN", "è™à≈ÇìZÇ¢Çµ"
	} else {
		mtname(0, p) = "dawn cloth", "dawn"
	}
	mtref(0, p) = 45, 850, 10, 8, 35, 15, 100, 4
	mtenc(0, p) = 1 * 10000 + 3, 200
	p = 28
	if (jp) {
		mtname(0, p) = "óÉíπóÿ", "óÉÇê‹ÇÁÇÍÇµ"
	} else {
		mtname(0, p) = "griffon scale", "fallen"
	}
	mtref(0, p) = 70, 1000, 16, 17, 32, 24, 120, 2
	mtenc(0, p) = 3 * 10000 + 173, 100
	dim mtlistmetal, 5, 6
	dim mtlistleather, 5, 6
	mtlistmetal(0, 0) = 34, 12, 21, 10, 0
	mtlistmetal(0, 1) = 5, 25, 9, 22, 11
	mtlistmetal(0, 2) = 26, 20, 30, 32, 0
	mtlistmetal(0, 3) = 29, 7, 0, 0, 0
	mtlistmetal(0, 4) = 23, 13, 0, 0, 0
	mtlistmetal(0, 5) = 15, 31, 0, 0, 0
	mtlistleather(0, 0) = 16, 3, 1, 0, 0
	mtlistleather(0, 1) = 4, 19, 0, 0, 0
	mtlistleather(0, 2) = 18, 2, 33, 0, 0
	mtlistleather(0, 3) = 27, 17, 0, 0, 0
	mtlistleather(0, 4) = 14, 28, 0, 0, 0
	mtlistleather(0, 5) = 24, 8, 0, 0, 0
	return



*label_0313
	gosub *label_0314
	gosub *label_0316
	return



*label_0314
	if (cm) {
		mtlv = cLevel(rc) / 12
	} else {
		mtlv = rndex(objlv + 1) / 8
	}
	if (iId(ci) == 630) {
		mtlv = rndex(mtlv + 1)
		if (rnd(3)) {
			iMaterial(ci) = 1000
		} else {
			iMaterial(ci) = 1001
		}
	}
	if (mode == 1) {
		mtlv = 0
	}
	if (mtlv >= 6) {
		if (cm) {
			objfix = rndex(mtlv - 6 + 1) + 1
		}
		mtlv = 6 - 1
	}
	mtlv = limit(rnd(rnd(mtlv + 1) + 1) + objfix, 0, 6 - 1)
	objfix = 0
	if (reftype == 60000) {
		if (rnd(2) == 0) {
			iMaterial(ci) = 1000
		} else {
			iMaterial(ci) = 1001
		}
	}
	f = -1
	if (iMaterial(ci) == 1000) {
		if (rnd(5) != 0) {
			f = 1
		} else {
			f = 0
		}
	}
	if (iMaterial(ci) == 1001) {
		if (rnd(5) == 0) {
			f = 1
		} else {
			f = 0
		}
	}
	if (f != (-1)) {
		mtlistmax = 0
		repeat 5
			if (f) {
				i = mtlistmetal(cnt, mtlv)
			} else {
				i = mtlistleather(cnt, mtlv)
			}
			if (i == 0) {
				break
			}
			mtlistmax++
		loop
		if (mtlistmax == 0) {
			if (jp) {
				buf += "\n\nîÒåˆéÆÉoÅ[ÉWÉáÉìÇ≈Ç∑ÅBÉoÉOïÒçêÇÕDiscordÇ‹Ç≈Ç®äËÇ¢ÇµÇ‹Ç∑ÅB"
			} else {
				buf += "\n\nIt is an unofficial version. Please report an issue to Discord."
			}
			return 0
		}
		p = rnd(mtlistmax)
		if (mode == 1) {
			p = 0
		}
		if (f) {
			iMaterial(ci) = mtlistmetal(p, mtlv)
		} else {
			iMaterial(ci) = mtlistleather(p, mtlv)
		}
	}
	if (rnd(25) == 0) {
		iMaterial(ci) = 35
	}
	return
*label_0315
	iColor(ci) = 0
	p = iMaterial(ci)
	reftype = refitem(iId(ci), 5, ci)
	fixlv = iQuality(ci)
	repeat 8
		if (mtenc(cnt * 2, p) == 0) {
			break
		}
		mtencremove ci, cnt, p
	loop
	if (reftype == 60000) {
		if (iSubname(ci) != 0) {
			originalvalue2 = iValue(ci) * 100 / (80 + iSubname(ci) * 20)
			originalvalue = originalvalue2 - mtref(1, p) * 2
		} else {
			originalvalue = iValue(ci) - mtref(1, p) * 2
		}
	} else {
		originalvalue = iValue(ci) * 100 / mtref(1, p)
	}
	dbid = iId(ci)
	dbmode = 10
	gosub *label_2426
	iValue(ci) = originalvalue
	if (fixmaterial != 0) {
		iMaterial(ci) = fixmaterial
	} else {
		gosub *label_0314
	}
	gosub *label_0316
	fixmaterial = 0
	gosub *label_0782
	r1 = cc
	gosub *chara_refresh
	return
*label_0316
	if (reftype == 60000) {
		if (fixmaterial == 0) {
			if (iMaterial(ci) == 3 | iMaterial(ci) == 16 | iMaterial(ci) == 21 | iMaterial(ci) == 2) {
				iMaterial(ci) = 43
			}
		}
	}
	p = iMaterial(ci)
	iWeight(ci) = iWeight(ci) * mtref(0, p) / 100
	if (reftype == 60000) {
		iValue(ci) += mtref(1, p) * 2
	} else {
		iValue(ci) = iValue(ci) * mtref(1, p) / 100
	}
	if (iColor(ci) == 0) {
		iColor(ci) = mtref(7, p)
	}
	p(1) = 120, 80
	if (fixlv == 1) {
		p(1) = 150, 80
	}
	if (fixlv == 3) {
		p(1) = 100, 70
	}
	if (fixlv >= 4) {
		p(1) = 80, 70
	}
	if (iDamageBonus(ci) != 0) {
		iDamageBonus(ci) = mtref(3, p) * iDamageBonus(ci) * 5 / (p(1) - rnd(30))
	}
	if (iDv(ci) != 0) {
		iDv(ci) = mtref(4, p) * iDv(ci) * 7 / (p(1) - rnd(30))
	}
	if (iPv(ci) != 0) {
		iPv(ci) = mtref(5, p) * iPv(ci) * 9 / (p(1) - rnd(30))
	}
	if (iDiceY(ci) != 0) {
		iDiceY(ci) = iDiceY(ci) * mtref(6, p) / (p(1) + rnd(25))
	}
	if (iHitBonus(ci) != 0) {
		if (iId(ci) != 788) {
			iHitBonus(ci) = mtref(2, p) * iHitBonus(ci) * 9 / (p(1) - rnd(30))
		} else {
			p(1) = 100, 70
			if (fixlv == 1) {
				p(1) = 80, 70
			}
			if (fixlv == 3) {
				p(1) = 120, 80
			}
			if (fixlv >= 4) {
				p(1) = 150, 80
			}
			iHitBonus(ci) = mtref(2, p) * iHitBonus(ci) * 9 / (p(1) - rnd(30))
		}
	}
	gosub *itemGem_setMaterialSpecificStats
	return



*itemGem_setMaterialSpecificStats
	p = iMaterial(ci)
	repeat 8
		if (mtenc(cnt * 2, p) == 0) {
			break
		}
		encadd ci, mtenc(cnt * 2, p), mtenc(cnt * 2 + 1, p), 0, 1
	loop
	repeat 10
		if (mtbit(cnt, p) == 0) {
			break
		}
		ibitmod mtbit(cnt, p), ci, 1
	loop
	return



*label_0318
	p = 0
	dim fishdata, 10, 100
	sdim fishdatan, 24, 100
	fishdatan(p) = lang("ÉoÉO", "bug")
	fishdata(0, p) = 0, 0, 0, 0, 100, 250, 100, 618
	p++
	fishdatan(p) = lang("ã‡ãõ", "goldfish")
	fishdata(0, p) = 1, 0, 1000, 2, 100, 100, 180, 618
	p++
	fishdatan(p) = lang("ãT", "turtle")
	fishdata(0, p) = 1, 0, 250, 4, 100, 250, 450, 618
	p++
	fishdatan(p) = lang("É[ÉjÉ^ÉiÉS", "bitterling")
	fishdata(0, p) = 1, 0, 50, 5, 100, 1500, 2200, 618
	p++
	fishdatan(p) = lang("Ç®ÇΩÇ‹Ç∂Ç·Ç≠Çµ", "tadpole")
	fishdata(0, p) = 1, 0, 1000, 0, 100, 150, 80, 618
	p++
	fishdatan(p) = lang("äCêÖÉpÉìÉc", "swimming trunks")
	fishdata(0, p) = 1, 0, 400, 0, 100, 250, 40, 619
	p++
	fishdatan(p) = lang("è¨âòÇ¢í∑åC", "dirty long boots")
	fishdata(0, p) = 1, 0, 100, 0, 100, 250, 25, 619
	p++
	fishdatan(p) = lang("ÉRÉC", "carp")
	fishdata(0, p) = 1, 1, 1000, 4, 100, 250, 400, 618
	p++
	fishdatan(p) = lang("ÉEÉiÉM", "eel")
	fishdata(0, p) = 1, 1, 800, 6, 100, 300, 750, 618
	p++
	fishdatan(p) = lang("ÉnÉ[", "goby")
	fishdata(0, p) = 1, 1, 250, 8, 100, 400, 1250, 618
	p++
	fishdatan(p) = lang("ÉLÉìÉÅÉ_ÉC", "sea bream")
	fishdata(0, p) = 1, 1, 50, 12, 100, 350, 3500, 618
	p++
	fishdatan(p) = lang("ãÛÇ´ä ", "empty can")
	fishdata(0, p) = 1, 1, 400, 0, 100, 250, 40, 619
	p++
	fishdatan(p) = lang("âÛÇÍÇΩã@äB", "broken machine")
	fishdata(0, p) = 1, 1, 400, 0, 100, 250, 25, 619
	p++
	fishdatan(p) = lang("ÉJÉWÉJ", "sculpin")
	fishdata(0, p) = 1, 2, 1000, 8, 100, 250, 800, 618
	p++
	fishdatan(p) = lang("ÉXÉYÉL", "sea bass")
	fishdata(0, p) = 1, 2, 800, 10, 100, 300, 1200, 618
	p++
	fishdatan(p) = lang("ÉEÉj", "sea urchin")
	fishdata(0, p) = 1, 2, 250, 12, 100, 400, 1800, 618
	p++
	fishdatan(p) = lang("ÉVÉçÉAÉ}É_ÉC", "red sea bream")
	fishdata(0, p) = 1, 2, 50, 16, 100, 350, 4500, 618
	p++
	fishdatan(p) = lang("ãÛÇ´ÉrÉì", "empty bottle")
	fishdata(0, p) = 1, 2, 400, 0, 100, 250, 40, 619
	p++
	fishdatan(p) = lang("âòÇ¢éwó÷", "dirty ring")
	fishdata(0, p) = 1, 2, 400, 0, 100, 250, 325, 619
	p++
	fishdatan(p) = lang("ÉLÉåÉAÉW", "sword fish")
	fishdata(0, p) = 1, 3, 1000, 15, 100, 250, 1500, 618
	p++
	fishdatan(p) = lang("ÉAÉçÉèÉi", "moonfish")
	fishdata(0, p) = 1, 3, 800, 18, 100, 300, 1900, 618
	p++
	fishdatan(p) = lang("ÉnÉäÉ}ÉOÉç", "tuna fish")
	fishdata(0, p) = 1, 3, 250, 22, 100, 400, 2400, 618
	p++
	fishdatan(p) = lang("å√ë„ãõ", "ancient fish")
	fishdata(0, p) = 1, 3, 50, 28, 100, 350, 7200, 618
	p++
	fishdatan(p) = lang("îjÇÍÇΩéP", "broken umbrella")
	fishdata(0, p) = 1, 3, 1000, 0, 100, 250, 40, 619
	p++
	fishdatan(p) = lang("Ç©Ç¬ÇÁ", "hairpiece")
	fishdata(0, p) = 1, 3, 1000, 0, 100, 250, 425, 619
	p++
	fishdatan(p) = lang("ÉJÉcÉI", "bonito")
	fishdata(0, p) = 1, 4, 1000, 19, 100, 250, 2200, 618
	p++
	fishdatan(p) = lang("ÉAÉÜ", "sweetfish")
	fishdata(0, p) = 1, 4, 800, 22, 100, 300, 2600, 618
	p++
	fishdatan(p) = lang("ÉVÉ}ÉAÉW", "yellow jack")
	fishdata(0, p) = 1, 4, 250, 25, 100, 400, 4500, 618
	p++
	fishdatan(p) = lang("ÉuÉâÉbÉNÉoÉX", "black bass")
	fishdata(0, p) = 1, 4, 50, 30, 100, 350, 11200, 618
	p++
	fishdatan(p) = lang("ñkÇ©ÇÁÇÃïYíÖï®", "ashore from the north")
	fishdata(0, p) = 1, 4, 400, 0, 100, 250, 240, 619
	p++
	fishdatan(p) = lang("ÉGÉçñ{", "pornographic book")
	fishdata(0, p) = 1, 4, 400, 0, 100, 250, 525, 619
	p++
	fishdatan(p) = lang("ÉTÉo", "mackerel")
	fishdata(0, p) = 1, 5, 1000, 25, 100, 250, 3500, 618
	p++
	fishdatan(p) = lang("ëÂêHÇ¢É}ÉOÉç", "big tuna fish")
	fishdata(0, p) = 1, 5, 800, 29, 100, 300, 4400, 618
	p++
	fishdatan(p) = lang("ÉRÉoÉìÉUÉÅ", "remora")
	fishdata(0, p) = 1, 5, 250, 33, 100, 400, 9550, 618
	p++
	fishdatan(p) = lang("ÉNÉWÉâ", "whale")
	fishdata(0, p) = 1, 5, 50, 40, 100, 350, 25000, 618
	p++
	fishdatan(p) = lang("ãÛÇ´î†", "empty box")
	fishdata(0, p) = 1, 5, 400, 0, 100, 250, 40, 619
	p++
	fishdatan(p) = lang("âÛÇÍÇΩågë—", "broken cell phone")
	fishdata(0, p) = 1, 5, 400, 0, 100, 250, 25, 619
	p++
	fishdatan(p) = lang("ì¥åAÇÃÉkÉV", "cave nushi")
	fishdata(0, p) = 1, 10, 0, 0, 100, 400, 400, 618
	p++
	fishdatan(p) = lang("ïséÄãõ", "undead fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 400, 550, 618
	p++
	fishdatan(p) = lang("é‹îMãõ", "scorching fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 400, 550, 618
	p++
	fishdatan(p) = lang("ê[ï£ãõ", "void fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 400, 700, 618
	p++
	fishdatan(p) = lang("éGãõÇÃâ§", "common king fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 300, 250, 618
	p++
	fishdatan(p) = lang("âiâìãõ", "ether fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 550, 1000, 618
	p++
	fishdatan(p) = lang("èIññãõ", "end fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 550, 1000, 618
	p++
	fishdatan(p) = lang("ÉÅÉJÉWÉL", "sail fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 650, 2000, 618
	p++
	fishdatan(p) = lang("ê·ãõ", "snow fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 550, 550, 618
	p++
	fishdatan(p) = lang("ëDãõ", "ship fish")
	fishdata(0, p) = 1, 10, 0, 0, 100, 400, 400, 618
	p++
	return



#deffunc itemcreate int __fff, int __ggg, int __hhh, int __iii, int __jjj
	itemcreatehack = -1
	if (flttypeminor != 0) {
		flttypemajor = 0
	}
	if (__ggg == 0) {
		dbid = -1
	} else {
		dbid = __ggg
	}
	if (__jjj != 0) {
		initnum = __jjj
	} else {
		initnum = 0
	}
	val = __fff, __hhh, __iii
	gosub *itemGen_doCreateItem
	if (stat) {
		if (ci == 5480) {
			iNumber(ci) = 0
			itemmemory(1, dbid)--
		} else {
			if (ogdata(518) == 2) {
				iIdentificationState(ci) = 3
			}
		}
	}
	itemcreatehack = 0
	encpfix = 0
	encbmboost = 0
	if (mode != 6) {
		if (ci >= 0) {
			if (iId(ci) == 54 | iId(ci) == 55 | iId(ci) == 724 | iId(ci) == 730) {
				itemmemory(0, iId(ci)) = 1
			}
			if (cfg_NC_directmoney == 1) {
				if (ci != 5480) {
					if (iId(ci) == 55 | iId(ci) == 54) {
						if (inv_getowner(ci) == (-1)) {
							if (iX(ci) == cX(0) & iY(ci) == cY(0)) {
								if (iId(ci) == 55 & godcheck() == "krula") {
									return stat
								}
								snd 11
								ti = ci
								in = iNumber(ci)
								iNumber(ci) = 0
								msgkeep = 1
								txt -1, lang(itemname(ti, in) + "ÇéËÇ…ì¸ÇÍÇΩÅB", "Get " + itemname(ti, in) + ".")
								cell_refresh iX(ci), iY(ci)
								map(iX(ci), iY(ci), 5) = map(iX(ci), iY(ci), 4)
								if (iId(ci) == 54) {
									se_moneymod 0, in
								} else {
									addplat 0, in
								}
								return 0
							}
						}
					}
				}
			}
		}
	}
	return stat



#deffunc inv_getheader int __kkk
	if (__kkk == 0) {
		invhead = 0
		invrange = 200
		if (nc_intb_nightmare) {
			invrange = 50
		}
		return
	}
	if (__kkk == (-1)) {
		invhead = 5080
		invrange = 5480 - 5080
		return
	}
	invhead = 200 + 20 * (__kkk - 1)
	invrange = 20
	return



#defcfunc inv_getowner int __lll
	if (__lll < 200) {
		return 0
	}
	if (__lll >= 5080) {
		return -1
	}
	return (__lll - 200) / 20 + 1



#deffunc inv_find int __mmm, int __nnn
	f@m52 = -1
	inv_getheader __nnn
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) == __mmm) {
			f@m52 = cnt
			break
		}
	loop
	return f@m52

#deffunc inv_find_ex int __mmm, int __nnn, int __ooo
	f@m52 = -1
	inv_getheader __nnn
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) == __mmm) {
			if (refitem(iId(cnt), 5, cnt) == 57000) {
				if (stgdata(56 + sc) != iParam2(cnt)) {
					continue
				}
			}
			if ((iCurseState(cnt) == __ooo & iIdentificationState(cnt) == 3) | (stgdata(36 + sc) == (-3) & iIdentificationState(cnt) < 3) | cfg_ST_shortcut == 0) {
				f@m52 = cnt
				break
			}
		}
	loop
	return f@m52

#deffunc item_find int __ooo, int __ppp, int __qqq
	p@m52 = -1, -1
	repeat 2
		if (cnt == 0) {
			if (__qqq < 0) {
				continue
			}
			inv_getheader 0
		} else {
			if (__qqq > 0) {
				continue
			}
			inv_getheader -1
		}
		p@m52(2) = cnt
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (p@m52(2) == 1) {
				if (iX(cnt) != cX(0) | iY(cnt) != cY(0)) {
					continue
				}
			}
			if (__ppp == 0) {
				if (refitem(iId(cnt), 5, cnt) == __ooo) {
					p@m52 = cnt
				}
			}
			if (__ppp == 1) {
				if (iSkill(cnt) == __ooo) {
					if (p@m52(1) < iParam1(cnt)) {
						p@m52 = cnt, iParam1(cnt)
					}
				}
			}
			if (__ppp == 2) {
				if (refitem(iId(cnt), 9, cnt) == __ooo) {
					p@m52 = cnt
				}
			}
			if (__ppp == 3) {
				if (iId(cnt) == __ooo) {
					p@m52 = cnt
				}
			}
			if (__ppp == 4) {
				if (iFunction(cnt) == __ooo) {
					p@m52 = cnt
				}
			}
		loop
	loop
	return p@m52



#defcfunc encfind int __rrr, int __sss
	f@m53 = sppfind(__rrr, __sss)
	repeat 30, 100
		if (cdata(cnt, __rrr) \ 10000 == 0) {
			continue
		}
		i@m53 = cdata(cnt, __rrr) \ 10000 - 1
		repeat 15
			if (iEnchantmentId(i@m53, cnt) == 0) {
				break
			}
			if (iEnchantmentId(i@m53, cnt) == __sss) {
				if (iEnchantmentPower(i@m53, cnt) > f@m53) {
					f@m53 = iEnchantmentPower(i@m53, cnt)
					break
				}
			}
		loop
	loop
	return f@m53



#defcfunc encfindspec int __ci, int __encId
	f@m53 = -1
	repeat 15
		if (iEnchantmentId(__ci, cnt) == 0) {
			break
		}
		if (iEnchantmentId(__ci, cnt) == __encId) {
			f@m53 = 1
			break
		}
	loop
	return f@m53



#deffunc itemlist int __vvv, int __www
	inv_getheader __vvv
	listmax = 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) == __www) {
			list(0, listmax) = cnt
			listmax++
		}
	loop
	return



#defcfunc itemusingfind int __xxx, int __yyy
	f@m54 = -1
	repeat 245
		dup roopbuf, cContinuousActionId(cnt)
		if (cState(cnt) != 1) {
			continue
		}
		if (roopbuf != 0 & roopbuf != 11 & roopbuf != 10006) {
			if (cContinuousActionTurn(cnt) > 0) {
				if (cContinuousActionItem(cnt) == __xxx) {
					if (__yyy == 0 | (__yyy == 1 & cnt != 0)) {
						f@m54 = cnt
						break
					}
				}
			}
		}
	loop
	return f@m54



#defcfunc itemfind int __zzz, int __aaa, int __bbb
	inv_getheader __zzz
	f@m54 = -1
	if (__bbb == 0) {
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iId(cnt) == __aaa) {
				f@m54 = cnt
				break
			}
		loop
		return f@m54
	}
	if (__bbb == 1) {
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (refitem(iId(cnt), 9, cnt) == __aaa) {
				f@m54 = cnt
				break
			}
		loop
		return f@m54
	}

// NC
// 0Ç»ÇÁÉhÉâÉSÉìÇÃîÁÇíTÇ∑ÅA1Ç»ÇÁïÅí ÇÃîÁÇ‡égópÇ∑ÇÈ
#defcfunc itemfind_dragonskin int __zzz
	inv_getheader __zzz
	f@m54 = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) == iId_skin) {
			s = refchara(iSubname(cnt), 8, 1)
			if (instr(s, 0, "/dragon/") != (-1)) {
				f@m54 = cnt
				break
			}
		}
	loop
return f@m54


#defcfunc mapitemfind int __ccc, int __ddd, int __eee
	inv_getheader -1
	f@m54 = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) == __eee) {
			if (iX(cnt) == __ccc) {
				if (iY(cnt) == __ddd) {
					f@m54 = cnt
					break
				}
			}
		}
	loop
	return f@m54



// Search item in the inventory for which the specific bit is ON.
// @param __cId : charactor id
// @param __bit : bit number
// @param __onlyEquipped : returns an equipped item if true.
// @return : item number
#defcfunc bititemfind int __cId, int __bit, int __onlyEquipped
	inv_getheader __cId
	itemno@st = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (__onlyEquipped & iBodyPart(cnt) == 0) {
			continue
		}
		if (ibit(__bit, cnt)) {
			itemno@st = cnt
			break
		}
	loop
	return itemno@st



// Search custom item from the inventory.
// @param __cId : charactor id
// @param __citemname : custom item name
// @return item number
#defcfunc customitemfind int __cId, str __citemname
	inv_getheader __cId
	citemno@st = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (equalsitem(cnt, __citemname)) {
			citemno@st = cnt
			break
		}
	loop
	return citemno@st



#deffunc cell_refresh int __fff, int __ggg
	if (mode == 6 | mode == 9) {
		return
	}
	if (__fff < 0 | __ggg < 0 | __fff >= mapWidth | __ggg >= mapHeight) {
		return
	}
	p@m55 = 0
	map(__fff, __ggg, 4) = 0
	map(__fff, __ggg, 9) = 0
	mapinv(__fff, __ggg) = 0
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) > 0) {
			if (iX(cnt) == __fff & iY(cnt) == __ggg) {
				floorstack(p@m55) = cnt
				p@m55++
				wpoke map(__fff, __ggg, 4), 0, iImage(cnt)
				wpoke map(__fff, __ggg, 4), 2, iColor(cnt)
				mapinv(__fff, __ggg) = cnt + 1
				if (iId(cnt) == 743) {
					if (useritemdata(13, inv(31, cnt)) != 0) {
						map(__fff, __ggg, 9) = useritemdata(13, inv(31, cnt))
					}
				} else {
					if (ilight(iId(cnt)) != 0) {
						map(__fff, __ggg, 9) = ilight(iId(cnt))
					}
				}
			}
		}
	loop
	if (p@m55 > 3) {
		if (cfg_stacksymbol == 1 & areaId(gCurrentMap) == 104) {
			p@m55 = 3
		} else {
			wpoke map(__fff, __ggg, 4), 0, 363
			wpoke map(__fff, __ggg, 4), 2, 0
			mapinv(__fff, __ggg) = -1
			return
		}
	}
	if (p@m55 > 1) {
		n@m55(2) = 0
		repeat p@m55
			cnt2@m55 = cnt
			i@m55 = -1
			repeat p@m55
				if (cnt2@m55 == 1) {
					if (cnt == n@m55(0)) {
						continue
					}
				}
				if (cnt2@m55 == 2) {
					if (cnt == n@m55(0) | cnt == n@m55(1)) {
						continue
					}
				}
				if (iTurn(floorstack(cnt)) > i@m55) {
					n@m55(cnt2@m55) = cnt
					i@m55 = iTurn(floorstack(cnt))
				}
			loop
		loop
		map(__fff, __ggg, 4) = floorstack(n@m55(0)) - 5080
		map(__fff, __ggg, 4) += (floorstack(n@m55(1)) - 5080) * 1000
		if (p@m55 > 2) {
			map(__fff, __ggg, 4) += (floorstack(n@m55(2)) - 5080) * 1000000
		} else {
			map(__fff, __ggg, 4) += 999 * 1000000
		}
		map(__fff, __ggg, 4) *= -1
		mapinv(__fff, __ggg) = -1
	}
	return



#deffunc itemturn int __hhh
	if (gItemTurns < 0) {
		gItemTurns = 0
	}
	gItemTurns++
	iTurn(__hhh) = gItemTurns
	return



#deffunc removeitem int __iii, int __jjj
	n@m56 = __jjj
	if (n@m56 == 0) {
		n@m56 = 1
	}
	iNumber(__iii) -= n@m56
	if (__iii < 200) {
		gosub *refreshPCBurdenState
	}
	if (iNumber(__iii) <= 0) {
		iNumber(__iii) = 0
		if (mode != 6) {
			if (__iii >= 5080) {
				cell_refresh iX(__iii), iY(__iii)
			}
		}
	}
	return



#deffunc item_copy int __kkk, int __lll
	if (__kkk < 0 | __lll < 0) {
		return
	}
	memcpy inv(0, __lll), inv(0, __kkk), 70 * 4
	return



#deffunc item_exchange int __mmm, int __nnn
	repeat 70
		p@m57 = inv(cnt, __nnn)
		inv(cnt, __nnn) = inv(cnt, __mmm)
		inv(cnt, __mmm) = p@m57
	loop
	return



#deffunc item_delete int __ooo
	memset iNumber(__ooo), 0, 70 * 4
	return



#defcfunc inv_getspace int __ppp
	inv_getheader __ppp
	p@m57 = 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			p@m57++
			break
		}
	loop
	return p@m57



#defcfunc inv_sum int __qqq
	inv_getheader __qqq
	p@m57 = 0
	repeat invrange, invhead
		if (iNumber(cnt) != 0) {
			p@m57++
		}
	loop
	return p@m57



#deffunc item_compress int __rrr
	p@m57 = 0
	repeat 100
		p@m57(1) = 200 * (cnt * cnt + 1)
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (ibit(5, cnt)) {
				continue
			}
			if (iValue(cnt) >= p@m57(1)) {
				continue
			}
			if (iId(cnt) == 493) {
				continue
			}
			if (mode != 6) {
				trash_push cnt
			}
			iNumber(cnt) = 0
			p@m57++
			if (iX(cnt) >= 0 & iX(cnt) < mapWidth & iY(cnt) >= 0 & iY(cnt) < mapHeight) {
				cell_refresh iX(cnt), iY(cnt)
			}
			if (p@m57 > __rrr) {
				break
			}
		loop
		if (p@m57 > __rrr) {
			break
		}
	loop
	p@m57 = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			p@m57 = cnt
			break
		}
	loop
	if (p@m57 == (-1)) {
		p@m57 = invhead + rnd(invrange)
		if (iNumber(p@m57) != 0) {
			if (mode != 6) {
				trash_push p@m57
			}
			iNumber(p@m57) = 0
			if (mode != 6) {
				if (iX(p@m57) >= 0 & iX(p@m57) < mapWidth & iY(p@m57) >= 0 & iY(p@m57) < mapHeight) {
					cell_refresh iX(p@m57), iY(p@m57)
				}
			}
		}
	}
	return



#defcfunc inv_getfreeid int __sss
	inv_getheader __sss
	p@m57 = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			p@m57 = cnt
			break
		}
	loop
	if (p@m57 == (-1)) {
		if (__sss == (-1)) {
			if (mode != 6) {
				f@m57 = 0
				repeat 246, -1
					if (cnt != (-1)) {
						if (cState(cnt) != 1) {
							continue
						}
					}
					inv_getheader cnt
					repeat invrange, invhead
						if (iNumber(cnt) > 0) {
							if (iId(cnt) == 493) {
								f@m57 = 1
								break
							}
						}
					loop
					if (f@m57) {
						break
					}
				loop
				inv_getheader __sss
				if (f@m57) {
					txt -1, lang("ÉAÉCÉeÉÄèÓïÒÇ™ëΩÇ∑Ç¨ÇÈÅIäÙÇ¬Ç©ÇÃÉAÉCÉeÉÄÇ™ÉSÉ~î†Ç…ï˙ÇËçûÇ‹ÇÍÇΩÅB", "Too many item data! Some items in this area are thrown for trash.")
					item_compress 25
					trash_throw
				} else {
					txt -1, lang("ÉAÉCÉeÉÄèÓïÒÇ™ëΩÇ∑Ç¨ÇÈÅIäÙÇ¬Ç©ÇÃÉAÉCÉeÉÄÇÕîjâÛÇ≥ÇÍÇΩÅB", "Too many item data! Some items in this area are destroyed.")
					item_compress 10
					trash_reset
				}
			}
		}
	}
	return p@m57



#defcfunc inv_weight int __cc
	p@tmp = 0.0
	inv_getheader __cc
	if (__cc == 0) {
		gCargoWeight = 0
		ogdata(101) = 0
	}
	repeat invrange, invhead
		if (iNumber(cnt) != 0) {
			if (iWeight(cnt) >= 0) {
				p@tmp += double(iWeight(cnt)) * iNumber(cnt)
			} else {
				if (__cc == 0) {
					gCargoWeight += limit(iWeight(cnt) * iNumber(cnt) * (-1), 0, 10000000)
					ogdata(101) += limit(iValue(cnt) * iNumber(cnt), 0, 10000000)
				}
			}
		}
	loop
	return p@tmp



#deffunc item_num int __uuu, int __vvv
	iNumber(__uuu) += __vvv
	if (iNumber(__uuu) < 0) {
		iNumber(__uuu) = 0
	}
	if (__uuu >= 5080) {
		cell_refresh iX(__uuu), iY(__uuu)
	} else {
		gosub *refreshPCBurdenState
	}
	return



#deffunc item_separate var __www
	if (iNumber(__www) <= 1) {
		return __www
	}
	ti@m59 = inv_getfreeid(inv_getowner(__www))
	if (ti@m59 == (-1)) {
		ti@m59 = inv_getfreeid(-1)
		if (ti@m59 == (-1)) {
			iNumber(__www) = 1
			txt -1, lang("âΩÇ©Ç™ínñ Ç…óéÇøÇƒè¡Ç¶ÇΩÅc", "Something falls to the ground and disappear...")
			return __www
		}
	}
	item_copy __www, ti@m59
	iNumber(ti@m59) = iNumber(__www) - 1
	iNumber(__www) = 1
	if (inv_getowner(ti@m59) == (-1)) {
		if (mode != 6) {
			if (inv_getowner(__www) != (-1)) {
				iX(__www) = cX(inv_getowner(__www))
				iY(__www) = cY(inv_getowner(__www))
			}
			iX(ti@m59) = iX(__www)
			iY(ti@m59) = iY(__www)
			itemturn ti@m59
			cell_refresh iX(ti@m59), iY(ti@m59)
			if (inv_getowner(__www) != -1) {
				txt -1, lang("âΩÇ©Ç™ínñ Ç…óéÇøÇΩÅB", "Something falls to the ground from your backpack.")
			}
			gosub *refreshPCBurdenState
		}
	}
	return ti@m59



#deffunc chara_unequip int __xxx
	if (iBodyPart(__xxx) == 0) {
		return 0
	}
	p@m59 = iBodyPart(__xxx)
	c@m59 = inv_getowner(__xxx)
	if (c@m59 == (-1)) {
		return 0
	}
	cdata(p@m59, c@m59) = cdata(p@m59, c@m59) / 10000 * 10000
	iBodyPart(__xxx) = 0
	return 1



#deffunc item_identify int __yyy, int __zzz, int __aaa
	idlv@m60 = __zzz
	if (__aaa) {
		if (__aaa >= iDifficultyToIdentify(__yyy)) {
			idlv@m60 = 3
		}
	}
	if (idlv@m60 >= 2) {
		if (refitem(iId(__yyy), 5, __yyy) >= 50000) {
			idlv@m60 = 3
		}
	}
	if (idlv@m60 == (-1) | iIdentificationState(__yyy) >= idlv@m60) {
		idtresult = 0
		return 0
	}
	iIdentificationState(__yyy) = idlv@m60
	if (iIdentificationState(__yyy) >= 1) {
		itemmemory(0, iId(__yyy)) = 1
	}
	idtresult = idlv@m60
	return idtresult



#deffunc item_checkknown int __bbb
	if (iIdentificationState(__bbb) >= 3) {
		iIdentificationState(__bbb) = 3
	}
	if (oabit(1, gCurrentMap)) {
		return
	}
	if (iId(__bbb) != 743) {
		if (itemmemory(0, iId(__bbb))) {
			if (iIdentificationState(__bbb) == 0) {
				item_identify __bbb, 1
			}
		}
	}
	return



#defcfunc rpname int __ccc
	s@m62 = "?????"
	if (rpdatan(__ccc) != "") {
		return rpdatan(__ccc)
	}
	if (__ccc >= 400) {
		return ioriginalnameref(__ccc - 400)
	}
	return s@m62



#defcfunc itemname int __eee, int __fff, int __ggg, int __hhh
	itemnamehack = iId(__eee) + 1
	if (iId(__eee) >= maxitemid - 2 | iId(__eee) > length(ioriginalnameref)) {
		itemnamehack = 0
		return lang("ñ¢ímÇÃÉAÉCÉeÉÄ(ÉoÅ[ÉWÉáÉìîÒå›ä∑)", "unknown item (incompatible version)")
	}
	if (iQuality(__eee) >= 5) {
		iqiality@m63(__eee) = 5
	}
	item_checkknown __eee
	if (__fff == 0) {
		num2@m63 = iNumber(__eee)
	} else {
		num2@m63 = __fff
	}
	a@m63 = refitem(iId(__eee), 5, __eee)
	if (jp) {
		if (num2@m63 > 1) {
			s2@m63 = "å¬ÇÃ"
			if (a@m63 == 16000) {
				s2@m63 = "íÖÇÃ"
			}
			if (a@m63 == 54000 | a@m63 == 55000) {
				if (iId(__eee) == 783) {
					s2@m63 = "ñáÇÃ"
				} else {
					s2@m63 = "ç˚ÇÃ"
				}
			}
			if (a@m63 == 10000) {
				s2@m63 = "ñ{ÇÃ"
			}
			if (a@m63 == 52000 & item_isCookedMilk(__eee) == 0 & item_isCookedHarb(__eee) == 0) {
				s2@m63 = "ïûÇÃ"
			}
			if (a@m63 == 53000) {
				s2@m63 = "ä™ÇÃ"
			}
			if (a@m63 == 22000 | a@m63 == 18000) {
				s2@m63 = "ëŒÇÃ"
			}
			if (a@m63 == 68000 | a@m63 == 69000 | iId(__eee) == 622 | iId(__eee) == 724 | iId(__eee) == 730) {
				s2@m63 = "ñáÇÃ"
			}
			if (iId(__eee) == 618) {
				s2@m63 = "ïCÇÃ"
			}
			if (a@m63 == 68000 | a@m63 == 69000) {
				s@m63 = thousandsep(str(num2@m63)) + s2@m63
			} else {
				s@m63 = oomsest_insertSeparater(str(num2@m63)) + s2@m63
			}
		} else {
			s@m63 = ""
		}
		if (iIdentificationState(__eee) >= 3) {
			if (iCurseState(__eee) == 1) {
				if ((a@m63 == 57000 | iId(__eee) == 431 | iId(__eee) == iId_milk) & __hhh == 0) {
					if (ibit(8, __eee)) {
						godindext = getgodindex(iParam4(__eee))
						if (godindext != (-1)) {
							s2@m63 = cnven(cgodshortname(godindext))
						} else {
							s2@m63 = godshortname(godno2godid(iParam4(__eee)))
						}
						s@m63 += s2@m63 + "Ç…"
					}
				}
				s@m63 += strblessed
			}
			if (iCurseState(__eee) == (-1)) {
				s@m63 += strcursed
			}
			if (iCurseState(__eee) == (-2)) {
				s@m63 += strdoomed
			}
		}
	} else {
		s@m63 = ""
		if (iIdentificationState(__eee) >= 3) {
			if (iCurseState(__eee) == 1) {
				s@m63 = ""
				if (a@m63 == 57000 | iId(__eee) == 431 | iId(__eee) == iId_milk) {
					if (ibit(8, __eee)) {
						godindext = getgodindex(iParam4(__eee))
						if (godindext != (-1)) {
							s2@m63 = cnven(cgodshortname(godindext))
						} else {
							s2@m63 = godshortname(godno2godid(iParam4(__eee)))
						}
						s@m63 = s2@m63 + "-"
					}
				}
				s@m63 += strblessed + " "
			}
			if (iCurseState(__eee) == (-1)) {
				s@m63 = strcursed + " "
			}
			if (iCurseState(__eee) == (-2)) {
				s@m63 = strdoomed + " "
			}
		}
		if (irandomname(iId(__eee)) == 1 & iIdentificationState(__eee) < 1) {
			s2@m63 = ""
		} else {
			s2@m63 = "" + ioriginalname2cnv(__eee)
			if (instr(ioriginalnameref(iId(__eee)), 0, "with") != (-1)) {
				s3@m63 = "with"
			} else {
				s3@m63 = "of"
			}
			if (iIdentificationState(__eee) != 0) {
				if (s2@m63 == "") {
					if (iWeight(__eee) < 0) {
						s2@m63 = "cargo"
					}
					if (a@m63 == 22000 | a@m63 == 18000) {
						s2@m63 = "pair"
					}
				}
			}
			if (a@m63 == 57000 | iId(__eee) == iId_milk) {
				if (iParam1(__eee) != 0) {
					if (iParam2(__eee) != 0) {
						s2@m63 = "dish"
					}
				}
			}
		}
		if (s2@m63 != "" & iId(__eee) != 618) {
			if (num2@m63 > 1) {
				s@m63 = "" + num2@m63 + " " + s@m63 + s2@m63 + "s " + s3@m63 + " "
			} else {
				s@m63 = s@m63 + s2@m63 + " " + s3@m63 + " "
			}
		} else {
			if (num2@m63 > 1) {
				s@m63 = "" + num2@m63 + " " + s@m63
			}
		}
	}
	if (a@m63 < 50000 & iParam3(__eee) > 0 & iId(__eee) != 743 & __hhh == 0) {
		s@m63 += cnamelist(iParam3(__eee) - 1)
		return s@m63
	}
	if (iMaterial(__eee) == 35 & a@m63 == 57000) {
		if (iParam3(__eee) < 0 | (mode == 6 & invctrl(1) == 14 & iParam3(__eee) <= getgametime())) {
			if (jp) {
				s@m63 += "ïÖÇ¡ÇΩ"
			} else {
				s@m63 += "rotten "
			}
		}
	}
	if (en) {
		if (a@m63 == 57000 | iId(__eee) == iId_milk) {
			if (iParam1(__eee) != 0) {
				if (iParam2(__eee) != 0) {
					skip@m63 = 1
				}
			}
		}
		if (iSubname(__eee) != 0) {
			if (a@m63 == 60000 | a@m63 == 77000) {
				if (iSubname(__eee) >= 12) {
					iSubname(__eee) = 0
				} else {
					s@m63 += _furniture(iSubname(__eee)) + " "
				}
			}
		}
		if (iId(__eee) == 687) {
			if (iParam2(__eee) != 0) {
				s@m63 += "undecoded "
			}
		}
		if (iId(__eee) == 783) {
			if (iSubname(__eee) == 0) {
				s@m63 += "custom "
			}
		}
	}
	if (iId(__eee) == 743) {
		if (useritemdata(65, inv(31, __eee))) {
			if (iIdentificationState(__eee) < 3) {
				if (iQuality(__eee) < 4 | a@m63 >= 50000) {
					s@m63 += ioriginalnamecnv(__eee)
				} else {
					s@m63 += iknownnamecnv(__eee)
				}
			} else {
				s@m63 += ioriginalnamecnv(__eee)
			}
			goto *label_0363
		}
	}
	if (iId(__eee) == 630) {
		s@m63 += "" + mtname(0, iMaterial(__eee)) + lang("êªÇÃ", " ")
	}
	if (jp) {
		gosub *label_0361
	}
	if (a@m63 == 60000) {
		if (iMaterial(__eee) != 0 & ibit(21, __eee) == 0) {
			if (jp) {
				s@m63 += "" + mtname(0, iMaterial(__eee)) + "ç◊çHÇÃ"
			} else {
				s@m63 += "" + mtname(0, iMaterial(__eee)) + "work "
			}
		} else {
			if (iMaterial(__eee) != 0 & ibit(21, __eee) != 0) {
				if (iParam2(__eee) == 343) {
					if (inv(33, __eee) != usernpcmax) {
						s@m63 += lang("" + userdatan(1, inv(33, __eee)), "" + userdatan(1, inv(33, __eee)))
					} else {
						s@m63 += "" + lang("écÇËÉJÉX", "garbage")
					}
				} else {
					if (iParam2(__eee) == 999) {
						s@m63 += "" + cdatan(0, 0)
					} else {
						s@m63 += "" + refchara(iParam2(__eee), 2, 1)
					}
				}
				/* écä[â∆ãÔÇÃñºëO */
				if (jp) {
					s@m63 += "ÇÃ" + mtname(0, iMaterial(__eee)) + "êªÇÃ"
				} else {
					s@m63 += " " + mtname(0, iMaterial(__eee)) + " "
				}
			}
		}
	}
	if (iId(__eee) == 729) {
		s@m63 += "" + giftn(iParam4(__eee)) + lang("", " ")
	}
	if (skip@m63 == 1) {
		goto *label_0363
	}
	alpha@m63 = 0
	if (iId(__eee) == 204 | iId(__eee) == 573 | iId(__eee) == 574 | iId(__eee) == 26 | iId(__eee) == 575) {
		if (ibit(5, __eee) == 1 & iSubname(__eee) == 0) {
			s@m63 += "" + cdatan(0, 0) + lang("ÇÃ", " ")
		}
	}
	if (iId(__eee) == 573 & iIdentificationState(__eee) == 3) {
		if (iCount(__eee) > 0) {
			s@m63 += lang("", " into ")
			if (iCount(__eee) == 343) {
				if (iDv(__eee) != usernpcmax) {
					s@m63 += lang(userdatan(1, iDv(__eee)), userdatan(0, iDv(__eee)))
				} else {
					s@m63 += lang("écÇËÉJÉX", "garbage")
				}
			} else {
				s@m63 += refchara(iCount(__eee), 2, 1)
			}
			if (jp) {
				s@m63 += "Ç™èhÇ¡ÇΩ"
			}
		}
	}
	if (iIdentificationState(__eee) >= 3) {
		if (a@m63 < 50000) {
			if (ibit(15, __eee)) {
				alpha@m63 = 1
				s@m63 += lang("ÉGÉ^Å[ÉiÉãÉtÉHÅ[ÉX", "eternal force") + strblank
			} else {
				if (iSubname(__eee) >= 10000) {
					if (iSubname(__eee) < 20000) {
						if (jp) {
							s@m63 += egoname(iSubname(__eee) - 10000) + strblank
						}
					} else {
						if (iSubname(__eee) < 40000) {
							s@m63 += egominorn(iSubname(__eee) - 20000) + strblank
						}
					}
				}
				if (iQuality(__eee) != 6 & (iId(__eee) != 477 | ibit(5, __eee) == 0)) {
					if (iQuality(__eee) >= 4) {
						s@m63 += mtname(1, iMaterial(__eee)) + strblank
					} else {
						s@m63 += mtname(0, iMaterial(__eee)) + strblank
						if (jp) {
							if (peek(mtname(0, iMaterial(__eee))) == 131) {
								alpha@m63 = 1
							} else {
								s@m63 += "ÇÃ"
							}
						}
					}
				}
			}
		}
	}
	if (ibit(19, __eee)) {
		alpha@m63 = 1
	}
	if (iIdentificationState(__eee) == 0) {
		s@m63 += iknownnamecnv(__eee)
	} else {
		if (iIdentificationState(__eee) < 3) {
			if (iQuality(__eee) < 4 | a@m63 >= 50000) {
				s@m63 += ioriginalnamecnv(__eee)
			} else {
				s@m63 += iknownnamecnv(__eee)
			}
		} else {
			if (iQuality(__eee) == 6 | ibit(5, __eee) == 1) {
				if (iMaterial(__eee) != 0 & ibit(21, __eee) != 0) {
					if (iParam2(__eee) == 343) {
						if (inv(33, __eee) != usernpcmax) {
							s@m63 += lang(userdatan(1, inv(33, __eee)) + "ÇÃ", userdatan(1, inv(33, __eee)))
						} else {
							s@m63 += "" + lang("écÇËÉJÉX", "garbage")
						}
					} else {
						if (iParam2(__eee) == 999) {
							s@m63 += cdatan(0, 0) + lang("ÇÃ", " ")
						} else {
							s@m63 += refchara(iParam2(__eee), 2, 1) + lang("ÇÃ", " ")
						}
					}
				}
				if (jp) {
					s@m63 = "Åö" + s@m63 + ioriginalnamecnv(__eee)
				} else {
					s@m63 += ioriginalnamecnv(__eee)
				}
			} else {
				if (iQuality(__eee) >= 4) {
					if (jp) {
						s@m63 = "Åô" + s@m63
					}
				}
				if (ibit(18, __eee)) {
					if (alpha@m63 == 1 & jp) {
						if (iCurseState(__eee) >= 1) {
							s@m63 += lang("ÉWÉÉÉXÉeÉBÉX", "justice ")
						} else {
							if (iCurseState(__eee) <= (-2)) {
								s@m63 += lang("ÉCÉrÉã", "evil ")
							} else {
								if (ibit(10, __eee) == 0) {
									s@m63 += lang("ÉqÅ[ÉçÅ[ÉY", "hero's ")
								}
							}
						}
					} else {
						if (iCurseState(__eee) >= 1) {
							s@m63 += lang("êπ", "justice ")
						} else {
							if (iCurseState(__eee) <= (-2)) {
								s@m63 += lang("é◊", "evil ")
							} else {
								if (ibit(10, __eee) == 0) {
									s@m63 += lang("âpóYÇÃ", "hero's ")
								}
							}
						}
					}
				}
				if (iMaterial(__eee) != 0 & ibit(21, __eee) != 0 & a@m63 != 60000) {
					if (iParam2(__eee) == 343) {
						if (inv(33, __eee) != usernpcmax) {
							s@m63 += lang( userdatan(1, inv(33, __eee)) + "ÇÃ", userdatan(1, inv(33, __eee)))
						} else {
							s@m63 += "" + lang("écÇËÉJÉX", "garbage")
						}
					} else {
						if (ibit(10, __eee) == 0) {
							if (iParam2(__eee) == 999) {
								s@m63 += cdatan(0, 0) + lang("ÇÃ", " ")
							} else {
								s@m63 += refchara(iParam2(__eee), 2, 1) + lang("ÇÃ", " ")
							}
						}
					}
				}
				if (alpha@m63 == 1 & jp) {
					s@m63 += ialphanamecnv(__eee)
				} else {
					s@m63 += ioriginalnamecnv(__eee)
				}
				if (en) {
					if (a@m63 < 50000) {
						if (iSubname(__eee) >= 10000) {
							if (iSubname(__eee) < 20000) {
								s@m63 += " " + egoname(iSubname(__eee) - 10000)
							}
						}
					}
				}
				if (iSubname(__eee) >= 40000) {
					randomize iSubname(__eee) - 40000
					if (iQuality(__eee) == 4) {
						s@m63 += lang("Åw", " <") + random_title(1) + lang("Åx", ">")
					} else {
						s@m63 += lang("Ås", " {") + random_title(1) + lang("Åt", "}")
					}
					randomize
				}
			}
		}
	}
	if (iId(__eee) == 618) {
		if (iSubname(__eee) >= 37) {
			if (iIdentificationState(__eee) == 3) {
				if (iParam2(__eee) == 0) {
					randomize iParam1(__eee)
					s@m63 += lang("Ås", " {") + random_title(1) + lang("Åt", "}")
					randomize
				}
			}
		}
	}
*label_0363
	if (en) {
		if (__ggg == 0) {
			if (iIdentificationState(__eee) >= 3 & (iQuality(__eee) >= 4 & a@m63 < 50000)) {
				s@m63 = "the " + s@m63
			} elseif (num2@m63 == 1) {
				s4@m63 = strmid(s@m63, 0, 1)
				if (s4@m63 == "a" | s4@m63 == "o" | s4@m63 == "i" | s4@m63 == "u" | s4@m63 == "e") {
					s@m63 = "an " + s@m63
				} else {
					s@m63 = "a " + s@m63
				}
			}
		}
		if (s2@m63 == "") {
			if (iId(__eee) != 618) {
				if (num2@m63 > 1) {
					s@m63 += "s"
				}
			}
		}
		gosub *label_0361
	}
	if (iIdentificationState(__eee) >= 3) {
		if (iEnhancement(__eee) != 0) {
			s@m63 += "" + cnvfix(iEnhancement(__eee)) + " "
		}
		if (ibit(4, __eee) == 1 & __hhh == 0) {
			s@m63 += lang("(écÇË" + iCount(__eee) + "âÒ)", "(Charges: " + iCount(__eee) + ")")
		}
		if ((iDiceX(__eee) != 0 | iHitBonus(__eee) != 0 | iDamageBonus(__eee) != 0) & __hhh == 0) {
			s@m63 += " ("
			if (iDiceX(__eee) != 0) {
				s@m63 += "" + iDiceX(__eee) + "d" + iDiceY(__eee)
				if (iDamageBonus(__eee) != 0) {
					if (iDamageBonus(__eee) > 0) {
						s@m63 += "+" + iDamageBonus(__eee)
					} else {
						s@m63 += "" + iDamageBonus(__eee)
					}
				}
				s@m63 += ")"
				if (iHitBonus(__eee) != 0) {
					s@m63 += "(" + iHitBonus(__eee) + ")"
				}
			} else {
				s@m63 += "" + iHitBonus(__eee) + "," + iDamageBonus(__eee) + ")"
			}
		}
		if ((iDv(__eee) != 0 | iPv(__eee) != 0) & __hhh == 0 & iId(__eee) != iId_egg) {
			s@m63 += " [" + iDv(__eee) + "," + iPv(__eee) + "]"
		}
		if (iId(__eee) == 687) {
			if (iParam2(__eee) != 0) {
				s@m63 += "(" + (iParam1(__eee) + 1) + "GP)"
			}
		}
	}
	if (iId(__eee) == 337 | iId(__eee) == 338 | iId(__eee) == 339 | iId(__eee) == 340 | iId(__eee) == 341) {
		if (iValue(__eee) >= 640) {
			s@m63 += "(Lv:" + (iValue(__eee) - 600) / 40 + ")"
		}
	}
	if (iId(__eee) == iId_egg & iIdentificationState(__eee) == 3) {
		if (iCount(__eee) > 0) {
			s@m63 += "(Lv:" + iPv(__eee) + ")"
		}
	}
	if (iId(__eee) == 243) {
		if (ibit(5, __eee)) {
			s@m63 += "(" + nc_horskilln(iParam1(__eee)) + " Lv:" + iParam2(__eee) + ")"
		}
	}
	if (en) {
		if (iId(__eee) == 284 | iId(__eee) == 283) {
			s@m63 += "(Lost property)"
		}
	}
	if (iId(__eee) == 342) {
		if (iCount(__eee) != 0) {
			s@m63 += lang("(" + biten(iParam4(__eee)) + "écÇË" + iCount(__eee) + "ïC)", "(" + iCount(__eee) + " " + biten(iParam4(__eee)) + ")")
		}
	}
	if (iId(__eee) == 685) {
		if (iSubname(__eee) == 0) {
			if (ibit(5, __eee)) {
				s@m63 += lang(" (ãÛ)", "(Empty)")
			} else {
				s@m63 += lang(" Lv", " Level ") + iParam2(__eee) + lang(" (ãÛ)", "(Empty)")
			}
		} elseif (iSubname(__eee) == 343) {
			if (inv(33, __eee) != usernpcmax) {
				s@m63 += " (" + userdatan(1, inv(33, __eee)) + " "
			} else {
				s@m63 += " (" + lang("écÇËÉJÉX", "garbage") + " "
			}
		} else {
			s@m63 += " (" + refchara(iSubname(__eee), 2, 1) + " "
		}
		if (iSubname(__eee) != 0) {
			s@m63 += "Lv:" + iParam3(__eee) + ")"
		}
	}
	if (iId(__eee) == 734) {
		s@m63 += lang(" Lv", " Level ") + iParam2(__eee)
	}
	if (iId(__eee) == 747) {
		if (iIdentificationState(__eee) == 3) {
			if (iParam2(__eee) == 505) {
				s@m63 += lang(" (ñÖ/", " (younger sister/")
			} elseif (iParam2(__eee) == 619) {
				s@m63 += lang(" (ÉGÉçñ{/", " (pornbook/")
			} else {
				s@m63 += " (" + ioriginalnameref(iParam2(__eee)) + "/"
			}
			s@m63 += lang("ê¨í∑ë¨ìx:", "SPEED:") + inv(16, __eee) + "/"
			s@m63 += lang("ê¨í∑å¿äE:", "Limit:") + iParam3(__eee) + ")"
		}
	}
	if (iId(__eee) == 526) {
		if (iIdentificationState(__eee) == 3) {
			if (iParam2(__eee) == 505) {
				s@m63 += lang(" (ñÖ)", " (younger sister)")
			} else {
				s@m63 += " (" + ioriginalnameref(iParam2(__eee)) + ")"
			}
		}
	}
	if (iIdentificationState(__eee) == 2) {
		if (a@m63 < 50000) {
			s@m63 += " (" + cnven(_quality(iQuality(__eee))) + ")"
			if (jp) {
				s@m63 += "[" + mtname(0, iMaterial(__eee)) + "êª]"
			} else {
				s@m63 += "[" + cnven(mtname(0, iMaterial(__eee))) + "]"
			}
			if (iCurseState(__eee) == (-1)) {
				s@m63 += lang("(ã∞ÇÎÇµÇ¢)", "(Scary)")
			}
			if (iCurseState(__eee) == (-2)) {
				s@m63 += lang("(â–ÅXÇµÇ¢)", "(Dreadful)")
			}
		}
	}
	if (a@m63 == 72000) {
		if (iId(__eee) == 361) {
			s@m63 += lang("(à⁄ìÆéûè¡ñ≈)", "(Temporal)")
		} elseif (iCount(__eee) == 0) {
			if (iParam1(__eee) == 0) {
				s@m63 += lang("(ãÛÇ¡Ç€)", "(Empty)")
			}
		}
	}
	if (a@m63 == 92000) {
		if (iParam2(__eee) != 0) {
			s@m63 += lang("(édì¸ÇÍíl " + iParam2(__eee) + "g)", "(Buying price: " + iParam2(__eee) + ")")
		}
	}
	if (ibit(6, __eee) == 1) {
		s@m63 += lang("(õZñÚç¨ì¸)", "(Aphrodisiac)")
	}
	if (ibit(14, __eee) == 1) {
		s@m63 += lang("(ì≈ï®ç¨ì¸)", "(Poisoned)")
	}
	if (ibit(7, __eee) == 1) {
		if (getgametime() < iCount(__eee)) {
			s@m63 += lang("(" + (iCount(__eee) - getgametime()) + "éûä‘)", "(Next: " + (iCount(__eee) - getgametime()) + "h.)")
		}
	}
	if (iId(__eee) == 555) {
		if (iCount(__eee) != 0) {
			s@m63 += lang(" ÉVÉäÉAÉãNo.", " serial no.") + iCount(__eee)
		}
	}
	if (iId(__eee) == 544) {
		s@m63 += " <BGM" + iParam1(__eee) + ">"
	}
	if (iId(__eee) == iId_dye) {
		s@m63 += "(" + text_dyeColor2Str(iColor(__eee)) + ")"
	}
	if (iId(__eee) == 621) {
		if (iParam3(__eee) != 0) {
			s@m63 += "(" + mapname(areaId(iParam3(__eee))) + ")"
		}
	}
	if (iId(__eee) == 204) {
		if (ibit(5, __eee) == 1) {
			if (iParam2(__eee) > 0 & iIdentificationState(__eee) == 3) {
				sreplace s@m63, s@m63, lang("ìÆï®", "beast"), cdatan(0, 0)
				s@m63 = lang("Åö", "") + s@m63
			}
		}
	}
	if (iId(__eee) == 573) {
		if (ibit(5, __eee) == 1) {
			if (iParam2(__eee) > 0 & iIdentificationState(__eee) == 3) {
				sreplace s@m63, s@m63, lang("íπ", "animal"), cdatan(0, 0)
				s@m63 = lang("Åö", "") + s@m63
			}
		}
	}
	if (iId(__eee) == iId_milk) {
		if (ibit(5, __eee) == 1) {
			if (iParam2(__eee) > 0 & iIdentificationState(__eee) == 3) {
				s@m63 = lang("Åö", "") + s@m63
			}
		}
	}
	if (gWizard) {
		s@m63 = "(" + __eee + ")" + s@m63
	}
	if (strlen(s@m63) > 66) {
		len@m63 = zentohan(s@m63, buf@m63, 0)
		sdim buf@m63, len@m63
		ret@m63 = zentohan(s@m63, s@m63, len@m63)
	}
	skip@m63 = 0
	itemnamehack = 0
	return s@m63
*label_0361
	if (iId(__eee) == 578) {
		s@m63 += lang("" + moneyboxn(iParam2(__eee)), "(" + moneyboxn(iParam2(__eee)) + ")")
	}
	if (iId(__eee) == 617) {
		s@m63 += lang("" + biten(iParam1(__eee)), " <" + biten(iParam1(__eee)) + ">")
	}
	if (iId(__eee) == 687) {
		if (jp) {
			if (iParam2(__eee) != 0) {
				s@m63 += "âì«çœÇ›ÇÃ"
			}
		}
		if (iIdentificationState(__eee) >= 3) {
			s@m63 += lang("Ås" + magebookn(iParam1(__eee)) + "ÅtÇ∆Ç¢Ç§ëËñºÇÃ", " titled <" + magebookn(iParam1(__eee)) + ">")
		}
	}
	if (iId(__eee) == 783) {
		if (iParam1(__eee) == 0) {
			s@m63 += lang("Ç‡Ç§égÇ¶Ç»Ç¢", " which cannot be used anymore")
		} elseif (iSubname(__eee) == 0) {
			s@m63 += lang("ÉJÉXÉ^ÉÄ", "blank ")
		} else {
			s@m63 += lang("Ås" + rpname(iSubname(__eee)) + "ÅtÇÃ", " of <" + rpname(iSubname(__eee)) + ">")
		}
	}
	if (a@m63 == 55000) {
		if (iId(__eee) == 563) {
			s@m63 += lang("Ås" + skillname(iParam1(__eee)) + "ÅtÇ∆Ç¢Ç§ëËñºÇÃ", " titled <Art of " + skillname(iParam1(__eee)) + ">")
		} elseif (iId(__eee) == 668) {
			s@m63 += lang("ëÊ", " of Rachel No.") + iParam2(__eee) + lang("ä™ñ⁄ÇÃ", "")
		} elseif (iId(__eee) == 24) {
			s@m63 += lang("Ås" + booktitle(iParam1(__eee)) + "ÅtÇ∆Ç¢Ç§ëËñºÇÃ", " titled <" + booktitle(iParam1(__eee)) + ">")
		}
	}
	if (a@m63 == 60002) {
		if (iParam1(__eee) != 0) {
			s@m63 += lang(godname(godno2godid(iParam1(__eee))) + "ÇÃ", " <" + godname(godno2godid(iParam1(__eee))) + ">")
		} elseif (iParam3(__eee) != 0) {
			if (cgodShortId(iParam2(__eee)) != "eyth") {
				s@m63 += lang(godname(cgodShortId(iParam2(__eee))) + "ÇÃ", " <" + godname(cgodShortId(iParam2(__eee))) + ">")
			}
		}
	}
	if (a@m63 == 57000 | item_isCookedMilk(__eee)) {
		if (iParam1(__eee) != 0) {
			if (iParam2(__eee) != 0) {
				skip@m63 = 1
				if (iId(__eee) == iId_egg & iIdentificationState(__eee) == 3) {
					if (iCount(__eee) > 0) {
						s@m63 += lang("", "into ")
						if (iCount(__eee) == 343) {
							if (iDv(__eee) != usernpcmax) {
								s@m63 += userdatan(1, iDv(__eee))
							} else {
								s@m63 += lang("écÇËÉJÉX", "garbage")
							}
						} else {
							s@m63 += refchara(iCount(__eee), 2, 1)
						}
						if (jp) {
							s@m63 += "Ç™èhÇ¡ÇΩ"
						}
					}
				}
				if (iId(__eee) == 743) {
					s@m63 = s@m63 + foodname(iParam1(__eee) / 1000, "" + ioriginalnamecnv(__eee), iParam2(__eee), iSubname(__eee), inv(33, __eee))
				} elseif (iId(__eee) == 618) {
					s@m63 = s@m63 + foodname(iParam1(__eee) / 1000, "" + fishdatan(iSubname(__eee)), iParam2(__eee), iSubname(__eee), inv(33, __eee))
				} elseif (iId(__eee) == iId_milk) {
					if (ibit(5, __eee) & iSubname(__eee) == 0) {
						s@m63 = s@m63 + foodname(9, cdatan(0, 0), iParam2(__eee), iSubname(__eee), inv(33, __eee))
					} else {
						s@m63 = s@m63 + foodname(9, "", iParam2(__eee), iSubname(__eee), inv(33, __eee))
					}
				} else {
					if (iId(__eee) == 419) {
						return
					}
					if (ibit(5, __eee) & iSubname(__eee) == 0) {
						s@m63 = s@m63 + foodname(iParam1(__eee) / 1000, cdatan(0, 0), iParam2(__eee), iSubname(__eee), inv(33, __eee))
					} elseif (iSubname(__eee) > 0) {
						s@m63 = s@m63 + foodname(iParam1(__eee) / 1000, refchara(iSubname(__eee), 2, 1), iParam2(__eee), iSubname(__eee), inv(33, __eee))
					} else {
						s@m63 = s@m63 + foodname(iParam1(__eee) / 1000, "" + ioriginalnamecnv(__eee), iParam2(__eee), iSubname(__eee), inv(33, __eee))
					}
				}
				return
			}
		}
		if (iOwnState(__eee) == 4) {
			s@m63 += lang("", " grown ") + _weight(iSubname(__eee)) + lang("àÁÇ¡ÇΩ", "")
		}
	}
	if (iSubname(__eee) != 0) {
		if (iId(__eee) == 618 | iId(__eee) == 619) {
			if (iSubname(__eee) < 0 | iSubname(__eee) >= 100) {
				s@m63 += "/bugged/"
				return
			}
			if (iId(__eee) == 619 & iSubname(__eee) == 30) {
				if (en) {
					// pornographic book
					s@m63 += "" + fishdatan(iSubname(__eee))
				}
				if (iParam1(__eee) != 0) {
					if (iParam2(__eee) != 0) {
							if (iParam1(__eee) == 343) {
								s@m63 += lang("", " of ")
								if (inv(33, __eee) != usernpcmax) {
									s@m63 += userdatan(1, inv(33, __eee))
								} else {
									s@m63 += lang("écÇËÉJÉX", "garbage")
								}
								if (jp) {
									s@m63 += "Å~"
								}
							} else {
								if (iParam1(__eee) == 999) {
									s@m63 += lang("", " of ") + cdatan(0, 0)
								} else {
									s@m63 += lang("", " of ") + refchara(iParam1(__eee), 2, 1)
								}
								if (jp) {
									s@m63 += "Å~"
								}
							}
							if (iParam2(__eee) == 343) {
								s@m63 += lang("", " of ")
								if (iParam3(__eee) != usernpcmax) {
									s@m63 += userdatan(1, iParam3(__eee))
								} else {
									s@m63 += lang("écÇËÉJÉX", "garbage")
								}
								if (jp) {
									s@m63 += "ÇÃ"
								}
							} else {
								if (iParam2(__eee) == 999) {
									s@m63 += lang("", " of ") + cdatan(0, 0)
								} else {
									s@m63 += lang("", " of ") + refchara(iParam2(__eee), 2, 1)
								}
								if (jp) {
									s@m63 += "ÇÃ"
								}
							}
					} else {
						if (iParam1(__eee) == 343) {
							s@m63 += lang("", " of ")
							if (inv(33, __eee) != usernpcmax) {
								s@m63 += userdatan(1, inv(33, __eee))
							} else {
								s@m63 += lang("écÇËÉJÉX", "garbage")
							}
							if (jp) {
								s@m63 += "ÇÃ"
							}
						} else {
							if (iParam1(__eee) == 999) {
								s@m63 += lang("", " of ") + cdatan(0, 0)
							} else {
								s@m63 += lang("", " of ") + refchara(iParam1(__eee), 2, 1)
							}
							if (jp) {
								s@m63 += "ÇÃ"
							}
						}
					}
				}
				if (jp) {
					// ÉGÉçñ{
					s@m63 += "" + fishdatan(iSubname(__eee))
				}
			} else {
				s@m63 += "" + fishdatan(iSubname(__eee))
			}
		} elseif (a@m63 == 57000 & iId(__eee) != 667 | a@m63 == 62000 | iId(__eee) == 503 | iId(__eee) == 504 | iId(__eee) == 575 | iId(__eee) == 574 | iId(__eee) == 745) {
			if (iSubname(__eee) < 0 | iSubname(__eee) >= 800) {
				s@m63 += "/bugged/"
				return
			}
			if (iOwnState(__eee) != 4) {
				s@m63 += lang("", " of ")
				if (iSubname(__eee) == 343) {
					if (inv(33, __eee) != usernpcmax) {
						s@m63 += userdatan(1, inv(33, __eee))
					} else {
						s@m63 += lang("écÇËÉJÉX", "garbage")
					}
				} else {
					s@m63 += refchara(iSubname(__eee), 2, 1)
				}
				if (jp) {
					s@m63 += "ÇÃ"
				}
			}
		}
		if (a@m63 == 60000 | a@m63 == 77000) {
			if (jp) {
				if (iSubname(__eee) >= 12) {
					iSubname(__eee) = 0
				} else {
					s@m63 += _furniture(iSubname(__eee))
				}
			}
		}
		if (iId(__eee) == 344) {
			s@m63 += lang("", " of ") + _homename(iParam1(__eee)) + lang("ÇÃ", "")
		}
		if (iId(__eee) == 615) {
			s@m63 += lang("" + iSubname(__eee) + "goldÇÃ", " <" + iSubname(__eee) + " gp>")
		}
		if (iId(__eee) == 704) {
			if (iSubname(__eee) < 0 | iSubname(__eee) >= 800) {
				s@m63 += "/bugged/"
				return
			}
			if (iSubname(__eee) == 343) {
				if (inv(33, __eee) != usernpcmax) {
					s@m63 += lang("" + userdatan(1, inv(33, __eee)) + "ÇÃ", " of " + userdatan(1, inv(33, __eee)))
				} else {
					s@m63 += lang("écÇËÉJÉXÇÃ", " of garbage")
				}
			} else {
				s@m63 += lang("" + refchara(iSubname(__eee), 2, 1) + "ÇÃ", " of " + refchara(iSubname(__eee), 2, 1))
			}
		}
	}
	if (iId(__eee) == 672) {
		if (iParam1(__eee) == 169) {
			s@m63 += lang("ëPêlÇÃ", " of saint")
		}
		if (iParam1(__eee) == 162) {
			s@m63 += lang("à´êlÇÃ", " of wicked")
		}
		if (iParam1(__eee) == 163) {
			s@m63 += lang("ÉGÉwÉJÉgÉãÇÃ", " of Ehekatl")
		}
		if (iParam1(__eee) == 164) {
			s@m63 += lang("ÉIÉpÅ[ÉgÉXÇÃ", " of Opatos")
		}
		if (iParam1(__eee) == 165) {
			s@m63 += lang("ÉCÉcÉpÉçÉgÉãÇÃ", " of Itzpalt")
		}
		if (iParam1(__eee) == 166) {
			s@m63 += lang("ÉWÉÖÉAÇÃ", " of Jure")
		}
	}
	if (equalsitem(__eee, "blacksmith hammer")) {
		if (iParam1(__eee) <= 10) {
			s@m63 += lang("É{ÉçÉ{ÉçÇÃ", " (Novice)")
		} elseif (iParam1(__eee) <= 20) {
				s@m63 += lang("è‰ïvÇ»", " (Apprentice)")
			} elseif (iParam1(__eee) <= 30) {
					s@m63 += lang("íbñËétÇÃ", " (Journeyman)")
				} elseif (iParam1(__eee) <= 40) {
						s@m63 += lang("å∫êlÇÃ", " (Expert)")
					} else {
						s@m63 += lang("ñºçHÇÃ", " (Master)")
					}
				}
	if (iId(__eee) == 795) {
		if (iParam1(__eee) == 0) {
			s@m63 += lang("ïóâªÇµÇΩ", "Weathered ")
		}
	}
	if (iId(__eee) == 667) {
		if (iSubname(__eee) != 0) {
			if (iSubname(__eee) < 0 | iSubname(__eee) >= 800) {
				s@m63 += "/bugged/"
				return
			}
			if (iSubname(__eee) == 343) {
				if (inv(33, __eee) != usernpcmax) {
					s@m63 += userdatan(1, inv(33, __eee))
				} else {
					s@m63 += lang("écÇËÉJÉX", "garbage")
				}
			} else {
				s@m63 += refchara(iSubname(__eee), 2, 1)
			}
			if (jp) {
				s@m63 += "Ç™"
			} else {
				s@m63 += "'s "
			}
		} elseif (jp) {
			s@m63 += "ñÖÇ™"
		} else {
			s@m63 += "sister's "
		}
	}
	if (equalsitem(__eee, "jewel of love")) {
		if (iSubname(__eee) != 0) {
			if (iSubname(__eee) < 0 | iSubname(__eee) >= 800) {
				// Unknown character name.
				s@m63 += "/bugged/"
				return
			}
			if (iSubname(__eee) == cId_user) { // CNPC
				if (inv(33, __eee) != usernpcmax) {
					s@m63 += userdatan(1, inv(33, __eee))
				} else {
					// Invalid CNPC ID.
					s@m63 += lang("écÇËÉJÉX", "a garbage")
				}
			} else { // Vanilla NPC
				s@m63 += refchara(iSubname(__eee), 2, 1)
			}
			s@m63 += lang("ÇÃ", "'s ")
		}
	}
	return



#deffunc remain_make int __hhh, int __iii
	iSubname(__hhh) = cId(__iii)
	if (iSubname(__hhh) == 343) {
		inv(33, __hhh) = cCnpcId(__iii)
		inv(34, __hhh) = createserialno(userdatan(0, cCnpcId(__iii)))
	}
	iColor(__hhh) = getcharacolor(__iii)
	iWeight(__hhh) = cWeight(__iii)
	if (iId(__hhh) == 204) {
		iWeight(__hhh) = 250 * (iWeight(__hhh) + 100) / 100 + 500
		iValue(__hhh) = iWeight(__hhh) / 5
	} else {
		iWeight(__hhh) = 20 * (iWeight(__hhh) + 500) / 500
		iValue(__hhh) = int(limitf(double(cLevel(__iii)) * 40 + 600, 1, 2147483647))
		if (refchara(cId(__iii), 6) < 20) {
			if (cOriginalRelationship(__iii) < (-1)) {
				iValue(__hhh) = int(limitf(double(iValue(__hhh)) * limit(4 - refchara(cId(__iii), 6) / 5, 1, 5), 1, 2147483647))
			}
		}
	}
	return



#deffunc make_dish int __food, int __rank
	if (iId(__food) == iId_milk) {
		iParam1(__food) = 9000
	}
	iImage(__food) = picfood(__rank, iParam1(__food) / 1000)
	iWeight(__food) = 500
	if (iMaterial(__food) == 35) {
		if (iParam3(__food) >= 0) {
			iParam3(__food) = getgametime() + 72
		}
	}
	iParam2(__food) = __rank
	inv(19, __food) = 0
	return



// Stack items.
// @param __owner The inventory's owner. -1 means the ground.
// @param __ci The base item.
// @param __showMessage If true, show the stacked items; otherwise, do nothing.
// @return true if any item did be stacked; otherwise, false.
#deffunc item_stack int __owner, int __ci, int __showMessage
	if (iNumber(__ci) == 2147483647) {
		return 0
	}

	if (iQuality(__ci) == iQuality_special) {
		if (refitem(iId(__ci), 5, __ci) < 50000) {
			// Special equipments never stack.
			return 0
		}
	}

	didStack@tmp = 0

	inv_getheader __owner
	repeat invrange, invhead
		if (cnt == __ci) {
			continue
		}
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) != iId(__ci)) {
			continue
		}
		if (iId(cnt) == iId_smallMedal) {
			if (__owner == (-1) & mode != 6) {
				if (iX(cnt) != iX(__ci) | iY(cnt) != iY(__ci)) {
					continue
				}
			}
			isAlmostSame@tmp = 1
			goto *item_stack_skipCheck
		}
		item@tmp = cnt
		isAlmostSame@tmp = 1
		repeat 70
			if (cnt == 0 | cnt == 4 | cnt == 30) {
				// Do not care "number", "quality", "turn".
				continue
			}
			if (__owner != (-1) | mode == 6) {
				if (cnt == 5 | cnt == 6) {
					// Do not care the position unless the item is put on the ground.
					continue
				}
			}
			if (inv(cnt, item@tmp) != inv(cnt, __ci)) {
				if (cnt == 35) {
					f = 0
					repeat 22
						if (cnt == 13 | cnt == 22) {
							continue
						}
						if (ibit(cnt, item@tmp) != ibit(cnt, __ci)) {
							f = 1
							break
						}
					loop
					if (f == 0) {
						continue
					}
				}
				isAlmostSame@tmp = 0
				break
			}
		loop
*item_stack_skipCheck
		if (isAlmostSame@tmp) {
			if (iNumber(cnt) == 2147483647) {
				continue
			}
			n1@tmp = iNumber(cnt)
			n2@tmp = iNumber(__ci)
			n3@tmp = limitaddition(n1@tmp, n2@tmp)
			iNumber(cnt) = n3@tmp
			iNumber(__ci) = n1@tmp + n2@tmp - n3@tmp
			didStack@tmp = 1
			ti = cnt
			break
		}
	loop

	if (didStack@tmp) {
		if (mode != 6) {
			if (inv_getowner(__ci) == (-1)) {
				cell_refresh iX(__ci), iY(__ci)
				if (__owner == 0) {
					gosub *refreshPCBurdenState
				}
			}
		}
		if (__showMessage) {
			txt -1, lang(itemname(ti, 1) + "ÇÇ‹Ç∆ÇﬂÇΩ(åv" + iNumber(ti) + "å¬) ", itemname(ti, 1) + " has been stacked. (Total:" + iNumber(ti) + ")")
		}
	}
	return didStack@tmp



#deffunc colorres int
	color 0, 0, 0
	if (i@m66 == 50) {
		color 150, 0, 0
	}
	if (i@m66 == 51) {
		color 0, 0, 150
	}
	if (i@m66 == 52) {
		color 150, 150, 0
	}
	if (i@m66 == 59) {
		color 150, 0, 150
	}
	if (i@m66 == 53) {
		color 100, 80, 80
	}
	if (i@m66 == 55) {
		color 0, 150, 0
	}
	if (i@m66 == 60) {
		color 150, 100, 100
	}
	if (i@m66 == 57) {
		color 50, 100, 150
	}
	if (i@m66 == 58) {
		color 100, 150, 50
	}
	if (i@m66 == 54) {
		color 150, 100, 50
	}
	if (i@m66 == 56) {
		color 150, 50, 0
	}
	return
