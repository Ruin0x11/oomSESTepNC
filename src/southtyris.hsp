#include "macro/macro.hsp"
#include "const/const.hsp"
#include "string/string.hsp"
#include "karioki.hsp"
#include "sqlite.hsp"
#include "ctalk.hsp"
#include "custom.hsp"
#include "ctrlfile.hsp"
#include "datetime.hsp"

#include "attack.hsp"
#include "chara.hsp"
#include "encicon.hsp"
#include "food.hsp"
#include "housing.hsp"
#include "locations.hsp"
#include "map.hsp"
#include "map_effect.hsp"
#include "material.hsp"
#include "migration.hsp"
#include "pet_strategy.hsp"
#include "quest.hsp"
#include "random.hsp"
#include "shop.hsp"
#include "text.hsp"
#include "trait.hsp"
#include "util.hsp"
#include "skill.hsp"

#include "longint.hsp"

#include "hspinet.as"

#include "a2d.hsp"

// nc
#include "NC.hsp"
#include "nc_gift.hsp"
#include "nc_pict.hsp"
#include "nc_charasheet.hsp"
#include "nc_music.hsp"
#include "nc_macro.hsp"
#include "nc_mmatxt.hsp"
#include "nc_mmasstp.hsp"
#include "nc_kouhai.hsp"
#include "nc_cname.hsp"
#include "nc_haizinhelp.hsp"
#include "nc_net.hsp"
#include "nc_horse.hsp"
#include "nc_adddamage.hsp"
#include "nc_jobskill.hsp"

#defcfunc ibit int __ooo, int __ppp
	HMMBITCHECK inv(35 + __ooo / 32, __ppp), __ooo \ 32
	return abs(stat)

#deffunc ibitmod int __qqq, int __rrr, int __sss
	if (__sss == 0) {
		HMMBITOFF inv(35 + __qqq / 32, __rrr), __qqq \ 32
		return
	}
	HMMBITON inv(35 + __qqq / 32, __rrr), __qqq \ 32
	return



#defcfunc refitem int __ttt, int __uuu, int __vvv
	dbmode = 16
	dbidbk = dbid
	dbid = __ttt
	dbspec = __uuu
	cibkref = __vvv
	gosub *label_2426
	dbid = dbidbk
	return stat



#defcfunc iequiploc int __www, int __xxx
	p@m13 = refitem(iId(__www), 5, __www)
	if (p@m13 == 12000) {
		if (__xxx == 0 | __xxx == 1) {
			return 1
		}
	}
	if (p@m13 == 34000) {
		if (__xxx == 0 | __xxx == 2) {
			return 2
		}
	}
	if (p@m13 == 20000) {
		if (__xxx == 0 | __xxx == 3) {
			return 3
		}
	}
	if (p@m13 == 16000) {
		if (__xxx == 0 | __xxx == 4) {
			return 4
		}
	}
	if (p@m13 == 10000 | p@m13 == 14000) {
		if (__xxx == 0 | __xxx == 5) {
			return 5
		}
	}
	if (p@m13 == 32000) {
		if (__xxx == 0 | __xxx == 6) {
			return 6
		}
	}
	if (p@m13 == 22000) {
		if (__xxx == 0 | __xxx == 7) {
			return 7
		}
	}
	if (p@m13 == 18000) {
		if (__xxx == 0 | __xxx == 9) {
			return 9
		}
	}
	if (p@m13 == 24000) {
		if (__xxx == 0 | __xxx == 10 | __xxx == 5) {
			if (__xxx != 5 | iSkill(__www) != 108) {
				return 10
			}
		}
	}
	if (p@m13 == 25000) {
		if (__xxx == 0 | __xxx == 11) {
			return 11
		}
	}
	if (p@m13 == 19000) {
		if (__xxx == 0 | __xxx == 8) {
			return 8
		}
	}
	return 0

#deffunc setunid int __yyy, int __zzz
	cCnpcId(__yyy) = __zzz
	if (cImage(__yyy) \ 1000 < 661 | cImage(__yyy) \ 1000 > 824) {
		if (ocbit(8, __yyy) == 0) {
			if (userdata2(8, cCnpcId(__yyy)) != 0) {
				cImage(__yyy) = limit(userdata2(8, cCnpcId(__yyy)), 0, 33 * 25)
				cImage(__yyy) += limit(userdata2(9, cCnpcId(__yyy)), 0, 30) * 1000
			} else {
				cImage(__yyy) = 825 + __zzz
			}
		}
	}
	return

#deffunc getunid int __aaa
	f@m14 = 0
	repeat usernpcmax
		if (cdatan(5, __aaa) == userdatan(0, cnt)) {
			setunid __aaa, cnt
			f@m14 = 1
			break
		}
	loop
	if (f@m14 == 0) {
		cImage(__aaa) = 0 * 3000 + 1
		cCnpcId(__aaa) = usernpcmax
		cdatan(0, __aaa) = lang("残りカス", "garbage")
	}
	return f@m14



#defcfunc findunid str __bbb
	f@m14 = 0
	repeat usernpcmax
		if (__bbb == userdatan(0, cnt)) {
			f@m14 = 1 + cnt
			break
		}
	loop
	return f@m14



#defcfunc synccheck int __ccc, int __ddd
	if (__ddd == (-1)) {
		if (cVisionFlag(__ccc) == msync) {
			return 1
		}
		if (__ccc == gMount) {
			return 1
		}
		if (ocdata(107, __ccc) != 0) {
			if (cVisionFlag(ocdata(107, __ccc)) == msync) {
				return 1
			}
		}
		return 0
	}
	if (mapsync(__ccc, __ddd) == msync) {
		return 1
	}
	return 0



#defcfunc evid
	if (evnum <= 0) {
		return -1
	}
	return evlist(evnum - 1)



#defcfunc evfind int __eee
	f@m17 = 0
	repeat evnum
		if (evlist(cnt) == __eee) {
			f@m17 = 1
		}
	loop
	return f@m17



#deffunc evadd int __fff, int __ggg, int __hhh
	if (evproc) {
		evlist(evnum) = evlist(evnum - 1)
		evdata1(evnum) = evdata1(evnum - 1)
		evdata2(evnum) = evdata2(evnum - 1)
		evlist(evnum - 1) = __fff
		evdata1(evnum - 1) = __ggg
		evdata2(evnum - 1) = __hhh
	} else {
		evlist(evnum) = __fff
		evdata1(evnum) = __ggg
		evdata2(evnum) = __hhh
	}
	evnum++
	return



#deffunc sndload str __iii, int __jjj
	if (__jjj < 7) {
		if (cfg_sound == 1) {
			DSLOADFNAME __iii, __jjj
		} else {
			if (cfg_music == 2) {
				mmload __iii, __jjj
			}
		}
	}
	soundfile(__jjj) = __iii
	return



#deffunc snd int __mmm, int __nnn, int __ooo
	if (cfg_sound == 0) {
		return
	}
	sound@m18 = __mmm
	if (sound@m18 > 7) {
		if (__nnn) {
			sound@m18 = 7 + 6
			if (__mmm == 78) {
				sound@m18 = 7 + 6 + 1
			}
			if (__mmm == 79) {
				sound@m18 = 7 + 6 + 2
			}
			if (__mmm == 80) {
				sound@m18 = 7 + 6 + 3
			}
		} else {
			sound@m18 = 7
			f@m18 = 0
			if (__ooo) {
				repeat 6, 7
					CHECKPLAY cnt
					if (stat) {
						if (soundlist(cnt - 7) == sound@m18) {
							sound@m18 = cnt
							f@m18 = 1
							break
						}
					}
				loop
			}
			if (f@m18 == 0) {
				repeat 6, 7
					CHECKPLAY cnt
					if (stat == 0) {
						sound@m18 = cnt
						soundlist(cnt - 7) = sound@m18
					}
				loop
			}
		}
		if (cfg_sound == 1) {
			DSLOADFNAME soundfile(__mmm), sound@m18
		} else {
			if (cfg_sound == 2) {
				mmload soundfile(__mmm), sound@m18
			}
		}
	}
	if (cfg_sound == 1) {
		DSPLAY sound@m18, __nnn
	} else {
		if (cfg_sound == 2) {
			mmplay sound@m18
		}
	}
	return
*label_0119
	dim soundlist, 6
	if (cfg_sound == 1) {
		DSGETMASTERVOLUME
		cfg_svolume = abs(stat)
	}
	folder = exedir + "sound\\"
	sndload folder + "exitmap1.wav", 49
	sndload folder + "book1.wav", 59
	sndload folder + "write1.wav", 44
	sndload folder + "pop1.wav", 1
	sndload folder + "kill1.wav", 8
	sndload folder + "kill2.wav", 9
	sndload folder + "trap1.wav", 70
	sndload folder + "more1.wav", 10
	sndload folder + "getgold1.wav", 11
	sndload folder + "paygold1.wav", 12
	sndload folder + "equip1.wav", 13
	sndload folder + "get1.wav", 14
	sndload folder + "get2.wav", 15
	sndload folder + "drop1.wav", 16
	sndload folder + "drink1.wav", 17
	sndload folder + "eat1.wav", 18
	sndload folder + "spend1.wav", 19
	sndload folder + "ding1.wav", 60
	sndload folder + "ding3.wav", 61
	sndload folder + "dead1.wav", 50
	sndload folder + "ok1.wav", 20
	sndload folder + "dig1.wav", 52
	sndload folder + "bash1.wav", 73
	sndload folder + "complete1.wav", 51
	sndload folder + "alert1.wav", 21
	sndload folder + "locked1.wav", 22
	sndload folder + "chest1.wav", 23
	sndload folder + "ding2.wav", 24
	sndload folder + "cook1.wav", 25
	sndload folder + "pop2.wav", 26
	sndload folder + "fail1.wav", 27
	sndload folder + "build1.wav", 58
	sndload folder + "bow1.wav", 29
	sndload folder + "atk1.wav", 2
	sndload folder + "atk2.wav", 3
	sndload folder + "gun1.wav", 30
	sndload folder + "throw1.wav", 31
	sndload folder + "heart1.wav", 32
	sndload folder + "heal1.wav", 33
	sndload folder + "teleport1.wav", 72
	sndload folder + "ball1.wav", 34
	sndload folder + "breath1.wav", 35
	sndload folder + "bolt1.wav", 37
	sndload folder + "arrow1.wav", 36
	sndload folder + "curse1.wav", 38
	sndload folder + "pop3.wav", 39
	sndload folder + "chime.wav", 53
	sndload folder + "laser1.wav", 42
	sndload folder + "web.wav", 68
	sndload folder + "cheer.wav", 69
	sndload folder + "door1.wav", 48
	sndload folder + "crush1.wav", 45
	sndload folder + "crush2.wav", 47
	sndload folder + "fire1.wav", 6
	sndload folder + "snow.wav", 86
	sndload folder + "fish_cast.wav", 87
	sndload folder + "fish_get.wav", 88
	sndload folder + "fish_fight.wav", 89
	sndload folder + "ammo.wav", 90
	sndload folder + "throw2.wav", 91
	sndload folder + "foot1a.wav", 81
	sndload folder + "foot2a.wav", 83
	sndload folder + "foot1b.wav", 82
	sndload folder + "foot2b.wav", 84
	sndload folder + "foot2c.wav", 85
	sndload folder + "click1.wav", 40
	sndload folder + "get3.wav", 41
	sndload folder + "card1.wav", 71
	sndload folder + "water.wav", 57
	sndload folder + "water2.wav", 46
	sndload folder + "dig2.wav", 54
	sndload folder + "bush1.wav", 55
	sndload folder + "gasha.wav", 56
	sndload folder + "cursor1.wav", 5
	sndload folder + "pop4.wav", 62
	sndload folder + "punish1.wav", 63
	sndload folder + "pray1.wav", 64
	sndload folder + "offer1.wav", 65
	sndload folder + "fizzle.wav", 66
	sndload folder + "door2.wav", 67
	sndload folder + "foot.wav", 43
	sndload folder + "miss.wav", 4
	sndload folder + "night.wav", 74
	sndload folder + "bg_rain.wav", 75
	sndload folder + "bg_thunder.wav", 76
	sndload folder + "bg_wind.wav", 77
	sndload folder + "bg_sea.wav", 78
	sndload folder + "bg_town.wav", 79
	sndload folder + "bg_fire.wav", 80
	sndload folder + "scroll.wav", 92
	sndload folder + "log.wav", 93
	sndload folder + "chara.wav", 94
	sndload folder + "wear.wav", 95
	sndload folder + "feat.wav", 96
	sndload folder + "port.wav", 97
	sndload folder + "unpop1.wav", 98
	sndload folder + "chat.wav", 99
	sndload folder + "inv.wav", 100
	sndload folder + "skill.wav", 101
	sndload folder + "spell.wav", 102
	sndload folder + "dice.wav", 103
	sndload folder + "vomit.wav", 104
	sndload folder + "atksword.wav", 105
	sndload folder + "atk_ice.wav", 106
	sndload folder + "atk_elec.wav", 107
	sndload folder + "atk_fire.wav", 108
	sndload folder + "atk_hell.wav", 109
	sndload folder + "atk_poison.wav", 110
	sndload folder + "atk_nerve.wav", 111
	sndload folder + "atk_sound.wav", 112
	sndload folder + "atk_mind.wav", 113
	sndload folder + "atk_chaos.wav", 114
	sndload folder + "atk_dark.wav", 115
	sndload folder + "curse2.wav", 116
	sndload folder + "curse3.wav", 117
	sndload folder + "enc.wav", 118
	sndload folder + "enc2.wav", 119
	sndload folder + "pray2.wav", 120
	sndload folder + "offer2.wav", 121
	isyoungersistervoice = 0
	exist folder + "oniichan_01.wav"
	if (strsize != (-1)) {
		sndload folder + "oniichan_01.wav", 150
		sndload folder + "oneechan_01.wav", 151
		sndload folder + "auchi.wav", 152
		sndload folder + "hidoi.wav", 153
		sndload folder + "yatta.wav", 154
		sndload folder + "nandeyanen.wav", 155
		isyoungersistervoice = 1
	}
	sndload folder + "arart.wav", 200
	repeat length(exsoundlist)
		s = folder + exsoundlist(cnt) + "0.wav"
		exist s
		if (strsize != (-1)) {
			sndload s, 122 + cnt
		}
	loop
	return
*label_0121
	s = exedir + "user\\music\\musiclist.txt"
	exist s
	if (strsize == (-1)) {
		return
	}
	notesel buff
	noteload s
	repeat noteinfo(0)
		noteget s, cnt
		if (s == "") {
			continue
		}
		musicfile(cnt + 50) = strmid(s, 0, instr(s, 0, "\t"))
	loop
	return
*label_0122
	oomSEST_log "Music"
	env = 0
	if (gWeather == 3) {
		env = 75
	}
	if (gWeather == 4) {
		env = 76
	}
	if (gWeather == 1) {
		env = 77
	}
	if (env != envwprev) {
		envwprev = env
		if (cfg_sound == 1) {
			if (env == 0) {
				DSSTOP 7 + 6
				DSRELEASE 7 + 6
			} else {
				snd env, 1
			}
		}
	}
	if (mapIndoorOrOutdoor == 2) {
		DSSETVOLUME 7 + 6, cfg_svolume * 8 / 10
	} else {
		if (gCurrentDungeonLevel == 1 | gCurrentMap == 30) {
			DSSETVOLUME 7 + 6, cfg_svolume * 2 / 10
		} else {
			DSSETVOLUME 7 + 6, 0
		}
	}
	if (gCurrentMap == 11 | gCurrentMap == areaId_serria | gCurrentMap == areaId_tormat) {
		snd 78, 1
	} else {
		DSSTOP 7 + 6 + 1
		DSRELEASE 7 + 6 + 1
	}
	if (gCurrentMap == 5 & gCurrentDungeonLevel == 1) {
		snd 79, 1
	} else {
		DSSTOP 7 + 6 + 2
		DSRELEASE 7 + 6 + 2
	}
	if (mapCampfireExists == 1) {
		snd 80, 1
	} else {
		DSSTOP 7 + 6 + 3
		DSRELEASE 7 + 6 + 3
	}
	if (envonly == 1) {
		envonly = 0
		return
	}
	if (cfg_music == 0) {
		return
	}
	if (usermusic) {
		return
	}
	if (music == 0) {
		if (areaType(gCurrentMap) == 4) {
			music = musicprev
		}
		if (areaType(gCurrentMap) == 3) {
			music = 51
		}
		if (areaType(gCurrentMap) == 5) {
			music = 67
		}
		if (areaType(gCurrentMap) >= 20) {
			music = 55 + gHour \ 6
		}
		if (mapBgm != 0) {
			music = mapBgm
		}
		if (areaId(gCurrentMap) == 8) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				if (areaHasBeenConquered(gCurrentMap) != (-1)) {
					music = 62
				}
			}
		}
		if (areaId(gCurrentMap) == 3 & gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (npcmemory(0, 2) == 0) {
				music = 66
			} else {
				music = 69
			}
		}
		if (areaId(gCurrentMap) == 16 & gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (npcmemory(0, 144) == 0 & npcmemory(0, 145) == 0) {
				music = 66
			}
		}
		if (areaId(gCurrentMap) == 17 & gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (npcmemory(0, 141) == 0) {
				music = 66
			}
		}
		if (areaId(gCurrentMap) == 18 & gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (npcmemory(0, 143) == 0) {
				music = 66
			}
		}
		if (gCurrentMap == 13) {
			if (gExecutingImmediateQuestType == 1001) {
				music = 76
			}
			if (gExecutingImmediateQuestType == 1006) {
				music = 75
			}
			if (gExecutingImmediateQuestType == 1009) {
				music = 77
			}
			if (gExecutingImmediateQuestType == 1008) {
				music = 62
			}
			if (gExecutingImmediateQuestType == 1010) {
				music = 73
			}
			if (gExecutingImmediateQuestType == 1020) {
				music = 77
			}
			if (gExecutingImmediateQuestType == 1021) {
				music = 62
			}
		}
		if (gCurrentMap == 6) {
			music = 73
		}
		if (gCurrentMap == 25) {
			music = 75
		}
		if (gCurrentMap == 11) {
			music = 52
		}
		if (gCurrentMap == 36) {
			music = 52
		}
		if (gCurrentMap == 12) {
			music = 75
		}
		if (gCurrentMap == 14) {
			music = 53
		}
		if (gCurrentMap == 15) {
			music = 54
		}
		if (gCurrentMap == 21) {
			music = 83
		}
		if (gCurrentMap == 33) {
			music = 85
		}
		// Towns in South Tyris
		if (gCurrentMap == areaId_serria) {
			music = musicId_serria
		}
		if (gCurrentMap == areaId_tormat) {
			music = musicId_tormat
		}
		if (gCurrentMap == areaId_khios) {
			music = musicId_khios
		}
		if (gCurrentMap == areaId_carlia) {
			music = musicId_carlia
		}
		if (gCurrentMap == areaId_trian) {
			music = musicId_trian
		}
		if (gCurrentMap == 200) {
			music = 94
		}
	}
	if ((music == 0 | areaType(gCurrentMap) == 1) & music != 91) {
		music = 86 + gDay \ 3
	}
	if (musicloop == 1) {
		musicloop = 0
	} else {
		musicloop = 65535
	}
	if (musicprev != music) {
		musicprev = music
		mmstop
		if (cfg_music == 1) {
			DMSTOP
			DMLOADFNAME exedir + "sound\\gm_on.mid", 0
			DMPLAY 1, 0
		}
		if (cfg_music == 3) {
			cmd_0_5
		}
		if (music != (-1)) {
			musicfolder = exedir + "user\\music\\"
			exist musicfolder + musicfile(music)
			if (strsize == (-1)) {
				musicfolder = exedir + "sound\\"
				exist musicfolder + musicfile(music)
				if (strsize == (-1)) {
					return
				}
			}
			if (instr(musicfile(music), 0, ".mp3") != (-1)) {
				mp3 = 1
			} else {
				mp3 = 0
			}
		}
		if (music != (-1)) {
			if (cfg_music == 2 | mp3 == 1) {
				mmload musicfolder + musicfile(music), 0, musicloop == 65535
				mmplay 0
			} else {
				if (cfg_music == 1) {
					DMLOADFNAME musicfolder + musicfile(music), 0
					DMPLAY musicloop, 0
				} else {
					if (cfg_music == 3) {
						cmd_0_9 cfg_sndvolume
						cmd_0_13 musicfolder + musicfile(music), 0, 0
						if (musicloop == 0) {
							cmd_0_4 2, 0
						} else {
							cmd_0_4 1 | 2, 0
						}
					}
				}
			}
		}
	}
	music = 0
	musicloop = 0
	return



#include "key.hsp"



#deffunc bmes str __rrr, int __sss, int __ttt, int __uuu
	pos_x@m21 = ginfo(22)
	pos_y@m21 = ginfo(23)
	mes_color@m21 = __sss, __ttt, __uuu
	if (cfg_fontstyle == 0) {
		repeat 3
			mes_y@m21 = cnt + pos_y@m21 - 1
			repeat 3
				pos pos_x@m21 - 1 + cnt, mes_y@m21
				mes __rrr
			loop
		loop
	} else {
		pos pos_x@m21 - 1, pos_y@m21
		mes __rrr
		pos pos_x@m21 + 1, pos_y@m21
		mes __rrr
		pos pos_x@m21, pos_y@m21 - 1
		mes __rrr
		pos pos_x@m21, pos_y@m21 + 1
		mes __rrr
	}
	color mes_color@m21(0), mes_color@m21(1), mes_color@m21(2)
	pos pos_x@m21, pos_y@m21
	mes __rrr
	return



#deffunc talk_conv var __vvv, int __www
	n@txtfunc = 0
	if (jp) {
		msgtemp@txtfunc = __vvv
		__vvv = ""
		if (cfg_putgrass == 1) {
			sreplace msgtemp@txtfunc, msgtemp@txtfunc, "…", "ｗｗｗ"
		}
		if (cfg_putgrass == 2) {
			sreplace msgtemp@txtfunc, msgtemp@txtfunc, "…", "ｗｗｗｗｗｗ"
			sreplace msgtemp@txtfunc, msgtemp@txtfunc, "、", "ｗｗｗ"
			sreplace msgtemp@txtfunc, msgtemp@txtfunc, "。", "ｗｗｗ"
			sreplace msgtemp@txtfunc, msgtemp@txtfunc, "！", "ｗｗｗ！"
			sreplace msgtemp@txtfunc, msgtemp@txtfunc, "？", "ｗｗｗ？"
		}
		repeat 100
			len@txtfunc = strlen(msgtemp@txtfunc)
			p2@txtfunc = 0
			if (len@txtfunc < __www) {
				break
			}
			repeat len@txtfunc
				p@txtfunc = peek(msgtemp@txtfunc, p2@txtfunc)
				if (p2@txtfunc > len@txtfunc) {
					break
				}
				if (p@txtfunc >= 129 & p@txtfunc <= 159 | p@txtfunc >= 224 & p@txtfunc <= 252) {
					p@txtfunc = 2
				} else {
					p@txtfunc = 1
				}
				p2@txtfunc += p@txtfunc
				if (p2@txtfunc > __www) {
					m@txtfunc = strmid(msgtemp@txtfunc, p2@txtfunc, 2)
					if (m@txtfunc != "。" & m@txtfunc != "、" & m@txtfunc != "」" & m@txtfunc != "』" & m@txtfunc != "！" & m@txtfunc != "？" & m@txtfunc != "…" & m@txtfunc != "♪") {
					} else {
						p2@txtfunc += 2
					}
					__vvv += strmid(msgtemp@txtfunc, 0, p2@txtfunc) + "\n"
					n@txtfunc++
					msgtemp@txtfunc = strmid(msgtemp@txtfunc, p2@txtfunc, len@txtfunc - p2@txtfunc)
					break
				}
			loop
		loop
		__vvv += msgtemp@txtfunc
	} else {
		msgtemp@txtfunc = __vvv
		__vvv = ""
		repeat 1000
			len@txtfunc = 0
			repeat 1000
				p@txtfunc = instr(msgtemp@txtfunc, 0, " ") + 1
				if (p@txtfunc == 0) {
					break
				}
				if (len@txtfunc + p@txtfunc > __www) {
					__vvv += "\n"
					n@txtfunc++
					break
				}
				__vvv += strmid(msgtemp@txtfunc, 0, p@txtfunc)
				len@txtfunc += p@txtfunc
				msgtemp@txtfunc = strmid(msgtemp@txtfunc, p@txtfunc, strlen(msgtemp@txtfunc) - p@txtfunc)
			loop
			if (p@txtfunc == 0) {
				break
			}
		loop
		__vvv += msgtemp@txtfunc
	}
	return n@txtfunc



#deffunc msg_write var __xxx
	if (cfg_nolog == 0 & nolog == 0) {
		repeat 1
			mp@txtfunc = instr(__xxx, 0, "♪")
			if (mp@txtfunc != (-1)) {
				mark@txtfunc = int(strmid(__xxx, mp@txtfunc + 2, 1))
				if (jp) {
					if (mark@txtfunc == 0) {
						break
					}
				}
				__xxx = strmid(__xxx, 0, mp@txtfunc) + "  " + strmid(__xxx, mp@txtfunc + 2 + (mark@txtfunc != 0), 9999)
				pos (msglen + mp@txtfunc) * inf_mesfont / 2 + inf_msgx + 7 + en * 3, (inf_msgline - 1) * inf_msgspace + inf_msgy + 5
				gmode 2
				gcopy 3, 600 + mark@txtfunc * 24, 360, 16, 16
				continue cnt
			}
		loop
		color tcol@txtfunc(0), tcol@txtfunc(1), tcol@txtfunc(2)
		pos msglen * inf_mesfont / 2 + inf_msgx + 6, (inf_msgline - 1) * inf_msgspace + inf_msgy + 6
		font lang(cfg_font1, cfg_font2), inf_mesfont - en * 2, 0
		mes __xxx
	}
	return



#deffunc txtcontinue
	tcontinue@txtfunc = 1
	return



#deffunc anime_halt
	key = ""
	objprm 0, ""
	keylog = ""
	redraw 0
	gmode 0
	gsel 3
	pos 672, 504
	gcopy 0, x@txtfunc, y@txtfunc, 120, 24
	gsel 0
	repeat 12
		redraw 0
		await 10
		pos x@txtfunc, y@txtfunc + 12 - cnt
		gzoom 120, cnt * 2 + 1, 3, 552, 504, 120, 22
		redraw 1
	loop
	press 1
	snd 20
	repeat 7
		redraw 0
		await 10
		pos x@txtfunc, y@txtfunc
		gcopy 3, 672, 504, 120, 24
		if (cnt != 6) {
			pos x@txtfunc, y@txtfunc + cnt * 2
			gzoom 120, 22 - cnt * 4, 3, 552, 504, 120, 22
		}
		redraw 1
	loop
	redraw 0
	gmode 2
	return



#deffunc msg_halt
	x@txtfunc = windoww - 120
	y@txtfunc = windowh - 22
	anime_halt
	screenupdate = -1
	gosub *label_0623
	return



#deffunc help_halt
	x@txtfunc = wx + dx - 140
	y@txtfunc = wy + dy - 1
	anime_halt
	return



#deffunc txtef int __yyy
	tcol@txtfunc = 255 - c_col(0, __yyy), 255 - c_col(1, __yyy), 255 - c_col(2, __yyy)
	if (__yyy == 5) {
		tcolfix@txtfunc = 1
	} else {
		tcolfix@txtfunc = 0
	}
	return



#deffunc msg_newlog
	if (cfg_exlog == 0) {
		return
	}
	gsel 8
	gmode 0
	pos 0, msgline \ inf_maxlog * inf_msgspace
	gcopy 0, inf_msgx, inf_msgy + 5 + inf_msgspace * 3 + en * 3, windoww - inf_msgx, inf_msgspace
	gsel 0
	return



#deffunc msg_newline
	msg_newlog
	msglen = 0
	msgline++
	if (msgline >= inf_maxlog) {
		msgline -= inf_maxlog
	}
	msg(msgline \ inf_maxlog) = ""
	p@txtfunc = (windoww - inf_msgx) / 192
	redraw 0
	gmode 0
	pos inf_msgx, inf_msgy + 5
	gcopy 0, inf_msgx, inf_msgy + 5 + inf_msgspace, windoww - inf_msgx, inf_msgspace * 3 + en * 3
	repeat p@txtfunc + 1
		if (cnt == p@txtfunc) {
			x@txtfunc = (windoww - inf_msgx) \ 192
		} else {
			x@txtfunc = 192
		}
		pos cnt * 192 + inf_msgx, inf_msgy + 5 + inf_msgspace * 3 + en * 2
		gcopy 3, 496, 536 + msgline \ 4 * inf_msgspace, x@txtfunc, inf_msgspace
	loop
	gmode 2
	msgtempprev = ""
	return



#deffunc txtnew
	if (tnew == 0) {
		if (strlen(msg(msgline \ inf_maxlog)) > 4) {
			msg_newline
			msglen = 2
		}
	}
	return



#deffunc msg_clear
	msg_len = 0
	msgtemp = ""
	repeat 3
		msg_newline
	loop
	return



#deffunc txt_conv
	redraw 0
	sstptalkc0 = sstptalkc
	sstptalkn0 = sstptalkn
	sstptalkc = 0
	sstptalkn = ""
	if (msgtemp == "") {
		return
	}
	if (oom_talkchara != (-1)) {
		if (isstorned(oom_talkchara)) {
			return
		}
	}
	if (sstptalkc0 != 0) {
		parsesstptalk msgtemp, sstptalk, 1
		if (cfg_NC_sstp_enabled != 0 & (cfg_NC_sstp_sakura == sstptalkc0 | cfg_NC_sstp_unyu == sstptalkc0)) {
			throwsstptalk sstptalkn0, sstptalk, sstptalkc0
			if (cfg_NC_sstp_suppresslog != 0) {
				return
			}
		}
	}
	if (tcopy) {
		tcopy = 0
		txtcopy = "" + msgtemp
	}
	if (tnew == 1) {
		if (msg(msgline \ inf_maxlog) != "") {
			msg_newline
			tnew = 0
			if (cfg_msgtrans) {
				p@txtfunc = (windoww - inf_msgx) / 192
				redraw 0
				gmode 4, , , cfg_msgtrans * 20
				repeat p@txtfunc + 1
					if (cnt == p@txtfunc) {
						x@txtfunc = (windoww - inf_msgx) \ 192
					} else {
						x@txtfunc = 192
					}
					pos cnt * 192 + inf_msgx, inf_msgy + 5
					gcopy 3, 496, 536, x@txtfunc, inf_msgspace * 3
				loop
			}
			if (cfg_msgaddtime) {
				msgtemp = "[" + gMinute + "] " + msgtemp
			} else {
				msglen = 2
			}
		}
	}
	if (msgdup != 0) {
		if (msgtempprev == msgtemp) {
			return
		}
		msgtempprev = msgtemp
		msgdup = 0
	}
	if (jp) {
		if (instr(msgtemp, 0, "「") != (-1) & instr(msgtemp, 0, "」") != (-1)) {
			if (tcolfix@txtfunc == 0) {
				tcol@txtfunc = 210, 250, 160
			} else {
				tcolfix@txtfunc = 0
			}
			misakuraconvert msgtemp, 1
		}
		if (cfg_putgrass == 1) {
			sreplace msgtemp, msgtemp, "…", "ｗｗｗ"
		}
		if (cfg_putgrass == 2) {
			sreplace msgtemp, msgtemp, "…", "ｗｗｗｗｗｗ"
			sreplace msgtemp, msgtemp, "、", "ｗｗｗ"
			sreplace msgtemp, msgtemp, "。", "ｗｗｗ"
			sreplace msgtemp, msgtemp, "！", "ｗｗｗ！"
			sreplace msgtemp, msgtemp, "？", "ｗｗｗ？"
		}
		if (cc@txtfunc >= 0) {
			if (synccheck(cc@txtfunc, -1)) {
				sstptalkc = instr(msgtemp, 0, "「") + 2
				if (sstptalkc < 2) {
					sstptalkc = 0
				}
				p2@txtfunc = instr(msgtemp, sstptalkc, "」")
				if (sstptalkc > 1 & p2@txtfunc != (-1)) {
					repeat
						if (instr(msgtemp, sstptalkc + p2@txtfunc + 2, "」") == (-1)) {
							break
						} else {
							p2@txtfunc += instr(msgtemp, sstptalkc + p2@txtfunc + 2, "」") + 2
						}
					loop
					getstr sstptalkn, msgtemp, sstptalkc, , p2@txtfunc
				} else {
					if (instr(msgtemp, 0, "♪") != (-1) | instr(msgtemp, 0, "*") != (-1)) {
						sstptalkc = 1
					}
					if (cfg_msgaddtime) {
						sstptalkn = strmid(msgtemp, instr(msgtemp, 0, "]") + 1, 200)
					} else {
						sstptalkn = msgtemp
					}
				}
				sreplace sstptalkn, sstptalkn, "♪1", "♪"
			}
		}
		if (oom_talkchara != (-1) & f@m116 != 5) {
			if (cfg_txtpop > 0 | ocdata(164, oom_talkchara) > 0) {
				if (oom_popup(1) == 1) {
					tmpcolor@00m = 0, 0, 0
					tmpbgcolor@00m = 255, 255, 255
					tmpfont@00m = 0, cfg_txtpopfont, 0
					if (gdatac(20) == 1) {
						split8bit gdatac(21), tmpcolor@00m
						split8bit gdatac(22), tmpbgcolor@00m
						split8bit gdatac(23), tmpfont@00m
					}
					if (ocdata(163, oom_talkchara) == 1) {
						split8bit ocdata(167, oom_talkchara), tmpcolor@00m
						split8bit ocdata(168, oom_talkchara), tmpbgcolor@00m
						split8bit ocdata(169, oom_talkchara), tmpfont@00m
					}
					bgcolor = tmpbgcolor@00m(0), tmpbgcolor@00m(1), tmpbgcolor@00m(2)
					if (oom_popup(0) == 0) {
						oom_msgtemp = msgtemp
					} else {
						oom_msgtemp = ""
						repeat oom_popup(0) + 1
							oom_msgtemp += splitbuff(cnt)
						loop
					}
					if (instr(oom_msgtemp, 0, "「") != (-1) & instr(oom_msgtemp, 0, "」") != (-1)) {
						buffer 200 + txtpopupcnt, 800, 600
						font fontlist@00m(tmpfont@00m(0)), 2 + tmpfont@00m(1) - en * 2, tmpfont@00m(2)
						brex_match "m/「.+(?=」)/", oom_msgtemp, 0, oom_idx, oom_len
						poptemp = strmid(oom_msgtemp, oom_idx, oom_len)
						strrep poptemp, "♪1", "♪"
						poptemp = strmid(poptemp, 2, 1000)
						autoinsertlf poptemp, txtpopupn, 48 * 5
						dim oom_txtsize, 2
						getstrrect hdc, txtpopupn, oom_txtsize
						width (oom_txtsize(0) + 10) * 3, oom_txtsize(1) + 20
						color 255, 0, 255
						boxf
						repeat 3
							color tmpcolor@00m(0), tmpcolor@00m(1), tmpcolor@00m(2)
							fukidashi (oom_txtsize(0) + 10) * cnt, 0, oom_txtsize(0) + 10, oom_txtsize(1) + 10, 5, cnt + 1, bgcolor
							pos 5 + (oom_txtsize(0) + 10) * cnt, 5
							mes txtpopupn
						loop
						txtpopup(0, txtpopupcnt) = timeGetTime(), oom_talkchara, oom_txtsize(0) + 10, oom_txtsize(1) + 20
						txtpopupcnt = (txtpopupcnt + 1) \ length2(txtpopup)
						gsel 0
					}
				}
			}
		}
		repeat
			len@txtfunc = strlen(msgtemp)
			if (msglen + 4 > inf_maxmsglen) {
				if (msgtemp != "") {
					msg_newline
				}
			}
			if (msglen + len@txtfunc > inf_maxmsglen) {
				p2@txtfunc = 0
				repeat
					p@txtfunc = peek(msgtemp, p2@txtfunc)
					p2@txtfunc++
					if (p@txtfunc > 128 & p@txtfunc < 160) {
						p2@txtfunc++
					}
					if (p@txtfunc > 223 & p@txtfunc < 253) {
						p2@txtfunc++
					}
					if (p2@txtfunc + msglen > inf_maxmsglen) {
						if (p2@txtfunc > 1) {
							if (strmid(msgtemp, p2@txtfunc - 2, 3) == "♪1") {
								p2@txtfunc++
								break
							}
						}
						if (p2@txtfunc + msglen > inf_maxmsglen + 2) {
							break
						}
						m@txtfunc = strmid(msgtemp, p2@txtfunc, 2)
						if (m@txtfunc != "。" & m@txtfunc != "、" & m@txtfunc != "」" & m@txtfunc != "』" & m@txtfunc != "！" & m@txtfunc != "？" & m@txtfunc != "…" & m@txtfunc != "♪") {
							break
						}
					}
				loop
				m@txtfunc = strmid(msgtemp, 0, p2@txtfunc)
				msg(msgline \ inf_maxlog) += m@txtfunc
				msg_write m@txtfunc
				msgtemp = strmid(msgtemp, p2@txtfunc, len@txtfunc - p2@txtfunc)
				if (msgtemp == "" | msgtemp == " ") {
					break
				}
				msg_newline
				continue
			}
			break
		loop
		msg(msgline \ inf_maxlog) += msgtemp
		msg_write msgtemp
		msglen += len@txtfunc
	} else {
		if (tcontinue@txtfunc == 0) {
			b@txtfunc = peek(msgtemp, 0)
			sstptalkc = 0
			if (instr(msgtemp, 0, "*") != (-1)) {
				sstptalkc = 1
			}
			if (instr(msgtemp, 0, "\"") != (-1)) {
				sstptalkc = 2
				if (tcolfix@txtfunc == 0) {
					tcol@txtfunc = 210, 250, 160
				} else {
					tcolfix@txtfunc = 0
				}
			}
			if (b@txtfunc >= 97 & b@txtfunc <= 122) {
				poke msgtemp, 0, b@txtfunc - 32
			}
		} else {
			tcontinue@txtfunc = 0
		}
		if (cfg_msgaddtime) {
			sstptalkn = strmid(msgtemp, instr(msgtemp, 0, "]") + 1, 200)
		} else {
			sstptalkn = msgtemp
		}
		if (sstptalkc == 2) {
			sreplace sstptalkn, sstptalkn, "\"", ""
		}
		msgtemp += " "
		if (oom_talkchara != (-1) & f@m116 != 5) {
			if (cfg_txtpop > 0 | ocdata(164, oom_talkchara) > 0) {
				if (oom_popup(1) == 1) {
					tmpcolor@00m = 0, 0, 0
					tmpbgcolor@00m = 255, 255, 255
					tmpfont@00m = 0, cfg_txtpopfont, 0
					if (gdatac(20) == 1) {
						split8bit gdatac(21), tmpcolor@00m
						split8bit gdatac(22), tmpbgcolor@00m
						split8bit gdatac(23), tmpfont@00m
					}
					if (ocdata(163, oom_talkchara) == 1) {
						split8bit ocdata(167, oom_talkchara), tmpcolor@00m
						split8bit ocdata(168, oom_talkchara), tmpbgcolor@00m
						split8bit ocdata(169, oom_talkchara), tmpfont@00m
					}
					bgcolor = tmpbgcolor@00m(0), tmpbgcolor@00m(1), tmpbgcolor@00m(2)
					if (oom_popup(0) == 0) {
						oom_msgtemp = msgtemp
					} else {
						oom_msgtemp = ""
						repeat oom_popup(0) + 1
							oom_msgtemp += splitbuff(cnt)
						loop
					}
					if (instr(oom_msgtemp, 0, "\"") != (-1) & instr(oom_msgtemp, 0, "\"") != (-1)) {
						buffer 200 + txtpopupcnt, 800, 600
						font fontlist@00m(tmpfont@00m(0)), 2 + tmpfont@00m(1) - en * 2, tmpfont@00m(2)
						brex_match "m/\".+(?=\")/", oom_msgtemp, 0, oom_idx, oom_len
						poptemp = strmid(oom_msgtemp, oom_idx, oom_len)
						strrep poptemp, "♪1", "!"
						poptemp = strmid(poptemp, 1, 1000)
						autoinsertlf poptemp, txtpopupn, 48 * 5
						dim oom_txtsize, 2
						getstrrect hdc, txtpopupn, oom_txtsize
						width (oom_txtsize(0) + 10) * 3, oom_txtsize(1) + 20
						color 255, 0, 255
						boxf
						repeat 3
							color tmpcolor@00m(0), tmpcolor@00m(1), tmpcolor@00m(2)
							fukidashi (oom_txtsize(0) + 10) * cnt, 0, oom_txtsize(0) + 10, oom_txtsize(1) + 10, 5, cnt + 1, bgcolor
							pos 5 + (oom_txtsize(0) + 10) * cnt, 5
							mes txtpopupn
						loop
						txtpopup(0, txtpopupcnt) = timeGetTime(), oom_talkchara, oom_txtsize(0) + 10, oom_txtsize(1) + 20
						txtpopupcnt = (txtpopupcnt + 1) \ length2(txtpopup)
						gsel 0
					}
				}
			}
		}
		repeat
			await
			p@txtfunc = instr(msgtemp, 0, " ") + 1
			if (p@txtfunc == 0) {
				break
			}
			if (msglen + p@txtfunc > inf_maxmsglen) {
				msg_newline
				continue
			}
			mst@txtfunc = strmid(msgtemp, 0, p@txtfunc)
			msg(msgline \ inf_maxlog) += mst@txtfunc
			msg_write mst@txtfunc
			msglen += p@txtfunc
			msgtemp = strmid(msgtemp, p@txtfunc, strlen(msgtemp) - p@txtfunc)
		loop
		msg(msgline \ inf_maxlog) += msgtemp
		msg_write msgtemp
		msglen += strlen(msgtemp)
	}
	return



#defcfunc name int __zzz
	if (__zzz == 0) {
		return lang("あなた", "you")
	}
	if (synccheck(__zzz, -1) == 0 & petcheck(__zzz) == 0) {
		return lang("何か", "something")
	}
	if (cBlind(0) != 0 | (cbit(6, __zzz) == 1 & cbit(7, 0) == 0 & cWet(__zzz) == 0)) {
		return lang("何か", "something")
	}
	if (en) {
		s@m23 = strmid(cdatan(0, __zzz), 0, 1)
		if (s@m23 == "\"" | s@m23 == "<") {
			return cdatan(0, __zzz)
		}
		if (cbit(977, __zzz) == 0) {
			return "the " + cdatan(0, __zzz)
		}
	}
	return cdatan(0, __zzz)



#defcfunc name2 int __cc
	if (__cc == 0) {
		return lang("あなた", "you")
	}
	if (en) {
		s@m23 = strmid(cdatan(0, __cc), 0, 1)
		if (s@m23 == "\"" | s@m23 == "<") {
			return cdatan(0, __cc)
		}
		if (cbit(977, __cc) == 0) {
			return "the " + cdatan(0, __cc)
		}
	}
	return cdatan(0, __cc)



#defcfunc aln int __aaa
	if (__aaa == 0) {
		return ""
	}
	if (synccheck(__aaa, -1) == 0) {
		return "それは"
	}
	return "" + cdatan(0, __aaa) + "は"



#defcfunc npcn int __bbb
	if (__bbb == 0) {
		return ""
	}
	if (synccheck(__bbb, -1) == 0) {
		return "それは"
	}
	return "" + cdatan(0, __bbb) + "は"



#defcfunc _s int __ccc, int __ddd
	if (__ccc < 0 | __ccc >= 245) {
		if (__ddd) {
			return "es"
		} else {
			return "s"
		}
	}
	if (__ccc == 0) {
		return ""
	}
	if (__ddd) {
		return "es"
	} else {
		return "s"
	}



#defcfunc _s2 int __eee
	if (__eee > 1) {
		return ""
	} else {
		return "s"
	}



#defcfunc is2 int __fff
	if (__fff > 1) {
		return "are"
	} else {
		return "is"
	}



#defcfunc is int __ggg
	if (__ggg < 0 | __ggg >= 245) {
		return "is"
	}
	if (__ggg == 0) {
		return "are"
	}
	return "is"



#defcfunc was int __hhh
	if (__hhh < 0 | __hhh >= 245) {
		return "was"
	}
	if (__hhh == 0) {
		return "were"
	}
	return "was"



#defcfunc have int __iii
	if (__iii < 0 | __iii >= 245) {
		return "has"
	}
	if (__iii == 0) {
		return "have"
	}
	return "has"



#defcfunc does int __jjj
	if (__jjj == 1) {
		return "do"
	} else {
		return "does"
	}



#defcfunc he int __kkk, int __lll
	if (__lll) {
		if (jp) {
			if (cSex(__kkk) == 0) {
				return "彼"
			} else {
				return "彼女"
			}
		}
		if (cSex(__kkk) == 0) {
			return "he"
		} else {
			return "she"
		}
	}
	if (__kkk < 0 | __kkk >= 245) {
		return "it"
	}
	if (synccheck(__kkk, -1) == 0) {
		return "it"
	}
	if (__kkk == 0) {
		return "you"
	}
	if (cSex(__kkk) == 0) {
		return "he"
	}
	return "she"



#defcfunc his int __mmm, int __nnn
	if (__nnn) {
		if (jp) {
			if (__mmm == 0) {
				return "あなたの"
			} else {
				if (cSex(__mmm) == 0) {
					return "彼の"
				} else {
					return "彼女の"
				}
			}
		}
		if (__mmm == 0) {
			return "your"
		} else {
			if (cSex(__mmm) == 0) {
				return "his"
			} else {
				return "her"
			}
		}
	}
	if (__mmm < 0 | __mmm >= 245) {
		return "its"
	}
	if (synccheck(__mmm, -1) == 0) {
		return "its"
	}
	if (__mmm == 0) {
		return "your"
	}
	if (cSex(__mmm) == 0) {
		return "his"
	}
	return "her"



#defcfunc him int __ooo, int __ppp
	if (__ppp) {
		if (jp) {
			if (cSex(__ooo) == 0) {
				return "彼"
			} else {
				return "彼女"
			}
		}
		if (cSex(__ooo) == 0) {
			return "him"
		} else {
			return "her"
		}
	}
	if (__ooo < 0 | __ooo >= 245) {
		return "it"
	}
	if (synccheck(__ooo, -1) == 0) {
		return "it"
	}
	if (__ooo == 0) {
		return "yourself"
	}
	if (cSex(__ooo) == 0) {
		return "him"
	}
	return "her"



#defcfunc your int __qqq, int
	if (__qqq < 0 | __qqq >= 245) {
		return "'s"
	}
	if (__qqq == 0) {
		return "r"
	}
	return "'s"



#defcfunc yourself int __sss
	if (__sss < 0 | __sss >= 245) {
		return "itself"
	}
	if (synccheck(__sss, -1) == 0) {
		return "itself"
	}
	if (__sss == 0) {
		return "yourself"
	}
	if (cSex(__sss) == 0) {
		return "himself"
	}
	return "herself"
*label_0158



#deffunc txt_select int __ttt, str __uuu, str __vvv, str __www, str __xxx, str __yyy, str __zzz, str __aaa, str __bbb, str __ccc
	cc@txtfunc = __ttt
	if (cfg_nolog == 0 & nolog == 0 & item_count == 0) {
		if (hear != 0) {
			snd hear
			hear = 0
		}
		txtc = 1 + (__vvv != "") + (__www != "") + (__xxx != "") + (__yyy != "") + (__zzz != "") + (__aaa != "") + (__bbb != "") + (__ccc != "")
		txtc = rnd(txtc)
		oom_talkchara = __ttt
		if (txtc == 0) {
			msgtemp = __uuu
			txt_conv
		} else {
			if (txtc == 1) {
				msgtemp = __vvv
				txt_conv
			} else {
				if (txtc == 2) {
					msgtemp = __www
					txt_conv
				} else {
					if (txtc == 3) {
						msgtemp = __xxx
						txt_conv
					} else {
						if (txtc == 4) {
							msgtemp = __yyy
							txt_conv
						} else {
							if (txtc == 5) {
								msgtemp = __zzz
								txt_conv
							} else {
								if (txtc == 6) {
									msgtemp = __aaa
									txt_conv
								} else {
									if (txtc == 7) {
										msgtemp = __bbb
										txt_conv
									} else {
										msgtemp = __ccc
										txt_conv
									}
								}
							}
						}
					}
				}
			}
		}
		tcol@txtfunc = 255, 255, 255
		tcolfix@txtfunc = 0
	}
	return



#defcfunc cnvfix int __ddd
	if (__ddd >= 0) {
		return "+" + __ddd
	} else {
		return "" + __ddd
	}
	goto *label_0167



#deffunc stxt int __eee, str __fff
	if (__eee == 0 | (synccheck(__eee, -1) & cBlind(0) == 0)) {
		txt -1, __fff
	}
	return



#defcfunc cnvdate int __ggg, int __hhh
	p@m27 = __ggg
	hour@m27 = __ggg \ 24
	day@m27 = __ggg / 24 \ 30
	if (day@m27 == 0) {
		day@m27 = 30
		p@m27 -= 24 * 30
	}
	month@m27 = p@m27 / 24 / 30 \ 12
	if (month@m27 == 0) {
		month@m27 = 12
		p@m27 -= 24 * 30 * 12
	}
	year@m27 = p@m27 / 24 / 30 / 12
	if (jp) {
		s@m27 = "" + year@m27 + "年" + month@m27 + "月" + day@m27 + "日"
		if (__hhh == 1) {
			s@m27 += "" + hour@m27 + "時"
		}
	} else {
		s@m27 = "" + year@m27 + " " + month@m27 + "/" + day@m27 + " "
		if (__hhh == 1) {
			s@m27 += "" + hour@m27 + "h"
		}
	}
	return s@m27



#defcfunc cnvplaytime int __iii
	return "" + __iii / 60 / 60 + lang("時間", ":") + __iii / 60 \ 60 + lang("分", ":") + __iii \ 60 + lang("秒", " Sec")



#defcfunc roundmargin int __jjj, int __kkk
	if (__jjj > __kkk) {
		return __jjj - rnd(__jjj - __kkk)
	}
	if (__jjj < __kkk) {
		return __jjj + rnd(__kkk - __jjj)
	}
	return __jjj
*label_0167



#deffunc at int __lll
	if (cc == 0) {
		autoturn = 1
		if (cfg_autoturn == 0) {
			await __lll
			if (gLeftTurnsOfTimestop == 0) {
				scrturn++
			}
		}
		if (cfg_autoturn != 2 | firstautoturn == 1) {
			screenupdate = -1
			gosub *label_0623
		}
		if (cfg_autoturn == 0) {
			redraw 1
		}
	}
	return



#deffunc text_set
	sdim bodyn, 4, 15
	_impression = lang("天敵", "Foe"), lang("嫌い", "Hate"), lang("うざい", "Annoying"), lang("普通", "Normal"), lang("好意的", "Amiable"), lang("友達", "Friend"), lang("親友", "Fellow"), lang("魂の友", "Soul Mate"), lang("*Love*", " *Love*")
	if (jp) {
		_weather = "", "*エーテル*", "雪", "雨", "雷雨"
	} else {
		_weather = "", "Etherwind", "Snow", "Rain", "Hard rain"
	}
	if (jp) {
		_homename = "洞窟", "森のほったて小屋", "住み心地のいい家", "セレブ邸", "サイバーハウス", "小城"
		_furniture = "", "みすぼらしい", "気になる", "いい感じの", "マダム殺しの", "思わず見入りそうな", "マニア向けの", "凄く華麗な", "王家御用達の", "芸術的な", "神々しい", "世界最高の"
		_weight = "超ミニに", "小振りに", "手ごろに", "やや大きく", "どでかく", "かなり巨大に", "化け物サイズに", "人より大きく", "伝説的サイズに", "象より重く"
	} else {
		_homename = "cave", "shack", "cozy house", "estate", "cyber house", "small castle"
		_furniture = "", "stupid", "lame", "cool", "madam's favorite", "bewitched", "maniac", "magnificent", "royal", "masterpiece", "heavenly", "godly"
		_weight = "extremely mini", "small", "handy", "rather big", "huge", "pretty huge", "monstrous-size", "bigger than a man", "legendary-size", "heavier than an elephant"
	}
	sdim _tone, 20, 10
	if (jp) {
		_reward = "", "装備品", "魔道具", "防具", "武器", "補給品"
	} else {
		_reward = "", "equipment", "magical goods", "armor", "weapons", "ores", "furnitures"
	}
	if (jp) {
		_time = "深夜", "夜明け", "朝", "昼", "宵", "夜", "", ""
	} else {
		_time = "Midnight", "Dawn", "Morning", "Noon", "Dusk", "Night", "", ""
	}
	if (jp) {
		_stats = " 力", " 耐", " 器", " 感", " 習", " 意", " 魔", " 魅"
		_stats2 = "筋力", "耐久", "器用", "感覚", "習得", "意思", "魔力", "魅力"
	} else {
		_stats = "STR", "CON", "DEX", "PER", "LER", "WIL", "MAG", "CHR"
		_stats2 = " STR", " CON", " DEX", " PER", " LER", " WIL", " MAG", " CHR"
	}
	if (jp) {
		_hunger = "餓死中", "飢餓", "空腹", "空腹", "空腹", "", "", "", "", "", "満腹", "満腹", "食過ぎ"
		_burden = "", "重荷", "圧迫", "超過", "潰れ中"
		_sleep = "睡眠可", "要睡眠", "要睡眠"
		_consick = "病気", "重病"
		_conpoison = "毒", "猛毒"
		_condim = "朦朧", "混濁", "気絶"
		_conangry = "激怒", "狂乱"
		_conbleed = "切り傷", "出血", "大出血"
		_coninsane = "不安定", "狂気", "崩壊"
		_condrunk = "酔払い"
		_conwet = "濡れ"
		_congravity = "重力"
		_consleep = "睡眠", "爆睡"
		_conblind = "盲目"
		_conparalyze = "麻痺"
		_storned = "石化"
		_conmochi = "窒息"
		_conconfuse = "混乱"
		_confear = "恐怖"
		_confatigue = "軽疲労", "疲労", "過労", "元気"
		_stress = "依存症"
		_aphrodisiac = "催淫"
	} else {
		_hunger = "Starving!", "Starving", "Hungry!", "Hungry", "Hungry", "", "", "", "", "", "Satisfied", "Satisfied!", "Bloated"
		_burden = "", "Burden", "Burden!", "Overweight", "Overweight!"
		_sleep = "Sleepy", "Need Sleep", "Need Sleep!"
		_consick = "Sick", "Very Sick"
		_conpoison = "Poisoned", "Poisoned Bad!"
		_condim = "Dim", "Muddled", "Unconscious"
		_conangry = "Fury", "Berserk"
		_conbleed = "Bleeding", "Bleeding!", "Hemorrhage"
		_coninsane = "Unsteady", "Insane", "Paranoia"
		_condrunk = "Drunk"
		_conwet = "Wet"
		_congravity = "Gravity"
		_consleep = "Sleep", "Deep Sleep"
		_conblind = "Blinded"
		_conparalyze = "Paralyzed"
		_storned = "Storned"
		_conmochi = "Choked"
		_conconfuse = "Confused"
		_confear = "Fear"
		_confatigue = "Tired", "Very tired", "VERY tired", "Spry"
		_stress = "Frustration"
		_aphrodisiac = "Aphrodisiac"
	}
	if (jp) {
		_quality = "", "粗悪", "良質", "高品質", "奇跡", "神器", "特別"
	} else {
		_quality = "", "bad", "good", "great", "miracle", "godly", "special"
	}
	if (jp) {
		_resist = "致命的な弱点", "弱点", "耐性なし", "弱い耐性", "普通の耐性", "強い耐性", "素晴らしい耐性"
	} else {
		_resist = "Critically Weak", "Weak", "No Resist", "Little", "Normal", "Strong", "Superb"
	}
	if (jp) {
		_mark = "。", "？", "！", ""
	} else {
		_mark = ".", "?", "!", ""
	}
	if (jp) {
		_sex = "男", "女"
		_sex2 = "男", "女"
	} else {
		_sex = "Male", "Female"
		_sex2 = "boy", "girl"
	}
	dim _onii2, 14, 2
	dim _onii3, 6, 2
	if (jp) {
		_onii = "お兄", "お姉"
		_nii = "兄", "姉"
		_onii2(0, 0) = "", "お兄ちゃん", "お兄ちゃま", "あにぃ", "お兄様", "おにいたま", "兄上様", "にいさま", "アニキ", "兄くん", "兄君さま", "兄チャマ", "兄や", "兄さん"
		_onii2(0, 1) = "", "お姉ちゃん", "お姉ちゃま", "おねぇ", "お姉様", "おねえたま", "姉上様", "あねさま", "アネキ", "姉くん", "姉君さま", "姉チャマ", "姉や", "姉さん"
		_onii3(0, 0) = "お兄ちゃん！", "お兄ちゃ〜ん", "お兄ちゃんっ", "お兄ちゃん？", "お兄〜ちゃん", "お兄ちゃん♪"
		_onii3(0, 1) = "お姉ちゃん！", "お姉ちゃ〜ん", "お姉ちゃんっ", "お姉ちゃん？", "お姉〜ちゃん", "お姉ちゃん♪"
		_onii4 = "おにーちゃん", "おねーちゃん"
		_syujin = "ご主人様", "お嬢様"
	} else {
		_onii = "onii", "onee"
		_nii = "nii", "nee"
		_onii2(0, 0) = "", "Oniichan", "Oniichama", "Big bro", "Oniisama", "Oniitama", "My dear brother", "Niisama", "Bro", "Older brother", "Dear brother", "Brother", "Elder brother", "Niisan"
		_onii2(0, 1) = "", "Oneechan", "Oneechama", "Big sis", "Oneesama", "Oneetama", "My dear sister", "Neesama", "Sis", "Older sister", "Dear sister", "Sister", "Elder sister", "Neesan"
		_onii3(0, 0) = "Brother!", "Brother~", "Brother", "Brother?", "Bro~ther", "Brother♪"
		_onii3(0, 1) = "Sister!", "Sister~", "Sister", "Sister?", "Sis~ter", "Sister♪"
		_onii4 = "Onii-chan", "Onee-chan"
		_syujin = "my master", "my lady"
	}
	if (jp) {
		strhint1 = "ｶｰｿﾙ [選択]  "
		strhint2 = "" + key_pageup + "," + key_pagedown + " [ページ切替]  "
		strhint3 = "Shift,Esc [閉じる]  "
		strhint3b = "Shift,Esc [戻る]  "
		strhint4 = "決定、"
		strhint5 = "" + key_identify + " [既知の情報]  "
		strhint5b = "" + key_mode + "," + key_msglog + " [情報切替]  "
		strhint6 = "p [ポートレイト変更]  "
		strhint7 = "0〜9 [ショートカット]  "
		oom_strhint1 = "" + key_drink + " [エンチャントフィルタ]  "
		oom_strhint2 = "" + key_search + " [ソート順切替]  "
		oom_strhint3 = "" + key_prev + "," + key_next + " [カテゴリ切替]  "
		oom_strhint4 = "" + key_southwest + "," + key_southeast + " [強度指定]  "
		oom_strhint5 = "" + key_mode2 + " [装備セット保存]  "
		oom_strhint6 = "" + key_msglog + " [装備セット読み込み]  "
		oom_strhint7 = "" + key_drink + " [エンチャント指定自動装備]  "
		oom_strhint8 = "" + key_mode2 + " [継承指定]  " + key_msglog + " [生き武器指定]  "
		oom_strhint9 = "" + key_read + " [アイテムカウント]  "
		oomsest_strhint1 = "" + key_msglog + " [フィルタ]  "
		oomsest_strhint2 = "" + key_mode3 + " [全て置く]  "
		oomsest_strhint3 = "" + key_mode3 + " [全て拾う]  "
		oomsest_strhint4 = "" + key_mode3 + " [すべて購入]  "
		oomsest_strhint5 = "" + key_mode3 + " [すべて売却]  "
		oomsest_strhint6 = "" + key_mode3 + " [アイテムの情報をログに送る]  "
		oomsest_strhint7 = "" + key_mode3 + " [金貨を渡す]  "
		strmale = "男性"
		strfemale = "女性"
		strbye = "さようなら"
		strmore = "(続く)"
		strnogold = "(所持金が足りない！)"
		strinteractfail = "その方向には、操作できる対象はない。"
		invtitle = "", "調べる", "置く", "拾う", "", "食べる", "装備する", "読む", "飲む", "振る", "渡す", "購入する", "売却する", "鑑定する", "使う", "開く", "料理する", "調合", "混ぜる対象", "捧げる", "交換する", "提示する", "取る", "対象の", "入れる", "もらう", "投げる", "盗む", "交換する", "予約する", "鍛える", "植える", "装着する", "送る", "肥料にする", "交換する", ""
		bodyn = "", "頭", "首", "背中", "胴体", "手", "指", "腕", "腰", "足", "遠隔", "矢弾"
		actlistn = "行動", "食事", "読書", "移動", "休息", "採掘", "演奏", "釣り", "採取", "探索", "行動", "行動", "行動", "行動"
	} else {
		strhint1 = "Cursor [Select]  "
		strhint2 = "" + key_pageup + "," + key_pagedown + " [Page]  "
		strhint3 = "Shift,Esc [Close]  "
		strhint3b = "Shift,Esc [Back]  "
		strhint4 = "Enter,"
		strhint5 = "" + key_identify + " [Known info]  "
		strhint5b = "" + key_mode + " [Mode]  "
		strhint6 = "p [Portrait]  "
		strhint7 = "0~9 [Shortcut]  "
		oom_strhint1 = "" + key_drink + " [Filter enc]  "
		oom_strhint2 = "" + key_search + " [Sort ascend/dscend]  "
		oom_strhint3 = "" + key_prev + "," + key_next + " [Switch category]  "
		oom_strhint4 = "" + key_southwest + "," + key_southeast + " [Filter strength]  "
		oom_strhint5 = "" + key_mode2 + " [Save equips]  "
		oom_strhint6 = "" + key_msglog + " [Load equips]  "
		oom_strhint7 = "" + key_drink + " [Auto-equip]  "
		oom_strhint8 = "" + key_mode2 + " [Only Inherited]  " + key_msglog + " [Only Alive]  "
		oomsest_strhint1 = "" + key_msglog + " [Filter]  "
		oomsest_strhint2 = "" + key_mode3 + " [Drop all]  "
		oomsest_strhint3 = "" + key_mode3 + " [Pickup all]  "
		oomsest_strhint4 = "" + key_mode3 + " [Buy all]  "
		oomsest_strhint5 = "" + key_mode3 + " [Sell all]  "
		oomsest_strhint6 = "" + key_mode3 + " [Item info to Log]  "
		strmale = "male"
		strfemale = "female"
		strbye = "Bye bye."
		strmore = "(More)"
		strnogold = "(You don't have enough money!)"
		strinteractfail = "There's no valid target in that direction."
		invtitle = "", "Examine", "Drop", "Pick Up", "", "Eat", "Wear", "Read", "Drink", "Zap", "Give", "Buy", "Sell", "Identify", "Use", "Open", "Cook", "Mix", "Mix Target", "Offer", "Trade", "Present", "Take", "Target", "Put", "Take", "Throw", "Pickpocket", "Trade", "Reserve", "Forge", "Plant", "Equip", "Conpost", "Trade", ""
		bodyn = "", "Head", "Neck", "Back", "Body", "Hand", "Ring", "Arm", "Waist", "Leg", "Shoot", "Ammo"
		actlistn = "current action", "eating", "reading", "moving", "resting", "mining", "playing", "fishing", "collecting materials", "searching", "current action", "current action", "current action", "current action"
	}
	sdim _cast, 30, 7
	_cast(0) = lang("魔法を詠唱した。", " casts a spell.")
	_cast(1) = lang("糸を吐いた。", " splits cobweb.")
	_cast(2) = lang("体液をまき散らした。", " spreads body fluid.")
	_cast(3) = lang("触手を伸ばした。", " puts out a tentacle.")
	_cast(4) = lang("鋭く睨んだ。", " gazes.")
	_cast(5) = lang("胞子を飛ばした。", " scatters spores.")
	_cast(6) = lang("細かく振動した。", " vibrates.")
	sdim _melee, 20, 4, 8
	if (jp) {
		_melee(0, 0) = "殴って", "殴られた。", "手", "殴った。"
		_melee(0, 1) = "引っ掻き", "引っ掻かれた。", "爪", "引っ掻いた。"
		_melee(0, 3) = "噛み付いて", "噛み付かれた。", "牙", "噛み付いた。"
		_melee(0, 4) = "睨んで", "睨まれた。", "眼", "睨んだ。"
		_melee(0, 5) = "刺し", "刺された。", "針", "刺した。"
		_melee(0, 6) = "触って", "触られた。", "手", "触った。"
		_melee(0, 7) = "胞子を撒き散らし", "胞子を飛ばされた。", "胞子", "胞子を撒き散らした。"
	} else {
		_melee(0, 0) = "punch", "punch", "hand", "punch"
		_melee(0, 1) = "claw", "claw", "claw", "claw"
		_melee(0, 3) = "bite", "bite", "fang", "bite"
		_melee(0, 4) = "gaze", "gaze", "eye", "gaze"
		_melee(0, 5) = "sting", "sting", "needle", "sting"
		_melee(0, 6) = "touch", "touch", "hand", "touch"
		_melee(0, 7) = "attack", "attack", "spore", "attack"
	}
	randcolor = 0, 4, 2, 5, 6
	_randcolor = 0, 2, 4, 5, 6, 3
	if (jp) {
		_namepotion = "透明な", "緑色の", "青い", "金色の", "茶色い", "赤い"
		_namespellbook = "分厚い", "苔むした", "真新しい", "豪華な", "古びた", "血の滴る"
		_namescroll = "かすれた", "苔むした", "ぼろぼろの", "難しそうな", "古びた", "血文字の"
		_namestaff = "鉄の", "つたの", "サファイアの", "金の", "木の", "錆の"
		_namering = "鉄の", "緑の", "サファイアの", "金の", "木の", "錆びた"
	}
	else {
		_namepotion = "clear", "green", "blue", "gold", "brown", "red"
		_namespellbook = "thick", "mossy", "clear", "luxurious", "old", "bloody"
		_namescroll = "blurred", "mossy", "ragged", "boring", "old", "bloody"
		_namestaff = "iron", "ivy", "sapphire", "golden", "wooden", "rusty"
		_namering = "iron", "green", "sapphire", "golden", "wooden", "rusty"
	}
	if (jp) {
		homepage = "http://homepage3.nifty.com/rfish/index.html"
	} else {
		homepage = "http://homepage3.nifty.com/rfish/index_e.html"
	}
	if (jp) {
		strcursed = "呪われた"
		strblessed = "祝福された"
		strdoomed = "堕落した"
	} else {
		strcursed = "cursed"
		strblessed = "blessed"
		strdoomed = "doomed"
	}
	if (jp) {
		stramulet = "首飾り"
		strring = "指輪"
		strpotion = "ポーション"
		strspellbook = "魔法書"
		strscroll = "巻物"
		strstaff = "魔法棒"
	} else {
		stramulet = "amulet"
		strring = "ring"
		strpotion = "potion"
		strspellbook = "spellbook"
		strscroll = "scroll"
		strstaff = "rod"
	}
	if (jp) {
		strbracketleft = "『"
		strbracketright = "』"
	}
	else {
		strbracketleft = "<"
		strbracketright = ">"
	}
	if (jp) {
		strfix = "修正"
	} else {
		strfix = "bonus"
	}
	if (jp) {
		strsex = "性別"
	} else {
		strsex = "sex"
	}
	if (jp) {
		strgold = " gold"
		strplat = " plat"
	} else {
		strgold = " gold pieces"
		strplat = " platinum pieces"
	}
	if (jp) {
		strweight = "s"
	} else {
		strweight = "s"
	}
	if (jp) {
		stryes = "ああ"
		strno = "いや…"
	} else {
		stryes = "Yes"
		strno = "No.."
	}
	if (jp) {
		strblank = ""
	} else {
		strblank = " "
	}
	return



#defcfunc elename int __mmm
	if (efid == 614) {
		return lang("飢えた", "starving")
	}
	if (efid == 613) {
		return lang("腐った", "rotten")
	}
	if (efid == 617) {
		return lang("恐ろしい", "fearful")
	}
	if (efid == 618) {
		return lang("柔らかい", "silky")
	}
	if (__mmm == 50) {
		return lang("燃える", "burning")
	}
	if (__mmm == 51) {
		return lang("冷たい", "icy")
	}
	if (__mmm == 52) {
		return lang("放電する", "electric")
	}
	if (__mmm == 54) {
		return lang("霊的な", "psychic")
	}
	if (__mmm == 58) {
		return lang("痺れる", "numb")
	}
	if (__mmm == 57) {
		return lang("震える", "shivering")
	}
	if (__mmm == 55) {
		return lang("毒の", "poisonous")
	}
	if (__mmm == 56) {
		return lang("地獄の", "infernal")
	}
	if (__mmm == 59) {
		return lang("混沌の", "chaotic")
	}
	if (__mmm == 53) {
		return lang("暗黒の", "gloomy")
	}
	if (__mmm == 61) {
		return lang("出血の", "cut")
	}
	if (__mmm == 62) {
		return lang("エーテルの", "ether")
	}
	return "?"
*label_0171



#deffunc txttargetlevel
	if (cLevel(0) * 20 < cLevel(tc)) {
		s = lang("相手が巨人だとすれば、あなたは蟻のフン以下だ。", "If " + he(tc) + " is a giant, you are less than a dropping of an ant.")
		return
	}
	if (cLevel(0) * 10 < cLevel(tc)) {
		s = lang("絶対に勝てない相手だ。", cnven(he(tc)) + " can mince you with " + his(tc) + " eyes closed.")
		return
	}
	if (cLevel(0) * 5 < cLevel(tc)) {
		s = lang("確実に殺されるだろう。", "You will get killed, a hundred percent sure.")
		return
	}
	if (cLevel(0) * 3 < cLevel(tc)) {
		s = lang("奇跡が起きなければ殺されるだろう。", "You will get killed unless miracles happen.")
		return
	}
	if (cLevel(0) * 2 < cLevel(tc)) {
		s = lang("少なくとも、あなたの倍は強そうだ。", cnven(he(tc)) + " " + is(tc) + " at least twice stronger than you.")
		return
	}
	if (cLevel(0) * 3 / 2 < cLevel(tc)) {
		s = lang("相手はかなり強そうだ。", "The opponent looks quite strong.")
		return
	}
	if (cLevel(0) < cLevel(tc)) {
		s = lang("勝てない相手ではない。", "Won't be an easy fight.")
		return
	}
	if (cLevel(0) / 3 * 2 < cLevel(tc)) {
		s = lang("たぶん勝てそうだ。", "You will probably win.")
		return
	}
	if (cLevel(0) / 2 < cLevel(tc)) {
		s = lang("負ける気はしない。", cnven(he(tc)) + " " + is(tc) + " an easy opponent.")
		return
	}
	if (cLevel(0) / 3 < cLevel(tc)) {
		s = lang("目隠ししていても勝てそうだ。", "You bet you can beat " + him(tc) + " with your eyes closed.")
		return
	}
	s = lang("目隠しして座っていても勝てる。", "You can absolutely beat " + him(tc) + " with your eyes closed and arms crossed.")
	return



#defcfunc sncnv var __nnn
	return strmid(__nnn, 0, instr(__nnn, 0, " ")) + " "



#deffunc sngeneral var __ooo
	__ooo = lang("雑貨屋の" + __ooo, sncnv(__ooo) + "the general vendor")
	return



#deffunc sninn var __ppp
	__ppp = lang("宿屋の" + __ppp, sncnv(__ppp) + "the innkeeper")
	return



#deffunc sntrade var __qqq
	__qqq = lang("交易店の" + __qqq, sncnv(__qqq) + "the trader")
	return



#deffunc sngoods var __rrr
	__rrr = lang("何でも屋の" + __rrr, sncnv(__rrr) + "the goods vendor")
	return



#deffunc snbakery var __sss
	__sss = lang("パン屋の" + __sss, sncnv(__sss) + "the baker")
	return



#deffunc snmagic var __ttt
	__ttt = lang("魔法店の" + __ttt, sncnv(__ttt) + "the magic vendor")
	return



#deffunc snarmor var __uuu
	__uuu = lang("武具店の" + __uuu, sncnv(__uuu) + "the blacksmith")
	return



#deffunc sntrainer var __vvv
	__vvv = lang("ギルドの" + __vvv, sncnv(__vvv) + "the trainer")
	return



#deffunc snfish var __www
	__www = lang("釣具店の" + __www, sncnv(__www) + "the fisher")
	return



#deffunc snblack var __xxx
	__xxx = lang("ブラックマーケットの" + __xxx, sncnv(__xxx) + "the blackmarket vendor")
	return



#deffunc snfood var __yyy
	__yyy = lang("食品店" + __yyy, sncnv(__yyy) + "the food vendor")
	return
*label_0185

#deffunc snhorse var __name
	__name = lang("馬屋の" + __name, sncnv(__name) + "the horse master")
	return

#deffunc txtsetlastword
	notesel buff
	noteload exedir + "user\\" + lang("lastwords.txt", "lastwords-e.txt")
	noteget lastword, rnd(noteinfo(0))
	return



#deffunc txtsetwinword int __zzz
	repeat 6
		i = rnd(cnt + 1)
		p(cnt) = p(i)
		p(i) = cnt
	loop
	repeat __zzz
		if (p(cnt) == 0) {
			s(cnt) = lang("遂に…！", "Finally!")
		}
		if (p(cnt) == 1) {
			s(cnt) = lang("当然の結果だ", "It's a matter of course.")
		}
		if (p(cnt) == 2) {
			s(cnt) = lang("おぉぉぉぉ！", "Woooooo!")
		}
		if (p(cnt) == 3) {
			s(cnt) = lang("ふっ", "Heh.")
		}
		if (p(cnt) == 4) {
			s(cnt) = lang("今日は眠れないな", "I can't sleep tonight.")
		}
		if (p(cnt) == 5) {
			s(cnt) = lang("またそんな冗談を", "You're kidding.")
		}
	loop
	return



#defcfunc limitmax int __aaa, int __bbb
	if (__aaa > __bbb) {
		return __bbb
	} else {
		return __aaa
	}
*label_0190
	sdim mapnamerd, 20, 2, 5
	mapnamerd(0, 0) = lang("はじまりの", "Beginner's "), lang("安全な", "Safe ")
	mapnamerd(0, 1) = lang("冒険者の", "Adventurer's "), lang("時めきの", "Exciting ")
	mapnamerd(0, 2) = lang("迷いの", "Dangerous "), lang("勇者の", "Servant's ")
	mapnamerd(0, 3) = lang("死の", "Fearful "), lang("闇の", "Shadow ")
	mapnamerd(0, 4) = lang("不帰の", "King's "), lang("混沌の", "Chaotic ")
	return



#defcfunc maplevel int
	if (gCurrentMap == 7) {
		if (gCurrentDungeonLevel != 1) {
			if (gCurrentDungeonLevel > 0) {
				return "B." + (gCurrentDungeonLevel - 1)
			} else {
				return "L." + (gCurrentDungeonLevel - 2) * (-1)
			}
		}
	}
	if (areaType(gCurrentMap) != 3) {
		if (areaId(gCurrentMap) == 3 | areaId(gCurrentMap) == 8 | areaId(gCurrentMap) == 13 | (mapType >= 20 & mapType <= 23) == 1) {
			return "" + cnvrank(gCurrentDungeonLevel - areaDangerLevel(gCurrentMap) + 1) + lang("層", "")
		}
	}
	return ""



#defcfunc mapfile int __ddd
	if (areaId(__ddd) == 5) {
		return "vernis"
	}
	if (areaId(__ddd) == 11) {
		return "kapul"
	}
	if (areaId(__ddd) == 12) {
		return "yowyn"
	}
	if (areaId(__ddd) == 14) {
		return "rogueden"
	}
	if (areaId(__ddd) == 15) {
		return "palmia"
	}
	if (areaId(__ddd) == 33) {
		return "noyel"
	}
	if (areaId(__ddd) == 36) {
		return "lumiest"
	}
	if (areaId(__ddd) == 200) {
		return "nc_crippletown"
	}
	if (areaId(__ddd) == areaId_serria) {
		return "st_serria"
	}
	if (areaId(__ddd) == areaId_tormat) {
		return "st_tormat"
	}
	if (areaId(__ddd) == areaId_khios) {
		return "st_khios"
	}
	if (areaId(__ddd) == areaId_carlia) {
		return "st_carlia"
	}
	if (areaId(__ddd) == areaId_trian) {
		return "st_trian"
	}
	return "vernis"



#defcfunc mapname int __eee, int __fff
	s = "", ""
	if (areaId(__eee) == 4) {
		s = lang("ノースティリス", "North Tyris")
	}
	if (areaId(__eee) == 5) {
		s = lang("ヴェルニース", "Vernis"), lang("ヴェルニースの街が見える。辺りは活気に満ちている。", "You see Vernis. The mining town is full of liveliness.")
	}
	if (areaId(__eee) == 11) {
		s = lang("ポート・カプール", "Port Kapul"), lang("ポート・カプールが見える。港は船で賑わっている。", "You see Port Kapul. The port is crowded with merchants.")
	}
	if (areaId(__eee) == 12) {
		s = lang("ヨウィン", "Yowyn"), lang("ヨウィンの村が見える。懐かしい土の匂いがする。", "You see a small town, Yowyn. You remember fondly the smell of the soil.")
	}
	if (areaId(__eee) == 14) {
		s = lang("ダルフィ", "Derphy"), lang("ダルフィの街がある。何やら危険な香りがする。", "You see the infamous rogue's den Derphy.")
	}
	if (areaId(__eee) == 15) {
		s = lang("パルミア", "Palmia"), lang("パルミアの都がある。都は高い壁に囲われている。", "You see the great city of Palmia. Entire city is surrounded by tall wall.")
	}
	if (areaId(__eee) == 16) {
		s = lang("灼熱の塔", "the Tower of Fire")
	}
	if (areaId(__eee) == 17) {
		s = lang("死者の洞窟", "the crypt of the damned")
	}
	if (areaId(__eee) == 18) {
		s = lang("古城", "the Ancient Castle")
	}
	if (areaId(__eee) == 7) {
		s = lang("わが家", "Your Home"), lang("あなたの家だ。", "It's your sweet home.")
	}
	if (areaId(__eee) == 3) {
		s = lang("レシマス", "Lesimas"), lang("レシマスの洞窟がある。運命の鼓動を感じる。", "You see the dungeon of Lesimas. The wheel of fortune starts to turn.")
	}
	if (areaId(__eee) == 42) {
		s = lang("すくつ", "the Void"), lang("なんだこの場所は…？", "What is this place?")
	}
	if (areaId(__eee) == 2) {
		s = lang("野外", "Wilderness")
	}
	if (areaId(__eee) == 10) {
		s = lang("ルミエスト墓所", "the graveyard"), lang("墓所が見える。辺りは静寂に包まれている…", "You see the graveyard of Lumiest. It's silent. Very silent.")
	}
	if (areaId(__eee) == 6) {
		s = lang("闘技場", "Arena")
	}
	if (areaId(__eee) == 19) {
		s = lang("竜窟", "the Dragon's Nest")
	}
	if (areaId(__eee) == 20) {
		s = lang("神々の休戦地", "the Truce Ground"), lang("寺院がある。神聖な雰囲気がする。", "You see old shrines. Sacred air surrounds the ground.")
	}
	if (areaId(__eee) == 21) {
		s = lang("アクリ・テオラ", "Cyber Dome"), lang("何やら奇妙な建物がある。", "You see a very strange building.")
	}
	if (areaId(__eee) == 22) {
		s = lang("混沌の城《獣》", "Fort of Chaos <Beast>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は666階相当)", "You see an unearthly fort. Your inner voice warns you to not go there. (Approximate danger level: 666) ")
	}
	if (areaId(__eee) == 23) {
		s = lang("混沌の城《機甲》", "Fort of Chaos <Machine>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は666階相当)", "You see an unearthly fort. Your inner voice warns you to not go there. (Approximate danger level: 666) ")
	}
	if (areaId(__eee) == 24) {
		s = lang("混沌の城《奇形》", "Fort of Chaos <Collapsed>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は666階相当)", "You see an unearthly fort. Your inner voice warns you to not go there. (Approximate danger level: 666) ")
	}
	if (areaId(__eee) == 40) {
		if (arenaop == 2) {
			s = lang("プチ格闘場", "Putit Arena")
		} else {
			s = lang("コロシアム", "Pet Arena")
		}
	}
	if (areaId(__eee) == 101) {
		s = lang("博物館", "My Museum")
	}
	if (areaId(__eee) == 102) {
		s = lang("店", "Shop")
	}
	if (areaId(__eee) == 103) {
		s = lang("畑", "Crop")
	}
	if (areaId(__eee) == 104) {
		s = lang("倉庫", "Storage House")
	}
	if (areaId(__eee) == 39) {
		s = lang("ダンジョン", "dungeon")
	}
	if (areaId(__eee) == 31) {
		s = lang("牧場", "Ranch")
	}
	if (areaId(__eee) == 30) {
		s = lang("シェルター", "Shelter")
	}
	if (areaId(__eee) == 32) {
		s = lang("パルミア大使館", "the Embassy")
	}
	if (areaId(__eee) == 9) {
		s = lang("実験場", "Test Ground")
	}
	if (areaId(__eee) == 33) {
		s = lang("ノイエル", "Noyel"), lang("ノイエルの村がある。子供たちの笑い声が聞こえる。", "You see Noyel. The laughters of children travel from the playground.")
	}
	if (areaId(__eee) == 34) {
		s = lang("工房ミラル・ガロク", "Miral and Garok's Workshop")
	}
	if (areaId(__eee) == 35) {
		s = lang("ハウスドーム", "Show House")
	}
	if (areaId(__eee) == 25) {
		s = lang("ラーナ", "Larna")
	}
	if (areaId(__eee) == 26) {
		s = lang("山道", "the Mountain Pass")
	}
	if (areaId(__eee) == 27) {
		s = lang("子犬の洞窟", "the Puppy Cave")
	}
	if (areaId(__eee) == 28) {
		s = lang("イークの洞窟", "the Yeek's Nest")
	}
	if (areaId(__eee) == 29) {
		s = lang("妹の館", "the mansion of younger sister")
	}
	if (areaId(__eee) == 36) {
		s = lang("ルミエスト", "Lumiest"), lang("ルミエストの都が見える。水のせせらぎが聴こえる。", "You see Lumiest. Murmuring of water pleasantly echoes.")
	}
	if (areaId(__eee) == 37) {
		s = lang("ピラミッド", "the Pyramid")
	}
	if (areaId(__eee) == 38) {
		s = lang("ﾐﾉﾀｳﾛｽの巣", "the Minotaur's Nest")
	}
	if (areaId(__eee) == 41) {
		s = lang("牢獄", "Jail"), lang("収容所がある。入り口は固く閉ざされている。", "You see a prison. The entrance is strictly closed.")
	}
	if (areaId(__eee) == 43) {
		s = lang("ノースティリス南関所", "North Tyris south border")
	}
	if (areaId(__eee) == 44) {
		s = lang("サウスティリス", "South Tyris")
	}
	if (areaId(__eee) == 45) {
		s = lang("サウスティリス北関所", "South Tyris north border")
	}
	if (areaId(__eee) == 46) {
		s = lang("煙とパイプ亭", "The smoke and pipe")
	}
	if (areaId(__eee) == 47) {
		s = lang("フェアリゾート", "Fairy island")
	}
	if (areaId(__eee) == 48) {
		s = lang("フェアリゾート関所", "Fairy island border")
	}
	if (areaId(__eee) == 49) {
		s = lang("フェアリゾートレース場", "Fairy island race track")
	}
	// Towns in South Tyris
	if (areaId(__eee) == areaId_serria) {
		s = lang("ポート・セリア", "Port Serria"), lang("ポート・セリアがある。潮風が香り、船員たちの声が聞こえる。", "You see Port Serria.")
	}
	if (areaId(__eee) == areaId_tormat) {
		s = lang("トーマット", "Tormat"), lang("トーマットがある。", "You see Tormat.")
	}
	if (areaId(__eee) == areaId_khios) {
		s = lang("キオス", "Khios"), lang("キオスがある。", "You see Khios.")
	}
	if (areaId(__eee) == areaId_carlia) {
		s = lang("カーリア", "Carlia"), lang("カーリアがある。", "You see Carlia.")
	}
	if (areaId(__eee) == areaId_trian) {
		s = lang("トライアン", "Trian"), lang("トライアンがある。", "You see Trian.")
	}
	if (areaId(__eee) == 57) {
		s = lang("古代の遺跡", "Ancient ruins")
	}
	if (areaId(__eee) == 58) {
		s = lang("棄てられた農村地", "Abandoned rural area")
	}
	if (areaId(__eee) == 59) {
		s = lang("混沌の城《妖》", "Fort of Chaos <Fairy>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は666階相当)", "You see an unearthly fort. Your inner voice warns you to not go there. (Approximate danger level: 666) ")
	}
	if (areaId(__eee) == 60) {
		s = lang("変異種の洞窟", "Mutant cave"), lang("変異種の洞窟がある。怪物たちの雄叫びが聞こえる。", "You see the dungeon of Mutant cave.")
	}
	if (areaId(__eee) == 61) {
		s = lang("シークレットゾーン", "Secret zone")
	}
	if (areaId(__eee) == 62) {
		s = lang("氷窟", "Ice Cave")
	}
	if (areaId(__eee) == 63) {
		s = lang("忘れられた実験場", "The forgotten laboratory")
	}
	if (areaId(__eee) == 13) {
		if (gExecutingImmediateQuestType == 1001) {
			s = lang("街近辺", "The outskirts")
		}
		if (gExecutingImmediateQuestType == 1010 | gExecutingImmediateQuestType == 1008) {
			s = lang("市街地", "Urban area")
		}
	}
	if (areaId(__eee) == 200) {
		s = lang("クリップルタウン", "Town of Void")
	}
	if (areaId(__eee) == 210) {
		s = lang("ならく", "The Abyss"), lang("地獄へようこそ！", "Welcome to hell!")
	}
	if (areaId(__eee) == 8) {
		p(60) = 1
		if (oabit(11, __eee)) {
			if (getfactionvalue(__eee - 450 + 245, "race") != "") {
				dbidn = refstr
				dbmode = 2
				gosub *label_1525
				s = lang(racename + "の", racename + "'s ")
				p(60) = 0
			}
		} else {
			if (oabit(12, __eee)) {
				s = lang("プチの", "the Putit's ")
				p(60) = 0
			}
		}
		if (p(60)) {
			s = mapnamerd(areaDungeonPrefixType(__eee), limitmax(areaDangerLevel(__eee) / 5, length2(mapnamerd) - 1))
		}
		repeat 32
			if (cnt == 11 | cnt == 12) {
				continue
			}
			if (oabit(cnt, __eee)) {
				s += oadatastr(cnt) + lang("の", " ")
			}
		loop
		if (oabit(12, __eee)) {
			s += lang("巣", "Nest")
		} else {
			if (areaType(__eee) == 20) {
				s += lang("洞窟", "Dungeon")
			}
			if (areaType(__eee) == 22) {
				s += lang("森", "Forest")
			}
			if (areaType(__eee) == 21) {
				s += lang("塔", "Tower")
			}
			if (areaType(__eee) == 23) {
				s += lang("砦", "Fort")
			}
		}
	}
	if (__fff == 1) {
		if (areaId(__eee) == 29) {
			return ""
		}
		if (s(1) != "") {
			return s(1)
		}
		if (areaType(__eee) >= 20) {
			return lang(s + "への入り口がある(入り口の危険度は" + areaDangerLevel(__eee) + "階相当)。", "You see an entrance leading to " + s + ".(Approximate danger level: " + areaDangerLevel(__eee) + ") ")
		}
		return lang(s + "がある。", "You see " + s + ".")
	}
	return s



#defcfunc txtbuilding int __ggg, int __hhh
	p@m32 = bddata(0, __ggg, __hhh)
	s@m32 = lang(bdrefn(p@m32) + "がある。", "You see " + bdrefn(p@m32) + ".")
	return s@m32



#defcfunc txtskillchange int __iii, int __jjj, int __kkk
	if (__kkk < 16) {
		if (__jjj == 0) {
			throwsstpevent "SkillUp", __kkk, skillname(__iii), sorgEx(__iii, __kkk)
		} else {
			throwsstpevent "SkillDown", __kkk, skillname(__iii), sorgEx(__iii, __kkk)
		}
	}
	if (__iii == 2) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は生命力の上昇を感じた。", name(__kkk) + your(__kkk) + " life force increases.")
		} else {
			return lang(name(__kkk) + "は生命力の衰えを感じた。", name(__kkk) + your(__kkk) + " life force decreases.")
		}
	}
	if (__iii == 3) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "はマナの向上を感じた。", name(__kkk) + your(__kkk) + " mana increases.")
		} else {
			return lang(name(__kkk) + "はマナの衰えを感じた。", name(__kkk) + your(__kkk) + " mana decreases.")
		}
	}
	if (__iii == 10) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "はより強くなった。", name(__kkk) + your(__kkk) + " muscles feel stronger.")
		} else {
			return lang(name(__kkk) + "は少し贅肉が増えたような気がした。", name(__kkk) + your(__kkk) + " muscles soften.")
		}
	}
	if (__iii == 11) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は我慢することの快感を知った。", name(__kkk) + " begin" + _s(__kkk) + " to feel good when being hit hard.")
		} else {
			return lang(name(__kkk) + "は我慢ができなくなった。", name(__kkk) + " lose" + _s(__kkk) + " patience.")
		}
	}
	if (__iii == 12) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は器用になった。", name(__kkk) + " become" + _s(__kkk) + " dexterous.")
		} else {
			return lang(name(__kkk) + "は不器用になった。", name(__kkk) + " become" + _s(__kkk) + " clumsy.")
		}
	}
	if (__iii == 13) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は世界をより身近に感じるようになった。", name(__kkk) + " feel" + _s(__kkk) + " more in touch with the world.")
		} else {
			return lang(name(__kkk) + "は感覚のずれを感じた。", name(__kkk) + " " + is(__kkk) + " getting out of touch with the world")
		}
	}
	if (__iii == 14) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は急に色々なことを学びたくなった。", name(__kkk) + " feel" + _s(__kkk) + " studious.")
		} else {
			return lang(name(__kkk) + "の学習意欲が低下した。", name(__kkk) + " lose" + _s(__kkk) + " curiosity.")
		}
	}
	if (__iii == 15) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "の意思は固くなった。", name(__kkk) + your(__kkk) + " will hardens.")
		} else {
			return lang(name(__kkk) + "は何でもすぐ諦める。", name(__kkk) + your(__kkk) + " will softens.")
		}
	}
	if (__iii == 16) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は魔力の上昇を感じた。", name(__kkk) + your(__kkk) + " magic improves.")
		} else {
			return lang(name(__kkk) + "は魔力の衰えを感じた。", name(__kkk) + your(__kkk) + " magic degrades.")
		}
	}
	if (__iii == 17) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は周囲の視線を心地よく感じる。", name(__kkk) + " enjoy" + _s(__kkk) + " showing off " + his(__kkk) + " body.")
		} else {
			return lang(name(__kkk) + "は急に人前に出るのが嫌になった。", name(__kkk) + " start" + _s(__kkk) + " to avoid eyes of people.")
		}
	}
	if (__iii == 18) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は周りの動きが遅く見えるようになった。", name(__kkk) + your(__kkk) + " speed increases.")
		} else {
			return lang(name(__kkk) + "は遅くなった。", name(__kkk) + your(__kkk) + " speed decreases.")
		}
	}
	if (__iii == 19) {
		if (__jjj == 0) {
			return lang(name(__kkk) + "は幸運になった。", name(__kkk) + " become" + _s(__kkk) + " lucky.")
		} else {
			return lang(name(__kkk) + "は不幸になった。", name(__kkk) + " become" + _s(__kkk) + " unlucky.")
		}
	}
	if (__jjj == 0) {
		return lang(name(__kkk) + "は" + skillnameref(__iii, __kkk) + "の技術の向上を感じた。", name(__kkk) + your(__kkk) + " " + skillnameref(__iii, __kkk) + " skill increases.")
	} else {
		return lang(name(__kkk) + "は" + skillnameref(__iii, __kkk) + "の技術の衰えを感じた。", name(__kkk) + your(__kkk) + " " + skillnameref(__iii, __kkk) + " skill falls off.")
	}
	goto *label_0198
*label_0198
	dim picfood, 10, 9
	picfood(0, 1) = 230, 230, 230, 195, 227, 167, 167, 194, 229, 227
	picfood(0, 2) = 230, 230, 230, 229, 342, 194, 229, 342, 229, 194
	picfood(0, 3) = 230, 230, 230, 229, 346, 346, 345, 345, 347, 346
	picfood(0, 4) = 230, 230, 230, 108, 346, 110, 346, 347, 347, 347
	picfood(0, 5) = 230, 230, 229, 343, 344, 344, 343, 343, 344, 343
	picfood(0, 6) = 230, 230, 230, 228, 342, 342, 228, 341, 228, 228
	picfood(0, 7) = 230, 230, 110, 108, 110, 112, 114, 113, 115, 111
	picfood(0, 8) = 230, 230, 230, 190, 229, 190, 342, 168, 347, 194
	picfood(0, 9) = 230, 700, 701, 702, 703, 704, 705, 706, 707, 708
	if (cfg_useffhp) {
		picfood(0,10) = 170, 710, 711, 711, 711, 711, 711, 711, 711, 711
	} else {
		picfood(0,10) = 170, 170, 354, 354, 354, 354, 354, 354, 354, 354
	}
	return

#include "jp_dialect.hsp"



#deffunc convert_word var __mmm, int __nnn, int __ooo
	nc_intb_modimp = 0
	repeat 20
		await
		splitpoint = instr(__mmm, 0, "{"), instr(__mmm, splitpoint, "}"), strlen(__mmm)
		if (splitpoint == (-1)) {
			break
		}
		splitword = strmid(__mmm, splitpoint + 1, splitpoint(1) - 1), strmid(__mmm, 0, splitpoint), strmid(__mmm, splitpoint + splitpoint(1) + 1, splitpoint(2) - splitpoint(1) - splitpoint)
		repeat 1
			if (strmid(splitword, 0, 4) == "snd:") {
				s = strmid(splitword, -1, strlen(splitword) - 4)
				playsound s
				splitword = ""
				break
			}
			if (strmid(splitword, 0, 4) == "bgm:") {
				s = strmid(splitword, -1, strlen(splitword) - 4)
				playbgm s
				splitword = ""
				break
			}
			if (splitword == "ref") {
				if (talkref == 1) {
					splitword = lang("" + gNumberOfWaitingGuests, "" + gNumberOfWaitingGuests + " guest" + _s2(gNumberOfWaitingGuests))
					break
				}
			}
			if (splitword == "mati") {
				if (talkref == 1) {
					splitword = lang("" + mati, "" + mati)
					break
				}
			}
			if (splitword == "matiname") {
				if (talkref == 1) {
					splitword = lang("" + mdatan(0), "" + mdatan(0))
					break
				}
			}
			if (splitword == "you") {
				splitword = _kimi(3)
				break
			}
			if (splitword == "me") {
				splitword = _ore(3)
				break
			}
			if (splitword == "sex") {
				splitword = _sex2(cSex(__nnn))
				break
			}
			if (splitword == "player") {
				splitword = cdatan(0, 0)
				break
			}
			if (splitword == "aka") {
				splitword = cdatan(1, 0)
				break
			}
			if (splitword == "npc") {
				splitword = cdatan(0, __ooo)
				break
			}
			if (splitword == "nnpc") {
				namae = refchara(cId(__ooo), 2, 1) + "の"
				if (instr(cdatan(0, __ooo), 0, namae) != (-1)) {
					splitword = cdatan(0, __ooo)
					delstr splitword, namae
				} else {
					splitword = cdatan(0, __ooo)
				}
				break
			}
			if (splitword == "snpc") {
				splitword = cdatan(0, __nnn)
				break
			}
			if (splitword == "nsnpc") {
				namae = refchara(cId(__nnn), 2, 1) + "の"
				if (instr(cdatan(0, __nnn), 0, namae) != (-1)) {
					splitword = cdatan(0, __nnn)
					delstr splitword, namae
				} else {
					splitword = cdatan(0, __nnn)
				}
				break
			}
			// NC
			if (splitword == "wholeprice") {
				splitword = lang("" + sexvalue, "" + sexvalue)
				break
			}
			if (splitword == "cost") {
				splitword = "" + thousandsep(str(costvalue))
				break
			}
			if (splitword == "giveprice") {
				splitword = lang("" + costvalue, "" + costvalue)
				break
			}
			//MMA移植
			if ( splitword == "csskill" ) {
				splitword = ""
				if (csskill >= 0 & csskill < length(skillname) ) {
					splitword = "" + skillname(csskill)
				}
				break
			}
			if ( splitword == "cmaka" ) {
				splitword = "" + cmaka
				break
			}
			if ( splitword == "psex" ) {
				splitword = _sex2(cdata(8, 0))
				break
			}
			if ( splitword == "csex" ) {
				splitword = _sex2(cdata(8, __mmm))
				break
			}
			if ( splitword == "tsex" ) {
				splitword = _sex2(cdata(8, __nnn))
				break
			}
			if ( splitword == "caka" ) {
				splitword = cdatan(1, __mmm)
				if ( splitword == "" ) {
					splitword = cdatan(0, __mmm)
				}
				break
			}
			if ( splitword == "taka" ) {
				splitword = cdatan(1, prm_587)
				if ( splitword == "" ) {
					splitword = cdatan(0, prm_587)
				}
				break
			}
			if ( splitword == "nptc" ) {
				splitword = cdatan(0, tc)
				break
			}
			if ( splitword == "npcc" ) {
				splitword = cdatan(0, cc)
				break
			}
			if ( splitword == "spell" ) {
				splitword = skillname(efid)
				break
			}
			if ( splitword == "calcadv" ) {
				splitword = str(calchireadv(__nnn))
				break
			}
			if (splitword == "ciname") {
				splitword = ""
				if ( ci != (-1) ) {
					splitword = itemname(ci)
				}
				break
			}
			if (splitword == "tiname") {
				splitword = ""
				if ( ti != (-1) ) {
					splitword = itemname(ti)
				}
				break
			}
			if ( splitword == "winame" ) {
				splitword = ""
				if ( cw != (-1) ) {
					splitword = itemname(cw)
				}
				break
			}
			if (splitword == "ainame") {
				splitword = ""
				if ( ammo != (-1) ) {
					splitword = itemname(ammo)
				}
				break
			}
			if (splitword == "ciname1") {
				splitword = ""
				if ( ci != (-1) ) {
					splitword = itemname(ci, 1)
				}
				break
			}
			if (splitword == "tiname1") {
				splitword = ""
				if ( ti != (-1) ) {
					splitword = itemname(ti, 1)
				}
				break
			}
			if (splitword == "pickitem") {
				splitword = ""
				if (ti != (-1)) {
					splitword = itemname(ti, in)
					str_replace splitword, "[", "［"
					str_replace splitword, "]", "］"
				}
				break
			}
			if (splitword == "winame1") {
				splitword = ""
				if ( cw != (-1) ) {
					splitword = itemname(cw, 1)
				}
				break
			}
			if (splitword == "ainame1") {
				splitword = ""
				if ( ammo != (-1) ) {
					splitword = itemname(ammo, 1)
				}
				break
			}
			if (splitword == "cititle") {
				splitword = ""
				if ( ci != (-1) ) {
					splitword = lang("", "The ") + iknownnameref(inv(3, ci))
					if ( inv(3, ci) == 743 ) {
						splitword = lang("", "The ") + iknownnamecnv(ci)
					}
					if ( inv(4, ci) >= 4 & inv(23, ci) >= 40000 & refitem(inv(3, ci), 5, ci) < 50000 ) {
						rndseed = rnd(32768)
						randomize inv(23, ci) - 40000
						splitword = random_title(1)
						randomize rndseed
					}
				}
				break
			}
			if (splitword == "tititle") {
				splitword = ""
				if ( ti != (-1) ) {
					splitword = lang("", "The ") + iknownnameref(inv(3, ti))
					if ( inv(3, ti) == 743 ) {
						splitword = lang("", "The ") + iknownnamecnv(ti)
					}
					if ( inv(4, ti) >= 4 & inv(23, ti) >= 40000 & refitem(inv(3, ti), 5, ti) < 50000 ) {
						rndseed = rnd(32768)
						randomize inv(23, ti) - 40000
						splitword = random_title(1)
						randomize rndseed
					}
				}
				break
			}
			if (splitword == "wititle") {
				splitword = ""
				if ( cw != (-1) ) {
					splitword = lang("", "The ") + iknownnameref(inv(3, cw))
					if ( inv(3, cw) == 743 ) {
						splitword = lang("", "The ") + iknownnamecnv(cw)
					}
					if ( inv(4, cw) >= 4 & inv(23, cw) >= 40000 & refitem(inv(3, cw), 5, cw) < 50000 ) {
						rndseed = rnd(32768)
						randomize inv(23, cw) - 40000
						splitword = random_title(1)
						randomize rndseed
					}
				}
				break
			}
			if (splitword == "aititle") {
				splitword = ""
				if ( ammo != (-1) ) {
					splitword = lang("", "The ") + iknownnameref(inv(3, ammo))
					if ( inv(3, ammo) == 743 ) {
						splitword = lang("", "The ") + iknownnamecnv(ammo)
					}
					if ( inv(4, ammo) >= 4 & inv(23, ammo) >= 40000 & refitem(inv(3, ammo), 5, ammo) < 50000 ) {
						rndseed = rnd(32768)
						randomize inv(23, ammo) - 40000
						splitword = random_title(1)
						randomize rndseed
					}
				}
				break
			}
			if (splitword == "ccname") {
				splitword = ""
				if ( __mmm != (-1) ) {
					if ( cdata(27, __mmm) == 343 ) {
						if ( cdata(157, __mmm) < usernpcmax ) {
							splitword = userdatan(1, cdata(157, __mmm))
							break
						}
					}
					splitword = name(__mmm)
				}
				break
			}
			if (splitword == "tcname") {
				splitword = ""
				if (__nnn != (-1)) {
					if (cdata(27, __nnn) == 343) {
						if (cdata(157, __nnn) < usernpcmax) {
							splitword = userdatan(1, cdata(157, __nnn))
							break
						}
					}
					splitword = name(__nnn)
				}
				break
			}
			if (splitword == "dropitem") {
				splitword = nc_ctalkbuff_str
				str_replace splitword, "[", "［"
				str_replace splitword, "]", "］"
			}
			if (splitword == "itemcount") {
				splitword = str(nc_ctalkbuff_int)
			}
			if ( splitword == "pgod" ) {
				splitword = godname(godcheck(0))
				break
			}
			if ( splitword == "cgod" ) {
				splitword = godname(godcheck(__mmm))
				break
			}
			if ( splitword == "tgod" ) {
				splitword = godname(godcheck(__nnn))
				break
			}
			if ( splitword == "psgod" ) {
				splitword = sgodname(godcheck(0))
				break
			}
			if ( splitword == "csgod" ) {
				splitword = sgodname(godcheck(__mmm))
				break
			}
			if ( splitword == "tsgod" ) {
				splitword = sgodname(godcheck(__nnn))
				break
			}
			if (strmid(splitword, 0, 5) == "gdata" & strlen(splitword) > 5) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(gdata) ) {
					splitword = ""
					break
				}
				cope = instr(s, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if (onum < 0 | onum >= length(cmgbuff)) {
						splitword = ""
						break
					}
					cmgbuff(onum) = gdata(cnum)
					splitword = ""
					break
				}
				splitword = "" + gdata(cnum)
				break
			}
			if (strmid(splitword, 0, 5) == "mdata" & strlen(splitword) > 5) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(mdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mdata(cnum)
					splitword = ""
					break
				}
				splitword = "" + mdata(cnum)
				break
			}
			if (strmid(splitword, 0, 6) == "madata" & strlen(splitword) > 6) {
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(adata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = adata(cnum, gdata(20))
					splitword = ""
					break
				}
				splitword = "" + adata(cnum, gdata(20))
				break
			}
			if ( strmid(splitword, 0, 6) == "wadata" & strlen(splitword) > 6) {
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(adata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = adata(cnum, gdata(850))
					splitword = ""
					break
				}
				splitword = "" + adata(cnum, gdata(850))
				break
			}
			if ( strmid(splitword, 0, 6) == "cgdata" & strlen(splitword) > 6 ) {
				cgdatatarget = __ooo
				if ( cdata(27, cgdatatarget) != 343 | cdata(157, cgdatatarget) >= usernpcmax ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(usergdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "add")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					usergdata(cnum, cdata(157, cgdatatarget)) += onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "sub")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					usergdata(cnum, cdata(157, cgdatatarget)) -= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mpl")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					usergdata(cnum, cdata(157, cgdatatarget)) *= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "div")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						usergdata(cnum, cdata(157, cgdatatarget)) /= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mod")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						usergdata(cnum, cdata(157, cgdatatarget)) \= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "set")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					usergdata(cnum, cdata(157, cgdatatarget)) = onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "rnd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum > 0 ) {
						usergdata(cnum, cdata(157, cgdatatarget)) = rnd(onum) + 1
					}
					else {
						usergdata(cnum, cdata(157, cgdatatarget)) = 0
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = usergdata(cnum, cdata(157, cgdatatarget))
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pop")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					usergdata(cnum, cdata(157, cgdatatarget)) = cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pad")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					if ( cdata(150, cgdatatarget) != 20 ) {
						splitword = ""
						break
					}
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					usergdata(cnum, cdata(157, cgdatatarget)) += cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psb")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					if ( cdata(150, cgdatatarget) != 20 ) {
						splitword = ""
						break
					}
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					usergdata(cnum, cdata(157, cgdatatarget)) -= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmp")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					if ( cdata(150, cgdatatarget) != 20 ) {
						splitword = ""
						break
					}
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					usergdata(cnum, cdata(157, cgdatatarget)) *= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pdv")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					if ( cdata(150, cgdatatarget) != 20 ) {
						splitword = ""
						break
					}
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						usergdata(cnum, cdata(157, cgdatatarget)) /= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					if ( cdata(150, cgdatatarget) != 20 ) {
						splitword = ""
						break
					}
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						usergdata(cnum, cdata(157, cgdatatarget)) \= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "prd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					if ( cdata(150, cgdatatarget) != 20 ) {
						splitword = ""
						break
					}
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					usergdata(cnum, cdata(157, cgdatatarget)) = 0
					if ( cmgbuff(onum) > 0 ) {
						usergdata(cnum, cdata(157, cgdatatarget)) = rnd(cmgbuff(onum)) + 1
					}
					splitword = ""
					break
				}
				splitword = "" + usergdata(cnum, cdata(157, cgdatatarget))
				break
			}

			if (strmid(splitword, 0, 5) == "cdata" & strlen(splitword) > 5) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(cdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cdata(cnum, 0)
					splitword = ""
					break
				}
				splitword = "" + cdata(cnum, 0)
				break
			}
			if ( strmid(splitword, 0, 5) == "cdata" & strlen(splitword) > 5 ) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(cdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cdata(cnum, 0)
					splitword = ""
					break
				}
				splitword = "" + cdata(cnum, 0)
				break
			}
			if ( strmid(splitword, 0, 6) == "ccdata" & strlen(splitword) > 6 ) {
				if ( __mmm == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(cdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cdata(cnum, __mmm)
					splitword = ""
					break
				}
				splitword = "" + cdata(cnum, __mmm)
				break
			}
			if ( strmid(splitword, 0, 6) == "tcdata" & strlen(splitword) > 6 ) {
				if ( __nnn == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(cdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cdata(cnum, __nnn)
					splitword = ""
					break
				}
				splitword = "" + cdata(cnum, __nnn)
				break
			}
			if ( strmid(splitword, 0, 4) == "cbit" & strlen(splitword) > 4 ) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= 50 * 32 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cbit(cnum, 0)
					splitword = ""
					break
				}
				splitword = "" + cbit(cnum, 0)
				break
			}
			if ( strmid(splitword, 0, 5) == "ccbit" & strlen(splitword) > 5 ) {
				if ( __mmm == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= 50 * 32 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cbit(cnum, __mmm)
					splitword = ""
					break
				}
				splitword = "" + cbit(cnum, __mmm)
				break
			}
			if (strmid(splitword, 0, 5) == "tcbit" & strlen(splitword) > 5) {
				if ( __nnn == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= 50 * 32 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cbit(cnum, __nnn)
					splitword = ""
					break
				}
				splitword = "" + cbit(cnum, __nnn)
				break
			}
			if (strmid(splitword, 0, 5) == "sdata" & strlen(splitword) > 5) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if (cope != (-1) & strlen(splitword) > cope + 3) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = sdata(cnum, 0)
					splitword = ""
					break
				}
				splitword = "" + sdata(cnum, 0)
				break
			}
			if ( strmid(splitword, 0, 6) == "csdata" & strlen(splitword) > 6 ) {
				if ( __mmm == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = sdata(cnum, __mmm)
					splitword = ""
					break
				}
				splitword = "" + sdata(cnum, __mmm)
				break
			}
			if ( strmid(splitword, 0, 6) == "tsdata" & strlen(splitword) > 6 ) {
				if ( __nnn == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = sdata(cnum, __nnn)
					splitword = ""
					break
				}
				splitword = "" + sdata(cnum, __nnn)
				break
			}
			if (strmid(splitword, 0, 4) == "sorg" & strlen(splitword) > 4) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = sorg(cnum, 0)
					splitword = ""
					break
				}
				splitword = "" + sorg(cnum, 0)
				break
			}
			if (strmid(splitword, 0, 5) == "csorg" & strlen(splitword) > 5) {
				if ( __mmm == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = sorg(cnum, __mmm)
					splitword = ""
					break
				}
				splitword = "" + sorg(cnum, __mmm)
				break
			}
			if ( strmid(splitword, 0, 5) == "tsorg" & strlen(splitword) > 5 ) {
				if ( __nnn == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = sorg(cnum, __nnn)
					splitword = ""
					break
				}
				splitword = "" + sorg(cnum, __nnn)
				break
			}
			if (strmid(splitword, 0, 4) == "cinv" & strlen(splitword) > 4) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= length(inv) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( ci != (-1) ) {
						cmgbuff(onum) = inv(cnum, ci)
					}
					splitword = ""
					break
				}
				if ( ci != (-1) ) {
					splitword = "" + inv(cnum, ci)
				}
				break
			}
			if (strmid(splitword, 0, 4) == "tinv" & strlen(splitword) > 4) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= length(inv) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( ti != (-1) ) {
						cmgbuff(onum) = inv(cnum, ti)
					}
					splitword = ""
					break
				}
				if ( ti != (-1) ) {
					splitword = "" + inv(cnum, ti)
				}
				break
			}
			if (strmid(splitword, 0, 4) == "winv" & strlen(splitword) > 4) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= length(inv) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cw != (-1) ) {
						cmgbuff(onum) = inv(cnum, cw)
					}
					splitword = ""
					break
				}
				if ( cw != (-1) ) {
					splitword = "" + inv(cnum, cw)
				}
				break
			}
			if ( strmid(splitword, 0, 4) == "ainv" & strlen(splitword) > 4 ) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= length(inv) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( ammo != (-1) ) {
						cmgbuff(onum) = inv(cnum, ammo)
					}
					splitword = ""
					break
				}
				if ( ammo != (-1) ) {
					splitword = "" + inv(cnum, ammo)
				}
				break
			}
			if (strmid(splitword, 0, 5) == "cibit" & strlen(splitword) > 5) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= 5 * 32 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( ci != (-1) ) {
						cmgbuff(onum) = ibit(cnum, ci)
					}
					splitword = ""
					break
				}
				if ( ci != (-1) ) {
					splitword = "" + ibit(cnum, ci)
				}
				break
			}
			if ( strmid(splitword, 0, 5) == "tibit" & strlen(splitword) > 5 ) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= 5 * 32 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( ti != (-1) ) {
						cmgbuff(onum) = ibit(cnum, ti)
					}
					splitword = ""
					break
				}
				if ( ti != (-1) ) {
					splitword = "" + ibit(cnum, ti)
				}
				break
			}
			if ( strmid(splitword, 0, 5) == "wibit" & strlen(splitword) > 5 ) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= 5 * 32 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cw != (-1) ) {
						cmgbuff(onum) = ibit(cnum, cw)
					}
					splitword = ""
					break
				}
				if ( cw != (-1) ) {
					splitword = "" + ibit(cnum, cw)
				}
				break
			}
			if (strmid(splitword, 0, 5) == "aibit" & strlen(splitword) > 5) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= 5 * 32 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( ammo != (-1) ) {
						cmgbuff(onum) = ibit(cnum, ammo)
					}
					splitword = ""
					break
				}
				if ( ammo != (-1) ) {
					splitword = "" + ibit(cnum, ammo)
				}
				break
			}
			if (strmid(splitword, 0, 4) == "kill" & strlen(splitword) > 4) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= length2(npcmemory) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = npcmemory(0, cnum)
					splitword = ""
					break
				}
				splitword = "" + npcmemory(0, cnum)
				break
			}
			if (strmid(splitword, 0, 4) == "item" & strlen(splitword) > 4) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mma_itemcount(0, cnum, "")
					splitword = ""
					break
				}
				splitword = "" + mma_itemcount(0, cnum, "")
				break
			}
			if (strmid(splitword, 0, 5) == "citem" & strlen(splitword) > 5) {
				if ( __mmm == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mma_itemcount(__mmm, cnum, "")
					splitword = ""
					break
				}
				splitword = "" + mma_itemcount(__mmm, cnum, "")
				break
			}
			if (strmid(splitword, 0, 5) == "titem" & strlen(splitword) > 5) {
				if ( __nnn == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mma_itemcount(__nnn, cnum, "")
					splitword = ""
					break
				}
				splitword = "" + mma_itemcount(__nnn, cnum, "")
				break
			}
			if (strmid(splitword, 0, 5) == "fitem" & strlen(splitword) > 5) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mma_itemcount(-1, cnum, "")
					splitword = ""
					break
				}
				splitword = "" + mma_itemcount(-1, cnum, "")
				break
			}
			if (strmid(splitword, 0, 4) == "char" & strlen(splitword) > 4) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mma_charcount(cnum, "")
					splitword = ""
					break
				}
				splitword = "" + mma_charcount(cnum, "")
				break
			}
			if (strmid(splitword, 0, 5) == "enemy" & strlen(splitword) > 5) {
				cgdatatarget = __ooo
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mma_enemycount(cgdatatarget, cnum)
					splitword = ""
					break
				}
				splitword = "" + mma_enemycount(cgdatatarget, cnum)
				break
			}
			if (strmid(splitword, 0, 5) == "dchar" & strlen(splitword) > 5) {
				cgdatatarget = __ooo
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = mma_dcharcount(cgdatatarget, cnum)
					splitword = ""
					break
				}
				splitword = "" + mma_dcharcount(cgdatatarget, cnum)
				break
			}
			if ( strmid(splitword, 0, 4) == "dist" & strlen(splitword) >= 4 ) {
				if ( __mmm == (-1) ) {
					splitword = ""
					break
				}
				if ( __nnn == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = dist(cdata(1, __mmm), cdata(2, __mmm), cdata(1, __nnn), cdata(2, __nnn))
					splitword = ""
					break
				}
				splitword = "" + dist(cdata(1, __mmm), cdata(2, __mmm), cdata(1, __nnn), cdata(2, __nnn))
				break
			}
			if (strmid(splitword, 0, 5) == "cdist" & strlen(splitword) >= 5) {
				if ( __mmm == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = dist(cdata(1, 0), cdata(2, 0), cdata(1, __mmm), cdata(2, __mmm))
					splitword = ""
					break
				}
				splitword = "" + dist(cdata(1, 0), cdata(2, 0), cdata(1, __mmm), cdata(2, __mmm))
				break
			}
			if ( strmid(splitword, 0, 5) == "tdist" & strlen(splitword) >= 5 ) {
				if ( __nnn == (-1) ) {
					splitword = ""
					break
				}
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(sdata) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = dist(cdata(1, 0), cdata(2, 0), cdata(1, __nnn), cdata(2, __nnn))
					splitword = ""
					break
				}
				splitword = "" + dist(cdata(1, 0), cdata(2, 0), cdata(1, __nnn), cdata(2, __nnn))
				break
			}
			if ( strmid(splitword, 0, 4) == "time" & strlen(splitword) > 4 ) {
				cnum = int(strmid(splitword, 4, strlen(splitword) - 4))
				if ( cnum < 0 | cnum > 7 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 4 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 4 + 1 + cope + 3, strlen(splitword) - (4 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = gettime(cnum)
					splitword = ""
					break
				}
				splitword = "" + gettime(cnum)
				break
			}
			//行動する人のローカル変数
			if (strmid(splitword, 0, 6) == "tlbuff" & strlen(splitword) > 6) {
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= 10 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "add")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __mmm) += onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "sub")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __mmm) -= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mpl")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __mmm) *= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "div")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						ocdata(cnum + 130, __mmm) /= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mod")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						ocdata(cnum + 130, __mmm) \= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "set")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __mmm) = onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "rnd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum > 0 ) {
						ocdata(cnum + 130, __mmm) = rnd(onum) + 1
					} else {
						ocdata(cnum + 130, __mmm) = 0
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = ocdata(cnum + 130, __mmm)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pop")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __mmm) = cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pad")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __mmm) += cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psb")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __mmm) -= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmp")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __mmm) *= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pdv")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						ocdata(cnum + 130, __mmm) /= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						ocdata(cnum + 130, __mmm) \= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "prd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __mmm) = 0
					if ( cmgbuff(onum) > 0 ) {
						ocdata(cnum + 130, __mmm) = rnd(cmgbuff(onum)) + 1
					}
					splitword = ""
					break
				}
				splitword = "" + ocdata(cnum + 130, __mmm)
				break
			}
			//ターゲットのローカル変数
			if (strmid(splitword, 0, 6) == "tlbuff" & strlen(splitword) > 6) {
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= 10 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "add")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __nnn) += onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "sub")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __nnn) -= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mpl")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __nnn) *= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "div")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						ocdata(cnum + 130, __nnn) /= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mod")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						ocdata(cnum + 130, __nnn) \= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "set")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, __nnn) = onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "rnd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum > 0 ) {
						ocdata(cnum + 130, __nnn) = rnd(onum) + 1
					} else {
						ocdata(cnum + 130, __nnn) = 0
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = ocdata(cnum + 130, __nnn)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pop")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __nnn) = cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pad")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __nnn) += cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psb")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __nnn) -= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmp")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __nnn) *= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pdv")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						ocdata(cnum + 130, __nnn) /= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						ocdata(cnum + 130, __nnn) \= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "prd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, __nnn) = 0
					if ( cmgbuff(onum) > 0 ) {
						ocdata(cnum + 130, __nnn) = rnd(cmgbuff(onum)) + 1
					}
					splitword = ""
					break
				}
				splitword = "" + ocdata(cnum + 130, __nnn)
				break
			}
			//プレイヤーのローカル変数
			if (strmid(splitword, 0, 6) == "plbuff" & strlen(splitword) > 6) {
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= 10 ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "add")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, 0) += onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "sub")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, 0) -= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mpl")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, 0) *= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "div")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						ocdata(cnum + 130, 0) /= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mod")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						ocdata(cnum + 130, 0) \= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "set")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					ocdata(cnum + 130, 0) = onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "rnd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum > 0 ) {
						ocdata(cnum + 130, 0) = rnd(onum) + 1
					} else {
						ocdata(cnum + 130, 0) = 0
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = ocdata(cnum + 130, 0)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pop")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, 0) = cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pad")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, 0) += cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psb")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, 0) -= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmp")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, 0) *= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pdv")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						ocdata(cnum + 130, 0) /= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						ocdata(cnum + 130, 0) \= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "prd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					ocdata(cnum + 130, 0) = 0
					if ( cmgbuff(onum) > 0 ) {
						ocdata(cnum + 130, 0) = rnd(cmgbuff(onum)) + 1
					}
					splitword = ""
					break
				}
				splitword = "" + ocdata(cnum + 130, 0)
				break
			}
			if ( strmid(splitword, 0, 5) == "pdata" & strlen(splitword) > 5 ) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				if ( cnum < 0 | cnum >= length(cmgbuff) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "add")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					cmgbuff(cnum) += onum
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "sub")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					cmgbuff(cnum) -= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "mpl")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					cmgbuff(cnum) *= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "div")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum != 0 ) {
						cmgbuff(cnum) /= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "mod")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum != 0 ) {
						cmgbuff(cnum) \= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "set")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					cmgbuff(cnum) = onum
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "rnd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum > 0 ) {
						cmgbuff(cnum) = rnd(onum) + 1
					}
					else {
						cmgbuff(cnum) = 0
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cmgbuff(cnum)
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "pop")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(cnum) = cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "pad")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(cnum) += cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "psb")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(cnum) -= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "pmp")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(cnum) *= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "pdv")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						cmgbuff(cnum) /= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "pmd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( cmgbuff(onum) != 0 ) {
						cmgbuff(cnum) \= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 5 + 1, "prd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(cnum) = 0
					if ( cmgbuff(onum) > 0 ) {
						cmgbuff(cnum) = rnd(cmgbuff(onum)) + 1
					}
					splitword = ""
					break
				}
				splitword = "" + cmgbuff(cnum)
				break
			}
			if ( strmid(splitword, 0, 6) == "gpdata" & strlen(splitword) > 6 ) {
				cnum = int(strmid(splitword, 6, strlen(splitword) - 6))
				if ( cnum < 0 | cnum >= length(nc_cmgbuff) ) {
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "add")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					nc_cmgbuff(cnum) += onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "sub")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					nc_cmgbuff(cnum) -= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mpl")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					nc_cmgbuff(cnum) *= onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "div")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						nc_cmgbuff(cnum) /= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "mod")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum != 0 ) {
						nc_cmgbuff(cnum) \= onum
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "set")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					nc_cmgbuff(cnum) = onum
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "rnd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum > 0 ) {
						nc_cmgbuff(cnum) = rnd(onum) + 1
					}
					else {
						nc_cmgbuff(cnum) = 0
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = nc_cmgbuff(cnum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pop")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					nc_cmgbuff(cnum) = cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pad")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					nc_cmgbuff(cnum) += cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "psb")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					nc_cmgbuff(cnum) -= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmp")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					nc_cmgbuff(cnum) *= cmgbuff(onum)
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pdv")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( nc_cmgbuff(onum) != 0 ) {
						nc_cmgbuff(cnum) /= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "pmd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					if ( nc_cmgbuff(onum) != 0 ) {
						nc_cmgbuff(cnum) \= cmgbuff(onum)
					}
					splitword = ""
					break
				}
				cope = instr(splitword, 6 + 1, "prd")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 6 + 1 + cope + 3, strlen(splitword) - (6 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					nc_cmgbuff(cnum) = 0
					if ( nc_cmgbuff(onum) > 0 ) {
						nc_cmgbuff(cnum) = rnd(cmgbuff(onum)) + 1
					}
					splitword = ""
					break
				}
				splitword = "" + nc_cmgbuff(cnum)
				break
			}
			if ( strmid(splitword, 0, 5) == "value" & strlen(splitword) > 5 ) {
				cnum = int(strmid(splitword, 5, strlen(splitword) - 5))
				cope = instr(splitword, 5 + 1, "psh")
				if ( cope != (-1) & strlen(splitword) > cope + 3 ) {
					onum = int(strmid(splitword, 5 + 1 + cope + 3, strlen(splitword) - (5 + 1 + cope + 3)))
					if ( onum < 0 | onum >= length(cmgbuff) ) {
						splitword = ""
						break
					}
					cmgbuff(onum) = cnum
					splitword = ""
					break
				}
			}
			if ( splitword == "punishment" ) {
				if (isgodtalk == 0) {
					splitword = ""
					break
				}
				evadd 2402, 0
				splitword = ""
				break
			}
			if ( splitword == "gainfaith" ) {
				if (isgodtalk == 0) {
					splitword = ""
					break
				}
				evadd 2403, 0
				splitword = ""
				break
			}
			if ( splitword == "losefaith" ) {
				if (isgodtalk == 0) {
					splitword = ""
					break
				}
				evadd 2404, 0
				splitword = ""
				break
			}
			if (splitword == "gainimp") {
				if (__mmm != (-1)) {
					modimp __mmm, 15
					cEmotionIcon(__mmm) = 17 + 100 * 3
				}
				splitword = ""
				break
			}
			if (splitword == "lostimp") {
				if (__mmm != (-1)) {
					modimp __mmm, -15
					cEmotionIcon(__mmm) = 18 + 100 * 3
				}
				splitword = ""
				break
			}
			// NCEND
			if (splitword == "n") {
				splitword = "#n#"
				break
			}
			if (splitword == "ある") {
				splitword = _aru(3)
				break
			}
			if (splitword == "が") {
				splitword = _ga(3)
				break
			}
			if (splitword == "か") {
				splitword = _ka(3)
				break
			}
			if (splitword == "かな") {
				splitword = _kana(3)
				break
			}
			if (splitword == "だ") {
				splitword = _da(3)
				break
			}
			if (splitword == "よ") {
				splitword = _yo(3)
				break
			}
			if (splitword == "だな") {
				splitword = _dana(3)
				break
			}
			if (splitword == "だろ") {
				splitword = _daro(3)
				break
			}
			if (splitword == "る") {
				splitword = _ru(3)
				break
			}
			if (splitword == "のだ") {
				splitword = _nda(3)
				break
			}
			if (splitword == "な") {
				splitword = _na(3)
				break
			}
			if (splitword == "くれ") {
				splitword = _kure(3)
				break
			}
			if (splitword == "う") {
				splitword = _u(3)
				break
			}
			if (splitword == "たのむ") {
				splitword = _tanomu(3)
				break
			}
			if (splitword == "兄") {
				splitword = _nii(cSex(0))
				break
			}
			if (splitword == "c兄") {
				if ( __mmm == (-1) ) {
					splitword = _nii(0)
					break
				}
				splitword = _nii(cSex(__mmm))
				break
			}
			if (splitword == "t兄") {
				if ( __nnn == (-1) ) {
					splitword = _nii(0)
					break
				}
				splitword = _nii(cSex(__nnn))
				break
			}
			if (splitword == "newline") {
				splitword = "#n#"
				break
			}
			if (splitword == "onii") {
				splitword = _onii(cSex(0))
				break
			}
			if (splitword == "onii2") {
				splitword = _onii4(cSex(0))
				break
			}
			if (splitword == "syujin") {
				splitword = _syujin(cSex(0))
				break
			}
		loop
		__mmm = splitword(1) + splitword + splitword(2)
	loop
	return
*label_0223
	buff = strmid(buff, p, instr(buff, p, "%END"))
	if (noteinfo(0) <= 1) {
		buff3 = ""
		notesel buff3
		noteload exedir + "data\\st_talk.txt"
		buff2 = ""
		notesel buff2
		noteload exedir + "data\\oo_talk.txt"
		buff = ""
		notesel buff
		noteload exedir + "data\\talk.txt"
		buff += "\n" + buff2 + "\n" + buff3
		if (rnd(5)) {
			p = instr(buff, 0, "%DEFAULT," + lang("JP", "EN"))
		} else {
			p = instr(buff, 0, "%O_DEFAULT," + lang("JP", "EN"))
		}
		buff = strmid(buff, p, instr(buff, p, "%END"))
	}
	notedel 0
	p = rnd(noteinfo(0))
	noteget s, p
	buff = s
	convert_word buff, cc, tc
	return
*label_0224
	buff3 = ""
	notesel buff3
	noteload exedir + "data\\st_talk.txt"
	buff2 = ""
	notesel buff2
	noteload exedir + "data\\oo_talk.txt"
	buff = ""
	notesel buff
	noteload exedir + "data\\talk.txt"
	buff += "\n" + buff2 + "\n" + buff3
	p = instr(buff, 0, valn + "," + lang("JP", "EN"))
	gosub *label_0223
	return
*label_0225
	buff3 = ""
	notesel buff3
	noteload exedir + "data\\st_talk.txt"
	buff2 = ""
	notesel buff2
	noteload exedir + "data\\oo_talk.txt"
	buff = ""
	notesel buff
	noteload exedir + "data\\talk.txt"
	buff += "\n" + buff2 + "\n" + buff3
	p = -1
	repeat 1
		if (cRole(tc) == 18 | cRole(tc) == 10018) {
			if (gNumberOfWaitingGuests > 0) {
				talkref = 1
				p = instr(buff, 0, "%MAID," + lang("JP", "EN"))
				break
			}
		}
		if (cInterest(tc) <= 0) {
			p = instr(buff, 0, "%BORED," + lang("JP", "EN"))
			break
		}
		if (petcheck(tc)) {
			p = instr(buff, 0, "%ALLY_DEFAULT," + lang("JP", "EN"))
			break
		}
		if (cId(tc) == 335 | eqfaction(tc, "whole")) {
			p = instr(buff, 0, "%BITCH," + lang("JP", "EN"))
			break
		}
		if (cRole(tc) == 1015) {
			p = instr(buff, 0, "%MOYER," + lang("JP", "EN"))
			break
		}
		if (cRole(tc) == 17) {
			p = instr(buff, 0, "%SLAVEKEEPER," + lang("JP", "EN"))
			break
		}
		if (chara_isShopKeeper(tc)) {
			if (rnd(3)) {
				if (rnd(5)) {
					p = instr(buff, 0, "%SHOPKEEPER," + lang("JP", "EN"))
				} else {
					p = instr(buff, 0, "%O_SHOPKEEPER," + lang("JP", "EN"))
				}
				break
			}
		}
		if (cImpression(tc) >= 100) {
			if (rnd(3) == 0) {
				p = instr(buff, 0, "%RUMOR,LOOT," + lang("JP", "EN"))
				break
			}
		}
		if (areaChristmasFestival(gCurrentMap)) {
			if (gCurrentMap == 33) {
				if (rnd(3)) {
					p = instr(buff, 0, "%FEST," + gCurrentMap + "," + lang("JP", "EN"))
					break
				}
			}
		}
		if (rnd(2)) {
			if (gCurrentMap == 50 || gCurrentMap == 51 || gCurrentMap == 52 || gCurrentMap == 53 || gCurrentMap == 54 || gCurrentMap == 55) {
				p = instr(buff, 0, "%ST_PERSONALITY," + cPersonality(tc) + "," + lang("JP", "EN"))
			} else {
				if (rnd(5)) {
					p = instr(buff, 0, "%PERSONALITY," + cPersonality(tc) + "," + lang("JP", "EN"))
				} else {
					p = instr(buff, 0, "%O_PERSONALITY," + cPersonality(tc) + "," + lang("JP", "EN"))
				}
			}
			break
		}
		if (rnd(3)) {
			if (rnd(5)) {
				p = instr(buff, 0, "%AREA," + gCurrentMap + "," + lang("JP", "EN"))
			} else {
				p = instr(buff, 0, "%O_AREA," + gCurrentMap + "," + lang("JP", "EN"))
			}
			break
		}
	loop
	if (p == (-1)) {
		if (gCurrentMap == 50 || gCurrentMap == 51 || gCurrentMap == 52 || gCurrentMap == 53 || gCurrentMap == 54 || gCurrentMap == 55) {
			p = instr(buff, 0, "%ST_DEFAULT," + lang("JP", "EN"))
		} else {
			if (rnd(5)) {
				p = instr(buff, 0, "%DEFAULT," + lang("JP", "EN"))
			} else {
				p = instr(buff, 0, "%O_DEFAULT," + lang("JP", "EN"))
			}
		}
	}
	gosub *label_0223
	return



#defcfunc cnvweight int __ppp
	s@m35 = "" + abs(__ppp) / 1000 + "." + abs(__ppp) \ 1000 / 100 + "" + strweight
	return s@m35



#include "fltname.hsp"



#deffunc addnews2 str __rrr, int __sss
	n@m36 = __rrr
	if (__sss) {
		txtef 13
		txt -1, "[News] " + n@m36
	}
	talk_conv n@m36, 38 - en * 5
	newsbuff += n@m36 + "\n"
	return



#deffunc addnewstopic str __ttt, str __uuu, int __vvv
	addnews2 __ttt + " " + gYear + "/" + gMonth + "/" + gDay + " h" + gHour + "" + " " + __uuu
	throwsstpevent "AddNewsTopic", __vvv, __uuu, 0
	return



#deffunc addnews int __vvv, int __www
	if (__vvv == 0) {
		addnews2 valn
		newsbuff += "\n"
		return
	}
	if (__vvv == 1) {
		addnewstopic "@01", lang("アイテム発見", "Discovery"), __www
		addnews2 lang(cdatan(1, __www) + " " + cdatan(0, __www) + "は" + mapname(cCurrentMap(__www)) + "にて" + valn + "を入手した。", cdatan(1, __www) + " " + cdatan(0, __www) + " has discovered " + valn + " in " + mapname(cCurrentMap(__www)) + "."), 1
	}
	if (__vvv == 2) {
		addnewstopic "@02", lang("新たなる力", "Growth"), __www
		addnews2 lang(cdatan(1, __www) + " " + cdatan(0, __www) + "は経験をつみ、レベル" + cLevel(__www) + "になった。", cdatan(1, __www) + " " + cdatan(0, __www) + " has gained experience and achieved level " + cLevel(__www) + "."), 1
	}
	if (__vvv == 3) {
		addnewstopic "@02", lang("怪我からの復帰", "Recovery from injury"), __www
		addnews2 lang(cdatan(1, __www) + " " + cdatan(0, __www) + "は怪我から回復した。", cdatan(1, __www) + " " + cdatan(0, __www) + " has fully recovered from injury."), 1
	}
	if (__vvv == 4) {
		addnewstopic "@03", lang("クエストの達成", "Accomplishment"), __www
		addnews2 lang(cdatan(1, __www) + " " + cdatan(0, __www) + "はクエストを達成し、" + val + "の名声を手にした。", cdatan(1, __www) + " " + cdatan(0, __www) + " has finished a quest and gained " + val + " fame."), 1
	}
	if (__vvv == 5) {
		addnewstopic "@04", lang("引退", "Retirement"), __www
		addnews2 lang(cdatan(1, __www) + " " + cdatan(0, __www) + "は自分の力の限界を悟り、ノースティリスから去っていった。", cdatan(1, __www) + " " + cdatan(0, __www) + " realizes the limitations and leaves North Tyris."), 1
	}
	newsbuff += "\n"
	return
*label_0238
	tmset
	time_warn = timeGetTime() / 1000
	time_begin = timeGetTime() / 1000
	oomSEST_log "system_init"
	exist exedir + "config.txt"
	if (strsize == (-1)) {
		bcopy exedir + "original\\" + "config.txt", exedir + "config.txt"
	}
	exist exedir + "omake_config.txt"
	if (strsize == (-1)) {
		omakeconfigstr = "[Omake Config]\n"
		bsave exedir + "omake_config.txt", omakeconfigstr, 16
	}
	exist exedir + "user\\export.txt"
	if (strsize == (-1)) {
		bcopy exedir + "original\\" + "export.txt", exedir + "user\\export.txt"
	}
	exist exedir + "user\\lastwords.txt"
	if (strsize == (-1)) {
		bcopy exedir + "original\\" + "lastwords.txt", exedir + "user\\lastwords.txt"
	}
	exist exedir + "user\\lastwords-e.txt"
	if (strsize == (-1)) {
		bcopy exedir + "original\\" + "lastwords-e.txt", exedir + "user\\lastwords-e.txt"
	}
	exist exedir + "user\\music\\musiclist.txt"
	if (strsize == (-1)) {
		bcopy "musiclist.txt", exedir + "user\\music\\musiclist.txt"
	}
	exist exedir + "user\\graphic\\face1.bmp"
	if (strsize == (-1)) {
		bcopy exedir + "original\\" + "face1.bmp", exedir + "user\\graphic\\face1.bmp"
	}
	exist exedir + "user\\graphic\\chara_500.bmp"
	if (strsize == (-1)) {
		bcopy "500.bmp", exedir + "user\\graphic\\chara_500.bmp"
	}
	exist exedir + "user\\graphic\\chara_286.bmp"
	if (strsize == (-1)) {
		bcopy "286.bmp", exedir + "user\\graphic\\chara_286.bmp"
	}
	exist exedir + "user\\graphic\\chara_453.bmp"
	if (strsize == (-1)) {
		bcopy "453.bmp", exedir + "user\\graphic\\chara_453.bmp"
	}
	exist exedir + "user\\graphic\\chara_454.bmp"
	if (strsize == (-1)) {
		bcopy "454.bmp", exedir + "user\\graphic\\chara_454.bmp"
	}
	exist exedir + "user\\graphic\\chara_455.bmp"
	if (strsize == (-1)) {
		bcopy "455.bmp", exedir + "user\\graphic\\chara_455.bmp"
	}
	exist exedir + "user\\graphic\\chara_456.bmp"
	if (strsize == (-1)) {
		bcopy "456.bmp", exedir + "user\\graphic\\chara_456.bmp"
	}
	exist exedir + "user\\graphic\\chara_457.bmp"
	if (strsize == (-1)) {
		bcopy "457.bmp", exedir + "user\\graphic\\chara_457.bmp"
	}
	exist exedir + "user\\graphic\\chara_458.bmp"
	if (strsize == (-1)) {
		bcopy "458.bmp", exedir + "user\\graphic\\chara_458.bmp"
	}
	exist exedir + "user\\graphic\\chara_459.bmp"
	if (strsize == (-1)) {
		bcopy "459.bmp", exedir + "user\\graphic\\chara_459.bmp"
	}
	exist exedir + "user\\graphic\\chara_460.bmp"
	if (strsize == (-1)) {
		bcopy "460.bmp", exedir + "user\\graphic\\chara_460.bmp"
	}
	exist exedir + "user\\graphic\\chara_461.bmp"
	if (strsize == (-1)) {
		bcopy "461.bmp", exedir + "user\\graphic\\chara_461.bmp"
	}
	exist exedir + "user\\graphic\\chara_501.bmp"
	if (strsize == (-1)) {
		bcopy "501.bmp", exedir + "user\\graphic\\chara_501.bmp"
	}
	exist exedir + "user\\graphic\\chara_502.bmp"
	if (strsize == (-1)) {
		bcopy "502.bmp", exedir + "user\\graphic\\chara_502.bmp"
	}
	exist exedir + "user\\graphic\\chara_503.bmp"
	if (strsize == (-1)) {
		bcopy "503.bmp", exedir + "user\\graphic\\chara_503.bmp"
	}
	exist exedir + "user\\graphic\\chara_504.bmp"
	if (strsize == (-1)) {
		bcopy "504.bmp", exedir + "user\\graphic\\chara_504.bmp"
	}
	exist exedir + "user\\graphic\\chara_505.bmp"
	if (strsize == (-1)) {
		bcopy "505.bmp", exedir + "user\\graphic\\chara_505.bmp"
	}
	exist exedir + "user\\graphic\\chara_506.bmp"
	if (strsize == (-1)) {
		bcopy "506.bmp", exedir + "user\\graphic\\chara_506.bmp"
	}
	exist exedir + "user\\graphic\\chara_507.bmp"
	if (strsize == (-1)) {
		bcopy "507.bmp", exedir + "user\\graphic\\chara_507.bmp"
	}
	exist exedir + "user\\graphic\\chara_508.bmp"
	if (strsize == (-1)) {
		bcopy "508.bmp", exedir + "user\\graphic\\chara_508.bmp"
	}
	exist exedir + "user\\graphic\\chara_509.bmp"
	if (strsize == (-1)) {
		bcopy "509.bmp", exedir + "user\\graphic\\chara_509.bmp"
	}
	exist exedir + "user\\graphic\\chara_510.bmp"
	if (strsize == (-1)) {
		bcopy "510.bmp", exedir + "user\\graphic\\chara_510.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_29.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_29.bmp", exedir + "user\\graphic\\buffIcon_29.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_30.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_30.bmp", exedir + "user\\graphic\\buffIcon_30.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_31.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_31.bmp", exedir + "user\\graphic\\buffIcon_31.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_32.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_32.bmp", exedir + "user\\graphic\\buffIcon_32.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_33.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_33.bmp", exedir + "user\\graphic\\buffIcon_33.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_35.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_35.bmp", exedir + "user\\graphic\\buffIcon_35.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_36.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_36.bmp", exedir + "user\\graphic\\buffIcon_36.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_37.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_37.bmp", exedir + "user\\graphic\\buffIcon_37.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_38.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_38.bmp", exedir + "user\\graphic\\buffIcon_38.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_39.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_39.bmp", exedir + "user\\graphic\\buffIcon_39.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_67.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_67.bmp", exedir + "user\\graphic\\buffIcon_67.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_68.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_68.bmp", exedir + "user\\graphic\\buffIcon_68.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_69.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_69.bmp", exedir + "user\\graphic\\buffIcon_69.bmp"
	}
	exist exedir + "user\\graphic\\buffIcon_70.bmp"
	if (strsize == (-1)) {
		bcopy "buffIcon_70.bmp", exedir + "user\\graphic\\buffIcon_70.bmp"
	}
	ooversion = 0
	exist exedir + "data\\oo_version"
	if (strsize != (-1)) {
		sdim buff, strsize
		bload exedir + "data\\oo_version", buff, strsize
		ooversion = int(buff)
	}
	if (ooversion < 119) {
		dirlist buff, exedir + "user\\npc\\omake_overhaul\\*.unpc"
		notesel buff
		repeat stat
			noteget file, cnt
			delete exedir + "user\\npc\\omake_overhaul\\" + file
		loop
	}
	if (ooversion < 110) {
		exist exedir + "data\\oo_talk.txt"
		if (strsize != (-1)) {
			delete exedir + "data\\oo_talk.txt"
		}
	}
	if (ooversion < 123) {
		exist exedir + "data\\oo_class.csv"
		if (strsize != (-1)) {
			delete exedir + "data\\oo_class.csv"
		}
	}
	exist exedir + "data\\st_talk.txt"
	if (strsize == (-1)) {
		bcopy "st_talk.txt", exedir + "data\\st_talk.txt"
	}
	if (ooversion < 177) {
		exist exedir + "user\\item\\omake_overhaul\\class change license.ooitem"
		if (strsize != (-1)) {
			delete exedir + "user\\item\\omake_overhaul\\class change license.ooitem"
		}
		exist exedir + "data\\oo_class.csv"
		if (strsize != (-1)) {
			bcopy exedir + "data\\oo_class.csv", exedir + "data\\oo_class.csv.old"
			delete exedir + "data\\oo_class.csv"
		}
	}
	exist exedir + "data\\o_race.csv"
	if (strsize == (-1)) {
		bcopy "o_race.csv", exedir + "data\\o_race.csv"
	}
	exist exedir + "data\\nc_race.csv"
	if (strsize == (-1)) {
		bcopy "nc_race.csv", exedir + "data\\nc_race.csv"
	}
	exist exedir + "data\\nc_skill.db"
	if (strsize == (-1)) {
		bcopy "nc_skill.db", exedir + "data\\nc_skill.db"
	}
	exist exedir + "user\\graphic\\menu_22.bmp"
	if (strsize == (-1)) {
		bcopy "menu_22.bmp", exedir + "user\\graphic\\menu_22.bmp"
	}
	exist exedir + "user\\graphic\\menu_23.bmp"
	if (strsize == (-1)) {
		bcopy "menu_23.bmp", exedir + "user\\graphic\\menu_23.bmp"
	}
	repeat 14, 80
		exist exedir + "user\\graphic\\buffIcon_" + cnt + ".bmp"
		if (strsize == (-1)) {
			bcopy "buffIcon_" + cnt + ".bmp", exedir + "user\\graphic\\buffIcon_" + cnt + ".bmp"
		}
	loop
	repeat 3, 96
		exist exedir + "user\\graphic\\buffIcon_" + cnt + ".bmp"
		if (strsize == (-1)) {
			bcopy "buffIcon_" + cnt + ".bmp", exedir + "user\\graphic\\buffIcon_" + cnt + ".bmp"
		}
	loop
	repeat 7, 60
		exist exedir + "user\\graphic\\buffIcon_" + cnt + ".bmp"
		if (strsize == (-1)) {
			bcopy "buffIcon_" + cnt + ".bmp", exedir + "user\\graphic\\buffIcon_" + cnt + ".bmp"
		}
	loop
	repeat 2
		exist exedir + "user\\graphic\\anime" + (29 + cnt) + ".bmp"
		if (strsize == (-1)) {
			bcopy "anime" + (29 + cnt) + ".bmp", exedir + "user\\graphic\\anime" + (29 + cnt) + ".bmp"
		}
	loop
	exist exedir + "data\\oo_talk.txt"
	if (strsize == (-1)) {
		bcopy "oo_talk.txt", exedir + "data\\oo_talk.txt"
	}
	exist exedir + "data\\oo_class.csv"
	if (strsize == (-1)) {
		bcopy "oo_class.csv", exedir + "data\\oo_class.csv"
	}
	gosub *label_1362
	sdim s, 160, 40
	dim p, 100
	dim rtval, 10
	sdim rtvaln, 50, 10
	sdim key_select, 2, 30
	sdim buff, 10000
	sdim splitbuff, 400, 10
	playerid = ""
	gosub *label_1589
	gosub *label_1591
	gosub *label_1592
	gosub *label_0618
	gosub *label_1590
	gosub *label_1659
	if (cfg_fullscreen) {
		chgdisp 1, windoww, windowh
		bgscr 0, windoww, windowh, 0, 0
		width windoww, windowh, 0, 0
	} else {
		screen 0, windoww, windowh, 0, windowx, windowy
	}
	gsel 0
	redraw 0
	color 0
	boxf
	redraw 1
	onkey gosub *label_1348
	onkey 0
	onexit goto *system_quitElona
	exist exedir + "user\\graphic\\target.bmp"
	if (strsize == (-1)) {
		existfile_target = 0
	} else {
		existfile_target = 1
		buffer 99
		picload_ exedir + "user\\graphic\\target.bmp"
	}
	exist exedir + "user\\graphic\\fruitTrees.bmp"
	if (strsize == (-1)) {
		existfile_fruittrees = 0
	} else {
		existfile_fruittrees = 1
		buffer 98
		picload_ exedir + "user\\graphic\\fruitTrees.bmp"
	}
	exist exedir + "user\\graphic\\minimap.bmp"
	if (strsize == (-1)) {
		existfile_minimap = 0
	} else {
		existfile_minimap = 1
		buffer 97
		picload_ exedir + "user\\graphic\\minimap.bmp"
	}
	exist exedir + "user\\graphic\\map1.bmp"
	if (strsize == (-1)) {
		existfile_map = 0
	} else {
		existfile_map = 1
	}
	buffer 96, 48 * 10, 48 * 6
	color 0, 0, 0
	boxf
	repeat 49, 1
		s = exedir + "user\\graphic\\mapchip" + cnt + ".bmp"
		exist s
		if (strsize != (-1)) {
			pos cnt \ 10 * 48, cnt / 10 * 48
			picload_ s, 1
		}
	loop
	buffer 95, 48 * 33, 48 * 2 * 5
	color 0, 0, 0
	boxf
	buffer 94, 600, 400
	repeat 20
		buffer 200 + cnt
	loop
	// +126 はエンチャアイコンの分 (see also encicon.hsp)
	buffer 3, 1440, 800 + 126
	picload_ exedir + "\\graphic\\interface.bmp", 1
	folder = exedir + "user\\graphic\\"
	dirlist buff, folder + "menu_*.bmp"
	notesel buff
	repeat stat
		noteget file, cnt
		p = int(strmid(file, 5, instr(file, 5, ".")))
		pos 290 + p * 48, 48
		picload_ folder + file, 1
	loop
	buffer 4, limit(windoww, 1280, 10000), limit(windowh, 896, 10000)
	cfg_exlog = 1
	if (cfg_exlog) {
		buffer 8, windoww, windowh
		p = windoww / 192
		repeat inf_maxlog
			cnt2 = cnt
			repeat p + 1
				if (cnt == p) {
					x = (windoww - inf_msgx) \ 192
				} else {
					x = 192
				}
				pos cnt * 192, cnt2 * inf_msgspace
				gcopy 3, 496, 536 + cnt2 \ 4 * inf_msgspace, x, inf_msgspace
			loop
		loop
		gsel 0
	}
	oomSEST_log "Init buffer"
	if (cfg_useffhp) {
		folder = exedir + "user\\graphic\\"
		buffer 1, 33 * 48, 25 * 48
		picload_ exedir + "graphic\\" + "item.bmp", 1
		dirlist buff, folder + "item_*.bmp"
		notesel buff
		repeat stat
			noteget file, cnt
			p = int(strmid(file, 5, instr(file, 5, ".")))
			pos p \ 33 * inf_tiles, p / 33 * inf_tiles
			picload_ folder + file, 1
		loop

		// カスタムアイテム画像機能
		repeat 32
			file = exedir + "user\\graphic\\item_u" + str(cnt + 1) + ".bmp"
			exist file
			if (strsize == (-1)) {
				break
			} else {
				pos 48 * (cnt + 1), 48 * 1
				picload_ file, 1
			}
		loop

		exist exedir + "graphic\\item_707.bmp"
		if (strsize == -1) {
			// 英雄チーズをクリームチーズの場所にコピー
			pos 48 * 14, 48 * 21
			gcopy 1, 48 * 3, 48 * 5, inf_tiles, inf_tiles
		}

		exist exedir + "user\\graphic\\item_710.bmp"
		if (strsize == (-1)) {
			bcopy "item_710.bmp", exedir + "user\\graphic\\item_710.bmp"
		}

		exist exedir + "user\\graphic\\item_711.bmp"
		if (strsize == (-1)) {
			bcopy "item_711.bmp", exedir + "user\\graphic\\item_711.bmp"
		}

		if (inf_tiles != 48) {
			pos 0, 0
			gzoom 33 * inf_tiles, 25 * inf_tiles, 1, 0, 0, 33 * 48, 25 * 48
		}
		buffer 31, 33 * 48, 25 * 48
		file = exedir + "graphic\\" + "itemEx.bmp"
		exist file
		if (strsize == (-1)) {
			use_exticon = 0
		} else {
			use_exticon = 1
			picload_ file, 1
			dirlist buff, folder + "itemEx_*.bmp"
			notesel buff
			repeat stat
				noteget file, cnt
				p = int(strmid(file, 7, instr(file, 7, ".")))
				pos p \ 33 * inf_tiles, p / 33 * inf_tiles
				picload_ folder + file, 1
			loop
			if (inf_tiles != 48) {
				pos 0, 0
				gzoom 33 * inf_tiles, 25 * inf_tiles, 31, 0, 0, 33 * 48, 25 * 48
			}
		}
	} else {
		folder = exedir + "user\\graphic\\"
		buffer 1, 33 * 48, 25 * 48
		picload_ exedir + "\\graphic\\item.bmp", 1

		// 英雄チーズを乳料理の場所にコピー
		repeat 9
			pos 48 * (7 + cnt), 48 * 21
			gcopy 1, 48 * 3, 48 * 5, inf_tiles, inf_tiles
		loop

		// カスタムアイテム画像機能
		repeat 32
			file = exedir + "user\\graphic\\item_u" + str(cnt + 1) + ".bmp"
			exist file
			if (strsize == (-1)) {
				break
			} else {
				pos 48 * (cnt + 1), 48 * 1
				picload_ file, 1
			}
		loop

		if (inf_tiles != 48) {
			pos 0, 0
			gzoom 33 * inf_tiles, 25 * inf_tiles, 1, 0, 0, 33 * 48, 25 * 48
		}

	}

	buffer 2, 33 * inf_tiles, 25 * inf_tiles
	buffer 6, 33 * inf_tiles, 25 * inf_tiles
	buffer 7, 24, 24
	buffer 9, 24, 24
	buffer 32, 80, 112
	buffer 36, windoww, windowh - inf_verh, 1

	/* oomSEST begin */
	encIcon_loadEncIcons
	/* oomSEST end */

	repeat 256
		palette cnt, cnt, cnt, cnt, cnt == 255
	loop
	oomSEST_log "dim"
	dim initeq, 3, 50
	dup eqhelm, initeq(0, 0)
	dup eqweapon1, initeq(0, 1)
	dup eqshield, initeq(0, 2)
	dup eqrange, initeq(0, 3)
	dup eqammo, initeq(0, 4)
	dup eqweapon2, initeq(0, 5)
	dup eqarmor, initeq(0, 6)
	dup eqglove, initeq(0, 7)
	dup eqboots, initeq(0, 8)
	dup eqcloack, initeq(0, 9)
	dup eqgirdle, initeq(0, 10)
	dup eqring1, initeq(0, 11)
	dup eqring2, initeq(0, 12)
	dup eqamulet1, initeq(0, 13)
	dup eqamulet2, initeq(0, 14)
	dim cmapdata, 5, 400
	dim fixeditemenc, 10 * 2
	dim dir, 5
	dim dblist, 2, 800
	dim unlist, 800
	dim citemlist, 800
	sdim csv, 1000, 40
	sdim filemod
	sdim loadedbuff, 20000
	memset loadedbuff, 0, 20000
	bufflast = 0
	loadedbuffmax = 20000
	sdim csvbuff, 10000
	sdim csvidx, 100, 40
	sdim inputlog, 100
	sdim key, 20
	sdim keylog, 20
	sdim msg, 120, inf_maxlog
	sdim msgtemp, 1000
	sdim msgref, 200
	sdim randn1, 30, 20
	sdim randn2, 30, 20
	sdim select, 200
	dim n, 40
	dim rtval, 10
	dim list, 3, 1000
	dim list_bk, 3, 1000
	sdim listn, 40, 2, 1000
	dim invctrl, 2
	sdim promptl, 50, 3, 20
	sdim description, 1000, 3
	sdim file, 1000
	sdim folder, 1000
	sdim msgtempprev
	dim mef, 9, 200
	dim adata, 40, 500
	dim qdata, 20, 500
	sdim qname, 40, 500
	dim oqdata, 1, 500
	dim gdata, 1000
	dim genetemp, 1000
	sdim gdatan, 40, 50
	dim mdatatmp, 100
	dim mdata, 100
	sdim mdatan, 20, 2
	sdim cdatan, 40, 10, 245
	sdim s1, 1000
	dim cdata, 500, 245
	dim sdata, 1200, 245
	dim sdataEx, 600, 245
	dim spell, 200
	dim spact, 500
	dim ospact, 300
	dim mat, 400
	dim inv, 70, 5481
	dim trait, 500
	dim itemmemory, 3, 850
	dim npcmemory, 2, 850
	dim recipememory, 1200
	dim invmark, 36
	dim commark, 3
	dim feat, 5
	sdim iname, 40
	dim val, 10
	sdim valn, 50, 10
	dim dirchk, 3, 2
	dirchk(0, 0) = -1, 0, 1
	dirchk(0, 1) = 1, 0, -1
	dim chatval, 5
	dim evlist, 10
	dim matneed, 20
	dim pcc, 30, 20
	maxrain = windoww * windowh / 3500
	dim rainx, maxrain * 2
	dim rainy, maxrain * 2
	sdim fltnrace
	sdim fltnclass
	dim card, 4, 1000
	dim deck, 1000
	dim cnpcmemory, 3, 900
	cnpcmemorymax = 0
	dim userspelldata, 14, 100
	sdim userspelldatan, 40, 6, 100
	gosub *label_0089
	gosub *label_0087
	gosub *label_0517
	gosub *label_0517_another
	dim rdata, 30, 20
	dup roomexist, rdata(0, 0)
	dup roomx, rdata(0, 1)
	dup roomy, rdata(0, 2)
	dup roomwidth, rdata(0, 3)
	dup roomheight, rdata(0, 4)
	dup roomexit, rdata(0, 5)
	dup roomexitmax, rdata(0, 6)
	dup roomentrancex, rdata(0, 7)
	dup roomentrancey, rdata(0, 8)
	dim idata, 8
	dim dirxy, 2, 4
	dirxy(0, 3) = 0, -1
	dirxy(0, 0) = 0, 1
	dirxy(0, 1) = -1, 0
	dirxy(0, 2) = 1, 0
	dim c_col, 3, 30
	c_col(0, 0) = 0, 0, 0
	c_col(0, 2) = 80, 0, 80
	c_col(0, 3) = 0, 100, 100
	c_col(0, 4) = 80, 80, 0
	c_col(0, 6) = 0, 40, 80
	c_col(0, 5) = 0, 0, 80
	c_col(0, 7) = 100, 101, 102
	c_col(0, 8) = 70, 100, 40
	c_col(0, 9) = 100, 50, 50
	c_col(0, 10) = 0, 60, 70
	c_col(0, 11) = 20, 40, 100
	c_col(0, 12) = 0, 0, 0
	c_col(0, 13) = 30, 40, 70
	c_col(0, 14) = 150, 20, 150
	c_col(0, 15) = 50, 50, 50
	c_col(0, 16) = 0, 30, 30
	c_col(0, 17) = 30, 30, 0
	c_col(0, 18) = 30, 60, 0
	c_col(0, 19) = 40, 0, 40
	c_col(0, 20) = 45, 5, 95
	text_init
	dim dirchk, 3, 2
	dirchk(0, 0) = -1, 0, 1
	dirchk(0, 1) = 1, 0, -1
	dim val_skill, 5
	sdim valn_skill, 40, 3
	dim cs_posbk, 4
	dim floorstack, 400
	sdim key_list, 2, 20
	sdim playerheader, 100
	sdim artifactlocation
	sdim newsbuff
	sdim soundfile, 30, 132
	sdim musicfile, 30, 92 + 5
	dim slight, inf_screenw + 4, inf_screenh + 4
	dim slightbk, inf_screenw + 4, inf_screenh + 4
	sdim faction, 128, 245 + 50
	dim ocdata, 250, 245
	dim ogdata, 550
	dim oadata, 50
	dim stgdata, 550
	dim ncgdata, 550
	sdim ncgsdata, 128, 100
	dim nc_ai, 16, 10, 45
	dim dim_buf, 100
	dim trophy, 50
	sdim oadatastr, 10, 32
  sdim musiclist, 40, 50
	sdim cnamelist, 40, 50
	dim cmgdata, 100, 500
	dim cmgbuff, 100
	dim nc_cmgbuff, 100

	// 引き継ぐもの
	dim takeover, 10
	takeover(0) = 1,1,1,1,1,1,1,1,1,1

	// aiページ数
	aipage = 3

	// 予約されている曲がmp3かmidか識別 0なら存在しない 1はmid 2はmp3
	dim resmusic, 50

	// Longint intを超えたつよい変数
	dimtype lint_damage,vartype("longint"),1
	dimtype lint_damage_hp,vartype("longint"),1
	dimtype lint_efp,vartype("longint"),1
  dimtype lint_buff,vartype("longint"),1

	if (jp) {
		oadatastr = "力", "忘却", "孤独", "影", "憩い", "地獄", "夢幻", "羅刹", "魔", "奈落", "狂信者", "類", "プチの巣", "不思議", "異形", "暗闇", "盗賊", "《白夜》", "《極夜》"
	} else {
		oadatastr = "Might", "Forgetful", "Lonely", "Shadow", "Calm", "Purgatory", "Illusion", "Maneater", "Magic", "Hellish", "Zealot", "", "", "Mysterious", "Anomalous", "Dark", "Thieves", "<WriteNight>", "<MidNight>"
	}
	dim junban, 245
	dim searchene, 15
	dim encprocref2, 6
	dim trashinv, 70, 400
	trashcnt = 0
	dim mondmg, 16, 20
	dim dmgpack, 5, 245
	sdim mondmgn, 20, 20
	mondmgcnt = 0
	dmgdisplayflag = 0
	cfg_dmgmonitor = cfg_dmgmonitor0 + cfg_dmgmonitor1 + cfg_dmgmonitor2 + cfg_dmgmonitor3
	dim weaponenc, 2
	dim txtpopup, 16, 20
	sdim txtpopupn, 1000
	txtpopupcnt = 0
	tmpfont@00m = 0, cfg_txtpopfont, 0
	dim oom_popup, 2
	setting@00m = 0
	enccategory = 10000, 20000, 30000, 60000, 70000, 80000, 90000, 100000
	sdim enccategoy, 10, 8
	if (jp) {
		enccategoryn = "主能力上昇", "耐性上昇", "スキル上昇", "主能力維持", "属性追加ダメージ", "発動効果", "特殊弾", "その他"
	} else {
		enccategoryn = "Attributes+", "Resistance+", "Skill+", "Remains attributs", "Deals elemental damage", "Invokes", "Special ammo", "Others"
	}
	encselect = 0
	if (jp) {
		_resiststr0 = "火", "冷", "雷", "闇", "幻", "毒", "獄", "音", "神", "沌", "魔"
		_resiststr1 = "筋", "耐", "器", "感", "習", "意", "魔", "魅", "速", "運", "盲", "麻", "混", "恐", "睡", "毒"
	} else {
		_resiststr0 = "Fi", "Co", "Li", "Da", "Mi", "Po", "Nt", "So", "Nr", "Ch", "Ma"
		_resiststr1 = "ST", "CO", "DE", "PE", "LE", "WI", "MA", "CH", "SP", "LU", "Bl", "Pa", "Co", "Fe", "Sl", "Po"
	}
	dim gdatac, 1000
	sdim printlog, 100, 4
	sdim _strackdata, 100, 4
	viewinfo = 1
	sdim varesname, 30, 32
	dim varequipsave, 4, 30, 32
	hide_popup@00m = 0
	dim cs_config, 18
	dim oom_color, 6, 10
	ccolor 401
	if (stat) {
		oom_color(0, 1) = oom_tmpcolor(0), oom_tmpcolor(1), oom_tmpcolor(2), oom_tmpcolor(3), oom_tmpcolor(4), oom_tmpcolor(5)
	} else {
		oom_color(0, 1) = 255, 255, 255, 150, 100, 50
	}
	ccolor 402
	if (stat) {
		oom_color(0, 2) = oom_tmpcolor(0), oom_tmpcolor(1), oom_tmpcolor(2), oom_tmpcolor(3), oom_tmpcolor(4), oom_tmpcolor(5)
	} else {
		oom_color(0, 2) = 255, 255, 255, 50, 100, 150
	}
	ccolor 403
	if (stat) {
		oom_color(0, 3) = oom_tmpcolor(0), oom_tmpcolor(1), oom_tmpcolor(2), oom_tmpcolor(3), oom_tmpcolor(4), oom_tmpcolor(5)
	} else {
		oom_color(0, 3) = 255, 255, 255, 50, 100, 150
	}
	ccolor 404
	if (stat) {
		oom_color(0, 4) = oom_tmpcolor(0), oom_tmpcolor(1), oom_tmpcolor(2), oom_tmpcolor(3), oom_tmpcolor(4), oom_tmpcolor(5)
	} else {
		oom_color(0, 4) = 255, 255, 255, 150, 100, 50
	}
	fontlist@00m = "" + lang(cfg_font1, cfg_font2)
	exist exedir + "user\\cfont.txt"
	if (strsize != (-1)) {
		s@00m = ""
		i@00m = 1
		notesel s@00m
		noteload exedir + "user\\cfont.txt"
		repeat noteinfo(0)
			noteget s@00m(1), cnt
			font s@00m(1), 10, 0
			if (stat != (-1)) {
				f@00m = 1
				foreach fontlist@00m
					if (fontlist@00m(cnt) == s@00m(1)) {
						f@00m = 0
						break
					}
				loop
				if (f@00m == 1) {
					fontlist@00m(i@00m) = s@00m(1)
					i@00m++
				}
			}
		loop
	}
	tm@00m = -1
	trash_reset
	dim csetspelllist, 66
	dim csetabilitylist, 61
	dim olist, 500
	dim fusionlist, 2, 15
	sdim userfilelist, 160, 2, 900
	gsel 3
	gmode 0
	redraw 0
	color 1, 1, 1
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
	repeat 18
		pos cnt * 24 + 72, 30
		gcopy 3, 0, 30, 24, 18
		pos cnt * 24 + 77, 31
		color 50, 60, 80
		bmes key_select(cnt), 250, 240, 230
	loop
	gsel 0
	gmode 2
	text_set
	notesel msg_log
	repeat inf_maxlog - 2
		noteadd ""
	loop
	noteadd lang("■メッセージログ", "<Message Log>")
	noteadd lang("過去の20行分のメッセージが表示されます。", "Past 20 message lines are logged.")
	ctrlFile 10
	tc = 0
	tcol@txtfunc = 255, 255, 255
	invctrl = 0, 0
	pos -40, -40
	mesbox keylog, 0, 0, 1, 10
	sdim buffboard
	notesel buffboard
	noteload exedir + "data\\board.txt"
	notesel buff
	noteload exedir + "data\\nc_board.txt"
	buffboard += buff
	notesel buffboard
	sdim filter_item, 850
	sdim rffilter_item, 850
	sdim ioriginalnameref, 850
	sdim ioriginalnameref2, 850
	sdim iknownnameref, 850
	sdim ialphanameref, 850
	dim irandomname, 850
	dim icolref
	dim keybd_st, 256
	dim trate, 8
	sdim filtern
	sdim filter_creature
	sdim netbuf, 20000
	sdim titlename, 50, 71
	sdim titlename2, 100, 71
	sdim Abysstitlename, 50, 12
	sdim Abysstitlename2, 100, 12
	sdim title_description, 1000, 3
	// NCのマクロ機能
	sdim nc_key_log, 32, 100
	dim nc_key_roop, 100
	gosub *label_1336
	gosub *custom_cleanUpTemporaryFiles
	gosub *label_1524
	gosub *label_2425
	gosub *label_3222
	gosub *label_0250
	gosub *label_0086
	gosub *label_0953
	gosub *label_0818
	gosub *label_0269
	gRandomSeed = rnd(800) + 2
	gdata(9) = rnd(200) + 2
	gosub *label_3223
	gosub *label_itemDB
	gosub *label_0095
	gosub *label_0081
	gosub *label_1779
	gosub *label_0085
	gosub *label_0312
	gosub *label_0308
	gosub *label_0295
	gosub *label_0770
	gosub *label_1674
	gosub *label_1717
	gosub *label_0198
	gosub *label_1122
	gosub *label_0318
	gosub *label_0190
	gosub *label_0916
	gosub *label_1677
	if (cfg_useffhp) {
		gosub *label_0279
	}
	if (cfg_usecharaffhp) {
		gosub *label_0280
	}
	gosub *custom_loadCgods
	gosub *custom_loadCnpcs
	gosub *custom_loadCitems
	if (cfg_music == 1) {
		DMINIT
		if (stat == 0) {
			cfg_music = 2
		}
	}
	if (cfg_music == 3) {
		cmd_0_0 -1100
	}
	if (cfg_sound == 1) {
		DSINIT
		if (stat == 0) {
			cfg_sound = 2
		}
	}
	if (cfg_joypad == 1) {
		DIINIT
		DIGETJOYNUM
		if (stat == 0) {
			cfg_joypad = 0
		}
	}
	gosub *label_1753
	gosub *label_0119
	gosub *label_0121
	mainskill = 173, 106, 108
	dim cycle, 15, 5
	sdim cyclekey, 5, 15
	cycle(0, 0) = 1, 2, 5, 7, 8, 9, 14, 15, 17, 26, -1
	cycle(0, 1) = 1, 5, 7, 8, 14, -1
	cycle(0, 2) = 10, 25, -1
	cycle(0, 3) = 22, 24, -1
	cycle(0, 4) = 2, -1
	cyclemax = 9, 4, 1, 1, 0
	shadowmap = 0, 9, 10, 5, 12, 7, 0, 1, 11, 0, 6, 3, 8, 4, 2, 0, 0
	lastctrl = 1
	dim invicon, 40
	sdim invkey, 4, 40
	invkey = "", "" + key_inventory, "" + key_drop, "", "", "" + key_eat, "", "" + key_read, "" + key_drink, "" + key_zap, "", "", "", "", "" + key_use, "" + key_open, "", "" + key_dip
	invkey(26) = "" + key_throw
	invicon = -1, 7, 8, -1, -1, 2, -1, 3, 0, 1, 17, -1, -1, -1, 5, 4, -1, 6, -1, -1, -1, -1, 17, -1, 17, 17, 18, -1, -1, -1
	if (cfg_autonumlock) {
		GetKeyboardState keybd_st
		if (peek(keybd_st, 144) == 1) {
			keybd_event 144
			keybd_event 144, 0, 2
		}
	}
	gosub *label_1774
	gosub *label_1715
	gosub *label_1802
	gosub *label_1843
	gosub *label_1211
	bsave exedir + "data\\oo_version", ooversionstr, 3
	goto *label_1606

*ErrorMsgInit
    sdim ErrorMsg, 2, 42

    ErrorMsg(0, 0) = "",                                            ""
    ErrorMsg(0, 1) = "システムエラーが発生しました",                "Unknown system error"
    ErrorMsg(0, 2) = "文法が間違っています",                        "Syntax error"
    ErrorMsg(0, 3) = "パラメータの値が異常です",                    "Illegal function call"
    ErrorMsg(0, 4) = "計算式でエラーが発生しました",                "Wrong expression"
    ErrorMsg(0, 5) = "パラメータの省略はできません",                "Default parameter not allowed"
    ErrorMsg(0, 6) = "パラメータの型が違います",                    "Type mismatch"
    ErrorMsg(0, 7) = "配列の要素が無効です",                        "Array overflow"
    ErrorMsg(0, 8) = "有効なラベルが指定されていません",            "Not a label object"
    ErrorMsg(0, 9) = "サブルーチンやループのネストが深すぎます",    "Too many nesting"
    ErrorMsg(0, 10) = "サブルーチン外のreturnは無効です",           "Return without gosub"
    ErrorMsg(0, 11) = "repeat外でのloopは無効です",                 "Loop without repeat"
    ErrorMsg(0, 12) = "ファイルが見つからないか無効な名前です",     "File I/O error"
    ErrorMsg(0, 13) = "画像ファイルがありません",                   "Picture file missing"
    ErrorMsg(0, 14) = "外部ファイル呼び出し中のエラーです",         "External execute error"
    ErrorMsg(0, 15) = "計算式でカッコの記述が違います",             "Priority error"
    ErrorMsg(0, 16) = "パラメータの数が多すぎます",                 "Too many parameters"
    ErrorMsg(0, 17) = "文字列式で扱える文字数を越えました",         "Temporary buffer overflow"
    ErrorMsg(0, 18) = "代入できない変数名を指定しています",         "Wrong valiable name"
    ErrorMsg(0, 19) = "0で除算しました",                            "Divided by zero"
    ErrorMsg(0, 20) = "バッファオーバーフローが発生しました",       "Buffer Overflow"
    ErrorMsg(0, 21) = "サポートされない機能を選択しました",         "Unsupported function"
    ErrorMsg(0, 22) = "計算式のカッコが深すぎます",                 "Expression too complex"
    ErrorMsg(0, 23) = "変数名が指定されていません",                 "Variable required"
    ErrorMsg(0, 24) = "整数以外が指定されています",                 "Integer value required"
    ErrorMsg(0, 25) = "配列の要素書式が間違っています",             "Bad array expression"
    ErrorMsg(0, 26) = "メモリの確保ができませんでした",             "Out of memory"
    ErrorMsg(0, 27) = "タイプの初期化に失敗しました",               "Type initalization failed"
    ErrorMsg(0, 28) = "関数に引数が設定されていません",             "No Function parameters"
    ErrorMsg(0, 29) = "スタック領域のオーバーフローです",           "Stack overflow"
    ErrorMsg(0, 30) = "無効な名前がパラメーターに指定されています", "Invalid parameter name"
    ErrorMsg(0, 31) = "異なる型を持つ配列変数に代入しました",       "Invalid type of array"
    ErrorMsg(0, 32) = "関数のパラメーター記述が不正です",           "Invalid function parameter"
    ErrorMsg(0, 33) = "オブジェクト数が多すぎます",                 "Too many window objects"
    ErrorMsg(0, 34) = "配列・関数として使用できない型です",         "Invalid Array/Function"
    ErrorMsg(0, 35) = "モジュール変数が指定されていません",         "Structure required"
    ErrorMsg(0, 36) = "モジュール変数の指定が無効です",             "Illegal structure call"
    ErrorMsg(0, 37) = "変数型の変換に失敗しました",                 "Invalid type of variable"
    ErrorMsg(0, 38) = "外部DLLの呼び出しに失敗しました",            "DLL call failed"
    ErrorMsg(0, 39) = "外部オブジェクトの呼び出しに失敗しました",   "External COM call failed"
    ErrorMsg(0, 40) = "関数の戻り値が設定されていません。",         "No function result"
    ErrorMsg(0, 41) = "関数を命令として記述しています。",           "Invalid syntax for function"

*system_quitElona
	if (cfg_music == 1) {
		DMEND
	} else {
		if (cfg_music == 3) {
			cmd_0_1
		}
	}
	if (cfg_sound == 1) {
		DSEND
	}
	if (ieopen) {
		delcom ie_event
		delcom ie
	}
	if (cfg_autonumlock) {
		keybd_event 144
		keybd_event 144, 0, 2
	}
	if (mutex_handle != 0) {
		CloseHandle mutex_handle
	}
	end

*exit_game_error
	if (errorhack > 1) {
		goto *system_quitElona
	} else {
		errorhack++
	}
	await
	buf = "Line " + lparam + " HspError " + wparam + " WinError " + GetLastError() + " Ver " + int(double("1.22") * 1000) + " oomEx Sukutu Edition STep Nasuko Custom" + releaseday + " Mode " + mode + "\n"
	buf += "Message (JP): " + ErrorMsg(0, wparam) + "\n"
	buf += "Message (EN): " + ErrorMsg(1, wparam) + "\n"
	buf += "" + oomsest_getHumanReadableErrorReason(wparam) + "\n"
	buf += "efId " + efid + " efP " + efp + " Area " + gCurrentMap + "(" + mapname(gCurrentMap) + ")\n"
	buf += "ci "
	if (ci < 200) {
		buf += "0(" + ci + ")"
		if (ci >= 0) {
			buf += "\t#" + iId(ci) + ":" + ioriginalnameref(iId(ci))
		}
	}
	if (ci >= 5080) {
		buf += "-1(" + ci + ")"
		if (ci < 5480) {
			buf += "\t#" + iId(ci) + ":" + ioriginalnameref(iId(ci))
		}
	}
	if (ci >= 200) {
		if (ci < 5080) {
			buf += "" + ((ci - 200) / 20 + 1) + "(" + ci + ")"
			buf += "\t#" + iId(ci) + ":" + ioriginalnameref(iId(ci))
		}
	}
	buf += "\n"
	buf += "ti "
	if (ti < 200) {
		buf += "0(" + ti + ")"
		if (ti >= 0) {
			buf += "\t#" + iId(ti) + ":" + ioriginalnameref(iId(ti))
		}
	}
	if (ti >= 5080) {
		buf += "-1(" + ti + ")"
		if (ti < 5480) {
			buf += "\t#" + iId(ti) + ":" + ioriginalnameref(iId(ti))
		}
	}
	if (ti >= 200) {
		if (ti < 5080) {
			buf += "" + ((ti - 200) / 20 + 1) + "(" + ti + ")"
			buf += "\t#" + iId(ti) + ":" + ioriginalnameref(iId(ti))
		}
	}
	buf += "\n"
	buf += "cc " + cc
	if (cc >= 0 & cc < 245) {
		buf += "\t#" + cId(cc) + ":" + cdatan(0, cc)
	}
	buf += "\n"
	buf += "tc " + tc
	if (tc >= 0 & tc < 245) {
		buf += "\t#" + cId(tc) + ":" + cdatan(0, tc)
	}
	buf += "\n"
	buf += "rc " + rc
	if (rc >= 0 & rc < 245) {
		buf += "\t#" + cId(rc) + ":" + cdatan(0, rc)
	}
	buf += "\n"
	buf += "cw "
	if (cw < 200) {
		buf += "0(" + cw + ")"
		if (cw >= 0) {
			buf += "\t#" + iId(cw) + ":" + ioriginalnameref(iId(cw))
		}
	}
	if (cw >= 5080) {
		buf += "-1(" + cw + ")"
		if (cw < 5480) {
			buf += "\t#" + iId(cw) + ":" + ioriginalnameref(iId(cw))
		}
	}
	if (cw >= 200) {
		if (cw < 5080) {
			buf += "" + ((cw - 200) / 20 + 1) + "(" + cw + ")"
			buf += "\t#" + iId(cw) + ":" + ioriginalnameref(iId(cw))
		}
	}
	buf += "\n"
	repeat 10
		buf += "" + proclist((procid + cnt + 1) \ 10) + "\n"
	loop
	repeat 245
		if (cState(cnt) != 1) {
			continue
		}
		if (cX(cnt) < 0 | cX(cnt) >= mapWidth | cY(cnt) < 0 | cY(cnt) >= mapHeight) {
			buf += "* invalid chara position " + cnt + "#" + cId(cnt) + "(" + cX(cnt) + "/" + cY(cnt) + ") max(" + mapWidth + "/" + mapHeight + ")\n"
		}
	loop
	repeat 400, 5080
		if (mode == 6) {
			break
		}
		if (iNumber(cnt) <= 0) {
			continue
		}
		if (iX(cnt) < 0 | iX(cnt) >= mapWidth | iY(cnt) < 0 | iY(cnt) >= mapHeight) {
			iX(cnt) = 0
			iY(cnt) = 0
			buf += "* invalid item position " + cnt + "#" + iId(cnt) + "(" + iX(cnt) + "/" + iY(cnt) + ") max(" + mapWidth + "/" + mapHeight + ")\n"
		}
	loop
	if (characreatehack) {
		buf += "* error in function:chara_create:#" + (characreatehack - 1) + "\n"
	}
	if (itemcreatehack) {
		buf += "* error in function:item_create:#" + (itemcreatehack - 1) + "\n"
	}
	if (chararefreshhack) {
		buf += "* error in function:charaRefresh\n"
	}
	if (itemnamehack) {
		buf += "* error in function:itemName:#" + (itemnamehack - 1) + "\n"
	}
	if (screendrawhack) {
		buf += "* error in function:screen_draw:" + screendrawhack + "\n"
	}
	if (gCurrentMap == 35) {
		buf += "* (possibly)invalid show room:#" + usermapid + "\n"
	}
	if (ci < 0) {
		buf += "* ci is below 0\n"
	}
	if (ci >= 5480) {
		buf += "* ci is above max\n"
	}
	if (ti < 0) {
		buf += "* ti is below 0\n"
	}
	if (ti >= 5480) {
		buf += "* ti is above max\n"
	}
	if (cc < 0) {
		buf += "* cc is below 0\n"
	}
	if (cc >= 245) {
		buf += "* cc is above max\n"
	}
	if (tc < 0) {
		buf += "* tc is below 0\n"
	}
	if (tc >= 245) {
		buf += "* tc is above max\n"
	}
	if (rc < 0) {
		buf += "* rc is below 0\n"
	}
	if (rc >= 245) {
		buf += "* rc is above max\n"
	}
	if (hack_equipfilter) {
		buf += "* enchantment filter\n"
	}
	if (hack_quest) {
		buf += "* quest time\n"
	}
	if (hack_dmgmonitor) {
		buf += "* damage popup\n"
	}
	if (hack_strack) {
		buf += "* extra skill tracker\n"
	}
	if (hack_furniture) {
		buf += "* 8-dir furniture\n"
	}
	if (hack_autofarm) {
		buf += "* auto-harvest\n"
	}
	if (hack_autob) {
		buf += "* auto-bash\n"
	}
	if (hack_targetex) {
		buf += "* extra target info:" + hack_targetex + "\n"
	}
	if (hack_alertstarvation) {
		buf += "* alert starving\n"
	}
	if (hack_plant) {
		buf += "* auto-plant\n"
	}
	if (hack_txtpopup) {
		buf += "* speech balloon" + hack_txtpopup
	}
	if (jp) {
		buf += "\n\n非公式バージョンです。バグ報告はDiscordもしくはask.fmまでお願いします。"
	} else {
		buf += "\n\nIt is an unofficial version. Please report an issue to Discord of ask.fm."
	}
	if ( jp ) {
		if ( wparam == 1 ) {
				buf += "\n"
				buf += "\n【エラーの説明】"
				buf += "\nHspError 1 は……これはちょっとまずいですね。これは基本的におま環のエラーです。"
				buf += "\nファイルが破損していたり予期しない異常が起こった際に発生します。"
				buf += "\nスペックが低いＰＣだと起こりやすいとも言われています。頻発するようであれば再インストールを検討してください。"
		}
		if ( wparam == 12 ) {
				buf += "\n"
				buf += "\n【エラーの説明】"
				buf += "\nHspError 12 は画像以外の必要なファイルが読み込めない時に発生します。"
				buf += "\nファイルが破損していたりセキュリティソフトによってブロックされている場合がありますのでご確認を。"
		}
		if ( wparam == 13 ) {
				buf += "\n"
				buf += "\n【エラーの説明】"
				buf += "\nHspError 13 は必要な画像ファイルが読み込めない時に発生します。"
				buf += "\nファイルが破損していたりセキュリティソフトによってブロックされている場合がありますのでご確認を。"
		}
		if ( wparam == 38 ) {
				buf += "\n"
				buf += "\n【エラーの説明】"
				buf += "\nHspError 38 は必要な拡張ライブラリファイル(.dllファイル)が読み込めない時に発生します。"
				buf += "\nファイルが破損していたりセキュリティソフトによってブロックされている場合がありますのでご確認を。"
		}
	}
	if (nc_intb_nightmare) {
		buf += "\n\nナイトメアモードでプレイ中です。救済用ファイルを生成しました。"
	}
	notesel buf
	notesave exedir + "error.txt"
	exec exedir + "error.txt", 16
	// ナイトメアモード時、専用のファイル生成して救済
	if (nc_intb_nightmare) {
		buf = ""
		notesel buf
		buf += "747474nightmarehelp" + gCurrentMap
		notesave exedir + "save\\nightmarehelp.save"
	}
	goto *system_quitElona
	goto *label_0247



#deffunc create_pcpic int __xxx, int __yyy
	buffer 10 + __xxx, 384, 198
	color 0, 0, 0
	boxf
	if (pcc(15, __xxx) == 0) {
		pcc(15, __xxx) = cSex(__xxx) + 1
		pcc(14, __xxx) = cSex(__xxx) + 7
		pcc(1, __xxx) = 2 + rnd(21) * 1000
		pcc(9, __xxx) = 1 + rnd(21) * 1000
		pcc(7, __xxx) = 1 + rnd(21) * 1000
		pcc(16, __xxx) = 1
	}
	if (__yyy == 1) {
		pcc(4, __xxx) = 0
		pcc(2, __xxx) = 0
		pcc(6, __xxx) = 0
		pcc(3, __xxx) = 0
		pcc(8, __xxx) = 0
		pcc(5, __xxx) = 0
		repeat 30, 100
			if (cdata(cnt, __xxx) \ 10000 != 0) {
				i@m38 = cdata(cnt, __xxx) \ 10000 - 1
				body@m38 = iequiploc(i@m38)
				gosub *label_0244
			}
		loop
	}
	pcc(10, __xxx) = pcc(1, __xxx) / 1000 * 1000 + pcc(10, __xxx) \ 1000
	pcc(14, __xxx) = pcc(15, __xxx) / 1000 * 1000 + pcc(14, __xxx) \ 1000
	if (__yyy != 0) {
		if (pcc(24, __xxx) == 0) {
			exist exedir + "\\graphic\\pcc_" + "mantle" + "_" + pcc(4, __xxx) \ 1000 + ".bmp"
			if (strsize != (-1)) {
				pos 128, 0
				picload_ exedir + "\\graphic\\pcc_" + "mantle" + "_" + pcc(4, __xxx) \ 1000 + ".bmp", 1
				color 0, 0, 0
				boxf 256, 0, 384, 198
				gmode 4, , , 256
				color 43, 133, 133
				pget 128, 0
				pos 256, 0
				gcopy 10 + __xxx, 128, 0, 128, 198
				pos 256, 0
				gfini 128, 198
				if (cStoned(__xxx) <= 0) {
					gfdec2 c_col(0, pcc(4, __xxx) / 1000), c_col(1, pcc(4, __xxx) / 1000), c_col(2, pcc(4, __xxx) / 1000)
				} else {
					gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
				}
				gmode 2
				color 0, 0, 0
				pos 0, 0
				gcopy 10 + __xxx, 256, 0, 128, 198
			}
		}
	}
	exist exedir + "\\graphic\\pcc_" + "hairbk" + "_" + pcc(1, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "hairbk" + "_" + pcc(1, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(1, __xxx) / 1000), c_col(1, pcc(1, __xxx) / 1000), c_col(2, pcc(1, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	if (__xxx == 0 & gMount != 0 | ocdata(106, __xxx) != 0 & pcc(16, __xxx) != 0) {
		exist exedir + "\\graphic\\pcc_" + "ridebk" + "_" + pcc(16, __xxx) \ 1000 + ".bmp"
		if (strsize != (-1)) {
			pos 128, 0
			picload_ exedir + "\\graphic\\pcc_" + "ridebk" + "_" + pcc(16, __xxx) \ 1000 + ".bmp", 1
			color 0, 0, 0
			boxf 256, 0, 384, 198
			gmode 4, , , 256
			color 43, 133, 133
			pget 128, 0
			pos 256, 0
			gcopy 10 + __xxx, 128, 0, 128, 198
			pos 256, 0
			gfini 128, 198
			if (cStoned(__xxx) <= 0) {
				gfdec2 c_col(0, pcc(16, __xxx) / 1000), c_col(1, pcc(16, __xxx) / 1000), c_col(2, pcc(16, __xxx) / 1000)
			} else {
				gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
			}
			gmode 2
			color 0, 0, 0
			pos 0, 0
			gcopy 10 + __xxx, 256, 0, 128, 198
		}
	} else {
		exist exedir + "\\graphic\\pcc_" + "body" + "_" + pcc(15, __xxx) \ 1000 + ".bmp"
		if (strsize != (-1)) {
			pos 128, 0
			picload_ exedir + "\\graphic\\pcc_" + "body" + "_" + pcc(15, __xxx) \ 1000 + ".bmp", 1
			color 0, 0, 0
			boxf 256, 0, 384, 198
			gmode 4, , , 256
			color 43, 133, 133
			pget 128, 0
			pos 256, 0
			gcopy 10 + __xxx, 128, 0, 128, 198
			pos 256, 0
			gfini 128, 198
			if (cStoned(__xxx) <= 0) {
				gfdec2 c_col(0, pcc(15, __xxx) / 1000), c_col(1, pcc(15, __xxx) / 1000), c_col(2, pcc(15, __xxx) / 1000)
			} else {
				gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
			}
			gmode 2
			color 0, 0, 0
			pos 0, 0
			gcopy 10 + __xxx, 256, 0, 128, 198
		}
	}
	exist exedir + "\\graphic\\pcc_" + "eye" + "_" + pcc(14, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "eye" + "_" + pcc(14, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(14, __xxx) / 1000), c_col(1, pcc(14, __xxx) / 1000), c_col(2, pcc(14, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	if (__xxx == 0 & gMount != 0 | ocdata(106, __xxx) != 0 & pcc(16, __xxx) != 0) {
	} else {
		exist exedir + "\\graphic\\pcc_" + "pants" + "_" + pcc(7, __xxx) \ 1000 + ".bmp"
		if (strsize != (-1)) {
			pos 128, 0
			picload_ exedir + "\\graphic\\pcc_" + "pants" + "_" + pcc(7, __xxx) \ 1000 + ".bmp", 1
			color 0, 0, 0
			boxf 256, 0, 384, 198
			gmode 4, , , 256
			color 43, 133, 133
			pget 128, 0
			pos 256, 0
			gcopy 10 + __xxx, 128, 0, 128, 198
			pos 256, 0
			gfini 128, 198
			if (cStoned(__xxx) <= 0) {
				gfdec2 c_col(0, pcc(7, __xxx) / 1000), c_col(1, pcc(7, __xxx) / 1000), c_col(2, pcc(7, __xxx) / 1000)
			} else {
				gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
			}
			gmode 2
			color 0, 0, 0
			pos 0, 0
			gcopy 10 + __xxx, 256, 0, 128, 198
		}
	}
	exist exedir + "\\graphic\\pcc_" + "cloth" + "_" + pcc(9, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "cloth" + "_" + pcc(9, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(9, __xxx) / 1000), c_col(1, pcc(9, __xxx) / 1000), c_col(2, pcc(9, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	if (__yyy != 0) {
		if (pcc(20, __xxx) == 0) {
			exist exedir + "\\graphic\\pcc_" + "chest" + "_" + pcc(2, __xxx) \ 1000 + ".bmp"
			if (strsize != (-1)) {
				pos 128, 0
				picload_ exedir + "\\graphic\\pcc_" + "chest" + "_" + pcc(2, __xxx) \ 1000 + ".bmp", 1
				color 0, 0, 0
				boxf 256, 0, 384, 198
				gmode 4, , , 256
				color 43, 133, 133
				pget 128, 0
				pos 256, 0
				gcopy 10 + __xxx, 128, 0, 128, 198
				pos 256, 0
				gfini 128, 198
				if (cStoned(__xxx) <= 0) {
					gfdec2 c_col(0, pcc(2, __xxx) / 1000), c_col(1, pcc(2, __xxx) / 1000), c_col(2, pcc(2, __xxx) / 1000)
				} else {
					gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
				}
				gmode 2
				color 0, 0, 0
				pos 0, 0
				gcopy 10 + __xxx, 256, 0, 128, 198
			}
		}
		if (__xxx == 0 & gMount != 0 | ocdata(106, __xxx) != 0 & pcc(16, __xxx) != 0) {
		} else {
			if (pcc(21, __xxx) == 0) {
				exist exedir + "\\graphic\\pcc_" + "leg" + "_" + pcc(3, __xxx) \ 1000 + ".bmp"
				if (strsize != (-1)) {
					pos 128, 0
					picload_ exedir + "\\graphic\\pcc_" + "leg" + "_" + pcc(3, __xxx) \ 1000 + ".bmp", 1
					color 0, 0, 0
					boxf 256, 0, 384, 198
					gmode 4, , , 256
					color 43, 133, 133
					pget 128, 0
					pos 256, 0
					gcopy 10 + __xxx, 128, 0, 128, 198
					pos 256, 0
					gfini 128, 198
					if (cStoned(__xxx) <= 0) {
						gfdec2 c_col(0, pcc(3, __xxx) / 1000), c_col(1, pcc(3, __xxx) / 1000), c_col(2, pcc(3, __xxx) / 1000)
					} else {
						gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
					}
					gmode 2
					color 0, 0, 0
					pos 0, 0
					gcopy 10 + __xxx, 256, 0, 128, 198
				}
			}
		}
		if (pcc(22, __xxx) == 0) {
			exist exedir + "\\graphic\\pcc_" + "belt" + "_" + pcc(5, __xxx) \ 1000 + ".bmp"
			if (strsize != (-1)) {
				pos 128, 0
				picload_ exedir + "\\graphic\\pcc_" + "belt" + "_" + pcc(5, __xxx) \ 1000 + ".bmp", 1
				color 0, 0, 0
				boxf 256, 0, 384, 198
				gmode 4, , , 256
				color 43, 133, 133
				pget 128, 0
				pos 256, 0
				gcopy 10 + __xxx, 128, 0, 128, 198
				pos 256, 0
				gfini 128, 198
				if (cStoned(__xxx) <= 0) {
					gfdec2 c_col(0, pcc(5, __xxx) / 1000), c_col(1, pcc(5, __xxx) / 1000), c_col(2, pcc(5, __xxx) / 1000)
				} else {
					gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
				}
				gmode 2
				color 0, 0, 0
				pos 0, 0
				gcopy 10 + __xxx, 256, 0, 128, 198
			}
		}
		if (pcc(23, __xxx) == 0) {
			exist exedir + "\\graphic\\pcc_" + "glove" + "_" + pcc(8, __xxx) \ 1000 + ".bmp"
			if (strsize != (-1)) {
				pos 128, 0
				picload_ exedir + "\\graphic\\pcc_" + "glove" + "_" + pcc(8, __xxx) \ 1000 + ".bmp", 1
				color 0, 0, 0
				boxf 256, 0, 384, 198
				gmode 4, , , 256
				color 43, 133, 133
				pget 128, 0
				pos 256, 0
				gcopy 10 + __xxx, 128, 0, 128, 198
				pos 256, 0
				gfini 128, 198
				if (cStoned(__xxx) <= 0) {
					gfdec2 c_col(0, pcc(8, __xxx) / 1000), c_col(1, pcc(8, __xxx) / 1000), c_col(2, pcc(8, __xxx) / 1000)
				} else {
					gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
				}
				gmode 2
				color 0, 0, 0
				pos 0, 0
				gcopy 10 + __xxx, 256, 0, 128, 198
			}
		}
	}
	if (__xxx == 0 & gMount != 0 | ocdata(106, __xxx) != 0) {
		exist exedir + "\\graphic\\pcc_" + "ride" + "_" + pcc(16, __xxx) \ 1000 + ".bmp"
		if (strsize != (-1)) {
			pos 128, 0
			picload_ exedir + "\\graphic\\pcc_" + "ride" + "_" + pcc(16, __xxx) \ 1000 + ".bmp", 1
			color 0, 0, 0
			boxf 256, 0, 384, 198
			gmode 4, , , 256
			color 43, 133, 133
			pget 128, 0
			pos 256, 0
			gcopy 10 + __xxx, 128, 0, 128, 198
			pos 256, 0
			gfini 128, 198
			if (cStoned(__xxx) <= 0) {
				gfdec2 c_col(0, pcc(16, __xxx) / 1000), c_col(1, pcc(16, __xxx) / 1000), c_col(2, pcc(16, __xxx) / 1000)
			} else {
				gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
			}
			gmode 2
			color 0, 0, 0
			pos 0, 0
			gcopy 10 + __xxx, 256, 0, 128, 198
		}
	}
	if (__yyy != 0) {
		if (pcc(24, __xxx) == 0) {
			exist exedir + "\\graphic\\pcc_" + "mantlebk" + "_" + pcc(4, __xxx) \ 1000 + ".bmp"
			if (strsize != (-1)) {
				pos 128, 0
				picload_ exedir + "\\graphic\\pcc_" + "mantlebk" + "_" + pcc(4, __xxx) \ 1000 + ".bmp", 1
				color 0, 0, 0
				boxf 256, 0, 384, 198
				gmode 4, , , 256
				color 43, 133, 133
				pget 128, 0
				pos 256, 0
				gcopy 10 + __xxx, 128, 0, 128, 198
				pos 256, 0
				gfini 128, 198
				if (cStoned(__xxx) <= 0) {
					gfdec2 c_col(0, pcc(4, __xxx) / 1000), c_col(1, pcc(4, __xxx) / 1000), c_col(2, pcc(4, __xxx) / 1000)
				} else {
					gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
				}
				gmode 2
				color 0, 0, 0
				pos 0, 0
				gcopy 10 + __xxx, 256, 0, 128, 198
			}
		}
	}
	exist exedir + "\\graphic\\pcc_" + "hair" + "_" + pcc(1, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "hair" + "_" + pcc(1, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(1, __xxx) / 1000), c_col(1, pcc(1, __xxx) / 1000), c_col(2, pcc(1, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	exist exedir + "\\graphic\\pcc_" + "subhair" + "_" + pcc(10, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "subhair" + "_" + pcc(10, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(10, __xxx) / 1000), c_col(1, pcc(10, __xxx) / 1000), c_col(2, pcc(10, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	exist exedir + "\\graphic\\pcc_" + "etc" + "_" + pcc(11, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "etc" + "_" + pcc(11, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(11, __xxx) / 1000), c_col(1, pcc(11, __xxx) / 1000), c_col(2, pcc(11, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	exist exedir + "\\graphic\\pcc_" + "etc" + "_" + pcc(12, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "etc" + "_" + pcc(12, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(12, __xxx) / 1000), c_col(1, pcc(12, __xxx) / 1000), c_col(2, pcc(12, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	exist exedir + "\\graphic\\pcc_" + "etc" + "_" + pcc(13, __xxx) \ 1000 + ".bmp"
	if (strsize != (-1)) {
		pos 128, 0
		picload_ exedir + "\\graphic\\pcc_" + "etc" + "_" + pcc(13, __xxx) \ 1000 + ".bmp", 1
		color 0, 0, 0
		boxf 256, 0, 384, 198
		gmode 4, , , 256
		color 43, 133, 133
		pget 128, 0
		pos 256, 0
		gcopy 10 + __xxx, 128, 0, 128, 198
		pos 256, 0
		gfini 128, 198
		if (cStoned(__xxx) <= 0) {
			gfdec2 c_col(0, pcc(13, __xxx) / 1000), c_col(1, pcc(13, __xxx) / 1000), c_col(2, pcc(13, __xxx) / 1000)
		} else {
			gfdec2 c_col(0, 7), c_col(1, 7), c_col(2, 7)
		}
		gmode 2
		color 0, 0, 0
		pos 0, 0
		gcopy 10 + __xxx, 256, 0, 128, 198
	}
	gsel 0
	return
*label_0244
	p@m38 = refitem(iId(i@m38), 18, i@m38)
	if (p@m38 == 0) {
		p@m38 = 1
	}
	if (body@m38 == 1) {
		return
	}
	if (body@m38 == 3) {
		pcc(4, __xxx) = p@m38 + iColor(i@m38) * 1000
		return
	}
	if (body@m38 == 4) {
		pcc(2, __xxx) = p@m38 + iColor(i@m38) * 1000
		return
	}
	if (body@m38 == 9) {
		pcc(3, __xxx) = p@m38 + iColor(i@m38) * 1000
		return
	}
	if (body@m38 == 7) {
		pcc(8, __xxx) = p@m38 + iColor(i@m38) * 1000
		return
	}
	if (body@m38 == 8) {
		pcc(5, __xxx) = p@m38 + iColor(i@m38) * 1000
		return
	}
	return



#deffunc addefmap int __zzz, int __aaa, int __bbb, int __ccc, int __ddd, int __eee
	efmap(0, __zzz, __aaa) = __bbb, __ccc, __ddd, __eee
	return
*label_0247
	repeat 12
		if (rnd(2) == 0) {
			cloud(2, cnt) = 288, 1040, 208, 160
		} else {
			cloud(2, cnt) = 0, 976, 288, 224
		}
		cloud(0, cnt) = rnd(100) + cnt * 200 + 100000
		cloud(1, cnt) = rnd(100) + cnt / 5 * 200 + 100000
	loop
	return
*label_0249
	dim chipm, 8, 33 * 25
	if (mapTileSet == 0) {
		chipm(5, 233) = 0, 0
		repeat 7, 26
			chipm(0, cnt) = 4
		loop
		chipm(0, 568) = 4
		chipm(0, 569) = 4
		chipm(0, 570) = 4
		repeat 33, 99
			chipm(0, cnt) = 7
		loop
		repeat 33, 165
			chipm(0, cnt) = 8
		loop
		repeat 33, 198
			chipm(0, cnt) = 4
		loop
		repeat 5, 594
			chipm(0, cnt) = 7
		loop
		repeat 5, 599
			chipm(0, cnt) = 8
		loop
		repeat 12, 107
			chipm(1, cnt) = 9
		loop
		repeat 12, 173
			chipm(1, cnt) = 9
		loop
		repeat 12, 206
			chipm(1, cnt) = 9
		loop
		chipm(0, 604) = 10
		repeat 12, 605
			chipm(0, cnt) = 10
			chipm(1, cnt) = 9
		loop
		repeat 13 * 33, 396
			chipm(7, cnt) = 5
		loop
		repeat 33, 264
			chipm(7, cnt) = 4
		loop
		chipm(5, 135) = 8
		chipm(5, 137) = 16
		chipm(5, 140) = 6
		chipm(5, 145) = 16
		chipm(5, 149) = 16
	}
	if (mapTileSet == 1) {
		repeat 13 * 33, 396
			chipm(7, cnt) = 5
		loop
		chipm(5, 233) = 56, 48
		chipm(7, 594) = 4
		chipm(7, 628) = 4
		chipm(7, 637) = 4
		chipm(7, 641) = 4
		chipm(7, 733) = 4
		repeat 61 - 45, 45
			chipm(0, cnt) = 4
		loop
		chipm(0, 82) = 4
		chipm(0, 83) = 4
		chipm(0, 84) = 4
		repeat (495 - 462) * 2, 462
			chipm(2, cnt) = 1
			chipm(2, cnt - 66) = 1
		loop
		repeat 33, 462
			chipm(2, cnt) = 2
			chipm(2, cnt - 66) = 2
		loop
		chipm(0, 29) = 1
		chipm(0, 30) = 2
		chipm(0, 31) = 2
		chipm(0, 464) = 6
		chipm(3, 550) = 2
		chipm(2, 550) = 1
		chipm(0, 165) = 3
		chipm(3, 165) = 3
		chipm(0, 168) = 3
		chipm(3, 168) = 3
		chipm(0, 171) = 3
		chipm(1, 171) = 5
		chipm(3, 171) = 3
		chipm(0, 594) = 3
		chipm(3, 594) = 3
	}
	if (mapTileSet == 2) {
		repeat 11
			cnt2 = cnt
			repeat 13
				chipm(0, cnt2 * 33 + cnt + 20) = 4
			loop
		loop
		repeat 33, 33
			chipm(0, cnt) = 4
		loop
		repeat 13 * 33, 396
			chipm(7, cnt) = 5
		loop
		chipm(5, 233) = 56, 48
		chipm(7, 594) = 4
		repeat (495 - 462) * 2, 462
			chipm(2, cnt) = 1
			chipm(2, cnt - 66) = 1
		loop
		repeat 33, 462
			chipm(2, cnt) = 2
			chipm(2, cnt - 66) = 2
		loop
		chipm(3, 550) = 2
		chipm(2, 550) = 1
		chipm(0, 165) = 3
		chipm(3, 165) = 3
		chipm(0, 168) = 3
		chipm(3, 168) = 3
		chipm(0, 171) = 3
		chipm(1, 171) = 5
		chipm(3, 171) = 3
		chipm(0, 594) = 3
		chipm(3, 594) = 3
		chipm(2, 476) = 0
		chipm(2, 476 + 33) = 0
	}
	return
*label_0250
	dim cloud, 6, 12
	dim mefsubref, 6, 6
	mefsubref(0, 1) = 144, 624
	mefsubref(0, 2) = 272, 624, 1
	mefsubref(0, 3) = 304, 624, 1
	mefsubref(0, 4) = 368, 624
	mefsubref(0, 5) = 464, 624
	dim lightdata, 10, 20
	lightdata(0, 4) = 3, 0, 80, 0, 6, 40
	lightdata(0, 3) = 3, 0, 100, 30, 8, 20
	lightdata(0, 1) = 1, 1, 50, 8, 8, 50, 1
	lightdata(0, 2) = 1, 1, 70, 28, 8, 70, 1
	lightdata(0, 5) = 11, 0, 140, 48, 10, 20
	lightdata(0, 14) = 0, 0, 140, 62, 10, 20
	lightdata(0, 15) = 11, 0, 100, 72, 10, 20
	lightdata(0, 6) = 5, 1, 170, 4, 2, 80, 1
	lightdata(0, 7) = 9, 1, 30, 8, 2, 80, 1
	lightdata(0, 8) = 9, 1, 30, 24, 2, 80, 1
	lightdata(0, 16) = 9, 1, 30, 50, 5, 80, 1
	lightdata(0, 11) = 8, 0, 120, 0, 15, 15
	lightdata(0, 9) = 7, 0, 35, 4, 1, 40, 1
	lightdata(0, 10) = 7, 0, 35, 24, 1, 40, 1
	lightdata(0, 18) = 12, 0, 20, 32, 2, 30, 1
	lightdata(0, 12) = 4, 0, 50, 48, 5, 70, 1
	lightdata(0, 13) = 4, 0, 50, 16, 5, 70, 1
	lightdata(0, 17) = 12, 0, 100, 24, 3, 10
	lightdata(0, 19) = 13, 0, 70, 35, 3, 10
	sdim tname, 16, 11
	tname(1) = lang("日干し岩", "a dryrock")
	tname(2) = lang("畑", "a field")
	dim chipc, 6, 33 * 25 * 2 + 900
	dim chipi, 8, 33 * 25 * 2 + 900
	repeat 33 * 25
		chipc(0, cnt) = cnt \ 33 * inf_tiles, cnt / 33 * inf_tiles, inf_tiles, inf_tiles, 16
		chipc(0, cnt + 33 * 25 + 900) = cnt \ 33 * inf_tiles, cnt / 33 * inf_tiles, inf_tiles, inf_tiles, 16
		chipi(0, cnt) = cnt \ 33 * inf_tiles, cnt / 33 * inf_tiles, inf_tiles, inf_tiles, 0
		chipi(5, cnt) = 8
		chipi(6, cnt) = 40
		chipi(0, cnt + 33 * 25) = cnt \ 33 * inf_tiles, cnt / 33 * inf_tiles, inf_tiles, inf_tiles, 0
		chipi(5, cnt + 33 * 25) = 8
		chipi(6, cnt + 33 * 25) = 40
	loop
	repeat 900, 33 * 25
		chipc(0, cnt) = cnt \ 33 * inf_tiles, cnt / 33 * inf_tiles, inf_tiles, inf_tiles, 16
	loop
	chipi(4, 24) = 16
	chipi(4, 30) = 16
	chipi(4, 72) = 22
	chipi(4, 73) = 22
	chipi(4, 74) = 22
	chipi(4, 75) = 22
	chipi(4, 76) = 22, 28
	chipi(4, 78) = 22
	chipi(4, 80) = 22
	chipi(4, 85) = 8, 8, 150
	chipi(4, 87) = 22
	chipi(4, 88) = 22
	chipi(4, 91) = 22
	chipi(4, 95) = 22
	chipi(4, 96) = 22, 18
	chipi(4, 97) = 22
	chipi(4, 99) = 22
	chipi(4, 98) = 22
	chipi(4, 100) = 22
	chipi(4, 102) = 22
	chipi(4, 103) = 22
	chipi(4, 104) = 22
	chipi(4, 107) = 22
	chipi(4, 116) = 22
	chipi(4, 117) = 22
	chipi(4, 123) = 12
	chipi(4, 125) = 12
	chipi(4, 130) = 12
	chipi(4, 132) = 22
	chipi(4, 134) = 12
	chipi(4, 136) = 12
	chipi(4, 137) = 22
	chipi(4, 138) = 22
	chipi(4, 139) = 22
	chipi(4, 142) = 22, 36
	chipi(4, 143) = 22, 36
	chipi(4, 145) = 22
	chipi(4, 146) = 22
	chipi(4, 147) = 22
	chipi(4, 150) = 22, 8, 70
	chipi(4, 151) = 22
	chipi(4, 156) = 8, 20, 150
	chipi(4, 158) = 8, 24, 150
	chipi(4, 159) = 8, 24, 150
	chipi(4, 160) = 22
	chipi(4, 163) = 22, 16
	chipi(4, 164) = 22
	chipi(4, 118) = 22
	chipi(4, 166) = 22
	chipi(4, 197) = 22, 24
	chipi(4, 232) = 22
	chipi(4, 248) = 22
	chipi(4, 234) = 22, 24
	chipi(4, 235) = 22, 36
	chipi(4, 236) = 22
	chipi(4, 242) = 22, 8, 250
	chipi(4, 259) = 8, 12
	chipi(4, 260) = 22, 22
	chipi(4, 262) = 22
	chipi(4, 263) = 22
	chipi(4, 264) = 22
	chipi(4, 266) = 22, 24
	chipi(4, 270) = 22
	chipi(4, 272) = 22, 34
	chipi(4, 273) = 22
	chipi(4, 276) = 22
	chipi(4, 277) = 8
	chipi(4, 278) = 22
	chipi(4, 279) = 22
	chipi(4, 281) = 22, 40
	chipi(4, 282) = 22
	chipi(4, 285) = 22
	chipi(4, 286) = 22
	chipi(4, 288) = 22, 18
	chipi(4, 291) = 22
	chipi(4, 292) = 22, 32
	chipi(4, 293) = 22
	chipi(4, 295) = 22
	chipi(4, 296) = 22
	chipi(4, 299) = 22, 8, 250
	chipi(4, 300) = 22
	chipi(4, 320) = 22
	chipi(4, 321) = 22
	chipi(4, 325) = 22
	chipi(4, 327) = 22
	chipi(4, 331) = 22
	chipi(4, 332) = 22
	chipi(4, 348) = 22
	chipi(4, 353) = 48
	chipi(5, 354) = 8, 20
	chipi(4, 360) = 0, 2, 1
	chipi(4, 364) = 22, 8, 250
	chipi(4, 367) = 22
	chipi(4, 368) = 22
	chipi(4, 370) = 8
	chipi(4, 372) = 22
	chipi(4, 373) = 22
	chipi(4, 375) = 22
	chipi(4, 376) = 22
	chipi(4, 377) = 22
	chipi(4, 395) = 22
	chipi(4, 378) = 48
	chipi(4, 379) = 48
	chipi(4, 380) = 8
	chipi(4, 381) = 22
	chipi(4, 382) = 48
	chipi(4, 384) = 22
	chipi(4, 442) = 8, 8, 100
	chipi(4, 507) = 22
	chipi(4, 508) = 22
	chipi(4, 506) = 22
	chipi(4, 510) = 22
	chipi(4, 511) = 22, 28
	chipi(4, 512) = 22
	chipi(4, 513) = 22
	chipi(4, 541) = 22, 36
	chipi(4, 543) = 22
	chipi(4, 544) = 48
	chipi(4, 545) = 0, 0, 0
	chipi(4, 627) = 22
	chipi(4, 637) = 22
	chipi(4, 639) = 48
	chipi(4, 640) = 22, 34
	chipi(4, 641) = 22
	chipi(4, 642) = 22
	chipi(4, 643) = 22
	chipi(4, 644) = 32
	chipi(4, 646) = 22
	chipi(4, 647) = 22
	chipi(4, 648) = 22
	chipi(4, 650) = 22
	chipi(4, 651) = 48
	chipi(4, 652) = 48
	chipi(4, 653) = 32
	chipi(4, 655) = 22
	chipi(4, 659) = 22
	chipi(4, 662) = 22
	chipi(6, 664) = 0
	chipi(6, 665) = 0
	chipi(6, 667) = 0
	chipi(4, 668) = 8
	chipi(4, 669) = 8
	chipi(4, 672) = 38
	chipi(4, 674) = 22, 24
	chipi(4, 675) = 16
	chipi(4, 676) = 40
	chipi(4, 677) = 16, 8, 50
	chipi(6, 679) = 1
	chipi(4, 700) = 12, 12
	chipi(3, 523) = inf_tiles * 2, inf_tiles + 16, 40, 6
	chipi(3, 524) = inf_tiles * 2, inf_tiles + 16, 65
	chipi(3, 525) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 526) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 527) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 529) = inf_tiles * 2, inf_tiles + 16, 40
	chipi(3, 531) = inf_tiles * 2, inf_tiles + 16, 40
	chipi(3, 563) = inf_tiles * 2, inf_tiles + 15
	chipi(3, 566) = inf_tiles * 2, inf_tiles + 12
	chipi(3, 567) = inf_tiles * 2, inf_tiles + 12
	chipi(3, 568) = inf_tiles * 2, inf_tiles + 12
	chipi(3, 569) = inf_tiles * 2, inf_tiles + 12, 70, 6
	chipi(3, 570) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 571) = inf_tiles * 2, inf_tiles + 20, 64
	chipi(3, 572) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 573) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 574) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 575) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 576) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 577) = inf_tiles * 2, inf_tiles + 20, 48, 6
	chipi(3, 578) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 579) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 580) = inf_tiles * 2, inf_tiles + 20, 40, 6
	chipi(3, 581) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 582) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 583) = inf_tiles * 2, inf_tiles + 20, 44, 6
	chipi(3, 584) = inf_tiles * 2, inf_tiles + 20, 40, 6
	chipi(3, 585) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 586) = inf_tiles * 2, inf_tiles + 20, 44, 6
	chipi(3, 587) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 588) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 589) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 590) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 591) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 592) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 593) = inf_tiles * 2, inf_tiles + 20
	chipi(3, 680) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 681) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 682) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 683) = inf_tiles * 2, inf_tiles + 22, 50
	chipi(3, 685) = inf_tiles * 2, inf_tiles + 52, 50, 18
	chipi(3, 684) = inf_tiles * 2, inf_tiles + 52, 50, 18
	chipi(3, 686) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 687) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 688) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 689) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 690) = inf_tiles * 2, inf_tiles + 16
	chipi(3, 691) = inf_tiles * 2, inf_tiles + 16, 48
	chipi(3, 692) = inf_tiles * 2, inf_tiles + 16
	chipi(7, 19) = 2
	chipi(7, 24) = 3
	chipi(7, 27) = 3
	chipi(7, 30) = 2
	chipi(7, 349) = 3
	chipi(7, 355) = 3
	chipc(4, 176) = 8
	chipc(4, 225) = 29
	chipc(4, 230) = 12
	chipc(4, 256) = 16
	chipc(4, 277) = 29
	chipc(3, 201) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 228) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 231) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 232) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 233) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 286) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 297) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 235) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 280) = inf_tiles * 2, inf_tiles + 32
	chipc(3, 338) = inf_tiles * 2, inf_tiles + 32
	chipc(3, 339) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 341) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 342) = inf_tiles * 2, inf_tiles + 12
	chipc(3, 343) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 349) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 351) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 389) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 391) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 393) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 398) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 402) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 404) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 405) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 408) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 413) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 429) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 430) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 432) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 433) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 439) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 442) = inf_tiles * 2, inf_tiles + 8
	chipc(3, 447) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 453) = inf_tiles * 2, inf_tiles + 16
	chipc(3, 454) = inf_tiles * 2, inf_tiles + 16
	dim deco, 3, 300
	repeat 16
		deco(0, 1 + cnt * 16) = 0, 1
		deco(0, 2 + cnt * 16) = 1, 2
		deco(0, 4 + cnt * 16) = 1, 0
		deco(0, 6 + cnt * 16) = -1, 21
		deco(0, 7 + cnt * 16) = -1, 30
		deco(0, 8 + cnt * 16) = 2, 1
		deco(0, 9 + cnt * 16) = -1, 20
		deco(0, 10 + cnt * 16) = 2, 2
		deco(0, 11 + cnt * 16) = -1, 33
		deco(0, 12 + cnt * 16) = 2, 0
		deco(0, 13 + cnt * 16) = -1, 32
		deco(0, 14 + cnt * 16) = -1, 31
		deco(0, 15 + cnt * 16) = 3, 1
		deco(0, 16 + cnt * 16) = -1, -1
		deco(0, 19 + cnt * 16) = 0, 2
	loop
	deco(2, 49) = 2
	deco(2, 52) = 2
	deco(2, 53) = 2
	deco(2, 97) = 2
	deco(2, 113) = 2
	deco(2, 117) = 2
	deco(2, 164) = 2
	deco(2, 180) = 2
	deco(2, 181) = 2
	deco(2, 145) = 4
	deco(2, 162) = 4
	deco(2, 194) = 4
	deco(2, 195) = 4
	deco(2, 209) = 4
	deco(2, 226) = 4
	deco(2, 243) = 4
	deco(2, 84) = 3
	deco(2, 104) = 3
	deco(2, 196) = 3
	deco(2, 200) = 3
	deco(2, 204) = 3
	deco(2, 212) = 3
	deco(2, 220) = 3
	deco(2, 232) = 3
	deco(2, 236) = 3
	deco(2, 24) = 1
	deco(2, 50) = 1
	deco(2, 56) = 1
	deco(2, 58) = 1
	deco(2, 82) = 1
	deco(2, 114) = 1
	deco(2, 122) = 1
	deco(2, 152) = 1
	deco(2, 184) = 1
	deco(2, 186) = 1
	deco(2, 178) = 8
	deco(2, 241) = 10
	deco(2, 242) = 8
	deco(2, 244) = 7
	deco(0, 16) = -1, 1
	deco(0, 32) = -1, 2
	deco(0, 64) = -1, 3
	deco(0, 128) = -1, 4
	deco(0, 48) = -1, 5
	deco(0, 192) = -1, 6
	deco(0, 96) = -1, 7
	deco(0, 144) = -1, 8
	deco(0, 80) = -1, 9
	deco(0, 160) = -1, 10
	deco(0, 91) = 0, 1
	deco(0, 93) = 0, 1
	deco(0, 21) = 0, 0
	deco(0, 85) = 0, 0
	deco(0, 213) = 0, 0
	deco(0, 149) = 0, 0
	gosub *label_0249
	return



#deffunc cardplayerinit int __fff, int __ggg
	dim cardplayer@cardcontrol, 100, __fff
	cardplayermax@cardcontrol = __fff
	cardholdermax@cardcontrol = __ggg
	return



#deffunc cardplayeradd int __hhh, int __iii, int __jjj
	cardplayer@cardcontrol(1, __hhh) = __iii, __jjj
	repeat 10
		cardplayer@cardcontrol(10 + cnt, __hhh) = -1
	loop
	return



#deffunc initcard int __kkk, int __lll, int
	pilex@cardcontrol = __kkk
	piley@cardcontrol = __lll
	dim card@cardcontrol, 6, 53
	cardmax@cardcontrol = 53
	if (nojoker == 1) {
		cardmax@cardcontrol = 52
	}
	repeat cardmax@cardcontrol
		card@cardcontrol(0, cnt) = cnt \ 13 + 1, cnt / 13, 1
		if (cnt == 52) {
			card@cardcontrol(1, cnt) = 4
		}
		card@cardcontrol(5, cnt) = -1
	loop
	repeat 200
		i@cardcontrol = rnd(cardmax@cardcontrol), rnd(cardmax@cardcontrol)
		p@cardcontrol = card@cardcontrol(0, i@cardcontrol), card@cardcontrol(1, i@cardcontrol)
		card@cardcontrol(0, i@cardcontrol) = card@cardcontrol(0, i@cardcontrol(1)), card@cardcontrol(1, i@cardcontrol(1))
		card@cardcontrol(0, i@cardcontrol(1)) = p@cardcontrol, p@cardcontrol(1)
	loop
	return



#deffunc showcard2 int __nnn, int __ooo
	font lang(cfg_font1, cfg_font2), 43 - en * 2, 1
	color 0, 0, 0
	gmode 2, 64, 96
	pos card@cardcontrol(3, __nnn), card@cardcontrol(4, __nnn)
	if (card@cardcontrol(2, __nnn) == 1) {
		gcopy 3, 736, 216, 64, 96
	} else {
		gcopy 3, 672, 216, 64, 96
		if (__ooo == 0) {
			gmode 4, inf_tiles, inf_tiles, 220
			color 0, 0, 0
			if (card@cardcontrol(1, __nnn) == 0) {
				pos card@cardcontrol(3, __nnn) + 32, card@cardcontrol(4, __nnn) + 36
				grotate 5, 144, 240, 0, 64, 104
				col@cardcontrol = 140, 140, 255
			}
			if (card@cardcontrol(1, __nnn) == 1) {
				pos card@cardcontrol(3, __nnn) + 32, card@cardcontrol(4, __nnn) + 40
				grotate 5, 1104, 288, 0, 64, 104
				col@cardcontrol = 255, 140, 140
			}
			if (card@cardcontrol(1, __nnn) == 2) {
				pos card@cardcontrol(3, __nnn) + 32, card@cardcontrol(4, __nnn) + 50
				grotate 5, 480, 336, 0, 64, 84
				col@cardcontrol = 240, 240, 240
			}
			if (card@cardcontrol(1, __nnn) == 3) {
				pos card@cardcontrol(3, __nnn) + 28, card@cardcontrol(4, __nnn) + 48
				grotate 5, 1200, 288, 0, 64, 80
				col@cardcontrol = 140, 255, 140
			}
			if (card@cardcontrol(1, __nnn) == 4) {
				pos card@cardcontrol(3, __nnn) + 28, card@cardcontrol(4, __nnn) + 44
				grotate 5, 1296, 336, 0, 72, 86
				col@cardcontrol = 250, 250, 105
			}
			gmode 2
			s@cardcontrol = str(card@cardcontrol(0, __nnn))
			tx@cardcontrol = 2
			if (card@cardcontrol(0, __nnn) == 1) {
				s@cardcontrol = "A"
				tx@cardcontrol = 3
			}
			if (card@cardcontrol(0, __nnn) == 11) {
				s@cardcontrol = "J"
				tx@cardcontrol = 13
			}
			if (card@cardcontrol(0, __nnn) == 12) {
				s@cardcontrol = "Q"
				tx@cardcontrol = 14
			}
			if (card@cardcontrol(0, __nnn) == 13) {
				s@cardcontrol = "K"
				tx@cardcontrol = 14
			}
			if (card@cardcontrol(1, __nnn) == 4) {
				s@cardcontrol = "Jo"
				tx@cardcontrol = -12
			}
			pos card@cardcontrol(3, __nnn) + 18 - (card@cardcontrol(0, __nnn) >= 10) * 12 + tx@cardcontrol, card@cardcontrol(4, __nnn) + 28
			color 10, 10, 10
			bmes s@cardcontrol, col@cardcontrol(0), col@cardcontrol(1), col@cardcontrol(2)
		} else {
			font lang(cfg_font1, cfg_font2), 12 - en * 2, 0
			color 0, 0, 0
			if (card@cardcontrol(1, __nnn) != (-1)) {
			}
		}
	}
	return



#deffunc showcardpile
	redraw 0
	pos pilex@cardcontrol - 8, piley@cardcontrol - 8
	gcopy 3, 528, 216, 80, 112
	pilestack@cardcontrol = 0
	repeat cardmax@cardcontrol
		if (card@cardcontrol(5, cnt) == (-1)) {
			pilestack@cardcontrol++
			if (pilestack@cardcontrol > 7) {
				continue
			}
			card@cardcontrol(3, cnt) = pilex@cardcontrol - pilestack@cardcontrol, piley@cardcontrol - pilestack@cardcontrol
			showcard2 cnt
		}
	loop
	font lang(cfg_font1, cfg_font2), 16 - en * 2, 1
	color 10, 10, 10
	pos pilex@cardcontrol + 8, piley@cardcontrol + 70
	bmes "X " + pilestack@cardcontrol, 240, 240, 240
	return



#deffunc showcard
	redraw 0
	showcardpile
	repeat cardmax@cardcontrol
		if (card@cardcontrol(5, cnt) == (-1) | card@cardcontrol(5, cnt) == (-2)) {
			continue
		}
		showcard2 cnt
	loop
	return



#deffunc servecard int __ppp
	cardid@cardcontrol = -1
	repeat cardmax@cardcontrol
		if (card@cardcontrol(5, cnt) == (-1)) {
			cardid@cardcontrol = cnt
			break
		}
	loop
	if (cardid@cardcontrol == (-1)) {
		return 0
	}
	repeat 10
		if (cardplayer@cardcontrol(10 + cnt, __ppp) == (-1)) {
			p@cardcontrol = cnt
			break
		}
	loop
	dx@cardcontrol = pilex@cardcontrol - cardplayer@cardcontrol(1, __ppp) - p@cardcontrol * 88
	dy@cardcontrol = piley@cardcontrol - cardplayer@cardcontrol(2, __ppp)
	card@cardcontrol(5, cardid@cardcontrol) = __ppp
	cardplayer@cardcontrol(10 + p@cardcontrol, __ppp) = cardid@cardcontrol
	repeat 10
		redraw 0
		if (cnt != 0) {
			pos card@cardcontrol(3, cardid@cardcontrol), card@cardcontrol(4, cardid@cardcontrol)
			gcopy 3, 608, 216, 64, 96
		}
		card@cardcontrol(3, cardid@cardcontrol) = pilex@cardcontrol - dx@cardcontrol / 10 * cnt
		if (cnt == 9) {
			card@cardcontrol(3, cardid@cardcontrol) = pilex@cardcontrol - dx@cardcontrol
		}
		card@cardcontrol(4, cardid@cardcontrol) = piley@cardcontrol - dy@cardcontrol / 10 * cnt
		if (cnt == 9) {
			card@cardcontrol(4, cardid@cardcontrol) = piley@cardcontrol - dy@cardcontrol
		}
		gmode 0
		gsel 3
		pos 608, 216
		gcopy 0, card@cardcontrol(3, cardid@cardcontrol), card@cardcontrol(4, cardid@cardcontrol), 64, 96
		gsel 0
		gmode 2
		showcard2 cardid@cardcontrol
		showcardpile
		await 10
		redraw 1
	loop
	return cardid@cardcontrol



#deffunc showcardholder
	redraw 0
	repeat cardplayermax@cardcontrol
		p@cardcontrol = cnt
		repeat cardholdermax@cardcontrol
			dx@cardcontrol = cardplayer@cardcontrol(1, p@cardcontrol) + cnt * 88
			dy@cardcontrol = cardplayer@cardcontrol(2, p@cardcontrol)
			pos dx@cardcontrol - 8, dy@cardcontrol - 8
			gcopy 3, 528, 216, 80, 112
		loop
	loop
	return



#deffunc opencard2 int __qqq, int __rrr
	if (__rrr == 1) {
		if (card@cardcontrol(2, __qqq) == 0) {
			return __qqq
		}
	}
	snd 71
	repeat 10
		redraw 0
		if (__rrr == 0) {
			pos card@cardcontrol(3, __qqq) - 8, card@cardcontrol(4, __qqq) - 8
			gcopy 3, 528, 216, 80, 112
			gmode 2, 64, 96
		} else {
			pos card@cardcontrol(3, __qqq), card@cardcontrol(4, __qqq)
			gcopy 4, card@cardcontrol(3, __qqq) - wx - 4, card@cardcontrol(4, __qqq) - wy - 4, 80, 112
			gmode 2, 64, 96
		}
		pos card@cardcontrol(3, __qqq) + 32, card@cardcontrol(4, __qqq) + 48
		grotate 3, 736, 216, 0, 64 - cnt * 14, 96
		await 10
		redraw 1
	loop
	card@cardcontrol(2, __qqq) = 0
	showcard2 __qqq, __rrr
	redraw 1
	return __qqq



#deffunc trashcard int __sss
	repeat 21
		redraw 0
		pos card@cardcontrol(3, __sss) - 8, card@cardcontrol(4, __sss) - 8
		gcopy 3, 528, 216, 80, 112
		gmode 2, 64, 96
		if (cnt == 20) {
			redraw 1
			break
		}
		pos card@cardcontrol(3, __sss) + 32, card@cardcontrol(4, __sss) + 48
		grotate 3, 736, 216, 0.015 * cnt * cnt, 64 - cnt * 3, 96 - cnt * 4
		await 10
		redraw 1
	loop
	repeat cardplayermax@cardcontrol
		p@cardcontrol = cnt
		repeat cardholdermax@cardcontrol
			if (cardplayer@cardcontrol(10 + cnt, p@cardcontrol) == __sss) {
				cardplayer@cardcontrol(10 + cnt, p@cardcontrol) = -1
			}
		loop
	loop
	return __sss



#defcfunc cpscore int __ttt
	i@cardcontrol = 0
	ace@cardcontrol = 0
	repeat cardholdermax@cardcontrol
		c@cardcontrol = cardplayer@cardcontrol(10 + cnt, __ttt)
		if (c@cardcontrol == (-1)) {
			break
		}
		c@cardcontrol = card@cardcontrol(0, c@cardcontrol)
		if (c@cardcontrol >= 10) {
			c@cardcontrol = 10
		}
		if (c@cardcontrol == 1) {
			ace@cardcontrol++
			c@cardcontrol = 11
		}
		i@cardcontrol += c@cardcontrol
	loop
	repeat ace@cardcontrol
		if (i@cardcontrol > 21) {
			i@cardcontrol -= 10
		}
	loop
	return i@cardcontrol



#defcfunc lastcard int __uuu
	c@cardcontrol = 0
	repeat cardholdermax@cardcontrol
		if (cardplayer@cardcontrol(10 + cnt, __uuu) == (-1)) {
			break
		}
		c@cardcontrol = cardplayer@cardcontrol(10 + cnt, __uuu)
	loop
	return c@cardcontrol



#defcfunc cpblackcard int __vvv
	c@cardcontrol = 0
	repeat cardholdermax@cardcontrol
		c@cardcontrol = cardplayer@cardcontrol(10 + cnt, __vvv)
		if (card@cardcontrol(2, c@cardcontrol) == 1) {
			break
		}
	loop
	return c@cardcontrol



#defcfunc cpcardnum int __www
	c@cardcontrol = 0
	repeat cardholdermax@cardcontrol
		if (cardplayer@cardcontrol(10 + cnt, __www) != (-1)) {
			c@cardcontrol++
		}
	loop
	return c@cardcontrol



#defcfunc pileremain
	p@cardcontrol = 0
	repeat cardmax@cardcontrol
		if (card@cardcontrol(5, cnt) == (-1)) {
			p@cardcontrol++
		}
	loop
	return p@cardcontrol



#deffunc csvsort array __xxx, var __yyy, int __zzz
	p@m40(0) = 0
	repeat 40
		__xxx(cnt) = ""
		getstr __xxx(cnt), __yyy, p@m40(0), __zzz
		if (strsize == 0) {
			csvmax = cnt
			break
		}
		p@m40(0) += strsize
	loop
	return
*label_0269
	sdim randn1, 30, 20
	notesel titlebuff
	noteload exedir + lang("data\\ndata.csv", "data\\ndata-e.csv")
	sdim rnlist, 20, 15, noteinfo(0)
	repeat noteinfo(0)
		noteget msgtemp, cnt
		csvsort randn1, msgtemp, 44
		cnt2 = cnt
		repeat 15
			rnlist(cnt, cnt2) = randn1(cnt)
		loop
	loop
	notesel titlebuff
	noteload exedir + "data\\name.csv"
	sdim rn1, 15, noteinfo(0)
	sdim rn2, 15, noteinfo(0)
	repeat noteinfo(0)
		noteget msgtemp, cnt
		csvsort randn1, msgtemp, 44
		rn1(cnt) = lang(randn1(0), randn1(1))
		rn2(cnt) = lang(randn1(2), randn1(3))
	loop
	return
	sdim randn2@m41, 30, 20
	dim p@m41, 10



#defcfunc randomname int
*label_0271
	s@m41 = rn1(rnd(length(rn1)))
	if (s@m41 == "") {
		goto *label_0272
	}
	if (jp) {
		if (rnd(8) == 0) {
			s@m41 += "ー"
		}
	}
	if (rnd(5)) {
		s@m41 += rn2(rnd(length(rn2)))
	}
	p@m41 = strlen(s@m41)
	if (p@m41 < 4) {
		goto *label_0272
	}
	if (p@m41 < 6) {
		if (rnd(3)) {
			goto *label_0272
		}
	}
	if (p@m41 < 8) {
		if (rnd(2)) {
			goto *label_0272
		}
	}
	if (jp) {
		if (strmid(s@m41, 0, 2) == "ー") {
			goto *label_0272
		}
		if (instr(s@m41, 0, "ーッ") != (-1)) {
			goto *label_0272
		}
	}
	goto *label_0273
*label_0272
	goto *label_0271
*label_0273
	return cnven(s@m41)



#defcfunc random_title int __bbb
*label_0275
	repeat 1
		p@m41(2) = rnd(length2(rnlist))
		p@m41(1) = rnd(14)
		if (rnlist(p@m41(1), p@m41(2)) == "") {
			continue cnt
		}
	loop
	if (__bbb == 1 | __bbb == 3) {
		if (rnlist(14, p@m41(2)) == "具") {
			goto *label_0275
		}
	}
	randn2@m41 = rnlist(p@m41(1), p@m41(2)), rnlist(14, p@m41(2))
	rtval@m41 = -1
	if (jp) {
		repeat 1
			if (p@m41(1) == 10 | p@m41(1) == 11) {
				if (rnd(5) == 0) {
					p@m41(1) = 0
					p@m41(3) = rnd(2)
					if (p@m41(3) == 0) {
						randn2@m41 += "の"
					}
					break
				}
				p@m41 = rnd(5)
				if (p@m41 == 0) {
					randn2@m41 += "・オブ・"
				}
				if (p@m41 == 1) {
					randn2@m41 = "ザ・" + randn2@m41
					rtval@m41 = 1
					break
				}
				if (p@m41 == 2) {
					randn2@m41 += "・"
				}
			}
			if (p@m41(1) == 0 | p@m41(1) == 1) {
				randn2@m41 += "の"
				p@m41(3) = rnd(10)
				if (p@m41(3) == 0) {
					p@m41(1) = 10
				}
			}
		loop
	} else {
		repeat 1
			if (p@m41(1) == 0 | p@m41(1) == 1) {
				if (rnd(6) == 0) {
					randn2@m41 += " of"
				} else {
					if (rnd(6) == 0) {
						randn2@m41 = "the " + randn2@m41
						rtval@m41 = 1
						break
					}
				}
			}
			randn2@m41 += " "
		loop
		randn2@m41 = cnven(randn2@m41)
	}
	if (rtval@m41 == 1) {
		s@m41 = randn2@m41
		goto *label_0276
	}
	rtval@m41 = -1
	repeat 100
		p@m41(4) = rnd(length2(rnlist))
		if (p@m41(4) == p@m41(2)) {
			continue
		}
		if (rnlist(14, p@m41(4)) == randn2@m41(1)) {
			if (rnlist(14, p@m41(4)) != "万能") {
				if (randn2@m41(1) != "万能") {
					continue
				}
			}
		}
		if (p@m41(1) < 10) {
			p@m41(1) = rnd(2)
		} else {
			p@m41(1) = rnd(2)
			p@m41(1) += 10
		}
		if (rnlist(p@m41(1), p@m41(4)) == "") {
			continue
		}
		rtval@m41 = 1
		break
	loop
	if (rtval@m41 == (-1)) {
		goto *label_0275
	}
	if (en) {
		rnlist(p@m41(1), p@m41(4)) = cnven(rnlist(p@m41(1), p@m41(4)))
	}
	randn2@m41 += rnlist(p@m41(1), p@m41(4))
	s@m41 = randn2@m41
	if (strlen(s@m41) >= 28) {
		goto *label_0275
	}
*label_0276
	if (__bbb == 2) {
		if (jp) {
			s2@m41 = "団", "チーム", "パーティー", "の集い", "の軍", "アーミー", "隊", "の一家", "軍", "の隊", "の団"
			if (rnd(5)) {
				s@m41 += s2@m41(rnd(11))
			}
		} else {
			if (rnd(2)) {
				s2@m41 = "The army of ", "The party of ", "The house of ", "Clan "
				s@m41 = s2@m41(rnd(4)) + s@m41
			} else {
				s2@m41 = "Clan", "Party", "Band", "Gangs", "Gathering", "House", "Army"
				s@m41 += " " + s2@m41(rnd(7))
			}
		}
	}
	return s@m41

*label_0277
	if (hour_played == 1) {
		s += lang("ラーネイレ「がんばれ〜」", "Larnneire cheers, " + cnvtalk("Way to go!"))
	}
	if (hour_played == 2) {
		s += lang("ロミアス「陰ながら応援しているよ（ニヤリ）」", "Lomias grins, " + cnvtalk("Go for it."))
	}
	if (hour_played == 3) {
		s += lang("クミロミ「…大丈夫…だよね？」", "Kumiromi worries, " + cnvtalk("Are you...okay..?"))
	}
	if (hour_played == 4) {
		s += lang("ルルウィ「あら、思いの他がんばるのね」", "Lulwy sneers, " + cnvtalk("You're tougher than I thought, little kitty."))
	}
	if (hour_played == 5) {
		s += lang("ラーネイレ「いけない。このままでは…手遅れになってしまうわ…」", "Larnneire cries, " + cnvtalk("No...before it is too late..."))
	}
	if (hour_played == 6) {
		s += lang("ロミアス「まだまだ、これからだろう（ニヤリ）」", "Lomias grins, " + cnvtalk("It hasn't even started yet... has it?"))
	}
	if (hour_played == 7) {
		s += lang("ルルウィ「休憩しなさい。壊れちゃったら、私の役にたてないじゃない」", "Lulwy warns you, " + cnvtalk("Have a rest, kitty. If you are broken, you're no use to me."))
	}
	if (hour_played == 8) {
		s += lang("ルルウィ「何を言っても無駄のようね。好きにするといいわ」", "Lulwy laughs, " + cnvtalk("I guess there's no use warning you. Alright. Do as you please, kitty."))
	}
	if (hour_played == 12) {
		s += lang("オパートス「フハハハハッフハー」", "Opatos laughs, " + cnvtalk("Muwahahahahahaha!"))
	}
	if (hour_played == 24) {
		s += lang("エヘカトルはあなたに抱きついた。「死なにゃいで！死なにゃいって約束して！して！」", "Ehekatl hugs you," + cnvtalk("Don't die! Promise you don't die!"))
	}
	return
*label_0279
	dim ichipexchangetable, maxitemid
	dim ichipexchangeidranktable, maxitemid
	dim ichipexchangeidcurse, maxitemid
	ichipexchghbooks = 4
	sdim buffitemextbl
	sdim itemextbl, 30, 20
	sdim tmpitemextbl, 1024
	ichipexchgnum = 0
	p = 0
	file = exedir + "data\\" + "itemEx.csv"
	exist file
	if (strsize != (-1)) {
		buffitemextbl = ""
		notesel buffitemextbl
		noteload file
		repeat noteinfo(0)
			noteget tmpitemextbl, cnt
			csvsort itemextbl, tmpitemextbl, 44
			if (itemextbl(0) == "HBooks") {
				if (int(itemextbl(1)) > 0) {
					ichipexchghbooks = int(itemextbl(1))
				}
				continue
			}
			if (csvmax >= 2) {
				itmid = int(itemextbl(0))
				picid = int(itemextbl(1))
				if (0 < itmid & itmid < maxitemid) {
					if (0 < picid & picid < 33 * 25) {
						ichipexchangetable(itmid) = picid + 33 * 25
						if (csvmax >= 3 & int(itemextbl(2)) != 0) {
							chipi(3, picid + 33 * 25) = int(itemextbl(2))
							p += int(itemextbl(2)) == 96
						}
						if (csvmax >= 4 & int(itemextbl(3)) != 0) {
							chipi(4, picid + 33 * 25) = int(itemextbl(3))
						}
						if (csvmax >= 5 & int(itemextbl(4)) != 0) {
							chipi(5, picid + 33 * 25) = int(itemextbl(4))
						}
						if (csvmax >= 6 & int(itemextbl(5)) != 0) {
							chipi(6, picid + 33 * 25) = int(itemextbl(5))
						}
						if (csvmax >= 7 & int(itemextbl(6)) != 0) {
							ichipexchangetable(itmid) += int(itemextbl(6)) * 10000
						}
						if (csvmax >= 8 & int(itemextbl(7)) != 0) {
							ichipexchangetable(itmid) += int(itemextbl(7)) * 1000000
						}
						if (csvmax >= 9 & int(itemextbl(8)) != 0) {
							ichipexchangeidranktable(itmid) = int(itemextbl(8))
						}
						if (csvmax >= 10 & int(itemextbl(9)) != 0) {
							ichipexchangeidcurse(itmid) = int(itemextbl(9))
						}
						ichipexchgnum++
					}
				}
			}
		loop
		noteunsel
	}
	folder = exedir + "user\\graphic\\"
	dirlist buff, folder + "itemEx2_*.bmp"
	if (stat) {
		notesel buff
		buffer 33, 384, 48 * stat + p * 48
		p2 = 0
		repeat stat
			noteget file, cnt
			pos 0, p2
			picload_ folder + file, 1
			p = int(strmid(file, 8, instr(file, 8, ".")))
			chipi(0, p + 33 * 25) = 0
			chipi(1, p + 33 * 25) = p2
			p2 += chipi(3, p + 33 * 25)
		loop
		noteunsel
	}
	return
*label_0280
	file = exedir + "data\\" + "charaEx.csv"
	exist file
	if (strsize != (-1)) {
		charaffhpflag = 1
		dim cchipexchangetable, maxcharaid, 2
		notesel buff
		noteload file
		sdim splitcsv, 64, 20, 2
		noteget s, 0
		csvstr2d splitcsv, 0, s, 20
		repeat noteinfo(0) - 1
			noteget s, cnt + 1
			csvstr2d splitcsv, 1, s, 20
			chrid = int(getcsvfield(splitcsv, "id"))
			chrsex = int(getcsvfield(splitcsv, "sex"))
			picid = int(getcsvfield(splitcsv, "pic"))
			if (0 <= chrid & chrid < maxcharaid) {
				if (0 <= picid & picid < 33 * 25) {
					cchipexchangetable(chrid, chrsex) = picid + 33 * 25 + 900
					if (int(getcsvfield(splitcsv, "hight")) != 0) {
						chipc(3, picid + 33 * 25 + 900) = int(getcsvfield(splitcsv, "hight"))
					}
					if (int(getcsvfield(splitcsv, "setpos")) != 0) {
						chipc(4, picid + 33 * 25 + 900) = int(getcsvfield(splitcsv, "setpos"))
					}
					if (chipc(3, picid + 33 * 25 + 900) > 48) {
						if (chipc(4, picid + 33 * 25 + 900) == int(getcsvfield(splitcsv, "setpos")) | chipc(4, picid + 33 * 25 + 900) == 16) {
							chipc(4, picid + 33 * 25 + 900) += inf_tiles
						}
					}
					if (int(getcsvfield(splitcsv, "color")) != 0) {
						cchipexchangetable(chrid, chrsex) += int(getcsvfield(splitcsv, "color")) * 10000
					}
				}
			}
		loop
		noteunsel
	}
	return



#include "item.hsp"



#deffunc equipinfo int __ppp, int __qqq, int __rrr
	if (iIdentificationState(__ppp) < 3) {
		return
	}
	if (cfg_equipex == 1) {
		if (showressub == 0) {
			repeat 15
				p@m66 = iEnchantmentId(__ppp, cnt)
				if (p@m66 == 0) {
					break
				}
				i@m66 = p@m66 / 10000
				if (i@m66 != 2) {
					continue
				}
				i@m66 = p@m66 \ 10000
				pos __qqq + (i@m66 - 50) * 20, __rrr
				p@m66 = abs(iEnchantmentPower(__ppp, cnt) / 2 / 50) + 1
				if (p@m66 > 5) {
					s@m66 = "+"
				} else {
					s@m66 = "" + p@m66
				}
				if (jp) {
					colorres
					if (iEnchantmentPower(__ppp, cnt) >= 0) {
						mes "●"
					} else {
						mes "▼"
					}
					pos __qqq + (i@m66 - 50) * 20 + 5, __rrr + 1
					color 0, 0, 0
					mes s@m66
					pos __qqq + (i@m66 - 50) * 20 + 4, __rrr
					color 255, 255, 255
					mes s@m66
				} else {
					color 80, 60, 40
					pos __qqq + (i@m66 - 50) * 20 + 5, __rrr
					mes "" + s@m66
					colorres
					pos __qqq + (i@m66 - 50) * 20 + 4, __rrr
					mes "" + s@m66
				}
			loop
		} elseif (showressub == 1) {
			repeat 10, 10
				oom_cnt = cnt
				repeat 15
					f@00m = 0
					p@m66 = iEnchantmentId(__ppp, cnt)
					if (p@m66 == 0) {
						break
					}
					i@m66 = p@m66 / 10000
					if (i@m66 != 6) {
						continue
					}
					i@m66 = p@m66 \ 10000
					if (i@m66 == oom_cnt) {
						f@00m = 1
						break
					}
				loop
				if (f@00m == 1) {
					color 0, 100, 100
					pos __qqq + (oom_cnt - 10) * 20 + en * 4, __rrr
					mes lang("●", "#")
				} else {
					color 0, 100, 100
					pos __qqq + (oom_cnt - 10) * 20 + 4, __rrr
					mes "-"
				}
			loop
			repeat 6, 23
				oom_cnt = cnt
				repeat 15
					f@00m = 0
					p@m66 = iEnchantmentId(__ppp, cnt)
					if (p@m66 == 0) {
						break
					}
					i@m66 = p@m66 / 10000
					if (i@m66 != 0) {
						continue
					}
					i@m66 = p@m66 \ 10000
					if (i@m66 == oom_cnt) {
						f@00m = 1
						break
					}
				loop
				if (f@00m == 1) {
					color 100, 32, 0
					pos __qqq + (oom_cnt - 23) * 20 + 200 + en * 4, __rrr
					mes lang("●", "#")
				} else {
					color 100, 32, 0
					pos __qqq + (oom_cnt - 23) * 20 + 204, __rrr
					mes "-"
				}
			loop
		} elseif (showressub == 2) {
			_wx = 0
			getinheritance __ppp, inhlist, inhmax
			if (equipfilter < 0) {
				repeat 15
					p@m66 = iEnchantmentId(__ppp, cnt)
					if (p@m66 == 0) {
						break
					}
					f@00m = 0
					if (p@m66 / 10000 == abs(equipfilter) / 10000) {
						f@00m = 1
					}
					if (p@m66 / 10000 == 0) {
						if (equipfilter / 10000 == (-10)) {
							f@00m = 1
						}
					}
					if (f@00m == 1) {
						i@m66 = p@m66 \ 10000
						if (iEnchantmentPower(__ppp, cnt) >= equipfilterpower) {
							cnt2 = cnt
							color 10, 40, 120
							if (oom_inheritance_search == 1) {
								f@00m = 0
								repeat inhmax
									if (cnt2 == inhlist(cnt)) {
										color 120, 40, 10
										f@00m = 1
										break
									}
								loop
							}
							if (f@00m == 1 & oom_inheritance_search == 1 | oom_inheritance_search == 0) {
								pos __qqq + _wx, __rrr
								if (p@m66 / 10000 == 8) {
									mes skillname(encprocref(0, i@m66))
								} elseif (p@m66 / 10000 == 9) {
									mes ammoname(i@m66)
								} elseif (p@m66 / 10000 == 0) {
									repeat 43
										if (encetc(cnt) == i@m66) {
											mes encetcn(1, cnt)
											break
										}
									loop
								} else {
									mes skillname(i@m66)
								}
								_wx += ginfo(14) + 10
							}
						}
					}
				loop
			}
		} elseif (showressub == 3) {
			color 100, 32, 0
			if (ibit_isFireproof(__ppp)) {
				pos __qqq, __rrr
				mes lang("●", "#")
			}
			if (ibit_isAcidproof(__ppp)) {
				pos __qqq + 20, __rrr
				mes lang("●", "#")
			}
			repeat 15
				p@m66 = iEnchantmentId(__ppp, cnt)
				if (p@m66 == 0) {
					break
				}
				if (p@m66 == 32) {
					pos __qqq + 40, __rrr
					mes lang("●", "#")
				}
				if (p@m66 == 48) {
					pos __qqq + 60, __rrr
					mes lang("●", "#")
				}
				if (p@m66 == 42) {
					pos __qqq + 80, __rrr
					mes lang("●", "#")
				}
				if (p@m66 == 56) {
					pos __qqq + 100, __rrr
					mes lang("●", "#")
				}
			loop
			encIcon_draw __ppp, __qqq + 40, __rrr
		}
	} else {
		repeat 15
			p@m66 = iEnchantmentId(__ppp, cnt)
			if (p@m66 == 0) {
				break
			}
			i@m66 = p@m66 / 10000
			if (i@m66 != 2) {
				continue
			}
			i@m66 = p@m66 \ 10000
			pos __qqq + (i@m66 - 50) * 20, __rrr
			p@m66 = abs(iEnchantmentPower(__ppp, cnt) / 2 / 50) + 1
			if (p@m66 > 5) {
				s@m66 = "+"
			} else {
				s@m66 = "" + p@m66
			}
			if (jp) {
				colorres
				if (iEnchantmentPower(__ppp, cnt) >= 0) {
					mes "●"
				} else {
					mes "▼"
				}
				pos __qqq + (i@m66 - 50) * 20 + 5, __rrr + 1
				color 0, 0, 0
				mes s@m66
				pos __qqq + (i@m66 - 50) * 20 + 4, __rrr
				color 255, 255, 255
				mes s@m66
			} else {
				color 80, 60, 40
				pos __qqq + (i@m66 - 50) * 20 + 5, __rrr
				mes "" + p@m66
				colorres
				pos __qqq + (i@m66 - 50) * 20 + 4, __rrr
				mes "" + p@m66
			}
		loop
	}
	return



#deffunc csvstr2 array __sss, str __ttt
	word@m67 = __ttt
	p@m67 = 0
	i@m67 = strlen(word@m67)
	repeat 40
		__sss(cnt) = ""
		getstr __sss(cnt), word@m67, limit(p@m67, 0, i@m67), 44
		if (strsize > i@m67) {
			break
		}
		p@m67 += strsize
	loop
	return
*label_0375



#deffunc cargocheck
	if (refitem(iId(ci), 10, ci) == 0) {
		return 1
	}
	if (mapType != 1 & mapType != 5 & mapType != 3 & mapType != 4 & mapType != 6 & mapType != 2) {
		msgdup++
		txt -1, lang("荷車の荷物は街か野外でしか操作できない。", "You can only use cargo items on the surface.")
		snd 27
		return 0
	} else {
		return 1
	}
	goto *label_0422



#deffunc rndshuffle array __uuu, int __vvv
	if (__vvv == 0) {
		p@m68 = length(__uuu)
	} else {
		p@m68 = __vvv
	}
	repeat p@m68
		r@m68 = rnd(p@m68)
		p@m68--
		i@m68 = __uuu(r@m68)
		__uuu(r@m68) = __uuu(p@m68)
		__uuu(p@m68) = i@m68
	loop
	return



#defcfunc dist int __www, int __xxx, int __yyy, int __zzz
	d@m69 = (__www - __yyy) * (__www - __yyy) + (__xxx - __zzz) * (__xxx - __zzz)
	return int(sqrt(d@m69))



#defcfunc winposy int __aaa, int __bbb
	if (__bbb == 0) {
		return ((inf_screenh + 1) * inf_tiles - __aaa) / 2 + 8
	}
	return (windowh - __aaa) / 2



#deffunc cutname var __ccc, int __ddd
	if (strlen(__ccc) > __ddd) {
		len@m71 = zentohan(__ccc, buf@m71, 0)
		sdim buf@m71, len@m71
		ret@m71 = zentohan(__ccc, __ccc, len@m71)
		if (strlen(__ccc) > __ddd) {
			len@m71 = 0
			repeat
				if (len@m71 >= __ddd) {
					break
				}
				p@m71 = peek(__ccc, len@m71)
				if (p@m71 >= 129 & p@m71 <= 159 | p@m71 >= 224 & p@m71 <= 252) {
					p@m71 = 2
				} else {
					p@m71 = 1
				}
				len@m71 += p@m71
			loop
			__ccc = strmid(__ccc, 0, len@m71) + ".."
		}
	}
	return



#deffunc cs_list str __eee, int __fff, int __ggg, int __hhh, int __iii, int __jjj, int __kkk
	if (cs == cnt) {
		tx@m72 = limit(strlen(__eee) * 7 + 32 + __iii, 10, 480)
		gsel 3
		pos 264, 96
		gcopy 0, __fff, __ggg, tx@m72, __hhh
		gsel 0
		pos __fff, __ggg
		gfini tx@m72, __hhh
		gfdec2 30, 10, 0
		pos __fff + 1, __ggg + 1
		gfini tx@m72 - 2, __hhh - 2
		gfinc 50, 50, 50
		pos __fff + tx@m72 - 20, __ggg + 4
		gcopy 3, 48, 360, 16, 16
		cs_posbk = __fff, __ggg, tx@m72, __hhh
	}
	if (__jjj == 0) {
		color 10, 10, 10
	}
	if (__jjj == 1) {
		color 0, 0, 0
		if (iIdentificationState(__kkk) >= 3) {
			color 10, 40, 120
			if (iCurseState(__kkk) == 1) {
				color 10, 110, 30
			}
			if (iCurseState(__kkk) == (-1)) {
				color 150, 10, 10
			}
			if (iCurseState(__kkk) == (-2)) {
				color 100, 10, 100
			}
		}
		if (ibit(13, __kkk)) {
			color 120, 80, 0
		}
		if (ibit(22, __kkk)) {
			color 100, 100, 250
		}
	}
	if (__jjj == 2) {
		color 240, 240, 240
	}
	if (__jjj == 3) {
		color 160, 10, 10
	}
	if (__jjj == 4) {
		if (ogdata(440 + __kkk) == 1 | ogdata(440 + __kkk) == 0) {
			color 130, 130, 130
		} else {
			color 10, 10, 10
		}
	}
	if (__jjj == 5) {
			color 130, 130, 130
	}
	if (__jjj == 6) {
			color 10, 10, 10
	}
	if (__jjj == 7) {
		if (ncgdata(300 + __kkk) == 0) {
			color 130, 130, 130
		} else {
			color 10, 10, 10
		}
	}
	pos __fff + 4 + __iii, __ggg + 3
	mes __eee
	return



#deffunc cs_listbk
	if (cs_bk == (-1)) {
		return
	}
	pos cs_posbk, cs_posbk(1)
	gcopy 3, 264, 96, cs_posbk(2), cs_posbk(3)
	return



#deffunc gohostile
	repeat 188, 57
		dup roopbuf, cRole(cnt)
		if (roopbuf == 14 | roopbuf == 16 | roopbuf == 1010) {
			cRelationship(cnt) = -3
			cHate(cnt) = 80
			cEmotionIcon(cnt) = 18 + 100 * 2
			lockon cnt, 0, 0
		}
	loop
	return



#deffunc modkarma int __lll, int __mmm
	a@m74 = __mmm
	if (a@m74 < 0 & cKarma(__lll) < 0) {
		decjusticweapon __lll
	}
	if (gettrait(__lll, 162)) {
		if (a@m74 < 0) {
			a@m74 = a@m74 * 75 / 100
			if (a@m74 == 0) {
				return
			}
		}
	}
	if (gettrait(__lll, 169)) {
		if (a@m74 < 0) {
			a@m74 = a@m74 * 150 / 100
		}
	}
	if (trophycheck(17) == 2 & a@m74 > 0) {
		a@m74 = a@m74 * 2
	}
	if (a@m74 >= 0) {
		txtef 5
	} else {
		txtef 8
	}
	txt -1, lang("カルマ変動(" + a@m74 + ") ", "Karma(" + a@m74 + ")")
	if (a@m74 > 0) {
		if (cKarma(__lll) < (-30)) {
			if (cKarma(__lll) + a@m74 >= (-30)) {
				txtef 2
				txt -1, lang("あなたの罪は軽くなった。", "You are no longer a criminal.")
				if (__lll == 0) {
					throwsstpevent "Atonement", 0, "", 0
				}
			}
		}
	}
	if (a@m74 < 0) {
		if (cKarma(__lll) >= (-30)) {
			if (cKarma(__lll) + a@m74 < (-30)) {
				txtef 8
				txt -1, lang("あなたは今や罪人だ。", "You are a criminal now.")
				gohostile
				if (__lll == 0) {
					throwsstpevent "BecomeCriminal", 0, "", 0
				}
			}
		}
	}
	cKarma(__lll) += a@m74
	max@m74 = 20
	if (gettrait(__lll, 162)) {
		max@m74 -= 20
	}
	if (gettrait(__lll, 169)) {
		max@m74 += 20
	}
	if (ogdata(461) == 2) {
		max@m74 += 20
	}
	if (ogdata(538) == 2) {
		max@m74 += 10
	}
	if (trophycheck(10) == 2) {
		max@m74 += 10
	}
	if (cKarma(__lll) > max@m74) {
		cKarma(__lll) = max@m74
	}
	if (cKarma(__lll) < (-100)) {
		cKarma(__lll) = -100
	}
	return



#deffunc modrank int __nnn, int __ooo, int __ppp
	p@m75 = 120 + __nnn
	p@m75(1) = gdata(p@m75) / 100
	orgrank@m75 = gdata(p@m75)
	i@m75 = __ooo
	if (__ooo > 0) {
		i@m75 = __ooo * (p@m75(1) + 20) * (p@m75(1) + 20) / 2500
		gdata(140 + __nnn) = ranknorma(__nnn)
		if (gdata(p@m75) == 100) {
			if (__nnn == 8) {
				newtitle 100
			}
			return
		}
		if (__ppp != 0) {
			if (i@m75 / 100 > __ppp) {
				i@m75 = __ppp * 100
			}
		}
	}
	gdata(p@m75) -= i@m75
	if (gdata(p@m75) >= 10000) {
		gdata(p@m75) = 10000
	}
	if (gdata(p@m75) < 100) {
		gdata(p@m75) = 100
	}
	if (orgrank@m75 / 100 != gdata(p@m75) / 100) {
		i@m75 = gdata(p@m75) / 100 - orgrank@m75 / 100
		if (i@m75 < 0) {
			txtef 2
		} else {
			txtef 8
		}
		s@m75 = " " + orgrank@m75 / 100 + lang("位 → ", " -> ") + gdata(p@m75) / 100 + lang("位 ", "")
		txt -1, lang("ランク変動", "Ranking Change ") + "(" + rankn(10, __nnn) + s@m75 + ") " + lang("《", "<") + ranktitle(__nnn) + lang("》", ">")
	} else {
		if (i@m75 > 0) {
			txtef 2
			txt -1, lang("着実に次のランクに近づいている。", "You are one step closer to the next rank.")
		}
	}
	if (__nnn == 8) {
		if (gdata(p@m75) / 100 == 1) {
			newtitle 100
		}
	}
	return

#defcfunc stexp int __qqq, int __rrr
	return sdata(__qqq, __rrr) \ 1000000 / 1000

#defcfunc sexp int __qqq, int __rrr
	return sdata(__qqq + 600, __rrr) \ 1000000 / 1000



#defcfunc sgrowth int __sss, int __ttt
	return sdata(__sss + 600, __ttt) \ 1000



#deffunc modgrowth int __uuu, int __vvv, int __www
	growth@m76 = sdata(__vvv + 600, __uuu) \ 1000 + __www
	if (ogdata(504) == 2) {
		if (growth@m76 > 450 + nc_intb_gro1) {
			growth@m76 = 450 + nc_intb_gro1
		}
		if (nc_intb_nightmare & __vvv >= 20) {
			if (growth@m76 < 50) {
				growth@m76 = 50
			}
			if (trophycheck(22) == 2 & growth@m76 < 100) {
				growth@m76 = 100
			}
		} else {
			if (growth@m76 < 52) {
				growth@m76 = 52
			}
			if (trophycheck(22) == 2 & growth@m76 < 102) {
				growth@m76 = 102
			}
		}
	} else {
		if (growth@m76 > 400 + nc_intb_gro1) {
			growth@m76 = 400 + nc_intb_gro1
		}
		if (nc_intb_nightmare & __vvv >= 20) {
			if (growth@m76 < 0) {
				growth@m76 = 0
			}
			if (trophycheck(22) == 2 & growth@m76 < 50) {
				growth@m76 = 50
			}
		} else {
			if (growth@m76 < 2) {
				growth@m76 = 2
			}
			if (trophycheck(22) == 2 & growth@m76 < 52) {
				growth@m76 = 52
			}
		}
	}
	sdata(__vvv + 600, __uuu) = sorg(__vvv, __uuu) * 1000000 + sexp(__vvv, __uuu) * 1000 + growth@m76
	return



#deffunc skillgain int __cc, int __skillId, int __initialLevel, int __spellStock
	if (__skillId >= 400) {
		if (__cc == 0) {
			spell(__skillId - 400) = limit(spell(__skillId - 400) + __spellStock, 0, 2000000000)
			if (__initialLevel) {
				modgrowth2 __cc, __skillId, __initialLevel
			} else {
				modgrowth2 __cc, __skillId, 1
			}
		}
	}
	if (sorg(__skillId, __cc) != 0) {
		if (__skillId < 400) {
			modgrowth2 __cc, __skillId, 20
		}
		return
	}
	lv@m76 = __initialLevel
	if (lv@m76 < 1) {
		lv@m76 = 1
	}
	if (__skillId >= 400) {
		modgrowth2 __cc, __skillId, 200
	} else {
		modgrowth2 __cc, __skillId, 50
	}
	sdata(__skillId + 600, __cc) = limit(lv@m76, 0, 2000) * 1000000 + sexp(__skillId, __cc) * 1000 + sgrowth(__skillId, __cc)
	r1 = __cc
	gosub *chara_refresh
	return



#deffunc skillmod int __skillId, int __cc, int __exp
	lv@m77 = sorgEx(__skillId, __cc)
	exp@m77 = sexp(__skillId, __cc) + __exp
	growth@m77 = sgrowth(__skillId, __cc)
	if (growth@m77 == 0) {
		return
	}
	if (exp@m77 >= 1000) {
		lvchange@m77 = exp@m77 / 1000
		lv@m77 += lvchange@m77
		exp@m77 = exp@m77 \ 1000
		repeat lvchange@m77
			growth@m77 = int(double(growth@m77) * 0.9)
			if (ogdata(504) == 2) {
				if (growth@m77 < 51) {
					growth@m77 = 51
				}
				if (trophycheck(22) == 2 & growth@m77 < 101) {
					growth@m77 = 101
				}
			} else {
				if (growth@m77 < 1) {
					growth@m77 = 1
				}
				if (trophycheck(22) == 2 & growth@m77 < 51) {
					growth@m77 = 51
				}
			}
		loop
		sdata(__skillId + 600, __cc) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
		if (__cc <= 15) {
			if (ogdata(499) != 0) {
				if (2000 < lv@m77) {
					sdataEx(__skillId, __cc) = limit(lv@m77 - 2000, 0, skillMaxLevelEx)
				}
			}
		}
		if (synccheck(__cc, -1)) {
			if (__cc == 0 | petcheck(__cc)) {
				snd 61
				txtef 2
			}
			txt -1, txtskillchange(__skillId, 0, __cc)
			gosub *label_1177
		}
		r1 = __cc
		gosub *chara_refresh
		return 1
	}
	if (exp@m77 < 0) {
		lvchange@m77 = -exp@m77 / 1000 + 1
		exp@m77 = 1000 + exp@m77 \ 1000
		if (lv@m77 - lvchange@m77 < 1) {
			lvchange@m77 = limitmin(lv@m77 - 1, 0)
			if (lv@m77 == 1) {
				if (lvchange@m77 == 0) {
					exp@m77 = 0
				}
			}
		}
		lv@m77 -= lvchange@m77
		repeat lvchange@m77
			growth@m77 = int(double(growth@m77) * -0.9 + 2) + 1
			if (ogdata(504) == 2) {
				if (growth@m77 > 450 + nc_intb_gro1) {
					growth@m77 = 450 + nc_intb_gro1
				}
			} else {
				if (growth@m77 > 400 + nc_intb_gro1) {
					growth@m77 = 400 + nc_intb_gro1
				}
			}
		loop
		sdata(__skillId + 600, __cc) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
		if (__cc <= 15) {
			if (ogdata(499) != 0) {
				sdataEx(__skillId, __cc) = limit(lv@m77 - 2000, 0, skillMaxLevelEx)
			}
		}
		if (__cc == 0 | petcheck(__cc)) {
			if (synccheck(__cc, -1)) {
				if (lvchange@m77 != 0) {
					txtef 3
					txt -1, txtskillchange(__skillId, 1, __cc)
					gosub *label_1177
				}
			}
		}
		r1 = __cc
		gosub *chara_refresh
		return 1
	}
	sdata(__skillId + 600, __cc) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
	if (__cc <= 15) {
		if (ogdata(499) != 0) {
			if (2000 < lv@m77) {
				sdataEx(__skillId, __cc) = limit(lv@m77 - 2000, 0, skillMaxLevelEx)
			}
		}
	}
	return



#deffunc skillexp int __skillId, int __cc, int __exp, int __relatedBasicAttrExpModifier, int __charaLevelExpModifier
	if (sorg(__skillId, __cc) == 0) {
		return 0
	}
	if (__exp == 0) {
		return
	}
	if (sdataref(0, __skillId) != 0) {
		skillexp sdataref(0, __skillId), __cc, __exp / (2 + __relatedBasicAttrExpModifier)
	}
	lv@m77 = sorgEx(__skillId, __cc)
	growth@m77 = sgrowth(__skillId, __cc)
	if (growth@m77 == 0) {
		return
	}
	if (__cc == 0) {
		if (gettrait(__cc, 193) < 0) {
			return
		}
	}
	if (__exp > 0) {
		exp@m77 = limit(__exp * growth@m77 / (100 + lv@m77 * 15), 0, 2000000000)
		if (__skillId >= 10) {
			if (__skillId <= 19) {
				if (cdata(270 + __skillId - 10, __cc) > 0) {
					exp@m77 = limit(exp@m77 * (100 + cdata(270 + __skillId - 10, __cc)) / 100, 0, 2000000000)
				}
			}
		}
		if (findbuff(__cc, 85) != (-1)) {
			exp@m77 = limit(exp@m77 * (100 + limitmax(ocdata(192 + findbuff(__cc, 85) * 3 + 1, __cc) / 200, 500)) / 100, 0, 2000000000)
		}
		if (exp@m77 == 0) {
			if (growth@m77 == 400 & rnd(lv@m77 / 100 + 1) == 0) {
				exp@m77 = 1
			} else {
				if (rnd(lv@m77 / 10 + 1) == 0) {
					exp@m77 = 1
				} else {
					return 0
				}
			}
		}
	} else {
		exp@m77 = __exp
	}
	if (gCurrentMap == 35) {
		exp@m77 /= 5
	}
	if (exp@m77 > 0) {
		if (exp@m77 >= 1000) {
			if (exp@m77 > lv@m77 * 1000) {
				expbk@m77 = exp@m77
				exp@m77 = limitmax(exp@m77, lv@m77 * 1000)
				growth2@m77 = (expbk@m77 - exp@m77) / 100
			}
		}
		if (__skillId >= 100) {
			if (__charaLevelExpModifier != 1000) {
				exp2@m77 = rndex(limit(cRequiredExperience(__cc) * exp@m77 / 1000 / (cLevel(__cc) + __charaLevelExpModifier) + 1, 1, 1000000)) + rnd(2)
				cExperience(__cc) += exp2@m77
				if (__cc == 0) {
					gSleepExperience += exp2@m77
				}
			}
		}
	}
	exp@m77 += sexp(__skillId, __cc)
	if (exp@m77 >= 1000) {
		lvchange@m77 = exp@m77 / 1000
		exp@m77 = exp@m77 \ 1000
		lv@m77 += lvchange@m77
		if (NC_intb_ndf == 0) {
			if (__cc < 16) {
				if (__skillId == 2) {
					if (ncgdata(218) < 2000000000) {
						ncgdata(218) += lvchange@m77
					}
				}
				if (__skillId == 3) {
					if (ncgdata(219) < 2000000000) {
						ncgdata(219) += lvchange@m77
					}
				}
				if (__skillId > 9 & __skillId <= 17) {
					if (ncgdata(200 + __skillId) < 2000000000) {
						ncgdata(200 + __skillId) += lvchange@m77
					}
				}
			}
		}
		repeat lvchange@m77
			growth@m77 = int(double(growth@m77) * 0.9)
			if (ogdata(504) == 2) {
				if (growth@m77 < 51) {
					growth@m77 = 51
				}
				if (trophycheck(22) == 2 & growth@m77 < 101) {
					growth@m77 = 101
				}
			} else {
				if (growth@m77 < 1) {
					growth@m77 = 1
				}
				if (trophycheck(22) == 2 & growth@m77 < 51) {
					growth@m77 = 51
				}
			}
		loop
		if (growth2@m77 != 0) {
			growth@m77 += growth2@m77
			if (ogdata(504) == 2) {
				if (growth@m77 > 450 + nc_intb_gro1) {
					growth@m77 = 450 + nc_intb_gro1
				}
			} else {
				if (growth@m77 > 400 + nc_intb_gro1) {
					growth@m77 = 400 + nc_intb_gro1
				}
			}
			growth2@m77 = 0
		}
		sdata(__skillId + 600, __cc) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
		if (__cc <= 15) {
			if (ogdata(499) != 0) {
				if (2000 < lv@m77) {
					sdataEx(__skillId, __cc) = limit(lv@m77 - 2000, 0, skillMaxLevelEx)
				}
			}
		}
		if (synccheck(__cc, -1) | petcheck(__cc)) {
			if (__cc == 0 | petcheck(__cc)) {
				snd 61
				txtef 2
				msgalert = 1
			}
			txt -1, txtskillchange(__skillId, 0, __cc)
			gosub *label_1177
		}
		r1 = __cc
		gosub *chara_refresh
		return 1
	}
	if (exp@m77 < 0) {
		lvchange@m77 = -exp@m77 / 1000 + 1
		exp@m77 = 1000 + exp@m77 \ 1000
		if (lv@m77 - lvchange@m77 < 1) {
			lvchange@m77 = lv@m77 - 1
			if (lv@m77 == 1) {
				if (lvchange@m77 == 0) {
					exp@m77 = 0
				}
			}
		}
		lv@m77 -= lvchange@m77
		repeat lvchange@m77
			growth@m77 = int(double(growth@m77) * ((-0.9) + 2)) + 1
			if (ogdata(504) == 2) {
				if (growth@m77 > 450 + nc_intb_gro1) {
					growth@m77 = 450 + nc_intb_gro1
				}
			} else {
				if (growth@m77 > 400 + nc_intb_gro1) {
					growth@m77 = 400 + nc_intb_gro1
				}
			}
		loop
		sdata(__skillId + 600, __cc) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
		if (__cc <= 15) {
			if (ogdata(499) != 0) {
				sdataEx(__skillId, __cc) = limit(lv@m77 - 2000, 0, skillMaxLevelEx)
			}
		}
		if (synccheck(__cc, -1) | petcheck(__cc)) {
			if (__cc == 0 | petcheck(__cc)) {
				if (lvchange@m77 != 0) {
					msgalert = 1
					txtef 3
					txt -1, txtskillchange(__skillId, 1, __cc)
					gosub *label_1177
				}
			}
		}
		r1 = __cc
		gosub *chara_refresh
		return 1
	}
	sdata(__skillId + 600, __cc) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
	if (__cc <= 15) {
		if (ogdata(499) != 0) {
			sdataEx(__skillId, __cc) = limit(lv@m77 - 2000, 0, skillMaxLevelEx)
		}
	}
	return 0

#defcfunc calcfame int __jjj, int __kkk
	p@m77 = limitIntMax(double(__kkk) * 100) / (100 + limitIntMax(double(cFame(__jjj)) / 100 * (cFame(__jjj) / 100)) / 2500)
	if (p@m77 < 5) {
		p@m77 = rnd(5) + 1
	}
	return p@m77

#deffunc decfame int __lll, int __mmm
	p@m77 = cFame(__lll) / __mmm + 5
	p@m77 = p@m77 + rndex(p@m77 / 2) - rndex(p@m77 / 2)
	cFame(__lll) -= p@m77
	if (cFame(__lll) < 0) {
		cFame(__lll) = 0
	}
	return p@m77



#defcfunc getworker int __nnn, int __ooo
	p@m78 = -1
	repeat 16
		if (cnt == 0) {
			continue
		}
		if (__ooo != 0) {
			if (cnt != __ooo) {
				continue
			}
		}
		if (cCurrentMap(cnt) == __nnn) {
			if (ocPetJob(cnt) != sId_geneEngineering) {
				p@m78 = cnt
				break
			}
		}
	loop
	return p@m78



#deffunc removeworker int __ppp
	repeat 16
		if (cnt == 0) {
			continue
		}
		if (cCurrentMap(cnt) == __ppp) {
			if (ocPetJob(cnt) != sId_geneEngineering) {
				cCurrentMap(cnt) = 0
			}
		}
	loop
	return



#defcfunc calcshopreform
	return mapItemMax * 100 + 1000



#deffunc delmef int __qqq
	if (mef(0, __qqq) == 7) {
		evadd 21, mef(2, __qqq), mef(3, __qqq)
	}
	map(mef(2, __qqq), mef(3, __qqq), 8) = 0
	mef(0, __qqq) = 0
	i@m79 = 200 - 1
	repeat 200 - __qqq
		if (mef(0, i@m79) != 0) {
			repeat 9
				mef(cnt, __qqq) = mef(cnt, i@m79)
			loop
			map(mef(2, i@m79), mef(3, i@m79), 8) = __qqq + 1
			mef(0, i@m79) = 0
			break
		}
		i@m79--
	loop
	return



#deffunc addmef int __rrr, int __sss, int __ttt, int __uuu, int __vvv, int __www, int __xxx, int __yyy, int __zzz, int __aaa
	p@m79 = map(__rrr, __sss, 0)
	if (__ttt == 5) {
		if (chipm(0, p@m79) == 3) {
			return
		}
	}
	if (map(__rrr, __sss, 8) != 0) {
		i@m79 = map(__rrr, __sss, 8) - 1
	} else {
		i@m79 = -1
		repeat 200
			if (mef(0, cnt) == 0) {
				i@m79 = cnt
				break
			}
		loop
		if (i@m79 == (-1)) {
			i@m79 = rnd(200)
			map(mef(2, i@m79), mef(3, i@m79), 8) = 0
		}
	}
	mef(0, i@m79) = __ttt, __uuu + __aaa * 10000, __rrr, __sss, __vvv, __www, __xxx, __yyy, __zzz
	map(__rrr, __sss, 8) = i@m79 + 1
	return



#deffunc cell_featset int __bbb, int __ccc, int __ddd, int __eee, int __fff, int __ggg
	if (__ddd != (-1)) {
		feat@m80 = __ddd
	} else {
		feat@m80 = map(__bbb, __ccc, 6) \ 1000
	}
	if (__eee != (-1)) {
		feat@m80(1) = __eee
	} else {
		feat@m80(1) = map(__bbb, __ccc, 6) / 1000 \ 100
	}
	if (__fff != (-1)) {
		feat@m80(2) = limit(__fff, 0, 99)
	} else {
		feat@m80(2) = map(__bbb, __ccc, 6) / 100000 \ 100
	}
	if (__ggg != (-1) & __ggg < 215) {
		feat@m80(3) = __ggg
	} else {
		feat@m80(3) = map(__bbb, __ccc, 6) / 10000000
	}
	map(__bbb, __ccc, 6) = feat@m80 + feat@m80(1) * 1000 + feat@m80(2) * 100000 + feat@m80(3) * 10000000
	return



#deffunc cell_featread int __hhh, int __iii, int
	feat = map(__hhh, __iii, 6) \ 1000, map(__hhh, __iii, 6) / 1000 \ 100, map(__hhh, __iii, 6) / 100000 \ 100, map(__hhh, __iii, 6) / 10000000
	return 0



#deffunc cell_featclear int __kkk, int __lll
	map(__kkk, __lll, 6) = 0
	return



#deffunc cell_check int __mmm, int __nnn
	cellaccess = 1
	cellchara = -1
	cellfeat = -1
	if (__mmm < 0 | __mmm >= mapWidth | __nnn < 0 | __nnn >= mapHeight) {
		cellaccess = 0
		return
	}
	if (map(__mmm, __nnn, 1) != 0) {
		cellchara = map(__mmm, __nnn, 1) - 1
		cellaccess = 0
	}
	if (map(__mmm, __nnn, 6) != 0) {
		cellfeat = map(__mmm, __nnn, 6) / 1000 \ 100
		if (chipm(7, map(__mmm, __nnn, 6) \ 1000) & 4) {
			cellaccess = 0
		}
	}
	if (chipm(7, map(__mmm, __nnn, 0)) & 4) {
		cellaccess = 0
	}
	return



#deffunc cell_check2 int __ooo, int __ppp
	cellaccess = 1
	cellfeat = -1
	if (__ooo < 0 | __ooo >= mapWidth | __ppp < 0 | __ppp >= mapHeight) {
		cellaccess = 0
		return
	}
	if (map(__ooo, __ppp, 6) != 0) {
		cellfeat = map(__ooo, __ppp, 6) / 1000 \ 100
		if (chipm(7, map(__ooo, __ppp, 6) \ 1000) & 4) {
			cellaccess = 0
		}
	}
	if (chipm(7, map(__ooo, __ppp, 0)) & 4) {
		cellaccess = 0
	}
	return



#deffunc cell_swap int __qqq, int __rrr, int __sss, int __ttt
	if (gMount != 0) {
		if (gMount == __qqq | gMount == __rrr) {
			return 0
		}
	}
	if (ocdata(107, __qqq) != 0) {
		return 0
	}
	tc@m81 = __rrr
	if (tc@m81 == (-1)) {
		if (map(__sss, __ttt, 1) != 0) {
			tc@m81 = map(__sss, __ttt, 1) - 1
		}
	}
	if (tc@m81 != (-1)) {
		if (ocdata(107, tc@m81) != 0) {
			return 0
		}
		map(cX(__qqq), cY(__qqq), 1) = tc@m81 + 1
		x2@m81 = cX(tc@m81)
		y2@m81 = cY(tc@m81)
		cX(tc@m81) = cX(__qqq)
		cY(tc@m81) = cY(__qqq)
	} else {
		map(cX(__qqq), cY(__qqq), 1) = 0
		x2@m81 = __sss
		y2@m81 = __ttt
	}
	map(x2@m81, y2@m81, 1) = __qqq + 1
	cX(__qqq) = x2@m81
	cY(__qqq) = y2@m81
	if (__qqq == 0 | tc@m81 == 0) {
		if (gMount) {
			cX(gMount) = cX(0)
			cY(gMount) = cY(0)
		}
	} else {
		if (ocdata(106, __qqq)) {
			cX(ocdata(106, __qqq)) = cX(__qqq)
			cY(ocdata(106, __qqq)) = cY(__qqq)
			return 0
		}
	}
	return 1



#deffunc cell_movechara int __uuu, int __vvv, int __www
	if (map(__vvv, __www, 1) != 0) {
		rc@m81 = map(__vvv, __www, 1) - 1
		if (rc@m81 == __uuu) {
			return
		}
		cell_swap __uuu, rc@m81
	} else {
		map(cX(__uuu), cY(__uuu), 1) = 0
		cX(__uuu) = __vvv
		cY(__uuu) = __www
		map(cX(__uuu), cY(__uuu), 1) = __uuu + 1
	}
	return



#deffunc route_info var __xxx, var __yyy, int __zzz
	if (maxroute == 0) {
		return -1
	}
	if (route(0, __zzz \ maxroute) == 1) {
		__xxx += route(1, __zzz \ maxroute)
	} else {
		__yyy += route(1, __zzz \ maxroute)
	}
	if (__zzz \ maxroute \ 2 == 0) {
		if (route(0, (__zzz + 1) \ maxroute) != route(0, __zzz \ maxroute)) {
			return -1
		}
	}
	if (__zzz >= maxroute) {
		if (__xxx < scx | __yyy < scy | __xxx >= scx + inf_screenw | __yyy >= scy + inf_screenh) {
			return 0
		}
		if (__xxx < 0 | __yyy < 0 | __xxx >= mapWidth | __yyy >= mapHeight) {
			return 0
		}
		if (chipm(7, map(__xxx, __yyy, 0)) & 1) {
			return 0
		}
		if (map(__xxx, __yyy, 6) != 0) {
			cell_featread __xxx, __yyy
			if (chipm(7, feat) & 1) {
				return 0
			}
		}
	}
	if (route(1, __zzz \ maxroute) == 0) {
		return -1
	}
	return 1
*label_0422



#deffunc breath_list
	dim breathlist, 2, 100
	maxbreath = 0
	breathw = 1
	dx = cX(cc)
	dy = cY(cc)
	repeat sdataref(3, efid) \ 1000 + 1
		if (route(0, cnt \ maxroute) == 1) {
			dx += route(1, cnt \ maxroute)
		} else {
			dy += route(1, cnt \ maxroute)
		}
		if (cnt < 6) {
			if (cnt \ 3 == 1) {
				breathw += 2
			}
		} else {
			breathw -= 2
			if (breathw < 3) {
				breathw = 3
			}
		}
		repeat breathw
			ty = cnt - breathw / 2 + dy
			repeat breathw
				tx = cnt - breathw / 2 + dx
				if (tx < scx | ty < scy | tx >= scx + inf_screenw | ty >= scy + inf_screenh) {
					continue
				}
				if (tx < 0 | ty < 0 | tx >= mapWidth | ty >= mapHeight) {
					continue
				}
				if (chipm(7, map(tx, ty, 0)) & 1) {
					continue
				}
				if (maxbreath >= 100) {
					break
				}
				p = 0
				repeat maxbreath
					if (breathlist(0, cnt) == tx) {
						if (breathlist(1, cnt) == ty) {
							p = 1
							break
						}
					}
				loop
				if (p == 1) {
					continue
				}
				breathlist(0, maxbreath) = tx, ty
				maxbreath++
			loop
		loop
	loop
	return 1



#deffunc draw_emo int __aaa, int __bbb, int __ccc
	gmode 2, 16, 16
	pos __bbb + 16, __ccc
	gcopy 3, 32 + cEmotionIcon(__aaa) \ 100 * 16, 608
	return



// Clip and colorlize character graphics. The result is drown on the region(0, 960, width, height) in the 5th buffer.
// @params __chipId The character chip ID. Note it is different from the character ID.
// @params __cc The character's color. (default: 0, no color correction)
// @return None
// chipc(0, N): x
// chipc(1, N): y
// chipc(2, N): width
// chipc(3, N): height
#deffunc chara_preparepic int __chipId, int __color
	// Select the destination buffer(5).
	gsel 5
	// Fill the region with black(key color).
	color 0
	boxf 0, 960, chipc(2, __chipId), chipc(3, __chipId) + 960

	// Copy the character chip.
	pos 0, 960
	if (__chipId < 33 * 25 + 900) {
		gcopy 5 + 90 * (__chipId > 660 & __chipId < 825), chipc(0, __chipId), chipc(1, __chipId), chipc(2, __chipId), chipc(3, __chipId)
	} else {
		gcopy 35, chipc(0, __chipId), chipc(1, __chipId), chipc(2, __chipId), chipc(3, __chipId)
	}

	// Colorize the region.
	gfini chipc(2, __chipId), chipc(3, __chipId)
	gfdec2 c_col(0, __color), c_col(1, __color), c_col(2, __color)

	// Restore the target buffer(to the main window, 0th buffer).
	gsel selcur
	return



#deffunc preparepicitem_func int __fff, int __ggg
	gsel 1
	color 0
	boxf 0, 960, chipi(2, __fff), chipi(3, __fff) + 960
	if (__fff == 528) {
		gmode 2
		pos 0, 960
		gcopy 1, 0, 768, inf_tiles, inf_tiles
		pos 0, 1008
		gzoom 22, 20, 5 + 90 * (__ggg > 660 & __ggg < 825), chipc(0, __ggg) + 8, chipc(1, __ggg) + 4 + (chipc(3, __ggg) > inf_tiles) * 8, chipc(2, __ggg) - 16, chipc(3, __ggg) - 8 - (chipc(3, __ggg) > inf_tiles) * 10, 1
		pos 6, 974
		gcopy 1, 0, 1008, 22, 20
		gsel selcur
		return
	}
	if (__fff == 531) {
		pos 8, 1058 - chipc(3, __ggg)
		gcopy 5 + 90 * (__ggg > 660 & __ggg < 825), chipc(0, __ggg) + 8, chipc(1, __ggg) + 2, chipc(2, __ggg) - 16, chipc(3, __ggg) - 8
		gmode 4, , , 150
		color 0, 0, 0
		pos 0, 960 + (chipc(3, __ggg) == inf_tiles) * 48
		gcopy 1, 144, 768 + (chipc(3, __ggg) > inf_tiles) * 48, inf_tiles, chipc(3, __ggg) + (chipc(3, __ggg) > inf_tiles) * 48
		gmode 2
		gsel selcur
		return
	}
	if (__fff == 529) {
		pos 0, 1056 - chipc(3, __ggg)
		gcopy 5 + 90 * (__ggg > 660 & __ggg < 825), chipc(0, __ggg), chipc(1, __ggg), chipc(2, __ggg), chipc(3, __ggg)
		gmode 2
		gsel selcur
		return
	}
	pos 0, 960
	gcopy 1, chipi(0, __fff), chipi(1, __fff), chipi(2, __fff), chipi(3, __fff)
	gfini chipi(2, __fff), chipi(3, __fff)
	gfdec2 c_col(0, __ggg), c_col(1, __ggg), c_col(2, __ggg)
	gsel selcur
	return



#deffunc preparepicitemex int __hhh
	srcwid = 1
	picno = iImage(__hhh) \ 1000
	colno = iColor(__hhh)
	havedirection = 0
	if (iId(__hhh) == 743) {
		picno = 1650 + useritemdata(39, inv(31, __hhh))
		srcwid = 30
	} else {
		if (picno == 528 | picno == 531 | picno == 529) {
			if (iSubname(__hhh) == 343) {
				if (inv(33, __hhh) != usernpcmax) {
					if (userdata2(8, inv(33, __hhh)) != 0) {
						colno = limit(userdata2(8, inv(33, __hhh)), 0, 33 * 25)
						ccolno = limit(userdata2(9, inv(33, __hhh)), 0, 30)
					} else {
						colno = 825 + inv(33, __hhh)
						ccolno = 0
					}
				} else {
					colno = 1
					ccolno = 0
				}
			} else {
				ccolno = refchara(iSubname(__hhh), 5)
			}
		} else {
			if (use_exticon) {
				repeat 1
					if (iIdentificationState(__hhh) < ichipexchangeidranktable(iId(__hhh))) {
							break
					}
					if ((ichipexchangeidcurse(iId(__hhh)) == 1 & iCurseState(__hhh) == 1) | (ichipexchangeidcurse(iId(__hhh)) == 2 & iCurseState(__hhh) < 0)) {
						break
					}
					if (iId(__hhh) == 618 | iId(__hhh) == 619) {
						if (iParam2(__hhh) == 0) {
							picno = 99 + (iSubname(__hhh) - 1)
							if (iSubname(__hhh) == 30) {
								picno += 33 * (gRandomSeed \ ichipexchghbooks)
							}
							picno += 33 * 25
							srcwid = 31
							break
						}
					}
					if (refitem(iId(__hhh), 5, __hhh) == 57000) {
						if (refitem(iId(__hhh), 9, __hhh) == 58005) {
							if (iParam1(__hhh) != 0) {
								if (iParam2(__hhh) != 0) {
									if (iMaterial(__hhh) != 35 | iParam3(__hhh) >= 0) {
										picno = 300 + iParam2(__hhh)
										srcwid = 31
										break
									}
								}
							}
						} else {
							if (iParam1(__hhh) != 0) {
								if (iParam2(__hhh) != 0) {
									if (iMaterial(__hhh) != 35 | iParam3(__hhh) >= 0) {
										picno = (iParam1(__hhh) / 1000 - 1) * 10 + iParam2(__hhh) + 33 * 25
										srcwid = 31
										break
									}
								}
							}
						}
					}
					if (ichipexchangetable(iId(__hhh))) {
						havedirection = ichipexchangetable(iId(__hhh)) / 1000000
						if (ichipexchangetable(iId(__hhh)) \ 1000000 >= 10000) {
							colno = ichipexchangetable(iId(__hhh)) \ 1000000 / 10000 - 1
						}
						picno = ichipexchangetable(iId(__hhh)) \ 10000
						if (havedirection) {
							srcwid = 33
						} else {
							srcwid = 31
						}
						break
					}
				loop
			}
		}
	}
	gsel 1
	color 0
	boxf 0, 960, chipi(2, picno), chipi(3, picno) + 960
	if (srcwid == 1) {
		if (picno == 528) {
			gmode 2
			pos 0, 960
			gcopy 1, 0, 768, inf_tiles, inf_tiles
			pos 0, 1008
			gzoom 22, 20, 5 + 90 * (colno > 660 & colno < 825), chipc(0, colno) + 8, chipc(1, colno) + 4 + (chipc(3, colno) > inf_tiles) * 8, chipc(2, colno) - 16, chipc(3, colno) - 8 - (chipc(3, colno) > inf_tiles) * 10, 1
			gfini chipc(2, colno), chipc(3, colno)
			gfdec2 c_col(0, ccolno), c_col(1, ccolno), c_col(2, ccolno)
			pos 6, 974
			gcopy 1, 0, 1008, 22, 20
			gsel selcur
			return picno
		}
		if (picno == 531) {
			pos 8, 1058 - chipc(3, colno)
			gcopy 5 + 90 * (colno > 660 & colno < 825), chipc(0, colno) + 8, chipc(1, colno) + 2, chipc(2, colno) - 16, chipc(3, colno) - 8
			gfini chipc(2, colno), chipc(3, colno)
			gfdec2 c_col(0, ccolno), c_col(1, ccolno), c_col(2, ccolno)
			gmode 4, , , 150
			color 0, 0, 0
			pos 0, 960 + (chipc(3, colno) == inf_tiles) * 48
			gcopy 1, 144, 768 + (chipc(3, colno) > inf_tiles) * 48, inf_tiles, chipc(3, colno) + (chipc(3, colno) > inf_tiles) * 48
			gmode 2
			gsel selcur
			return picno
		}
		if (picno == 529) {
			pos 0, 1056 - chipc(3, colno)
			gcopy 5 + 90 * (colno > 660 & colno < 825), chipc(0, colno), chipc(1, colno), chipc(2, colno), chipc(3, colno)
			gfini chipc(2, colno), chipc(3, colno)
			gfdec2 c_col(0, ccolno), c_col(1, ccolno), c_col(2, ccolno)
			gmode 2
			gsel selcur
			return picno
		}
	}
	pos 0, 960
	fruittrees_f = 0
	if (cfg_fruittrees == 1) {
		if (existfile_fruittrees == 1) {
			if (iId(__hhh) == 526) {
				fruittrees_f = 1
				if (iImage(__hhh) == 591) {
					_switch_val = iParam2(__hhh)
					repeat 1
						if (_switch_val == 180) {
							gcopy 98, 0 * 48, 0, 48, 48 * 2
							break
						}
						if (_switch_val == 181) {
							gcopy 98, 5 * 48, 0, 48, 48 * 2
							break
						}
						if (_switch_val == 183) {
							gcopy 98, 1 * 48, 0, 48, 48 * 2
							break
						}
						if (_switch_val == 192) {
							gcopy 98, 2 * 48, 0, 48, 48 * 2
							break
						}
						if (_switch_val == 196) {
							gcopy 98, 4 * 48, 0, 48, 48 * 2
							break
						}
						if (_switch_val == 197) {
							gcopy 98, 3 * 48, 0, 48, 48 * 2
							break
						}
						if (_switch_val == 505) {
							gcopy 98, 6 * 48, 0, 48, 48 * 2
							break
						}
						gcopy 98, 0 * 48, 0, 48, 48 * 2
						break
					loop
				} else {
					gcopy srcwid, chipi(0, picno) + inv(39, __hhh) * 48, chipi(1, picno), chipi(2, picno), chipi(3, picno)
				}
			}
		}
	}
	if (fruittrees_f == 0) {
		gcopy srcwid, chipi(0, picno) + inv(39, __hhh) * 48, chipi(1, picno), chipi(2, picno), chipi(3, picno)
	}
	gfini chipi(2, picno), chipi(3, picno)
	gfdec2 c_col(0, colno), c_col(1, colno), c_col(2, colno)
	gsel selcur
	return picno



#include "cell.hsp"



#defcfunc fov_los int __rrr, int __sss, int __ttt, int __uuu
	if (__rrr >= mapWidth | __sss >= mapHeight | __ttt >= mapWidth | __uuu >= mapHeight) {
		return 0
	}
	dy@modfov = __uuu - __sss
	dx@modfov = __ttt - __rrr
	ay@modfov = abs(dy@modfov)
	ax@modfov = abs(dx@modfov)
	if (ax@modfov < 2 & ay@modfov < 2) {
		return 1
	}
	if (dx@modfov == 0) {
		if (dy@modfov > 0) {
			ty@modfov = __sss + 1
*label_0436
			if (ty@modfov < __uuu == 0) {
				goto *label_0437
			}
			if (chipm(7, map(__rrr, ty@modfov, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(__rrr, ty@modfov, 6) \ 1000) & 1) {
				return 0
			}
			ty@modfov++
			goto *label_0436
*label_0437
		} else {
			ty@modfov = __sss - 1
*label_0438
			if (ty@modfov > __uuu == 0) {
				goto *label_0439
			}
			if (chipm(7, map(__rrr, ty@modfov, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(__rrr, ty@modfov, 6) \ 1000) & 1) {
				return 0
			}
			ty@modfov--
			goto *label_0438
		}
*label_0439
		return 1
	}
	if (dy@modfov == 0) {
		if (dx@modfov > 0) {
			tx@modfov = __rrr + 1
*label_0440
			if (tx@modfov < __ttt == 0) {
				goto *label_0441
			}
			if (chipm(7, map(tx@modfov, __sss, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(tx@modfov, __sss, 6) \ 1000) & 1) {
				return 0
			}
			tx@modfov++
			goto *label_0440
*label_0441
		} else {
			tx@modfov = __rrr - 1
*label_0442
			if (tx@modfov > __ttt == 0) {
				goto *label_0443
			}
			if (chipm(7, map(tx@modfov, __sss, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(tx@modfov, __sss, 6) \ 1000) & 1) {
				return 0
			}
			tx@modfov--
			goto *label_0442
		}
*label_0443
		return 1
	}
	if (dx@modfov < 0) {
		sx@modfov = -1
	} else {
		sx@modfov = 1
	}
	if (dy@modfov < 0) {
		sy@modfov = -1
	} else {
		sy@modfov = 1
	}
	if (ax@modfov == 1) {
		if (ay@modfov == 2) {
			if ((chipm(7, map(__rrr, __sss + sy@modfov, 0)) & 1) == 0) {
				if ((chipm(7, map(__rrr, __sss + sy@modfov, 6) \ 1000) & 1) == 0) {
					return 1
				}
			}
		}
	} else {
		if (ay@modfov == 1) {
			if (ax@modfov == 2) {
				if ((chipm(7, map(__rrr + sx@modfov, __sss, 0)) & 1) == 0) {
					if ((chipm(7, map(__rrr + sx@modfov, __sss, 6) \ 1000) & 1) == 0) {
						return 1
					}
				}
			}
		}
	}
	f2@modfov = ax@modfov * ay@modfov
	f1@modfov = f2@modfov << 1
	if (ax@modfov >= ay@modfov) {
		qy@modfov = ay@modfov * ay@modfov
		m@modfov = qy@modfov << 1
		tx@modfov = __rrr + sx@modfov
		if (qy@modfov == f2@modfov) {
			ty@modfov = __sss + sy@modfov
			qy@modfov -= f1@modfov
		} else {
			ty@modfov = __sss
		}
*label_0444
		if (__ttt - tx@modfov == 0) {
			goto *label_0445
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
			return 0
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
			return 0
		}
		qy@modfov += m@modfov
		if (qy@modfov < f2@modfov) {
			tx@modfov += sx@modfov
		} else {
			if (qy@modfov > f2@modfov) {
				ty@modfov += sy@modfov
				if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
					return 0
				}
				if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
					return 0
				}
				qy@modfov -= f1@modfov
				tx@modfov += sx@modfov
			} else {
				ty@modfov += sy@modfov
				qy@modfov -= f1@modfov
				tx@modfov += sx@modfov
			}
		}
		goto *label_0444
*label_0445
	} else {
		qx@modfov = ax@modfov * ax@modfov
		m@modfov = qx@modfov << 1
		ty@modfov = __sss + sy@modfov
		if (qx@modfov == f2@modfov) {
			tx@modfov = __rrr + sx@modfov
			qx@modfov -= f1@modfov
		} else {
			tx@modfov = __rrr
		}
*label_0446
		if (__uuu - ty@modfov == 0) {
			goto *label_0447
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
			return 0
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
			return 0
		}
		qx@modfov += m@modfov
		if (qx@modfov < f2@modfov) {
			ty@modfov += sy@modfov
		} else {
			if (qx@modfov > f2@modfov) {
				tx@modfov += sx@modfov
				if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
					return 0
				}
				if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
					return 0
				}
				qx@modfov -= f1@modfov
				ty@modfov += sy@modfov
			} else {
				tx@modfov += sx@modfov
				qx@modfov -= f1@modfov
				ty@modfov += sy@modfov
			}
		}
		goto *label_0446
	}
*label_0447
	return 1



#deffunc get_route int __vvv, int __www, int __xxx, int __yyy
	dim route, 2, 100
	dy@modfov = __yyy - __www
	dx@modfov = __xxx - __vvv
	if (__yyy == __www) {
		if (__xxx == __vvv) {
			route(0, 0) = 2, 0
			maxroute = 1
			return 1
		}
	}
	ay@modfov = abs(dy@modfov)
	ax@modfov = abs(dx@modfov)
	p@modfov = 0
	if (dx@modfov == 0) {
		if (dy@modfov > 0) {
			ty@modfov = __www + 1
			route(0, p@modfov) = 2, 1
			p@modfov++
*label_0449
			if (ty@modfov < __yyy == 0) {
				goto *label_0450
			}
			if (chipm(7, map(__vvv, ty@modfov, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(__vvv, ty@modfov, 6) \ 1000) & 1) {
				return 0
			}
			ty@modfov++
			route(0, p@modfov) = 2, 1
			p@modfov++
			goto *label_0449
*label_0450
		} else {
			ty@modfov = __www - 1
			route(0, p@modfov) = 2, -1
			p@modfov++
*label_0451
			if (ty@modfov > __yyy == 0) {
				goto *label_0452
			}
			if (chipm(7, map(__vvv, ty@modfov, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(__vvv, ty@modfov, 6) \ 1000) & 1) {
				return 0
			}
			ty@modfov--
			route(0, p@modfov) = 2, -1
			p@modfov++
			goto *label_0451
		}
*label_0452
		maxroute = p@modfov
		return 1
	}
	if (dy@modfov == 0) {
		if (dx@modfov > 0) {
			tx@modfov = __vvv + 1
			route(0, p@modfov) = 1, 1
			p@modfov++
*label_0453
			if (tx@modfov < __xxx == 0) {
				goto *label_0454
			}
			if (chipm(7, map(tx@modfov, __www, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(tx@modfov, __www, 6) \ 1000) & 1) {
				return 0
			}
			tx@modfov++
			route(0, p@modfov) = 1, 1
			p@modfov++
			goto *label_0453
*label_0454
		} else {
			tx@modfov = __vvv - 1
			route(0, p@modfov) = 1, -1
			p@modfov++
*label_0455
			if (tx@modfov > __xxx == 0) {
				goto *label_0456
			}
			if (chipm(7, map(tx@modfov, __www, 0)) & 1) {
				return 0
			}
			if (chipm(7, map(tx@modfov, __www, 6) \ 1000) & 1) {
				return 0
			}
			tx@modfov--
			route(0, p@modfov) = 1, -1
			p@modfov++
			goto *label_0455
		}
*label_0456
		maxroute = p@modfov
		return 1
	}
	if (dx@modfov < 0) {
		sx@modfov = -1
	} else {
		sx@modfov = 1
	}
	if (dy@modfov < 0) {
		sy@modfov = -1
	} else {
		sy@modfov = 1
	}
	if (ax@modfov == 1) {
		if (ay@modfov == 2) {
			if ((chipm(7, map(__vvv, __www + sy@modfov, 0)) & 1) == 0) {
				if ((chipm(7, map(__vvv, __www + sy@modfov, 6) \ 1000) & 1) == 0) {
					p@modfov = 0
					route(0, p@modfov) = 2, sy@modfov
					p@modfov++
					route(0, p@modfov) = 2, 0
					p@modfov++
					route(0, p@modfov) = 1, sx@modfov
					p@modfov++
					maxroute = p@modfov
					return 1
				}
			}
		}
	} else {
		if (ay@modfov == 1) {
			if (ax@modfov == 2) {
				if ((chipm(7, map(__vvv + sx@modfov, __www, 0)) & 1) == 0) {
					if ((chipm(7, map(__vvv + sx@modfov, __www, 6) \ 1000) & 1) == 0) {
						route(0, p@modfov) = 1, sx@modfov
						p@modfov++
						route(0, p@modfov) = 1, 0
						p@modfov++
						route(0, p@modfov) = 2, sy@modfov
						p@modfov++
						maxroute = p@modfov
						return 1
					}
				}
			}
		}
	}
	f2@modfov = ax@modfov * ay@modfov
	f1@modfov = f2@modfov << 1
	if (ax@modfov >= ay@modfov) {
		qy@modfov = ay@modfov * ay@modfov
		m@modfov = qy@modfov << 1
		tx@modfov = __vvv + sx@modfov
		route(0, p@modfov) = 1, sx@modfov
		p@modfov++
		if (qy@modfov == f2@modfov) {
			ty@modfov = __www + sy@modfov
			route(0, p@modfov) = 2, sy@modfov
			p@modfov++
			qy@modfov -= f1@modfov
		} else {
			ty@modfov = __www
		}
*label_0457
		if (__xxx - tx@modfov == 0) {
			goto *label_0458
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
			return 0
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
			return 0
		}
		qy@modfov += m@modfov
		if (qy@modfov < f2@modfov) {
			tx@modfov += sx@modfov
			route(0, p@modfov) = 1, sx@modfov
			p@modfov++
		} else {
			if (qy@modfov > f2@modfov) {
				ty@modfov += sy@modfov
				route(0, p@modfov) = 2, sy@modfov
				p@modfov++
				if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
					return 0
				}
				if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
					return 0
				}
				qy@modfov -= f1@modfov
				tx@modfov += sx@modfov
				route(0, p@modfov) = 1, sx@modfov
				p@modfov++
			} else {
				ty@modfov += sy@modfov
				route(0, p@modfov) = 2, sy@modfov
				p@modfov++
				qy@modfov -= f1@modfov
				tx@modfov += sx@modfov
				route(0, p@modfov) = 1, sx@modfov
				p@modfov++
			}
		}
		goto *label_0457
*label_0458
	} else {
		qx@modfov = ax@modfov * ax@modfov
		m@modfov = qx@modfov << 1
		ty@modfov = __www + sy@modfov
		route(0, p@modfov) = 2, sy@modfov
		p@modfov++
		if (qx@modfov == f2@modfov) {
			tx@modfov = __vvv + sx@modfov
			route(0, p@modfov) = 1, sx@modfov
			p@modfov++
			qx@modfov -= f1@modfov
		} else {
			tx@modfov = __vvv
		}
*label_0459
		if (__yyy - ty@modfov == 0) {
			goto *label_0460
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
			return 0
		}
		if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
			return 0
		}
		qx@modfov += m@modfov
		if (qx@modfov < f2@modfov) {
			ty@modfov += sy@modfov
			route(0, p@modfov) = 2, sy@modfov
			p@modfov++
		} else {
			if (qx@modfov > f2@modfov) {
				tx@modfov += sx@modfov
				route(0, p@modfov) = 1, sx@modfov
				p@modfov++
				if (chipm(7, map(tx@modfov, ty@modfov, 0)) & 1) {
					return 0
				}
				if (chipm(7, map(tx@modfov, ty@modfov, 6) \ 1000) & 1) {
					return 0
				}
				qx@modfov -= f1@modfov
				ty@modfov += sy@modfov
				route(0, p@modfov) = 2, sy@modfov
				p@modfov++
			} else {
				tx@modfov += sx@modfov
				route(0, p@modfov) = 1, sx@modfov
				p@modfov++
				qx@modfov -= f1@modfov
				ty@modfov += sy@modfov
				route(0, p@modfov) = 2, sy@modfov
				p@modfov++
			}
		}
		goto *label_0459
	}
*label_0460
	maxroute = p@modfov
	return 1



#deffunc display_customkey str __zzz, int __aaa, int __bbb, int
	redraw 0
	gsel 3
	gmode 0
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
	pos 624, 30
	gcopy 3, 0, 30, 24, 18
	pos 629, 31
	color 50, 60, 80
	bmes "" + __zzz, 250, 240, 230
	gmode 2, inf_tiles, inf_tiles
	gsel 0
	pos __aaa, __bbb
	gcopy 3, 624, 30, 24, 18
	return



#deffunc display_key int __ddd, int __eee, int __fff
	pos __ddd, __eee
	gcopy 3, __fff * 24 + 72, 30, 24, 18
	return



#deffunc cursor_check
	if (key == key_north) {
		snd 5
		cs--
		if (cs < 0) {
			cs = keyrange - 1
			if (cs < 0) {
				cs = 0
			}
		}
	}
	if (key == key_south) {
		snd 5
		cs++
		if (cs >= keyrange) {
			cs = 0
		}
	}
	if (key == key_west) {
		key = key_pagedown
	}
	if (key == key_east) {
		key = key_pageup
	}
	if (cs >= keyrange) {
		cs_bk = -1
		cs = keyrange - 1
		if (cs < 0) {
			cs = 0
		}
	}
	if (key == key_enter) {
		key = key_list(cs)
	}
	return



#deffunc lenfix var __ggg, int __hhh
	p@m89 = __hhh - strlen(__ggg)
	if (p@m89 < 1) {
		p@m89 = 1
	}
	repeat p@m89
		__ggg += " "
	loop
	return



#deffunc showscroll int __iii, int __jjj, int __kkk, int __lll
	repeat 2
		if (cnt == 0) {
			if (windowshadow == 0) {
				continue
			} else {
				gmode 6, , , 80
				x@m91 = __iii + 3
				y@m91 = __jjj + 3
				windowshadow = 0
			}
		} else {
			gmode 2
			x@m91 = __iii
			y@m91 = __jjj
		}
		x3@m91 = __kkk + x@m91 - __kkk \ 8 - 64
		y3@m91 = __lll + y@m91 - __lll \ 8 - 64
		repeat __kkk / 8
			if (cnt < 8) {
				if (cnt == 0) {
					pos x@m91, y@m91
					gcopy 7, 0, 0, 64, 48
					pos x@m91, y3@m91
					gcopy 7, 0, 144, 64, 48
				}
				continue
			}
			if (cnt < __kkk / 8 - 8) {
				pos cnt * 8 + x@m91, y@m91
				gcopy 7, (cnt - 8) \ 18 * 8 + 64, 0, 8, 48
				pos cnt * 8 + x@m91, y3@m91
				gcopy 7, (cnt - 8) \ 18 * 8 + 64, 144, 8, 48
				continue
			}
			pos x3@m91, y@m91
			gcopy 7, 208, 0, 64, 48
			pos x3@m91, y3@m91
			gcopy 7, 208, 144, 64, 48
			break
		loop
		repeat __lll / 8 - 14
			cnt2@m91 = cnt
			repeat __kkk / 8
				if (cnt == 0) {
					pos x@m91, cnt2@m91 * 8 + y@m91 + 48
					gcopy 7, 0, cnt2@m91 \ 12 * 8 + 48, 64, 8
					continue
				}
				if (cnt < __kkk / 8 - 15) {
					pos cnt * 8 + x@m91 + 56, cnt2@m91 * 8 + y@m91 + 48
					gcopy 7, cnt \ 18 * 8 + 64, cnt2@m91 \ 12 * 8 + 48, 8, 8
					continue
				}
				pos x3@m91, cnt2@m91 * 8 + y@m91 + 48
				gcopy 7, 208, cnt2@m91 \ 12 * 8 + 48, 64, 8
				break
			loop
		loop
	loop
	if (s != "") {
		pos x@m91 + 40, y@m91 + __lll - 67 - __lll \ 8
		gcopy 3, 96, 360, 24, 16
		color 194, 173, 161
		line x@m91 + 60, y@m91 + __lll - 68 - __lll \ 8, x@m91 + __kkk - 40, y@m91 + __lll - 68 - __lll \ 8
		color 224, 213, 191
		line x@m91 + 60, y@m91 + __lll - 69 - __lll \ 8, x@m91 + __kkk - 40, y@m91 + __lll - 69 - __lll \ 8
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		color 0, 0, 0
		pos x@m91 + 68, y@m91 + __lll - 63 - __lll \ 8
		mes s
		if (pagesize != 0) {
			s = "Page." + (page + 1) + "/" + (pagemax + 1)
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			pos x@m91 + __kkk - strlen(s) * 7 - 40, y@m91 + __lll - 63 - __lll \ 8
			mes s
		}
	}
	return



#deffunc window int __mmm, int __nnn, int __ooo, int __ppp, int, int __rrr
	if (__rrr == (-1)) {
		gmode 6, , , 80
		color 0, 0, 0
	} else {
		gmode 2
	}
	dx@m92 = 0
	dy@m92 = 48
	x3@m92 = __ooo + __mmm - __ooo \ 8 - 64
	y3@m92 = __ppp + __nnn - __ppp \ 8 - 64
	if (y3@m92 < __nnn + 14) {
		y3@m92 = __nnn + 14
	}
	repeat __ooo / 8
		if (cnt < 8) {
			if (cnt == 0) {
				pos __mmm, __nnn
				gcopy 3, dx@m92, dy@m92, 64, 48
				pos __mmm, y3@m92
				gcopy 3, dx@m92, dy@m92 + 144, 64, 48
			}
			continue
		}
		if (cnt < __ooo / 8 - 8) {
			pos cnt * 8 + __mmm, __nnn
			gcopy 3, (cnt - 8) \ 18 * 8 + dx@m92 + 36, dy@m92, 8, 48
			pos cnt * 8 + __mmm, y3@m92
			gcopy 3, (cnt - 8) \ 18 * 8 + dx@m92 + 54, dy@m92 + 144, 8, 48
			continue
		}
		pos x3@m92, __nnn
		gcopy 3, dx@m92 + 208, dy@m92, 56, 48
		pos x3@m92, y3@m92
		gcopy 3, dx@m92 + 208, dy@m92 + 144, 56, 48
		break
	loop
	p@m92 = __ppp / 8 - 14
	if (p@m92 < 0) {
		p@m92 = 0
	}
	repeat p@m92
		cnt2@m92 = cnt
		repeat __ooo / 8
			if (cnt == 0) {
				pos __mmm, cnt2@m92 * 8 + __nnn + 48
				gcopy 3, dx@m92, cnt2@m92 \ 12 * 8 + dy@m92 + 48, 64, 8
				continue
			}
			if (cnt < __ooo / 8 - 15) {
				pos cnt * 8 + __mmm + 56, cnt2@m92 * 8 + __nnn + 48
				gcopy 3, cnt \ 18 * 8 + dx@m92 + 64, cnt2@m92 \ 12 * 8 + dy@m92 + 48, 8, 8
				continue
			}
			pos x3@m92, cnt2@m92 * 8 + __nnn + 48
			gcopy 3, dx@m92 + 208, cnt2@m92 \ 12 * 8 + dy@m92 + 48, 56, 8
			break
		loop
	loop
	gmode 2
	return



#deffunc window2 int __sss, int __ttt, int __uuu, int __vvv, int __www, int __xxx
	dx@m93 = 0
	dy@m93 = 240
	x2@m93 = __uuu
	y2@m93 = __vvv
	if (x2@m93 < 32) {
		x2@m93 = 32
	}
	if (y2@m93 < 24) {
		y2@m93 = 24
	}
	x3@m93 = __sss + x2@m93 / 16 * 16 - 16
	y3@m93 = __ttt + y2@m93 / 16 * 16 - 16
	if (__xxx == 0) {
		pos __sss + 4, __ttt + 4
		gzoom x2@m93 - 6, y2@m93 - 8, 3, 24, 72, 228, 144
	}
	if (__xxx == 1) {
		pos __sss + 4, __ttt + 4
		gzoom x2@m93 - 6, y2@m93 - 8, 3, 24, 72, 228, 144
		pos __sss + 4, __ttt + 4
		gfini x2@m93 - 4, y2@m93 - 4
		gfdec2 195, 205, 195
	}
	if (__xxx == 2) {
		pos __sss + 4, __ttt + 4
		gzoom x2@m93 - 6, y2@m93 - 8, 3, 24, 72, 228, 144
		pos __sss + 4, __ttt + 4
		gfini x2@m93 - 4, y2@m93 - 4
		gfdec2 210, 215, 205
	}
	if (__xxx == 3) {
		pos __sss + 4, __ttt + 4
		gzoom x2@m93 - 6, y2@m93 - 8, 3, 24, 72, 228, 144
		pos __sss + 4, __ttt + 4
		gfini x2@m93 - 4, y2@m93 - 4
		gfdec2 10, 13, 16
	}
	if (__xxx == 4) {
		pos __sss + 4, __ttt + 4
		gzoom x2@m93 - 6, y2@m93 - 8, 3, 24, 72, 228, 144
		pos __sss + 4, __ttt + 4
		gfini x2@m93 - 4, y2@m93 - 4
		gfdec2 195, 205, 195
	}
	if (__xxx == 6) {
		pos __sss + x2@m93 / 2, __ttt + y2@m93 / 2
		gmode 4, 228, 144, 180
		grotate 3, 24, 72, 0, x2@m93 - 4, y2@m93 - 4
	}
	gmode 2, 16, 16
	repeat x2@m93 / 16 - 2
		pos cnt * 16 + __sss + 16, __ttt
		gcopy 3, __www * 48 + dx@m93 + 16, dy@m93
		pos cnt * 16 + __sss + 16, __ttt + y2@m93 - 16
		gcopy 3, __www * 48 + dx@m93 + 16, dy@m93 + 32
	loop
	pos x3@m93, __ttt
	gcopy 3, __www * 48 + dx@m93 + 16, dy@m93, x2@m93 \ 16, 16
	pos x3@m93, __ttt + y2@m93 - 16
	gcopy 3, __www * 48 + dx@m93 + 16, dy@m93 + 32, x2@m93 \ 16, 16
	p@m93 = y2@m93 / 16 - 2
	if (p@m93 < 0) {
		p@m93 = 0
	}
	repeat p@m93
		pos __sss, cnt * 16 + __ttt + 16
		gcopy 3, __www * 48 + dx@m93, dy@m93 + 16
		pos __sss + x2@m93 - 16, cnt * 16 + __ttt + 16
		gcopy 3, __www * 48 + dx@m93 + 32, dy@m93 + 16
	loop
	pos __sss, y3@m93
	gcopy 3, __www * 48 + dx@m93, dy@m93 + 16, 16, y2@m93 \ 16
	pos __sss + x2@m93 - 16, y3@m93
	gcopy 3, __www * 48 + dx@m93 + 32, dy@m93 + 16, 16, y2@m93 \ 16
	pos __sss, __ttt
	gcopy 3, __www * 48 + dx@m93, dy@m93
	pos __sss, __ttt + y2@m93 - 16
	gcopy 3, __www * 48 + dx@m93, dy@m93 + 32
	pos __sss + x2@m93 - 16, __ttt
	gcopy 3, __www * 48 + dx@m93 + 32, dy@m93
	pos __sss + x2@m93 - 16, __ttt + y2@m93 - 16
	gcopy 3, __www * 48 + dx@m93 + 32, dy@m93 + 32
	if (__xxx == 5) {
		pos __sss + 2, __ttt + 2
		gzoom x2@m93 - 4, y2@m93 - 5, 3, 24, 72, 228, 144
		pos __sss + 2, __ttt + 2
		gfini x2@m93 - 4, y2@m93 - 4
		gfdec2 195, 205, 195
	}
	return



#deffunc display_window2 int __yyy, int __zzz, int __aaa, int __bbb, int __ccc, int __ddd
	gmode 2
	pos __yyy, __zzz
	gcopy __ccc, 0, 0, __aaa, __bbb
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	color 0, 0, 0
	if (s != "") {
		pos __yyy + __aaa - strlen(s) * 7 - 140, __zzz + __bbb - 24 - __bbb \ 8 + __ddd
		mes s
	}
	if (pagesize != 0) {
		s = "Page." + (page + 1) + "/" + (pagemax + 1)
		pos __yyy + __aaa - strlen(s) * 7 - 40, __zzz + __bbb - 24 - __bbb \ 8 + __ddd
		mes s
	}
	return



#deffunc display_window int __eee, int __fff, int __ggg, int __hhh, int __iii, int __jjj, int __longHint
	if (windowshadow == 1) {
		window __eee + 4, __fff + 4, __ggg, __hhh - __hhh \ 8 + 12, 0, -1
		windowshadow = 0
	}
	window __eee, __fff, __ggg, __hhh - __hhh \ 8 + 12, 0, 0
	if (s != "") {
		window2 __eee + 34, __fff - 4, 45 * __ggg / 100 + limit(strlen(s) * 8 - 120, 0, 200), 32, 1, 1
	}
	gmode 2
	pos __eee + 30 + __iii, __fff + __hhh - 47 - __hhh \ 8 - 10 * __longHint
	gcopy 3, 96, 360, 24, 16
	color 194, 170, 146
	line __eee + 50 + __iii, __fff + __hhh - 48 - __hhh \ 8 - 10 * __longHint, __eee + __ggg - 40, __fff + __hhh - 48 - __hhh \ 8 - 10 * __longHint
	color 234, 220, 188
	line __eee + 50 + __iii, __fff + __hhh - 49 - __hhh \ 8 - 10 * __longHint, __eee + __ggg - 40, __fff + __hhh - 49 - __hhh \ 8 - 10 * __longHint
	font lang(cfg_font1, cfg_font2), 15 + en - en * 2, 0
	color 0, 0, 0
	pos __eee + 45 * __ggg / 200 + 34 - strlen(s) * 4 + limit(strlen(s) * 8 - 120, 0, 200) / 2, __fff + 4 + vfix
	color 20, 10, 0
	bmes s, 255, 255, 255
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	color 0, 0, 0
	pos __eee + 58 + __iii, __fff + __hhh - 43 - __hhh \ 8 - 10 * __longHint
	mes s(1)
	if (pagesize != 0) {
		s = "Page." + (page + 1) + "/" + (pagemax + 1)
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
		pos __eee + __ggg - strlen(s) * 7 - 40 - __jjj, __fff + __hhh - 65 - __hhh \ 8 - 10 * __longHint
		mes s
	}
	wx = __eee
	wy = __fff
	ww = __ggg
	wh = __hhh
	return



#deffunc display_note str __kkk, int __lll
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	pos wx + ww - strlen(__kkk) * 7 - 140 - __lll, wy + wh - 65 - wh \ 8
	mes __kkk
	return



#deffunc display_topic str __mmm, int __nnn, int __ooo, int
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	color 0, 0, 0
	pos __nnn, __ooo + 7
	gcopy 3, 120, 360, 24, 16
	pos __nnn + 26, __ooo + 8
	mes __mmm
	color 0, 0, 0
	line __nnn + 22, __ooo + 21, __nnn + strlen(__mmm) * 7 + 36, __ooo + 21
	return



#deffunc display_msg int __qqq, int __rrr
	msgkeep = __rrr
	msgclear = 1
	msgy = __qqq
	redraw 0
	gosub *label_0628
	return



#defcfunc id_crlf var __sss
	char@crlf = "\n"
	if (instr(__sss, 0, char@crlf) >= 0) {
		return 0
	}
	char@crlf = " "
	poke char@crlf, 0, 13
	if (instr(__sss, 0, char@crlf) >= 0) {
		return 1
	}
	poke char@crlf, 0, 10
	if (instr(__sss, 0, char@crlf) >= 0) {
		return 2
	}
	return 100



#deffunc rm_crlf var __vvv
	crlfs@crlf = 0, 13, 10
	repeat 3
		crlftype@crlf = cnt
		i@crlf = 0
		tmpbuf@crlf = ""
		len@crlf = strlen(__vvv)
		repeat
			if (i@crlf >= len@crlf) {
				break
			}
			getstr tmpstr@crlf, __vvv, i@crlf, crlfs@crlf(crlftype@crlf)
			i@crlf += strsize
			tmpbuf@crlf += tmpstr@crlf
		loop
		__vvv = tmpbuf@crlf
	loop
	return



#defcfunc role int __www, int __xxx, int __yyy
	d@m97 = 0
	p@m97 = __www, __xxx
	if (p@m97 < 1) {
		p@m97 = 1
	}
	if (p@m97(1) < 1) {
		p@m97(1) = 1
	}
	repeat p@m97
		d@m97 += rndex(p@m97(1)) + 1
		if (ogdata(505) != 2) {
			d@m97 = limit(d@m97, 0, 10000000)
		} else {
			d@m97 = limit(d@m97, 0, 1000000000)
		}
	loop
	return d@m97 + __yyy



#defcfunc rolemax int __zzz, int __aaa, int __bbb
	if (ogdata(505) == 2) {
		return limit(__zzz * __aaa + __bbb, 0, 1500000000)
	}
	return limit(__zzz * __aaa + __bbb, 0, 15000000)



#deffunc page_save2
	pagebk2 = page
	csprev2 = cs
	pagesaved2 = 1
	return



#deffunc page_load2
	if (pagesaved2 == 1) {
		page = pagebk2
		cs = csprev2
		pagesaved2 = 0
	}
	return



#deffunc page_save
	pagebk = page
	csprev = cs
	pagesaved = 1
	return



#deffunc page_load
	if (pagesaved == 1) {
		page = pagebk
		cs = csprev
		pagesaved = 0
	}
	return



#deffunc fileadd str __ccc, int __ddd
	if (__ddd == 0) {
		q@m98 = "*", "#"
	} else {
		q@m98 = "#", "*"
	}
	notesel filemod
	p@m98 = instr(filemod, 0, __ccc)
	if (p@m98 != (-1)) {
		if (strmid(filemod, p@m98 - 1, 1) == q@m98(1)) {
			cnvstow a@m98, q@m98
			poke filemod, p@m98 - 1, a@m98
		}
		noteunsel
		return
	}
	if (__ddd != 0) {
		noteadd q@m98 + __ccc
		noteunsel
		return
	}
	noteadd q@m98 + __ccc
	noteunsel
	return
*label_0483



#defcfunc del_str str __eee, str __fff
	s@m99 = __eee
	repeat
		if (instr(s@m99, 0, __fff) == (-1)) {
			break
		}
		s@m99 = strmid(s@m99, 0, instr(s@m99, 0, __fff)) + strmid(s@m99, instr(s@m99, 0, __fff) + strlen(__fff), 100)
	loop
	return s@m99



#deffunc cnv_str var __ggg, str __hhh, str __iii
	repeat
		s3@m100 = getpath(__ggg, 16)
		p@m100 = instr(s3@m100, 0, __hhh)
		if (p@m100 == (-1)) {
			break
		}
		__ggg = strmid(__ggg, 0, p@m100) + lang(__iii, __iii) + strmid(__ggg, p@m100 + strlen(__hhh), 300)
	loop
	return __ggg



#deffunc fix_wish var __jjj
	cnv_str __jjj, "の剥製", ""
	cnv_str __jjj, "剥製", ""
	cnv_str __jjj, "のはく製", ""
	cnv_str __jjj, "はく製", ""
	cnv_str __jjj, "のカード", ""
	cnv_str __jjj, "カード", ""
	cnv_str __jjj, "の死体", ""
	cnv_str __jjj, "死体", ""
	cnv_str __jjj, "のエロ本", ""
	cnv_str __jjj, "エロ本", ""
	cnv_str __jjj, "card ", ""
	cnv_str __jjj, "figure ", ""
	cnv_str __jjj, "corpse ", ""
	cnv_str __jjj, "card", ""
	cnv_str __jjj, "figure", ""
	cnv_str __jjj, "corpse", ""
	cnv_str __jjj, "キャラ生成　", ""
	cnv_str __jjj, "ペット召喚　", ""
	return



#deffunc fix_input_chat var __kkk
	cnv_str __kkk, " ", "+"
	cnv_str __kkk, "%", "per"
	cnv_str __kkk, "&", "and"
	cnv_str __kkk, "<", ""
	cnv_str __kkk, ">", ""
	return



#deffunc fix_input_chat2 var __lll
	cnv_str __lll, "fucking", "nyoro~n"
	cnv_str __lll, "fuck", "nyou talk funny"
	return



#deffunc cnv_filestr var __mmm
	cnv_str __mmm, "\"", "_"
	cnv_str __mmm, "\\", "_"
	cnv_str __mmm, "<", "_"
	cnv_str __mmm, ">", "_"
	cnv_str __mmm, "/", "_"
	cnv_str __mmm, "?", "_"
	cnv_str __mmm, "|", "_"
	cnv_str __mmm, "*", "_"
	return



#deffunc imeset int __nnn
	himc@ime_control = ImmGetContext(hwnd)
	ImmSetOpenStatus himc@ime_control, __nnn
	ImmReleaseContext hwnd, himc@ime_control
	return



#defcfunc imeget
	himc@ime_control = ImmGetContext(hwnd)
	imesw@ime_control = ImmGetOpenStatus(himc@ime_control)
	ImmReleaseContext hwnd, himc@ime_control
	return imesw@ime_control



#deffunc _fdialog array __ooo, int __ppp, array __qqq, str __rrr, str __sss
	mref _stat@filedialog, 64
	mref _refstr@filedialog, 65
	p1_len@filedialog = length(__ooo)
	p3_len@filedialog = length(__qqq)
	if (p1_len@filedialog != p3_len@filedialog | (__ppp != 16 & __ppp != 17)) {
		_stat@filedialog = 0
		return
	}
	sdim szfilename@filedialog, 260
	szfilename@filedialog = __sss
	sdim szinitdir@filedialog, 260
	szinitdir@filedialog = __rrr
	szappfilter@filedialog = ""
	repeat p1_len@filedialog
		szappfilter@filedialog += __qqq(cnt) + " (*." + __ooo(cnt) + ")@*." + __ooo(cnt) + "@"
	loop
	szappfilter@filedialog += "ALL files (*.*)@*.*@"
	start@filedialog = 0
	repeat
		await 0
		mutch@filedialog = instr(szappfilter@filedialog, start@filedialog, "@")
		if (mutch@filedialog == (-1)) {
			break
		}
		poke szappfilter@filedialog, start@filedialog + mutch@filedialog, 0
		start@filedialog += mutch@filedialog + 1
	loop
	dim ofn@filedialog, 19
	ofn@filedialog(0) = 76
	ofn@filedialog(1) = hwnd
	ofn@filedialog(2) = hinstance
	ofn@filedialog(3) = varptr(szappfilter@filedialog)
	ofn@filedialog(4) = 0
	ofn@filedialog(5) = 0
	ofn@filedialog(6) = 0
	ofn@filedialog(7) = varptr(szfilename@filedialog)
	ofn@filedialog(8) = 260
	ofn@filedialog(9) = 0
	ofn@filedialog(10) = 0
	ofn@filedialog(11) = varptr(szinitdir@filedialog)
	ofn@filedialog(12) = 0
	ofn@filedialog(13) = 4098
	if (__ppp == 16) {
		GetOpenFileNameA varptr(ofn@filedialog)
	}
	if (__ppp == 17) {
		GetSaveFileNameA varptr(ofn@filedialog)
	}
	_stat@filedialog = stat
	_refstr@filedialog = szfilename@filedialog
	return



#deffunc gmes str __ttt
	m@m102 = ""
	msg@m102 = "" + __ttt + "$end"
	i@m102 = 0
	xorg@m102 = gmesx
	size@m102 = 14
	col@m102 = gmescol, gmescol(1), gmescol(2), 180, 160, 140
	lim@m102 = gmesx + gmesw
	font lang(cfg_font1, cfg_font2), size@m102 - en * 2, 0
	repeat
		p@m102 = peek(msg@m102, i@m102)
		brwait@m102 = 0
		if (p@m102 >= 129 & p@m102 <= 159 | p@m102 >= 224 & p@m102 <= 252) {
			p@m102 = 2
		} else {
			p@m102 = 1
		}
		m@m102 = strmid(msg@m102, i@m102, p@m102)
		i@m102 += p@m102
		if (m@m102 == "$") {
			s@m102 = strmid(msg@m102, i@m102, 3)
			p@m102 += 3
			if (s@m102 == "end") {
				break
			}
			continue
		} else {
			if (m@m102 != "。" & m@m102 != "、" & m@m102 != "」" & m@m102 != "』" & m@m102 != "！" & m@m102 != "？" & m@m102 != "…") {
			} else {
				brwait@m102 = 1
			}
		}
		if (m@m102 == "<") {
			s@m102 = strmid(msg@m102, i@m102, instr(msg@m102, i@m102, ">"))
			i@m102 += instr(msg@m102, i@m102, ">") + 1
			if (s@m102 == "emp1") {
				font lang(cfg_font1, cfg_font2), size@m102 - en * 2, 4
				col@m102 = 50, 50, 255
			}
			if (s@m102 == "emp2") {
				font lang(cfg_font1, cfg_font2), size@m102 - en * 2, 1
				col@m102 = 40, 130, 40
			}
			if (s@m102 == "title1") {
				size@m102 = 12
				font lang(cfg_font1, cfg_font2), size@m102 - en * 2, 1
				col@m102 = 100, 50, 50
			}
			if (s@m102 == "def") {
				size@m102 = 14
				font lang(cfg_font1, cfg_font2), size@m102 - en * 2, 0
				col@m102 = gmescol, gmescol(1), gmescol(2)
			}
			if (s@m102 == "p") {
				gmesy += 24
				gmesx = xorg@m102
			}
			if (s@m102 == "br") {
				gmesy += 16
				gmesx = xorg@m102
			}
			if (s@m102 == "b") {
				font lang(cfg_font1, cfg_font2), size@m102 - en * 2, 1
			}
			if (s@m102 == "green") {
				col@m102 = 20, 120, 20
			}
			if (s@m102 == "red") {
				col@m102 = 120, 20, 20
			}
			if (s@m102 == "col") {
				col@m102 = gmescol, gmescol(1), gmescol(2), 180, 160, 140
			}
			continue
		}
		if (m@m102 == "^") {
			m@m102 = strmid(msg@m102, i@m102, 1)
			i@m102++
		}
		if (brwait@m102 == 0) {
			if (gmesx >= lim@m102) {
				gmesx = xorg@m102
				gmesy += size@m102 + 2
			}
		}
		if (gmestype == 1) {
			color col@m102(3), col@m102(4), col@m102(5)
			pos gmesx + 1, gmesy + 1
			mes m@m102
		}
		color col@m102(0), col@m102(1), col@m102(2)
		pos gmesx, gmesy
		mes m@m102
		gmesx += size@m102 / 2 * p@m102
	loop
	gmesx = xorg@m102
	gmesy += size@m102 + 4
	return



#deffunc boxl int __uuu, int __vvv, int __www, int __xxx
	pos __uuu, __xxx
	line __uuu, __vvv
	line __www, __vvv
	line __www, __xxx
	line __uuu, __xxx
	return



#defcfunc fixtxt str __ccc, int __ddd
	m@m104 = "" + __ccc
	if (strlen(__ccc) < __ddd) {
		repeat
			if (strlen(m@m104) >= __ddd) {
				break
			}
			m@m104 += " "
		loop
	} else {
		m@m104 = "" + strmid(m@m104, 0, __ddd)
	}
	return "" + m@m104



#deffunc windowanime int __eee, int __fff, int __ggg, int __hhh, int __iii, int __jjj
	if (nowindowanime) {
		nowindowanime = 0
		return
	}
	if (cfg_windowanime == 0) {
		return
	}
	gsel __jjj
	gmode 0
	pos 0, 0
	gcopy 0, __eee, __fff, __ggg, __hhh
	gsel 0
	gmode 0
	x2@m105 = __ggg / 2
	y2@m105 = __hhh / 2
	cenx@m105 = __eee + x2@m105
	ceny@m105 = __fff + y2@m105
	redraw 0
	repeat __iii - 1, 1
		color 30, 30, 30
		boxl cenx@m105 - x2@m105 / __iii * cnt, ceny@m105 - y2@m105 / __iii * cnt, cenx@m105 + x2@m105 / __iii * cnt, ceny@m105 + y2@m105 / __iii * cnt
		color 240, 240, 240
		boxl cenx@m105 - x2@m105 / __iii * cnt - 1, ceny@m105 - y2@m105 / __iii * cnt - 1, cenx@m105 + x2@m105 / __iii * cnt - 1, ceny@m105 + y2@m105 / __iii * cnt - 1
		redraw 0
		redraw 1
		if (cnt != __iii - 1) {
			await 15
		}
		redraw 0
		pos __eee, __fff
		gcopy __jjj, 0, 0, __ggg, __hhh
	loop
	gmode 2
	return



#deffunc windowanimecorner int __kkk, int __lll, int __mmm, int __nnn, int __ooo, int __ppp
	if (cfg_windowanime == 0) {
		return
	}
	gsel __ppp
	gmode 0
	pos 0, 0
	gcopy 0, __kkk, __lll, __mmm, __nnn
	gsel 0
	gmode 0
	x2@m105 = __mmm - __kkk
	y2@m105 = __nnn - __lll
	redraw 0
	repeat __ooo, 1
		color 30, 30, 30
		boxl __kkk + __mmm, __lll + __nnn, __kkk + __mmm - (__mmm - __kkk) / __ooo * cnt, __lll + __nnn - (__nnn - __lll) / __ooo * cnt
		color 240, 240, 240
		boxl __kkk + __mmm - 1, __lll + __nnn - 1, __kkk + __mmm - (__mmm - __kkk) / __ooo * cnt - 1, __lll + __nnn - (__nnn - __lll) / __ooo * cnt - 1
		redraw 1
		if (cnt != __ooo) {
			await 15
		}
		redraw 0
		pos __kkk, __lll
		gcopy __ppp, 0, 0, __mmm, __nnn
	loop
	gmode 2
	return



#deffunc showtitle str, str __rrr, int __sss, int
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	if (mode != 1) {
		x@m106 = __sss - 10
		y@m106 = 0
	} else {
		x@m106 = 240
		y@m106 = windowh - 16
	}
	repeat (windoww - x@m106 - 8) / 192 + 1
		pos x@m106 + 8 + cnt * 192, y@m106
		gcopy 3, 496, 599 - 18, 192, 18
	loop
	gmode 2
	pos x@m106, y@m106 + (mode != 1)
	gcopy 3, 96, 360, 24, 16
	color 0, 0, 0
	pos x@m106 + 32, y@m106 + 1 + jp
	bmes __rrr, 250, 250, 250
	return



#deffunc drawmenu int __uuu
	y@m107 = 34
	if (__uuu == 0) {
		x@m107 = windoww - 260, 240
		p = 9, 10, 11, 12
		s = lang("情報", "Chara"), lang("装備", "Wear"), lang("特徴", "Feat"), lang("ﾏﾃﾘｱﾙ", "Material"), ""
	}
	if (__uuu == 1) {
		x@m107 = windoww - 260, 240
		p = 13, 14, 22, 23
		s = lang("魔法", "Spell"), lang("技能", "Skill"), lang("大魔法", "Greater Spell"), lang("異界魔法", "Another Spell"), ""
	}
	if (__uuu == 2) {
		x@m107 = windoww - 210, 190
		p = 15, 3, 16
		s = lang("ログ", "Log"), lang("日誌", "Journal"), lang("チャット", "Chat"), ""
	}
	if (__uuu == 3) {
		x@m107 = windoww - 210, 190
		p = 19, 20, 21
		s = lang("チャート", "Chart"), lang("街情報", "City"), lang("法律", "Law"), ""
	}
	if (__uuu == 4) {
		x@m107 = windoww - 210, 190
		p = 24, 25, 26
		s = lang("N.T", "N.T"), lang("S.T", "S.T"), lang("すくつ", "Void"), ""
	}
	if (menucycle == 0) {
		return
	}
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	window2 x@m107, y@m107, x@m107(1), 22, 5, 5
	pos x@m107 - 28, y@m107 - 8
	gcopy 3, 64, 288, 50, 32
	repeat 8
		if (s(cnt) == "") {
			break
		}
		pos x@m107 + cnt * 50 + 20, y@m107 - 24
		gcopy 3, 288 + p(cnt) * 48, 48, 48, 48
		if (curmenu == cnt) {
			gmode 5, , , 70
			pos x@m107 + cnt * 50 + 20, y@m107 - 24
			gcopy 3, 288 + p(cnt) * 48, 48, 48, 48
			gmode 2
		}
		pos x@m107 + cnt * 50 + 46 - strlen(s(cnt)) * 3, y@m107 + 7
		color 0, 0, 0
		if (curmenu == cnt) {
			bmes s(cnt), 255, 255, 255
		} else {
			bmes s(cnt), 165, 165, 165
		}
	loop
	color 0, 0, 0
	pos x@m107 + x@m107(1) - 150, y@m107 + 28
	bmes "" + key_prev + "," + key_next + ",Tab " + lang("[メニュー切替]", "[Change]"), 255, 255, 255
	return



#deffunc fillbg int __vvv, int __www, int __xxx, int __yyy, int __zzz
	gmode 0
	repeat inf_ver / __zzz + 1
		cnt2@m108 = cnt
		repeat windoww / __yyy + 1
			pos windoww - (cnt + 1) * __yyy, inf_ver - (cnt2@m108 + 1) * __zzz
			gcopy __vvv, __www, __xxx, __yyy, __zzz
		loop
	loop
	gmode 2
	return



#defcfunc direction int __aaa, int __bbb, int __ccc, int __ddd
	if (abs(__aaa - __ccc) > abs(__bbb - __ddd)) {
		if (__aaa > __ccc) {
			return 1
		} else {
			return 2
		}
	} else {
		if (__bbb > __ddd) {
			return 3
		} else {
			return 0
		}
	}
*label_0517
	dim matval, 4
	dim matref, 5, 400
	dim matspot, 5, 400
	sdim matname, 40, 400
	sdim matdesc, 80, 400
	// 探知
	p = 0
	matref(0, p) = 0, 1, 240
	matname(p) = lang("端材", "scraps")
	matdesc(p) = lang("様々な素材のあまりもの", "Too much of a material.")
	matspot(0, p) = 16
	p = 1
	matref(0, p) = 5, 1, 240
	matname(p) = lang("マジックマス", "magic mass")
	matdesc(p) = lang("質の低い魔力の塊", "A low quality piece of magic.")
	matspot(0, p) = 16
	p = 2
	matref(0, p) = 10, 1, 240
	matname(p) = lang("革", "leather")
	matdesc(p) = lang("なめした皮", "tanned leather.")
	matspot(0, p) = 16
	p = 3
	matref(0, p) = 15, 1, 240
	matname(p) = lang("魔法のインク", "magic ink")
	matdesc(p) = lang("魔力を秘めたインク", "magic ink.")
	matspot(0, p) = 16
	p = 4
	matref(0, p) = 20, 3, 240
	matname(p) = lang("希少な端材", "rare scraps")
	matdesc(p) = lang("希少な素材のあまりもの", "Too much of a material.")
	matspot(0, p) = 16
	p = 5
	matref(0, p) = 25, 3, 240
	matname(p) = lang("魔力の結晶", "magic fragment")
	matdesc(p) = lang("魔力が込められている", "This is magical.")
	matspot(0, p) = 16
	p = 6
	matref(0, p) = 30, 3, 240
	matname(p) = lang("魔獣の革", "hexenbiest Leather")
	matdesc(p) = lang("獰猛な革", "fierce leather.")
	matspot(0, p) = 16
	p = 7
	matref(0, p) = 40, 5, 240
	matname(p) = lang("魂のかけら", "fragment soul")
	matdesc(p) = lang("ほんのりと輝いている", "It is shining.")
	matspot(0, p) = 16
	// 採掘
	p = 10
	matref(0, p) = 0, 1, 209
	matname(p) = lang("石ころ", "stone")
	matdesc(p) = lang("なんの変哲もない石ころ", "stone.")
	matspot(0, p) = 14
	p = 11
	matref(0, p) = 5, 1, 209
	matname(p) = lang("鉄鉱石", "iron ore")
	matdesc(p) = lang("小さな鉄鉱石", "tiny ore.")
	matspot(0, p) = 14
	p = 12
	matref(0, p) = 10, 1, 209
	matname(p) = lang("金鉱石", "gold ore")
	matdesc(p) = lang("小さな金鉱石", "tiny ore.")
	matspot(0, p) = 14
	p = 13
	matref(0, p) = 15, 1, 209
	matname(p) = lang("エメラルド鉱石", "emerald ore")
	matdesc(p) = lang("小さなエメラルド鉱石", "tiny ore.")
	matspot(0, p) = 14
	p = 14
	matref(0, p) = 20, 3, 209
	matname(p) = lang("ダイア鉱石", "diamond ore")
	matdesc(p) = lang("小さなダイア鉱石", "tiny ore.")
	matspot(0, p) = 14
	p = 15
	matref(0, p) = 25, 3, 209
	matname(p) = lang("水晶鉱石", "crystal ore")
	matdesc(p) = lang("小さな水晶鉱石", "tiny ore.")
	matspot(0, p) = 14
	p = 16
	matref(0, p) = 30, 3, 209
	matname(p) = lang("混沌の石", "stone of chaos")
	matdesc(p) = lang("混沌の力が封じられた石", "chaos chaos.")
	matspot(0, p) = 14
	p = 17
	matref(0, p) = 40, 5, 209
	matname(p) = lang("エーテル鉱石", "ether ore")
	matdesc(p) = lang("エーテルの力が込められた鉱石", "tiny ore.")
	matspot(0, p) = 14
	// 釣り
	p = 20
	matref(0, p) = 0, 1, 310
	matname(p) = lang("雑魚", "small fry")
	matdesc(p) = lang("どこにでも居る魚", "found anywhere.")
	matspot(0, p) = 13
	p = 21
	matref(0, p) = 5, 1, 310
	matname(p) = lang("燃魚", "fire fish")
	matdesc(p) = lang("熱を発し身を守る魚", "fire fish.")
	matspot(0, p) = 13
	p = 22
	matref(0, p) = 10, 1, 310
	matname(p) = lang("氷魚", "cold fish")
	matdesc(p) = lang("つららを身に纏う魚", "cold fish.")
	matspot(0, p) = 13
	p = 23
	matref(0, p) = 15, 1, 310
	matname(p) = lang("電魚", "elect fish")
	matdesc(p) = lang("電気を身に纏う魚", "elect fish.")
	matspot(0, p) = 13
	p = 24
	matref(0, p) = 20, 3, 310
	matname(p) = lang("闇魚", "dark fish")
	matdesc(p) = lang("敵の目をくらませる魚", "dark fish.")
	matspot(0, p) = 13
	p = 25
	matref(0, p) = 25, 3, 310
	matname(p) = lang("音魚", "sound fish")
	matdesc(p) = lang("音を発し敵を威嚇する魚", "sound fish.")
	matspot(0, p) = 13
	p = 26
	matref(0, p) = 30, 3, 310
	matname(p) = lang("毒魚", "harm fish")
	matdesc(p) = lang("その身に毒を持つ魚", "harm fish.")
	matspot(0, p) = 13
	p = 27
	matref(0, p) = 40, 5, 310
	matname(p) = lang("幻魚", "vision fish")
	matdesc(p) = lang("幻影で敵から逃れる魚", "vision fish.")
	matspot(0, p) = 13
	// 栽培
	p = 30
	matref(0, p) = 0, 1, 240
	matname(p) = lang("木の枝", "tree branch")
	matdesc(p) = lang("脆い木の枝", "tree branch.")
	matspot(0, p) = 15
	p = 31
	matref(0, p) = 5, 1, 240
	matname(p) = lang("草の束", "bunch of grass")
	matdesc(p) = lang("様々な種類の草の束", "bunch of grass.")
	matspot(0, p) = 15
	p = 32
	matref(0, p) = 10, 1, 240
	matname(p) = lang("頑丈な枝", "sturdy branch")
	matdesc(p) = lang("しっかりとした枝", "firm branches.")
	matspot(0, p) = 15
	p = 33
	matref(0, p) = 15, 1, 240
	matname(p) = lang("魔力草", "magic grass")
	matdesc(p) = lang("魔力を蓄えた草", "magic grass.")
	matspot(0, p) = 15
	p = 34
	matref(0, p) = 20, 3, 240
	matname(p) = lang("唸る草", "meadow grass")
	matdesc(p) = lang("変な音を出す草", "meadow grass.")
	matspot(0, p) = 15
	p = 35
	matref(0, p) = 25, 3, 240
	matname(p) = lang("呪いの草", "cursed grass")
	matdesc(p) = lang("呪われた草", "cursed grass.")
	matspot(0, p) = 15
	p = 36
	matref(0, p) = 30, 3, 240
	matname(p) = lang("聖なる草", "holy grass")
	matdesc(p) = lang("祝福された草", "holy grass.")
	matspot(0, p) = 15
	p = 37
	matref(0, p) = 40, 5, 240
	matname(p) = lang("世界樹の樹液", "sap of yaggdrasil")
	matdesc(p) = lang("どんな傷も癒す樹液", "It's pretty rare.")
	matspot(0, p) = 15
	// ハズレマテリアル
	p = 40
	matref(0, p) = 1, 3, 209
	matname(p) = lang("汚れたマテリアルの元", "dirty materials")
	matdesc(p) = lang("様々なマテリアルの元", "source of various materials.")
	matspot(0, p) = 18
	p = 41
	matref(0, p) = 10, 5, 209
	matname(p) = lang("マテリアルの元", "materials")
	matdesc(p) = lang("様々なマテリアルの元", "source of various materials.")
	matspot(0, p) = 18
	p = 42
	matref(0, p) = 25, 7, 209
	matname(p) = lang("澄んだマテリアルの元", "unruffled materials")
	matdesc(p) = lang("様々なマテリアルの元", "source of various materials.")
	matspot(0, p) = 18
	p = 43
	matref(0, p) = 40, 10, 209
	matname(p) = lang("神秘のマテリアルの元", "mystical materials")
	matdesc(p) = lang("様々なマテリアルの元", "source of various materials.")
	matspot(0, p) = 18

	p = 50
	matref(0, p) = 1, 20, 434
	matname(p) = lang("カジノチップ", "Casino chip")
	matdesc(p) = lang("カジノで使うチップ", "Chips used in casinos.")
	matspot(0, p) = 18
	p = 51
	matref(0, p) = 1, 30, 437
	matname(p) = lang("100Yen硬貨", "100 Yen coin")
	matdesc(p) = lang("異国のお金", "Foreign money.")
	matspot(0, p) = 18
	p = 52
	matref(0, p) = 1, 40, 437
	matname(p) = lang("500Yen硬貨", "500 Yen coin")
	matdesc(p) = lang("異国のお金", "Foreign money.")
	matspot(0, p) = 18
	p = 53
	matref(0, p) = 0, 999999, 434
	matname(p) = lang("季節の欠片", "Season chip")
	matdesc(p) = lang("季節の移り変わりを感じる", "Feel the changing of the seasons.")
	p = 399
	matref(0, p) = 0, 999999, 209
	matname(p) = lang("いにしえのマテリアル", "old material")
	matdesc(p) = lang("古き時代のマテリアルの遺り", "old material.")
	return

*label_0517_another
	// another_matref
	// マテリアルレベル(0-3 0:汚れた 3:神秘のマテリアルの元) ,
	// -10 : 0 11-20 : 1 21-30 : 2 31- : 3
	// マテリアルの必要数,
	// 画像id,
	dim  another_matref,   5, 100
	sdim another_matname, 40, 100
	sdim another_matdesc, 80, 100
	another_matref(0, 0) =  0, 1, 240
	another_matname(0)   = lang("クズ(異界)", "Garbage(A)")
	another_matdesc(0)   = lang("何の価値もないクズ", "Just garbage.")
	p = 0
	another_matref(0, 1) =  0, 2, 434
	another_matname(1)   = lang("カジノチップ(異界)", "Casino chip(A)")
	another_matdesc(1)   = lang("カジノで使うチップ", "Chips used in casinos.")
	p = 1
	another_matref(0, 40) = 0, 4, 437
	another_matname(40)   = lang("100Yen硬貨(異界)", "100 Yen coin(A)")
	another_matdesc(40)   = lang("異国のお金", "Foreign money.")
	p = 40
	another_matref(0, 41) = 0, 20, 437
	another_matname(41)   = lang("500Yen硬貨(異界)", "500 Yen coin(A)")
	another_matdesc(41)   = lang("異国のお金", "Foreign money.")
	p = 41
	another_matref(0, 43) = 0, 1, 470
	another_matname(43)   = lang("紙(異界)", "Paper(A)")
	another_matdesc(43)   = lang("白紙", "Blank paper.")
	p = 43
	another_matref(0, 2) = 0, 1, 239
	another_matname(2)   = lang("炭(異界)", "Charcoal(A)")
	another_matdesc(2)   = lang("良質な炭", "This is good quality charcoal.")
	p = 2
	another_matref(0, 3) = 0, 1, 239
	another_matname(3)   = lang("流木(異界)", "Driftwood(A)")
	another_matdesc(3)   = lang("あまり質の良くない木材", "Common driftwood.")
	p = 3
	another_matref(0, 48) = 0, 1, 209
	another_matname(48)   = lang("石ころ(異界)", "Pebble(A)")
	another_matdesc(48)   = lang("どこにでも落ちている", "These are around everywhere.")
	p = 48
	another_matref(0, 6) = 0, 2, 239
	another_matname(6)   = lang("杖(異界)", "Stick(A)")
	another_matdesc(6)   = lang("杖", "A specially shaped piece of wood.")
	p = 6
	another_matref(0, 45) = 0, 1, 155
	another_matname(45)   = lang("布きれ(異界)", "Cloth(A)")
	another_matdesc(45)   = lang("ただの布きれ", "A piece of cloth.")
	p = 45
	another_matref(0, 38) = 0, 1, 8
	another_matname(38)   = lang("わめく狂人(異界)", "Yelling madman(A)")
	another_matdesc(38)   = lang("黙らない", "It never shuts up.")
	p = 38
	another_matref(0, 30) = 0, 3, 7
	another_matname(30)   = lang("マジックマス(異界)", "Magic mass(A)")
	another_matdesc(30)   = lang("謎の魔力の塊", "Unknown magical mass.")
	p = 30
	another_matref(0, 23) = 1, 1, 7
	another_matname(23)   = lang("電気(異界)", "Electricity(A)")
	another_matdesc(23)   = lang("放電している", "It is discharging.")
	p = 23
	another_matref(0, 44) = 2, 3, 7
	another_matname(44)   = lang("生成機械(異界)", "Generator(A)")
	another_matdesc(44)   = lang("何かを生み出す機械", "This machine generates something.")
	p = 44
	another_matref(0, 50) = 0, 1, 209
	another_matname(50)   = lang("魔力の結晶(異界)", "Magic fragment(A)")
	another_matdesc(50)   = lang("魔力が込められている", "This is magical.")
	p = 50
	another_matref(0, 46) = 0, 1, 239
	another_matname(46)   = lang("枝(異界)", "Branch(A)")
	another_matdesc(46)   = lang("枝", "Broken off of a tree.")
	p = 46
	another_matref(0, 33) = 0, 1, 155
	another_matname(33)   = lang("革(異界)", "Leather(A)")
	another_matdesc(33)   = lang("なめした皮", "A tanned hide.")
	p = 33
	another_matref(0, 53) = 0, 1, 202
	another_matname(53)   = lang("ツル(異界)", "Vein(A)")
	another_matdesc(53)   = lang("ツル", "Vein.")
	p = 53
	another_matref(0, 47) = 0, 1, 239
	another_matname(47)   = lang("頑丈な枝(異界)", "Thick wood(A)")
	another_matdesc(47)   = lang("なかなか折れない", "This doesn't break down easily.")
	p = 47
	another_matref(0, 37) = 1, 2, 471
	another_matname(37)   = lang("曲がった杖(異界)", "Curved stick(A)")
	another_matdesc(37)   = lang("杖の役割を果たさない", "Almost unusable.")
	p = 37
	another_matref(0, 54) = 0, 1, 354
	another_matname(54)   = lang("接着剤(異界)", "Adhesive(A)")
	another_matdesc(54)   = lang("ネトネトしている", "It's sticky.")
	p = 54
	another_matref(0, 49) = 0, 1, 150
	another_matname(49)   = lang("記憶の欠片(異界)", "Memory fragment(A)")
	another_matdesc(49)   = lang("思い出が残っている", " Reminds you of something.")
	p = 49
	another_matref(0, 35) = 0, 1, 470
	another_matname(35)   = lang("魔法の紙(異界)", "Magic paper(A)")
	another_matdesc(35)   = lang("魔力を秘めた紙", "Magical paper.")
	p = 35
	another_matref(0, 36) = 0, 1, 354
	another_matname(36)   = lang("魔法のインク(異界)", "Magic ink(A)")
	another_matdesc(36)   = lang("魔力を秘めたインク", "Wizards love to use it.")
	p = 36
	another_matref(0, 12) = 0, 1, 354
	another_matname(12)   = lang("海水(異界)", "Seawater(A)")
	another_matdesc(12)   = lang("しょっぱい水", "Very salty.")
	p = 12
	another_matref(0, 5) = 0, 1, 354
	another_matname(5)   = lang("水滴(異界)", "Waterdrop(A)")
	another_matdesc(5)   = lang("水滴", "A drop of water.")
	p = 5
	another_matref(0, 10) = 0, 1, 354
	another_matname(10)   = lang("天使の涙(異界)", "Angel's tear(A)")
	another_matdesc(10)   = lang("不思議な輝きを放つ涙", "Hard to gather.")
	p = 10
	another_matref(0, 25) = 0, 1, 354
	another_matname(25)   = lang("お湯(異界)", "Hot water(A)")
	another_matdesc(25)   = lang("なぜか冷めない", "Somehow it's not cooling down.")
	p = 25
	another_matref(0, 11) = 0, 1, 354
	another_matname(11)   = lang("魔女の涙(異界)", "Witch's tear(A)")
	another_matdesc(11)   = lang("決して乾かない涙", "Never dries up.")
	p = 11
	another_matref(0, 20) = 1, 1, 7
	another_matname(20)   = lang("雪(異界)", "Snow(A)")
	another_matdesc(20)   = lang("なぜか溶けない", "It won't melt somehow.")
	p = 20
	another_matref(0, 7) = 0, 1, 209
	another_matname(7)   = lang("ミスリルの欠片(異界)", "Mithril fragment(A)")
	another_matdesc(7)   = lang("ミスリルを含んだ鉱石の欠片", "Contains mithril.")
	p = 7
	another_matref(0, 9) = 0, 1, 209
	another_matname(9)   = lang("鉄の欠片(異界)", "Iron fragment(A)")
	another_matdesc(9)   = lang("鉄分を含んだ鉱石の欠片", "Contains iron.")
	p = 9
	another_matref(0, 26) = 0, 1, 209
	another_matname(26)   = lang("火炎石(異界)", "Fire stone(A)")
	another_matdesc(26)   = lang("熱を帯びた石", "This is hot.")
	p = 26
	another_matref(0, 27) = 0, 1, 209
	another_matname(27)   = lang("冷凍石(異界)", "Ice stone(A)")
	another_matdesc(27)   = lang("冷たい石", "This is cool.")
	p = 27
	another_matref(0, 28) = 0, 1, 209
	another_matname(28)   = lang("帯電石(異界)", "Discharging stone(A)")
	another_matdesc(28)   = lang("電気を帯びた石", "It's electrified.")
	p = 28
	another_matref(0, 52) = 0, 1, 209
	another_matname(52) = lang("上等な石(異界)", "Fine stone(A)")
	another_matdesc(52) = lang("状態の良い石", "A good quality stone.")
	p = 52
	another_matref(0, 8) = 0, 1, 209
	another_matname(8) = lang("エーテルの欠片(異界)", "Ether fragment(A)")
	another_matdesc(8) = lang("エーテルを含んだ鉱石の欠片", "Contains ether.")
	p = 8
	another_matref(0, 22) = 1, 2, 209
	another_matname(22) = lang("元素の欠片(異界)", "Element fragment(A)")
	another_matdesc(22) = lang("元素の力を宿した石", "Elemental.")
	p = 22
	another_matref(0, 51) = 3, 4, 209
	another_matname(51) = lang("混沌の石(異界)", "Chaos stone(A)")
	another_matdesc(51) = lang("混沌の力が封じられた石", "Chaotic.")
	p = 51
	another_matref(0, 13) = 0, 1, 170
	another_matname(13) = lang("唸る草(異界)", "Howling weed(A)")
	another_matdesc(13) = lang("変な音を出す草", "It's making a whining sound.")
	p = 13
	another_matref(0, 14) = 0, 1, 170
	another_matname(14) = lang("赤い草(異界)", "Red weed(A)")
	another_matdesc(14) = lang("ほんのり赤い草", "A faintly reddish weed.")
	p = 14
	another_matref(0, 15) = 0, 1, 170
	another_matname(15) = lang("青い草(異界)", "Blue weed(A)")
	another_matdesc(15) = lang("ほんのり青い草", "A faintly blueish weed.")
	p = 15
	another_matref(0, 16) = 0, 1, 170
	another_matname(16) = lang("呪いの草(異界)", "Curse weed(A)")
	another_matdesc(16) = lang("呪われた草", "A cursed weed.")
	p = 16
	another_matref(0, 42) = 0, 1, 170
	another_matname(42) = lang("薬草(異界)", "Medicinal weed(A)")
	another_matdesc(42) = lang("少し傷を癒す", "Slightly cures wounds.")
	p = 42
	another_matref(0, 29) = 0, 1, 170
	another_matname(29) = lang("浮き草(異界)", "Floating weed(A)")
	another_matdesc(29) = lang("とても軽い草", "Very light.")
	p = 29
	another_matref(0, 17) = 1, 1, 170
	another_matname(17) = lang("聖なる草(異界)", "Holy weed(A)")
	another_matdesc(17) = lang("祝福された草", "It's blessed.")
	p = 17
	another_matref(0, 24) = 1, 1, 8
	another_matname(24) = lang("黒い霧(異界)", "Black mist(A)")
	another_matdesc(24) = lang("真っ黒な霧", "It's as black as coal.")
	p = 24
	another_matref(0, 34) = 2, 4, 354
	another_matname(34) = lang("世界樹の樹液(異界)", "Sap of Yaggdrasil(A)")
	another_matdesc(34) = lang("どんな傷も癒す樹液", "It's pretty rare.")
	p = 34
	another_matref(0, 4) = 0, 1, 436
	another_matname(4) = lang("鳥の羽(異界)", "Bird's feather(A)")
	another_matdesc(4) = lang("普通の鳥の羽", "A piece of Feather.")
	p = 4
	another_matref(0, 18) = 0, 2, 301
	another_matname(18) = lang("ウサギの尻尾(異界)", "Rabbit's tail(A)")
	another_matdesc(18) = lang("幸運を呼ぶ尻尾", "Scut.")
	p = 18
	another_matref(0, 31) = 0, 1, 304
	another_matname(31) = lang("ヒトの遺伝子(異界)", "Human gene(A)")
	another_matdesc(31) = lang("普通の遺伝子", "It's common.")
	p = 31
	another_matref(0, 39) = 0, 1, 301
	another_matname(39) = lang("クマの尻尾(異界)", "Bear's tail(A)")
	another_matdesc(39) = lang("とても短い", "Very short.")
	p = 39
	another_matref(0, 19) = 0, 1, 304
	another_matname(19) = lang("トロールの遺伝子(異界)", "Troll gene(A)")
	another_matdesc(19) = lang("再生する遺伝子", "It's regenerating.")
	p = 19
	another_matref(0, 32) = 0, 1, 304
	another_matname(32) = lang("魔女の瞳(異界)", "Witch's eye(A)")
	another_matdesc(32) = lang("まだ動いている", "These eyes are still moving.")
	p = 32
	another_matref(0, 21) = 0, 1, 209
	another_matname(21) = lang("フェアリーダスト(異界)", "Fairy dust(A)")
	another_matdesc(21) = lang("妖精の燐粉", "Fairies leave it.")
	p = 21
	return

#defcfunc prodcheck int __eee
	f@m110 = 1
	if (matval(1) > sdata(matval, __eee)) {
		f@m110 = -1
	}
	repeat 6
		j@m110 = matneed(cnt * 2), matneed(cnt * 2 + 1)
		if (j@m110 == (-1)) {
			break
		}
		if (mat(j@m110) < j@m110(1)) {
			f@m110 = -1
		}
	loop
	return f@m110

#defcfunc prodcheck_another
	f@m110 = 1
	repeat 6
		j@m110 = matneed(cnt * 2), matneed(cnt * 2 + 1)
		if (j@m110 == (-1)) {
			break
		}
		if (mat(j@m110) < j@m110(1)) {
			f@m110 = -1
		}
	loop
	return f@m110

#defcfunc prodcheck_custom int __eee
	f@m110 = 1
	if (matval(1) > sdata(matval, __eee)) {
		f@m110 = -1
	}
	repeat 6
		j@m110 = matneed(cnt * 2), matneed(cnt * 2 + 1)
		if (j@m110 == (-1)) {
			break
		}
		if (ncgdata(400 + j@m110) < j@m110(1)) {
			f@m110 = -1
		}
	loop
	return f@m110


#deffunc calcweaponfix int __fff, int __ggg
	pierce = 0
	rangemap_pow = 100, 20, 20, 20, 20, 20, 20, 20, 20, 20
	rangemap_hit = 100, 20, 20, 20, 20, 20, 20, 20, 20, 20
	if (__fff == 800) {
		pierce = 0
		rangemap_pow = 80, 100, 100, 90, 80, 70
		rangemap_hit = 80, 100, 100, 90, 80, 70
		return 1
	}
	if (__fff == 788) {
		pierce = 15
		rangemap_pow = 80, 90, 100, 100, 100, 90, 80, 60, 40
		rangemap_hit = 50, 80, 100, 100, 80, 50
		return 1
	}
	if (__fff == 781) {
		pierce = 40
		return 1
	}
	if (__fff == 759) {
		pierce = 100
		return 1
	}
	if (__fff == 758) {
		pierce = 35
		rangemap_pow = 100, 90, 80, 70, 50, 30, 30, 30
		rangemap_hit = 100, 90, 90, 80, 70, 70, 50, 30
		return 1
	}
	if (__fff == 743) {
		pierce = useritemdata(44, inv(31, __ggg))
		repeat 10
			rangemap_pow(cnt) = useritemdata(45 + cnt, inv(31, __ggg))
			rangemap_hit(cnt) = useritemdata(55 + cnt, inv(31, __ggg))
		loop
		return 1
	}
	if (__fff == 741) {
		pierce = 20
		return 1
	}
	if (__fff == 739) {
		pierce = 65
		return 1
	}
	if (__fff == 735) {
		pierce = 5
		return 1
	}
	if (__fff == 725) {
		pierce = 0
		rangemap_pow = 80, 100, 90, 60
		rangemap_hit = 60, 100, 70, 30
		return 1
	}
	if (__fff == 718) {
		pierce = 5
		rangemap_pow = 50, 100, 50
		rangemap_hit = 50, 100, 50
		return 1
	}
	if (__fff == 716) {
		pierce = 50
		rangemap_pow = 60, 100, 70
		rangemap_hit = 60, 100, 70
		return 1
	}
	if (__fff == 714) {
		pierce = 0
		rangemap_pow = 60, 100, 70, 20, 20
		rangemap_hit = 80, 100, 90, 80, 60
		return 1
	}
	if (__fff == 713) {
		pierce = 15
		rangemap_pow = 60, 100, 70
		rangemap_hit = 60, 100, 70
		return 1
	}
	if (__fff == 678) {
		pierce = 10
		return 1
	}
	if (__fff == 677) {
		pierce = 30
		return 1
	}
	if (__fff == 675) {
		pierce = 15
		return 1
	}
	if (__fff == 674) {
		pierce = 30
		rangemap_pow = 200, 40
		rangemap_hit = 50, 60, 70, 80, 80, 90, 90, 100, 100, 100
		return 1
	}
	if (__fff == 673) {
		pierce = 20
		rangemap_pow = 50, 90, 100, 90, 80, 80, 70, 60, 50, 20
		rangemap_hit = 50, 90, 100, 100, 100, 90, 80, 70, 60, 50
		return 1
	}
	if (__fff == 633) {
		pierce = 5
		rangemap_pow = 50, 100, 50
		rangemap_hit = 50, 100, 50
		return 1
	}
	if (__fff == 514) {
		pierce = 5
		rangemap_pow = 100, 100, 100, 100, 100, 100, 100, 50
		rangemap_hit = 100, 100, 100, 100, 100, 100, 100, 50
		return 1
	}
	if (__fff == 512) {
		pierce = 5
		rangemap_pow = 100, 100, 100, 100, 100, 100, 100
		rangemap_hit = 100, 100, 100, 100, 100, 100, 100
		return 1
	}
	if (__fff == 496) {
		pierce = 30
		rangemap_pow = 100, 60
		rangemap_hit = 50, 60, 70, 80, 80, 90, 90, 100, 100, 100
		return 1
	}
	if (__fff == 482) {
		pierce = 25
		rangemap_pow = 80, 100, 90, 80, 70, 60, 50
		rangemap_hit = 80, 100, 90, 80, 70, 60, 50
		return 1
	}
	if (__fff == 359) {
		pierce = 40
		return 1
	}
	if (__fff == 266) {
		pierce = 5
		return 1
	}
	if (__fff == 235) {
		pierce = 30
		return 1
	}
	if (__fff == 231) {
		pierce = 0
		rangemap_pow = 80, 100, 100, 90, 80, 70
		rangemap_hit = 80, 100, 100, 90, 80, 70
		return 1
	}
	if (__fff == 230) {
		pierce = 15
		rangemap_pow = 70, 100, 100, 80, 60
		rangemap_hit = 70, 100, 100, 80, 60
		return 1
	}
	if (__fff == 228) {
		pierce = 25
		return 1
	}
	if (__fff == 225) {
		pierce = 10
		return 1
	}
	if (__fff == 224) {
		pierce = 20
		return 1
	}
	if (__fff == 213) {
		pierce = 25
		return 1
	}
	if (__fff == 211) {
		pierce = 5
		return 1
	}
	if (__fff == 210) {
		pierce = 5
		rangemap_pow = 60, 100, 70
		rangemap_hit = 60, 100, 70
		return 1
	}
	if (__fff == 207) {
		pierce = 20
		rangemap_pow = 50, 90, 100, 90, 80, 80, 70, 60, 50, 20
		rangemap_hit = 50, 90, 100, 100, 130, 150, 180, 200, 200, 200
		return 1
	}
	if (__fff == 206) {
		pierce = 20
		return 1
	}
	if (__fff == 73) {
		pierce = 20
		return 1
	}
	if (__fff == 64) {
		pierce = 15
		return 1
	}
	if (__fff == 63) {
		pierce = 15
		return 1
	}
	if (__fff == 60) {
		pierce = 10
		rangemap_pow = 100, 90, 70, 50
		rangemap_hit = 100, 90, 70, 50
		return 1
	}
	if (__fff == 58) {
		pierce = 20
		rangemap_pow = 50, 90, 100, 90, 80, 80, 70, 60, 50
		rangemap_hit = 50, 90, 100, 90, 80, 80, 70, 60, 50
		return 1
	}
	if (__fff == 57) {
		pierce = 25
		return 1
	}
	if (__fff == 56) {
		pierce = 10
		return 1
	}
	if (__fff == 2) {
		pierce = 10
		return 1
	}
	if (__fff == 1) {
		pierce = 5
		return 1
	}
	return 0
*label_0521
	matneed = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
	/* 大工 */
	if (matid == 10000) {
		matval = 176, 1, 100
		matneed = 40, 2
		return 1
	}
	if (matid == 10001) {
		matval = 176, 1, 100
		matneed = 40, 4
		return 1
	}
	if (matid == 10002) {
		matval = 176, 12, 100
		matneed = 41, 2
		return 1
	}
	if (matid == 10003) {
		matval = 176, 12, 100
		matneed = 41, 4
		return 1
	}
	if (matid == 10004) {
		matval = 176, 21, 100
		matneed = 42, 2
		return 1
	}
	if (matid == 10005) {
		matval = 176, 21, 100
		matneed = 42, 4
		return 1
	}
	if (matid == 10006) {
		matval = 176, 33, 100
		matneed = 43, 2
		return 1
	}
	if (matid == 10007) {
		matval = 176, 33, 100
		matneed = 43, 4
		return 1
	}
	// かがり台
	if (matid == 48) {
		matval = 176, 3, 100
		matneed = 0, 2, 10, 1, 11, 1
		return 1
	}
	// 旗
	if (matid == 49) {
		matval = 176, 3, 100
		matneed = 0, 2, 30, 1, 11, 1
		return 1
	}
	// 石碑
	if (matid == 53) {
		matval = 176, 3, 100
		matneed = 10, 4
		return 1
	}
	// 丸椅子
	if (matid == 77) {
		matval = 176, 6, 100
		matneed = 32, 2, 2, 2
		return 1
	}
	// 四角い椅子
	if (matid == 101) {
		matval = 176, 6, 100
		matneed = 32, 2, 2, 2
		return 1
	}
	// 安物の椅子
	if (matid == 102) {
		matval = 176, 6, 100
		matneed = 32, 3
		return 1
	}
	// 普通の本棚
	if (matid == 78) {
		matval = 176, 6, 100
		matneed = 32, 2, 31, 1, 2, 1
		return 1
	}
	// 高級箪笥
	if (matid == 79) {
		matval = 176, 9, 100
		matneed = 32, 2, 30, 4
		return 1
	}
	// 安物ベッド
	if (matid == 80) {
		matval = 176, 9, 100
		matneed = 0, 2, 32, 2
		return 1
	}
	// モダンテーブル
	if (matid == 83) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// ダイニングテーブル
	if (matid == 84) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// バーテーブルα
	if (matid == 89) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// バーテーブルβ
	if (matid == 90) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// 勉強机
	if (matid == 99) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// 狭い食卓
	if (matid == 156) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// 上品なテーブル
	if (matid == 157) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// 物置
	if (matid == 104) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// 落ち着くテーブル
	if (matid == 280) {
		matval = 176, 12, 100
		matneed = 11, 2, 32, 2
		return 1
	}
	// タル
	if (matid == 91) {
		matval = 176, 12, 100
		matneed = 32, 4
		return 1
	}
	// おしゃれな椅子
	if (matid == 92) {
		matval = 176, 15, 100
		matneed = 32, 2, 10, 2
		return 1
	}
	// ランタン
	if (matid == 94) {
		matval = 176, 15, 100
		matneed = 11, 2, 21, 1
		return 1
	}
	// 金床
	if (matid == 96) {
		matval = 176, 15, 100
		matneed = 11, 5
		return 1
	}
	// ポーションの棚
	if (matid == 100) {
		matval = 176, 15, 100
		matneed = 0, 4, 1, 2, 32, 2
		return 1
	}
	// 食器棚
	if (matid == 103) {
		matval = 176, 15, 100
		matneed = 11, 4, 32, 2
		return 1
	}
	// 本たてつきの棚
	if (matid == 105) {
		matval = 176, 15, 100
		matneed = 32, 2, 31, 1, 2, 1
		return 1
	}
	// 流し台
	if (matid == 153) {
		matval = 176, 15, 100
		matneed = 4, 6
		return 1
	}
	// 2段ベッド
	if (matid == 174) {
		matval = 176, 15, 100
		matneed = 11, 4, 32, 2
		return 1
	}
	// 収納棚
	if (matid == 106) {
		matval = 176, 18, 100
		matneed = 32, 4, 11, 2
		return 1
	}
	// 日用品の棚
	if (matid == 292) {
		matval = 176, 18, 100
		matneed = 32, 4, 11, 2
		return 1
	}
	// 装飾品の棚
	if (matid == 293) {
		matval = 176, 18, 100
		matneed = 32, 4, 11, 2
		return 1
	}
	// 溶解炉
	if (matid == 111) {
		matval = 176, 18, 100
		matneed = 4, 2, 10, 4, 11, 2
		return 1
	}
	// オーブン
	if (matid == 112) {
		matval = 176, 18, 100
		matneed = 4, 4, 11, 4, 21, 1
		return 1
	}
	// 調理器
	if (matid == 142) {
		matval = 176, 18, 100
		matneed = 4, 4, 11, 4
		return 1
	}
	// 調理台
	if (matid == 153) {
		matval = 176, 18, 100
		matneed = 4, 4, 11, 4
		return 1
	}
	// コンロ付き調理台
	if (matid == 155) {
		matval = 176, 18, 100
		matneed = 4, 4, 11, 4, 21, 1
		return 1
	}
	// 標識
	if (matid == 113) {
		matval = 176, 21, 100
		matneed = 32, 6
		return 1
	}
	// 道標
	if (matid == 114) {
		matval = 176, 21, 100
		matneed = 32, 6
		return 1
	}
	// 掲示板
	if (matid == 115) {
		matval = 176, 21, 100
		matneed = 32, 6
		return 1
	}
	// 名工箪笥
	if (matid == 150) {
		matval = 176, 21, 100
		matneed = 32, 4, 30, 4
		return 1
	}
	// 名工本棚
	if (matid == 151) {
		matval = 176, 21, 100
		matneed = 32, 4, 30, 4, 31, 2
		return 1
	}
	// 街灯
	if (matid == 278) {
		matval = 176, 21, 100
		matneed = 11, 4, 1, 4
		return 1
	}
	// 観葉植物
	if (matid == 129) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// 木香薔薇
	if (matid == 130) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// 大きい観葉植物
	if (matid == 131) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// サルビアの花
	if (matid == 132) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// ガザニアの花
	if (matid == 133) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// ネリネの花
	if (matid == 134) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// アネモネの花
	if (matid == 135) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// カーネーションの花
	if (matid == 137) {
		matval = 176, 24, 100
		matneed = 4, 2, 10, 4, 31, 4
		return 1
	}
	// 植物で飾られた柱
	if (matid == 138) {
		matval = 176, 27, 100
		matneed = 4, 2, 10, 6, 31, 6
		return 1
	}
	// 花で飾られた柱
	if (matid == 138) {
		matval = 176, 27, 100
		matneed = 4, 2, 10, 6, 31, 6
		return 1
	}
	// 絢爛な燭台
	if (matid == 157) {
		matval = 176, 30, 100
		matneed = 4, 6, 12, 2
		return 1
	}
	// 高級ベッド
	if (matid == 297) {
		matval = 176, 30, 100
		matneed = 32, 6, 2, 4
		return 1
	}
	// 高級ミラー
	if (matid == 299) {
		matval = 176, 30, 100
		matneed = 4, 6, 11, 4
		return 1
	}
	// こたつ
	if (matid == 753) {
		matval = 176, 30, 100
		matneed = 4, 6, 2, 4, 5, 2
		return 1
	}
	// 階段
	if (matid == 751) {
		matval = 176, 30, 100
		matneed = 10, 8, 5, 4
		return 1
	}
	// 階段
	if (matid == 750) {
		matval = 176, 30, 100
		matneed = 10, 8, 5, 4
		return 1
	}
	// 赤のガシャポン
	if (matid == 413) {
		matval = 176, 30, 100
		matneed = 11, 6, 14, 2, 5, 2
		return 1
	}
	// 青のガシャポン
	if (matid == 414) {
		matval = 176, 30, 100
		matneed = 11, 6, 14, 2, 5, 2
		return 1
	}
	// 幸せのベッド
	if (matid == 720) {
		matval = 176, 40, 100
		matneed = 4, 10, 5, 5, 14, 4, 12, 4
		return 1
	}
	// 祭壇
	if (matid == 171) {
		matval = 176, 60, 100
		matneed = 4, 10, 16, 4, 7, 2
		return 1
	}
	// 井戸
	if (matid == 109) {
		matval = 176, 60, 100
		matneed = 10, 10, 20, 5, 7, 2
		return 1
	}
	// 噴水
	if (matid == 173) {
		matval = 176, 60, 100
		matneed = 10, 10, 20, 5, 7, 2
		return 1
	}
	/* ここから杖 */
	// テレポートの杖
	if (matid == 19) {
		matval = 176, 6, 100
		matneed = 32, 2, 1, 1, 11, 1
		return 1
	}
	// 軽治癒の杖
	if (matid == 119) {
		matval = 176, 6, 100
		matneed = 32, 2, 1, 1, 11, 1
		return 1
	}
	// 鑑定の杖
	if (matid == 18) {
		matval = 176, 9, 100
		matneed = 32, 3, 3, 1, 11, 1
		return 1
	}
	// マジックミサイルの杖
	if (matid == 120) {
		matval = 176, 9, 100
		matneed = 32, 3, 3, 1, 11, 1
		return 1
	}
	// 千里眼の杖
	if (matid == 202) {
		matval = 176, 9, 100
		matneed = 32, 3, 3, 1, 11, 1
		return 1
	}
	// 扉生成の杖
	if (matid == 581) {
		matval = 176, 9, 100
		matneed = 32, 3, 3, 1, 11, 1
		return 1
	}
	// 鈍足の杖
	if (matid == 176) {
		matval = 176, 12, 100
		matneed = 32, 4, 4, 1, 12, 1
		return 1
	}
	// 沈黙の杖
	if (matid == 366) {
		matval = 176, 12, 100
		matneed = 32, 4, 4, 1, 12, 1
		return 1
	}
	// 蜘蛛の巣の杖
	if (matid == 485) {
		matval = 176, 12, 100
		matneed = 32, 4, 4, 1, 12, 1
		return 1
	}
	// 炎の衝撃の杖
	if (matid == 123) {
		matval = 176, 15, 100
		matneed = 32, 5, 5, 1, 12, 1
		return 1
	}
	// 氷の視線の杖
	if (matid == 122) {
		matval = 176, 15, 100
		matneed = 32, 5, 5, 1, 12, 1
		return 1
	}
	// 稲妻の軌跡の杖
	if (matid == 175) {
		matval = 176, 15, 100
		matneed = 32, 5, 5, 1, 12, 1
		return 1
	}
	// 炎の壁の杖
	if (matid == 570) {
		matval = 176, 15, 100
		matneed = 32, 5, 5, 1, 12, 1
		return 1
	}
	// 酸の滴る杖
	if (matid == 565) {
		matval = 176, 15, 100
		matneed = 32, 5, 5, 1, 12, 1
		return 1
	}
	// 癒やしの杖
	if (matid == 203) {
		matval = 176, 18, 100
		matneed = 32, 6, 5, 2, 12, 2
		return 1
	}
	// 魔力の杖
	if (matid == 391) {
		matval = 176, 18, 100
		matneed = 32, 6, 5, 2, 12, 2
		return 1
	}
	// 解呪の杖
	if (matid == 412) {
		matval = 176, 21, 100
		matneed = 32, 6, 5, 3, 13, 2
		return 1
	}
	// 加速の杖
	if (matid == 377) {
		matval = 176, 21, 100
		matneed = 32, 6, 5, 3, 13, 2
		return 1
	}
	// 浄化の杖
	if (matid == 385) {
		matval = 176, 21, 100
		matneed = 32, 6, 5, 3, 13, 2
		return 1
	}
	// 変化の杖
	if (matid == 517) {
		matval = 176, 24, 100
		matneed = 32, 7, 5, 4, 13, 4
		return 1
	}
	// 錬金術の杖
	if (matid == 518) {
		matval = 176, 24, 100
		matneed = 32, 7, 5, 4, 13, 4
		return 1
	}
	// 生命の杖
	if (matid == 518) {
		matval = 176, 27, 100
		matneed = 32, 8, 5, 5, 13, 5
		return 1
	}
	// 支配の杖
	if (matid == 480) {
		matval = 176, 35, 100
		matneed = 32, 10, 5, 6, 14, 4
		return 1
	}
	// 願いの杖
	if (matid == 290) {
		matval = 176, 100, 100
		matneed = 32, 100, 5, 50, 16, 10, 7, 10
		return 1
	}
	/* 錬金術 */
	if (matid == 10010) {
		matval = 178, 1, 100
		matneed = 40, 2
		return 1
	}
	if (matid == 10011) {
		matval = 178, 1, 100
		matneed = 40, 4
		return 1
	}
	if (matid == 10012) {
		matval = 178, 12, 100
		matneed = 41, 2
		return 1
	}
	if (matid == 10013) {
		matval = 178, 12, 100
		matneed = 41, 4
		return 1
	}
	if (matid == 10014) {
		matval = 178, 21, 100
		matneed = 42, 2
		return 1
	}
	if (matid == 10015) {
		matval = 178, 21, 100
		matneed = 42, 4
		return 1
	}
	if (matid == 10016) {
		matval = 178, 33, 100
		matneed = 43, 2
		return 1
	}
	if (matid == 10017) {
		matval = 178, 33, 100
		matneed = 43, 4
		return 1
	}
	// 空き瓶
	if (matid == 601) {
		matval = 178, 3, 100
		matneed = 21, 1, 10, 1
		return 1
	}
	// 汚水
	if (matid == 26) {
		matval = 178, 3, 100
		matneed = 20, 2, 10, 1
		return 1
	}
	// 軽傷治癒のポーション
	if (matid == 68) {
		matval = 178, 3, 100
		matneed = 20, 2, 10, 1, 1, 1
		return 1
	}
	// クリムエール
	if (matid == 31) {
		matval = 178, 3, 100
		matneed = 20, 2, 31, 1
		return 1
	}
	// 硫酸
	if (matid == 392) {
		matval = 178, 3, 100
		matneed = 20, 2, 10, 1, 1, 1
		return 1
	}
	// 盲目のポーション
	if (matid == 27) {
		matval = 178, 6, 100
		matneed = 20, 4, 10, 1, 1, 2
		return 1
	}
	// 混乱のポーション
	if (matid == 28) {
		matval = 178, 6, 100
		matneed = 20, 4, 10, 1, 1, 2
		return 1
	}
	// 睡眠薬
	if (matid == 30) {
		matval = 178, 6, 100
		matneed = 20, 4, 10, 1, 1, 2
		return 1
	}
	// 麻痺のポーション
	if (matid == 29) {
		matval = 178, 6, 100
		matneed = 20, 4, 10, 1, 1, 2
		return 1
	}
	// 染料
	if (matid == 519) {
		matval = 178, 6, 100
		matneed = 20, 4, 10, 1, 1, 2
		return 1
	}
	// 毒薬
	if (matid == 262) {
		matval = 178, 9, 100
		matneed = 20, 4, 11, 1, 1, 2
		return 1
	}
	// 食塩水
	if (matid == 698) {
		matval = 178, 9, 100
		matneed = 20, 4, 11, 2
		return 1
	}
	// 肉体復活のポーション
	if (matid == 285) {
		matval = 178, 9, 100
		matneed = 20, 4, 11, 1, 1, 2
		return 1
	}
	// 精神復活のポーション
	if (matid == 286) {
		matval = 178, 9, 100
		matneed = 20, 4, 11, 1, 1, 2
		return 1
	}
	// 防衛者のポーション
	if (matid == 364) {
		matval = 178, 12, 100
		matneed = 21, 4, 12, 1, 1, 2
		return 1
	}
	// トロールの血
	if (matid == 370) {
		matval = 178, 12, 100
		matneed = 21, 4, 12, 1, 1, 2
		return 1
	}
	// 重傷治癒のポーション
	if (matid == 69) {
		matval = 178, 12, 100
		matneed = 21, 4, 12, 1, 1, 2
		return 1
	}
	// 火炎瓶
	if (matid == 577) {
		matval = 178, 12, 100
		matneed = 21, 4, 12, 1, 1, 2
		return 1
	}
	// ウィスキー
	if (matid == 205) {
		matval = 178, 12, 100
		matneed = 20, 4, 31, 2
		return 1
	}
	// 元素耐性のポーション
	if (matid == 372) {
		matval = 178, 15, 100
		matneed = 21, 4, 12, 2, 1, 2
		return 1
	}
	// 鈍足のポーション
	if (matid == 376) {
		matval = 178, 15, 100
		matneed = 21, 4, 12, 2, 1, 2
		return 1
	}
	// 致命傷治癒のポーション
	if (matid == 70) {
		matval = 178, 18, 100
		matneed = 21, 4, 13, 2, 4, 2
		return 1
	}
	// 耐熱コーティング
	if (matid == 736) {
		matval = 178, 18, 100
		matneed = 21, 4, 13, 2, 4, 2
		return 1
	}
	// 耐酸コーティング
	if (matid == 566) {
		matval = 178, 18, 100
		matneed = 23, 4, 13, 2, 4, 2
		return 1
	}
	// 媚薬
	if (matid == 620) {
		matval = 178, 18, 100
		matneed = 23, 4, 13, 2, 4, 2
		return 1
	}
	// 突然変異のポーション
	if (matid == 432) {
		matval = 178, 21, 100
		matneed = 23, 4, 13, 3, 4, 3
		return 1
	}
	// 変異治癒のポーション
	if (matid == 433) {
		matval = 178, 21, 100
		matneed = 23, 4, 13, 3, 4, 3
		return 1
	}
	// 失耐性のポーション
	if (matid == 429) {
		matval = 178, 21, 100
		matneed = 23, 4, 13, 3, 4, 3
		return 1
	}
	// ラムネ
	if (matid == 770) {
		matval = 178, 21, 100
		matneed = 23, 4, 13, 3, 4, 3
		return 1
	}
	// 加速のポーション
	if (matid == 375) {
		matval = 178, 21, 100
		matneed = 23, 4, 13, 3, 4, 3
		return 1
	}
	// 乳
	if (matid == 574) {
		matval = 178, 21, 100
		matneed = 20, 4, 24, 2
		return 1
	}
	// 聖なる癒し手ジュアのポーション
	if (matid == 76) {
		matval = 178, 24, 100
		matneed = 27, 2, 14, 1, 5, 1
		return 1
	}
	// 水
	if (matid == 516) {
		matval = 178, 24, 100
		matneed = 27, 2, 5, 2
		return 1
	}
	// エーテル抗体のポーション
	if (matid == 559) {
		matval = 178, 27, 100
		matneed = 26, 4, 14, 3, 5, 2
		return 1
	}
	// 進化のポーション
	if (matid == 711) {
		matval = 178, 27, 100
		matneed = 26, 4, 14, 3, 5, 2
		return 1
	}
	// 下落のポーション
	if (matid == 706) {
		matval = 178, 30, 100
		matneed = 27, 6, 14, 6, 7, 4
		return 1
	}
	// *エーテル抗体*のポーション
	if (matid == 793) {
		matval = 178, 30, 100
		matneed = 27, 4, 14, 6, 5, 4
		return 1
	}
	// 潜在能力のポーション
	if (matid == 287) {
		matval = 178, 50, 100
		matneed = 27, 10, 16, 4, 7, 2
		return 1
	}
	/* ここから鉱石 */
	// 錆びた偽物の金塊
	if (matid == 208) {
		matval = 178, 3, 100
		matneed = 0, 2, 10, 2
		return 1
	}
	// 折れた刃
	if (matid == 50) {
		matval = 178, 6, 100
		matneed = 0, 2, 11, 2
		return 1
	}
	// 大地の結晶
	if (matid == 35) {
		matval = 178, 9, 100
		matneed = 1, 2, 10, 2
		return 1
	}
	// 魔力の結晶
	if (matid == 36) {
		matval = 178, 9, 100
		matneed = 1, 2, 10, 2
		return 1
	}
	// 太陽の結晶
	if (matid == 37) {
		matval = 178, 9, 100
		matneed = 1, 2, 10, 2
		return 1
	}
	// 金塊
	if (matid == 38) {
		matval = 178, 15, 100
		matneed = 4, 2, 12, 2
		return 1
	}
	// エメラルドの原石
	if (matid == 41) {
		matval = 178, 18, 100
		matneed = 4, 2, 13, 2
		return 1
	}
	// ダイアモンドの原石
	if (matid == 42) {
		matval = 178, 21, 100
		matneed = 4, 2, 14, 2
		return 1
	}
	/* 裁縫 */
	if (matid == 10020) {
		matval = 177, 1, 100
		matneed = 40, 2
		return 1
	}
	if (matid == 10021) {
		matval = 177, 1, 100
		matneed = 40, 4
		return 1
	}
	if (matid == 10022) {
		matval = 177, 12, 100
		matneed = 41, 2
		return 1
	}
	if (matid == 10023) {
		matval = 177, 12, 100
		matneed = 41, 4
		return 1
	}
	if (matid == 10024) {
		matval = 177, 21, 100
		matneed = 42, 2
		return 1
	}
	if (matid == 10025) {
		matval = 177, 21, 100
		matneed = 42, 4
		return 1
	}
	if (matid == 10026) {
		matval = 177, 33, 100
		matneed = 43, 2
		return 1
	}
	if (matid == 10027) {
		matval = 177, 33, 100
		matneed = 43, 4
		return 1
	}
	// サンダル
	if (matid == 455) {
		matval = 177, 3, 100
		matneed = 31, 2, 0, 4
		return 1
	}
	// マント
	if (matid == 65) {
		matval = 177, 3, 100
		matneed = 2, 4, 0, 4
		return 1
	}
	// ライトグローブ
	if (matid == 447) {
		matval = 177, 3, 100
		matneed = 2, 2, 0, 4
		return 1
	}
	// ブーツ
	if (matid == 456) {
		matval = 177, 9, 100
		matneed = 31, 4, 0, 4, 2, 2
		return 1
	}
	// ローブ
	if (matid == 8) {
		matval = 177, 9, 100
		matneed = 31, 4, 0, 4, 2, 2
		return 1
	}
	// グローブ
	if (matid == 445) {
		matval = 177, 9, 100
		matneed = 31, 4, 0, 4, 2, 4
		return 1
	}
	// ペリドット
	if (matid == 468) {
		matval = 177, 12, 100
		matneed = 31, 4, 11, 2
		return 1
	}
	// オーロラリング
	if (matid == 558) {
		matval = 177, 21, 100
		matneed = 4, 10, 23, 4, 24, 4
		return 1
	}
	// ギャルのパンティー
	if (matid == 633) {
		matval = 177, 21, 100
		matneed = 4, 6, 2, 6
		return 1
	}
	// 法王衣
	if (matid == 440) {
		matval = 177, 21, 100
		matneed = 4, 6, 2, 6, 15, 4
		return 1
	}
	// セブンリーグブーツ
	if (matid == 556) {
		matval = 177, 24, 100
		matneed = 33, 10, 2, 10, 25, 4
		return 1
	}
	// ウィンデールクローク
	if (matid == 557) {
		matval = 177, 27, 100
		matneed = 6, 10, 7, 2, 17, 2
		return 1
	}
	/* その他 */
	// ぬいぐるみ
	if (matid == 81) {
		matval = 177, 6, 100
		matneed = 0, 4, 2, 2
		return 1
	}
	// ぬいぐるみ(荷車)
	if (matid == 399) {
		matval = 177, 12, 100
		matneed = 2, 4, 4, 2
		return 1
	}
	// おみやげ
	if (matid == 729) {
		matval = 177, 15, 100
		matneed = 4, 4, 34, 2, 13, 2
		return 1
	}
	// ジュアの抱き枕
	if (godcheck() == "jure") {
		if (cPietyPoint(0) >= 5000) {
			if (matid == 767) {
				matval = 177, 21, 100
				matneed = 4, 66
				return 1
			}
		}
	}
	/*宝石細工*/
	if (matid == 10030) {
		matval = 179, 1, 100
		matneed = 40, 2
		return 1
	}
	if (matid == 10031) {
		matval = 179, 1, 100
		matneed = 40, 4
		return 1
	}
	if (matid == 10032) {
		matval = 179, 12, 100
		matneed = 41, 2
		return 1
	}
	if (matid == 10033) {
		matval = 179, 12, 100
		matneed = 41, 4
		return 1
	}
	if (matid == 10034) {
		matval = 179, 21, 100
		matneed = 42, 2
		return 1
	}
	if (matid == 10035) {
		matval = 179, 21, 100
		matneed = 42, 4
		return 1
	}
	if (matid == 10036) {
		matval = 179, 33, 100
		matneed = 43, 2
		return 1
	}
	if (matid == 10037) {
		matval = 179, 33, 100
		matneed = 43, 4
		return 1
	}
	// 鑑定の巻物
	if (matid == 14) {
		matval = 179, 3, 100
		matneed = 0, 2, 31, 2
		return 1
	}
	// ショートテレポートの巻物
	if (matid == 245) {
		matval = 179, 3, 100
		matneed = 0, 2, 31, 2
		return 1
	}
	// 脱出の巻物
	if (matid == 638) {
		matval = 179, 6, 100
		matneed = 0, 4, 31, 2, 3, 2
		return 1
	}
	// 魔法の地図
	if (matid == 242) {
		matval = 179, 6, 100
		matneed = 0, 4, 31, 2, 3, 2
		return 1
	}
	// テレポートの巻物
	if (matid == 16) {
		matval = 179, 6, 100
		matneed = 0, 4, 31, 2, 3, 2
		return 1
	}
	// 武器強化の巻物
	if (matid == 506) {
		matval = 179, 9, 100
		matneed = 0, 6, 31, 4, 3, 4
		return 1
	}
	// 防具強化の巻物
	if (matid == 508) {
		matval = 179, 9, 100
		matneed = 0, 6, 31, 4, 3, 4
		return 1
	}
	// 劣悪素材の巻物
	if (matid == 500) {
		matval = 179, 9, 100
		matneed = 0, 6, 31, 4, 3, 4
		return 1
	}
	// インコグニートの巻物
	if (matid == 17) {
		matval = 179, 9, 100
		matneed = 0, 4, 31, 2, 3, 2
		return 1
	}
	// 解呪の巻物
	if (matid == 209) {
		matval = 179, 12, 100
		matneed = 4, 4, 24, 2, 3, 4
		return 1
	}
	// ホーリーヴェイルの巻物
	if (matid == 384) {
		matval = 179, 12, 100
		matneed = 4, 4, 24, 2, 3, 4
		return 1
	}
	// 素材変化の巻物
	if (matid == 501) {
		matval = 179, 12, 100
		matneed = 4, 4, 20, 4, 3, 4
		return 1
	}
	// 清浄なる光の巻物
	if (matid == 388) {
		matval = 179, 12, 100
		matneed = 4, 4, 24, 2, 3, 4
		return 1
	}
	// 全浄化の巻物
	if (matid == 389) {
		matval = 179, 15, 100
		matneed = 4, 6, 24, 4, 3, 4
		return 1
	}
	// ＊武器強化＊の巻物
	if (matid == 507) {
		matval = 179, 15, 100
		matneed = 4, 6, 13, 2, 33, 2
		return 1
	}
	// ＊防具強化＊の巻物
	if (matid == 509) {
		matval = 179, 15, 100
		matneed = 4, 6, 13, 2, 33, 2
		return 1
	}
	// 充填の巻物
	if (matid == 515) {
		matval = 179, 18, 100
		matneed = 4, 6, 13, 4, 23, 2
		return 1
	}
	// ＊鑑定＊の巻物
	if (matid == 362) {
		matval = 179, 18, 100
		matneed = 4, 6, 13, 4, 23, 2
		return 1
	}
	// ＊素材変化＊の巻物
	if (matid == 502) {
		matval = 179, 21, 100
		matneed = 5, 6, 33, 6, 35, 1
		return 1
	}
	// 復活の書
	if (matid == 708) {
		matval = 179, 24, 100
		matneed = 5, 6, 33, 6, 35, 2
		return 1
	}
	// 羽の生えた巻物
	if (matid == 632) {
		matval = 179, 27, 100
		matneed = 5, 8, 16, 2, 36, 2
		return 1
	}
	// 収穫の魔法書
	if (matid == 732) {
		matval = 179, 30, 100
		matneed = 5, 10, 36, 2, 37, 2
		return 1
	}
	return -1

// 異世界マテリアル製造
*label_0521_another
	matneed = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
	matval  = -1
	if (another_matref(1, matid - 100000) != 0) {
		matval = -1
		matneed = 40 + another_matref(0, matid - 100000), another_matref(1, matid - 100000)
		return 1
	}
	return -1

// 異世界CNPC製造
*label_0521_cnpc
	matneed = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
	matval  = -1
	if (usernpcmatval(1, matid - 1000000) != 0) {
		matval = usernpcmatval(0, matid - 1000000), usernpcmatval(1, matid - 1000000), usernpcmatval(2, matid - 1000000), usernpcmatval(3, matid - 1000000), usernpcmatval(4, matid - 1000000)
		matneed = usernpcmatneed(0, matid - 1000000), usernpcmatneed(1, matid - 1000000), usernpcmatneed(2, matid - 1000000), usernpcmatneed(3, matid - 1000000), usernpcmatneed(4, matid - 1000000), usernpcmatneed(5, matid - 1000000), usernpcmatneed(6, matid - 1000000), usernpcmatneed(7, matid - 1000000), usernpcmatneed(8, matid - 1000000), usernpcmatneed(9, matid - 1000000), usernpcmatneed(10, matid - 1000000), usernpcmatneed(11, matid - 1000000)
		return 1
	}
	return -1

*label_0521_citem
	matneed = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
	matval  = -1
	if (useritemmatval(1, matid - 2000000) != 0) {
		matval = useritemmatval(0, matid - 2000000), useritemmatval(1, matid - 2000000), useritemmatval(2, matid - 2000000), useritemmatval(3, matid - 2000000), useritemmatval(4, matid - 2000000)
		matneed = useritemmatneed(0, matid - 2000000), useritemmatneed(1, matid - 2000000), useritemmatneed(2, matid - 2000000), useritemmatneed(3, matid - 2000000), useritemmatneed(4, matid - 2000000), useritemmatneed(5, matid - 2000000), useritemmatneed(6, matid - 2000000), useritemmatneed(7, matid - 2000000), useritemmatneed(8, matid - 2000000), useritemmatneed(9, matid - 2000000), useritemmatneed(10, matid - 2000000), useritemmatneed(11, matid - 2000000)
		return 1
	}
	return -1

#defcfunc eleinfo int __hhh, int __iii
	if (__hhh == 50) {
		if (__iii == 0) {
			return 3
		} else {
			return 108
		}
	}
	if (__hhh == 51) {
		if (__iii == 0) {
			return 12
		} else {
			return 106
		}
	}
	if (__hhh == 52) {
		if (__iii == 0) {
			return 5
		} else {
			return 107
		}
	}
	if (__hhh == 59) {
		if (__iii == 0) {
			return 8
		} else {
			return 114
		}
	}
	if (__hhh == 53) {
		if (__iii == 0) {
			return 4
		} else {
			return 115
		}
	}
	if (__hhh == 58) {
		if (__iii == 0) {
			return 9
		} else {
			return 111
		}
	}
	if (__hhh == 57) {
		if (__iii == 0) {
			return 11
		} else {
			return 112
		}
	}
	if (__hhh == 54) {
		if (__iii == 0) {
			return 10
		} else {
			return 113
		}
	}
	if (__hhh == 55) {
		if (__iii == 0) {
			return 2
		} else {
			return 110
		}
	}
	if (__hhh == 56) {
		if (__iii == 0) {
			return 7
		} else {
			return 109
		}
	}
	if (__hhh == 63) {
		if (__iii == 0) {
			return 2
		} else {
			return 110
		}
	}
	return 0



#deffunc characreate int __jjj, int __kkk, int __lll, int __mmm
	characreatehack = -1
	if (__lll == (-3)) {
		cxinit = -1
		cyinit = -1
	} else {
		cxinit = __lll
		cyinit = __mmm
	}
	if (__kkk == 0) {
		dbid = -1
	} else {
		dbid = __kkk
	}
	if (dbid == (-2)) {
		rc = __jjj
		gosub *label_1714
	} else {
		rc = __jjj
		gosub *label_0733
	}
	initlv = 0
	voidlv = 0
	characreatehack = 0
	if (stat == 1) {
		resetfaction rc, 1
		if (rc != 0) {
			if (__lll != (-1)) {
				place_chara rc, cxinit, cyinit
			}
			if (cId(rc) == 260) {
				believegod rc, godno2godid(4)
			}
			if (cId(rc) == 261) {
				believegod rc, godno2godid(7)
			}
			if (cId(rc) == 262) {
				believegod rc, godno2godid(1)
			}
			if (cId(rc) == 263) {
				believegod rc, godno2godid(2)
			}
			if (cId(rc) == 264) {
				believegod rc, godno2godid(3)
			}
			if (cId(rc) == 265) {
				believegod rc, godno2godid(5)
			}
			if (cId(rc) == 266) {
				believegod rc, godno2godid(6)
			}
			if (cId(rc) == 306) {
				believegod rc, godno2godid(2)
			}
			if (cId(rc) == 331) {
				believegod rc, godno2godid(4)
			}
			if (cId(rc) == 336) {
				believegod rc, godno2godid(0)
				cbitmod 990, rc, 1
			}
			if (cId(rc) == 338) {
				believegod rc, godno2godid(5)
			}
			if (cId(rc) == 339) {
				believegod rc, godno2godid(7)
			}
			if (cId(rc) == 342) {
				believegod rc, godno2godid(1)
			}
			if (cId(rc) == 347) {
				believegod rc, godno2godid(6)
			}
			if (cId(rc) == 348) {
				believegod rc, godno2godid(6)
			}
			if (cId(rc) == 366) {
				believegod rc, godno2godid(6)
			}
			if (cId(rc) == 367) {
				believegod rc, godno2godid(3)
			}
			if (cId(rc) == 343 & cCnpcId(rc) < usernpcmax) {
				if (userdatan2(3, cCnpcId(rc)) != "") {
					believegod rc, userdatan2(3, cCnpcId(rc))
					if (userdatan2(3, cCnpcId(rc)) == "eyth") {
						cbitmod 990, rc, 1
					}
				} else {
					repeat usergodmax
						if (cCnpcId(rc) == findunid(cgodServantId(cnt)) - 1) {
							believegod rc, cgodShortId(cnt)
							break
						}
						if (cCnpcId(rc) == findunid(cgodGodNpcId(cnt)) - 1) {
							believegod rc, cgodShortId(cnt)
							break
						}
					loop
				}
			}
		}
		if (rc == 56) {
			cState(rc) = 0
			modnpcmemory 1, rc, -1
			nc_skipflag = 0
			return 1
		}
	} else {
		rc = 56
		nc_skipflag = 0
		return 0
	}
	nc_skipflag = 0
	return 1



#defcfunc relationbetween int __nnn, int __ooo
	if (__nnn == 0 | petcheck(__nnn)) {
		if (__ooo == 0 | petcheck(__ooo)) {
			return 10
		}
	}
	if (ocdata(155, __nnn)) {
		if (ocdata(150, __nnn) - 1 == __ooo) {
			if (cHate(__nnn) > 0) {
				return -3
			}
		}
	}
	if (cRole(__nnn) == 14) {
		if (cKarma(__ooo) < (-30)) {
			if (cbit(16, __ooo) == 0) {
				return -3
			}
		}
	}
	if (__nnn == 0 | petcheck(__nnn)) {
		if (cOriginalRelationship(__nnn) == cRelationship(__ooo)) {
			return 10
		}
	} else {
		if (cOriginalRelationship(__nnn) == cOriginalRelationship(__ooo)) {
			return 10
		}
	}
	if (cOriginalRelationship(__nnn) <= (-3)) {
		if (ocbit(14, __nnn)) {
			return 10
		}
		if (cRelationship(__ooo) > (-3)) {
			return -3
		}
	} else {
		if (__nnn == 0 | petcheck(__nnn)) {
			return cRelationship(__ooo)
		} else {
			if (__ooo == 0 | petcheck(__ooo)) {
				return cRelationship(__nnn)
			} else {
				if (cOriginalRelationship(__ooo) <= (-3)) {
					return -3
				}
			}
		}
	}
	return 0



#defcfunc calcage int __ppp
	if (gYear - cBirthYear(__ppp) < 0) {
		return lang("不明", "Unknown")
	}
	return gYear - cBirthYear(__ppp)



#deffunc rowactend int __qqq
	if (cContinuousActionId(__qqq) != 20002) {
		cContinuousActionId(__qqq) = 0
		cContinuousActionTurn(__qqq) = 0
		cContinuousActionItem(__qqq) = 0
	}
	return



#defcfunc findchara int __ttt, int __uuu, int __vvv
	p@m117 = 0
	repeat 188, 57
		dup roopbuf, cState(cnt)
		dup roopbuf1, cRole(cnt)
		dup roopbuf2, cId(cnt)
		if (roopbuf != 1) {
			if (roopbuf != 2 | __vvv != 0) {
				continue
			}
		}
		if (roopbuf1 == 10001 | roopbuf1 == 10018 | eqfaction(cnt, "petshop")) {
			continue
		}
		if (roopbuf2 == __ttt) {
			if (__uuu != 0 & cQuality(cnt) != __uuu) {
				continue
			}
			p@m117 = cnt
			break
		}
	loop
	return p@m117



#defcfunc findally int __www
	p@m117 = -1
	repeat 16
		if (cState(cnt) != 1) {
			continue
		}
		if (cId(cnt) == __www) {
			p@m117 = cnt
			break
		}
	loop
	return p@m117



#defcfunc implevel int __xxx
	if (__xxx < 10) {
		return 0
	}
	if (__xxx < 25) {
		return 1
	}
	if (__xxx < 50 - 10) {
		return 2
	}
	if (__xxx < 75) {
		return 3
	}
	if (__xxx < 100) {
		return 4
	}
	if (__xxx < 150) {
		return 5
	}
	if (__xxx < 200) {
		return 6
	}
	if (__xxx < 300) {
		return 7
	}
	return 8



#deffunc modimp int __yyy, int __zzz
	p@m118 = implevel(cImpression(__yyy))
	if (__zzz < 0) {
		i@m118 = __zzz
	} else {
		i@m118 = __zzz * 100 / (50 + p@m118 * p@m118 * p@m118)
		if (i@m118 == 0) {
			if (p@m118 < rnd(10)) {
				i@m118 = 1
			}
		}
	}
	cImpression(__yyy) += i@m118
	p@m118(1) = implevel(cImpression(__yyy))
	if (p@m118 > p@m118(1)) {
		txtef 8
		txt -1, lang(cdatan(0, __yyy) + "との関係が<" + _impression(p@m118(1)) + ">になった…", "Your relation with " + cdatan(0, __yyy) + " becomes <" + _impression(p@m118(1)) + ">...")
		return
	}
	if (p@m118(1) > p@m118) {
		if (cRelationship(__yyy) != (-3)) {
			txtef 2
			txt -1, lang(cdatan(0, __yyy) + "との関係が<" + _impression(p@m118(1)) + ">になった！", "Your relation with " + cdatan(0, __yyy) + " becomes <" + _impression(p@m118(1)) + ">!")
		}
		return
	}
	return



#deffunc put_questtarget
	repeat 188, 57
		if (cState(cnt) == 1) {
			cbitmod 970, cnt, 1
			cRelationship(cnt) = -3
		}
	loop
	return



#defcfunc exist_questtarget
	f@m119 = 0
	repeat 188, 57
		if (cState(cnt) == 1) {
			if (cbit(970, cnt) == 1) {
				f@m119++
			}
		}
	loop
	return f@m119

#defcfunc exist_questtarget_ex
	f@m119 = 0
	repeat 188, 57
		if (cOriginalRelationship(cnt) == 10) {
			continue
		}
		if (cState(cnt) == 1) {
			f@m119++
		}
	loop
	return f@m119

#deffunc check_quest
	if (gCurrentMap == 5) {
		if (gCurrentDungeonLevel == 3) {
			if (exist_questtarget() == 0) {
				if (gdata(250 + 200) < 2) {
					gdata(250 + 200) = 2
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
		if (gCurrentDungeonLevel == 4) {
			if (exist_questtarget() == 0) {
				if (gdata(250 + 201) < 2) {
					gdata(250 + 201) = 2
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
		if (gCurrentDungeonLevel == 5) {
			if (exist_questtarget() == 0) {
				if (gdata(250 + 202) < 3) {
					gdata(250 + 202) = 3
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
	}
	if (gCurrentMap == 12) {
		if (gCurrentDungeonLevel == 3) {
			if (exist_questtarget() == 0) {
				if (gdata(250 + 206) < 2) {
					gdata(250 + 206) = 2
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
		if (gCurrentDungeonLevel == 4) {
			if (exist_questtarget() == 0) {
				if (gdata(250 + 207) < 3) {
					gdata(250 + 207) = 3
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
	}
	if (gCurrentMap == 36) {
		if (gCurrentDungeonLevel == 20) {
			if (exist_questtarget() == 0) {
				if (gdata(250 + 215) < 2) {
					gdata(250 + 215) = 2
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
	}
	if (areaId(gCurrentMap) == 39) {
		if (gCurrentDungeonLevel == 0) {
			if (exist_questtarget() == 0) {
				music = 74
				musicloop = 1
				gdata(73) = 3
				gosub *label_0122
				if (ogdata(200) < 5) {
					ogdata(200) = 5
					txtef 2
					txt -1, lang("エイリアンを全滅させた。戻ってメイド長に報告しよう。", "All aliens have been exterminated. Let's report back to the maid.")
				}
			} else {
				txtef 4
				txt -1, lang("[殲滅対象]残り" + exist_questtarget() + "体" + "] ", "" + exist_questtarget() + " more to go.")
			}
		}
	}
	if (gCurrentMap == 50) {
		if (gCurrentDungeonLevel == 5) {
			if (exist_questtarget_ex() == 0) {
				if (ncgdata(153) < 11) {
					ncgdata(153) = 11
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
	}
	if (ogdata(24) == 1 & gdata(73) != 3) {
		if (exist_escorttarget(166) == 0) {
			gosub *label_1666
		} else {
			if (exist_questtarget() == 0) {
				gdata(73) = 2
				evadd 103
			} else {
				txtef 4
				txt -1, lang("[殲滅対象]残り" + exist_questtarget() + "体" + "] ", "" + exist_questtarget() + " more to go.")
			}
		}
	}
	if (ogdata(28)) {
		if (findchara(210, 6, 1) == 0) {
			ogdata(28) = 0
		}
	}
	if (ogdata(24) == 2) {
		if (findchara(263, 6, 1) == 0) {
			ogdata(24) = 0
			gdata(73) = 3
			gExecutingImmediateQuestType = 0
			ogdata(60) = 0
		}
	}
	if (gExecutingImmediateQuestType == 0) {
		return
	}
	if (gdata(73) != 3) {
		if (gdata(71) == 1 | ogdata(24) == 2) {
			p@m119 = 0
			repeat 188, 57
				if (cState(cnt) == 1) {
					if (cRelationship(cnt) == (-3)) {
						p@m119++
					}
				}
			loop
			if (areaId(gCurrentMap) == 6) {
				repeat 40 - 1, 16
					if (cState(cnt) == 1) {
						if (ocdata(100, cnt) == 20000) {
							p@m119++
						}
					}
				loop
			}
			if (p@m119 == 0) {
				if (ogdata(24) == 2) {
					gdata(73) = 2
					evadd 110
				} else {
					evadd 8
				}
			} else {
				txtef 4
				txt -1, lang("[殲滅依頼]残り" + p@m119 + "体" + "] ", "" + p@m119 + " more to go.")
			}
		}
		if (gExecutingImmediateQuestType == 1008) {
			if (findchara(qdata(12, gExecutingImmediateQuest), qdata(16, gExecutingImmediateQuest)) == 0) {
				evadd 8
			}
		}
		if (gExecutingImmediateQuestType == 1021) {
			if (gLeftMinutesOfExecutingQuest > 0) {
				qdata(12, gExecutingImmediateQuest) = 0
				qdata(13, gExecutingImmediateQuest) = 0
				repeat 188, 57
					if (cState(cnt) == 1) {
						if (eqfaction(cnt, "nc_sheep")) {
							qdata(12, gExecutingImmediateQuest)++
						} else {
							qdata(13, gExecutingImmediateQuest)++
						}
					}
				loop
			}
			if (qdata(13, gExecutingImmediateQuest) > 0) {
				txtef 4
				txt -1, lang("[防衛依頼]残り" + qdata(13, gExecutingImmediateQuest) + "体" + "] ", "" + qdata(13, gExecutingImmediateQuest) + " more to go.")
			}
			if (rnd(3) == 0) {

			}
			if (gLeftMinutesOfExecutingQuest > 0 & qdata(12, gExecutingImmediateQuest) == 0) {
				gLeftMinutesOfExecutingQuest = 0
				evadd 14
			}
			if (gLeftMinutesOfExecutingQuest > 0 & qdata(13, gExecutingImmediateQuest) == 0 & qdata(12, gExecutingImmediateQuest) > 0) {
				gLeftMinutesOfExecutingQuest = 0
				evadd 8
			}
		}
	}
	return



#deffunc refreshspeed int __aaa
	if (cSpeedCorrectionValue(__aaa) == 0) {
		cCurrentSpeed(__aaa) = sdata(18, __aaa)
	} else {
		cCurrentSpeed(__aaa) = limitmax(sdata(18, __aaa) * limit(100 - cSpeedCorrectionValue(__aaa), 0, 100) / 100, 2147483647)
	}
	if (__aaa == 0) {
		if (gettrait(__aaa, 97)) {
			p(36) = stat
			f@m157 = pethealthcheck()
			if (f@m157) {
				cCurrentSpeed(__aaa) += calc5traitmulti(p(36), cCurrentSpeed(__aaa))
			}
		}
	}
	if (cHp(__aaa) >= cMaxHp(__aaa) * 9 / 10) {
		if (nc_gettrait(__aaa, 115) > 0) {
			cCurrentSpeed(__aaa) = cCurrentSpeed(__aaa) / 2 * 3
		}
	}
	if (cHp(__aaa) <= cMaxHp(__aaa) * 3 / 10) {
		if (nc_gettrait(__aaa, 116) > 0) {
			cCurrentSpeed(__aaa) *= 2
		}
	}
	if (cCurrentSpeed(__aaa) < 10) {
		cCurrentSpeed(__aaa) = 10
	}
	if (ocbit(12, __aaa)) {
		if (findbuff(__aaa, 97) != (-1)) {
			cCurrentSpeed(__aaa) += limitmax(limitmax(ocdata(192 + findbuff(__aaa, 97) * 3 + 1, __aaa) / 50, 2000), 2147483647)
		}
		if (eqfaction(__aaa, "aqua")) {
			cCurrentSpeed(__aaa) = limitmax(cCurrentSpeed(__aaa) * 3, 2147483647)
		}
	}
	// Nightmare
	if (nc_intb_nightmare) {
		if (__aaa > 15) {
			if (cRelationship(__aaa) == (-3)) {
				cCurrentSpeed(__aaa) = limitmax(cCurrentSpeed(__aaa) * 2, 2147483647)
			}
		}
	}
	cSpeedPercentageInNextTurn(__aaa) = 0
	ridetarget = 0
	rider = 0
	if (__aaa == 0 | (gMount != 0 & gMount == __aaa)) {
		ridetarget = gMount
	} else {
		if (gCurrentMap == 49) {
			if (eqfaction(__aaa, "horse")) {
				if (cSp(__aaa) <= cMaxSp(__aaa) / 2) {
					cCurrentSpeed(__aaa) = ((cCurrentSpeed(__aaa) / 4 * 3) + limitmax(sdata(__aaa, 11) / 15, 500)) * horse_spcons(__aaa)
				}
				if (cSp(__aaa) <= cMaxSp(__aaa) / 4) {
					cCurrentSpeed(__aaa) = ((cCurrentSpeed(__aaa) / 2) + limitmax(sdata(__aaa, 11) / 15, 300)) * horse_spcons(__aaa)
				}
				if (cSp(__aaa) <= cMaxSp(__aaa) / 20) {
					cCurrentSpeed(__aaa) = (10 + limitmax(sdata(__aaa, 11) / 15, 100)) * horse_spcons(__aaa)
					if (cCurrentSpeed(__aaa) < 10) {
						cCurrentSpeed(__aaa) = 10
					}
				}
			}
			if (cCurrentSpeed(__aaa) > 20000) {
				cCurrentSpeed(__aaa) = 20000
			}
			return
		}
		if (ocdata(107, __aaa) != 0) {
			rider = ocdata(107, __aaa)
			ridetarget = __aaa
		} else {
			if (ocdata(106, __aaa) != 0) {
				rider = __aaa
				ridetarget = ocdata(106, __aaa)
			} else {
				return
			}
		}
	}
	if (gCurrentMap == 49) {
		if (__aaa == 0) {
			if (cCurrentSpeed(__aaa) > limitmax(((100 - gdata(129) / 100) + 1) * 10, 1000)) {
				cCurrentSpeed(__aaa) = limitmax(((100 - gdata(129) / 100) + 1) * 10, 1000)
				return
			}
		}
	}
	if (ridetarget != 0) {
		cCurrentSpeed(rider) = limitmax(sdata(18, ridetarget) * limit(100 - cSpeedCorrectionValue(ridetarget), 0, 100) / 100 * 100 / limit(100 + sdata(18, ridetarget) * limit(100 - cSpeedCorrectionValue(ridetarget), 0, 100) / 100 - sdata(10, ridetarget) * 3 / 2 - sdata(301, rider) * 2 - (cbit(22, ridetarget) == 1) * 50, 100, 1000), 2147483647)
		if (rider != 0) {
			if (cCurrentSpeed(0) < cCurrentSpeed(rider)) {
				cCurrentSpeed(rider) = cCurrentSpeed(0)
			}
		}
		if (cbit(25, ridetarget)) {
			cCurrentSpeed(rider) /= 10
		}
		if (ridetarget == __aaa) {
			cCurrentSpeed(__aaa) = limit(sdata(10, __aaa) + sdata(301, rider), 10, sdata(18, __aaa))
			return
		}
	}
	gspdorg = sorgEx(18, 0)
	if (gMount == 0) {
		r@m120 = cNutrition(0) / 1000 * 1000
		if (r@m120 < 1000) {
			cSpeedPercentageInNextTurn(0) -= 30
		}
		if (r@m120 < 2000) {
			cSpeedPercentageInNextTurn(0) -= 10
		}
		if (cSp(0) < 0) {
			cSpeedPercentageInNextTurn(0) -= 30
		}
		if (cSp(0) < 25) {
			cSpeedPercentageInNextTurn(0) -= 20
		}
		if (cSp(0) < 50) {
			cSpeedPercentageInNextTurn(0) -= 10
		}
	}
	if (cInventoryWeightType(0) >= 3) {
		cSpeedPercentageInNextTurn(0) -= 50
	}
	if (cInventoryWeightType(0) == 2) {
		cSpeedPercentageInNextTurn(0) -= 30
	}
	if (cInventoryWeightType(0) == 1) {
		cSpeedPercentageInNextTurn(0) -= 10
	}
	if (mapType == 1 | mapType == 4) {
		if (godcheck() == "serria") {
			if (gCargoWeight > gCurrentCartLimit * 3) {
				cSpeedPercentageInNextTurn(0) -= 25 + 25 * (gCargoWeight / (gCurrentCartLimit * 3 + 1))
			} else {
				if (gCargoWeight * 3 / 2 > gCurrentCartLimit * 3) {
					cSpeedPercentageInNextTurn(0) -= 25 + 15 * (gCargoWeight * 2 / (gCurrentCartLimit * 3 + 1))
				} else {
					if (gCargoWeight * 2 > gCurrentCartLimit * 3) {
						cSpeedPercentageInNextTurn(0) -= 25 + 5 * (gCargoWeight * 3 / (gCurrentCartLimit * 3 + 1))
					}
				}
			}
		} else {
			if (gCargoWeight > gCurrentCartLimit) {
				cSpeedPercentageInNextTurn(0) -= 25 + 25 * (gCargoWeight / (gCurrentCartLimit + 1))
			} else {
				if (gCargoWeight * 3 / 2 > gCurrentCartLimit) {
					cSpeedPercentageInNextTurn(0) -= 25 + 15 * (gCargoWeight * 2 / (gCurrentCartLimit + 1))
				} else {
					if (gCargoWeight * 2 > gCurrentCartLimit) {
						cSpeedPercentageInNextTurn(0) -= 25 + 5 * (gCargoWeight * 3 / (gCurrentCartLimit + 1))
					}
				}
			}
		}
	}
	gspd = cCurrentSpeed(0) * (100 + cSpeedPercentage(0)) / 100
	if (gspd < 10) {
		gspd = 10
	}
	return



#deffunc ride_begin int __bbb, int __ccc
	if (__ccc == 0) {
		txt -1, lang(name(__bbb) + "に騎乗した(" + name(__bbb) + "の速度: " + cCurrentSpeed(__bbb) + "→", "You ride " + name(__bbb) + ". (" + name(__bbb) + "'s speed: " + cCurrentSpeed(__bbb) + "->")
	}
	cbitmod 975, __bbb, 1
	map(cX(__bbb), cY(__bbb), 1) = 0
	if (__ccc == 0) {
		gMount = __bbb
		create_pcpic 0, 1
		rowactend gMount
		refreshspeed gMount
		txt -1, "" + cCurrentSpeed(__bbb) + ") "
		if (cbit(22, gMount)) {
			txt -1, lang("この生物は乗馬用にちょうどいい！", "You feel comfortable.")
		}
		if (cbit(25, gMount)) {
			txt -1, lang("この生物はあなたを乗せるには非力すぎる。", "This creature is too weak to carry you.")
		}
	} else {
		ocdata(106, __ccc) = __bbb
		ocdata(107, __bbb) = __ccc
		if (cbit(967, __ccc) == 1) {
			create_pcpic __ccc, 1
		}
		rowactend __bbb
		refreshspeed __bbb
	}
	return



#deffunc ride_end int __ddd
	if (__ddd == 0) {
		cbitmod 975, gMount, 0
		rowactend gMount
		p@m121 = gMount
		gMount = 0
		create_pcpic 0, 1
	} else {
		cbitmod 975, ocdata(106, __ddd), 0
		ocdata(107, ocdata(106, __ddd)) = 0
		rowactend ocdata(106, __ddd)
		p@m121 = ocdata(106, __ddd)
		ocdata(106, __ddd) = 0
		if (cbit(967, __ddd) == 1) {
			create_pcpic __ddd, 1
		}
		refreshspeed __ddd
	}
	refreshspeed p@m121
	return



#deffunc chara_vanquish int __eee
	if (__eee == gMount) {
		ride_end
	} else {
		if (ocdata(107, __eee) != 0) {
			ride_end ocdata(107, __eee)
		} else {
			if (cState(__eee) == 1 | cState(__eee) == 10) {
				map(cX(__eee), cY(__eee), 1) = 0
			}
		}
	}
	cState(__eee) = 0
	cRole(__eee) = 0
	if (cShopStoreId(__eee) != 0) {
		zaiko = exedir + "tmp\\shop" + cShopStoreId(__eee) + ".s2"
		tmpload "shop" + cShopStoreId(__eee) + ".s2"
		exist zaiko
		if (strsize != (-1)) {
			delete zaiko
			fileadd zaiko, 1
		}
		cShopStoreId(__eee) = 0
	}
	if (__eee >= 57) {
		addcrowd gCrowdDensity, -1
	}
	check_quest
	return



#deffunc turn_aggro int __fff, int __ggg, int __hhh
	if (__ggg == 0 | petcheck(__ggg)) {
		cRelationship(__fff) = -3
	}
	cHate(__fff) = __hhh
	cEmotionIcon(__fff) = 18 + 100 * 2
	lockon __fff, __ggg, 1
	return



#deffunc make_sound int __iii, int __jjj, int __kkk, int __lll, int __mmm, int __nnn
	repeat 245 - 1, 1
		if (cState(cnt) != 1) {
			continue
		}
		if (dist(__iii, __jjj, cX(cnt), cY(cnt)) < __kkk) {
			if (rnd(__lll) == 0) {
				if (cSleep(cnt) != 0) {
					cSleep(cnt) = 0
					if (synccheck(cnt, -1)) {
						txt -1, lang(name(cnt) + "は物音に気付き目を覚ました。", name(cnt) + " notice" + _s(cnt) + " the sound and wake" + _s(cnt) + " up.")
					}
					cEmotionIcon(cnt) = 21 + 100 * 2
					if (__mmm) {
						if (rnd(500) == 0) {
							if (synccheck(cnt, -1)) {
								txtef 9
								txt -1, lang(name(cnt) + "はキレた。", name(cnt) + " can no longer put up with it.")
								txt cnt, lang("「もう我慢できない」", cnvtalk("That's it."))
							}
							turn_aggro cnt, __nnn, 80
						}
					}
				}
			}
		}
	loop
	return



#defcfunc get_freechara
	f@m125 = -1
	repeat 188, 57
		if (cState(cnt) == 0) {
			f@m125 = cnt
			break
		}
	loop
	return f@m125



#defcfunc get_freeally
	f@m125 = 0
	repeat limit(sdata(17, 0) / 5 + 1, 2, 16 - 1), 1
		if (cState(cnt) != 0) {
			continue
		}
		f@m125 = cnt
		break
	loop
	return f@m125



#deffunc del_chara int __ooo
	inv_getheader __ooo
	repeat invrange, invhead
		iNumber(cnt) = 0
	loop
	repeat 10
		cdatan(cnt, __ooo) = ""
	loop
	memset ocdata(0, __ooo), 0, 1000
	memset sdata(0, __ooo), 0, 4800
	memset sdataEx(0, __ooo), 0, 2400
	memset cState(__ooo), 0, 2000
	// AI削除
	if (__ooo < 16) {
		resetcai __ooo
	}
	faction(__ooo) = ""
	return



#deffunc relocate_chara int __ppp, int __qqq, int __rrr
	tc@m125 = __qqq
	if (__ppp == gMount) {
		ride_end
		cX(__ppp) = cX(0)
		cY(__ppp) = cY(0)
	} else {
		if (ocdata(107, __ppp) != 0) {
			p@m125 = ocdata(107, __ppp)
			ride_end p@m125
			cX(__ppp) = cX(p@m125)
			cY(__ppp) = cY(p@m125)
		}
	}
	if (tc@m125 == (-1)) {
		f@m125 = 0
		repeat 188, 57
			if (cState(cnt) == 0) {
				f@m125 = 1
				tc@m125 = cnt
				break
			}
		loop
		if (f@m125 == 0) {
			repeat
				tc@m125 = 57 + rnd(245 - 57)
				if (cState(cnt) == 1) {
					if (cRole(cnt) == 0) {
						break
					}
				}
			loop
			chara_vanquish tc@m125
		}
	}
	if (__rrr == 1) {
		x@m125 = cX(tc@m125)
		y@m125 = cY(tc@m125)
	}
	p1@m125 = cRelationship(tc@m125)
	p2@m125 = cHate(tc@m125)
	p3@m125 = cState(tc@m125)
	hp@m125 = cHp(tc@m125)
	cItemWhichWillBeUsed(__ppp) = 0
	cbitmod 960, __ppp, 0
	inv_getheader __ppp
	p@m125 = invhead
	invrangecc@m125 = invrange
	inv_getheader tc@m125
	repeat invrange, invhead
		cnt2@m125 = cnt
		if (cnt == invrangecc@m125) {
			break
		}
		if (cc == __ppp) {
			if (ci == p@m125) {
				ci = cnt2@m125
			}
		}
		repeat 70
			inv(cnt, cnt2@m125) = inv(cnt, p@m125)
			inv(cnt, p@m125) = 0
		loop
		iBodyPart(cnt) = 0
		p@m125++
	loop
	repeat 1200
		sdata(cnt, tc@m125) = sdata(cnt, __ppp)
		sdata(cnt, __ppp) = 0
	loop
	repeat 500
		cdata(cnt, tc@m125) = cdata(cnt, __ppp)
		cdata(cnt, __ppp) = 0
	loop
	repeat 10
		cdatan(cnt, tc@m125) = cdatan(cnt, __ppp)
		cdatan(cnt, __ppp) = ""
	loop
	repeat 30, 100
		cdata(cnt, tc@m125) = cdata(cnt, tc@m125) / 10000 * 10000
	loop
	repeat 250
		ocdata(cnt, tc@m125) = ocdata(cnt, __ppp)
		ocdata(cnt, __ppp) = 0
	loop
	repeat 600
		sdataEx(cnt, tc@m125) = sdataEx(cnt, __ppp)
		sdataEx(cnt, __ppp) = 0
	loop
	faction(tc@m125) = faction(__ppp)
	faction(__ppp) = ""
	if (__rrr == 1) {
		cState(tc@m125) = 1
		cX(tc@m125) = x@m125
		cY(tc@m125) = y@m125
		cRelationship(tc@m125) = p1@m125
		cHate(tc@m125) = p2@m125
		cHp(tc@m125) = hp@m125
		cState(tc@m125) = p3@m125
		map(cX(tc@m125), cY(tc@m125), 1) = tc@m125 + 1
	} else {
		if (__ppp != 56) {
			map(cX(tc@m125), cY(tc@m125), 1) = tc@m125 + 1
		} else {
			rc = tc@m125
			cState(tc@m125) = 1
			if (__rrr == (-3)) {
				cxinit = -1
				cyinit = -1
			} else {
				cxinit = cX(0)
				cyinit = cY(0)
			}
			place_chara rc, cxinit, cyinit
		}
		unlockson tc@m125
		cHate(tc@m125) = 0
	}
	if (petcheck(tc@m125)) {
		repeat 61 - 50, 50
			p@m125 = 100
			if (sorg(cnt, tc@m125) >= 500 | sorg(cnt, tc@m125) <= 100) {
				p@m125 = sorg(cnt, tc@m125)
			}
			if (p@m125 > 500) {
				p@m125 = 500
			}
			sdata(cnt + 600, tc@m125) = p@m125 * 1000000
		loop
		// AI削除
		if (tc@m125 < 16) {
			resetcai tc@m125
		}
	}
	rc = tc@m125
	gosub *label_1539
	r1 = tc@m125
	gosub *chara_refresh
	if (__ppp >= 57 & tc@m125 <= 56) {
		addcrowd gCrowdDensity, -1
	}
	if (__ppp <= 56 & tc@m125 >= 57) {
		addcrowd gCrowdDensity, 1
	}
	return __ppp



#deffunc hostileaction int __sss, int __ttt
	if (__sss >= 16 & cRole(__sss) != 10001 & cRole(__sss) != 10018 & eqfaction(__sss, "petshop") == 0 | __ttt == 0) {
		return
	}
	if (cRelationship(__ttt) != (-3)) {
		cEmotionIcon(__ttt) = 18 + 100 * 4
	}
	if (cRelationship(__ttt) == 10) {
		if (weaponenc == 0) {
			txtef 8
			txt -1, lang(name(__ttt) + "は嫌な顔をした。", name(__ttt) + " glares at you.")
			ctalk __ttt, 1258, __sss, __ttt
		}
	} else {
		if (cRelationship(__ttt) == 0) {
			modkarma 0, -2
		}
		if (cId(__ttt) == 202) {
			if (gdata(250 + 8) == 0) {
				txtef 8
				txt -1, lang(name(__ttt) + "は嫌な顔をした。", name(__ttt) + " glares at you.")
				ctalk __ttt, 1258, __sss, __ttt
				return
			}
		}
		if (cRelationship(__ttt) > (-2)) {
			txtef 8
			txt -1, lang(name(__ttt) + "は嫌な顔をした。", name(__ttt) + " glares at you.")
			ctalk __ttt, 1258, __sss, __ttt
			cRelationship(__ttt) = -2
		} else {
			if (cRelationship(__ttt) != (-3)) {
				txtef 8
				txt -1, lang(name(__ttt) + "は激怒した。", name(__ttt) + " gets furious!")
			}
			cRelationship(__ttt) = -3
			cHate(__ttt) = 80
			lockon __ttt, __sss, 2
		}
		if (cbit(985, __ttt) == 0) {
			txtef 9
			ctalk __ttt, 101, __ttt, __sss
		}
	}
	if (cbit(960, __ttt) == 1) {
		if (rnd(50) == 0) {
			txtef 3
			txt -1, lang("家畜は興奮した！", "Animals get excited!")
			repeat 245
				if (cbit(960, cnt) == 1) {
					lockon cnt, 0, 3
					cHate(cnt) = 20
					cEmotionIcon(cnt) = 18 + 100 * 3
				}
			loop
		}
	}
	rowactend __ttt
	return



#deffunc rowact_check int __uuu
	if (cNullifyDamage(__uuu) < 100) {
		if (cContinuousActionId(__uuu) != 0) {
			if (cContinuousActionId(__uuu) != 3) {
				cStopsContinuousAction(__uuu) = 1
			}
		}
	}
	return



#deffunc rowact_item int __vvv
	repeat 245
		if (cState(cnt) != 1) {
			continue
		}
		if (cContinuousActionTurn(cnt) <= 0) {
			continue
		}
		if (cContinuousActionId(cnt) == 1 | cContinuousActionId(cnt) == 2) {
			if (cContinuousActionItem(cnt) == __vvv) {
				rowactend cnt
				txt -1, lang(name(cnt) + "は行動を中断した。", name(cnt) + " cancel" + _s(cnt) + " " + his(cnt) + " action.")
			}
		}
	loop
	return



#deffunc wake_up
	if (gHour >= 7 & gHour <= 22) {
		repeat 188, 57
			if (cSleep(cnt) > 0) {
				if (rnd(10)) {
					cSleep(cnt) = 0
				}
			}
		loop
	}
	return



#deffunc incognitobegin
	repeat 229, 16
		if (cState(cnt) != 1) {
			continue
		}
		if (cRole(cnt) == 1010) {
			continue
		}
		if (cRole(cnt) == 16) {
			continue
		}
		if (cOriginalRelationship(cnt) >= (-2)) {
			if (cRelationship(cnt) <= (-2)) {
				cHate(cnt) = 0
				cRelationship(cnt) = cOriginalRelationship(cnt)
				cEmotionIcon(cnt) = 21 + 100 * 2
			}
		}
	loop
	return



#deffunc incognitoend
	repeat 229, 16
		if (cState(cnt) != 1) {
			continue
		}
		if (cRole(cnt) == 14) {
			if (cKarma(0) < (-30)) {
				cRelationship(cnt) = -3
				cHate(cnt) = 80
				cEmotionIcon(cnt) = 18 + 100 * 2
			}
		}
	loop
	return



#deffunc cell_setchara int __www, int __xxx, int __yyy
	map(__xxx, __yyy, 1) = __www + 1
	cX(__www) = __xxx
	cY(__www) = __yyy
	return



#deffunc cell_removechara int __zzz, int __aaa
	map(__zzz, __aaa, 1) = 0
	return



#deffunc cell_findspace int __bbb, int __ccc, int __ddd
	f@m130 = 0
	repeat __ddd * 2 + 1
		dy@m130 = __ccc + cnt - 1
		if (dy@m130 < 0 | dy@m130 >= mapHeight) {
			continue
		}
		repeat __ddd * 2 + 1
			dx@m130 = __bbb + cnt - 1
			if (dx@m130 < 0 | dx@m130 >= mapWidth) {
				continue
			}
			if (map(dx@m130, dy@m130, 1) != 0) {
				continue
			}
			if (chipm(7, map(dx@m130, dy@m130, 0)) & 4) {
				continue
			}
			if (chipm(7, map(dx@m130, dy@m130, 6) \ 1000) & 4) {
				continue
			}
			rtval = dx@m130, dy@m130
			f@m130 = 1
		loop
		if (f@m130) {
			break
		}
	loop
	return f@m130



#defcfunc findbuff int __eee, int __fff
	f@m131 = -1
	repeat 8 + 8
		if (ocdata(192 + cnt * 3, __eee) == 0) {
			break
		}
		if (ocdata(192 + cnt * 3, __eee) == __fff) {
			f@m131 = cnt
			break
		}
	loop
	return f@m131



#deffunc addbuff int __ggg, int __hhh, int __iii, int __jjj, int __kkk
	if (__jjj <= 0) {
		return 0
	}
	if (__hhh == 86) {
		if (gLeftTurnsOfTimestop == 0) {
			ctalk cc, 1285, cc, cc
			txtef 9
			txt -1, lang(name(__ggg) + "は時を止めた。", name(__ggg) + " stop" + _s(cc) + " time.")
			gLeftTurnsOfTimestop = __jjj
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			return
		}
	} else {
		if (__hhh == 94) {
			cSick(__ggg) = 21 + __jjj
			cBleeding(__ggg) = 11 + __jjj
			cInsane(__ggg) = 41 + __jjj
			return
		}
	}
	p@m132 = -1
	repeat 8 + 8
		if (ocdata(192 + cnt * 3, __ggg) == __hhh) {
			if (ocdata(192 + cnt * 3 + 2, __ggg) < __jjj) {
				p@m132 = cnt
				break
			} else {
				p@m132 = -2
				break
			}
		}
		if (ocdata(192 + cnt * 3, __ggg) == 0) {
			p@m132 = cnt
			break
		}
	loop
	if (p@m132 == (-1)) {
		p@m132 = rnd(8 + 8)
	}
	if (p@m132 == (-2) & __hhh != 65) {
		if (synccheck(__ggg, -1)) {
			txt -1, lang("しかし、効果はなかった。", "But it produces no effect.")
			return 0
		}
	}
	fixeddur@m132 = __jjj
	if (__kkk == 0) {
		if (bdataref(0, __hhh) == 2) {
			f@m132 = 0
			if (sdata(60, __ggg) / 2 > rndex(__iii * 2 + 100)) {
				f@m132 = 1
			}
			if (__iii * 3 < sdata(60, __ggg)) {
				f@m132 = 1
			}
			if (__iii / 3 > sdata(60, __ggg)) {
				f@m132 = 0
			}
			if (cQuality(__ggg) > 3) {
				if (rnd(4)) {
					f@m132 = 1
				} else {
					fixeddur@m132 = __jjj / 5 + 1
				}
				if (f@m132) {
					if (cc != (-1) & __ggg != cc) {
						if (nc_gettrait(cc, 107) > 0) {
							f@m132 = 0
						}
					}
				}
			}
			if (cQuality(__ggg) >= 4) {
				if (__hhh == 16) {
					f@m132 = 1
				}
			}
			if (findbuff(__ggg, 10) != (-1)) {
				if (ocdata(192 + findbuff(__ggg, 10) * 3 + 1, __ggg) + 50 > __iii * 5 / 2 | rnd(ocdata(192 + findbuff(__ggg, 10) * 3 + 1, __ggg) + 50) > rndex(__iii + 1)) {
					txt -1, lang("ホーリーヴェイルが呪いを防いだ。", "The holy veil repels the hex.")
					return
				}
			}
			if (findfaction(__ggg, "regist", "hex")) {
				f@m132 = 1
			}
			if (f@m132 == 1) {
				if (synccheck(__ggg, -1)) {
					txt -1, lang(name(__ggg) + "は抵抗した。", name(__ggg) + " resist" + _s(__ggg) + " the hex.")
				}
				return
			}
			if (cc == 0) {
				hostileaction 0, __ggg
			}
		}
	}
	if (bufftxt(0, __hhh) != "") {
		if (synccheck(__ggg, -1)) {
			if (__hhh >= 29 & __hhh <= 39) {
				ctalk __ggg, 961, __ggg, __ggg
				if (stat == 0) {
					txt -1, lang(name(__ggg) + bufftxt(0, __hhh), name(__ggg) + " " + bufftxt(0, __hhh) + _s(__ggg) + bufftxt(1, __hhh))
				}
			} else {
				txt -1, lang(name(__ggg) + bufftxt(0, __hhh), name(__ggg) + " " + bufftxt(0, __hhh) + _s(__ggg) + bufftxt(1, __hhh))
			}
			if (cfg_dmgmonitor1 == 1) {
				mondmgn(mondmgcnt) = buffname(__hhh)
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 0, 0, 255, 255, 255, __ggg, -1
				if (__hhh == 2 | __hhh == 6 | __hhh == 8 | __hhh == 9 | __hhh == 11 | __hhh == 13 | __hhh == 16) {
					ccolor 100
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 150, 0, 0
					}
				} else {
					if (__hhh >= 29 & __hhh <= 39) {
						i@m66 = __hhh + 21
						ccolor 101
						if (stat == 0) {
							colorres
							mondmg(2, mondmgcnt) = 255, 255, 255, ginfo(16), ginfo(17), ginfo(18)
						}
					} else {
						ccolor 102
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 0, 150, 150
						}
					}
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
	}
	ocdata(192 + p@m132 * 3, __ggg) = __hhh, __iii, fixeddur@m132
	r1 = __ggg
	gosub *chara_refresh
	return



#deffunc delbuff int __lll, int __mmm
	if (ocbit(7, __lll)) {
		if (cRelationship(__lll) == 10 | cOriginalRelationship(__lll) == 10) {
			txt -1, lang(name(__lll) + "は消え去った。", name(__lll) + " vanish" + _s(__lll, 1) + ".")
			chara_vanquish __lll
		}
	} else {
		if (synccheck(__lll, -1)) {
			txtef 8
			txt -1, lang(name(__lll) + "の" + buffname(ocdata(192 + __mmm * 3, __lll)) + "の効果が切れた。", name(__lll) + " " + is(__lll) + " The effect of " + buffname(ocdata(192 + __mmm * 3, __lll)) + " ends.")
			if (cfg_dmgmonitor1 == 1) {
				mondmgn(mondmgcnt) = buffname(ocdata(192 + __mmm * 3, __lll))
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 0, 0, 255, 255, 255, __lll, -1
				if (ocdata(192 + __mmm * 3, __lll) == 2 | ocdata(192 + __mmm * 3, __lll) == 6 | ocdata(192 + __mmm * 3, __lll) == 8 | ocdata(192 + __mmm * 3, __lll) == 9 | ocdata(192 + __mmm * 3, __lll) == 11 | ocdata(192 + __mmm * 3, __lll) == 13 | ocdata(192 + __mmm * 3, __lll) == 16) {
					ccolor 103
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 150, 0
					}
				} else {
					if (ocdata(192 + __mmm * 3, __lll) >= 29 & ocdata(192 + __mmm * 3, __lll) <= 39) {
						i@m66 = ocdata(192 + __mmm * 3, __lll) + 21
						ccolor 112
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 150, 150, 150
						}
					} else {
						ccolor 104
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 150, 150, 150
						}
					}
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
	}
	if (ocdata(192 + __mmm * 3, __lll) == 15) {
		if (__lll == 0) {
			incognitoend
		}
	}
	if (ocdata(192 + __mmm * 3, __lll) == 16) {
		cbitmod 973, __lll, 0
	}
	if (ocdata(192 + __mmm * 3, __lll) == 18) {
		cbitmod 980, __lll, 0
	}
	ocdata(192 + __mmm * 3, __lll) = 0
	repeat 8 + 8 - __mmm - 1, __mmm
		if (ocdata(192 + cnt * 3, __lll) == 0) {
			if (ocdata(192 + (cnt + 1) * 3, __lll) != 0) {
				ocdata(192 + cnt * 3, __lll) = ocdata(192 + (cnt + 1) * 3, __lll), ocdata(192 + (cnt + 1) * 3 + 1, __lll), ocdata(192 + (cnt + 1) * 3 + 2, __lll)
				ocdata(192 + (cnt + 1) * 3, __lll) = 0, 0, 0
			} else {
				break
			}
		}
	loop
	r1 = __lll
	gosub *chara_refresh
	return



// Load and play animation.
// @params __animationType The animation type. graphic\anime{__animationType}.bmp will be loaded.
// @params __cc The target character. The animation is rendered around the character.
// @params __drawLulwy If true, draw Lulu-sama; otherwise, not.
// @return None
#deffunc animeload int __animationType, int __cc, int __drawLulwy
	if (mode != 0) {
		return
	}
	if (synccheck(__cc, -1) == 0) {
		return // You cannot see the character.
	}
	if (oomSEST_noAnimation) {
		return // Animation is disabled.
	}

	// Draw entire screen.
	screenupdate = -1
	gosub *label_0623

	// Load animation graphics.
	gsel 7
	picload_ exedir + "graphic\\anime" + __animationType + ".bmp"

	// (dx, dy) Position where the animation will be rendered.
	dx@m133 = (cX(__cc) - scx) * inf_tiles + inf_screenx
	dy@m133 = (cY(__cc) - scy) * inf_tiles + inf_screeny

	// Preserve the previous screen around the region the animation is rendered.
	gsel 4
	gmode 0
	pos 0, 0
	gcopy 0, dx@m133 - 24, dy@m133 - 146, 96, 202

	// Restore the render target and graphic blending mode.
	gsel 0
	gmode 2

	// i(0) The duration of the animation.
	// i(1) The interval of each frame.
	i@m133 = 5, 50
	// r The angle of images. Zero means no-rotation.
	r@m133 = 0

	// Play the corresponding sound effect and set the animation information.
	if (__animationType == 8) {
		snd 65
	}
	if (__animationType == 10) {
		i@m133 = 8, 30
		r@m133 = 0.2
		snd 119
	}
	if (__animationType == 11) {
		snd 118
	}
	if (__animationType == 14) {
		i@m133 = 6
	}

	repeat i@m133
		gmode 2, 96, 96
		pos dx@m133 + 24, dy@m133 + 8
		grotate 7, cnt * 96, 0, r@m133 * cnt, 96, 96

		if (__drawLulwy) {
			// Draw Lulu-sama.
			color 0, 0, 0
			gmode 4, chipc(2, cChip_lulwy), chipc(3, cChip_lulwy), 128 - cnt * 16
			chara_preparepic cChip_lulwy
			pos dx@m133, dy@m133 - inf_tiles / 2 - chipc(3, cChip_lulwy) - cnt * 2
			gcopy 5, 0, 960
		}

		gmode 0
		redraw 1
		redraw 0
		pos dx@m133 - 24, dy@m133 - 146
		gcopy 4, 0, 0, 96, 202
		await cfg_animewait + i@m133(1)
	loop

	// Restore the graphic blending mode.
	gmode 2
	return



#deffunc animeblood int __ppp, int __qqq, int __rrr
	if (synccheck(__ppp, -1) == 0) {
		return
	}
	if (oomSEST_noAnimation) {
		return
	}
	screenupdate = -1
	gosub *label_0623
	if (__qqq == 0) {
		gsel 1
		color 0
		boxf 0, 960, chipi(2, 16), chipi(3, 16) + 960
		pos 0, 960
		gcopy 1, chipi(0, 16), chipi(1, 16), chipi(2, 16), chipi(3, 16)
		gfini chipi(2, 16), chipi(3, 16)
		gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
		gsel selcur
	}
	if (__qqq == 1) {
		gsel 1
		color 0
		boxf 0, 960, chipi(2, 18), chipi(3, 18) + 960
		pos 0, 960
		gcopy 1, chipi(0, 18), chipi(1, 18), chipi(2, 18), chipi(3, 18)
		gfini chipi(2, 18), chipi(3, 18)
		gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
		gsel selcur
	}
	dx@m133 = (cX(__ppp) - scx) * inf_tiles + inf_screenx
	dy@m133 = (cY(__ppp) - scy) * inf_tiles + inf_screeny, 0
	gsel 4
	gmode 0
	pos 0, 0
	gcopy 0, dx@m133 - 48, dy@m133 - 56, 144, 160
	ele2@m133 = 0
	if (__rrr == 52) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime18.bmp"
		dy@m133(1) = -16
	}
	if (__rrr == 51) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime19.bmp"
		dy@m133(1) = -16
	}
	if (__rrr == 50) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime20.bmp"
		dy@m133(1) = -20
	}
	if (__rrr == 56) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime22.bmp"
		dy@m133(1) = -24
	}
	if (__rrr == 53) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime21.bmp"
		dy@m133(1) = -16
	}
	if (__rrr == 54) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime23.bmp"
		dy@m133(1) = -16
	}
	if (__rrr == 57) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime24.bmp"
		dy@m133(1) = -16
	}
	if (__rrr == 59) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime25.bmp"
		dy@m133(1) = -16
	}
	if (__rrr == 58) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime26.bmp"
		dy@m133(1) = -16
	}
	if (__rrr == 55 | __rrr == 63) {
		ele2@m133 = 1
		gsel 7
		picload_ exedir + "graphic\\anime27.bmp"
		dy@m133(1) = -16
	}
	gmode 2
	gsel 0
	repeat 20
		x@m133(cnt) = rnd(48) - 24
		y@m133(cnt) = rnd(16)
	loop
	repeat 6
		cnt2@m133 = cnt * 2
		gmode 2, inf_tiles, inf_tiles
		if (ele2@m133) {
			pos dx@m133 - 24, dy@m133 - 32 + dy@m133(1)
			gcopy 7, cnt * 96, 0, 96, 96
		}
		repeat 20
			pos dx@m133 + 24 + x@m133(cnt) + (x@m133(cnt) < 3) * ((1 + (cnt \ 2 == 0)) * (-1)) * cnt2@m133 + (x@m133(cnt) > (-4)) * (1 + (cnt \ 2 == 0)) * cnt2@m133, dy@m133 + y@m133(cnt) + cnt2@m133 * cnt2@m133 / 2 - 12 + cnt
			grotate 1, 0, 960, 0.2 * cnt, 24 - cnt2@m133 * 2, 24 - cnt2@m133 * 2
		loop
		gmode 0
		redraw 1
		redraw 0
		pos dx@m133 - 48, dy@m133 - 56
		gcopy 4, 0, 0, 144, 160
		await cfg_animewait + 15 + (ele2@m133 != 0) * 20
	loop
	gmode 2
	return



#deffunc resistmod int __sss, int __ttt, int __uuu
	if (__uuu < 0 & sorg(__ttt, __sss) <= 50) {
		return
	}
	if (__uuu >= 0 & sorg(__ttt, __sss) >= 200) {
		return
	}
	lv@m134 = sorg(__ttt, __sss) + __uuu
	if (lv@m134 < 50) {
		lv@m134 = 50
	}
	if (lv@m134 > 200) {
		lv@m134 = 200
	}
	if (__uuu >= 50) {
		txtef 2
		if (__ttt == 50) {
			txt -1, lang(name(__sss) + "の身体は急に火照りだした。", "Suddenly, " + name(__sss) + " feel" + _s(__sss) + " very hot.")
		}
		if (__ttt == 51) {
			txt -1, lang(name(__sss) + "の身体は急に冷たくなった。", "Suddenly, " + name(__sss) + " feel" + _s(__sss) + " cool.")
		}
		if (__ttt == 52) {
			txt -1, lang(name(__sss) + "の身体に電気が走った。", name(__sss) + " " + is(__sss) + " struck by an electric shock.")
		}
		if (__ttt == 54) {
			txt -1, lang(name(__sss) + "は急に明晰になった。", "Suddenly, " + name(__sss) + your(__sss) + " mind becomes very clear.")
		}
		if (__ttt == 58) {
			txt -1, lang(name(__sss) + "は急に神経が図太くなった。", name(__sss) + your(__sss) + " nerve is sharpened.")
		}
		if (__ttt == 53) {
			txt -1, lang(name(__sss) + "は急に暗闇が怖くなくなった。", name(__sss) + " no longer fear" + _s(__sss) + " darkness.")
		}
		if (__ttt == 57) {
			txt -1, lang(name(__sss) + "は騒音を気にしなくなった。", name(__sss) + your(__sss) + " eardrums get thick.")
		}
		if (__ttt == 59) {
			txt -1, lang(name(__sss) + "は急にカオスを理解した。", "Suddenly, " + name(__sss) + " understand" + _s(__sss) + " chaos.")
		}
		if (__ttt == 55) {
			txt -1, lang(name(__sss) + "の毒への耐性は強くなった。", name(__sss) + " now " + have(__sss) + " antibodies to poisons.")
		}
		if (__ttt == 56) {
			txt -1, lang(name(__sss) + "の魂は地獄に近づいた。", name(__sss) + " " + is(__sss) + " no longer afraid" + _s(__sss) + " of hell.")
		}
		if (__ttt == 60) {
			txt -1, lang(name(__sss) + "の皮膚は魔力のオーラに包まれた。", name(__sss) + your(__sss) + " body is covered by a magical aura.")
		}
	}
	if (__uuu <= 50 * (-1)) {
		txtef 8
		if (__ttt == 50) {
			txt -1, lang(name(__sss) + "は急に汗をかきだした。", name(__sss) + " sweat" + _s(__sss) + ".")
		}
		if (__ttt == 51) {
			txt -1, lang(name(__sss) + "は急に寒気を感じた。", name(__sss) + " shivers" + _s(__sss) + ".")
		}
		if (__ttt == 52) {
			txt -1, lang(name(__sss) + "は急に電気に敏感になった。", name(__sss) + " " + is(__sss) + " shocked.")
		}
		if (__ttt == 54) {
			txt -1, lang(name(__sss) + "は以前ほど明晰ではなくなった。", name(__sss) + your(__sss) + " mind becomes slippery.")
		}
		if (__ttt == 58) {
			txt -1, lang(name(__sss) + "の神経は急に萎縮した。", name(__sss) + " become" + _s(__sss) + " dull.")
		}
		if (__ttt == 53) {
			txt -1, lang(name(__sss) + "は急に暗闇が怖くなった。", "Suddenly, " + name(__sss) + " fear" + _s(__sss) + " darkness.")
		}
		if (__ttt == 57) {
			txt -1, lang(name(__sss) + "は急に辺りをうるさく感じた。", name(__sss) + " become" + _s(__sss) + " very sensitive to noises.")
		}
		if (__ttt == 59) {
			txt -1, lang(name(__sss) + "はカオスへの理解を失った。", name(__sss) + " no longer understand" + _s(__sss) + " chaos.")
		}
		if (__ttt == 55) {
			txt -1, lang(name(__sss) + "の毒への耐性は薄れた。", name(__sss) + " lose" + _s(__sss, 1) + " antibodies to poisons.")
		}
		if (__ttt == 56) {
			txt -1, lang(name(__sss) + "の魂は地獄から遠ざかった。", name(__sss) + " " + is(__sss) + " afraid of hell.")
		}
		if (__ttt == 60) {
			txt -1, lang(name(__sss) + "の皮膚から魔力のオーラが消えた。", "The magical aura disappears from " + name(__sss) + your(__sss) + " body.")
		}
	}
	sdata(__ttt + 600, __sss) = limit(lv@m134, 0, 2000) * 1000000 + sexp(__ttt, __sss) * 1000 + sgrowth(__ttt, __sss)
	snd 107
	animeload 15, __sss
	r1 = __sss
	gosub *chara_refresh
	return



#deffunc modcorrupt int __vvv
	org@m134 = gEtherDiseaseStage / 1000
	p@m134 = __vvv + (__vvv > 0) * gEtherDiseaseSpeed
	if (gettrait(0, 168)) {
		if (__vvv > 0) {
			p@m134 = p@m134 * 100 / 150
		}
	}
	if (have_bigench(0, 14)) {
		p@m134 = p@m134 * 100 / 150
	}
	gEtherDiseaseStage = limit(gEtherDiseaseStage + p@m134, 0, 28000)
	mod@m134 = gEtherDiseaseStage / 1000 - org@m134
	if (mod@m134 > 0) {
		if (org@m134 == 0) {
			txtef 8
			txt -1, lang("エーテルの病が発症した。", "The symptom of the Ether disease is shown up on you.")
			if (cfg_extrahelp) {
				if (gdata(200 + 15) == 0) {
					if (mode == 0) {
						if (cContinuousActionTurn(0) == 0) {
							gdata(200 + 15) = 1
							ghelp = 15
							gosub *label_1575
						}
					}
				}
			}
		}
		if (org@m134 + mod@m134 >= 28) {
			p@m134 = 28 - org@m134
		} else {
			p@m134 = mod@m134
		}
		repeat p@m134
			cnt2@m134 = cnt
			if (gettrait(0, 194) < 0 | ogdata(448)) {
				if (org@m134 + cnt2@m134 > 34) {
					break
				}
			} else {
				if (org@m134 + cnt2@m134 > 28) {
					break
				}
			}
			repeat 100000
				await
				if (gettrait(0, 194) < 0 | ogdata(448)) {
					tid = rnd(28) + 200
				} else {
					tid = rnd(22) + 200
				}
				traitmode = 0
				r1 = 0
				gosub *label_0097
				if (stat == 0 | traitref != 3) {
					continue
				}
				if (gettrait(0, tid) <= traitref(1)) {
					continue
				}
				addtrait 0, tid, -1
				i@m134 = 700 + org@m134 + cnt2@m134
				gdata(i@m134) = tid
				txtef 8
				txt -1, lang("あなたはエーテルに侵食された。", "Your disease is getting worse.")
				txtef 3
				txt -1, traitrefn(1)
				if (tid == 203) {
					body = 9
					r1 = 0
					gosub *label_1420
				}
				if (tid == 205) {
					body = 3
					r1 = 0
					gosub *label_1420
				}
				if (tid == 206) {
					body = 2
					r1 = 0
					gosub *label_1420
				}
				if (tid == 217) {
					if (gettrait(0, tid) != (-1)) {
						body = 8
						r1 = 0
						gosub *label_1420
					}
					body = 1
					r1 = 0
					gosub *label_1420
				}
				if (tid == 218) {
					body = 5
					r1 = 0
					gosub *label_1420
				}
				throwsstpevent "EtherDisease", 0, traitrefn(1), 0
				break
			loop
		loop
		animeload 8, 0
		r1 = 0
		gosub *chara_refresh
		return
	}
	if (mod@m134 < 0) {
		if (org@m134 + mod@m134 < 0) {
			p@m134 = org@m134
		} else {
			p@m134 = abs(mod@m134)
		}
		if (p@m134 < 0) {
			p@m134 = 0
		}
		repeat p@m134
			cnt2@m134 = cnt
			repeat 100000
				await
				if (gettrait(0, 194) < 0 | ogdata(448)) {
					tid = rnd(28) + 200
				} else {
					tid = rnd(22) + 200
				}
				if (cnt == 0) {
					i@m134 = 700 + org@m134 - cnt2@m134 - 1
					if (gdata(i@m134) != 0) {
						tid = gdata(i@m134)
						gdata(i@m134) = 0
					}
				}
				traitmode = 0
				r1 = 0
				gosub *label_0097
				if (stat == 0 | traitref != 3) {
					continue
				}
				if (gettrait(0, tid) >= 0) {
					continue
				}
				addtrait 0, tid, 1
				txtef 2
				txt -1, lang("あなたのエーテルの侵食はやわらいだ。", "The symptoms of the Ether disease seem to calm down.")
				txtef 2
				txt -1, traitrefn(0)
				throwsstpevent "EtherDiseaseCured", 0, traitrefn(0), 0
				break
			loop
		loop
		animeload 10, 0
		r1 = 0
		gosub *chara_refresh
		return
	}
	return



#deffunc wet int __www, int __xxx
	if (synccheck(__www, -1)) {
		if (cWet(__www) == 0) {
			txt -1, lang(name(__www) + "は濡れた。", name(__www) + " get" + _s(__www) + " wet.")
			if (cbit(6, __www) == 1) {
				txt -1, lang(name(__www) + "の姿があらわになった。", name(__www) + " " + is(__www) + " revealed " + his(__www) + " shape.")
			}
		}
	}
	cWet(__www) += __xxx
	return



#deffunc dmgcon int __yyy, int __zzz, int __aaa
	if (__aaa < 1) {
		f@con = 0
	} else {
		f@con = 1
	}
	if (__zzz == 4) {
		if (cbit(9, __yyy) == 1) {
			if (rnd(4) | gettrait(0, 194) == 0) {
				f@con = 0
			}
		}
		if (cQuality(__yyy) > 3) {
			if (rnd(cLevel(__yyy) / 2 + 1)) {
				f@con = 0
			}
		}
		res@con = 53
		gosub *label_0563
		if (f@con == 0) {
			return 0
		}
		p@con = p@con / 6
		if (p@con > 0) {
			if (cBlind(__yyy) == 0) {
				cBlind(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は盲目になった。", name(__yyy) + " " + is(__yyy) + " blinded.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conblind
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						i@m66 = res@con
						ccolor 201
						if (stat == 0) {
							colorres
							mondmg(5, mondmgcnt) = ginfo(16)
							mondmg(6, mondmgcnt) = ginfo(17)
							mondmg(7, mondmgcnt) = ginfo(18)
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cBlind(__yyy) += p@con / 3 + 1
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 5) {
		if (cbit(8, __yyy) == 1) {
			if (rnd(4) | gettrait(0, 194) == 0) {
				f@con = 0
			}
		}
		if (findbuff(__yyy, 7) != (-1)) {
			f@con = 0
		}
		if (cQuality(__yyy) > 3) {
			if (rnd(cLevel(__yyy) / 2 + 1)) {
				f@con = 0
			}
		}
		res@con = 54
		gosub *label_0563
		if (f@con == 0) {
			return 0
		}
		p@con = p@con / 7
		if (p@con > 0) {
			if (cConfused(__yyy) == 0) {
				cConfused(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は混乱した。", name(__yyy) + " " + is(__yyy) + " confused.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conconfuse
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						i@m66 = res@con
						ccolor 202
						if (stat == 0) {
							colorres
							mondmg(5, mondmgcnt) = ginfo(16)
							mondmg(6, mondmgcnt) = ginfo(17)
							mondmg(7, mondmgcnt) = ginfo(18)
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cConfused(__yyy) += p@con / 3 + 1
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 3) {
		if (cbit(12, __yyy) == 1) {
			if (rnd(4) | gettrait(0, 194) == 0) {
				f@con = 0
			}
		}
		if (cQuality(__yyy) > 3) {
			if (rnd(cLevel(__yyy) + 1)) {
				f@con = 0
			}
		}
		res@con = 58
		gosub *label_0563
		if (f@con == 0) {
			return 0
		}
		p@con = p@con / 10
		if (p@con > 0) {
			if (cParalyzed(__yyy) == 0) {
				cParalyzed(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					if (p@con < 100) {
						txtef 8
						txt -1, lang(name(__yyy) + "は麻痺した。", name(__yyy) + " " + is(__yyy) + " paralyzed.")
					}
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conparalyze
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						i@m66 = res@con
						ccolor 203
						if (stat == 0) {
							colorres
							mondmg(5, mondmgcnt) = ginfo(16)
							mondmg(6, mondmgcnt) = ginfo(17)
							mondmg(7, mondmgcnt) = ginfo(18)
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cParalyzed(__yyy) += p@con / 3 + 1
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 1) {
		if (cbit(13, __yyy) == 1) {
			if (rnd(4) | gettrait(0, 194) == 0) {
				f@con = 0
			}
		}
		if (cQuality(__yyy) > 3) {
			if (rnd(cLevel(__yyy) / 3 + 1)) {
				f@con = 0
			}
		}
		res@con = 55
		gosub *label_0563
		if (f@con == 0) {
			return 0
		}
		p@con = p@con / 5
		if (p@con > 0) {
			if (cPoisoned(__yyy) == 0) {
				cPoisoned(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は毒におかされた。", name(__yyy) + " " + is(__yyy) + " poisoned.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conpoison
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						i@m66 = res@con
						ccolor 204
						if (stat == 0) {
							colorres
							mondmg(5, mondmgcnt) = ginfo(16)
							mondmg(6, mondmgcnt) = ginfo(17)
							mondmg(7, mondmgcnt) = ginfo(18)
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cPoisoned(__yyy) += p@con / 3 + 3
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 2) {
		if (cbit(11, __yyy) == 1) {
			if (rnd(4) | gettrait(0, 194) == 0) {
				f@con = 0
			}
		}
		if (cQuality(__yyy) > 3) {
			if (rnd(cLevel(__yyy) / 5 + 1)) {
				f@con = 0
			}
		}
		res@con = 58
		gosub *label_0563
		if (f@con == 0) {
			return 0
		}
		p@con = p@con / 4
		if (p@con > 0) {
			if (cSleep(__yyy) == 0) {
				cSleep(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は眠りにおちた。", name(__yyy) + " fall" + _s(__yyy) + " asleep.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _consleep
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						i@m66 = res@con
						ccolor 205
						if (stat == 0) {
							colorres
							mondmg(5, mondmgcnt) = ginfo(16)
							mondmg(6, mondmgcnt) = ginfo(17)
							mondmg(7, mondmgcnt) = ginfo(18)
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cSleep(__yyy) += p@con / 3 + 1
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 6) {
		if (cbit(10, __yyy) == 1) {
			if (rnd(4) | gettrait(0, 194) == 0) {
				f@con = 0
			}
		}
		if (findbuff(__yyy, 1) != (-1)) {
			f@con = 0
		}
		if (findbuff(__yyy, 7) != (-1)) {
			f@con = 0
		}
		if (cQuality(__yyy) > 3) {
			if (rnd(cLevel(__yyy) / 5 + 1)) {
				f@con = 0
			}
		}
		res@con = 54
		gosub *label_0563
		if (f@con == 0) {
			return 0
		}
		p@con = p@con / 7
		if (p@con > 0) {
			if (cFear(__yyy) == 0) {
				cFear(__yyy) = p@con
			}
			if (synccheck(__yyy, -1)) {
				txt -1, lang(name(__yyy) + "は恐怖に侵された。", name(__yyy) + " " + is(__yyy) + " frightened.")
				if (cfg_dmgmonitor2 == 1) {
					mondmgn(mondmgcnt) = _confear
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
					i@m66 = res@con
					ccolor 206
					if (stat == 0) {
						colorres
						mondmg(5, mondmgcnt) = ginfo(16)
						mondmg(6, mondmgcnt) = ginfo(17)
						mondmg(7, mondmgcnt) = ginfo(18)
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		}
		return 1
	}
	if (__zzz == 7) {
		if (cQuality(__yyy) > 3) {
			if (rnd(cLevel(__yyy) / 3 + 1)) {
				f@con = 0
			}
		}
		if (cdatan(2, __yyy) == "golem" | cbit(34, __yyy)) {
			f@con = 0
		}
		if (gettrait(__yyy, 157)) {
			f@con = 0
		}
		res@con = 57
		gosub *label_0563
		if (f@con == 0) {
			return 0
		}
		p@con = p@con / 8
		if (p@con > 0) {
			if (cDimmed(__yyy) == 0) {
				cDimmed(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は朦朧とした。", name(__yyy) + " " + is(__yyy) + " dimmed.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _condim
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						i@m66 = res@con
						ccolor 207
						if (stat == 0) {
							colorres
							mondmg(5, mondmgcnt) = ginfo(16)
							mondmg(6, mondmgcnt) = ginfo(17)
							mondmg(7, mondmgcnt) = ginfo(18)
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cDimmed(__yyy) += p@con / 3 + 1
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 9) {
		p@con = __aaa / 25
		if (cQuality(__yyy) > 3) {
			p@con /= 2
		}
		if (p@con > 0) {
			if (cBleeding(__yyy) == 0) {
				cBleeding(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は血を流し始めた。", name(__yyy) + " begin" + _s(__yyy) + " to bleed.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conbleed
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						ccolor 208
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cBleeding(__yyy) += p@con
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 8) {
		p@con = __aaa / 10
		if (p@con > 0) {
			if (cDrunk(__yyy) == 0) {
				cDrunk(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txt -1, lang(name(__yyy) + "は酔っ払った。", name(__yyy) + " get" + _s(__yyy) + " drunk.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _condrunk
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						ccolor 209
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cDrunk(__yyy) += p@con
			}
		}
		return 1
	}
	if (__zzz == 11) {
		p@con = __aaa / 8
		if (p@con > 0) {
			if (cInsane(__yyy) == 0) {
				cInsane(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は気が狂った。", name(__yyy) + " become" + _s(__yyy) + " insane.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _coninsane
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						ccolor 210
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cInsane(__yyy) += p@con / 3 + 1
			}
			rowactend __yyy
		}
		return 1
	}
	if (__zzz == 12) {
		p@con = __aaa / 10
		if (p@con > 0) {
			if (cSick(__yyy) == 0) {
				cSick(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は病気になった。", name(__yyy) + " get" + _s(__yyy) + " sick.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _consick
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						ccolor 211
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				cSick(__yyy) += p@con / 10 + 1
			}
		}
		return 1
	}
	if (__zzz == 13) {
		p@con = __aaa
		if (p@con > 0) {
			if (cAphrodisiac(__yyy) == 0) {
				cAphrodisiac(__yyy) = p@con
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "の下半身は興奮した。", name(__yyy) + " get" + _s(__yyy) + " aphrodisiac.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _aphrodisiac
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						ccolor 211
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			} else {
				if (cAphrodisiac(__yyy) < 100000000) {
					cAphrodisiac(__yyy) += p@con / 2 + 1
				}
			}
		}
		return 1
	}
	if (__zzz == 14) {
		p@con = __aaa
		if (p@con > 0) {
			if (cStoned(__yyy) == 0) {
				cStoned(__yyy) = 100
				if (synccheck(__yyy, -1)) {
					txtef 8
					txt -1, lang(name(__yyy) + "は石化した。", name(__yyy) + " " + is(__yyy) + " storned.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _storned
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, __yyy, -1
						ccolor 211
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
				if (__yyy < 16) {
					if (cbit(967, __yyy) == 1 | __yyy == 0) {
						create_pcpic __yyy, 1
					}
				}
			}
		}
		return 1
	}
	return
*label_0563
	p@con = rnd(__aaa / 2 + 1) + __aaa / 2
	r@con = sdata(res@con, __yyy) / 50
	p@con = p@con * 100 / (50 + r@con * 50)
	if (r@con >= 3) {
		if (p@con < 40) {
			f@con = 0
		}
	}
	return



#deffunc healhp int __bbb, int __ccc
	if (__ccc < 0) {
		if (eqfaction(__bbb, "overwish")) {
			return
		}
	}
	lint_buff = limitIntMax(cHp(__bbb) + __ccc)
	cHp(__bbb) = lint_buff
	if (cHp(__bbb) > cMaxHp(__bbb)) {
		cHp(__bbb) = cMaxHp(__bbb)
	}
	return



#deffunc healmp int __ddd, int __eee
	lint_buff = limitIntMax(cMp(__ddd) + __eee)
	cMp(__ddd) = lint_buff
	if (cMp(__ddd) > cMaxMp(__ddd)) {
		cMp(__ddd) = cMaxMp(__ddd)
	}
	return



#deffunc healsp int __fff, int __ggg
	cSp(__fff) += __ggg
	if (cSp(__fff) > cMaxSp(__fff)) {
		cSp(__fff) = cMaxSp(__fff)
	}
	return



#deffunc healcon int __hhh, int __iii, int __jjj
	if (__iii == 6) {
		if (cFear(__hhh) > 0) {
			if (__jjj == 0) {
				cFear(__hhh) = 0
			} else {
				cFear(__hhh) -= __jjj
			}
			if (cFear(__hhh) <= 0) {
				cFear(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は恐怖から立ち直った。", name(__hhh) + " shake" + _s(__hhh) + " off " + his(__hhh) + " fear.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _confear
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 306
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			return
		}
	}
	if (__iii == 4) {
		if (cBlind(__hhh) > 0) {
			if (__jjj == 0) {
				cBlind(__hhh) = 0
			} else {
				cBlind(__hhh) -= __jjj
			}
			if (cBlind(__hhh) <= 0) {
				cBlind(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は盲目から回復した。", name(__hhh) + " can see again.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conblind
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 301
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			return
		}
	}
	if (__iii == 5) {
		if (cConfused(__hhh) > 0) {
			if (__jjj == 0) {
				cConfused(__hhh) = 0
			} else {
				cConfused(__hhh) -= __jjj
			}
			if (cConfused(__hhh) <= 0) {
				cConfused(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は混乱から回復した。", name(__hhh) + " recover" + _s(__hhh) + " from confusion.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conconfuse
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 302
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			return
		}
	}
	if (__iii == 3) {
		if (cParalyzed(__hhh) > 0) {
			if (__jjj == 0) {
				cParalyzed(__hhh) = 0
			} else {
				cParalyzed(__hhh) -= __jjj
			}
			if (cParalyzed(__hhh) <= 0) {
				cParalyzed(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は麻痺から回復した。", name(__hhh) + " recover" + _s(__hhh) + " from paralysis.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conparalyze
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 303
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			return
		}
	}
	if (__iii == 1) {
		if (cPoisoned(__hhh) > 0) {
			if (__jjj == 0) {
				cPoisoned(__hhh) = 0
			} else {
				cPoisoned(__hhh) -= __jjj
			}
			if (cPoisoned(__hhh) <= 0) {
				cPoisoned(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は毒から回復した。", name(__hhh) + " recover" + _s(__hhh) + " from poison.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conpoison
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 304
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			return
		}
	}
	if (__iii == 2) {
		if (cSleep(__hhh) > 0) {
			if (__jjj == 0) {
				cSleep(__hhh) = 0
			} else {
				cSleep(__hhh) -= __jjj
			}
			if (cSleep(__hhh) <= 0) {
				cSleep(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は心地よい眠りから覚めた。", name(__hhh) + " awake" + _s(__hhh) + " from " + his(__hhh) + " sleep.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _consleep
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 305
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			return
		}
	}
	if (__iii == 7) {
		if (cDimmed(__hhh) > 0) {
			if (__jjj == 0) {
				cDimmed(__hhh) = 0
			} else {
				cDimmed(__hhh) -= __jjj
			}
			if (cDimmed(__hhh) <= 0) {
				cDimmed(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "の意識ははっきりした。", name(__hhh) + " recover" + _s(__hhh) + " from dim.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _condim
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 307
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
		}
	}
	if (__iii == 9) {
		if (cBleeding(__hhh) > 0) {
			if (__jjj == 0) {
				cBleeding(__hhh) = 0
			} else {
				cBleeding(__hhh) -= __jjj
			}
			if (cBleeding(__hhh) <= 0) {
				cBleeding(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "の出血は止まった。", name(__hhh) + your(__hhh) + " bleeding stops.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _conbleed
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 308
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
		}
	}
	if (__iii == 8) {
		if (cDrunk(__hhh) > 0) {
			if (__jjj == 0) {
				cDrunk(__hhh) = 0
			} else {
				cDrunk(__hhh) -= __jjj
			}
			if (cDrunk(__hhh) <= 0) {
				cDrunk(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "の酔いは覚めた。", name(__hhh) + " get" + _s(__hhh) + " sober.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _condrunk
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 309
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
		}
	}
	if (__iii == 11) {
		if (cInsane(__hhh) > 0) {
			if (__jjj == 0) {
				cInsane(__hhh) = 0
			} else {
				cInsane(__hhh) -= __jjj
			}
			if (cInsane(__hhh) <= 0) {
				cInsane(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は正気に戻った。", name(__hhh) + " come" + _s(__hhh) + " to " + yourself(__hhh) + " again.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _coninsane
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 310
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
		}
	}
	if (__iii == 12) {
		if (cSick(__hhh) > 0) {
			if (have_bigench(__hhh, 11) == 0) {
				if (__jjj == 0) {
					cSick(__hhh) = 0
				} else {
					cSick(__hhh) -= __jjj
				}
			}
			if (cSick(__hhh) <= 0) {
				cSick(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "の病気は治った。", name(__hhh) + " recover" + _s(__hhh) + " from " + his(__hhh) + " illness.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _consick
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 311
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
		}
	}
	if (__iii == 13) {
		if (cAphrodisiac(__hhh) > 0) {
			if (have_bigench(__hhh, 11) == 0) {
				if (__jjj == 0) {
					cAphrodisiac(__hhh) = 0
				} else {
					cAphrodisiac(__hhh) -= __jjj
				}
			}
			if (cAphrodisiac(__hhh) <= 0) {
				cAphrodisiac(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "の下半身は落ち着いた。", name(__hhh) + " recover" + _s(__hhh) + " from " + his(__hhh) + " from Aphrodisiac.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _aphrodisiac
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 311
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
		}
	}
	if (__iii == 14) {
		if (cStoned(__hhh) > 0) {
			cStoned(__hhh) -= __jjj
			if (cStoned(__hhh) <= 0) {
				cStoned(__hhh) = 0
				if (synccheck(__hhh, -1)) {
					txt -1, lang(name(__hhh) + "は石化から回復した。", name(__hhh) + " recover" + _s(__hhh) + " from storned.")
					if (cfg_dmgmonitor2 == 1) {
						mondmgn(mondmgcnt) = _storned
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, __hhh, -1
						ccolor 311
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
				if (__hhh < 16) {
					if (cbit(967, __hhh) == 1 | __hhh == 0) {
						create_pcpic __hhh, 1
					}
				}
			}
		}
	}
	return



#deffunc spillblood int __kkk, int __lll, int __mmm
	repeat __mmm + 1
		if (cnt == 0) {
			dx@m136 = __kkk
			dy@m136 = __lll
		} else {
			dx@m136 = __kkk + rnd(2) - rnd(2)
			dy@m136 = __lll + rnd(2) - rnd(2)
		}
		if (dx@m136 < 0 | dx@m136 >= mapWidth | dy@m136 < 0 | dy@m136 >= mapHeight) {
			continue
		}
		if (chipm(2, map(dx@m136, dy@m136, 0))) {
			continue
		}
		if (map(dx@m136, dy@m136, 7) \ 10 < 5) {
			map(dx@m136, dy@m136, 7)++
		}
	loop
	return



#deffunc spillfrag int __nnn, int __ooo, int __ppp
	repeat __ppp + 1
		if (cnt == 0) {
			dx@m136 = __nnn
			dy@m136 = __ooo
		} else {
			dx@m136 = __nnn + rnd(2) - rnd(2)
			dy@m136 = __ooo + rnd(2) - rnd(2)
		}
		if (dx@m136 < 0 | dx@m136 >= mapWidth | dy@m136 < 0 | dy@m136 >= mapHeight) {
			continue
		}
		if (chipm(2, map(dx@m136, dy@m136, 0))) {
			continue
		}
		if (map(dx@m136, dy@m136, 7) / 10 < 4) {
			map(dx@m136, dy@m136, 7) = map(dx@m136, dy@m136, 7) \ 10 + (map(dx@m136, dy@m136, 7) / 10 + 1) * 10
		}
	loop
	return



#deffunc check_kill int __qqq, int __rrr
	if (gCurrentMap == 40 | gCurrentMap == 49 | gCurrentMap == 35 | gCurrentMap == 6 | oabit(6, gCurrentMap)) {
		return
	}
	p@m137 = 0
	if (__qqq >= 0) {
		if (__qqq == 0 | cRelationship(__qqq) >= 10) {
			if (__rrr > 16) {
				gKillCount++
				if (cId(__rrr) == gdata(250 + 18)) {
					if (gdata(250 + 17) > 0) {
						gdata(250 + 17)--
					}
				}
				if (gettrait(__qqq, 181) != 0) {
					s = refchara(cId(__rrr), 8, 1)
					if (instr(s, 0, "/man/") != (-1)) {
						p@m137 = -2
					}
				}
				if (cOriginalRelationship(__rrr) >= 0) {
					p@m137 = -2
				}
				if (cId(__rrr) == 183) {
					p@m137 = -15
				}
				if (cId(__rrr) == 184) {
					p@m137 = -10
				}
				if (cId(__rrr) == 185) {
					p@m137 = -5
				}
				if (chara_isShopKeeper(__rrr)) {
					p@m137 = -10
				}
				if (cRole(__rrr) == 13 & ocdata(100, __rrr) != 20000) {
					modimp __rrr, -25
				}
			}
		}
		if (cRelationship(__qqq) >= 10) {
			if (__qqq != 0) {
				if (cImpression(__qqq) < 200) {
					if (rnd(2)) {
						modimp __qqq, 1
						cEmotionIcon(__qqq) = 17 + 100 * 3
					}
				} else {
					if (rnd(10) == 0) {
						modimp __qqq, 1
						cEmotionIcon(__qqq) = 17 + 100 * 3
					}
				}
			}
		}
	}
	if (p@m137 != 0) {
		modkarma 0, p@m137
	}
	return



#deffunc item_acid int __sss, int __ttt
	if (__ttt != (-1)) {
		ci@m138 = __ttt
	} else {
		ci@m138 = -1
		repeat 30, 100
			body@m138 = cdata(cnt, __sss) / 10000
			if (body@m138 == 0) {
				break
			}
			p@m138 = cdata(cnt, __sss) \ 10000 - 1
			if (p@m138 == (-1)) {
				continue
			}
			if (rnd(limit(30, 1, 30)) == 0) {
				if (iEnhancement(p@m138) > (-4)) {
					ci@m138 = p@m138
					break
				}
			}
		loop
	}
	if (ci@m138 == (-1)) {
		return
	}
	if (refitem(iId(ci@m138), 5, ci@m138) >= 50000) {
		return
	}
	if (ibit(1, ci@m138) == 0) {
		txtef 8
		txt -1, lang(name(__sss) + "の" + itemname(ci@m138) + "は酸で傷ついた。", name(__sss) + your(__sss) + " " + itemname(ci@m138, , 1) + " is damaged by acid.")
		safe_subtract iEnhancement(ci@m138), 1
	} else {
		txt -1, lang(name(__sss) + "の" + itemname(ci@m138) + "は酸では傷つかない。", name(__sss) + your(__sss) + " " + itemname(ci@m138, , 1) + " is immune to acid.")
	}
	return



#deffunc item_fire int __uuu, int __vvv
	oomSEST_log "item_fire unit:" + __uuu + " item:" + __vvv
	max@m138 = 0
	ti@m138 = -1
	if (__vvv != (-1)) {
		itemfirex = iX(__vvv)
		itemfirey = iY(__vvv)
		if (itemfirex >= 0 & itemfirey >= 0 & itemfirex < mapWidth & itemfirey < mapHeight) {
			if (map(itemfirex, itemfirey, 1) > 0) {
				if (godcheck(map(itemfirex, itemfirey, 1) - 1) == "plamja" | (ogdata(454) == 2 & godcheck(map(itemfirex, itemfirey, 1) - 1) == "itzpalt")) {
					oomSEST_log "item_fire end:0"
					return 0
				}
			}
		}
		list@m138(0) = __vvv
		max@m138++
	}
	if (__uuu != (-1)) {
		if (godcheck(__uuu) == "plamja" | (ogdata(454) == 2 & godcheck(__uuu) == "itzpalt")) {
			oomSEST_log "item_fire end:0"
			return 0
		}
		if (sdata(50, __uuu) / 50 >= 6 | cQuality(__uuu) >= 4) {
			oomSEST_log "item_fire end:0"
			return 0
		}
		inv_getheader __uuu
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iId(cnt) == 567) {
				if (ti@m138 == (-1)) {
					ti@m138 = cnt
					item_separate ti@m138
				}
				continue
			}
			if (__vvv == (-1)) {
				list@m138(max@m138) = cnt
				max@m138++
			}
		loop
	}
	if (max@m138 == 0) {
		oomSEST_log "item_fire end:0"
		return 0
	}
	f@m138 = 0
	repeat 3
		ci@m138 = list@m138(rnd(max@m138))
		if (iNumber(ci@m138) <= 0) {
			continue
		}
		rowact_item ci@m138
		if (ibit(2, ci@m138) == 0) {
			if (ibit(5, ci@m138) == 0) {
				a@m138 = refitem(iId(ci@m138), 5, ci@m138)
				if (a@m138 == 57000) {
					if (iParam2(ci@m138) == 0) {
						if (__uuu == (-1)) {
							if (synccheck(iX(ci@m138), iY(ci@m138))) {
								txtef 11
								txt -1, lang("地面の" + itemname(ci@m138, iNumber(ci@m138)) + "はこんがりと焼き上がった。", itemname(ci@m138, iNumber(ci@m138)) + " on the ground get" + _s2(iNumber(ci@m138)) + " perfectly broiled.")
							}
						}
						if (__uuu != (-1)) {
							if (synccheck(__uuu, -1)) {
								txtef 11
								txt -1, lang(name(__uuu) + "の" + itemname(ci@m138, iNumber(ci@m138)) + "はこんがりと焼き上がった。", name(__uuu) + your(__uuu) + " " + itemname(ci@m138, iNumber(ci@m138), 1) + " get" + _s2(iNumber(ci@m138)) + " perfectly broiled.")
							}
						}
						make_dish ci@m138, rnd(5) + 1
						f@m138 = 1
						continue
					}
				}
				if (a@m138 == 72000 | a@m138 == 59000 | a@m138 == 68000 | iQuality(ci@m138) >= 4) {
					continue
				}
				if (iBodyPart(ci@m138) != 0) {
					if (rnd(2)) {
						continue
					}
				}
				if (a@m138 != 56000 & a@m138 != 80000 & a@m138 != 55000 & a@m138 != 53000 & a@m138 != 54000) {
					if (rnd(4)) {
						continue
					}
					if (__uuu != (-1)) {
						if (rnd(4)) {
							continue
						}
					}
				}
				if (ti@m138 != (-1)) {
					if (iNumber(ti@m138) > 0) {
						if (synccheck(__uuu, -1)) {
							txt -1, lang(itemname(ti@m138, 1) + "が" + name(__uuu) + "の持ち物を炎から守った。", itemname(ti@m138, 1) + " protects " + name(__uuu) + your(__uuu) + " stuff from fire.")
						}
						if (iCount(ti@m138) > 0) {
							iCount(ti@m138)--
						} else {
							if (rnd(20) == 0) {
								iNumber(ti@m138)--
								if (synccheck(__uuu, -1)) {
									txt -1, lang(itemname(ti@m138, 1) + "は灰と化した。", itemname(ti@m138, 1) + " turns to dust.")
									break
								}
							}
						}
						continue
					}
				}
				p@m138 = rndex(iNumber(ci@m138)) / 2 + 1
				if (__uuu != (-1)) {
					if (iBodyPart(ci@m138) != 0) {
						if (synccheck(__uuu, -1)) {
							txtef 8
							txt -1, lang(name(__uuu) + "の装備している" + itemname(ci@m138, p@m138) + "は灰と化した。", itemname(ci@m138, p@m138) + " " + name(__uuu) + " equip" + _s(__uuu) + " turn" + _s2(p@m138) + " to dust.")
							if (godcheck(0) == "plamja" | (ogdata(454) == 2 & godcheck(0) == "itzpalt")) {
								burntoffering ci@m138, 0
							}
						}
						repeat 16 - 1, 1
							if (cState(cnt) == 1) {
								if (godcheck(cnt) == "plamja" | (ogdata(454) == 2 & godcheck(cnt) == "itzpalt")) {
									if (dist(cX(cnt), cY(cnt), cX(__uuu), cY(__uuu)) <= 6) {
										burntoffering ci@m138, cnt
									}
								}
							}
						loop
						cdata(iBodyPart(ci@m138), __uuu) = cdata(iBodyPart(ci@m138), __uuu) / 10000 * 10000
						iBodyPart(ci@m138) = 0
						r1 = __uuu
						gosub *chara_refresh
					} else {
						if (synccheck(__uuu, -1)) {
							txtef 8
							txt -1, lang(name(__uuu) + "の" + itemname(ci@m138, p@m138) + "は灰と化した。", name(__uuu) + your(__uuu) + " " + itemname(ci@m138, p@m138, 1) + " turn" + _s2(p@m138) + " to dust.")
							if (godcheck(0) == "plamja" | (ogdata(454) == 2 & godcheck(0) == "itzpalt")) {
								burntoffering ci@m138, 0
							}
						}
						repeat 16 - 1, 1
							if (cState(cnt) == 1) {
								if (godcheck(cnt) == "plamja" | (ogdata(454) == 2 & godcheck(cnt) == "itzpalt")) {
									if (dist(cX(cnt), cY(cnt), cX(__uuu), cY(__uuu)) <= 6) {
										burntoffering ci@m138, cnt
									}
								}
							}
						loop
					}
				} else {
					if (synccheck(iX(ci@m138), iY(ci@m138))) {
						txtef 8
						txt -1, lang("地面の" + itemname(ci@m138, p@m138) + "は灰と化した。", itemname(ci@m138, p@m138) + " on the ground turn" + _s(p@m138) + " to dust.")
						if (godcheck(0) == "plamja" | (ogdata(454) == 2 & godcheck(0) == "itzpalt")) {
							burntoffering ci@m138, 0
						}
					}
					repeat 16 - 1, 1
						if (cState(cnt) == 1) {
							if (godcheck(cnt) == "plamja" | (ogdata(454) == 2 & godcheck(cnt) == "itzpalt")) {
								if (dist(cX(cnt), cY(cnt), iX(__vvv), iY(__vvv)) <= 6) {
									burntoffering ci@m138, cnt
								}
							}
						}
					loop
				}
				iNumber(ci@m138) -= p@m138
				cell_refresh iX(ci@m138), iY(ci@m138)
				f@m138 = 1
			}
		}
	loop
	gosub *refreshPCBurdenState
	oomSEST_log "item_fire end:" + f@m138
	return f@m138



#deffunc mapitem_fire int __www, int __xxx
	if (map(__www, __xxx, 4) == 0) {
		return
	}
	inv_getheader -1
	ci@m138 = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iX(cnt) == __www) {
			if (iY(cnt) == __xxx) {
				ci@m138 = cnt
				break
			}
		}
	loop
	if (ci@m138 != (-1)) {
		item_fire -1, ci@m138
		if (stat == 1) {
			if (map(__www, __xxx, 8) == 0) {
				addmef __www, __xxx, 5, 24, rnd(10) + 5, 100, cc
			}
		}
		cell_refresh __www, __xxx
	}
	return



#deffunc item_cold int __yyy, int __zzz
	max@m138 = 0
	ti@m138 = -1
	if (__zzz != (-1)) {
		list@m138(0) = __zzz
		max@m138++
	}
	if (__yyy != (-1)) {
		if (sdata(51, __yyy) / 50 >= 6 | cQuality(__yyy) >= 4) {
			return 0
		}
		inv_getheader __yyy
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iId(cnt) == 568) {
				if (ti@m138 == (-1)) {
					ti@m138 = cnt
					item_separate ti@m138
				}
				continue
			}
			if (__zzz == (-1)) {
				list@m138(max@m138) = cnt
				max@m138++
			}
		loop
	}
	if (max@m138 == 0) {
		return 0
	}
	f@m138 = 0
	repeat 2
		ci@m138 = list@m138(rnd(max@m138))
		if (iNumber(ci@m138) <= 0) {
			continue
		}
		rowact_item ci@m138
		if (ibit(5, ci@m138) == 0) {
			a@m138 = refitem(iId(ci@m138), 5, ci@m138)
			if (__yyy == (-1)) {
				s@m138 = ""
			} else {
				s@m138 = name(__yyy) + lang("の", your(__yyy))
			}
			if (a@m138 == 72000 | a@m138 == 59000 | a@m138 == 68000) {
				continue
			}
			if (iQuality(ci@m138) >= 4 | iBodyPart(ci@m138) != 0) {
				continue
			}
			if (a@m138 != 52000) {
				if (rnd(30)) {
					continue
				}
			}
			if (ti@m138 != (-1)) {
				if (iNumber(ti@m138) > 0) {
					txt -1, lang(itemname(ti@m138, 1) + "が" + name(__yyy) + "の持ち物を冷気から守った。", itemname(ti@m138, 1) + " protects " + name(__yyy) + your(__yyy) + " stuff from cold.")
					if (iCount(ti@m138) > 0) {
						iCount(ti@m138)--
					} else {
						if (rnd(20) == 0) {
							txt -1, lang(itemname(ti@m138, 1) + "は粉々に砕けた。", itemname(ti@m138, 1) + " is broken to pieces.")
							iNumber(ti@m138)--
							break
						}
					}
					continue
				}
			}
			p@m138 = rndex(iNumber(ci@m138)) / 2 + 1
			txtef 8
			txt -1, lang(s@m138 + itemname(ci@m138, p@m138) + "は粉々に砕けた。", s@m138 + itemname(ci@m138, p@m138) + " break" + _s2(p@m138) + " to pieces.")
			iNumber(ci@m138) -= p@m138
			f@m138 = 1
		}
	loop
	gosub *refreshPCBurdenState
	return f@m138



#deffunc mapitem_cold int __aaa, int __bbb
	if (map(__aaa, __bbb, 4) == 0) {
		return
	}
	inv_getheader -1
	ci@m138 = -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iX(cnt) == __aaa) {
			if (iY(cnt) == __bbb) {
				ci@m138 = cnt
				break
			}
		}
	loop
	if (ci@m138 != (-1)) {
		item_cold -1, ci@m138
		cell_refresh __aaa, __bbb
	}
	return



#deffunc copy_chara int __ccc, int __ddd, int __eee
	oomSEST_log "copy_chara:Begin"
	if (__ccc != (-1)) {
		c@m139 = __ccc
	} else {
		c@m139 = 0
		repeat 188, 57
			if (cState(cnt) == 0) {
				c@m139 = cnt
				break
			}
		loop
	}
	if (c@m139 == 0) {
		return 0
	}
	if (__eee == 0) {
		f@m139 = 0
		repeat 8
			y@m139 = cY(__ddd) - rnd(cnt / 4 + 1) + rnd(cnt / 4 + 1)
			if (y@m139 < 0 | y@m139 >= mapHeight) {
				continue
			}
			x@m139 = cX(__ddd) - rnd(cnt / 4 + 1) + rnd(cnt / 4 + 1)
			if (x@m139 < 0 | x@m139 >= mapWidth) {
				continue
			}
			if (map(x@m139, y@m139, 1) == 0) {
				if ((chipm(7, map(x@m139, y@m139, 0)) & 4) == 0) {
					f@m139 = 1
					break
				}
			}
		loop
		if (f@m139 == 0) {
			return 0
		}
	}
	oomSEST_log "copy_chara:Proc"
	del_chara c@m139
	memcpy sdata(0, c@m139), sdata(0, __ddd), 4800
	memcpy sdataEx(0, c@m139), sdataEx(0, __ddd), 2400
	memcpy cState(c@m139), cState(__ddd), 2000
	memcpy ocdata(0, c@m139), ocdata(0, __ddd), 1000
	repeat 10
		cdatan(cnt, c@m139) = cdatan(cnt, __ddd)
	loop
	faction(c@m139) = faction(__ddd)
	if (__eee == 0) {
		map(x@m139, y@m139, 1) = c@m139 + 1
		cX(c@m139) = x@m139
		cY(c@m139) = y@m139
		cInitialX(c@m139) = cX(c@m139)
		cInitialY(c@m139) = cY(c@m139)
	}
	cImpression(c@m139) = 0
	cGold(c@m139) = 0
	repeat 30, 100
		cdata(cnt, c@m139) = cdata(cnt, c@m139) / 10000 * 10000
	loop
	cRole(c@m139) = 0
	cOriginalRelationship(c@m139) = -3
	ocdata(104, c@m139) = 0
	ocdata(80, c@m139) = 0
	cbitmod 966, c@m139, 0
	cbitmod 967, c@m139, 0
	cbitmod 968, c@m139, 0
	cbitmod 960, c@m139, 0
	cbitmod 961, c@m139, 0
	cbitmod 975, c@m139, 0
	cbitmod 981, c@m139, 1
	cbitmod 985, c@m139, 0
	memset cContinuousActionId(c@m139), 0, 24
	oomSEST_log "copy_chara:end"
	return 1



#deffunc txteledmg int __fff, int __ggg, int __hhh, int __iii
	if (__iii == 50) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は燃え上がった。", name(__hhh) + " " + is(__hhh) + " burnt.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("燃やし尽くした。", "burn" + _s(__ggg) + " " + him(__hhh) + " to death.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は燃え尽きて灰になった。", name(__hhh) + " " + is(__hhh) + " burnt to ashes.")
		}
		return
	}
	if (__iii == 51) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は凍えた。", name(__hhh) + " " + is(__hhh) + " frozen.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("氷の塊に変えた。", "transform" + _s(__ggg) + " " + him(__hhh) + " to an ice sculpture.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は氷の彫像になった。", name(__hhh) + " " + is(__hhh) + " frozen and turn" + _s(__hhh) + " into an ice sculpture.")
		}
		return
	}
	if (__iii == 52) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "に電流が走った。", name(__hhh) + " " + is(__hhh) + " shocked.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("焦げカスにした。", "electrocute" + _s(__ggg) + " " + him(__hhh) + " to death.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は雷に打たれ死んだ。", name(__hhh) + " " + is(__hhh) + " struck by lightning and die" + _s(__hhh) + ".")
		}
		return
	}
	if (__iii == 53) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は闇の力で傷ついた。", name(__hhh) + " " + is(__hhh) + " struck by dark force.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("闇に飲み込んだ。", "let" + _s(__ggg) + " the depths swallow " + him(__hhh) + ".")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は闇に蝕まれて死んだ。", name(__hhh) + " " + is(__hhh) + " consumed by darkness.")
		}
		return
	}
	if (__iii == 58) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "の神経は傷ついた。", name(__hhh) + your(__hhh) + " nerves are hurt.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("神経を破壊した。", "destroy" + _s(__ggg) + " " + his(__hhh) + " nerves.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は神経を蝕まれて死んだ。", name(__hhh) + " die" + _s(__hhh) + " from neurofibroma.")
		}
		return
	}
	if (__iii == 54) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は狂気に襲われた。", name(__hhh) + " suffer" + _s(__hhh) + " a splitting headache.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("再起不能にした。", "completely disable" + _s(__ggg) + " " + him(__hhh) + ".")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は発狂して死んだ。", name(__hhh) + " lose" + _s(__hhh) + " " + his(__hhh) + " mind and commit" + _s(__hhh) + " a suicide.")
		}
		return
	}
	if (__iii == 59) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は混沌の渦で傷ついた。", name(__hhh) + " " + is(__hhh) + " hurt by chaotic force.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("混沌の渦に吸い込んだ。", "let" + _s(__ggg) + " the chaos consume " + him(__hhh) + ".")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は混沌の渦に吸収された。", name(__hhh) + " " + is(__hhh) + " drawn into a chaotic vortex.")
		}
		return
	}
	if (__iii == 56) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は冥界の冷気で傷ついた。", name(__hhh) + " " + is(__hhh) + " chilled by infernal squall.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("冥界に墜とした。", "entrap" + _s(__ggg) + " " + him(__hhh) + " into the inferno.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は冥界に墜ちた。", name(__hhh) + " go" + _s(__hhh, 1) + " to hell.")
		}
		return
	}
	if (__iii == 55) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は吐き気を催した。", name(__hhh) + " suffer" + _s(__hhh) + " from venom.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("毒殺した。", "kill" + _s(__ggg) + " " + him(__hhh) + " with poison.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は毒に蝕まれて死んだ。", name(__hhh) + " " + is(__hhh) + " poisoned to death.")
		}
		return
	}
	if (__iii == 57) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は轟音の衝撃を受けた。", name(__hhh) + " " + is(__hhh) + " shocked by a shrill sound.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("聴覚を破壊し殺した。", "shatter" + _s(__ggg) + " " + him(__hhh) + " to atoms.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は朦朧となって死んだ。", name(__hhh) + " resonate" + _s(__hhh) + " and break up.")
		}
		return
	}
	if (__iii == 63) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は酸に焼かれた。", name(__hhh) + " " + is(__hhh) + " burnt by acid.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("ドロドロに溶かした。", "melt" + _s(__ggg) + " " + him(__hhh) + " away.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は酸に焼かれ溶けた。", name(__hhh) + " melt" + _s(__hhh) + ".")
		}
		return
	}
	if (__iii == 61) {
		if (__fff == 0) {
			if (synccheck(__hhh, -1)) {
				txt -1, lang(name(__hhh) + "は切り傷を負った。", name(__hhh) + " get" + _s(__hhh) + " a cut.")
			}
		}
		if (__fff == 1) {
			txt -1, lang("千切りにした。", "cut" + _s(__ggg) + " " + him(__hhh) + " into thin strips.")
		}
		if (__fff == 2) {
			txt -1, lang(name(__hhh) + "は千切りになった。", name(__hhh) + " " + is(__hhh) + " cut into thin strips.")
		}
		return
	}
	if (__fff == 0) {
		if (synccheck(__hhh, -1)) {
			txt -1, lang(name(__hhh) + "は傷ついた。", name(__hhh) + " " + is(__hhh) + " wounded.")
		}
	}
	if (__fff == 1) {
		txt -1, lang("殺した。", "kill" + _s(__ggg) + " " + him(__hhh) + ".")
	}
	if (__fff == 2) {
		txt -1, lang(name(__hhh) + "は死んだ。", name(__hhh) + " " + is(__hhh) + " killed.")
	}
	return

#include "dmg.hsp"

#deffunc actionsp int __www, int __xxx
	if (__www != 0) {
		return 1
	}
	if (cSp(__www) < 50) {
		if (cSp(__www) < rnd(75)) {
			dmgsp __www, __xxx
			return 0
		}
	}
	dmgsp __www, __xxx
	return 1



#deffunc advfavoriteskill int __yyy
	randomize __yyy
	rtval = 0
	i@m145 = 0
	repeat
		rtval(i@m145) = rnd(400 - 100) + 100
		if (sdataref(0, rtval(i@m145)) == 0) {
			continue
		}
		i@m145++
		if (i@m145 >= 2) {
			break
		}
	loop
	randomize
	return i@m145



#deffunc advfavoritestat int __zzz
	randomize __zzz
	i@m145 = rnd(18 - 10) + 10
	randomize
	return i@m145



#deffunc modweight int __cc, int __delta, int __ignoreMax
	// 変異保護エンチャントを持っているなら変動無効
	if (encfind(__cc, 33) != -1) {
		return
	}

	min@m146 = cHeight(__cc) * cHeight(__cc) * 18 / 25000
	max@m146 = cHeight(__cc) * cHeight(__cc) * 24 / 10000
	if (cWeight(__cc) < min@m146) {
		cWeight(__cc) = min@m146
		return
	}
	if (__ignoreMax == 0 & __delta > 0) {
		if (cWeight(__cc) > max@m146) {
			return
		}
	}
	cWeight(__cc) = cWeight(__cc) * (100 + __delta) / 100 + (__delta > 0) - (__delta < 0)
	if (cWeight(__cc) < 0) {
		cWeight(__cc) = 0
	}
	if (synccheck(__cc, -1)) {
		if (__delta > 2) {
			txt -1, lang(name(__cc) + "は太った。", name(__cc) + " gain" + _s(__cc) + " weight.")
			ctalk __cc, 1385, __cc, __cc
		}
		if (__delta < (-2)) {
			txt -1, lang(name(__cc) + "は痩せた。", name(__cc) + " lose" + _s(__cc) + " weight.")
			ctalk __cc, 1386, __cc, __cc
		}
	}
	return



#deffunc modheight int __cc, int __delta
	// 変異保護エンチャントを持っているなら変動無効
	if (encfind(__cc, 33) != -1) {
		return
	}

	cHeight(__cc) = cHeight(__cc) * (100 + __delta) / 100 + (__delta > 0) - (__delta < 0)
	if (cHeight(__cc) < 0) {
		cHeight(__cc) = 0
	}
	if (synccheck(__cc, -1)) {
		if (__delta > 0) {
			txt -1, lang(name(__cc) + "の身長は少し伸びた。", name(__cc) + " grow" + _s(__cc) + " taller.")
			ctalk __cc, 1387, __cc, __cc
		}
		if (__delta < 0) {
			txt -1, lang(name(__cc) + "の身長は少し縮んだ。", name(__cc) + " grow" + _s(__cc) + " smaller.")
			ctalk __cc, 1388, __cc, __cc
		}
	}
	return



#deffunc cure_anorexia int __fff
	if (cbit(986, __fff) == 0) {
		return
	}
	cbitmod 986, __fff, 0
	if (synccheck(__fff, -1) | petcheck(__fff)) {
		txt -1, lang(name(__fff) + "の拒食症は治った。", name(__fff) + " manage" + _s(__fff) + " to recover from anorexia.")
		snd 65
	}
	return



#deffunc chara_vomit int __ggg
	cAnorexiaCount(__ggg)++
	if (synccheck(__ggg, -1)) {
		snd 104
		if (cbit(978, __ggg)) {
			ctalk __ggg, 1294, __ggg, __ggg
		} else {
			ctalk __ggg, 1293, __ggg, __ggg
		}
		txt -1, lang(name(__ggg) + "は吐いた。", name(__ggg) + " vomit" + _s(__ggg) + ".")
	}
	if (cbit(978, __ggg)) {
		cbitmod 978, __ggg, 0
		if (ocdata(52, __ggg) == 330) {
			if (synccheck(__ggg, -1)) {
				txt -1, lang(name(__ggg) + "は体内のエイリアンを吐き出した！", name(__ggg) + " spit" + _s(__ggg) + " alien children from " + his(__ggg) + " body!")
			}
		} else {
			if (synccheck(__ggg, -1)) {
				txt -1, lang(name(__ggg) + "は体内の何かを吐き出した！", name(__ggg) + " spit" + _s(__ggg) + " something from " + his(__ggg) + " body!")
			}
		}
		ocdata(52, __ggg) = 0
		ocdata(53, __ggg) = 0
	}
	if (ocdata(192 + 0 * 3, __ggg) != 0) {
		repeat 8 + 8
			if (ocdata(192 + cnt * 3, __ggg) == 0) {
				break
			}
			if (bdataref(0, ocdata(192 + cnt * 3, __ggg)) == 3) {
				delbuff __ggg, cnt
				continue cnt
			}
		loop
	}
	if (mapType != 1) {
		inv_getheader -1
		p@m146 = 2
		repeat invrange, invhead
			if (iNumber(cnt) > 0) {
				if (iId(cnt) == 704) {
					p@m146++
				}
			}
		loop
		if (rnd(p@m146 * p@m146 * p@m146) == 0 | __ggg == 0) {
			flt
			itemcreate -1, 704, cX(__ggg), cY(__ggg), 0
			if (stat != 0) {
				if (__ggg != 0) {
					iSubname(ci) = cId(__ggg)
					if (iSubname(ci) == 343) {
						inv(33, ci) = cCnpcId(__ggg)
						inv(34, ci) = createserialno(userdatan(0, cCnpcId(__ggg)))
					}
					if (ogdata(460) == 2) {
						if (iNumber(0) != 0) {
							if (iId(0) == 685) {
								if (iSubname(0) != 319) {
									iSubname(0) = cId(__ggg)
									if (iSubname(0) == 343) {
										inv(33, 0) = cCnpcId(__ggg)
										inv(34, 0) = createserialno(userdatan(0, cCnpcId(__ggg)))
									}
									if (iSubname(0) == 319 | iSubname(0) == 368) {
										iSubname(0) = 176
									}
								}
							}
						}
					}
				}
			}
		}
	}
	if (cbit(986, __ggg) == 0) {
		if (petcheck(__ggg) & cAnorexiaCount(__ggg) > 10 | (__ggg >= 16 & cRole(__ggg) != 10001 & cRole(__ggg) != 10018 & eqfaction(__ggg, "petshop") == 0 & rnd(4) == 0)) {
			if (rnd(5) == 0) {
				cbitmod 986, __ggg, 1
				if (synccheck(__ggg, -1)) {
					txt -1, lang(name(__ggg) + "は拒食症になった。", name(__ggg) + " develop" + _s(__ggg) + " anorexia.")
					snd 65
				}
			}
		}
	} else {
		skillmod 10, __ggg, -50
		skillmod 11, __ggg, -75
		skillmod 17, __ggg, -100
	}
	dmgcon __ggg, 7, 100
	modweight __ggg, (1 + rnd(5)) * (-1)
	if (cNutrition(__ggg) <= 0) {
		dmghp __ggg, 9999, -3
	}
	cNutrition(__ggg) -= 3000
	return



#deffunc eatstatus int __hhh, int __iii
	if (cState(__iii) != 1) {
		return
	}
	if (__hhh <= (-1) & trophycheck(20) != 2) {
		cNutrition(__iii) -= 1500
		if (synccheck(__iii, -1)) {
			txt -1, lang(name(__iii) + "は嫌な感じがした。", name(__iii) + " feel" + _s(__iii) + " bad.")
		}
		chara_vomit __iii
	}
	if (__hhh >= 1) {
		if (synccheck(__iii, -1)) {
			txt -1, lang(name(__iii) + "は良い予感がした。", name(__iii) + " feel" + _s(__iii) + " good.")
		}
		if (rnd(5) == 0) {
			addbuff __iii, 19, 100, 500 + rnd(500)
		}
		if (godcheck(__iii) != "danalin") {
			healsan __iii, 2
		}
	}
	return



#deffunc chara_anorexia int __jjj
	if (cbit(986, __jjj) == 0) {
		return 0
	}
	chara_vomit __jjj
	return 1



#deffunc sickifcursed int __kkk, int __lll, int __mmm
	if (__kkk <= (-1)) {
		if (rnd(__mmm + (__mmm == 0)) == 0) {
			if (synccheck(__lll, -1)) {
				txt -1, lang(name(__lll) + "は気分が悪くなった。", name(__lll) + " feel" + _s(__lll) + " grumpy.")
			}
			dmgcon __lll, 12, 200
		}
	}
	return

#deffunc net_send str __nnn, int __ooo
	if (cfg_net == 0) {
		return 0
	}
	chattemp = __nnn
	if (__ooo == 0) {
		fix_input_chat2 chattemp
	}
	fix_input_chat chattemp
	if (__ooo == 0) {
		url@m147 = chatsendurl
		msg@m147 = "&comment=" + chattemp
	} else {
		if (gWizard) {
			return 1
		}
	}
	conurl@m147 = "hpcgi3.nifty.com"
	if (__ooo == 1) {
		conurl@m147 = cfg_hostname
		url@m147 = "http://" + cfg_hostname + "/eln/?mode=vote"
		msg@m147 = "&vote=" + chattemp
	}
	if (__ooo == 2) {
		conurl@m147 = cfg_hostname
		url@m147 = "http://" + cfg_hostname + "/eln/?mode=vote"
		msg@m147 = "&namber=" + chattemp
	}
	if (__ooo == 0) {
		conurl@m147 = cgiurl2
	}
	sockopen 0, conurl@m147, 80
	if (stat) {
		sockclose
		txt -1, "[" + stat + "]" + lang("ネットに繋がっていない。", "You need an internet connection.")
		return 0
	}
	sockput "GET " + url@m147 + msg@m147 + " HTTP/1.0\nHost:" + cfg_hostname + "???\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows 98; Win 9x 4.90)\n\n"
	if (stat) {
		sockclose
		txt -1, lang("送信に失敗した。", "Failed to send a message.")
		return 0
	}
	sockclose
	return 1



#include "net.hsp"

#defcfunc magiclv
	a = 0
	repeat 67
		if (cnt != 26 & cnt != 27) {
			if (sdata(1000 + cnt, 0) < 2000000000) {
				a = 1
				break
			}
		}
	loop
	if (a == 1) {
		a = 0
		return 0
	}
return 1

#defcfunc carmor int __uuu
	if (cSumOfEquipmentWeight(__uuu) >= 35000) {
		return 169
	} else {
		if (cSumOfEquipmentWeight(__uuu) >= 15000) {
			return 170
		} else {
			return 171
		}
	}



#defcfunc cnveqweight int __vvv
	if (cSumOfEquipmentWeight(__vvv) >= 35000) {
		return lang("(重装備)", "(Heavy)")
	} else {
		if (cSumOfEquipmentWeight(__vvv) >= 15000) {
			return lang("(中装備)", "(Medium)")
		} else {
			return lang("(軽装備)", "(Light)")
		}
	}



#defcfunc getgametime
	return gHour + gDay * 24 + gMonth * 24 * 30 + gYear * 24 * 30 * 12



#defcfunc limitaddition int __www, int __xxx
	if (__www > 2147483647 - __xxx) {
		return 2147483647
	} else {
		return __www + __xxx
	}



#defcfunc calcexpalive int __yyy
	return __yyy * 100


*refreshSpeedPenaltyByTooManyBodyParts
	cSpeedCorrectionValue(r1) = 0
	repeat 30, 100
		if (cdata(cnt, r1) != 0) {
			cSpeedCorrectionValue(r1)++
		}
	loop
	if (cSpeedCorrectionValue(r1) > 13) {
		cSpeedCorrectionValue(r1) = (cSpeedCorrectionValue(r1) - 13) * 5
	} else {
		cSpeedCorrectionValue(r1) = 0
	}
	return


#module
// Find an empty body part slot. If not found, returns -1.
#defcfunc findEmptyBodyPartSlot int __cc
	slot = -1
	repeat 30, 100
		if (cdata@(cnt, __cc) == 0) {
			slot = cnt
			break
		}
	loop
	return slot


// Select a new body part at random. Body, Shot, and Ammo are never selected.
#defcfunc selectNewBodyPartAtRandom
	bodyParts = 1, 2, 3, 5, 6, 7, 8, 9
	return bodyparts(rnd(length(bodyparts)))
#global

*gainNewBodyPart
	newSlot@tmp = findEmptyBodyPartSlot(r1)
	if (newSlot@tmp == -1) {
		return
	}
	newBodyPart@tmp = selectNewBodyPartAtRandom()
	cdata(newSlot@tmp, r1) = newBodyPart@tmp * 10000
	if (cm == 0) {
		txt -1, lang(name(r1) + "の身体から新たな" + bodyn(newBodyPart@tmp) + "が生えてきた！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(newBodyPart@tmp) + "!")
	}
	gosub *refreshSpeedPenaltyByTooManyBodyParts
	return


*label_0661
	cExperience(r1) -= cRequiredExperience(r1)
	if (cExperience(r1) < 0) {
		cExperience(r1) = 0
	}
	cLevel(r1)++
	if (cRole(r1) != 13) {
		if (r2 == 0) {
			txtef 2
			if (r1 == 0) {
				txt -1, lang(name(r1) + "はレベル" + cLevel(r1) + "になった！", name(r1) + " have gained a level.")
			} else {
				txt -1, lang(name(r1) + "は成長した。", name(r1) + " " + have(r1) + " grown up.")
			}
		}
	} else {
		addnews 2, r1
	}
	if (cLevel(r1) \ 5 == 0) {
		if (cMaxLevel(r1) < cLevel(r1)) {
			if (cLevel(r1) <= 50) {
				if (r1 == 0) {
					gAcquirableFeatCount++
				} else {
					if (petcheck(r1)) {
						ocdata(105, r1)++
					}
				}
			}
		}
	}
	if (r1 == 0) {
		gosub *label_0726
	}

	chara_gainSkillBonus r1

	if (cdatan(2, r1) == "mutant" | gettrait(r1, 0) == 1) {
		if (cLevel(r1) < 37) {
			if (cLevel(r1) \ 3 == 0) {
				if (cMaxLevel(r1) < cLevel(r1)) {
					gosub *gainNewBodyPart
				}
			}
		}
	}
	if (cMaxLevel(r1) < cLevel(r1)) {
		cMaxLevel(r1) = cLevel(r1)
	}
	if (r1 >= 56 & cRole(r1) != 10001 & cRole(r1) != 10018 & eqfaction(r1, "petshop") == 0) {
		gosub *label_0662
	}
	gosub *label_0663
	gosub *chara_refresh
	if (r1 < 16) {
		throwsstpevent "LevelUp", r1, "", 0
	}
	return



*label_0662
	repeat 20 - 10, 10
		sdata(cnt + 600, r1) = limit(sdata(cnt + 600, r1) + 1000000 * rnd(3), 1, 2000 * 1000000)
	loop
	repeat length(mainskill)
		sdata(mainskill(cnt) + 600, r1) = limit(sdata(mainskill(cnt) + 600, r1) + 1000000 * rnd(3), 1, 2000 * 1000000)
	loop
	return
*label_0663
	cRequiredExperience(r1) = limit(cLevel(r1), 1, 200) * (limit(cLevel(r1), 1, 200) + 1) * (limit(cLevel(r1), 1, 200) + 2) * (limit(cLevel(r1), 1, 200) + 3) + 3000
	if (cRequiredExperience(r1) > 100000000 | cRequiredExperience(r1) < 0) {
		cRequiredExperience(r1) = 100000000
	}
	return
*label_0664
	skillexp2 163, 0, 100
	return
*label_0665
	skillexp2 150, cc, (10 + sdataref(4, efid) / 60) * r4, 10, 100
	return
*label_0666
	if (r2 >= (sdata(156, r1) + 10) * (sdata(156, r1) + 10)) {
		skillexp2 156, r1, limit(r2 * r2 / (sdata(156, r1) * 5 + 10), 10, 1000), 10
	}
	return
*label_0667
	skillexp2 158, r1, 100 + limitmax(r2 * 3 / 2, 3000)
	return
*label_0668
	skillexp2 159, cc, gCurrentDungeonLevel * 2 + 20
	return
*label_0669
	if (r1 == 0) {
		if (r2 >= 550 & r2 <= 599) {
			userspellexp r2 - 550, r1, sdataref(2, r2) / 3 + 20, 4, 5
			skillexp2 172, r1, sdataref(2, r2) / 12 + 10, 5
		} else {
			skillexp2 r2, r1, sdataref(2, r2) * 4 + 20, 4, 5
			skillexp2 172, r1, sdataref(2, r2) + 10, 5
		}
	} else {
		skillexp2 172, r1, sdataref(2, r2) + 10, 5
	}
	return
*label_0670
	skillexp2 164, r1, abs(cMp(r1)) * 200 / (cMaxMp(r1) + 1)
	return
*label_0671
	if (cHp(r1) != cMaxHp(r1)) {
		if (sdata(154, r1) < sdata(11, r1)) {
			skillexp2 154, r1, 5 + sdata(154, r1) / 5, 1000
		}
	}
	if (cMp(r1) != cMaxMp(r1)) {
		if (sdata(155, r1) < sdata(16, r1)) {
			skillexp2 155, r1, 5 + sdata(155, r1) / 5, 1000
		}
	}
	return
*label_0672
	if (mapType == 1) {
		if (rnd(20)) {
			return
		}
	}
	skillexp2 157, r1, 2, 0, 1000
	return
	if (mapType == 1) {
		if (rnd(20)) {
			return
		}
	}
	skillexp2 301, cc, 2, 0, 1000
	return
*label_0673
	skillexp2 160, 0, 600
	return
*label_0674
	skillexp2 183, cc, r1, 0, 0
	return
*label_0675
	if (r2 == 0) {
		return
	}
	if (mapType == 1) {
		if (rnd(20)) {
			return
		}
	}
	skillexp2 153, r1, r2 * 4, 0, 1000
	return
*label_0676
	skillexp2 174, cc, 40
	return
*label_0677
	skillexp2 185, cc, 100 + r1 * 5
	return
*label_0678
	skillexp2 165, cc, (10 + sdataref(4, efid) / 5) * r4
	return
*label_0679
	skillexp2 r1, cc, 50 + r2
	return



#defcfunc calcattackhit int __zzz
	critical = 0
	if (attackskill == 106) {
		tohitorg = sdata(12, cc) / 5 + sdata(10, cc) / 2 + sdata(attackskill, cc) + 50
		tohitfix = sdata(12, cc) / 5 + sdata(10, cc) / 10 + cHitBonus(cc)
		pierce = limit(sdata(attackskill, cc) / 5, 5, 50)
		if (cEquipmentType(cc) & 1) {
			tohitorg = tohitorg * 100 / 130
		}
	} else {
		tohitorg = sdata(12, cc) / 4 + refattackskill(iSkill(cw), cc) / 3 + refattackskill(attackskill, cc) + 50
		tohitfix = cHitBonus(cc) + iHitBonus(cw)
		if (ammo != (-1)) {
			tohitfix += iHitBonus(ammo)
		}
		calcweaponfix iId(cw), cw
		if (attackskill == 109) {
			pierce += limit((sdata(attackskill, cc) - 500) / 10, 5, 200)
		} else {
			if (attackskill == 108) {
				if (gettrait(cc, 85)) {
					tohitfix += int(sqrt(sdata(108, cc)) + calc3traitmulti(stat, sdata(108, cc)))
				}
				if (gettrait(cc, 66)) {
					if (stat == 3) {
						repeat 5, 5
							rangemap_pow(cnt) += 50
							rangemap_hit(cnt) += 50
						loop
					} else {
						if (stat == 2) {
							repeat 5, 5
								rangemap_pow(cnt) += 30
								rangemap_hit(cnt) += 30
							loop
						} else {
							repeat 5, 5
								rangemap_pow(cnt) += 10
								rangemap_hit(cnt) += 10
							loop
						}
					}
				}
			} else {
				if (attackskill == 111) {
					if (gettrait(cc, 87)) {
						if (stat == 3) {
							repeat 2, 2
								rangemap_pow(cnt) += 30
								rangemap_hit(cnt) += 30
							loop
						} else {
							if (stat == 2) {
								rangemap_pow(2) += 30
								rangemap_hit(2) += 30
								rangemap_pow(3) += 10
								rangemap_hit(3) += 10
							} else {
								rangemap_pow(2) += 10
								rangemap_hit(2) += 10
							}
						}
					}
				}
			}
		}
	}
	if (nc_gettrait(cc, 103) > 0) {
		repeat 10
			rangemap_pow(cnt) = limitmin(rangemap_pow(cnt), 100)
		loop
	}
	if (nc_gettrait(cc, 104) > 0) {
		repeat 10
			rangemap_hit(cnt) = limitmin(rangemap_hit(cnt), 100)
		loop
	}
	tohit = tohitorg + tohitfix
	if (attackskill != 106) {
		if (attackrange) {
			if (__zzz == 0) {
				rangedist = limit(dist(cX(cc), cY(cc), cX(tc), cY(tc)) - 1, 0, 9)
				tohit = tohit * rangemap_hit(rangedist) / 100
			}
		} else {
			if (cEquipmentType(cc) & 2) {
				tohit += 25
				if (iWeight(cw) >= 4000) {
					tohit += sdata(167, cc)
				}
			}
			if (cEquipmentType(cc) & 4) {
				if (attacknum == 1) {
					if (iWeight(cw) >= 4000) {
						tohit -= (iWeight(cw) - 4000 + 400) / (10 + sdata(166, cc) / 5)
					}
				} else {
					if (iWeight(cw) > 1500 + gettrait(cc, 19) * 500) {
						tohit -= (iWeight(cw) - 1500 + 100) / (10 + sdata(166, cc) / 5)
					}
				}
			}
		}
	}
	if (gMount != 0 | ocdata(106, cc) != 0 | ocdata(107, cc) != 0) {
		if (cc == 0 | ocdata(106, cc) != 0) {
			tohit = tohit * 100 / limit(150 - sdata(301, cc) / 2, 115, 150)
			if (attackskill != 106) {
				if (attackrange == 0) {
					if (iWeight(cw) >= 4000) {
						tohit -= (iWeight(cw) - 4000 + 400) / (10 + sdata(301, cc) / 5)
					}
				}
			}
		}
		if (cc == gMount | ocdata(107, cc) != 0) {
			tohit = tohit * 100 / limit(150 - sdata(10, cc) / 2, 115, 150)
			if (attackskill != 106) {
				if (attackrange == 0) {
					if (iWeight(cw) >= 4000) {
						tohit -= (iWeight(cw) - 4000 + 400) / (10 + sdata(10, cc) / 10)
					}
				}
			}
		}
	}
	if (attackskill != 106) {
		if (attacknum > 1) {
			twohit = 100 - (attacknum - 1) * (10000 / (100 + sdata(166, cc) * 10))
			if (tohit > 0) {
				tohit = tohit * twohit / 100
			}
		}
	}
	if (__zzz == 1) {
		return tohit
	}
	evade = sdata(13, tc) / 3 + sdata(173, tc) + cDv(tc) + 25
	if (__zzz == 2) {
		return evade
	}
	if (cDimmed(tc) != 0) {
		if (rnd(4) == 0) {
			critical = 1
			return 1
		}
		evade /= 2
	}
	if (cBlind(cc) != 0) {
		tohit /= 2
	}
	if (cBlind(tc) != 0) {
		evade /= 2
	}
	if (cSleep(tc) != 0 | cStoned(tc) != 0) {
		return 1
	}
	if (multicritical) {
		critical = 1
		return 1
	}
	if (cConfused(cc) != 0 | cDimmed(cc) != 0) {
		if (attackrange) {
			tohit /= 5
		} else {
			tohit = tohit / 3 * 2
		}
	}
	if (sdata(187, tc) - sdata(187, cc) > 0) {
		if (tohit < (sdata(187, tc) - sdata(187, cc)) * 10) {
			evaderef = evade * 100 / limit(tohit, 1, tohit)
			if (evaderef > 300) {
				if (rnd(sdata(187, tc) - sdata(187, cc) + 250) > 100) {
					return -2
				}
			}
			if (evaderef > 200) {
				if (rnd(sdata(187, tc) - sdata(187, cc) + 250) > 150) {
					return -2
				}
			}
			if (evaderef > 150) {
				if (rnd(sdata(187, tc) - sdata(187, cc) + 250) > 200) {
					return -2
				}
			}
		}
	}
	if (rnd(5000) < sdata(13, cc) + 50) {
		critical = 1
		return 1
	}
	if (cRateOfCriticalHit(cc) > rnd(200) | findbuff(cc, 87) != (-1)) {
		critical = 1
		return 1
	}
	if (rnd(20) == 1) {
		return -1
	}
	if (rnd(20) == 0) {
		return 1
	}
	if (tohit < 1) {
		return -1
	}
	if (evade < 1) {
		return 1
	}
	if (rndex(tohit) > rndex(evade * 3 / 2)) {
		return 1
	}
	return -1



#defcfunc calcattackdmg int __aaa
	if (attackskill == 106) {
		dmgfix = sdata(10, cc) / 8 + sdata(106, cc) / 8 + cDamageBonus(cc)
		dice1 = 2
		dice2 = sdata(106, cc) / 8 + 5
		dmgmulti = 0.5 + double(sdata(10, cc) + sdata(attackskill, cc) / 5 + sdata(152, cc) * 2) / 40
	} else {
		dmgfix = cDamageBonus(cc) + iDamageBonus(cw) + (iCurseState(cw) == 1)
		dice1 = iDiceX(cw)
		dice2 = iDiceY(cw)
		if (ammo != (-1)) {
			dmgfix += iDamageBonus(ammo) + iDiceX(ammo) * iDiceY(ammo) / 2
			if (iId(cw) == 230) {
				p(62) = 152
			} else {
				p(62) = 189
			}
			dmgmulti = 0.5 + double(sdata(13, cc) + calcattackskil(sdata(attackskill, cc) / 4, ammo) + calcattackskil(sdata(iSkill(cw), cc), cw) + calcattackskil(sdata(attackskill, cc), cw) + sdata(p(62), cc) * 3 / 2) / 40
		} else {
			dmgmulti = 0.6 + double(sdata(10, cc) + calcattackskil(refattackskill(iSkill(cw), cc), cw) + calcattackskil(refattackskill(attackskill, cc), cw) + sdata(152, cc) * 2) / 45
		}
	}
	if (attackrange) {
		if (__aaa == 0) {
			if (efid == 762) {
				dmgmulti = dmgmulti * double(cPietyPoint(cc) * 3 / 10000)
			} else {
				if (efid == 766) {
					dmgmulti = dmgmulti * double(rounds * double(cPietyPoint(cc)) * 3 / 10000)
				}
			}
			dmgmulti = dmgmulti * rangemap_pow(rangedist) / 100
		}
	} else {
		f@m157 = carmor(cc)
		if (f@m157 == 169) {
			dmgmulti += dmgmulti / (5 + (cc != 0) * 10)
		}
		if (f@m157 == 170) {
			dmgmulti += dmgmulti / (10 + (cc != 0) * 20)
		}
		if (attackskill != 106) {
			if (cEquipmentType(cc) & 2) {
				if (iWeight(cw) >= 4000) {
					dmgmulti *= 1.5
				} else {
					dmgmulti *= 1.2
				}
				dmgmulti += 0.03 * sdata(167, cc)
			}
		} else {
			if (gettrait(cc, 20)) {
				dmgmulti += calc5traitmulti(stat, dmgmulti)
			}
		}
	}
	if (gettrait(cc, 207)) {
		dmgfix += sqrt(cLevel(cc)) + limitmax(cLevel(cc), 10000) * 2 / 3
	}
	if (attackskill != 106) {
		if (attackskill >= 100 & attackskill <= 111) {
			if (gettrait(cc, attackskill - 54)) {
				dmgmulti += calc5traitmulti(stat, dmgmulti)
			}
		}
	}
	if (findbuff(cc, 84) != (-1)) {
		if (attackskill != 106) {
			if (iId(cw) == 759) {
				dmgfix += ocdata(192 + findbuff(cc, 84) * 3 + 1, cc) / 10000
			}
		}
	}
	if (findbuff(cc, 96) != (-1)) {
		if (attackskill == 101) {
			dmgfix += limitmax(ocdata(192 + findbuff(cc, 96) * 3 + 1, cc) / 200, 500)
		}
	}
	if (__aaa == 1) {
		return damage
	}
	prot = cPv(tc) + sdata(carmor(tc), tc) + sdata(12, tc) / 10
	if (prot > 0) {
		prot2 = prot / 4
		protdice1 = prot2 / 10 + 1
		if (protdice1 < 0) {
			protdice1 = 1
		}
		protdice2 = prot2 / protdice1 + 2
		protfix = 0
	} else {
		prot2 = 0
		protdice1 = 1
		protdice2 = 1
		protfix = 0
		prot = 0
	}
	if (__aaa == 2) {
		return prot
	}
	if (dmgfix < (-100)) {
		dmgfix = -100
	}
	if (efid == 771) {
		dmgmulti = dmgmulti * double(limitmin((cMaxHp(cc) * (cPietyPoint(cc) / 10000) - cHp(cc)) / 30, 1))
	} else {
		if (efid == 773) {
			dmgfix = dmgmulti * double(cPietyPoint(cc) * 3 / 10000)
		}
	}
	if (efid == sId_angryblow) {
		efid = 0
		dmgfix = (role(dice1, dice2, dmgfix) * 3)
	}
	if (efid == sId_blowofconfidence) {
		efid = 0
		dice1 += (dice1 * 0.1) * iQuality(cw)
		dice2 += (dice1 * 0.1) * iQuality(cw)
		dmgfix += (dmgfix * 0.2) * iQuality(cw)
	}
	if (efid == sId_fightstep) {
		efid = 0
		dice1 = (dice1 / 2) + 1
		dice2 = (dice2 / 2) + 1
	}
	if (cSleep(tc) > 0) {
		if (gettrait(cc, 96)) {
			dmgmulti = dmgmulti * double(1 + calctraitscore(stat))
		}
	}
	lint_damage = longint(role(dice1, dice2, dmgfix))
	if (critical) {
		lint_damage = longint(rolemax(dice1, dice2, dmgfix))
		if (attackskill == 106) {
			pierce += calcknucklepierce(cc)
			dmgmulti *= 1.25
		} else {
			if (ammo != (-1)) {
				dmgmulti = dmgmulti * limit(iWeight(ammo) / 100 + 100, 100, 150) / 100
			} else {
				dmgmulti = dmgmulti * limit(iWeight(cw) / 200 + 100, 100, 150 + calcweightmulti(cc)) / 100
			}
		}
		if (nc_gettrait(cc, 100) > 0) {
			dmgmulti *= 1.5
		}
	}
	lint_damage = dmgmulti * lint_damage
	if (lint_damage > 2000000000) {
		lint_damage = 2000000000
	}
	if (cc == 0) {
		if (ogdata(442) == 2) {
			if (rnd(30) == 0) {
				prot /= 2
				txtef 5
				txt -1, lang(" *キッ* ", " *leer* ")
			}
		}
	}
	if (oabit(8, gCurrentMap)) {
		return 0
	}
	if (cRateToPierce(cc) > rnd(100)) {
		pierce += 100
		if (synccheck(cc, -1)) {
			ctalk cc, 1345, cc, tc
			if ( stat == 0 ) {
				txtef 5
				txt -1, lang(" *シャキーン* ", "*vopal*")
			}
		}
	}
	if (attackrange == 1) {
		if (ammoproc == 2) {
			pierce += 60
			if (synccheck(cc, -1)) {
				ctalk cc, 1346, cc, tc
				if ( stat == 0 ) {
					txtef 5
					txt -1, lang(" *ズバシュッ* ", "*vopal*")
				}
			}
		}
		if (ammoprocbk == 0) {
			lint_damage /= 2
		}
		if (ammoprocbk == 5) {
			lint_damage /= 3
		}
		if (ammoproc == 3) {
			lint_damage /= 10
		}
	}
	pierce += calcpiercefix(attackskill, cc, tc, cw)
	if (gettrait(cc, 60) == 1) {
		s = refchara(cId(tc), 8, 1)
		if (instr(s, 0, "/wild/") != (-1)) {
			pierce += 20
		}
	}
	if (gettrait(cc, 61) == 1) {
		s = refchara(cId(tc), 8, 1)
		if (instr(s, 0, "/demon/") != (-1)) {
			pierce += 20
		}
	}
	if (gettrait(cc, 98) == 1) {
		s = refchara(cId(tc), 8, 1)
		if (instr(s, 0, "/element/") != (-1)) {
			pierce += 20
		}
	}
	if (findbuff(cc, 84) != (-1)) {
		if (attackskill != 106) {
			if (iId(cw) == 759) {
				pierce = 200
			}
		}
	}
	damagepierce = limitmax(lint_damage * pierce / 200, 2000000000)
	damagenormal = limitmax(lint_damage - absf(damagepierce), 2000000000)
	if (prot > 0) {
		damagenormal = damagenormal * 100 / (100 + prot) - role(protdice1, protdice2, protfix)
		if (damagenormal < 0.0) {
			damagenormal = 0.0
		}
	}
	lint_damage = damagenormal
	if (damagepierce > 0) {
		lint_damage += damagepierce
	}
	/*オパートスフィート*/
	if (gettrait(tc, 164) != 0) {
		lint_damage = lint_damage * 95 / 100
	}
	if (cDecreasePhysicalDamage(tc) != 0) {
		lint_damage = lint_damage * 100 / limit(100 + cDecreasePhysicalDamage(tc), 25, 1000)
	}
	if (lint_damage < 0.0) {
		lint_damage = 0.0
	}
	if (ogdata(505) == 2) {
		overdamage = 0
		if (lint_damage > 20000000) {
			// 20000000以降のダメージは直接加算
			overdamage = limit(lint_damage - 20000000, 0, 1980000000)
		}
		orgdmg = limit(lint_damage, 0, 2000000000)
	} else {
		orgdmg = limit(lint_damage, 0, 20000000)
	}
	return limit(lint_damage, 0, 20000000)



#deffunc cnvbonus int __bbb, int __ccc
	if (__bbb >= 50 & __bbb < 61) {
		if (__ccc > 0) {
			buff += "　　" + skillname(__bbb) + "耐性に <green>クラス" + __ccc / 50 + "<col>(" + __ccc + ") のボーナス\n"
		}
		if (__ccc < 0) {
			buff += "　　" + skillname(__bbb) + "耐性に <red>クラス" + __ccc / 50 + "<col>(" + __ccc + ") のマイナス修正\n"
		}
	} else {
		if (__ccc > 0) {
			buff += "　　" + skillname(__bbb) + "に <green>+" + __ccc + "<col> のボーナス\n"
		}
		if (__ccc < 0) {
			buff += "　　" + skillname(__bbb) + "に <red>" + __ccc + "<col> のマイナス修正\n"
		}
	}
	return


*chara_refresh
	chararefreshhack = 1
	if (r1 == 0) {
		gSevenLeagueBootEffect = 0
		gEtherDiseaseSpeed = 0
		gProtectsFromEtherwind = 0
		gProtectsFromBadWeather = 0
		gdata(89) = 70
		gCatchesGodSignal = 0
		gRevealsReligion = 0
	}
	repeat 600
		sdata(cnt, r1) = sorgEx(cnt, r1)
	loop
	if (cdata(158, r1) == 0) {
		gosub *label_1523
	}
	if (r1 == 0 & have_bigench(0, 6) == 0) {
		if (ocdata(140, 0) >= 2000) {
			if (ocdata(140, 0) < 4000) {
				p(45) = 1
			} else {
				if (ocdata(140, 0) < 6000) {
					p(45) = 3
				} else {
					p(45) = 5
				}
			}
			repeat 8, 10
				sdata(cnt, 0) -= sdata(cnt, 0) * p(45) / 10
			loop
		}
		memset cdata(450, r1), 0, 30 * 4
	} else {
		if (cId(r1) == 343) {
			memcpy cdata(450, r1), userdata(40, cCnpcId(r1)), 30 * 4
		} else {
			if (cId(r1) != 336) {
				memcpy cdata(450, r1), cbitorg(0, cId(r1)), 30 * 4
			} else {
				if (ocbit(7, r1) == 0) {
					memcpy cdata(450, r1), cbitorg(0, cId(r1)), 30 * 4
				}
			}
		}
	}
	if (gettrait(r1, 161) != 0) {
		repeat 30, 100
			dup roopbuf, cdata(cnt, r1)
			if (roopbuf \ 10000 == 0) {
				continue
			}
			rp = roopbuf\ 10000 - 1
			if (iWeight(rp) >= 1000) {
				roopbuf = roopbuf / 10000 * 10000
				iBodyPart(rp) = 0
			}
		loop
	}
	repeat 10
		if (racebit(cnt, cdata(158, r1)) == 0) {
			break
		}
		cbitmod racebit(cnt, cdata(158, r1)), r1, 1
	loop
	repeat 10, 10
		cdata(270 + cnt - 10, r1) = 0
	loop
	nc_armorbonus = nc_gettrait(r1, 102)
	nc_armorcount = 0
	cDv(r1) = 0
	cPv(r1) = 0
	cHitBonus(r1) = 0
	cDamageBonus(r1) = 0
	cEquipmentType(r1) = 0
	attacknum = 0
	cRateToPierce(r1) = 0
	cRateOfCriticalHit(r1) = 0
	cCursePower(r1) = 0
	cExtraAttack(r1) = 0
	cExtraShot(r1) = 0
	cSumOfEquipmentWeight(r1) = 0
	cDecreasePhysicalDamage(r1) = 0
	cNullifyDamage(r1) = 0
	cCutCounterattack(r1) = 0
	cAphropower(r1) = 0
	cSPboost(r1) = 0
	if (findbuff(r1, 63) != (-1)) {
		cNullifyDamage(r1) = 50
	}
	p(69) = 1
	// エンチャント封印計算
	nc_intb_noench = findbuff(r1, 62)
	repeat 30, 100
		dup roopbuf, cdata(cnt, r1)
		if (roopbuf \ 10000 == 0) {
			continue
		}
		rp = roopbuf \ 10000 - 1
		// ビッグエンチャント計算
		nc_intb_bigench = check_bigench(rp)
		cSumOfEquipmentWeight(r1) += iWeight(rp)
		if (iSkill(rp) == 168) {
			if (cEquipmentType(r1) & 1) {
			} else {
				cEquipmentType(r1) += 1
			}
		}
		if (nc_armorbonus > 0) {
			nc_armorcount += 1
		}
		cDv(r1) += iDv(rp)
		cPv(r1) += iPv(rp)
		if (iDiceX(rp) == 0) {
			cHitBonus(r1) += iHitBonus(rp)
			cDamageBonus(r1) += iDamageBonus(rp)
			if (gettrait(0, 194) < 0) {
				if (r1 < 56) {
					cPv(r1) += iEnhancement(rp) * 1 + (iCurseState(rp) == 1) * 2
				} else {
					cPv(r1) += iEnhancement(rp) * 3 + (iCurseState(rp) == 1) * 2
				}
			} else {
				cPv(r1) += iEnhancement(rp) * 2 + (iCurseState(rp) == 1) * 2
			}
			if (check_bigench(rp) != 1) {
				p(69) = 0
			}
			if (ibit(6, rp)) {
				cAphropower(r1)++
			}
		} else {
			if (roopbuf / 10000 == 5) {
				attacknum++
			}
		}
		if (iCurseState(rp) == (-1)) {
			cCursePower(r1) += 20
		}
		if (iCurseState(rp) == (-2)) {
			cCursePower(r1) += 100
		}
		if (iMaterial(rp) == 8) {
			if (r1 == 0) {
				gEtherDiseaseSpeed += 5
			}
		}

		repeat 15
			if (iEnchantmentId(rp, cnt) == 0) {
				break
			}
			rp2 = iEnchantmentId(rp, cnt)
			dup roopbuf, iEnchantmentPower(rp, cnt)
			if (rp2 >= 10000) {
				rp3 = rp2 \ 10000
				rp2 = rp2 / 10000
				if (nc_intb_noench == (-1) | nc_intb_bigench == 3) {
					if (rp2 == 1) {
						sdata(rp3, r1) += roopbuf / 50 + 1
						continue
					}
					if (rp2 == 2) {
						sdata(rp3, r1) += roopbuf / 2
						if (sdata(rp3, r1) < 0) {
							sdata(rp3, r1) = 1
						}
						if (gettrait(0, 194) < 0) {
							if (r1 < 56) {
								if (sdata(rp3, r1) > 400) {
									sdata(rp3, r1) = 400
								}
							}
						}
						continue
					}
					if (rp2 == 3) {
						if (sorg(rp3, r1) != 0) {
							sdata(rp3, r1) += roopbuf / 50 + 1
							if (sdata(rp3, r1) < 1) {
								sdata(rp3, r1) = 1
							}
						}
						continue
					}
				}
			} else {
				if (nc_intb_noench == (-1) | nc_intb_bigench == 3) {
					if (rp2 == 56) {
						if (r1 == 0) {
							gCatchesGodSignal = 1
							continue
						}
					}
					if (rp2 == 59) {
						if (r1 == 0) {
							gRevealsReligion = 1
							continue
						}
					}
					if (rp2 == 29) {
						sdata(18, r1) += roopbuf / 50 + 1
						if (r1 == 0) {
							gSevenLeagueBootEffect += roopbuf / 8
							continue
						}
					}
					if (rp2 == 32) {
						cbitmod 5, r1, 1
						continue
					}
					if (rp2 == 35) {
						cbitmod 7, r1, 1
						continue
					}
					if (rp2 == 23) {
						cbitmod 9, r1, 1
						continue
					}
					if (rp2 == 24) {
						cbitmod 12, r1, 1
						continue
					}
					if (rp2 == 25) {
						cbitmod 8, r1, 1
						continue
					}
					if (rp2 == 26) {
						cbitmod 10, r1, 1
						continue
					}
					if (rp2 == 27) {
						cbitmod 11, r1, 1
						continue
					}
					if (rp2 == 28) {
						cbitmod 13, r1, 1
						continue
					}
					if (rp2 == 42) {
						cbitmod 14, r1, 1
						continue
					}
					if (rp2 == 41) {
						cbitmod 15, r1, 1
						continue
					}
					if (rp2 == 55) {
						cbitmod 29, r1, 1
						continue
					}
					if (rp2 == 52) {
						cDecreasePhysicalDamage(r1) += roopbuf / 40 + 5
						continue
					}
					if (rp2 == 53) {
						cNullifyDamage(r1) += roopbuf / 60 + 3
						continue
					}
					if (rp2 == 54) {
						cCutCounterattack(r1) += roopbuf / 5
						continue
					}
					if (rp2 == 44) {
						cRateOfCriticalHit(r1) += roopbuf / 50
						continue
					}
					if (rp2 == 39) {
						cRateToPierce(r1) += roopbuf / 50
						continue
					}
					if (rp2 == 50) {
						cExtraAttack(r1) += roopbuf / 15
						continue
					}
					if (rp2 == 51) {
						cExtraShot(r1) += roopbuf / 15
						continue
					}
					if (rp2 == 21 | rp2 == 45 | rp2 == 46 | rp2 == 47) {
						cbitmod 24, r1, 1
						continue
					}
					if (rp2 == 63) {
						cSPboost(r1) += roopbuf / 10
						continue
					}
				}
				if (nc_intb_noench == (-1) | nc_intb_bigench == 3) {
					if (r1 == 0) {
						if (rp2 == 30) {
							gProtectsFromEtherwind = 1
							continue
						}
						if (rp2 == 31) {
							gProtectsFromBadWeather = 1
							continue
						}
					}
				}
			}
		loop
	loop
	if (nc_armorcount > 0) {
		cDv(r1) += 5 * nc_armorcount
		cPv(r1) += 5 * nc_armorcount
	}
	if (gettrait(0, 194) < 0 & cNullifyDamage(r1) > 60) {
		cNullifyDamage(r1) = 60
	}
	if (cNullifyDamage(r1) < 100) {
		if (getfactionvalue(r1, "invalid") != "") {
			cNullifyDamage(r1) += getfactionvalue(r1, "invalid")
		}
	}
	if (findbuff(r1, 68) != (-1) | cStoned(r1) > 0) {
		cNullifyDamage(r1) = 0
		cDecreasePhysicalDamage(r1) = 0
	}
	if (refreshmode == 1) {
		buff += "\n"
		buff += "<title1>◆ 装備による能力の修正<def>\n"
		repeat 600
			sdata(cnt, 56) = sorgEx(cnt, r1)
			if (sdata(cnt, 56) != sdata(cnt, r1)) {
				rp = sdata(cnt, r1) - sdata(cnt, 56)
				cnvbonus cnt, rp
			}
		loop
	}
	repeat 10
		if (cdata(240 + cnt, r1) != 0) {
			if (cQuality(r1) >= 4) {
				if (cdata(240 + cnt, r1) < sorg(10 + cnt, r1) / 5) {
					cdata(240 + cnt, r1) = sorg(10 + cnt, r1) / 5
				}
			}
			sdata(10 + cnt, r1) += cdata(240 + cnt, r1)
		}
		if (sdata(10 + cnt, r1) < 1) {
			sdata(10 + cnt, r1) = 1
		}
	loop
	gosub *label_1085
	if (r1 == 0) {
		cElementOfUnarmedAttack(r1) = 0
		if (gettrait(r1, 193) < (-1)) {
			sdata(2, r1) = 1
			sdata(3, r1) = 1
			sdata(10, r1) = 1
			sdata(11, r1) = 1
			sdata(12, r1) = 1
			sdata(13, r1) = 1
			sdata(14, r1) = 1
			sdata(15, r1) = 1
			sdata(16, r1) = 1
			sdata(17, r1) = 1
			sdata(18, r1) = 1
			sdata(19, r1) = 1
		}
	}
	traitmode = 1
	repeat 300
		if (gettrait(r1, cnt) != 0) {
			tid = cnt
			gosub *label_0097
		}
	loop
	if (getfactionvalue(r1, "pet") != "") {
		p(55) = int(refstr)
		if (gettrait(p(55), 67)) {
			p(56) = stat
			sdata(154, r1) = limit(sdata(154, r1) + sqrt(sdata(154, p(55))) + calc3traitmulti(p(56), sdata(154, p(55))), sdata(154, r1) > 0, 2000000000)
			sdata(155, r1) = limit(sdata(155, r1) + sqrt(sdata(155, p(55))) + calc3traitmulti(p(56), sdata(155, p(55))), sdata(155, r1) > 0, 2000000000)
		}
	}
	if (cEquipmentType(r1) & 1) {
		if (cPv(r1) > 0) {
			cPv(r1) = cPv(r1) * (120 + int(sqrt(sdata(168, r1))) * 2) / 100
		}
	} else {
		if (attacknum == 1) {
			cEquipmentType(r1) += 2
		} else {
			if (attacknum != 0) {
				cEquipmentType(r1) += 4
			}
		}
	}
	if (cEquipmentType(r1) & 4) {
		if (gettrait(r1, 63)) {
			sdata(173, r1) = limit(sdata(173, r1) + sqrt(sdata(166, r1)) + calc3traitmulti(stat, sdata(166, r1)), sdata(173, r1) > 0, 2000000000)
		}
	}
	lint_buff = int(limitf(double(limit(limit(sdata(16, r1) * 2 + sdata(15, r1) + sdata(14, r1) / 3, 1, 50000) * limit(cLevel(r1), 1, 30000) / 25 + sdata(16, r1), 1, 1000000)) * sdata(3, r1) / 100, 1, 2000000000))
	cMaxMp(r1) = lint_buff
	lint_buff = int(limitf(double(limit(limit(sdata(11, r1) * 2 + sdata(10, r1) + sdata(15, r1) / 3, 1, 50000) * limit(cLevel(r1), 1, 30000) / 25 + sdata(11, r1), 1, 1000000)) * sdata(2, r1) / 100 + 5, 1, 2000000000))
	cMaxHp(r1) = lint_buff
	lint_buff = limitmax(100 + (sdata(15, r1) + sdata(11, r1)) / 5 + gettrait(r1, 24) * 8 + cSPboost(r1), 2000000000)
	cMaxSp(r1) = lint_buff
	if (petcheck(r1)) {
		if (implevel(cImpression(r1)) >= 8) {
			if (ogdata(506) == 2) {
					lint_buff = int(limitf(cMaxMp(r1) + (cMaxMp(r1) * 0.2), 1, 2000000000))
					cMaxMp(r1) = lint_buff
					lint_buff = int(limitf(cMaxHp(r1) + (cMaxHp(r1) * 0.2), 1, 2000000000))
					cMaxHp(r1) = lint_buff
			}
		}
	}
	if (cMaxMp(r1) < 1) {
		cMaxMp(r1) = 1
	}
	if (cMaxHp(r1) < 1) {
		cMaxHp(r1) = 1
	}
	if (r1 == 0) {
		if (eqfaction(r1, "golem")) {
			cPv(0) += 20
		}
	}
	if (p(69)) {
		if (cDvCorrectionValue(r1) == 0) {
			cDvCorrectionValue(r1) = 100
		}
		cDv(r1) = limit(cLevel(r1), 1, 10000) / 2 + cDv(r1) * cDvCorrectionValue(r1) / 100 + cDvCorrectionValue(r1) - 100
		if (cPvCorrectionValue(r1) == 0) {
			cPvCorrectionValue(r1) = 100
		}
		cPv(r1) = limit(cLevel(r1), 1, 10000) + (cPv(r1) + limit(cLevel(r1), 1, 10000) / 2 + cPvCorrectionValue(r1) / 25) * cPvCorrectionValue(r1) / 100
	}
	if (r1 >= 57) {
		if (cQuality(r1) == 3) {
			cMaxHp(r1) = cMaxHp(r1) * 3 / 2
		}
		if (cQuality(r1) >= 4) {
			cMaxHp(r1) = cMaxHp(r1) * 5
		}
	} else {
		cMaxHp(r1) += 10
	}
	repeat 16
		rp = ocdata(192 + cnt * 3, r1)
		if (rp == 0) {
			break
		}
		calcbuff r1, rp, ocdata(192 + cnt * 3 + 1, r1)
	loop
	if (r1 == 0) {
		if (gettrait(r1, 193) < (-1)) {
			sdata(2, r1) = 1
			sdata(3, r1) = 1
			sdata(10, r1) = 1
			sdata(11, r1) = 1
			sdata(12, r1) = 1
			sdata(13, r1) = 1
			sdata(14, r1) = 1
			sdata(15, r1) = 1
			sdata(16, r1) = 1
			sdata(17, r1) = 1
			sdata(18, r1) = 1
			sdata(19, r1) = 1
		}
	}
	if (cEquipmentType(r1) & 4) {
		cExtraAttack(r1) += int(sqrt(sdata(166, r1))) * 3 / 2 + 4
	}
	if (sdata(186, r1)) {
		cRateOfCriticalHit(r1) += int(sqrt(sdata(186, r1))) + 2
	}
	if (cRateOfCriticalHit(r1) > 30) {
		cHitBonus(r1) += (cRateOfCriticalHit(r1) - 30) * 2
		cRateOfCriticalHit(r1) = 30
	}
	if (ocbit(1, r1)) {
		cbitmod 6, r1, 1
	}
	f@se = carmor(r1)
	if (f@se == 169) {
		if (cDv(r1) > 0) {
			cDv(r1) = cDv(r1) / 2
		} else {
			cDv(r1) = cDv(r1) * 3 / 2
		}
	}
	if (f@se == 170) {
		if (cDv(r1) > 0) {
			cDv(r1) = cDv(r1) * 3 / 4
		} else {
			cDv(r1) = cDv(r1) * 4 / 3
		}
	}
	gosub *refreshPCBurdenState
	refreshspeed r1
	cbitmod 981, r1, 0
	rewriteai r1
	if (characreatehack == 0) {
		refreshfaction r1
	}
	chararefreshhack = 0
	return



#defcfunc calcmedalvalue int __ddd
	if (iId(__ddd) == 430) {
		return 5
	}
	if (iId(__ddd) == 431) {
		return 8
	}
	if (iId(__ddd) == 502) {
		return 7
	}
	if (iId(__ddd) == 480) {
		return 20
	}
	if (iId(__ddd) == 421) {
		return 15
	}
	if (iId(__ddd) == 603) {
		return 20
	}
	if (iId(__ddd) == 615) {
		return 5
	}
	if (iId(__ddd) == 559) {
		return 10
	}
	if (iId(__ddd) == 516) {
		return 3
	}
	if (iId(__ddd) == 616) {
		return 18
	}
	if (iId(__ddd) == 623) {
		return 85
	}
	if (iId(__ddd) == 624) {
		return 25
	}
	if (iId(__ddd) == 505) {
		return 12
	}
	if (iId(__ddd) == 625) {
		return 11
	}
	if (iId(__ddd) == 626) {
		return 30
	}
	if (iId(__ddd) == 627) {
		return 55
	}
	if (iId(__ddd) == 56) {
		return 65
	}
	if (iId(__ddd) == 742) {
		return 72
	}
	if (iId(__ddd) == 760) {
		return 94
	}
	if (iId(__ddd) == 650) {
		return 13
	}
	if (iId(__ddd) == 708) {
		return 24
	}
	if (iId(__ddd) == 737) {
		return 40
	}
	if (iId(__ddd) == 637) {
		return 150
	}
	if (iId(__ddd) == 706) {
		return 20
	}
	if (iId(__ddd) == 794) {
		return 200
	}
	if (iId(__ddd) == 289) {
		return 2000
	}
	if (iId(__ddd) == 795) {
		if (iParam1(__ddd) == 0) {
			return 10
		}
		return 1000
	}
	if (iId(__ddd) == 743) {
		if (inv(31, __ddd) + 1 == finditemid("artifacts fusion license")) {
			return 500
		}
	}
	if (iId(__ddd) == 791) {
		return 10000
	}
	if (iId(__ddd) == 744) {
		return 2000000000
	}
	if (iId(__ddd) == 800) {
		return 300
	}
	if (iId(__ddd) == 813) {
		return 100
	}
	if (iId(__ddd) == 777) {
		return 100
	}
	return 1

#defcfunc calcfeavalue int __ddd
	if (iId(__ddd) == 655) {
		return 1000
	}
	if (iId(__ddd) == 662) {
		return 1000
	}
	if (iId(__ddd) == 802) {
		return 100
	}
	if (iId(__ddd) == 803) {
		return 40
	}
	if (iId(__ddd) == 804) {
		return 20
	}
	if (iId(__ddd) == 805) {
		return 20
	}
	if (iId(__ddd) == 806) {
		return 10
	}
	if (iId(__ddd) == 807) {
		return 10
	}
	if (iId(__ddd) == 808) {
		return 30
	}
	if (iId(__ddd) == 809) {
		return 30
	}
	if (iId(__ddd) == 810) {
		return 20
	}
	if (iId(__ddd) == 811) {
		return 30
	}
	if (iId(__ddd) == 812) {
		return 10
	}
	if (iId(__ddd) == 822) {
		return 100
	}
	if (iId(__ddd) == 622) {
		return 150
	}
return 300



#defcfunc calcitemvalue int __eee, int __fff
	reftype@m153 = refitem(iId(__eee), 5, __eee)
	if (iIdentificationState(__eee) == 0) {
		if (__fff == 2) {
			value@m153 = iValue(__eee) * 4 / 10
		} else {
			value@m153 = (gRandomSeed + __eee * 31) \ 10 + 4 + 10
		}
	} else {
		if (reftype@m153 >= 50000) {
			value@m153 = iValue(__eee)
		} else {
			if (iIdentificationState(__eee) == 1) {
				value@m153 = iValue(__eee) * 2 / 10
			}
			if (iIdentificationState(__eee) == 2) {
				value@m153 = iValue(__eee) * 5 / 10
			}
			if (iIdentificationState(__eee) >= 3) {
				value@m153 = iValue(__eee)
			}
		}
	}
	if (iIdentificationState(__eee) >= 3) {
		if (iCurseState(__eee) == 1) {
			value@m153 = int(double(value@m153) * 120 / 100)
		}
		if (iCurseState(__eee) == (-1)) {
			value@m153 = value@m153 / 2
		}
		if (iCurseState(__eee) == (-2)) {
			value@m153 = value@m153 / 5
		}
	}
	if (reftype@m153 == 57000 | item_isCookedMilk(__eee)) {
		if (iParam2(__eee) > 0) {
			value@m153 = value@m153 * iParam2(__eee) * iParam2(__eee) / 10
		}
	}
	if (iEnhancement(__eee) > 0) {
		if (reftype@m153 == 52000 | reftype@m153 == 10000 | reftype@m153 == 24000) {
			value@m153 += value@m153 * iEnhancement(__eee) / 2
		} else {
			if (reftype@m153 < 50000) {
				value@m153 += value@m153 * iEnhancement(__eee) / 5
			}
		}
	}
	if (iId(__eee) == 333) {
		if (__fff == 0) {
			value@m153 += limit(cFame(0) / 40 + value@m153 * (cFame(0) / 80) / 100, 0, 800)
		}
	}
	if (iWeight(__eee) < 0) {
		if (mode == 6) {
			if (reftype@m153 == 92000) {
				if (equalsitem(__eee, "wuqing")) {
					randomize gDay + gMonth * 30 + gYear * 30 * 12
					exrand_randomize gDay + gMonth * 30 + gYear * 30 * 12
					value@m153 = value@m153 * (rnd(rnd(20) + 1) + 1)
					randomize
					exrand_randomize
				} else {
					value@m153 = value@m153 * trate(iParam1(__eee)) / 100
				}
				if (__fff == 1) {
					value@m153 = value@m153 * 85 / 100
				}
				return value@m153
			}
		}
	}
	if (ibit(4, __eee) == 1) {
		dbid = iId(__eee)
		cibkref = __eee
		dbmode = 2
		gosub *label_2426
		if (iCount(__eee) < 0) {
			value@m153 = value@m153 / 10
		} else {
			if (reftype@m153 == 54000) {
				value@m153 = value@m153 / 5 + value@m153 * iCount(__eee) / (ichargelevel * 2 + 1)
			} else {
				value@m153 = value@m153 / 2 + value@m153 * iCount(__eee) / (ichargelevel * 3 + 1)
			}
		}
	}
	if (reftype@m153 == 72000) {
		if (iParam1(__eee) == 0) {
			value@m153 = value@m153 / 100 + 1
		}
	}
	if (__fff == 0) {
		if (reftype@m153 == 53000) {
			reftypeminor@m153 = refitem(inv(3, __eee), 9, __eee)
			if (reftypeminor@m153 == 53100) {
				if (gettrait(0, 100)) {
					value@m153 -= calc3traitmulti(stat, value@m153)
				}
			}
		}
		limitvalue@m153 = value@m153 / 2
		limitvalue2 = value@m153 * 2
		if (trophycheck(6) == 2) {
			correctionvalue = 100 + (cImpression(tc) * 2) - 50
		} else {
			correctionvalue = 100 + cImpression(tc) - 50
		}
		if (correctionvalue <= 0) {
			correctionvalue = 1
		}
		value@m153 = int(double(value@m153) * 100 / (100 + sdata(156, 0)) * 100 / correctionvalue)
		if (guildcheck(0) == "mage") {
			if (reftype@m153 == 54000) {
				value@m153 = value@m153 * 80 / 100
			}
		}
		if (value@m153 <= limitvalue@m153) {
			value@m153 = limitvalue@m153
		}
		if (value@m153 >= limitvalue2) {
			value@m153 = limitvalue2
		}
	}
	if (__fff == 1) {
		limitvalue@m153 = sdata(156, 0) * 250 + 5000
		if (value@m153 / 3 < limitvalue@m153) {
			limitvalue@m153 = value@m153 / 3
		}
		if (trophycheck(6) == 2) {
			correctionvalue = 100 + (cImpression(tc) * 2) - 50
		} else {
			correctionvalue = 100 + cImpression(tc) - 50
		}
		if (correctionvalue <= 0) {
			correctionvalue = 1
		}
		value@m153 = int(double(value@m153) * (100 + sdata(156, 0) * 5) / 1000 * correctionvalue / 100)
		if (reftype@m153 < 50000) {
			value@m153 /= 20
		}
		if (ibit(9, __eee)) {
			if (guildcheck(0) != "thieve") {
				value@m153 /= 10
			} else {
				value@m153 = value@m153 / 3 * 2
			}
		}
		if (value@m153 >= limitvalue@m153) {
			value@m153 = limitvalue@m153
		}
	}
	if (__fff == 2) {
		value@m153 = value@m153 / 5
		if (reftype@m153 < 50000) {
			value@m153 /= 3
		}
		if (value@m153 > 15000) {
			value@m153 = 15000
		}
		if (ibit(9, __eee)) {
			value@m153 = 1
		}
	}
	if (value@m153 <= 0) {
		value@m153 = 1
	}
	return value@m153



#defcfunc calcinvestvalue int
	value@m153 = limit(cShopRank(tc), 1, 200) * limit(cShopRank(tc), 1, 200) * 15 + 200
	if (value@m153 > 500000) {
		value@m153 = 500000
	}
	value@m153 = value@m153 * 100 / (100 + sdata(160, 0) * 10) + 200
	return value@m153



#defcfunc calcinvestvalue2 int __hhh, int __iii
	sum@m153 = 0
	calcinvestvaluemain __hhh, 0, __iii, sum@m153
	return sum@m153



#deffunc calcinvestvaluemain int __jjj, int __kkk, int __lll, var __mmm
	if (__kkk >= __lll) {
		return
	}
	value@m153 = limit(__jjj, 1, 200) * limit(__jjj, 1, 200) * 15 + 200
	if (value@m153 > 500000) {
		value@m153 = 500000
	}
	value@m153 = value@m153 * 100 / (100 + sdata(160, 0) * 10) + 200
	__mmm += value@m153
	calcinvestvaluemain __jjj + 2, __kkk + 1, __lll, __mmm
	return



#defcfunc calcguiltvalue int
	value@m153 = -cKarma(0) / 2 * (cFame(0) / 3)
	return value@m153



#defcfunc calchireadv int __ooo
	return 250 + limit(cLevel(__ooo), 1, 1000) * limit(cLevel(__ooo), 1, 1000) * 30



#defcfunc calchirecost int __ppp
	value@m153 = 0
	if (cRole(__ppp) == 18) {
		value@m153 = 450
	}
	if (cRole(__ppp) == 7) {
		value@m153 = 250
	}
	if (cRole(__ppp) == 9) {
		value@m153 = 350
	}
	if (cRole(__ppp) == 12) {
		value@m153 = 500
	}
	if (cRole(__ppp) == 5) {
		value@m153 = 750
	}
	if (cRole(__ppp) == 8) {
		value@m153 = 250
	}
	if (cRole(__ppp) == 14) {
		value@m153 = 50
	}
	if (chara_isShopKeeper(__ppp)) {
		value@m153 = 1000
		if (cRole(__ppp) == 1007) {
			value@m153 *= 4
		}
		if (cRole(__ppp) == 1018) {
			value@m153 *= 4
		}
		if (cRole(__ppp) == 1020) {
			value@m153 *= 320
		}
		if (cRole(__ppp) == 2003) {
			value@m153 = 0
		}
	}
	if (areaId(gCurrentMap) == 39) {
		value@m153 = 0
	}
	return value@m153



#deffunc generatemoney int __qqq
	p@m153 = rnd(100) + rndex(cLevel(__qqq) * 50 + 1)
	if (chara_isShopKeeper(__qqq) & eqfaction(__qqq, "petshop") == 0) {
		p@m153 = int(limitf(double(p@m153) + 2500 + double(cShopRank(__qqq)) * 250, 0, 2000000000))
	}
	if (cGold(__qqq) < p@m153 / 2 & eqfaction(__qqq, "petshop") == 0) {
		cGold(__qqq) = p@m153
	}
	return



#deffunc calccosthire
	if (areaId(gCurrentMap) == 104) {
		return
	}
	cost@m153 = 0
	repeat 188, 57
		if (cRole(cnt) == 0) {
			continue
		}
		if (cState(cnt) != 1) {
			continue
		}
		cost@m153 += calchirecost(cnt)
	loop
	cost@m153 = cost@m153 * limit(100 - limit(cKarma(0) / 2, 0, 50) - 7 * gettrait(0, 38) - (cKarma(0) >= 20) * 5, 25, 200) / 100
	gCostToHire = cost@m153
	return



#defcfunc calccostbuilding
	cost@m153 = 0
	cost@m153 += gHomeScale * gHomeScale * 200
	repeat 450 - 300, 300
		if (areaId(cnt) == 101) {
			cost@m153 += 1500
		}
		if (areaId(cnt) == 31) {
			cost@m153 += 1000
		}
		if (areaId(cnt) == 103) {
			cost@m153 += 750
		}
		if (areaId(cnt) == 102) {
			cost@m153 += 5000
		}
		if (areaId(cnt) == 104) {
			cost@m153 += 750
		}
	loop
	cost@m153 = cost@m153 * limit(100 - limit(cKarma(0) / 2, 0, 50) - 7 * gettrait(0, 38) - (cKarma(0) >= 20) * 5, 25, 200) / 100
	return cost@m153



#defcfunc calccosttax
	cost@m153 = 0
	cost@m153 += cGold(0) / 1000
	/*免税の処理*/
	if (cKarma(0) > 0) {
		cost@m153 -= powf(cKarma(0),3) / 4
	}
	cost@m153 += cFame(0) * 7 / 6
	cost@m153 = cost@m153 * limit(100 - limit(cKarma(0) / 2, 0, 50) - 7 * gettrait(0, 38) - (cKarma(0) >= 20) * 5, 25, 200) / 100
	if (cost@m153 < 1000) {
		cost@m153 = 1000
	}
	return cost@m153



#defcfunc calcmealvalue
	return 140



#defcfunc calccostreload int __rrr, int __sss
	cost@m153 = 0
	inv_getheader __rrr
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (refitem(iId(cnt), 5, cnt) != 25000) {
			continue
		}
		ci@m153 = cnt
		repeat 15
			if (iEnchantmentId(ci@m153, cnt) == 0) {
				break
			}
			enc@m153 = iEnchantmentId(ci@m153, cnt)
			i@m153 = enc@m153 / 10000
			if (i@m153 != 0) {
				enc@m153 = enc@m153 \ 10000
				if (i@m153 == 9) {
					i@m153 = iEnchantmentPower(ci@m153, cnt) \ 1000, iEnchantmentPower(ci@m153, cnt) / 1000
					cost@m153 += (i@m153(1) - i@m153) * (50 + enc@m153 * enc@m153 * 10)
					if (__sss == 1) {
						iEnchantmentPower(ci@m153, cnt) = i@m153(1) * 1000 + i@m153(1)
					}
				}
			}
		loop
	loop
	return cost@m153



#defcfunc calccargoupdate
	return 30000



#defcfunc calccargoupdatecost
	if (ogdata(542) == 2) {
		return (gCurrentCartLimit - gInitialCartLimit) / 10000 / 4 + 1
	}
	return (gCurrentCartLimit - gInitialCartLimit) / 10000 / 3 + 1



#defcfunc calcidentifyvalue int __ttt
	value@m153 = 300
	if (__ttt == 2) {
		value@m153 = 5000
	}
	if (__ttt == 1) {
		inv_getheader 0
		p@m153 = 0
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iIdentificationState(cnt) < 3) {
				p@m153++
			}
		loop
		if (p@m153 >= 2) {
			value@m153 = value@m153 * p@m153 * 70 / 100
		}
	}
	value@m153 = value@m153 * 100 / (100 + sdata(156, 0) * 2)
	if (guildcheck(0) == "fighter") {
		value@m153 /= 2
	}
	return value@m153



#defcfunc calctraincost int __uuu, int __vvv, int __www
	value@m153 = sorgEx(__uuu, __vvv) / 5 + 2
	if (__www) {
		value@m153 /= 2
	}
	if (sgrowth(__uuu, __vvv) == 0) {
		value@m153 = 3
	}
	return value@m153



#defcfunc calclearncost int, int, int __zzz
	value@m153 = 15 + 3 * gNumberOfLearnedSkillsByTrainer
	if (__zzz) {
		value@m153 = value@m153 * 2 / 3
	}
	return value@m153



#defcfunc calcresurrectvalue int __aaa
	if (cState(__aaa) != 6) {
		return 100
	}
	value@m153 = limit(cLevel(__aaa), 1, 1000) * limit(cLevel(__aaa), 1, 1000) * 15
	return value@m153



#defcfunc calcslavevalue int __bbb
	value@m153 = sdata(10, __bbb) * sdata(11, __bbb) + cLevel(__bbb) * cLevel(__bbb) + 1000
	if (value@m153 > 50000) {
		value@m153 = 50000
	}
	if (cbit(23, __bbb) | cbit(27, __bbb)) {
		value@m153 = 10
	}
	return value@m153

#defcfunc calcrestorecost
	value@m153 = 500
	if (guildcheck(0) == "fighter") {
		value@m153 /= 2
	}
	return value@m153



#defcfunc calcinitgold int __ddd
	dropgold = 0
	if (__ddd < 0) {
		dropgold = rndex(gCurrentDungeonLevel * 25 * (gCurrentMap != 30) + 10) + 1
	} else {
		lootrich@m155 = -1
		if (cId(__ddd) == 183) {
			lootrich@m155 = 10
		}
		if (cId(__ddd) == 184) {
			lootrich@m155 = 4
		}
		if (cId(__ddd) == 185) {
			lootrich@m155 = 2
		}
		if (lootrich@m155 != (-1)) {
			dropgold = lootrich@m155 * 500 + rnd(1000 + lootrich@m155 * 1000)
		} else {
			dropgold = rndex(cLevel(__ddd) * 25 + 10) + 1
		}
	}
	if (gettrait(0, 170)) {
		dropgold += dropgold / 10
	}
	return dropgold



#defcfunc calcspellpower int __eee, int __fff
	lint_efp = 0
	fix_spallpower = 0
	if (__eee == 625) {
		if (godcheck(__fff) == "lulwy") {
			lint_efp = sdata(sdataref(0, __eee), __fff) * 6 + 10 + cPietyPoint(__fff) / 10
			return limitmax(lint_efp, INT_MAX)
		}
	}
	if (__eee >= 663 & __eee <= 673) {
		if (__fff == 0) {
			lint_efp = limit(sdata(sdataref(6, __eee), __fff) * 5 / (200 / sdata(sdataref(0, __eee)) + 1), 10, 1000)
			return limitmax(lint_efp, INT_MAX)
		}
		lint_efp = limit(cLevel(__fff) * 6 + 10 / (200 / sdata(sdataref(0, __eee)) + 1), 10, 1000)
		return limitmax(lint_efp, INT_MAX)
	}
	if (__eee >= 779 & __eee <= 781) {
		god_no = getcgodno(__fff)
		// 779 - 754 = 25 (miracle 1)
		// 780 - 754 = 26 (miracle 1)
		// 781 - 754 = 27 (special power)
		lint_efp = convert_var(usergoddatan(__eee - 754, god_no), 0, sdata(sdataref(0, __eee), __fff), cPietyPoint(__fff))
		return limitmax(lint_efp, INT_MAX)
	}
	if (__eee == 810) {
		god_no = getcgodno(__fff)
		lint_efp = convert_var(usergodskilldatan(2, god_no), 0, sdata(sdataref(0, __eee), __fff), cPietyPoint(__fff))
		return limitmax(lint_efp, INT_MAX)
	}
	if (__eee >= 761 & __eee <= 778) {
		return cPietyPoint(__fff)
	}
	if (sdataref(1, __eee) == 4) {
		if (range == 0) {
			if (nc_gettrait(__fff, 105) > 0) {
				fix_spallpower = 1.5
			}
		}
	}
	if (sdataref(1, __eee) > 1000 & sdataref(3, __eee) / 1000 == 3) {
		if (range == 0) {
			if (nc_gettrait(__fff, 106) > 0) {
				fix_spallpower = 1.5
			}
		}
	}
	if (sdataref(1, __eee) > 1000 & sdataref(3, __eee) / 1000 == 2) {
		if (range == 0) {
			if (nc_gettrait(__fff, 107) > 0) {
				fix_spallpower = 2
			}
		}
	}
	if (__eee >= 600) {
		if (sdataref(0, __eee) != 0) {
			lint_efp = sdata(sdataref(0, __eee), __fff) * 6 + 10
			return limitmax(lint_efp, INT_MAX)
		}
		return 100
	}
	if (__fff == 0) {
		if (__eee >= 550 & __eee <= 599) {
			lint_efp = limit(userspelldata(12, __eee - 550) / 1000000 * 10 + 50, 0, 50000) * userspelldata(5, __eee - 550)
			if (fix_spallpower > 0) {
				lint_efp *= fix_spallpower
			}
			return limitmax(lint_efp, INT_MAX)
		}
		lint_efp = sdata(__eee, __fff) * 10 + 50
		if (fix_spallpower > 0) {
			lint_efp *= fix_spallpower
		}
		return limitmax(lint_efp, INT_MAX)
	}
	if (sdata(172, __fff) == 0) {
		if (__fff >= 16 & cRole(__fff) != 10001 & cRole(__fff) != 10018 & eqfaction(__fff, "petshop") == 0) {
			lint_efp = cLevel(__fff) * 6 + 10
			return limitmax(lint_efp, INT_MAX)
		}
	}
	lint_efp = sdata(172, __fff) * 6 + 10
	if (fix_spallpower > 0) {
		lint_efp *= fix_spallpower
	}
	return limitmax(lint_efp, INT_MAX)



#defcfunc calcspellfail int __ggg, int __hhh
	if (__hhh != 0) {
		if (gMount == __hhh) {
			return 95 - limit(30 - sdata(301, 0) / 2, 0, 30)
		} else {
			if (ocdata(107, __hhh) != 0) {
				return 95 - limit(30 - sdata(301, ocdata(107, __hhh)) / 2, 0, 30)
			} else {
				return 95
			}
		}
	}
	if (__ggg >= 550 & __ggg <= 599) {
		return calcuserspellfail(__ggg - 550)
	}
	fixfail = 2
	repeat length(isethighspell)
		if (isethighspell(cnt) + 400 == __ggg) {
			fixfail = 1
			break
		}
	loop
	if (godcheck(0) == "danalin") {
		if (cInsanity(0) >= 100) {
			fixfail = 2
		}
	}
	i@m157 = 4
	f@m157 = carmor(__hhh)
	if (f@m157 == 169) {
		i@m157 = 17 / fixfail - sdata(169, __hhh) / 5
	}
	if (f@m157 == 170) {
		i@m157 = 12 / fixfail - sdata(170, __hhh) / 5
	}
	if (i@m157 < 4) {
		i@m157 = 4
	}
	if (gMount != 0) {
		i@m157 += 4 / fixfail
	}
	if (__ggg == 441 | __ggg == 454) {
		i@m157 += sdata(__ggg, __hhh) * 4 / 5
	}
	if (__ggg == 464) {
		i@m157 += sdata(__ggg, __hhh) / 3
	}
	p@m157 = 90 + sdata(__ggg, __hhh) - sdataref(4, __ggg) * i@m157 / (5 + sdata(172, __hhh) * 4)
	if (fixfail == 1) {
		if (f@m157 == 169) {
			if (p@m157 > 80) {
				p@m157 = 80
			}
		} else {
			if (f@m157 == 170) {
				if (p@m157 > 92) {
					p@m157 = 92
				}
			} else {
				if (p@m157 > 100) {
					p@m157 = 100
				}
			}
		}
	}
	if (cEquipmentType(__hhh) & 4) {
		p@m157 -= 6 / fixfail
	}
	if (cEquipmentType(__hhh) & 1) {
		p@m157 -= 12 / fixfail
	}
	if (fixfail == 2 & p@m157 > 100) {
		p@m157 = 100
	}
	if (ogdata(467) == 2) {
		p@m157 += 5
	}
	if (ogdata(512) == 2) {
		p@m157 += 5
	}
	if (trophycheck(0) == 2) {
		p@m157 += 5
	}
	return limit(p@m157, 0, 100)



#defcfunc calcspellcostmp int __iii, int __jjj
	if (__iii >= 550 & __iii <= 599) {
		return calcuserspellcostmp(__iii - 550)
	}
	if (__jjj == 0) {
		if (__iii == 413 | __iii == 461 | __iii == 457 | __iii == 438 | __iii == 409 | __iii == 408 | __iii == 410 | __iii == 466 | __iii == 428 | __iii == 439 | __iii == 440 | __iii == 441 | __iii == 503 | __iii == 504 | __iii == 505 | __iii == 506 | __iii == 508 | __iii == 510) {
			cost@m158 = sdataref(2, __iii)
			return cost@m158
		}
		cost@m158 = sdataref(2, __iii) * (100 + sdata(__iii, __jjj) * 3) / 100 + sdata(__iii, __jjj) / 8
	} else {
		cost@m158 = sdataref(2, __iii) * (50 + limit(cLevel(__jjj), 1, 2000) * 3) / 100
	}
	return cost@m158



#defcfunc calcspellcoststock int __kkk, int __lll
	cost@m159 = sdataref(2, __kkk) * (200 + magiccritical * 200) / (sdata(__kkk, __lll) * 3 + 100)
	if (cost@m159 < sdataref(2, __kkk) / 5) {
		cost@m159 = sdataref(2, __kkk) / 5
	}
	cost@m159 = rnd(cost@m159 / 2 + 1) + cost@m159 / 2
	if (nc_gettrait(__lll, 108) > 0) {
		cost@m159 = rnd(cost@m159 / 3 + 1) + cost@m159 / 2
	}
	if (cost@m159 < 1) {
		cost@m159 = 1
	}
	return cost@m159



#deffunc skillinit int __mmm, int __nnn, int __ooo
	dup sdatadup@m161, sdata(__mmm + 600, __nnn)
	if (__mmm >= 100) {
		p@m161 = __ooo * 5
		if (sdatadup@m161 / 1000000 == 0) {
			p@m161 += 100
		} else {
			p@m161 += 50
		}
	} else {
		p@m161 = __ooo * 20
		if (p@m161 > 400) {
			p@m161 = 400
		}
	}
	if (__mmm == 18) {
		p@m161(1) = int(limitf(double(__ooo) * (100 + cLevel(__nnn) * 2), 0, 2000000000)) / 100
	} else {
		p@m161(1) = int(limitf(double(p@m161) * p@m161 * cLevel(__nnn), 0, 2000000000)) / 45000 + __ooo + cLevel(__nnn) / 3
	}
	if (cLevel(__nnn) > 1) {
		p@m161 = int(expf(logf(0.9) * cLevel(__nnn)) * p@m161)
	}
	if (p@m161 < 1) {
		p@m161 = 1
	}
	if (__mmm == 2 | __mmm == 19 | __mmm == 3) {
		p@m161(1) = __ooo
		p@m161 = 100
	}
	if (sdatadup@m161 / 1000000 + p@m161(1) > 2000) {
		p@m161(1) = 2000 - sdatadup@m161 / 1000000
	}
	sdatadup@m161 += limit(p@m161(1), 0, 2000) * 1000000 + p@m161
	// ならくなら強化される
	if (gCurrentMap == 210) {
		sdatadup@m161 = 2000 * 1000000
		nc_intb_001 = (gCurrentDungeonLevel - 49)
		if (__mmm == 2) {
			nc_intb_002 = limitmax(int(nc_intb_001 / 10) * 100 + int(nc_intb_001 / 50) * 500, 100000)
		} else {
			if (__mmm == 18) {
				nc_intb_002 = limit(int(nc_intb_001 / 50) * 1000000, 1000000, 60000000)
				if (ncgdata(300)) {
					nc_intb_002 *= 10
				}
			} else {
				nc_intb_002 = nc_intb_001 * 25
				if (ncgdata(302)) {
					nc_intb_002 *= 4
				}
			}
		}
		sdataEx(__mmm, __nnn) = nc_intb_002
		if (boss & __mmm != 2 & __mmm != 18) {
			sdataEx(__mmm, __nnn) *= 3
		}
	}
	return

*label_0713
	repeat 61 - 50, 50
		p = cLevel(r1) * 4 + 96
		if (p > 300) {
			p = 300
		}
		if (sdata(cnt, r1) != 0) {
			if (sdata(cnt, r1) < 100 | sdata(cnt, r1) >= 500) {
				p = sdata(cnt, r1)
			} else {
				p += sdata(cnt, r1)
			}
		}
		if (cnt == 60 & p < 500 | r1 == 0) {
			p = 100
		}
		sdata(cnt + 600, r1) = limit(p, 1, 2000) * 1000000
	loop
	if (nc_intb_nightmare) {
		if (cRelationship(r1) == (-3)) {
			repeat 3
				sdata(rnd(11) + 650, r1) = 2000 * 1000000
			loop
		}
	}
	i = 4
	skillinit 100, r1, i
	skillinit 101, r1, i
	skillinit 103, r1, i
	skillinit 102, r1, i
	skillinit 104, r1, i
	skillinit 105, r1, i
	skillinit 107, r1, i
	skillinit 108, r1, i
	skillinit 111, r1, i
	skillinit 109, r1, i
	skillinit 173, r1, 4
	skillinit 154, r1, 4
	skillinit 155, r1, 4
	skillinit 106, r1, 4
	skillinit 157, r1, 4
	skillinit 181, r1, 4
	skillinit 171, r1, 4
	skillinit 170, r1, 4
	skillinit 169, r1, 4
	skillinit 168, r1, 3
	skillinit 19, r1, 50
	return
*label_0714
	f = calcread(r2, r3)
	if (f == 1) {
		return 1
	}
	if (rnd(4) == 0 & trophycheck(11) != 2) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "はマナを吸い取られた！", name(cc) + your(cc) + " mana is absorbed.")
		}
		if (cc == 0) {
			dmgmp cc, cMaxMp(cc)
		} else {
			dmgmp cc, cMaxMp(cc) / 3
		}
		return 0
	}
	if (rnd(4) == 0 & trophycheck(11) != 2) {
		if (synccheck(cc, -1)) {
			if (cConfused(cc) != 0) {
				ctalk cc, 1309, cc, cc
				txt -1, lang(name(cc) + "は余計に混乱した。", name(cc) + " " + is(cc) + " confused more.")
			} else {
				ctalk cc, 1308, cc, cc
				txt -1, lang("難解だ！", "It's too difficult!")
			}
		}
		dmgcon cc, 5, 100
		return 0
	}
	if (rnd(4) == 0 & trophycheck(11) != 2) {
		if (synccheck(cc, -1)) {
			txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
		}
		repeat 2 + rnd(3)
			flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(2)
			characreate -1, 0, cX(cc), cY(cc)
			if (stat != 0) {
				if (cRelationship(cc) <= (-3)) {
					cRelationship(rc) = -1
					cOriginalRelationship(rc) = -1
				}
			}
		loop
		return 0
	}
	if (trophycheck(11) == 2) {
		if (synccheck(cc, -1)) {
				ctalk cc, 1308, cc, cc
				txt -1, lang("難解だ！", "It's too difficult!")
		}
		return 0
	}
	if (synccheck(cc, -1)) {
		txt -1, lang(name(cc) + "は奇妙な力に捻じ曲げられた！", "A dimension door opens in front of you.")
	}
	tc = cc
	efid = 408
	rndtelepo = 1
	gosub *label_1398
	rndtelepo = 0
	return 0
*label_0715
	if (rndex(sdata(159, cc) * 15 + 20 + sdata(13, cc)) > rndex(gCurrentDungeonLevel * 8 + 60)) {
		gosub *label_0668
		return 1
	}
	return 0
*label_0716
	if (feat(2) == 7) {
		return 0
	}
	if (petcheck(cc)) {
		if (rnd(refdiff + 1) < sdata(13, cc) + sdata(159, cc) * 4) {
			return 1
		}
	} else {
		if (rnd(4) != 0) {
			return 1
		}
	}
	return 0
*label_0717
	skillexp2 175, cc, 50
	return
*label_0718
	if (rndex(sdata(175, cc) * 15 + 20 + sdata(12, cc)) > rndex(val * 12 + 100)) {
		gosub *label_0717
		return 1
	}
	return 0
*label_0719
	cv = 8
	if (cX(r1) > cX(r2) - cv & cX(r1) < cX(r2) + cv) {
		if (cY(r1) > cY(r2) - cv & cY(r1) < cY(r2) + cv) {
			p = dist(cX(r1), cY(r1), cX(r2), cY(r2)) * 150 + (sdata(157, r1) * 100 + 150)
			if (p / 2 + rndex(p / 2 + 1) < rndex(pcnoise * sdata(13, r2) + (sdata(159, r2) * 100 + 150) + 1)) {
				return 1
			}
		}
	}
	return 0
*label_0720
	if (gettrait(0, 158)) {
		if (rnd(3) == 0) {
			return
		}
	}
	p = cNutrition(r1) / 1000
	if (cbit(985, r1) == 0 | p > 2) {
		cNutrition(r1) -= 8
	}
	if (cNutrition(r1) < (-2000000000)) {
		cNutrition(r1) = (-2000000000)
	}
	if (cNutrition(r1) / 1000 != p) {
		if (p == 1000 / 1000) {
			msgalert = 1
			txt -1, lang("このままだと餓死してしまう！", "You are starving!"), lang("腹が減ってほとんど死にかけている。", "You are almost dead from hunger.")
			if (cfg_NC_starvearart == 1 & cNullifyDamage(0) < 100) {
				snd 200
			}
		}
		if (p == 2000 / 1000) {
			msgalert = 1
			txt -1, lang("空腹で目が回りだした…", "Your hunger makes you dizzy."), lang("すぐに何かを食べなくては…", "You have to eat something NOW.")
				hack_alertstarvation = 1
				bk_tc = tc
				if (cfg_alertstarvation & cNullifyDamage(0) < 100 & (areaId(gCurrentMap) == 7 | areaId(gCurrentMap) == 39)) {
					alertstarvationmax = 0
					repeat 244, 1
						if (cState(cnt) != 1) {
							continue
						}
						if (cRelationship(cnt) < 0 | (cRelationship(cnt) == 0 & cId(cnt) != 205)) {
							continue
						}
						if (cRelationship(cnt) == 10 & ocdata(104, cnt) != 184) {
							continue
						}
						alertstarvation(alertstarvationmax) = cnt
						alertstarvationmax++
					loop
					if (alertstarvationmax & gettrait(0, 191) == 0) {
						tc = alertstarvation(rnd(alertstarvationmax))
						snd 99
						gosub *label_1465
						listmax = 0
						ctalk tc, 1019, 0, tc
						if (stat == 0) {
							buff = lang(cdatan(0, 0) + "、お腹は減ってない" + _ka(1) + _ore(3) + "がなにか作ってくる" + _yo(1), cdatan(0, 0) + ", you looks like hungry. I'll prepare something soon.")
						}
						tc = tc * (0 == 0) + (0 != 0) * 0
						list(0, listmax) = 0
						listn(0, listmax) = stryes
						listmax++
						list(0, listmax) = 1
						listn(0, listmax) = strno
						listmax++
						gosub *label_1487
						if (chatval == 0) {
							listmax = 0
							ctalk tc, 1020, 0, tc
							if (stat == 0) {
								buff = lang("たんと食べるが良い" + _yo(), "Here, it's your favorite food, right? Help yourself!")
							}
							tc = tc * (0 == 0) + (0 != 0) * 0
							list(0, listmax) = 0
							listn(0, listmax) = lang("ありがとう", "Thanks, " + name(tc) + ".")
							listmax++
							chatesc = 1
							gosub *label_1487
							snd 18
							cNutrition(0) = 15000
							txt -1, lang("なかなか美味しかった。", "It was tasty."), lang("悪くない。", "Not bad at all."), lang("あなたは舌鼓をうった。", "You smack your lips.")
							gosub *label_1384
							chara_anorexia 0
						}
						if (chatval == 1) {
							listmax = 0
							ctalk tc, 1021, 0, tc
							if (stat == 0) {
								buff = lang("後でちゃんと食べなきゃだめ" + _da(), "You have to eat later.")
							}
							tc = tc * (0 == 0) + (0 != 0) * 0
							list(0, listmax) = 0
							listn(0, listmax) = lang("はい", "Okay.")
							listmax++
							chatesc = 1
							gosub *label_1487
						}
					}
				}
				tc = bk_tc
				rowact_check 0
				hack_alertstarvation = 0
			if (cfg_NC_starvearart == 1 & cNullifyDamage(0) < 100) {
				snd 200
			}
		}
		if (p == 5000 / 1000) {
			msgalert = 1
			txt -1, lang("腹がすいてきた。", "You are getting hungry."), lang("空腹になった。", "You feel hungry."), lang("さて何を食べようか。", "Now what shall I eat?")
		}
		refreshspeed r1
	}
	return
	return
*label_0721
	nc_atk_loopf = 0
	regen = 1
	if (cSleep(r1) > 0) {
		healcon r1, 2, 1
		if (cSleep(r1) > 0) {
			cEmotionIcon(r1) = 14 + 100
		}
		healhp r1, 1
		healmp r1, 1
	}
	if (cPoisoned(r1) > 0) {
		dmghp r1, rnd(2 + sdata(11, r1) / 10), -4
		healcon r1, 1, 1
		if (cPoisoned(r1) > 0) {
			cEmotionIcon(r1) = 8 + 100
		}
		regen = 0
	}
	if (cChoked(r1) > 0) {
		if (cChoked(r1) \ 3 == 0) {
			if (synccheck(r1, -1)) {
				ctalk r1, 1245, r1, r1
				if (stat == 0) {
					txt r1, lang("「うぐぐ…！」", cnvtalk("Ughh...!"))
				}
			}
		}
		cChoked(r1)++
		if (cChoked(r1) > 15) {
			dmghp r1, 500, -21
		}
		regen = 0
	}
	if (cAphropower(r1) > 0) {
		if (rnd(100) < cAphropower(r1)) {
			txt -1, lang(name(r1) + "は防具に染み付いた媚薬を嗅いだ。", name(r1) + " sniffed an aphrodisiac.")
			dmgcon r1, 13, 50 + cAphropower(r1) * 5
			repeat 30, 100
				if (cdata(cnt, r1) \ 10000 == 0) {
					continue
				}
				rp = cdata(cnt, r1) \ 10000 - 1
				if (ibit(6, rp)) {
					if (rnd(20 + cAphropower(r1)) == 0 & check_bigench(rp) != 18) {
						if (iCurseState(r1) != (-1) | rnd(5) == 0) {
							ibitmod 6, rp, 0
							txt -1, lang(itemname(rp) + "に染み付いた媚薬は乾いた。", "The aphrodisiac that soaked in " + itemname(rp) + " was dry.")
							cAphropower(r1)--
						}
					}
				}
			loop
		}
	}
	if (cAphrodisiac(r1) > 0) {
		if (mapType != 1 & mapType != 5) {
			f = int(sqrt(cAphrodisiac(r1)))
			if (f < 200) {
				f = 200
			}
			if (rnd(10000) < f) {
				f = 0
				lovemiracle r1, 1
			}
		}
		healcon r1, 13, 1
		if (cAphrodisiac(r1) > 0) {
			cEmotionIcon(r1) = 17 + 100
		}
	}
	if (oabit(16, gCurrentMap) | (gCurrentMap == 210 & ncgdata(306))) {
		if (r1 == 0 | petcheck(r1)) {
			if (cGravity(r1) < 2) {
				cGravity(r1) = 2
			}
		}
	}
	if (gCurrentMap == 210 & ncgdata(310)) {
		if (r1 == 0 | petcheck(r1)) {
			dmghp r1, cMaxHp(r1) / 200, -21
		}
	}
	if (cGravity(r1) > 0) {
		cGravity(r1)--
		if (cGravity(r1) == 0) {
			if (synccheck(r1, -1)) {
				txt -1, lang(name(r1) + "は重力から抜け出した。", name(r1) + " break" + _s(r1) + " away from gravity.")
			}
		}
	}
	if (cFurious(r1) > 0) {
		cFurious(r1)--
		if (cFurious(r1) == 0) {
			if (synccheck(r1, -1)) {
				txt -1, lang(name(r1) + "はやや落ち着いた。", name(r1) + " calm" + _s(r1) + " down.")
			}
		}
	}
	if (cSick(r1) > 0) {
		if (rnd(80) == 0) {
			p = rnd(20 - 10)
			if (encfind(r1, 6 * 10000 + 10 + p) == (-1) & have_bigench(r1, 6) == 0) {
				cdata(240 + p, r1) -= sorgEx(10 + p, r1) / 25 + 1
				gosub *chara_refresh
			}
		}
		if (rnd(5)) {
			regen = 0
		}
		if (r1 >= 16 & cRole(r1) != 10001 & cRole(r1) != 10018 & eqfaction(r1, "petshop") == 0) {
			if (cQuality(r1) >= 4) {
				if (rnd(200) == 0) {
					healcon r1, 12
				}
			}
		}
	}
	if (gCurrentMap == 49) {
		if (cSp(r1) < cMaxSp(r1) / 4) {
			cEmotionIcon(r1) = 15 + 100
		}
	}
	if (cBlind(r1) > 0) {
		healcon r1, 4, 1
		if (cBlind(r1) > 0) {
			cEmotionIcon(r1) = 10 + 100
		}
	}
	if (cParalyzed(r1) > 0) {
		regen = 0
		healcon r1, 3, 1
		cEmotionIcon(r1) = 15 + 100
	}
	if (cStoned(r1) > 0) {
		regen = 0
		if (r1 == 0) {
			if (rnd(20) == 0) {
				recoverstorn r1
				gosub *chara_refresh
			}
		} else {
			if (cQuality(r1) >= 4) {
				if (rnd(5) == 0) {
					recoverstorn r1
					gosub *chara_refresh
				}
			}
		}
	}
	if (cConfused(r1) > 0) {
		healcon r1, 5, 1
		if (cConfused(r1) > 0) {
			cEmotionIcon(r1) = 11 + 100
		}
	}
	if (cFear(r1) > 0) {
		healcon r1, 6, 1
		if (cFear(r1) > 0) {
			cEmotionIcon(r1) = 13 + 100
		}
	}
	if (cDimmed(r1) > 0) {
		healcon r1, 7, 1
		if (cDimmed(r1) > 0) {
			cEmotionIcon(r1) = 12 + 100
		}
	}
	if (cDrunk(r1) > 0) {
		healcon r1, 8, 1
		if (cDrunk(r1) > 0) {
			cEmotionIcon(r1) = 6 + 100
		}
	}
	if (cBleeding(r1) > 0) {
		dmghp r1, rndex(cHp(r1) * (1 + cBleeding(r1) / 4) / 100 + 3) + 1, -13
		healcon r1, 9, 1 + cbit(29, r1) * 3
		if (cBleeding(r1) > 0) {
			cEmotionIcon(r1) = 9 + 100
		}
		regen = 0
		spillblood cX(r1), cY(r1)
	}
	if (cWet(r1) > 0) {
		cWet(r1)--
	}
	if (cInsane(r1) > 0) {
		if (synccheck(r1, -1)) {
			if (rnd(3) == 0) {
				txtef 9
				ctalk r1, 405, r1, r1
				if (stat == 0) {
					ctalk r1, 1204, r1, r1
					if (stat == 0) {
						txtef 9
						if (jp) {
							r2 = rnd(5)
							if (r2 == 0) {
								txt r1, name(r1) + "「キョキョキョ」", name(r1) + "「クワッ」", name(r1) + "「シャアァァ」", name(r1) + "「ばぶっふ！」", name(r1) + "「煮殺せ！」", name(r1) + "「許しなさい許しなさい！！」"
							}
							if (r2 == 1) {
								txt r1, name(r1) + "「フゥハハハー！」", name(r1) + "「あ、あ、あ、あ」", name(r1) + "「ぴ…ぴ…ぴか…」", name(r1) + "「お兄ちゃん！」", name(r1) + "「うみみやぁ」"
							}
							if (r2 == 2) {
								txt r1, name(r1) + "は突然踊りだした。", name(r1) + "は着ていたものを脱ぎだした。", name(r1) + "はぐるぐる回りだした。", name(r1) + "は奇声を発した。", name(r1) + "「ねうねう♪ねうねう♪」"
							}
							if (r2 == 3) {
								txt r1, name(r1) + "「ウージッムシ♪ウージッムシ♪」", name(r1) + "「じゃあ殺さなきゃ。うん♪」", name(r1) + "「このナメクジがっ」", name(r1) + "「おすわり！」", name(r1) + "「フーーーーン フーーーーン･･･ フーーーンフ」"
							}
							if (r2 == 4) {
								txt r1, name(r1) + "「このかたつむり野郎がっ」", name(r1) + "「うにゅみゅあ！」", name(r1) + "「ごめんなさいごめんなさい！」", name(r1) + "「もうすぐ生まれるよ♪」", name(r1) + "「フーーーーン フー…クワッ！」"
							}
						} else {
							r2 = rnd(2)
							if (r2 == 0) {
								txt r1, name(r1) + " start" + _s(r1) + " to take " + his(r1) + " cloths off.", name(r1) + " shout" + _s(r1) + ".", name(r1) + " dance" + _s(r1) + "."
							}
							if (r2 == 1) {
								txt r1, cnvtalk("Weeeeeee!"), cnvtalk("Forgive me! Forgive me!"), cnvtalk("P-P-Pika!"), cnvtalk("Shhhhhh!"), cnvtalk("So I have to kill."), cnvtalk("You snail!")
							}
						}
					}
				}
			}
		}
		if (rnd(5) == 0) {
			if (godcheck(r1) != "danalin" | cInsanity(r1) < 50) {
				cConfused(r1) += rnd(10)
			}
		}
		if (rnd(5) == 0) {
			if (godcheck(r1) != "danalin" | cInsanity(r1) < 20) {
				cDimmed(r1) += rnd(10)
			}
		}
		if (rnd(5) == 0) {
			if (godcheck(r1) != "danalin" | cInsanity(r1) < 5) {
				cSleep(r1) += rnd(5)
			}
		}
		if (rnd(5) == 0) {
			cFear(r1) += rnd(10)
		}
		healcon r1, 11, 1
		if (cInsane(r1) > 0) {
			cEmotionIcon(r1) = 24 + 100
		}
	}
	if (r1 == 0) {
		if (cNutrition(r1) < 2000) {
			if (cNutrition(r1) < 1000) {
				if (cContinuousActionId(r1) != 1) {
					p = 50
					if (gettrait(r1, 45)) {
						p -= 20
					}
					dmghp r1, rnd(2) + cMaxHp(0) / p, -3
					if (gPlayTurns \ 10 == 0) {
						rowact_check r1
						if (rnd(50) == 0) {
							modweight r1, -1
						}
					}
				}
			}
			regen = 0
		}
		if (gContinuousActiveHours >= 30) {
			if (gPlayTurns \ 100 == 0) {
				txt -1, lang("あなたは眠りを必要としている。", "You need to sleep.")
			}
			if (rnd(2)) {
				regen = 0
			}
			if (gContinuousActiveHours >= 50) {
				regen = 0
				dmgsp r1, 1
			}
		}
	} else {
		if (cRelatedQuestId(r1) != 0) {
			p = cRelatedQuestId(r1) - 1
			repeat 5
				p(1) = gdata(160 + cnt)
				if (qdata(3, p(1)) == 1002) {
					if (qdata(10, p(1)) == p) {
						if (qdata(15, p) > 0) {
							cEmotionIcon(r1) = 22 + 100
						}
						break
					}
				}
			loop
			if (qdata(8, p) != 0) {
				if (cTurn(r1) \ 2 == 1) {
					cEmotionIcon(r1) = 23 + 100
				}
			}
		}
	}
	if (gExecutingImmediateQuestType == 1009 | gExecutingImmediateQuestType == 1020) {
		if (r1 >= 57) {
			if (cImpression(r1) >= 53) {
				cEmotionIcon(r1) = 25 + 100 + 100
			}
		}
	}
	if (regen == 1) {
		if (findbuff(r1, 70) == (-1)) {
			if (rnd(6 - (findbuff(r1, 3) != (-1)) * 4) == 0) {
				if (findbuff(r1, 3) != (-1)) {
					healhp r1, rnd(ocdata(193 + (findbuff(r1, 3) * 3), r1)) / 100 + 1
				}
				healhp r1, rnd(sdata(154, r1) / 3 + 1) + 1
			}
		}
		if (rnd(5) == 0) {
			healmp r1, rnd(sdata(155, r1) / 2 + 1) + 1
		}
	}
	if (rnd(50) == 0) {
		repeat 30, 100
			if (cdata(cnt, r1) \ 10000 == 0) {
				continue
			}
			nc_intb_002 = cdata(cnt, r1) \ 10000 - 1
			if (inv(37, nc_intb_002) >= 10000) {
				if (sorg(inv(37, nc_intb_002) \ 10000, r1) > 0) {
					skillexp2 inv(37, nc_intb_002) \ 10000, r1, 100 * inv(38, nc_intb_002)
				}
			}
		loop
	}
	return
	if (r1 < 200) {
		r1 = 0
	} else {
		r1 = -1
	}
	if (r1 != 0) {
		return
	}
*refreshPCBurdenState
	cInventoryWeight(0) = limitIntMax(limitf(inv_weight(0), 0.0, 20000000.0) * limitmin(100 - gettrait(0, 201) * 10 + gettrait(0, 205) * 20 - limitmax(have_bigench2(0, 15), 90), 0) / 100)
	cMaxInventoryWeight(0) = limitIntMax((2.0 * sdata(10, 0) + 1.0 * sdata(11, 0) + 8.0 * sdata(153, 0) + 180) * 250)
	repeat 1
		if (cInventoryWeight(0) / 2 > cMaxInventoryWeight(0)) {
			cInventoryWeightType(0) = 4
			break
		}
		if (cInventoryWeight(0) > cMaxInventoryWeight(0)) {
			cInventoryWeightType(0) = 3
			break
		}
		if (cInventoryWeight(0) > cMaxInventoryWeight(0) / 4 * 3) {
			cInventoryWeightType(0) = 2
			break
		}
		if (cInventoryWeight(0) > cMaxInventoryWeight(0) / 2) {
			cInventoryWeightType(0) = 1
			break
		}
		cInventoryWeightType(0) = 0
	loop
	refreshspeed 0
	gosub *label_1857
	return



#defcfunc calcscore
	p = cLevel(0) * cLevel(0) + gDeepestDungeonLevel * gDeepestDungeonLevel + gKillCount
	if (gDeathCount > 1) {
		p = p / 10 + 1
	}
	if (gWizard) {
		p = 0
	}
	return p



#deffunc calcpartyscore
	partypoint = 0
	repeat 188, 57
		if (cState(cnt) != 1) {
			continue
		}
		if (cImpression(cnt) >= 53) {
			partypoint += cLevel(cnt) + 5
		}
		if (cImpression(cnt) < 50) {
			partypoint -= 20
		}
	loop
	if (partypoint > qdata(13, gExecutingImmediateQuest)) {
		txtef 4
		txt -1, "(+" + (partypoint - qdata(13, gExecutingImmediateQuest)) + ") "
	}
	if (partypoint < qdata(13, gExecutingImmediateQuest)) {
		txtef 3
		txt -1, "(" + (partypoint - qdata(13, gExecutingImmediateQuest)) + ") "
	}
	qdata(13, gExecutingImmediateQuest) = partypoint
	return



#deffunc calcpartyscore2
	p = 0
	repeat 188, 57
		if (cState(cnt) != 1) {
			continue
		}
		if (cImpression(cnt) >= 53) {
			if (cQuality(cnt) >= 4) {
				p += 20 + cLevel(cnt) / 2
				txt -1, lang(cdatan(0, cnt) + "は満足した。", cdatan(0, cnt) + " " + is(cnt) + " satisfied.")
			}
		}
	loop
	if (p != 0) {
		txt -1, lang("(合計ボーナス:" + p + "%) ", "(Total Bonus:" + p + "%)")
	}
	qdata(13, gExecutingImmediateQuest) = qdata(13, gExecutingImmediateQuest) * (100 + p) / 100
	return
*label_0726
	if (sorg(174, 0) > 15) {
		if (spact(629 - 600) == 0) {
			spact(629 - 600) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(629) + "」の能力を得た。", "You have learned new ability, " + skillname(629) + ".")
		}
		if (spact(630 - 600) == 0) {
			spact(630 - 600) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(630) + "」の能力を得た。", "You have learned new ability, " + skillname(630) + ".")
		}
	}
	if (sorg(152, 0) > 15) {
		if (spact(631 - 600) == 0) {
			spact(631 - 600) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(631) + "」の能力を得た。", "You have learned new ability, " + skillname(631) + ".")
		}
		/*みねうち*/
		if (ospact(sId_falseSwipe - 661) == 0) {
			ospact(sId_falseSwipe - 661) = 1
			txtef 5
			txt_select -1, lang("あなたは「" + skillname(sId_falseSwipe) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_falseSwipe) + "."), "", "", "", "", "", "", "", ""
		}
	}
	if (sorg(189, 0) > 15) {
		if (ospact(661 - 661) == 0) {
			ospact(661 - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(661) + "」の能力を得た。", "You have learned new ability, " + skillname(661) + ".")
		}
	}
	// oo職業追加技能
	nc_setjobskill
	/*
	if (cdatan(3, 0) == "idol" & sorg(183, 0) >= 15) {
		if (ospact(sId_powersong - 661) == 0) {
			ospact(sId_powersong - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_powersong) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_powersong) + ".")
		}
		if (ospact(sId_hopesong - 661) == 0) {
			ospact(sId_hopesong - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_hopesong) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_hopesong) + ".")
		}
		if (ospact(sId_crashsong - 661) == 0) {
			ospact(sId_crashsong - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_crashsong) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_crashsong) + ".")
		}
	} else {
		ospact(sId_powersong - 661) = 0
		ospact(sId_hopesong - 661) = 0
		ospact(sId_crashsong - 661) = 0
	}
	if (cdatan(3, 0) == "fighter" & sorg(106, 0) >= 15) {
		if (ospact(sId_addattack - 661) == 0) {
			ospact(sId_addattack - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_addattack) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_addattack) + ".")
		}
	} else {
		ospact(sId_addattack - 661) = 0
	}
	if (cdatan(3, 0) == "guard" & sorg(152, 0) >= 15) {
		if (ospact(sId_reinforcement - 661) == 0) {
			ospact(sId_reinforcement - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_reinforcement) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_reinforcement) + ".")
		}
	} else {
		ospact(sId_reinforcement - 661) = 0
	}
	if (cdatan(3, 0) == "samurai" & sorg(186, 0) >= 15) {
		if (ospact(sId_cutoff - 661) == 0) {
			ospact(sId_cutoff - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_cutoff) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_cutoff) + ".")
		}
	} else {
		ospact(sId_cutoff - 661) = 0
	}
	if (cdatan(3, 0) == "rogue" & sorg(12, 0) >= 15) {
		if (ospact(sId_robbery - 661) == 0) {
			ospact(sId_robbery - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_robbery) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_robbery) + ".")
		}
	} else {
		ospact(sId_robbery - 661) = 0
	}
	if (cdatan(3, 0) == "barbarian" & sorg(152, 0) >= 15) {
		if (ospact(sId_angryblow - 661) == 0) {
			ospact(sId_angryblow - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_angryblow) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_angryblow) + ".")
		}
	} else {
		ospact(sId_angryblow - 661) = 0
	}
	if (cdatan(3, 0) == "pirate" & sorg(185, 0) >= 15) {
		if (ospact(sId_swimming - 661) == 0) {
			ospact(sId_swimming - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_swimming) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_swimming) + ".")
		}
	} else {
		ospact(sId_swimming - 661) = 0
	}
	if (cdatan(3, 0) == "ninja" & sorg(152, 0) >= 15) {
		if (ospact(sId_shadowalternation - 661) == 0) {
			ospact(sId_shadowalternation - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_shadowalternation) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_shadowalternation) + ".")
		}
	} else {
		ospact(sId_shadowalternation - 661) = 0
	}
	if (cdatan(3, 0) == "scientist" & sorg(151, 0) >= 15) {
		if (ospact(sId_genedeprivation - 661) == 0) {
			ospact(sId_genedeprivation - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_genedeprivation) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_genedeprivation) + ".")
		}
	} else {
		ospact(sId_genedeprivation - 661) = 0
	}
	if (cdatan(3, 0) == "librarian" & sorg(150, 0) >= 15) {
		if (ospact(sId_instantreading - 661) == 0) {
			ospact(sId_instantreading - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_instantreading) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_instantreading) + ".")
		}
	} else {
		ospact(sId_instantreading - 661) = 0
	}
	if (cdatan(3, 0) == "gunslinger" & sorg(189, 0) >= 15) {
		if (ospact(sId_backshot - 661) == 0) {
			ospact(sId_backshot - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_backshot) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_backshot) + ".")
		}
	} else {
		ospact(sId_backshot - 661) = 0
	}
	if (cdatan(3, 0) == "valkyrie" & sorg(152, 0) >= 15) {
		if (ospact(sId_inspiringcommand - 661) == 0) {
			ospact(sId_inspiringcommand - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_inspiringcommand) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_inspiringcommand) + ".")
		}
	} else {
		ospact(sId_inspiringcommand - 661) = 0
	}
	if (cdatan(3, 0) == "cultist" & sorg(181, 0) >= 15) {
		if (ospact(sId_punishment - 661) == 0) {
			ospact(sId_punishment - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_punishment) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_punishment) + ".")
		}
	} else {
		ospact(sId_punishment - 661) = 0
	}
	if (cdatan(3, 0) == "dancer" & sorg(173, 0) >= 15) {
		if (ospact(sId_battlefielddance - 661) == 0) {
			ospact(sId_battlefielddance - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_battlefielddance) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_battlefielddance) + ".")
		}
	} else {
		ospact(sId_battlefielddance - 661) = 0
	}
	if (cdatan(3, 0) == "guide" & sorg(182, 0) >= 15) {
		if (ospact(sId_guide - 661) == 0) {
			ospact(sId_guide - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_guide) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_guide) + ".")
		}
	} else {
		ospact(sId_guide - 661) = 0
	}
	if (((cdatan(3, 0) == "prostitute" | cdatan(3, 0) == "male prostitute") & sorg(156, 0) >= 15) | gettrait(0, 250) > 0) {
		if (ospact(sId_pleasant - 661) == 0) {
			ospact(sId_pleasant - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_pleasant) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_pleasant) + ".")
		}
	} else {
		ospact(sId_pleasant - 661) = 0
	}
	if (cdatan(3, 0) == "noble" & sorg(156, 0) >= 15) {
		if (ospact(sId_charisma - 661) == 0) {
			ospact(sId_charisma - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_charisma) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_charisma) + ".")
		}
	} else {
		ospact(sId_charisma - 661) = 0
	}
	if (cdatan(3, 0) == "merchant" & sorg(160, 0) >= 15) {
		if (ospact(sId_zenithrow - 661) == 0) {
			ospact(sId_zenithrow - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_zenithrow) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_zenithrow) + ".")
		}
	} else {
		ospact(sId_zenithrow - 661) = 0
	}
	if (cdatan(3, 0) == "blacksmith" & sorg(11, 0) >= 15) {
		if (ospact(sId_blowofconfidence - 661) == 0) {
			ospact(sId_blowofconfidence - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_blowofconfidence) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_blowofconfidence) + ".")
		}
	} else {
		ospact(sId_blowofconfidence - 661) = 0
	}
	if (cdatan(3, 0) == "swashbuckler" & sorg(11, 0) >= 15) {
		if (ospact(sId_fightstep - 661) == 0) {
			ospact(sId_fightstep - 661) = 1
			txtef 5
			txt -1, lang("あなたは「" + skillname(sId_fightstep) + "」の能力を得た。", "You have learned new ability, " + skillname(sId_fightstep) + ".")
		}
	} else {
		ospact(sId_fightstep - 661) = 0
	}
	*/
	return



#defcfunc eqweaponlight
	if (rnd(2)) {
		return 10003
	}
	if (rnd(2)) {
		return 10009
	}
	return 10004



#defcfunc eqweaponheavy
	if (rnd(3) == 0) {
		return 10001
	}
	if (rnd(3) == 0) {
		return 10010
	}
	if (rnd(3) == 0) {
		return 10008
	}
	return 10005



#deffunc eqrandweaponmage int __ppp
	p@m162 = rnd(2)
	if (p@m162 == 0) {
		eqweapon1 = 10003, __ppp
	}
	if (p@m162 == 1) {
		eqweapon1 = 10006, __ppp
	}
	return
*label_0730
	if (cdatan(2, rc) == "mutant") {
		r1 = rc
		repeat cLevel(r1) / 3
			gosub *gainNewBodyPart
		loop
	}
	memset initeq, 0, 20 * 4 * 3
	if (mode == 1) {
		fixeq = 0
		probeq = 10
	} else {
		if (cQuality(rc) <= 2) {
			probeq = 3
			fixeq = 0
		} else {
			if (cQuality(rc) == 3) {
				probeq = 6
				fixeq = 1
			} else {
				if (cQuality(rc) == 4) {
					probeq = 8
					fixeq = 2
				} else {
					probeq = 10
					fixeq = 2
				}
			}
		}
	}
	if (cequipment == 1) {
		generatemoney rc
		eqweapon1 = eqweaponheavy(), 2
		eqshield = 14003, 1
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqhelm = 12001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
		if (rnd(10) < probeq) {
			eqgirdle = 19001, 1
		}
		eqrange = 24030, 1
	}
	if (cequipment == 2) {
		generatemoney rc
		eqrandweaponmage 2
		eqamulet1 = 34001, 1
		eqring1 = 32001, 2
		eqring2 = 32001, 1
		if (rnd(10) < probeq) {
			eqarmor = 16003, 1
		}
		if (rnd(10) < probeq) {
			eqcloack = 20001, 1
		}
	}
	if (cequipment == 3) {
		generatemoney rc
		eqweapon1 = 10002, 1
		eqrange = 24001, 1
		eqammo = 25001, 1
		eqcloack = 20001, 1
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqglove = 22001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
	}
	if (cequipment == 4) {
		generatemoney rc
		if (rnd(2) != 0) {
			eqweapon1 = 24020, 2
		} else {
			eqweapon1 = 10002, 1
		}
		if (rnd(4) != 0) {
			eqrange = 24020, 2
			eqammo = 25020, 1
		} else {
			eqrange = 24021, 2
			eqammo = 25030, 1
		}
		eqcloack = 20001, 1
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqglove = 22001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
	}
	if (cequipment == 5) {
		generatemoney rc
		eqrandweaponmage 2
		eqamulet1 = 34001, 1
		eqring1 = 32001, 2
		eqring2 = 32001, 1
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqcloack = 20001, 1
		}
	}
	if (cequipment == 6) {
		generatemoney rc
		eqweapon1 = 10004, 1
		if (rnd(10) < probeq) {
			eqshield = 14003, 1
		}
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqhelm = 12001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
	}
	if (cequipment == 7) {
		generatemoney rc
		eqweapon1 = eqweaponlight(), 2
		eqweapon2 = eqweaponlight(), 2
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqhelm = 12001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
		if (rnd(10) < probeq) {
			eqgirdle = 19001, 1
		}
		eqrange = 24030, 1
		eqtwowield = 1
	}
	if (cequipment == 8) {
		generatemoney rc
		eqweapon1 = 232, 3
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
		if (rnd(10) < probeq) {
			eqgirdle = 19001, 1
		}
		if (rnd(10) < probeq) {
			eqcloack = 20001, 2
		}
		eqrange = 24030, 1
		eqtwohand = 1
	}
	if (cequipment == 11) {
		generatemoney rc
		eqweapon1 = eqweaponlight(), 1
		eqrange = 24001, 1
		eqammo = 25001, 1
		eqcloack = 20001, 1
		if (rnd(10) < probeq) {
			eqhelm = 12002, 1
		}
		if (rnd(10) < probeq) {
			eqglove = 22003, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18002, 1
		}
	}
	if (cequipment == 12) {
		generatemoney rc
		if (rnd(3) == 0) {
			if (rnd(2) == 0) {
				eqweapon1 = 10007, 2
			} else {
				eqweapon1 = 10008, 2
			}
		} else {
			eqweapon1 = 10004, 1
			eqshield = 14003, 1
		}
		eqarmor = 16001, 2
		if (rnd(10) < probeq) {
			eqhelm = 12001, 1
		}
		if (rnd(10) < probeq) {
			eqglove = 22001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
	}
	if (cequipment == 13) {
		generatemoney rc
		eqweapon1 = 10011, 1
		eqarmor = 16003, 1
		if (rnd(10) < probeq) {
			eqcloack = 20001, 1
		}
	}
	if (cequipment == 14) {
		generatemoney rc
		eqweapon1 = 2, 2
		eqring1 = 32001, 2
		if (rnd(10) < probeq) {
			eqamulet1 = 34001, 2
		}
		if (rnd(10) < probeq) {
			eqring2 = 32001, 2
		}
	}
	if (cequipment == 15) {
		generatemoney rc
		eqweapon1 = 10003, 1
		eqrange = 24003, 2
		eqammo = 25002, 1
		eqcloack = 20001, 1
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqglove = 22001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
	}
	if (cequipment == 16) {
		generatemoney rc
		if (rnd(3) == 0) {
			eqweapon1 = 10010, 3
		} else {
			eqweapon1 = 10009, 2
			eqweapon2 = 10009, 2
		}
		if (rnd(10) < probeq) {
			eqarmor = 16001, 1
		}
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
		if (rnd(10) < probeq) {
			eqhelm = 12001, 1
		}
	}
	if (cequipment == 17) {
		eqweapon1 = 10007, 3
		if (rnd(10) < probeq) {
			eqboots = 18001, 1
		}
		if (rnd(10) < probeq) {
			eqgirdle = 19001, 1
		}
		if (rnd(10) < probeq) {
			eqcloack = 20001, 2
		}
		eqrange = 24030, 1
		eqtwohand = 1
	}
	if (cQuality(rc) >= 4) {
		repeat 2
			if (rnd(2) == 0) {
				initeq(1, rnd(20)) = 3
			}
			if (rnd(2) == 0) {
				continue cnt
			}
		loop
	}
	if (cspecialeq) {
		dbmode = 4
		dbid = cId(rc)
		gosub *label_2067
	}
	if (eqtwohand) {
		eqshield = 0
	}
	if (ocbit(7, rc) == 0) {
		if (cId(rc) == 9) {
			if (rnd(120) == 0) {
				eqamulet1 = 705
			}
		}
		if (cId(rc) == 274) {
			if (rnd(100) == 0) {
				eqrange = 718
			}
		}
		if (cId(rc) == 163) {
			if (rnd(200) == 0) {
				eqrange = 716
			}
		}
		if (cId(rc) == 186 | cId(rc) == 187 | cId(rc) == 188) {
			if (rnd(800) == 0) {
				eqgirdle = 728
			}
		}
		if (cId(rc) == 317) {
			if (rnd(150) == 0 | cQuality(rc) == 6) {
				eqweapon1 = 719
			}
		}
		if (cId(rc) == 309 | cId(rc) == 310 | cId(rc) == 311) {
			if (rnd(600) == 0) {
				eqamulet1 = 723
			}
		}
		if (cId(rc) == 304) {
			if (rnd(250) == 0) {
				eqamulet1 = 722
			}
		}
	}
	if (cId(rc) == 0 & cOriginalRelationship(rc) == (-3)) {
		p(99) = topattackskill(0)
		if (p(99) == 109) {
			eqrange = 24003
			eqammo = 25002
		} else {
			if (p(99) == 100) {
				if (rnd(2)) {
					eqweapon1 = 10001
				} else {
					eqweapon1 = 10002
				}
			} else {
				if (p(99) == 101) {
					eqweapon1 = 10003
				} else {
					if (p(99) == 102) {
						if (rnd(2)) {
							eqweapon1 = 10009
						} else {
							eqweapon1 = 10010
						}
					} else {
						if (p(99) == 103) {
							if (rnd(2)) {
								eqweapon1 = 10004
							} else {
								eqweapon1 = 10005
							}
						} else {
							if (p(99) == 104) {
								if (rnd(2)) {
									eqweapon1 = 10007
								} else {
									eqweapon1 = 10008
								}
							} else {
								if (p(99) == 105) {
									eqweapon1 = 10006
								} else {
									if (p(99) == 106) {
										eqweapon1 = 0
										if (boss) {
											eqshield(1) = 5
										}
									} else {
										if (p(99) == 107) {
											eqweapon1 = 10011
										} else {
											if (p(99) == 111) {
												eqrange = 24030
												eqammo = 0
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		if (boss) {
			if (cequipment == 3 | cequipment == 4) {
				if (eqrange != 0) {
					eqrange(1) = 5
				}
			} else {
				if (eqweapon1 != 0) {
					eqweapon1(1) = 5
				}
			}
		}
	}
	repeat 30, 100
		p = cdata(cnt, rc) / 10000
		if (p == 0) {
			break
		}
		if (p == 2) {
			if (eqamulet1) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqamulet1(1))
				if (eqamulet1 >= 10000) {
					flttypeminor = eqamulet1
					dbid = -1
				} else {
					dbid = eqamulet1
					if (dbid == 743) {
						inititemid = eqamulet1(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqamulet1 = 0
				continue
			}
			if (eqamulet2) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqamulet2(1))
				if (eqamulet2 >= 10000) {
					flttypeminor = eqamulet2
					dbid = -1
				} else {
					dbid = eqamulet2
					if (dbid == 743) {
						inititemid = eqamulet2(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqamulet2 = 0
				continue
			}
		}
		if (p == 6) {
			if (eqring1) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqring1(1))
				if (eqring1 >= 10000) {
					flttypeminor = eqring1
					dbid = -1
				} else {
					dbid = eqring1
					if (dbid == 743) {
						inititemid = eqring1(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqring1 = 0
				continue
			}
			if (eqring2) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqring2(1))
				if (eqring2 >= 10000) {
					flttypeminor = eqring2
					dbid = -1
				} else {
					dbid = eqring2
					if (dbid == 743) {
						inititemid = eqring2(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqring2 = 0
				continue
			}
		}
		if (p == 3) {
			if (eqcloack) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqcloack(1))
				if (eqcloack >= 10000) {
					flttypeminor = eqcloack
					dbid = -1
				} else {
					dbid = eqcloack
					if (dbid == 743) {
						inititemid = eqcloack(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqcloack = 0
				continue
			}
			continue
		}
		if (p == 8) {
			if (eqgirdle) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqgirdle(1))
				if (eqgirdle >= 10000) {
					flttypeminor = eqgirdle
					dbid = -1
				} else {
					dbid = eqgirdle
					if (dbid == 743) {
						inititemid = eqgirdle(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqgirdle = 0
				continue
			}
			continue
		}
		if (p == 1) {
			if (eqhelm) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqhelm(1))
				if (eqhelm >= 10000) {
					flttypeminor = eqhelm
					dbid = -1
				} else {
					dbid = eqhelm
					if (dbid == 743) {
						inititemid = eqhelm(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqhelm = 0
				continue
			}
			continue
		}
		if (p == 4) {
			if (eqarmor) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqarmor(1))
				if (eqarmor >= 10000) {
					flttypeminor = eqarmor
					dbid = -1
				} else {
					dbid = eqarmor
					if (dbid == 743) {
						inititemid = eqarmor(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqarmor = 0
				continue
			}
			continue
		}
		if (p == 7) {
			if (eqglove) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqglove(1))
				if (eqglove >= 10000) {
					flttypeminor = eqglove
					dbid = -1
				} else {
					dbid = eqglove
					if (dbid == 743) {
						inititemid = eqglove(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqglove = 0
				continue
			}
			continue
		}
		if (p == 9) {
			if (eqboots) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqboots(1))
				if (eqboots >= 10000) {
					flttypeminor = eqboots
					dbid = -1
				} else {
					dbid = eqboots
					if (dbid == 743) {
						inititemid = eqboots(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqboots = 0
				continue
			}
			continue
		}
		if (p == 5) {
			if (eqmultiweapon) {
				repeat 15
					flt calcobjlv(cLevel(rc)), calcfixlv(2 + fixeq)
					itemcreate rc, eqmultiweapon, -1, -1, 0
					if (iWeight(ci) > 1500) {
						if (cnt < 14) {
							iNumber(ci) = 0
							continue
						}
					}
					break
				loop
				r1 = rc
				body = cnt
				gosub *label_1418
				eqweapon1 = 0
				continue
			}
			if (eqweapon1) {
				if (eqweapon1 >= 10000) {
					repeat 15
						flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon1(1))
						flttypeminor = eqweapon1
						dbid = -1
						itemcreate rc, dbid, -1, -1, 0
						if (eqtwohand) {
							if (iWeight(ci) < 4000) {
								if (cnt < 14) {
									iNumber(ci) = 0
									continue
								}
							}
						}
						if (eqtwowield) {
							if (iWeight(ci) > 1500) {
								if (cnt < 14) {
									iNumber(ci) = 0
									continue
								}
							}
						}
						break
					loop
				} else {
					flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon1(1))
					dbid = eqweapon1
					if (dbid == 743) {
						inititemid = eqweapon1(2)
					}
					itemcreate rc, dbid, -1, -1, 0
				}
				r1 = rc
				body = cnt
				gosub *label_1418
				eqweapon1 = 0
				continue
			}
			if (eqweapon2) {
				if (eqweapon2 >= 10000) {
					repeat 15
						flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon2(1))
						flttypeminor = eqweapon2
						dbid = -1
						itemcreate rc, dbid, -1, -1, 0
						if (eqtwowield) {
							if (iWeight(ci) > 1500) {
								if (cnt < 14) {
									iNumber(ci) = 0
									continue
								}
							}
						}
						break
					loop
				} else {
					flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon2(1))
					dbid = eqweapon2
					if (dbid == 743) {
						inititemid = eqweapon2(2)
					}
					itemcreate rc, dbid, -1, -1, 0
				}
				eqweapon2 = 0
				r1 = rc
				body = cnt
				gosub *label_1418
				continue
			}
			if (eqshield) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqshield(1))
				if (eqshield >= 10000) {
					flttypeminor = eqshield
					dbid = -1
				} else {
					dbid = eqshield
					if (dbid == 743) {
						inititemid = eqshield(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqshield = 0
				continue
			}
			continue
		}
		if (p == 10) {
			if (eqrange) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqrange(1))
				if (eqrange >= 10000) {
					flttypeminor = eqrange
					dbid = -1
				} else {
					dbid = eqrange
					if (dbid == 743) {
						inititemid = eqrange(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqrange = 0
				continue
			}
			continue
		}
		if (p == 11) {
			if (eqammo) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqammo(1))
				if (eqammo >= 10000) {
					flttypeminor = eqammo
					dbid = -1
				} else {
					dbid = eqammo
					if (dbid == 743) {
						inititemid = eqammo(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_1418
				eqammo = 0
				continue
			}
			continue
		}
	loop
	if (cId(rc) == 326) {
		if (ocbit(7, rc) == 0 & rnd(150) == 0) {
			flt
			itemcreate rc, 707, -1, -1, 0
		} else {
			flt calcobjlv(cLevel(rc)), calcfixlv()
			flttypeminor = 60005
			itemcreate rc, 0, -1, -1, 0
		}
	}
	if (cId(rc) == 343) {
		if (userdata2(5, cCnpcId(rc)) == 1) {
			flt calcobjlv(cLevel(rc)), calcfixlv()
			flttypeminor = 60005
			itemcreate rc, 0, -1, -1, 0
		}
	}
	if (cId(rc) == 351 | cId(rc) == 352) {
		repeat 6
			flt
			nostack = 1
			itemcreate rc, 772, -1, -1, 0
			if (stat != 0) {
				iNumber(ci) += rnd(4)
				if (rnd(2)) {
					iParam3(ci) = -1
					iImage(ci) = 336
				}
			}
		loop
	}
	if (nomagicdevice == 0) {
		if (cId(rc) == 343) {
			if (cCnpcId(rc) != usernpcmax) {
				s = userdatan(4, cCnpcId(rc))
			} else {
				s = ""
			}
		} else {
			s = refchara(cId(rc), 8, 1)
		}
		if (instr(s, 0, "/man/") != (-1)) {
			if (sorg(174, rc) != 0) {
				repeat rnd(3)
					flt calcobjlv(cLevel(rc)), calcfixlv()
					flttypemajor = 56000
					itemcreate rc, 0, -1, -1, 0
				loop
			}
			if (sorg(150, rc) != 0 & sorg(165, rc) != 0) {
				repeat rnd(3)
					flt calcobjlv(cLevel(rc)), calcfixlv()
					flttypemajor = 54000
					itemcreate rc, 0, -1, -1, 0
				loop
			}
		}
	}
	if (noenchant == 0) {
		if (cId(rc) == 343) {
			if (userdata(12, cCnpcId(rc)) == 2) {
				if (cQuality(rc) == 6) {
					repeat rnd(1 + cLevel(rc) / 10)
						if (inv_getfreeid(rc) == (-1)) {
							break
						}
						flt calcobjlv(cLevel(rc)), calcfixlv(4)
						if (fixlv == 3) {
							if (rnd(20) == 0) {
								fltselect = 2
							}
						}
						if (fixlv == 4) {
							if (rnd(10) == 0) {
								fltselect = 2
							}
						}
						itemcreate rc, 0, -1, -1, 0
					loop
					r1 = rc
					gosub *chara_refresh
				}
			}
		}
	}
	if (cId(rc) == 343) {
		if (userdatan(0, cCnpcId(rc)) == "putit putit") {
			if (rnd(5) == 0) {
				flt
				itemcreate rc, 55, -1, -1, 1
			}
		}
	}
	eqtwohand = 0
	eqtwowield = 0
	eqmultiweapon = 0
	nospartifact = 0
	nomagicdevice = 0
	noenchant = 0
	noencpfix = 0
	return
*label_0731
	p = 100
	i@ooen = 0
	repeat 30
		getstr s, s(1), i@ooen, 124
		if (strsize == 0) {
			break
		}
		i@ooen += strsize
		s = getpath(s, 16)
		if (s == "頭" | s == "head") {
			cdata(p, rc) = 1 * 10000
			p++
			continue
		}
		if (s == "首" | s == "neck") {
			cdata(p, rc) = 2 * 10000
			p++
			continue
		}
		if (s == "背" | s == "back") {
			cdata(p, rc) = 3 * 10000
			p++
			continue
		}
		if (s == "体" | s == "body") {
			cdata(p, rc) = 4 * 10000
			p++
			continue
		}
		if (s == "手" | s == "hand") {
			cdata(p, rc) = 5 * 10000
			p++
			continue
		}
		if (s == "指" | s == "ring") {
			cdata(p, rc) = 6 * 10000
			p++
			continue
		}
		if (s == "腕" | s == "arm") {
			cdata(p, rc) = 7 * 10000
			p++
			continue
		}
		if (s == "腰" | s == "waist") {
			cdata(p, rc) = 8 * 10000
			p++
			continue
		}
		if (s == "足" | s == "leg") {
			cdata(p, rc) = 9 * 10000
			p++
			continue
		}
	loop
	cdata(p, rc) = 10 * 10000
	p++
	cdata(p, rc) = 11 * 10000
	p++
	return



#deffunc place_chara int __qqq, int __rrr, int __sss
	if (__qqq == (-1)) {
		return
	}
	if (__qqq == 56) {
		cState(__qqq) = 0
		return
	}
	placefail = 0
	if (gMount == __qqq) {
		if (__qqq != 0) {
			cX(__qqq) = cX(0)
			cY(__qqq) = cY(0)
			return
		}
	}
	repeat
		if (cnt == 99) {
			if (__qqq >= 57) {
				placefail = 1
				break
			}
		}
		if (cnt > 99) {
			if (mapWidth == 0) {
				placefail = 1
				break
			}
			y = (cnt - 100) / mapWidth
			x = (cnt - 100) \ mapWidth
			if (y >= mapHeight) {
				if (__qqq != 0) {
					placefail = 1
					break
				} else {
					x = rnd(mapWidth)
					y = rnd(mapHeight)
					if (map(x, y, 1) != 0) {
						map(x, y, 1) = 0
					}
					if (chipm(7, map(x, y, 0)) & 4) {
						map(x, y, 0) = tile_tunnel
					}
					if (map(x, y, 6) != 0) {
						cell_featread x, y
						if (feat(1) == 21 | feat(1) == 22) {
							map(x, y, 6) = 0
						}
					}
				}
			}
		} else {
			x = rnd(mapWidth - 4) + 2
			y = rnd(mapHeight - 4) + 2
			if (__rrr >= 0) {
				if (cnt == 0) {
					x = __rrr
					y = __sss
				} else {
					x = __rrr + rnd(cnt + 1) - rnd(cnt + 1)
					y = __sss + rnd(cnt + 1) - rnd(cnt + 1)
				}
			}
			if (cnt < 20) {
				if (__rrr == (-2)) {
					p = cVisionDistance(0) / 2
					if (x >= cX(0) - p & x <= cX(0) + p) {
						if (y >= cY(0) - p & y <= cY(0) + p) {
							continue
						}
					}
				}
			}
		}
		if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
			continue
		}
		if (chipm(7, map(x, y, 0)) & 4) {
			continue
		}
		if (map(x, y, 1) != 0) {
			continue
		}
		if (map(x, y, 6) != 0) {
			if (chipm(7, map(x, y, 6) \ 1000) & 4) {
				continue
			}
			cell_featread x, y
			if (feat(1) == 11) {
				if (__qqq != 0) {
					if (__rrr < 0) {
						continue
					}
				}
			}
			if (feat(1) == 10) {
				if (__qqq != 0) {
					if (__rrr < 0) {
						continue
					}
				}
			}
		}
		cInitialX(__qqq) = x
		cInitialY(__qqq) = y
		map(x, y, 1) = __qqq + 1
		cX(__qqq) = x
		cY(__qqq) = y
		p = 1
		break
	loop
	if (placefail == 1) {
		if (__qqq < 16) {
			cState(__qqq) = 8
			txt -1, lang(name(__qqq) + "とはぐれた。", name(__qqq) + " loses " + his(__qqq) + " way.")
		} else {
			if (isHiringServants == 0) {
				txt -1, lang(name(__qqq) + "は何かに潰されて息絶えた。", name(__qqq) + " is killed.")
			}
			cState(__qqq) = 0
		}
		if (cRole(__qqq) != 0) {
			cState(__qqq) = 2
		}
		if (cRole(__qqq) == 13) {
			advdie gdata, cdata, ocdata, __qqq
		}
		if (__qqq >= 57) {
			addcrowd gCrowdDensity, -1
		}
	}
	return
*label_0733
	if (rc == (-1)) {
		repeat 188, 57
			if (cState(cnt) == 0) {
				rc = cnt
				break
			}
		loop
		if (rc == (-1)) {
			rc = 56
			return 0
		}
	}
	del_chara rc
	cequipment = 0
	cmshade = 0
	if (rc == 0) {
		p = 10
	} else {
		p = 4
	}
	if (dbid == (-1)) {
		if (fltselect == 0 & filtermax == 0 & flttypemajor == 0 & flttypeminor == 0 & fltnrace == "" & fltnclass == "") {
			if (fixlv == 3) {
				if (rnd(20) == 0) {
					fltselect = 2
				}
			}
			if (fixlv == 4) {
				if (rnd(10) == 0) {
					fltselect = 2
				}
			}
		}
		if (gCurrentMap != 30) {
			p(43) = difficulty()
			if (fltselect == 0 & initlv == 0) {
				if (oabit(7, gCurrentMap) == 1 | areaId(gCurrentMap) == 3) {
					npcrare = 1
				} else {
					if (p(43) >= 150) {
						p(42) = 10
					} else {
						if (p(43) >= 100) {
							p(42) = 20
						} else {
							if (p(43) >= 50) {
								p(42) = 40
							} else {
								p(42) = 80
							}
						}
					}
					if (rnd(p(42)) == 0) {
						npcrare = 1
					}
				}
			}
			if (p(43) <= 5) {
				nomagicdevice = 1
			}
		}
		dbmode = 1
		gosub *label_2067
		if (dbid == 0) {
			if (fltselect == 2 | fixlv == 6) {
				fixlv = 4
			}
			flt objlv + 10, fixlv
			fltselect = 0
			dbmode = 1
			gosub *label_2067
		}
	} else {
		if (dbid == 343) {
			cCnpcId(rc) = usernpcmax
			olistmax = 0
			repeat usernpcmax
				if (userdata(12, cnt) != 0) {
					continue
				}
				if (instr(userdatan(4, cnt), 0, "/nogenerate/") != (-1)) {
					continue
				}
				if (nc_shopflag) {
					if (instr(userdatan(4, cnt), 0, "/noshop/") != (-1)) {
						continue
					}
				}
				olist(olistmax) = cnt
				olistmax++
			loop
			if (olistmax > 0) {
				cCnpcId(rc) = olist(rnd(olistmax))
			}
		}
	}
	characreatehack = dbid + 1
	cm = 1
	if (dbid == 323) {
		if (rnd(5)) {
			objlv *= 2
			if (fixlv >= 4) {
				fixlv = 3
			}
			cmshade = 1
			flt objlv, fixlv
			dbmode = 1
			gosub *label_2067
		}
	}
	if (oabit(3, gCurrentMap)) {
		if (novoidlv == 0) {
			if (dbid != 318) {
				if (dbid != 319) {
					cmshade = 1
				}
			}
		}
	}
	if (gCurrentMap == 42 | gCurrentMap == 210) {
		if (novoidlv) {
			novoidlv = 0
		} else {
			voidlv = gCurrentDungeonLevel / 50 * 50
		}
	} else {
		if (rank != 0 | npcrare != 0) {
			if (dbid != 343 & dbid != 317) {
				if (initlv) {
					p(41) = initlv
				} else {
					dbmode = 16
					dbspec = 10
					gosub *label_2067
					p(41) = stat
				}
				if (rank == 0) {
					if (npcrare) {
						p = rnd(4) + 2
						repeat p - 1
							if (p(41) * p < objlv) {
								rank = p
								break
							}
							p--
						loop
					}
				}
				if (rank) {
					initlv = p(41) * rank
				}
			}
			npcrare = 0
		}
	}
	novoidlv = 0
	if (dbid == 343) {
		gosub *label_1328
	} else {
		dbmode = 3
		gosub *label_2067
	}
	modnpcmemory 1, rc, 1
	if (rank) {
		if (jp) {
			dbmode = 16
			dbspec = 2
			gosub *label_2067
			rname = refstr
			sreplace uname, cdatan(0, rc), rname, ""
			if (checkalpha(rname)) {
				if (rank == 5) {
					cdatan(0, rc) = "エルダーエンセスターズオブ" + rname
				} else {
					if (rank == 4) {
						cdatan(0, rc) = "チャンピオンオブ" + rname
					} else {
						if (rank == 3) {
							cdatan(0, rc) = "デミゴッド" + rname
						} else {
							if (rank == 2) {
								cdatan(0, rc) = rname + "ヒーロー"
							}
						}
					}
				}
				if (uname != "") {
					cdatan(0, rc) += uname
				}
			} else {
				if (rank == 5) {
					cdatan(0, rc) = "大いなる" + rname + "の祖霊"
				} else {
					if (rank == 4) {
						cdatan(0, rc) = "世界最強の" + rname
					} else {
						if (rank == 3) {
							cdatan(0, rc) = "半神" + rname
						} else {
							if (rank == 2) {
								cdatan(0, rc) = rname + "の英雄"
							}
						}
					}
				}
				if (uname != "") {
					cdatan(0, rc) += uname
				}
			}
		} else {
			if (rank == 5) {
				cdatan(0, rc) = "elder ancestor of " + cdatan(0, rc)
			} else {
				if (rank == 4) {
					cdatan(0, rc) = "champion of " + cdatan(0, rc)
				} else {
					if (rank == 3) {
						cdatan(0, rc) += " demi-god"
					} else {
						if (rank == 2) {
							cdatan(0, rc) += " the hero"
						}
					}
				}
			}
		}
		if (rank == 5) {
			ocdata(101, rc) = 128
			ocdata(102, rc) = -1
		} else {
			ocdata(191, rc) = 9
		}
		cbitmod 977, rc, 1
		ocbitmod 5, rc, 1
	}
	if (cmshade) {
		if (ogdata(517) != 2) {
			cdatan(0, rc) = lang("シェイド", "shade")
		}
		cImage(rc) = 280
		ocbitmod 8, rc, 1
	}
	cQuality(rc) = fixlv
	gosub *label_0735
	rtval = rc
	return 1
*label_0734
	if (fixlv == 4) {
		cdatan(0, rc) = strbracketleft + cdatan(0, rc) + strbracketright
		cLevel(rc) = cLevel(rc) * 10 / 8
	}
	if (fixlv == 5) {
		cdatan(0, rc) = lang("《", "{") + cdatan(0, rc) + lang("》", "}")
		cLevel(rc) = cLevel(rc) * 10 / 6
	}
	return
*label_0735
	if (mode != 1) {
		gosub *label_0734
	}
	cState(rc) = 1
	cInterest(rc) = 100
	cImpression(rc) = 50
	cVisionDistance(rc) = 14
	if (cId(rc) == 205) {
		cImage(rc) = rnd(67 / 2) * 2 + cSex(rc) + 1
	}
	if (cId(rc) == 321) {
		if (rnd(20) == 0) {
			cImage(rc) += 5 * 1000
			ocdata(191, rc) = 7
			cdatan(0, rc) += lang(" (プレミアム)", " (Premium)")
		}
	}
	if (rc == 0) {
		cNutrition(rc) = 9000
	} else {
		cNutrition(rc) = 6000 - 1000 + rnd(4000)
	}
	cHeight(rc) = cHeight(rc) + rnd(cHeight(rc) / 5 + 1) - rnd(cHeight(rc) / 5 + 1)
	cWeight(rc) = cHeight(rc) * cHeight(rc) * (rnd(6) + 18) / 10000
	if (userdata3(1, cCnpcId(rc)) > (-1)) {
		cHeight(rc) = userdata3(1, cCnpcId(rc))
	}
	if (userdata3(2, cCnpcId(rc)) > (-1)) {
		cWeight(rc) = userdata3(2, cCnpcId(rc))
	}
	r1 = rc
	gosub *label_0663
	r1 = rc
	gosub *label_0713
	// MMA_contents
	if (cId(rc) == 343 & cCnpcId(rc) < usernpcmax) {
		if (int(userdatan2(4, cCnpcId(rc))) >= (-1)) {
			cPortrait(rc) = int(userdatan2(4, cCnpcId(rc)))
			if (cPortrait(rc) == (-1)) {
				cPortrait(rc) = rnd(32)
			}
		}
	}
	if (cPortrait(rc) == 0) {
		cPortrait(rc) = rnd(32)
	}
	cPersonality(rc) = rnd(4)
	cTalkType(rc) = rnd(7)
	gosub *label_0730
	r1 = rc
	gosub *chara_refresh
	if (rc >= 57) {
		addcrowd gCrowdDensity, 1
	}
	cHp(rc) = cMaxHp(rc)
	cMp(rc) = cMaxMp(rc)
	cSp(rc) = cMaxSp(rc)
	if (rc == 0) {
		gosub *label_1347
		gInitialCartLimit = 80000
		gCurrentCartLimit = gInitialCartLimit
	}
	if (cbit(21, rc)) {
		cbitmod 974, rc, 1
	}
	if (gettrait(rc, 58)) {
		ocbitmod 9, rc, 1
	}
	ocbitmod 10, rc, 1
	cm = 0
	return
*label_0736
	cQuality(rc) = 2
	cRelationship(rc) = 10
	cOriginalRelationship(rc) = 10
	cbitmod 967, rc, 1
	flt
	itemcreate 0, 333, -1, -1, 0
	iNumber(ci) = 8
	flt
	itemcreate 0, 233, -1, -1, 0
	iNumber(ci) = 4
	flt
	itemcreate 0, 31, -1, -1, 0
	iNumber(ci) = 2
	if (sdata(150, 0) == 0) {
		flt
		itemcreate 0, 68, -1, -1, 0
		iNumber(ci) = 3
	}
	p(38) = 0
	repeat length(classnamecsv)
		if (cdatan(3, 0) == classnamecsv(cnt, 1)) {
			p(38) = classtool(cnt)
			break
		}
	loop
	if (p(38) == 0) {
		if (cdatan(3, 0) == "pianist") {
			flt
			itemcreate 0, 88, -1, -1, 0
		}
		if (cdatan(3, 0) == "farmer") {
			flt
			itemcreate 0, 256, -1, -1, 0
		}
		if (cdatan(3, 0) == "wizard" | cdatan(3, 0) == "warmage") {
			flt
			itemcreate 0, 116, -1, -1, 0
			flt
			itemcreate 0, 257, -1, -1, 0
			iNumber(ci) = 3
		}
		if (cdatan(3, 0) == "priest") {
			flt
			itemcreate 0, 249, -1, -1, 0
			iNumber(ci) = 3
			flt
			itemcreate 0, 378, -1, -1, 0
		}
	}
	if (p(38) == 1) {
		flt
		itemcreate 0, 88, -1, -1, 0
	}
	if (p(38) == 2) {
		flt
		itemcreate 0, 256, -1, -1, 0
	}
	if (p(38) == 3) {
		flt
		itemcreate 0, 116, -1, -1, 0
		flt
		itemcreate 0, 257, -1, -1, 0
		inv(0, ci) = 3
	}
	if (p(38) == 4) {
		flt
		itemcreate 0, 249, -1, -1, 0
		inv(9, ci) = 3
		flt
		itemcreate 0, 378, -1, -1, 0
	}
	if (p(38) == 5) {
		flt
		itemcreate 0, 119, -1, -1, 0
		flt
		itemcreate 0, 120, -1, -1, 0
		inv(0, ci) = 3
	}
	if (p(38) == 6) {
		p(37) = finditemid("blacksmith hammer")
		if (p(37) != 0) {
			flt
			inititemid = p(37)
			itemcreate 0, 743, -1, -1, 0
			inv(25, ci) = 20
		}
	}
	if (p(38) == 7) {
		flt
		itemcreate 0, 692, -1, -1, 0
	}
	if (p(38) == 8) {
		flt
		itemcreate 0, 691, -1, -1, 0
	}
	if (p(38) == 9) {
		flt
		itemcreate 0, 685, -1, -1, 6
		inv(26, ci) = 5
	}
	if (p(38) == 10) {
		mat(1) += 5
	}
	if (p(38) == 11) {
		flt
		itemcreate 0, 342, -1, -1, 0
	}
	if (p(38) == 12) {
		flt
		itemcreate 0, 93, -1, -1, 0
	}
	if (p(38) == 13) {
		flt
		itemcreate 0, 161, -1, -1, 0
	}
	if (p(38) == 14) {
		flt
		itemcreate 0, 256, -1, -1, 0
		flt
		itemcreate 0, 160, -1, -1, 0
	}
	if (p(38) == 15) {
		flt
		itemcreate 0, 127, -1, -1, 0
		flt
		itemcreate 0, 160, -1, -1, 0
		flt
		itemcreate 0, 161, -1, -1, 0
		flt
		itemcreate 0, 393, -1, -1, 0
	}
	if (p(38) == 16) {
		flt
		itemcreate 0, 127, -1, -1, 0
	}
	if (p(38) == 17) {
		flt
		itemcreate 0, 629, -1, -1, 6
		inv(0, ci) = 3
		inv(9, ci) = 5
	}
	gosub *label_0098
	cSkillBonus(r1) = 5 + gettrait(0, 154), 5 + gettrait(0, 154)
	inv_getheader 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		iIdentificationState(cnt) = 3
	loop
	r1 = 0
	gosub *chara_refresh
	return
*label_0737
	gosub *label_0738
	cxinit = cX(0)
	cyinit = cY(0)
	place_chara rc, cxinit, cyinit
	cCurrentMap(rc) = 0
	snd 64
	txtef 5
	txt -1, cnven(cdatan(0, rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
	return
*label_0738
	cbitmod 972, rc, 0
	cbitmod 973, rc, 0
	cbitmod 978, rc, 0
	cbitmod 980, rc, 0
	cbitmod 986, rc, 0
	cHp(rc) = cMaxHp(rc) / 3
	cMp(rc) = cMaxMp(rc) / 3
	cSp(rc) = cMaxSp(rc) / 3
	cInsanity(rc) = 0
	cState(rc) = 1
	cCurrentMap(rc) = 0
	cRelationship(rc) = cOriginalRelationship(rc)
	cNutrition(rc) = 8000
	ocdata(104, rc) = 0
	ocdata(52, rc) = 0
	ocdata(53, rc) = 0
*label_0739
	cbitmod 980, rc, 0
	rowactend rc
	cPoisoned(rc) = 0
	cSleep(rc) = 0
	cConfused(rc) = 0
	cBlind(rc) = 0
	if (gettrait(rc, 195) != 0) {
		cBlind(rc) = 1000
	}
	cParalyzed(rc) = 0
	cStoned(rc) = 0
	cChoked(rc) = 0
	cFurious(rc) = 0
	cDimmed(rc) = 0
	cDrunk(rc) = 0
	cBleeding(rc) = 0
	cGravity(rc) = 0
	cItemWhichWillBeUsed(rc) = 0
	cHate(rc) = 0
	unlockson rc
	cSick(rc) = 0
	cEmotionIcon(rc) = 0
	repeat 20 - 10
		cdata(240 + cnt, rc) = 0
	loop
	if (ocdata(192 + 0 * 3, rc) != 0) {
		repeat 8 + 8
			if (ocdata(192 + cnt * 3, rc) == 0) {
				break
			}
			if (ocdata(192 + cnt * 3, rc) == 13) {
				continue
			}
			delbuff rc, cnt
			continue cnt
		loop
	}
	r1 = rc
	gosub *chara_refresh
	return
*label_0740
	gosub *label_0738
	if (rc == 0) {
		gIsReturningOrEscaping = 0
		traveldone = 0
		if (gExecutingImmediateQuestType == 0) {
			evadd 6
		}
	}
	if (cRole(rc) == 1) {
		cRelationship(rc) = 0
	}
	if (cRole(rc) == 14) {
		p = rnd(5) + 1
		repeat p
			r1 = rc
			r2 = 1
			gosub *label_0661
		loop
	}
	if (cId(rc) == 326) {
		skillmod 183, rc, 1000
	}
	r1 = rc
	gosub *chara_refresh
	return
*label_0741
	if (cfg_wizard) {
		gWizard = 1
	}
	if (geneuse != "") {
		dim takeover, 10
		listmax = 0
		page = 0
		cs = 0
		cs_bk = -1
		redraw 0
		gsel 4
		pos 0, 0
		picload_ exedir + "\\graphic\\void.bmp", 1
		gzoom windoww, windowh, 4, 0, 0, 800, 600
		gsel 0
		gmode 0
		pos 0, 0
		gcopy 4, 0, 0, windoww, windowh
		gmode 2
		gsel 4
		repeat 8
			pos cnt \ 4 * 180, cnt / 4 * 300
			picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
		loop
		gsel 0
		s = lang("どの内容を引き継ぐ？", "Carry over which content?")
		gosub *label_0629
		windowshadow = 1
		listmax = 0
		q = lang("引継ぎ選択", "Carryover selection")
		if (jp) {
			s = "アイテム", "マテリアル", "金貨", "プラチナ", "BP", "プレイ時間", "ペットの冒険者化", "ロミアスの秘密の経験", "妹の日記", "アイテムの色及び未確定名", ""
		} else {
			s = "Items", "Materials", "Gold coins", "Platinum coins", "BP", "Play time", "Turn pets to adventurers", "Secret experience of Lomias", "Little sister's diary", "Items color", ""
		}
		dx = 440
		dy = 350
		repeat 30
			if (s(cnt) == "") {
				break
			}
			list(0, listmax) = cnt
			listn(0, listmax) = s(cnt)
			listmax++
		loop
		repeat
			redraw 0
			pagesize = 0
			s = q, lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]  決定キー [決定]", "Right,left [Change]  Shift,Esc [Close] Enter [Enter]")
			display_window (windoww - dx) / 2 + inf_screenx, winposy(288, 1), dx, dy
			pagesize = listmax
			display_topic lang("項目", "Category"), wx + 34, wy + 36
			x = ww / 5 * 3
			y = wh - 80
			gmode 4, 180, 300, 50
			pos wx + ww / 3, wy + wh / 2
			grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
			gmode 2
			keyrange = 0
			repeat pagesize
				p = pagesize * page + cnt
				if (p >= listmax) {
					break
				}
				key_list(cnt) = key_enter
				keyrange++
			loop
			keyrange = 0
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			cs_listbk
			repeat pagesize
				p = pagesize * page + cnt
				if (p >= listmax) {
					break
				}
				i = list(0, p)
				s = listn(0, p)
				x = 0
				cs_list s, wx + 56 + x, wy + 66 + cnt * 19 - 1, 19, 0
				pos wx + 250, wy + 66 + cnt * 19 - 5
				gcopy 3, 312, 336, 24, 24
				pos wx + 370, wy + 66 + cnt * 19 - 5
				gcopy 3, 336, 336, 24, 24
				pos wx + 280, wy + 66 + cnt * 19
				color 0, 0, 0
				if (cnt == 0) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(0))
				}
				if (cnt == 1) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(1))
				}
				if (cnt == 2) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(2))
				}
				if (cnt == 3) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(3))
				}
				if (cnt == 4) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(4))
				}
				if (cnt == 5) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(5))
				}
				if (cnt == 6) {
					s = lang("する", "Do"), lang("しない", "Don't")
					keyrange++
					mes s(takeover(6))
				}
				if (cnt == 7) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(7))
				}
				if (cnt == 8) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(8))
				}
				if (cnt == 9) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(9))
				}
			loop
			if (keyrange != 0) {
				cs_bk = cs
			}
			redraw 1
			await cfg_wait1
			key_check
			cursor_check
			if (key == key_pageup | key == key_pagedown) {
				repeat
					if (cs == cnt) {
						takeover(cnt) = 1 - takeover(cnt)
						snd 20
						break
					}
				loop
			}
			if (key == key_enter) {
				snd 20
				break
			}
			if (key == key_cancel) {
				p = -1
				break
			}
		loop
		if (p == (-1)) {
			goto *label_1345
		}
		gosub *label_1317
	}
	redraw 0
	rc = 0
	mode = 1
	cm = 1
	gsel 4
	pos 0, 0
	picload_ exedir + "graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel 2
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_cm.bmp", 1
	gsel 0
	dirlist buff, exedir + "save\\*", 5
	notesel buff
	if (noteinfo() >= 5) {
		redraw 0
		keyrange = 0
		gmode 0
		pos 0, 0
		gcopy 4, 0, 0, windoww, windowh
		gmode 2
		s = lang("これ以上は冒険者を保存できない。", "Save slots are full. You have to delete some of your adventurers.")
		gosub *label_0629
		redraw 1
*label_0742
		key_check
		cursor_check
		await cfg_wait1
		if (key != "") {
			goto *label_0743
		}
		goto *label_0742
*label_0743
		goto *label_1341
	}
	goto *label_0759
*label_0744
	redraw 0
	cs = 0
	cs_bk = -1
	pagesize = 16
	page = 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("職業や種族は、初期の能力だけでなく、成長の方向性に影響するんだ。", "Your class and race determine growth rate of your skills and attributes.")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	dbmode = 1
	gosub *label_1525
	repeat listmax
		dbidn = listn(1, cnt)
		dbmode = 2
		gosub *label_1525
		listn(0, cnt) = racename
		if (list(0, cnt) == 1) {
			listn(0, cnt) = "(extra)" + listn(0, cnt)
		}
	loop
	windowshadow = 1
*label_0745
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_0746
	redraw 0
	if (cs != cs_bk) {
		s = lang("種族の選択", "Race Selection"), strhint3b
		display_window (windoww - 680) / 2 + inf_screenx, winposy(500, 1) + 20, 680, 500
		cmbg++
		x = ww / 5 * 2
		y = wh - 80
		gmode 4, 180, 300, 50
		pos wx + ww / 4, wy + wh / 2
		grotate 2, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		display_topic lang("選択できる種族", "Race"), wx + 28, wy + 30
		display_topic lang("種族の説明", "Detail"), wx + 188, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat pagesize
			p = page * pagesize + cnt
			if (p >= listmax) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
			cs_list listn(0, p), wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		cs_bk = cs
		color 0, 0, 0
		pos wx + 200, wy + 66
		del_chara 0
		dbidn = listn(1, page * pagesize + cs)
		dbmode = 3
		gosub *label_1525
		dbmode = 11
		gosub *label_1525
		val = 0
		gosub *label_0768
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if (key == key_select(cnt)) {
			p = page * pagesize + cnt
			break
		} else {
			p = -1
		}
	loop
	if (p != (-1)) {
		cmrace = listn(1, p), listn(0, p)
		dbidn = cmrace
		dbmode = 11
		gosub *label_1525
		goto *label_0747
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_0745
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_0745
		}
	}
	if (key == key_cancel) {
		goto *label_0759
	}
	getkey p, 112
	if (p) {
		gosub *label_1577
		goto *label_0744
	}
	goto *label_0746
*label_0747
	snd 102
*label_0748
	redraw 0
	cs = 0
	cs_bk = -1
	pagesize = 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("男性と女性に能力の違いはない。", "What's your gender?")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	windowshadow = 1
*label_0749
	redraw 0
	s = lang("性別の選択", "Gender Selection"), strhint3b
	display_window (windoww - 370) / 2 + inf_screenx, winposy(168, 1) - 20, 370, 168
	x = ww / 2
	y = wh - 60
	gmode 4, 180, 300, 30
	pos wx + ww / 2, wy + wh / 2
	grotate 2, 0, 0, 0, x, y
	gmode 2
	display_topic lang("性別の候補", "Gender"), wx + 28, wy + 30
	listn(0, 0) = cnven(strmale)
	listn(0, 1) = cnven(strfemale)
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	repeat 2
		key_list(cnt) = key_select(cnt)
		keyrange = cnt + 1
		pos wx + 38, wy + 66 + cnt * 19 - 2
		gcopy 3, cnt * 24 + 72, 30, 24, 18
		cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (key == key_select(0)) {
		cmsex = 0
		goto *label_0750
	}
	if (key == key_select(1)) {
		cmsex = 1
		goto *label_0750
	}
	if (key == key_cancel) {
		goto *label_0744
	}
	getkey p, 112
	if (p) {
		gosub *label_1577
		goto *label_0748
	}
	goto *label_0749
*label_0750
	snd 20
*label_0751
	redraw 0
	cs = 0
	cs_bk = -1
	page = 0
	pagesize = 16
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("職業や種族は、初期の能力だけでなく、成長の方向性に影響するんだ。", "Your class and race determine growth rate of your skills and attributes.")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	dbmode = 1
	gosub *label_1526
	repeat listmax
		dbidn = listn(1, cnt)
		dbmode = 2
		gosub *label_1526
		listn(0, cnt) = classname
	loop
	windowshadow = 1
*label_0752
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_0753
	if (cs != cs_bk) {
		redraw 0
		s = lang("職業の選択", "Class Selection"), strhint3b
		display_window (windoww - 680) / 2 + inf_screenx, winposy(500, 1) + 20, 680, 500
		cmbg++
		x = ww / 5 * 2
		y = wh - 80
		gmode 4, 180, 300, 50
		pos wx + ww / 4, wy + wh / 2
		grotate 2, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		display_topic lang("選択できる職業", "Class"), wx + 28, wy + 30
		display_topic lang("職業の説明", "Detail"), wx + 188, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat pagesize
			p = page * pagesize + cnt
			if (p >= listmax) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
			if (jp) {
				s = listn(0, p)
			} else {
				s = cnven(listn(1, p))
			}
			cs_list s, wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		cs_bk = cs
		color 0, 0, 0
		pos wx + 200, wy + 66
		del_chara 0
		dbidn = listn(1, page * pagesize + cs)
		dbmode = 3
		gosub *label_1526
		dbmode = 11
		gosub *label_1526
		val = 1
		gosub *label_0768
		redraw 1
	}
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if (key == key_select(cnt)) {
			p = page * pagesize + cnt
			break
		} else {
			p = -1
		}
	loop
	if (p != (-1)) {
		cmclass = listn(1, p)
		goto *label_0754
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_0752
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_0752
		}
	}
	if (key == key_cancel) {
		goto *label_0748
	}
	getkey p, 112
	if (p) {
		gosub *label_1577
		goto *label_0751
	}
	goto *label_0753
*label_0754
	snd 101
	dim cmlock, 10
	cmlock(8) = 2
*label_0755
	redraw 0
	cs = 0
	cs_bk = -1
	pagesize = 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("死にたくないなら、ある程度の能力は必要だね。", "You should prepare well, if you want to survive long enough in Ylva.")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	del_chara 0
	dbidn = cmrace
	dbmode = 3
	gosub *label_1525
	dbidn = cmclass
	dbmode = 3
	gosub *label_1526
	cLevel(rc) = 1
	repeat 8, 10
		if (cmlock(cnt - 10) == 0) {
			if (oomSEST_minimumAttributeRoll) {
				sdata(cnt + 600, rc) -= sdata(cnt + 600, rc) / 2000000 * 1000000
			} else {
				sdata(cnt + 600, rc) -= rnd(sdata(cnt + 600, rc) / 2000000 + 1) * 1000000
			}
			cmstats(cnt - 10) = sdata(cnt + 600, rc)
		}
	loop
	oomSEST_minimumAttributeRoll = 0
	listmax = 0
	list(0, 0) = 0
	listn(0, 0) = lang("リロール", "Reroll")
	listmax++
	list(0, 1) = 0
	listn(0, 1) = lang("決定", "Proceed")
	listmax++
	repeat 8, 10
		list(0, listmax) = cmstats(cnt - 10)
		listn(0, listmax) = skillname(cnt)
		listmax++
	loop
	windowshadow = 1
*label_0756
	redraw 0
	s = lang("能力のロール", "Attb Reroll"), strhint3b + key_mode2 + lang(" [最低値ロール]", " [Min roll]")
	display_window (windoww - 360) / 2 + inf_screenx, winposy(352, 1) - 20, 360, 352
	x = 150
	y = 240
	gmode 4, 180, 300, 30
	pos wx + 85, wy + wh / 2
	grotate 2, 0, 0, 0, x, y
	gmode 2
	display_topic lang("能力", "Attributes"), wx + 28, wy + 30
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	pos wx + 175, wy + 52
	mes lang("ロックされた能力は\n変化しません", "Locked items will\nnot change.")
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos wx + 180, wy + 84
	mes lang("残りロック: ", "Locks left: ") + cmlock(8)
	repeat 10
		key_list(cnt) = key_select(cnt)
		keyrange = cnt + 1
		pos wx + 38, wy + 66 + cnt * 23 - 2
		gcopy 3, cnt * 24 + 72, 30, 24, 18
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 23 - 1, 19
		font lang(cfg_font1, cfg_font2), 15 - en * 2, 1
		color 0, 0, 0
		if (cnt >= 2) {
			pos wx + 198, wy + 76 + cnt * 23
			gmode 2, inf_tiles, inf_tiles
			grotate 1, (cnt - 2) * inf_tiles, 672, 0, inf_tiles, inf_tiles
			pos wx + 210, wy + 66 + cnt * 23
			mes "" + list(0, cnt) / 1000000
			if (cmlock(cnt - 2) == 1) {
				font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
				pos wx + 240, wy + 66 + cnt * 23 + 2
				color 20, 20, 140
				mes "Locked!"
			}
		}
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if (key == key_select(cnt)) {
			p = cnt
			break
		} else {
			p = -1
		}
	loop
	if (p != (-1)) {
		if (p == 0) {
			snd 103
			goto *label_0755
		}
		if (p == 1) {
			goto *label_0757
		}
		if (cmlock(p - 2) != 0) {
			cmlock(8)++
			cmlock(p - 2) = 0
		} else {
			if (cmlock(8) > 0) {
				cmlock(p - 2) = 1
				cmlock(8)--
			}
		}
		snd 20
	}
	if (key == key_mode2) {
		snd 103
		oomSEST_minimumAttributeRoll = 1
		goto *label_0755
	}
	if (key == key_cancel) {
		goto *label_0751
	}
	getkey p, 112
	if (p) {
		gosub *label_1577
		goto *label_0755
	}
	goto *label_0756
*label_0757
*label_0758
	gAcquirableFeatCount = 3
	dim trait, 500
	dim spact, 500
	faction(0) = ""
	gosub *label_0098
	gosub *label_0099
	redraw 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("フィートとは、君の持っている有益な特徴だ。3つまで選べるよ。", "Choose your feats wisely.")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	charamake@se = 1
	gosub *label_1167
	charamake@se = 0
	if (stat == (-1)) {
		goto *label_0758
	}
	if (stat == 0) {
		goto *label_0755
	}
	faction(56) = faction(0)
*label_NCJobTrait
	nc_resettrait 56
	nc_intb_001 = 56
	nc_intb_002 = 2
　redraw 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("君の個性となる追加の能力を得ることが出来る。君の好きなものを選ぶといいよ。", "You'll gain abilities here that will make you unique.")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	charamake@se = 1
	gosub *label_N040
	charamake@se = 0
	if (stat == (-1)) {
		goto *label_NCJobTrait
	}
	if (stat == 0) {
		goto *label_0757
	}
*label_SESTCharamakeSelectGod_before
	selectgodid@st = "eyth"
	// 無神論者取得時は信仰選択画面をスキップする
	if (gettrait(0, 175)) {
		goto *label_0761
	}
*label_SESTCharamakeSelectGod
	cs = 0
	page = 0
	pagesize = 16
	listmax = 0
	repeat 8
		if (cnt == 0 & cmrace == "sister") {
			listn(0, listmax) = godname("elder brother")
			listn(1, listmax) = "elder brother"
		} else {
			listn(0, listmax) = godname(godno2godid(cnt))
			listn(1, listmax) = godno2godid(cnt)
		}
		listmax++
	loop
	repeat usergodmax
		listn(0, listmax) = cgodName(cnt)
		listn(1, listmax) = cgodShortId(cnt)
		listmax++
	loop
	pagemax = (listmax - 1) / pagesize
*label_SESTCharamakeSelectGodloop
	cs_bk = -1
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	redraw 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("信仰は自由さ。君は誰を信じるんだい？", "Faith is freedom. Who do you believe?"), lang("左右キー [ページ切替]  Shift,Esc [戻る]", "Right,left [Change]  Shift,Esc [Back]")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	redraw 0
	s = lang("どの神を信仰する？", "Which god do you believe?")
	display_window (windoww - 400) / 2 + inf_screenx, winposy(458, 1) + 20, 400, 458
	x = ww / 3 * 2
	y = wh - 80
	gmode 4, 180, 300, 40
	pos wx + ww / 2, wy + wh / 2
	grotate 2, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("信仰の候補", "God List"), wx + 28, wy + 30
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	repeat pagesize
		p = page * pagesize + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange = cnt + 1
		display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
		cs_list listn(0, p), wx + 64, wy + 66 + cnt * 19 - 1, 19
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = pagesize * page + cnt
			cs = cnt
			break
		}
	loop
	if (p != (-1)) {
		// 頻繁にdel_charaが呼ばれcdataが初期化されるため
		// ここで選択した神を覚えておいて最終確認画面で適用する
		selectgodid@st = listn(1, p)
		goto *label_0761
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_SESTCharamakeSelectGodloop
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_SESTCharamakeSelectGodloop
		}
	}
	if (key == key_cancel) {
		goto *label_NCJobTrait
	}
	goto *label_SESTCharamakeSelectGodloop

*label_0759
	sdim lockedaka, 30, 17
	redraw 0
	pagemax = 0
	page = 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("やあ、待っていたよ。早速旅の支度をしようか。", "Welcome traveler, I've been looking for you.")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	windowshadow = 1
	cs = 0
	cs_bk = -1
	list(0, 0) = -1
	nameFilter = ""
*label_0760
	redraw 0
	if (cs != cs_bk | p == (-2)) {
		s = lang("異名の選択", "Alias Selection"), strhint3b + " " + key_mode2 + " " + lang("[異名のロック]", "[Lock Alias]") + "  " + oomsest_strhint1
		display_window (windoww - 400) / 2 + inf_screenx, winposy(458, 1) + 20, 400, 458
		cmbg++
		x = ww / 3 * 2
		y = wh - 80
		gmode 4, 180, 300, 40
		pos wx + ww / 2, wy + wh / 2
		grotate 2, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		display_topic lang("異名の候補", "Alias List"), wx + 28, wy + 30
		if (nameFilter != "") {
			pos wx + 210, wy + 38
			mes lang("フィルタ","Filter") + ": " + nameFilter
		}
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 17
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			if (list(0, 0) == (-1)) {
				if (gWizard == 1) {
					listn(0, cnt) = "*Debug*"
				} else {
					if (lockedaka(cnt) != "") {
						listn(0, cnt) = lockedaka(cnt)
					} else {
						cnt2 = cnt
						listn(0, cnt2) = ""
						repeat 1000
							nickname = random_title()
							if (nameFilter != "") {
								nicknameLower = getpath(nickname, 16)
								if (instr(nicknameLower, , getpath(nameFilter, 16)) < 0) {
									continue
								}
							}
							listn(0, cnt2) = nickname
							break
						loop
						if (listn(0, cnt2) == "") {
							listn(0, cnt2) = random_title()
						}
					}
				}
			}
			if (cnt == 0) {
				listn(0, cnt) = lang("リロール", "Reroll")
			}
			pos wx + 38, wy + 66 + cnt * 19 - 2
			gcopy 3, cnt * 24 + 72, 30, 24, 18
			cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
			if (lockedaka(cnt) != "") {
				pos wx + 20, wy + 68 + cnt * 19
				mes "*"
			}
		loop
		cs_bk = cs
		list(0, 0) = 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if (key == key_select(cnt)) {
			p = cnt
			break
		} else {
			p = -1
		}
	loop
	if (p != (-1)) {
		if (key == key_select(0)) {
			list(0, 0) = -1
			snd 103
			cs_bk = -1
		} else {
			cmaka = listn(0, p)
			repeat 17
				lockedaka(cnt) = ""
			loop
			snd 20
			nameFilter = ""
			goto *label_0744
		}
	}
	if (key == key_cancel) {
		nameFilter = ""
		goto *label_1341
	}
	getkey p, 112
	if (p) {
		gosub *label_1577
		goto *label_0759
	}
	if (key == key_mode2) {
		if (cs != 0) {
			if (lockedaka(cs) == "") {
				lockedaka(cs) = listn(0, cs)
				p = -2
			} else {
				lockedaka(cs) = ""
				p = -2
			}
			snd 20
		}
	}
	if (key = key_msglog) {
		val = windoww / 2 - 140 + inf_screenx, winposy(60), 14, 0, 0
		inputlog = ""
		gosub *label_1349 // input
		nameFilter = inputlog
		list(0, 0) = -1 // reset list
		snd 103
		cs = 0  // select 0
		cs_bk = -1
	}
	goto *label_0760
*label_0761
	pcc(15, 0) = 0
*label_0762
	redraw 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("君の見た目を知っておきたいな。まあ、後からいつでも変えられるけどね。", "What you look like? Don't worry, you can change them later.")
	gosub *label_0629
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if (geneuse != "") {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	cbitmod 967, 0, 1
	gosub *label_1258
	if (stat == 0) {
		gosub *label_0767
		if (gettrait(0, 175)) {
			goto *label_0758
		} else {
			goto *label_SESTCharamakeSelectGod
		}
	}
	if (stat == (-1)) {
		gosub *label_1577
		gosub *label_0767
		goto *label_0762
	}
	gosub *label_0767
	cmportrait = cPortrait(rc)
*label_0763
	snd 94
*label_0764
	redraw 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	s = lang("決定ｷｰを押すことで、生い立ちをリロールできる。", "Hit the enter key to reroll your personal history.")
	gosub *label_0629
	del_chara 0

	believegod 0, selectgodid@st // add oomsest
	gosub *label_SESTSetSpactWhenFollowGod

	dbidn = cmrace
	dbmode = 3
	gosub *label_1525
	dbidn = cmclass
	dbmode = 3
	gosub *label_1526
	cdatan(0, rc) = "????"
	cdatan(1, rc) = cmaka
	cLevel(rc) = 1
	repeat 8, 10
		sdata(cnt + 600, rc) = cmstats(cnt - 10)
	loop
	resetfaction 0
	gosub *label_0735
	gosub *label_0736
	// 通常フィートのチェック
	repeat 224
		s = getfactionvalue(56, "trait" + cnt)
		if (s == "") {
			continue
		}
		settrait 0, cnt, int(s)
	loop
	// 職業フィートのチェック
	repeat 200
		if (nc_gettrait(56, cnt)) {
			addfaction 0, "nc_trait," + cnt
			// 各種歌系
			// 演奏スキルがない場合、1レベルで習得
			if (cnt == 0) {
				if (sdata(183, 0) == 0) {
					skillgain 0, 183, 1
				}
			}
			if (cnt == 1) {
				if (sdata(183, 0) == 0) {
					skillgain 0, 183, 1
				}
			}
			if (cnt == 2) {
				if (sdata(183, 0) == 0) {
					skillgain 0, 183, 1
				}
			}
			// 銭投げ
			// 投資スキルがない場合、1レベルで取得
			if (cnt == 20) {
				if (sdata(160, 0) == 0) {
					skillgain 0, 160, 1
				}
			}
		}
	loop
	cPortrait(rc) = cmportrait
	create_pcpic 0, 1
	mode = 1
	csctrl = 1
	menucycle = 0
	gosub *label_1251
	if (stat == 0) {
		nowindowanime = 1
		gosub *label_0767
		goto *label_0764
	}
	redraw 0
	gsel 2
	pos 0, 0
	gmode 0
	gcopy 0, 0, 100, windoww, windowh - 100
	gsel 0
	gosub *label_0767
	s = lang("満足できたかな？", "Are you satisfied now?")
	gosub *label_0629
	promptl(0, promptmax) = lang("はい", "Yes"), "a", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("いいえ", "No"), "b", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("最初から", "Restart"), "c", "" + promptmax
	promptmax++
	val = promptx, 240, 160, 1
	gosub *label_1353
	snd 20
	if (rtval == 1 | rtval == (-1)) {
		goto *label_0763
	}
	if (rtval == 2) {
		nowindowanime = 0
		goto *label_0741
	}
nc_setjobskill
*label_0765
	redraw 0
	gmode 0
	pos 0, 100
	gcopy 2, 0, 0, windoww, windowh - 100
	gmode 2
	s = lang("最後の質問だ。君の名前は？", "Last question. What's your name?")
	gosub *label_0629
*label_0766
	val = (windoww - 230) / 2 + inf_screenx, winposy(120), 10, 0, 0
	inputlog = ""
	input_mode = 1
	gosub *label_1349
	cmname = "" + inputlog
	if (cmname == "" | cmname == " ") {
		cmname = randomname()
	}
	playerid = "sav_" + cmname
	dirlist buff, exedir + "save\\*", 5
	notesel buff
	f = 0
	repeat noteinfo(0)
		noteget s, cnt
		if (getpath(s, 16) == getpath(playerid, 16)) {
			f = 1
			break
		}
	loop
	if (f == 1) {
		redraw 0
		gmode 0
		pos 0, 100
		gcopy 2, 0, 0, windoww, windowh - 100
		gmode 2
		msgconfirm = 1
		s = lang("あいにく、その名前の冒険者はすでに存在する。", "Sorry, but the name is already taken.")
		gosub *label_0629
		goto *label_0766
	}
	snd 101
	cdatan(0, rc) = cmname
	cGold(0) = 400 + rnd(200)
	if (geneuse != "") {
		gosub *label_1316
	}
	await 250
	mode = 5
	goto *label_1607
*label_0767
	redraw 0
	gsel 4
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, 64
	gmode 2
	return
*label_0768
	if (val == 1) {
		chara_preparepic ref1, cnt
		pos wx + 380, wy - chipc(3, ref1) + 60
		gcopy 5, 0, 960, inf_tiles, chipc(3, ref1)
		chara_preparepic ref2, cnt
		pos wx + 350, wy - chipc(3, ref1) + 60
		gcopy 5, 0, 960, inf_tiles, chipc(3, ref1)
		pos wx + 460, wy + 38
		mes lang("種族: ", "Race: ") + cmrace(1)
	} else {
		if (val != 3) {
			gmode 4, chipc(2, ref1), chipc(3, ref1), 40
			chara_preparepic ref1, cnt
			pos wx + 480, wy + 96
			grotate 5, 0, 960, 0, chipc(2, ref1) * 2, chipc(3, ref1) * 2
			chara_preparepic ref2, cnt
			pos wx + 350, wy + 96
			grotate 5, 0, 960, 0, chipc(2, ref1) * 2, chipc(3, ref1) * 2
			gmode 2
		}
	}
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	tx = wx + 230
	ty = wy + 62
	talk_conv buff, 60 + en * 2
	color 0, 0, 0
	pos tx - 20, ty
	mes buff
	if (val == 3) {
		p = -1
		repeat length(classnamecsv)
			if (dbidn == classnamecsv(cnt, 1)) {
				p = cnt
				break
			}
		loop
		if (p != (-1)) {
			color 0, 0, 0
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			tx = wx + 200
			ty = wy + 166
			display_topic lang("技能", "Skill"), wx + 188, wy + 166
			ty += 34
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			r = 1
			repeat 20
				r++
				if (r >= classspact(p, 1) + 2) {
					break
				}
				if (classspact(p, r) >= 400 & classspact(p, r) < tailspact) {
					pos cnt \ 4 * 110 + tx - 2, cnt / 4 * 32 + ty - 18
					gmode 2, inf_tiles, inf_tiles
					gcopy 1, (sdataref(0, classspact(p, r)) - 10) * inf_tiles, 672, inf_tiles, inf_tiles
					pos cnt \ 4 * 110 + tx + 32, cnt / 4 * 32 + ty
					mes skillname(classspact(p, r))
				} else {
					continue cnt
				}
			loop
		}
		return
	}
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	tx = wx + 200
	ty = wy + 166
	display_topic lang("能力ボーナス", "Attribute Bonus"), tx, ty
	ty += 34
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	if (jp) {
		s = "皆無", "最高", "理想的", "高い", "やや高い", "普通", "少し", "微々"
	}
	if (en) {
		s = "None", "Best", "Great", "Good", "Not bad", "Normal", "Little", "Slight"
	}
	repeat 3
		cnt2 = cnt
		repeat 3
			if (cnt2 == 2) {
				if (cnt == 2) {
					r = 18
					repeat 1
						if (sorg(r, 0) > 120) {
							color 0, 0, 200
							break
						}
						if (sorg(r, 0) > 100) {
							color 0, 0, 200
							break
						}
						if (sorg(r, 0) > 80) {
							color 0, 0, 150
							break
						}
						if (sorg(r, 0) > 60) {
							color 0, 0, 150
							break
						}
						if (sorg(r, 0) > 40) {
							color 0, 0, 0
							break
						}
						if (sorg(r, 0) > 20) {
							color 150, 0, 0
							break
						}
						if (sorg(r, 0) > 0) {
							color 200, 0, 0
							break
						}
						color 120, 120, 120
					loop
					p(1) = cnt2 * 3 + cnt + (cnt2 == 2 & cnt == 2) * 3
					pos cnt2 * 150 + tx + 13, ty + 7
					gmode 2, inf_tiles, inf_tiles
					grotate 1, p(1) * inf_tiles, 672, 0, inf_tiles, inf_tiles
					pos cnt * 150 + tx + 32, ty
					if (val != 1) {
						mes strmid(skillname(r), 0, 4 - (jp == 0)) + ": " + sorg(r, 0)
					} else {
						mes strmid(skillname(r), 0, 4 - (jp == 0)) + ": " + cnvfix(sorg(r, 0))
					}
					break
				}
			}
			r = cnt2 * 3 + cnt + 10
			p = 0
			repeat 1
				if (sorg(r, 0) > 13) {
					p = 1
					color 0, 0, 200
					break
				}
				if (sorg(r, 0) > 11) {
					p = 2
					color 0, 0, 200
					break
				}
				if (sorg(r, 0) > 9) {
					p = 3
					color 0, 0, 150
					break
				}
				if (sorg(r, 0) > 7) {
					p = 4
					color 0, 0, 150
					break
				}
				if (sorg(r, 0) > 5) {
					p = 5
					color 0, 0, 0
					break
				}
				if (sorg(r, 0) > 3) {
					p = 6
					color 150, 0, 0
					break
				}
				if (sorg(r, 0) > 0) {
					p = 7
					color 200, 0, 0
					break
				}
				color 120, 120, 120
			loop
			pos cnt * 150 + tx + 13, ty + 7
			gmode 2, inf_tiles, inf_tiles
			grotate 1, (cnt2 * 3 + cnt) * inf_tiles, 672, 0, inf_tiles, inf_tiles
			pos cnt * 150 + tx + 32, ty
			mes strmid(skillname(r), 0, 4 - (jp == 0)) + ": " + s(p)
		loop
		ty += 16
	loop

	ty = wy + 260

	if (val == 0) {
		display_topic lang("獲得部位", "Bodyparts"), tx, ty
		ty += 34
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		pos tx + 32, ty
		mes bodyParts2string()
		ty = wy + 322
	}

	display_topic lang("獲得技能", "Trained Skill"), tx, ty
	ty += 34
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	r = 0
	s = lang("武器の専門  ", "Proficient in ")
	repeat 150 - 100, 100
		if (sorg(cnt, 0) != 0) {
			if (r != 0) {
				s += ","
			}
			s += skillname(cnt)
			r++
		}
	loop
	if (r != 0) {
		pos tx + 13, ty + 6
		gmode 2, inf_tiles, inf_tiles
		grotate 1, 0, 672, 0, inf_tiles, inf_tiles
		pos tx + 32, ty
		mes s
		ty += 14
	}
	repeat 600 - 150, 150
		if (sorg(cnt, 0) != 0) {
			s = skillname(cnt)
			if (jp) {
				lenfix s, 12
			} else {
				lenfix s, 16
			}
			pos tx + 13, ty + 6
			gmode 2, inf_tiles, inf_tiles
			grotate 1, (sdataref(0, cnt) - 10) * inf_tiles, 672, 0, inf_tiles, inf_tiles
			s(1) = skilldesc(cnt)
			if (en) {
				if (strlen(s(1)) > 45) {
					s(1) = strmid(s(1), 0, 42) + "..."
				}
			}
			pos tx + 32, ty
			mes s + s(1)
			ty += 14
		}
	loop
	return



#module
// "HEAD NECK BACK BODY HANDx2 RINGx2 ARM WAIST LEG"
#defcfunc bodyParts2string
	if (jp@) {
		names = "", "頭", "首", "背", "胴", "手", "指", "腕", "腰", "足"
	} else {
		names = "", "HEAD", "NECK", "BACK", "BODY", "HAND", "RING", "ARM", "WAIST", "LEG"
	}

	dim bodyparts, 10
	repeat 30, 100
		bodypart = cdata@(cnt, 0) / 10000
		if (bodypart == 0 | bodypart == 10 | bodypart == 11) {
			break
		}
		bodyparts(bodypart) += 1
	loop

	s = ""
	repeat length(bodyparts)
		n = bodyparts(cnt)
		if (n == 0) {
			continue
		}
		s += names(cnt)
		if (n != 1) {
			s += "x" + n
		}
		s += " "
	loop
	return s
#global

// NC追加
// 文字列の置き換え
#module mod_str_replace
#deffunc str_replace var src, str search, str replace
repeat strlen(src)
	await
	idx = instr(src, 0, search)
	if(idx == -1){ break }
	src = strmid(src, 0, idx) + replace + strmid(src, idx + strlen(search), strlen(src) - idx)
loop
return
#global

; Shift-JIS <-> UTF-8 Convert module
;  Supported OS : Windows 98 or later

#module "sjis2utf8"

#uselib "kernel32"
#func _mb2wc "MultiByteToWideChar" int, int, sptr, int, sptr, int
#func _wc2mb "WideCharToMultiByte" int, int, sptr, int, sptr, int, int, int

#define CP_ACP    0
#define CP_UTF8    65001 ; win 98 or later

#deffunc sjis2utf8n var dest, str src
    ; SJIS -> Unicode
    len_uni = strlen(src) * 2
    sdim str_uni, len_uni + 1
    cnvstow str_uni, src
    ; Unicode -> UTF-8
    _wc2mb CP_UTF8, 0, varptr(str_uni), -1, 0, 0, 0, 0
    len_utf8 = stat
    memexpand dest, len_utf8 + 1
    _wc2mb CP_UTF8, 0, varptr(str_uni), -1, varptr(dest), len_utf8, 0, 0
    ; UTF-8 length
    return len_utf8

#defcfunc utf8n2sjis var dest
    ; UTF-8	 -> Unicode
    _mb2wc CP_UTF8, 0, varptr(dest), -1, 0, 0
    len_uni = stat
    sdim str_uni, len_uni + 1
    _mb2wc CP_UTF8, 0, varptr(dest), -1, varptr(str_uni), len_uni
    ; Unicode -> SJIS
    return cnvwtos(str_uni)

#global

#deffunc convertartifact int __ttt, int __uuu
	if (refitem(iId(__ttt), 5, __ttt) >= 50000) {
		return __ttt
	}
	if (iQuality(__ttt) != 6) {
		return __ttt
	}
	if (iBodyPart(__ttt) != 0) {
		return __ttt
	}
	f@m163 = 0
	repeat 5480
		if (__uuu) {
			if (cnt >= 5080) {
				break
			}
		}
		if (cnt >= 20 * 16 + 200 & cnt < 5080 - 20) {
			continue
		}
		tc@m163 = inv_getowner(cnt)
		if (tc@m163 != (-1)) {
			if (cState(tc@m163) == 0 | cRole(tc@m163) == 13) {
				continue
			}
		}
		if (iNumber(cnt) > 0) {
			if (iId(cnt) == iId(__ttt)) {
				if (cnt != __ttt) {
					if (iId(__ttt) != 743 | inv(31, cnt) == inv(31, __ttt)) {
						f@m163 = 1
						break
					}
				}
			}
		}
	loop
	if (f@m163 == 0) {
		return __ttt
	}
	n@m163 = "" + itemname(__ttt)
	repeat
		flt refitem(iId(__ttt), 7, __ttt), 4
		flttypeminor = refitem(iId(__ttt), 9, __ttt)
		iNumber(__ttt) = 0
		itemcreate inv_getowner(__ttt), 0, iX(__ttt), iY(__ttt), 0
		if (iQuality(ci) != 6) {
			break
		}
		iNumber(ci) = 0
	loop
	txt -1, lang(n@m163 + "は" + itemname(ci) + "に形を変えた。", n@m163 + " turns its shape into " + itemname(ci) + ".")
	return __ttt
*label_0770
*label_0771
	fsetincome = 52000, 52000, 52000, 53000, 53000, 56000, 54000, 77000, 57000, 57000
	fsetchest = 10000, 24000, 12000, 16000, 20000, 19000, 18000, 22000, 14000, 32000, 34000, 54000, 59000
	fsetwear = 10000, 10000, 24000, 24000, 25000, 12000, 16000, 20000, 19000, 18000, 22000, 14000, 32000, 34000
	fsetitem = 52000, 52000, 53000, 53000, 56000, 68000, 54000, 64000, 59000, 55000
	fsetrewardsupply = 52000, 53000, 56000, 54000, 57000
	fsetrare = 60000, 72000, 77000, 55000, 57000
	fsetperform = 77000, 57000, 57000, 57000, 60000, 18000, 20000, 32000, 34000, 52000, 64000, 64000
	fsetperform2 = 10000, 12000, 14000, 16000, 18000, 19000, 20000, 22000, 24000, 25000, 32000, 34000, 69000
	fsetdeliver = 60000, 77000, 54000, 64000
	fsetsupply = 60000, 77000, 56000, 54000, 64000
	fsetmagic = 53000, 56000, 54000
	fsetarmor = 12000, 16000, 20000, 19000, 18000, 22000, 14000
	fsetweapon = 10000, 24000, 25000
	fsetplantartifact = 32000, 34000
	fsetplantunknown = 57000, 57000, 54000, 64000, 77000
	fsetremain = 25000, 57000, 57000, 77000, 53000, 52000, 57000
	fsetbarrel = 25000, 57000, 53000, 52000, 77000, 64000
	fsetcollect = 64000, 60000, 57000, 77000
	isetforgetnefia = 287, 559, 711, 243, 430, 431, 632, 709, 732, 480
	isetabyss = 10000, 12000, 14000, 16000, 18000, 19000, 20000, 22000, 24000, 32000, 34000
	isetdeed = 344, 521, 522, 542, 543, 555, 572
	isetfruit = 180, 181, 196, 197, 192, 183
	isetthrowpotionminor = 27, 28, 376, 30, 262, 253, 379, 392
	isetthrowpotionmajor = 28, 376, 205, 368, 433, 382, 577, 577
	isetthrowpotiongreater = 28, 205, 368, 432, 429, 29, 577
	isethire = 205, 70, 74, 41, 69, 76, 1, 1, 1
	isetgiftminor = 753, 754, 754, 756, 756, 540, 541, 537, 538, 526, 415, 511, 343, 340, 338, 328, 220, 575, 622, 167
	isetgiftmajor = 755, 755, 633, 626, 502, 632, 667, 555, 748, 640
	isetgiftgrand = 757, 558, 664, 758, 759, 761
	isethirerole = 18, 9, 12, 5, 8, 14, 1008, 1008, 1008
	isetcrop = 180, 181, 197, 192, 183, 188, 200
	isetgod = 0, 1, 2, 3, 4, 5, 6, 7
	isetrarewear = 759, 788, 512, 556, 552, 557, 558, 664

	iSetWanderingVendorsRareItems = iId_scrollOfGainAttribute, iId_rodOfWishing, iId_artifactSeed, iId_scrollOfGrowth, iId_scrollOfFaith, iId_rodOfDomination, iId_scrollOfHealingRain, iId_treasureMap, iId_bookOfResurrection, iId_scrollOfContingency, iId_scrollOfName

	dim asettown, 5, 2
	asettown(0, 0) = 5, 11, 14, 15, 12
	asettown(0, 1) = areaId_serria, areaId_trian, areaId_carlia, areaId_tormat, areaId_khios
	moneybox = 500, 2000, 10000, 50000, 500000, 5000000, 100000000, 2147483647
	giftvalue = 10, 20, 30, 50, 75, 100
	giftn = lang("つまらない", "cheap"), lang("普通の", "so so"), lang("ちょっとドキドキする", "exciting"), lang("高価な", "expensive"), lang("気絶しそうなほど素晴らしい", "hot and gorgeous"), lang("王様が羨むほどの", "crazy epic"), "bug"
	moneyboxn = lang("5百金貨", "500 GP"), lang("2千金貨", "2k GP"), lang("1万金貨", "10K GP"), lang("5万金貨", "50K GP"), lang("50万金貨", "500K GP"), lang("500万金貨", "5M GP"), lang("1億金貨", "500M GP"), lang("1I金貨", "1I GP")
	biten = lang("ミジンコ", "water flea"), lang("バッタ", "grasshopper"), lang("テントウ", "ladybug"), lang("トンボ", "dragonfly"), lang("セミ", "locust"), lang("ヘラクレス", "beetle")
	nc_horskilln = lang("加速", "acceleration"), lang("スタミナ節約", "stamina saving"), lang("立ち回り強化", "conducting"), lang("前半スタミナ節約", "first half stamina saving"), lang("後半スタミナ節約", "save stamina in second half"), lang("後半疾走", "half a mile"), lang("休息", "rest"), lang("敵惑わし(スタミナ)", "enemy distraction(stamina)"), lang("敵惑わし(速度)", "enemy distraction(speed)"), lang("妨害耐性", "jamming resist"), lang("晴れの日得意", "fine day"), lang("雨の日得意", "rain day"), "", "", "", "", "", "", "", "", "", lang("竜頭蛇尾", "headlong"), lang("スライド", "slide"), lang("逃げ切りの構え", "ready to flee"), lang("追い抜きの構え", "passing stance"), lang("鉄壁", "iron wall"), lang("エーテルフロー", "Ether Flow")
	notesel buff
	noteload exedir + "data\\book.txt"
	p = instr(buff, 0, "%DEFINE")
	buff = strmid(buff, p, instr(buff, p, "%END"))
	notedel 0
	sdim booktitle, noteinfo(0), 25
	p = 0
	repeat noteinfo(0)
		noteget msgtemp, cnt
		csvsort s, msgtemp, 44
		booktitle(int(s)) = lang(s(1), s(2))
		if (int(s(3)) == 1) {
			isetbook(p) = int(s)
			p++
		}
	loop
	magebookn = lang("ヴォイニッチ写本", "Voynich Manuscript"), lang("ドール賛歌", "Dhol Chants"), lang("ポナペ教教典", "Ponape Scripture"), lang("グラーキ黙示録", "Revelations of Glaaki"), lang("グ＝ハーン断章", "G'harne Fragments"), lang("断罪の書", "Liber Damnatus"), lang("ドジアンの書", "Book of Dzyan"), lang("エイボンの書", "Book of Eibon"), lang("大いなる教書", "Grand Grimoire"), lang("セラエノ断章", "Celaeno Fragments"), lang("ネクロノミコン", "Necronomicon"), lang("ルルイエ異本", "The R'lyeh Text"), lang("エルトダウン・シャールズ", "Eltdown Shards"), lang("金枝篇", "The Golden Bough"), lang("終焉の書", "Apocalypse")
	isetgsrare = 557, 685, 733
	isetmvrare = 632, 502, 287, 711
	isetblacksmithrare = 556, 759, 781, 788
	isethighspell = 59, 54, 60, 35, 41, 64, 65, 3
	return
*label_0772
	if (rc == 0) {
		if (gExecutingImmediateQuestType != 0) {
			return
		}
		if (trophycheck(21) != 2) {
			inv_getheader rc
			repeat invrange, invhead
				ci = cnt
				if (iNumber(cnt) == 0) {
					continue
				}
				if (mapIsFixed == 0) {
					if (iBodyPart(cnt) != 0) {
						continue
					}
					if (ibit(5, ci)) {
						continue
					}
					if (rnd(3)) {
						continue
					}
				} else {
					if (rnd(5)) {
						continue
					}
				}
				if (refitem(iId(ci), 10, ci) == 1) {
					if (mapType != 1 & mapType != 5 & mapType != 3 & mapType != 4 & mapType != 6 & mapType != 2) {
						continue
					} else {
						if (rnd(2)) {
							continue
						}
					}
				}
				f = 0
				if (iBodyPart(ci) != 0) {
					if (rnd(10)) {
						f = 1
					}
					if (iCurseState(ci) >= 1) {
						if (rnd(2)) {
							f = 1
						}
					}
					if (iCurseState(ci) <= (-1)) {
						if (rnd(2)) {
							f = 0
						}
					}
					if (iCurseState(ci) <= (-2)) {
						if (rnd(2)) {
							f = 0
						}
					}
				} else {
					if (iIdentificationState(ci) >= 3) {
						if (rnd(4)) {
							f = 1
						}
					}
				}
				if (f == 0) {
					if (nc_intb_nightmare == 0) {
						if (iCurseState(ci) >= 1) {
							txtef 2
							txt -1, lang(itemname(ci, 1) + "にかけられた祝福が消失を防いだ。", "The blessing on" + itemname(ci, 1) + "prevented the disappearance.")
							iCurseState(ci) = 0
							f = 1
						}
					}
				}
				if (f) {
					continue
				}
				if (iBodyPart(ci) != 0) {
					cdata(iBodyPart(ci), rc) = cdata(iBodyPart(ci), rc) / 10000 * 10000
					iBodyPart(ci) = 0
				}
				f = 0
				if (ibit(5, ci) == 0) {
					if (rnd(4) == 0) {
						f = 1
					}
					if (iCurseState(ci) >= 1) {
						if (rnd(3) == 0) {
							f = 0
						}
					}
					if (iCurseState(ci) <= (-1)) {
						if (rnd(3) == 0) {
							f = 1
						}
					}
					if (iCurseState(ci) <= (-2)) {
						if (rnd(3) == 0) {
							f = 1
						}
					}
				}
				if (f) {
					iNumber(ci) = 0
					continue
				}
				iX(ci) = cX(rc)
				iY(ci) = cY(rc)
				item_stack -1, ci
				if (stat == 0) {
					ti = inv_getfreeid(-1)
					if (ti == (-1)) {
						break
					}
					item_copy ci, ti
					iOwnState(ti) = -2
				}
				iNumber(ci) = 0
			loop
		}
		if (rnd(2) == 0) {
			itemcreate -1, 204, cX(rc), cY(rc), 0
			if (stat != 0) {
				ibitmod 5, ci, 1
			}
		}
		cell_refresh cX(rc), cY(rc)
		create_pcpic 0, 1
		return
	} else {
		if (rc < 16) {
			if (cbit(967, rc) == 1) {
				create_pcpic rc, 1
			}
		}
		if (cRelationship(rc) == 10) {
			return
		}
	}
	if (gCurrentMap == 33) {
		if (cId(rc) == 185) {
			return
		}
		if (cId(rc) == 204) {
			return
		}
	}
	if (cbit(969, rc)) {
		return
	}
	if (cbit(23, rc) | cbit(27, rc)) {
		if (rnd(6)) {
			return
		}
	}
	if (cRole(rc) == 10001 | cRole(rc) == 10018 | eqfaction(rc, "petshop")) {
		return
	}
	inv_getheader rc
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		ci = cnt
		f = 0
		if (cRole(rc) == 20) {
			break
		}
		if (iQuality(ci) > 4 | iId(ci) == 55) {
			f = 1
		}
		if (rnd(30) == 0) {
			f = 1
		}
		if (cQuality(rc) >= 4) {
			if (rnd(2) == 0) {
				f = 1
			}
		}
		if (cRole(rc) == 13) {
			if (rnd(5)) {
				f = 0
			}
		}
		if (gCurrentMap == 6) {
			if (rnd(4)) {
				f = 0
			}
		}
		if (iQuality(ci) == 6) {
			f = 1
		}
		if (ibit(12, ci)) {
			f = 1
			iCount(ci) = 0
			ibitmod 12, ci, 0
		}
		if (f == 0) {
			continue
		}
		if (catitem != 0) {
			if (ibit(8, ci) == 0) {
				if (refitem(iId(ci), 5, ci) < 50000) {
					if (iQuality(ci) >= 3) {
						if (rnd(3)) {
							txtef 9
							txt -1, lang(name(catitem) + "は" + itemname(ci) + "をぺろぺろと舐めた。", name(catitem) + " licks " + itemname(ci) + ".")
							ibitmod 8, ci, 1
							reftype = refitem(iId(ci), 5, ci)
							encadd ci, randomenc(randomenclv(rnd(4))), randomencp()
							animeload 8, rc
						}
					}
				}
			}
		}
		if (iBodyPart(ci) != 0) {
			cdata(iBodyPart(ci), rc) = cdata(iBodyPart(ci), rc) / 10000 * 10000
			iBodyPart(ci) = 0
		}
		iX(ci) = cX(rc)
		iY(ci) = cY(rc)
		itemturn ci
		item_stack -1, ci
		if (stat == 0) {
			ti = inv_getfreeid(-1)
			if (ti == (-1)) {
				break
			}
			item_copy ci, ti
		}
		iNumber(ci) = 0
	loop
	if (cQuality(rc) >= 4 | rnd(20) == 0 | cbit(17, rc) == 1 | petcheck(rc)) {
		if (cGold(rc) > 0) {
			flt
			itemcreate -1, 54, cX(rc), cY(rc), cGold(rc) / (1 + 3 * (cbit(17, rc) == 0))
			cGold(rc) -= cGold(rc) / (1 + 3 * (cbit(17, rc) == 0))
		}
	}
	if (areaId(gCurrentMap) == 39 & cRole(rc) != 0) {
		cell_refresh cX(rc), cY(rc)
		return
	}
	_switch_val = refclass(rc, 4)
	if (cbit(23, rc) | cbit(27, rc)) {
		goto *label_0773
	}
	if (_switch_val == 1 | _switch_sw) {
		_switch_sw = 0
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 52000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0773
		_switch_sw++
	}
	if (_switch_val == 7 | _switch_sw) {
		_switch_sw = 0
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 52000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0773
		_switch_sw++
	}
	if (_switch_val == 3 | _switch_sw) {
		_switch_sw = 0
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 52000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0773
		_switch_sw++
	}
	if (_switch_val == 2 | _switch_sw) {
		_switch_sw = 0
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 53000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(40) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 54000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0773
		_switch_sw++
	}
	if (_switch_val == 4 | _switch_sw) {
		_switch_sw = 0
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 52000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0773
		_switch_sw++
	}
	if (_switch_val == 5 | _switch_sw) {
		_switch_sw = 0
		if (rnd(50) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 54000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0773
	}
*label_0773
	_switch_val = refchara(cId(rc), 3)
	if (_switch_val == 3 | _switch_sw) {
		_switch_sw = 0
		if (rnd(40) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 52000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(40) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 53000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(40) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(40) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = fsetweapon(rnd(length(fsetweapon)))
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 68000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0774
		_switch_sw++
	}
	if (_switch_val == 1 | _switch_sw) {
		_switch_sw = 0
		if (cId(rc) != 0) {
			if (rnd(20) == 0) {
				p = 0
				flt calcobjlv(cLevel(tc)), calcfixlv(2)
				flttypemajor = 62000
				flttypeminor = 0
				itemcreate -1, 0, cX(rc), cY(rc), 0
				remain_make ci, rc
			}
		}
		goto *label_0774
		_switch_sw++
	}
	if (_switch_val == 2 | _switch_sw) {
		_switch_sw = 0
		if (cId(rc) != 0) {
			if (rnd(20) == 0) {
				p = 0
				flt calcobjlv(cLevel(tc)), calcfixlv(2)
				flttypemajor = 62000
				flttypeminor = 0
				itemcreate -1, 0, cX(rc), cY(rc), 0
				remain_make ci, rc
			}
		}
		goto *label_0774
		_switch_sw++
	}
	if (_switch_val == 6 | _switch_sw) {
		_switch_sw = 0
		if (rnd(10) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 32000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(10) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 34000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 54000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(10) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 52000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(10) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 53000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 72000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(10) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 68000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(10) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 77000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0774
		_switch_sw++
	}
	if (_switch_val == 4 | _switch_sw) {
		_switch_sw = 0
		if (rnd(5) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(5) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = fsetweapon(rnd(length(fsetweapon)))
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(20) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 72000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(4) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 68000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0774
		_switch_sw++
	}
	if (_switch_val == 5 | _switch_sw) {
		_switch_sw = 0
		if (rnd(5) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(5) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = fsetweapon(rnd(length(fsetweapon)))
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(15) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 54000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(5) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 52000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(5) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 53000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(10) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 72000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(4) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 68000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		if (rnd(4) == 0) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(2)
			flttypemajor = 77000
			flttypeminor = 0
			itemcreate -1, 0, cX(rc), cY(rc), 0
		}
		goto *label_0774
	}
*label_0774
	if (ocbit(7, rc)) {
		cell_refresh cX(rc), cY(rc)
		return
	}
	if (gettrait(0, 194) < 0) {
		if (cbit(23, rc) | cbit(27, rc)) {
			nodropbodyparts = 2
		}
	}
	if (cId(rc) != 0) {
		if (rnd(20 - ((ogdata(472) == 2 | oabit(3, gCurrentMap) == 1) * 5) - ((cQuality(rc) >= 4) * 5)) == 0) {
			if (nodropbodyparts == 0 | gCurrentMap != 35) {
				if (nodropbodyparts != 2) {
					p = 0
					flt calcobjlv(cLevel(rc)), calcfixlv(2)
					flttypemajor = 62000
					flttypeminor = 0
					itemcreate -1, 0, cX(rc), cY(rc), 0
					remain_make ci, rc
				}
			}
		}
	}
	if (gCurrentMap == 35) {
		cell_refresh cX(rc), cY(rc)
		return
	}
	if (gCurrentMap != 6 & cRole(rc) != 20) {
		if (rnd(175) == 0 | cQuality(rc) == 6 | (cQuality(rc) == 4 & rnd(2) == 0) | (cQuality(rc) == 5 & rnd(3) == 0)) {
			if (cId(rc) != 0) {
				flt
				itemcreate -1, 504, cX(rc), cY(rc), 0
				collection_make ci, rc
				cell_refresh iX(ci), iY(ci)
			}
		}
		if (rnd(175) == 0 | cQuality(rc) == 6 | (cQuality(rc) == 4 & rnd(2) == 0) | (cQuality(rc) == 5 & rnd(3) == 0)) {
			if (cId(rc) != 0) {
				flt
				itemcreate -1, 503, cX(rc), cY(rc), 0
				collection_make ci, rc
				cell_refresh iX(ci), iY(ci)
			}
		}
	}
	if (cRole(rc) == 1010) {
		flt
		itemcreate -1, 361, cX(rc), cY(rc), 0
		iParam1(ci) = cShopStoreId(rc)
		iOwnState(ci) = 2
	}
	if (gettrait(0, 194) < 0) {
		if (cbit(23, rc) | cbit(27, rc)) {
			nodropbodyparts = 2
		}
	}
	if (rollanatomy == 1 | cQuality(rc) >= 4 | cbit(960, rc) == 1 | 0) {
		if ((cId(rc) == 319 & (cRole(rc) == 13 | ocbit(7, rc))) == 0) {
			if (nodropbodyparts != 2) {
				flt
				itemcreate -1, 204, cX(rc), cY(rc), 0
				if (stat != 0) {
					remain_make ci, rc
					if (cbit(960, rc) == 1) {
						if (sdata(161, 0) != 0) {
							iNumber(ci) += rnd(1 + (sdata(161, 0) > cLevel(rc)))
						}
						if (godcheck() == "dybony") {
							iNumber(ci) += 1
						}
					}
				}
			}
		}
	}
	lootrich = -1
	if (cId(rc) == 183) {
		lootrich = 8
	}
	if (cId(rc) == 184) {
		lootrich = 4
	}
	if (cId(rc) == 185) {
		lootrich = 2
	}
	if (lootrich != (-1)) {
		repeat lootrich
			flt calcobjlv(cLevel(rc))
			flttypeminor = 77001
			itemcreate -1, 0, cX(rc), cY(rc), 0
		loop
		if (rnd(3) == 0) {
			flt
			itemcreate -1, 284, cX(rc), cY(rc), 0
		}
	}
	drop = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
	if (cId(rc) == 140) {
		if (gCurrentMap == 19 | gCurrentMap == 42 | gCurrentMap == 210) {
			drop = 355, -1
		}
	}
	if (cId(rc) == 175 | cId(rc) == 177 | cId(rc) == 178) {
		if (npcmemory(0, cId(rc)) == 1) {
			drop = 290, 421, -1
		} else {
			drop = 421, 421, -1
		}
	}
	if (gCurrentMap == 37) {
		if (cId(rc) == 257) {
			drop = 665, 55, 55, 55, 55, 621, -1
		}
	}
	repeat 10
		if (drop(cnt) == (-1)) {
			break
		}
		flt
		itemcreate -1, drop(cnt), cX(rc), cY(rc), 0
	loop
	if (cId(rc) == 5) {
		if (rnd(200) == 0) {
			flt
			itemcreate -1, 702, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 21) {
		if (cQuality(rc) != 1) {
			if (rnd(100) == 0) {
				flt
				itemcreate -1, 706, cX(rc), cY(rc), 0
			}
		}
	}
	if (cId(rc) == 34) {
		if (rnd(4) == 0) {
			flt
			itemcreate -1, 717, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 99 | cId(rc) == 100 | cId(rc) == 101) {
		if (rnd(300) == 0) {
			flt
			itemcreate -1, 708, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 117) {
		if (rnd(140) == 0) {
			flt
			itemcreate -1, 720, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 168) {
		if (rnd(100) == 0) {
			flt
			itemcreate -1, 740, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) >= 302 & cId(rc) <= 305) {
		if (rnd(90) == 0) {
			flt
			itemcreate -1, 771, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 307 | cId(rc) == 308) {
		if (rnd(150) == 0) {
			flt
			itemcreate -1, 709, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 189 | cId(rc) == 190) {
		if (rnd(150) == 0) {
			flt
			itemcreate -1, 711, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 213) {
		if (rnd(50) == 0) {
			flt
			itemcreate -1, 672, cX(rc), cY(rc), 0
			if (stat != 0) {
				iParam1(ci) = 169
			}
		}
	}
	if (cId(rc) == 250) {
		if (rnd(200) == 0) {
			flt
			itemcreate -1, 715, cX(rc), cY(rc), 0
		}
		if (eqfaction(rc, "lurgy")) {
			flt
			itemcreate -1, 795, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 292) {
		if (rnd(50) == 0) {
			flt
			itemcreate -1, 794, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 341) {
		if (rnd(3) == 0) {
			flt
			itemcreate -1, 635, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 85 | cId(rc) == 86 | cId(rc) == 87) {
		if (rnd(600) == 0) {
			flt
			itemcreate -1, 737, cX(rc), cY(rc), 0
		}
	}
	if (cId(rc) == 302) {
		repeat 2 + rnd(4)
			nostack = 1
			flt cLevel(rc), 2
			flttypemajor = 92000
			itemcreate -1, 0, cX(rc), cY(rc), 0
			if (iValue(ci) < 800) {
				iNumber(ci) = rnd(5) + 1
			}
		loop
	}
	if (cId(rc) == 328) {
		if (gCurrentMap == 210) {
			flt
			itemcreate -1, 55, cX(rc), cY(rc), (gCurrentDungeonLevel - 50 / 10) * 5 + 5
			flt
			itemcreate -1, 622, cX(rc), cY(rc), (gCurrentDungeonLevel - 50 / 10) * 5 + 5
		} else {
			flt
			itemcreate -1, 55, cX(rc), cY(rc), 1 + rnd(3)
			if (rnd(2)) {
				flt
				itemcreate -1, 622, cX(rc), cY(rc), 0
			}
		}
	}
	if (cId(rc) == 329) {
		if (gCurrentMap == 210) {
			flt
			itemcreate -1, 54, cX(rc), cY(rc), 2500 + rndex(cFame(0) + 1000) * ((gCurrentDungeonLevel - 50 / 10) + 5)
		} else {
			flt
			itemcreate -1, 54, cX(rc), cY(rc), 2500 + rndex(cFame(0) + 1000)
		}
	}
	if (cId(rc) == 351 | cId(rc) == 352) {
		repeat 12
			flt
			nostack = 1
			itemcreate -1, 772, cX(rc), cY(rc), 0
			if (rnd(2)) {
				if (stat != 0) {
					iParam3(ci) = -1
					iImage(ci) = 336
				}
			}
		loop
	}
	if (eqfaction(rc, "overwish")) {
		ncgdata(69)++
		flt
		itemcreate -1, 799, cX(rc), cY(rc), 0
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (cnt == rc) {
				continue
			}
			if (eqfaction(cnt, "overwish")) {
				continue
			}
			nc_intb_001 = cnt
			repeat 16
				if (ocdata(192 + cnt * 3, nc_intb_001) == 0) {
						break
				}
				delbuff nc_intb_001, cnt
				continue cnt
			loop
		loop
	}
	if (eqfaction(rc, "ncdungeon")) {
		if (rnd(20) == 0) {
			flt
			itemcreate -1, 801, cX(rc), cY(rc), 0
		}
	}
	if (eqfaction(rc, "st_ruinboss")) {
		flt
		itemcreate -1, 480, cX(rc), cY(rc), 0
		iCount(ci) = 4
		flt
		itemcreate -1, 55, cX(rc), cY(rc), 5
	}
	if (eqfaction(rc, "st_ruralboss")) {
		flt
		itemcreate -1, 702, cX(rc), cY(rc), 0
		flt
		itemcreate -1, 55, cX(rc), cY(rc), 3
	}
	if (eqfaction(rc, "st_feaboss")) {
		flt
		itemcreate -1, 290, cX(rc), cY(rc), 0
		flt
		itemcreate -1, 715, cX(rc), cY(rc), 3
	}
	if (eqfaction(rc, "st_caveboss")) {
		flt
		itemcreate -1, 622, cX(rc), cY(rc), 5
		flt
		itemcreate -1, 655, cX(rc), cY(rc)
		flt
		itemcreate -1, 662, cX(rc), cY(rc)
	}
	cell_refresh cX(rc), cY(rc)
	if (cRole(rc) == 13) {
		gosub *label_1541
	}
	return
*label_0775
	i = getgametime()
	repeat 245 + 1
		if (cnt == 245) {
			p = -1
		} else {
			p = cnt
			if (cState(p) == 0) {
				continue
			}
		}
		inv_getheader p
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iMaterial(cnt) == 35 & refitem(iId(cnt), 5, cnt) == 57000) {
				if (iParam3(cnt) > 0) {
					if (iParam3(cnt) <= i) {
						if (iOwnState(cnt) <= 0) {
							if (p == (-1)) {
								if (iId(cnt) == 204) {
									if (chipm(0, map(iX(cnt), iY(cnt), 0)) == 1) {
										if (gWeather != 0) {
											continue
										}
										txt -1, lang(itemname(cnt) + "は上手い具合に干された。", itemname(cnt) + is2(iNumber(cnt)) + " dried up in the sun.")
										iParam3(cnt) = getgametime() + 2160
										iImage(cnt) = 337
										iId(cnt) = 571
										iParam1(cnt) = 0
										iParam2(cnt) = 5
										cell_refresh iX(cnt), iY(cnt)
										continue
									}
								}
							}
							if (p != (-1)) {
								if (p < 16 | cRole(p) == 10001 | cRole(p) == 10018 | eqfaction(p, "petshop")) {
									txt -1, lang(itemname(cnt) + "は腐った。", itemname(cnt) + " rot" + _s2(iNumber(cnt)) + ".")
								}
							}
							iParam3(cnt) = -1
							iImage(cnt) = 336
							if (p == (-1)) {
								cell_refresh iX(cnt), iY(cnt)
							}
							if (p == 0) {
								if (godcheck() == "kumiromi") {
									i = refitem(iId(cnt), 9, cnt)
									txt -1, lang("あなたは" + itemname(cnt) + "から種を取り出した。", "You extract plant seeds from " + itemname(cnt) + ".")
									seedratio = limit(cPietyPoint(0) / 500, 0, 50)
									if (sorgEx(181, 0) >= 1000) {
										seedratio += limit((cPietyPoint(0) - 100000) / 1000, 0, 50)
									}
									seedbonus@se = iNumber(cnt) * seedratio / 100
									p = rndex2(iNumber(cnt) - seedbonus@se + 1)
									p += seedbonus@se
									removeitem cnt, iNumber(cnt)
									flt calcobjlv(difficulty())
									flttypeminor = 58500
									itemcreate 0, 0, -1, -1, p
									p = 0
									i = getgametime()
								}
							}
						}
					}
				}
			}
		loop
	loop
	return
*label_0776
	if (have_bigench(cc, 16)) {
		if (have_bigench2(cc, 16) > rnd(100)) {
			txt 0, lang("" + name(cc) + "の呪いの影響は軽減された。", "" + name(cc) + "avoided the curse.")
			return
		}
	}
	if (rnd(4) == 0) {
		if (godcheck(cc) == "fuuri") {
			if (rnd(2) == 0) {
				if (rnd(13) == 0) {
					dmghp cc, cMaxHp(cc) * (5 + cCursePower(cc) / 8) / 100, -5
				} else {
					dmghp cc, cHp(cc) * (5 + cCursePower(cc) / 8) / 100 / (rnd(4) + 1), -5
				}
			}
		} else {
			dmghp cc, cHp(cc) * (5 + cCursePower(cc) / 5) / 100, -5
		}
		return
	}
	if (mapType != 1) {
		if (rnd(10 - limit(cCursePower(cc) / 10, 0, 9)) == 0) {
			if (godcheck(cc) == "fuuri") {
				if (rnd(20) == 0) {
					txt -1, lang("呪いの神が" + name(cc) + "をテレポートから守った。", "God of curse protects " + name(cc) + " from teleporting.")
				}
				return
			} else {
				efid = 408
				tc = cc
				rndtelepo = 1
				gosub *label_1398
				rndtelepo = 0
				return
			}
		}
	}
	if (rnd(10) == 0) {
		if (godcheck(cc) == "fuuri") {
			if (rnd(10) == 0) {
				txt -1, lang("呪いの神が" + name(cc) + "の財布を守った。", "God of curse protects " + name(cc) + " from being stolen.")
			}
			return
		} else {
			if (cGold(cc) > 0) {
				p = rndex(cGold(cc)) / 100 + rnd(10) + 1
				if (p > cGold(cc)) {
					p = cGold(cc)
				}
				cGold(cc) -= p
				if (synccheck(cc, -1)) {
					txtef 8
					txt -1, lang("悪意のある手が" + name(cc) + "の財布から金貨を抜き去った。", "A malicious hand filches some gold pieces from " + name(cc) + your(cc) + " wallet.")
				}
				return
			}
		}
	}
	return
*label_0777
	if (rnd(15) == 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は不安げに腹を押さえた。", name(cc) + " pat" + _s(cc) + " " + his(cc) + " stomach uneasily.")
			txtef 9
			ctalk cc, 972, cc, cc
			if (stat == 0) {
				txtef 9
				ctalk cc, 1202, cc, cc
				if ( stat == 0 ) {
					txt cc, lang("「なにかが産まれそうだよ！」", cnvtalk("I'm going to have a baby!")), lang("「腹になにかが…」", cnvtalk("Something is wrong with my stomach..."))
				}
			}
		}
	}
	if (mapType != 1) {
		if (rnd(30) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang("何かが" + name(cc) + "の腹を破り飛び出した！", "Something splits " + name(cc) + your(cc) + " body and breaks out!")
			}
			txtef 9
			ctalk cc, 971, cc, cc
			cBleeding(cc) += 15
			flt
			initlv = cLevel(cc) / 2 + 1
			novoidlv = 1
			if (rnd(20) == 0) {
				characreate -1, 176, cX(cc), cY(cc)
				if (stat != 0) {
					cBirthYear(rc) = gYear
					if (instr(cdatan(0, cc), 0, lang("の子供", "child")) != (-1)) {
						cdatan(0, rc) = lang("妹の" + randomname(), randomname() + " the younger sister")
					} else {
						cdatan(0, rc) = lang(cdatan(0, cc) + "の子供", "child of " + cdatan(0, cc))
					}
					cElementOfUnarmedAttack(rc) = 63 * 100000 + 250
					if (cc == 0 | cId(cc) == 343 | cId(cc) == 0 | cId(cc) == 212 | cId(cc) == 340) {
					} else {
						if (rnd(5) == 0) {
							cAiCalm(rc) = cAiCalm(cc)
							cAiMove(rc) = cAiMove(cc)
							cAiDist(rc) = cAiDist(cc)
							cAiActSubFreq(rc) = limitmax(cAiActSubFreq(cc), 100)
							cAiHeal(rc) = cAiHeal(cc)
							cAiActNum(rc) = cAiActNum(cc)
							cdata(215, rc) = cdata(215, cc)
							cdata(216, rc) = cdata(216, cc)
							cdata(217, rc) = cdata(217, cc)
							cdata(218, rc) = cdata(218, cc)
							cdata(219, rc) = cdata(219, cc)
							cdata(220, rc) = cdata(220, cc)
							cdata(221, rc) = cdata(221, cc)
							cdata(222, rc) = cdata(222, cc)
							cdata(223, rc) = cdata(223, cc)
							cdata(224, rc) = cdata(224, cc)
							ocbitmod 0, rc, 1
						}
					}
				}
			} else {
				childid = ocdata(52, cc)
				if (childid == 0) {
					childid = 330
				}
				if (childid == 319 | childid == 368) {
					childid = 176
				}
				if (childid == 343) {
					initunid = ocdata(53, cc)
				}
				if (childid == (-1)) {
					childid = cId(cc)
					if (childid == 343) {
						initunid = cCnpcId(cc) + 1
					}
				}
				characreate -1, childid, cX(cc), cY(cc)
				if (stat != 0) {
					cBirthYear(rc) = gYear
					ocbitmod 15, rc, 1
					if (instr(cdatan(0, cc), 0, lang("の子供", "child")) != (-1)) {
						sreplace cdatan(0, rc), cdatan(0, cc), "の子供", "の子孫"
					} else {
						cdatan(0, rc) = lang(cdatan(0, cc) + "の子供", "child of " + cdatan(0, cc))
					}
					if (cc == 0 | cId(cc) == 343 | cId(cc) == 0 | cId(cc) == 212 | cId(cc) == 340) {
					} else {
						if (rnd(5) == 0) {
							cAiCalm(rc) = cAiCalm(cc)
							cAiMove(rc) = cAiMove(cc)
							cAiDist(rc) = cAiDist(cc)
							cAiActSubFreq(rc) = limitmax(cAiActSubFreq(cc), 100)
							cAiHeal(rc) = cAiHeal(cc)
							cAiActNum(rc) = cAiActNum(cc)
							cdata(215, rc) = cdata(215, cc)
							cdata(216, rc) = cdata(216, cc)
							cdata(217, rc) = cdata(217, cc)
							cdata(218, rc) = cdata(218, cc)
							cdata(219, rc) = cdata(219, cc)
							cdata(220, rc) = cdata(220, cc)
							cdata(221, rc) = cdata(221, cc)
							cdata(222, rc) = cdata(222, cc)
							cdata(223, rc) = cdata(223, cc)
							cdata(224, rc) = cdata(224, cc)
							ocbitmod 0, rc, 1
						}
					}
				}
			}
		}
	}
	return
*label_0778
	if (getcgodno(cc) != (-1)) {
		god_no = stat
		if (cgodSpecialPowerId(god_no) / 1000 == 1) {
			rp2 = cgodSpecialPowerId(god_no) \ 1000
			if (rp2 == 21) {
				if (mapType != 1) {
					if (rnd(25) < limit(abs(convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(cc))) / 50, 1, 25)) {
						efid = 408
						tc = cc
						rndtelepo = 1
						gosub *label_1398
						rndtelepo = 0
					}
				}
			}
			if (rp2 == 45) {
				if (rnd(4) == 0) {
					if (synccheck(cc, -1)) {
						txtef 8
						txt -1, lang("何かが" + name(cc) + "の血を吸った。", "Something sucks " + name(cc) + your(cc) + " blood.")
					}
					cBleeding(cc) += abs(convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(cc))) / 25 + 3
				}
			}
			if (rp2 == 46) {
				if (rnd(20) == 0) {
					if (synccheck(cc, -1)) {
						txtef 8
						txt -1, lang(name(cc) + "は未熟になった。", name(cc) + " become" + _s(cc) + " inexperienced.")
					}
					cExperience(cc) -= cRequiredExperience(cc) / (300 - limit(abs(convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(cc))) / 2, 0, 50)) + rnd(100)
					if (cExperience(cc) < 0) {
						cExperience(cc) = 0
					}
				}
			}
			if (rp2 == 47) {
				if (mapType != 1) {
					if (mapType != 5) {
						if (rnd(50) < limit(abs(convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(cc))) / 50, 1, 50)) {
							if (synccheck(cc, -1)) {
								txtef 8
								txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
							}
							repeat 1 + rnd(3)
								flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(2)
								characreate -1, 0, cX(cc), cY(cc)
							loop
						}
					}
				}
			}
		}
	}
	repeat 30, 100
		if (cdata(cnt, cc) \ 10000 == 0) {
			continue
		}
		cibk_autoenc = cdata(cnt, cc) \ 10000 - 1
		repeat 15
			ci = cibk_autoenc
			if (iEnchantmentId(ci, cnt) == 0) {
				break
			}
			if (findbuff(cc, 62) == (-1) | check_bigench(ci) == 3) {
				if (iEnchantmentId(ci, cnt) == 21) {
					if (mapType != 1) {
						if (rnd(25) < limit(abs(iEnchantmentPower(ci, cnt)) / 50, 1, 25)) {
							efid = 408
							tc = cc
							rndtelepo = 1
							gosub *label_1398
							rndtelepo = 0
							continue
						}
					}
				}
				if (iEnchantmentId(ci, cnt) == 45) {
					if (rnd(4) == 0) {
						if (synccheck(cc, -1)) {
							txtef 8
							txt -1, lang("何かが" + name(cc) + "の血を吸った。", "Something sucks " + name(cc) + your(cc) + " blood.")
						}
						elep = abs(iEnchantmentPower(ci, cnt)) / 25 + 3
						cBleeding(cc) += elep
						if (ibit(10, ci)) {
							exp = rndex(cHp(cc) * (1 + elep / 4) / 100 + 3) + 1
							cw = ci
							gosub *label_1771
						}
						continue
					}
				}
				if (iEnchantmentId(ci, cnt) == 46) {
					if (rnd(20) == 0) {
						if (synccheck(cc, -1)) {
							txtef 8
							txt -1, lang(name(cc) + "は未熟になった。", name(cc) + " become" + _s(cc) + " inexperienced.")
						}
						cExperience(cc) -= cRequiredExperience(cc) / (300 - limit(abs(iEnchantmentPower(ci, cnt)) / 2, 0, 50)) + rnd(100)
						if (cExperience(cc) < 0) {
							cExperience(cc) = 0
						}
						continue
					}
				}
				if (iEnchantmentId(ci, cnt) == 47) {
					if (mapType != 1) {
						if (mapType != 5) {
							if (rnd(50) < limit(abs(iEnchantmentPower(ci, cnt)) / 50, 1, 50)) {
								if (synccheck(cc, -1)) {
									txtef 8
									txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
								}
								repeat 1 + rnd(3)
									flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(2)
									characreate -1, 0, cX(cc), cY(cc)
								loop
								continue
							}
						}
					}
				}
			}
		loop
	loop
	return
*label_0779
	if (cConfused(cc) != 0 | cSleep(cc) != 0 | cParalyzed(cc) != 0 | cChoked(cc) != 0 | cStoned(cc) != 0) {
		return
	}
	inv_getheader cc
	repeat invrange, invhead
		if (iNumber(cnt) == 0 | iIdentificationState(cnt) >= 3) {
			continue
		}
		if (refitem(iId(cnt), 5, cnt) >= 50000) {
			continue
		}
		ci = cnt
		p = sdata(13, cc) + sdata(162, cc) * 5, 1500 + iDifficultyToIdentify(ci) * 5
		if (p > rnd(p(1) * 5)) {
			s = itemname(ci)
			item_identify ci, 3
			itemmemory(0, iId(ci)) = 1
			if (cfg_hideautoidentify <= 1) {
				txt -1, lang(name2(cc) + "のバックパックの中の" + s + "は" + itemname(ci) + "だと判明した。", name2(cc) + " appraise" + _s(cc) + " " + s + " as " + itemname(ci) + ".")
			}
			skillexp2 162, cc, 50
		}
		if (iIdentificationState(ci) < 2) {
			if (p > rnd(p(1))) {
				if (cfg_hideautoidentify == 0) {
					txt -1, lang(name2(cc) + "のバックパックの中の" + itemname(ci) + "は" + _quality(iQuality(ci)) + "だという感じがする。", name2(cc) + " sense" + _s(cc) + " the quality of " + itemname(ci) + " is " + _quality(iQuality(ci)) + ".")
				}
				item_identify ci, 2
				skillexp2 162, cc, 50
			}
		}
	loop
	return



// TODO: rename! BUCとMaterial以外にも色々やってる
*itemGen_setBUCAndMaterial
	// BUC status
	if (reftype < 60000) {
		if (rnd(12) == 0) {
			iCurseState(ci) = 1 // blessed
		}
		if (rnd(13) == 0) {
			iCurseState(ci) = -1 // cursed
			if (refitem(iId(ci), 5, ci) < 50000) {
				if (rnd(4) == 0) {
					iCurseState(ci) = -2 // doomed
				}
			}
		}
	}
	if (cm | mode == 1 | iQuality(ci) == 6) {
		iCurseState(ci) = 0
	}

	// Material
	if (reftype < 50000 | (reftype == 60000 & rnd(5) == 0)) {
		if (iMaterial(ci) >= 1000 | reftype == 60000) {
			gosub *label_0313
		} else {
			gosub *itemGem_setMaterialSpecificStats
		}
	}

	// Enchantments
	if (fixeditemenc != 0) {
		repeat 10
			if (fixeditemenc(cnt * 2) == 0) {
				break
			}
			encadd ci, fixeditemenc(cnt * 2), fixeditemenc(cnt * 2 + 1), 0, 0, 0, 1
		loop
	}

	// Misc.
	if (reftype < 52000) {
		gosub *label_0311
		gosub *itemGen_setEnhancementValue
	} else {
		if (iQuality(ci) != 6) {
			iQuality(ci) = 2
		}
	}
	return



*itemGen_doCreateItem
	// Increase fixlv if you're lucky.
	if (val == 0 | val == (-1) & mode != 8) {
		if (sdata(19, 0) > rnd(5000)) {
			if (fixlv < 5) {
				fixlv++
			}
		}
	}

	// Determine inv slot.
	if (val == 5480) {
		ci = val
	} else {
		ci = inv_getfreeid(val)
		if (ci == (-1)) {
			return 0
		}
	}
	// Delete old one.
	item_delete ci

	// Determine item position unless the item is about to be generated in some container.
	if (val == (-1) & mode != 6 & mode != 9) {
		p = 0
		repeat 100
			if (val(1) == (-1)) {
				sx = rnd(mapWidth - 2) + 2
				sy = rnd(mapHeight - 2) + 2
				if (map(sx, sy, 4) != 0) {
					continue
				}
			} else {
				if (cnt == 0) {
					sx = val(1)
					sy = val(2)
				} else {
					sx = val(1) + rnd(cnt + 1) - rnd(cnt + 1)
					sy = val(2) + rnd(cnt + 1) - rnd(cnt + 1)
				}
				if (sx < 0 | sy < 0 | sx > mapWidth - 1 | sy > mapHeight - 1) {
					continue
				}
			}
			if (val(1) != (-1)) {
				if (cnt == 0) {
					p = 1
					iX(ci) = sx
					iY(ci) = sy
					break
				}
			}
			if (map(sx, sy, 6) != 0) {
				if (map(sx, sy, 6) / 1000 \ 100 == 22 | map(sx, sy, 6) / 1000 \ 100 == 20 | map(sx, sy, 6) / 1000 \ 100 == 21) {
					continue
				}
			}
			if ((chipm(7, map(sx, sy, 0)) & 4) == 0) {
				p = 1
				iX(ci) = sx
				iY(ci) = sy
				break
			}
		loop
		if (p == 0) {
			return 0
		}
	}

	// Determine item ID.
	if (dbid == (-1)) {
		if (fltselect == 0) {
			if (mode != 6 & mode != 8) {
				if (fixlv == 3) {
					if (rnd(1000) == 0) {
						fltselect = 2
					}
				}
				if (fixlv == 4) {
					if (rnd(100) == 0) {
						fltselect = 2
					}
				}
			}
		}
		dbmode = 1
		gosub *label_2426
		if (dbid == 25) {
			if (fltselect == 2) {
				fixlv = 4
			}
			objlv += 10
			fltselect = 0
			dbmode = 1
			gosub *label_2426
		}
	} else {
		if (dbid == 743) {
			if (useritemmax > 0) {
				inv(31, ci) = rnd(useritemmax)
			}
		}
	}
	if (dbid == 25) {
		if (flttypemajor == 60002) {
			dbid = 501
		}
	}

	itemcreatehack = dbid + 1

	if (characreatehack > 0) {
		if (noencpfix == 0) {
			encpfix = 1
		}
	}

	// Set basic item stats.
	if (dbid == 743) {
		gosub *itemGen_initCItem
	} else {
		dbmode = 3
		gosub *label_2426
		dbmode = 2
		gosub *label_2426
		iColor(ci) = icolref(iId(ci))
	}

	// Set color.
	if (iColor(ci) == 1) {
		iColor(ci) = randcolor(rnd(length(randcolor)))
	}
	if (iId(ci) == iId_dye) {
		iColor(ci) = rnd(21)
	}

	// Set detailed item stats.
	if (iId(ci) == iId_manual) {
		if (iParam1(ci) == 0) {
			iParam1(ci) = isetbook(rnd(length(isetbook)))
		}
	}
	if (iId(ci) == iId_textbook) {
		if (iParam1(ci) == 0) {
			iParam1(ci) = randskill()
		}
	}
	if (iId(ci) == iId_recipe) {
		iSubname(ci) = rpsourcelist(rnd(length(rpsourcelist)))
		iParam1(ci) = 1
	}

	itemmemory(1, dbid)++

	// Set item quality.
	iQuality(ci) = fixlv

	// Append news to the oracle.
	if (fixlv == 6) {
		if (mode != 6) {
			if (nooracle == 0) {
				oomSEST_log "oracle"
				ii_p = inv_getowner(ci)
				if (ii_p != (-1)) {
					if (cRole(ii_p) == 13) {
						artifactlocation += lang(iknownnamecnv(ci) + "は" + gYear + "年" + gMonth + "月に" + mapname(cCurrentMap(ii_p)) + "の" + cdatan(0, ii_p) + "の手に渡った。\n", cnven(iknownnameref(iId(ci))) + " was held by " + cdatan(0, ii_p) + " at " + mapname(cCurrentMap(ii_p)) + " in " + gDay + "/" + gMonth + ", " + gYear + ". ")
					} else {
						ii_p = -1
					}
				}
				if (ii_p == (-1)) {
					artifactlocation += lang(iknownnamecnv(ci) + "は" + gYear + "年" + gMonth + "月に" + mdatan(0) + "で生成された。\n", cnven(iknownnameref(iId(ci))) + " was created at " + mdatan(0) + " in " + gDay + "/" + gMonth + ", " + gYear + ". ")
				}
			}
		}
	}

	if (iId(ci) == iId_bait) {
		iParam1(ci) = rnd(6)
		iImage(ci) = 385 + iParam1(ci)
		iValue(ci) = iParam1(ci) * iParam1(ci) * 500 + 200
	}
	if (iId(ci) == iId_deedOfHome) {
		iParam1(ci) = rnd(5) + 1
		if (mode != 6) {
			iParam1(ci) = 2
		}
		iSubname(ci) = iParam1(ci)
		iValue(ci) = 5000 + 4500 * iParam1(ci) * iParam1(ci) * iParam1(ci) + iParam1(ci) * 20000
		if (iParam1(ci) == 5) {
			iValue(ci) *= 2
		}
	}
	if (iId(ci) == iId_gold) {
		iNumber(ci) = calcinitgold(val)
		if (iQuality(ci) == 3) {
			iNumber(ci) = iNumber(ci) * 2
		}
		if (iQuality(ci) >= 4) {
			iNumber(ci) = iNumber(ci) * 4
		}
		if (val >= 0) {
			se_moneymod val, iNumber(ci)
			iNumber(ci) = 0
			return 1
		}
	}
	if (iId(ci) == iId_gift) {
		iParam4(ci) = rnd(rnd(rnd(length(giftvalue)) + 1) + 1)
		iValue(ci) = iParam4(ci) * 2500 + 500
	}
	if (iId(ci) == iId_kittyBank) {
		iParam2(ci) = rnd(length(moneybox) - 1)
		if (ogdata(516) == 2) {
			iParam2(ci) = rnd(length(moneybox))
		}
		if (iParam2(ci) != 2147483647) {
			iValue(ci) = iParam2(ci) * iParam2(ci) * iParam2(ci) * 1000 + 1000
		} else {
			iValue(ci) = 2000000000
		}
	}
	if (iId(ci) == iId_monsterBall) {
		iParam2(ci) = rndex2(objlv + 1) + 1
		iValue(ci) = 2000 + iParam2(ci) * iParam2(ci) + iParam2(ci) * 100
	}
	if (iId(ci) == iId_materialKit) {
		gosub *label_0314
		gosub *label_0316
	}
	if (iId(ci) == iId_ancientBook) {
		iParam1(ci) = rnd(rnd(limit(objlv / 2, 1, 15)) + 1)
	}
	if (iId(ci) == iId_loveFueledLunch) {
		ibitmod 17, ci, 1
	}
	if (iId(ci) == iId_coolerBox) {
		gNextInventorySerialId++
		iCount(ci) = gNextInventorySerialId
	}
	if (iId(ci) == iId_heirTrunk) {
		iCount(ci) = 3
	}
	if (iId(ci) == iId_shopStrongbox) {
		iCount(ci) = 5
	}
	if (iId(ci) == iId_salaryChest) {
		iCount(ci) = 4
	}
	if (iId(ci) == iId_freezer) {
		iCount(ci) = 6
	}
	if (iId(ci) == iId_storage) {
		iCount(ci) = 10
	}
	if (iId(ci) == iId_trashCan) {
		iCount(ci) = 17
		iFunction(ci) = 1503
	}
	if (iId(ci) == 275) {
		iCount(ci) = 17
		iFunction(ci) = 1504
	}
	if (iId(ci) == 813) {
		iCount(ci) = 17
		iFunction(ci) = 1505
	}
	if (iId(ci) == iId_garoksHammer) {
		iSubname(ci) = 40000 + rnd(30000)
		p = rnd(rnd(rnd(10) + 1) + 3) + 5
		egolv = rnd(limit(rnd(30 / 10 + 3), 0, 4) + 1)
		if (rnd(10) == 0) {
			encadd ci, randomenc(99, 9), randomencp(), , , , 1
		}
		repeat p
			encadd ci, randomenc(randomenclv(egolv), twochoice(-1, 9)), randomencp(), 20, , , 1
		loop
	}
	if (equalsitem(ci, "blacksmith hammer")) {
		iParam1(ci) = 1
	}
	if (reftype == 72000) { // chests
		iParam1(ci) = gCurrentDungeonLevel * (gCurrentMap != 30) + 5
		if (iId(ci) == iId_suitcase) {
			iParam1(ci) = (rnd(10) + 1) * (difficulty() / 10 + 1)
		}
		if (iId(ci) == iId_treasureBall | iId(ci) == iId_rareTreasureBall) {
			iParam1(ci) = difficulty()
		}
		iParam2(ci) = rnd(abs(gCurrentDungeonLevel) * (gCurrentMap != 30) + 1)
		if (iId(ci) == iId_wallet | iId(ci) == iId_suitcase) {
			iParam2(ci) = rnd(15)
		}
		iParam3(ci) = rnd(30000)
		if (iId(ci) == iId_smallGambleChest) {
			iParam2(ci) = rnd(rnd(100) + 1) + rnd(limit(fixrank / 4, 1, 2000)) + 1
			iValue(ci) = iParam2(ci) * 25 + 150
			initnum = rnd(8)
		}
	}
	if (reftype == 57000) { // foods
		if (iParam1(ci) != 0) {
			if (mode == 6) {
				if (rnd(2) == 0) {
					iParam2(ci) = 0
				} else {
					iParam2(ci) = 3 + rnd(3)
					iWeight(ci) = 500
				}
				if (iParam2(ci) != 0) {
					if (iParam2(ci) < 9 & rnd(16000 / limit(fixrank * lvup / 5, 1, 2000)) == 0) {
						iParam2(ci) = 9
					} elseif (fixlv < 8 & rnd(8000 / limit(fixrank * lvup / 5, 1, 2000)) == 0) {
						iParam2(ci) = 8
					} elseif (fixlv < 7 & rnd(4000 / limit(fixrank * lvup / 5, 1, 2000)) == 0) {
						iParam2(ci) = 7
					} elseif (fixlv < 6 & rnd(2000 / limit(fixrank * lvup / 5, 1, 1000)) == 0) {
						iParam2(ci) = 6
					} elseif (fixlv < 5 & rnd(1000 / limit(fixrank * lvup / 5, 1, 500)) == 0) {
						iParam2(ci) = 5
					} elseif (fixlv < 4 & rnd(500 / limit(fixrank * lvup / 5, 1, 250)) == 0) {
						iParam2(ci) = 4
					}
				}
			}
			if (iParam2(ci) != 0) {
				iImage(ci) = picfood(iParam2(ci), iParam1(ci) / 1000)
			}
			if (iMaterial(ci) == 35) {
				iParam3(ci) += getgametime() + harvest * iParam3(ci)
			}
		}
	}

	gosub *itemGen_setBUCAndMaterial

	if (reftype == 60000) { // furniture
		if (rnd(3) == 0) {
			iSubname(ci) = rnd(rnd(12) + 1)
		} else {
			iSubname(ci) = 0
		}
		if (reftypeminor == 60005) { // musical instruments
			// 楽器に演奏報酬の品質を上げるエンチャントを付与する
			// すでにそのエンチャントを持っていた場合 (CItemを除けばストラディバリウスのみ) には付与しない
			// 世界最高: 100%
			// 神々しい: 25%
			// 芸術的な: 11%
			// それ以下: 0%
			if (9 <= iSubname(ci)) {
				if (rnd((12 - iSubname(ci)) * (12 - iSubname(ci))) == 0) {
					if (encfindspec(ci, 49) == -1) {
						encadd ci, 49, 100, 0, 1
					}
				}
			}
		}
		gosub *itemGen_containerize
	}
	if (reftypeminor == 77001 | iId(ci) == iId_goldBar) { // ores (gems)
		if (rnd(2) == 0) {
			iSubname(ci) = 0
		} else {
			if (objlv <= 50) {
				p@tmp = objlv / 25
			} else {
				p@tmp = int(10.0 / sqrt(1000) * sqrt(objlv))
			}
			iSubname(ci) = limit(p@tmp + rnd(1 + rnd(3)) + 1, 1, 11)
		}
	}
	if (mode == 6) {
		iIdentificationState(ci) = 3
	}
	if (reftype == 68000 | reftype == 69000 | iId(ci) == 622 | iId(ci) == 724 | iId(ci) == 730 | iId(ci) == 615) {
		iCurseState(ci) = 0
		iIdentificationState(ci) = 3
	}
	if (reftype == 92000) {
		iIdentificationState(ci) = 3
		iCurseState(ci) = 0
		itemmemory(0, iId(ci)) = 1
	}
	if (reftype == 62000 | reftype == 64000 | reftype == 77000) {
		iCurseState(ci) = 0
	}
	if (dbg_autoidentify) {
		item_identify ci, dbg_autoidentify
	} else {
		if (mode != 6) {
			if (reftype < 50000) {
				if (rnd(sdata(162, 0) + 1) > 5) {
					iIdentificationState(ci) = 2
				}
			}
		}
	}
	gosub *label_0782
	itemturn ci
	if (initnum != 0) {
		iNumber(ci) = initnum
	}
	if (nostack == 1 | ci == 5480) {
		nostack = 0
	} else {
		item_stack val, ci
		if (stat == 1) {
			ci = ti
			return 1
		}
	}
	if (val == (-1)) {
		cell_refresh iX(ci), iY(ci)
	}
	return 1
*label_0782
	if (reftype == 60000) {
		if (iSubname(ci) != 0) {
			iValue(ci) = iValue(ci) * (80 + iSubname(ci) * 20) / 100
		}
	}
	if (reftype == 77000) {
		if (iSubname(ci) != 0) {
			iValue(ci) = iValue(ci) * powf(iSubname(ci), 2)
		}
	}
	return



#deffunc lovemiracle int __vvv, int __xxx
	if (rnd(2) | gCurrentMap == 49) {
		return
	}
	cibk = ci
	if (cfg_NC_aphrodisiac == 0 | f == 0) {
		txtef 9
		ctalk __vvv, 994, __vvv, __vvv
		if (stat == 0) {
			txtef 9
			txt __vvv, lang("「あ…！」", cnvtalk("Uh...!"))
		}
	}
	flt
	if (rnd(2)) {
		itemcreate -1, iId_egg, cX(__vvv), cY(__vvv), 0
		if (stat) {
			if (__vvv == 0) {
				ibitmod 5, ci, 1
			} else {
				iSubname(ci) = cId(__vvv)
				if (iSubname(ci) == 343) {
					inv(33, ci) = cCnpcId(__vvv)
					inv(34, ci) = createserialno(userdatan(0, cCnpcId(__vvv)))
				}
			}
			iWeight(ci) = cWeight(__vvv) * 10 + 250
			iValue(ci) = limit(cWeight(__vvv) * cWeight(__vvv) / 10000, 200, 40000)
			if (cbit(978, __vvv)) {
				if (rnd(100) < 5) {
					// iCount:寄生元NPC
					// iDv:寄生元NPC(Cnpc)
					// iPv:レベル
					childid = ocdata(52, __vvv)
					if (childid == 0) {
						iCount(ci) = 330
					}
					if (childid == 319 | childid == 368) {
						iCount(ci) = 176
					}
					if (childid == 343) {
						iDv(ci) = ocdata(53, __vvv) - 1
					}
					if (childid == (-1)) {
						childid = cId(__vvv)
						iCount(ci) = childid
						if (childid == 343) {
							iDv(ci) = cCnpcId(__vvv) + 1
						}
					} else {
						iCount(ci) = childid
					}
					iPv(ci) = limitmax((sdata(17, __vvv) / 5) + (cLevel(__vvv) / 5) + 1, 1000)
					inv(19, ci) = 53
					if (cfg_NC_aphrodisiac == 0 | f == 0) {
						ctalk __vvv, 1220, __vvv, __vvv
					}
				}
			}
		}
		if (cfg_NC_aphrodisiac == 0 | f == 0) {
			ctalk __vvv, 1215, __vvv, __vvv
		}
	} else {
		itemcreate -1, iId_milk, cX(__vvv), cY(__vvv), 0
		if (stat) {
			if (__vvv == 0) {
				ibitmod 5, ci, 1
			} else {
				iSubname(ci) = cId(__vvv)
				if (iSubname(ci) == 343) {
					inv(33, ci) = cCnpcId(__vvv)
					inv(34, ci) = createserialno(userdatan(0, cCnpcId(__vvv)))
				}
			}
			if (iCurseState(ci) == 1) {
				s@tmp = godcheck(__vvv)
				if (s@tmp != "eyth" & s@tmp != "elder brother") {
					iParam4(ci) = cGod(__vvv)
					if (iParam4(ci) == 0) {
						iParam4(ci) = blesscgod(__vvv)
					}
					if (iParam4(ci) != 0) {
						ibitmod 8, ci, 1
					}
				}
			}
		}
		if (cfg_NC_aphrodisiac == 0 | f == 0) {
			ctalk __vvv, 1218, __vvv, __vvv
		}
	}
	if (__xxx == 1) {
		if (cContinuousActionId(__vvv) == 11 & rnd(50) == 0) {
			if (rnd(2)) {
				ctalk __vvv, 1216, __vvv, __vvv
				if (stat == 0) {
					txtef 9
					txt __vvv, lang("「やぁ…！」", cnvtalk("No...!"))
				}
				flt
				itemcreate -1, 26, cX(__vvv), cY(__vvv), 0
				if (stat) {
					if (__vvv == 0) {
						ibitmod 5, ci, 1
					} else {
						iSubname(ci) = cId(__vvv)
						if (iSubname(ci) == 343) {
							inv(33, ci) = cCnpcId(__vvv)
							inv(34, ci) = createserialno(userdatan(0, cCnpcId(__vvv)))
						}
					}
					iValue(ci) = (sdata(17, __vvv) / 10) * 10 + 100
				}
			} else {
				ctalk __vvv, 1217, __vvv, __vvv
				if (stat == 0) {
					txtef 9
					txt __vvv, lang("「やぁ…！」", cnvtalk("No...!"))
				}
				flt
				itemcreate -1, 575, cX(__vvv), cY(__vvv), 0
				if (stat) {
					if (__vvv == 0) {
						ibitmod 5, ci, 1
					} else {
						iSubname(ci) = cId(__vvv)
						if (iSubname(ci) == 343) {
							inv(33, ci) = cCnpcId(__vvv)
							inv(34, ci) = createserialno(userdatan(0, cCnpcId(__vvv)))
						}
					}
					iValue(ci) = (sdata(17, __vvv) / 10) * 10 + 100
				}
			}
			snd 107
			if ((cfg_NC_aphrodisiac < 3 & __xxx == 0) | (cfg_NC_aphrodisiac < 2 & __xxx == 1)) {
				animeload 15, __vvv
			}
		}
	}
	ci = cibk
	if (cfg_NC_aphrodisiac == 0 | f == 0) {
		snd 107
		if ((cfg_NC_aphrodisiac < 3 & __xxx == 0) | (cfg_NC_aphrodisiac < 2 & __xxx == 1)) {
			animeload 15, __vvv
		}
		f = 1
	}
	return
*label_0784
	if (cc != 0) {
		txt -1, lang(name(cc) + "は渋い顔をした。", name(cc) + " looks glum.")
		return
	}
	if (cbit(14, cc) == 1) {
		txt -1, lang("しかし、" + name(cc) + "は何ともなかった。", "But " + name(cc) + your(cc) + " stomach isn't affected.")
		return
	}
	fdmax = 0
	if (fdmax < 10) {
		fdlist(0, fdmax) = 10, -100
		fdmax++
	}
	if (fdmax < 10) {
		fdlist(0, fdmax) = 11, -100
		fdmax++
	}
	if (fdmax < 10) {
		fdlist(0, fdmax) = 17, -100
		fdmax++
	}
	if (fdmax < 10) {
		fdlist(0, fdmax) = 16, -100
		fdmax++
	}
	if (fdmax < 10) {
		fdlist(0, fdmax) = 12, -100
		fdmax++
	}
	if (fdmax < 10) {
		fdlist(0, fdmax) = 13, -100
		fdmax++
	}
	if (fdmax < 10) {
		fdlist(0, fdmax) = 14, -100
		fdmax++
	}
	if (fdmax < 10) {
		fdlist(0, fdmax) = 15, -100
		fdmax++
	}
	nutrition = 1000
	dmgcon cc, 3, 100
	dmgcon cc, 5, 200
	return
*label_0785
	gosub *label_1744
	gosub *refreshPCBurdenState
	return
*label_0787
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang("まるで鉄のように硬い！" + name(cc) + "の胃は悲鳴をあげた。", "It's too hard! " + name(cc) + your(cc) + " stomach screams.")
	}
	dmgcon cc, 7, 200
	return
*label_0788
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang("気が変になりそうな味だ。", "It tastes really, really strange.")
	}
	dmgsan cc, 25
	dmgcon cc, 11, 500
	return
*label_0789
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("馬肉だ！これは精がつきそうだ。", "A horsemeat! It's nourishing")
	}
	skillexp2 11, cc, 100
	return
*label_0790
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang(name(cc) + "は神聖なものを汚した気がした。", name(cc) + " feel" + _s(cc) + " as " + he(cc) + " " + have(cc) + " been corrupted.")
	}
	if (rnd(5) == 0) {
		resistmod cc, 53, 50
	}
	return
*label_0791
	if (synccheck(cc, -1)) {
		txt -1, lang("＠を食べるなんて…", "You dare to eat @...")
	}
	return
*label_0792
	if (cc != 0) {
		return
	}
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang("ガード達はあなたを憎悪した。", "Guards hate you.")
	}
	modkarma cc, -15
	return
*label_0793
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang(name(cc) + "の体は一瞬燃え上がった。", name(cc) + your(cc) + " body burns up for a second.")
	}
	resistmod cc, 50, 50 * 2
	return
*label_0794
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang(name(cc) + "の胃は狂気で満たされた。", "Sheer madness!")
	}
	resistmod cc, 54, 50
	dmgsan cc, 200
	dmgcon cc, 11, 1000
	return
*label_0795
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("肌がつるつるになりそうだ。", name(cc) + your(cc) + " skin becomes smooth.")
	}
	skillexp2 17, cc, 150
	return
*label_0796
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang(name(cc) + "は恋をしている気分になった！", name(cc) + " feel" + _s(cc) + " love!")
	}
	skillexp2 17, cc, 400
	return
*label_0797
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang("これは有毒だ！", "Argh! It's poisonous!")
	}
	dmgcon cc, 1, 100
	return
*label_0798
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("血が沸き立つようだ。", "A troll meat. This must be good for your body.")
	}
	skillexp2 154, cc, 200
	return
*label_0799
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang("腐ってるなんて分かりきっていたのに…うげぇ", "Of course, it's rotten! Urgh...")
	}
	gosub *label_0784
	return
*label_0800
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("力が湧いてくるようだ。", "Mighty taste!")
	}
	skillexp2 10, cc, 250
	return
*label_0801
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("微かな魔力の刺激を感じた。", name(cc) + " " + is(cc) + " magically stimulated.")
	}
	skillexp2 155, cc, 500
	return
*label_0802
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang("胃の調子がおかしい…", "Something is wrong with " + name(cc) + your(cc) + " stomach...")
	}
	dmgcon cc, 5, 200
	return
*label_0803
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("この肉は心を落ち着かせる効果があるようだ。", "Eating this brings " + name(cc) + " inner peace.")
	}
	if (godcheck(cc) != "danalin") {
		healsan cc, 20
	}
	return
*label_0804
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang(name(cc) + "の胃は狂気で満たされた。", "Sheer madness!")
	}
	dmgsan cc, 50
	if (rnd(5) == 0) {
		resistmod cc, 54, 50
	}
	return
*label_0805
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang(name(cc) + "の胃は混沌で満たされた。", name(cc) + " " + is(cc) + " shaken by a chaotic power.")
	}
	dmgcon cc, 5, 300
	return
*label_0806
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang(name(cc) + "の神経に電流が走った。", name(cc) + your(cc) + " nerve is damaged.")
	}
	dmgcon cc, 3, 300
	return
*label_0807
	if (cc != 0) {
		return
	}
	if (synccheck(cc, -1)) {
		txt -1, lang("猫を食べるなんて！！", "How can you eat a cat!!")
	}
	modkarma 0, -5
	return
*label_0808
	if (cc != 0) {
		return
	}
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang(name(cc) + "の体内はエーテルで満たされた。", "Ether corrupts your body.")
	}
	modcorrupt 1000
	return
*label_0809
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("体力がつきそうだ。", "This food is good for your endurance.")
	}
	return
*label_0810
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("魔力が鍛えられる。", "This food is good for your magic.")
	}
	return
*label_0811
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("力がつきそうだ。", "This food is good for your strength.")
	}
	return
*label_0812
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("精神が少しずぶとくなった。", "This food is good for your will power.")
	}
	return
*label_0813
	if (synccheck(cc, -1)) {
		txtef 2
		txt -1, lang("ワアーォ、" + name(cc) + "は速くなった気がする！", "Wow, " + name(cc) + " speed" + _s(cc) + " up!")
	}
	skillexp2 18, cc, limit(2500 - sdata(18, cc) * sdata(18, cc) / 10, 20, 2500)
	return
*label_0814
	if (cc == 0) {
		return
	}
	if (synccheck(cc, -1)) {
		if (cId(cc) == 176 | cId(cc) == 249) {
			return
		}
		if (cfg_ST_youngerSisterCorpse) {
			if (encfind(cc, 33) != (-1) | cQuality(cc) >= 6) {
				txt -1, lang(name(cc) + "は変異を受け付けなかった。", name(cc) + " resist the threat of mutation.")
				return
			}
			txtef 8
			txt -1, lang(name(cc) + "はあなたの血の繋がっていない妹だ。", name(cc) + " " + is(cc) + " your younger sister.")
			animeload 8, cc
			characreate 56, 176, -3, 0
			repeat 1000
				nc_intb_001 = cbit(cnt, cc)
				cbitmod cnt, 56, nc_intb_001
			loop
			cId(cc) = 176
			cImage(cc) = 105
			repeat 1000
				nc_intb_001 = cbit(cnt, 56)
				cbitmod cnt, cc, nc_intb_001
			loop
			cbitmod 22, cc, 1
			cbitmod 25, cc, 0
			cbitmod 967, cc, 0
			cCanTalk(cc) = 1
			cCanTalk(cc) += 1
			cCanTalk(cc) += 1
			cCanTalk(cc) += 1
			cbitmod 965, cc, 0
			chara_vanquish 56
		}
	}
	return
*label_0815
	if (synccheck(cc, -1)) {
		txt -1, lang("何かが" + name(cc) + "の体内に入り込んだ。", "Something gets into " + name(cc) + your(cc) + " body.")
	}
	tc = cc
	flag_alien = 1
	gosub *label_0816
	return
*label_0816
	if (findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1) {
		if (encfind(tc, 48) != (-1)) {
			if (synccheck(tc, -1)) {
				txt -1, lang("しかしすぐに吐き出した。", "But " + he(tc) + " puke" + _s(tc) + " it out quickly.")
			}
			return
		}
	}
	if (cbit(978, tc) == 0) {
		txtef 5
		if (cId(cc) == 330 | flag_alien) {
			txt -1, lang(name(tc) + "は寄生された。", name(tc) + " get" + _s(tc) + " pregnant.")
		} else {
			txt -1, lang(name(tc) + "は妊娠した。", name(tc) + " get" + _s(tc) + " pregnant.")
		}
		txtef 9
		ctalk tc, 973, tc, tc
		animeload 8, tc
		cbitmod 978, tc, 1
		if (flag_alien) {
			ocdata(52, tc) = 330
			flag_alien = 0
		} else {
			if (cc != 0) {
				ocdata(52, tc) = cId(cc)
				if (cId(cc) == 343) {
					ocdata(53, tc) = cCnpcId(cc) + 1
				}
			} else {
				ocdata(52, tc) = -1
			}
		}
	}
	return
*label_0817
	if (synccheck(cc, -1)) {
		txtef 8
		txt -1, lang(name(cc) + "の胃はズタズタになった。", his(cc) + " stomach is shredded.")
	}
	dmghp cc, rolemax(iDiceX(ci), iDiceY(ci), iDamageBonus(ci) + iEnhancement(ci) + (iCurseState(ci) == 1)), -16
	return
*label_0818
	tile_trap = 234
	tile_doorclosed = 726
	tile_doorclosed1 = 726
	tile_doorclosed2 = 728
	tile_doorclosed3 = 730
	tile_doorclosed4 = 733
	tile_dooropen = 236
	tile_dooropen1 = 236
	tile_dooropen2 = 241
	tile_dooropen3 = 264
	tile_dooropen4 = 265
	tile_downstairs = 231
	tile_upstairs = 232
	tile_hidden = 0
	tile_downlocked = 237
	tile_re = 238
	tile_plant = 247
	tile_board = 727
	tile_votebox = 729
	tile_townboard = 732
	dim cellobjdata, 5, 50
	maxobjid = 0
	cellobjdata(0, maxobjid) = 21, tile_doorclosed, 99, tile_doorclosed
	maxobjid++
	cellobjdata(0, maxobjid) = 21, tile_doorclosed, 99, tile_doorclosed
	maxobjid++
	cellobjdata(0, maxobjid) = 21, tile_doorclosed, 0, tile_doorclosed
	maxobjid++
	cellobjdata(0, maxobjid) = 14, tile_trap, 100, 0
	maxobjid++
	cellobjdata(0, maxobjid) = 14, tile_trap, 100, 0
	maxobjid++
	cellobjdata(0, maxobjid) = 10, tile_upstairs, 0, tile_upstairs
	maxobjid++
	cellobjdata(0, maxobjid) = 11, tile_downstairs, 0, tile_downstairs
	maxobjid++
	cellobjdata(0, maxobjid) = 21, tile_doorclosed2, 0, tile_doorclosed2
	maxobjid++
	cellobjdata(0, maxobjid) = 23, tile_board, 0, tile_board
	maxobjid++
	cellobjdata(0, maxobjid) = 31, tile_votebox, 0, tile_votebox
	maxobjid++
	cellobjdata(0, maxobjid) = 32, tile_trap, 0, 0
	maxobjid++
	cellobjdata(0, maxobjid) = 21, tile_doorclosed3, 0, tile_doorclosed3
	maxobjid++
	cellobjdata(0, maxobjid) = 33, tile_townboard, 0, tile_townboard
	maxobjid++
	cellobjdata(0, maxobjid) = 21, tile_doorclosed4, 0, tile_doorclosed4
	maxobjid++
	return



#deffunc map_converttile
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			if (map(x, y, 0) == 0) {
				map(x, y, 0) = tile_default + (rnd(tile_default(2)) == 0) * rnd(tile_default(1))
				continue
			}
			if (map(x, y, 0) >= 100) {
				map(x, y, 0) = tile_tunnel + (rnd(tile_tunnel(2)) == 0) * rnd(tile_tunnel(1))
				continue
			}
			if (map(x, y, 0) == 1) {
				map(x, y, 0) = tile_wall + (rnd(tile_wall(2)) == 0) * rnd(tile_wall(1))
				continue
			}
			if (map(x, y, 0) == 3) {
				map(x, y, 0) = tile_room + (rnd(tile_room(2)) == 0) * rnd(tile_room(1))
				continue
			}
			if (map(x, y, 0) == 4) {
				map(x, y, 0) = tile_default + (rnd(tile_default(2)) == 0) * rnd(tile_default(1))
				continue
			}
		loop
	loop
	return



#deffunc map_tileset int __www
	oomSEST_log "map_tileSet:Begin"
	tile_doorclosed = 726
	tile_dooropen = 236
	tile_trans = 999
	tile_dungeon = 133
	tile_battlesite = 134
	tile_default = 396, 1, 1
	tile_fog = 531, 1, 1
	tile_wall = 462, 1, 1
	tile_room = 13, 1, 1
	tile_board = 727
	tile_votebox = 729
	tile_townboard = 732
	tile_tunnel = 33, 1, 1
	tile_pot = 242
	tile_roomlen = 1
	if (__www == 12) {
		tile_doorclosed = 733
		tile_dooropen = 265
	}
	if (__www == 8) {
		tile_doorclosed = 728
		tile_dooropen = 241
	}
	if (__www == 9) {
		tile_doorclosed = 730
		tile_dooropen = 264
	}
	if (__www == 3) {
		tile_room = 41
		tile_tunnel = 41
		tile_wall = 469
		tile_fog = tile_wall + 66
	}
	if (__www == 2) {
		tile_wall = 462
		tile_fog = 529
	}
	if (__www == 10) {
		tile_room = 165
		tile_tunnel = 33, 4, 2
		tile_wall = 469
		tile_default = 469
	}
	if (__www == 11) {
		tile_default = 465
		tile_fog = 530
		tile_tunnel = 212
		tile_wall = 467
		tile_room = 203
	}
	if (__www == 0) {
		tile_default = 469
		tile_fog = 529
		tile_tunnel = 33, 4, 2
		tile_wall = 469
		tile_room = 33, 4, 2
	}
	if (__www == 6) {
		tile_default = 469
		tile_fog = 529
		tile_tunnel = 45, 3, 2
		tile_wall = 469
		tile_room = 33, 6, 3
	}
	if (__www == 7) {
		tile_default = 474
		tile_fog = 530
		tile_tunnel = 33 * 2 + 2
		tile_wall = 474
		tile_room = 33 * 2, 2, 2
	}
	if (__www == 300) {
		tile_default = 475
		tile_fog = 528
		tile_tunnel = 0
		tile_wall = 475
		tile_room = 0, 6, 6
	}
	if (__www == 100) {
		tile_default = 472
		tile_fog = 530
		tile_tunnel = 33 * 3 + 4
		tile_wall = 473
		tile_room = 33 * 4, 3, 2
	}
	if (__www == 101) {
		tile_default = 477
		tile_fog = 530
		tile_tunnel = 33 * 3 + 1
		tile_wall = 477
		tile_room = 33 * 3
	}
	if (__www == 200) {
		tile_default = 468
		tile_fog = 531
		tile_tunnel = 33, 4, 2
		tile_wall = 462
		tile_room = 119, 4, 2
	}
	if (__www == 1) {
		tile_wall = -1
		tile_fog = 396, 4, 2
	}
	if (__www == 4) {
		tile_default = 0
		tile_fog = 528
		if (4 <= gdata(62) & gdata(62) < 9) {
			tile_default = 7
			tile_fog = 528
		}
		if (264 <= gdata(62) & gdata(62) < 363) {
			tile_default = 12
		}
		if (9 <= gdata(62) & gdata(62) < 13) {
			tile_fog = 528
			tile_default = 3
		}
		if (13 <= gdata(62) & gdata(62) < 17) {
			tile_fog = 531
			tile_default = 19
		}
		if (chipm(0, gdata(62)) == 4) {
			tile_fog = 532
			tile_default = 45
		}
	}
	if (gCurrentMap == areaId_carlia) {
		tile_default = 529
		tile_wall = 469
		tile_fog = 529
	}
	// 古代の遺跡
	if (gCurrentMap == 57) {
		tile_default = 487
		tile_wall = 469
		tile_fog = 529
	}
	oomSEST_log "map_tileSet:End"
	return

#defcfunc dist_town
	p@m165 = 1000
	repeat mapHeight
		y@m165 = cnt
		repeat mapWidth
			x@m165 = cnt
			cell_featread x@m165, y@m165
			if (areaType(feat(2)) == 3 | (areaId(gCurrentMap) == 47 & areaType(feat(2)) == 5)) {
				i@m165 = dist(cX(0), cY(0), x@m165, y@m165)
				if (i@m165 < p@m165) {
					p@m165 = i@m165
				}
			}
		loop
	loop
	return p@m165

#deffunc map_reload str __yyy
	fmapfile = exedir + "map\\" + __yyy
	ctrlFile 16
	repeat mapHeight
		y@m166 = cnt
		repeat mapWidth
			map(cnt, y@m166, 8) = 0
			map(cnt, y@m166, 9) = 0
		loop
	loop
	repeat 200
		mef(0, cnt) = 0
	loop
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) > 0) {
			if (iOwnState(cnt) == 1) {
				if (refitem(iId(cnt), 5, cnt) == 57000) {
					iNumber(cnt) = 0
					cell_refresh iX(cnt), iY(cnt)
				}
			}
		}
	loop
	repeat 400
		if (cmapdata(0, cnt) == 0) {
			continue
		}
		x@m166 = cmapdata(1, cnt)
		y@m166 = cmapdata(2, cnt)
		if (cmapdata(4, cnt) == 0) {
			if (map(x@m166, y@m166, 4) == 0) {
				flt
				itemcreate -1, cmapdata(0, cnt), x@m166, y@m166, 0
				if (stat != 0) {
					iOwnState(ci) = cmapdata(3, cnt)
				}
			}
			cell_refresh x@m166, y@m166
		}
	loop
	oomSEST_log "map_reload:End"
	return
*label_0825



#deffunc map_initialize
	if (rdroomnum >= 30) {
		rdroomnum = 30
	}
	repeat 30
		roomexist(cnt) = 0
	loop
	dim map, mapWidth, mapHeight, 10
	dim mapsync, mapWidth, mapHeight
	dim mef, 9, 200
	dim mapinv, mapWidth, mapHeight
	dim oommap, mapWidth, mapHeight, 20
	map_tileset mapTileType
	oomSEST_log "map_initialize:end"
	return



#deffunc map_placecharaonentrance int __zzz, int __aaa, int __bbb
	if (__aaa == 1) {
		x@m167 = mapUpstairs \ 1000
		if (__bbb != 0) {
			x@m167 += rnd(__bbb) - rnd(__bbb)
		}
		y@m167 = mapUpstairs / 1000
		if (__bbb != 0) {
			y@m167 += rnd(__bbb) - rnd(__bbb)
		}
	}
	if (__aaa == 2) {
		x@m167 = mapDownstairs \ 1000
		if (__bbb != 0) {
			x@m167 += rnd(__bbb) - rnd(__bbb)
		}
		y@m167 = mapDownstairs / 1000
		if (__bbb != 0) {
			y@m167 += rnd(__bbb) - rnd(__bbb)
		}
	}
	if (__aaa == 3) {
		if (gdata(35) == 1) {
			x@m167 = mapWidth - 2
			y@m167 = mapHeight / 2
			if (gCurrentMap == 15) {
				y@m167 = 22
			}
			if (gCurrentMap == 36) {
				x@m167 = 58
				y@m167 = 21
			}
			if (gCurrentMap == areaId_serria) {
				y@m167 = 21
			}
			if (gCurrentMap == areaId_tormat) {
				x@m167 = 45
				y@m167 = 45
			}
		}
		if (gdata(35) == 2) {
			x@m167 = 1
			y@m167 = mapHeight / 2
			if (gCurrentMap == 33) {
				y@m167 = 3
			}
			if (gCurrentMap == 36) {
				x@m167 = 25
				y@m167 = 1
			}
		}
		if (gdata(35) == 3) {
			x@m167 = mapWidth / 2
			y@m167 = mapHeight - 2
			if (gCurrentMap == 15) {
				x@m167 = 30
			}
			if (gCurrentMap == 33) {
				x@m167 = 28
			}
			if (gCurrentMap == 36) {
				x@m167 = 58
				y@m167 = 21
			}
			if (gCurrentMap == areaId_serria) {
				x@m167 = 21
			}
		}
		if (gdata(35) == 0) {
			x@m167 = mapWidth / 2
			y@m167 = 1
			if (gCurrentMap == 33) {
				x@m167 = 5
			}
			if (gCurrentMap == 36) {
				x@m167 = 25
				y@m167 = 1
			}
			if (gCurrentMap == areaId_tormat) {
				x@m167 = 18
				y@m167 = 0
			}
		}
		if (gCurrentMap == 25) {
			x@m167 = 1
			y@m167 = 14
		}
		if (gdata(60) != (-1)) {
			x@m167 = gdata(60)
			y@m167 = gdata(61)
		}
	}
	if (__aaa == 4) {
		x@m167 = mapWidth / 2
		y@m167 = mapHeight / 2
	}
	if (__aaa == 8) {
		x@m167 = mapWidth / 2
		y@m167 = mapHeight - 2
		if (gCurrentMap == areaId_trian) {
			x@m167 = 18
		}
		if (gCurrentMap == areaId_carlia) {
			x@m167 = 26
			y@m167 = 10
		}
	}
	if (__aaa == 5) {
		x@m167 = rnd(mapWidth - 5) + 2
		y@m167 = rnd(mapHeight - 5) + 2
	}
	if (__aaa == 6) {
		x@m167 = gPcXInWorldMap + rnd(cnt / 5 + 1)
		y@m167 = gPcYInWorldMap + rnd(cnt / 5 + 1)
	}
	if (__aaa == 7) {
		x@m167 = mapstartx
		y@m167 = mapstarty
	}
	cxinit = x@m167
	cyinit = y@m167
	rc = __zzz
	place_chara rc, cxinit, cyinit
	return
*label_0828



#deffunc map_placearena int __ccc, int __ddd
	repeat
		await
		x = rnd(7) + 5
		y = rnd(6) + 6
		if (__ddd == 0) {
			x += 8
		}
		cxinit = x
		cyinit = y
		rc = __ccc
		place_chara rc, cxinit, cyinit
		if (__ddd == 0) {
			if (cX(__ccc) >= 13 & cY(__ccc) >= 6 & cX(__ccc) < 20 & cY(__ccc) < 12) {
				break
			}
		} else {
			if (cX(__ccc) >= 5 & cY(__ccc) >= 6 & cX(__ccc) < 12 & cY(__ccc) < 12) {
				break
			}
		}
		map(cX(__ccc), cY(__ccc), 1) = 0
	loop
	return



#deffunc map_placeplayer
	if (mode == 11) {
		return
	}
	camera = 0
	repeat 16
		if (cState(cnt) != 1) {
			continue
		}
		if (cnt != 0) {
			if (gMount == cnt) {
				cX(gMount) = cX(0)
				cY(gMount) = cY(0)
				continue
			} else {
				if (ocdata(107, cnt) != 0) {
					continue
				}
			}
		}
		if (gCurrentMap == 40) {
			if (followerin(cnt) == 1) {
				if (camera == 0) {
					camera = cnt
				}
				map_placearena cnt, 0
				continue
			}
		}
		if (gCurrentMap == 49) {
			if (followerin(cnt) == 1) {
				if (camera == 0) {
					camera = cnt
				}
				cxinit = 1
				cyinit = 6
				place_chara cnt, cxinit, cyinit
				cNextX(cnt) = cxinit
				cNextY(cnt) = cyinit
				continue
			}
		}
		if (cCurrentMap(cnt) == gCurrentMap) {
			if (cnt != 0) {
				cxinit = cInitialX(cnt)
				cyinit = cInitialY(cnt)
				rc = cnt
				place_chara rc, cxinit, cyinit
				continue
			}
		}
		map_placecharaonentrance cnt, gEntranceType
	loop
	repeat 15, 1
		if (cState(cnt) != 1) {
			continue
		}
		if (ocdata(107, cnt) != 0) {
			cX(cnt) = cX(ocdata(107, cnt))
			cY(cnt) = cY(ocdata(107, cnt))
			continue
		}
	loop
	return



#deffunc map_randomtile int __eee, int __fff
	repeat mapWidth * mapHeight * __fff / 100 + 1
		map(rnd(mapWidth), rnd(mapHeight), 0) = __eee
	loop
	return



#defcfunc map_digcheck int __qqq, int __rrr
	if (__qqq < 1 | __rrr < 1 | __qqq > mapWidth - 2 | __rrr > mapHeight - 2) {
		return 0
	}
	if (map(__qqq, __rrr, 0) == 100) {
		return 100
	}
	return map(__qqq, __rrr, 0) == 0



#deffunc map_nextdir1 int __sss, int __ttt
	if (tx@m168 >= __sss - 4 & tx@m168 <= __sss + 4) {
		if (ty@m168 >= __ttt - 4 & ty@m168 <= __ttt + 4) {
			if (tx@m168 < __sss) {
				dir@m168 = 2
				if (ty@m168 > __ttt) {
					dest@m168 = 3
				} else {
					dest@m168 = 0
				}
			}
			if (tx@m168 > __sss) {
				dir@m168 = 1
				if (ty@m168 > __ttt) {
					dest@m168 = 3
				} else {
					dest@m168 = 0
				}
			}
			if (ty@m168 < __ttt) {
				dir@m168 = 0
				if (tx@m168 > __sss) {
					dest@m168 = 1
				} else {
					dest@m168 = 2
				}
			}
			if (ty@m168 > __ttt) {
				dir@m168 = 3
				if (tx@m168 > __sss) {
					dest@m168 = 1
				} else {
					dest@m168 = 2
				}
			}
			return
		}
	}
	if (dir@m168 == 1 | dir@m168 == 2) {
		if (ty@m168 > __ttt) {
			dir@m168 = 3
		} else {
			dir@m168 = 0
		}
		if (tx@m168 > __sss) {
			dest@m168 = 1
		} else {
			dest@m168 = 2
		}
		return
	}
	if (dir@m168 == 3 | dir@m168 == 0) {
		if (tx@m168 > __sss) {
			dir@m168 = 1
		} else {
			dir@m168 = 2
		}
		if (ty@m168 > __ttt) {
			dest@m168 = 3
		} else {
			dest@m168 = 0
		}
		return
	}



#deffunc map_nextdir2 int __uuu, int __vvv
	if (dir2@m168 != (-1)) {
		if (dir2@m168 == 1) {
			if (map_digcheck(tx@m168 - 1, ty@m168)) {
				if (tx@m168 == __uuu) {
					p@m168 = dir2@m168
					dir2@m168 = dir@m168
					dir@m168 = p@m168
				} else {
					dir@m168 = dir2@m168
					dir2@m168 = -1
				}
			}
		}
		if (dir2@m168 == 2) {
			if (map_digcheck(tx@m168 + 1, ty@m168)) {
				if (tx@m168 == __uuu) {
					p@m168 = dir2@m168
					dir2@m168 = dir@m168
					dir@m168 = p@m168
				} else {
					dir@m168 = dir2@m168
					dir2@m168 = -1
				}
			}
		}
		if (dir2@m168 == 3) {
			if (map_digcheck(tx@m168, ty@m168 - 1)) {
				if (ty@m168 == __vvv) {
					p@m168 = dir2@m168
					dir2@m168 = dir@m168
					dir@m168 = p@m168
				} else {
					dir@m168 = dir2@m168
					dir2@m168 = -1
				}
			}
		}
		if (dir2@m168 == 0) {
			if (map_digcheck(tx@m168, ty@m168 + 1)) {
				if (ty@m168 == __vvv) {
					p@m168 = dir2@m168
					dir2@m168 = dir@m168
					dir@m168 = p@m168
				} else {
					dir@m168 = dir2@m168
					dir2@m168 = -1
				}
			}
		}
	}
	if (dir@m168 == 1 | dir@m168 == 2) {
		if (tx@m168 == __uuu) {
			if (ty@m168 > __vvv) {
				if (map_digcheck(tx@m168, ty@m168 - 1)) {
					dir2@m168 = dir@m168
					dir@m168 = 3
				}
			}
			if (ty@m168 < __vvv) {
				if (map_digcheck(tx@m168, ty@m168 + 1)) {
					dir2@m168 = dir@m168
					dir@m168 = 0
				}
			}
		}
		return
	}
	if (dir@m168 == 3 | dir@m168 == 0) {
		if (ty@m168 == __vvv) {
			if (tx@m168 > __uuu) {
				if (map_digcheck(tx@m168 - 1, ty@m168)) {
					dir2@m168 = dir@m168
					dir@m168 = 1
				}
			}
			if (tx@m168 < __uuu) {
				if (map_digcheck(tx@m168 + 1, ty@m168)) {
					dir2@m168 = dir@m168
					dir@m168 = 2
				}
			}
		}
		return
	}



#deffunc map_digtoentrance1 int __www, int __xxx, int __yyy, int __zzz, int __aaa
	tx@m168 = __www
	ty@m168 = __xxx
	dest@m168 = -1
	f@m168 = 0
	if (__aaa == 1) {
		dir2@m168 = -1
		map_nextdir1 __yyy, __zzz
	}
	repeat 2000
		if (tx@m168 == __yyy) {
			if (ty@m168 + 1 == __zzz | ty@m168 - 1 == __zzz) {
				f@m168 = 1
				break
			}
		}
		if (ty@m168 == __zzz) {
			if (tx@m168 + 1 == __yyy | tx@m168 - 1 == __yyy) {
				f@m168 = 1
				break
			}
		}
		if (__aaa == 1) {
			map_nextdir2 __yyy, __zzz
		}
		dx@m168 = tx@m168
		dy@m168 = ty@m168
		if (dir@m168 == 1) {
			dx@m168--
		}
		if (dir@m168 == 2) {
			dx@m168++
		}
		if (dir@m168 == 3) {
			dy@m168--
		}
		if (dir@m168 == 0) {
			dy@m168++
		}
		if (map_digcheck(dx@m168, dy@m168)) {
			tx@m168 = dx@m168
			ty@m168 = dy@m168
			map(dx@m168, dy@m168, 0) = 100
			if (rnd(200) < rdhiddenpath) {
				map(dx@m168, dy@m168, 0) = 4
				cell_featset dx@m168, dy@m168, 0, 22
			}
			if (__aaa == 0) {
				if (rnd(4) == 0) {
					map_nextdir1 __yyy, __zzz
				}
			}
		} else {
			if (dest@m168 == 1) {
				if (map_digcheck(tx@m168 - 1, ty@m168)) {
					dir@m168 = 1
					dest@m168 = -2
				}
			}
			if (dest@m168 == 2) {
				if (map_digcheck(tx@m168 + 1, ty@m168)) {
					dir@m168 = 2
					dest@m168 = -2
				}
			}
			if (dest@m168 == 3) {
				if (map_digcheck(tx@m168, ty@m168 - 1)) {
					dir@m168 = 3
					dest@m168 = -2
				}
			}
			if (dest@m168 == 0) {
				if (map_digcheck(tx@m168, ty@m168 + 1)) {
					dir@m168 = 0
					dest@m168 = -2
				}
			}
			if (dest@m168 == (-2)) {
				dest@m168 = -1
				continue
			}
			if (__aaa == 0) {
				map_nextdir1 __yyy, __zzz
			}
			if (__aaa == 1) {
				map_nextdir1 __yyy, __zzz
			}
		}
	loop
	return f@m168



#deffunc map_setfog int, int
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			map(x, y, 2) = tile_fog + (rnd(tile_fog(2)) == 0) * rnd(tile_fog(1))
		loop
	loop
	return



#deffunc map_createroomdoor
	if (rdpos == 3 | rdpos == 0) {
		p = roomwidth(cr)
	} else {
		p = roomheight(cr)
	}
	dim rddoorpos
	repeat p - 2
		rddoorpos(cnt) = cnt
	loop
	rndshuffle rddoorpos
	repeat p - 2
		if (rdpos == 3) {
			x = rddoorpos(cnt) + roomx(cr) + 1
			y = roomy(cr) + roomheight(cr) - 1
			p = 0, 0, -1, 1
		}
		if (rdpos == 0) {
			x = rddoorpos(cnt) + roomx(cr) + 1
			y = roomy(cr)
			p = 0, 0, -1, 1
		}
		if (rdpos == 1) {
			y = rddoorpos(cnt) + roomy(cr) + 1
			x = roomx(cr) + roomwidth(cr) - 1
			p = -1, 1, 0, 0
		}
		if (rdpos == 2) {
			y = rddoorpos(cnt) + roomy(cr) + 1
			x = roomx(cr)
			p = -1, 1, 0, 0
		}
		f = 1
		repeat 2
			dx = x + p(cnt)
			dy = y + p(cnt + 2)
			if ((dx >= 0 & dy >= 0 & dx < mapWidth & dy < mapHeight) == 0) {
				f = 0
				break
			}
			if (map(dx, dy, 0) == 1) {
				f = 0
				break
			}
		loop
		if (f == 1) {
			map(x, y, 0) = 3
			if (roomdoor != 3) {
				if (oabit(18, gCurrentMap) == 0) {
					cell_featset x, y, tile_doorclosed, 21, rnd(abs(gCurrentDungeonLevel * 3 / 2) + 1)
				} else {
					p = tile
					map(x, y, 0) = p
					map(x, y, 2) = p
				}
			}
			break
		}
	loop
	return



#deffunc map_createroom int __ddd
	if (roomsum >= 30) {
		return 0
	}
	if (__ddd == 0) {
		roompos = 0
		roomwall = 0
		roomdoor = 0
	}
	if (__ddd == 1) {
		roompos = 1
		roomwall = 1
		roomdoor = 0
	}
	if (__ddd == 2) {
		roompos = 2
		roomwall = 1
		roomdoor = 1
	}
	if (__ddd == 3) {
		roompos = 3
		roomwall = 2
		roomdoor = 3
	}
	if (__ddd == 4) {
		roompos = 4
		roomwall = 3
		roomdoor = 0
	}
	cr = roomsum
	f = 0
	repeat 100
		if (roompos == 0) {
			roomwidth(cr) = rnd(rdroomsizemax) + rdroomsizemin
			roomheight(cr) = rnd(rdroomsizemax) + rdroomsizemin
			roomx(cr) = rnd(mapWidth) + 2
			roomy(cr) = rnd(mapHeight) + 2
		}
		if (roompos == 1) {
			roomwidth(cr) = (rnd(rdroomsizemax) + rdroomsizemin) / 3 * 3 + 5
			roomheight(cr) = (rnd(rdroomsizemax) + rdroomsizemin) / 3 * 3 + 5
			roomx(cr) = rnd(mapWidth) / 3 * 3 + 2
			roomy(cr) = rnd(mapHeight) / 3 * 3 + 2
		}
		if (roompos == 2) {
			rdpos = rnd(4)
			if (rdpos == 3 | rdpos == 0) {
				roomx(cr) = rnd(mapWidth - rdroomsizemin * 3 / 2 - 2) + rdroomsizemin / 2
				roomwidth(cr) = rnd(rdroomsizemin) + rdroomsizemin / 2 + 3
				roomheight(cr) = rdroomsizemin
				if (rdpos == 3) {
					roomy(cr) = 0
				} else {
					roomy(cr) = mapHeight - roomheight(cr)
				}
			}
			if (rdpos == 1 | rdpos == 2) {
				roomy(cr) = rnd(mapHeight - rdroomsizemin * 3 / 2 - 2) + rdroomsizemin / 2
				roomwidth(cr) = rdroomsizemin
				roomheight(cr) = rnd(rdroomsizemin) + rdroomsizemin / 2 + 3
				if (rdpos == 1) {
					roomx(cr) = 0
				} else {
					roomx(cr) = mapWidth - roomwidth(cr)
				}
			}
		}
		if (roompos == 3) {
			roomwidth(cr) = 3
			roomheight(cr) = 3
			x = mapWidth - rdroomsizemin * 2 - roomwidth(cr) - 2 + 1
			if (x < 1) {
				break
			}
			y = mapHeight - rdroomsizemin * 2 - roomheight(cr) - 2 + 1
			if (y < 1) {
				break
			}
			roomx(cr) = rdroomsizemin + 1 + rnd(x)
			roomy(cr) = rdroomsizemin + 1 + rnd(y)
		}
		if (roompos == 4) {
			roomwidth(cr) = rnd(rdroomsizemax) + rdroomsizemin
			roomheight(cr) = rnd(rdroomsizemax) + rdroomsizemin
			if (ogdata(33) == 0) {
				roomx(cr) = rnd(mapWidth - rdroomsizemax - 8) + 3
				roomy(cr) = rnd(mapHeight - rdroomsizemax - 8) + 3
			}
			if (ogdata(33) == 1) {
				roomx(cr) = rnd(mapWidth - rdroomsizemax - 10) + 3
				roomy(cr) = rnd(mapHeight - rdroomsizemax - 10) + 3
			}
		}
		x = roomx(cr) + roomwidth(cr) - 1
		y = roomy(cr) + roomheight(cr) - 1
		if (x >= mapWidth) {
			continue
		}
		if (y >= mapHeight) {
			continue
		}
		if (roompos == 1) {
			if (x + 1 >= mapWidth) {
				continue
			}
			if (y + 1 >= mapHeight) {
				continue
			}
		}
		if (roompos == 0) {
			if (map(x, y, 0) != 3) {
				continue
			}
		}
		p = 0
*label_0844
		exgoto p, 1, roomsum, *label_0846
		if (p == cr) {
			goto *label_0845
		}
		x1 = roomx(p) - 1 - roomx(cr)
		x2 = -roomwidth(p) - 2 < x1 & x1 < roomwidth(cr)
		y1 = roomy(p) - 1 - roomy(cr)
		y2 = -roomheight(p) - 2 < y1 & y1 < roomheight(cr)
		if (x2 & y2) {
			continue
		}
*label_0845
		p += 1
		goto *label_0844
*label_0846
		roomsum++
		f = 1
		break
	loop
	if (f == 0) {
		return 0
	}
	if (rnd(2) == 0) {
		tile(1) = 1 + rnd(2)
	} else {
		tile(1) = 0
	}
	if (rnd(2) == 0) {
		tile(2) = 1 + rnd(2)
	} else {
		tile(2) = 0
	}
	repeat roomheight(cr)
		y = roomy(cr) + cnt
		cnt2 = cnt
		repeat roomwidth(cr)
			x = roomx(cr) + cnt
			tile = 3
			if (roomwall != 0) {
				if (cnt == 0 | cnt2 == 0 | cnt == roomwidth(cr) - 1 | cnt2 == roomheight(cr) - 1) {
					if (roomwall == 1) {
						tile = 1
					}
					if (roomwall == 2) {
						tile = 4
					}
					if (roomwall == 3) {
						tile = 3
						if (tile(1) == 1) {
							if (cnt == 0) {
								tile = 1
							}
						}
						if (tile(2) == 1) {
							if (cnt2 == 0) {
								if (cnt != 0 & cnt != roomwidth(cr) - 1) {
									if (rnd(3)) {
										flt
										p = 296, 300, 312, 604
										itemcreate -1, p(rnd(4)), x, y + 1, 0
									} else {
										if (cnt \ 2 == 1) {
											flt
											itemcreate -1, 584, x, y + 1, 0
										}
									}
								}
								tile = 1
							}
						}
						if (tile(1) == 2) {
							if (cnt == roomwidth(cr) - 1) {
								tile = 1
							}
						}
						if (tile(2) == 2) {
							if (cnt2 == roomheight(cr) - 1) {
								if (rnd(3)) {
									flt
									p = 296, 300, 312, 604
									itemcreate -1, p(rnd(4)), x, y + 1, 0
								} else {
									if (cnt \ 2 == 1) {
										flt
										itemcreate -1, 584, x, y + 1, 0
									}
								}
								tile = 1
							}
						}
					}
				}
			}
			map(x, y, 0) = tile
		loop
	loop
	if (roomdoor == 1) {
		map_createroomdoor
	}
	if (roomdoor == 2 | roomdoor == 3) {
		repeat 4
			rdpos = cnt
			map_createroomdoor
		loop
	}
	return 1



#deffunc map_placeupstairs int __eee, int __fff
	if (__eee == 0) {
		x@m169 = rnd(roomwidth(cr) - 2) + roomx(cr) + 1
		y@m169 = rnd(roomheight(cr) - 2) + roomy(cr) + 1
	} else {
		x@m169 = __eee
		y@m169 = __fff
	}
	cell_featset x@m169, y@m169, tile_upstairs, 10
	mapUpstairs = y@m169 * 1000 + x@m169
	rdroomupstair = cr
	return 1



#deffunc map_placedownstairs int __ggg, int __hhh
	if (gCurrentDungeonLevel >= areaLastFloor(gCurrentMap)) {
		return
	}
	if (__ggg == 0) {
		x@m169 = rnd(roomwidth(cr) - 2) + roomx(cr) + 1
		y@m169 = rnd(roomheight(cr) - 2) + roomy(cr) + 1
	} else {
		x@m169 = __ggg
		y@m169 = __hhh
	}
	cell_featset x@m169, y@m169, tile_downstairs, 11
	mapDownstairs = y@m169 * 1000 + x@m169
	rdroomdownstair = cr
	return 1



#deffunc map_randsite int __iii, int __jjj
	f@m169 = 0
	repeat 20
		if (__iii == 0) {
			x@m169 = rnd(mapWidth - 5) + 2
			y@m169 = rnd(mapHeight - 5) + 2
		} else {
			x@m169 = __iii
			y@m169 = __jjj
		}
		if ((chipm(7, map(x@m169, y@m169, 0)) & 4) == 0) {
			if (map(x@m169, y@m169, 6) == 0 & map(x@m169, y@m169, 4) == 0) {
				f@m169 = 1
				break
			}
		}
	loop
	if (mapType == 1) {
		if (264 <= map(x@m169, y@m169, 0) & map(x@m169, y@m169, 0) < 363 | (33 <= map(x@m169, y@m169, 0) & map(x@m169, y@m169, 0) < 66)) {
			f@m169 = 0
		}
	}
	if (f@m169 == 0) {
		return
	}
	if (mapType >= 20 & mapType <= 23) {
		if (mapTimeOfNextRegeneration == 0) {
			if (rnd(25) == 0) {
				flt
				itemcreate -1, 173, x@m169, y@m169, 0
				iOwnState(ci) = 1
				return
			}
			if (rnd(100) == 0) {
				flt
				itemcreate -1, 172, x@m169, y@m169, 0
				iOwnState(ci) = 1
				setgod ci
				return
			}
		}
	}
	if (mapType >= 20 & mapType <= 23) {
		if (rnd(14) == 0) {
			cell_featset x@m169, y@m169, 243, 27
			return
		}
		if (rnd(13) == 0) {
			cell_featset x@m169, y@m169, 244, 25
			return
		}
		if (rnd(12) == 0) {
			cell_featset x@m169, y@m169, 245, 26
			return
		}
		if (rnd(11) == 0) {
			cell_featset x@m169, y@m169, 246, 28
			return
		}
		cell_featset x@m169, y@m169, tile_re + rnd(3), 24
		return
	}
	if (mapType == 3 | mapType == 2) {
		if (gCurrentDungeonLevel != 3) {
			if (rnd(3) == 0) {
				flt
				itemcreate -1, 631, x@m169, y@m169, 0
				return
			}
			if (rnd(15) == 0) {
				flt
				itemcreate -1, 55, x@m169, y@m169, 0
				return
			}
			if (rnd(20) == 0) {
				flt
				itemcreate -1, 284, x@m169, y@m169, 0
				return
			}
			if (rnd(15) == 0) {
				flt
				itemcreate -1, 283, x@m169, y@m169, 0
				return
			}
			if (rnd(18) == 0) {
				flt calcobjlv(rnd(difficulty() + 10)), calcfixlv(3)
				flttypemajor = fsetwear(rnd(length(fsetwear)))
				itemcreate -1, 0, x@m169, y@m169, 0
				return
			}
			flt 10
			flttypeminor = 64100
			itemcreate -1, 0, x@m169, y@m169, 0
		}
		return
	}
	if (mapType == 4) {
	}
	return



#deffunc map_trap int __kkk, int __lll, int, int __nnn
	dx@m170 = __kkk
	dy@m170 = __lll
	p@m170 = 0
*label_0852
	exgoto p@m170, 1, 3, *label_0853
	if (__kkk == 0) {
		dx@m170 = rnd(mapWidth - 5) + 2
		dy@m170 = rnd(mapHeight - 5) + 2
	} else {
		dx@m170 = __kkk
		dy@m170 = __lll
	}
	if ((chipm(7, map(dx@m170, dy@m170, 0)) & 4) == 0) {
		if (map(dx@m170, dy@m170, 6) == 0) {
			if (__nnn == 0) {
				trap@m170 = rnd(8)
			} else {
				trap@m170 = __nnn
			}
			if (gCurrentDungeonLevel <= 5) {
				if (trap@m170 == 6) {
					return 0
				}
				if (trap@m170 == 1) {
					return 0
				}
				if (trap@m170 == 5) {
					return 0
				}
			}
			if (gCurrentDungeonLevel <= 25) {
				if (trap@m170 == 7) {
					return 0
				}
			}
			cell_featset dx@m170, dy@m170, 0, 14, trap@m170
			return 1
		}
	}
	p@m170 += 1
	goto *label_0852
*label_0853
	return 0



#deffunc map_web int __ooo, int __ppp, int __qqq
	dx@m170 = __ooo
	dy@m170 = __ppp
	p@m170 = 0
*label_0855
	exgoto p@m170, 1, 3, *label_0856
	if (__ooo == 0) {
		dx@m170 = rnd(mapWidth - 5) + 2
		dy@m170 = rnd(mapHeight - 5) + 2
	} else {
		dx@m170 = __ooo
		dy@m170 = __ppp
	}
	if ((chipm(7, map(dx@m170, dy@m170, 0)) & 4) == 0) {
		if (map(dx@m170, dy@m170, 6) == 0) {
			addmef dx@m170, dy@m170, 1, 11, -1, __qqq
			return 1
		}
	}
	p@m170 += 1
	goto *label_0855
*label_0856
	return 0



#deffunc map_barrel int __rrr, int __sss
	dx@m170 = __rrr
	dy@m170 = __sss
	p@m170 = 0
*label_0858
	exgoto p@m170, 1, 3, *label_0859
	if (__rrr == 0) {
		dx@m170 = rnd(mapWidth - 5) + 2
		dy@m170 = rnd(mapHeight - 5) + 2
	} else {
		dx@m170 = __rrr
		dy@m170 = __sss
	}
	if ((chipm(7, map(dx@m170, dy@m170, 0)) & 4) == 0) {
		if (map(dx@m170, dy@m170, 6) == 0) {
			cell_featset dx@m170, dy@m170, tile_pot, 30
			return 1
		}
	}
	p@m170 += 1
	goto *label_0858
*label_0859
	return 0



#deffunc map_medal int __ttt, int __uuu
	dx@m0 = __ttt
	dy@m0 = __uuu
	p@m0 = 0
*label_0861
	exgoto p@m0, 1, 3, *label_0862
	if (__ttt == 0) {
		dx@m0 = rnd(mapWidth - 5) + 2
		dy@m0 = rnd(mapHeight - 5) + 2
	} else {
		dx@m0 = __ttt
		dy@m0 = __uuu
	}
	if ((chipm(7, map(dx@m0, dy@m0, 0)) & 4) == 0) {
		if (map(dx@m0, dy@m0, 6) == 0) {
			cell_featset dx@m0, dy@m0, tile_hidden, 32
			return 1
		}
	}
	p@m0 += 1
	goto *label_0861
*label_0862
	return 0
*label_0863

#deffunc map_zirai int __ttt, int __uuu
	dx@m0 = __ttt
	dy@m0 = __uuu
	p@m0 = 0
*label_N700
	exgoto p@m0, 1, 3, *label_0862
	if (__ttt == 0) {
		dx@m0 = rnd(mapWidth - 5) + 2
		dy@m0 = rnd(mapHeight - 5) + 2
	} else {
		dx@m0 = __ttt
		dy@m0 = __uuu
	}
	cell_featread dx@m0, dy@m0
	if (feat(1) == 10 | feat(1) == 11) {
		return
	}
	cell_featset dx@m0, dy@m0, 0, 14, 7
	return

#deffunc map_connectroom
	cr = 0
*label_0865
	exgoto cr, 1, roomsum - 1, *label_0866
	p = cr + 1
	repeat rnd(rdroomentrance + 1) + 1
		repeat 2
			if (cnt == 0) {
				p = cr
			} else {
				p = cr + 1
			}
			dir = rnd(4)
			x = dirxy(0, dir)
			y = dirxy(1, dir)
			if (dir == 1) {
				dx = roomx(p)
				dy = roomy(p) + rnd(roomheight(p) - 2) + 1
			}
			if (dir == 2) {
				dx = roomx(p) + roomwidth(p) - 1
				dy = roomy(p) + rnd(roomheight(p) - 2) + 1
			}
			if (dir == 3) {
				dx = roomx(p) + rnd(roomwidth(p) - 2) + 1
				dy = roomy(p)
			}
			if (dir == 0) {
				dx = roomx(p) + rnd(roomwidth(p) - 2) + 1
				dy = roomy(p) + roomheight(p) - 1
			}
			if (x != 0) {
				if (map(dx, dy - 1, 0) == 3 | map(dx, dy + 1, 0) == 3) {
					continue cnt
				}
			}
			if (y != 0) {
				if (map(dx - 1, dy, 0) == 3 | map(dx + 1, dy, 0) == 3) {
					continue cnt
				}
			}
			map(dx, dy, 0) = 3
			roomexist(p) = 1
			dx += x
			dy += y
			roomentrancex(p) = dx
			roomentrancey(p) = dy
			map(dx, dy, 0) = 100
			if (cnt == 0) {
				tx = dx
				ty = dy
			}
		loop
		map_digtoentrance1 tx, ty, dx, dy, 1
	loop
	if (stat == 0) {
		roomexist(cr) = 0
		roomexist(p) = 0
		return 0
	}
	cr += 1
	goto *label_0865
*label_0866
	return 1



#deffunc map_makedoor
	cr = 0
*label_0868
	exgoto cr, 1, roomsum, *label_0869
	tx = 0
	ty = 0
	repeat roomheight(cr) * 2 + roomwidth(cr) * 2
		if (tx == 0) {
			if (cnt != 0) {
				ty--
			}
		}
		if (ty == roomheight(cr) - 1) {
			tx--
		}
		if (tx == roomwidth(cr) - 1) {
			ty++
		}
		if (ty == 0) {
			tx++
		}
		dx = tx + roomx(cr)
		dy = ty + roomy(cr)
		if (map(dx, dy, 0) == 1) {
			continue
		}
		cell_featset dx, dy, tile_doorclosed, 21, rnd(abs(gCurrentDungeonLevel * 3 / 2) + 1)
	loop
	cr += 1
	goto *label_0868
*label_0869
	return
	if (rdroomdoor >= rnd(100)) {
		p = 0
		repeat 3
			jy = cnt
			repeat 3
				jx = cnt
				if ((jx >= 0 & jy >= 0 & jx < mapWidth & jy < mapHeight) == 0) {
					continue
				}
				if (map(jx, jy, 0) != tile_wall) {
					p++
				}
				if (p < 2) {
				}
			loop
		loop
	}
	return
	p = 0
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) > 0) {
			p++
		}
	loop
	rtval = (p * 10 - 1) / 400
	return
*label_0898
	randomize
	rdtry++
	mdata(15) = 0
	mapWidth = 34 + rnd(15)
	mapHeight = 22 + rnd(15)
	mapDensity = mapWidth * mapHeight / 100
	roomsum = 0
	rdroomnum = mapWidth * mapHeight / 70
	rdroomsizemin = 3
	rdroomsizemax = 4
	rdroomdoor = 80
	rdroomentrance = 1
	rdhiddenpath = 20
	rdval(2) = 2
	rdtunnel = mapWidth * mapHeight
	rdextraroom = 10
	rdtype = 1
	if (oabit(10, gCurrentMap) == 0) {
		if (rnd(30) == 0) {
			rdtype = 3
		}
	}
	if (areaType(gCurrentMap) == 20) {
		rdtype = 2
		if (rnd(4) == 0) {
			rdtype = 1
		}
		if (rnd(6) == 0) {
			rdtype = 10
		}
		if (rnd(10) == 0) {
			rdtype = 4
		}
		if (rnd(25) == 0) {
			rdtype = 8
		}
		if (rnd(20) == 0) {
			mapTileType = 10
		}
	}
	if (areaType(gCurrentMap) == 22) {
		rdtype = 2
		if (rnd(6) == 0) {
			rdtype = 1
		}
		if (rnd(6) == 0) {
			rdtype = 10
		}
		if (rnd(25) == 0) {
			rdtype = 8
		}
		if (rnd(20) == 0) {
			rdtype = 4
		}
	}
	if (areaType(gCurrentMap) == 21) {
		rdtype = 1
		if (rnd(5) == 0) {
			rdtype = 4
		}
		if (oabit(10, gCurrentMap) == 0) {
			if (rnd(10) == 0) {
				rdtype = 3
			}
		}
		if (rnd(25) == 0) {
			rdtype = 2
		}
		if (rnd(40) == 0) {
			mapTileType = 10
		}
	}
	if (areaType(gCurrentMap) == 23) {
		rdtype = 1
		if (rnd(5) == 0) {
			rdtype = 4
		}
		if (rnd(6) == 0) {
			rdtype = 5
		}
		if (rnd(7) == 0) {
			rdtype = 2
		}
		if (rnd(40) == 0) {
			mapTileType = 10
		}
	}
	if (areaId(gCurrentMap) == 3) {
		mapDensity += gCurrentDungeonLevel / 2
		mapTileType = 101
		if (rnd(20) == 0) {
			mapTileType = 10
		}
		if (gCurrentDungeonLevel < 35) {
			mapTileType = 0
		}
		if (gCurrentDungeonLevel < 20) {
			mapTileType = 100
		}
		if (gCurrentDungeonLevel < 10) {
			mapTileType = 200
		}
		if (gCurrentDungeonLevel < 5) {
			mapTileType = 0
		}
		rdtype = 1
		repeat 1
			if (gCurrentDungeonLevel == 1) {
				rdtype = 2
				break
			}
			if (gCurrentDungeonLevel == 5) {
				rdtype = 5
				break
			}
			if (gCurrentDungeonLevel == 10) {
				rdtype = 3
				break
			}
			if (gCurrentDungeonLevel == 15) {
				rdtype = 5
				break
			}
			if (gCurrentDungeonLevel == 20) {
				rdtype = 3
				break
			}
			if (gCurrentDungeonLevel == 25) {
				rdtype = 5
				break
			}
			if (gCurrentDungeonLevel == 30) {
				rdtype = 3
				break
			}
			if (gCurrentDungeonLevel < 30) {
				if (rnd(4) == 0) {
					rdtype = 2
				}
			}
			if (rnd(5) == 0) {
				rdtype = 4
			}
			if (rnd(20) == 0) {
				rdtype = 8
			}
			if (rnd(6) == 0) {
				rdtype = 10
			}
		loop
	}
	if (areaId(gCurrentMap) == 16) {
		mapDensity += gCurrentDungeonLevel / 2
		mapTileType = 7
		rdtype = 1
	}
	if (areaId(gCurrentMap) == 17) {
		mapDensity += gCurrentDungeonLevel / 2
		mapTileType = 0
		rdtype = 1
	}
	if (areaId(gCurrentMap) == 18) {
		mapDensity += gCurrentDungeonLevel / 2
		mapTileType = 200
		rdtype = 1
	}
	if (areaId(gCurrentMap) == 26) {
		rdtype = 8
	}
	if (areaId(gCurrentMap) == 27) {
		rdtype = 10
	}
	if (areaId(gCurrentMap) == 38) {
		rdtype = 9
	}
	if (areaId(gCurrentMap) == 13) {
		if (gExecutingImmediateQuestType == 1001) {
			mapTileType = 300
			mapWidth = 28 + rnd(6)
			mapHeight = 20 + rnd(6)
			rdtype = 6
		}
		if (gExecutingImmediateQuestType == 1009) {
			gosub *label_0906
			return
		}
		if (gExecutingImmediateQuestType == 1006) {
			gosub *label_0900
			return
		}
		if (gExecutingImmediateQuestType == 1008) {
			gosub *label_0908
			return
		}
		if (gExecutingImmediateQuestType == 1010) {
			gosub *label_0908
			return
		}
		if (gExecutingImmediateQuestType == 1020) {
			gosub *label_NC_MAP_PRO
			return
		}
		if (gExecutingImmediateQuestType == 1021) {
			gosub *label_NC_MAP_SHEEP
			return
		}
	}
	if (oabit(0, gCurrentMap) | oabit(8, gCurrentMap)) {
		rdtype = 3
	}
	if (rdtype == 2) {
		gosub *label_0904
	}
	if (rdtype == 1) {
		gosub *label_0901
	}
	if (rdtype == 4) {
		gosub *label_0902
	}
	if (rdtype == 5) {
		gosub *label_0903
	}
	if (rdtype == 3) {
		gosub *label_0905
	}
	if (rdtype == 6) {
		mapIndoorOrOutdoor = 2
		gosub *label_0899
		return
	}
	if (rdtype == 8) {
		gosub *label_0909
	}
	if (rdtype == 10) {
		_mclass = 5 + rnd(4)
		_bold = 2
		gosub *label_0913
	}
	if (rdtype == 9) {
		_mclass = 12
		_bold = 2
		gosub *label_0911
	}
	if (stat == 0) {
		goto *label_0898
	}
	map_converttile
	map_placeplayer
	if (oabit(5, gCurrentMap)) {
		repeat 200
			repeat 2
				x = rnd(mapWidth)
				y = rnd(mapHeight)
				map(x, y, 0) = 37
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight | rnd(5) == 0) {
				x = rnd(mapWidth)
				y = rnd(mapHeight)
			}
			addmef x, y, 5, 24, rnd(15) + 20, 50, -1
			mapitem_fire x, y
			if (cnt \ 4 == 0) {
				gosub *label_0937
				characreate -1, dbid, x, y
				if (stat) {
					gosub *label_1759
				}
			}
		loop
	} else {
		rdmonsterhouse = 0
		rdcreaturepack = 0
		repeat roomsum
			rx = roomx(cnt) + 1
			rw = roomwidth(cnt) - 2
			ry = roomy(cnt) + 1
			rh = roomheight(cnt) - 2
			rdsize = rw * rh
			cnt2 = cnt
			repeat rnd(rdsize / 8 + 2)
				if (rnd(2) == 0) {
					flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
					flttypemajor = fltsetdungeon()
					if (oabit(13, gCurrentMap)) {
						encpfix = 1
					}
					itemcreate -1, 0, rnd(rw) + rx, rnd(rh) + ry, 0
				}
				gosub *label_0937
				if (oabit(4, gCurrentMap)) {
					if (cnt2 == 0 & cnt == 0 | rnd(5) == 0) {
						gosub *label_1713
					}
				}
				characreate -1, dbid, rnd(rw) + rx, rnd(rh) + ry
				if (stat == 1) {
					gosub *label_1759
					if (gCurrentDungeonLevel > 3) {
						if (creaturepack != 0) {
							if (rnd(rdcreaturepack * 5 + 5) == 0) {
								rdcreaturepack++
								fixgod = godcheck(rc)
								repeat 10 + rnd(20)
									flt cLevel(rc), calcfixlv(2)
									flttypemajor = creaturepack
									if (oabit(17, gCurrentMap) | oabit(18, gCurrentMap)) {
										initlv = 5000
									}
									characreate -1, 0, rnd(rw) + rx, rnd(rh) + ry
									gosub *label_1759
								loop
								fixgod = ""
								break
							}
						}
					}
				}
			loop
			if (areaType(gCurrentMap) == 22) {
				if (rnd(3) == 0) {
					repeat rw
						cnt2 = cnt
						repeat rh
							if (rnd(5)) {
								if ((chipm(7, map(rx + cnt2, ry + cnt, 0)) & 4) == 0) {
									if (map(rx + cnt2, ry + cnt, 6) == 0) {
										flt calcobjlv(gCurrentDungeonLevel)
										flttypeminor = 58500
										itemcreate -1, 0, rx + cnt2, ry + cnt, 1
										cell_featset rx + cnt2, ry + cnt, tile_plant + rnd(2) + rnd(2) + rnd(2), 29, iMaterial(ci), 4 + rnd(5)
										removeitem ci, 1
									}
								}
							}
						loop
					loop
				}
			}
			if (oabit(10, gCurrentMap)) {
				if (rnd(3)) {
					flt
					itemcreate -1, 172, rnd(rw) + rx, rnd(rh) + ry, 0
					iOwnState(ci) = 1
					iWeight(ci) = 9999999
					setgod ci
				}
			}
			if (oabit(6, gCurrentMap)) {
				continue
			}
			if (cnt == rdroomdownstair) {
				continue
			}
			if (cnt == rdroomupstair) {
				continue
			}
			if (rdmonsterhouse == 0 | rdtype == 2) {
				if (rnd(8) == 0) {
					if (rw * rh < 40) {
						rdmonsterhouse++
						repeat rh, ry
							rdy3 = cnt
							repeat rw, rx
								rdx3 = cnt
								gosub *label_0937
								characreate -1, dbid, rdx3, rdy3
								if (stat) {
									gosub *label_1759
								}
							loop
						loop
						if (rdtype != 2) {
							repeat rnd(3) + 1
								flt
								flttypemajor = 72000
								itemcreate -1, 0, rnd(rw) + rx, rnd(rh) + ry, 0
							loop
						}
					}
				}
			}
		loop
		mobdensity = mapDensity / 4
		itemdensity = mapDensity / 4
		if (rdtype == 3) {
			flt
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			fixlv = 4
			if (oabit(13, gCurrentMap)) {
				encpfix = 1
			}
			itemcreate -1, 0, -1, -1, 0
			mobdensity = mapDensity / 2
			itemdensity = mapDensity / 3
		}
		if (rdtype == 8) {
			mobdensity = mapDensity / 4
			itemdensity = mapDensity / 10
		}
		if (rdtype == 10) {
			mobdensity = mapDensity / 3
			itemdensity = mapDensity / 6
		}
		if (rdtype == 9) {
			mobdensity = mapDensity / 3
			itemdensity = mapDensity / 10
		}
		repeat mobdensity
			gosub *label_0937
			characreate -1, dbid, -3, 0
			if (stat) {
				gosub *label_1759
			}
		loop
		repeat itemdensity
			flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
			flttypemajor = fltsetdungeon()
			if (oabit(13, gCurrentMap)) {
				encpfix = 1
			}
			itemcreate -1, 0, -1, -1, 0
		loop
		if (gCurrentMap == 210) {
			repeat 10
				if (rnd(3) == 0) {
					flt
					fixlv = 5
					flttypemajor = isetabyss(rnd(length(isetabyss)))
					itemcreate -1, 0, -1, -1, 0
					repeat 15
						if (iEnchantmentId(ci, cnt) == 0) {
							break
						}
						iEnchantmentPower(ci, cnt) = limitmax(iEnchantmentPower(ci, cnt) * (rnd((gCurrentDungeonLevel - 50) / 5 + 1) + 50), 2100000000)
						if (ncgdata(350) > 0 & iEnchantmentPower(ci, cnt) > 0) {
							iEnchantmentPower(ci, cnt) += (iEnchantmentPower(ci, cnt) / 10) * rnd(ncgdata(350)) + 1
						}
					loop
				}
			loop
		}
		if (oabit(1, gCurrentMap)) {
			repeat 3
				if (rnd(3) == 0) {
					flt
					itemcreate -1, isetforgetnefia(rnd(length(isetforgetnefia))), -1, -1, 0
				}
			loop
		}
		if (oabit(7, gCurrentMap)) {
			repeat 3 + rnd(10)
				flt calcobjlv(gCurrentDungeonLevel * 3)
				flttypemajor = fsetwear(rnd(length(fsetwear)))
				if (oabit(13, gCurrentMap)) {
					encpfix = 1
				}
				itemcreate -1, 0, -1, -1, 0
			loop
		}
		if (oabit(15, gCurrentMap) | oabit(18, gCurrentMap) | (gCurrentMap == 210 & ncgdata(308))) {
			repeat 1 + rnd(10)
				flt
				itemcreate -1, 583, -1, -1, 0
			loop
			repeat 3
				if (rnd(3) == 0) {
					flt
					if (oabit(13, gCurrentMap)) {
						encpfix = 1
					}
					itemcreate -1, isetrarewear(rnd(length(isetrarewear))), -1, -1, 0
				}
			loop
		}
		if (oabit(16, gCurrentMap)) {
			repeat 5
				if (rnd(2) == 0) {
					flt
					itemcreate -1, 240, -1, -1, 0
					iOwnState(ci) = 1
					iWeight(ci) = 9999999
				}
			loop
		}
		if (oabit(16, gCurrentMap)) {
			p = mapWidth * mapHeight / 80
		} else {
			p = rnd(mapWidth * mapHeight / 80)
		}
		repeat p
			map_trap 0, 0, gCurrentDungeonLevel
		loop
		if (rnd(5) == 0) {
			p = rnd(mapWidth * mapHeight / 40)
			if (rnd(5) == 0) {
				p = rnd(mapWidth * mapHeight / 5)
			}
			repeat p
				map_web 0, 0, gCurrentDungeonLevel * 10 + 100
			loop
		}
		if (rnd(4) == 0) {
			p = limit(rnd(mapWidth * mapHeight / 500 + 1) + 1, 3, 15)
			repeat p
				map_barrel 0, 0
			loop
		}
		repeat 5
			if (rnd(10) == 0) {
				map_medal 0, 0
			}
		loop
		if (gCurrentMap == 210) {
			if (ncgdata(306)) {
				repeat 300
					map_zirai 0, 0
				loop
			}
		}
		if (mapIsFixed == 1) {
			if (have_bigench(0, 17)) {
				if (have_bigench2(0, 17) > rnd(100)) {
					repeat 15, 1
						if (cState(cnt) == 6) {
							rc = cnt
							gosub *label_0738
							cxinit = cX(cc)
							cyinit = cY(cc)
							place_chara rc, cxinit, cyinit
							cCurrentMap(rc) = 0
							txtef 5
							txt -1, cnven(cdatan(0, rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
							ctalk rc, 1263, rc, cc
							if ( stat == 0 ) {
								txt rc, lang("「ありがとう！」", cnvtalk("Thanks!"))
							}
							f += 1
							animeid = 19
							animode = 100 + rc
							gosub *label_0630
							snd 120
						}
					loop
					animeload 11, cc
				}
			}
			if (oabit(10, gdata(20)) == 0) { // Not 狂信者の塔
				if (rnd(limit(15 - (sdata(19, 0) / 500), 5, 15) + limit(gKillCountOfLittleSister, 0, 5)) == 0) {
					// <Big Daddy>
					flt
					initlv = limit(gCurrentDungeonLevel + rnd(5), 30, 2000)
					characreate -1, 318, -3, 0
				}
				p = 0
				repeat 450 - 300, 300
					if (areaId(cnt) == 39) {
						p = 1
						break
					}
				loop
				if (p) { // You have your own dungeon.
					// Generate town NPCs.
					repeat 2
						if (rnd(25 - limit(gCurrentDungeonLevel / 5, 0, 15)) == 0) {
							charakind = rnd(19)
							flt
							novoidlv = 1
							if (charakind == 0) {
								characreate -1, 73, -3, 0
							}
							if (charakind == 1) {
								characreate -1, 76, -3, 0
							}
							if (charakind == 2) {
								characreate -1, 77, -3, 0
							}
							if (charakind == 3) {
								characreate -1, 1, -3, 0
							}
							if (charakind == 4) {
								characreate -1, 320, -3, 0
							}
							if (charakind == 5) {
								characreate -1, 70, -3, 0
							}
							if (charakind == 6) {
								characreate -1, 74, -3, 0
							}
							if (charakind == 7) {
								characreate -1, 69, -3, 0
							}
							if (charakind == 8) {
								characreate -1, 41, -3, 0
							}
							if (charakind == 9) {
								characreate -1, 206, -3, 0
							}
							if (charakind == 10) {
								characreate -1, 326, -3, 0
							}
							if (charakind == 11) {
								characreate -1, 39, -3, 0
							}
							if (charakind == 12) {
								characreate -1, 39, -3, 0
							}
							if (charakind == 13) {
								characreate -1, 16, -3, 0
							}
							if (charakind == 14) {
								characreate -1, 16, -3, 0
							}
							if (charakind == 15) {
								characreate -1, 71, -3, 0
							}
							if (charakind == 16) {
								characreate -1, 71, -3, 0
							}
							if (charakind == 17) {
								characreate -1, 72, -3, 0
							}
							if (charakind == 18) {
								characreate -1, 176, -3, 0
							}
							if (stat != 0) {
								cRelationship(rc) = 0
								cOriginalRelationship(rc) = 0
								cRole(rc) = 10000
							}
						}
					loop
				}
			}
			if (ogdata(27) == (-1)) {
				// 頑嬢
				if (rnd(30) == 0) {
					x = -3
					y = 0
					gosub *label_1772
				}
			}
		}
	}
	if (dbg_testtrap) {
		repeat 80
			map_trap 0, 0, gCurrentDungeonLevel
		loop
		repeat mapHeight
			y = cnt
			repeat mapWidth
				x = cnt
				cell_featread x, y
				if (feat(1) == 14) {
					map(x, y, 0) = 15
				}
			loop
		loop
	}
	if (areaId(gCurrentMap) == 3) {
		if (gCurrentDungeonLevel == 3 | gCurrentDungeonLevel == 17 | gCurrentDungeonLevel == 25 | gCurrentDungeonLevel == 44) {
			x = mapDownstairs \ 1000
			y = mapDownstairs / 1000
			cell_featset x, y, tile_downlocked, 11
		}
	}
	return
*label_0899
	map_initialize
	repeat mapHeight
		p = cnt
		repeat mapWidth
			map(cnt, p, 0) = 3
		loop
	loop
	repeat rnd(mapWidth * mapHeight / 30)
		x = rnd(mapWidth)
		y = rnd(mapHeight)
		map(x, y, 0) = 1
	loop
	if (gPreviousMap2 == 33) {
		tile_room = 45, 6
	}
	map_converttile
	map_placeplayer
	mapDensity = 0
	repeat 10 + rnd(6)
		gosub *label_0937
		characreate -1, dbid, -3, 0
		if (stat != 0) {
			gosub *label_1759
			cRelationship(rc) = -3
			cOriginalRelationship(rc) = -3
		}
	loop
	repeat 10 + rnd(10)
		flt
		flttypemajor = 80000
		itemcreate -1, 0, -1, -1, 0
		iOwnState(ci) = 1
	loop
	return
	return 1
*label_0900
	gLeftMinutesOfExecutingQuest = 120
	gdata(87) = 9999
	mapIndoorOrOutdoor = 2
	mapTileType = 4
	mapWidth = 58 + rnd(16)
	mapHeight = 50 + rnd(16)
	map_initialize
	repeat mapHeight
		p = cnt
		repeat mapWidth
			map(cnt, p, 0) = tile_default + (rnd(tile_default(2)) == 0) * rnd(tile_default(1))
		loop
	loop
	mdatan(0) = lang("街周辺の畑", "Field nearby town")
	map_randomtile 9, 10
	map_randomtile 10, 10
	map_randomtile 0, 30
	map_randomtile 1, 4
	map_randomtile 4, 2
	map_randomtile 3, 2
	map_randomtile 4, 2
	map_randomtile 5, 2
	repeat 30
		w = rnd(5) + 5
		h = rnd(4) + 4
		dx = rnd(mapWidth)
		dy = rnd(mapHeight)
		if (rnd(2)) {
			tile = 30
		} else {
			tile = 31
		}
		size = limit(dist(dx, dy, mapWidth / 2, mapHeight / 2) / 8, 0, 8)
		crop = isetcrop(rnd(length(isetcrop)))
		repeat h, dy
			y = cnt
			if (y >= mapHeight) {
				break
			}
			repeat w, dx
				x = cnt
				if (x >= mapWidth) {
					break
				}
				map(x, y, 0) = tile
				if (rnd(10) != 0 | map(x, y, 4) != 0) {
					continue
				}
				if (rnd(4)) {
					dbid = crop
				} else {
					dbid = isetcrop(rnd(length(isetcrop)))
				}
				flt
				itemcreate -1, dbid, x, y, 0
				iOwnState(ci) = 4
				p = limit(size + rnd(rnd(4) + 1), 0, 9)
				iWeight(ci) = iWeight(ci) * (80 + p * p * 100) / 100
				iSubname(ci) = p
			loop
		loop
	loop
	gEntranceType = 7
	mapstartx = rnd(mapWidth / 3) + mapWidth / 3
	mapstarty = rnd(mapHeight / 3) + mapHeight / 3
	map_placeplayer
	flt
	itemcreate -1, 560, cX(0) + 1, cY(0), 0
	iOwnState(ci) = 1
	repeat 70 + rnd(20)
		x = rnd(mapWidth)
		y = rnd(mapHeight)
		if (map(x, y, 0) != 30 & map(x, y, 0) != 31) {
			if (map(x, y, 4) == 0) {
				if (rnd(8)) {
					flt
					flttypemajor = 80000
					itemcreate -1, 0, x, y, 0
					iOwnState(ci) = 1
				} else {
					cell_featset x, y, tile_pot, 30
				}
			}
		}
	loop
	mapDensity = 15
	repeat 30
		gosub *label_0937
		characreate -1, 0, -3, 0
		if (stat) {
			gosub *label_1759
		}
	loop
	return 1
*label_0901
	map_initialize
	map_createroom 1
	if (stat == 0) {
		return 0
	}
	map_placeupstairs
	map_createroom 1
	if (stat == 0) {
		return 0
	}
	map_placedownstairs
	repeat rdroomnum
		map_createroom 1
	loop
	map_connectroom
	if (stat == 0) {
		return 0
	}
	map_makedoor
	return 1
*label_0902
	rdroomsizemin = 8
	map_initialize
	p = rdroomsizemin - 1
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			map(x, y, 0) = 1
			if (x > p & y > p & x + 1 < mapWidth - p & y + 1 < mapHeight - p) {
				map(x, y, 0) = 100
			}
		loop
	loop
	map_createroom 2
	if (stat == 0) {
		return 0
	}
	map_placeupstairs
	map_createroom 2
	if (stat == 0) {
		return 0
	}
	map_placedownstairs
	repeat rdroomnum
		map_createroom 2
	loop
	if (rnd(2) == 0) {
		repeat rdroomnum / 4 + 1
			map_createroom 3
		loop
	} else {
		p = rdroomsizemin + 1 + rnd(3)
		repeat mapHeight - p * 2
			y = p + cnt
			repeat mapWidth - p * 2
				x = p + cnt
				map(x, y, 0) = 1
			loop
		loop
	}
	return 1
*label_0903
	rdroomsizemin = 8
	mapWidth = 48 + rnd(20)
	mapHeight = 22
	mapDensity = mapWidth * mapHeight / 20
	map_initialize
	p = rdroomsizemin - 1
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			map(x, y, 0) = 1
			if (x > p & y > p & x + 1 < mapWidth - p & y + 1 < mapHeight - p) {
				map(x, y, 0) = 100
			}
		loop
	loop
	map_createroom 2
	if (stat == 0) {
		return 0
	}
	map_placeupstairs
	map_createroom 2
	if (stat == 0) {
		return 0
	}
	map_placedownstairs
	repeat rdroomnum
		map_createroom 2
	loop
	if (rnd(2) == 0) {
		repeat rdroomnum / 4 + 1
			map_createroom 3
		loop
	} else {
		p = rdroomsizemin + 1 + rnd(3)
		repeat mapHeight - p * 2
			y = p + cnt
			repeat mapWidth - p * 2
				x = p + cnt
				map(x, y, 0) = 1
			loop
		loop
	}
	return 1
*label_0904
	rdroomsizemax = 3
	map_initialize
	dx = mapWidth / 2
	dy = mapHeight / 2
	map(dx, dy, 0) = 3
	p = 0
	repeat rdtunnel
		if (rnd(rdval(2)) == 0) {
			p = rnd(4)
		}
		if (p == 2) {
			dx++
			if (dx > mapWidth - 2) {
				p = 0
				dx = mapWidth - 2
			}
		}
		if (p == 1) {
			dx--
			if (dx < 1) {
				p = 3
				dx = 1
			}
		}
		if (p == 0) {
			dy++
			if (dy > mapHeight - 2) {
				p = 1
				dy = mapHeight - 2
			}
		}
		if (p == 3) {
			dy--
			if (dy < 1) {
				p = 2
				dy = 1
			}
		}
		map(dx, dy, 0) = 3
	loop
	map_createroom
	if (stat == 0) {
		return 0
	}
	map_placeupstairs
	map_createroom
	if (stat == 0) {
		return 0
	}
	map_placedownstairs
	repeat rdroomnum
		map_createroom 0
	loop
	repeat rdextraroom
		p = 0
		repeat 100
			x = rnd(mapWidth)
			y = rnd(mapHeight)
			if (map(x, y, 0) == 3) {
				dx = rnd(rdroomsizemax) + rdroomsizemin
				dy = rnd(rdroomsizemax) + rdroomsizemin
				rx = rnd(dx)
				ry = rnd(dy)
				if (x > 1 & y > 1 & x + dx < mapWidth - 2 & y + dy < mapHeight - 2) {
					p = 1
					break
				}
			}
		loop
		if (p == 0) {
			continue
		}
		dy = y
		repeat ry
			dx = x
			repeat rx
				map(dx, dy, 0) = 3
				dx++
			loop
			dy++
		loop
	loop
	return 1
*label_0905
	mapWidth = 48 + rnd(20)
	mapHeight = 22
	mapDensity = mapWidth * mapHeight / 20
	map_initialize
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			if (x == 0 | y == 0 | x + 1 == mapWidth | y + 1 == mapHeight) {
				continue
			}
			map(x, y, 0) = 3
		loop
	loop
	p = rnd(mapWidth / 2) + 2, rnd(mapWidth / 2) + mapWidth / 2 - 2
	if (rnd(2) == 0) {
		p(2) = p
		p = p(1)
		p(1) = p(2)
	}
	map_placeupstairs p, rnd(mapHeight - 4) + 2
	map_placedownstairs p(1), rnd(mapHeight - 4) + 2
	return 1
*label_0906
	if (ogdata(33) == 0) {
		gLeftMinutesOfExecutingQuest = 60
		gdata(87) = 9999
		rdroomsizemin = 5
		mdatan(0) = lang("パーティー場", "Party Room")
		mapIndoorOrOutdoor = 1
		mapTileType = 11
		mapWidth = 38
		mapHeight = 28
		map_initialize
		rdroomnum = 80
		repeat mapHeight
			y = cnt
			repeat mapWidth
				x = cnt
				if (x == 0 | y == 0 | x + 1 == mapWidth | y + 1 == mapHeight) {
					continue
				}
				map(x, y, 0) = 100
			loop
		loop
		repeat rdroomnum
			map_createroom 4
		loop
		map_converttile
		repeat 500
			dx = rnd(mapWidth - 5)
			dy = rnd(mapHeight - 5)
			p = 1, 1
			repeat 4
				y = dy + cnt
				repeat 4
					x = dx + cnt
					if (map(x, y, 0) != tile_tunnel | map(x, y, 4) != 0) {
						p(0) = 0
					}
					if (map(x, y, 0) != tile_room | map(x, y, 4) != 0) {
						p(1) = 0
					}
				loop
			loop
			if (p(0) == 1) {
				n = rnd(5)
				repeat 4
					y = dy + cnt
					cnt2 = cnt
					repeat 4
						x = dx + cnt
						if (n < 2) {
							if (cnt != 0 & cnt != 3 & cnt2 != 0 & cnt2 != 3) {
								map(x, y, 0) = 473
							}
						}
						if (n == 2) {
							if (cnt == 3 | cnt2 == 3) {
								break
							}
							if (cnt == 1 & cnt2 == 1) {
								map(x, y, 0) = 664
							} else {
								map(x, y, 0) = 206
								flt
								itemcreate -1, 91, x, y, 0
							}
						}
						if (n == 3) {
							if (cnt == 1 & cnt2 == 1) {
								map(x, y, 0) = 204
								flt
								itemcreate -1, 585, x, y, 0
							}
						}
						if (n == 4) {
							if (cnt == 1 & cnt2 == 1) {
								flt
								map(x, y, 0) = 69
								itemcreate -1, 138, x, y, 0
							}
						}
					loop
				loop
			}
			if (p(1) == 1) {
				flt
				itemcreate -1, 83, dx + 1, dy + 1, 0
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx + 1, dy, 0
				}
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx + 1, dy + 2, 0
				}
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx, dy + 1, 0
				}
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx + 2, dy + 1, 0
				}
			}
		loop
		if (Seasonal_Check(0, 0)) {
			list(0, 0) = 176, 176, 176
			list(0, 1) = 176, 176, 176
			list(0, 2) = 176, 176, 176
			list(0, 3) = 176, 176, 176
			list(0, 4) = 176, 176, 176
			list(0, 5) = 176, 176, 176
			list(0, 6) = 176, 176, 176
			list(0, 7) = 176, 176, 176
			list(0, 8) = 176, 176, 176
			list(0, 9) = 176, 176, 176
		} else {
			if (Seasonal_Check(1, 0)) {
				list(0, 0) = 326, 326, 326
				list(0, 1) = 326, 326, 326
				list(0, 2) = 326, 326, 326
				list(0, 3) = 326, 326, 326
				list(0, 4) = 326, 326, 326
				list(0, 5) = 326, 326, 326
				list(0, 6) = 326, 326, 326
				list(0, 7) = 326, 326, 326
				list(0, 8) = 326, 326, 326
				list(0, 9) = 326, 326, 326
			} else {
				list(0, 0) = 171, 9, 36
				list(0, 1) = 269, 273, 35
				list(0, 2) = 269, 174, 8
				list(0, 3) = 174, 16, 239
				list(0, 4) = 16, 185, 41
				list(0, 5) = 185, 274, 184
				list(0, 6) = 274, 272, 70
				list(0, 7) = 272, 38, 1
				list(0, 8) = 38, 206, 72
				list(0, 9) = 206, 73, 69
			}
		}
		repeat roomsum
			rx = roomx(cnt) + 1
			rw = roomwidth(cnt) - 2
			ry = roomy(cnt) + 1
			rh = roomheight(cnt) - 2
			rdsize = rw * rh
			roomdiff = limit(rnd(qdata(5, gExecutingImmediateQuest) / 3 + 3), 0, 9)
			if (rnd(2) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 88, x, y, 0
				}
			}
			if (rnd(3) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 313, x, y, 0
				}
			}
			if (rnd(2) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 156, x, y, 0
				}
			}
			if (rnd(3) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 606, x, y, 0
				}
			}
			repeat rnd(rdsize / 5 + 2) + rdsize / 5 + 3
				flt roomdiff * 5, calcfixlv(2)
				initlv = roomdiff * 7 + rnd(5)
				dbid = list(rnd(3), roomdiff)
				characreate -1, dbid, rnd(rw) + rx, rnd(rh) + ry
				cRole(rc) = 3
				cRelationship(rc) = -1
				cOriginalRelationship(rc) = -1
				cGold(rc) = cLevel(rc) * (20 + rnd(20))
			loop
		loop
		gEntranceType = 7
		mapstartx = rnd(mapWidth / 3) + mapWidth / 3
		mapstarty = rnd(mapHeight / 3) + mapHeight / 3
		map_placeplayer
		mapDensity = 0
		repeat 25 + rnd(10)
			x = rnd(mapWidth)
			y = rnd(mapHeight)
			if (map(x, y, 4) != 0 | (chipm(7, map(x, y, 0)) & 4)) {
				continue
			}
			flt
			p = 217, 218, 216, 215, 215, 152, 152, 91, 189
			itemcreate -1, p(rnd(9)), x, y, 0
		loop
		flt
		characreate -1, 29, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		flt
		characreate -1, 231, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		flt
		characreate -1, 31, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		flt
		characreate -1, 247, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (rnd(10) == 0) {
			flt
			characreate -1, 34, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(10) == 0) {
			flt
			characreate -1, 28, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(10) == 0) {
			flt
			characreate -1, 223, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(10) == 0) {
			flt
			characreate -1, 252, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(10) == 0) {
			flt
			characreate -1, 322, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		inv_getheader -1
		repeat invrange, invhead
			if (iNumber(cnt) > 0) {
				iOwnState(cnt) = 1
			}
		loop
	}
	if (ogdata(33) == 1) {
		gLeftMinutesOfExecutingQuest = 120
		gdata(87) = 9999
		rdroomsizemin = 7
		mdatan(0) = lang("パーティー場", "Party Room")
		mapIndoorOrOutdoor = 1
		mapTileType = 11
		mapWidth = 50
		mapHeight = 35
		map_initialize
		tile_default = 462
		tile_fog = 530
		tile_tunnel = 202
		tile_wall = 464
		tile_room = 201
		rdroomnum = 80
		repeat mapHeight
			y = cnt
			repeat mapWidth
				x = cnt
				if (x == 0 | y == 0 | x + 1 == mapWidth | y + 1 == mapHeight) {
					continue
				}
				map(x, y, 0) = 100
			loop
		loop
		repeat rdroomnum
			map_createroom 4
		loop
		map_converttile
		repeat 500
			dx = rnd(mapWidth - 5)
			dy = rnd(mapHeight - 5)
			p = 1, 1
			repeat 4
				y = dy + cnt
				repeat 4
					x = dx + cnt
					if (map(x, y, 0) != tile_tunnel | map(x, y, 4) != 0) {
						p(0) = 0
					}
					if (map(x, y, 0) != tile_room | map(x, y, 4) != 0) {
						p(1) = 0
					}
				loop
			loop
			if (p(0) == 1) {
				n = rnd(5)
				repeat 4
					y = dy + cnt
					cnt2 = cnt
					repeat 4
						x = dx + cnt
						if (n < 2) {
							if (cnt != 0 & cnt != 3 & cnt2 != 0 & cnt2 != 3) {
								map(x, y, 0) = 473
							}
						}
						if (n == 2) {
							if (cnt == 3 | cnt2 == 3) {
								break
							}
							if (cnt == 1 & cnt2 == 1) {
								map(x, y, 0) = 664
							} else {
								map(x, y, 0) = 206
								flt
								itemcreate -1, 91, x, y, 0
							}
						}
						if (n == 3) {
							if (cnt == 1 & cnt2 == 1) {
								map(x, y, 0) = 204
								flt
								itemcreate -1, 158, x, y, 0
							}
						}
						if (n == 4) {
							if (cnt == 1 & cnt2 == 1) {
								flt
								map(x, y, 0) = 69
								if (rnd(4) == 0) {
									itemcreate -1, 749, x, y, 0
								} else {
									itemcreate -1, 139, x, y, 0
								}
							}
						}
					loop
				loop
			}
			if (p(1) == 1) {
				flt
				itemcreate -1, 157, dx + 1, dy + 1, 0
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx + 1, dy, 0
				}
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx + 1, dy + 2, 0
				}
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx, dy + 1, 0
				}
				if (rnd(2)) {
					flt
					itemcreate -1, 92, dx + 2, dy + 1, 0
				}
			}
		loop
		if (Seasonal_Check(0, 0)) {
			list(0, 0) = 176, 176, 176
			list(0, 1) = 176, 176, 176
			list(0, 2) = 176, 176, 176
			list(0, 3) = 176, 176, 176
			list(0, 4) = 176, 176, 176
			list(0, 5) = 176, 176, 176
			list(0, 6) = 176, 176, 176
			list(0, 7) = 176, 176, 176
			list(0, 8) = 176, 176, 176
			list(0, 9) = 176, 176, 176
		} else {
			if (Seasonal_Check(1, 0)) {
				list(0, 0) = 326, 326, 326
				list(0, 1) = 326, 326, 326
				list(0, 2) = 326, 326, 326
				list(0, 3) = 326, 326, 326
				list(0, 4) = 326, 326, 326
				list(0, 5) = 326, 326, 326
				list(0, 6) = 326, 326, 326
				list(0, 7) = 326, 326, 326
				list(0, 8) = 326, 326, 326
				list(0, 9) = 326, 326, 326
			} else {
				list(0, 0) = 170, 16, 39
				list(0, 1) = 176, 176, 176
				list(0, 2) = 270, 71, 72
				list(0, 3) = 211, 210, 166
				list(0, 4) = 185, 185, 183
				list(0, 5) = 274, 183, 184
				list(0, 6) = 69, 70, 74
				list(0, 7) = 40, 38, 1
				list(0, 8) = 206, 73, 76
				list(0, 9) = 216, 218, 220
			}
		}
		flt
		characreate -1, 28, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		flt
		characreate -1, 29, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (rnd(5) == 0) {
			flt
			characreate -1, 30, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		flt
		characreate -1, 31, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		flt
		characreate -1, 33, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		rc_x = cX(rc)
		rc_y = cY(rc)
		flt
		characreate -1, 34, rc_x, rc_y
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (rnd(5) == 0) {
			flt
			characreate -1, 79, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			rc_x = cX(rc)
			rc_y = cY(rc)
			if (gdata(250 + 2) < 90) {
				flt
				characreate -1, 80, rc_x, rc_y
				cRole(rc) = 3
				cRelationship(rc) = -1
				cOriginalRelationship(rc) = -1
			}
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 142, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 179, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 202, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			rc_x = cX(rc)
			rc_y = cY(rc)
			flt
			characreate -1, 203, rc_x, rc_y
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 208, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			rc_x = cX(rc)
			rc_y = cY(rc)
			flt
			characreate -1, 209, rc_x, rc_y
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 213, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		flt
		characreate -1, 223, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (rnd(5) == 0) {
			flt
			characreate -1, 224, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 225, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			rc_x = cX(rc)
			rc_y = cY(rc)
			flt
			characreate -1, 226, rc_x, rc_y
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 227, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		flt
		characreate -1, 231, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (rnd(5) == 0) {
			flt
			characreate -1, 243, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		flt
		characreate -1, 247, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		flt
		characreate -1, 252, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (rnd(5) == 0) {
			flt
			characreate -1, 253, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 259, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 279, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 280, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 288, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 291, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 292, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (ogdata(444) == 2) {
			flt
			characreate -1, 300, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (rnd(5) == 0) {
			flt
			characreate -1, 301, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		flt
		characreate -1, 322, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		flt
		characreate -1, 334, -3, 0
		cRole(rc) = 3
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (rnd(5) == 0) {
			flt
			characreate -1, 351, -3, 0
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			rc_x = cX(rc)
			rc_y = cY(rc)
			flt
			characreate -1, 352, rc_x, rc_y
			cRole(rc) = 3
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		}
		if (ogdata(501) == 2) {
			flt
			initunid = findunid("The Unicorn of Order")
			if (initunid) {
				characreate -1, 343, -3, 0
				cRole(rc) = 3
				cRelationship(rc) = -1
				cOriginalRelationship(rc) = -1
			}
		}
		repeat roomsum
			rx = roomx(cnt) + 1
			rw = roomwidth(cnt) - 2
			ry = roomy(cnt) + 1
			rh = roomheight(cnt) - 2
			rdsize = rw * rh
			roomdiff = rnd(limit(rnd(qdata(5, gExecutingImmediateQuest) / 3 + 3), 0, 9) + 1)
			if (rnd(2) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 88, x, y, 0
				}
			}
			if (rnd(3) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 313, x, y, 0
				}
			}
			if (rnd(2) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 156, x, y, 0
				}
			}
			if (rnd(3) == 0) {
				x = rnd(rw) + rx
				y = rnd(rh) + ry
				if (map(x, y, 4) == 0) {
					flt
					itemcreate -1, 606, x, y, 0
				}
			}
			repeat rnd(rdsize / 5 + 2) + rdsize / 5 + 3
				flt roomdiff * 5, calcfixlv(2)
				initlv = roomdiff * 14 + rnd(5)
				dbid = list(rnd(3), roomdiff)
				characreate -1, dbid, rnd(rw) + rx, rnd(rh) + ry
				cRole(rc) = 3
				cRelationship(rc) = -1
				cOriginalRelationship(rc) = -1
				cGold(rc) = cLevel(rc) * (20 + rnd(20)) * 10
			loop
		loop
		gEntranceType = 7
		mapstartx = rnd(mapWidth / 3) + mapWidth / 3
		mapstarty = rnd(mapHeight / 3) + mapHeight / 3
		map_placeplayer
		mapDensity = 0
		repeat 25 + rnd(10)
			x = rnd(mapWidth)
			y = rnd(mapHeight)
			if (map(x, y, 4) != 0 | (chipm(7, map(x, y, 0)) & 4)) {
				continue
			}
			flt
			p = 217, 218, 216, 215, 770, 152, 770, 91, 189
			itemcreate -1, p(rnd(9)), x, y, 0
		loop
		inv_getheader -1
		repeat invrange, invhead
			if (iNumber(cnt) > 0) {
				iOwnState(cnt) = 1
			}
		loop
	}
	return 1

#include "nc_evmap.hsp"

*label_0907
	mapIsFixed = 0
	gEntranceType = 7
	snd 49
	mapTileType = 0
	map_initcustom "dungeon1"
	mapIndoorOrOutdoor = 1
	mapType = 5
	mapDensity = 0
	mapBgm = 62
	mdata(17) = 1
	mapItemMax = 350
	mdata(15) = 0
	mapstartx = 40
	mapstarty = 58
	map_placeplayer
	if (ogdata(200) >= 1 & ogdata(200) < 1000) {
		mdatan(0) = lang("エイリアンの巣", "Alien nest")
		repeat 15 + rnd(10)
			flt
			initlv = (rnd(20) + 1) * 3 / 2
			fixlv = 1
			characreate -1, 330, -3, 0
			cRelationship(rc) = -3
			cOriginalRelationship(rc) = -3
		loop
		flt
		initlv = 50
		fixlv = 5
		characreate -1, 330, -3, 0
		cRelationship(rc) = -3
		cOriginalRelationship(rc) = -3
		cSex(rc) = 1
		cdatan(0, rc) = lang("《クイーン・エイリアン》", "{Queen Alien}")
	}
	put_questtarget
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		iNumber(cnt) = 0
		cell_refresh iX(cnt), iY(cnt)
	loop
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			map(x, y, 6) = 0
		loop
	loop
	cell_featset 40, 58, tile_upstairs, 10, gPreviousDungeonLevel
	txt -1, lang(mdatan(0) + "に辿り着いた。", "Reached " + mdatan(0) + ".")
	return
*label_0908
	mapDensity = 0
	mapIndoorOrOutdoor = 2
	map_initcustom mapfile(gPreviousMap2)
	mdatan(0) = lang("市街地", "Urban Area")
	randomize
	gEntranceType = 5
	map_placeplayer
	mdata(15) = 0
	if (gExecutingImmediateQuestType == 1008) {
		gLeftMinutesOfExecutingQuest = 60 * 12
		gdata(87) = 9999
		flt
		initlv = qdata(5, gExecutingImmediateQuest)
		fixlv = 5
		if (qdata(12, gExecutingImmediateQuest) == 343) {
			if (qdata(13, gExecutingImmediateQuest) != usernpcmax) {
				initunid = qdata(13, gExecutingImmediateQuest) + 1
			}
		}
		characreate -1, qdata(12, gExecutingImmediateQuest), -3, 0
		cRelationship(rc) = -3
		cOriginalRelationship(rc) = -3
		qdata(13, gExecutingImmediateQuest) = rc
		qdata(16, gExecutingImmediateQuest) = cQuality(rc)
	}
	if (gExecutingImmediateQuestType == 1010) {
		repeat 6 + rnd(4)
			flt
			initlv = qdata(5, gExecutingImmediateQuest) * 3 / 2
			fixlv = 1
			if (qdata(12, gExecutingImmediateQuest) == 343) {
				if (qdata(13, gExecutingImmediateQuest) != usernpcmax) {
					initunid = qdata(13, gExecutingImmediateQuest) + 1
				}
			}
			characreate -1, qdata(12, gExecutingImmediateQuest), -3, 0
			cRelationship(rc) = -3
			cOriginalRelationship(rc) = -3
		loop
	}
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		f = 0
		if (iId(cnt) == 109 | iId(cnt) == 173) {
			iParam1(cnt) = -10
		}
		if (iId(cnt) == 241) {
			iParam1(cnt) = 0
		}
	loop
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			map(x, y, 6) = 0
		loop
	loop
	return
*label_0909
	mapWidth = 30
	mapHeight = 60 + rnd(60)
	mapDensity = mapWidth * mapHeight / 20
	map_initialize
	w = 6
	dx = mapWidth / 2 - w / 2
	p = 0
	repeat mapHeight - 4
		y = 2 + cnt
		repeat w
			x = cnt + dx
			map(x, y, 0) = 100
		loop
		if (p <= 0) {
			if (rnd(2)) {
				p = rnd(12)
			}
		}
		if (rnd(2)) {
			if (w > 4) {
				w -= rnd(2)
			}
		}
		if (p > 0) {
			if (p < 5) {
				if (w > 3) {
					w -= rnd(2)
					p--
				}
			}
			if (p > 4) {
				if (w < 10) {
					w++
					p--
				}
			}
		}
		if (dx > 1) {
			dx -= rnd(2)
		}
		if (dx + w < mapWidth - 1) {
			dx += rnd(2)
		}
		if (dx + w > mapWidth) {
			w = mapWidth - dx
		}
	loop
	repeat
		x = rnd(mapWidth)
		y = rnd(15)
		if (map(x, y, 0) == 100) {
			map_placeupstairs x, y
			break
		}
	loop
	repeat
		x = rnd(mapWidth)
		y = mapHeight - rnd(15) - 1
		if (map(x, y, 0) == 100) {
			map_placedownstairs x, y
			break
		}
	loop
	return



#deffunc dimmix array __www
	mx@m172 = length(__www)
	repeat mx@m172
		r@m172 = cnt + rnd(mx@m172 - cnt)
		tmp@m172 = __www(r@m172)
		__www(r@m172) = __www(cnt)
		__www(cnt) = tmp@m172
	loop
	return
*label_0911
	mapWidth = _mclass * (_bold * 2) - _bold + 8
	mapHeight = mapWidth
	mapDensity = mapWidth * mapHeight / 12
	map_initialize
	gosub *label_0912
	rdsecond = 1
	gosub *label_0912
	rdsecond = 0
	return
*label_0912
	dim maze, _mclass * _mclass
	mdig = 0
	_hole = 0
	sdigx = _bold
	sdigy = _bold
	maze(mdig) = 7
	dim way, 4
	repeat 4
		way(cnt) = cnt
	loop
	i = 0
	repeat
		dimmix way
		digno = 0
		repeat 4
			pmdig = mdig
			if (way(cnt) == 0) {
				if (pmdig / _mclass == 0) {
					continue
				} else {
					mdig -= _mclass
				}
			}
			if (way(cnt) == 1) {
				if (pmdig \ _mclass == _mclass - 1) {
					continue
				} else {
					mdig++
				}
			}
			if (way(cnt) == 2) {
				if (pmdig / _mclass == _mclass - 1) {
					continue
				} else {
					mdig += _mclass
				}
			}
			if (way(cnt) == 3) {
				if (pmdig \ _mclass == 0) {
					continue
				} else {
					mdig--
				}
			}
			if (maze(mdig) != _hole) {
				mdig = pmdig
				continue
			}
			i++
			sdigx = pmdig \ _mclass * _bold * 2 + _bold
			sdigy = pmdig / _mclass * _bold * 2 + _bold
			if (way(cnt) == 0) {
				maze(mdig) = 3
				repeat _bold * 2
					y = sdigy - _bold * 2 + cnt - _bold + 4
					repeat _bold - 1
						x = sdigx + cnt - _bold + 4
						map(x, y, 0) = 100
					loop
				loop
			}
			if (way(cnt) == 1) {
				maze(mdig) = 4
				repeat _bold - 1
					y = sdigy + cnt - _bold + 4
					repeat _bold * 3 - 1
						x = sdigx + cnt - _bold + 4
						map(x, y, 0) = 100
					loop
				loop
			}
			if (way(cnt) == 2) {
				maze(mdig) = 1
				repeat _bold * 3 - 1
					y = sdigy + cnt - _bold + 4
					repeat _bold - 1
						x = sdigx + cnt - _bold + 4
						map(x, y, 0) = 100
					loop
				loop
			}
			if (way(cnt) == 3) {
				maze(mdig) = 2
				repeat _bold - 1
					y = sdigy + cnt - _bold + 4
					repeat _bold * 2
						x = sdigx + cnt - _bold * 2 - _bold + 4
						map(x, y, 0) = 100
					loop
				loop
			}
			digno = 1
			break
		loop
		if (digno == 1) {
			continue
		}
		if (maze(mdig) == 7) {
			break
		}
		if (maze(mdig) == 1) {
			mdig -= _mclass
			continue
		}
		if (maze(mdig) == 2) {
			mdig++
			continue
		}
		if (maze(mdig) == 3) {
			mdig += _mclass
			continue
		}
		if (maze(mdig) == 4) {
			mdig--
		}
	loop
	if (rdsecond) {
		return
	}
	repeat
		x = rnd(mapWidth)
		y = rnd(mapHeight)
		if (map(x, y, 0) != 100) {
			continue
		}
		dx = rnd(mapWidth)
		dy = rnd(mapHeight)
		if (map(dx, dy, 0) != 100) {
			continue
		}
		if (dist(x, y, dx, dy) < 10) {
			if (cnt < 1000) {
				continue
			}
		}
		map_placeupstairs x, y
		map_placedownstairs dx, dy
		break
	loop
	return
*label_0913
	mapWidth = _mclass * (_bold * 2) - _bold + 8
	mapHeight = mapWidth
	mapDensity = mapWidth * mapHeight / 12
	map_initialize
	gosub *label_0912
	repeat 50
		cnt2 = cnt
		t = 100 + cnt2 + 1
		repeat
			x = rnd(mapWidth)
			y = rnd(mapHeight)
			if (map(x, y, 0) != 100) {
				continue
			}
			w = 10 + rnd(4)
			repeat w
				dy = cnt + y - w / 2
				repeat w
					dx = cnt + x - w / 2
					if (dx < 1 | dy < 1 | dx >= mapWidth - 1 | dy >= mapHeight - 1) {
						continue
					}
					if (dist(x, y, dx, dy) >= w / 2) {
						continue
					}
					tx = dx - 1
					ty = dy
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					tx = dx + 1
					ty = dy
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					tx = dx
					ty = dy - 1
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					tx = dx
					ty = dy + 1
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					tx = dx - 1
					ty = dy - 1
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					tx = dx + 1
					ty = dy - 1
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					tx = dx - 1
					ty = dy + 1
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					tx = dx + 1
					ty = dy + 1
					if (map(tx, ty, 0) != t) {
						if (map(tx, ty, 0) != 0) {
							if (map(tx, ty, 0) != 100) {
								continue
							}
						}
					}
					map(dx, dy, 0) = t
				loop
			loop
			break
		loop
	loop
	repeat mapHeight / 2 - 2
		y = cnt * 2
		repeat mapWidth / 2 - 2
			x = cnt * 2
			if (map(x, y, 0) < 100) {
				continue
			}
			if (map(x, y, 6) != 0) {
				continue
			}
			if (map(x - 1, y, 0) >= 100) {
				if (map(x + 1, y, 0) >= 100) {
					if (map(x, y - 1, 0) == 0) {
						if (map(x, y + 1, 0) == 0) {
							cell_featset x, y, tile_doorclosed, 21, rnd(abs(gCurrentDungeonLevel * 3 / 2) + 1)
						}
					}
					continue
				}
			}
			if (map(x, y - 1, 0) >= 100) {
				if (map(x, y + 1, 0) >= 100) {
					if (map(x - 1, y, 0) == 0) {
						if (map(x + 1, y, 0) == 0) {
							cell_featset x, y, tile_doorclosed, 21, rnd(abs(gCurrentDungeonLevel * 3 / 2) + 1)
						}
					}
					continue
				}
			}
		loop
	loop
	return
*label_0914
	if (gHomeScale == 0) {
		mapItemMax = 100
		gBasicPointOfHomeRank = 1000
	}
	if (gHomeScale == 1) {
		mapItemMax = 150
		gBasicPointOfHomeRank = 3000
	}
	if (gHomeScale == 2) {
		mapItemMax = 200
		gBasicPointOfHomeRank = 5000
	}
	if (gHomeScale == 3) {
		mapItemMax = 300
		gBasicPointOfHomeRank = 7000
	}
	if (gHomeScale == 4) {
		mapItemMax = 350
		gBasicPointOfHomeRank = 8000
		mapTileType = 8
	}
	if (gHomeScale == 5) {
		mapItemMax = 400
		gBasicPointOfHomeRank = 10000
	}
	return
*label_0915
	if (mapType != 1) {
		txt -1, lang("それはワールドマップでしか使えない。", "You can only use it in the world map.")
		gosub *label_0623
		goto *label_1623
	}
	cell_featread cX(0), cY(0)
	if (feat(0) != 0) {
		if (feat(2) + feat(3) * 100 != 7 | iId(ci) != 344 | gHomeScale == iParam1(ci)) {
			txt -1, lang("その場所には建てられない。", "You can't build it here.")
			gosub *label_0623
			goto *label_1623
		}
	}
	if (iId(ci) == 344) {
		if (gHomeScale == iParam1(ci)) {
			txt -1, lang("自宅をこの場所に移動させる？", "Really move your home here?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval != 0) {
				gosub *label_0623
				goto *label_1623
			}
			areaX(7) = cX(0)
			areaY(7) = cY(0)
			areaOuterMap(7) = gdata(850)
			snd 58
			txtef 5
			txt -1, lang("「フハハハハハハ！まかせろ！」", "\"Muwahahahaha, I'll take care of it!\"")
			gosub *label_0950
			iNumber(ci)--
			cell_refresh iX(ci), iY(ci)
			goto *label_1617
		}
	}
	if (iId(ci) == 712) {
		exdun = -1
		repeat 450 - 300, 300
			if (areaId(cnt) == 39) {
				exdun = cnt
				break
			}
		loop
		if (exdun != (-1)) {
			txt -1, lang("ダンジョンをこの場所に移動させる？", "Really move your dungeon here?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval != 0) {
				gosub *label_0623
				goto *label_1623
			}
			areaX(exdun) = cX(0)
			areaY(exdun) = cY(0)
			areaOuterMap(exdun) = gdata(850)
			snd 58
			txtef 5
			txt -1, lang("「フハハハハハハ！まかせろ！」", "\"Muwahahahaha, I'll take care of it!\"")
			gosub *label_0950
			iNumber(ci)--
			cell_refresh iX(ci), iY(ci)
			goto *label_1617
		}
	}
	area = -1
	repeat 450 - 300, 300
		if (areaId(cnt) == 0) {
			area = cnt
			break
		}
	loop
	if (area == (-1)) {
		txt -1, lang("もうこれ以上建物は建てられない。", "You can't build a building anymore.")
		gosub *label_0623
		goto *label_1623
	}
	txt -1, lang("本当にこの場所に建設する？ ", "Really build it here? ")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *label_1353
	if (rtval != 0) {
		gosub *label_0623
		goto *label_1623
	}
	if (iId(ci) == 344) {
		gHomeScale = iParam1(ci)
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		gosub *label_0916
		midbk = mid
		mid = "" + 7 + "_" + (100 + 1)
		ctrlFile 12
		mid = midbk
		gosub *label_0950
		levelexitby = 2
		gDestinationMap = 7
		gDestinationDungeonLevel = 1
		gPcXInWorldMap = areaX(7)
		gPcYInWorldMap = areaY(7)
		snd 58
		txtef 2
		txt -1, lang("新しい家を建てた！ ", "You've built a new house!")
		msg_halt
		snd 49
		goto *label_0939
	}
	ctrlFile 13
	p = area
	areaX(p) = cX(0)
	areaY(p) = cY(0)
	areaType(p) = 5
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaTileType(p) = 3
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaTileSet(p) = 1
	areaEntranceType(p) = 8
	areaOuterMap(p) = gdata(850)
	if (iId(ci) == 521) {
		areaId(p) = 101
		areaAppearance(p) = 151
		areaIndoorOrOutdoor(p) = 1
		s = lang("博物館", "museum")
	}
	if (iId(ci) == 522) {
		areaId(p) = 102
		areaAppearance(p) = 150
		areaIndoorOrOutdoor(p) = 1
		s = lang("店", "shop")
	}
	if (iId(ci) == 542) {
		areaId(p) = 103
		areaAppearance(p) = 152
		areaIndoorOrOutdoor(p) = 2
		s = lang("畑", "crop")
	}
	if (iId(ci) == 543) {
		areaId(p) = 104
		areaAppearance(p) = 153
		areaIndoorOrOutdoor(p) = 1
		s = lang("倉庫", "storage")
	}
	if (iId(ci) == 572) {
		areaId(p) = 31
		areaAppearance(p) = 154
		areaIndoorOrOutdoor(p) = 2
		areaDefaultAiCalm(p) = 1
		s = lang("牧場", "ranch")
	}
	if (iId(ci) == 712) {
		areaId(p) = 39
		areaAppearance(p) = 138
		areaIndoorOrOutdoor(p) = 1
		areaDefaultAiCalm(p) = 1
		s = lang("ダンジョン", "dungeon")
	}
	snd 58
	txtef 5
	txt -1, lang("あなたは" + s + "を建設した！ ", "You've built a " + s + "!")
	gosub *label_0950
	iNumber(ci)--
	cell_refresh iX(ci), iY(ci)
	goto *label_1617
*label_0916
	p = 7
	areaAppearance(p) = 143
	if (gHomeScale == 0) {
		areaAppearance(p) = 138
	}
	if (gHomeScale == 4) {
		areaAppearance(p) = 148
	}
	if (gHomeScale == 5) {
		areaAppearance(p) = 144
	}
	if (gHomeScale != 0) {
		areaX(p) = cX(0)
		areaY(p) = cY(0)
	}
	areaOuterMap(p) = gdata(850)
	return
*label_0917
	txtnew
	f = 0
	if (mapType == 5) {
		f = 1
	}
	if (gCurrentDungeonLevel == 3) {
		if (gdata(128) < 3000) {
			if (areaId(gCurrentMap) == 36 & guildcheck(0) == "mage" | (areaId(gCurrentMap) == 14 & guildcheck(0) == "thieve") | (areaId(gCurrentMap) == 11 & guildcheck(0) == "fighter")) {
				f = 1
			}
		}
	}
	if (areaId(gCurrentMap) == 3 & gdata(250 + 2) >= 200) {
		f = 1
	}
	/*混沌の城模様替え*/
	if (areaId(gCurrentMap) == 22 | areaId(gCurrentMap) == 23 | areaId(gCurrentMap) == 24) {
		if (ogdata(451) == 2) {
		f = 1
		}
	}
	if (areaId(gCurrentMap) == 59) {
		if (ogdata(535) == 2) {
			f = 1
		}
	}
	if (areaId(gCurrentMap) == 47 | areaId(gCurrentMap) == 48) {
		f = 1
	}
	if (f == 0) {
		msgdup++
		txt -1, lang("ここはあなたの家ではない。", "You can only use it in your home.")
		gosub *label_0623
		goto *label_1623
	}
	inv_getheader -1
	p = 0, 0, 0
	repeat invrange, invhead
		p(2)++
		if (iNumber(cnt) != 0) {
			if (refitem(iId(cnt), 5, cnt) != 60000) {
				p++
			} else {
				p(1)++
			}
		}
	loop
	if (mapItemMax != 0) {
		p(2) = mapItemMax
	}
	txt -1, lang(mapname(gCurrentMap) + "には" + p + "個のアイテムと" + p(1) + "個の家具がある(アイテム最大" + p(2) + "個) ", "There are " + p + " items and " + p(1) + " furniture in " + mapname(gCurrentMap) + ".(Max: " + p(2) + ") ")
	if (areaId(gCurrentMap) == 102) {
		if (getworker(gCurrentMap) != (-1)) {
			txt -1, lang("現在の店主は" + cdatan(0, getworker(gCurrentMap)) + "だ。", "Current shopkeeper is " + cdatan(0, getworker(gCurrentMap)) + ".")
		} else {
			txt -1, lang("現在店主はいない。", "You haven't assigned a shopkeeper yet.")
		}
	}
	if (areaId(gCurrentMap) == 31) {
		if (getworker(gCurrentMap) != (-1)) {
			txt -1, lang("現在のブリーダーは" + cdatan(0, getworker(gCurrentMap)) + "だ。", "Current breeder is " + cdatan(0, getworker(gCurrentMap)) + ".")
		} else {
			txt -1, lang("現在ブリーダーはいない。", "You haven't assigned a breeder yet.")
		}
	}
	if (gCurrentMap == 7) {
		p = 0
		repeat 188, 57
			if (cState(cnt) == 1 | cState(cnt) == 2) {
				if (cId(cnt) == 176) {
					continue
				}
				if (cRole(cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop")) {
					continue
				}
				if (cRole(cnt) != 0) {
					p++
				}
			}
		loop
		txt -1, lang("現在" + p + "人の滞在者がいる(最大" + (gHomeScale + 2 + (ogdata(494) == 2) * 10) + "人) ", "" + p + " members are staying at your home. (Max: " + (gHomeScale + 2 + (ogdata(494) == 2) * 10) + ").")
		if (ogdata(448) != 0) {
			areaLastFloor(gCurrentMap) = 20
		}
		if (ogdata(448) != 0 & ncgdata(5) < 1) {
			ncgdata(5) = 1
			snd 58
			txtef 2
			txt -1, lang("あなたの活躍を聞いた大工にわが家を改良してもらった！地下" + (areaLastFloor(gCurrentMap) - 1) + "階まで使えるようになった！", "Now possible to go down " + (areaLastFloor(gCurrentMap) - 1) + " floors underground!")
		}
		if (ogdata(499) != 0) {
			areaLastFloor(gCurrentMap) = 30
		}
		if (ogdata(499) != 0 & ncgdata(5) < 2) {
			ncgdata(5) = 2
			snd 58
			txtef 2
			txt -1, lang("あなたの活躍を聞いた大工にわが家を改良してもらった！地下" + (areaLastFloor(gCurrentMap) - 1) + "階まで使えるようになった！", "Now possible to go down " + (areaLastFloor(gCurrentMap) - 1) + " floors underground!")
		}
		if (ogdata(515) != 0) {
			areaLastFloor(gCurrentMap) = 40
		}
		if (ogdata(515) != 0 & ncgdata(5) < 3) {
			ncgdata(5) = 3
			snd 58
			txtef 2
			txt -1, lang("あなたの活躍を聞いた大工にわが家を改良してもらった！地下" + (areaLastFloor(gCurrentMap) - 1) + "階まで使えるようになった！", "Now possible to go down " + (areaLastFloor(gCurrentMap) - 1) + " floors underground!")
		}
	}
	txtnew
	txt -1, lang("何をする？", "What do you want to do?")
	p = 0
	promptl(0, promptmax) = lang("家の模様替え", "Design"), "null", "" + 0
	promptmax++
	if (areaId(gCurrentMap) == 101) {
		if (ogdata(498) == 2) {
			promptl(0, promptmax) = lang("博物館の名前を考える", "Think of a name for my museum"), "null", "" + 20
			promptmax++
		}
	}
	if (areaId(gCurrentMap) == 102) {
		promptl(0, promptmax) = lang("仲間に店主を頼む", "Assign a shopkeeper"), "null", "" + 4
		promptmax++
		if (mapItemMax < 400) {
			promptl(0, promptmax) = lang("店を拡張", "Extend") + "(" + calcshopreform() + " GP)", "null", "" + 5
			promptmax++
		}
		if (cfg_notforsale) {
			promptl(0, promptmax) = lang("非売エリアの設定", "Set not-for-sale area."), "null", "" + 10
			promptmax++
		}
		if (ogdata(498) == 2) {
			promptl(0, promptmax) = lang("店の名前を考える", "Think of a name for my shop"), "null", "" + 20
			promptmax++
		}
	}
	if (areaId(gCurrentMap) == 103) {
		if (mapItemMax < 400) {
			promptl(0, promptmax) = lang("畑を拡張", "Extend") + "(" + calcshopreform() + " GP)", "null", "" + 5
			promptmax++
		}
		if (ogdata(498) == 2) {
			promptl(0, promptmax) = lang("畑の名前を考える", "Think of a name for my crop"), "null", "" + 20
			promptmax++
		}
	}
	if (areaId(gCurrentMap) == 104) {
		if (mapItemMax < 400) {
			promptl(0, promptmax) = lang("倉庫を拡張", "Extend") + "(" + calcshopreform() + " GP)", "null", "" + 5
			promptmax++
		}
		if (areaOuterMap(gCurrentMap) == 47) {
			promptl(0, promptmax) = lang("使用人を募集する", "Recruit a servant"), "null", "" + 6
			promptmax++
		} else {
			if (ogdata(498) == 2) {
				promptl(0, promptmax) = lang("倉庫の名前を考える", "Think of a name for my storage"), "null", "" + 20
				promptmax++
			}
		}
	}
	if (areaId(gCurrentMap) == 31) {
		promptl(0, promptmax) = lang("ブリーダーを任命する", "Assign a breeder"), "null", "" + 4
		promptmax++
		if (mapItemMax < 400) {
			promptl(0, promptmax) = lang("牧場を拡張", "Extend") + "(" + calcshopreform() + " GP)", "null", "" + 5
			promptmax++
		}
		if (ogdata(498) == 2) {
			promptl(0, promptmax) = lang("牧場の名前を考える", "Think of a name for my ranch"), "null", "" + 20
			promptmax++
		}
	}
	if (gCurrentMap == 7) {
		promptl(0, promptmax) = lang("家の情報", "Home rank"), "null", "" + 2
		promptmax++
		promptl(0, promptmax) = lang("仲間の滞在", "Allies in your home"), "null", "" + 4
		promptmax++
		if (gCurrentDungeonLevel == 1) {
			promptl(0, promptmax) = lang("使用人を募集する", "Recruit a servant"), "null", "" + 6
			promptmax++
		}
	}
	if (areaId(gCurrentMap) == 39) {
		promptl(0, promptmax) = lang("メイドを雇う", "Hire a maid"), "null", "" + 7
		promptmax++
	}
	if (areaId(gCurrentMap) == 103) {
		promptl(0, promptmax) = lang("仲間の滞在", "Allies in crop"), "null", "" + 4
		promptmax++
	}
	if (areaId(gCurrentMap) == 47) {
		promptl(0, promptmax) = lang("ネフィアの消去", "Clear Nefia"), "null", "" + 30
		promptmax++
		promptl(0, promptmax) = lang("関所の移設", "Move Border"), "null", "" + 31
		promptmax++
		promptl(0, promptmax) = lang("島の名前を考える", "Think of a name for island"), "null", "" + 20
		promptmax++
	} else {
		promptl(0, promptmax) = lang("滞在者の移動", "Move a stayer"), "null", "" + 3
		promptmax++
	}
	promptl(0, promptmax) = lang("模様のリセット", "Design Reset"), "null", "" + 40
	promptmax++
	homemakewall = 0
	val = promptx, prompty, 240, 1
	gosub *label_1353
	if (stat == 0) {
		gosub *label_0623
		goto *label_1623
	}
	_switch_val = rtval
	if (_switch_val == 10 | _switch_sw) {
		_switch_sw = 0
		homemapmode = 2
		f = 0
		cxbk = cX(0)
		cybk = cY(0)
		n = 0
		txtnew
		txt -1, lang("赤いマスが非商品エリア。マウスの左クリックで非商品エリア設置、右クリックで撤去、決定キーでエリア反転、移動キーでスクリーン移動、キャンセルキーで終了。", "Left click to place the tile, right click to pick the tile under your mouse cursor, movement keys to move current position, hit the enter key to show the list of tiles, hit the cancel key to exit.")
		tcol@txtfunc = 255, 255, 255
		tlocinitx = cX(0)
		tlocinity = cY(0)
		tile = 0
		repeat
			await
			homemakewall = 1
			gosub *label_1147
			if (stat == (-1)) {
				break
			}
			if (stat == 1) {
				mapbitmod 3, tlocx, tlocy, 0
			}
			if (stat == 2) {
				mapbitmod 3, tlocx, tlocy, 1
			}
			tlocinitx = tlocx
			tlocinity = tlocy
		loop
		homemapmode = 0
		cX(0) = cxbk
		cY(0) = cybk
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 20 | _switch_sw) {
		_switch_sw = 0
		repeat
			promptmax = 0
			promptl(0, promptmax) = "別の名前を考える", "null", "" + promptmax
			promptmax++
			repeat 3
				mdatan(0) = random_title()
				if (rnd(50) == 0) {
					if (rnd(2)) {
						mdatan(0) = cdatan(0, 0)
					} else {
						mdatan(0) = cdatan(1, 0)
					}
				}
				if (areaId(gCurrentMap) == 101) {
					if (jp) {
						s = "の博物館", "ミュージアム", "の記念館", "ハーレム", "の芸術展", "の美術館", "堂", "の史料館", "館", "の史料館", "ドーム"
						if (rnd(5)) {
							mdatan(0) += s(rnd(11))
						}
					} else {
						s = "Museum", "Mansion", "Shack", "Nest", "Base", "Hideout", "Dome", "Hut", "Cabin", "Hovel", "Shed"
						if (rnd(3)) {
							mdatan(0) += " " + s(rnd(11))
						}
					}
					mati = lang("博物館", "museum")
				}
				if (areaId(gCurrentMap) == 102) {
					if (jp) {
						s = "の店", "舗", "ストア", "ハーレム", "の販売店", "商店", "の販売所", "市場", "ショップ", "モール", "ドーム"
						if (rnd(5)) {
							mdatan(0) += s(rnd(11))
						}
					} else {
						s = "Shop", "Mansion", "Shack", "Nest", "Base", "Hideout", "Dome", "Hut", "Cabin", "Hovel", "Shed"
						if (rnd(3)) {
							mdatan(0) += " " + s(rnd(11))
						}
					}
					mati = lang("店", "shop")
				}
				if (areaId(gCurrentMap) == 103) {
					if (jp) {
						s = "の畑", "棚田", "原", "ハーレム", "の菜園", "園", "農園", "の水田", "の家庭菜園", "の温室", "ドーム"
						if (rnd(5)) {
							mdatan(0) += s(rnd(11))
						}
					} else {
						s = "Crop", "Mansion", "Shack", "Nest", "Base", "Hideout", "Dome", "Hut", "Cabin", "Hovel", "Shed"
						if (rnd(3)) {
							mdatan(0) += " " + s(rnd(11))
						}
					}
					mati = lang("畑", "crop")
				}
				if (areaId(gCurrentMap) == 104) {
					if (jp) {
						s = "の倉庫", "倉", "庫", "ハーレム", "の蔵", "の穴蔵", "の物置", "の納屋", "置き場", "の集積場", "ドーム"
						if (rnd(5)) {
							mdatan(0) += s(rnd(11))
						}
					} else {
						s = "Storage", "Mansion", "Shack", "Nest", "Base", "Hideout", "Dome", "Hut", "Cabin", "Hovel", "Shed"
						if (rnd(3)) {
							mdatan(0) += " " + s(rnd(11))
						}
					}
					mati = lang("倉庫", "storage")
				}
				if (areaId(gCurrentMap) == 31) {
					if (jp) {
						s = "の牧場", "の放牧地", "地", "ハーレム", "の草原", "フィールド", "の牧草地", "の草原", "牧", "原", "ドーム"
						if (rnd(5)) {
							mdatan(0) += s(rnd(11))
						}
					} else {
						s = "Ranch", "Mansion", "Shack", "Nest", "Base", "Hideout", "Dome", "Hut", "Cabin", "Hovel", "Shed"
						if (rnd(3)) {
							mdatan(0) += " " + s(rnd(11))
						}
					}
					mati = lang("牧場", "ranch")
				}
				promptl(0, promptmax) = mdatan(0), "null", "" + promptmax
				promptmax++
			loop
			promptl(0, promptmax) = "やっぱり直接決める", "null", "" + promptmax
			promptmax++
			val = promptx, prompty, 400, 1
			gosub *label_1353
			if (rtval != -1 & rtval != 0) {
				mdatan(0) = promptl(0, rtval)
				if (rtval == 4) {
					txtnew
					txt -1, lang("この" + mati + "の名前は？", "What is the name of this facility?")
					val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
					inputlog = ""
					gosub *label_1349
					mdatan(0) = inputlog
				}
				break
			}
			snd 103
		loop
		screenupdate = -1
		gosub *label_0621
		txtnew
		txt -1, lang("これからこの" + mati + "の名前は" + mdatan(0) + "だ", "You don't have enough money...")
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 30 | _switch_sw) {
		_switch_sw = 0
		repeat 500 - 450, 450
			if (areaId(cnt) == 8) {
				map(areaX(cnt), areaY(cnt), 6) = 0
				areaId(cnt) = 0
				removeworker cnt
				gosub *label_0950
			}
		loop
		txt -1, lang("ネフィアを一掃した。", "Clear all nefia.")
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 31 | _switch_sw) {
		_switch_sw = 0
		txtnew
		txt -1, lang("どこに移動させる？", "Where do you want to move?")
		gosub *label_1147
		if (stat == (-1)) {
			goto *label_0925
		}
		if (chipm(7, map(tlocx, tlocy, 0)) & 4 | map(tlocx, tlocy, 1) != 0 | map(tlocx, tlocy, 6) != 0) {
			txtnew
			txt -1, lang("その場所には移動させることができない。", "The location is invalid.")
			goto *label_0925
		}
		repeat 500
			if (areaId(cnt) == 48) {
				areaX(cnt) = tlocx
				areaY(cnt) = tlocy
				p = cnt
				break
			}
		loop
		gosub *label_0950
		cell_refresh areaX(p), areaY(p)
		ncgdata(202) = 1
		snd 58
		txtnew
		txt -1, lang("関所を移動させた。", "Border moved to the location.")
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 40 | _switch_sw) {
		_switch_sw = 0
		repeat mapHeight
			nc_intb_001 = cnt
			repeat mapWidth
				map(cnt, nc_intb_001, 0) = 0
			loop
		loop
		snd 58
		txt -1, lang("地面を均した。", "Clear all nefia.")
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 0 | _switch_sw) {
		_switch_sw = 0
		gosub *housing_design
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 2 | _switch_sw) {
		_switch_sw = 0
		gsel 4
		repeat 8
			pos cnt \ 4 * 180, cnt / 4 * 300
			picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
		loop
		gsel 0
		snd 26
		redraw 0
		pagesize = 0
		keyrange = 0
		key_list = key_cancel
		s = lang("家の情報", "Home Value"), lang("決定ｷｰ,", "Enter key,") + strhint3
		windowshadow = 1
		display_window (windoww - 440) / 2 + inf_screenx, winposy(360), 440, 360
		display_topic lang("価値", "Value"), wx + 28, wy + 36
		display_topic lang("家宝ランク", "Heirloom Rank"), wx + 28, wy + 106
		cmbg++
		x = ww / 5 * 2
		y = wh - 80
		gmode 4, 180, 300, 50
		pos wx + ww / 4, wy + wh / 2
		grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		gosub *housing_calculateHomeValue
		s = lang("基本.", "Base"), lang("家具.", "Deco"), lang("家宝.", "Heir"), lang("総合.", "Total")
		p = gBasicPointOfHomeRank, gdata(77), gdata(78)
		p(3) = (p + p(1) + p(2)) / 3
		repeat 4
			x = wx + 45 + cnt / 2 * 190
			y = wy + 68 + cnt \ 2 * 18
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			color 0, 0, 0
			pos x, y
			mes s(cnt)
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			repeat limit(p(cnt) / 1000, 1, 10)
				color 0, 0, 0
				pos x + 35 + cnt * 13 + en * 8, y - 2
				bmes lang("★", "*"), 255, 255, 50
			loop
		loop
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		color 0, 0, 0
		listmax = 10
		gosub *label_1276
		repeat 10
			p = list(0, cnt)
			if (p == 0) {
				continue
			}
			p(1) = iImage(p) \ 1000
			gsel 1
			color 0
			boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
			if (p(1) == 528) {
				gmode 2
				pos 0, 960
				gcopy 1, 0, 768, inf_tiles, inf_tiles
				pos 0, 1008
				gzoom 22, 20, 5, chipc(0, iColor(p)) + 8, chipc(1, iColor(p)) + 4 + (chipc(3, iColor(p)) > inf_tiles) * 8, chipc(2, iColor(p)) - 16, chipc(3, iColor(p)) - 8 - (chipc(3, iColor(p)) > inf_tiles) * 10, 1
				pos 6, 974
				gcopy 1, 0, 1008, 22, 20
				gsel selcur
			} else {
				if (p(1) == 531) {
					pos 8, 1058 - chipc(3, iColor(p))
					gcopy 5, chipc(0, iColor(p)) + 8, chipc(1, iColor(p)) + 2, chipc(2, iColor(p)) - 16, chipc(3, iColor(p)) - 8
					gmode 4, , , 150
					color 0, 0, 0
					pos 0, 960 + (chipc(3, iColor(p)) == inf_tiles) * 48
					gcopy 1, 144, 768 + (chipc(3, iColor(p)) > inf_tiles) * 48, inf_tiles, chipc(3, iColor(p)) + (chipc(3, iColor(p)) > inf_tiles) * 48
					gmode 2
					gsel selcur
				} else {
					if (p(1) == 529) {
						pos 0, 1056 - chipc(3, iColor(p))
						gcopy 5, chipc(0, iColor(p)), chipc(1, iColor(p)), chipc(2, iColor(p)), chipc(3, iColor(p))
						gmode 2
						gsel selcur
					} else {
						pos 0, 960
						gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
						gfini chipi(2, p(1)), chipi(3, p(1))
						gfdec2 c_col(0, iColor(p)), c_col(1, iColor(p)), c_col(2, iColor(p))
						gsel selcur
					}
				}
			}
			pos wx + 37, cnt * 16 + wy + 138
			gmode 2, chipi(2, p(1)), chipi(3, p(1))
			grotate 1, 0, 960, 0, chipi(2, p(1)) * inf_tiles / chipi(3, p(1)), inf_tiles
			pos wx + 68, cnt * 16 + wy + 138
			mes "" + cnvrank(10 - cnt) + lang("位.", "")
			pos wx + 110, cnt * 16 + wy + 138
			mes itemname(p)
		loop
*label_0918
		redraw 1
		await cfg_wait1
		key_check
		cursor_check
		if (key == key_cancel) {
			goto *label_0919
		}
		goto *label_0918
*label_0919
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 3 | _switch_sw) {
		_switch_sw = 0
*label_0920
		txtnew
		txt -1, lang("誰を移動させる？", "Move who?")
		allyctrl = 0
		oom_posinfo = 1
		gosub *label_1187
		oom_posinfo = 0
		if (stat == (-1)) {
			goto *label_0924
		}
		tchome = stat
		tc = stat
		if (cRelationship(tc) <= (-3)) {
			if (cbit(985, tc) == 0) {
				txtnew
				txtef 9
				txt tc, cdatan(0, tc) + lang("「触るな！」", " " + cnvtalk("Don't touch me!"))
				goto *label_0924
			}
		}
		snd 20
*label_0921
		txtnew
		txt -1, lang(cdatan(0, tc) + "をどこに移動させる？", "Where do you want to move " + cdatan(0, tc) + "?")
		gosub *label_1147
		if (stat == (-1)) {
			goto *label_0923
		}
		if (chipm(7, map(tlocx, tlocy, 0)) & 4 | map(tlocx, tlocy, 1) != 0) {
			txt -1, lang("その場所には移動させることができない。", "The location is invalid.")
			goto *label_0922
		}
		tc = tchome
		map(cX(tc), cY(tc), 1) = 0
		map(tlocx, tlocy, 1) = tc + 1
		cX(tc) = tlocx
		cInitialX(tc) = tlocx
		cY(tc) = tlocy
		cInitialY(tc) = tlocy
		rowactend tc
		txtnew
		txt -1, lang(cdatan(0, tc) + "を移動させた。", cdatan(0, tc) + " " + is(tc) + " moved to the location.")
		snd 43
		goto *label_0923
*label_0922
		goto *label_0921
*label_0923
		goto *label_0920
*label_0924
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 4 | _switch_sw) {
		_switch_sw = 0
		allyctrl = 3
		gosub *ui_selectAlly
		if (stat != (-1)) {
			c = stat
			snd 20
			txtnew
			if (getworker(gCurrentMap, c) == c) {
				if (gCurrentMap == 7) {
					cCurrentMap(c) = 0
					ctalk c, 1312, c, c
					txt -1, lang(cdatan(0, c) + "の滞在を取り消した。", cdatan(0, c) + " " + is(c) + " no longer staying at your home.")
				} else {
					removeworker gCurrentMap
					if ( adata(16, gdata(20)) == 102 ) {
						ctalk c, 1297, c, c
					}
					if ( adata(16, gdata(20)) == 31 ) {
						ctalk c, 1299, c, c
					}
					txt -1, lang(cdatan(0, c) + "を役目から外した。", "You remove " + cdatan(0, c) + " from " + his(c) + " job.")
				}
				ocdata(104, c) = 0
				ocdata(80, c) = 0
			} else {
				if (gCurrentMap == 7) {
					cInitialX(c) = cX(c)
					cInitialY(c) = cY(c)
					ctalk c, 1311, c, c
					txt -1, lang(cdatan(0, c) + "を滞在させた。", cdatan(0, c) + " stay" + _s(c) + " at your home now.")
				} else {
					removeworker gCurrentMap
					if ( adata(16, gdata(20)) == 102 ) {
						ctalk c, 1296, c, c
					}
					if ( adata(16, gdata(20)) == 31 ) {
						ctalk c, 1298, c, c
					}
					txt -1, lang(cdatan(0, c) + "を任命した。", cdatan(0, c) + " take" + _s(c) + " charge of the job now.")
				}
				cCurrentMap(c) = gCurrentMap
				ocdata(80, c) = (gCurrentDungeonLevel + 1) * (-1)
			}
		}
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 5 | _switch_sw) {
		_switch_sw = 0
		txtnew
		if (cGold(0) < calcshopreform() & ncgdata(50) == 0) {
			txt -1, lang("お金が足りない…", "You don't have enough money...")
		} else {
			snd 12
			cGold(0) -= calcshopreform()
			gosub *label_N200
			if (areaId(gCurrentMap) == 104) {
				mapItemMax = limit(mapItemMax + 10, 1, 400)
				txtef 2
				txt -1, lang("倉庫を拡張した！これからは" + mapItemMax + "個のアイテムを保管できる。", "You extend your storage! You can put max of " + mapItemMax + " items now!")
			} else {
				if (areaId(gCurrentMap) == 103) {
					mapItemMax = limit(mapItemMax + 10, 1, 400)
					txtef 2
					txt -1, lang("畑を拡張した！これからは" + mapItemMax + "個のアイテムを保管できる。", "You extend your crop! You can put max of " + mapItemMax + " items now!")
				} else {
					if (areaId(gCurrentMap) == 31) {
						mapItemMax = limit(mapItemMax + 10, 1, 400)
						txtef 2
						txt -1, lang("牧場を拡張した！これからは" + mapItemMax + "個のアイテムを保管できる。", "You extend your ranch! You can put max of " + mapItemMax + " items now!")
					} else {
						mapItemMax = limit(mapItemMax + 10, 1, 400)
						txtef 2
						txt -1, lang("店を拡張した！これからは" + mapItemMax + "個のアイテムを陳列できる。", "You extend your shop! You can display max of " + mapItemMax + " items now!")
					}
				}
			}
		}
		goto *label_0925
		_switch_sw++
	}
	if (_switch_val == 6 | _switch_sw) {
		_switch_sw = 0
		txtnew
		p = 0
		repeat 188, 57
			if (cState(cnt) == 1 | cState(cnt) == 2) {
				if (cId(cnt) == 176) {
					continue
				}
				if (cRole(cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop")) {
					continue
				}
				if (cRole(cnt) != 0) {
					p++
				}
			}
		loop
		if (p >= gHomeScale + 2 + (ogdata(494) == 2) * 10 & areaId(gCurrentMap) != 104) {
			txt -1, lang("家はすでに人であふれかえっている。", "You already have too many guests in your home.")
			goto *label_0925
		}
		repeat 60
			randomize gDay + cnt
			if (rnd(2)) {
				continue
			}
			if (cnt == 0) {
				hire = 0
			} else {
				hire = rnd(length(isethire))
			}
			dbid = isethire(hire)
			randomize gDay + cnt
			flt 20
			norandomclass = 1
			isHiringServants = 1
			characreate -1, dbid, -3, 0
			isHiringServants = 0
			if (stat == 0) {
				continue
			}
			cState(rc) = 10
			cRole(rc) = isethirerole(hire)
			if (cId(rc) == 1) {
				/* 自宅雇用の判定 */
				if (guildcheck(0) == "mage" & gdata(128) / 100 == 1) {
					p = rnd(10)
				} else {
					p = rnd(9)
				}
				if (p == 0) {
					cRole(rc) = 1001
					cdatan(0, rc) = lang("武具店の" + cdatan(0, rc), cdatan(0, rc) + " of armory")
				}
				if (p == 1) {
					cRole(rc) = 1006
					cdatan(0, rc) = lang("雑貨屋の" + cdatan(0, rc), cdatan(0, rc) + " of general store")
				}
				if (p == 2) {
					cRole(rc) = 1004
					cdatan(0, rc) = lang("魔法店の" + cdatan(0, rc), cdatan(0, rc) + " of magic store")
				}
				if (p == 3) {
					cRole(rc) = 1008
					cdatan(0, rc) = lang("何でも屋の" + cdatan(0, rc), cdatan(0, rc) + " of goods store")
				}
				if (p == 4) {
					cRole(rc) = 1001
					cdatan(0, rc) = lang("武具店の" + cdatan(0, rc), cdatan(0, rc) + " of armory")
				}
				if (p == 5) {
					cRole(rc) = 1007
					cdatan(0, rc) = lang("ブラックマーケットの" + cdatan(0, rc), cdatan(0, rc) + " of blackmarket")
				}
				if (p == 6) {
					cRole(rc) = 1018
					cdatan(0, rc) = lang("おみやげ屋の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the souvenir vendor")
				}
				if (p == 7) {
					cRole(rc) = 1003
					cdatan(0, rc) = lang("パン屋の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the baker")
				}
				if (p == 8) {
					cRole(rc) = 1002
					cdatan(0, rc) = lang("食料品店の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the food vendor")
				}
				if (p == 9) {
					cRole(rc) = 1020
					cdatan(0, rc) = lang("魔法書作家の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the spell writer")
				}
				randomize
				cShopRank(rc) = rnd(15) + 1
			}
			cnt2 = cnt
			repeat 188, 57
				if (cnt == rc) {
					continue
				}
				if (cState(cnt) != 0) {
					if (cdatan(0, cnt) == cdatan(0, rc)) {
						chara_vanquish rc
					}
				}
			loop
			if (Seasonal_Check(0, 0)) {
				cId(rc) = 176
				cImage(rc) = 105
				cSex(rc) = 1
				cPortrait(rc) = -1
				cdatan(0, rc) = cdatan(0, rc) + "の妹"
				cdatan(2, rc) = "roran"
			}
		loop
		randomize
		txtnew
		txt -1, lang("誰を雇用する？", "Who do you want to hire?")
		allyctrl = 1
		gosub *label_1187
		if (stat != (-1)) {
			tc = stat
			txtnew
			if (cGold(0) < calchirecost(tc) * 20 & ncgdata(50) == 0) {
				txt -1, lang("お金が足りない…", "You don't have enough money...")
			} else {
				snd 12
				cGold(0) -= calchirecost(tc) * 20
				gosub *label_N200
				await 250
				cState(tc) = 1
				txtef 2
				if (areaId(gCurrentMap) == 104) {
					txt -1, lang(cdatan(0, tc) + "を迎えた。", "You hire " + cdatan(0, tc) + ".")
				} else {
					txt -1, lang(cdatan(0, tc) + "を家に迎えた。", "You hire " + cdatan(0, tc) + ".")
				}
				snd 64
			}
		}
		repeat 245
			if (cState(cnt) == 10) {
				chara_vanquish cnt
			}
		loop
		calccosthire
		goto *label_0925
	}
	if (_switch_val == 7 | _switch_sw) {
		_switch_sw = 0
		txtnew
		repeat 10
			if (rnd(2)) {
				continue
			}
			flt 20
			characreate -1, 205, -3, 0
			if (stat == 0) {
				continue
			}
			cState(rc) = 10
			cRole(rc) = 4
		loop
		txtnew
		txt -1, lang("どのメイドを雇用する？", "Who do you want to hire?")
		allyctrl = 1
		gosub *label_1187
		if (stat != (-1)) {
			tc = stat
			txtnew
			if (cGold(0) < calchirecost(tc) * 20 & ncgdata(50) == 0) {
				txt -1, lang("お金が足りない…", "You don't have enough money...")
			} else {
				snd 12
				cGold(0) -= calchirecost(tc) * 20
				gosub *label_N200
				await 250
				cState(tc) = 1
				txtef 2
				txt -1, lang(cdatan(0, tc) + "を街に迎えた。", "You hire " + cdatan(0, tc) + ".")
				snd 64
			}
		}
		repeat 245
			if (cState(cnt) == 10) {
				chara_vanquish cnt
			}
		loop
		goto *label_0925
	}
*label_0925
	tlocinitx = 0
	tlocinity = 0
	screenupdate = -1
	gosub *label_0623
	goto *label_0917
*label_0927
	area = -1
	if (cfg_notforsale) {
		ctrlFile 2
		dim bkmapinv, mapWidth, mapHeight
		dim bkmapsync, mapWidth, mapHeight
		memcpy bkmapinv, mapinv, 4 * mapWidth * mapHeight
		memcpy bkmapsync, mapsync, 4 * mapWidth * mapHeight
	}
	midbk = mid
	repeat 450 - 300, 300
		if (areaId(cnt) == 102) {
			area = cnt
			mid = "" + area + "_" + (100 + 1)
			gosub *label_0928
		}
	loop
	mid = midbk
	if (areaId(gCurrentMap) == 102) {
		gosub *label_0929
	}
	if (cfg_notforsale) {
		ctrlFile 1
		memcpy mapinv, bkmapinv, 4 * mapWidth * mapHeight
		memcpy mapsync, bkmapsync, 4 * mapWidth * mapHeight
	}
	return
*label_0928
	worker = getworker(area)
	if (worker == (-1)) {
		txt -1, lang("[店]店には店番がいない。", "[Shop]Your shop doesn't have a shopkeeper.")
		return
	}
	sold = 0
	income = 0, 0
	listmax = 0
	shoplv = 100 - gdata(125) / 100
	customer = 0
	repeat 3
		customer += rnd(shoplv / 3 + 5)
	loop
	customer = customer * (80 + sdata(17, worker) * 3 / 2) / 100
	if (customer < 1) {
		customer = 1
	}
	if (cfg_notforsale) {
		ctrlFile 1
	}
	if (gCurrentMap != area) {
		file = "shoptmp.s2"
		ctrlFile 4
		file = "inv_" + mid + ".s2"
		ctrlFile 3
	}
	mode = 6
	dblistmax = 0
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) <= 0) {
			continue
		}
		if (iId(cnt) == iId_shopStrongbox) {
			continue
		}
		if (iId(cnt) == iId_register) {
			continue
		}
		if (iId(cnt) == iId_manual) {
			continue
		}
		if (iId(cnt) == iId_gold) {
			continue
		}
		if (iId(cnt) == iId_shelter) {
			continue
		}
		if (iId(cnt) == iId_deedOfHome) {
			continue
		}
		if (item_isCargoGoods(cnt)) {
			continue
		}
		if (iQuality(cnt) >= iQuality_special) {
			continue
		}
		if (iValue(cnt) < 50) {
			continue
		}
		a = refitem(iId(cnt), 5, cnt)
		if (a == itemCategory_furniture) {
			continue
		}
		if (cfg_notforsale) {
			if (iX(cnt) >= 0 & iX(cnt) < mapWidth) {
				if (iY(cnt) >= 0 & iY(cnt) < mapHeight) {
					if (mapbit(3, iX(cnt), iY(cnt)) == 1) {
						continue
					}
				}
			}
		}
		if (item_isMarkedAsNoDrop(cnt)) {
			continue
		}
		dblist(0, dblistmax) = cnt, a
		dblistmax++
	loop
	repeat customer
		if (dblistmax == 0) {
			break
		}
		p = rnd(dblistmax)
		ci = dblist(0, p)
		a = dblist(1, p)
		val = calcitemvalue(ci, 2)
		val = val * int(10 + sqrt(sdata(156, worker) * 200)) / 100
		if (val <= 1) {
			continue
		}
		if (rndex(val) > shoplv * 100 + 500) {
			continue
		}
		if (iNumber(ci) <= 0) {
			continue
		}
		if (rnd(8)) {
			continue
		}
		in = rndex(iNumber(ci)) + 1
		iNumber(ci) -= in
		sold += in
		val = val * in
		if (rnd(4) == 0) {
			list(0, listmax) = refitem(iId(ci), 7, ci), iQuality(ci)
			listn(0, listmax) = str(a), str(val)
			listmax++
		} else {
			income += val
		}
		if (area == gCurrentMap) {
			repeat 245
				if (cState(cnt) != 1) {
					continue
				}
				if (cContinuousActionId(cnt) == 0 | cContinuousActionTurn(cnt) == 0) {
					continue
				}
				if (cContinuousActionItem(cnt) == ci) {
					rowactend cnt
				}
			loop
		}
	loop
	mode = 0
	if (gCurrentMap != area) {
		file = "inv_" + mid + ".s2"
		ctrlFile 4
	} else {
		file = "shoptmp.s2"
		ctrlFile 4
	}
	file = "shop" + 5 + ".s2"
	tmpload "" + file
	exist exedir + "tmp\\" + file
	if (strsize != (-1)) {
		ctrlFile 3
	} else {
		inv_getheader -1
		repeat invrange, invhead
			iNumber(cnt) = 0
		loop
	}
	mode = 6
	if (income != 0) {
		flt
		itemcreate -1, 54, -1, -1, income
	}
	repeat listmax
		cnt2 = cnt
		repeat 4
			flt list(0, cnt2), list(1, cnt2)
			flttypemajor = int(listn(0, cnt2))
			nostack = 1
			itemcreate -1, 0, -1, -1, 0
			if (stat == 0) {
				f = 0
				break
			}
			if (iValue(ci) > int(listn(1, cnt2)) * 2) {
				item_stack -1, ci
				f = 1
				break
			} else {
				iNumber(ci) = 0
				if (cnt == 3) {
					f = 0
					break
				} else {
					continue
				}
			}
		loop
		if (f == 0) {
			itemcreate -1, 54, -1, -1, int(listn(1, cnt))
			income += int(listn(1, cnt))
		} else {
			income(1)++
		}
	loop
	if (sold == 0) {
		if (cfg_hideshopresult == 0) {
			txt -1, lang("[店]" + customer + "人が来客したが、" + cdatan(0, worker) + "はアイテムを一つも売れなかった。", "[Shop]" + customer + " customers visited your shop but " + cdatan(0, worker) + " couldn't sell any item.")
		}
	} else {
		if (cfg_hideshopresult <= 1) {
			s = "" + income + lang("gold", " gold pieces")
			if (income(1) != 0) {
				s += lang("と" + income(1) + "個のアイテム", " and " + income(1) + " items")
			}
			snd 24
			txtef 5
			txt -1, lang("[店]" + customer + "人の来客があり、" + cdatan(0, worker) + "は" + sold + "個のアイテムを売却した。" + s + "が売り上げとして金庫に保管された。", "[Shop]" + customer + " customers visited your shop and " + cdatan(0, worker) + " sold " + sold + " items. " + cdatan(0, worker) + " put " + s + " in the shop strong box.")
		}
		skillexp2 156, worker, limit(int(sqrt(income)) * 6, 25, 1000)
	}
	if (sold > (110 - gdata(125) / 100) / 10) {
		modrank 5, 30, 2
	}
	mode = 0
	file = "shop" + 5 + ".s2"
	ctrlFile 4
	file = "shoptmp.s2"
	ctrlFile 3
	ccbk = cc
	cc = worker
	gosub *label_1755
	gosub *label_1756
	cc = ccbk
	return
*label_0929
	mapDensity = (100 - gdata(125) / 100) / 4 + 1
	inv_getheader -1
	repeat mapHeight
		y = cnt
		repeat mapWidth
			map(cnt, y, 4) = 0
			map(cnt, y, 9) = 0
			mapinv(cnt, y) = 0
		loop
	loop
	repeat invrange, invhead
		if (iNumber(cnt) <= 0) {
			continue
		}
		x = iX(cnt)
		y = iY(cnt)
		if (x < 0 | x >= mapWidth | y < 0 | y >= mapHeight) {
			continue
		}
		cell_refresh x, y
	loop
	return
*label_0930
	rc = 56
	fixlv = 2
	dbmode = 3
	gosub *label_2067
	dblist(val, cId(56))++
	if (fixlv == 6) {
		rtval = 70 + cLevel(56)
	} else {
		rtval = cLevel(56) / 10 + 2
		i = getcharapic(56)
		if (chipc(3, i) > inf_tiles) {
			rtval = rtval / 2 * 3 + 40
		}
		p = refchara(cId(56), 6)
		if (p < 80) {
			rtval = rtval + 80 - p
		}
	}
	if (dblist(val, cId(56)) > 1) {
		rtval /= 3
		if (rtval > 15) {
			rtval = 15
		}
	}
	return
*label_0931
	rankorg = gdata(123)
	inv_getheader -1
	rankcur = 0
	dim dblist, 2, 800
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) != 503 & iId(cnt) != 504) {
			continue
		}
		if (wpeek(map(iX(cnt), iY(cnt), 4), 0) != iImage(cnt)) {
			continue
		}
		if (iId(cnt) == 503) {
			val = 0
		} else {
			val = 1
		}
		dbid = iSubname(cnt)
		gosub *label_0930
		if (iId(cnt) == 503) {
			rankcur += rtval
		} else {
			rankcur += rtval / 2
		}
	loop
	rankcur = 10000 - int(sqrt(rankcur) * 100)
	if (rankcur < 100) {
		rankcur = 100
	}
	gdata(123) = rankcur
	if (rankorg != rankcur) {
		if (rankorg > rankcur) {
			txtef 2
		} else {
			txtef 8
		}
		txtnew
		txt -1, lang("ランク変動(" + rankn(10, 3) + " " + rankorg / 100 + "位 → " + rankcur / 100 + "位)《" + ranktitle(3) + "》", "Museum Rank:" + cnvrank(rankorg / 100) + "->" + cnvrank(rankcur / 100) + " Your museum is now known as <" + ranktitle(3) + ">.")
	}
	mapDensity = (100 - gdata(123) / 100) / 2 + 1
	return



*housing_addHeirloomValue
	a = refitem(iId(val), 5, val)
	if (a == 60000) {
		gdata(77) += limit(iValue(val) / 50, 50, 500)
	}
	p = iValue(val)
	repeat 1
		if (a == 60000) {
			p /= 20
			break
		}
		if (a == 80000) {
			p /= 10
			break
		}
		if (a == 77000) {
			p /= 10
			break
		}
		p /= 1000
	loop
	if (p > list(1, n)) {
		list(0, n) = val, p
		repeat 10
			if (list(1, cnt) < list(1, n)) {
				n = cnt
			}
		loop
	}
	return



*housing_calculateHomeValue
	if (gCurrentDungeonLevel != 1) {
		return
	}
	rankorg = gdata(124)
	inv_getheader -1
	rankcur = 0
	gdata(77) = 0
	gdata(78) = 0
	n = 0
	repeat 10
		list(0, cnt) = 0, 0
	loop
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (map(iX(cnt), iY(cnt), 5) == 363) {
			continue
		}
		val = cnt
		gosub *housing_addHeirloomValue
	loop
	repeat 10
		if (list(0, cnt) != 0) {
			gdata(78) += limit(list(1, cnt), 100, 2000)
		}
	loop
	if (gdata(77) > 10000) {
		gdata(77) = 10000
	}
	if (gdata(78) > 10000) {
		gdata(78) = 10000
	}
	rankcur = 10000 - (gBasicPointOfHomeRank + gdata(77) + gdata(78)) / 3
	if (rankcur < 100) {
		rankcur = 100
	}
	gdata(124) = rankcur
	if (rankorg != rankcur) {
		if (rankorg > rankcur) {
			txtef 2
		} else {
			txtef 8
		}
		txtnew
		txt -1, lang("家具(" + gdata(77) / 100 + "点) 家宝(" + gdata(78) / 100 + "点) ランク変動(" + rankn(10, 4) + " " + rankorg / 100 + "位 → " + rankcur / 100 + "位) 《" + ranktitle(4) + "》", "Furniture Value:" + gdata(77) / 100 + " Heirloom Value:" + gdata(78) / 100 + " Home Rank:" + cnvrank(rankorg / 100) + "->" + cnvrank(rankcur / 100) + " Your home is now known as <" + ranktitle(4) + ">.")
	}
	return



// Get breeder power.
// @param __breeder the breeder character.
// @return double the breeder power of `__breeder`.
#defcfunc cbreeder int __breeder
	// Base breeder power: [1, 1100]
	baseBreederPower@tmp = refrace(cnRace(__breeder), 9)
	percentage@tmp = 100.0
	repeat CHARA_ALL_PETS
		if (cState(cnt) != 1 & cState(cnt) != 9) {
			continue
		}
		if (ocPetJob(cnt) != sId_geneEngineering) {
			continue
		}
		percentage@tmp += sdata(sId_geneEngineering, cnt) / 2 + 1
	loop
	if (percentage@tmp != 100.0) {
		percentage@tmp += 10
	}
	nc_intb_201 = 0
	if (godcheck() == "dybony") {
		nc_intb_201 = (cPietyPoint(0) / 100) + 1
		if (ogdata(546) == 2) {
			nc_intb_201 += (cPietyPoint(0) / 50) + 1
		}
	}
	if (ogdata(544) == 2) {
		nc_intb_201 += 30
	}
	if (gettrait(0, 252)) {
		return (percentage@tmp * baseBreederPower@tmp / (100.0 + cLevel(__breeder) * 5)) + 50 + nc_intb_201
	}
	return percentage@tmp * baseBreederPower@tmp / (100.0 + cLevel(__breeder) * 5) + nc_intb_201



*label_0935
	// 繁殖数
	nc_intb_101 = 0
	// 卵
	nc_intb_102 = 0
	// 乳
	nc_intb_103 = 0
	// 鉱石
	nc_intb_104 = 0
	worker = getworker(gCurrentMap)
	livestock = 0
	geneEngineeringExperience@oor = 0
	repeat 245
		if (cState(cnt) != 1) {
			continue
		}
		if (cbit(960, cnt) == 0) {
			continue
		}
		livestock++
	loop
	repeat renewmulti
		if (worker == (-1)) {
			goto *label_0936
		}
		if (rnd(5000) > cbreeder(worker) * 100 / (100 + livestock * 20) - livestock * 2) {
			if (livestock != 0 | rnd(30) != 0) {
				goto *label_0936
			}
		}
		flt calcobjlv(cLevel(worker)), 2
		if (rnd(2)) {
			dbid = cId(worker)
		} else {
			dbid = 0
		}
		if (rnd(10) != 0) {
			fltnrace = cdatan(2, worker)
		}
		if (cId(worker) == 319 | cId(worker) == 368) {
			dbid = 176
		}
		if (dbid == 343) {
			initunid = cCnpcId(worker) + 1
		}
		nospartifact = 1
		noenchant = 1
		noencpfix = 1
		characreate -1, dbid, 4 + rnd(11), 4 + rnd(8)
		if (stat != 0) {
			cbitmod 960, rc, 1
			cBirthYear(rc) = gYear
			livestock++
			nc_intb_101++
			geneEngineeringExperience@oor += 400
		}
*label_0936
		egg = 0
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (cbit(960, cnt) == 0) {
				continue
			}
			x = rnd(11) + 4
			y = rnd(8) + 4
			if (map(x, y, 4) != 0) {
				continue
			}
			flt calcobjlv(cLevel(cnt)), 2
			p = rnd(5)
			f = 0
			if (rnd(egg + 1) > 2) {
				continue
			}
			if (livestock > 10) {
				if (rnd(4) == 0) {
					continue
				}
			}
			if (livestock > 20) {
				if (rnd(4) == 0) {
					continue
				}
			}
			if (livestock > 30) {
				if (rnd(4) == 0) {
					continue
				}
			}
			if (livestock > 40) {
				if (rnd(4) == 0) {
					continue
				}
			}
			if (p == 0) {
				if (rnd(60) == 0) {
					f = 1
				}
				if (cdatan(2, cnt) == "chicken") {
					if (rnd(20) == 0) {
						f = 1
					}
				}
				if (godcheck() == "dybony") {
					if (rnd(20) == 0) {
						f = 1
					}
				}
				if (ogdata(543) == 2) {
					if (rnd(15) == 0) {
						f = 1
					}
				}
				if (f) {
					egg++
					itemcreate -1, 573, x, y, 0
					if (stat) {
						iSubname(ci) = cId(cnt)
						if (iSubname(ci) == 343) {
							inv(33, ci) = cCnpcId(cnt)
							inv(34, ci) = createserialno(userdatan(0, cCnpcId(cnt)))
						}
						iWeight(ci) = cWeight(cnt) * 10 + 250
						iValue(ci) = limit(cWeight(cnt) * cWeight(cnt) / 10000, 200, 40000)
						nc_intb_102++
					}
				}
				continue
			}
			if (p == 1) {
				if (rnd(60) == 0) {
					f = 1
				}
				if (cdatan(2, cnt) == "sheep") {
					if (rnd(20) == 0) {
						f = 1
					}
				}
				if (cId(cnt) == 343) {
					if (userdatan(0, cCnpcId(cnt)) == "Gold sheep") {
						if (rnd(20) == 0) {
							f = 1
						}
					}
				}
				if (godcheck() == "dybony") {
					if (rnd(20) == 0) {
						f = 1
					}
				}
				if (ogdata(543) == 2) {
					if (rnd(15) == 0) {
						f = 1
					}
				}
				if (f) {
					egg++
					itemcreate -1, 574, x, y, 0
					if (stat) {
						iSubname(ci) = cId(cnt)
						if (iSubname(ci) == 343) {
							inv(33, ci) = cCnpcId(cnt)
							inv(34, ci) = createserialno(userdatan(0, cCnpcId(cnt)))
						}
					}
				}
				continue
			}
			if (p == 2) {
				if (rnd(80) == 0) {
					f = 1
				}
				if (f) {
					itemcreate -1, 575, x, y, 0
					if (stat) {
						iSubname(ci) = cId(cnt)
						if (iSubname(ci) == 343) {
							inv(33, ci) = cCnpcId(cnt)
							inv(34, ci) = createserialno(userdatan(0, cCnpcId(cnt)))
						}
						iWeight(ci) = cWeight(cnt) * 40 + 300
						iValue(ci) = limit(cWeight(cnt) * cWeight(cnt) / 5000, 1, 20000)
						nc_intb_103++
					}
				}
				continue
			}
			if (p == 3) {
				if (rnd(80) == 0) {
					f = 1
				}
				if (godcheck() == "dybony") {
					if (rnd(3) == 0) {
						f = 0
					}
				}
				if (f) {
					dbid = 222
					if (rnd(2)) {
						dbid = 45
					}
					itemcreate -1, dbid, x, y, 0
				}
				continue
			}
			if (p == 4) {
				if (cId(cnt) == 343) {
					if (userdatan(1, cCnpcId(cnt)) == "Gold sheep" | userdatan(1, cCnpcId(cnt)) == "金の羊") {
						if (rnd(10) == 0) {
							f = 1
						}
					}
					if (f) {
						egg++
						flttypemajor = 77000
						itemcreate -1, 0, x, y, 0
						nc_intb_104++
					}
				}
			}
		loop
		geneEngineeringExperience@oor += egg * 40
	loop
	repeat CHARA_ALL_PETS
		if (cState(cnt) != 1 & cState(cnt) != 9) {
			continue
		}
		if (ocPetJob(cnt) != sId_geneEngineering) {
			continue
		}
		skillexp2 sId_geneEngineering, cnt, geneEngineeringExperience@oor
	loop
	return
*label_0937
	dbid = 0
	if (oabit(17, gCurrentMap) | oabit(18, gCurrentMap)) {
		initlv = 5000
	}
	if (gCurrentMap == 21) {
		flt calcobjlv(10), calcfixlv(2)
		fltn "sf"
		return
	}
	if (mapType == 3 | mapType == 2 | areaId(gCurrentMap) == 39) {
		flt calcobjlv(10), calcfixlv(2)
		fltselect = 5
		if (gCurrentDungeonLevel == 1) {
			if (gCurrentMap == 12) {
				if (rnd(2)) {
					dbid = 269
					return
				}
			}
			if (gCurrentMap == 33) {
				if (rnd(3) == 0) {
					dbid = 270
					return
				}
			}
			if (gCurrentMap == 14) {
				if (rnd(3) == 0) {
					dbid = 271
					return
				} else {
					if (rnd(2) == 0) {
						dbid = 335
						return
					}
				}
			}
			if (gCurrentMap == 36) {
				if (rnd(3) == 0) {
					dbid = 272
					return
				}
			}
			if (gCurrentMap == 5) {
				if (rnd(2)) {
					dbid = 273
					return
				}
			}
			if (gCurrentMap == 15) {
				if (rnd(3) == 0) {
					dbid = 274
					return
				}
			}
		}
		if (gCurrentDungeonLevel >= 1) {
			if (areaId(gCurrentMap) == 39) {
				charakind = rnd(3)
				if (charakind == 0) {
					if (cFame(0) > 50000) {
						if (rnd(3) == 0) {
							dbid = 274
							return
						}
					}
				}
				if (charakind == 1) {
					if (cKarma(0) < 0) {
						if (rnd(3) == 0) {
							dbid = 271
							return
						} else {
							if (rnd(2) == 0) {
								dbid = 335
								return
							}
						}
					}
				}
				if (charakind == 2) {
					if (cPietyPoint(0) > 5000) {
						if (rnd(3) == 0) {
							dbid = 270
							return
						}
					}
				}
			}
		}
		if (gCurrentMap == 36) {
			if (gCurrentDungeonLevel == 3) {
				dbid = 289
			}
		}
		if (gCurrentMap == 14) {
			if (gCurrentDungeonLevel == 3) {
				dbid = 293
			}
		}
		if (gCurrentMap == 11) {
			if (gCurrentDungeonLevel == 3) {
				dbid = 295
			}
		}
		return
	}
	if (gCurrentMap == 3) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		if (gCurrentDungeonLevel < 4) {
			if (objlv > 5) {
				objlv = 5
			}
		}
		return
	}
	if (gCurrentMap == 42 | gCurrentMap == 210) {
		flt calcobjlv(gCurrentDungeonLevel \ 50 + 5), calcfixlv(2)
		return
	}
	if (gCurrentMap == 19) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		return
	}
	if (gCurrentMap == 17) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		fltn "undead"
		return
	}
	if (gCurrentMap == 16) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		fltn "fire"
		return
	}
	if (gCurrentMap == 18) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		if (rnd(2) == 0) {
			fltn "man"
		}
		return
	}
	if (gCurrentMap == 37) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		flttypemajor = 13
		return
	}
	if (gCurrentMap == 10 | gCurrentMap == 20) {
		flt calcobjlv(20), calcfixlv(2)
		fltselect = 4
		return
	}
	if (gCurrentMap == 13) {
		if (gExecutingImmediateQuestType >= 1000) {
			flt calcobjlv(qdata(5, gExecutingImmediateQuest) + 1), calcfixlv(2)
		}
		if (gExecutingImmediateQuestType == 1006) {
			fltn "wild"
			objlv = limit(objlv / 4, 1, 8)
		} else {
			if (gExecutingImmediateQuestType == 1001) {
				if (oqdata(0, rq)) {
					fltn csetfamily(0, oqdata(0, rq))
				}
			}
		}
		return
	}
	if (areaId(gCurrentMap) == 28) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		if (rnd(2)) {
			fltn "yeek"
		}
		return
	}
	if (areaId(gCurrentMap) == 38) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		if (rnd(2)) {
			fltn "mino"
		}
		return
	}
	if (gCurrentMap == 58) {
		flt calcobjlv(gCurrentDungeonLevel), calcfixlv(2)
		fltn "wild"
		return
	}
	if (gCurrentMap == 60) {
		flt calcobjlv(gCurrentDungeonLevel)
		if (gCurrentDungeonLevel != areaLastFloor(gCurrentMap)) {
			fixlv = 5
		}
		return
	}
	if (mapType >= 20) {
		fixobjlv = 1
		if (oabit(7, gCurrentMap)) {
			fixobjlv = 3
		}
		if (oabit(5, gCurrentMap)) {
			flt gCurrentDungeonLevel * fixobjlv, calcfixlv(3)
			if (rnd(4)) {
				fltnrace = "dragon"
			} else {
				fltnrace = "giant"
			}
		} else {
			flt calcobjlv(gCurrentDungeonLevel * fixobjlv), calcfixlv(2)
		}
		if (oabit(14, gCurrentMap)) {
			if (rnd(3) == 0) {
				fixlv = 4
			}
		}
		if (oabit(3, gCurrentMap)) {
			dbid = 323
		} else {
			if (oabit(6, gCurrentMap)) {
				gosub *label_1758
			} else {
				if (oabit(8, gCurrentMap)) {
					if (rnd(3)) {
						p = rnd(4)
						if (p == 0 | boss == 1) {
							fltnrace = "lich"
						} else {
							if (p == 1) {
								fltnrace = "imp"
							} else {
								if (p == 2) {
									fltnrace = "fairy"
								} else {
									if (p == 3) {
										fltnclass = "wizard"
									}
								}
							}
						}
					}
				} else {
					if (oabit(0, gCurrentMap)) {
						if (rnd(3)) {
							fltnclass = "warrior"
						}
					} else {
						if (oabit(11, gCurrentMap)) {
							if (getfactionvalue(gCurrentMap - 450 + 245, "family") != "") {
								fltn refstr
							} else {
								fltnrace = getfactionvalue(gCurrentMap - 450 + 245, "race")
							}
						} else {
							if (oabit(12, gCurrentMap)) {
								fltselect = 10
							} else {
								if (oabit(10, gCurrentMap)) {
									if (rnd(5)) {
										olist = 73, 76, 77, 1, 320, 70, 74, 69, 41, 206, 326, 39, 39, 16, 16, 347, 347, 72, 176
										dbid = olist(rnd(19))
										initlv = 1 + rndex(1 + objlv)
									} else {
										fltn "man"
									}
								} else {
									if (oabit(16, gCurrentMap)) {
										if (rnd(3)) {
											fltn "thief"
										} else {
											fltnclass = "thief"
										}
									}
								}
							}
						}
					}
				}
			}
		}
		return
	}
	if (areaId(gCurrentMap) == 101 | areaId(gCurrentMap) == 102) {
		flt calcobjlv(100), calcfixlv(2)
		if (rnd(1)) {
			fltselect = 5
		} else {
			fltselect = 7
		}
		return
	}
	flt calcobjlv(difficulty()), calcfixlv(2)
	return
*label_0938
	if (areaId(gCurrentMap) == 101 | areaId(gCurrentMap) == 102) {
		if (gCrowdDensity < mapDensity / 2) {
			if (rnd(2) == 0) {
				gosub *label_0937
				characreate -1, dbid, -2, 0
				if (stat) {
					gosub *label_1759
				}
			}
		}
	}
	if (areaId(gCurrentMap) == 39) {
		if (ogdata(gCurrentDungeonLevel) > 10) {
			if (ogdata(gCurrentDungeonLevel + 10) < 15) {
				if (rnd(2) == 0) {
					gosub *label_0937
					characreate -1, dbid, -2, 0
					if (stat) {
						gosub *label_1759
					}
					ogdata(gCurrentDungeonLevel + 10)++
				}
			}
		}
	}
	if (mapDensity == 0) {
		return
	}
	if (gCrowdDensity < mapDensity) {
		if (rnd(limit(8 / (mapDensity / (gCrowdDensity + 1)), 2, 8)) == 0) {
			gosub *label_0937
			characreate -1, dbid, -2, 0
			if (stat) {
				gosub *label_1759
			}
		}
	}
	return
*label_0939
	oomSEST_log "map_exit"
	memset junban, 0, 980
	gLeftMinutesOfExecutingQuest = 0
	gdata(171) = 0
	if (mapType == 5) {
		if (cfg_extrahelp) {
			if (gdata(200 + 1) == 0) {
				if (mode == 0) {
					if (cContinuousActionTurn(0) == 0) {
						gdata(200 + 1) = 1
						ghelp = 1
						gosub *label_1575
					}
				}
			}
		}
	}
	if (mapType == 7) {
		rq = gExecutingImmediateQuest
		gosub *label_1547
	}
	msg_newline
	msgtemp = "  "
	if (gCurrentMap == 35 | gCurrentMap == 6 | gCurrentMap == 40 | gCurrentMap == 49) {
		usermapid = 0
	}
	rdtry = 0
	fixstart = 0
	if (areaId(gCurrentMap) == 8) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (areaHasBeenConquered(gCurrentMap) > 0) {
				chara_vanquish areaHasBeenConquered(gCurrentMap)
				areaHasBeenConquered(gCurrentMap) = -1
			}
		}
	}
	gPreviousMap = gCurrentMap
	if (gPreviousMap == 30) {
		gCurrentMap = gPreviousMap2
		gCurrentDungeonLevel = gPreviousDungeonLevel
		mapstartx = gPreviousX
		mapstarty = gPreviousY
		gEntranceType = 7
		fixstart = 1
		levelexitby = 5
	}
	if (levelexitby == 4) {
		cell_featread cX(0), cY(0)
		if (gCurrentMap == 7 | areaId(gCurrentMap) == 39) {
			if (movelevelbystairs == 2) {
				if (mapitemfind(cX(cc), cY(cc), 751) != (-1)) {
					feat(1) = 11, 0
				}
			}
			if (movelevelbystairs == 1) {
				if (mapitemfind(cX(cc), cY(cc), 750) != (-1)) {
					feat(1) = 10, 0
				}
			}
		}
		f = 0
		if (feat(1) == 11) {
			msgtemp += lang("階段を降りた。", "You walk down the stairs. ")
			f = 1
			gEntranceType = 1
			mapDownstairs = cY(0) * 1000 + cX(0)
			if (feat(2) == 0) {
				gCurrentDungeonLevel++
				gCurrentDungeonLevel -= (areaEntranceType(gCurrentMap) == 2) * 2
			} else {
				gCurrentDungeonLevel = feat(2)
			}
		}
		if (feat(1) == 10) {
			msgtemp += lang("階段を昇った。", "You walk up the stairs. ")
			f = 1
			gEntranceType = 2
			mapUpstairs = cY(0) * 1000 + cX(0)
			if (feat(2) == 0) {
				gCurrentDungeonLevel--
				gCurrentDungeonLevel += (areaEntranceType(gCurrentMap) == 2) * 2
			} else {
				gCurrentDungeonLevel = feat(2)
			}
		}
		if (f == 0) {
			if (mapType == 1) {
				gPcXInWorldMap = cX(cc)
				gPcYInWorldMap = cY(cc)
				gCurrentDungeonLevel = 1
				if (feat(2) != 0 | feat(3) != 0) {
					gCurrentMap = feat(2) + feat(3) * 100
					if (areaId(gCurrentMap) == 42) {
						if (itemfind(0, 742) == (-1)) {
							txt -1, lang("あなたはこの洞窟の探索を許可されていない。", "You are not permitted to explore this dungeon.")
							msg_halt
							gCurrentMap = 2
						}
					}
					if (areaId(gCurrentMap) == 37) {
						if (gdata(250 + 212) == 0) {
							txt -1, lang("あなたはピラミッドへの招待状を持っていない。", "You don't have an invitation.")
							msg_halt
							gCurrentMap = 2
						}
					}
					if (areaId(gCurrentMap) == 41) {
						txt -1, lang("あなたはガードに追い返された。", "The guards turn you away from the jail.")
						msg_halt
						gCurrentMap = 2
					}
					if (oabit(13, gCurrentMap)) {
						if (areaHasBeenConquered(gCurrentMap) == (-1)) {
							txt -1, lang("この洞窟は不思議なバリアで塞がれている。", "This dungeon is sealed by a mysterious barrier.")
							msg_halt
							gCurrentMap = 2
						}
					}
				} else {
					gCurrentMap = 2
				}
				if (feat(1) != 15) {
					gCurrentMap = 2
				}
			}
			if (mapType == 3 | mapType == 4 | mapType == 5 | mapType == 6 | mapType == 2) {
				gCurrentMap = gdata(850)
			}
		}
		if (mapType >= 20 | mapType == 6) {
			if (gCurrentDungeonLevel < areaDangerLevel(gCurrentMap)) {
				gCurrentMap = gdata(850)
			}
		}
		if (areaType(gCurrentMap) == 3) {
			if (gCurrentMap == gPreviousMap) {
				if (gCurrentDungeonLevel == 1) {
					msgtemp += lang(mapname(gCurrentMap) + "の表層に戻った。", "You returned to the surface of " + mapname(gCurrentMap))
				} else {
					msgtemp += lang(mapname(gCurrentMap) + "の表層を後にした。", "You left the surface of " + mapname(gCurrentMap) + ".")
				}
			}
		}
	}
	if (mapType == 7) {
		gCurrentMap = gPreviousMap2
		gCurrentDungeonLevel = gPreviousDungeonLevel
		mapstartx = gPreviousX
		mapstarty = gPreviousY
		gEntranceType = 7
		fixstart = 1
	}
	if (ogdata(24) == 1) {
		gosub *label_1665
	}
	if (ogdata(28)) {
		ogdata(28) = 0
		tc = findchara(210, 6)
		if (tc != 0) {
			del_chara tc
		}
	}
	if (ogdata(24) == 2) {
		ogdata(24) = 0
		gdata(73) = 3
		gExecutingImmediateQuestType = 0
		ogdata(60) = 0
		if (findchara(263, 6)) {
			chara_vanquish stat
		}
	}
	if (ogdata(29)) {
		f = 0
		repeat 188, 57
			if (cState(cnt) != 1) {
				continue
			}
			if (cRelationship(cnt) > (-3)) {
				continue
			}
			s = getfactionvalue(cnt, "guild")
			if (s == "") {
				continue
			}
			if (getfactionvalue(0, "guild") == s) {
				continue
			}
			chara_vanquish cnt
			f = 1
		loop
		if (f) {
			modrank 8, -500
			msg_halt
		}
		ogdata(29) = 0
	}
	if (levelexitby == 2) {
		gCurrentMap = gDestinationMap
		gCurrentDungeonLevel = gDestinationDungeonLevel
		if (gExecutingImmediateQuestType == 0) {
			if (gPreviousMap != 2) {
				gPcXInWorldMap = areaX(gCurrentMap)
				gPcYInWorldMap = areaY(gCurrentMap)
				gosub *label_1610
			}
		}
		if (gCurrentMap == 41) {
			mapstartx = 29
			mapstarty = 3
			gEntranceType = 7
			fixstart = 1
		}
		if (gCurrentMap == 200) {
			mapstartx = 19
			mapstarty = 19
			gEntranceType = 7
			fixstart = 1
		}
	}
	if (cState(0) == 0) {
		rc = 0
		gosub *label_0740
		gCurrentMap = 7
		gdata(850) = areaOuterMap(7)
		gCurrentDungeonLevel = 1
	}
	if (rdtry > 1) {
		msgtemp += "(再生成" + rdtry + "回)"
	}
	if (gCurrentMap != gPreviousMap) {
		if (mapType == 3 | gDepartureDate == 0 | gPreviousMap == 7 | mapType == 2) {
			gDepartureDate = getgametime()
			gDistanceBetweenTown = 0
			gLeftTownMap = gPreviousMap
		}
		if (areaType(gCurrentMap) != 1 & areaType(gCurrentMap) != 4 & gCurrentMap != 35) {
			autosave = 1 * (gCurrentMap != 35)
			if (cfg_noautosave > 1 & gettrait(0, 190) == 0) {
				autosave = 0
			}
		}
		if (mapType != 1) {
			if (mapType != 4 | mapType == 5) {
				if (fixtransfermap == 0) {
					gPcXInWorldMap = areaX(gPreviousMap)
					gPcYInWorldMap = areaY(gPreviousMap)
				} else {
					fixtransfermap = 0
				}
			}
		}
		if (fixstart == 0) {
			gEntranceType = areaEntranceType(gCurrentMap)
		}
		if (evfind(6)) {
			msgtemp += lang("あなたは家まで運ばれた。", "You were delivered to your home.")
			gosub *label_1610
		} else {
			if (areaType(gPreviousMap) == 1) {
				msgtemp += lang(mapname(gCurrentMap) + "に入った。", "You entered " + mapname(gCurrentMap) + ".")
			} else {
				if (mapType == 7) {
					msgtemp += lang(mapname(gCurrentMap) + "に戻った。", "You returned to " + mapname(gCurrentMap))
				} elseif (areaId(gCurrentMap) != 200) {
					msgtemp += lang(mapname(gPreviousMap) + "を後にした。", "You left " + mapname(gPreviousMap) + ".")
				} else {
					msgtemp += lang("クリップルタウンを後にした。", "You left Town of Void.")
				}
			}
		}
		if (areaType(gCurrentMap) == 1 | areaType(gCurrentMap) == 4) {
			if (godcheck() == "serria") {
				if (gCargoWeight > gCurrentCartLimit * 3) {
					msgtemp += lang("荷車の重量超過でかなり鈍足になっている！ ", "The weight of your cargo burdens your traveling speed.")
				} else {
					if (gCargoWeight * 3 / 2 > gCurrentCartLimit * 3) {
						msgtemp += lang("荷車の重量で鈍足になっている。 ", "The weight of your cargo burdens your traveling speed.")
					} else {
						if (gCargoWeight * 2 > gCurrentCartLimit * 3) {
							msgtemp += lang("荷車の重量で少し鈍足になっている… ", "The weight of your cargo burdens your traveling speed.")
						}
					}
				}
			} else {
				if (gCargoWeight > gCurrentCartLimit) {
					msgtemp += lang("荷車の重量超過でかなり鈍足になっている！ ", "The weight of your cargo burdens your traveling speed.")
				} else {
					if (gCargoWeight * 3 / 2 > gCurrentCartLimit) {
						msgtemp += lang("荷車の重量で鈍足になっている。 ", "The weight of your cargo burdens your traveling speed.")
					} else {
						if (gCargoWeight * 2 > gCurrentCartLimit) {
							msgtemp += lang("荷車の重量で少し鈍足になっている… ", "The weight of your cargo burdens your traveling speed.")
						}
					}
				}
			}
		}
	}
	if (oabit(13, gCurrentMap)) {
	}
	if (gCurrentMap == 25) {
		if (gCurrentDungeonLevel == 2) {
			gCurrentMap = 26
			gCurrentDungeonLevel = areaLastFloor(gCurrentMap) - 1
			gEntranceType = 1
			msgtemp += lang("マウンテンパスに降りた。", "You entered the Mountain Pass.")
		}
	}
	if (gCurrentMap == 26) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			gCurrentMap = 25
			gCurrentDungeonLevel = 1
			gEntranceType = 2
			msgtemp += lang("ラーナの村に辿りついた。", "You reached the town of Larna.")
		}
	}
	repeat 16
		cHate(cnt) = 0
		unlockson cnt
		rowactend cnt
		if (cState(cnt) != 1) {
			if (cState(cnt) == 8) {
				cState(cnt) = 1
			}
			continue
		}
		map(cX(cnt), cY(cnt), 1) = 0
		if (cnt != 0) {
			if (cCurrentMap(cnt) != 0) {
				cState(cnt) = 9
			}
		}
	loop
	if (mapIsFixed == 1) {
		gosub *label_0941
	} else {
		gosub *label_0940
		tmpload "mdata_" + mid + ".s2"
		exist exedir + "tmp\\mdata_" + mid + ".s2"
		if (strsize != (-1)) {
			ctrlFile 11
		}
		repeat 188, 57
			if (cState(cnt) != 0) {
				modnpcmemory 1, cnt, -1
			}
		loop
		//repeat 5480 - 1320, 1320
		//	if (iNumber(cnt) != 0) {
		//	}
		//loop
	}
	mode = 2
	goto *label_0942
*label_0940
	repeat 57
		rowactend cnt
		cItemWhichWillBeUsed(cnt) = 0
	loop
	repeat 40 - 1, 16
		if (cState(cnt) == 1) {
			map(cX(cnt), cY(cnt), 1) = 0
			cState(cnt) = 3
		}
	loop
	return
*label_0941
	gosub *label_0940
	repeat mapHeight
		y = cnt
		repeat mapWidth
			map(cnt, y, 7) = 0
		loop
	loop
	ctrlFile 2
	file = "inv_" + mid + ".s2"
	ctrlFile 4
	return
*label_0942
	oomSEST_log "map_init"
	mapupdate = 0
	dim mondmg, 16, 20
	sdim mondmgn, 20, 20
	mondmgcnt = 0
	dim txtpopup, 16, 20
	sdim txtpopupn, 1000
	txtpopupcnt = 0
	if (gCurrentDungeonLevel > areaLastFloor(gCurrentMap)) {
		gCurrentDungeonLevel = areaLastFloor(gCurrentMap)
	}
	if (gCurrentDungeonLevel < areaDangerLevel(gCurrentMap)) {
		gCurrentDungeonLevel = areaDangerLevel(gCurrentMap)
	}
	if (gDeepestDungeonLevel < gCurrentDungeonLevel) {
		if (gCurrentMap != 30) {
			gDeepestDungeonLevel = gCurrentDungeonLevel
		}
	}
	if (areaVisitedDeepestFloor(gCurrentMap) < gCurrentDungeonLevel) {
		areaVisitedDeepestFloor(gCurrentMap) = gCurrentDungeonLevel
	}
	repeat 16
		if (cnt == 0) {
			continue
		}
		if (cCurrentMap(cnt) != 0) {
			if (cCurrentMap(cnt) == gCurrentMap) {
				if (cState(cnt) == 9) {
					cState(cnt) = 1
				}
			}
		}
	loop
	if (cfg_floormove == 1) {
		repeat 16, 1
			if (cCurrentMap(cnt) == gCurrentMap) {
				if (ocdata(80, cnt) != 0) {
					if (ocdata(80, cnt) != (gCurrentDungeonLevel + 1) * (-1)) {
						cState(cnt) = 9
					}
				}
			}
		loop
	}
	mid = "" + gCurrentMap + "_" + (100 + gCurrentDungeonLevel)
	if (mode == 3) {
		memset ocdata(0, 57), 0, 245000 - 57000
		ctrlFile 1
		file = "inv_" + mid + ".s2"
		ctrlFile 3
		goto *label_0945
	}
	getkey a, 8
	if (a) {
		tmpload "mdata_" + mid + ".s2"
		exist exedir + "tmp\\mdata_" + mid + ".s2"
		if (strsize != (-1)) {
			dialog lang("　　　　　　　　　　　　 マップを初期化しますか？\n　　( 黄金 )　　　　　　（注：ゲームに影響が出る可能性があります。\n＿(__つ/￣￣￣/＿　エラーが出てマップが読み込めない場合のみ、\n　　＼/　　 　　/　　　必ず元のセーブのバックアップをとった上で実行してください。）", "Initialize this map? (Warning, only do this if an error occurs when loading this map. Make sure make a backup of the current save folder before doing this.)"), 3
			if (stat == 6) {
				ctrlFile 11
			}
		}
	}
	tmpload "mdata_" + mid + ".s2"
	exist exedir + "tmp\\mdata_" + mid + ".s2"
	if (strsize != (-1)) {
		memset ocdata(0, 57), 0, 245000 - 57000
		ctrlFile 1
		if (mapIsFixed == 0 | oabit(13, gCurrentMap)) {
			goto *label_0943
		}
		if (mdata(19) != gdata(184) | (gdata(79) == 1 & mapType == 1 & areaId(gCurrentMap) != 47)) {
			if (mapType == 3 | mapType == 2 | mapType == 6 | mapType == 1) {
				mapupdate = 1
				goto *label_0943
			}
		}
		file = "inv_" + mid + ".s2"
		ctrlFile 3
		if (mode == 2) {
			map_placeplayer
		}
		goto *label_0944
	}
*label_0943
	oomSEST_log "map_init_main"
	if (mapupdate == 1) {
		oomSEST_log "map_init_mapUpdate"
		maxnpcbk = 0
		dim rolebk, 2, 245
		repeat 245
			if (cState(cnt) == 0) {
				continue
			}
			if (chara_isShopKeeper(cnt)) {
				rolebk(0, maxnpcbk) = cRole(cnt), cShopRank(cnt)
				maxnpcbk++
			}
		loop
		maxmedal = 0
		dim medalbk, 2, 30
		repeat mapHeight
			y = cnt
			repeat mapWidth
				x = cnt
				if (map(x, y, 6) / 1000 \ 100 == 32) {
					if (maxmedal < 30) {
						medalbk(0, maxmedal) = x, y
						maxmedal++
					}
				}
			loop
		loop
	}
	mapTimeOfNextRegeneration = 0
	repeat 188, 57
		cState(cnt) = 0
	loop
	repeat 5480 - 1320, 1320
		iNumber(cnt) = 0
	loop
	dim mdata, 100
	mdata(11) = gCurrentDungeonLevel
	mapTileSet = areaTileSet(gCurrentMap)
	mapTileType = areaTileType(gCurrentMap)
	mapType = areaType(gCurrentMap)
	mapTurnCost = areaTurnCost(gCurrentMap)
	mapIsFixed = areaIsFixed(gCurrentMap)
	mapDefaultAiCalm = areaDefaultAiCalm(gCurrentMap)
	mapIndoorOrOutdoor = areaIndoorOrOutdoor(gCurrentMap)
	if (mapupdate) {
		randomize gRandomSeed + gCurrentMap * 1000 + gCurrentDungeonLevel
	}
	if (gCurrentMap == 7) {
		if (mdatan(0) == "" | mdatan(0) == lang("ノースティリス", "North Tyris")) {
			mdatan(0) = lang("わが家", "Your Home")
		}
	} else {
		mdatan(0) = mapname(gCurrentMap)
	}
	if (gCurrentMap == 30) {
		if (gCurrentDungeonLevel == 1) {
			map_initcustom "shelter_2"
			mapIsFixed = 0
			mapType = 6
			if (rnd(50) == 0) {
				repeat 188, 57
					if (cState(cnt) != 0) {
						cState(cnt) = 0
						cRole(cnt) = 0
						map(cX(cnt), cY(cnt), 1) = 0
					}
				loop
				repeat rnd(5) + 5
					flt
					characreate -1, 176, -3, 0
					cRelationship(rc) = 0
					cOriginalRelationship(rc) = 0
				loop
			}
		} else {
			map_initcustom "shelter_1"
			mdata(15) = 0
		}
		mapDensity = 0
		mapItemMax = 5
		map_placeplayer
		mapBgm = 68
	}
	if (areaId(gCurrentMap) == 8) {
		gosub *label_0898
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			evadd 4
		}
	}
	if (areaId(gCurrentMap) == 35) {
		file = "" + userfile
		id = 0
		gosub *label_1320
		ctrlFile 19
		repeat mapHeight
			y = cnt
			repeat mapWidth
				x = cnt
				map(x, y, 1) = 0
			loop
		loop
		importmode = 0
		ctrlFile 21
		mapDensity = 0
		mapIsFixed = 0
		mdata(15) = 0
		mapType = 7
		mapTurnCost = 10000
		gdata(73) = 3
		inv_getheader -1
		repeat invrange, invhead
			if (iId(cnt) >= maxitemid - 2 | iId(cnt) > length(ioriginalnameref)) {
				iNumber(cnt) = 0
				cell_refresh iX(cnt), iY(cnt)
				continue
			}
			if (iNumber(cnt) > 0) {
				iOwnState(cnt) = 5
			}
		loop
		gosub *custom_cleanUpTemporaryFiles
		evadd 19
		map_placeplayer
	}
	if (areaId(gCurrentMap) == 101) {
		map_initcustom "museum_1"
		mapBgm = 53
		map_placeplayer
		mdata(15) = 0
		flt
		itemcreate -1, 24, 15, 17, 0
		iParam1(ci) = 4
	}
	if (areaId(gCurrentMap) == 102) {
		map_initcustom "shop_1"
		mapBgm = 53
		mapItemMax = 10
		map_placeplayer
		mdata(15) = 0
		flt
		itemcreate -1, 24, 17, 14, 0
		iParam1(ci) = 8
		flt
		itemcreate -1, 561, 19, 10, 0
		iCount(ci) = 5
		flt
		itemcreate -1, 562, 17, 11, 0
	}
	if (areaId(gCurrentMap) == 103) {
		map_initcustom "crop_1"
		mapBgm = 68
		map_placeplayer
		mapItemMax = 80
		mdata(15) = 0
		flt
		itemcreate -1, 24, 14, 5, 0
		iParam1(ci) = 9
	}
	if (areaId(gCurrentMap) == 31) {
		map_initcustom "ranch_1"
		mapBgm = 68
		map_placeplayer
		mapItemMax = 80
		mdata(15) = 0
		flt
		itemcreate -1, 24, 23, 8, 0
		iParam1(ci) = 11
		flt
		itemcreate -1, 562, 22, 6, 0
	}
	if (areaId(gCurrentMap) == 39) {
		if (gCurrentDungeonLevel == 0) {
			gosub *label_0907
		} else {
			map_initcustom "dungeon1"
			mapBgm = 68
			map_placeplayer
			mapItemMax = 350
			mdata(15) = 0
			if (gCurrentDungeonLevel == 1) {
				flt
				itemcreate -1, 24, 39, 54, 0
				iParam1(ci) = 15
			} else {
				flt
				itemcreate -1, 219, cX(0), cY(0), 0
			}
		}
	}
	if (areaId(gCurrentMap) == 104) {
		if (areaOuterMap(gCurrentMap) != 47) {
			map_initcustom "storage_1"
			mapItemMax = 200
		} else {
			map_initcustom "dungeon1"
			mapItemMax = 400
		}
		mapBgm = 68
		map_placeplayer
		mdata(15) = 0
	}
	if (gCurrentMap == 13) {
		gosub *label_0898
	}
	if (gCurrentMap == 9) {
		mapWidth = 16
		mapHeight = 16
		mapDensity = 0
		map_initialize
		repeat mapHeight
			p = cnt
			repeat mapWidth
				map(cnt, p, 0) = tile_default + (rnd(tile_default(2)) == 0) * rnd(tile_default(1))
			loop
		loop
		map_placeplayer
		repeat rqop(1)
			flt
			characreate -1, rqop, cX(0), cY(0) + 5
		loop
		if (dbg_friend) {
			repeat rqop(1)
				flt
				characreate 3, rqop - 1, cX(0), cY(0)
				cRelationship(rc) = 10
			loop
		}
		repeat 280
		loop
		repeat 100
			x = rnd(mapWidth)
			y = rnd(mapHeight)
		loop
		flt
		characreate -1, 41, cX(0), cY(0)
		cRole(rc) = 22
		cbitmod 960, rc, 1
		repeat 6 + rnd(6)
		loop
	}
	if (gCurrentMap == 10) {
		map_initcustom "grave_1"
		mapDensity = 7
		mapBgm = 79
		map_placeplayer
		repeat mapDensity / 2
			gosub *label_0937
			characreate -1, 0, -3, 0
			if (stat) {
				gosub *label_1759
			}
		loop
		if (itemfind(-1, 171) != -1) {
			ibitmod 5, stat, 1
		}
	}
	if (gCurrentMap == 41) {
		map_initcustom "jail1"
		mapDensity = 0
		mapBgm = 79
		map_placeplayer
	}
	if (gCurrentMap == 20) {
		map_initcustom "shrine_1"
		mapDensity = 10
		flt
		itemcreate -1, 171, 10, 8, 0
		iParam1(ci) = 1
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		itemcreate -1, 171, 13, 8, 0
		iParam1(ci) = 2
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		itemcreate -1, 171, 10, 13, 0
		iParam1(ci) = 5
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		itemcreate -1, 171, 13, 13, 0
		iParam1(ci) = 4
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		itemcreate -1, 171, 20, 8, 0
		iParam1(ci) = 3
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		itemcreate -1, 171, 23, 8, 0
		iParam1(ci) = 7
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		itemcreate -1, 171, 20, 13, 0
		iParam1(ci) = 6
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		itemcreate -1, 171, 23, 13, 0
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		mapBgm = 79
		map_placeplayer
		repeat mapDensity / 2
			gosub *label_0937
			characreate -1, 0, -3, 0
			if (stat) {
				gosub *label_1759
			}
		loop
	}
	if (gCurrentMap == 32) {
		map_initcustom "office_1"
		mapDensity = 0
		flt
		characreate -1, 173, 9, 2
		cRole(rc) = 1012, 10
		flt
		characreate -1, 173, 15, 2
		cRole(rc) = 1012, 10
		flt
		characreate -1, 173, 21, 2
		cRole(rc) = 1013, 10
		flt
		characreate -1, 173, 3, 2
		cRole(rc) = 1013, 10
		repeat 3
			flt
			characreate -1, 16, -3, 0
			cRole(rc) = 4
			flt
			characreate -1, 39, -3, 0
			cRole(rc) = 4
		loop
		repeat 4
			flt
			characreate -1, 77, 3 + cnt * 6, 9
			cRole(rc) = 14
		loop
		mapBgm = 79
		map_placeplayer
	}
	if (gCurrentMap == 48) {
		// フェアリゾート関所
		map_initcustom "nc_fairyzort_barrier"
		mapDensity = 0
		// 宿屋の店主
		flt
		characreate -1, 1, 3, 7
		cRole(rc) = 1005, 8
		sninn cdatan(0, rc)
		cAiCalm(rc) = 3
		// バーテンダー
		flt
		characreate -1, 70, 5, 10
		cRole(rc) = 9
		// 情報屋
		flt
		characreate -1, 69, 13, 13
		cRole(rc) = 8
		cAiCalm(rc) = 3
		// 癒し手
		flt
		characreate -1, 74, 21, 11
		cRole(rc) = 12
		// 何でも屋
		flt
		characreate -1, 1, 13, 15
		cRole(rc) = 1008, 10
		sngoods cdatan(0, rc)
		cAiCalm(rc) = 3
		// 魔道具店
		flt
		characreate -1, 41, 15, 15
		cRole(rc) = 1004, 11
		snmagic cdatan(0, rc)
		//キャラバンの隊長
		flt
		characreate -1, 353, 19, 2
		cRole(rc) = 23
		//モルフィ
		flt
		characreate -1, 381, 25, 3
		cRole(rc) = 3112, 100
		cShopStoreId(rc) = 3112
		mapBgm = 92
		map_placeplayer
		evadd 30
	}
	if (gCurrentMap == 43) {
		map_initcustom "station-nt1"
		mapDensity = 0
		flt
		characreate -1, 1, 7, 23
		cRole(rc) = 1006, 10
		sngeneral cdatan(0, rc)
		cAiCalm(rc) = 3
		flt
		characreate -1, 1, 5, 17
		cRole(rc) = 1009, 12
		sntrade cdatan(0, rc)
		cAiCalm(rc) = 3
		flt
		characreate -1, 1, 16, 19
		cRole(rc) = 1005, 8
		sninn cdatan(0, rc)
		flt
		characreate -1, 70, 17, 13
		cRole(rc) = 9
		flt
		characreate -1, 353, 7, 3
		cRole(rc) = 23
		flt
		characreate -1, 69, 16, 20
		cRole(rc) = 8
		cAiCalm(rc) = 3
		flt
		repeat 2
			flt
			characreate -1, 9, -3, 0
			flt
			characreate -1, 159, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			flt
			characreate -1, 160, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			flt
			characreate -1, 161, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1

		loop
		flt
		characreate -1, 77, 5, 7
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 8, 7
		cRole(rc) = 14
		cAiCalm(rc) = 3
		mapBgm = 79
		map_placeplayer
	}
	if (gCurrentMap == 45) {
		// map_initcustom "station-st1"
		map_initcustom "station-nt1"
		mapDensity = 0
		flt
		characreate -1, 1, 7, 23
		cRole(rc) = 1006, 10
		sngeneral cdatan(0, rc)
		cAiCalm(rc) = 3
		flt
		characreate -1, 1, 5, 17
		cRole(rc) = 1009, 12
		sntrade cdatan(0, rc)
		cAiCalm(rc) = 3
		flt
		characreate -1, 1, 16, 19
		cRole(rc) = 1005, 8
		sninn cdatan(0, rc)
		flt
		characreate -1, 70, 17, 13
		cRole(rc) = 9
		flt
		characreate -1, 353, 7, 3
		cRole(rc) = 23

		characreate -1, 69, 16, 20
		cRole(rc) = 8
		cAiCalm(rc) = 3
		flt
		repeat 2
			flt
			characreate -1, 9, -3, 0
			flt
			characreate -1, 159, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			flt
			characreate -1, 160, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			flt
			characreate -1, 161, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		loop
		flt
		characreate -1, 77, 5, 7
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 8, 7
		cRole(rc) = 14
		cAiCalm(rc) = 3
		mapBgm = 79
		map_placeplayer
	}

	if (gCurrentMap == 46) {
		map_initcustom "inn1"
		mapDensity = 0
		flt
		characreate -1, 1, 19, 10
		cRole(rc) = 1005, 8
		sninn cdatan(0, rc)
		flt
		characreate -1, 351, 26, 16
		cRole(rc) = 3
		cAiCalm(rc) = 3
		flt
		characreate -1, 35, 25, 15
		cAiCalm(rc) = 3
		flt
		characreate -1, 35, 25, 17
		cAiCalm(rc) = 3
		flt
		characreate -1, 35, 27, 18
		cAiCalm(rc) = 3
		flt
		characreate -1, 35, 27, 16
		cAiCalm(rc) = 3
		flt
		characreate -1, 35, 26, 17
		cAiCalm(rc) = 3
		flt
		characreate -1, 352, 4, 3
		cRole(rc) = 3
		flt
		characreate -1, 271, 4, 2
		flt
		characreate -1, 269, 3, 3
		flt
		characreate -1, 272, 4, 4
		flt
		characreate -1, 274, 5, 4
		flt
		characreate -1, 239, 24, 3
		flt
		characreate -1, 239, 26, 4
		flt
		characreate -1, 239, 25, 5
		flt
		characreate -1, 239, 25, 9
		flt
		characreate -1, 326, 12, 9
		repeat 2
			flt
			characreate -1, 9, -3, 0
			flt
			characreate -1, 159, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			flt
			characreate -1, 36, -3, 0
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
			flt
			characreate -1, 8, -3, 0
			flt
			characreate -1, 185, -3, 0
		loop
		mapBgm = 79
		map_placeplayer
	}
	if (gCurrentMap == 34) {
		map_initcustom "smith0"
		mapDensity = 0
		flt
		characreate -1, 208, 17, 11
		cRole(rc) = 3
		flt
		characreate -1, 209, 8, 16
		cRole(rc) = 1016, 100
		repeat 5
			flt
			characreate -1, 164, -3, 0
			cRole(rc) = 3
		loop
		mapBgm = 79
		map_placeplayer
	}
	if (gCurrentMap == 29) {
		map_initcustom "sister"
		mapDensity = 0
		mapBgm = 79
		if (mapupdate == 0) {
			flt
			itemcreate -1, 668, 12, 8, 0
			iParam2(ci) = 4
		}
		flt
		characreate -1, 249, 12, 6
		cRole(rc) = 1019
		repeat 6
			flt
			characreate -1, 211, -3, 0
			cRole(rc) = 3
		loop
		repeat 8
			flt
			characreate -1, 246, -3, 0
			cRole(rc) = 3
		loop
		map_placeplayer
	}
	if (gCurrentMap == 21) {
		map_initcustom "cyberdome"
		mapDensity = 10
		flt
		itemcreate -1, 171, 19, 5, 0
		iParam1(ci) = 1
		iOwnState(ci) = 1
		ibitmod 5, ci, 1
		flt
		characreate -1, 173, 9, 16
		cRole(rc) = 1011, 10
		flt
		characreate -1, 173, 9, 8
		cRole(rc) = 1011, 10
		flt
		characreate -1, 322, 28, 7
		cRole(rc) = 3
		repeat 4
			flt
			characreate -1, 171, -3, 0
			cRole(rc) = 4
			flt
			characreate -1, 172, -3, 0
			cRole(rc) = 4
		loop
		repeat mapDensity / 2
			gosub *label_0937
			characreate -1, 0, -3, 0
			if (stat) {
				gosub *label_1759
			}
		loop
		mapBgm = 79
		map_placeplayer
	}
	if (gCurrentMap == 25) {
		map_initcustom "highmountain"
		mapDensity = 20
		flt
		characreate -1, 41, 21, 23
		cRole(rc) = 21
		flt
		characreate -1, 1, 9, 44
		cRole(rc) = 1017, 5
		cdatan(0, rc) = lang("染色店の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the dye vendor")
		flt
		characreate -1, 1, 13, 37
		cRole(rc) = 1018, 30
		cdatan(0, rc) = lang("おみやげ屋の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the souvenir vendor")
		flt
		characreate -1, 70, 24, 48
		cRole(rc) = 9
		flt
		characreate -1, 239, 7, 36
		flt
		characreate -1, 239, 9, 38
		flt
		characreate -1, 239, 6, 33
		flt
		characreate -1, 239, 3, 33
		flt
		characreate -1, 239, 8, 31
		flt
		characreate -1, 239, 4, 36
		repeat 7
			flt
			characreate -1, 16, -3, 0
			cRole(rc) = 4
			flt
			characreate -1, 39, -3, 0
			cRole(rc) = 4
			flt
			characreate -1, 239, -3, 0
		loop
		repeat 15
			flt
			characreate -1, 239, -3, 0
		loop
		repeat mapDensity / 2
			gosub *label_0937
			characreate -1, 0, -3, 0
			if (stat) {
				gosub *label_1759
			}
		loop
		mapBgm = 79
		map_placeplayer
	}
	if (gCurrentMap == 6) {
		map_initcustom "arena_1"
		map_placeplayer
		repeat 16
			if (cState(cnt) == 1) {
				if (cRelationship(cnt) == 10) {
					if (cnt != 0) {
						map(cX(cnt), cY(cnt), 1) = 0
						cState(cnt) = 8
					}
				}
			}
		loop
		if (arenaop == 0) {
			fixlv = arenaop(2)
			if (arenaop(1) == 176) {
				x = cX(0) - 1
				y = cY(0) - 4
				initlv = 10000
				fixlv = 5
				characreate -1, 176, x, y
				cdatan(0, rc) = "《チャレンジャーの妹》"
				cdata(209, rc) = 50
				cdata(215, rc) = 903
				cdata(220, rc) = 660, 900, 904
				cAiActNum(rc) = 31
				cbitmod 26, rc, 1
				cbitmod 27, rc, 1
				cbitmod 28, rc, 1
				cbitmod 39, rc, 1
				ocbitmod 13, rc, 1
				cRole(rc) = 3004
				cHate(rc) = 30
				cRelationship(rc) = -3
				cOriginalRelationship(rc) = -3
			} elseif (arenaop(1) == 363) {
				x = cX(0) - 1
				y = cY(0) - 4
				gosub *label_1772
			} else {
				rank = arenaop(3)
				if (arenaop(1) == 343) {
					initunid = arenaop(4) + 1
				}
				characreate -1, arenaop(1), cX(0) - 1, cY(0) - 4
			}
			cHate(rc) = 30
			cRelationship(rc) = -3
			cOriginalRelationship(rc) = -3
			cbitmod 976, rc, 1
			if (arenaop(1) == 363) {
				evadd 105
			}
		}
		if (arenaop == 1) {
			repeat 3 + rnd(4)
				flt arenaop(1), 2
				characreate -1, 0, cX(0) - 1, cY(0) - 5
				cRelationship(rc) = -3
				cOriginalRelationship(rc) = -3
				cHate(rc) = 30
				cRelationship(rc) = -3
				cbitmod 976, rc, 1
				addfaction rc, "pet," + 56
				if (cLevel(rc) > arenaop(1) | cRelationship(rc) != (-3)) {
					chara_vanquish rc
					continue cnt
				}
			loop
		}
		noaggrorefresh = 1
	}
	if (gCurrentMap == 40) {
		map_initcustom "arena_2"
		mapDensity = 0
		mapBgm = 81
		repeat 16
			if (cnt == 0 | cnt == 56) {
				continue
			}
			if (followerin(cnt) == 0) {
				cState(cnt) = 8
				cX(cnt) = 0
				cY(cnt) = 0
			} else {
				cState(cnt) = 1
			}
		loop
		map_placeplayer
		petarenawin = 0
		if (arenaimport == 1) {
			file = "" + userfile
			id = 0
			gosub *label_1320
			importmode = 1
			ctrlFile 21
			gosub *custom_cleanUpTemporaryFiles
		} else {
			repeat arenaop(1)
				if (arenaop(0) == 2) {
					relocate_chara 56, -1, -3
					map(cX(rc), cY(rc), 1) = 0
					cHp(rc) = cMaxHp(rc)
					cMp(rc) = cMaxMp(rc)
					cSp(rc) = cMaxSp(rc)
				} else {
					flt arenaop(2), calcfixlv(3)
					characreate -1, 0, -3, 0
					map(cX(rc), cY(rc), 1) = 0
					f = 1
					if (arenaop == 0) {
						if (cLevel(rc) < arenaop(2) / 2) {
							f = 0
						}
					}
					if (cRelationship(rc) != (-3)) {
						f = 0
					}
					if (f == 0) {
						chara_vanquish rc
						continue cnt
					}
				}
				map_placearena rc, 1
				if (cnt == 0) {
					enemyteam = rc
				}
			loop
		}
		repeat 245 - 57, 57
			if (cRelationship(cnt) == (-3)) {
				cbitmod 966, cnt, 1
			}
		loop
	}
	if (gCurrentMap == 49) {
		if (nc_horse_001 == 0) {
			map_initcustom "nc_derby"
		} else {
			map_initcustom "nc_derby_long"
		}
		mapDensity = 0
		mapBgm = 81
		repeat 16
			if (cnt == 0 | cnt == 56) {
				continue
			}
			if (followerin(cnt) == 0) {
				cState(cnt) = 8
				cX(cnt) = 0
				cY(cnt) = 0
			} else {
				cState(cnt) = 1
			}
		loop
		map_placeplayer
		petarenawin = 0
		repeat 5
			flt
			fixlv = 3
			initlv = (100 - gdata(129) / 100) * 2 + 1 + rnd(10)
			if (nc_horse_002 == 2) {
				initlv = 5
			}
			if (nc_horse_002 == 3) {
				initlv = 800
			}
			fltn "horse"
			characreate -1, 0, 1, 7 + cnt
			if (stat == 0) {
				continue cnt
			}
			sdata(18 + 600, rc) = limit((cLevel(rc) * 3) * 1000000, 50 * 1000000, 2000 * 1000000)
			skillinit 15, rc, 20 + (cLevel(rc) * (rnd(8) + 3)) + (50 * nc_horse_001)
			skillinit 11, rc, 20 + (cLevel(rc) * (rnd(4) + 2)) + (30 * nc_horse_001)
			if (nc_horse_002 == 3) {
				sdata(18 + 600, rc) = 800 * 1000000
				skillinit 12, rc, 100
				skillinit 19, rc, 100
				sdata(11 + 600, rc) = 2000 * 1000000
				sdataEx(11, rc) = 10000
				sdata(15 + 600, rc) = 2000 * 1000000
				sdataEx(15, rc) = 80000
			}
			gosub *chara_refresh
			cHp(rc) = cMaxHp(rc)
			cMp(rc) = cMaxMp(rc)
			cSp(rc) = cMaxSp(rc)
			horsestat(cnt + 1, 0) = rc
			if (nc_horse_002 != 2 | nc_horse_002 != 3) {
				repeat limitmax((100 - gdata(129) / 100) / 25, 3) + 1
					nc_intb_001 = rnd(26)
					if (nc_intb_001 > 8 & nc_intb_001 < 21) {
						 continue cnt
					}
					if (horse_getskill(rc, nc_intb_001) > 0) {
						continue
					}
					nc_intb_002 = rnd(limitmax((100 - gdata(129) / 100) / 25, 2) + 1) + 1
					addfaction rc, "horskill" + nc_intb_001 + "," + nc_intb_002
				loop
			}
			if (nc_horse_002 == 3) {
				nc_intb_001 = rnd(4)
				if (nc_intb_001 == 0) {
					addfaction rc, "horskill21,3"
					addfaction rc, "horskill4,5"
					addfaction rc, "horskill6,5"
					addfaction rc, "horskill5,3"
					addfaction rc, "horskill9,3"
				}
				if (nc_intb_001 == 1) {
					addfaction rc, "horskill6,3"
					addfaction rc, "horskill7,5"
					addfaction rc, "horskill8,5"
					addfaction rc, "horskill25,3"
					addfaction rc, "horskill9,3"
				}
				if (nc_intb_001 == 2) {
					addfaction rc, "horskill2,5"
					addfaction rc, "horskill3,5"
					addfaction rc, "horskill4,5"
					addfaction rc, "horskill24,3"
					addfaction rc, "horskill9,3"
				}
				if (nc_intb_001 == 3) {
					addfaction rc, "horskill0,5"
					addfaction rc, "horskill1,5"
					addfaction rc, "horskill2,5"
					addfaction rc, "horskill3,3"
					addfaction rc, "horskill4,3"
					addfaction rc, "horskill9,5"
				}
			} else {
				if (nc_horse_002 != 2) {
					if (gdata(129) / 100 <= 30) {
						if (horse_getskill(rc, 6) == 0) {
							addfaction rc, "horskill6,3"
						}
					}
					if (gdata(129) / 100 <= 10) {
						if (horse_getskill(cc, 5) == 0) {
							addfaction rc, "horskill5,3"
						}
					}
					if (gdata(129) / 100 <= 1) {
						if (horse_getskill(cc, 1) == 0) {
							addfaction rc, "horskill5,5"
						}
					}
				}
			}
			refreshspeed rc
		loop
		mapBgm = 93
	}
	/*フリージア*/
	if (gCurrentMap == 22) {
		map_initcustom "god"
		mapDensity = 0
		mapBgm = 63
		flt
		characreate -1, 175, 12, 14
		map_placeplayer
	}
	if (gCurrentMap == 23) {
		map_initcustom "god"
		mapDensity = 0
		mapBgm = 63
		flt
		characreate -1, 177, 12, 14
		map_placeplayer
	}
	if (gCurrentMap == 24) {
		map_initcustom "god"
		mapBgm = 63
		mapDensity = 0
		flt
		characreate -1, 178, 12, 14
		map_placeplayer
	}
	if (gCurrentMap == 7) {
		map_initcustom "home" + gHomeScale
		mapBgm = 68
		gEntranceType = 4
		map_placeplayer
		mdata(15) = 0
		mapTileType = 3
		if (gCurrentDungeonLevel == 1) {
			if (gHomeScale == 0) {
				mapCampfireExists = 1
				flt
				characreate -1, 33, 18, 10
				cRole(rc) = 3
				flt
				characreate -1, 34, 16, 11
				cRole(rc) = 3
				flt
				itemcreate -1, 510, 6, 10, 0
				iCount(ci) = 3
				flt
				itemcreate -1, 547, 15, 19, 0
				iCount(ci) = 4
				flt
				itemcreate -1, 579, 9, 8, 0
				iCount(ci) = 6
				flt
				itemcreate -1, 24, 18, 19, 0
				iParam1(ci) = 1
			} else {
				file = "inv_" + mid + ".s2"
				ctrlFile 3
				inv_getheader -1
				repeat invrange, invhead
					if (iNumber(cnt) == 0) {
						continue
					}
					iX(cnt) = mapWidth / 2
					iY(cnt) = mapHeight / 2
					cell_refresh iX(cnt), iY(cnt)
				loop
				memset ocdata(0, 57), 0, 245000 - 57000
				ctrlFile 17
				repeat 188, 57
					cX(cnt) = mapWidth / 2
					cY(cnt) = mapHeight / 2
					cInitialX(cnt) = mapWidth / 2
					cInitialY(cnt) = mapHeight / 2
				loop
			}
			if (gHomeScale == 5) {
				p = 0
				repeat 188, 57
					if (cState(cnt) == 1 | cState(cnt) == 2) {
						if (cRole(cnt) != 0) {
							p++
						}
					}
				loop
				if (7 + (ogdata(494) == 2) * 10 - p > 0) {
					repeat 7 + (ogdata(494) == 2) * 10 - p
						flt
						if (cnt == 0) {
							characreate -1, 1, 31, 20
							cRole(rc) = 1006, 10
							sngeneral cdatan(0, rc)
						}
						if (cnt == 1) {
							characreate -1, 1, 9, 20
							cRole(rc) = 1001, 12
							snarmor cdatan(0, rc)
						}
						if (cnt == 2) {
							characreate -1, 1, 4, 20
							cRole(rc) = 1008, 10
							sngoods cdatan(0, rc)
						}
						if (cnt == 3) {
							characreate -1, 41, 4, 11
							cRole(rc) = 5
						}
						if (cnt == 4) {
							characreate -1, 70, 30, 11
							cRole(rc) = 9
						}
						if (cnt == 5) {
							characreate -1, 74, 30, 4
							cRole(rc) = 12
						}
						if (cnt == 6) {
							characreate -1, 41, 4, 4
							cRole(rc) = 1004, 11
							snmagic cdatan(0, rc)
						}
					loop
				}
			}
		} else {
			flt
			itemcreate -1, 219, cX(0), cY(0), 0
		}
		gosub *label_0914
	}
	if (gCurrentMap == 4) {
		map_initcustom "ntyris"
		gosub *label_0948
		map_placeplayer
	}
	if (gCurrentMap == 44) {
		map_initcustom "st_styris"
		gosub *label_0948
		map_placeplayer
	}
	if (gCurrentMap == 47) {
		mapIsFixed = 1
		mdata(17) = 0
		map_initcustom "nc_fairesorts"
		gosub *label_0948
		map_placeplayer
		mdata(15) = 0
	}
	if (gCurrentMap == 14) {
		if (gCurrentDungeonLevel == 1) {
			mapDensity = 35
			map_initcustom "rogueden"
			map_placeplayer
			mdata(15) = 0
			flt
			characreate -1, 253, 23, 14
			cRole(rc) = 3
			flt
			characreate -1, 259, 13, 18
			cRole(rc) = 3
			flt
			characreate -1, 294, 16, 17
			cRole(rc) = 3
			flt
			characreate -1, 1, 10, 17
			cRole(rc) = 1009, 12
			sntrade cdatan(0, rc)
			flt
			characreate -1, 70, 15, 15
			cRole(rc) = 9
			flt
			characreate -1, 1, 13, 3
			cRole(rc) = 1006, 10
			sngeneral cdatan(0, rc)
			flt
			characreate -1, 1, 29, 23
			cRole(rc) = 1005, 8
			sninn cdatan(0, rc)
			flt
			characreate -1, 1, 26, 7
			cRole(rc) = 1008, 10
			sngoods cdatan(0, rc)
			flt
			characreate -1, 1, 30, 4
			cRole(rc) = 1007, 10
			snblack cdatan(0, rc)
			flt
			characreate -1, 1, 29, 4
			cRole(rc) = 17
			cdatan(0, rc) = lang("謎の奴隷商人", "The slave master")
			flt
			characreate -1, 1, 10, 6
			cRole(rc) = 1001, 12
			snarmor cdatan(0, rc)
			flt
			characreate -1, 73, 7, 15
			cRole(rc) = 10
			flt
			characreate -1, 38, 9, 18
			cRole(rc) = 6
			cdatan(0, rc) = lang("ダルフィ" + cdatan(0, rc), cdatan(0, rc) + " of Derphy")
			flt
			characreate -1, 40, 13, 18
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 41, 5, 26
			cRole(rc) = 5
			flt
			characreate -1, 69, 3, 28
			cRole(rc) = 8
			repeat 4
				flt
				characreate -1, 16, -3, 0
				cRole(rc) = 4
				flt
				characreate -1, 39, -3, 0
				cRole(rc) = 4
			loop
			gosub *label_1542
			repeat 20
				dbid = 0
				gosub *label_0937
				characreate -1, dbid, -3, 0
				if (stat) {
					gosub *label_1759
				}
			loop
		}
		if (gCurrentDungeonLevel == 3) {
			mapTileType = 0
			map_initcustom "thiefguild"
			mapIndoorOrOutdoor = 1
			mapType = 2
			mapDensity = 25
			mapBgm = 79
			mdata(17) = 0
			mdatan(0) = lang("盗賊ギルド", "Thieves Guild")
			map_placeplayer
			flt
			characreate -1, 292, 21, 9
			cRole(rc) = 3
			flt
			characreate -1, 40, 3, 6
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 41, 3, 12
			cRole(rc) = 5
			flt
			characreate -1, 1, 5, 18
			cRole(rc) = 1007, 10
			snblack cdatan(0, rc)
			flt
			characreate -1, 1, 27, 13
			cRole(rc) = 1007, 10
			snblack cdatan(0, rc)
			flt
			characreate -1, 1, 21, 19
			cRole(rc) = 1021, 10
			cdatan(0, rc) = lang("盗賊店の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the fence")
			repeat 16
				flt
				characreate -1, 293, -3, 0
			loop
		}
	}
	if (gCurrentMap == 15) {
		mapDensity = 45
		map_initcustom "palmia"
		map_placeplayer
		mdata(15) = 0
		flt
		characreate -1, 70, 42, 27
		cRole(rc) = 9
		flt
		characreate -1, 74, 34, 3
		cRole(rc) = 12
		flt
		characreate -1, 73, 22, 31
		cRole(rc) = 10
		flt
		characreate -1, 142, 5, 15
		cRole(rc) = 3
		flt
		characreate -1, 247, 41, 11
		cRole(rc) = 3
		flt
		characreate -1, 301, 5, 6
		cRole(rc) = 3
		flt
		characreate -1, 320, 24, 6
		cRole(rc) = 3
		flt
		characreate -1, 320, 15, 22
		cRole(rc) = 3
		flt
		characreate -1, 326, 15, 22
		cRole(rc) = 3
		if (gdata(250 + 210) == 1000) {
			flt
			characreate -1, 246, 42, 11
			cRole(rc) = 3
		}
		flt
		characreate -1, 1, 48, 18
		cRole(rc) = 1006, 10
		sngeneral cdatan(0, rc)
		flt
		characreate -1, 1, 30, 17
		cRole(rc) = 1005, 8
		sninn cdatan(0, rc)
		flt
		characreate -1, 1, 48, 3
		cRole(rc) = 1008, 8
		sngoods cdatan(0, rc)
		flt
		characreate -1, 1, 42, 17
		cRole(rc) = 1001, 12
		snarmor cdatan(0, rc)
		flt
		characreate -1, 1, 11, 14
		cRole(rc) = 1003, 9
		snbakery cdatan(0, rc)
		cImage(rc) = 138
		flt
		characreate -1, 41, 41, 3
		cRole(rc) = 1004, 11
		snmagic cdatan(0, rc)
		flt
		characreate -1, 1, 41, 28
		cRole(rc) = 1009, 12
		sntrade cdatan(0, rc)
		flt
		characreate -1, 79, 7, 2
		cRole(rc) = 15
		cAiCalm(rc) = 3
		flt
		characreate -1, 80, 6, 2
		cRole(rc) = 15
		cAiCalm(rc) = 3
		flt
		characreate -1, 38, 49, 11
		cRole(rc) = 6
		cdatan(0, rc) = lang("パルミア市街地の" + cdatan(0, rc), cdatan(0, rc) + " of Palmia city")
		flt
		characreate -1, 40, 30, 27
		cRole(rc) = 7
		sntrainer cdatan(0, rc)
		flt
		characreate -1, 41, 32, 27
		cRole(rc) = 5
		flt
		characreate -1, 69, 29, 28
		cRole(rc) = 8
		flt
		characreate -1, 77, 16, 5
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 16, 9
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 5, 3
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 8, 3
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 35, 14
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 38, 14
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 29, 2
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 19, 18
		cRole(rc) = 14
		cAiCalm(rc) = 3
		flt
		characreate -1, 77, 22, 18
		cRole(rc) = 14
		cAiCalm(rc) = 3
		repeat 5
			flt
			characreate -1, 16, -3, 0
			cRole(rc) = 4
			flt
			characreate -1, 39, -3, 0
			cRole(rc) = 4
		loop
		repeat 4
			flt
			characreate -1, 77, -3, 0
			cRole(rc) = 14
		loop
		gosub *label_1542
		repeat 25
			dbid = 0
			gosub *label_0937
			characreate -1, dbid, -3, 0
			if (stat) {
				gosub *label_1759
			}
		loop
	}
	if (gCurrentMap == 36) {
		if (gCurrentDungeonLevel == 1) {
			mapDensity = 40
			map_initcustom "lumiest"
			map_placeplayer
			mdata(15) = 0
			if (gdata(250 + 215)) {
				cell_featset 18, 45, tile_downstairs, 11, 20
			}
			flt
			characreate -1, 252, 12, 24
			cRole(rc) = 3
			flt
			characreate -1, 280, 21, 3
			cRole(rc) = 3
			flt
			characreate -1, 290, 5, 20
			cRole(rc) = 3
			flt
			characreate -1, 320, 28, 29
			cRole(rc) = 3
			flt
			characreate -1, 326, 41, 19
			cRole(rc) = 3
			flt
			characreate -1, 326, 32, 43
			cRole(rc) = 3
			flt
			characreate -1, 326, 29, 28
			cRole(rc) = 3
			flt
			characreate -1, 326, 16, 45
			cRole(rc) = 3
			flt
			characreate -1, 326, 13, 24
			cRole(rc) = 3
			flt
			characreate -1, 70, 41, 42
			cRole(rc) = 9
			flt
			characreate -1, 74, 10, 16
			cRole(rc) = 12
			flt
			characreate -1, 1, 47, 30
			cRole(rc) = 1006, 10
			sngeneral cdatan(0, rc)
			flt
			characreate -1, 1, 24, 47
			cRole(rc) = 1005, 8
			sninn cdatan(0, rc)
			flt
			characreate -1, 1, 37, 30
			cRole(rc) = 1001, 12
			snarmor cdatan(0, rc)
			flt
			characreate -1, 1, 37, 12
			cRole(rc) = 1003, 9
			snbakery cdatan(0, rc)
			cImage(rc) = 138
			flt
			characreate -1, 41, 6, 15
			cRole(rc) = 1004, 11
			snmagic cdatan(0, rc)
			flt
			characreate -1, 1, 33, 43
			cRole(rc) = 1009, 12
			sntrade cdatan(0, rc)
			flt
			characreate -1, 1, 47, 12
			cRole(rc) = 1014, 5
			snfish cdatan(0, rc)
			flt
			characreate -1, 38, 3, 38
			cRole(rc) = 6
			cdatan(0, rc) = lang("ルミエストの" + cdatan(0, rc), cdatan(0, rc) + " of Lumiest")
			flt
			characreate -1, 40, 21, 28
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 41, 21, 30
			cRole(rc) = 5
			flt
			characreate -1, 69, 23, 38
			cRole(rc) = 8
			repeat 6
				flt
				characreate -1, 16, -3, 0
				cRole(rc) = 4
				flt
				characreate -1, 39, -3, 0
				cRole(rc) = 4
			loop
			repeat 7
				flt
				characreate -1, 77, -3, 0
				cRole(rc) = 14
			loop
			gosub *label_1542
			repeat 25
				dbid = 0
				gosub *label_0937
				characreate -1, dbid, -3, 0
				if (stat) {
					gosub *label_1759
				}
			loop
		}
		if (gCurrentDungeonLevel == 3) {
			mapTileType = 0
			map_initcustom "mageguild"
			mapIndoorOrOutdoor = 1
			mapType = 2
			mapDensity = 25
			mapBgm = 79
			mdata(17) = 0
			mdatan(0) = lang("魔術士ギルド", "Mages Guild")
			map_placeplayer
			flt
			characreate -1, 288, 24, 3
			cRole(rc) = 3
			flt
			characreate -1, 41, 27, 8
			cRole(rc) = 1020
			cdatan(0, rc) = lang("魔法書作家の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the spell writer")
			flt
			characreate -1, 41, 22, 8
			cRole(rc) = 1004, 11
			snmagic cdatan(0, rc)
			flt
			characreate -1, 74, 3, 9
			cRole(rc) = 12
			flt
			characreate -1, 40, 12, 6
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 41, 3, 3
			cRole(rc) = 5
			repeat 16
				flt
				characreate -1, 289, -3, 0
			loop
		}
		if (gCurrentDungeonLevel == 20) {
			mapTileType = 0
			map_initcustom "sqSewer"
			mapIndoorOrOutdoor = 1
			mapType = 20
			mapDensity = 0
			mapBgm = 61
			mdata(17) = 1
			mdatan(0) = lang("ルミエスト下水道", "The Sewer")
			put_questtarget
			gEntranceType = 1
			map_placeplayer
		}
	}
	if (gCurrentMap == 12) {
		if (gCurrentDungeonLevel == 1) {
			mapDensity = 35
			map_initcustom "yowyn"
			map_placeplayer
			mdata(15) = 0
			if (gdata(250 + 206)) {
				cell_featset 23, 22, tile_downstairs, 11, 3
			}
			flt
			characreate -1, 224, 3, 17
			cRole(rc) = 3
			flt
			characreate -1, 227, 26, 11
			cRole(rc) = 3
			flt
			characreate -1, 231, 14, 20
			cRole(rc) = 3
			flt
			characreate -1, 1, 11, 5
			cRole(rc) = 1006, 10
			sngeneral cdatan(0, rc)
			flt
			characreate -1, 1, 25, 8
			cRole(rc) = 1005, 8
			sninn cdatan(0, rc)
			flt
			characreate -1, 1, 7, 8
			cRole(rc) = 1008, 8
			sngoods cdatan(0, rc)
			flt
			characreate -1, 1, 14, 14
			cRole(rc) = 1009, 12
			sntrade cdatan(0, rc)
			flt
			characreate -1, 1, 35, 18
			cRole(rc) = 22
			cdatan(0, rc) = lang("馬屋の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the horse master")
			flt
			characreate -1, 267, 33, 16
			cRole(rc) = 3
			flt
			characreate -1, 267, 37, 19
			cRole(rc) = 3
			flt
			characreate -1, 268, 34, 19
			cRole(rc) = 3
			flt
			characreate -1, 268, 38, 16
			cRole(rc) = 3
			flt
			characreate -1, 38, 3, 4
			cRole(rc) = 6
			cdatan(0, rc) = lang("ヨウィンの" + cdatan(0, rc), cdatan(0, rc) + " of Yowyn")
			flt
			characreate -1, 40, 20, 14
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 41, 24, 16
			cRole(rc) = 5
			flt
			characreate -1, 69, 26, 16
			cRole(rc) = 8
			flt
			characreate -1, 213, 14, 12
			cRole(rc) = 3
			repeat 2
				flt
				characreate -1, 16, -3, 0
				cRole(rc) = 4
				flt
				characreate -1, 39, -3, 0
				cRole(rc) = 4
			loop
			repeat 3
				flt
				characreate -1, 77, -3, 0
				cRole(rc) = 14
			loop
			gosub *label_1542
			repeat 15
				dbid = 0
				gosub *label_0937
				characreate -1, dbid, -3, 0
				if (stat) {
					gosub *label_1759
				}
			loop
		}
		if (gCurrentDungeonLevel == 3) {
			mapTileType = 0
			map_initcustom "sqcat"
			mapIndoorOrOutdoor = 1
			mapType = 20
			mapDensity = 0
			mapBgm = 61
			mdata(17) = 1
			mdatan(0) = lang("タムの猫屋敷", "Cat Mansion")
			put_questtarget
			map_placeplayer
		}
		if (gCurrentDungeonLevel == 4) {
			mapTileType = 0
			map_initcustom "sqwar"
			mapIndoorOrOutdoor = 2
			mapType = 20
			mapDensity = 0
			mapBgm = 61
			mdata(17) = 1
			mapIsFixed = 0
			mdatan(0) = lang("防衛線", "Battle Field")
			put_questtarget
			gEntranceType = 8
			map_placeplayer
			listmax = 0
			repeat 188, 57
				if (cState(cnt) == 1) {
					if (cbit(970, cnt) == 1) {
						list(0, listmax) = cnt
						listmax++
					}
				}
			loop
			repeat 30
				flt
				characreate -1, 233 + 2 * (cnt > 22), 11, 16
				cRelationship(rc) = 10
				cOriginalRelationship(rc) = 10
				cHate(rc) = 100
				p = list(0, rnd(listmax))
				lockon rc, p, 5
				cHate(p) = 100
				lockon p, rc, 6
			loop
			noaggrorefresh = 1
		}
	}
	if (gCurrentMap == 33) {
		mapDensity = 35
		map_initcustom "noyel"
		map_placeplayer
		mdata(15) = 0
		flt
		characreate -1, 202, 46, 18
		gdata(250 + 9) = rc
		cRole(rc) = 3
		flt
		characreate -1, 203, 47, 18
		cRole(rc) = 1015
		flt
		characreate -1, 35, 47, 20
		cRole(rc) = 3
		flt
		characreate -1, 35, 45, 19
		cRole(rc) = 3
		flt
		characreate -1, 35, 49, 20
		cRole(rc) = 3
		flt
		characreate -1, 326, 28, 22
		cRole(rc) = 3
		flt
		characreate -1, 221, 19, 3
		cRole(rc) = 3
		if (gdata(250 + 203) != 1001) {
			flt
			characreate -1, 222, 19, 2
			cRole(rc) = 3
		}
		flt
		characreate -1, 70, 40, 33
		cRole(rc) = 9
		flt
		characreate -1, 74, 44, 6
		cRole(rc) = 12
		flt
		characreate -1, 206, 44, 3
		cRole(rc) = 19
		flt
		characreate -1, 1, 19, 31
		cRole(rc) = 1001, 12
		snarmor cdatan(0, rc)
		flt
		characreate -1, 1, 11, 31
		cRole(rc) = 1006, 10
		sngeneral cdatan(0, rc)
		flt
		characreate -1, 1, 38, 34
		cRole(rc) = 1005, 8
		sninn cdatan(0, rc)
		flt
		characreate -1, 1, 5, 27
		cRole(rc) = 1003, 9
		snbakery cdatan(0, rc)
		cImage(rc) = 138
		flt
		characreate -1, 41, 56, 5
		cRole(rc) = 1004, 11
		snmagic cdatan(0, rc)
		flt
		characreate -1, 1, 39, 35
		cRole(rc) = 1009, 12
		sntrade cdatan(0, rc)
		flt
		characreate -1, 38, 5, 18
		cRole(rc) = 6
		cdatan(0, rc) = lang("ノイエルの" + cdatan(0, rc), cdatan(0, rc) + " of Noyel")
		flt
		characreate -1, 40, 18, 20
		cRole(rc) = 7
		sntrainer cdatan(0, rc)
		flt
		characreate -1, 41, 4, 33
		cRole(rc) = 5
		flt
		characreate -1, 69, 6, 33
		cRole(rc) = 8
		repeat 3
			flt
			characreate -1, 16, rnd(32), rnd(mapHeight)
			cRole(rc) = 4
			flt
			characreate -1, 39, rnd(32), rnd(mapHeight)
			cRole(rc) = 4
		loop
		repeat 3
			flt
			characreate -1, 77, rnd(32), rnd(mapHeight)
			cRole(rc) = 14
		loop
		gosub *label_1542
		repeat 8
			gosub *label_0937
			characreate -1, 35, rnd(11) + 25, rnd(5) + 15
			if (stat) {
				gosub *label_1759
				cRole(rc) = 3
			}
		loop
		repeat 20
			dbid = 0
			gosub *label_0937
			characreate -1, dbid, rnd(55), rnd(mapHeight)
			if (stat) {
				gosub *label_1759
			}
		loop
	}
	if (gCurrentMap == 11) {
		if (gCurrentDungeonLevel == 1) {
			mapDensity = 40
			map_initcustom "kapul"
			map_placeplayer
			mdata(15) = 0
			flt
			characreate -1, 223, 15, 18
			cRole(rc) = 3
			flt
			characreate -1, 243, 36, 27
			cRole(rc) = 3
			flt
			characreate -1, 279, 5, 26
			cRole(rc) = 3
			flt
			characreate -1, 297, 29, 3
			cRole(rc) = 3
			flt
			characreate -1, 320, 24, 21
			cRole(rc) = 3
			flt
			characreate -1, 320, 12, 26
			cRole(rc) = 3
			flt
			characreate -1, 320, 8, 11
			cRole(rc) = 3
			flt
			characreate -1, 326, 8, 14
			cRole(rc) = 3
			flt
			characreate -1, 1, 16, 17
			cRole(rc) = 1009, 12
			sntrade cdatan(0, rc)
			flt
			characreate -1, 1, 23, 7
			cRole(rc) = 1001, 12
			snarmor cdatan(0, rc)
			flt
			characreate -1, 1, 32, 14
			cRole(rc) = 1006, 10
			sngeneral cdatan(0, rc)
			flt
			characreate -1, 1, 22, 14
			cRole(rc) = 1008, 10
			sngoods cdatan(0, rc)
			flt
			characreate -1, 1, 16, 25
			cRole(rc) = 1007, 10
			snblack cdatan(0, rc)
			flt
			characreate -1, 1, 17, 28
			cRole(rc) = 1002, 10
			snfood cdatan(0, rc)
			flt
			characreate -1, 41, 22, 22
			cRole(rc) = 1004, 11
			snmagic cdatan(0, rc)
			flt
			characreate -1, 1, 35, 3
			cRole(rc) = 1005, 8
			sninn cdatan(0, rc)
			flt
			characreate -1, 70, 15, 15
			cRole(rc) = 9
			flt
			characreate -1, 73, 26, 3
			cRole(rc) = 10
			flt
			characreate -1, 179, 25, 4
			cRole(rc) = 11
			flt
			characreate -1, 38, 8, 12
			cRole(rc) = 6
			cdatan(0, rc) = lang("ポート・カプールの" + cdatan(0, rc), cdatan(0, rc) + " of Port Kapul")
			flt
			characreate -1, 40, 16, 4
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 41, 14, 4
			cRole(rc) = 5
			flt
			characreate -1, 69, 17, 5
			cRole(rc) = 8
			flt
			characreate -1, 74, 27, 11
			cRole(rc) = 12
			repeat 2
				flt
				characreate -1, 16, -3, 0
				cRole(rc) = 4
				flt
				characreate -1, 39, -3, 0
				cRole(rc) = 4
			loop
			repeat 4
				flt
				characreate -1, 71, -3, 0
				cRole(rc) = 4
			loop
			repeat 5
				flt
				characreate -1, 76, -3, 0
				cRole(rc) = 14
			loop
			flt
			characreate -1, 72, 7, 6
			cRole(rc) = 4
			gosub *label_1542
			repeat 20
				gosub *label_0937
				characreate -1, 0, -3, 0
				if (stat) {
					gosub *label_1759
				}
			loop
		}
		if (gCurrentDungeonLevel == 3) {
			mapTileType = 0
			map_initcustom "fighterguild"
			mapIndoorOrOutdoor = 1
			mapType = 2
			mapDensity = 25
			mapBgm = 79
			mdata(17) = 0
			mdatan(0) = lang("戦士ギルド", "Fighters Guild")
			map_placeplayer
			flt
			characreate -1, 291, 27, 4
			cRole(rc) = 3
			flt
			characreate -1, 74, 28, 10
			cRole(rc) = 12
			flt
			characreate -1, 40, 15, 10
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 41, 14, 18
			cRole(rc) = 5
			flt
			characreate -1, 1, 29, 15
			cRole(rc) = 1001, 12
			snarmor cdatan(0, rc)
			repeat 16
				flt
				characreate -1, 295, -3, 0
			loop
		}
		if (gCurrentDungeonLevel == 25) {
			mapTileType = 0
			map_initcustom "sqkamikaze"
			mapIndoorOrOutdoor = 2
			mapType = 20
			mapDensity = 0
			mapBgm = 61
			mdata(17) = 1
			mapIsFixed = 0
			mdatan(0) = lang("戦場", "Doom Ground")
			gEntranceType = 4
			gdata(250 + 11) = 0
			map_placeplayer
			repeat 10
				flt
				characreate -1, 204, cX(0), cY(0)
				cRelationship(rc) = 10
				cOriginalRelationship(rc) = 10
			loop
			noaggrorefresh = 1
		}
	}
	// nc_map
	if (gCurrentMap == 200) {
				mapDensity = 40
				map_initcustom "nc_crippletown"
				mdatan(0) = lang("クリップルタウン", "Town of Void")
				mapType = 3
				areaIsFixed(gCurrentMap) = 1
				mdata(9) = 10000
				mdata(14) = 2
				mdata(15) = 0
				mdata(17) = 0
				mapstartx = 7
				mapstarty = 35
				areaType(gCurrentMap) = 3
				mapBgm = 94
				map_placeplayer
				// 癒し手
				flt
				characreate -1, 74, 12, 22
				cRole(rc) = 12
				cdata(202, rc) = 2
				// 魔術師
				flt
				characreate -1, 41, 4, 8
				cRole(rc) = 1004, 40
				cdata(202, rc) = 2
				snmagic cdatan(0, rc)
				// ブラックマーケット
				flt
				characreate -1, 1, 15, 4
				cAiCalm(rc) = 3
				cRole(rc) = 1007, 1000
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cdata(202, rc) = 2
				snblack cdatan(0, rc)
				cbitmod 991, rc, 1
				// ブラックマーケット
				flt
				characreate -1, 1, 17, 4
				cAiCalm(rc) = 3
				cRole(rc) = 1007, 1000
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cdata(202, rc) = 2
				snblack cdatan(0, rc)
				cbitmod 991, rc, 1
				//　妖精さん
        flt
				characreate -1, 250, 17, 8
				cQuality(rc) = 5
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cRole(rc) = 3100, 10
				cdata(16, rc) = 0
				cdata(18, rc) = 6
				cdata(202, rc) = 2
				cdatan(0, rc) = lang("『素材販売店の見習い妖精』", "Apprentice Fairy")
				faction(rc) = ""
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"
				//　魔法書専門
				flt
				characreate -1, 305, 16, 17
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cRole(rc) = 3101, 20
				cdata(202, rc) = 2
				cdatan(0, rc) = lang("魔法書専門店のルイエス", "Ruies the magic vendor")
				faction(rc) = ""
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"
				// 帰還代行
				flt
				characreate -1, 18, 9, 8
				cRole(rc) = 21
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cdata(202, rc) = 2
				cdatan(0, rc) = lang("帰還代行のクィナ", "Cuina the home warper")
				faction(rc) = ""
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"
				// 媚薬商人
				flt
				characreate -1, 16, 34, 7
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cRole(rc) = 3102, 1000
				cdata(202, rc) = 2
				cdatan(0, rc) = lang("媚薬商人のアポン", "Apon the aphrodisiac vendor")
				// 同人誌商人
				flt
				characreate -1, 16, 45, 7
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cRole(rc) = 3103, 1000
				cdata(202, rc) = 2
				cdatan(0, rc) = lang("同人誌商人のドリー", "Dory the doujinshi vendor")
				// 奴隷娼婦商人
				flt
				characreate -1, 1, 40, 7
				cRole(rc) = 17
				cdatan(0, rc) = lang("謎の奴隷娼婦商人", "The slave whole master")
				// バーテンダー
				flt
				characreate -1, 70, 7, 10
				cRole(rc) = 9
　　　　 // ルージィ
				flt
				initlv = 50
				characreate -1, 250, 15, 8
				cQuality(rc) = 5
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cSex(rc) = 1
				cImage(rc) = 500
				cdatan(0, rc) = lang("妖精の鍛冶士『ルージィ』", "<lurgy> the metallurgy fairy")
				cRole(rc) = 3200
				faction(rc) = ""
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"
				addfaction rc, "lurgy"
				// ギルドトレイナー
				flt
				characreate -1, 333, 9, 4
				cRole(rc) = 3201
				cdatan(0, rc) = lang("スペシャルギルドトレイナー", "Spacial Guild Trainer")
				// ここから娼婦
				flt
				initlv = 3000
				fixlv = 5
				characreate -1, 250, 41, 22
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cSex(rc) = 1
				cRole(rc) = 1
				cdatan(0, rc) = lang("妖精娼婦『フィー』", "<Fea> the fairy whole")
				faction(rc) = ""
				addfaction rc, "whole"
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"

				flt
				initlv = 3000
				fixlv = 5
				characreate -1, 176, 34, 19
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cSex(rc) = 1
				cRole(rc) = 1
				cdatan(0, rc) = lang("娼婦な妹『シス』", "<Sis> the sister whole")
				faction(rc) = ""
				addfaction rc, "whole"
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"

				flt
				initlv = 3000
				fixlv = 5
				characreate -1, 335, 34, 26
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cSex(rc) = 1
				cRole(rc) = 1
				cdatan(0, rc) = lang("娼婦『フォーリ』", "<Foory> the whole")
				faction(rc) = ""
				addfaction rc, "whole"
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"

				flt
				initlv = 3000
				fixlv = 5
				characreate -1, 210, 35, 13
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cSex(rc) = 1
				cRole(rc) = 1
				cdatan(0, rc) = lang("娼婦な妹猫『キャシー』", "<Casy> the cat sister whole")
				faction(rc) = ""
				addfaction rc, "whole"
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"

				flt
				initlv = 3000
				fixlv = 5
				characreate -1, 211, 44, 13
				cRelationship(rc) = 0
				cOriginalRelationship(rc) = 0
				cSex(rc) = 1
				cRole(rc) = 1
				cdatan(0, rc) = lang("娼婦なお嬢様『ディレー』", "<Dele> the Lady whole")
				faction(rc) = ""
				addfaction rc, "whole"
				addfaction rc, "family,man"
				addfaction rc, "align,neutral"
				addfaction rc, "god,eyth"

				// 祭壇設置
				map_generateItemIfNeeded iId_altar, 7, 16
				if (stat != 0) {
					iParam1(ci) = 0
					iParam2(ci) = findgodid("Dorein the Tipsies")
					iParam3(ci) = creategoduid(iParam2(ci))
					iOwnState(ci) = 1
				}

				gosub *label_1542
	}
	// nc_map
	if (gCurrentMap == 5) {
		if (gCurrentDungeonLevel == 1) {
			mapDensity = 40
			map_initcustom "vernis"
			map_placeplayer
			mdata(15) = 0
			if (gdata(250 + 201)) {
				cell_featset 48, 5, tile_downstairs, 11, 4
			}
			flt
			characreate -1, 28, 39, 3
			flt
			characreate -1, 29, 42, 23
			cRole(rc) = 3
			flt
			characreate -1, 30, 24, 5
			cRole(rc) = 3
			flt
			characreate -1, 31, 40, 24
			cRole(rc) = 3
			flt
			characreate -1, 32, 40, 25
			cRole(rc) = 3
			modnpcmemory 1, rc, -1
			flt
			characreate -1, 226, 30, 5
			cRole(rc) = 3
			flt
			characreate -1, 326, 42, 24
			cRole(rc) = 3
			if (gdata(250 + 205) == 1000) {
				flt
				characreate -1, 225, 31, 4
				cRole(rc) = 3
			}
			flt
			characreate -1, 1, 47, 9
			cRole(rc) = 1014, 5
			snfish cdatan(0, rc)
			flt
			characreate -1, 1, 14, 12
			cRole(rc) = 1001, 12
			snarmor cdatan(0, rc)
			flt
			characreate -1, 1, 39, 27
			cRole(rc) = 1009, 12
			sntrade cdatan(0, rc)
			flt
			characreate -1, 1, 10, 15
			cRole(rc) = 1006, 10
			sngeneral cdatan(0, rc)
			flt
			characreate -1, 41, 7, 26
			cRole(rc) = 1004, 11
			snmagic cdatan(0, rc)
			flt
			characreate -1, 1, 14, 25
			cRole(rc) = 1005, 8
			sninn cdatan(0, rc)
			flt
			characreate -1, 1, 22, 26
			cRole(rc) = 1003, 9
			snbakery cdatan(0, rc)
			cImage(rc) = 138
			flt
			characreate -1, 41, 28, 16
			cRole(rc) = 5
			flt
			characreate -1, 70, 38, 27
			cRole(rc) = 9
			flt
			characreate -1, 74, 6, 25
			cRole(rc) = 12
			flt
			characreate -1, 38, 10, 7
			cRole(rc) = 6
			cdatan(0, rc) = lang("ヴェルニースの" + cdatan(0, rc), cdatan(0, rc) + " of Vernis")
			flt
			characreate -1, 40, 27, 16
			cRole(rc) = 7
			sntrainer cdatan(0, rc)
			flt
			characreate -1, 69, 25, 16
			cRole(rc) = 8
			repeat 4
				flt
				characreate -1, 16, -3, 0
				cRole(rc) = 4
				flt
				characreate -1, 39, -3, 0
				cRole(rc) = 4
			loop
			repeat 4
				flt
				characreate -1, 77, -3, 0
				cRole(rc) = 14
			loop
			gosub *label_1542
			repeat 25
				dbid = 0
				gosub *label_0937
				characreate -1, dbid, -3, 0
				if (stat) {
					gosub *label_1759
				}
			loop
		}
		if (gCurrentDungeonLevel == 3) {
			mapTileType = 0
			map_initcustom "puti"
			mapIndoorOrOutdoor = 1
			mapType = 20
			mapDensity = 0
			mapBgm = 61
			mdata(17) = 1
			mdatan(0) = lang("スライムの坑道", "The Mine")
			put_questtarget
			map_placeplayer
		}
		if (gCurrentDungeonLevel == 4) {
			mapTileType = 0
			map_initcustom "sqrogue"
			mapIndoorOrOutdoor = 1
			mapType = 20
			mapDensity = 0
			mapBgm = 61
			mdata(17) = 1
			mdatan(0) = lang("盗賊の隠れ家", "Robber's Hideout")
			put_questtarget
			map_placeplayer
		}
		if (gCurrentDungeonLevel == 5) {
			mapTileType = 0
			map_initcustom "sqNightmare"
			mapIndoorOrOutdoor = 1
			mapType = 20
			mapDensity = 0
			mapBgm = 61
			mdata(17) = 1
			mdatan(0) = lang("生体兵器実験場", "Test Site")
			put_questtarget
			gEntranceType = 7
			mapstartx = 6
			mapstarty = 27
			map_placeplayer
		}
	}
	if (gCurrentMap == 2) {
		mapWidth = 34
		mapHeight = 22
		mapDensity = 4
		mdata(15) = 0
		map_initialize
		repeat mapHeight
			p = cnt
			repeat mapWidth
				map(cnt, p, 0) = tile_default + (rnd(tile_default(2)) == 0) * rnd(tile_default(1))
			loop
		loop
		mdatan(0) = ""
		if (4 <= gdata(62) & gdata(62) < 9) {
			mdatan(0) = lang("森", "Forest")
			map_randomtile 8, 25
			map_randomtile 0, 10
			map_randomtile 1, 4
			map_randomtile 4, 2
			repeat 20 + rnd(20)
				flt
				flttypemajor = 80000
				itemcreate -1, 0, -1, -1, 0
				iOwnState(ci) = 1
				map(iX(ci), iY(ci), 0) = 0
			loop
		}
		if (264 <= gdata(62) & gdata(62) < 363) {
			mdatan(0) = lang("水上", "Sea")
		}
		if (9 <= gdata(62) & gdata(62) < 13) {
			mdatan(0) = lang("草原", "Grassland")
			map_randomtile 9, 10
			map_randomtile 10, 10
			map_randomtile 0, 30
			map_randomtile 1, 4
			map_randomtile 4, 2
			map_randomtile 3, 2
			map_randomtile 4, 2
			map_randomtile 5, 2
			repeat 10 + rnd(10)
				flt
				flttypemajor = 80000
				itemcreate -1, 0, -1, -1, 0
				iOwnState(ci) = 1
			loop
		}
		if (13 <= gdata(62) & gdata(62) < 17) {
			mdatan(0) = lang("荒野", "Desert")
			map_randomtile 18, 25
			map_randomtile 17, 10
			map_randomtile 19, 2
			map_randomtile 20, 4
			map_randomtile 21, 2
			repeat 4 + rnd(4)
				flt
				itemcreate -1, 527, -1, -1, 0
				iOwnState(ci) = 1
			loop
		}
		if (chipm(0, gdata(62)) == 4) {
			mdatan(0) = lang("雪原", "Snow Field")
			map_randomtile 57, 4
			map_randomtile 56, 4
			map_randomtile 49, 2
			map_randomtile 46, 1
			map_randomtile 47, 1
			map_randomtile 48, 1
			map_randomtile 51, 1
			repeat 3 + rnd(5)
				flt
				flttypemajor = 80000
				fltselect = 8
				itemcreate -1, 0, -1, -1, 0
				iOwnState(ci) = 1
			loop
		}
		if (mdatan(0) == "") {
			mdatan(0) = lang("平地", "Plain Field")
			map_randomtile 1, 10
			map_randomtile 2, 2
			map_randomtile 3, 2
			map_randomtile 4, 2
			map_randomtile 5, 2
			map_randomtile 6, 2
			repeat 5 + rnd(5)
				flt
				flttypemajor = 80000
				itemcreate -1, 0, -1, -1, 0
				iOwnState(ci) = 1
			loop
		}
		map_placeplayer
		if (264 <= gdata(62) & gdata(62) < 363) {
		} else {
			repeat 4 + rnd(5)
				flt
				flttypeminor = 64000
				itemcreate -1, 0, -1, -1, 0
			loop
		}
		if (encounter == 0) {
			repeat mapDensity + 1
				gosub *label_0937
				flt
				characreate -1, 0, -3, 0
				if (stat) {
					gosub *label_1759
				}
			loop
		}
		if (encounter == 6) {
			mapDensity = 0
			flt
			characreate -1, 354, 14, 11
			flt
			characreate -1, 355, 14, 11
			evadd 23
		}
		if (encounter == 5) {
			mapDensity = 0
			enemylim = 3 + rnd(6)
			enemycount = 0
			repeat 50
				if (enemycount == enemylim) {
					break
				}
				flt calcobjlv(difficulty() * 3 / 2 + 3), 4 + rnd(2)
				initlv = encounterlv / 3 * 2 + rnd(10)
				characreate 56, 0, -3, 0
				if (cRelationship(rc) != (-3) | cOriginalRelationship(rc) != (-3)) {
					continue
				}
				if (cId(rc) == 328 | cId(rc) == 329 | cId(rc) == 166) {
					continue
				}
				cdatan(0, rc) += " Lv" + cLevel(rc)
				relocate_chara 56, -1
				modnpcmemory 1, rc, 1
				cHp(rc) = cMaxHp(rc)
				cMp(rc) = cMaxMp(rc)
				cSp(rc) = cMaxSp(rc)
				enemycount++
			loop
			put_questtarget
			repeat 6 + rnd(6)
				flt
				characreate -1, 360 + rnd(362 - 360 + 1), 14, 11
			loop
			gdatan(1) = random_title(2)
			evadd 103
		}
		if (encounter == 4) {
			mapDensity = 0
			if (rnd(10) == 0 | Seasonal_Check(0, 0)) {
				ccbk = cc
				flt
				initlv = encounterlv
				characreate -1, 356, cX(0), cY(0)
				cc = rc
				repeat 2 + rnd(2)
					flt
					initlv = encounterlv + rnd(10)
					characreate -1, 357, 14, 11
					cdatan(0, rc) += " Lv" + cLevel(rc)
					addfaction rc, "pet," + cc
					ocdata(0, rc) = 3
					ocdata(10, rc) = 1
				loop
				repeat 2 + rnd(2)
					flt
					initlv = encounterlv + rnd(10)
					characreate -1, 358, 14, 11
					cdatan(0, rc) += " Lv" + cLevel(rc)
					addfaction rc, "pet," + cc
					ocdata(0, rc) = 3
					ocdata(10, rc) = 1
				loop
				repeat 2 + rnd(2)
					flt
					initlv = encounterlv + rnd(10)
					characreate -1, 359, 14, 11
					cdatan(0, rc) += " Lv" + cLevel(rc)
					addfaction rc, "pet," + cc
					ocdata(0, rc) = 3
				loop
				cc = ccbk
			} else {
				ccbk = cc
				flt
				initlv = encounterlv
				characreate -1, 302, cX(0), cY(0)
				cc = rc
				repeat 6 + rnd(6)
					flt
					initlv = encounterlv + rnd(10)
					characreate -1, 303 + rnd(305 - 303 + 1), 14, 11
					if (stat) {
						cdatan(0, rc) += " Lv" + cLevel(rc)
						addfaction rc, "pet," + cc
						ocdata(0, rc) = 3
						if (cId(rc) != 305) {
							ocdata(10, rc) = 1
						}
					}
				loop
				cc = ccbk
			}
			gdatan(1) = random_title(2)
			evadd 23
		}
		if (encounter == 3) {
			mapDensity = 0
			mapType = 7
			rq = encounterref
			gExecutingImmediateQuestType = 1007, 1, rq, 1
			p = rnd(3) + 5
			repeat p
				flt qdata(5, rq), 3
				characreate -1, 0, cX(0), cY(0)
				if (stat != 0) {
					cHate(rc) = 30
					cRelationship(rc) = -3
					cOriginalRelationship(rc) = -3
				}
			loop
		}
		if (encounter == 2) {
			if (rnd(20) == 0 | Seasonal_Check(0, 0)) {
				flt
				initlv = difficulty() * 2 / 3
				characreate -1, 249, 10, 11
				cRole(rc) = 1010, encounterlv
				cdatan(0, rc) = lang("行商" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the wandering younger sister vendor")
				generatemoney rc
				repeat encounterlv / 2 + 1
					r1 = rc
					r2 = 1
					gosub *label_0661
				loop
				evadd 11
			} else {
				encounterlv = limit(cFame(0) / 100, 10, 1000)
				ccbk = cc
				flt
				initlv = limitmin(encounterlv / 2 + 1, 35)
				characreate -1, 1, 10, 11
				cRole(rc) = cRole_wanderingVendor, encounterlv
				cdatan(0, rc) = lang("行商人の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the wandering vendor")
				generatemoney rc
				evadd 11
				cc = rc
				repeat 6 + rnd(6)
					flt
					initlv = encounterlv + rnd(10)
					characreate -1, 159 + rnd(161 - 159 + 1), 14, 11
					if (stat) {
						cRole(rc) = 16
						cdatan(0, rc) += " Lv" + cLevel(rc)
						addfaction rc, "pet," + cc
						ocdata(0, rc) = 3
						if (cId(rc) != 161) {
							ocdata(10, rc) = 1
						}
					}
				loop
				cc = ccbk
			}
		}
		if (encounter == 1) {
			p = rnd(9)
			if (cFame(0) <= 1000) {
				p = rnd(3)
			}
			repeat 2 + p
				flt calcobjlv(encounterlv), calcfixlv(2)
				if (gWeather == 1) {
					if (33 <= gdata(62) & gdata(62) < 66) {
					} else {
						if (rnd(3) == 0) {
							fixlv = 5
						}
					}
				}
				if (cnt < 4) {
					characreate -1, 0, cX(0), cY(0)
				} else {
					characreate -1, 0, -3, 0
				}
				cHate(rc) = 30
			loop
		}
		encounter = 0
	}
	if (gCurrentMap == 42) {
		gosub *label_0898
		if (gdata(186) == 0) {
			gdata(186) = areaDangerLevel(gCurrentMap) + 4
		}
		if (gdata(186) <= gCurrentDungeonLevel) {
			evadd 29
		} else {
			areaHasBeenConquered(gCurrentMap) = 0
		}
	}
	if (gCurrentMap == 210) {
		gosub *label_0898
		if (ncgdata(72) == 0) {
			ncgdata(72) = areaDangerLevel(gCurrentMap) - 49
		}
		if (gCurrentDungeonLevel == 1) {
			ncgdata(203) = gCurrentDungeonLevel
		}
		if ((gCurrentDungeonLevel + 1) \ 5 == 0 & gCurrentDungeonLevel != 1 & ncgdata(203) != gCurrentDungeonLevel) {
			evadd 29
		} else {
			areaHasBeenConquered(gCurrentMap) = 0
		}
	}
	if (gCurrentMap == 3) {
		map_tileset mapTileType
		repeat 1
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				map_initcustom "lesimas_1"
				mapDensity = 0
				mapIsFixed = 0
				mapBgm = 66
				mdatan(0) = lang("レシマス最深層", "The Depth")
				if (gdata(250 + 2) < 170) {
					evadd 3
				}
				oomSEST_log "lesimas1"
				x = 16
				y = 13
				cell_featset x, y, tile_upstairs, 10
				mapUpstairs = y * 1000 + x
				map_placeplayer
				oomSEST_log "lesimas2"
				if (npcmemory(0, 2) == 0 | gdata(250 + 2) < 180) {
					flt
					if (gettrait(0, 194) < 0) {
						initlv = 75
					}
					if (gettrait(0, 194) < (-1)) {
						initlv = 90
					}
					characreate -1, 2, 16, 6
					if (gettrait(0, 194) < 0) {
						cAiMove(rc) = 66
						cAiDist(rc) = 2
						cAiActSubFreq(rc) = 25
						cdata(215, rc) = -1, -1, 414, 446, 442
						cdata(220, rc) = 424, 903, 433, 449, 465
						cAiActNum(rc) = 55
					}
					if (gettrait(0, 194) < (-1)) {
						cAiMove(rc) = 66
						cAiDist(rc) = 2
						cAiActSubFreq(rc) = 25
						cdata(210, rc) = 500
						cdata(215, rc) = -1, 416, 416, 416, 509
						cdata(220, rc) = 459, 524, 434, 542, 545
						cAiHeal(rc) = 500
						cAiActNum(rc) = 55
						addfaction rc, "invalid,40"
					}
				} else {
					if (npcmemory(0, 23) == 0) {
						flt
						characreate -1, 23, 16, 6
					}
				}
				oomSEST_log "lesimas3"
				break
			}
			gosub *label_0898
			break
		loop
		if (gCurrentDungeonLevel == 3) {
			characreate -1, 139, cX(0), cY(0)
			cRole(rc) = 3
			cAiCalm(rc) = 3
		}
		if (gCurrentDungeonLevel == 17) {
			characreate -1, 146, cX(0), cY(0)
			cRole(rc) = 3
			cAiCalm(rc) = 3
		}
	}
	if (gCurrentMap == 16) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			map_initcustom "firet1"
			mapDensity = 0
			mapBgm = 66
			map_placeplayer
			rc = 0
			repeat 188, 57
				if (cId(cnt) == 144) {
					rc = cnt
					break
				}
			loop
			if (rc) {
				repeat 188, 57
					if (cId(cnt) == 145) {
						addfaction cnt, "pet," + rc
						break
					}
				loop
			}
		} else {
			gosub *label_0898
		}
	}
	if (gCurrentMap == 17) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			map_initcustom "undeadt1"
			mapDensity = 0
			mapBgm = 66
			map_placeplayer
		} else {
			gosub *label_0898
		}
	}
	if (gCurrentMap == 18) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			map_initcustom "roguet1"
			mapDensity = 0
			mapBgm = 66
			map_placeplayer
		} else {
			gosub *label_0898
		}
	}
	if (gCurrentMap == 19) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			map_initcustom "d_1"
			mapDensity = 0
			mapBgm = 66
			map_placeplayer
		} else {
			gosub *label_0898
		}
	}
	if (gCurrentMap == 27) {
		gosub *label_0898
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (gdata(250 + 205) < 2) {
				if (findally(225) == (-1)) {
					flt
					characreate -1, 225, -3, 0
					cbitmod 979, rc, 1
				}
			}
		}
	}
	if (gCurrentMap == 38) {
		gosub *label_0898
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (gdata(250 + 222) < 2) {
				flt
				characreate -1, 300, -3, 0
			}
		}
	}
	if (gCurrentMap == 28) {
		gosub *label_0898
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (gdata(250 + 208) < 2) {
				flt
				characreate -1, 242, -3, 0
				tc = rc
				repeat 5
					flt
					characreate -1, 240, cX(tc), cY(tc)
				loop
				repeat 10
					flt
					characreate -1, 238, cX(tc), cY(tc)
					flt
					characreate -1, 237, cX(tc), cY(tc)
				loop
			}
		}
	}
	if (gCurrentMap == 37) {
		if (gCurrentDungeonLevel == 20) {
			map_initcustom "sqPyramid"
			mapDensity = 40
			mapBgm = 61
			map_placeplayer
			repeat mapDensity + 1
				gosub *label_0937
				characreate -1, 0, -3, 0
				if (stat) {
					gosub *label_1759
				}
			loop
		}
		if (gCurrentDungeonLevel == 21) {
			map_initcustom "sqPyramid2"
			mapDensity = 0
			mapBgm = 61
			map_placeplayer
			rc = 0
			repeat 188, 57
				if (cId(cnt) == 257) {
					rc = cnt
					break
				}
			loop
			if (rc) {
				repeat 188, 57
					if (cId(cnt) != 257) {
						addfaction cnt, "pet," + rc
					}
				loop
			}
		}
	}
	if (gCurrentMap == 26 | gCurrentMap == 201) {
		gosub *label_0898
	}

	// Towns in South Tyris here
	if (gCurrentMap == areaId_serria) {
		generateSerria
		if (gDestinationDungeonLevel == 1) {
			f = 0
			repeat 188, 57
				if (cId(cnt) == 387) {
					f = 1
					break
				}
			loop
			if (f == 0) {
				f = get_freechara()
				if (f != (-1)) {
					flt
					characreate -1, 387, 30, 6
					cRole(rc) = 3301
				}
			}
			f = 0
			repeat 188, 57
				if (cId(cnt) == 389) {
					f = 1
					break
				}
			loop
			if (f == 0) {
				f = get_freechara()
				if (f != (-1)) {
					flt
					characreate -1, 389, 3, 33
					cRole(rc) = 3303
				}
			}
		}
	}
	if (gCurrentMap == areaId_tormat) {
		generateTormat
		if (gDestinationDungeonLevel == 1) {
			f = 0
			repeat 188, 57
				if (cId(cnt) == 386) {
					f = 1
					break
				}
			loop
			if (f == 0) {
				f = get_freechara()
				if (f != (-1)) {
					flt
					characreate -1, 386, 26, 2
					cRole(rc) = 3300
				}
			}
		}
	}
	if (gCurrentMap == areaId_khios) {
		generateKhios
		f = 0
		repeat 188, 57
			if (cId(cnt) == 392) {
				f = 1
				break
			}
		loop
		if (f == 0) {
			f = get_freechara()
			if (f != (-1)) {
				flt
				characreate -1, 392, 23, 13
				cRole(rc) = 3306
			}
		}
	}
	if (gCurrentMap == areaId_carlia) {
		generateCarlia
		if (gDestinationDungeonLevel == 1) {
			f = 0
			repeat 188, 57
				if (cId(cnt) == 388) {
					f = 1
					break
				}
			loop
			if (f == 0) {
				f = get_freechara()
				if (f != (-1)) {
					flt
					characreate -1, 388, 30, 23
					cRole(rc) = 3302
				}
			}
		}
	}
	if (gCurrentMap == areaId_trian) {
		generateTrian
		f = 0
		repeat 188, 57
			if (cId(cnt) == 391) {
				f = 1
				break
			}
		loop
		if (f == 0) {
			f = get_freechara()
			if (f != (-1)) {
				flt
				characreate -1, 391, 15, 15
				cRole(rc) = 3305
			}
		}
	}
	if (gCurrentMap == 57) {
		map_tileset mapTileType
		repeat 1
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				map_initcustom "st_ancientruins"
				mapDensity = 0
				inv_getheader -1
				repeat invrange, invhead
					iOwnState(cnt) = 0
				loop
				map_placeplayer
				flt
				fixlv = 6
				initlv = 30
				characreate -1, 278, 27, 6
				cAiMove(rc) = 33
				cAiDist(rc) = 2
				cAiActSubFreq(rc) = 25
				cdata(215, rc) = -1
				cdata(220, rc) = 450, 421, 442
				cAiActNum(rc) = 31
				skillinit 172, rc, 15
				cdatan(0, rc) = lang("《古代のミュータント》", "<Ruins mutant>")
				addfaction rc, "st_ruinboss"
				ocdata(191, rc) = 7
				break
			}
			gosub *label_0898
			break
		loop
	}
	if (gCurrentMap == 58) {
		map_tileset mapTileType
		repeat 1
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				map_initcustom "st_abandoned"
				mapDensity = 0
				inv_getheader -1
				repeat invrange, invhead
					iOwnState(cnt) = 0
				loop
				map_placeplayer
				flt
				fixlv = 6
				initlv = 10
				characreate -1, 50, 24, 9
				cAiMove(rc) = 60
				cAiDist(rc) = 1
				cAiActSubFreq(rc) = 30
				cdata(215, rc) = -1
				cdata(220, rc) = 619
				cAiActNum(rc) = 11
				skillinit 186, rc, 3
				cdatan(0, rc) = lang("《飢えた猟犬》", "<Hungry hound>")
				ocdata(191, rc) = 7
				addfaction rc, "st_ruralboss"
				flt
				if (finditemid("blacksmith hammer")) {
					inititemid = stat
					itemcreate -1, 743, 7, 21
				}
				break
			}
			gosub *label_0898
			break
		loop
	}
	if (gCurrentMap == 59) {
		map_initcustom "st_fea"
		mapDensity = 0
		inv_getheader -1
		repeat invrange, invhead
			iOwnState(cnt) = 0
		loop
		mapBgm = 63
		flt
		initlv = 120
		fixlv = 6
		characreate -1, 250, 12, 4
		cImage(rc) = 455
		cAiCalm(rc) = 1
		cAiMove(rc) = 80
		cAiDist(rc) = 2
		cAiActSubFreq(rc) = 20
		creaturepack = 0
		cdata(215, rc) = -2, -2, -2, 460, 460
		cdata(220, rc) = 434, 434, 433, 433, 901
		cAiActNum(rc) = 55
		skillinit 2, rc, 70
		skillinit 3, rc, 300
		skillinit 10, rc, 10
		skillinit 11, rc, 10
		skillinit 12, rc, 15
		skillinit 13, rc, 15
		skillinit 14, rc, 25
		skillinit 15, rc, 25
		skillinit 16, rc, 30
		skillinit 17, rc, 20
		skillinit 172, rc, 45
		skillinit 173, rc, 12
		skillinit 187, rc, 10
		gosub *chara_refresh
		cHp(rc) = cMaxHp(rc)
		cMp(rc) = cMaxMp(rc)
		if (jp) {
			cdatan(0, rc) = "混沌の妖精『カオシー』"
		} else {
			cdatan(0, rc) = "<Chaosy> the Chaos fairy"
		}
		faction(rc) = ""
		addfaction rc, "align,chaotic"
		addfaction rc, "st_feaboss"
		map_placeplayer
	}
	if (gCurrentMap == 60) {
		map_tileset mapTileType
		repeat 1
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				map_initcustom "st_henikutu"
				mapDensity = 0
				mapBgm = 66
				mdatan(0) = lang("最深層", "The Depth")
				flt
				initlv = 100
				fixlv = 6
				characreate -1, 24, 16, 11
				cAiMove(rc) = 60
				cAiDist(rc) = 1
				cAiActSubFreq(rc) = 20
				cdata(215, rc) = -1, 631, 631, 619, 619
				cdata(220, rc) = 459, 459, 459, 402, 424
				cAiActNum(rc) = 55
				skillinit 2, rc, 100
				skillinit 3, rc, 100
				skillinit 18, rc, 50
				skillinit 152, rc, 10
				skillinit 172, rc, 20
				skillinit 166, rc, 10
				skillinit 167, rc, 10
				skillinit 186, rc, 5
				gosub *chara_refresh
				cHp(rc) = cMaxHp(rc)
				cMp(rc) = cMaxMp(rc)
				if (jp) {
					cdatan(0, rc) = "洞窟の主『サーペンテ』"
				} else {
					cdatan(0, rc) = "<Servente> the Cave Boss"
				}
				addfaction rc, "st_caveboss"
				map_placeplayer
				break
			}
			gosub *label_0898
			break
		loop
	}
	if (gCurrentMap == 61) {
		map_initcustom "st_secret"
		mapDensity = 0
		flt
		fixlv = 6
		initlv = 74
		characreate -1, 250, 20, 26
		cRole(rc) = 3111, 100
		cOriginalRelationship(rc) = 0
		cRelationship(rc) = 0
		cShopStoreId(rc) = 3111
		cdata(215, rc) = -2, -2, -2, 460, 460
		cdata(220, rc) = 654
		cAiActNum(rc) = 51
		cImage(rc) = 456
		faction(rc) = ""
		addfaction rc, "family,man"
		addfaction rc, "align,neutral"
		addfaction rc, "god,eyth"
		cSex(rc) = 1
		if (jp) {
			cdatan(0, rc) = "『卵屋さんの妖精』"
		} else {
			cdatan(0, rc) = "<Egg Shop Fairy>"
		}
		itemcreate -1, 573, 17, 26, 1
		iCurseState(ci) = 0
		iSubname(ci) = 250
		ibitmod 5, ci, 1
		iEnchantmentId(ci, 0) = 10010
		iEnchantmentPower(ci, 0) = 500
		iEnchantmentId(ci, 1) = 60010
		iEnchantmentPower(ci, 1) = 450
		iParam4(ci) = 0
		ibitmod 8, ci, 0
		itemcreate -1, 573, 21, 28, 1
		iCurseState(ci) = 0
		iSubname(ci) = 250
		ibitmod 5, ci, 1
		iEnchantmentId(ci, 0) = 10011
		iEnchantmentPower(ci, 0) = 500
		iEnchantmentId(ci, 1) = 60011
		iEnchantmentPower(ci, 1) = 450
		iParam4(ci) = 0
		ibitmod 8, ci, 0
		itemcreate -1, 573, 18, 30, 1
		iCurseState(ci) = 0
		iSubname(ci) = 250
		ibitmod 5, ci, 1
		iEnchantmentId(ci, 0) = 10012
		iEnchantmentPower(ci, 0) = 500
		iEnchantmentId(ci, 1) = 60012
		iEnchantmentPower(ci, 1) = 450
		iParam4(ci) = 0
		ibitmod 8, ci, 0
		mapBgm = 95
		map_placeplayer
	}
	if (gCurrentMap == 62) {
		map_tileset mapTileType
		repeat 1
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				map_initcustom "nc_subquest_ice"
				mapDensity = 0
				map_placeplayer
				flt
				fixlv = 6
				initlv = 25
				characreate -1, 122, 9, 2
				cAiMove(rc) = 33
				cAiDist(rc) = 1
				cAiActSubFreq(rc) = 25
				cdata(215, rc) = -1
				cdata(220, rc) = 932, 603, 604
				cAiActNum(rc) = 31
				cdatan(0, rc) = lang("《氷窟の主》", "<Master of the ice cave>")
				addfaction rc, "nc_iceboss"
				ocdata(191, rc) = 7
				break
			}
			gosub *label_0898
			break
		loop
	}
	if (gCurrentMap == 63) {
		map_initcustom "nc_subquest_iseki"
		mapBgm = 66
		mapDensity = 0
		map_placeplayer
		flt
		characreate -1, 393, 25, 9
		addfaction rc, "nc_isekiboss"
	}
	map_setfog
	oomSEST_log "map_init:1"
	if (gCurrentMap == 40 | gCurrentMap == 49 | dbg_revealmap | gCurrentMap == 6 | mapType == 3 | mapType == 1 | mapType == 5 | mapType == 2 | gCurrentMap == 30 | gCurrentMap == 32 | gCurrentMap == 34 | gCurrentMap == 35 | (gCurrentMap == 13 & gExecutingImmediateQuestType == 1009)) {
		repeat mapHeight
			y = cnt
			repeat mapWidth
				map(cnt, y, 2) = map(cnt, y, 0)
			loop
		loop
	}
	if (mapupdate == 1) {
		if (mapType == 1) {
			f = 0
			i = 0
			repeat 500 - 300, 300
				p = cnt
				if (areaX(cnt) == 0 | areaY(cnt) == 0 | areaId(cnt) == 0) {
					continue
				}
				repeat 300
					if (areaX(cnt) == 0 | areaY(cnt) == 0 | areaId(cnt) == 0) {
						continue
					}
					if (areaX(p) == areaX(cnt)) {
						if (areaY(p) == areaY(cnt)) {
							if (areaOuterMap(p) == areaOuterMap(cnt)) {
								repeat
									await
									dx = limit(rnd(cnt / 4 + 1) + 1, 1, mapWidth)
									dy = limit(rnd(cnt / 4 + 1) + 1, 1, mapHeight)
									x = areaX(p) + rnd(dx) - rnd(dx)
									y = areaY(p) + rnd(dy) - rnd(dy)
									if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
										continue
									}
									if (33 <= map(x, y, 0) & map(x, y, 0) < 66) {
										continue
									}
									if (map(x, y, 0) > 19) {
										continue
									}
									i = 1
									repeat 300
										if (areaX(cnt) == 0 | areaY(cnt) == 0 | areaId(cnt) == 0) {
											continue
										}
										if (x == areaX(cnt)) {
											if (y == areaY(cnt)) {
												i = 0
												break
											}
										}
									loop
									if (i == 0) {
										continue
									}
									dialog lang("エリアが再配置されます。" + mapname(p) + "の位置は、x" + areaX(p) + ":y" + areaY(p) + "からx" + x + ":y" + y + "に変更されます。", "The location of " + mapname(p) + " has been changed from x" + areaX(p) + ":y" + areaY(p) + " to x" + x + ":y" + y + ".")
									areaX(p) = x
									areaY(p) = y
									f++
									break
								loop
							}
						}
					}
				loop
			loop
			gosub *label_0950
		}
		mapupdate = 0
		repeat 245
			if (cState(cnt) == 0) {
				continue
			}
			if (chara_isShopKeeper(cnt)) {
				cnt2 = cnt
				repeat maxnpcbk
					if (cRole(cnt2) == rolebk(0, cnt)) {
						cShopRank(cnt2) = rolebk(1, cnt)
						rolebk(0, cnt) = 0, 0
						break
					}
				loop
			}
		loop
		repeat maxmedal
			cell_featset medalbk(0, cnt), medalbk(1, cnt), tile_hidden, 32
		loop
	}
	randomize
	mdata(19) = gdata(184)
	mdata(21) = 1
	if (areaType(gCurrentMap) >= 20) {
		if (sdata(159, 0) > 0) {
			evadd 106
		}
	}
*label_0944
	oomSEST_log "map_preBegin"
	// バッファ変数のリセット
	repeat length(cmgbuff)
		cmgbuff(cnt) = 0
	loop
	if (gCurrentMap == 4) {
		if (gdata(250 + 2) == 180) {
			cX(0) = areaX(11)
			cY(0) = areaY(11)
			gdata(35) = 1
			gdata(60) = -1
			msg_newline
			msgtemp = lang("  三年の月日が経ち、あなたは再びノースティリスに降り立った。", "  Three years elapsed and you set foot on cool soil of North Tyris's again.")
		}
	}
	if (areaId(gCurrentMap) == 39) {
		if (gCurrentDungeonLevel != ogdata(25)) {
			repeat 188, 57
				if (cId(cnt) == 205) {
					cQuality(cnt) = 2
					if (instr(cdatan(0, cnt), 0, "メイド長") != (-1)) {
						sreplace cdatan(0, cnt), cdatan(0, cnt), "メイド長", "メイド"
					}
				}
			loop
		}
	}
	if (oabit(2, gCurrentMap)) {
		if (gMount) {
			ride_end
		}
		repeat 16
			if (cState(cnt) == 1) {
				if (cRelationship(cnt) == 10) {
					if (cnt != 0) {
						map(cX(cnt), cY(cnt), 1) = 0
						cState(cnt) = 8
					}
				}
			}
		loop
	}
	repeat 40 - 1, 16
		if (cState(cnt) != 3) {
			continue
		}
		if (ocdata(190, cnt) != 0 & ocdata(190, cnt) != cnt) {
			continue
		}
		if (cbit(969, cnt)) {
			cRelationship(cnt) = 10
			cCurrentMap(cnt) = gCurrentMap
		} else {
			if (cCurrentMap(cnt) != gCurrentMap) {
				continue
			}
			if (mapType != 3 & mapType != 2 & mapType != 20 & mapType != 21 & mapType != 22 & mapType != 23 & areaId(gCurrentMap) != 39) {
				continue
			}
			if (areaId(gCurrentMap == 39)) {
				if (gCurrentDungeonLevel == 0) {
					continue
				}
			}
			if (mapType >= 20 | areaId(gCurrentMap == 39)) {
				if (rnd(5) != 0) {
					continue
				}
			} else {
				if (gCurrentDungeonLevel != 1) {
					continue
				}
			}
		}
		if (gCurrentMap == 6 | gCurrentMap == 40 | gCurrentMap == 49) {
			continue
		}
		if (oabit(2, gCurrentMap)) {
			continue
		}
		rc = cnt
		cState(rc) = 1
		if (cbit(969, cnt) == 1) {
			cxinit = cX(0)
			cyinit = cY(0)
			place_chara rc, cxinit, cyinit
		} else {
			cxinit = -1
			place_chara rc, cxinit
			cHp(rc) = cMaxHp(rc)
			cMp(rc) = cMaxMp(rc)
			repeat 40 - 1, 16
				if (ocdata(190, cnt) == rc) {
					if (cnt != rc) {
						cxinit = cX(rc)
						cyinit = cY(rc)
						cState(cnt) = 1
						place_chara cnt, cxinit, cyinit
						cHp(cnt) = cMaxHp(cnt)
						cMp(cnt) = cMaxMp(cnt)
					}
				}
			loop
		}
		r1 = cnt
		gosub *chara_refresh
	loop
	/* 混沌再生成 */
	if (ogdata(447) == 2) {
		if (gCurrentDungeonLevel == 33) {
			if (ogdata(400) == 1) {
				if (gCurrentMap == 22) {
					if (findchara(175) == 0) {
						flt
						characreate -1, 175, 12, 14
						ogdata(400) = 0
					}
				}
			}
			if (ogdata(401) == 1) {
				if (gCurrentMap == 23) {
					if (findchara(177) == 0) {
						flt
						characreate -1, 177, 12, 14
						ogdata(401) = 0
					}
				}
			}
			if (ogdata(402) == 1) {
				if (gCurrentMap == 24) {
					if (findchara(178) == 0) {
						flt
						characreate -1, 178, 12, 14
						ogdata(402) = 0
					}
				}
			}
			if (ogdata(403) == 1) {
				if (gCurrentMap == 59) {
					if (findchara(250) == 0) {
						flt
						initlv = 120
						fixlv = 6
						characreate -1, 250, 12, 4
						cImage(rc) = 455
						cAiCalm(rc) = 1
						cAiMove(rc) = 80
						cAiDist(rc) = 2
						cAiActSubFreq(rc) = 20
						creaturepack = 0
						cdata(215, rc) = -2, -2, -2, 460, 460
						cdata(220, rc) = 434, 434, 433, 433, 901
						cAiActNum(rc) = 55
						skillinit 2, rc, 70
						skillinit 3, rc, 300
						skillinit 10, rc, 10
						skillinit 11, rc, 10
						skillinit 12, rc, 15
						skillinit 13, rc, 15
						skillinit 14, rc, 25
						skillinit 15, rc, 25
						skillinit 16, rc, 30
						skillinit 17, rc, 20
						skillinit 172, rc, 45
						skillinit 173, rc, 12
						skillinit 187, rc, 10
						gosub *chara_refresh
						cHp(rc) = cMaxHp(rc)
						cMp(rc) = cMaxMp(rc)
						if (jp) {
							cdatan(0, rc) = "混沌の妖精『カオシー』"
						} else {
							cdatan(0, rc) = "<Chaosy> the Chaos fairy"
						}
						faction(rc) = ""
						addfaction rc, "align,chaotic"
						addfaction rc, "st_feaboss"
						ogdata(403) = 0
					}
				}
			}
		}
	}
	if (mapIsFixed == 1) {
		if (getgametime() >= mapTimeOfNextRegeneration) {
			if (mdata(17) == 0) {
				if (mapTimeOfNextRegeneration != 0) {
					if (gCurrentDungeonLevel == 1) {
						if (gCurrentMap == 36) {
							map_reload "lumiest"
						}
						if (gCurrentMap == 5) {
							map_reload "vernis"
						}
						if (gCurrentMap == 15) {
							map_reload "palmia"
						}
						if (gCurrentMap == 11) {
							map_reload "kapul"
						}
						if (gCurrentMap == 12) {
							map_reload "yowyn"
						}
						if (gCurrentMap == 14) {
							map_reload "rogueden"
						}
						if (gCurrentMap == 33) {
							if (gMonth == 12 & ogbit(9) == 0) {
								if (areaChristmasFestival(gCurrentMap) == 0) {
									areaChristmasFestival(gCurrentMap) = 1
									gosub *label_0956
								}
								map_reload "noyel_fest"
							} else {
								if (areaChristmasFestival(gCurrentMap) == 1) {
									areaChristmasFestival(gCurrentMap) = 0
									gosub *label_0956
								}
								map_reload "noyel"
							}
							gdata(250 + 8) = 0
						}
						/* South Tyrist BEGIN */
						if (gCurrentMap == areaId_serria) {
							map_reload "st_serria"
							map_placeItemsSerria
						}
						if (gCurrentMap == areaId_tormat) {
							map_reload "st_tormat"
						}
						if (gCurrentMap == areaId_khios) {
							map_reload "st_khios"
							map_placeItemsKhios
						}
						if (gCurrentMap == areaId_carlia) {
							map_reload "st_carlia"
						}
						if (gCurrentMap == areaId_trian) {
							map_reload "st_trian"
						}
						/* South Tyrist END */
						if (gCurrentMap == 200) {
							map_reload "nc_crippletown"
						}
					}
				}
			}
		}
		repeat mapHeight
			y = cnt
			repeat mapWidth
				map(cnt, y, 1) = 0
			loop
		loop
		repeat 245
			rc = cnt
			cbitmod 987, rc, 0
			if (rc < 57) {
				if (mode == 11) {
					continue
				}
			}
			if (cState(rc) == 2) {
				if (getgametime() >= cTimeToRevive(rc)) {
					gosub *label_0740
				} else {
					continue
				}
			}
			if (cState(rc) != 1) {
				continue
			}
			if (cRole(rc) == 14) {
				if (cKarma(0) < (-30)) {
					if (difficulty() > cLevel(rc)) {
						r1 = rc
						r2 = 1
						gosub *label_0661
					}
				}
			}
			if (rc >= 57) {
				cHp(rc) = cMaxHp(rc)
				cMp(rc) = cMaxMp(rc)
				cInsanity(rc) = 0
			}
			if (rc >= 57) {
				if (mapDefaultAiCalm == 1) {
					cX(rc) = cInitialX(rc)
					cY(rc) = cInitialY(rc)
				}
				if (cbit(970, rc) == 0) {
					cHate(rc) = 0
					cRelationship(rc) = cOriginalRelationship(rc)
				}
				if (cRole(rc) == 14) {
					if (cKarma(0) < (-30)) {
						if (cbit(16, 0) == 0) {
							cHate(rc) = 200
							cRelationship(rc) = -3
						}
					}
				}
				if (mapType == 3 | mapType == 2) {
					cSleep(rc) = 0
					if (gHour >= 22 | gHour < 7) {
						if (rnd(6) == 0) {
							cSleep(rc) = rnd(400)
						}
					}
				}
			}
			if (rc == 0 | (gMount != rc & ocdata(107, rc) == 0)) {
				cell_check cX(rc), cY(rc)
				if (map(cX(rc), cY(rc), 1) != 0 | cellaccess != 1) {
					repeat
						x = cX(rc) + rnd(cnt / 2 + 2) - rnd(cnt / 2 + 2)
						y = cY(rc) + rnd(cnt / 2 + 2) - rnd(cnt / 2 + 2)
						if (cnt > 100) {
							x = rnd(mapWidth)
							y = rnd(mapHeight)
						}
						if (cnt > 1000) {
							break
						}
						cell_check x, y
						if (cellaccess == 1) {
							cX(rc) = x
							cY(rc) = y
							break
						}
					loop
				}
			}
			if (cbit(975, rc) == 0) {
				map(cX(rc), cY(rc), 1) = rc + 1
			}
		loop
	}
*label_0945
	dim efmap, 4, mapWidth, mapHeight
	if (mapWidth == 0 | mapHeight == 0) {
		dialog lang("マップのロードに失敗しました。", "Map loading failed.")
		mode = 2
		gCurrentMap = 7
		gCurrentDungeonLevel = 1
		gPcXInWorldMap = areaX(7)
		gPcYInWorldMap = areaY(7)
		gPreviousMap = 2
		levelexitby = 4
		goto *label_0942
	}
	if (gCurrentMap == 35) {
		gosub *custom_loadCnpcs
		gosub *custom_loadCitems
	}
	if (cfg_reloadcnpc == 1) {
		if (gPreviousMap == 35) {
			gosub *custom_loadCnpcs
			gosub *custom_loadCitems
		}
	}
	repeat 5480
		if (iId(cnt) == 743) {
			getitemid cnt
		}
		checkalter cnt
	loop
	if (gCurrentMap == 35) {
		repeat 188, 57
			if (cState(cnt) == 1) {
				if (cId(cnt) == 343) {
					if (cCnpcId(cnt) == usernpcmax) {
						map(cX(cnt), cY(cnt), 1) = 0
						del_chara cnt
						continue
					}
					if (userdata(12, cCnpcId(cnt)) == 2) {
						map(cX(cnt), cY(cnt), 1) = 0
						del_chara cnt
						continue
					}
				}
				rc = cnt
				gosub *label_1539
			}
		loop
	}
	memset mapinv, 0, mapWidth * mapHeight * 4
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) > 0) {
			if (mapinv(iX(cnt), iY(cnt)) == 0) {
				mapinv(iX(cnt), iY(cnt)) = cnt + 1
			} else {
				mapinv(iX(cnt), iY(cnt)) = -1
			}
		}
	loop
	oomSEST_log "Map:Prepare tile"
	cCurrentMap(0) = gCurrentMap, gCurrentDungeonLevel
	raderx = -1
	radery = -1
	raderw = 120 / mapWidth + 2
	raderh = 84 / mapHeight + 2
	scx = cX(0)
	scy = cY(0)
	msync = 1
	gosub *label_0947
	gosub *label_0644
	gosub *label_0632
	oomSEST_log "Map:Recaluculate crowd"
	gCrowdDensity = 0
	if (areaId(gCurrentMap) == 39) {
		ogdata(gCurrentDungeonLevel + 10) = 0
	}
	repeat 245
		cTurnCost(cnt) = 0
		if (cId(cnt) == 343) {
			getunid cnt
			r1 = cnt
			gosub *chara_refresh
		}
		if (noaggrorefresh == 0) {
			unlockson cnt
			cHate(cnt) = 0
			ocbitmod 14, c@m139, 0
		}
		cVisionFlag(cnt) = 0
		if (cnt >= 57) {
			if (cState(cnt) != 0) {
				addcrowd gCrowdDensity, 1
				if (areaId(gCurrentMap) == 39) {
					if (cRole(cnt) == 0) {
						ogdata(gCurrentDungeonLevel + 10)++
					}
				}
				if (gCurrentMap == 35) {
					cHp(cnt) = cMaxHp(cnt)
				}
			}
		}
	loop
	repeat 5480
		if (inv(34, cnt)) {
			getunid4item cnt
		}
	loop
	oomSEST_log "Map:Check renew"
	gosub *label_0946
	oomSEST_log "Map:Update quest"
	if (mapType == 3) {
		gosub *quest_updateQuests
	}
	if (mode == 11) {
		return
	}
	repeat gNumberOfExistingQuests
		if (qdata(0, cnt) == 0) {
			continue
		}
		if (qdata(3, cnt) == 1008 | qdata(3, cnt) == 1010 & qdata(12, cnt) == 343) {
			getunid4job cnt
		}
	loop
	oomSEST_log "Map:Proc scene"
	if (gdata(250 + 2) == 9) {
		sceneid = 2
		gosub *label_1553
		gdata(250 + 2) = 10
	}
	if (gdata(250 + 2) == 60) {
		sceneid = 5
		gosub *label_1553
		gdata(250 + 2) = 65
	}
	if (gdata(250 + 2) == 110) {
		sceneid = 26
		gosub *label_1553
		gdata(250 + 2) = 115
	}
	if (gdata(250 + 2) == 115) {
		if (gdata(250 + 3) + gdata(250 + 5) + gdata(250 + 4) >= 1) {
			sceneid = 28
			gosub *label_1553
			gdata(250 + 2) = 116
		}
	}
	if (gdata(250 + 2) == 116) {
		if (gdata(250 + 3) + gdata(250 + 5) + gdata(250 + 4) >= 2) {
			sceneid = 29
			gosub *label_1553
			gdata(250 + 2) = 117
		}
	}
	if (gdata(250 + 2) == 117) {
		if (gdata(250 + 3) + gdata(250 + 5) + gdata(250 + 4) >= 3) {
			sceneid = 30
			gosub *label_1553
			gdata(250 + 2) = 120
		}
	}
	if (gCurrentMap == 3) {
		if (gdata(250 + 2) == 10) {
			sceneid = 3
			gosub *label_1553
			gdata(250 + 2) = 20
		}
		if (gCurrentDungeonLevel == 4) {
			if (gdata(250 + 2) == 65) {
				sceneid = 7
				gosub *label_1553
				gdata(250 + 2) = 70
			}
		}
		if (gCurrentDungeonLevel == 7) {
			if (gdata(250 + 2) == 70) {
				sceneid = 15
				gosub *label_1553
				gdata(250 + 2) = 75
			}
		}
		if (gCurrentDungeonLevel == 10) {
			if (gdata(250 + 2) == 75) {
				sceneid = 16
				gosub *label_1553
				gdata(250 + 2) = 80
			}
		}
		if (gCurrentDungeonLevel == 14) {
			if (gdata(250 + 2) == 80) {
				sceneid = 17
				gosub *label_1553
				gdata(250 + 2) = 85
			}
		}
		if (gCurrentDungeonLevel == 16) {
			if (gdata(250 + 2) == 85) {
				sceneid = 24
				gosub *label_1553
				gdata(250 + 2) = 90
			}
		}
		if (gCurrentDungeonLevel == 26) {
			if (gdata(250 + 2) == 125) {
				sceneid = 33
				gosub *label_1553
				gdata(250 + 2) = 130
			}
		}
		if (gCurrentDungeonLevel == 28) {
			if (gdata(250 + 2) == 130) {
				sceneid = 35
				gosub *label_1553
				gdata(250 + 2) = 135
			}
		}
		if (gCurrentDungeonLevel == 31) {
			if (gdata(250 + 2) == 135) {
				sceneid = 40
				gosub *label_1553
				gdata(250 + 2) = 140
			}
		}
		if (gCurrentDungeonLevel == 35) {
			if (gdata(250 + 2) == 140) {
				sceneid = 60
				gosub *label_1553
				gdata(250 + 2) = 145
			}
		}
		if (gCurrentDungeonLevel == 38) {
			if (gdata(250 + 2) == 145) {
				sceneid = 70
				gosub *label_1553
				gdata(250 + 2) = 150
			}
		}
		if (gCurrentDungeonLevel == 42) {
			if (gdata(250 + 2) == 150) {
				sceneid = 90
				gosub *label_1553
				gdata(250 + 2) = 160
			}
		}
	}
	oomSEST_log "Map:Area specific"
	if (areaId(gCurrentMap) == 33) {
		tc = findchara(222)
		if (tc != 0) {
			if (gdata(250 + 203) >= 10) {
				cImage(tc) = 360
				cPortrait(tc) = -1
			}
		}
	}
	if (areaId(gCurrentMap) == 36) {
		if (gCurrentDungeonLevel == 3) {
			evadd 22, guildcheck(0) == "mage"
		}
	}
	if (areaId(gCurrentMap) == 14) {
		if (gCurrentDungeonLevel == 3) {
			evadd 22, guildcheck(0) == "thieve"
		}
	}
	if (areaId(gCurrentMap) == 11) {
		if (gCurrentDungeonLevel == 3) {
			evadd 22, guildcheck(0) == "fighter"
		}
	}
	if (areaId(gCurrentMap) == areaId_carlia) {
		if (gCurrentDungeonLevel == 3) {
			evadd 22, guildcheck(0) == "blacksmith"
		}
	}
	if (areaId(gCurrentMap) == areaId_tormat) {
		if (gCurrentDungeonLevel == 3) {
			evadd 22, guildcheck(0) == "prostitute"
		}
	}
	if (ogdata(29)) {
		evadd 108
	}
	if (gCurrentMap == 5) {
		if (gdata(250 + 2) == 0) {
			sceneid = 1
			gosub *label_1553
			gdata(250 + 2) = 9
		}
		if (gdata(250 + 7) == 0) {
			evadd 12
		}
	}
	if (gCurrentMap == 15) {
		if (gdata(250 + 2) == 30) {
			sceneid = 4
			gosub *label_1553
			gdata(250 + 2) = 40
		}
		if (gdata(250 + 2) == 100) {
			sceneid = 25
			gosub *label_1553
			gdata(250 + 2) = 105
		}
	}
	if (gCurrentMap == 4) {
		if (gdata(250 + 2) == 180) {
			sceneid = 100
			gosub *label_1553
			gdata(250 + 2) = 200
			gYear += 3
			repeat 16
				if (gettrait(cnt, 131) == 1) {
					cBirthYear(cnt) += 3
					if (cBirthYear(cnt) > gYear) {
						cBirthYear(cnt) = gYear
					}
				}
			loop
		}
	}
	if (areaId(gCurrentMap) == 8) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (areaHasBeenConquered(gCurrentMap) == (-1)) {
				msgtemp += lang("辺りからは何の緊張感も感じられない。" + mapname(gCurrentMap) + "の主はもういないようだ。", "This place is pretty dull. The dungeon master is no longer sighted here.")
			}
		}
	}
	if (ogdata(28)) {
		if (findchara(210, 6, 1)) {
			tc = stat
			if (cRole(tc) == 20001) {
				lockon tc, 0, 7
				cHate(tc) = 1000
			}
		} else {
			ogdata(28) = 0
		}
	} else {
		if (evfind(107) == 0) {
			if (findchara(210, 6)) {
				chara_vanquish stat
			}
		}
	}
	if (ogdata(24) == 2) {
		if (findchara(263, 6) == 0) {
			ogdata(24) = 0
			gdata(73) = 3
			gExecutingImmediateQuestType = 0
			ogdata(60) = 0
		}
	} else {
		if (evfind(110) == 0) {
			if (findchara(263, 6)) {
				if (cRole(stat) == 20004) {
					chara_vanquish stat
				}
			}
		}
	}
	oomSEST_log "Map:Init music"
	gosub *label_0122
	gosub *label_1313
	oomSEST_log "Map:Init world"
	noaggrorefresh = 0
	if (areaType(gCurrentMap) == 1) {
		gosub *label_0247
		gosub *label_0949
	}
	oomSEST_log "Map:Continue"
	if (mode == 3) {
		mode = 0
		if (mapsubroutine == 0) {
			screenupdate = -1
			gosub *label_0621
			txt_conv
			gosub *label_0623
			if (evnum == 0) {
				goto *label_1623
			} else {
				goto *label_1608
			}
		} else {
			mapsubroutine = 0
			return
		}
	}
	oomSEST_log "Map:Update area"
	wake_up
	pcattacker = 0
	unlockson 0
	gdata(94) = 0
	mode = 0
	screenupdate = -1
	gosub *label_0621
	txt_conv
	if (gCurrentMap == 7) {
		if (gdata(250 + 2) != 0) {
			if (findchara(33) != 0) {
				if (cRole(stat) != 10001 & cRole(stat) != 10018 & eqfaction(stat, "petshop") == 0) {
					chara_vanquish findchara(33)
				}
			}
			if (findchara(34) != 0) {
				if (cRole(stat) != 10001 & cRole(stat) != 10018 & eqfaction(stat, "petshop") == 0) {
					chara_vanquish findchara(34)
				}
			}
		}
	}
	if (gCurrentMap == 15) {
		if (gdata(250 + 2) >= 90) {
			if (findchara(80) != 0) {
				chara_vanquish findchara(80)
			}
		}
	}
	if (mapType == 3) {
		repeat gNumberOfExistingQuests
			if (qdata(3, cnt) == 1007) {
				if (qdata(8, cnt) == 1) {
					cnt2 = cnt
					repeat 16
						if (cbit(963, cnt) == 1) {
							if (cState(cnt) == 1) {
								if (cId(cnt) == qdata(13, cnt2)) {
									if (qdata(12, cnt2) == gCurrentMap) {
										evadd 16, cnt2, cnt
										cbitmod 963, cnt, 0
										break
									}
								}
							}
						}
					loop
				}
			}
		loop
	}
	if (areaId(gCurrentMap) == 101 | areaId(gCurrentMap) == 102) {
		repeat 5
			gosub *label_0938
		loop
	}
	if (mapIsFixed == 1) {
		gosub *label_0775
	}
	if (areaId(gCurrentMap) == 102) {
		gosub *label_0929
	}
	if (areaId(gCurrentMap) == 101) {
		gosub *label_0931
	}
	if (gCurrentMap == 7) {
		gosub *housing_calculateHomeValue
	}
	if (areaId(gCurrentMap) == 31) {
		repeat 245
			if (cbit(960, cnt) == 1) {
				cHate(cnt) = 0
				cRelationship(cnt) = -1
				cOriginalRelationship(cnt) = -1
				resetfaction cnt
				addfaction cnt, "pet,0"
			}
		loop
	}
	oomSEST_log "Map:Init final"
	if (mapType == 1) {
		if (cfg_extrahelp) {
			if (gdata(200 + 2) == 0) {
				if (mode == 0) {
					if (cContinuousActionTurn(0) == 0) {
						gdata(200 + 2) = 1
						ghelp = 2
						gosub *label_1575
					}
				}
			}
		}
	}
	if (mapType == 3) {
		if (cfg_extrahelp) {
			if (gdata(200 + 3) == 0) {
				if (mode == 0) {
					if (cContinuousActionTurn(0) == 0) {
						gdata(200 + 3) = 1
						ghelp = 3
						gosub *label_1575
					}
				}
			}
		}
	}
	if (gCurrentMap == 30) {
		if (cfg_extrahelp) {
			if (gdata(200 + 14) == 0) {
				if (mode == 0) {
					if (cContinuousActionTurn(0) == 0) {
						gdata(200 + 14) = 1
						ghelp = 14
						gosub *label_1575
					}
				}
			}
		}
	}
	if (mapType == 3 | gCurrentMap == 7 | mapType == 2) {
		if (gDistanceBetweenTown >= 16) {
			p = getgametime() - gDepartureDate
			txt -1, lang(cnvdate(gDepartureDate) + "に" + mapname(gLeftTownMap) + "を発ってから、" + p / 24 + "日と" + p \ 24 + "時間の旅を終えた。", "" + p / 24 + " days and " + p \ 24 + " hours have passed since you left " + mapname(gLeftTownMap) + ".")
			p = 0
			exp = difficulty() * gDistanceBetweenTown * sdata(182, 0) / 100 + 1
			repeat 16
				if (cState(cnt) != 1) {
					continue
				}
				if (cCurrentMap(cnt)) {
					continue
				}
				p++
				cExperience(cnt) += exp
			loop
			if (p == 1) {
				s = "あなた"
			} else {
				s = "あなたとその仲間"
			}
			txt -1, lang(s + "は" + gDistanceBetweenTown + "マイルの距離を歩き、経験を積んだ。", "You've walked about " + gDistanceBetweenTown + " miles and have gained experience.")
			skillexp2 182, 0, 25 + gDistanceBetweenTown * 2 / 3, 0, 1000
			ogdata(438) += gDistanceBetweenTown
			gosub *label_1177
			gDistanceBetweenTown = 0
		}
	}
	oomSEST_log "Map:Quest message"
	if (gCurrentMap == 13) {
		if (gExecutingImmediateQuestType == 1009) {
			txtef 9
			txt -1, lang("" + gLeftMinutesOfExecutingQuest + "分間の間にパーティーを盛り上げよう。目標は" + qdata(12, gExecutingImmediateQuest) + "ポイント。", "You have to warm up the party within " + gLeftMinutesOfExecutingQuest + " minitues. Your target score is " + qdata(12, gExecutingImmediateQuest) + " points.")
			if (ogdata(462) == 2) {
				repeat 188, 57
					if (cId(cnt) == 34) {
						txtef 9
						txt -1, lang("このパーティーには異形の森の使者『ロミアス』が参加しているようだ。", "<Lomias> the messenger from Vindale seems to be participating in this party.")
						throwsstpevent "LomiasInTheParty", 0, "", 0
					}
				loop
			}
		}
		if (gExecutingImmediateQuestType == 1006) {
			if (qdata(12, gExecutingImmediateQuest) <= 0) {
				qdata(12, gExecutingImmediateQuest) = 15000
				qdata(6, gExecutingImmediateQuest) = 400
			}
			txtef 9
			txt -1, lang("" + gLeftMinutesOfExecutingQuest + "分以内に、納入箱に" + cnvweight(qdata(12, gExecutingImmediateQuest)) + "の作物を納入しよう。", "To complete the quest, you have to harvest " + cnvweight(qdata(12, gExecutingImmediateQuest)) + " worth farm products and put them into the delivery chest within " + gLeftMinutesOfExecutingQuest + " minutes.")
		}
		if (gExecutingImmediateQuestType == 1008) {
			txtef 9
			if (qdata(12, gExecutingImmediateQuest) == 343) {
				if (qdata(13, gExecutingImmediateQuest) != usernpcmax) {
					s = userdatan(1, qdata(13, gExecutingImmediateQuest))
				} else {
					s = lang("残りカス", "garbage")
				}
			} else {
				s = refchara(qdata(12, gExecutingImmediateQuest), 2, 1)
			}
			txt -1, lang("" + gLeftMinutesOfExecutingQuest + "分以内に、" + s + "を討伐しなければならない。", "You have to slay " + s + " within " + gLeftMinutesOfExecutingQuest + " minitues.")
		}
		if (gExecutingImmediateQuestType == 1020) {
			txtef 9
			txt -1, lang("" + gLeftMinutesOfExecutingQuest + "分間の間に客を多く取ろう。目標は" + qdata(12, gExecutingImmediateQuest) + "人。", "" + "Let's get more customers in a " + gLeftMinutesOfExecutingQuest + " minute. Target is " + qdata(12, gExecutingImmediateQuest) + " people.")
		}
		if (gExecutingImmediateQuestType == 1021) {
			txtef 9
			txt -1, lang("" + gLeftMinutesOfExecutingQuest + "分間の間、羊を守り抜こう。全ての敵を倒すとボーナスが貰える。", "" + "You have " + gLeftMinutesOfExecutingQuest + " minutes to protect your sheep. You will get a bonus if you defeat all the enemies.")
			if (qdata(5, gExecutingImmediateQuest) >= 15) {
				txtef 3
				txt -1, lang("モンスター達がこちらに向かって来る！", "The monsters are coming towards us!")
				repeat 188, 57
					if (cState(cnt) == 1) {
						if (eqfaction(cnt, "nc_sheep") == 0) {
							cRelationship(cnt) = -3
							lockon cnt, 0, 29
							cHate(cnt) = 250
						}
					}
				loop
			}
		}
	}
	if (gdata(19) >= 0) {
		repeat 245
			if (cState(cnt) == 1) {
				ctalk cnt, 1372, cnt, cnt
			}
			if (cState(cnt) == 2) {
				ctalk cnt, 1374, cnt, cnt
			}
		loop
		txtgod godcheck(), 2431
		throwsstpevent "MapChanged", 0, "", 0
	}
	if (gdata(20) != gdata(19) & gdata(19) != 2 & gdata(19) != 6 & gdata(19) != 13 & gdata(19) != 13 & gdata(19) != 35 & gdata(19) != 40 & gdata(19) >= 0) {
		ctalk 0, 1315, 0, 0
		if ( stat == 0 ) {
			ctalk 0, 723, 0, 0
		}
		repeat 16 - 1, 1
			if ( cdata(0, cnt) == 1 & cdata(80, cnt) == 0 ) {
				ctalk cnt, 1315, cnt, cnt
				if ( stat == 0 ) {
					ctalk cnt, 723, cnt, cnt
				}
			}
		loop
		repeat 56 - 16, 16
			if (cdata(0, cnt) == 1 & cbit(969, cnt) != 0) {
				ctalk cnt, 1315, cnt, cnt
				if ( stat == 0 ) {
					ctalk cnt, 1371, cnt, cnt
				}
			}
		loop
		if (gdata(20) != 7) {
			repeat 188, 57
				if ( cdata(0, cnt) == 1 & (cdata(150, cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop"))) {
					ctalk cnt, 1316, cnt, cnt
				}
			loop
		}
		txtgod godcheck(), 2429
		if (stat == 0) {
			txtgod godcheck(), 2430
		}
		throwsstpevent "AreaChanged", 0, "" + mapname(gdata(19)), gdata(19)
		throwsstpevent "AreaChanged" + gdata(20), 0, "" + mapname(gdata(19)), gdata(19)
	}
	goto *label_1608
*label_0946
	if (getgametime() >= adata(25, gCurrentMap)) {
		areaArenaRandomSeed(gCurrentMap) = rnd(10000)
		adata(25, gCurrentMap) = getgametime() + 24
	}
	if (getgametime() >= mapTimeOfNextRegeneration) {
		oomSEST_log "renew_major"
		if (mdata(17) == 0) {
			if (mapTimeOfNextRegeneration != 0) {
				repeat mapHeight
					y = cnt
					repeat mapWidth
						if (map(cnt, y, 6) != 0) {
							cell_featread cnt, y
							if (feat(1) >= 24 & feat(1) <= 28) {
								cell_featclear cnt, y
							}
						}
					loop
				loop
				inv_getheader -1
				repeat invrange, invhead
					if (iNumber(cnt) == 0) {
						continue
					}
					if (iId(cnt) == 526) {
						if (iParam1(cnt) < 10) {
							iParam1(cnt) += (getgametime() - mapTimeOfNextRegeneration) / 120 + 1
							if (iParam1(cnt) > 10) {
								iParam1(cnt) = 10
							}
							iImage(cnt) = 591
							cell_refresh iX(cnt), iY(cnt)
						}
					}
					if (areaId(gCurrentMap) == 103) {
						if (iId(cnt) == 526) {
							if (chipm(0, map(iX(cnt), iY(cnt), 0)) == 2) {
								nc_intb_001 = cnt
								repeat (getgametime() - mapTimeOfNextRegeneration) / 120 + 1
									if (rnd(10) == 0) {
										if (inv_sum(-1) < mapItemMax) {
											fx = iX(nc_intb_001) + rnd(3) - 1
											fy = iY(nc_intb_001) + rnd(3) - 1
											if (fx >= 0 & fx < mapWidth & (fx != iX(nc_intb_001) | fy != iY(nc_intb_001))) {
												if (fy >= 0 & fy < mapHeight) {
													if (chipm(0, map(fx, fy, 0)) == 2 & map(fx, fy, 4) == 0) {
														flt
														itemcreate -1, 747, fx, fy, 0
														if (iParam2(nc_intb_001) != 290 & iParam2(nc_intb_001) != 505) {
															iParam2(ci) = iParam2(nc_intb_001)
														}
														cell_refresh iX(ci), iY(ci)
													}
												}
											}
										}
									}
								loop
							}
						}
						if (iId(cnt) == 747) {
							if (iParam1(cnt) < iParam3(cnt)) {
								iParam1(cnt) += ((getgametime() - mapTimeOfNextRegeneration) / 120 * inv(16, cnt)) + inv(16, cnt)
								if (iParam1(cnt) > iParam3(cnt)) {
									iParam1(cnt) = iParam3(cnt)
								}
								iImage(cnt) = 591
								cell_refresh iX(cnt), iY(cnt)
							}
							// 交配システム
							if (chipm(0, map(iX(cnt), iY(cnt), 0)) == 2) {
								nc_intb_001 = cnt
								repeat (getgametime() - mapTimeOfNextRegeneration) / 120 + 1
								if (inv_sum(-1) < mapItemMax) {
									fx = iX(nc_intb_001) + rnd(3) - 1
									fy = iY(nc_intb_001) + rnd(3) - 1
									if (fx >= 0 & fx < mapWidth & fy >= 0 & fy < mapHeight & (fx != iX(nc_intb_001) | fy != iY(nc_intb_001))) {
										if (chipm(0, map(fx, fy, 0)) == 2) {
											f = mapitemfind(fx, fy, 747)
											if (f != (-1)) {
												dim fip, 3
												fip(0) = iParam2(f)
												fip(1) = iParam3(f)
												fip(2) = inv(16, f)
												fx = iX(nc_intb_001) + rnd(3) - 1
												fy = iY(nc_intb_001) + rnd(3) - 1
												if ((fx != iX(nc_intb_001) | fy != iY(nc_intb_001)) & (fx != iX(f) | fy != iY(f))) {
													if (fy >= 0 & fy < mapHeight & fx >= 0 & fx < mapWidth) {
														if (chipm(0, map(fx, fy, 0)) == 2) {
															if (map(fx, fy, 4) == 0) {
																flt
																itemcreate -1, 747, fx, fy, 0
																// 交配レシピ通りなら、低確率で交配後のアイテムに
																iParam2(ci) = kouhai(fip(0), iParam2(nc_intb_001))
																// 実る最大数
																iParam3(ci) = rnd((iParam3(f) + iParam3(nc_intb_001)) / 2 + 3) + 1
																if (iParam3(ci) > 1000) {
																	iParam3(ci) = 1000
																}
																if (iParam3(ci) > int(sqrt(sdata(180, 0))) + 1) {
																	iParam3(ci) = int(sqrt(sdata(180, 0))) + 1
																}
																// 実る速度
																inv(16, ci) = rnd((inv(16, ci) + inv(16, ci)) / 2 + 1) + 1
																if (inv(16, ci) > 50) {
																	inv(16, ci) = 50
																}
																cell_refresh iX(ci), iY(ci)
															}
														}
													}
												}
											}
										}
									}
								}
							loop
							}
						}
					}
					if (mapType == 3 | mapType == 2) {
						if (gCurrentDungeonLevel != 3) {
							if (iOwnState(cnt) < 0) {
								iOwnState(cnt)++
							}
							if (iOwnState(cnt) == 0) {
								iNumber(cnt) = 0
								cell_refresh iX(cnt), iY(cnt)
							}
						}
					}
				loop
				if (mapDensity != 0) {
					repeat (getgametime() - mapTimeOfNextRegeneration) / (24 * 3)
						gosub *label_0938
					loop
				}
			}
			repeat 188, 57
				rc = cnt
				gosub *label_0739
				if (cState(cnt) != 1) {
					continue
				}
				if (cbit(964, cnt) == 1) {
					if (rnd(2)) {
						cState(cnt) = 0
						map(cX(cnt), cY(cnt), 1) = 0
					}
				}
			loop
			p = rnd(mapHeight * mapWidth / 400 + 3)
			if (mapType == 1) {
				p = rnd(40)
			}
			if (mapType == 3) {
				p = rnd(rnd(rnd(12) + 1) + 1)
			}
			if (mapType == 2) {
				p = rnd(p + 1)
			}
			repeat p
				map_randsite
			loop
		}
		if (mapType == 3 | areaId(gCurrentMap) == 39 | (areaId(gCurrentMap) == 8 & gCurrentDungeonLevel == areaDangerLevel(gCurrentMap))) {
			if (oabit(10, gCurrentMap) == 0) { // Not 狂信者の塔
				// 妹猫
				if (rnd(limit(50 - (sdata(19, 0) / 50), 15, 50)) == 0) {
					flt
					initlv = difficulty() + rnd(5)
					characreate -1, 364, cX(0), cY(0)
					if (areaId(gCurrentMap) == 39) {
						// ダンジョン => かくれんぼ
						cRole(rc) = 20003
						cAiCalm(rc) = 3
						cdata(215, rc) = 0
						cdata(220, rc) = 0
						cAiActNum(rc) = 1
						cAiMove(rc) = 0
						cAiDist(rc) = 1
						ocdata(0, rc) = 4
						evadd 107
					} elseif (areaId(gCurrentMap) == 8) {
						// ランダムネフィア => 救出
						cRole(rc) = 20005
						ogdata(28) = 0
						tc = 0
						repeat 20
							p = rnd(gCrowdDensity + 1) + 57
							if (p >= 245) {
								continue cnt
							}
							if (cState(p) == 1) {
								tc = p
								break
							}
						loop
						telex = cX(tc)
						teley = cY(tc)
						tc = rc
						efid = 619
						gosub *label_1402
						evadd 107
					} else {
						// 街 => 鬼ごっこ
						cRole(rc) = 20001
						evadd 107
					}
				}
			}
		}
		if (areaId(gCurrentMap) == 8) {
			if (oabit(7, gCurrentMap)) {
				if (gCurrentDungeonLevel == areaDangerLevel(gCurrentMap)) {
					if (rnd(50) == 0) {
						flt
						initlv = 150 + difficulty()
						characreate -1, 365, cX(0), cY(0)
						cRole(rc) = 20004
						ocdata(0, rc) = 1
						f = 0
						repeat 30
							body = 100 + cnt
							if (cdata(body, rc) \ 10000 == 0) {
								continue
							}
							if (cdata(body, rc) / 10000 == 11) {
								ci = cdata(body, rc) \ 10000 - 1
								f = 1
								break
							}
						loop
						if (f) {
							encadd ci, 90005, 7007, 0, 1
						}
						evadd 110
					}
				}
			}
		}
		if (gCurrentDungeonLevel == 3) {
			if (gdata(128) < 3000) {
				if (areaId(gCurrentMap) == 36 & guildcheck(0) == "mage" | (areaId(gCurrentMap) == 14 & guildcheck(0) == "thieve") | (areaId(gCurrentMap) == 11 & guildcheck(0) == "fighter")) {
					if (rnd(25) == 0) {
						guildlistmax = 0
						dim guildlist, 3
						if (guildcheck(0) != "mage") {
							guildlist(guildlistmax) = 0
							guildlistmax++
						}
						if (guildcheck(0) != "thieve") {
							guildlist(guildlistmax) = 2
							guildlistmax++
						}
						if (guildcheck(0) != "fighter") {
							guildlist(guildlistmax) = 1
							guildlistmax++
						}
						rndshuffle guildlist, guildlistmax
						repeat 2
							ambushtarget = cnt
							guildrank = gdata(128) / 100
							if (guildrank <= 10) {
								flt
								characreate -1, csetguildmaster(guildlist(ambushtarget)), -3, 0
								if (stat != 0) {
									cRelationship(rc) = -1
									cOriginalRelationship(rc) = -1
								}
							}
							if (guildrank == 1) {
								p = 1
							} else {
								if (guildrank <= 5) {
									p = 2
								} else {
									if (guildrank <= 10) {
										p = 3
									} else {
										p = guildrank / 15 + 4
									}
								}
							}
							repeat rnd(20 / p) + 6
								flt
								characreate -1, csetguildmember(guildlist(ambushtarget)), -3, 0
								if (stat != 0) {
									cRelationship(rc) = -1
									cOriginalRelationship(rc) = -1
								}
							loop
							if (rnd(5)) {
								break
							}
						loop
						evadd 108
						ogdata(29) = 1
					}
				}
			}
		}
		mapTimeOfNextRegeneration = getgametime() + 120
	}
	if (ncgdata(106)) {
		if (areaId(gCurrentMap) == 31) {
			ncgdata(106) = 0
			renewmulti += 1080
			gosub *label_0935
			renewmulti = 0
		}
	}
	if (getgametime() >= mapTimeOfNextMinorRegeneration) {
		oomSEST_log "renew_minor"
		if (mapTimeOfNextMinorRegeneration == 0) {
			renewmulti = 1
		} else {
			renewmulti = (getgametime() - mapTimeOfNextMinorRegeneration) / 24 + 1
		}
		if (areaId(gCurrentMap) == 31) {
			gosub *label_0935
		}
		if (areaId(gCurrentMap) == 7) {
			repeat 188, 57
				if (cState(cnt) != 1) {
					continue
				}
				if (cbit(964, cnt) == 1) {
					cState(cnt) = 0
					map(cX(cnt), cY(cnt), 1) = 0
				}
			loop
		}
		if (mdata(17) == 0) {
			repeat mapHeight
				y = cnt
				repeat mapWidth
					if (map(cnt, y, 6) != 0) {
						cell_featread cnt, y
						x = cnt
						if (feat(1) == 29) {
							p@se = 0
							repeat 15, 1
								if (cState(cnt) != 1) {
									continue
								}
								if (ocdata(104, cnt) == 180) {
									if (p@se < sdata(180, cnt)) {
										p@se = sdata(180, cnt)
									}
								}
							loop
							repeat renewmulti
								if (feat >= tile_plant + 2) {
									break
								}
								if (chipm(0, map(x, y, 0)) == 2) {
									val = 1
								} else {
									val = 0
								}
								gosub *label_1458
							loop
							cell_featset cnt, y, feat, feat(1), feat(2), feat(3)
						}
					}
				loop
			loop
			if (mapType == 3 | mapType == 2 | gCurrentMap == 7) {
				repeat 188, 57
					if (cRole(cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop")) {
						continue
					}
					if (cState(cnt) != 1) {
						continue
					}
					generatemoney cnt
					if (cId(cnt) == 326) {
						if (itemfind(cnt, 60005, 1) == (-1)) {
							if (rnd(150) == 0) {
								flt
								itemcreate cnt, 707, -1, -1, 0
							} else {
								flt calcobjlv(cLevel(cnt)), calcfixlv()
								flttypeminor = 60005
								itemcreate cnt, 0, -1, -1, 0
							}
						}
					}
					rc = cnt
					if (rnd(5) == 0) {
						gosub *label_1541
					}
					if (rnd(2) == 0) {
						if (inv_sum(rc) < 8) {
							flt calcobjlv(cLevel(rc)), calcfixlv(2)
							itemcreate rc, 0, -1, -1, 0
							if (stat != 0) {
								if (iWeight(ci) <= 0 | iWeight(ci) >= 4000) {
									iNumber(ci) = 0
								}
							}
						}
					}
				loop
			}
		}
		mapTimeOfNextMinorRegeneration = getgametime() + 24
	}
	if (areaId(gCurrentMap) == 31) {
		if (getworker(gCurrentMap) != (-1)) {
			msgtemp += lang("前回の来訪から、" + nc_intb_101 + "回繁殖し、" + nc_intb_102 + "個の卵、" + nc_intb_103 + "個の乳が生産された。", "Since our last visit, bred " + nc_intb_001 + " times, producing " + nc_intb_002 + " eggs and " + nc_intb_003 + " milk.")
			if (nc_intb_104 != 0) {
				msgtemp += lang("更に、鉱石を" + nc_intb_104 + "個拾ってきている。", "In addition, we are picking up " + nc_intb_104 + " ore.")
			}
			ncgdata(361) += nc_intb_101
			if (ncgdata(361) >= 100) {
				newtitle 104
			}
		}
	}
	return
*label_0947
	oomSEST_log "map_prepareTile:begin"
	gsel 6
	redraw 0
	if (mapTileSet != mtilefilecur | areaType(gCurrentMap) == 5 | firstturn == 1) {
		pos 0, 0
		mtilefilecur = mapTileSet
		if (areaType(gCurrentMap) == 5) {
			if (existfile_map == 1) {
				picload_ exedir + "user\\graphic\\map1.bmp", 1
				mtilefilecur = -1
			} else {
				picload_ exedir + "\\graphic\\map" + mapTileSet + ".bmp", 1
			}
		} else {
			picload_ exedir + "\\graphic\\map" + mapTileSet + ".bmp", 1
		}
		gosub *label_0249
	}
	map_tileset mapTileType
	gsel 2
	gmode 0
	pos 0, 0
	gcopy 6, 0, 0, 33 * inf_tiles, 25 * inf_tiles
	p = 5, 5, 5
	shade = 15
	if (mapIndoorOrOutdoor == 2) {
		if (gHour >= 24) {
			p = 110, 90, 60
			shade = 8
		}
		if (gHour >= 0 & gHour < 4) {
			p = 110, 90, 60
			shade = 8
		}
		if (gHour >= 4 & gHour < 10) {
			p = 70 - (gHour - 3) * 10, 80 - (gHour - 3) * 12, 60 - (gHour - 3) * 10
			if (p < 10) {
				p = 10
				shade = (gHour - 3) * 2 + 8
			}
		}
		if (gHour >= 10 & gHour < 12) {
			p = 10, 10, 10
			shade = 25
		}
		if (gHour >= 12 & gHour < 17) {
			p = 0, 0, 0
			shade = 25
		}
		if (gHour >= 17 & gHour < 21) {
			p = 0 + (gHour - 17) * 20, 15 + (gHour - 16) * 15, 10 + (gHour - 16) * 10
			shade = 12
		}
		if (gHour >= 21 & gHour < 24) {
			p = 80 + (gHour - 21) * 10, 70 + (gHour - 21) * 10, 40 + (gHour - 21) * 5
			shade = 7
		}
		if (gWeather == 3) {
			if (p < 40) {
				p = 40, 40, 40
			}
		}
		if (gWeather == 4) {
			if (p < 65) {
				p = 65, 65, 65
			}
		}
		if (gCurrentMap == 33) {
			if (gHour >= 17 | gHour < 7) {
				p += 35
				p(1) += 35
				p(2) += 35
			}
		}
	}
	pos 0, 0
	gfini 33 * inf_tiles, 25 * inf_tiles
	gfdec2 p, p(1), p(2)
	color 255, 255, 255
	gmode 4, , , 30
	if (mapTileSet == 0) {
		pos 0, 192
		gcopy 6, 0, 192, 1360, 48
	}
	if (mapTileSet == 1) {
		pos 0, 1056
		gcopy 6, 0, 1056, 1360, 48
	}
	if (mapTileSet != 2) {
		pos 0, 336
		gcopy 6, 0, 336, 1360, 48
	}
	gmode 0
	gsel 0
	gmode 2, 24, 24
	oomSEST_log "map_prepareTile:end"
	return
*label_0948
	oomSEST_log "world_newRandArea"
	p = 0
	repeat 500 - 450, 450
		if (areaId(cnt) == 8) {
			if (areaHasBeenConquered(cnt) != (-1)) {
				p++
			}
		}
	loop
	p = 40 - p
	if (p < 1) {
		p = 1
	}
	repeat p
		cxinit = rnd(mapWidth)
		cyinit = rnd(mapHeight)
		gosub *label_0954
	loop
	gosub *label_0950
	return 1
	repeat 500 - 450, 450
		if (areaId(cnt) == 0) {
			continue
		}
		if (areaId(cnt) == 8) {
			if (rnd(3) == 0) {
				areaHasBeenConquered(cnt) = -1
			}
		}
	loop
	gosub *label_0949
	repeat 500 - 450, 450
		if (areaId(cnt) == 0) {
			continue
		}
		if (areaId(cnt) == 8) {
			areaX(cnt) = cnt * 3 \ mapWidth
			areaY(cnt) = cnt * 3 \ mapHeight
			areaDangerLevel(cnt) = 33
			areaLastFloor(cnt) = 33
		}
	loop
	gosub *label_0952
	gosub *label_0951
	return
*label_0949
	oomSEST_log "world_update"
	if (gdata(79) == 1) {
		gosub *label_0953
		gosub *label_0950
		repeat 500 - 450, 450
			areaId(cnt) = 0
		loop
	}
	p = 0
	repeat 500 - 450, 450
		if (areaId(cnt) == 0) {
			continue
		}
		if (areaId(cnt) == 8) {
			if (areaHasBeenConquered(cnt) != (-1)) {
				p++
			}
		}
	loop
	if (ncgdata(155) == 5) {
		ncgdata(155)++
		gosub *label_0950
	}
	if (ncgdata(158) == 1) {
		ncgdata(158)++
		gosub *label_0950
	}
	if (p <= 25 | rnd(150) == 0 | gdata(250 + 12) != 0 | gdata(79)) {
		oomSEST_log "world_update_rand_dungeon"
		gdata(250 + 12) = 0
		msgtemp += lang("この大陸に大きな地殻変動が起こった。", "A sudden diastrophism hits the continent.")
		repeat 500 - 450, 450
			if (areaId(cnt) == 8) {
				if ((rnd(5) == 0 | areaHasBeenConquered(cnt) == (-1)) & (oabit(17, cnt) == 0 & oabit(18, cnt) == 0)) {
					areaId(cnt) = 0
				}
			}
		loop
		gosub *label_0948
		gosub *label_0950
	}
	gdata(79) = 0
	return
*label_0950
	gosub *label_0952
	gosub *label_0951
	return
*label_0951
	oomSEST_log "world_setArea:building"
	gosub *label_0249
	repeat 20
		cnt2 = cnt
		if (gdata(850) != 4) {
			break
		}
		repeat 10
			if (bddata(0, cnt2, cnt) != 0) {
				p = bddata(0, cnt2, cnt)
				cell_featset bddata(1, cnt2, cnt), bddata(2, cnt2, cnt), bddata(3, cnt2, cnt), 34, cnt2, cnt
			}
		loop
	loop
	repeat 500
		oomSEST_log "world_setArea:fix:id" + cnt + "/" + areaId(cnt)
		if (areaId(cnt) == 0 | areaAppearance(cnt) == 0) {
			continue
		}
		if (areaOuterMap(cnt) != gdata(850)) {
			continue
		}
		if (areaId(cnt) == 900) {
			areaId(cnt) = 40
			continue
		}
		if (areaId(cnt) >= 900) {
			areaId(cnt) -= 800
			continue
		}
		oomSEST_log "world_setArea:fix:begin" + areaX(cnt) + "/" + areaY(cnt)
		if (areaX(cnt) <= 0 | areaY(cnt) <= 0 | areaX(cnt) >= mapWidth | areaY(cnt) >= mapHeight) {
			areaX(cnt) = mapWidth / 2
			areaY(cnt) = mapHeight / 2
		}
		p = cnt
		if (chipm(7, map(areaX(cnt), areaY(cnt), 0)) & 4 | map(areaX(cnt), areaY(cnt), 6) != 0) {
			oomSEST_log "world_setArea:fix:loop"
			repeat
				await
				dx = limit(rnd(cnt / 4 + 1) + 1, 1, mapWidth)
				dy = limit(rnd(cnt / 4 + 1) + 1, 1, mapHeight)
				x = areaX(p) + rnd(dx) - rnd(dx)
				y = areaY(p) + rnd(dy) - rnd(dy)
				if (x <= 0 | y <= 0 | x >= mapWidth - 1 | y >= mapHeight - 1) {
					continue
				}
				if (33 <= map(x, y, 0) & map(x, y, 0) < 66) {
					continue
				}
				if (chipm(7, map(x, y, 0)) & 4) {
					continue
				}
				if (map(x, y, 6) != 0) {
					continue
				}
				areaX(p) = x
				areaY(p) = y
				break
			loop
		}
		oomSEST_log "world_setArea:fix:xy:" + x + ":" + y
		oomSEST_log "world_setArea:fix:map:" + map(areaX(cnt), areaY(cnt), 0)
		cell_featset areaX(cnt), areaY(cnt), areaAppearance(cnt), 15, cnt \ 100, cnt / 100
		oomSEST_log "world_setArea:fix:'"
		if (areaType(cnt) == 3 | areaType(cnt) == 2) {
			map(areaX(cnt), areaY(cnt), 9) = 11
		}
	loop
	oomSEST_log "world_setArea:end"
	return
*label_0952
	repeat mapHeight
		y = cnt
		repeat mapWidth
			x = cnt
			cell_featread x, y
			if (feat(1) >= 24 & feat(1) <= 28) {
			} else {
				map(x, y, 6) = 0
			}
			map(x, y, 9) = 0
		loop
	loop
	return
*label_0953
	p = 47
	areaId(p) = 47
	areaAppearance(p) = 0
	areaType(p) = 1
	areaX(p) = 18
	areaY(p) = 14
	areaEntranceType(p) = 6
	areaTileSet(p) = 2
	areaTileType(p) = 1
	areaTurnCost(p) = 50000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 47
	p = 48
	areaId(p) = 48
	areaAppearance(p) = 158
	areaType(p) = 2
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 47
	if (ncgdata(202) == 0) {
		areaX(p) = 18
		areaY(p) = 14
	}
	p = 44
	areaId(p) = 44
	areaAppearance(p) = 0
	areaType(p) = 1
	areaX(p) = 26
	areaY(p) = 23
	areaEntranceType(p) = 6
	areaTileSet(p) = 2
	areaTileType(p) = 1
	areaTurnCost(p) = 50000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 44
	p = 45
	areaId(p) = 45
	areaAppearance(p) = 158
	areaType(p) = 2
	areaX(p) = 41
	areaY(p) = 8
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 44
	p = 46
	areaId(p) = 46
	areaAppearance(p) = 159
	areaType(p) = 2
	areaX(p) = 39
	areaY(p) = 13
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 44
	p = 4
	areaId(p) = 4
	areaAppearance(p) = 0
	areaType(p) = 1
	areaX(p) = 26
	areaY(p) = 23
	areaEntranceType(p) = 6
	areaTileSet(p) = 2
	areaTileType(p) = 1
	areaTurnCost(p) = 50000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 5
	areaId(p) = 5
	areaAppearance(p) = 132
	areaType(p) = 3
	areaX(p) = 26
	areaY(p) = 23
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 999
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaQuestTownId(p) = 1
	areaOuterMap(p) = 4
	p = 12
	areaId(p) = 12
	areaAppearance(p) = 142
	areaType(p) = 3
	areaX(p) = 43
	areaY(p) = 32
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 999
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaQuestTownId(p) = 2
	areaOuterMap(p) = 4
	p = 15
	areaId(p) = 15
	areaAppearance(p) = 136
	areaType(p) = 3
	areaX(p) = 53
	areaY(p) = 24
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaQuestTownId(p) = 3
	areaOuterMap(p) = 4
	p = 14
	areaId(p) = 14
	areaAppearance(p) = 142
	areaType(p) = 3
	areaX(p) = 14
	areaY(p) = 35
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 999
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaQuestTownId(p) = 4
	areaOuterMap(p) = 4
	p = 11
	areaId(p) = 11
	areaAppearance(p) = 132
	areaType(p) = 3
	areaX(p) = 3
	areaY(p) = 15
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 999
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaQuestTownId(p) = 5
	areaOuterMap(p) = 4
	p = 33
	areaId(p) = 33
	areaAppearance(p) = 156
	areaType(p) = 3
	areaX(p) = 89
	areaY(p) = 14
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaQuestTownId(p) = 6
	areaOuterMap(p) = 4
	p = 36
	areaId(p) = 36
	areaAppearance(p) = 132
	areaType(p) = 3
	areaX(p) = 61
	areaY(p) = 32
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 999
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaQuestTownId(p) = 7
	areaOuterMap(p) = 4
	p = 2
	areaId(p) = 2
	areaAppearance(p) = 0
	areaType(p) = 4
	areaX(p) = 0
	areaY(p) = 0
	areaEntranceType(p) = 4
	areaTileSet(p) = 1
	areaTileType(p) = 4
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 7
	areaId(p) = 7
	areaType(p) = 5
	areaEntranceType(p) = 8
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 10
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	if (gHomeScale == 0) {
		areaAppearance(p) = 138
		areaX(p) = 22
		areaY(p) = 21
		areaTileSet(p) = 1
		areaTileType(p) = 3
		areaOuterMap(p) = 4
	}
	p = 35
	areaId(p) = 35
	areaType(p) = 7
	areaEntranceType(p) = 8
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 1
	areaAppearance(p) = 158
	areaX(p) = 35
	areaY(p) = 27
	areaTileSet(p) = 1
	areaTileType(p) = 3
	areaOuterMap(p) = 4
	p = 6
	areaId(p) = 6
	areaAppearance(p) = 0
	areaType(p) = 7
	areaX(p) = 22
	areaY(p) = 21
	areaEntranceType(p) = 4
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 40
	areaId(p) = 40
	areaAppearance(p) = 0
	areaType(p) = 7
	areaX(p) = 23
	areaY(p) = 21
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 49
	areaId(p) = 49
	areaAppearance(p) = 0
	areaType(p) = 7
	areaX(p) = 80
	areaY(p) = 21
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 13
	areaId(p) = 13
	areaAppearance(p) = 0
	areaType(p) = 7
	areaX(p) = 22
	areaY(p) = 21
	areaEntranceType(p) = 4
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 3
	areaId(p) = 3
	areaAppearance(p) = 139
	areaType(p) = 20
	areaX(p) = 23
	areaY(p) = 29
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 45
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 42
	areaId(p) = 42
	areaAppearance(p) = 139
	areaType(p) = 20
	areaX(p) = 81
	areaY(p) = 51
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 50
	areaLastFloor(p) = 99999999
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 16
	areaId(p) = 16
	areaAppearance(p) = 145
	areaType(p) = 21
	areaX(p) = 43
	areaY(p) = 4
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 15
	areaLastFloor(p) = 18
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 17
	areaId(p) = 17
	areaAppearance(p) = 141
	areaType(p) = 20
	areaX(p) = 37
	areaY(p) = 20
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 25
	areaLastFloor(p) = 30
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 18
	areaId(p) = 18
	areaAppearance(p) = 144
	areaType(p) = 23
	areaX(p) = 26
	areaY(p) = 44
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 17
	areaLastFloor(p) = 22
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 19
	areaId(p) = 19
	areaAppearance(p) = 146
	areaType(p) = 20
	areaX(p) = 13
	areaY(p) = 32
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 30
	areaLastFloor(p) = 33
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 26
	areaId(p) = 26
	areaAppearance(p) = 146
	areaType(p) = 20
	areaX(p) = 64
	areaY(p) = 43
	areaEntranceType(p) = 2
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 25
	areaLastFloor(p) = 29
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 27
	areaId(p) = 27
	areaAppearance(p) = 146
	areaType(p) = 20
	areaX(p) = 29
	areaY(p) = 24
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 2
	areaLastFloor(p) = 5
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 38
	areaId(p) = 38
	areaAppearance(p) = 146
	areaType(p) = 20
	areaX(p) = 43
	areaY(p) = 39
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 23
	areaLastFloor(p) = 27
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 28
	areaId(p) = 28
	areaAppearance(p) = 146
	areaType(p) = 20
	areaX(p) = 38
	areaY(p) = 31
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 5
	areaLastFloor(p) = 5
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 37
	areaId(p) = 37
	areaAppearance(p) = 160
	areaType(p) = 20
	areaX(p) = 4
	areaY(p) = 11
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 20
	areaLastFloor(p) = 21
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 10
	areaId(p) = 10
	areaAppearance(p) = 141
	areaType(p) = 6
	areaX(p) = 74
	areaY(p) = 31
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 4
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 20
	areaId(p) = 20
	areaAppearance(p) = 147
	areaType(p) = 6
	areaX(p) = 51
	areaY(p) = 9
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 4
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 41
	areaId(p) = 41
	areaAppearance(p) = 161
	areaType(p) = 6
	areaX(p) = 28
	areaY(p) = 37
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 12
	areaTurnCost(p) = 100000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 21
	areaId(p) = 21
	areaAppearance(p) = 148
	areaType(p) = 2
	areaX(p) = 21
	areaY(p) = 27
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 8
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 25
	areaId(p) = 25
	areaAppearance(p) = 142
	areaType(p) = 2
	areaX(p) = 64
	areaY(p) = 47
	areaEntranceType(p) = 3
	areaTileSet(p) = 1
	areaTileType(p) = 9
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 34
	areaId(p) = 34
	areaAppearance(p) = 157
	areaType(p) = 2
	areaX(p) = 88
	areaY(p) = 25
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 29
	areaId(p) = 29
	areaAppearance(p) = 162
	areaType(p) = 6
	areaX(p) = 18
	areaY(p) = 2
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 32
	areaId(p) = 32
	areaAppearance(p) = 155
	areaType(p) = 2
	areaX(p) = 53
	areaY(p) = 21
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 43
	areaId(p) = 43
	areaAppearance(p) = 158
	areaType(p) = 2
	areaX(p) = 27
	areaY(p) = 52
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 2
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 1
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 22
	areaId(p) = 22
	areaAppearance(p) = 149
	areaType(p) = 6
	areaX(p) = 13
	areaY(p) = 43
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 33
	areaLastFloor(p) = 33
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 23
	areaId(p) = 23
	areaAppearance(p) = 149
	areaType(p) = 6
	areaX(p) = 51
	areaY(p) = 32
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 33
	areaLastFloor(p) = 33
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 24
	areaId(p) = 24
	areaAppearance(p) = 149
	areaType(p) = 6
	areaX(p) = 35
	areaY(p) = 10
	areaEntranceType(p) = 8
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 33
	areaLastFloor(p) = 33
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 30
	areaId(p) = 30
	areaAppearance(p) = 0
	areaType(p) = 5
	areaX(p) = 35
	areaY(p) = 10
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 100
	areaTurnCost(p) = 1000000
	areaDangerLevel(p) = -999999
	areaLastFloor(p) = 999999
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 1
	areaOuterMap(p) = 4
	p = 9
	areaId(p) = 9
	areaAppearance(p) = 0
	areaType(p) = 6
	areaX(p) = 20
	areaY(p) = 20
	areaEntranceType(p) = 4
	areaTileSet(p) = 1
	areaTileType(p) = 4
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 45
	areaIndoorOrOutdoor(p) = 2
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	return
	p = 200
	areaId(p) = 200
	areaAppearance(p) = 0
	areaType(p) = 3
	areaX(p) = 0
	areaY(p) = 0
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000
	areaDangerLevel(p) = 1
	areaLastFloor(p) = 999
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 1
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4
	p = 210
	areaId(p) = 210
	areaAppearance(p) = 0
	areaType(p) = 20
	areaX(p) = 0
	areaY(p) = 0
	areaEntranceType(p) = 1
	areaTileSet(p) = 1
	areaTileType(p) = 0
	areaTurnCost(p) = 10000000
	areaDangerLevel(p) = 50
	areaLastFloor(p) = 99999999
	areaIndoorOrOutdoor(p) = 1
	areaIsFixed(p) = 0
	areaDefaultAiCalm(p) = 0
	areaOuterMap(p) = 4

	initializeSouthTyrisTowns

return
*label_0954
	minbosslv = 2001
	repeat length(csetquestboss)
		if (npcmemory(0, csetquestboss(cnt) / 10000) != 0) {
			if (csetquestboss(cnt) \ 10000 < minbosslv) {
				minbosslv = csetquestboss(cnt) \ 10000
			}
		}
	loop
	repeat usernpcmax
		if (userdata(12, cnt) == 2) {
			if (getcnpcmemory(0, cnt) != 0) {
				if (userdata(2, cnt) < minbosslv) {
					minbosslv = userdata(2, cnt)
				}
			}
		}
	loop
	revisespawnrate = limitmin(difficulty() / 10, 0)
	repeat 500 - 450, 450
		if (areaId(cnt) != 0) {
			continue
		}
		f = -1
		repeat 1000
			x = cxinit + rnd(cnt + 1) - rnd(cnt + 1)
			y = cyinit + rnd(cnt + 1) - rnd(cnt + 1)
			if (x <= 5 | y <= 5 | x >= mapWidth - 6 | y >= mapHeight - 6) {
				continue
			}
			if (33 <= map(x, y, 0) & map(x, y, 0) < 66) {
				continue
			}
			if (map(x, y, 0) > 19) {
				continue
			}
			if (map(x, y, 6) \ 1000 != 0) {
				continue
			}
			p = 1
			repeat 500
				if (areaId(cnt) == 0) {
					continue
				}
				if (x >= areaX(cnt) - 2 & x <= areaX(cnt) + 2) {
					if (y >= areaY(cnt) - 2 & y <= areaY(cnt) + 2) {
						p = 0
						break
					}
				}
			loop
			if (p == 0) {
				continue
			}
			f = 1
			break
		loop
		if (f == (-1)) {
			p = -1
			break
		}
		p = cnt
		area = p
		ctrlFile 13
		areaType(p) = 20 + rnd(4)
		areaId(p) = 8
		areaAppearance(p) = 133
		areaX(p) = x
		areaY(p) = y
		areaEntranceType(p) = 1
		areaTileSet(p) = 1
		areaTileType(p) = 1
		areaTurnCost(p) = 10000
		areaIndoorOrOutdoor(p) = 1
		areaOuterMap(p) = gdata(850)
		if (rnd(3)) {
			areaDangerLevel(p) = difficulty() / 2 + rnd(difficulty() / 2 + 5) + 1
		} else {
			areaDangerLevel(p) = rnd(50) + 1
			if (rnd(5) == 0) {
				areaDangerLevel(p) *= rnd(3) + 1
			}
		}
		areaLastFloor(p) = areaDangerLevel(p) + rnd(4) + 2
		areaIsFixed(p) = 1
		areaDefaultAiCalm(p) = 0
		areaHasBeenConquered(p) = 0
		areaDungeonPrefixType(p) = rnd(length(mapnamerd))
		map(x, y, 6) = 1
		if (areaType(p) == 20) {
			areaAppearance(p) = 133
			areaTileType(p) = 0
		}
		if (areaType(p) == 21) {
			areaAppearance(p) = 137
			areaTileType(p) = 100
		}
		if (areaType(p) == 23) {
			areaAppearance(p) = 140
			areaTileType(p) = 200
		}
		if (areaType(p) == 22) {
			areaAppearance(p) = 135
			areaTileType(p) = 300
		}
		oadata(p - 450) = 0
		faction(p - 450 + 245) = ""
		gosub *label_1841
		if (areaDangerLevel(p) > 50 & oabit(17, p) == 0 & oabit(18, p) == 0) {
			if (incspawnrate(30)) {
				oabitmod 13, p, 1
			}
			if (incspawnrate(30)) {
				oabitmod 7, p, 1
			}
			if (areaType(p) == 22) {
				if (incspawnrate(30)) {
					oabitmod 14, p, 1
				}
			}
		}
		if (areaDangerLevel(p) > 30 & oabit(17, p) == 0 & oabit(18, p) == 0) {
			if (incspawnrate(30)) {
				oabitmod 9, p, 1
				areaLastFloor(p) += (areaLastFloor(p) - areaDangerLevel(p)) * 2
			}
			if (areaType(p) == 20) {
				if (incspawnrate(30)) {
					oabitmod 15, p, 1
				}
			}
		}
		if (areaDangerLevel(p) > 20 & oabit(17, p) == 0 & oabit(18, p) == 0) {
			if (incspawnrate(20)) {
				oabitmod 1, p, 1
			}
		}
		if (decspawnrate(10) & oabit(17, p) == 0 & oabit(18, p) == 0) {
			oabitmod 4, p, 1
		}
		if (incspawnrate(30) & oabit(17, p) == 0 & oabit(18, p) == 0) {
			oabitmod 2, p, 1
		}
		break
	loop
	return p
*label_0955
	if (gCurrentMap == 33) {
		if (gdata(250 + 8) == 1) {
			if (cState(gdata(250 + 9)) == 1) {
				if (gCrowdDensity < 30) {
					if (rnd(4) == 0) {
						flt
						objlv = 1
						characreate -1, 204, -3, 0
					}
					if (rnd(10) == 0) {
						flt
						objlv = 1
						characreate -1, 185, -3, 0
					}
				}
			}
		}
	}
	if (gExecutingImmediateQuestType == 1008) {
		if (qdata(8, gExecutingImmediateQuest) != 3) {
			if (gCrowdDensity < gLeftMinutesOfExecutingQuest / 60) {
				dbid = 0
				if (rnd(4) == 0) {
					dbid = 204
				}
				if (rnd(10) == 0) {
					dbid = 185
				}
				if (dbid != 0) {
					flt
					objlv = 1
					characreate -1, dbid, -3, 0
					if (stat != 0) {
						cRelationship(rc) = -1
						cOriginalRelationship(rc) = -1
						cHate(rc) = 100
						lockson rc, qdata(13, gExecutingImmediateQuest), 0
					}
				}
			}
		}
	}
	if (gCurrentMap == 16) {
		if (rnd(5) == 0) {
			r = sdata(50, 0) / 50
			if (r < 6) {
				dmg = (6 - r) * (6 - r) * 2
				txtef 3
				txt -1, lang("熱い！", "It's hot!")
				dmghp cc, dmg, -9
			}
		}
		return
	}
	if (gCurrentMap == 62) {
		if (rnd(5) == 0) {
			r = sdata(51, 0) / 50
			if (r < 6) {
				dmg = (12 - r) * (12 - r) * 2
				txtef 3
				txt -1, lang("寒すぎて凍えてしまいそうだ！", "It's too cold, freezing!")
				dmghp cc, dmg, -10
			}
		}
		return
	}
	if (gCurrentMap == 210) {
		repeat 56
			if (cState(cnt) != 1) {
				continue
			}
			addbuff cnt, 65, 200000000, 10, 1
		loop
		repeat 189, 56
			if (cState(cnt) != 1) {
				continue
			}
			if (findbuff(cnt, 66) == (-1)) {
				addbuff cnt, 66, 1, 9999999, 1
				if (gCurrentDungeonLevel >= 10050) {
					addbuff cnt, 63, 1, 99999999, 1
				}
				cHp(cnt) = cMaxHp(cnt)
				cMp(cnt) = cMaxMp(cnt)
			}
		loop
		return
	}
	if (oabit(17, gCurrentMap)) {
		if (rnd(5) == 0) {
				txtef 3
				txt -1, lang("瘴気が身を焦がす。", "It's hot!")
				dmghp cc, cMaxHp(cc) / 100, -9, 658
		}
		return
	}
	if (gCurrentMap == 11) {
		if (gCurrentDungeonLevel == 25) {
			gdata(250 + 11)++
			x = 1
			y = rnd(mapHeight)
			if (rnd(4) == 0) {
				x = mapWidth - 2
				y = rnd(mapHeight)
			}
			if (rnd(5) == 0) {
				x = rnd(mapWidth)
				y = 1
			}
			if (rnd(6) == 0) {
				x = rnd(mapWidth)
				y = mapHeight - 2
			}
			p = 237
			if (gdata(250 + 11) > 50) {
				if (rnd(10) == 0) {
					p = 245
				}
			}
			if (gdata(250 + 11) > 100) {
				if (rnd(10) == 0) {
					p = 244
				}
			}
			if (gdata(250 + 11) > 150) {
				if (rnd(10) == 0) {
					p = 244
				}
			}
			if (gdata(250 + 11) == 250) {
				snd 44
				txtef 2
				txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				gdata(250 + 209) = 3
				txtef 9
				txt -1, lang("伝令「パルミア軍の撤退が完了しました！これ以上ここに留まる必要はありません。機を見て地下から退却してください！」", "The messenger " + cnvtalk("The retreat of our army is over now. You don't need to fight them any more. Please leave at once!"))
				txt -1, lang("階段が現れた。", "Suddenly, stairs appear.")
				cell_featset 18, 9, tile_downstairs, 11, 1
			}
			flt
			characreate -1, p, x, y
			cHate(rc) = 1000
			lockson rc, 0, 1
			return
		}
	}
	if (gCurrentMap == 41) {
		if (rnd(50) == 0) {
			if (cKarma(0) < (-30)) {
				txt -1, lang("あなたは罪を悔いた。", "You repent of your sin.")
				modkarma 0, 1
				p = rnd(8) + 10
				if (sorg(p, 0) >= 10) {
					skillmod p, 0, -300
				}
			}
		}
		if (cKarma(0) >= (-30)) {
			if (rnd(1000) == 0) {
				cell_featread 29, 6
				if (feat(1) == 21) {
					txt -1, lang("あなたはガードの足音が近づいてくるのに気付いた。", "You hear footsteps coming towards your cell.")
					txt -1, lang("「そこのお前、もう反省したころだろう。出てもいいぞ」", cnvtalk("Hey punk, our boss says you can leave the jail now. Do not come back, okay?"))
					txt -1, lang("ガードは面倒くさそうにあなたの牢の扉を開けた。", "A guard unenthusiastically unlocks your cell.")
					cell_featset 29, 6, tile_dooropen, 20, 0, -1
					snd 48
				}
			}
		}
	}
	if (gCurrentMap == 30) {
		if (gWeather == 2 | gWeather == 4 | gWeather == 1) {
			if (cNutrition(0) < 5000 & gettrait(0, 191) == 0) {
				if (cbit(986, 0) == 0) {
					snd 18
					txt -1, lang("シェルターの貯蔵食品を食べた。", "You eat stored food.")
					cNutrition(cc) += 5000
					gosub *label_1384
				}
			}
			if (gContinuousActiveHours >= 15) {
				gContinuousActiveHours = 15 - 2
			}
			mapTurnCost = 1000000
		} else {
			if (mapTurnCost == 1000000) {
				mapTurnCost = 10000
				repeat 245
					cTurnCost(cnt) = 0
				loop
				txt -1, lang("もうシェルターの中にいる必要は無い。", "You don't need to stay in the shelter any longer.")
			}
		}
	}
	if (areaId(gCurrentMap) == 101) {
		if (gCrowdDensity > 0) {
			if (rnd(25) == 0) {
				txtef 9
				txt -1, lang(" *ざわざわ* ", "*noise*"), lang("「ふむ…悪くないな」", cnvtalk("Hmm. Not bad.")), lang("「何だろう、これは」", cnvtalk("What's this?")), lang("「ほほう…」", cnvtalk("Ohh...")), lang("「私も死んだらはく製に…」", cnvtalk("I want to be stuffed...")), lang("「ここが噂の…」", cnvtalk("So this is the famous..."))
			}
			if (rnd(25) == 0) {
				txtef 9
				txt -1, lang(" *がやがや* ", "*murmur*"), lang("「やだっ気持ち悪い」", cnvtalk("Gross! Disgusting.")), lang("「ねーねーこれ死んでるんでしょ？」", cnvtalk("Hey. Is it really dead?")), lang("「かわ、いー♪」", cnvtalk("Scut!")), lang("「今日はとことん見るぜ」", cnvtalk("Absolutely amazing.")), lang("「触ってもいいの？」", cnvtalk("Can I touch?"))
			}
			if (rnd(15) == 0) {
				txtef 9
				repeat 1
					if (en) {
						break
					}
					if (gdata(123) > 8000) {
						txt -1, "「退屈ぅー」", "「あまり見るものがないな」", "「こんなので見物料とるの？」", "館内は少し寂しい…"
						break
					}
					if (gdata(123) > 5000) {
						txt -1, "「いいんじゃない〜」", "「まあ、普通の博物館だ」", "「恋人を連れてくればよかったかも」", "まあまあの客足だ。"
						break
					}
					if (gdata(123) > 2500) {
						txt -1, "「この雰囲気好きだなぁ」", "「もう一度来ようよ」", "「時間が経つのを忘れるね！」", "館内はなかなか賑わっている。"
						break
					}
					if (gdata(123) > 500) {
						txt -1, "「来て良かった♪」", "「よくこんなに集めたなあ」", "「むぅ…興味深い」", "客足が全く絶えない盛況ぶりだ。"
						break
					}
					txt -1, "「素晴らしいコレクションだ！」", "「感動した」", "「帰りたくないわ♪」", "来客は食い入るように展示物を眺めている。"
				loop
			}
			return
		}
	}
	if (areaId(gCurrentMap) == 102) {
		if (gCrowdDensity > 0) {
			if (rnd(25) == 0) {
				txtef 9
				txt -1, lang(" *ざわざわ* ", "*murmur*"), lang("「これ欲しい〜」", cnvtalk("I want this! I want this!")), lang("「何だろう、これは」", cnvtalk("Oh what's this?")), lang("「お買い物♪」", cnvtalk("I'm just watching")), lang("「金が足りん…」", cnvtalk("My wallet is empty...")), lang("「ここが噂の…」", cnvtalk("So this is the famous...."))
			}
			return
		}
	}
	return
*label_0956
	inv_getheader -1
	repeat invrange, invhead
		if (iId(cnt) == 555 | iId(cnt) == 600) {
			continue
		}
		iNumber(cnt) = 0
		cell_refresh iX(cnt), iY(cnt)
	loop
	if (areaChristmasFestival(gCurrentMap) == 1) {
		flt
		itemcreate -1, 763, 29, 16, 0
		if (stat != 0) {
			iOwnState(ci) = 1
		}
		flt
		itemcreate -1, 686, 29, 16, 0
		if (stat != 0) {
			iOwnState(ci) = 1
		}
		flt
		itemcreate -1, 171, 29, 17, 0
		if (stat != 0) {
			iParam1(ci) = 6
			iOwnState(ci) = 1
		}
		flt
		itemcreate -1, 756, 29, 17, 0
		if (stat != 0) {
			iOwnState(ci) = 5
		}
		flt
		characreate -1, 345, 48, 19
		if (stat != 0) {
			cRole(rc) = 3
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 348, 30, 17
		if (stat != 0) {
			cRole(rc) = 3
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 174, 38, 19
		if (stat != 0) {
			cbitmod 991, rc, 1
			cbitmod 985, rc, 1
			cdatan(0, rc) = lang("マニの信者", "Mani Fanatic")
		}
		flt
		characreate -1, 347, 35, 19
		if (stat != 0) {
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 347, 37, 18
		if (stat != 0) {
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 347, 37, 21
		if (stat != 0) {
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 347, 39, 20
		if (stat != 0) {
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 347, 38, 21
		if (stat != 0) {
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 70, 17, 8
		if (stat != 0) {
			cAiCalm(rc) = 3
			cbitmod 991, rc, 1
			cRole(rc) = 1002, 10
			snfood cdatan(0, rc)
		}
		flt
		characreate -1, 239, 25, 8
		if (stat != 0) {
			cAiCalm(rc) = 3
			cRelationship(rc) = 0
			cOriginalRelationship(rc) = 0
			cbitmod 991, rc, 1
			cRole(rc) = 1018, 30
			cdatan(0, rc) = randomname()
			cdatan(0, rc) = lang("おみやげ屋の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the souvenir vendor")
		}
		flt
		characreate -1, 271, 24, 22
		if (stat != 0) {
			cAiCalm(rc) = 3
			cRelationship(rc) = 0
			cOriginalRelationship(rc) = 0
			cbitmod 991, rc, 1
			cRole(rc) = 1018, 30
			cdatan(0, rc) = randomname()
			cdatan(0, rc) = lang("おみやげ屋の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the souvenir vendor")
		}
		flt
		characreate -1, 1, 38, 12
		if (stat != 0) {
			cAiCalm(rc) = 3
			cRole(rc) = 1007, 10
			snblack cdatan(0, rc)
			cbitmod 991, rc, 1
		}
		flt
		characreate -1, 271, 28, 9
		if (stat != 0) {
			cAiCalm(rc) = 3
			cRelationship(rc) = 0
			cOriginalRelationship(rc) = 0
			cbitmod 991, rc, 1
			cRole(rc) = 1022, 30
			cdatan(0, rc) = randomname()
			cdatan(0, rc) = lang("屋台商人の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the street vendor")
		}
		flt
		characreate -1, 271, 29, 24
		if (stat != 0) {
			cAiCalm(rc) = 3
			cRelationship(rc) = 0
			cOriginalRelationship(rc) = 0
			cbitmod 991, rc, 1
			cRole(rc) = 1022, 30
			cdatan(0, rc) = randomname()
			cdatan(0, rc) = lang("屋台商人屋の" + cdatan(0, rc), sncnv(cdatan(0, rc)) + "the street vendor")
		}
		repeat 20
			flt
			characreate -1, 349, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
			flt
			characreate -1, 350, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
		loop
		repeat 15
			flt
			characreate -1, 326, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
		loop
		repeat 7
			flt
			characreate -1, 335, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
			flt
			characreate -1, 185, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
			flt
			characreate -1, 274, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
			flt
			characreate -1, 174, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
		loop
		repeat 3
			flt
			characreate -1, 332, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
			flt
			characreate -1, 185, -3, 0
			if (stat != 0) {
				cbitmod 991, rc, 1
			}
		loop
	} else {
		repeat 188, 57
			if (cbit(991, cnt) == 1) {
				chara_vanquish cnt
			}
		loop
	}
	return

#include "card_ref.hsp"
	goto *label_1054

#defcfunc cdbit int __yyy, int __zzz
	HMMBITCHECK card@tcg(30 + __yyy / 32, __zzz), __yyy \ 32
	return abs(stat)

#deffunc cdbitmod int __aaa, int __bbb, int __ccc
	if (__ccc == 0) {
		HMMBITOFF card@tcg(30 + __aaa / 32, __bbb), __aaa \ 32
		return
	}
	HMMBITON card@tcg(30 + __aaa / 32, __bbb), __aaa \ 32
	return
	return

*label_1054
*label_1055
	return
*label_1056
	listmax = 0
	page = 0
	pagesize = 10
	cs = 0
	cc = 0
	cs_bk = -1
	page_load
	if (invctrl == 0) {
		gosub *label_1719
	} else {
		repeat 50
			gosub *label_1055
			listn(0, listmax) = "" + prodcheck()
			list(0, listmax) = 630, cnt
			listmax++
		loop
	}
	windowshadow = 1
*label_1057
*label_1058
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	s = lang("生産品の選択", "Production"), strhint2 + strhint3b
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	display_topic lang("生産品", "Product"), wx + 28, wy + 36
	display_topic lang("説明", "Detail"), wx + 296, wy + 36
	display_topic lang("詳細", "Requirement"), wx + 28, wy + 258
	display_topic lang("必要素材", "Material"), wx + 28, wy + 304
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	cs_listbk
	f = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p), list(1, p)
		if (cs == cnt) {
			matid = i
			if (invctrl == 0) {
				font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
				if (i < 100000) {
					gosub *label_0521
					s = lang("必要スキル: ", "Skill needed: ")
					if (matval == 178) {
						s += lang("錬金術", "Alchemy")
					}
					if (matval == 176) {
						s += lang("大工", "Carpentry")
					}
					if (matval == 179) {
						s += lang("宝石細工", "Jeweler")
					}
					if (matval == 177) {
						s += lang("裁縫", "Tailoring")
					}
					s += " " + matval(1) + "(" + sdata(matval, 0) + ")"
					if (matval(1) <= sdata(matval, 0)) {
						color 30, 30, 200
					} else {
						color 200, 30, 30
					}
					pos wx + 37, wy + 288
					mes s + " "
				} else {
					if (i < 1000000) {
						gosub *label_0521_another
					} else {
						if (i < 2000000) {
							gosub *label_0521_cnpc
						} else {
							gosub *label_0521_citem
						}
						s = lang("必要スキル: ", "Skill needed: ")
						s += skillname(matval(0))
						s += " " + matval(1) + "(" + sdata(matval, 0) + ")"
						if (matval(1) <= sdata(matval, 0)) {
							color 30, 30, 200
						} else {
							color 200, 30, 30
						}
						pos wx + 37, wy + 288
						mes s + " "
						if (matval(4) > 0) {
							s = skillname(matval(3)) + " " + matval(4) + "(" + sdata(matval(3), 0) + ")"
							if (matval(4) <= sdata(matval(3), 0)) {
								color 30, 30, 200
							}
							else {
								color 200, 30, 30
							}
							pos wx + 37 + 192, wy + 288
							mes s + " "
						}
						matlevel = matval(1)
						matskill = sdata(matval, 0)
						if (matval(4) > 0) {
							matlevel = (matlevel + matval(4)) / 2
							matskill = (matskill + sdata(matval(3), 0)) / 2
						}
						s = lang("成功率: ", "Success rate: ") + limit(limit(matval(2) * matskill / matlevel, matval(2), matval(2) * 2), 0, 100) + "%"
						color 30, 30, 200
						pos wx + 37 + 192 * 2, wy + 288
						mes s + " "
					}
				}
			}
			repeat 6
				j = matneed(cnt * 2), matneed(cnt * 2 + 1)
				if (j == (-1)) {
					break
				}
				if (i < 1000000) {
					s = matname(j) + lang(" × ", " x ") + j(1) + "(" + mat(j) + ")"
					if (mat(j) >= j(1)) {
						color 30, 30, 200
					} else {
						color 200, 30, 30
					}
				} else {
					s = another_matname(j) + lang(" × ", " x ") + j(1) + "(" + ncgdata(400 + j) + ")"
					if (ncgdata(400 + j) >= j(1)) {
						color 30, 30, 200
					} else {
						color 200, 30, 30
					}
				}
				pos wx + 37 + cnt \ 3 * 192, wy + 334 + cnt / 3 * 16
				mes s
			loop
			f = 1
		}
		if (i < 10000) {
			s = ioriginalnameref(i)
			p(1) = ipicref(i)
			gsel 1
			color 0
			boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
			if (p(1) == 528) {
				gmode 2
				pos 0, 960
				gcopy 1, 0, 768, inf_tiles, inf_tiles
				pos 0, 1008
				gzoom 22, 20, 5, chipc(0, 0) + 8, chipc(1, 0) + 4 + (chipc(3, 0) > inf_tiles) * 8, chipc(2, 0) - 16, chipc(3, 0) - 8 - (chipc(3, 0) > inf_tiles) * 10, 1
				pos 6, 974
				gcopy 1, 0, 1008, 22, 20
				gsel selcur
			} else {
				if (p(1) == 531) {
					pos 8, 1058 - chipc(3, 0)
					gcopy 5, chipc(0, 0) + 8, chipc(1, 0) + 2, chipc(2, 0) - 16, chipc(3, 0) - 8
					gmode 4, , , 150
					color 0, 0, 0
					pos 0, 960 + (chipc(3, 0) == inf_tiles) * 48
					gcopy 1, 144, 768 + (chipc(3, 0) > inf_tiles) * 48, inf_tiles, chipc(3, 0) + (chipc(3, 0) > inf_tiles) * 48
					gmode 2
					gsel selcur
				} else {
					if (p(1) == 529) {
						pos 0, 1056 - chipc(3, 0)
						gcopy 5, chipc(0, 0), chipc(1, 0), chipc(2, 0), chipc(3, 0)
						gmode 2
						gsel selcur
					} else {
						pos 0, 960
						gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
						gfini chipi(2, p(1)), chipi(3, p(1))
						gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
						gsel selcur
					}
				}
			}
		} else {
			if (i < 100000) {
				s = matname(i - 10000)
				p(1) = matref(2, i - 10000)
				gsel 1
				color 0
				boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
				pos 0, 960
				gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
				gfini chipi(2, p(1)), chipi(3, p(1))
				gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
				gsel selcur
			} else {
				if (i < 1000000) {
					s = another_matname(i - 100000)
					p(1) = another_matref(2, i - 100000)
					gsel 1
					color 0
					boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
					pos 0, 960
					gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
					gfini chipi(2, p(1)), chipi(3, p(1))
					gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
					gsel selcur
				} else {
					if (i < 2000000) {
						s = lang("" + userdatan(1, i - 1000000), "" + userdatan(0, i - 1000000))
						gsel 1
						color 0
						boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
						gsel selcur
					} else {
						s = lang("" + useritemdatan(1, i - 2000000), "" + useritemdatan(0, i - 2000000))
						gsel 1
						color 0
						boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
						gsel selcur
					}
				}
			}
		}
		if (i < 1000000) {
			if (i < 100000) {
				if (i < 10000) {
					s(1) = lang("アイテム[" + s + "]", "Make [" + s + "]")
				} else {
					s(1) = lang("マテリアル[" + s + "]", "Make [" + s + "]")
				}
			} else {
				s(1) = lang("異界マテリアル[" + s + "]", "Make [" + s + "(Another)]")
			}
		} else {
			if (i < 2000000) {
				s(1) = lang("カスタムNPC[" + s + "]", "Make [" + s + "(CNPC)]")
			} else {
				s(1) = lang("カスタムアイテム[" + s + "]", "Make [" + s + "(CItem)]")
			}
		}

		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		if (int(listn(0, p)) == (-1)) {
			p(2) = 3
		} else {
			p(2) = 0
		}
		cs_list cnven(s), wx + 86, wy + 66 + cnt * 19 - 1, 19, 0, p(2)
		pos wx + 308, wy + 66 + cnt * 19 + 2
		mes s(1)
		pos wx + 37, wy + 69 + cnt * 19 + 2
		gmode 2, inf_tiles, inf_tiles
		grotate 1, 0, 960, 0, chipi(2, p(1)), chipi(3, p(1))
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	if (f == 1 | listmax == 0) {
		redraw 1
	}
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		matid = p
		// CItem
		if (matid >= 2000000) {
			gosub *label_0521_citem
			if (prodcheck_custom() == (-1)) {
				snd 27
				txt -1, lang("生産の条件を満たしてない。", "You don't meet requirements to create the material.")
				goto *label_1057
			}
			if (inv_getspace() == 0) {
				snd 27
				txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
				goto *label_1057
			}
			in = 1
			if (matval(2) < 100) {
				autosave = 1 * (gCurrentMap != 35)
				if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
					autosave = 0
				}
			}
			matexp = 0
			repeat 6
				j = matneed(cnt * 2), matneed(cnt * 2 + 1)
				if (j == -1) {
					break
				}
				ncgdata(400 + j) -= j(1) * in
				matexp += j(1) * another_matref(1, j) * limit(in, 1, 1000)
			loop
			if (limit(matval(2) * matskill / matlevel, matval(2), matval(2) * 2) < rnd(100)) {
				txtef 8
				txt -1, lang("製造に失敗した…", "You failed to product the item...")
				page_save
				return
			}
			snd 58
			fixlv = 2
			if (rnd(200 + matval(1) * 2) < sdata(matval, 0) + 20) {
				fixlv = 4
			}
			if (rnd(100 + matval(1) * 2) < sdata(matval, 0) + 20) {
				fixlv = 3
			}
			flt calcobjlv(sdata(matval, 0)), calcfixlv(fixlv)
			inititemid = finditemid(useritemdatan(0, matid - 2000000))
			itemcreate 0, 743, -1, -1, in
			txt -1, lang(itemname(ci, in) + "を製造した。", "You crafted " + itemname(ci, 1) + ".")
			item_stack 0, ci
			r1 = matval
			r2 = matexp
			gosub *label_0679
			r1 = 0
			gosub *chara_refresh
			gosub *label_0625
			page_save
			return
		}
		// CNPC
		if (matid >= 1000000) {
			gosub *label_0521_cnpc
			if (prodcheck_custom() == (-1)) {
				snd 27
				txt -1, lang("生産の条件を満たしてない。", "You don't meet requirements to create the material.")
				goto *label_1057
			}
			if (get_freechara() == (-1)) {
				snd 27
				txt -1, lang("スペースが足りない。", "There is not enough space.")
				goto *label_1057
			}
			if (matval(2) < 100) {
				autosave = 1 * (gCurrentMap != 35)
				if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
					autosave = 0
				}
			}
			matexp = 0
			repeat 6
				j = matneed(cnt * 2), matneed(cnt * 2 + 1)
				if (j == -1) {
					break
				}
				ncgdata(400 + j) -= j(1)
				matexp += j(1) * another_matref(1, j) * limit(in, 1, 1000)
			loop
			if (limit(matval(2) * matskill / matlevel, matval(2), matval(2) * 2) < rnd(100)) {
				txtef 8
				txt -1, lang("製造に失敗した…", "You failed to product the item...")
				page_save
				return
			}
			initunid = findunid(userdatan(0, matid - 1000000))
			flt
			characreate -1, 343, cX(0), cY(0)
			txt -1, lang( userdatan(1, matid - 1000000) + "を製造した。", "You crafted " + userdatan(0, matid - 1000000) + ".")
			if (userdata3(4, matid - 1000000) == 1) {
				gosub *label_1530
			}
			r1 = matval
			r2 = matexp
			gosub *label_0679
			r1 = 0
			gosub *chara_refresh
			gosub *label_0625
			page_save
			return
		}
		// 異界マテリアル
		if (matid >= 100000) {
			gosub *label_0521_another
			if (prodcheck_another() == (-1)) {
				snd 27
				txt -1, lang("生産の条件を満たしてない。", "You don't meet requirements to create the material.")
				goto *label_1057
			}
			txt -1, lang(another_matname(matid - 100000) + "を製造した。", "You crafted " + another_matname(matid - 100000)  + ".")
			another_matgetmain matid - 100000, 1
			repeat 6
				j = matneed(cnt * 2), matneed(cnt * 2 + 1)
				if (j == -1) {
					break
				}
				mat(j) -= j(1)
			loop
			r1 = 0
			gosub *chara_refresh
			gosub *label_0625
			page_save
			goto *label_1056
		}
		// 通常生産
		gosub *label_0521
		if (matid >= 10000) {
			if (prodcheck() == (-1)) {
				snd 27
				txt -1, lang("生産の条件を満たしてない。", "You don't meet requirements to create the material.")
				goto *label_1057
			}
			txt -1, lang(matname(matid - 10000) + "を製造した。", "You crafted " + matname(matid - 10000)  + ".")
			matgetmain matid - 10000, 1
			matexp = 0
			repeat 6
				j = matneed(cnt * 2), matneed(cnt * 2 + 1)
				if (j == -1) {
					break
				}
				mat(j) -= j(1)
				matexp += j(1) * matref(1, j)
			loop
			r1 = matval
			r2 = matexp
			gosub *label_0679
			r1 = 0
			gosub *chara_refresh
			gosub *label_0625
			page_save
			goto *label_1056
		}
		s = ioriginalnameref(matid)
		if (prodcheck() == (-1)) {
			snd 27
			txt -1, lang("生産の条件を満たしてない。", "You don't meet requirements to create the item.")
			goto *label_1057
		}
		if (inv_getspace() == 0) {
			snd 27
			txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
			goto *label_1057
		}
		in = 1
		if (refitem(p, 5, 0) >= 50000) {
			j@se = mat(matneed(0)) / matneed(1)
			repeat 5, 1
				if (matneed(cnt * 2) == -1) {
					break
				}
				if (j@se > mat(matneed(cnt * 2)) / matneed(cnt * 2 + 1)) {
					j@se = mat(matneed(cnt * 2)) / matneed(cnt * 2 + 1)
				}
			loop
			txtnew
			txt -1, lang("幾つ作る？", "How many items do you want to create?")
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, j@se
			inputlog = "1"
			gosub *label_1349
			in = int(inputlog)
			if (in == 0 | rtval == (-1)) {
				goto *label_1057
			}
		}
		matexp = 0
		repeat 6
			j = matneed(cnt * 2), matneed(cnt * 2 + 1)
			if (j == -1) {
				break
			}
			mat(j) -= j(1) * in
			matexp += j(1) * matref(1, j) * limit(in, 1, 1000)
		loop
		snd 58
		fixlv = 2
		if (rnd(200 + matval(1) * 2) < sdata(matval, 0) + 20) {
			fixlv = 4
		}
		if (rnd(100 + matval(1) * 2) < sdata(matval, 0) + 20) {
			fixlv = 3
		}
		flt calcobjlv(sdata(matval, 0)), calcfixlv(fixlv)
		itemcreate 0, p, -1, -1, in
		txt -1, lang(itemname(ci, in) + "を製造した。", "You crafted " + itemname(ci, 1) + ".")
		item_stack 0, ci
		r1 = matval
		r2 = matexp
		gosub *label_0679
		r1 = 0
		gosub *chara_refresh
		gosub *label_0625
		page_save
		goto *label_1056
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1057
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1057
		}
	}
	if (key == key_cancel) {
		return
	}
	goto *label_1058
*label_1059
*label_1060
	listmax = 0
	page = 0
	pagesize = 15
	cs = 0
	cc = 0
	cs_bk = -1
	curmenu = 3
	repeat 400
		if (mat(cnt) != 0) {
			list(0, listmax) = cnt
			listmax++
		}
	loop
	repeat 100
		if (ncgdata(400 + cnt) != 0) {
			list(0, listmax) = cnt + 10000
			listmax++
		}
	loop
	redraw 0
	gsel 7
	pos 0, 0
	picload_ exedir + "graphic\\ie_scroll.bmp"
	gsel 0
	snd 92
	drawmenu
	wx = (windoww - 600) / 2 + inf_screenx
	wy = winposy(430)
	ww = 600
	wh = 430
	windowanime wx, wy, ww, wh, 10, 4
	windowshadow = 1
*label_1061
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	drawmenu
*label_1062
	redraw 0
	s = strhint2 + strhint3b
	showscroll wx, wy, ww, wh
	display_topic lang("所持マテリアル", "Name"), wx + 38, wy + 36
	display_topic lang("説明", "Detail"), wx + 296, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 490, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 68, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		if (i >= 10000) {
			s = "" + another_matname(i - 10000) + lang(" × ", " x ") + oomsest_insertSeparater(str(ncgdata(400 + i - 10000)))
			cs_list s, wx + 96, wy + 66 + cnt * 19 - 1, 19, 0, 0
			s = another_matdesc(i - 10000)
			pos wx + 308, wy + 66 + cnt * 19 + 2
			mes s
			p(1) = matref(2, i - 10000)
			gsel 1
			color 0
			boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
			if (p(1) == 528) {
				gmode 2
				pos 0, 960
				gcopy 1, 0, 768, inf_tiles, inf_tiles
				pos 0, 1008
				gzoom 22, 20, 5, chipc(0, 0) + 8, chipc(1, 0) + 4 + (chipc(3, 0) > inf_tiles) * 8, chipc(2, 0) - 16, chipc(3, 0) - 8 - (chipc(3, 0) > inf_tiles) * 10, 1
				pos 6, 974
				gcopy 1, 0, 1008, 22, 20
				gsel selcur
			} else {
				if (p(1) == 531) {
					pos 8, 1058 - chipc(3, 0)
					gcopy 5, chipc(0, 0) + 8, chipc(1, 0) + 2, chipc(2, 0) - 16, chipc(3, 0) - 8
					gmode 4, , , 150
					color 0, 0, 0
					pos 0, 960 + (chipc(3, 0) == inf_tiles) * 48
					gcopy 1, 144, 768 + (chipc(3, 0) > inf_tiles) * 48, inf_tiles, chipc(3, 0) + (chipc(3, 0) > inf_tiles) * 48
					gmode 2
					gsel selcur
				} else {
					if (p(1) == 529) {
						pos 0, 1056 - chipc(3, 0)
						gcopy 5, chipc(0, 0), chipc(1, 0), chipc(2, 0), chipc(3, 0)
						gmode 2
						gsel selcur
					} else {
						pos 0, 960
						gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
						gfini chipi(2, p(1)), chipi(3, p(1))
						gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
						gsel selcur
					}
				}
			}
		} else {
			s = "" + matname(i) + lang(" × ", " x ") + oomsest_insertSeparater(str(mat(i)))
			cs_list s, wx + 96, wy + 66 + cnt * 19 - 1, 19, 0, 0
			s = matdesc(i)
			pos wx + 308, wy + 66 + cnt * 19 + 2
			mes s
			p(1) = matref(2, i)
			gsel 1
			color 0
			boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
			if (p(1) == 528) {
				gmode 2
				pos 0, 960
				gcopy 1, 0, 768, inf_tiles, inf_tiles
				pos 0, 1008
				gzoom 22, 20, 5, chipc(0, 0) + 8, chipc(1, 0) + 4 + (chipc(3, 0) > inf_tiles) * 8, chipc(2, 0) - 16, chipc(3, 0) - 8 - (chipc(3, 0) > inf_tiles) * 10, 1
				pos 6, 974
				gcopy 1, 0, 1008, 22, 20
				gsel selcur
			} else {
				if (p(1) == 531) {
					pos 8, 1058 - chipc(3, 0)
					gcopy 5, chipc(0, 0) + 8, chipc(1, 0) + 2, chipc(2, 0) - 16, chipc(3, 0) - 8
					gmode 4, , , 150
					color 0, 0, 0
					pos 0, 960 + (chipc(3, 0) == inf_tiles) * 48
					gcopy 1, 144, 768 + (chipc(3, 0) > inf_tiles) * 48, inf_tiles, chipc(3, 0) + (chipc(3, 0) > inf_tiles) * 48
					gmode 2
					gsel selcur
				} else {
					if (p(1) == 529) {
						pos 0, 1056 - chipc(3, 0)
						gcopy 5, chipc(0, 0), chipc(1, 0), chipc(2, 0), chipc(3, 0)
						gmode 2
						gsel selcur
					} else {
						pos 0, 960
						gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
						gfini chipi(2, p(1)), chipi(3, p(1))
						gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
						gsel selcur
					}
				}
			}
		}
		pos wx + 47, wy + 69 + cnt * 19 + 2
		gmode 2, inf_tiles, inf_tiles
		grotate 1, 0, 960, 0, chipi(2, p(1)), chipi(3, p(1))
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 3) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 3
				}
			}
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					csctrl = 0
					goto *label_1251
				}
				if (curmenu == 1) {
					goto *label_1269
				}
				if (curmenu == 2) {
					goto *label_1167
				}
				if (curmenu == 3) {
					goto *label_1060
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1061
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1061
		}
	}
	if (key == key_cancel) {
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1062

#deffunc atxinit
	if (atxthrough == 0) {
		notesel atbuff
		atbuff = ""
	}
	atxthrough = 0
	listmax = 0
	cs = 0
	page = 0
	cc = 0
	cs_bk = -1
	pagesize = 16
	chatesc = -1
	if (atxbg != atxbgbk) {
		mode = 0
		screenupdate = -1
		gosub *label_0623
		mode = 9
		atxbgbk = atxbg
		gsel 4
		gmode 0
		pos 0, 0
		picload_ exedir + "\\graphic\\" + atxbg + ".bmp", 1
		pos 0, inf_msgh
		gzoom windoww, windowh - inf_verh - inf_msgh, 4, 0, 0, 240, 160
		gmode 2
		p = windoww / 192
		repeat p + 1
			if (cnt == p) {
				sx = windoww \ 192
			} else {
				sx = 192
			}
			pos cnt * 192, 0
			gcopy 3, 496, 528, sx, inf_msgh
		loop
		window2 windoww - 208, 0, 208, 98, 0, 0
		pos windoww - 204, 4
		gzoom 200, 90, 0, 120, 88, windoww - 120, windowh - inf_verh - 112, 1
		gsel 0
	}
	return



#deffunc begintempinv
	file = "shoptmp.s2"
	ctrlFile 4
	inv_getheader -1
	repeat invrange, invhead
		iNumber(cnt) = 0
	loop
	return



#deffunc exittempinv
	file = "shoptmp.s2"
	ctrlFile 3
	return
*label_1066
	begintempinv
	atxthrough = 0
	atxpic = 0
	snd 39
	mode = 9
	atxbg = "bg13"
	atxbgbk = ""
	sdim atxinfon, 80, 5
	redraw 0
	if (atxid == 2) {
		goto *label_1074
	}
	if (atxid == 1) {
		txt -1, lang("ディーラーに話しかけた。", "You talk to the dealer.")
		music = 77
		gosub *label_0122
		hide_popup@00m = 2
		goto *label_1078
	}
	if (atxid == 4) {
		music = 77
		gosub *label_0122
		goto *label_1078
	}
	goto *label_1073
*label_1067
	redraw 0
	screenupdate = -1
	gosub *label_0623
	if (atxid >= 2) {
		txtadvmsgfix = 20 + 116
	}
	repeat noteinfo(0)
		noteget s, cnt
		if (strmid(s, 0, 1) == "@") {
			s(1) = strmid(s, 1, 2)
			s = strmid(s, 3, strlen(s) - 3)
			font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
			color 250, 240, 230
			if (s(1) == "BL") {
				color 130, 130, 250
			}
			if (s(1) == "GR") {
				color 130, 250, 130
			}
			if (s(1) == "QM") {
				color 0, 100, 0
			}
		} else {
			font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
			color 250, 240, 230
		}
		pos 170, cnt * 20 + 120 + txtadvmsgfix
		mes s
	loop
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	gsel 2
	gmode 0
	pos 0, 0
	gcopy 0, 0, 0, windoww, windowh
	gsel 0
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	gosub *label_1069
*label_1068
	redraw 0
	x = 170, 400
	y = noteinfo(0) * 20 + 120 + txtadvmsgfix + 16, 20 * listmax
	gmode 0
	pos x, y
	gcopy 2, x, y, x(1), y(1)
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		display_key 170, noteinfo(0) * 20 + 120 + txtadvmsgfix + 16 + cnt * 20, cnt
		s = listn(0, p)
		cs_list s, 170 + 30, noteinfo(0) * 20 + 120 + txtadvmsgfix + 16 + cnt * 20, 19, 0, 2
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	rtval = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			rtval = list(0, pagesize * page + cnt)
			snd 40
			break
		}
	loop
	if (chatesc != (-1)) {
		if (key == key_cancel) {
			snd 40
			rtval = chatesc
		}
	}
	if (rtval != (-1)) {
		gosub *label_1071
		atxpic = 0
		return
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1067
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1067
		}
	}
	goto *label_1068
*label_1069
*label_1070
	gosub *label_1072
	if (mattile != (-1)) {
		mattile = rnd(mattile(2)) + mattile(1)
	}
	repeat 12
		x = 170, 300
		y = noteinfo(0) * 20 + 120 + txtadvmsgfix + 16, 20 * listmax
		redraw 0
		gmode 0
		pos x - 50, y - 50
		gcopy 2, x - 50, y - 50, 100 + x(1), y(1) + 100
		if (cnt == 11) {
			break
		}
		color 0, 0, 0
		gmode 4, x(1), y(1), cnt * 25
		pos x + x(1) / 2 - 10 + cnt, y + y(1) / 2
		grotate 2, 0, 0, 0, x(1), y(1)
		if (atxpic != 0) {
			x = 170 + 175, atxpic(2) + 120
			y = 170, atxpic(3)
			gmode 0
			pos x - atxpic(2) / 2, y - atxpic(3) / 2
			gcopy 2, x - atxpic(2) / 2, y - atxpic(3) / 2, x(1), y(1)
			pos x, y
			gmode 2, inf_tiles, inf_tiles
			if (cnt == 10) {
				p_double = 0
			} else {
				p_double = 0.6222 * cnt
			}
			p(1) = 1
			if (atxpic == 2) {
				p(1) = 5
			}
			grotate p(1), atxpic(1) \ 33 * 32, atxpic(1) / 33 * 32, p_double, cnt * (atxpic(2) / 10), cnt * (atxpic(3) / 10)
		}
		if (mattile != (-1)) {
			cnt2 = cnt
			repeat 2
				x = cnt * 250 + 170, 96
				y = 120, 96
				gmode 0
				pos x, y
				gcopy 2, x, y, x(1), y(1)
				pos x + x(1) / 2, y + y(1) / 2
				gmode 2, inf_tiles, inf_tiles
				grotate 1, mattile \ 33 * 32, mattile / 33 * 32, 0, cnt2 * (96 / 10), cnt2 * (96 / 10)
			loop
		}
		await 20
		redraw 1
	loop
	gmode 2
	atxpic = 0
	return
*label_1071
	gosub *label_1072
	repeat 11
		x = 170
		y = noteinfo(0) * 20 + 120 + txtadvmsgfix + 16, 20 * listmax
		redraw 0
		gmode 0
		pos x - 50, y - 50
		gcopy 2, x - 50, y - 50, 100 + x(1), y(1) + 100
		color 0, 0, 0
		gmode 4, x(1), y(1), 250 - cnt * 25
		pos x + x(1) / 2 - 2 * cnt, y + y(1) / 2
		grotate 2, 0, 0, 0, x(1), y(1)
		await 15
		redraw 1
	loop
	return
*label_1072
	x(1) = 300
	cs = -1
	redraw 0
	color 0, 0, 0
	boxf 170, noteinfo(0) * 20 + 120 + txtadvmsgfix + 16, 170 + x(1), noteinfo(0) * 20 + 120 + txtadvmsgfix + 16 + 20 * listmax
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		display_key 170, noteinfo(0) * 20 + 120 + txtadvmsgfix + 16 + cnt * 20, cnt
		s = listn(0, p)
		gmode 2
		color 0, 0, 0
		cs_list s, 170 + 30, noteinfo(0) * 20 + 120 + txtadvmsgfix + 16 + cnt * 20, 19, 0, 2
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	gsel 2
	gmode 0
	pos 0, 0
	gcopy 0, 170, noteinfo(0) * 20 + 120 + txtadvmsgfix + 16, x(1), 20 * listmax
	gsel 0
	gmode 2
	cs = 0
	return
*label_1073
	mtilefilecur = -1
	gosub *label_0947
	f = 0
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) != 0) {
			f = 1
		}
	loop
	if (f == 1) {
		if (cHp(0) >= 0) {
			txt -1, lang("幾つかの戦利品がある。", "There are some items you can acquire.")
			screenupdate = -1
			gosub *label_0623
			invsubroutine = 1
			invctrl = 22, 0
			gosub *label_1280
		}
	}
	mode = 0
	atxid = 0
	exittempinv
	await 100
	snd 39
	hide_popup@00m = 0
	gosub *label_0122
	return
*label_1074
	atxap = 10
	atxspot = 19
	atxinfon(0) = "ランダムサイト"
	atxinit
	atxthrough = 1
	if (atxid(1) == 0) {
		atxid(1) = 3
		atxlv = gCurrentDungeonLevel
		if (mapType == 20) {
			atxid(1) = 1
		}
		if (mapType == 21) {
			atxid(1) = 4
		}
		if (mapType == 22) {
			atxid(1) = 2
		}
		if (mapType == 23) {
			atxid(1) = 4
		}
		if (mapType == 1) {
			atxlv = cLevel(0)
			if (4 <= gdata(62) & gdata(62) < 9) {
				atxid(1) = 2
			}
			if (264 <= gdata(62) & gdata(62) < 363) {
				atxid(1) = 3
			}
			if (9 <= gdata(62) & gdata(62) < 13) {
				atxid(1) = 2
			}
			if (13 <= gdata(62) & gdata(62) < 17) {
				atxid(1) = 3
			}
		}
	}
	if (atxid(1) == 8) {
		atxbg = "bg21"
		mattile = 0, 495, 3
		atxspot = 16
		noteadd "この辺りは残骸やら遺品やらでごちゃごちゃだ。"
	}
	if (atxid(1) == 7) {
		atxbg = "bg20"
		mattile = 0, 495, 3
		atxspot = 15
		noteadd "この辺りには見たこともない植物がたくさんある。"
	}
	if (atxid(1) == 6) {
		atxbg = "bg19"
		mattile = 0, 495, 3
		atxspot = 14
		noteadd "天然の鉱石の宝庫だ。"
	}
	if (atxid(1) == 5) {
		atxbg = "bg18"
		mattile = 0, 495, 3
		atxspot = 13
		noteadd "綺麗な泉がある。"
	}
	if (atxid(1) == 1) {
		atxbg = "bg13"
		mattile = 0, 495, 3
		atxspot = 9
	}
	if (atxid(1) == 4) {
		atxbg = "bg17"
		mattile = 0, 495, 3
		atxspot = 12
	}
	if (atxid(1) == 2) {
		atxbg = "bg15"
		mattile = 0, 495, 3
		atxspot = 10
	}
	if (atxid(1) == 3) {
		atxbg = "bg16"
		mattile = 0, 495, 3
		atxspot = 11
	}
*label_1075
	if (atxap <= 0 | cHp(0) < 0) {
		goto *label_1077
	}
	atxinit
	noteadd "何をしよう？"
	list(0, listmax) = 1
	listn(0, listmax) = "探索"
	listmax++
	list(0, listmax) = 3
	listn(0, listmax) = "去る"
	listmax++
	atxinfon(1) = "行動回数残り " + atxap + "回\n"
	chatesc = 3
	txtadvmsgfix = 0
	txtadvscreenupdate = 1
	gosub *label_1067
	if (rtval == 1) {
		goto *label_1076
	}
	if (rtval == 2) {
		goto *label_1076
	}
	if (rtval == 3) {
		goto *label_1077
	}
	goto *label_1075
*label_1076
	atxap--
	atxinit
	if (rnd(1) == 0) {
		atxrefval1 = -1
		if (atxid(1) == 7) {
			atxpic = 1, 171, 96, 96
			noteadd "茂みを見つけた。"
			list(0, listmax) = 1
			listn(0, listmax) = "調べる"
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = "採取する" + "(" + skillname(180) + ": " + sdata(180, 0) + ")"
			listmax++
			atxrefval1 = 7
		}
		if (atxid(1) == 6) {
			atxpic = 1, 219, 96, 96
			noteadd "鉱石の岩がある。"
			list(0, listmax) = 1
			listn(0, listmax) = "調べる"
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = "掘る" + "(" + skillname(163) + ": " + sdata(163, 0) + ")"
			listmax++
			atxrefval1 = 7
		}
		if (atxid(1) == 5) {
			atxpic = 1, 439, 96, 96
			noteadd "泉がある。"
			list(0, listmax) = 1
			listn(0, listmax) = "飲む"
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = "釣る" + "(" + skillname(185) + ": " + sdata(185, 0) + ")"
			listmax++
			atxrefval1 = 7
		}
		if (atxid(1) == 8) {
			atxpic = 1, 199, 96, 96
			noteadd "残骸を見つけた。"
			list(0, listmax) = 1
			listn(0, listmax) = "あさる"
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = "解剖する" + "(" + skillname(161) + ": " + sdata(161, 0) + ")"
			listmax++
			atxrefval1 = 7
		}
		if (atxrefval1 == (-1)) {
			noteadd "壁に何やら怪しいひび割れがある…"
			list(0, listmax) = 1
			listn(0, listmax) = "叩く(筋力)"
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = "調べる(感知)"
			listmax++
		}
		atxinfon(1) = "行動回数残り " + atxap + "回\n"
		chatesc = 1
		txtadvmsgfix = 0
		txtadvscreenupdate = 1
		gosub *label_1067
		atxinit
		if (rtval == 1) {
			repeat 3
				p = random_material(atxspot)
				atxpic = 1, matref(2, p), 96, 96
				snd 41
				mat(p) = limit(mat(p) + 1, 0, 2000000000)
				noteadd lang("@BL" + matname(p) + "を" + 1 + "個手に入れた！(所持数:" + mat(p) + "個)", "@BLYou get " + 1 + " " + matname(p) + "(s)! (Total:" + mat(p) + ")")
			loop
			atxthrough = 1
			goto *label_1075
		}
		if (rtval == 2) {
			atxthrough = 1
			goto *label_1075
		}
	}
	if (rnd(8) == 0) {
		if (rnd(4) == 0) {
			noteadd "あれ…？"
			noteadd "道に迷った！ (行動回数-2)"
			atxap -= 2
			atxthrough = 1
			goto *label_1075
		}
		if (rnd(2) == 0) {
			atxpic = 2, 205, 96, 96
			noteadd "幽霊に脅かされた！ (行動回数-1)"
			snd 70
			atxap -= 1
			atxthrough = 1
			goto *label_1075
		}
		if (rnd(2) == 0) {
			atxpic = 1, 424, 96, 96
			noteadd "小石につまづいてころんでしまった！ (行動回数-1)"
			snd 70
			atxap -= 1
			atxthrough = 1
			goto *label_1075
		}
	}
	if (rnd(8) == 0) {
		if (rnd(4) == 0) {
			atxpic = 1, 200, 96, 96
			noteadd "ふかふかの藁を見つけた。"
			noteadd "ふかふかして気持ちいい。（行動回数+3)"
			atxap += 2
			atxthrough = 1
			goto *label_1075
		}
		if (rnd(2) == 0) {
			atxpic = 1, 294, 96, 96
			noteadd "切り株がある。"
			noteadd "腰を下ろして疲れを癒した。（行動回数+2)"
			atxap += 2
			atxthrough = 1
			goto *label_1075
		}
		if (rnd(2) == 0) {
			atxpic = 1, 127, 96, 96
			noteadd "綺麗な花を見つけた。"
			noteadd "心がなごんだ…（行動回数+2)"
			atxap += 2
			atxthrough = 1
			goto *label_1075
		}
	}
	if (rnd(7) == 0) {
		if (rnd(3)) {
			atxpic = 2, 210, 96, 96
			noteadd "痛っ！蚊に刺された。"
			snd 2
			dmghp 0, cMaxHp(0) * 5 / 100, -10
		} else {
			atxpic = 2, 216, 96, 96
			noteadd "うっ！ヘビに噛まれた。"
			snd 2
			dmghp 0, cMaxHp(0) * 10 / 100, -10
		}
		atxthrough = 1
		goto *label_1075
	}
	if (rnd(3) == 0) {
		if (rnd(3)) {
			atxpic = 2, 210, 96, 96
			noteadd "痛っ！蚊に刺された。"
			snd 2
			dmghp 0, cMaxHp(0) * 5 / 100, -10
		} else {
			atxpic = 2, 216, 96, 96
			noteadd "うっ！ヘビに噛まれた。"
			snd 2
			dmghp 0, cMaxHp(0) * 10 / 100, -10
		}
		atxthrough = 1
		goto *label_1075
	}
	if (rnd(2) == 0) {
		atxpic = 1, 220, 96, 96
		noteadd "宝箱がある。"
		list(0, listmax) = 1
		listn(0, listmax) = "錠を解体する" + "(" + skillname(158) + ": " + sdata(158, 0) + ")"
		listmax++
		list(0, listmax) = 3
		listn(0, listmax) = "叩き割る" + "(筋力: " + sdata(10, 0) + ")"
		listmax++
		atxinfon(1) = "行動回数残り " + atxap + "回\n"
		chatesc = 1
		txtadvmsgfix = 0
		txtadvscreenupdate = 1
		gosub *label_1067
		atxinit
		goto *label_1075
	}
	if (rnd(2) == 0) {
		p = random_material(atxspot)
		atxpic = 1, matref(2, p), 96, 96
		snd 41
		mat(p) = limit(mat(p) + 1, 0, 2000000000)
		noteadd lang("@BL" + matname(p) + "を" + 1 + "個手に入れた！(所持数:" + mat(p) + "個)", "@BLYou get " + 1 + " " + matname(p) + "(s)! (Total:" + mat(p) + ")")
		atxthrough = 1
		goto *label_1075
	}
	if (rnd(3) == 0) {
		noteadd "何も見つからなかった…"
		atxthrough = 1
		goto *label_1075
	}
	noteadd "何も見つからなかった…"
	atxthrough = 1
	goto *label_1075
*label_1077
	atxinit
	if (cHp(0) >= 0) {
		noteadd "探索を終えた。"
		list(0, listmax) = 0
		listn(0, listmax) = "戻る"
		listmax++
	} else {
		noteadd "ぐふ…"
		list(0, listmax) = 0
		listn(0, listmax) = "(断末魔の叫び)"
		listmax++
	}
	atxinfon(1) = "行動回数残り " + atxap + "回\n"
	chatesc = 0
	txtadvmsgfix = 0
	txtadvscreenupdate = 1
	gosub *label_1067
	goto *label_1073
*label_1078
	atxbg = "bg14"
	mattile = -1
	atxinfon(0) = lang("カジノ《フォーチュンクッキー》", "Casino <<Fortune Cookie>>")
	atxinit
	noteadd lang("カジノ《フォーチュンクッキー》へようこそ。", "Welcome to the casino, Fortune cookie!")
	noteadd lang("チップマテリアルと引き換えにゲームをすることができます。", "You can bet the casino chips you have and play some games.")
	noteadd lang("ごゆっくりお楽しみ下さい。", "Enjoy your stay.")
	if (gdata(250 + 6) == 0) {
		noteadd ""
		noteadd lang("お客様は初めてのご利用のようですね。", "Looks like you play for the first time, sir.")
		noteadd lang("当店からチップマテリアルを10枚進呈します。", "We're offering you 10 free casino chips to try our games.")
		gdata(250 + 6) = 1
		snd 41
		mat(50) = limit(mat(50) + 10, 0, 2000000000)
		noteadd lang("@BL" + matname(50) + "を" + 10 + "個手に入れた！(所持数:" + mat(50) + "個)", "@BLYou get " + 10 + " " + matname(50) + "(s)! (Total:" + mat(50) + ")")
	}
	atxinfon(1) = lang("カジノチップ残り " + thousandsep(str(mat(50))) + "枚\n", "Casino chips left: " + thousandsep(str(mat(50))) + "\n")
	atxinfon(2) = ""
	list(0, listmax) = 0
	listn(0, listmax) = lang("店を出る", "Later.")
	listmax++
	list(0, listmax) = 1
	listn(0, listmax) = lang("ブラックジャック", "I want to play Blackjack.")
	listmax++
	chatesc = 0
	txtadvmsgfix = 0
	txtadvscreenupdate = 1
	gosub *label_1067
	if (rtval == 0) {
		goto *label_1073
	}
	if (rtval == 1) {
		goto *label_1079
	}
	goto *label_1078
*label_1079
	atxinit
	noteadd lang("ブラックジャックは、カードの合計を21に近づけるゲームです。", "In Blackjack, the hand with the highest total wins as long as it")
	noteadd lang("J,Q,Kは10に、Aは1または11に数えられます。21を越えると負けです。", "doesn't exceed 21. J,Q,K are counted as 10 and A is counted as 1 or 11.")
	noteadd lang("では、賭けるチップを宣言してください。", "More bets means better rewards.")
	noteadd lang("チップが多いほど、景品の質があがります。", "How many tips would you like to bet?")
	atxinfon(1) = lang("カジノチップ残り " + thousandsep(str(mat(50))) + "枚\n", "Casino chips left: " + thousandsep(str(mat(50))) + "\n")
	atxinfon(2) = ""
	if (mat(50) <= 0) {
		noteadd ""
		noteadd lang("お客様はチップをもっていません。", "Sorry sir, you don't seem to have casino chips.")
	}
	list(0, listmax) = 0
	listn(0, listmax) = lang("やめる", "I quit.")
	listmax++
	if (mat(50) >= 1) {
		list(0, listmax) = 1
		listn(0, listmax) = lang("" + 1 + "枚賭ける", "Bet " + 1 + " chip.")
		listmax++
	}
	if (mat(50) >= 5) {
		list(0, listmax) = 5
		listn(0, listmax) = lang("" + 5 + "枚賭ける", "Bet " + 5 + " chips.")
		listmax++
	}
	if (mat(50) >= 20) {
		list(0, listmax) = 20
		listn(0, listmax) = lang("" + 20 + "枚賭ける", "Bet " + 20 + " chips.")
		listmax++
	}
	if (mat(50) >= 100) {
		list(0, listmax) = mat(50)
		listn(0, listmax) = lang(thousandsep(str(mat(50))) + "枚賭ける", "Bet " + thousandsep(str(mat(50))) + " chips.")
		listmax++
	}
	chatesc = 0
	txtadvmsgfix = 0
	txtadvscreenupdate = 1
	gosub *label_1067
	if (rtval == 0) {
		goto *label_1078
	}
	stake = rtval
	winrow = 0
	cardround = 0
	autosave = 1 * (gCurrentMap != 35)
	if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
		autosave = 0
	}
	repeat
		screenupdate = -1
		gosub *label_0623
		atxinit
		if (cnt == 0) {
			mat(50) -= stake
			noteadd lang(matname(50) + "を" + thousandsep(str(stake)) + "個失った(残り:" + mat(50) + "個)", "You lose " + thousandsep(str(stake)) + " " + matname(50) + "(s). (Total:" + mat(50) + ")")
		}
		if (cardround == 0) {
			nojoker = 1
			initcard 60, 160
			cardplayerinit 2, 5
			cardplayeradd 0, 220, 124
			cardplayeradd 1, 220, 240
		}
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 1
		color 255, 255, 255
		pos 152, 154
		mes lang("　親", "Dealer")
		pos 152, 270
		mes lang("あなた", "   You")
		showcardpile
		showcardholder
		showcard
		if (cardround == 0) {
			repeat 4
				servecard cnt \ 2
				if (cnt != 2) {
					nc_intb_001 = stat
					opencard2 nc_intb_001
				}
				if (cnt == 2) {
					nc_intb_002 = 0
					item_find 820, 3, 1
					if (stat != (-1)) {
						if (rnd(3) == 0) {
							txt -1, lang("相手の手の内が見えた。", "You have seen your opponent's card.")
							opencard2 2
							nc_intb_002 = 1
						}
					}
				}
			loop
			repeat 1
				if (cpcardnum(0) >= 5) {
					break
				}
				if (cpscore(0) < cpscore(1) | cpscore(0) - rnd(5) <= 11) {
					servecard 0
					opencard2 stat
					continue cnt
				}
			loop
		}
		noteadd lang("あなたの合計は" + cpscore(1) + "です。", "Your hand is " + cpscore(1) + ".")
		if (cardround == (-1)) {
			noteadd lang("親の合計は" + cpscore(0) + "です。", "The dealer's hand is " + cpscore(0) + ".")
			winner = -1
			if (cpscore(0) <= 21) {
				if (cpscore(1) > 21 | cpscore(0) > cpscore(1)) {
					winner = 0
				}
			}
			if (cpscore(1) <= 21) {
				if (cpscore(0) > 21 | cpscore(1) > cpscore(0)) {
					winner = 1
				}
			}
			if (winner == (-1)) {
				noteadd lang("勝負は引き分けです。", "The match is a draw.")
			}
			if (winner == 0) {
				noteadd lang("あなたの負けです。", "You lose.")
			}
			if (winner == 1) {
				noteadd lang("おめでとうございます。あなたの勝ちです。", "Congratulations, you win.")
			}
		}
		atxinfon(1) = lang("カジノチップ残り " + thousandsep(str(mat(50))) + "枚\n", "Casino chips left: " + thousandsep(str(mat(50))) + "\n")
		atxinfon(2) = lang("賭けチップ " + thousandsep(str(stake)) + "枚 現在" + winrow + "連勝中", "Bets: " + thousandsep(str(stake)) + " Wins: " + winrow + "")
		if (cardround == (-1)) {
			if (winner == 1) {
				winrow++
			}
			if (winner != 0) {
				list(0, listmax) = 0
				listn(0, listmax) = lang("次の勝負へ", "To the next round.")
				listmax++
			}
			if (winner == 0) {
				list(0, listmax) = 0
				listn(0, listmax) = lang("戻る", "Bah...!")
				listmax++
			}
			chatesc = -1
			txtadvmsgfix = 240
			txtadvscreenupdate = 0
			gosub *label_1067
			if (winner == 0) {
				break
			}
			cardround = 0
			continue
		}
		list(0, listmax) = 0
		listn(0, listmax) = lang("これに決める", "Stay.")
		listmax++
		if (pileremain() > 10) {
			if (cpcardnum(1) < 5) {
				list(0, listmax) = 1
				listn(0, listmax) = lang("もう一枚引く(運)", "Hit me. (Luck)")
				listmax++
			}
			list(0, listmax) = 2
			listn(0, listmax) = lang("イカサマ(器用", "Cheat. (Dex:") + sdata(12, 0) + ")"
			listmax++
		}
		chatesc = -1
		txtadvmsgfix = 240
		txtadvscreenupdate = 0
		gosub *label_1067
		if (rtval == 0) {
			if (nc_intb_002 == 0) {
				opencard2 cpblackcard(0)
			}
			cardround = -1
			continue
		}
		if (rtval == 1) {
			servecard 1
			p = stat
			nc_intb_003 = 3
			item_find 820, 3, 1
			if (stat != (-1)) {
				nc_intb_003 = 5
			}
			repeat 3
				if (cpscore(1) >= 22) {
					if (pileremain() > 10) {
						if (rnd(sdata(19, 0)) > 40) {
							txt -1, lang("このカードは悪い予感がする…", "I have a bad feeling about this card...")
							trashcard p
							servecard 1
							p = stat
						} elseif (trophycheck(16) == 2 & rnd(3) == 0) {
							txt -1, lang("殺気っ…！", "I have a bad feeling about this card...")
							trashcard p
							servecard 1
							p = stat
						} else {
							item_find 820, 3, 1
							if (stat != (-1)) {
								if (rnd(3)) {
									txt -1, lang("このカードは悪い予感がする…", "I have a bad feeling about this card...")
									trashcard p
									servecard 1
									p = stat
								}
							}
						}
					}
				}
			loop
			opencard2 p
		}
		if (rtval == 2) {
			trashcard lastcard(1)
			servecard 1
			opencard2 stat
			p = 20
			if (stake == 5) {
				p = 40
			}
			if (stake == 20) {
				p = 60
			}
			if (nc_gettrait(0, 113) > 0) {
				p /= 2
			}
			if (rnd(sdata(12, 0)) < rnd(p) | stake >= 100) {
				atxinit
				noteadd lang("イカサマだ！", "Cheater!")
				atxinfon(1) = lang("カジノチップ残り " + thousandsep(str(mat(50))) + "枚\n", "Casino chips left: " + thousandsep(str(mat(50))) + "\n")
				atxinfon(2) = lang("賭けチップ " + thousandsep(str(stake)) + "枚 現在" + winrow + "連勝中", "Bets: " + thousandsep(str(stake)) + " Wins: " + winrow + "")
				winrow = 0
				txt -1, lang("イカサマが見つかってしまった…", "You are caught cheating...")
				modkarma 0, -5
				list(0, listmax) = 0
				listn(0, listmax) = lang("濡れ衣だ！", "I didn't do it!")
				listmax++
				chatesc = -1
				txtadvmsgfix = 0
				txtadvscreenupdate = 1
				gosub *label_1067
				break
			}
		}
		cardround++
	loop
	if (winrow > 0) {
		atxinit
		noteadd lang("おめでとうございます。あなたは" + winrow + "連勝しました。", "Congratulations! You've won " + winrow + " times in a row.")
		repeat 1
			i = 2
			if (winrow > 2) {
				i = 3
			}
			if (winrow > 7) {
				if (stake >= 5) {
					i = 4
				}
			}
			if (winrow > 15) {
				if (stake >= 20) {
					i = 5
				}
			}
			flt calcobjlv(rnd(stake + winrow * 2) + winrow * 3 / 2 + stake / 2), i
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			itemcreate -1, 0, -1, -1, 0
			if (iNumber(ci) == 0) {
				continue cnt
			}
		loop
		snd 41
		noteadd lang("@GRアイテム：" + itemname(ci, iNumber(ci)) + "を戦利品に加えた！", "@GR" + itemname(ci, iNumber(ci)) + " has been added to your loot list!")
		if (winrow > 3) {
			if (rnd(50) < winrow * 5 + 5) {
				flt
				if (stake == 1) {
					itemcreate -1, 559, -1, -1, rnd(1) + 1
				} elseif (stake == 5) {
					itemcreate -1, 559, -1, -1, rnd(5) + 1
				} elseif (stake == 20) {
					itemcreate -1, 559, -1, -1, rnd(20) + 1
				} else {
					itemcreate -1, 793, -1, -1, role(stake / 10, 10) + 1
				}
				snd 41
				noteadd lang("@GRアイテム：" + itemname(ci, iNumber(ci)) + "を戦利品に加えた！", "@GR" + itemname(ci, iNumber(ci)) + " has been added to your loot list!")
			}
		}
		if (ocbit(11, 0)) {
			if (gettrait(0, 187)) {
				modstress limit(stake * 50 * winrow, 0, 15000) * (-1)
			}
		}
		if (nc_gettrait(0, 113) > 0) {
			skillexp2 11, 0, 10 * (stake / 10 + 1) * winrow
			skillexp2 12, 0, 15 * (stake / 10 + 1) * winrow
			skillexp2 19, 0, 20 * (stake / 10 + 1) * winrow
		}
		list(0, listmax) = 0
		listn(0, listmax) = lang("戻る", "Great.")
		listmax++
		chatesc = 0
		txtadvmsgfix = 0
		txtadvscreenupdate = 1
		gosub *label_1067
		winrow = 0
	}
	goto *label_1079
	goto *label_1081



#deffunc modpiety int __www, int __xxx
	if (__xxx == 0) {
		if (cGod(0) != 0) {
			if (cPietyPoint(0) >= 4000) {
				ogbitmod cGod(0), 1
				gosub *label_1177
			}
		} else {
			if (cPietyPoint(0) >= 4000) {
				if (godcheck() == "serria") {
					newtitle 101
				}
				if (godcheck() == "dybony") {
					newtitle 103
				}
			}
		}
		if (cPietyPoint(__xxx) >= 6666) {
			if (godcheck() == "lulwy") {
				ospact(100) = 1, 1
			} elseif (godcheck() == "kumiromi") {
				ospact(102) = 1
				ospact(112) = 1
			} elseif (godcheck() == "jure") {
				ospact(103) = 1
				ospact(110) = 1
			} elseif (godcheck() == "opatos") {
				ospact(104) = 1
				ospact(109) = 1
			} elseif (godcheck() == "ehekatl") {
				ospact(107) = 1
				ospact(113) = 1
			} elseif (godcheck() == "mani") {
				ospact(105) = 1, 1
			} elseif (godcheck() == "itzpalt") {
				ospact(108) = 1
				ospact(111) = 1
			} elseif (godcheck() == "inari") {
				ospact(114) = 1, 1
			} elseif (godcheck() == "danalin") {
				ospact(116) = 1, 1
			} elseif (godcheck() == "serria") {
				ospact(272) = 1
			} elseif (godcheck() == "dybony") {
				ospact(275) = 1
			} elseif (getcgodno() != (-1)) {
				god_no = stat
				repeat 2
					if (cgodMiracleNameEn(god_no, cnt) != "") {
						ospact(118 + cnt) = 1
					}
				loop
			}
		}
	}
	if (__xxx == 0) {
		if (gGodRank == 4) {
			if (cPietyPoint(0) >= 4000) {
				gGodRank++
				txtgod godcheck(), 8
			}
		}
		if (gGodRank == 2) {
			if (cPietyPoint(0) >= 2500) {
				gGodRank++
				txtgod godcheck(), 7
			}
		}
		if (gGodRank == 0) {
			if (cPietyPoint(0) >= 1500) {
				gGodRank++
				txtgod godcheck(), 7
			}
		}
	}
	if (int(limitf(double(sdata(181, __xxx)) * 100, 0, 2147483647)) <= cPietyPoint(__xxx)) {
		if (__xxx == 0) {
			txt -1, lang("あなたの信仰は既に限界まで高まっている。", " Your God becomes indifferent to your gift.")
		}
		return 0
	}
	cPietyPoint(__xxx) = int(limitf(double(cPietyPoint(__xxx)) + __www, 0, int(limitf(double(sdata(181, __xxx)) * 100, 0, 2147483647))))
	return 1
*label_1081
*label_1082
	if (godcheck(tc) != "eyth" | cbit(990, tc) | tc == 0) {
		return
	}
	randomize gRandomSeed + gCurrentMap
	believegod tc, godno2godid(rnd(8))
	randomize
	if (godcheck(tc) == "eyth" | rnd(4) == 0) {
		cbitmod 990, tc, 1
	}
	return
*label_1085
	prayp = 1
	repeat 30, 100
		if (cdata(cnt, r1) \ 10000 == 0) {
			continue
		}
		rp = cdata(cnt, r1) \ 10000 - 1
		if (check_bigench(rp) == 5) {
			prayp += iBigenchantmentPower(rp)
		}
	loop
	if (godcheck(r1) == "mani") {
		if (sdata(12, r1) > 0) {
			sdata(12, r1) += limit(cPietyPoint(r1) / 400, 1, 8 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(13, r1) > 0) {
			sdata(13, r1) += limit(cPietyPoint(r1) / 300, 1, 14 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(154, r1) > 0) {
			sdata(154, r1) += limit(cPietyPoint(r1) / 500, 1, 8 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(110, r1) > 0) {
			sdata(110, r1) += limit(cPietyPoint(r1) / 250, 1, 18 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(159, r1) > 0) {
			sdata(159, r1) += limit(cPietyPoint(r1) / 350, 1, 8 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(158, r1) > 0) {
			sdata(158, r1) += limit(cPietyPoint(r1) / 250, 1, 16 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(176, r1) > 0) {
			sdata(176, r1) += limit(cPietyPoint(r1) / 300, 1, 10 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(179, r1) > 0) {
			sdata(179, r1) += limit(cPietyPoint(r1) / 350, 1, 12 + sdata(181, r1) / 5) * prayp
		}
	}
	if (godcheck(r1) == "lulwy") {
		if (sdata(13, r1) > 0) {
			sdata(13, r1) += limit(cPietyPoint(r1) / 450, 1, 10 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(18, r1) > 0) {
			sdata(18, r1) += limit(cPietyPoint(r1) / 350, 1, 30 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(108, r1) > 0) {
			sdata(108, r1) += limit(cPietyPoint(r1) / 350, 1, 16 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(109, r1) > 0) {
			sdata(109, r1) += limit(cPietyPoint(r1) / 450, 1, 12 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(157, r1) > 0) {
			sdata(157, r1) += limit(cPietyPoint(r1) / 450, 1, 12 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(174, r1) > 0) {
			sdata(174, r1) += limit(cPietyPoint(r1) / 550, 1, 8 + sdata(181, r1) / 5) * prayp
		}
	}
	if (godcheck(r1) == "itzpalt") {
		if (sdata(16, r1) > 0) {
			sdata(16, r1) += limit(cPietyPoint(r1) / 300, 1, 18 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(155, r1) > 0) {
			sdata(155, r1) += limit(cPietyPoint(r1) / 350, 1, 15 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(50, r1) > 0) {
			sdata(50, r1) += limit(cPietyPoint(r1) / 50, 1, 200 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(51, r1) > 0) {
			sdata(51, r1) += limit(cPietyPoint(r1) / 50, 1, 200 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(52, r1) > 0) {
			sdata(52, r1) += limit(cPietyPoint(r1) / 50, 1, 200 + sdata(181, r1) / 5) * prayp
		}
		cbitmod 20, r1, 1
	}
	if (godcheck(r1) == "ehekatl") {
		if (sdata(17, r1) > 0) {
			sdata(17, r1) += limit(cPietyPoint(r1) / 250, 1, 20 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(19, r1) > 0) {
			sdata(19, r1) += limit(cPietyPoint(r1) / 100, 1, 50 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(173, r1) > 0) {
			sdata(173, r1) += limit(cPietyPoint(r1) / 300, 1, 15 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(164, r1) > 0) {
			sdata(164, r1) += limit(cPietyPoint(r1) / 350, 1, 17 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(185, r1) > 0) {
			sdata(185, r1) += limit(cPietyPoint(r1) / 300, 1, 12 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(158, r1) > 0) {
			sdata(158, r1) += limit(cPietyPoint(r1) / 450, 1, 8 + sdata(181, r1) / 5) * prayp
		}
	}
	if (godcheck(r1) == "opatos") {
		if (sdata(10, r1) > 0) {
			sdata(10, r1) += limit(cPietyPoint(r1) / 450, 1, 11 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(11, r1) > 0) {
			sdata(11, r1) += limit(cPietyPoint(r1) / 350, 1, 16 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(168, r1) > 0) {
			sdata(168, r1) += limit(cPietyPoint(r1) / 350, 1, 15 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(153, r1) > 0) {
			sdata(153, r1) += limit(cPietyPoint(r1) / 300, 1, 16 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(163, r1) > 0) {
			sdata(163, r1) += limit(cPietyPoint(r1) / 350, 1, 12 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(174, r1) > 0) {
			sdata(174, r1) += limit(cPietyPoint(r1) / 450, 1, 8 + sdata(181, r1) / 5) * prayp
		}
	}
	if (godcheck(r1) == "jure") {
		if (sdata(15, r1) > 0) {
			sdata(15, r1) += limit(cPietyPoint(r1) / 300, 1, 16 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(154, r1) > 0) {
			sdata(154, r1) += limit(cPietyPoint(r1) / 250, 1, 18 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(155, r1) > 0) {
			sdata(155, r1) += limit(cPietyPoint(r1) / 400, 1, 10 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(161, r1) > 0) {
			sdata(161, r1) += limit(cPietyPoint(r1) / 400, 1, 9 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(184, r1) > 0) {
			sdata(184, r1) += limit(cPietyPoint(r1) / 450, 1, 8 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(174, r1) > 0) {
			sdata(174, r1) += limit(cPietyPoint(r1) / 400, 1, 10 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(164, r1) > 0) {
			sdata(164, r1) += limit(cPietyPoint(r1) / 400, 1, 12 + sdata(181, r1) / 5) * prayp
		}
	}
	if (godcheck(r1) == "kumiromi") {
		if (sdata(13, r1) > 0) {
			sdata(13, r1) += limit(cPietyPoint(r1) / 400, 1, 8 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(12, r1) > 0) {
			sdata(12, r1) += limit(cPietyPoint(r1) / 350, 1, 12 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(14, r1) > 0) {
			sdata(14, r1) += limit(cPietyPoint(r1) / 250, 1, 16 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(180, r1) > 0) {
			sdata(180, r1) += limit(cPietyPoint(r1) / 300, 1, 12 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(178, r1) > 0) {
			sdata(178, r1) += limit(cPietyPoint(r1) / 350, 1, 10 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(177, r1) > 0) {
			sdata(177, r1) += limit(cPietyPoint(r1) / 350, 1, 9 + sdata(181, r1) / 5) * prayp
		}
		if (sdata(150, r1) > 0) {
			sdata(150, r1) += limit(cPietyPoint(r1) / 350, 1, 8 + sdata(181, r1) / 5) * prayp
		}
	}
	if (getcgodno(r1) != (-1)) {
		god_no = stat
		repeat 10
			bonusskill = cgodBonusAbility(god_no, cnt)
			if (bonusskill == 0) {
				break
			}
			if (sdata(bonusskill, r1) > 0) {
				bonuslimit = cgodBonusRank(god_no, cnt)
				bonust = limitmin(20 - bonuslimit, 1)
				if (bonusskill >= 50 & bonusskill < 100) {
					bonuslimit = 10 + bonuslimit * 10
				}
				sdata(bonusskill, r1) += limit(cPietyPoint(r1) / (50 * bonust), 1, bonuslimit + sdata(181, r1) / 5) * prayp
			}
		loop
		if (cgodSpecialPowerId(god_no) / 1000 == 1) {
			rp2 = cgodSpecialPowerId(god_no) \ 1000
			if (rp2 == 56) {
				if (r1 == 0) {
					gCatchesGodSignal = 1
				}
			}
			if (rp2 == 59) {
				if (r1 == 0) {
					gRevealsReligion = 1
				}
			}
			if (rp2 == 29) {
				sdata(18, r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 50 + 1
				if (r1 == 0) {
					gSevenLeagueBootEffect += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 8
				}
			}
			if (rp2 == 32) {
				cbitmod 5, r1, 1
			}
			if (rp2 == 35) {
				cbitmod 7, r1, 1
			}
			if (rp2 == 23) {
				cbitmod 9, r1, 1
			}
			if (rp2 == 24) {
				cbitmod 12, r1, 1
			}
			if (rp2 == 25) {
				cbitmod 8, r1, 1
			}
			if (rp2 == 26) {
				cbitmod 10, r1, 1
			}
			if (rp2 == 27) {
				cbitmod 11, r1, 1
			}
			if (rp2 == 28) {
				cbitmod 13, r1, 1
			}
			if (rp2 == 42) {
				cbitmod 14, r1, 1
			}
			if (rp2 == 41) {
				cbitmod 15, r1, 1
			}
			if (rp2 == 55) {
				cbitmod 29, r1, 1
			}
			if (rp2 == 52) {
				cDecreasePhysicalDamage(r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 40 + 5
			}
			if (rp2 == 53) {
				cNullifyDamage(r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 60 + 3
			}
			if (rp2 == 54) {
				cCutCounterattack(r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 5
			}
			if (rp2 == 44) {
				cRateOfCriticalHit(r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 50
			}
			if (rp2 == 39) {
				cRateToPierce(r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 50
			}
			if (rp2 == 50) {
				cExtraAttack(r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 15
			}
			if (rp2 == 51) {
				cExtraShot(r1) += convert_var(cgodSpecialPowerPower(god_no), 0, 0, cPietyPoint(r1)) / 15
			}
			if (rp2 == 21 | rp2 == 45 | rp2 == 46 | rp2 == 47) {
				cbitmod 24, r1, 1
			}
			if (r1 == 0) {
				if (rp2 == 30) {
					gProtectsFromEtherwind = 1
				}
				if (rp2 == 31) {
					gProtectsFromBadWeather = 1
				}
			}
		} else {
			if (cgodSpecialPowerId(god_no) / 1000 == 2) {
				rp2 = cgodSpecialPowerId(god_no) \ 1000
				repeat 1
					if (rp2 == 22) {
						if (cbit(25, r1)) {
							break
						}
					}
					cbitmod rp2, r1, 1
				loop
			}
		}
	}
	if (godcheck(r1) == "danalin") {
		if (cInsanity(r1) < cPietyPoint(r1) / 500) {
			cInsanity(r1) = cPietyPoint(r1) / 500
		}
		if (sdata(16, r1) > 0) {
			sdata(16, r1) += limit(cInsanity(r1), 1, 18 + sdata(181, r1) / 5)
		}
		if (cInsanity(r1) >= 10) {
			gRevealsReligion = 1
		}
		if (cInsanity(r1) >= 30) {
			cbitmod 7, r1, 1
		}
	}
	if (godcheck(r1) == "fuuri") {
		if (cCursePower(r1) != 0) {
			sdata(2, r1) += cCursePower(r1) / 20
			sdata(3, r1) += cCursePower(r1) / 3
			sdata(10, r1) += cCursePower(r1) / 10
			sdata(11, r1) += cCursePower(r1) / 10
			sdata(12, r1) += cCursePower(r1) / 4
			sdata(13, r1) += cCursePower(r1) / 5
			sdata(14, r1) += cCursePower(r1) / 4
			sdata(15, r1) += cCursePower(r1) / 5
			sdata(16, r1) += cCursePower(r1) / 5
			sdata(17, r1) += cCursePower(r1) / 5
			sdata(18, r1) += cCursePower(r1) / 10
		}
	}
	return
*label_1086
	buff = " "
	if (godidt == "mani") {
		buff = lang("マニは機械仕掛けの神です。マニを信仰した者は、機械や罠に対する膨大な知識を得、またそれらを効果的に利用する術を知ります。<p><p>", "Mani is a clockwork god of machinery. Those faithful to Mani<br>receive immense knowledge of machines and learn a way to use them<br>effectively.<p>")
		buff += lang("　捧げ物: 死体 / 銃器 / 機械<p>", "Offering: Corpses/Guns/Machinery<p>")
		buff += lang("ボーナス: 器用 / 感覚 / 銃 / 治癒 / 探知 / 宝石細工 / 鍵開け / 大工<p>", "   Bonus: DEX/PER/Firearm/Healing/Detection/Jeweler/Lockpick/Carpentry<p>")
		if (cfg_NC_displayblesseddishes) {
			buff += lang("祝福料理: 器用 / 速度<p>", " Blessed: DEX/SPD<p>")
		} else {
			buff += "<p>"
		}
		buff += lang("特殊能力: マニの分解術(自動:罠からマテリアルを取り出す)<p>", " Ability: Mani's decomposition (Passive: Extracts materials<br>from traps.)<p>")
	}
	if (godidt == "lulwy") {
		buff = lang("ルルウィは風を司る女神です。ルルウィを信仰した者は、風の恩恵を受け素早く動くことが可能になります。<p><p>", "Lulwy is a goddess of wind. Those faithful to Lulwy receive<br>the blessing of wind and can move swiftly.<p>")
		buff += lang("　捧げ物: 死体 / 弓<p>", "Offering: Corpses/Bows<p>")
		buff += lang("ボーナス: 感覚 / 速度 / 弓 / クロスボウ / 隠密 / 魔道具<p>", "   Bonus: PER/SPD/Bow/Crossbow/Stealth/Magic Device<p>")
		if (cfg_NC_displayblesseddishes) {
			buff += lang("祝福料理: 感覚 / 速度<p>", " Blessed: PER/SPD<p>")
		} else {
			buff += "<p>"
		}
		buff += lang("特殊能力: ルルウィの憑依(スキル:瞬間的に高速になる)<p>", " Ability: Lulwy's trick (Boosts your speed for a short time.)<p>")
	}
	if (godidt == "itzpalt") {
		buff = lang("イツパロトルは元素を司る神です。イツパロトルを信仰した者は、魔力を大気から吸収し、元素に対する保護を受けることができます。<p><p>", "Itzpalt is a god of elements. Those faithful to Itzpalt are<br>protected from elemental damages and learn to absorb mana from<br>their surroundings.<p>")
		buff += lang("　捧げ物: 死体 / 杖<p>", "Offering: Corpses/Staves<p>")
		buff += lang("ボーナス: 魔力 / 瞑想 / 火炎耐性 / 冷気耐性 / 電撃耐性<p>", "   Bonus: MAG/Meditation/RES Fire/RES Cold/RES Lightning<p>")
		if (cfg_NC_displayblesseddishes) {
			buff += lang("祝福料理: 魔力 / マナ<p>", " Blessed: MAG/Mana<p>")
		} else {
			buff += "<p>"
		}
		buff += lang("特殊能力: マナの抽出(スキル:周囲の空気からマナを吸い出す)<p>　　　　  連続魔法(自動:矢魔法を連続して詠唱できる)<p>", " Ability: Absorb mana (Absorbs mana from the air.)<p>          Rapid magic (Passive: Cast arrow spells in a row.)")
	}
	if (godidt == "ehekatl") {
		buff = lang("エヘカトルは幸運の女神です。エヘカトルを信仰した者は、運を味方につけます。<p><p>", "Ehekatl is a goddess of luck. Those faithful to Ehekatl are<br>really lucky.<p><p>")
		buff += lang("　捧げ物: 死体 / 魚<p>", "Offering: Corpses/Fish<p>")
		buff += lang("ボーナス: 魅力 / 運 / 回避 / 魔力の限界 / 釣り/ 鍵開け<p>", "   Bonus: CHR/LUCK/Evasion/Magic Capacity/Fishing/Lockpick<p>")
		if (cfg_NC_displayblesseddishes) {
			buff += lang("祝福料理: 魔力 / マナ / 運<p>", " Blessed: MAG/Mana/Luck<p>")
		} else {
			buff += "<p>"
		}
		buff += lang("特殊能力: エヘカトル流魔術(自動:マナの消費がランダムになる)<p>", " Ability: Ehekatl school of magic (Passive: Randomizes casting mana<br>cost.)<p>")
	}
	if (godidt == "opatos") {
		buff = lang("オパートスは大地の神です。オパートスを信仰した者は、高い防御力と破壊力を身につけます。<p><p>", "Opatos is a god of earth. Those faithful to Opatos have massive<br>strength and defense.<p><p>")
		buff += lang("　捧げ物: 死体 / 鉱石<p>", "Offering: Corpses/Ores<p>")
		buff += lang("ボーナス: 筋力 / 耐久 / 盾 / 重量挙げ / 採掘 / 魔道具<p>", "   Bonus: STR/END/Shield/Weight Lifting/Mining/Magic Device<p>")
		if (cfg_NC_displayblesseddishes) {
			buff += lang("祝福料理: 耐久 / 生命力<p>", " Blessed: END/Life<p>")
		} else {
			buff += "<p>"
		}
		buff += lang("特殊能力: オパートスの甲殻(自動:受ける物理ダメージを減らす)<p>", " Ability: Opatos' shell (Passive: Reduce any physical damage you<br>receive.)<p>")
	}
	if (godidt == "jure") {
		buff = lang("ジュアは癒しの女神です。ジュアを信仰した者は、傷ついた身体を癒すことができます。<p><p>", "Jure is a god of healing. Those faithful to Jure can heal wounds.<p><p>")
		buff += lang("　捧げ物: 死体 / 鉱石<p>", "Offering: Corpses/Ores<p>")
		buff += lang("ボーナス: 意思 / 治癒 / 瞑想 / 解剖学 / 料理 / 魔道具 / 魔力の限界<p>", "   Bonus: WIL/Healing/Meditation/Anatomy/Cooking/Magic Device/Magic Capacity<p>")
		if (cfg_NC_displayblesseddishes) {
			buff += lang("祝福料理: 意思 / 生命力<p>", " Blessed: WIL/Life<p>")
		} else {
			buff += "<p>"
		}
		buff += lang("特殊能力: ジュアの祈り(スキル:失った体力を回復)<p>", " Ability: Prayer of Jure (Heal yourself.)<p>")
	}
	if (godidt == "kumiromi") {
		buff = lang("クミロミは収穫の神です。クミロミを信仰した者は、大地の恵みを収穫し、それを加工する術を知ります。<p><p>", "Kumiromi is a god of harvest. Those faithful to Kumiromi receive<br>the blessings of nature.<p><p>")
		buff += lang("　捧げ物: 死体 / 野菜 / 種<p>", "Offering: Corpses/Vegetables/Seeds<p>")
		buff += lang("ボーナス: 感覚 / 器用 / 習得 / 栽培 / 錬金術 / 裁縫 / 読書<p>", "   Bonus: PER/DEX/LER/Gardening/Alchemy/Tailoring/Literacy<p>")
		if (cfg_NC_displayblesseddishes) {
			buff += lang("祝福料理: 筋力 / 耐久 / 器用 / 感覚 / 習得 / 意思 / 魔力 / 魅力<p>", " Blessed: STR/END/DEX/PER/LER/WIL/MAG/CHR<p>")
		} else {
			buff += "<p>"
		}
		buff += lang("特殊能力: 生命の輪廻(自動：腐った作物から種を取り出す)<p>", " Ability: Kumiromi's recycle (Passive: Extracts seeds from rotten foods.)<p>")
	}
	if (findcgodno(godidt) != (-1)) {
		tg = stat
		buff = ""
		repeat 4
			if (jp) {
				hajime = instr(usergodtxt(tg), 0, "%txt[NC]description" + cnt + ",JP")
				if (hajime == -1) {
					hajime = instr(usergodtxt(tg), 0, "%txt[MMA]description" + cnt + ",JP")
				}
				if (hajime == -1) {
					hajime = instr(usergodtxt(tg), 0, "%txtdescription" + cnt + ",JP")
				}
				if (hajime == -1) {
					hajime = instr(usergodtxt(tg), 0, "%txtdescription" + cnt + ",EN")
				}
			} else {
				hajime = instr(usergodtxt(tg), 0, "%txt[NC]description" + cnt + ",EN")
				if (hajime == -1) {
					hajime = instr(usergodtxt(tg), 0, "%txt[MMA]description" + cnt + ",EN")
				}
				if (hajime == -1) {
					hajime = instr(usergodtxt(tg), 0, "%txtdescription" + cnt + ",EN")
				}
				if (hajime == -1) {
					hajime = instr(usergodtxt(tg), 0, "%txtdescription" + cnt + ",JP")
				}
			}
			s = strmid(usergodtxt(tg), hajime, instr(usergodtxt(tg), hajime + 1, "%"))
			notesel s
			notedel 0
			if (godidt == "fuuri") {
				if (cnt == 0) {
					s = lang("フウリは呪いと書物の女神です。フウリを信仰した者は呪われた装備を付けることで強化されます。", "Fuuri is a goddess of curse and tome. Those faithful to Fuuri can turn curse into their power.")
				}
				if (cnt == 3) {
					s = lang("特殊能力: 呪いの寵愛(効果：呪い装備を付けることで強化)", " Ability: Favor of Curse (Passive: Turn curse into their power.)")
				}
			}
			if (godidt == "mayumaka") {
				if (cnt == 3) {
					s = lang("特殊能力: 炯眼(効果：隠された情報を見ることができる)", " Ability: Mayumaka's Eyes (Passive: Reveal hidden information.)")
				}
			}
			if (godidt == "plamja") {
				if (cnt == 3) {
					s = lang("特殊能力: 燔祭(自動：焼失したアイテムからマテリアルを取り出す)", " Ability: Burnt offering (Passive: Extracts materials<br>from burnt items.)")
				}
			}
			buff += s
			if (cnt != 0) {
				buff += "<p>"
			} else {
				buff += "<p><p>"
			}
			if (cnt == 2) {
				if (cfg_NC_displayblesseddishes) {
					p = 0, 0, 0, 0, 0, 0, 0, 0
					repeat 8
						if (cgodFoodBonus(tg, cnt) == 0) {
							break
						}
						p(cnt) = cgodFoodBonus(tg, cnt)
					loop
					notesel s
					notedel 0
					repeat 8
						if (p(cnt) == 0) {
							if (cnt == 0) {
								s = lang("なし", "None")
							}
							break
						}
						if (cnt > 0) {
							s += " / "
						}
						if ((p(cnt) / 100) >= tailspact | (p(cnt) / 100) < 0) {
							s = lang("ありえないスキルIDが指定されています", "An impossible skill ID.")
							break
						} else {
							s += skillname(p(cnt) / 100)
						}
					loop
					buff += lang("祝福料理: ", " Blessed: ") + s + "<p>"
				} else {
					buff += "<p>"
				}
			}
		loop
	}
	return
*label_1087
	cs = 0
	page = 0
	pagemax = 0
	pagesize = 16
	cs_bk = -1
	key = ""
	objprm 0, ""
	keylog = ""
	listmax = 0
	chatesc = 2
	if (prayctrl == 1) {
		godidt = godcheck()
	} else {
		godidt = godno2godid(iParam1(ci))
		if (godidt == "eyth") {
			if (iParam3(ci) != 0) {
				godidt = cgodShortId(iParam2(ci))
			}
		}
		if (godcheck() != "eyth") {
			if (gettrait(0, 174) == 0) {
				if (godidt != "eyth") {
					s = lang(godname(godidt) + "に改宗する", "Convert to " + godname(godidt))
				} else {
					s = lang("信仰を捨てる", "Abandon God")
				}
				list(0, listmax) = 0
				listn(0, listmax) = s
				listmax++
			}
		} else {
			s = lang(godname(godidt) + "を信仰する", "Believe in " + godname(godidt))
			list(0, listmax) = 0
			listn(0, listmax) = s
			listmax++
		}
	}
	list(0, listmax) = 2
	listn(0, listmax) = lang("やめる", "Cancel")
	listmax++
	snd 62
	redraw 0
	gsel 4
	gmode 0
	pos 0, 0
	picload_ exedir + "\\graphic\\bg_altar.bmp", 1
	pos 0, 0
	gzoom windoww, windowh - inf_verh, 4, 0, 0, 600, 400, 1
	gsel 0
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
*label_1088
	redraw 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh - inf_verh
	gmode 2
	gosub *label_0625
	dx = 520
	dy = 340
	window2 (windoww - dx) / 2 + inf_screenx, winposy(dy), dx, dy, 4, 6
	wx = (windoww - dx) / 2 + inf_screenx
	wy = winposy(dy)
	font lang(cfg_font1, cfg_font2), 18 - en * 2, 1
	color 30, 30, 30
	pos wx + 20, wy + 20
	color 0, 0, 0
	s = godname(godidt)
	bmes lang("《 ", "< ") + godname(godidt) + lang(" 》", " >"), 255, 255, 255
	gmesx = wx + 23
	gmesy = wy + 60
	gmesw = dx - 60
	gmescol = 30, 30, 30
	gmestype = 1
	gosub *label_1086
	gmes buff
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat listmax
		p = cnt
		i = list(0, p)
		display_key wx + 50, wy + dy + cnt * 20 - listmax * 20 - 18, cnt
		s = listn(0, p)
		cs_list s, wx + 80, wy + dy + cnt * 20 - listmax * 20 - 18, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	rtval = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			rtval = list(0, pagesize * page + cnt)
			snd 40
			break
		}
	loop
	if (chatesc != (-1)) {
		if (key == key_cancel) {
			snd 40
			rtval = chatesc
		}
	}
	if (rtval != (-1)) {
		goto *label_1089
	}
	goto *label_1088
*label_1089
	if (rtval == 0) {
		redraw 0
		gmode 0
		pos 0, 0
		gcopy 4, 0, 0, windoww, windowh - inf_verh
		gmode 2
		gosub *label_0625
		redraw 1
		if (goddomaincheck(godidt, godcheck()) == 1) {
			believegod 0, godidt
			gosub *label_1090_01
		} else {
			if (godcheck() != "eyth") {
				mode = 9
				txtef 8
				txt -1, lang(godname(godcheck()) + "は激怒した。", godname(godcheck()) + " is enraged.")
				enemygod = godidt
				txtgod godcheck(), 1
				redraw 1
				efid = 622
				efp = 10000
				tc = 0
				gosub *label_1398
				snd 63
				mode = 0
				await 500
			}
			believegod 0, godidt
			gosub *label_1090
		}
		msg_halt
	}
	r1 = 0
	gosub *chara_refresh
	return
*label_1090
	clearsubfaith 0
	cPietyPoint(0) = 0
	cPrayingPoint(0) = 500
	ncgdata(205) = 0
	gGodRank = 0
	spact(623 - 600) = 0
	spact(624 - 600) = 0
	spact(625 - 600) = 0
	repeat 21
		ospact(100 + cnt) = 0
	loop
	ospact(810 - 661) = 0
	ospact(933 - 661) = 0
	ospact(sId_wofintimidation - 661) = 0
	ospact(sId_tprosperity - 661) = 0
	if (godcheck() == "eyth") {
		txtef 5
		txt -1, lang("あなたは今や無信仰者だ。", "You are an unbeliever now.")
	} else {
		animeid = 19
		animode = 100
		gosub *label_0630
		snd 51
		txtef 5
		txt -1, lang("あなたは今や" + godname(godcheck()) + "の信者だ！", "You become a follower of " + godname(godcheck()) + "!")
		ctalk 0, 1279, 0, 0
		if (stat == 0) {
			ctalk 0, 1278, 0, 0
		}
		gosub *label_SESTSetSpactWhenFollowGod
		enemygod = beforefaith
		txtgod godcheck(), 5
	}
	return
*label_1090_01
	setsubfaith 0, beforefaith, cPietyPoint(0) / 10 * 9
	setsubfaithflag 0, beforefaith, gdata(807)
	cPietyPoint(0) = getsubfaith(0, godcheck())
	cPrayingPoint(0) = 500
	gGodRank = getsubfaithflag(0, godcheck())
	spact(623 - 600) = 0
	spact(624 - 600) = 0
	spact(625 - 600) = 0
	repeat 21
		ospact(100 + cnt) = 0
	loop
	ospact(810 - 661) = 0
	ospact(933 - 661) = 0
	ospact(sId_wofintimidation - 661) = 0
	ospact(sId_tprosperity - 661) = 0
	if (godcheck() == "eyth") {
		txtef 5
		txt -1, lang("あなたは今や無信仰者だ。", "You are an unbeliever now.")
	} else {
		animeid = 19
		animode = 100
		gosub *label_0630
		snd 51
		txtef 5
		txt -1, lang("あなたは今や" + godname(godcheck()) + "の信者だ！", "You become a follower of " + godname(godcheck()) + "!")
		ctalk 0, 1279, 0, 0
		if ( stat == 0 ) {
			ctalk 0, 1278, 0, 0
		}
		gosub *label_SESTSetSpactWhenFollowGod
		enemygod = beforefaith
		txtgod godcheck(), 5
	}
	return

*label_SESTSetSpactWhenFollowGod
	if (godcheck() == "itzpalt") {
		spact(624 - 600) = 1
	} else {
		if (godcheck() == "jure") {
			spact(623 - 600) = 1
		} else {
			if (godcheck() == "lulwy") {
				spact(625 - 600) = 1
			} else {
				if (godcheck() == "dybony") {
					ospact(sId_wofintimidation - 661) = 1
				} else {
					if (getcgodno() != (-1)) {
						god_no = stat
						if (cgodSpecialPowerId(god_no) != 0) {
							if (cgodSpecialPowerId(god_no) / 1000 == 0) {
								ospact(781 - 661) = 1
							}
						}
						if (cgodSkillNameEn(god_no) != "") {
							ospact(810 - 661) = 1
						}
						gosub *label_1822
					}
				}
			}
		}
	}
	return

*label_1091
	if (godcheck() == "eyth") {
		txt -1, lang(name(0) + "は神を信仰していないが、試しに祈ってみた。", "You don't believe in God.")
		ctalk 0, 1270, 0, 0
		goto *label_1617
	}
	txtnew
	txt -1, lang("あなたの神に祈りを乞う？", "Really pray to your God?")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *label_1353
	if (rtval != 0) {
		gosub *label_0623
		goto *label_1623
	}
	txt -1, lang(godname(godcheck()) + "に祈った。", "You pray to " + godname(godcheck()) + ".")
	ctalk 0, 1270, 0, 0
	if (cPietyPoint(0) < 200 | cPrayingPoint(0) < 1000) {
		txt -1, lang(godname(godcheck()) + "はあなたに無関心だ。", godname(godcheck()) + " is indifferent to you.")
		txtgod godcheck(), 2409
		throwsstpevent "PrayFailed", 0, "", 0
		goto *label_1617
	}
	throwsstpevent "Pray", 0, "", 0
	animeid = 19
	animode = 100
	gosub *label_0630
	snd 120
	efid = 1120
	efp = 100
	tc = 0
	gosub *label_1398
	efid = 451
	efp = 200
	tc = 0
	gosub *label_1398
	cPrayingPoint(0) -= 1000
	if (cPrayingPoint(0) >= 2000) {
		cPrayingPoint(0) = 1000
	}
	cPietyPoint(0) = cPietyPoint(0) * 85 / 100
	item_find 60002, 0
	if (stat != (-1)) {
		ci = stat
		godidt = godno2godid(iParam1(ci))
		if (godidt == "eyth" & iParam3(ci) != 0) {
			godidt = cgodShortId(iParam2(ci))
		}
		if (godidt != "eyth") {
			if (godidt == godcheck()) {
				s = "", ""
				repeat 5480 - 5080, 5080
					if (iNumber(cnt) == 0) {
						continue
					}
					if (iX(cnt) != cX(0) | iY(cnt) != cY(0)) {
						continue
					}
					f = 0
					if (refitem(iId(cnt), 5, cnt) == 57000) {
						s = lang("食べ物", "food")
						f = 1
					}
					if (iId(cnt) == 431) {
						s(1) = lang("巻物", "scroll")
						f = 1
					}
					if (iId(cnt) == iId_milk) {
						if (iParam2(cnt)) {
							s = lang("食べ物", "food")
						} else {
							s(1) = lang("乳", "milk")
						}
						f = 1
					}
					if (f) {
						iCurseState(cnt) = 1
						ibitmod 8, cnt, 1
						iParam4(cnt) = cGod(0)
						if (iParam4(cnt) == 0) {
							iParam4(cnt) = blesscgod()
						}
					}
				loop
				repeat 2
					if (s(cnt) != "") {
						snd 64
						txtef 2
						txt -1, lang(s(cnt) + "は神の祝福を受けた。", "The " + s(cnt) + " is blessed by a god.")
					}
				loop
			}
		}
	}
	if (gGodRank \ 2 == 1) {
		txtgod godcheck(), 6
		if (gGodRank == 1) {
			f = 0
			p = 0
			repeat 16 - 1, 1
				if (cState(cnt) != 0) {
					if (custom_isGodServant(cnt)) {
						p++
					}
				}
			loop
			if (p + ogGodServantsCount >= 2) {
				if (ogdata(493) != 2) {
					f = 1
					txt -1, lang("神の使徒は2匹までしか仲間にできない。", "No more than 2 God's servants are allowed in your party.")
				}
			}
			if (f == 0) {
				if (get_freeally() == 0 | gettrait(0, 184) < 0) {
					f = 1
					txt -1, lang("仲間が一杯で、神からの贈り物を受け取ることができなかった。", "Your party is full. The gift is reserved.")
				}
			}
			if (f) {
				txt -1, lang("この贈り物を諦める？", "Do you want to decline this gift?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval == 0) {
					gGodRank++
				}
				goto *label_1617
			}
			flt
			dbid = 0
			txtef 4
			if (godcheck() == "mani") {
				dbid = 262
				txt -1, lang("このアンドロイドちゃんは生まれつきブースト以外の能力が使えません。カードを使ってAIを変更してあげてください。", "This android only uses Boost. Please use a card to change its AI.")
			}
			if (godcheck() == "lulwy") {
				dbid = 263
				txt -1, lang("この黒天使はブーストした時に恐るべき力を発揮するようだ。", "This black angel shows enormous strength when boosting.")
			}
			if (godcheck() == "itzpalt") {
				dbid = 264
				txt -1, lang("この追放者は連続魔法を使えるようだ。", "This exile can cast several spells in a row.")
			}
			if (godcheck() == "ehekatl") {
				dbid = 260
				txt -1, lang("この猫に舐められた武具は、エヘカトルの祝福を授かるようだ。祝福を受けた武具にはエンチャントが一つ付与される。", "Weapons and armor licked by this cat receive a blessing of Ehekatl which adds an extra enchantment.")
			}
			if (godcheck() == "opatos") {
				dbid = 265
				txt -1, lang("この騎士はある程度重いものをもたせても文句をいわないようだ。", "This knight can hold really heavy stuff for you.")
			}
			if (godcheck() == "jure") {
				dbid = 266
				txt -1, lang("この防衛者は致死ダメージを受けた仲間をレイハンドで回復できるようだ。レイハンドは眠るたびに再使用可能になる。", "This defender can use Lay on hand to heal a mortally wounded ally. The ability becomes re-useable after sleeping.")
			}
			if (godcheck() == "kumiromi") {
				dbid = 261
				txt -1, lang("この妖精は食後に種を吐き出すようだ。", "This fairy generates a seed after eating.")
			}
			if (getcgodno() != (-1)) {
				god_no = stat
				initunid = findunid(cgodServantId(god_no))
				dbid = 343
				txtcgod god_no, 17
			}
			novoidlv = 1
			characreate 56, dbid, -3, 0
			rc = 56
			gosub *label_1530
		}
		if (gGodRank == 3) {
			flt
			dbid = 0
			if (godcheck() == "lulwy") {
				dbid = 680
			}
			if (godcheck() == "jure") {
				dbid = 681
			}
			if (godcheck() == "kumiromi") {
				dbid = 682
			}
			if (godcheck() == "mani") {
				dbid = 683
			}
			if (getcgodno() != (-1)) {
				inititemid = finditemid(cgodGiftId1(stat))
				dbid = 743
			}
			if (dbid != 0) {
				if (dbid != 743) {
					if (itemmemory(1, dbid)) {
						dbid = 559
					}
				}
				itemcreate -1, dbid, cX(0), cY(0), 0
			} else {
				nostack = 1
				itemcreate -1, 672, cX(0), cY(0), 0
				if (godcheck() == "itzpalt") {
					iParam1(ci) = 165
				}
				if (godcheck() == "ehekatl") {
					iParam1(ci) = 163
				}
				if (godcheck() == "opatos") {
					iParam1(ci) = 164
				}
			}
			if (godcheck() == "jure") {
				flt
				nostack = 1
				itemcreate -1, 672, cX(0), cY(0), 0
				iParam1(ci) = 166
			}
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		}
		if (gGodRank == 5) {
			flt
			dbid = 0
			if (godcheck() == "mani") {
				dbid = 674
			}
			if (godcheck() == "lulwy") {
				dbid = 673
			}
			if (godcheck() == "itzpalt") {
				dbid = 676
			}
			if (godcheck() == "ehekatl") {
				dbid = 678
			}
			if (godcheck() == "opatos") {
				dbid = 679
			}
			if (godcheck() == "jure") {
				dbid = 677
			}
			if (godcheck() == "kumiromi") {
				dbid = 675
			}
			if (itemmemory(1, dbid)) {
				dbid = 621
			}
			if (getcgodno() != (-1)) {
				inititemid = finditemid(cgodGiftId2(stat))
				dbid = 743
			}
			itemcreate -1, dbid, cX(0), cY(0), 0
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		}
		gGodRank++
	} else {
		txtgod godcheck(), 2408
　}
	if (cdata(22, 0) < 1000) {
		cell_itemoncell cdata(1, 0), cdata(2, 0)
		if ( stat == 0 ) {
			itemcreate -1, 787, cdata(1, 0), cdata(2, 0), 3
			inv(17, ci) = 1
			ibitmod 8, ci, 1
			inv(28, ci) = cdata(61, 0)
			if (inv(28, ci) == 0) {
				inv(28, ci) = blesscgod()
			}
			txtgod godcheck(), 2428
			txt_select -1, lang("何かが足元に転がってきた。", "Something is put on the ground."), "", "", "", "", "", "", "", ""
		}
	}
	goto *label_1617
*label_1092
	if (godcheck() == "eyth") {
		txt -1, lang("あなたは神を信仰していないが、試しに捧げてみた。", "You don't believe in God.")
		ctalk 0, 1271, 0, 0
		throwsstpevent "PrayEyth", 0, "", 0
		goto *label_1617
	}
	godidt = godno2godid(iParam1(ti))
	if (godidt == "eyth" & iParam3(ti) != 0) {
		godidt = cgodShortId(iParam2(ti))
	}
	if (goddomaincheck(godidt, godcheck()) == 1) {
		if (cfg_offernumber & iNumber(ci) > 1) {
			txt -1, lang(itemname(ci, 1) + "をいくつ捧げる？ (1〜" + iNumber(ci) + ") ", "How many? (1 to " + iNumber(ci) + ")")
			display_msg screenmsgy, 2
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
			inputlog = "" + 1
			gosub *label_1349
			in = int(inputlog)
			if (in > iNumber(ci)) {
				in = iNumber(ci)
			}
			if (in == 0 | rtval == (-1)) {
				goto *label_1617
			}
			rowact_item ci
		} else {
			in = 1
			rowact_item ci
			item_separate ci
		}
		ctalk 0, 1271, 0, 0
		if (stat == 0) {
			txt -1, lang("あなたは" + itemname(ci, in) + "を" + godname(godidt) + "に捧げ、その名を唱えた。", "You put " + itemname(ci, in) + " on the altar and mutter the name of " + godname(godcheck()) + ".")
		}
		snd 121
		animeid = 7
		gosub *label_0630
		tc = animetcbk
		if (iId(ci) == 204) {
			i = limit(iWeight(ci) / 400, 1, 10)
			if (iParam3(ci) < 0) {
				i = 1
			}
		} else {
			i = 10
		}
		if (i >= 10) {
			i = i * (2000 + limitmax(sdata(181, 0), 1000000)) / 2000
			txtef 2
			txt -1, lang(itemname(ci, in) + "はまばゆく輝いて消えた。", itemname(ci, in) + " shine" + _s2(inv(0, ci)) + " all around and disappear" + _s2(inv(0, ci)) + ".")
			txtgod godidt, 4
		} else {
			i = i * (2000 + limitmax(sdata(181, 0), 1000000)) / 2000
			txt -1, lang(itemname(ci, in) + "は一瞬輝いて消えた。", itemname(ci, in) + " shine" + _s2(iNumber(ci)) + " for a moment and disappear" + _s2(iNumber(ci)) + ".")
		}
		throwsstpevent "Offer", 0, itemname(ci), 0
		nc_intb_001 = getsubfaith(0, godidt)
		if (ncgdata(205) < (10 + limitmax(nc_intb_001, 250000))) {
			txtef 2
			txt -1, lang("あなたは" + godname(godidt) + "の祝福を受けた。", godname(godidt) + " bless You.")
			ncgdata(205) = int(limitf(ncgdata(205) + double(i) * 14 * in, 1, 10 + limitmax(nc_intb_001, 250000)))
			if (ncgdata(205) >= (10 + limitmax(nc_intb_001, 250000))) {
				txt -1, lang("" + godname(godidt) + "の祝福をこれ以上受けることができない。", "You cannot receive any more blessings from " + godname(godidt) + ".")
			}
		} else {
			txt -1, lang("" + godname(godidt) + "の祝福をこれ以上受けることができない。", "You cannot receive any more blessings from" + godname(godidt) + ".")
		}
		removeitem ci, in
		goto *label_1617
	}
	if (cfg_offernumber & godidt == godcheck() & iNumber(ci) > 1) {
		txt -1, lang(itemname(ci, 1) + "をいくつ捧げる？ (1〜" + iNumber(ci) + ") ", "How many? (1 to " + iNumber(ci) + ")")
		display_msg screenmsgy, 2
		val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
		inputlog = "" + 1
		gosub *label_1349
		in = int(inputlog)
		if (in > iNumber(ci)) {
			in = iNumber(ci)
		}
		if (in == 0 | rtval == (-1)) {
			goto *label_1617
		}
		rowact_item ci
	} else {
		in = 1
		rowact_item ci
		item_separate ci
	}
	ctalk 0, 1271, 0, 0
	if (stat == 0) {
		txt -1, lang("あなたは" + itemname(ci, in) + "を" + godname(godcheck()) + "に捧げ、その名を唱えた。", "You put " + itemname(ci, in) + " on the altar and mutter the name of " + godname(godcheck()) + ".")
	}
	snd 121
	animeid = 7
	gosub *label_0630
	throwsstpevent "Offer", 0, itemname(ci), 0
	if (iId(ci) == 204) {
		i = limit(iWeight(ci) / 200, 1, 50)
		if (iParam3(ci) < 0) {
			i = 1
		}
	} else {
		i = 25
	}
	i = i * (2000 + limitmax(sdata(181, 0), 1000000)) / 2000
	if (godidt != godcheck()) {
		f = 0
		if (areaId(gCurrentMap) == 20 & gettrait(0, 174) == 0) {
			txt -1, lang("ここでは許されない。", "You can't do this here.")
			goto *label_1617
		}
		if (godidt == "eyth") {
			f = 1
			txt -1, lang("異世界で、" + godname(godcheck()) + "が空白の祭壇の権利を主張した。", godname(godcheck()) + " claims the empty altar.")
		} else {
			txt -1, lang("異様な霧が現れ、" + godname(godcheck()) + "と" + godname(godidt) + "の幻影がせめぎあった。", "Strange fogs surround all over the place. You see shadows of " + godname(godcheck()) + " and " + godname(godidt) + " make a fierce dance.")
			if (rnd(17) <= i) {
				f = 1
			} else {
				f = 0
			}
		}
		if (f == 1) {
			p(89) = i * 5
			if (iId(ti) == 743) {
				p(89) /= 10
			}
			modpiety p(89)
			cPrayingPoint(0) += i * 30
			if (cPrayingPoint(0) > 2000) {
				cPrayingPoint(0) = 2000
			}
			animeid = 19
			animode = 100
			gosub *label_0630
			snd 120
			if (godidt != "eyth") {
				txt -1, lang("あなたの神の幻影は、次第に色濃くなった。", "The shadow of your god slowly gets bolder.")
			}
			txtef 5
			txt -1, lang(godname(godcheck()) + "は" + itemname(ti) + "を支配した。", godname(godcheck()) + " takes over the altar.")
			enemygod = godidt
			txtgod godcheck(), 2
			iParam1(ti) = cGod(0)
			if (iParam1(ti) == 0) {
				if (getcgodno() != (-1)) {
					iParam2(ti) = stat
					iParam3(ti) = creategoduid(stat)
				}
			} else {
				iParam2(ti) = 0
				iParam3(ti) = 0
			}
		} else {
			txt -1, lang(godname(godidt) + "は祭壇を守りきった。", godname(godidt) + " keeps the altar.")
			enemygod = godcheck()
			txtgod godidt, 3
			gosub *label_1093
		}
		if (oabit(10, gCurrentMap)) {
			evadd 109, cc, 1
		}
	} else {
		txtef 2
		repeat 1
			if (i >= 15) {
				txt -1, lang(itemname(ci, in) + "はまばゆく輝いて消えた。", itemname(ci, in) + " shine" + _s2(iNumber(ci)) + " all around and disappear" + _s2(iNumber(ci)) + ".")
				faithitem = inv(3, ci)
				txtgod godcheck(), 4
				break
			}
			if (i >= 10) {
				txt -1, lang(itemname(ci, in) + "は輝いて消え、三つ葉のクローバーがふってきた。", itemname(ci, in) + " shine" + _s2(iNumber(ci)) + " for a moment and disappear" + _s2(iNumber(ci)) + ". A three-leaved falls from the altar.")
				faithitem = inv(3, ci)
				txtgod godcheck(), 2412
				break
			}
			if (i >= 5) {
				txt -1, lang(itemname(ci, in) + "は一瞬輝いて消えた。", itemname(ci, in) + " shine" + _s2(iNumber(ci)) + " for a moment and disappear" + _s2(iNumber(ci)) + ".")
				faithitem = inv(3, ci)
				txtgod godcheck(), 2411
				break
			}
			if (i >= 1) {
				txt -1, lang(itemname(ci, in) + "は消えた。", itemname(ci, in) + " disappear" + _s2(iNumber(ci)) + ".")
				faithitem = inv(3, ci)
				txtgod godcheck(), 2410
				break
			}
		loop
		if (trophycheck(3) == 2) {
			modpiety int(limitf(double(i) * in * 2, 1, 2147483647))
			cPrayingPoint(0) += int(limitf(double(i) * 14 * in, 1, 2147483647))
			if (cPrayingPoint(0) < 0 | cPrayingPoint(0) > 2000) {
				cPrayingPoint(0) = 2000
			}
		} else {
			modpiety int(limitf(double(i) * in, 1, 2147483647))
			cPrayingPoint(0) += int(limitf(double(i) * 7 * in, 1, 2147483647))
			if (cPrayingPoint(0) < 0 | cPrayingPoint(0) > 2000) {
				cPrayingPoint(0) = 2000
			}
		}
	}
	removeitem ci, in
	goto *label_1617
*label_1093
	efid = 1114
	efp = 500
	tc = 0
	gosub *label_1398
	if (rnd(2)) {
		efid = 622
		efp = 250
		tc = 0
		gosub *label_1398
		snd 63
	}
	if (rnd(2)) {
		efid = 1106
		efp = 100
		tc = 0
		gosub *label_1398
	}
	return
*label_1094
	oomSEST_log "Random event"
	id = 0, 0
	if (gspd < 10) {
		return 0
	}
	if (dbg_skipevent) {
		return
	}
	if (mode == 12) {
		return
	}
	if (mode == 9) {
		if (godcheck() != "eyth") {
			if (rnd(12) == 0) {
				id = 18
			}
		}
		if (rnd(80) == 0) {
			id = 4, 120
		}
		if (rnd(20) == 0) {
			id = 3
		}
		if (rnd(25) == 0) {
			id = 2
		}
		if (rnd(100) == 0) {
			id = 5, 65
		}
		if (rnd(20) == 0) {
			id = 6
		}
		if (rnd(20) == 0) {
			id = 7
		}
		if (rnd(250) == 0) {
			if (inv_getfreeid(0) != (-1)) {
				id = 19
			}
		}
		// Ehe-sama~~
		if (rnd(10000) <= 0 + (godcheck() == "ehekatl") * limit(cPietyPoint(0) / 40000 - 1, 1, 4)) {
			if (inv_getfreeid(0) != (-1)) {
				id = 21
			}
		}
		if (rnd(70) == 0) {
			id = 8, 40
		}
		if (rnd(200) == 0) {
			id = 20
		}
		if (rnd(50) == 0) {
			id = 23
		}
		if (rnd(300) == 0) {
			id = 24
		}
		if (rnd(90) == 0) {
			id = 22, 70
		}
		goto *label_1095
	}
	if (mapType != 1) {
		if (cContinuousActionId(0) != 0) {
			return
		}
	}
	if (mapType == 5) {
		return
	}
	if (gCurrentMap == 35) {
		return
	}
	if (rnd(30) == 0) {
		id = 17
	}
	if (rnd(25) == 0) {
		id = 16
	}
	if (rnd(25) == 0) {
		id = 12
	}
	if (rnd(50) == 0) {
		id = 9
	}
	if (rnd(80) == 0) {
		id = 14
	}
	if (rnd(50) == 0) {
		id = 8, 40
	}
	if (rnd(80) == 0) {
		id = 13, 45
	}
	if (mapType == 3) {
		if (rnd(25) == 0) {
			id = 15, 80
		}
		goto *label_1095
	}
	if (mapType == 1) {
		if (rnd(40)) {
			return 0
		}
		goto *label_1095
	}
	if (rnd(25) == 0) {
		id = 10
	}
	if (rnd(25) == 0) {
		id = 11
	}
*label_1095
	oomSEST_log "random_eventProc:" + id
	if (id == 0) {
		return 0
	}
	cc = 0
	tc = 0
	listmax = 0
	if (id(1) != 0) {
		if (rnd(sdata(19, 0) + 1) > id(1)) {
			id = 1
		}
		if (mode == 9) {
			if (cContinuousActionItem(0) != (-1)) {
				if (iNumber(cContinuousActionItem(0)) != 0 & iId(cContinuousActionItem(0)) == iId_happyBed) {
					if (rnd(sdata(19, 0) + 1) > id(1)) {
						id = 1
					}
				}
			}
		}
	}
	_switch_val = id
	if (_switch_val == 15 | _switch_sw) {
		_switch_sw = 0
		repeat 20
			p = rnd(gCrowdDensity + 1) + 57
			if (p >= 245) {
				continue cnt
			}
			if (cState(p) == 1) {
				txt -1, lang(name(p) + "「ぎゃぁーー！」", name(p) + " screams, " + cnvtalk("Ahhhhhhh!"))
				if (cQuality(p) < 6) {
					cHp(p) = -1
				}
				dmghp p, 99999, -11
				break
			}
		loop
		s = lang("殺人鬼", "Murderer")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_murderer1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_murderer1"
			p++
		}
		exist exedir + "user\\graphic\\bg_murderer2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_murderer2"
			p++
		}
		exist exedir + "user\\graphic\\bg_murderer3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_murderer3"
			p++
		}
		exist exedir + "user\\graphic\\bg_murderer4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_murderer4"
			p++
		}
		exist exedir + "user\\graphic\\bg_murderer5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_murderer5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re9"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("街のどこかで悲鳴があがった。あなたはガードが慌しく走っていくのを目撃した。「人殺し、人殺しだ！！」", "Suddenly, a painful shriek rises from somewhere in the town. You see several guards hastily run by.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("なむ…", "Sorry for you.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 14 | _switch_sw) {
		_switch_sw = 0
		s = lang("謎のご馳走", "Strange Feast")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_feast1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_feast1"
			p++
		}
		exist exedir + "user\\graphic\\bg_feast2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_feast2"
			p++
		}
		exist exedir + "user\\graphic\\bg_feast3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_feast3"
			p++
		}
		exist exedir + "user\\graphic\\bg_feast4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_feast4"
			p++
		}
		exist exedir + "user\\graphic\\bg_feast5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_feast5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re10"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("あなたは目の前にご馳走をみつけた。", "You come across a strange feast.")
		if (cfg_randomeventreplace) {
			list(0, listmax) = 2
			listn(0, listmax) = lang("立ち去る", "(Leave)")
			listmax++
			list(0, listmax) = 1
			listn(0, listmax) = lang("食べる", "(Eat)")
			listmax++
		} else {
			list(0, listmax) = 1
			listn(0, listmax) = lang("食べる", "(Eat)")
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = lang("立ち去る", "(Leave)")
			listmax++
		}
		gosub *label_1097
		if (rtval == 1) {
			if (gettrait(0, 191) == 0) {
				cNutrition(0) = 15000
				txt -1, lang("なかなか美味しかった。", "It was tasty."), lang("悪くない。", "Not bad at all."), lang("あなたは舌鼓をうった。", "You smack your lips.")
				gosub *label_1384
				chara_anorexia 0
			} else {
				txt -1, lang("しかし、効果はなかった。", "But it produces no effect.")
			}
		}
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 13 | _switch_sw) {
		_switch_sw = 0
		s = lang("ご馳走の匂い", "Smell of Food")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_smell1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_smell1"
			p++
		}
		exist exedir + "user\\graphic\\bg_smell2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_smell2"
			p++
		}
		exist exedir + "user\\graphic\\bg_smell3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_smell3"
			p++
		}
		exist exedir + "user\\graphic\\bg_smell4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_smell4"
			p++
		}
		exist exedir + "user\\graphic\\bg_smell5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_smell5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re10"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("どこからともなく漂うご馳走の匂いで、あなたの胃は不満を叫び始めた。", "A sweet smell of food floats from nowhere. Your stomach growls but you can't find out where it comes from.")
		cNutrition(0) -= 5000
		list(0, listmax) = 1
		listn(0, listmax) = lang("腹減った…", "I'm hungry now!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 1 | _switch_sw) {
		_switch_sw = 0
		s = lang("不運の回避", "Avoiding Misfortune")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_avoiding1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_avoiding1"
			p++
		}
		exist exedir + "user\\graphic\\bg_avoiding2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_avoiding2"
			p++
		}
		exist exedir + "user\\graphic\\bg_avoiding3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_avoiding3"
			p++
		}
		exist exedir + "user\\graphic\\bg_avoiding4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_avoiding4"
			p++
		}
		exist exedir + "user\\graphic\\bg_avoiding5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_avoiding5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re8"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("あなたは一瞬嫌な予感がしたが、それはやがて消えた。", "You sense a bad feeling for a moment but it fades away quickly.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("よし", "Good.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 24 | _switch_sw) {
		_switch_sw = 0
		efid = 1113
		tc = 0
		gosub *label_1398
		s = lang("才能の開花", "Your Potential")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_potential1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_potential1"
			p++
		}
		exist exedir + "user\\graphic\\bg_potential2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_potential2"
			p++
		}
		exist exedir + "user\\graphic\\bg_potential3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_potential3"
			p++
		}
		exist exedir + "user\\graphic\\bg_potential4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_potential4"
			p++
		}
		exist exedir + "user\\graphic\\bg_potential5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_potential5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re4"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("突然あなたの才能は開花した！", "Suddenly you develop your gift!")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ワァオー", "Woohoo!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 18 | _switch_sw) {
		_switch_sw = 0
		if (trophycheck(4) == 2) {
			skillexp2 181, 0, 2000, 6, 2000
		} else {
			skillexp2 181, 0, 1000, 6, 1000
		}
		txtgod godcheck(), 2403
		s = lang("信仰の深まり", "Gaining Faith")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_faith1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_faith1"
			p++
		}
		exist exedir + "user\\graphic\\bg_faith2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_faith2"
			p++
		}
		exist exedir + "user\\graphic\\bg_faith3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_faith3"
			p++
		}
		exist exedir + "user\\graphic\\bg_faith4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_faith4"
			p++
		}
		exist exedir + "user\\graphic\\bg_faith5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_faith5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re12"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("夢の中で、あなたは偉大なる者の穏やかな威光に触れた。", "In your dream, a saint comes out and blesses you.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("神よ", "Great.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 12 | _switch_sw) {
		_switch_sw = 0
		s = lang("マテリアルの発見", "Small Luck")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_material1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_material1"
			p++
		}
		exist exedir + "user\\graphic\\bg_material2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_material2"
			p++
		}
		exist exedir + "user\\graphic\\bg_material3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_material3"
			p++
		}
		exist exedir + "user\\graphic\\bg_material4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_material4"
			p++
		}
		exist exedir + "user\\graphic\\bg_material5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_material5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re3"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("石ころにつまずいて転んだ拍子に、あなたは幾つかのマテリアルを見つけた。", "You stumble over a stone and find some materials on the ground. ")
		efid = 1117
		efp = 100
		tc = 0
		oom_material = 1
		gosub *label_1398
		list(0, listmax) = 1
		listn(0, listmax) = lang("よし", "Nice.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 23 | _switch_sw) {
		_switch_sw = 0
		efid = 1117
		efp = 200
		tc = 0
		gosub *label_1398
		s = lang("夢の中の収穫", "Dream Harvest")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_harvest1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_harvest1"
			p++
		}
		exist exedir + "user\\graphic\\bg_harvest2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_harvest2"
			p++
		}
		exist exedir + "user\\graphic\\bg_harvest3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_harvest3"
			p++
		}
		exist exedir + "user\\graphic\\bg_harvest4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_harvest4"
			p++
		}
		exist exedir + "user\\graphic\\bg_harvest5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_harvest5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re3"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("夢の中で、あなたはのんきにマテリアルを採取していた", "In your dream, you harvest materials peacefully.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("るん♪", "Sweet.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 10 | _switch_sw) {
		_switch_sw = 0
		s = lang("野営跡の発見", "Camping Site")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_camping1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_camping1"
			p++
		}
		exist exedir + "user\\graphic\\bg_camping2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_camping2"
			p++
		}
		exist exedir + "user\\graphic\\bg_camping3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_camping3"
			p++
		}
		exist exedir + "user\\graphic\\bg_camping4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_camping4"
			p++
		}
		exist exedir + "user\\graphic\\bg_camping5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_camping5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re3"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("あなたは何者かが野営した跡を見つけた。辺りには食べ残しやがらくたが散らばっている。もしかしたら、何か役に立つものがあるかもしれない。", "You discover a camping site someone left behind. Chunks of leftovers and junks remain here. You may possibly find some useful items.")
		if (cfg_randomeventreplace) {
			list(0, listmax) = 2
			listn(0, listmax) = lang("立ち去る", "(Leave)")
			listmax++
			list(0, listmax) = 1
			listn(0, listmax) = lang("調べる", "(Search)")
			listmax++
		} else {
			list(0, listmax) = 1
			listn(0, listmax) = lang("調べる", "(Search)")
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = lang("立ち去る", "(Leave)")
			listmax++
		}
		gosub *label_1097
		if (rtval == 1) {
			repeat 1 + rnd(4)
				flt
				flttypemajor = fsetremain(rnd(length(fsetremain)))
				itemcreate -1, 0, cX(0), cY(0), 0
			loop
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		}
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 4 | _switch_sw) {
		_switch_sw = 0
		snd 116
		efid = 1118
		efp = 100
		tc = 0
		gosub *label_1398
		s = lang("不気味な夢", "Creepy Dream")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_creepy1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_creepy1"
			p++
		}
		exist exedir + "user\\graphic\\bg_creepy2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_creepy2"
			p++
		}
		exist exedir + "user\\graphic\\bg_creepy3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_creepy3"
			p++
		}
		exist exedir + "user\\graphic\\bg_creepy4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_creepy4"
			p++
		}
		exist exedir + "user\\graphic\\bg_creepy5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_creepy5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re5"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("あなたは不気味な夢をみた。陰気な幾つもの瞳があなたを凝視し、どこからともなく笑い声がこだました。「ケラケラケラ…ミツケタヨ…ケラケラ」あなたが二度寝返りをうった後、その夢は終わった。", "In your dreams, several pairs of gloomy eyes stare at you and laughter seemingly from nowhere echoes around you.  \"Keh-la keh-la keh-la I found you...I found you.. keh-la keh-la keh-la\" After tossing around a couple times, the dream is gone.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("おかしな夢だ", "Strange...")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 22 | _switch_sw) {
		_switch_sw = 0
		snd 116
		efid = 454
		efp = 100
		tc = 0
		gosub *label_1398
		s = lang("怪物の夢", "Monster Dream")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_monster1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_monster1"
			p++
		}
		exist exedir + "user\\graphic\\bg_monster2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_monster2"
			p++
		}
		exist exedir + "user\\graphic\\bg_monster3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_monster3"
			p++
		}
		exist exedir + "user\\graphic\\bg_monster4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_monster4"
			p++
		}
		exist exedir + "user\\graphic\\bg_monster5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_monster5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re2"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("あなたは怪物と戦っていた。醜い化け物に斬りかかろうとした時、怪物は悲鳴をあげた。「オレハオマエダ！オマエハオレダ！」あなたは自分の呻き声に起こされた。", "You are fighting an ugly monster. You are about to thrust a dagger into the neck of the monster. And the monster screams. \"You are me! I am you!\" You are awakened by your own low moan.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ううぅん…", "Urrgh..hh..")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 19 | _switch_sw) {
		_switch_sw = 0
		flt
		itemcreate 0, 621, -1, -1, 0
		txt -1, lang(itemname(ci, 1) + "をバックパックに入れた。", "You put " + itemname(ci, 1) + " in your backpack.")
		s = lang("宝を埋める夢", "Treasure of Dream")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_treasure1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_treasure1"
			p++
		}
		exist exedir + "user\\graphic\\bg_treasure2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_treasure2"
			p++
		}
		exist exedir + "user\\graphic\\bg_treasure3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_treasure3"
			p++
		}
		exist exedir + "user\\graphic\\bg_treasure4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_treasure4"
			p++
		}
		exist exedir + "user\\graphic\\bg_treasure5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_treasure5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re15"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("あなたは夢の中で宝を埋めた。あなたはすぐに飛び起き、その場所を紙に書き留めた", "You buried treasure in your dream. You quickly get up and write down the location.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ワァオー", "Woohoo!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 20 | _switch_sw) {
		_switch_sw = 0
		addbuff tc, 19, 777, 1500
		s = lang("幸運の日", "Lucky Day")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_lucky1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_lucky1"
			p++
		}
		exist exedir + "user\\graphic\\bg_lucky2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_lucky2"
			p++
		}
		exist exedir + "user\\graphic\\bg_lucky3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_lucky3"
			p++
		}
		exist exedir + "user\\graphic\\bg_lucky4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_lucky4"
			p++
		}
		exist exedir + "user\\graphic\\bg_lucky5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_lucky5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re12"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("うみみゃぁ！", "Mewmewmew!")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ワァオー", "Woohoo!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 21 | _switch_sw) {
		_switch_sw = 0
		flt
		itemcreate 0, 721, -1, -1, 0
		txt -1, lang(itemname(ci, 1) + "をバックパックに入れた。", "You put " + itemname(ci, 1) + " in your backpack.")
		s = lang("運命の気まぐれ", "Quirk of Fate")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_quirk1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_quirk1"
			p++
		}
		exist exedir + "user\\graphic\\bg_quirk2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_quirk2"
			p++
		}
		exist exedir + "user\\graphic\\bg_quirk3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_quirk3"
			p++
		}
		exist exedir + "user\\graphic\\bg_quirk4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_quirk4"
			p++
		}
		exist exedir + "user\\graphic\\bg_quirk5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_quirk5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re15"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("うみみゃっ、見つけたね！", "Mewmew? You've found me!")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ワァオー", "Woohoo!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 5 | _switch_sw) {
		_switch_sw = 0
		if (gettrait(0, 42)) {
			txt -1, lang("あなたは祈祷を捧げ呪いのつぶやきを無効にした。", "Your prayer nullifies the curse.")
		} else {
			if (rnd(2) & ogdata(441) == 2) {
				txt -1, lang("「破ぁ！！」あなたは気合いを込めて呪いのつぶやきを吹き飛ばした。", "\"HA!!\" You yelled and nullified the curse by fight.")
			} else {
				f = 0
				tc = 0
				repeat 30, 100
					if (cdata(cnt, tc) \ 10000 == 0) {
						continue
					} else {
						f = 1
					}
				loop
				if (f) {
					efid = 1114
					efp = 200
					gosub *label_1398
				} else {
					if (evid() == (-1)) {
						evadd 26
					}
				}
			}
		}
		s = lang("呪いのつぶやき", "Cursed Whispering")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_cursed1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_cursed1"
			p++
		}
		exist exedir + "user\\graphic\\bg_cursed2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_cursed2"
			p++
		}
		exist exedir + "user\\graphic\\bg_cursed3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_cursed3"
			p++
		}
		exist exedir + "user\\graphic\\bg_cursed4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_cursed4"
			p++
		}
		exist exedir + "user\\graphic\\bg_cursed5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_cursed5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re5"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("どこからともなく聞こえる呪いのつぶやきが、あなたの眠りを妨げた。", "Your sleep is disturbed by a harshly whispering that comes from nowhere.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("眠れない…", "Can't...sleep...")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 8 | _switch_sw) {
		_switch_sw = 0
		p = rndex(cGold(0) / 8 + 1)
		if (cbit(15, 0)) {
			p = 0
		}
		if (p > 0) {
			txt -1, lang("金貨" + p + "枚を失った。", "You lose " + p + " gold pieces.")
			cGold(0) -= p
		} else {
			txt -1, lang("損害はなかった。", "The thief fails to steal money from you.")
		}
		s = lang("悪意ある手", "Malicious Hand")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_malicious1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_malicious1"
			p++
		}
		exist exedir + "user\\graphic\\bg_malicious2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_malicious2"
			p++
		}
		exist exedir + "user\\graphic\\bg_malicious3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_malicious3"
			p++
		}
		exist exedir + "user\\graphic\\bg_malicious4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_malicious4"
			p++
		}
		exist exedir + "user\\graphic\\bg_malicious5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_malicious5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re9"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("悪意のある手が忍び寄り、あなたが気付かない間に金貨を奪って逃げた。", "A malicious hand slips and steals your money.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("盗人め…", "Bloody thieves...")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 11 | _switch_sw) {
		_switch_sw = 0
		s = lang("冒険者の遺骸", "Corpse")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_corpse1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_corpse1"
			p++
		}
		exist exedir + "user\\graphic\\bg_corpse2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_corpse2"
			p++
		}
		exist exedir + "user\\graphic\\bg_corpse3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_corpse3"
			p++
		}
		exist exedir + "user\\graphic\\bg_corpse4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_corpse4"
			p++
		}
		exist exedir + "user\\graphic\\bg_corpse5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_corpse5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re7"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("この場所で力尽きた冒険者の遺骸を見つけた。既に朽ちかけている骨と、身に着けていたと思われる幾つかの装備が散らばっている。", "You find a corpse of an adventurer. There're bones and equipment scatters on the ground waiting to decay.")
		if (cfg_randomeventreplace) {
			list(0, listmax) = 2
			listn(0, listmax) = lang("埋葬する", "(Bury)")
			listmax++
			list(0, listmax) = 1
			listn(0, listmax) = lang("あさる", "(Loot)")
			listmax++
		} else {
			list(0, listmax) = 1
			listn(0, listmax) = lang("あさる", "(Loot)")
			listmax++
			list(0, listmax) = 2
			listn(0, listmax) = lang("埋葬する", "(Bury)")
			listmax++
		}
		gosub *label_1097
		if (rtval == 1) {
			txt -1, lang("あなたは遺留品をあさった。", "You loot the remains.")
			modkarma 0, -2
			repeat 1 + rnd(3)
				flt 0, calcfixlv(3)
				if (rnd(3) == 0) {
					flttypemajor = fsetwear(rnd(length(fsetwear)))
				} else {
					flttypemajor = fsetremain(rnd(length(fsetremain)))
				}
				itemcreate -1, 0, cX(0), cY(0), 0
			loop
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		} else {
			txt -1, lang("あなたは骨と遺留品を埋葬した。", "You bury the corpse with respect.")
			modkarma 0, 5
		}
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 2 | _switch_sw) {
		_switch_sw = 0
		efid = 1104
		efp = 100
		tc = 0
		gosub *label_1398
		s = lang("魔法使いの夢", "Wizard's Dream")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_wizard1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_wizard1"
			p++
		}
		exist exedir + "user\\graphic\\bg_wizard2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_wizard2"
			p++
		}
		exist exedir + "user\\graphic\\bg_wizard3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_wizard3"
			p++
		}
		exist exedir + "user\\graphic\\bg_wizard4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_wizard4"
			p++
		}
		exist exedir + "user\\graphic\\bg_wizard5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_wizard5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re6"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("夢の中であなたは赤い髪の魔術師に出会った。「誰じゃ、お主は？ふむ、間違った者の夢に現れてしまったようじゃ。すまぬな。お詫びといってはなんじゃが…」魔法使いは指をくるりと回した。あなたは軽い頭痛を覚えた。", "In your dream, you meet a wizard with a red mustache. \"Who are you? Hmm, I guess I picked up the wrong man's dream. My apology for disturbing your sleep. To make up for this...\" The wizard draws a circle in the air and vanishes. You feel the effects of a faint headache.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("おかしな夢だ", "A weird dream.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 3 | _switch_sw) {
		_switch_sw = 0
		efid = 1119
		efp = 100
		tc = 0
		gosub *label_1398
		s = lang("成長のきざし", "Development")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_development1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_development1"
			p++
		}
		exist exedir + "user\\graphic\\bg_development2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_development2"
			p++
		}
		exist exedir + "user\\graphic\\bg_development3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_development3"
			p++
		}
		exist exedir + "user\\graphic\\bg_development4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_development4"
			p++
		}
		exist exedir + "user\\graphic\\bg_development5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_development5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re4"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("長年の鍛錬の成果が実ったようだ。なかなか眠りにつけず考えごとをしていたあなたは、ふと、自らの技術に関する新しいアイデアを思いついた。", "You lie awake, sunk deep into thought. As memories of your journey flow from one into another, you chance upon a new theory to improve one of your skills.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("よし！", "Good!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 6 | _switch_sw) {
		_switch_sw = 0
		skillexp2 154, 0, 1000
		s = lang("自然治癒力の向上", "Regeneration")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_regeneration1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_regeneration1"
			p++
		}
		exist exedir + "user\\graphic\\bg_regeneration2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_regeneration2"
			p++
		}
		exist exedir + "user\\graphic\\bg_regeneration3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_regeneration3"
			p++
		}
		exist exedir + "user\\graphic\\bg_regeneration4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_regeneration4"
			p++
		}
		exist exedir + "user\\graphic\\bg_regeneration5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_regeneration5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re4"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("身体が妙に火照ってあなたは目を覚ました。気がつくと、腕にあった傷跡が完全に消えていた。", "Your entire body flushes. When you wake up, a scar in your arm is gone.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("よし", "Good.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 7 | _switch_sw) {
		_switch_sw = 0
		skillexp2 155, 0, 1000
		s = lang("瞑想力の向上", "Meditation")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_meditation1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_meditation1"
			p++
		}
		exist exedir + "user\\graphic\\bg_meditation2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_meditation2"
			p++
		}
		exist exedir + "user\\graphic\\bg_meditation3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_meditation3"
			p++
		}
		exist exedir + "user\\graphic\\bg_meditation4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_meditation4"
			p++
		}
		exist exedir + "user\\graphic\\bg_meditation5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_meditation5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re4"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("あなたは、夢の中でも驚くほど理性を保っていた。まるで瞑想を行っている時のように、あなたは心の平和を感じた。", "In your dream, you meditate and feel inner peace.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("よし", "Good.")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 9 | _switch_sw) {
		_switch_sw = 0
		addplat 0, 1
		s = lang("路上に転がる幸運", "Great Luck")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_platinum1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_platinum1"
			p++
		}
		exist exedir + "user\\graphic\\bg_platinum2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_platinum2"
			p++
		}
		exist exedir + "user\\graphic\\bg_platinum3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_platinum3"
			p++
		}
		exist exedir + "user\\graphic\\bg_platinum4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_platinum4"
			p++
		}
		exist exedir + "user\\graphic\\bg_platinum5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_platinum5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re1"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("下を向いて歩いていると、幸運にもプラチナ硬貨を見つけた。", "You stumble over a stone and find a platinum coin.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ラッキー！", "What a luck!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 16 | _switch_sw) {
		_switch_sw = 0
		p = rndex(cGold(0) / 10 + 1000) + 1
		se_moneymod 0, p
		txt -1, lang("金貨" + p + "枚を手に入れた。", "You pick up " + p + " gold pieces.")
		s = lang("発狂した金持ち", "Mad Millionaire")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_millionaire1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_millionaire1"
			p++
		}
		exist exedir + "user\\graphic\\bg_millionaire2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_millionaire2"
			p++
		}
		exist exedir + "user\\graphic\\bg_millionaire3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_millionaire3"
			p++
		}
		exist exedir + "user\\graphic\\bg_millionaire4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_millionaire4"
			p++
		}
		exist exedir + "user\\graphic\\bg_millionaire5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_millionaire5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re1"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("発狂した金持ちが、何か叫びながら金貨をばらまいている…", "A rich mad man is scattering his money all over the ground.")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ラッキー！", "What a luck!")
		listmax++
		gosub *label_1097
		goto *label_1096
		_switch_sw++
	}
	if (_switch_val == 17 | _switch_sw) {
		_switch_sw = 0
		priest_spells = 451, 402, 439, 407
		efid = priest_spells(rnd(length(priest_spells)))
		if (efid == 439) {
			efp = 800
			tc = 0
			gosub *label_1398
			efid = 440
			efp = 800
			tc = 0
			gosub *label_1398
		} else {
			efp = 800
			tc = 0
			gosub *label_1398
		}
		s = lang("辻プリースト", "Wandering Priest")
		p = 0
		sdim bg_file, 30, 5
		exist exedir + "user\\graphic\\bg_priest1.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_priest1"
			p++
		}
		exist exedir + "user\\graphic\\bg_priest2.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_priest2"
			p++
		}
		exist exedir + "user\\graphic\\bg_priest3.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_priest3"
			p++
		}
		exist exedir + "user\\graphic\\bg_priest4.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_priest4"
			p++
		}
		exist exedir + "user\\graphic\\bg_priest5.bmp"
		if (strsize != (-1)) {
			bg_file(p) = "bg_priest5"
			p++
		}
		if (p != 0) {
			file = bg_file(rnd(p))
			bg_exist = 1
		} else {
			file = "bg_re11"
		}
		throwsstpevent "RandomEvent", 0, s, 0
		buff = lang("突然、向かいからやって来た一人の神官が、すれ違いざまにあなたに魔法をかけた。「ノープロブレム」", "A priest comes up to you and casts a spell on you. \"No problem.\"")
		list(0, listmax) = 1
		listn(0, listmax) = lang("ありがとう", "Thanks.")
		listmax++
		gosub *label_1097
		goto *label_1096
	}
*label_1096
	cc = 0
	gosub *label_0626
	return 1
*label_1097
	oomSEST_log "re_select"
	if (cfg_skiprandevents) {
		if (listmax <= 1) {
			snd 62
			txt -1, "" + buff
			txt -1, lang("「", "\"") + listn(0, 0) + lang("」", "\"")
			rtval = -1
			bg_exist = 0
			return rtval
		}
	}
	keyhalt = 1
	cs = 0
	page = 0
	pagemax = 0
	pagesize = 16
	cs_bk = -1
	key = ""
	objprm 0, ""
	keylog = ""
	if (listmax <= 1) {
		chatesc = 0
	} else {
		chatesc = -1
	}
	gsel 7
	gmode 0
	pos 0, 0
	if (bg_exist == 1) {
		picload_ exedir + "user\\graphic\\" + file + ".bmp", 0
		bg_exist = 0
	} else {
		picload_ exedir + "\\graphic\\" + file + ".bmp", 0
	}
	tx = ginfo(12)
	ty = ginfo(13)
	gsel 0
	snd 62
	dx = tx + 36
	talk_conv buff, (dx - 80) / (7 - en) - en * 4
	notesel buff
	dy = ty + noteinfo(0) * 15 + 80 + listmax * 20
*label_1098
	redraw 0
	gmode 2
	window (windoww - dx) / 2 + inf_screenx + 4, winposy(dy) - 12, dx, dy, 0, -1
	window (windoww - dx) / 2 + inf_screenx, winposy(dy) - 16, dx, dy
	wx = (windoww - dx) / 2 + inf_screenx
	wy = winposy(dy)
	gmode 0
	pos wx + 12, wy + 6
	gcopy 7, 0, 0, tx, ty
	gmode 2
	color 240, 230, 220
	boxl wx + 12, wy + 6, wx + tx + 12, wy + ty + 6
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	q = lang("《 " + s + " 》", " < " + s + " > ")
	pos wx + 40, wy + 16
	color 30, 20, 10
	bmes q, 245, 235, 225
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 30, 30, 30
	pos wx + 24, wy + ty + 20
	mes buff
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat listmax
		p = cnt
		i = list(0, p)
		display_key wx + 30, wy + dy + cnt * 20 - listmax * 20 - 52, cnt
		q = listn(0, p)
		cs_list q, wx + 60, wy + dy + cnt * 20 - listmax * 20 - 52, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	rtval = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			rtval = list(0, pagesize * page + cnt)
			snd 40
			break
		}
	loop
	if (chatesc != (-1)) {
		if (key == key_cancel) {
			snd 40
			rtval = chatesc
		}
	}
	if (rtval != (-1)) {
		goto *label_1099
	}
	goto *label_1098
*label_1099
	key = ""
	return rtval



#defcfunc calcincome int __zzz
	p@m176 = 100 - gdata(120 + __zzz) / 100
	if (p@m176 == 99) {
		p@m176 = p@m176 * 70
	} else {
		p@m176 = p@m176 * 50
	}
	if (__zzz == 2) {
		p@m176 = p@m176 * 120 / 100
	}
	if (__zzz == 4) {
		p@m176 = p@m176 * 60 / 100
	}
	if (__zzz == 0) {
		p@m176 = p@m176 * 80 / 100
	}
	if (__zzz == 1) {
		p@m176 = p@m176 * 70 / 100
	}
	if (__zzz == 6) {
		p@m176 = p@m176 * 25 / 100
	}
	if (__zzz == 5) {
		p@m176 = p@m176 * 20 / 100
	}
	if (__zzz == 8) {
		p@m176 = p@m176 * 15 / 100
	}
	if (__zzz == 9) {
		p@m176 = p@m176 * 1500 / 100
	}
	return p@m176
*label_1101
*label_1102
	invfile = 4
	file = "shoptmp.s2"
	ctrlFile 4
	file = "shop" + 4 + ".s2"
	tmpload "" + file
	exist exedir + "tmp\\" + file
	if (strsize != (-1)) {
		ctrlFile 3
	} else {
		inv_getheader -1
		repeat invrange, invhead
			iNumber(cnt) = 0
		loop
	}
	mode = 6
	income = 0, 0
	repeat 10
		if (gdata(120 + cnt) >= 10000) {
			continue
		}
		p = calcincome(cnt) + rnd(calcincome(cnt) / 3 + 1) - rnd(calcincome(cnt) / 3 + 1)
		income += p
		flt
		itemcreate -1, 54, -1, -1, p
		if (cnt == 5 | cnt == 6) {
			continue
		}
		if (cnt == 5 | cnt == 6 | cnt == 3) {
			continue
		}
		p = rnd(rnd(3) + 1) + 1
		cnt2 = cnt
		repeat p
			dbid = 0
			flt calcobjlv((100 - gdata(120 + cnt2) / 100) / 2 + 1), calcfixlv(3 + (rnd(12) < gettrait(0, 39)))
			flttypemajor = fsetincome(rnd(length(fsetincome)))
			if (rnd(5) == 0) {
				flttypemajor = fsetwear(rnd(length(fsetwear)))
			}
			if (rnd(100 + gdata(120 + cnt2) / 5) < 2) {
				dbid = 559
			}
			itemcreate -1, dbid, -1, -1, 0
			income(1)++
		loop
	loop
	if (cFame(0) > 0) {
		p = limit(cFame(0) / 10, 100, 25000)
		if (cFame(0) >= 25000) {
			p += (cFame(0) - 25000) / 100
		}
		income += p
		flt
		itemcreate -1, 54, -1, -1, p
	}
	s = "" + income + lang("gold", " gold pieces")
	if (income(1) != 0) {
		s += lang("と" + income(1) + "個のアイテム", " and " + income(1) + " items")
	}
	if (income != 0 | income(1) != 0) {
		snd 24
		txtef 5
		txt -1, lang(s + "が給料として振り込まれた。", "As a salary, " + s + " have been sent to your house.")
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 0 & gettrait(0, 190) == 0) {
			autosave = 0
		}
	}
	if (gDay == 1) {
		ncgdata(200) = 0
		if (cFame(0) > 1000) {
			autosave = 1 * (gCurrentMap != 35)
			if (cfg_noautosave > 0 & gettrait(0, 190) == 0) {
				autosave = 0
			}
			inv_getheader -1
			p = -1
			repeat invrange, invhead
				if (iNumber(cnt) == 0) {
					p = cnt
					break
				}
			loop
			if (p == (-1)) {
				item_compress 10
			}
			flt
			itemcreate -1, 615, -1, -1, 0
			iSubname(ci) = gCostToHire + calccostbuilding() + calccosttax()
			iSubname(ci) = iSubname(ci) * (100 + rnd(20)) / 100
			mode = 0
			gLeftBill++
			txt -1, lang("請求書が送られてきた。", "A bill has been sent to your house.")
			if (gLeftBill > 1) {
				if (gLeftBill <= 4) {
					txtef 3
					if (gLeftBill > 3) {
						s = lang("警告！！", "Warning!! "), lang("早急にパルミア大使館まで行き、税金を納めなければならない。", "You have to go to the Embassy of Palmia and pay tax at once. ")
					} else {
						s = lang("注意！", "Caution! "), ""
					}
					txt -1, s + lang("税金を" + (gLeftBill - 1) + "ヶ月分滞納している。", "You are in arrears with your tax for " + (gLeftBill - 1) + " months.") + s(1)
				}
			}
			if (gLeftBill > 4) {
				txtef 3
				txt -1, lang("あなたは税金を" + (gLeftBill - 1) + "ヶ月滞納した罪で訴えられた。", "You have been accused for being in arrears with your tax for" + (gLeftBill - 1) + " months.")
				decfame 0, 50
				p = stat
				txtef 3
				txt -1, lang("名声値を" + p + "失った。", "You lose " + p + " fame.")
				modkarma 0, (-30) * 2
			}
		} else {
			txt -1, lang("名声が1000に達していないので納税の義務はない。", "There is no need to pay tax until you reach at least 1000 fame.")
		}
	}
	if (gWeather == 1 & gLastEtherwindMonth != gMonth) {
		gWeather = 0
		txt -1, lang("エーテルの風は止んだ。", "The Ether Wind dissipates.")
		if (gettrait(0, 222) != 0) {
			gWeather = 2
		}
	}
	file = "shop" + invfile + ".s2"
	ctrlFile 4
	file = "shoptmp.s2"
	ctrlFile 3
	mode = 0
	if (cfg_extrahelp) {
		if (gdata(200 + 16) == 0) {
			if (mode == 0) {
				if (cContinuousActionTurn(0) == 0) {
					gdata(200 + 16) = 1
					ghelp = 16
					gosub *label_1575
				}
			}
		}
	}
	return



#defcfunc rpmatname int __aaa
	s@m177 = "?????"
	if (rpdata(20 + __aaa, rpid) < 9000) {
		s@m177 = ioriginalnameref(rpdata(20 + __aaa, rpid))
	} else {
		if (rpdata(20 + __aaa, rpid) < 10000) {
			s@m177 = rfnameorg(1, rpdata(20 + __aaa, rpid) - 9000)
		} else {
			s@m177 = fltname(rpdata(20 + __aaa, rpid))
		}
	}
	if (rpdata(40 + __aaa, rpid) == 0) {
		return s@m177
	}
	if (rpdata(40 + __aaa, rpid) >= 10000) {
		p@m177 = rpdata(40 + __aaa, rpid) \ 10000
		if (p@m177 < 0 | p@m177 >= 800) {
			s@m177 += "/bugged/"
			return s@m177
		}
		if (rpid == 200 & step <= 0 | (rpid == 202 & step <= 0)) {
			s@m177 = lang("未定の", "unknown ") + cnvitemname(rpdata(20 + __aaa, rpid))
		} else {
			if (p@m177 == 343) {
				p2@m177 = rpdata(50 + __aaa, rpid) \ 10000
				if (p2@m177 != usernpcmax) {
					s@m177 = userdatan(1, p2@m177)
				} else {
					s@m177 = lang("残りカス", "garbage")
				}
			} else {
				s@m177 = refchara(p@m177, 2, 1)
			}
			s@m177 += lang("の", "'s ") + cnvitemname(rpdata(20 + __aaa, rpid))
		}
		return s@m177
	}
	return s@m177



#deffunc blendcheckext int __bbb, int __ccc
	if (rpdata(40 + __ccc, rpid) >= 10000) {
		p@m178 = rpdata(40 + __ccc, rpid) \ 10000
		if (p@m178 < 0 | p@m178 >= 800) {
			return 0
		}
		if (iSubname(__bbb) == p@m178) {
			if (p@m178 == 343) {
				if (inv(33, __bbb) != rpdata(50 + __ccc, rpid) \ 10000) {
					return 0
				}
			}
			return 1
		} else {
			return 0
		}
	}
	return 0



#defcfunc rpsuccessrate int __ddd
	if (__ddd == 100) {
		return lang("もう完璧！", "Perfect!")
	}
	if (__ddd >= 90) {
		return lang("朝飯前！", "A piece of cake!")
	}
	if (__ddd >= 80) {
		return lang("かんたんね", "Very likely")
	}
	if (__ddd >= 70) {
		return lang("まず大丈夫", "No problem")
	}
	if (__ddd >= 60) {
		return lang("たぶんいける", "Probably OK")
	}
	if (__ddd >= 50) {
		return lang("ちょっと不安", "Maybe")
	}
	if (__ddd >= 40) {
		return lang("だめかも", "Bad")
	}
	if (__ddd >= 30) {
		return lang("やばい", "Very bad")
	}
	if (__ddd >= 20) {
		return lang("まず無理", "Almost impossible")
	}
	return lang("絶対ムリ！", "Impossible!")



#defcfunc rpdiff int __eee, int __fff, int __ggg
	p1@m180 = 80
	if (__eee == 204) {
		if (gettrait(0, 83)) {
			p1@m180 += calctraitscore(stat) * 10
		}
	}
	f@m180 = 100
	if (__fff > 0) {
		repeat __fff
			f2@m180 = 0
			if (rpref(10 + cnt * 2) == (-1)) {
				break
			}
			i@m180 = rpref(10 + cnt * 2)
			if (iCurseState(i@m180) >= 1) {
				f2@m180 -= 10
			}
			if (iCurseState(i@m180) <= (-1)) {
				f2@m180 += 20
			}
			if (__eee == 204 | __eee == 211) {
				if (iEnhancement(i@m180) > 0) {
					f2@m180 += iEnhancement(i@m180) * 5
				}
			}
			f@m180 += f2@m180
			if (__ggg == cnt) {
				repeat
					if (f2@m180 < 0) {
						txtef 2
						txt -1, lang("調合の成功率が上がった。", "The success rate goes up.")
						break
					}
					if (f2@m180 > 0) {
						txtef 3
						txt -1, lang("調合の成功率が下がった。", "The success rate goes down.")
						break
					}
					break
				loop
			}
		loop
	}
	repeat 5
		if (rpdata(10 + cnt * 2, rpid) == 0) {
			break
		}
		if (sdata(rpdata(10 + cnt * 2, rpid), 0) <= 0) {
			p1@m180 -= 125
			continue
		}
		d@m180 = rpdata(11 + cnt * 2, rpid)
		if (__fff > 0) {
			d@m180 = d@m180 * f@m180 / 100
			if (d@m180 < 1) {
				d@m180 = 1
			}
		}
		p@m180 = (d@m180 * 200 / sdata(rpdata(10 + cnt * 2, rpid), 0) - 200) * (-1)
		if (p@m180 > 0) {
			p@m180 /= 5
		}
		if (p@m180 < (-125)) {
			p@m180 = -125
		}
		p1@m180 += p@m180
	loop
	if (p1@m180 < 25) {
		p1@m180 = 0
	}
	if (p1@m180 > 100) {
		p1@m180 = 100
	}
	return p1@m180



// Check if you have required materials.
// @param [in] __recipeId the recipe ID you are blending.
// @return bool true if you have enough; Otherwise, false.
#defcfunc blendcheckmat int __recipeId
	rpid = __recipeId
	repeat 10
		if (rpdata(20 + cnt, rpid) == 0) {
			break
		}
		f@m181 = 0
		step@m181 = cnt
		id@m181 = rpdata(20 + cnt, rpid)
		rp@m181 = cnt
		repeat 2
			if (cnt == 0) {
				o@m181 = -1
			}
			if (cnt == 1) {
				o@m181 = 0
			}
			inv_getheader o@m181
			repeat invrange, invhead
				if (iNumber(cnt) <= 0) {
					continue
				}
				if (cfg_hideitem & ibit_isMarkedAsNoDrop(cnt)) {
					continue
				}
				if (rpdata(2, rpid) > 0 & step@m181 == 0) {
				} else {
					if (iOwnState(cnt) > 0) {
						continue
					}
				}
				if (o@m181 == (-1)) {
					if (dist(iX(cnt), iY(cnt), cX(0), cY(0)) > 4) {
						continue
					}
				}
				if (rpdata(40 + rp@m181, rpid)) {
					blendcheckext cnt, rp@m181
					if (stat == 0) {
						continue
					}
				}
				if (id@m181 < 9000) {
					if (iId(cnt) == id@m181) {
						f@m181 = 1
						break
					}
					continue
				}
				if (id@m181 < 10000) {
					if (instr(rffilter_item(iId(cnt)), 0, "/" + rfnameorg(0, id@m181 - 9000) + "/") != (-1) | id@m181 == 9004) {
						f@m181 = 1
						break
					}
					continue
				}
				if (refitem(iId(cnt), 5, cnt) == id@m181) {
					f@m181 = 1
					break
				}
			loop
			if (f@m181 == 1) {
				break
			}
		loop
		if (f@m181 == 0) {
			break
		}
	loop
	return f@m181



// Count the number of required materials you have.
// @param [in] __materialType the required material type.
// @param [in] __step the current step in the recipe.
// @return int the number of required materials you have.
#deffunc blendmatnum int __materialType, int __step
	m@m182 = 0
	repeat 2
		if (cnt == 0) {
			o@m182 = -1
		}
		if (cnt == 1) {
			o@m182 = 0
		}
		inv_getheader o@m182
		repeat invrange, invhead
			if (iNumber(cnt) <= 0) {
				continue
			}
			if (cfg_hideitem & ibit_isMarkedAsNoDrop(cnt)) {
				continue
			}
			if (rpdata(2, rpid) > 0 & __step == 0) {
			} else {
				if (iOwnState(cnt) > 0) {
					continue
				}
			}
			if (o@m182 == (-1)) {
				if (dist(iX(cnt), iY(cnt), cX(0), cY(0)) > 4) {
					continue
				}
			}
			if (rpdata(40 + __step, rpid)) {
				blendcheckext cnt, __step
				if (stat == 0) {
					continue
				}
			}
			if (__materialType < 9000) {
				if (iId(cnt) == __materialType) {
					m@m182 += iNumber(cnt)
				}
				continue
			}
			if (__materialType < 10000) {
				if (__materialType == 9006) {
					if (iId(cnt) != 204) {
						continue
					}
					if (iSubname(cnt) == 120 | iSubname(cnt) == 121 | iSubname(cnt) == 122 | iSubname(cnt) == 123 | iSubname(cnt) == 124 | iSubname(cnt) == 125) {
					} else {
						continue
					}
					m@m182 += iNumber(cnt)
					continue
				}
				if (__materialType == 9007) {
					if (iId(cnt) != 340) {
						continue
					}
					if (iSubname(cnt) == 0) {
						continue
					}
					if (iSubname(cnt) == 285 | iSubname(cnt) == 286 | iSubname(cnt) == 287 | iSubname(cnt) == 327 | iSubname(cnt) == 343) {
						continue
					}
					m@m182 += iNumber(cnt)
					continue
				}
				if (__materialType == 9010) {
					if (iId(cnt) != 340) {
						if (iId(cnt) != 427) {
							continue
						}
					} else {
						if (iSubname(cnt) == 0) {
							continue
						}
						if (iSubname(cnt) == 285 | iSubname(cnt) == 286 | iSubname(cnt) == 287 | iSubname(cnt) == 327 | iSubname(cnt) == 343) {
							continue
						}
					}
					m@m182 += iNumber(cnt)
					continue
				}
				if (instr(rffilter_item(iId(cnt)), 0, "/" + rfnameorg(0, __materialType - 9000) + "/") != (-1) | __materialType == 9004) {
					m@m182 += iNumber(cnt)
					continue
				}
			}
			if (refitem(iId(cnt), 5, cnt) == __materialType) {
				m@m182 += iNumber(cnt)
				continue
			}
		loop
	loop
	return m@m182



// Create the list of materials you have.
// @param [out] __result The list of materials you have.
// @param [in] __step the current step in the recipe.
// @return int the size of `__result`.
#deffunc blendlist array __result, int __step
	id@m183 = rpdata(20 + __step, rpid)
	m@m183 = 0
	repeat 2
		if (cnt == 0) {
			o@m183 = -1
		}
		if (cnt == 1) {
			o@m183 = 0
		}
		inv_getheader o@m183
		repeat invrange, invhead
			if (m@m183 >= 500) {
				break
			}
			if (iNumber(cnt) <= 0) {
				continue
			}
			if (cfg_hideitem & ibit_isMarkedAsNoDrop(cnt)) {
				continue
			}
			if (rpdata(2, rpid) > 0 & step == 0) {
			} else {
				if (iOwnState(cnt) > 0) {
					continue
				}
			}
			if (o@m183 == (-1)) {
				if (dist(iX(cnt), iY(cnt), cX(0), cY(0)) > 4) {
					continue
				}
			}
			reftype@m183 = refitem(iId(cnt), 5, cnt)
			if (rpdata(40 + __step, rpid)) {
				blendcheckext cnt, __step
				if (stat == 0) {
					continue
				}
			}
			if (rpid == 204 | rpid == 216) {
				if (item_isCookedMilk(cnt)) {
					continue
				}
			}
			if (rpid == 211 | rpid == 217) {
				if ((iId(cnt) == 290 & ogdata(515) != 2) | iId(cnt) == 480) {
					continue
				}
			}
			if (rpid == 213 & step == 0) {
				if (ibit(20, cnt) == 0) {
					continue
				}
			}
			if (rpid == 216 | rpid == 217) {
				if (iNumber(cnt) < 2) {
					continue
				}
				if (iEnhancement(cnt) >= sdata(178, 0)) {
					continue
				}
			}
			if (rpid == 218) {
				if (iParam2(cnt) != 0 | iSubname(cnt) != 30) {
					continue
				}
			}
			if (id@m183 < 9000) {
				if (iId(cnt) != id@m183) {
					continue
				}
			} else {
				if (id@m183 < 10000) {
					if (rfnameorg(0, id@m183 - 9000) != "") {
						if (instr(rffilter_item(iId(cnt)), 0, "/" + rfnameorg(0, id@m183 - 9000) + "/") == (-1)) {
							continue
						}
					}
					if (id@m183 == 9004) {
						if (iId(cnt) == 54 | iId(cnt) == 787) {
							if (gettrait(0, 194) < 0) {
								continue
							}
						}
					}
					if (id@m183 == 9006) {
						if (iId(cnt) != 204) {
							continue
						}
						if (iSubname(cnt) == 120 | iSubname(cnt) == 121 | iSubname(cnt) == 122 | iSubname(cnt) == 123 | iSubname(cnt) == 124 | iSubname(cnt) == 125) {
						} else {
							continue
						}
					}
					if (id@m183 == 9007) {
						if (iId(cnt) != 340) {
							continue
						}
					}
					if (id@m183 == 9008) {
						if (reftype@m183 != 60000) {
							continue
						}
						if (iColor(cnt) == 1) {
							continue
						}
					}
					if (id@m183 == 9009) {
						if (contafurniturecheck(iId(cnt)) == (-1) & iId(cnt) != 579) {
							continue
						}
						if (contafurniturecheck(iId(cnt)) != (-1)) {
							if (iCount(cnt) >= 1000) {
								continue
							}
						}
						if (iId(cnt) == 579) {
							if (iCount(cnt) != 6) {
								continue
							}
						}
					}
					if (id@m183 == 9010) {
						if (iId(cnt) != 340 & iId(cnt) != 427) {
							continue
						}
					}
				} else {
					if (reftype@m183 != id@m183) {
						continue
					}
				}
			}
			if (step > 0) {
				f@m183 = cnt
				repeat step
					if (rpid == 204 | rpid == 211) {
						if (iNumber(rpref(10 + cnt * 2)) < 2 & rpref(10 + cnt * 2) == f@m183) {
							f@m183 = -999
						}
					} else {
						if (rpref(10 + cnt * 2) == f@m183) {
							f@m183 = -999
							break
						}
					}
				loop
				if (f@m183 == (-999)) {
					continue
				}
			}
			__result(0, m@m183) = cnt, reftype@m183 * 1000 + iId(cnt)
			m@m183++
		loop
	loop
	return m@m183



#deffunc window_recipe2
	x@m183 = wx + ww
	w@m183 = 400
	gmode 2
	pos x@m183 + w@m183 - 520, 0
	gcopy 3, 960, 96 + 192, 480, 68
	dx@m183 = x@m183 + w@m183 - 500
	dy@m183 = 10
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 1
	s@m183 = "" + rpsuccessrate(rpdiff(rpid, step, -1))
	if (gWizard) {
		s@m183 += ":" + rpdiff(rpid, step, -1)
	}
	pos dx@m183 + 140, dy@m183
	color 30, 30, 30
	bmes lang("成功率: ", "Success Rate: ") + s@m183, 235, 235, 235
	p@m183 = rpdata(1, rpid)
	if (rpmode) {
		if (p@m183 < 10000) {
			p@m183 = p@m183 * val
		} else {
			p@m183 = p@m183 \ 10000
		}
		p@m183 += rpdata(1, rpid) / 10000 * val * 10000
	}
	s@m183 = "" + p@m183 \ 10000 + lang("ターン", " turns")
	if (p@m183 >= 10000) {
		s@m183 += lang("と", " and ") + p@m183 / 10000 + lang("時間", " hours")
	}
	pos dx@m183 + 140, dy@m183 + 20
	color 40, 40, 40
	bmes lang("必要時間: ", "Time: ") + s@m183, 235, 235, 235
	return



#deffunc window_recipe array, int __nnn, int __ooo, int __ppp, int __qqq, int __rrr
	sdim s@m184
	if (windowshadow == 1) {
		window __ooo + 4, __ppp + 4, __qqq, __rrr - __rrr \ 8, 0, -1
		pos __ooo + __qqq - 522, 0
		gfini 486, 69
		gfdec 40, 40, 40
		windowshadow = 0
	}
	window __ooo, __ppp, __qqq, __rrr - __rrr \ 8, 0, 0
	window_recipe2
	gmode 2
	color 194, 170, 146
	line __ooo + 50 + xfix@m184, __ppp + __rrr - 48 - __rrr \ 8, __ooo + __qqq - 40, __ppp + __rrr - 48 - __rrr \ 8
	color 234, 220, 188
	line __ooo + 50 + xfix@m184, __ppp + __rrr - 49 - __rrr \ 8, __ooo + __qqq - 40, __ppp + __rrr - 49 - __rrr \ 8
	s@m184 = "Page." + (rppage + 1) + "/" + (rppage(1) + 1), "" + key_prev + "," + key_next + "" + lang("[ページ切替]  ", "[Page]  ")
	if (step == (-1)) {
		s@m184(1) += strhint3
	} else {
		s@m184(1) += strhint3b
	}
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	color 0, 0, 0
	pos __ooo + 25 + xfix@m184, __ppp + __rrr - 43 - __rrr \ 8
	mes s@m184(1)
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	color 0, 0, 0
	pos __ooo + __qqq - strlen(s@m184) * 7 - 40 - xfix2@m184, __ppp + __rrr - 65 - __rrr \ 8
	mes s@m184
	dx@m184 = __ooo + 35
	dy@m184 = __ppp + 48
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
	color 0, 0, 0
	pos dx@m184 - 10, dy@m184
	mes lang("調合の手順", "Blending Procedure")
	dy@m184 = dy@m184 + 18
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	color 0, 0, 0
	i@m184 = 1
	pos dx@m184 - 10, dy@m184 - 2
	gfini __qqq - 60, 17
	if (step == i@m184 - 2) {
		gfdec2 10, 20, 30
	} else {
		if (step > i@m184 - 2) {
			gfdec2 25, 30, 35
		}
	}
	if (step == (-1)) {
		pos dx@m184, dy@m184
		mes "" + i@m184 + "." + lang("レシピを選ぶ", "Choose a recipe")
	} else {
		pos dx@m184, dy@m184
		mes "" + i@m184 + "." + lang(rpname(rpid) + "のレシピを選んだ", "Chose the recipe of " + rpname(rpid))
	}
	dy@m184 += 17
	i@m184++
	repeat 10
		if (rpdata(20 + cnt, rpid) == 0) {
			break
		}
		pos dx@m184 - 10, dy@m184 - 2
		gfini __qqq - 60, 17
		if (step == i@m184 - 2) {
			gfdec2 10, 20, 30
		} else {
			if (step > i@m184 - 2) {
				gfdec2 25, 30, 35
			}
		}
		if (step <= cnt) {
			blendmatnum rpdata(20 + cnt, rpid), cnt
			p@m184 = stat
			s@m184 = lang(rpmatname(cnt) + "を加える", "Add " + rpmatname(cnt) + "") + "(" + lang("所持:", "Stock:") + p@m184 + ")"
		} else {
			s@m184 = lang("", "Selected ") + itemname(rpref(10 + cnt * 2)) + lang("を選んだ", "")
			s@m184 = strmid(s@m184, 0, 44)
		}
		pos dx@m184, dy@m184
		mes "" + i@m184 + "." + s@m184
		dy@m184 += 17
		i@m184++
	loop
	pos wx + ww + 243, wy - 4
	gcopy 3, 1040, 96, 160, 70
	pos dx@m184 - 10, dy@m184 - 2
	gfini __qqq - 60, 17
	if (step == i@m184 - 2) {
		gfdec2 10, 20, 30
	} else {
		if (step > i@m184 - 2) {
			gfdec2 25, 30, 35
		}
	}
	pos dx@m184, dy@m184
	mes "" + i@m184 + "." + lang("調合を始める！", "Start blending!")
	dy@m184 += 30
	if (rppage == 0) {
		font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
		color 0, 0, 0
		pos dx@m184 - 10, dy@m184
		mes lang(rpname(rpid) + "のレシピ", "The recipe of " + rpname(rpid))
		dy@m184 += 20
		pos dx@m184 - 10, dy@m184
		mes lang("必要なスキル:", "Required Skills:")
		dy@m184 = dy@m184 + 18
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 0, 0, 0
		repeat 5
			if (rpdata(10 + cnt * 2, rpid) == 0) {
				break
			}
			if (rpdata(11 + cnt * 2, rpid) > sdata(rpdata(10 + cnt * 2, rpid), 0)) {
				color 150, 0, 0
			} else {
				color 0, 120, 0
			}
			pos dx@m184 + cnt \ 2 * 140, dy@m184 + cnt / 2 * 17
			mes skillname(rpdata(10 + cnt * 2, rpid)) + "  " + rpdata(11 + cnt * 2, rpid) + "(" + sdata(rpdata(10 + cnt * 2, rpid), 0) + ")"
		loop
		return
	}
	if (__nnn == (-1)) {
		return
	}
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
	color 0, 0, 0
	pos dx@m184 - 10, dy@m184
	mes itemname(__nnn)
	dy@m184 += 20
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	color 0, 0, 0
	if (iIdentificationState(__nnn) < 2) {
		pos dx@m184, dy@m184
		mes lang("このアイテムは鑑定されていない。", "You haven't identified it yet.")
		dy@m184 += 16
		return
	}
	getinheritance __nnn, inhlist@m184, p@m184
	if (p@m184 > 0) {
		repeat p@m184
			cnt2@m184 = inhlist@m184(cnt)
			if (iEnchantmentId(__nnn, cnt2@m184) == 0) {
				break
			}
			val = iEnchantmentId(__nnn, cnt2@m184), iEnchantmentPower(__nnn, cnt2@m184), 0, refitem(iId(__nnn), 5, __nnn)
			gosub *label_0297
			color 0, 0, 100
			if (iEnchantmentPower(__nnn, cnt2@m184) < 0) {
				color 180, 0, 0
			}
			pos dx@m184, dy@m184
			mes cnven(s)
			dy@m184 += 16
		loop
	} else {
		pos dx@m184, dy@m184
		mes lang("継承効果なし", "No inheritance effects")
		dy@m184 += 16
		p@m184++
	}
	color 0, 0, 0
	return



#deffunc clear_rprefmat
	repeat 10
		rpref(10 + cnt * 2) = -1
	loop
	return



*blending_clearRecipeMemory
	repeat 8
		recipememory(200 + cnt) = 1
	loop
	recipememory(792 + 400) = 1
	recipememory(775 + 400) = 1
	recipememory(200 + 11) = 1
	recipememory(200 + 12) = 1
	recipememory(200 + 13) = 1
	recipememory(200 + 14) = 1
	recipememory(200 + 16) = 1
	recipememory(200 + 17) = 1
	recipememory(200 + 18) = 1
	recipememory(200 + 19) = 1
	return



*label_1122
	dim rpdata, 100, 1200
	sdim rfnameorg, 20, 2, 9009 - 9000
	sdim rpdatan, 40, 1200
	dim rpref, 100
	rpsourcelist = 498 + 400, 756 + 400, 787 + 400
	rpid = 200
	rpdatan(rpid) = lang("人体錬成", "human transmutation")
	rpdata(0, rpid) = 10000, 10
	rpdata(10 + 0 * 2, rpid) = 178, 1
	rpdata(20 + 0, rpid) = 204, 337, 338, 339, 340, 341
	rpdata(40 + 0, rpid) = 0, 10000, 10000, 10000, 10000, 10000
	rpdata(50 + 0, rpid) = 0, 10000, 10000, 10000, 10000, 10000
	rpid = 200 + 1
	rpdatan(rpid) = lang("矢弾の充填", "reload ammo")
	rpdata(0, rpid) = 10001, 3
	rpdata(10 + 0 * 2, rpid) = 12, 10, 110, 5
	rpdata(20 + 0, rpid) = 191, 261
	rpid = 200 + 2
	rpdatan(rpid) = lang("人形作成", "doll")
	rpdata(0, rpid) = 10002, 15
	rpdata(10 + 0 * 2, rpid) = 176, 25, 177, 25
	rpdata(20 + 0, rpid) = 503, 204, 337, 338, 339, 340, 341, 566, 736
	rpdata(40 + 0, rpid) = 0, 10000, 10000, 10000, 10000, 10000, 10000
	rpdata(50 + 0, rpid) = 0, 10000, 10000, 10000, 10000, 10000, 10000
	rpid = 200 + 3
	rpdatan(rpid) = lang("収納家具拡張", "expand containers")
	rpdata(0, rpid) = 10003, 20
	rpdata(10 + 0 * 2, rpid) = 176, 15
	rpdata(20 + 0, rpid) = 9009, 731
	rpid = 200 + 4
	rpdatan(rpid) = lang("同種ポーション調合", "potion doping")
	rpdata(0, rpid) = 10004, 15
	rpdata(10 + 0 * 2, rpid) = 178, 20
	rpdata(20 + 0, rpid) = 52000, 52000
	rpid = 200 + 5
	rpdatan(rpid) = lang("釣り餌の装着", "bait attachment")
	rpdata(0, rpid) = 10005, 10, 1
	rpdata(10 + 0 * 2, rpid) = 185, 2, 12, 10
	rpdata(20 + 0, rpid) = 342, 617
	rpid = 200 + 6
	rpdatan(rpid) = lang("アイテムの祝福", "blessed item")
	rpdata(0, rpid) = 10006, 5, 1
	rpdata(10 + 0 * 2, rpid) = 12, 5
	rpdata(20 + 0, rpid) = 9004, 516
	rpid = 200 + 7
	rpdatan(rpid) = lang("井戸水の回復", "well refill")
	rpdata(0, rpid) = 10007, 3, 2
	rpdata(10 + 0 * 2, rpid) = 12, 3
	rpdata(20 + 0, rpid) = 60001, 52000
	rpid = 200 + 11
	rpdatan(rpid) = lang("魔道具合成", "rod doping")
	rpdata(0, rpid) = 10011, 15
	rpdata(10 + 0 * 2, rpid) = 178, 20, 174, 16
	rpdata(20 + 0, rpid) = 56000, 56000
	rpid = 200 + 12
	rpdatan(rpid) = lang("転移マーカー付与", "add teleporting marker")
	rpdata(0, rpid) = 10012, 100, 1
	rpdata(10 + 0 * 2, rpid) = 408, 16, 428, 16
	rpdata(20 + 0, rpid) = 9004, 35, 36
	rpid = 200 + 13
	rpdatan(rpid) = lang("転移マーカー消去", "remove teleporting marker")
	rpdata(0, rpid) = 10013, 10, 1
	rpdata(10 + 0 * 2, rpid) = 408, 16, 428, 16
	rpdata(20 + 0, rpid) = 9004, 37
	rpid = 200 + 14
	rpdatan(rpid) = lang("家具レプリカ作成", "create furniture replica")
	rpdata(0, rpid) = 10014, 60, 1
	rpdata(10 + 0 * 2, rpid) = 176, 5, 177, 5
	rpdata(20 + 0, rpid) = 9008
	rpid = 200 + 15
	rpdatan(rpid) = lang("家具レプリカ消去", "destroy furniture replica")
	rpdata(0, rpid) = 10015, 10, 1
	rpdata(10 + 0 * 2, rpid) = 10, 1
	rpdata(20 + 0, rpid) = 161
	rpid = 200 + 16
  rpdatan(rpid) = lang("同種ポーション濃縮", "potion concentrated")
	rpdata(0, rpid) = 10017, 15
	rpdata(10 + 0 * 2, rpid) = 178, 200
  rpdata(20 + 0, rpid) = 52000
	rpid = 200 + 17
  rpdatan(rpid) = lang("同種魔道具圧縮", "rod concentrated")
	rpdata(0, rpid) = 10017, 15
	rpdata(10 + 0 * 2, rpid) = 178, 200, 174, 100
  rpdata(20 + 0, rpid) = 56000
	rpid = 200 + 18
  rpdatan(rpid) = lang("エロ本の合成", "pornbook Synthesis")
	rpdata(0, rpid) = 10018, 50
	rpdata(10 + 0 * 2, rpid) = 150, 15
  rpdata(20 + 0, rpid) = 619, 619
	rpid = 200 + 19
  rpdatan(rpid) = lang("伝承本の作成", "creating a lore book")
	rpdata(0, rpid) = 10019, 15
	rpdata(10 + 0 * 2, rpid) = 150, 30, 172, 15
  rpdata(20 + 0, rpid) = 54000, 244
	rpid = 498 + 400
	rpdata(0, rpid) = 498, 60 + 15 * 10000
	rpdata(10 + 0 * 2, rpid) = 175, 4, 457, 20, 12, 8
	rpdata(30 + 0, rpid) = 0
	rpdata(20 + 0, rpid) = 260, 9001
	rpid = 756 + 400
	rpdata(0, rpid) = 756, 20 + 2 * 10000
	rpdata(10 + 0 * 2, rpid) = 184, 4, 179, 20, 157, 8
	rpdata(30 + 0, rpid) = 0
	rpdata(20 + 0, rpid) = 260
	rpid++
	rpid = 787 + 400
	rpdata(0, rpid) = 787, 30
	rpdata(10 + 0 * 2, rpid) = 184, 10, 178, 5
	rpdata(30 + 0, rpid) = 0
	rpdata(20 + 0, rpid) = 9004
	rpid = 775 + 400
	rpdata(0, rpid) = 775, 30
	rpdata(10 + 0 * 2, rpid) = 184, 100
	rpdata(30 + 0, rpid) = 0
	rpdata(20 + 0, rpid) = 260, 698, 9006, 9010
	rpid = 792 + 400
	rpdata(0, rpid) = 792, 30
	rpdata(10 + 0 * 2, rpid) = 178, 300, 174, 150
	rpdata(30 + 0, rpid) = 0
	rpdata(20 + 0, rpid) = 52000, 52000, 52000
	rpid = 583 + 400
	rpdata(0, rpid) = 583, 30
	rpdata(10 + 0 * 2, rpid) = 176, 5
	rpdata(20 + 0, rpid) = 43, 45, 577
	rfnameorg(0, 9001 - 9000) = "flavor", lang("適当な調味料", "suitable flavoring")
	rfnameorg(0, 9002 - 9000) = "ore", lang("適当な鉱石", "any ore")
	rfnameorg(0, 9003 - 9000) = "wood", lang("加工前の木", "something made of wood")
	rfnameorg(0, 9004 - 9000) = "", lang("何か物体", "any item")
	rfnameorg(0, 9005 - 9000) = "fish", lang("魚介類", "fish")
	rfnameorg(0, 9006 - 9000) = "", lang("ドラゴンの死体", "meat of dragon")
	rfnameorg(0, 9007 - 9000) = "", lang("モンスターの心臓", "hart of monster")
	rfnameorg(0, 9008 - 9000) = "", lang("家具", "furniture")
	rfnameorg(0, 9009 - 9000) = "", lang("収納家具", "storage furniture")
	rfnameorg(0, 9010 - 9000) = "", lang("心臓/ストマフィリア", "hart or stomafillia")
	return
*label_1123
	oomSEST_log "com_blend"
	step = -1
	rpid = 0
	recipememory(200 + 14) = 1 * (areaId(gCurrentMap) == 7 | areaId(gCurrentMap) == 39 | areaId(gCurrentMap) > 100)
	recipememory(200 + 15) = 1 * (oommap(cX(0), cY(0), 0) != 0)
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_blend.bmp", 1
	gsel 0
	clear_rprefmat
*label_1124
	if (step == (-1) | step == 0) {
		rsikibetu = 0
		rpdata(40 + 0, 200) = 0, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu
		rpdata(40 + 0, 202) = 0, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu
		rpdata(20 + 0, 204) = 52000, 52000
		rpdata(20 + 0, 211) = 56000, 56000
		rpdata(20 + 0, 216) = 52000
		rsikibetu2 = 0
		rpdata(50 + 0, 200) = 0, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2
		rpdata(50 + 0, 202) = 0, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2
	}
	if (step != (-1)) {
		if (rpdata(20 + step, rpid) == 0) {
			rppage = 0
			window_recipe list2, -1, wx + ww, wy, 400, wh
			txtnew
			txt -1, lang("幾つ作る？", "How many items do you want to create?")
			promptl(0, promptmax) = lang("調合を始める", "Start blending"), "a", "" + promptmax
			promptmax++
			promptl(0, promptmax) = lang("前に戻る", "Go back"), "b", "" + promptmax
			promptmax++
			promptl(0, promptmax) = lang("最初から", "From the start"), "c", "" + promptmax
			promptmax++
			if (ogdata(475) == 2) {
				p = 1000 + ((sdata(176, 0) + sdata(177, 0) + sdata(178, 0) + sdata(179, 0)) / 10)
			} else {
				p = 20
			}
			if (rpid == 216 | rpid == 217 | rpid == 219) {
				p = 1
			}
			repeat 10
				if (rpref(10 + cnt * 2) == (-1)) {
					break
				}
				if (rpdata(2, rpid) == 2 & cnt == 0) {
					continue
				}
				if (iNumber(rpref(10 + cnt * 2)) < p) {
					p = iNumber(rpref(10 + cnt * 2))
				}
				if (rpref(10 + cnt * 2) == rpref(10 + (cnt + 1) * 2)) {
					if (iNumber(rpref(10 + cnt * 2)) / 2 < p) {
						p = iNumber(rpref(10 + cnt * 2)) / 2
					}
				}
			loop
			val = promptx, prompty, 220, 2, p
			rpmode = 1
			gosub *label_1353
			rpmode = 0
			if (rtval == 0) {
				rpref(1) = val
				rpref(2) = rpdata(1, rpid)
				rpref(3) = rpdiff(rpid, step, -1)
				gosub *label_1135
				goto *label_1617
			}
			if (rtval == 2) {
				step = -1
				goto *label_1124
			}
			step--
			goto *label_1124
		}
	}
	page = 0
	pagesize = 16
	listmax = 0
	cs = 0
	cs_bk = -1
	cc = 0
	screenupdate = -1
	gosub *label_0623
	if (step == (-1)) {
		rppage = 0, 0
		listmax = 0
		repeat 1200
			if (rpdata(0, cnt) == 0) {
				continue
			}
			if (cnt == 201) {
				if (godcheck() != "mani") {
					continue
				}
			}
			if (recipememory(cnt) > 0) {
				list(0, listmax) = cnt, cnt
				listmax++
			}
		loop
		gosub *label_1276
		windowshadow(1) = 1
		txtnew
		txt -1, lang("どのレシピを使う？", "Which recipe do you want to use?")
		goto *label_1125
	}
	rppage = 1
	blendlist list, step
	listmax = stat
	gosub *label_1276
	goto *label_1127
*label_1125
	cs_bk = -1
	cs = cs_recipe1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	dim blendchecklist, pagesize
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		blendchecklist(cnt) = blendcheckmat(list(0, p))
	loop
*label_1126
	oomSEST_log "rpid:" + rpid
	redraw 0
	s = lang("レシピの選択", "Choose a recipe"), strhint2
	windowshadow = windowshadow(1)
	display_window (windoww - 780) / 2 + inf_screenx, winposy(445), 380, 432, 74
	display_topic lang("レシピの名称", "Name"), wx + 28, wy + 30
	s = "" + listmax + " recipes"
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	pos wx + 130, wy + wh - 65 - wh \ 8
	mes s
	keyrange = 0
	gmode 2
	gsel 1
	color 0
	boxf 0, 960, chipi(2, 550), chipi(3, 550) + 960
	pos 0, 960
	gcopy 1, chipi(0, 550), chipi(1, 550), chipi(2, 550), chipi(3, 550)
	gfini chipi(2, 550), chipi(3, 550)
	gfdec2 c_col(0, 0), c_col(1, 0), c_col(2, 0)
	gsel selcur
	oomSEST_log "TEST1"
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
		pos wx + 37, wy + 70 + cnt * 19
		gmode 2, chipi(2, 550), chipi(3, 550)
		grotate 1, 0, 960, 0, inf_tiles, inf_tiles
		pos wx + 330, wy + 53 + cnt * 19
		if (blendchecklist(cnt) == 1) {
			gcopy 3, 336, 360, 24, 24
		}
		rpid = list(0, p)
		pos wx + 317, wy + 60 + cnt * 19
		gcopy 3, 64 + (4 - rpdiff(rpid, -1, -1) / 25) * 16, 624, 16, 16
	loop
	oomSEST_log "TEST2"
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		p = list(0, p)
		rpid = p
		s = lang("", "Recipe of ") + cnven(rpname(rpid)) + lang("のレシピ", "")
		display_key wx + 58, wy + 60 + cnt * 19 - 2, cnt
		cs_list s, wx + 84, wy + 60 + cnt * 19 - 1, 19, 0, 0, p
	loop
	oomSEST_log "TEST3"
	if (cs_bk != cs) {
		if (pagesize * page + cs < listmax) {
			rpid = list(0, pagesize * page + cs)
			windowshadow = windowshadow(1)
			window_recipe list2, -1, wx + ww, wy, 400, wh
		}
	}
	if (keyrange != 0) {
		cs_bk = cs
		cs_recipe1 = cs
	}
	oomSEST_log "TEST4"
	windowshadow(1) = 0
	pos wx + 10, wy + wh - 100
	gcopy 3, 960, 96, 80, 90
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	oomSEST_log "TEST5"
	if (p != (-1)) {
		rpid = p
		step = 0
		rppage = 1, 1
		rpref(0) = rpid
		goto *label_1124
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1125
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1125
		}
	}
	if (key == key_cancel) {
		screenupdate = 0
		gosub *label_0623
		goto *label_1623
	}
	oomSEST_log "TEST6"
	goto *label_1126
*label_1127
*label_1128
	cs = cs_recipe2
	page = page_recipe2
	windowshadow(1) = 1
	txtnew
	txt -1, lang(rpmatname(step) + "を追加しよう。", "Add \"" + rpmatname(step) + "\".")
*label_1129
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	redraw 0
	if (jp) {
		s = rpmatname(step) + "を追加"
	} else {
		s = "Add " + rpmatname(step)
	}
	s(1) = strhint2
	windowshadow = windowshadow(1)
	display_window (windoww - 780) / 2 + inf_screenx, winposy(445), 380, 432, 74
	display_topic lang("アイテムの名称", "Name"), wx + 28, wy + 30
	s = "" + listmax + " items"
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	pos wx + 130, wy + wh - 65 - wh \ 8
	mes s
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		p = list(0, p)
		s = itemname(p, iNumber(p))
		s = strmid(s, 0, 28)
		if (p >= 5080) {
			s += lang("(地面)", " (Ground)")
		}
		display_key wx + 58, wy + 60 + cnt * 19 - 2, cnt
		p(1) = iImage(p) \ 1000
		gsel 1
		color 0
		boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
		if (p(1) == 528) {
			gmode 2
			pos 0, 960
			gcopy 1, 0, 768, inf_tiles, inf_tiles
			pos 0, 1008
			gzoom 22, 20, 5, chipc(0, iColor(p)) + 8, chipc(1, iColor(p)) + 4 + (chipc(3, iColor(p)) > inf_tiles) * 8, chipc(2, iColor(p)) - 16, chipc(3, iColor(p)) - 8 - (chipc(3, iColor(p)) > inf_tiles) * 10, 1
			pos 6, 974
			gcopy 1, 0, 1008, 22, 20
			gsel selcur
		} else {
			if (p(1) == 531) {
				pos 8, 1058 - chipc(3, iColor(p))
				gcopy 5, chipc(0, iColor(p)) + 8, chipc(1, iColor(p)) + 2, chipc(2, iColor(p)) - 16, chipc(3, iColor(p)) - 8
				gmode 4, , , 150
				color 0, 0, 0
				pos 0, 960 + (chipc(3, iColor(p)) == inf_tiles) * 48
				gcopy 1, 144, 768 + (chipc(3, iColor(p)) > inf_tiles) * 48, inf_tiles, chipc(3, iColor(p)) + (chipc(3, iColor(p)) > inf_tiles) * 48
				gmode 2
				gsel selcur
			} else {
				if (p(1) == 529) {
					pos 0, 1056 - chipc(3, iColor(p))
					gcopy 5, chipc(0, iColor(p)), chipc(1, iColor(p)), chipc(2, iColor(p)), chipc(3, iColor(p))
					gmode 2
					gsel selcur
				} else {
					pos 0, 960
					gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
					gfini chipi(2, p(1)), chipi(3, p(1))
					gfdec2 c_col(0, iColor(p)), c_col(1, iColor(p)), c_col(2, iColor(p))
					gsel selcur
				}
			}
		}
		pos wx + 37, wy + 69 + cnt * 19
		gmode 2, chipi(2, p(1)), chipi(3, p(1))
		grotate 1, 0, 960, 0, chipi(2, p(1)) * inf_tiles / chipi(3, p(1)), inf_tiles
		if (iBodyPart(p) != 0) {
			pos wx + 46, wy + 72 + cnt * 18 - 3
			gcopy 3, 12, 348, 12, 12
		}
		cs_list s, wx + 84, wy + 60 + cnt * 19 - 1, 19, 0, 1, p
	loop
	p = list(0, pagesize * page + cs)
	if (listmax == 0) {
		p = -1
	}
	if (cs_bk != cs) {
		windowshadow = windowshadow(1)
		window_recipe list2, p, wx + ww, wy, 400, wh
	}
	if (keyrange != 0) {
		cs_bk = cs
		cs_recipe2 = cs
		page_recipe2 = page
	}
	windowshadow(1) = 0
	pos wx + 10, wy + wh - 100
	gcopy 3, 960, 96, 80, 90
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1130
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1130
		}
	}
	if (p != (-1)) {
		ci = p
		if (ibit(13, ci)) {
			snd 27
			txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
			goto *label_1129
		}
		if (rpid == 200 | rpid == 202) {
			if (iSubname(ci) == 0 & iId(ci) != 566 & iId(ci) != 736) {
				snd 27
				txt -1, lang("それは無理だ。", "It's impossible.")
				goto *label_1129
			}
		}
		snd 17
		rpref(10 + step * 2) = ci, iId(ci)
		txt -1, lang(itemname(ci) + "を選んだ。", "You add " + itemname(ci) + ".")
		step++
		p = rpdiff(rpid, step, step - 1)
		if (rpid == 200) {
			rsikibetu = iSubname(ci)
			rpdata(40 + 0, rpid) = 0, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu
			if (rsikibetu == 343) {
				rsikibetu2 = inv(33, ci)
				rpdata(50 + 0, rpid) = 0, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2
			}
		}
		if (rpid == 202) {
			rsikibetu = iSubname(ci)
			rpdata(40 + 0, rpid) = 0, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu, 10000 + rsikibetu
			if (rsikibetu == 343) {
				rsikibetu2 = inv(33, ci)
				rpdata(50 + 0, rpid) = 0, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2, 10000 + rsikibetu2
			}
		}
		if (rpid == 204) {
			rsikibetu = iId(ci)
			rpdata(20 + 0, 204) = 52000, rsikibetu
		}
		if (rpid == 211) {
			rsikibetu = iId(ci)
			rpdata(20 + 0, 211) = 56000, rsikibetu
		}
		goto *label_1124
	}
	if (key == key_prev) {
		snd 1
		rppage--
		cs_bk = -1
		if (rppage < 0) {
			rppage = rppage(1)
		}
	}
	if (key == key_next) {
		snd 1
		rppage++
		cs_bk = -1
		if (rppage > rppage(1)) {
			rppage = 0
		}
	}
	if (key == key_cancel) {
		step--
		goto *label_1124
	}
*label_1130
	goto *label_1129
*label_1131
	goto *label_1623
*label_1132
	f = 1
	repeat 10
		if (rpref(10 + cnt * 2) == (-1)) {
			break
		}
		if (rpref(10 + cnt * 2) == (-2)) {
			f = 0
			break
		}
		if (iNumber(rpref(10 + cnt * 2)) <= 0 | iId(rpref(10 + cnt * 2)) != rpref(11 + cnt * 2)) {
			f = 0
			break
		}
	loop
	return f
*label_1133
	p = 0
	repeat 10
		if (rpref(10 + cnt * 2) == (-1)) {
			break
		}
		if (rpref(10 + cnt * 2) == (-2)) {
			continue
		}
		if (rpdata(2, rpid) > 0 & cnt == 0) {
		} else {
			if (rpresult) {
				if (rpdata(0, rpid) != 10017) {
					iNumber(rpref(10 + cnt * 2))--
				}
			} else {
				if (rnd(3) == 0) {
					txt -1, lang(itemname(rpref(10 + cnt * 2), 1) + "を失った。", "You lose " + itemname(rpref(10 + cnt * 2), 1) + ".")
					iNumber(rpref(10 + cnt * 2))--
				}
			}
			chara_unequip rpref(10 + cnt * 2)
			if (stat == 1) {
				r1 = 0
				gosub *chara_refresh
			}
		}
		cell_refresh iX(rpref(10 + cnt * 2)), iY(rpref(10 + cnt * 2))
	loop
	gosub *refreshPCBurdenState
	return 1
*label_1134
	rpresult = 1
	if (rpref(3) < rnd(100)) {
		rpresult = 0
		txtef 3
		txt -1, lang("調合失敗！", "The blending attempt failed!")
	} else {
		if (rpdata(0, rpid) >= 10000) {
			gosub *label_1136
		} else {
			flt
			nostack = 1
			itemcreate -1, rpdata(0, rpid), cX(0), cY(0), 0
			if (stat != 0) {
				repeat
					if (rpdata(50 + cnt * 2, rpid) == 0) {
						break
					}
					encadd ci, rpdata(50 + cnt * 2, rpid), rpdata(51 + cnt * 2, rpid), 0, 1
				loop
			}
			txtef 2
			txt -1, lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
			item_stack -1, ci
			if (iId(ci) == 792) {
				randomize iId(rpref(10 + 0 * 2)) + iId(rpref(10 + 1 * 2)) + iId(rpref(10 + 2 * 2))
				iParam1(ci) = ((rnd(50) + 1) * 10000) + ((rnd(20) + 1) * 10)
				randomize (iId(rpref(10 + 1 * 2)) * 2) + iId(rpref(10 + 1 * 2)) + iId(rpref(10 + 2 * 2))
				iParam2(ci) = ((rnd(50) + 1) * 10000) + ((rnd(20) + 1) * 10)
				randomize (iId(rpref(10 + 1 * 2)) * 2) + (iId(rpref(10 + 1 * 2)) * 2) + iId(rpref(10 + 2 * 2))
				iParam3(ci) = ((rnd(50) + 1) * 10000) + ((rnd(20) + 1) * 10)
				iValue(ci) = (iValue(rpref(10 + 0 * 2)) + iValue(rpref(10 + 1 * 2)) + iValue(rpref(10 + 2 * 2))) / 5
				randomize
			}
			snd 17
		}
		repeat 5
			if (rpdata(10 + cnt * 2, rpid) == 0) {
				break
			}
			skillexp2 rpdata(10 + cnt * 2, rpid), 0, 50 + rpdata(11 + cnt * 2, rpid) + rpref(2) / 10000 * 25, 2, 50
		loop
	}
	rpref(1)--
	gosub *label_1133
	return
*label_1135
	rpid = rpref(0)
	if (rpid == 0) {
		rowactend cc
		return
	}
	if (cContinuousActionId(cc) == 0) {
		txtnew
		txt -1, lang(name(cc) + "は" + rpname(rpid) + "の調合をはじめた。", name(cc) + " start" + _s(cc) + " blending of " + rpname(rpid) + ".")
		cContinuousActionId(cc) = 12
		cContinuousActionTurn(cc) = rpref(2) \ 10000
		return
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (rnd(30) == 0) {
			txtef 4
			txt -1, lang(" *こねこね* ", "*pug*"), lang(" *トントン* ", "*clank*")
		}
		return
	}
	if (rpref(2) >= 10000) {
		cContinuousActionTurn(cc) = rpref(2) / 10000
		repeat
			mode = 12
			gHour++
			gosub *label_1611
			redraw 0
			gosub *label_0625
			if (cnt \ 5 == 0) {
				txtef 4
				txt -1, lang(" *こねこね* ", "*pug*"), lang(" *トントン* ", "*clank*")
			}
			repeat 20
				redraw 0
				redraw 1
				await 30
			loop
			gMinute = 0
			cc = 0
			cContinuousActionTurn(cc)--
			if (cContinuousActionTurn(cc) <= 0) {
				gosub *label_1132
				if (stat == 0) {
					txt -1, lang("調合に必要な材料が見つからない。", "A required material cannot be found.")
					break
				}
				gosub *label_1134
				if (rpref(1) > 0) {
					cContinuousActionTurn(cc) = rpref(2) / 10000
					continue 0
				} else {
					break
				}
			}
		loop
		rowactend cc
		mode = 0
		return
	}
	gosub *label_1132
	if (stat == 0) {
		txt -1, lang("調合に必要な材料が見つからない。", "A required material cannot be found.")
		rowactend cc
		return
	}
	gosub *label_1134
	if (rpref(1) > 0) {
		cContinuousActionId(cc) = 0
		goto *label_1135
	}
	rowactend cc
	return
*label_1136
	ci = rpref(10 + 0 * 2)
	ti = rpref(10 + 1 * 2)
	_switch_val = rpdata(0, rpid)
	if (_switch_val == 10000 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang("人体錬成に成功した！あなたは禁忌を犯した…", "You successfully performed a human transmutation! You've violated a taboo of alchemy...")
		modkarma 0, -60
		flt
		novoidlv = 1
		clnum = -1
		nomagicdevice = 1
		noenchant = 1
		noencpfix = 1
		p = iSubname(ci)
		if (p == 343) {
			if (inv(33, ci) != usernpcmax) {
				initunid = inv(33, ci) + 1
			}
		}
		if (p == 368) {
			p = 176
		}
		characreate 56, p, -3, 0
		clnum = 0
		rc = 56
		if (cQuality(rc) >= 5) {
			cQuality(rc) = 5
		}
		gosub *label_1530
		repeat 245
			if (cnt < 16 | cRole(cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop")) {
				continue
			}
			if (cState(cnt) == 1) {
				turn_aggro cnt, 0, 80
			}
		loop
		ogdata(434)++
		gosub *label_1177
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10001 | _switch_sw) {
		_switch_sw = 0
		p = calccostreload(0, 1)
		txtef 2
		txt -1, lang("あなたは矢弾を充填した。", "You successfully reloaded all ammo in your inventory.")
		snd 90
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10002 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang("人形を作った。", "You successfully created a doll.")
		dbid = iSubname(ci)
		if (iSubname(ci) == 343) {
			if (inv(33, ci) != usernpcmax) {
				initunid = inv(33, ci) + 1
			}
		}
		flt
		characreate 56, dbid, -3, 0
		flt
		itemcreate -1, 745, cX(0), cY(0), 0
		iMaterial(ci) = 35
		collection_make ci, 56
		chara_vanquish 56
		cell_refresh cX(0), cY(0)
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10003 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang("あなたは収納家具を拡張した。", "You successfully extend the capacity of the container.")
		snd 58
		itemcreate -1, iId(ci), cX(0), cY(0), 0
		gNextInventorySerialId++
		iCount(ci) = gNextInventorySerialId
		ibitmod 5, ci, 1
		item_identify ci, 3
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10004 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang(itemname(ci) + "を調合して強化した。", "You successfully mixed and upgraded potions.")
		if (iEnhancement(ci) == 0 & iEnhancement(ti) == 0) {
			reinforcevalue = 1
		} else {
			reinforcevalue = iEnhancement(ci) + iEnhancement(ti)
		}
		if (iId(ci) == iId_milk | iId(ci) == iId_vomit) { // Has NPC name modifier.
			// If `ci` and `ti` are the same NPC's,
			if (iSubname(ci) == iSubname(ti)) {
				if (iSubname(ci) == cId_user) {
					if (inv(33, ci) == inv(33, ti) & inv(33, ci) != usernpcmax) {
						npcId@oomSEST = cId_user, inv(33, ci)
					}
				} else {
					npcId@oomSEST = iSubname(ci), 0
				}
			}
		}
		flt
		if (iId(ci) == iId_user) {
			inititemid = inv(31, ci) + 1
		}
		itemcreate -1, iId(ci), cX(0), cY(0), 0
		if (npcId@oomSEST) {
			iSubname(ci) = npcId@oomSEST
			inv(33, ci) = npcId@oomSEST(1)
			npcId@oomSEST = 0
		}
		if (iId(ci) == 792) {
			iParam1(ci) = iParam1(rpref(10 + 0 * 2))
			iParam2(ci) = iParam2(rpref(10 + 0 * 2))
			iParam3(ci) = iParam3(rpref(10 + 0 * 2))
		}
		iCurseState(ci) = 0
		iEnhancement(ci) = reinforcevalue
		item_identify ci, 3
		item_stack -1, ci
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10011 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang(itemname(ci) + "を合成して強化した。", "You successfully upgraded rods.")
		if (iEnhancement(ci) == 0 & iEnhancement(ti) == 0) {
			reinforcevalue = 1
		} else {
			reinforcevalue = iEnhancement(ci) + iEnhancement(ti)
		}
		reinforcestock = iCount(ci) + iCount(ti)
		flt
		itemcreate -1, iId(ci), cX(0), cY(0), 0
		iCurseState(ci) = 0
		iEnhancement(ci) = reinforcevalue
		iCount(ci) = reinforcestock
		item_identify ci, 3
		item_stack -1, ci
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (rpdata(2, rpid) == 2) {
		item_separate ci
	} else {
		if (iNumber(ci) <= 1) {
			rpref(10 + 0 * 2) = -2
		} else {
			if (rpdata(0, rpid) != 10017) {
				item_separate ci
				if (rpref(10 + 0 * 2) == stat) {
					rpref(10 + 0 * 2) = -2
				} else {
					rpref(10 + 0 * 2) = stat
				}
			} else {
				if (rpref(10 + 0 * 2) == stat) {
					rpref(10 + 0 * 2) = -2
				} else {
					rpref(10 + 0 * 2) = ci
				}
			}
		}
	}
	if (_switch_val == 10005 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang(itemname(ti, 1) + "を" + itemname(ci) + "に装着した。", "You bait " + itemname(ci) + " with " + itemname(ti, 1) + ".")
		if (iParam4(ci) == iParam1(ti)) {
			iCount(ci) += rnd(10) + 15
		} else {
			iCount(ci) = rnd(10) + 15
			iParam4(ci) = iParam1(ti)
		}
		snd 13
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10006 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang(itemname(ti, 1) + "を" + itemname(ci) + "に降りかけた。", "You shower " + itemname(ci) + " on " + itemname(ti, 1) + ".")
		if (ibit(18, ci)) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1137
		}
		if (iCurseState(ti) >= 1) {
			txtef 5
			txt -1, lang(itemname(ci) + "は銀色に輝いた。", itemname(ci) + " shine" + _s2(iNumber(ci)) + " silvery.")
			iCurseState(ci) = 1
			item_stack 0, ci, 1
		}
		if (iCurseState(ti) <= (-1)) {
			txtef 8
			txt -1, lang(itemname(ci) + "は黒いオーラに包まれた。", itemname(ci) + " " + is2(iNumber(ci)) + " wrapped by a dark aura.")
			iCurseState(ci) = -1
			item_stack 0, ci, 1
		}
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10007 | _switch_sw) {
		_switch_sw = 0
		txt -1, lang(itemname(ti, 1) + "を" + itemname(ci) + "に放り込んだ。", "You throw " + itemname(ci) + " into " + itemname(ti, 1) + ".")
		if (iId(ti) == 601) {
			txt -1, lang("空き瓶の割れる音がした。", "You hear the sound of the empty bottle shatters.")
			goto *label_1137
		}
		snd 17
		if (iId(ci) == 602) {
			txt -1, lang("井戸は汚れた。", "The holy well is polluted.")
			goto *label_1137
		}
		if (iParam3(ci) >= 20) {
			txt -1, lang(itemname(ci) + "は完全に枯れている。", itemname(ci) + " is completely dry.")
			goto *label_1137
		}
		txtef 2
		txt -1, lang(itemname(ci) + "は一瞬輝いた。", itemname(ci) + " shines for a moment.")
		if (iId(ti) == 587) {
			txt -1, lang("しかしこんな量では… ", "But the snow just melts.")
		} else {
			iParam1(ci) += rnd(3)
		}
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10008 | _switch_sw) {
		_switch_sw = 0
		if (iParam1(ci) < (-5) | iParam3(ci) >= 20 | (iId(ci) == 602 & gdata(250 + 10) <= 0)) {
			valn = itemname(ci)
			txt -1, lang(valn + "は涸れている。", valn + " is dry.")
			txt -1, lang("あっ！空き瓶を井戸に落としてしまった…", "Oops! You drop the empty bottle into the well...")
			goto *label_1137
		}
		if (inv_getfreeid(0) == (-1)) {
			item_num ti, 1
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			goto *label_1137
		}
		cibk = ci
		if (iId(ci) == 602) {
			gdata(250 + 10)--
			flt
			itemcreate 0, 516, -1, -1, 0
			if (stat != 0) {
				iCurseState(ci) = 1
			}
		} else {
			iParam1(ci) -= 3
			flt 20
			flttypemajor = 52000
			itemcreate 0, 0, -1, -1, 0
		}
		txt -1, lang("空き瓶に水をすくった。", "You draw water from the well into the empty bottle.")
		txtef 2
		txt -1, lang(itemname(ci, 1) + "を手に入れた。", "You get " + itemname(ci, 1) + ".")
		item_stack 0, ci, 1
		item_stack 0, ci
		ci = cibk
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10012 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang(itemname(ci, 1) + "は転移用の目印として機能するようになった。", itemname(ci, 1) + " now works as a teleporting marker.")
		ibitmod 20, ci, 1
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10013 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang(itemname(ci, 1) + "は転移用の目印としての機能を失った。", itemname(ci, 1) + " lost its magical power as a teleporting marker.")
		ibitmod 20, ci, 0
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10014 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		txt -1, lang(itemname(ci, 1) + "のレプリカを作成した。", "You successfully created a replica of " + itemname(ci, 1) + ".")
		oommap(cX(0), cY(0), 0) = iId(ci)
		oommap(cX(0), cY(0), 1) = iImage(ci)
		oommap(cX(0), cY(0), 2) = inv(31, ci)
		oommap(cX(0), cY(0), 3) = iColor(ci)
		oommap(cX(0), cY(0), 4) = ilight(iId(ci))
		oommap(cX(0), cY(0), 5) = inv(39, ci)
		snd 17
		goto *label_1137
		_switch_sw++
	}
	if (_switch_val == 10015 | _switch_sw) {
		_switch_sw = 0
		txtef 2
		if (oommap(cX(0), cY(0), 0) == 743) {
			s@00m = useritemdatan(1, oommap(cX(0), cY(0), 2))
		} else {
			s@00m = ioriginalnameref(oommap(cX(0), cY(0), 0))
		}
		txt -1, lang(s@00m + "のレプリカ（仮）を削除した。", "You successfully destroyed a replica of " + s@00m + ".")
		oommap(cX(0), cY(0), 0) = 0
		oommap(cX(0), cY(0), 1) = 0
		oommap(cX(0), cY(0), 2) = 0
		oommap(cX(0), cY(0), 3) = 0
		oommap(cX(0), cY(0), 4) = 0
		oommap(cX(0), cY(0), 5) = 0
		snd 17
		goto *label_1137
	}
	if (_switch_val == 10016 | _switch_sw) {
		_switch_sw = 0
		flt
		itemcreate -1, 792, cX(0), cY(0), 0
		iCurseState(ci) = 0
		iEnhancement(ci) = 0
		item_identify ci, 3
		item_stack -1, ci
		txtef 2
		txt -1, lang(itemname(ci) + "を調合した。", "You successfully Random potions.")
		snd 17
		goto *label_1137
		_switch_sw++
	}
	// ポーション濃縮　魔道具圧縮
	if (_switch_val == 10017 | _switch_sw) {
		_switch_sw = 0
		rodf = 0
		if (refitem(iId(rpref(10)), 5, rpref(10)) == 56000) {
			rodf = 1
		}
		nc_intb_100 = 0
		reinforcestock = 0
		reinforcevalue = 0
		txtef 2
		if (rodf == 1) {
			txt -1, lang(itemname(rpref(10)) + "を圧縮して強化した。", "You successfully concentrated and upgraded rods.")
			reinforcestock = iCount(rpref(10))
		} else {
			txt -1, lang(itemname(rpref(10)) + "を濃縮して強化した。", "You successfully concentrated and upgraded potions.")
		}
		reinforcevalue = iEnhancement(rpref(10))
		Repeat
			if (reinforcevalue >= sdata(178, 0)) {
				break
			}
			if (iNumber(rpref(10)) >= 2) {
				nc_intb_100 = 1
				iNumber(rpref(10)) -= 2
				if (iEnhancement(rpref(10)) == 0) {
						reinforcevalue += 1
				} else {
					if (cnt == 0) {
						reinforcevalue += iEnhancement(rpref(10))
					} else {
						reinforcevalue += (iEnhancement(rpref(10)) * 2)
					}
				}
			} else {
				break
			}
			if (rodf == 1) {
				if (reinforcestock > 0) {
					if (cnt == 0) {
						reinforcestock += iCount(rpref(10))
					} else {
						reinforcestock += (iCount(rpref(10)) * 2)
					}
				}
			}
		loop
		if (nc_intb_100) {
			if (iId(rpref(10)) == iId_milk | iId(rpref(10)) == iId_vomit) { // Has NPC name modifier.
				// If `ci` and `ti` are the same NPC's,
				if (iSubname(rpref(10)) == iSubname(ti)) {
					if (iSubname(rpref(10)) == cId_user) {
						if (inv(33, rpref(10)) == inv(33, ti) & inv(33, rpref(10)) != usernpcmax) {
							npcId@oomSEST = cId_user, inv(33, rpref(10))
						}
					} else {
						npcId@oomSEST = iSubname(rpref(10)), 0
					}
				}
			}
			flt
			if (iId(rpref(10)) == iId_user) {
				inititemid = inv(31, rpref(10)) + 1
			}
			itemcreate -1, iId(rpref(10)), cX(0), cY(0), 0
			if (npcId@oomSEST) {
				iSubname(ci) = npcId@oomSEST
				inv(33, ci) = npcId@oomSEST(1)
				npcId@oomSEST = 0
			}
			if (iId(ci) == 792) {
				iParam1(ci) = iParam1(rpref(10 + 0 * 2))
				iParam2(ci) = iParam2(rpref(10 + 0 * 2))
				iParam3(ci) = iParam3(rpref(10 + 0 * 2))
			}
			iCurseState(ci) = 0
			iEnhancement(ci) = reinforcevalue
			if (rodf == 1) {
				iCount(ci) = reinforcestock
			}
			item_identify ci, 3
			item_stack -1, ci
		}
		snd 17
		goto *label_1137
		_switch_sw++
	}
	// エロ本合成
	if (_switch_val == 10018 | _switch_sw) {
		_switch_sw = 0
		pornnpcId = 0, 0, 0, 0, 0, 0
		pornnpcId(0) = iParam1(ci)
		pornnpcId(1) = inv(33, ci)
		pornnpcId(2) = inv(34, ci)
		pornnpcId(3) = iParam1(ti)
		pornnpcId(4) = inv(33, ti)
		pornnpcId(5) = inv(34, ti)
		if (iNumber(ci) == 1) {
			iNumber(ci)--
		}
		flt
		itemcreate -1, iId(ci), cX(0), cY(0), 0
		iSubname(ci) = 30
		iImage(ci) = 429
		iColor(ci) = 0
		iParam1(ci) = pornnpcId(0)
		inv(33, ci) = pornnpcId(1)
		inv(34, ci) = pornnpcId(2)
		iParam2(ci)	= pornnpcId(3)
		if (pornnpcId(3) == 343) {
			iParam3(ci)	= pornnpcId(4)
			inv(16, ci)	= pornnpcId(5)
		}
		iEnhancement(ci) = rnd(sdata(150, 0) / 10) + (sdata(150, 0) / 15)
		iValue(ci) += (iEnhancement(ci) * 150)
		iCurseState(ci) = 0
		item_identify ci, 3
		item_stack -1, ci
		txtef 2
		txt -1, lang(itemname(ci) + "を作成した。", "Created an" + itemname(ci) + ".")
		snd 17
		goto *label_1137
		_switch_sw++
	}
	// 伝承本
	if (_switch_val == 10019 | _switch_sw) {
		_switch_sw = 0
		iNumber(ci)--
		flt
		itemcreate -1, iId(ci), cX(0), cY(0), 0
		iQuality(ci) = 6
		ibitmod 5, ci, 1
		item_identify ci, 3
		iCount(ci) = 1
		item_stack -1, ci
		txtef 2
		txt -1, lang(itemname(ci) + "を作成した。", "Created an" + itemname(ci) + ".")
		snd 17
		goto *label_1137
		_switch_sw++
	}
*label_1137
	item_stack 0, ci
	if (iBodyPart(ci) != 0) {
		create_pcpic 0, 1
	}
	if (inv_getowner(ci) == (-1)) {
		cell_refresh iX(ci), iY(ci)
	}
	r1 = 0
	gosub *chara_refresh
	return



#defcfunc txtitemoncell int __sss, int __ttt, int __uuu
	cell_itemoncell __sss, __ttt
	if (stat <= 3) {
		if (map(__sss, __ttt, 5) < 0) {
			rtvaln = ""
			p@m185 = -map(__sss, __ttt, 5), 0
			i@m185 = p@m185 \ 1000 + 5080, p@m185 / 1000 \ 1000 + 5080, p@m185 / 1000000 \ 1000 + 5080
			repeat 3
				if (i@m185(cnt) == 999 + 5080) {
					continue
				}
				if (p@m185(1) != 0) {
					rtvaln += lang("と", " and ")
				}
				rtvaln += itemname(i@m185(cnt))
				p@m185(1)++
			loop
		} else {
			rtvaln = itemname(rtval(1))
		}
		nc_ctalkbuff_str = rtvaln
		if (iOwnState(rtval(1)) <= 0) {
			if (__uuu == 0) {
				if (scposval_nc == 0) {
					ctalk 0, 10101, 0, tc
				}
				if (stat == 0 | scposval_nc) {
					return lang(rtvaln + "が落ちている。", "You see " + rtvaln + " here.")
				}
				return ""
			}
			return lang(rtvaln + "が落ちている。", "You see " + rtvaln + " here.")
		} else {
			if (iOwnState(rtval(1)) == 3) {
				if (scposval_nc == 0) {
					ctalk 0, 10102, 0, tc
				}
				if (stat == 0 | scposval_nc) {
					return lang(rtvaln + "が設置されている。", "" + rtvaln + " is constructed here.")
				}
				return ""
			} else {
				if (scposval_nc == 0) {
					ctalk 0, 10103, 0, tc
				}
				if (stat == 0 | scposval_nc) {
					return lang(rtvaln + "がある。", "You see " + rtvaln + " placed here.")
				}
				return ""
			}
		}
	} else {
		nc_ctalkbuff_int = rtval
		if (scposval_nc == 0) {
			ctalk 0, 10104, 0, tc
		}
		if (stat == 0 | scposval_nc) {
			return lang("ここには" + rtval + "種類のアイテムがある。", "There are " + rtval + " items lying here.")
		}
		return ""
	}
*label_1139
	goto *label_1141



#deffunc txttargetnpc int __uuu, int __vvv, int __www
	dy@m186 = 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	if (__www == 0) {
		if (fov_los(cX(0), cY(0), __uuu, __vvv) == 0 | dist(cX(0), cY(0), __uuu, __vvv) > cVisionDistance(0) / 2) {
			pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
			dy@m186++
			color 0, 0, 0
			bmes lang("視界範囲外", "This location is out of sight."), 255, 255, 255
			cansee = 0
			return
		}
	}
	if (map(__uuu, __vvv, 1) != 0) {
		i@m186 = map(__uuu, __vvv, 1) - 1
		if (cbit(6, i@m186) == 0 | cbit(7, 0) | cWet(i@m186)) {
			tc = i@m186
			if (cfg_targetex == 1) {
				hack_targetex = 1
				if (cfg_targetbuff == 1) {
					hack_targetex = 2
					gmode 4, , , 180
					_mesx = 100
					repeat 8 + 8 - 1
						if (ocdata(192 + cnt * 3, tc) != 0) {
							_tes = ""
							color 0, 0, 0
							pos _mesx, windowh - inf_verh - 45 - dy@m186 * 20 - 10
							gcopy 5, ocdata(192 + cnt * 3, tc) \ 50 * 32, buffy(ocdata(192 + cnt * 3, tc)), 32, 32
							pos _mesx + 2, windowh - inf_verh - 45 - dy@m186 * 20 + 18 - 10
							bmes "" + ocdata(192 + cnt * 3 + 2, tc), 255, 255, 255
							_mesx += 32
						} else {
							break
						}
					loop
					if (_mesx != 100) {
						dy@m186++
					}
				}
				if (cfg_targetbullet == 1) {
					hack_targetex = 2
					dim cwlist@00m, 30
					cwlistmax@00m = 0
					ammo = -1
					repeat 30
						body = 100 + cnt
						cwlist@00m(cwlistmax@00m) = -1
						if (cdata(body, tc) \ 10000 == 0) {
							continue
						}
						if (cdata(body, tc) / 10000 == 5) {
							cwlist@00m(cwlistmax@00m) = cdata(body, tc) \ 10000 - 1
							cwlistmax@00m++
						}
						if (cdata(body, tc) / 10000 == 10) {
							cwlist@00m(cwlistmax@00m) = cdata(body, tc) \ 10000 - 1
							cwlistmax@00m++
						}
						if (cdata(body, tc) / 10000 == 11) {
							ammo = cdata(body, tc) \ 10000 - 1
						}
					loop
					f@00m = 0
					if (ammo != (-1) & cwlistmax@00m > 0) {
						repeat cwlistmax@00m
							if (cwlist@00m(cnt) != (-1)) {
								if (iSkill(cwlist@00m(cnt)) == iSkill(ammo)) {
									f@00m = 1
									break
								}
							}
						loop
					}
					if (f@00m == 1 & tc < 16) {
						_mesx = 100
						if (tc == 0) {
							bullet_ci = ammo
							bullet_listmax = 0
							dim bullet_list
							bullet_cs = -1
							f = 0
							repeat 15
								if (iEnchantmentId(bullet_ci, cnt) == 0) {
									break
								}
								enc = iEnchantmentId(bullet_ci, cnt)
								i = enc / 10000
								if (i != 0) {
									enc = enc \ 10000
									if (i == 9) {
										if (iCount(bullet_ci) == cnt) {
											bullet_cs = cnt
										}
										bullet_list(0, bullet_listmax) = cnt
										bullet_listmax++
										continue
									}
								}
							loop
							repeat bullet_listmax + 1
								_tes = ""
								if (cnt == 0) {
								} else {
									p = bullet_list(0, cnt - 1)
									i = iEnchantmentPower(bullet_ci, p) \ 1000, iEnchantmentPower(bullet_ci, p) / 1000
									_tes += ammoname(iEnchantmentId(bullet_ci, p) \ 10000) + ":" + i + "/" + i(1)
									color 0, 0, 0
									pos _mesx, windowh - inf_verh - 45 - dy@m186 * 20 - 10
									if (iCount(bullet_ci) == cnt - 1) {
										_tes = "[" + _tes + "]"
										color 255, 0, 0
										f = 1
									}
									bmes _tes, 255, 255, 255
									_mesx += ginfo(14) + 10
								}
							loop
						} else {
							bullet_ammotype = 0
							repeat 15
								bullet_val(0) = iEnchantmentId(ammo, cnt) / 10000
								bullet_val(1) = iEnchantmentId(ammo, cnt) \ 10000
								bullet_val(2) = inv(41 + cnt * 2, ammo) / 1000
								bullet_val(3) = inv(41 + cnt * 2, ammo) \ 1000
								if (bullet_val(0) == 9) {
									_tes = ammoname(bullet_val(1)) + ":" + bullet_val(3) + "/" + bullet_val(2)
									color 0, 0, 0
									pos _mesx, windowh - inf_verh - 45 - dy@m186 * 20 - 10
									if (ocdata(9, tc) - 1 == bullet_val(1)) {
										if (bullet_val(3) != 0) {
											bullet_ammotype = 1
											_tes = "[" + _tes + "]"
											color 255, 0, 0
											f = 1
										}
									}
									bmes _tes, 255, 255, 255
									_mesx += ginfo(14) + 10
								}
							loop
						}
						_tes = lang("通常弾", "Normal ammo")
						color 0, 0, 0
						if (f == 0) {
							_tes = "[" + _tes + "]"
							color 255, 0, 0
						}
						pos _mesx, windowh - inf_verh - 45 - dy@m186 * 20 - 10
						bmes _tes, 255, 255, 255
						dy@m186++
					}
				}
				if (cfg_targetdebuff != 0) {
					hack_targetex = 3
					_tes = ""
					if (jp) {
						_tes2 = "毒", "眠り", "麻痺", "盲目", "混乱", "恐怖", "朦朧", "酔い", "出血", "濡れ", "狂気", "病気", "重力", "もち", "怒り", "催淫", "石化"
					} else {
						_tes2 = "Poisoned", "Sleep", "Paralyzed", "Blinded", "Confused", "Fear", "Dimmed", "Drunk", "Bleeding", "Wet", "Insane", "Sick", "Gravity", "Choked", "Fury", "Aphrodisiac", "Stoned"
					}
					_mesx = 100
					repeat 17
						if (cnt == 16) {
							if (cStoned(tc) != 0) {
								_tes = _tes2(cnt)
								if (cfg_targetdebuff == 2) {
									_tes += ":" + cStoned(tc)
								}
								color 0, 0, 0
								pos _mesx, windowh - inf_verh - 45 - dy@m186 * 20 - 10
								bmes _tes, 255, 255, 255
								_mesx += ginfo(14) + 5
							}
							continue
						}
						if (cdata(250 + cnt, tc) != 0) {
							_tes = _tes2(cnt)
							if (cfg_targetdebuff == 2) {
								_tes += ":" + cdata(250 + cnt, tc)
							}
							color 0, 0, 0
							pos _mesx, windowh - inf_verh - 45 - dy@m186 * 20 - 10
							bmes _tes, 255, 255, 255
							_mesx += ginfo(14) + 5
						}
					loop
					if (_tes != "") {
						dy@m186++
					}
				}
				if (cfg_targetresist == 1) {
					hack_targetex = 4
					_tes = ""
					_mesx = 100
					repeat 11
						i@m66 = cnt + 50
						colorres
						_tes = skillname(50 + cnt) + ":" + limit(sdata(50 + cnt, tc) / 50, -1, 10) + ""
						pos _mesx, windowh - inf_verh - 45 - dy@m186 * 20 - 10
						bmes _tes, 255, 255, 255
						_mesx += ginfo(14) + 5
					loop
					dy@m186++
				}
				if (cfg_targetlockon == 1 & existfile_target == 1) {
					hack_targetex = 5
					repeat ocdata(155, tc)
						if (ocdata(150 + cnt, tc) != 0) {
							_x = (cX(ocdata(150 + (ocdata(155, tc) - cnt - 1), tc) - 1) - scx) * inf_tiles + inf_screenx
							_y = (cY(ocdata(150 + (ocdata(155, tc) - cnt - 1), tc) - 1) - scy) * inf_tiles + inf_screeny
							if (_y < windowh - inf_barh - inf_msgh) {
								pos _x, _y
								color 0, 0, 0
								gmode 4, , , 128
								gcopy 99, 0, 0, 48, 48
								pos _x + 5, _y + 48 - 15
								bmes "" + (ocdata(155, tc) - cnt), 255, 255, 255
							}
						}
					loop
					repeat ocdata(161, tc)
						if (ocdata(156 + cnt, tc) != 0) {
							_x = (cX(ocdata(156 + (ocdata(161, tc) - cnt - 1), tc) - 1) - scx) * inf_tiles + inf_screenx
							_y = (cY(ocdata(156 + (ocdata(161, tc) - cnt - 1), tc) - 1) - scy) * inf_tiles + inf_screeny
							if (_y < windowh - inf_barh - inf_msgh) {
								pos _x, _y
								color 0, 0, 0
								gmode 4, , , 128
								gcopy 99, 48, 0, 96, 48
								pos _x + 5, _y + 48 - 15
								bmes "" + (ocdata(161, tc) - cnt), 255, 255, 255
							}
						}
					loop
					gmode 2
				}
				hack_targetex = 6
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
				_tes = ""
				if (cfg_targetstat == 1) {
					// E.g., HP: 10%  MP: 10%
					_tes = "HP: " + int(1.0 * cHp(tc) / cMaxHp(tc) * 100) + "%  MP: " + int(1.0 * cMp(tc) / cMaxMp(tc) * 100) + "%"
					bmes _tes, 255, 255, 255
					dy@m186++
				} elseif (cfg_targetstat == 2) {
					// E.g., HP: 10/100 (10%)  MP: 10/100 (10%)
					_tes = "HP: " + cHp(tc) + "/" + cMaxHp(tc) + " (" + int(1.0 * cHp(tc) / cMaxHp(tc) * 100) + "%)  MP: " + cMp(tc) + "/" + cMaxMp(tc) + " (" + int(1.0 * cMp(tc) / cMaxMp(tc) * 100) + "%)"
					bmes _tes, 255, 255, 255
					dy@m186++
				}
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
				if (tc > 15) {
					txttargetlevel
					s = " - " + s
				} else {
					s = ""
				}
				s@00m = ""
				if (cfg_targetclass == 1) {
					dbidn = cdatan(3, tc)
					dbmode = 2
					gosub *label_1526
					if (cId(tc) == 343) {
						if (userdatan2(1, cCnpcId(tc)) != "") {
							classname = userdatan2(1, cCnpcId(tc))
						}
					}
					s@00m += lang(" [職業 ", " [Class: ") + classname + "] "
				}
				s@se = ""
				if (gWizard) {
					s@se = "(" + i@m186 + ")"
				}
				bmes "" + s@se + name(i@m186) + s@00m + lang(" (距離 ", " (Distance ") + dist(cX(0), cY(0), cX(i@m186), cY(i@m186)) + ")" + s, 255, 255, 255
				dy@m186++
			} else {
				txttargetlevel
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
				dy@m186++
				bmes s, 255, 255, 255
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
				dy@m186++
				dbidn = cdatan(3, tc)
				dbmode = 2
				gosub *label_1526
				if (cId(tc) == 343) {
					if (userdatan2(1, cCnpcId(tc)) != "") {
						classname = userdatan2(1, cCnpcId(tc))
					}
				}
				bmes lang("現在のターゲットは", "You are targeting ") + name(i@m186) + lang(" (距離 ", ". (Distance ") + dist(cX(0), cY(0), cX(i@m186), cY(i@m186)) + ")", 255, 255, 255
			}
			hack_targetex = 0
		}
	}
	if (map(__uuu, __vvv, 5) != 0) {
		color 0, 0, 0
		pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
		dy@m186++
		bmes txtitemoncell(__uuu, __vvv, 1), 255, 255, 255
	}
	if (oommap(__uuu, __vvv, 0) != 0) {
		color 0, 0, 0
		pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
		dy@m186++
		if (oommap(__uuu, __vvv, 0) == 743) {
			bmes useritemdatan(1, oommap(__uuu, __vvv, 2)) + "のレプリカがある。", 255, 255, 255
		} else {
			bmes ioriginalnameref(oommap(__uuu, __vvv, 0)) + "のレプリカがある。", 255, 255, 255
		}
	}
	if (cfg_notforsale) {
		if (mapbit(3, __uuu, __vvv) == 1) {
			color 0, 0, 0
			pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
			dy@m186++
			bmes "ここは非売品エリアだ。", 255, 255, 255
		}
	}
	if (map(__uuu, __vvv, 6) != 0) {
		if (mapType == 1) {
			if (map(__uuu, __vvv, 6) / 1000 \ 100 == 15) {
				p@m186 = map(__uuu, __vvv, 6) / 100000 \ 100 + map(__uuu, __vvv, 6) / 10000000 * 100
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
				dy@m186++
				bmes mapname(p@m186, 1), 255, 255, 255
			}
			if (map(__uuu, __vvv, 6) / 1000 \ 100 == 34) {
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - dy@m186 * 20 - 10
				dy@m186++
				bmes txtbuilding(map(__uuu, __vvv, 6) / 100000 \ 100, map(__uuu, __vvv, 6) / 10000000), 255, 255, 255
			}
		}
	}
	cansee = 1
	return
*label_1141



#deffunc key_direction
	kdx = 0
	kdy = 0
	if (key == key_north) {
		kdy--
		return 1
	}
	if (key == key_south) {
		kdy++
		return 1
	}
	if (key == key_west) {
		kdx--
		return 1
	}
	if (key == key_east) {
		kdx++
		return 1
	}
	if (key == key_northwest) {
		kdx--
		kdy--
		return 1
	}
	if (key == key_northeast) {
		kdx++
		kdy--
		return 1
	}
	if (key == key_southwest) {
		kdx--
		kdy++
		return 1
	}
	if (key == key_southeast) {
		kdx++
		kdy++
		return 1
	}
	return 0
*label_1143
	if (cfg_extrahelp) {
		if (gdata(200 + 17) == 0) {
			if (mode == 0) {
				if (cContinuousActionTurn(0) == 0) {
					gdata(200 + 17) = 1
					ghelp = 17
					gosub *label_1575
					screenupdate = -1
					gosub *label_0623
					goto *label_1623
				}
			}
		}
	}
	if ((dbg_noautosave == 0 | gettrait(0, 190) < 0) & gWizard == 0) {
		snd 44
		gosub *label_1339
		txtef 5
		txt -1, lang(" *保存* ", "*saving*")
	}
	txt -1, lang("あなたはゲートに足を踏み入れた。ゲートはあなたの背後で消滅した。", "You stepped into the gate. The gate disappears.")
	iNumber(ci)--
	cell_refresh iX(ci), iY(ci)
	if (cfg_net == 0) {
		if (jp) {
			txt -1, lang("ネット機能をONにする必要がある。", "You have to turn on network setting.")
			gosub *label_0623
			goto *label_1623
		}
	}
	listmax = 0
	net_dllist ".eum", 0
	if (listmax == 0 | stat == 0) {
		txt -1, lang("あれ…どこにも繋がっていない… ", "Hmmm...the gate isn't connected to anywhere.")
		gosub *label_0623
		goto *label_1623
	}
	buff = ""
	notesel buff
	exist exedir + "user\\showroom_log.txt"
	if (strsize != (-1)) {
		noteload exedir + "user\\showroom_log.txt"
	}
	repeat 500
		p = rnd(listmax)
		if (cfg_moongatejump == 0) {
			break
		}
		if (cfg_moongatejump == 1) {
			noteget s, 0
			if (s != listn(0, p)) {
				break
			}
		}
		if (cfg_moongatejump == 2) {
			if (instr(buff, 0, listn(0, p)) == (-1)) {
				break
			}
		}
	loop
	noteunsel
	net_dl "" + list(1, p) + ".eum", "temp.eum"
	usermapid = list(1, p)
	if (stat == 0) {
		txt -1, lang("ファイルの取得に失敗した。", "Failed to retrieve designated files.")
		gosub *label_0623
		goto *label_1623
	}
	userfile = "temp.eum"
	bload exedir + "user\\" + userfile, headtemp, 1024
	notesel headtemp
	noteget s, 5
	noteget s(1), 6
	username = "" + s
	userrelation = int(s(1))
	gosub *label_1649
	msg_halt
	goto *label_1340
*label_1144
	if ((dbg_noautosave == 0 | gettrait(0, 190) < 0) & gWizard == 0) {
		snd 44
		gosub *label_1339
		txtef 5
		txt -1, lang(" *保存* ", "*saving*")
	}
	snd 26
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	sdim headtemp, 1024
	p(91) = 0
	if (comctrl == 0 | comctrl == 2) {
		getuserfiledata "eum", p(91)
	}
	if (comctrl == 1) {
		getuserfiledata "ept", p(91)
	}
	folder = exedir + "user\\"
	repeat p(91)
		oomSEST_log "showRoom_update:2" + " dir:" + userfilelist(1, cnt) + " file:" + userfilelist(0, cnt)
		sreplace file, userfilelist(1, cnt) + userfilelist(0, cnt), folder, ""
		if (file == "temp.eum" | file == "temp.ept") {
			continue
		}
		bload folder + file, headtemp, 1024
		notesel headtemp
		noteget s, 0
		noteget s(1), 1
		noteget s(2), 4
		list(0, listmax) = listmax, 0, int(s(2))
		listn(0, listmax) = "(" + file + ") " + s + " " + s(1), file
		listmax++
		noteunsel
	loop
	if (cfg_net != 0) {
		if (comctrl == 1) {
			net_dllist ".ept", 1
		}
		if (comctrl == 2) {
			net_dllist ".eum", 1
		}
	}
	if (comctrl == 0 | comctrl == 2) {
		exist exedir + "user\\showroom_log.txt"
		if (strsize != (-1)) {
			notesel buff
			noteload exedir + "user\\showroom_log.txt"
			noteunsel
			repeat listmax
				if (instr(buff, 0, listn(0, cnt)) != (-1)) {
					listn(0, cnt) = "*" + listn(0, cnt)
				}
			loop
		}
		txt -1, lang("どのルームを訪問する？ ", "Which room do you want to visit? ")
	}
	if (comctrl == 1) {
		txt -1, lang("どのチームと対戦する？", "Which team do you want to play a match? ")
	}
	windowshadow = 1
*label_1145
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1146
	redraw 0
	if (comctrl == 0 | comctrl == 2) {
		s = lang("ルーム一覧", "Room List")
	}
	if (comctrl == 1) {
		s = lang("ペットチーム一覧", "Team List")
	}
	s(1) = lang("BackSpace [削除]  ", "BackSpace [Delete]  ") + strhint2 + strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	if (comctrl == 0 | comctrl == 2) {
		s = lang("ルームの名称", "Name")
	}
	if (comctrl == 1) {
		s = lang("チームの名称", "Name")
	}
	display_topic s, wx + 28, wy + 36
	display_topic "Ver", wx + 534, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		s = listn(0, p)
		cutname s, 64
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		pos wx + 570, wy + 66 + cnt * 19
		mes "" + (list(2, p) \ 1000 + 1) + ".0"
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		if (p == (-999)) {
			snd 27
			txt -1, lang("互換性のないバージョンのファイルです。", "Selected item is incompatible.")
			goto *label_1145
		}
		folder = exedir + "user\\"
		if (listn(1, p) == "net") {
			if (comctrl == 1) {
				s = ".ept"
			} else {
				s = ".eum"
			}
			net_dl "" + list(1, p) + s, "temp" + s
			usermapid = list(1, p)
			if (stat == 0) {
				txt -1, lang("ファイルの取得に失敗した。", "Failed to retrieve designated files.")
				goto *label_1145
			}
			userfile = "temp" + s
		} else {
			userfile = listn(1, p)
		}
		bload folder + userfile, headtemp, 1024
		notesel headtemp
		noteget s, 5
		noteget s(1), 6
		if (comctrl == 0 | comctrl == 2) {
			username = "" + s
			userrelation = int(s(1))
			gosub *label_1649
		}
		if (comctrl == 1) {
			rtval = int(s), int(s(1))
		}
		return 1
	}
	getkey a, 8
	if (ginfo(2) == 0) {
		if (p(91) != 0) {
			if (a == 1) {
				userfile = listn(1, cs + pagesize * page)
				exist exedir + "user\\" + userfile
				if (strsize == (-1)) {
					goto *label_1145
				}
				txt -1, lang("本当に" + userfile + "を削除する？ ", "Do you really want to delete " + userfile + "? ")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval == 0) {
					delete exedir + "user\\" + userfile
					goto *label_1144
				}
				goto *label_1145
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1145
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1145
		}
	}
	if (key == key_cancel) {
		gosub *label_0623
		return 0
	}
	goto *label_1146
*label_1147
*label_1148
	if (tlocinitx != 0 | tlocinity != 0 | homemapmode == 1) {
		tlocx = tlocinitx
		tlocy = tlocinity
	} else {
		tlocx = cX(cc)
		tlocy = cY(cc)
	}
	scposval_nc = 1
	if (homemapmode) {
		scposval = 0
	} else {
		scposval = 1
		if (ocdata(155, 0) == 0) {
			gosub *label_1295
		}
		if (ocdata(155, 0)) {
			gosub *label_1301
			if (listmax == 0) {
				txt -1, lang("視界内にターゲットは存在しない。", "You look around and find nothing.")
			}
			repeat listmax
				if (list(0, cnt) == 0) {
					continue
				}
				if (list(0, cnt) == ocdata(150, 0) - 1) {
					tlocx = cX(list(0, cnt))
					tlocy = cY(list(0, cnt))
					break
				}
			loop
		}
	}
*label_1149
	screenupdate = -1
	gosub *label_0623
	dx = (tlocx - scx) * inf_tiles + inf_screenx
	dy = (tlocy - scy) * inf_tiles + inf_screeny
	if (dy + inf_tiles <= windowh - inf_verh) {
		pos dx, dy * (dy > 0)
		gfini inf_tiles - (dx + inf_tiles > windoww) * (dx + inf_tiles - windoww), inf_tiles + (dy < 0) * inf_screeny - (dy + inf_tiles > windowh - inf_verh) * (dy + inf_tiles - windowh + inf_verh)
		gfinc 50, 50, 100
	}
	if (homemapmode == 1) {
		pos windoww - 80, 20
		gcopy 2, tile \ 33 * inf_tiles, tile / 33 * inf_tiles, inf_tiles, inf_tiles
	}
	if (homemapmode == 2) {
		f = 0
		repeat inf_screenh
			y = cnt
			repeat inf_screenw
				x = cnt
				xx = x + scx
				yy = y + scy
				if (mapbit(3, xx, yy) == 1) {
					xx = x * inf_tiles + inf_screenx
					yy = y * inf_tiles + inf_screeny
					w = inf_tiles - (xx + inf_tiles > windoww) * (xx + inf_tiles - windoww)
					h = inf_tiles - (yy + inf_tiles > windowh - inf_verh) * (yy + inf_tiles - (windowh - inf_verh))
					if (yy < 0) {
						h += yy
						yy = 0
					}
					pos xx, yy
					gfini w, h
					gfinc 100, 0, 0
				}
				f = 1 - f
			loop
		loop
	}
	if (homemapmode == 0) {
		rc = -1
		repeat 1
			if (map(tlocx, tlocy, 1) <= 1) {
				break
			}
			rc = map(tlocx, tlocy, 1) - 1
			if (synccheck(rc, -1) == 0) {
				break
			}
			if (fov_los(cX(cc), cY(cc), cX(rc), cY(rc)) == 0) {
				break
			}
			if ((cbit(6, rc) == 0 | cbit(7, 0) | cWet(rc)) == 0) {
				break
			}
			get_route cX(cc), cY(cc), cX(rc), cY(rc)
			dx = (tlocx - scx) * inf_tiles + inf_screenx
			dy = (tlocy - scy) * inf_tiles + inf_screeny
			if (maxroute != 0) {
				dx = cX(cc)
				dy = cY(cc)
				repeat 100
					route_info dx, dy, cnt
					if (stat == 0) {
						break
					} else {
						if (stat == (-1)) {
							continue
						}
					}
					sx = (dx - scx) * inf_tiles + inf_screenx
					sy = (dy - scy) * inf_tiles + inf_screeny
					if (sy + inf_tiles <= windowh - inf_verh) {
						pos sx, sy * (sy > 0)
						gfini inf_tiles - (sx + inf_tiles > windoww) * (sx + inf_tiles - windoww), inf_tiles + (sy < 0) * inf_screeny - (sy + inf_tiles > windowh - inf_verh) * (sy + inf_tiles - windowh + inf_verh)
						gfinc 25, 25, 25
					}
				loop
			}
		loop
	}
	txttargetnpc tlocx, tlocy
	redraw 1
	await cfg_wait1
	key_check
	if (homemapmode == 1 | homemapmode == 2) {
		if (key == key_enter) {
			if (homemapmode == 1) {
				gosub *label_1156
				keyrelease
			} else {
				repeat mapHeight
					y = cnt
					repeat mapWidth
						x = cnt
						if (mapbit(3, x, y) == 1) {
							mapbitmod 3, x, y, 0
						} else {
							mapbitmod 3, x, y, 1
						}
					loop
				loop
			}
			goto *label_1150
		}
		stick a, 768
		lbtn = 0
		rbtn = 0
		if (a == 256) {
			lbtn = 1
			key = key_enter
		}
		if (a == 512) {
			rbtn = 1
			if (homemapmode == 1) {
				tile = map(tlocx, tlocy, 0)
				snd 5
				keyrelease
			} else {
				key = key_enter
			}
		}
		tx = limit(mousex - inf_screenx, 0, windoww) / 48
		ty = limit(mousey - inf_screeny, 0, windowh - inf_verh) / 48
		key_direction
		if (stat == 1) {
			cX(0) += kdx
			cY(0) += kdy
			if (cX(0) < 0) {
				cX(0) = 0
			} else {
				if (cX(0) >= mapWidth) {
					cX(0) = mapWidth - 1
				}
			}
			if (cY(0) < 0) {
				cY(0) = 0
			} else {
				if (cY(0) >= mapHeight) {
					cY(0) = mapHeight - 1
				}
			}
		}
		tlocx = tx + scx
		if (tlocx < 0) {
			tlocx = 0
		} else {
			if (tlocx >= mapWidth) {
				tlocx = mapWidth - 1
			}
		}
		tlocy = ty + scy
		if (tlocy < 0) {
			tlocy = 0
		} else {
			if (tlocy >= mapHeight) {
				tlocy = mapHeight - 1
			}
		}
	} else {
		key_direction
		if (stat == 1) {
			x = tlocx + kdx
			y = tlocy + kdy
			if (x >= 0 & y >= 0 & x < mapWidth & y < mapHeight) {
				tlocx += kdx
				tlocy += kdy
			}
		}
	}
	if (findlocmode == 1) {
		if (rc == (-1)) {
			i = 0
		} else {
			i = rc
		}
		f = 0
		p = 0
		repeat listmax
			if (cX(list(0, cnt)) == cX(i)) {
				if (cY(list(0, cnt)) == cY(i)) {
					p = cnt
					break
				}
			}
		loop
		if (key == key_pageup) {
			p++
			f = 1
			if (p >= listmax) {
				p = 0
			}
		}
		if (key == key_pagedown) {
			p--
			f = 1
			if (p < 0) {
				p = listmax - 1
				if (p < 0) {
					p = 0
				}
			}
		}
		i = list(0, p)
		if (f) {
			snd 5
			tlocx = cX(list(0, p))
			tlocy = cY(list(0, p))
		}
	}
	if (key == key_enter) {
		if (homemapmode == 2) {
			if (lbtn) {
				return 2
			}
			if (rbtn) {
				return 1
			}
			return 0
		}
		if (findlocmode == 1) {
			if (cansee == 0 | (chipm(7, map(tlocx, tlocy, 0)) & 4)) {
				txt -1, lang("その場所は見えない。", "You can't see the location.")
				goto *label_1150
			}
			snd 20
			if (rc > 0) {
				lockon 0, rc, 8
				txt -1, lang(name(rc) + "をターゲットにした。", "You target " + name(rc) + ".")
			} else {
				tgloc = 1
				tglocx = tlocx
				tglocy = tlocy
				txt -1, lang("地面をターゲットにした。", "You target the ground.")
				unlockson 0
			}
		} else {
			if (homemapmode == 0) {
				snd 5
			}
		}
		scposval = 0
		if (tlocinitx == 0 & tlocinity == 0 & homemapmode != 1) {
			scposval = 0
			scposval_nc = 0
			gosub *label_0623
		}
		tlocinitx = 0
		tlocinity = 0
		return cansee
	}
	if (key == key_cancel) {
		tlocinitx = 0
		tlocinity = 0
		scposval = 0
		scposval_nc = 0
		gosub *label_0623
		return -1
	}
*label_1150
	goto *label_1149
*label_1151
*label_1152
	oomSEST_log "com_target"
	page = 0
	pagesize = 16
	cs_bk = -1
	gosub *label_1301
	if (listmax == 0) {
		msgdup++
		txt -1, lang("視界内にターゲットは存在しない。", "You look around and find nothing.")
		gosub *label_0623
		goto *label_1623
	}
	cs = 0
	repeat listmax
		if (list(0, cnt) == ocdata(150, 0) - 1) {
			cs = cnt \ pagesize
			page = cnt / pagesize
		}
	loop
*label_1153
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1154
	if (cs != cs_bk) {
		screenupdate = -1
		gosub *label_0623
		keyrange = 0
		font lang(cfg_font1, cfg_font2), 20 - en * 2, 1
		color 255, 255, 255
		repeat pagesize
			p = pagesize * page + cnt
			if (p >= listmax) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange++
			x = list(1, p) - scx
			y = list(2, p) - scy
			if (cs == cnt) {
				i = p
				get_route cX(cc), cY(cc), cX(list(0, p)), cY(list(0, p))
				dx = (tlocx - scx) * inf_tiles + inf_screenx
				dy = (tlocy - scy) * inf_tiles + inf_screeny
				if (maxroute != 0) {
					dx = cX(cc)
					dy = cY(cc)
					repeat 100
						route_info dx, dy, cnt
						if (stat == 0) {
							break
						} else {
							if (stat == (-1)) {
								continue
							}
						}
						sx = (dx - scx) * inf_tiles + inf_screenx
						sy = (dy - scy) * inf_tiles + inf_screeny
						if (sy + inf_tiles <= windowh - inf_verh) {
							pos sx, sy * (sy > 0)
							gfini inf_tiles - (sx + inf_tiles > windoww) * (sx + inf_tiles - windoww), inf_tiles + (sy < 0) * inf_screeny - (sy + inf_tiles > windowh - inf_verh) * (sy + inf_tiles - windowh + inf_verh)
							gfinc 25, 25, 25
						}
						await
					loop
				}
				sx = x * inf_tiles + inf_screenx
				sy = y * inf_tiles + inf_screeny
				if (sy + inf_tiles <= windowh - inf_verh) {
					pos sx, sy * (sy > 0)
					gfini inf_tiles, inf_tiles + (sy < 0) * inf_screeny - (sy + inf_tiles > windowh - inf_verh) * (sy + inf_tiles - windowh + inf_verh)
					gfinc 50, 50, 100
				}
			}
			display_key x * inf_tiles + inf_screenx - 12, y * inf_tiles + inf_screeny - 12, cnt
		loop
		txttargetnpc cX(list(0, i)), cY(list(0, i))
		cs_bk = cs
		gosub *label_0625
		redraw 1
	}
	await cfg_wait1
	key_check
	cursor_check
	if (key == key_target) {
		key = key_list(cs)
	}
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		lockon 0, p, 9
		snd 20
		txt -1, lang(name(p) + "をターゲットにした。", "You target " + name(p) + ".")
		scposval_nc = 0
		gosub *label_0623
		goto *label_1155
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1153
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1153
		}
	}
	if (key == key_cancel) {
		gosub *label_0623
		goto *label_1155
	}
	goto *label_1154
*label_1155
	goto *label_1623
*label_1156
	ww = 33
	wh = 20
	wx = 0
	wy = 0
	snd 26
*label_1157
	redraw 0
	gmode 0
	color 200, 200, 200
	p = 0
	repeat wh
		cnt2 = cnt
		repeat ww
			if (p < listmax) {
				pos wx + cnt * 24, wy + cnt2 * 24
				gzoom 24, 24, 2, list(0, p) \ ww * 48, list(0, p) / ww * 48, 48, 48
				if (chipm(7, list(0, p)) & 4) {
					color 240, 230, 220
					boxl wx + cnt * 24, wy + cnt2 * 24, wx + cnt * 24 + 24, wy + cnt2 * 24 + 24
				}
			}
			p++
		loop
	loop
	gmode 2
	redraw 1
	await cfg_wait1
	stick a
	if (a == 256) {
		p = mousex / 24 + mousey / 24 * ww
		if (p >= listmax) {
			snd 27
			goto *label_1158
		}
		tile = list(0, p)
		snd 20
		goto *label_1159
	}
	if (a == 512) {
		goto *label_1159
	}
*label_1158
	goto *label_1157
*label_1159
	screenupdate = -1
	gosub *label_0623
	return



*ui_selectAlly
	snd 26
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	if (allyctrl == 2) {
		list(0, listmax) = 99, -9999
		listmax++
	}
	repeat 16
		if (cState(cnt) == 0) {
			continue
		}
		if (allyctrl == 1 | allyctrl == 7) {
			if (cState(cnt) == 6) {
				continue
			}
		}
		if (allyctrl == 3 | allyctrl == 5 | allyctrl == 6 | allyctrl == 8 | allyctrl == 98 | allyctrl == 99 | allyctrl == 100) {
			if (cState(cnt) != 1) {
				continue
			}
			if (areaId(gCurrentMap) == 103) {
				if (cCurrentMap(cnt) != gCurrentMap) {
					continue
				}
			}
		}
		if (allyctrl == 5) {
			if (cnt == rc) {
				continue
			}
		}
		if (cCurrentMap(cnt) != 0) {
			if (allyctrl == 1 | allyctrl == 2 | allyctrl == 7 | allyctrl == 8) {
				continue
			}
		}
		if (allyctrl != 1 & allyctrl != 7) {
			if (cbit(963, cnt) | cbit(971, cnt)) {
				continue
			}
		}
		if (cbit(975, cnt)) {
			continue
		}
		if (allyctrl != 6) {
			if (cnt == 0) {
				continue
			}
		}
		if (cRole(cnt) == 20001) {
			continue
		}
		if (allyctrl == 2) {
			if (arenaop(0) == 2) {
				if (filtercheck(cnt, "putit") == 0) {
					continue
				}
			}
			if (arenaop(0) == 3) {
				if (filtercheck(cnt, "horse") == 0) {
					continue
				}
			}
		}
		if (allyctrl == 3) {
			if (areaId(gCurrentMap) == 31) { // すでに牧場にいて
				if (ocPetJob(cnt) == sId_geneEngineering) { // 働いているならば
					continue // スキップ
				}
			}
		}
		if (allyctrl == 99) {
			cnt2 = cnt
			f = 0
			repeat 96, 1
				if (gettrait(cnt2, cnt)) {
					f = 1
					break
				}
			loop
			if (f == 0) {
				continue
			}
		}
		if (allyctrl == 100) {
			if (cnt == swap@se) {
				continue
			}
		}
		list(0, listmax) = cnt, -cLevel(cnt)
		listmax++
	loop
	gosub *label_1276
	if (allyctrl == 2) {
		p = 0
		dim followerin, 16
		repeat listmax
			if (cnt == 0) {
				continue
			}
			i = list(0, cnt)
			if (cState(i) != 6) {
				followerin(i) = 1
				p++
				if (p == arenaop(1)) {
					break
				}
			}
		loop
	}
	windowshadow = 1
*label_1161
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
			txtnew
		}
	}
	if (allyctrl == 0) {
		txt -1, lang("誰を呼び戻す？", "Call who?")
		s(10) = lang("呼び戻す仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		x = 0
	}
	if (allyctrl == 1) {
		txt -1, lang("誰を売り飛ばす？", "Sell who?")
		s(10) = lang("売り飛ばす仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("値段", "Value")
		x = 20
	}
	if (allyctrl == 2) {
		i = 0
		repeat 16
			i += followerin(cnt) == 1
		loop
		if (i < arenaop(1)) {
			txtef 3
		} else {
			txtef 4
		}
		txt -1, lang("試合の規定人数: ", "Participant: ") + i + " / " + arenaop(1)
		s(10) = lang("出場する仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		x = 20
	}
	if (allyctrl == 3) {
		if (areaId(gCurrentMap) == 102) {
			txt -1, lang("誰を店長にする？", "Who takes the role of shopkeeper?")
			s(10) = lang("店長候補", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("魅力/交渉", "CHR/Negotiation")
		}
		if (areaId(gCurrentMap) == 31) {
			txt -1, lang("誰をブリーダーにする？", "Who takes the role of breeder?")
			s(10) = lang("ブリーダー候補", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("繁殖力", "Breed Power")
		}
		if (gCurrentMap == 7 | areaId(gCurrentMap) == 103) {
			txt -1, lang("誰を滞在させる？", "Who stays in your home?")
			s(10) = lang("滞在状態の変更", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		}
		x = 20
	}
	if (allyctrl == 4 | allyctrl == 5) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		if (allyctrl == 5) {
			if (rc != 0) {
				s(13) = lang("獲得部位/技能", "Body/Skill")
			}
		}
		x = 0
	}
	if (allyctrl == 6 | allyctrl == 7 | allyctrl == 8) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name")
		if (allyctrl == 8) {
			s(13) = lang("速度", "Speed")
		} else {
			s(13) = lang("料金", "Cost")
		}
		x = 20
	}
	if (allyctrl == 99 | allyctrl == 98) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name")
		s(13) = lang("最大Lv - フィート数", "Max lvl - Available feats")
		x = 20
	}
	if (allyctrl == 100) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("入れ替える仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		x = 0
	}
*label_1162
	redraw 0
	s = s(10), s(11)
	display_window (windoww - 620) / 2 + inf_screenx, winposy(400), 620, 400
	display_topic s(12), wx + 28, wy + 36
	display_topic s(13), wx + 350 + x, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 500, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		if (list(0, p) != 99) {
			transmissivity = 0
			if (cId(list(0, p)) == 343) {
				if (userdata2(1, cCnpcId(list(0, p)))) {
					transmissivity = userdata2(1, cCnpcId(list(0, p)))
				}
			}
			if (ocdata(101, list(0, p))) {
				transmissivity = ocdata(101, list(0, p))
			}
			i = getcharapic(list(0, p)), getcharacolor(list(0, p))
			chara_preparepic i, i(1)
			pos wx + 40, wy + 74 + cnt * 19 - 8
			gmode 4, chipc(2, i), chipc(3, i), 256 - transmissivity
			color 0, 0, 0
			grotate 5, 0, 960, 0, chipc(2, i) / (1 + (chipc(3, i) > inf_tiles)), inf_tiles
			gmode 2
		}
		i = list(0, p)
		if (i == 99) {
			cs_list lang("決定", "Proceed"), wx + 84, wy + 66 + cnt * 19 - 1, 19
			continue
		}
		if (allyctrl == 0 | allyctrl == 2 | allyctrl == 3 | allyctrl == 4 | allyctrl == 5 | allyctrl == 100) {
			s = "" + cdatan(1, i) + " " + cdatan(0, i)
			if (allyctrl != 6) {
				if (cCurrentMap(i) != 0) {
					if (ocdata(80, i) == 0) {
						s = s + "(" + mapname(cCurrentMap(i)) + ")"
					} else {
						s = s + "(" + mapname(cCurrentMap(i)) + floorstr(-ocdata(80, i) - 1) + ")"
					}
				}
			}
			if (allyctrl == 2) {
				if (followerin(i) == 1) {
					s += lang(" *出場* ", " *In* ")
				}
			}
			n = 0
			if (allyctrl == 5) {
				if (cLevel(i) > sdata(151, 0) + 5) {
					n = 3
				}
			}
			cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19, 0, n
			if (allyctrl != 3 | gCurrentMap == 7 | areaId(gCurrentMap) == 103) {
				s = "Lv." + cLevel(i) + " "
				if (cState(i) == 6) {
					s += lang("(死んでいる)", "(Dead)")
				}
				if (cState(i) == 7) {
					if (allyctrl == 0) {
						s += lang("(待機している)", "(Waiting)")
					} else {
						s += "(Hp: " + cHp(i) * 100 / cMaxHp(i) + "%) " + lang("待機", "Waiting")
					}
				}
				if (cState(i) == 1) {
					if (allyctrl == 0) {
						s += lang("(生きている)", "(Alive)")
					} else {
						s += "(Hp: " + cHp(i) * 100 / cMaxHp(i) + "%)"
					}
				}
			} else {
				if (areaId(gCurrentMap) == 102) {
					s = "   " + sdata(17, i) + " / " + sdata(156, i)
				}
				if (areaId(gCurrentMap) == 31) {
					breederPower@tmp = cbreeder(i)
					if (double(INT_MAX) < breederPower@tmp) {
						// 32bit符号付整数の表示限界
						s = strf("   %.0f", breederPower@tmp)
					} else {
						s = "   " + int(breederPower@tmp)
					}
				}
			}
			if (allyctrl == 5) {
				if (rc != 0) {
					tc = i
					gosub *label_1456
					if (stat == (-1)) {
						s = lang("なし", "None")
					} else {
						s = bodyn(rtval)
					}
					s += "/"
					gosub *getExtractableSkill
					if (stat == 0) {
						s += lang("なし", "None")
					} else {
						s += "" + skillname(rtval)
						if (rtval(1) != (-1)) {
							s += ", " + skillname(rtval(1))
						}
					}
				}
			}
			pos wx + 370, wy + 66 + cnt * 19 + 2
			mes s
		}
		if (allyctrl == 1 | allyctrl == 6 | allyctrl == 7 | allyctrl == 8) {
			s = "" + cdatan(1, i) + " " + cdatan(0, i)
			s += " Lv." + cLevel(i)
			n = 0
			if (allyctrl == 6) {
				if (cGold(0) < calcactupgradevalue(i)) {
					n = 3
				}
			}
			if (allyctrl == 7) {
				if (cGold(0) < calcactupgradevalue(i) * 2 / 3) {
					n = 3
				}
			}
			cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19, 0, n
			if (allyctrl == 8) {
				s = "" + cCurrentSpeed(i)
			} else {
				if (allyctrl == 6) {
					s = thousandsep(str(calcactupgradevalue(i))) + strgold
				} elseif (allyctrl == 7) {
					s = thousandsep(str(calcactupgradevalue(i) * 2 / 3)) + strgold
				} else {
					s = thousandsep(str(calcslavevalue(i) * 2 / 3)) + strgold
				}
			}
			pos wx + 390, wy + 66 + cnt * 19 + 2
			mes s
		}
		if (allyctrl == 99 | allyctrl == 98) {
			s = "" + cdatan(1, i) + " " + cdatan(0, i)
			s += " Lv." + cLevel(i)
			cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19, 0, 0
			featcnt = 0
			repeat 96, 1
				if (gettrait(i, cnt) != 0) {
					featcnt += stat
				}
			loop
			s = "Lv." + cMaxLevel(i) + " - " + featcnt
			pos wx + 390, wy + 66 + cnt * 19 + 2
			mes s
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		if (allyctrl == 5) {
			if (cLevel(p) > sdata(151, 0) + 5) {
				snd 27
				txt -1, lang("遺伝子学のスキルが足りない。", "You need to be a better gene engineer.")
				goto *label_1161
			}
		}
		if (allyctrl == 2) {
			i = 0
			repeat 16
				if (followerin(cnt) == 1) {
					i++
				}
			loop
			if (p == 99) {
				if (i == 0) {
					txt -1, lang("最低でも一人の参加者が必要だ。", "You need at least 1 pet to start the battle.")
					snd 27
					goto *label_1163
				}
				snd 20
				return 1
			}
			if (cState(p) == 6) {
				txt -1, lang("死んでいる。", he(p) + " " + is(p) + " dead.")
				snd 27
				goto *label_1163
			}
			if (followerin(p) == 0) {
				if (i >= arenaop(1)) {
					snd 27
					txt -1, lang("参加枠を超えている。", "Too many participants.")
					goto *label_1163
				} else {
					followerin(p) = 1
					snd 20
				}
			} else {
				followerin(p) = 0
				snd 20
			}
			goto *label_1161
		}
		if (allyctrl == 6) {
			if (cGold(0) < calcactupgradevalue(p) & ncgdata(50) == 0) {
				snd 27
				txt -1, lang("お金が足りない。", "You don't have enough money...")
				goto *label_1161
			}
		}
		return p
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1161
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1161
		}
	}
	if (key == key_cancel) {
		return -1
	}
*label_1163
	goto *label_1162



*label_1164
	if (rc < 0) {
		rc = tc
		if (rc < 0) {
			rc = 0
		}
	}
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = 0
	cs_bk = -1
	snd 26
	buff = ""
	notesel buff
	del_chara 56
	r1 = 56
	cPietyPoint(r1) = cPietyPoint(0)
	cGod(r1) = cGod(0)
	repeat 600
		sdata(cnt, rc) = 1
	loop
	gosub *label_1085
	if (godcheck() != "eyth") {
		buff += lang("<title1>◆ " + godname(godcheck()) + "による能力の恩恵<def>\n", "<title1>* Blessing by " + godname(godcheck()) + "<def>\n")
		repeat 600
			p = sdata(cnt, rc) - 1
			cnvbonus cnt, p
		loop
	}
	r1 = 0
	refreshmode = 1
	gosub *chara_refresh
	refreshmode = 0
	buff += "\n"
	buff += lang("<title1>◆ 特徴と特殊状態による能力の恩恵<def>\n", "<title1>* Stats boosts by your traits and equipments")
	listmax = noteinfo(0)
*label_1165
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	s = lang("自己の分析", "Analyze Self"), strhint2 + strhint3b
	display_window (windoww - 400) / 2 + inf_screenx, winposy(448), 400, 448
	s = lang("分析結果", "Analysis Result")
	display_topic s, wx + 28, wy + 36
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		noteget s, p
		gmesx = wx + 40
		gmesy = wy + 66 + cnt * 19 + 2
		gmesw = 600
		gmescol = 30, 30, 30
		gmestype = 0
		pos wx + 54, wy + 66 + cnt * 19 + 2
		gmes s
	loop
	redraw 1
*label_1166
	redraw 0
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1165
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1165
		}
	}
	if (key == key_cancel) {
		return
	}
	goto *label_1166
*label_1167
*label_1168
	listmax = 0
	page = 0
	pagesize = 15
	cs = 0
	tc = 0
	cs_bk = -1
	curmenu = 2
	snd 96
	drawmenu
	ww = 700
	wh = 400
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	windowanime wx, wy, ww, wh, 10, 4
	redraw 0
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_feat.bmp", 1
	gsel 0
	windowshadow = 1
*label_1169
	if (cm == 1) {
		s = lang("フィートとは、君の持っている有益な特徴だ。" + gAcquirableFeatCount + "つまで選べるよ。", "Choose your feats wisely.")
		gosub *label_0629
	}
	listmax = 0
	if (tc == 0) {
		if (gAcquirableFeatCount > 0) {
			list(0, listmax) = -1, 0
			listmax++
		}
	} else {
		if (ocdata(105, tc) > 0) {
			list(0, listmax) = -1, 0
			listmax++
		}
	}
	f = 0
	repeat 300
		traitmode = 0
		tid = cnt
		r1 = tc
		gosub *label_0097
		if (stat == 0) {
			continue
		}
		if (stat == 1) {
			if (traitref == 0) {
				if (traitref(1) >= 0) {
					if (tc == 0 & gAcquirableFeatCount > 0 | ocdata(105, tc) > 0) {
						list(0, listmax) = cnt, cnt + 1
						listmax++
					}
				} else {
					if (traitref(1) < 0) {
						if (cm == 1) {
							list(0, listmax) = cnt, cnt + 1
							listmax++
						}
					}
				}
			}
		}
		if (gettrait(tc, cnt) != 0) {
			list(0, listmax) = cnt, 10000 + cnt + 1
			listmax++
			f++
		}
	loop
	if (f != 0) {
		list(0, listmax) = -2, 10000
		listmax++
	}
	gosub *label_1276
	repeat listmax
		i = list(0, cnt)
		if (i < 0) {
			if (i == (-1)) {
				if (jp) {
					s = "◆ 取得できるフィート"
				} else {
					s = "[Available feats]"
				}
			}
			if (i == (-2)) {
				if (jp) {
					s = "◆ 特徴と体質"
				} else {
					s = "[Feats and traits]"
				}
			}
			listn(0, cnt) = s
			continue
		}
		tid = i
		traitmode = 0
		r1 = tc
		gosub *label_0097
		featrq = stat
		s = ""
		if (list(1, cnt) < 10000) {
			if (traitref(1) >= 0) {
				if (gettrait(tc, tid) < traitref(2)) {
					s = traitrefn2(gettrait(tc, tid))
				} else {
					s = traitrefn2(traitref(2) - 1) + "(MAX)"
				}
			} else {
				if (gettrait(tc, tid) > traitref(1)) {
					s = traitrefn2(abs(gettrait(tc, tid)))
				} else {
					s = traitrefn2(abs(traitref(1) + 1)) + "(MAX)"
				}
			}
			if (featrq == (-1)) {
				if (jp) {
					s += "(条件不足)"
				} else {
					s += "(requirement)"
				}
			}
			pos wx + 30, wy + 61 + cnt * 19
			x = 84
		} else {
			pos wx + 45, wy + 61 + cnt * 19
			x = 70
			if (traitref == 0) {
				if (jp) {
					s = "[フィート]"
				} else {
					s = "[Feat]"
				}
			}
			if (traitref == 1) {
				if (jp) {
					s = "[変異]"
				} else {
					s = "[Mutation]"
				}
			}
			if (traitref == 2) {
				if (jp) {
					s = "[先天]"
				} else {
					s = "[Race]"
				}
			}
			if (traitref == 3) {
				if (jp) {
					s = "[ｴｰﾃﾙ病]"
				} else {
					s = "[Disease]"
				}
			}
			s += traitrefn(2 + abs(gettrait(tc, tid)))
		}
		listn(0, cnt) = s
	loop
	r1 = tc
	if (cdata(158, r1) == 0) {
		gosub *label_1523
	}
	sdim naturevalues, 3
	getfactionvalues tc, "nature", naturevalues
	repeat stat
		s = getfactionlabel(naturen, naturevalues(cnt))
		if (s != "") {
			if (strmid(s, -1, 2) != "い") {
				s += "だ"
			}
			list(0, listmax) = 1, 99999
			listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは" + s, "You are " + naturevalues(cnt) + ".")
			listmax++
		}
	loop
	if (tc == 0 & ncgdata(205) > 0) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは祝福を受けている[次回睡眠時、潜在能力上昇量+", "You have been blessed.[sleep potential increase +") + ((ncgdata(205) / 2500) * 10 + 10) + "%]"
		listmax++
	}
	if (eqfaction(tc, "slime")) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは軟体だ[格闘/鈍器耐性強化]", "Your body is highly elastic. [Martial Arts/Blunt Resist]")
		listmax++
	}
	if (eqfaction(tc, "dragon")) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは竜の血脈だ[シャウト使用可 竜特効弱点]", "You possess dragon's blood. [Can scream, weak against dragon slaying weapons]")
		listmax++
	}
	if (eqfaction(tc, "golem")) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは硬体だ[PV+20 鈍器耐性弱化]", "Your body is rigid. [PV+20, weak against Blunt]")
		listmax++
	}
	if (eqfaction(tc, "champ")) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは現チャンプだ", "You are the current putit champion.")
		listmax++
	}
	if (getcgodno(tc) != (-1)) {
		nc_intb_001 = stat
		repeat 5
			if (usergoddatam(cnt + 10, nc_intb_001) <= cdata(62, tc) & (usergoddatam(cnt + 15, nc_intb_001) == 0 | usergoddatam(cnt + 15, nc_intb_001) >= cdata(62, tc)) & usergoddatanm(cnt + 5, nc_intb_001) != "") {
				list(0, listmax) = 1, 99999
				listn(0, listmax) = lang("[その他]", "[ETC]") + usergoddatanm(cnt + 5, nc_intb_001)
				listmax++
			} else {
				break
			}
		loop
	}
	if (cbit(16, tc) == 1) {
		list(0, listmax) = 1, 99999
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは変装している", "You are disguising yourself.")
		listmax++
	}
	if (cbit(978, tc) == 1) {
		list(0, listmax) = 1, 99999
		if (ocdata(52, tc) == 330) {
			listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは寄生されている", "You are pregnant.")
		} else {
			listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは妊娠している", "You are pregnant.")
		}
		listmax++
	}
	if (cbit(986, tc) == 1) {
		list(0, listmax) = 1, 99999
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは拒食症だ", "You have anorexia.")
		listmax++
	}
	if (cSpeedCorrectionValue(tc) != 0) {
		list(0, listmax) = 1, 99999
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは複雑な体をしている[速度-" + cSpeedCorrectionValue(tc) + "%]", "Your body is complicated. [SPD-" + cSpeedCorrectionValue(tc) + "%]")
		listmax++
	}
	if (tc == 0) {
		if (gEtherDiseaseSpeed != 0) {
			if (gEtherDiseaseSpeed > 0) {
				list(0, listmax) = 1, 99999
				listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたのエーテル病の進行は早い。", "Your Ether disease grows fast.")
				listmax++
			} else {
				list(0, listmax) = 1, 99999
				listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたのエーテル病の進行は遅い。", "Your Ether disease grows slow.")
				listmax++
			}
		}
	}
	// NC_job
	repeat 100
		if (nc_getskillname(100 + cnt) == "") {
			continue
		}
		if (nc_gettrait(tc, 100 + cnt) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) =  lang("[職業]", "[Job]") + nc_getskilldesc(100 + cnt)
			listmax++
		}
	loop
	// NC_Horse
	if (filtercheck(tc, "horse")) {
		if (horse_getskill(tc, 0) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中に速度を上げる術を持っている", "You have increase speed during a race.") + "[Lv:" + horse_getskill(tc, 0) + "]"
			listmax++
		}
		if (horse_getskill(tc, 1) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中にスタミナを節約する術を持っている", "You have save stamina during a race.") + "[Lv:" + horse_getskill(tc, 1) + "]"
			listmax++
		}
		if (horse_getskill(tc, 2) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中に立ち回りを強化する術を持っている", "You have getting around during a race.") + "[Lv:" + horse_getskill(tc, 2) + "]"
			listmax++
		}
		if (horse_getskill(tc, 3) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレースの前半にスタミナを節約する術を持っている", "You have save stamina in the first half of the race.") + "[Lv:" + horse_getskill(tc, 3) + "]"
			listmax++
		}
		if (horse_getskill(tc, 4) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレースの後半にスタミナを節約する術を持っている", "You have save stamina late in the race.") + "[Lv:" + horse_getskill(tc, 4) + "]"
			listmax++
		}
		if (horse_getskill(tc, 5) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレースの後半に全力を上手く出す術を持っている", "You have getting the best out of late in the race.") + "[Lv:" + horse_getskill(tc, 5) + "]"
			listmax++
		}
		if (horse_getskill(tc, 6) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中にスタミナを回復する術を持っている", "You have regain stamina during a race.") + "[Lv:" + horse_getskill(tc, 6) + "]"
			listmax++
		}
		if (horse_getskill(tc, 7) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは駆け引きで敵を疲れやすくさせる術を持っている", "You have a way of tiring out enemies through bargaining.") + "[Lv:" + horse_getskill(tc, 7) + "]"
			listmax++
		}
		if (horse_getskill(tc, 8) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは駆け引きで敵の進行を停滞させる術を持っている", "You have the art of slowing down your enemies with bargaining.") + "[Lv:" + horse_getskill(tc, 8) + "]"
			listmax++
		}
		if (horse_getskill(tc, 9) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは敵の妨害に惑わされない力を持っている", "You have the power not to be distracted by the interference of your enemies.") + "[Lv:" + horse_getskill(tc, 9) + "]"
			listmax++
		}
		if (horse_getskill(tc, 10) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは晴れの日に力を発揮する", "You are a force to be reckoned with on a sunny day.") + "[Lv:" + horse_getskill(tc, 10) + "]"
			listmax++
		}
		if (horse_getskill(tc, 11) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは雨の日に力を発揮する", "You are a force to be reckoned with on a rain day.") + "[Lv:" + horse_getskill(tc, 11) + "]"
			listmax++
		}
		if (horse_getskill(tc, 21) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("竜頭蛇尾の力でレース開始時に速度が大幅に上がる", "The power of the Headlong greatly increase speed at the start of the race.") + "[Lv:" + horse_getskill(tc, 21) + "]"
			listmax++
		}
		if (horse_getskill(tc, 22) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("華麗なスライドで敵の追い抜きを防ぐ", "Prevent the enemy from overtaking with a brilliant slide.") + "[Lv:" + horse_getskill(tc, 22) + "]"
			listmax++
		}
		if (horse_getskill(tc, 23) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("レース後半であなたがトップの時に全力を出して逃げ切る", "Late in the race, when you're in the lead, give it your all and get away.") + "[Lv:" + horse_getskill(tc, 23) + "]"
			listmax++
		}
		if (horse_getskill(tc, 24) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("レース後半で追い抜く意地を見せ、様々な能力が強化される", "Show the will to overtake in the second half various abilities will be enhanced.") + "[Lv:" + horse_getskill(tc, 24) + "]"
			listmax++
		}
		if (horse_getskill(tc, 25) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("鉄壁の構えで後ろからの追い抜きを完全に防ぐことがある", "The ironclad stance may completely prevent you from overtaking from behind.") + "[Lv:" + horse_getskill(tc, 25) + "]"
			listmax++
		}
		if (horse_getskill(tc, 26) > 0) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("レース後半でエーテルの風の勢いに乗り、速度を大幅に上昇させて敵の進行を大幅に妨げる", "Rides the momentum of the ether wind, greatly increasing its speed and greatly impeding the enemy's progress.") + "[Lv:" + horse_getskill(tc, 26) + "]"
			listmax++
		}
	}

	if (cfg_dump == 0) {
		if (dump_return == 1) {
			dump_return = 0
			return
		}
	}
	xnotesel buff2
	buff2 = ""
	repeat 30, 100
		if (cdata(cnt, tc) \ 10000 != 0) {
			ci = cdata(cnt, tc) \ 10000 - 1
			repeat 15
				if (iEnchantmentId(ci, cnt) == 0) {
					break
				}
				val = iEnchantmentId(ci, cnt), iEnchantmentPower(ci, cnt), 1, 0
				gosub *label_0297
				if (s == "") {
					continue
				}
				xnoteadd s
			loop
		}
	loop
	if (findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1) {
		notesel buff2
		repeat noteinfo(0)
			noteget s, cnt
			list(0, listmax) = 1, 99999
			listn(0, listmax) = lang(his(tc, 1) + "装備は", cnven(his(tc, 1)) + " equipment ") + s
			listmax++
		loop
		noteunsel
	}
	if (tc != 0) {
		repeat listmax
			if (jp) {
				cnv_str listn(0, cnt), "あなた", he(tc, 1)
			}
			if (en) {
				cnv_str listn(0, cnt), " your", " " + his(tc, 1)
				cnv_str listn(0, cnt), " you", " " + him(tc, 1)
			}
		loop
	}
	if (dump_return == 1) {
		dump_return = 0
		return
	}
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	if (cs != 0) {
		if (tc == 0 & gAcquirableFeatCount == 0 | (tc != 0 & ocdata(105, tc) == 0)) {
			cs = cs@se
		}
	}
	cs@se = 0
	if (cs < 0) {
		repeat listmax
			if (list(1, cnt) >= 10000) {
				if (list(0, cnt) - 10000 == cs) {
					page = cnt / pagesize
					cs = cnt \ pagesize
					break
				}
			}
		loop
		if (cs < 0) {
			cs = 0
		}
	}
*label_1170
	redraw 0
	s = lang("特徴と体質", "Feats and Traits"), lang("決定 [フィート取得]  " + strhint2 + strhint3, "Enter [Gain Feat]  " + strhint2 + strhint3) + "z,x [" + lang("仲間", "Ally") + "]"
	if (mode == 1) {
		i = 1
	} else {
		i = 0
	}
	display_window (windoww - 730) / 2 + inf_screenx, winposy(430, i) + i * 15, 730, 430, 55, 40
	if (jp) {
		s = "特徴の名称", "段階", "特徴の効果"
	} else {
		s = "Name", "Level", "Detail"
	}
	display_topic s, wx + 46, wy + 36
	display_topic s(2), wx + 255, wy + 36
	pos wx + 46, wy - 16
	gcopy 3, 288 + 11 * 48, 48, 48, 48
	pos wx + ww - 56, wy + wh - 198
	gcopy 3, 960, 96, 48, 192
	pos wx, wy
	gcopy 3, 1008, 96, 48, 144
	pos wx + ww - 108, wy
	gcopy 3, 960, 288, 96, 72
	pos wx, wy + wh - 70
	gcopy 3, 1008, 240, 96, 48
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (list(0, p) < 0) {
			continue
		}
		if (cnt \ 2 == 0) {
			pos wx + 57, wy + 66 + cnt * 19
			gfini 640, 18
			gfdec2 12, 14, 16
		}
		if (list(1, p) >= 10000 | list(0, p) < 0) {
			continue
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	if (tc == 0) {
		s = lang("残り " + gAcquirableFeatCount + "個のフィートを取得できる", "You can acquire " + gAcquirableFeatCount + " feats")
	} else {
		s = cnven(cdatan(0, tc)) + lang(" 残り " + ocdata(105, tc) + "個のフィートを取得できる", " You can acquire " + ocdata(105, tc) + " feats")
	}
	display_note s, 50
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		if (i < 0) {
			color 0, 0, 0
			cs_list listn(0, p), wx + 114, wy + 66 + cnt * 19 - 1, 19, 0, -1
			continue
		}
		if (list(1, p) != 99999) {
			tid = i
			traitmode = 0
			r1 = tc
			gosub *label_0097
			featrq = stat
			if (gettrait(tc, tid) == 0) {
				color 0, 0, 0
			} else {
				if (gettrait(tc, tid) > 0) {
					color 0, 0, 200
				} else {
					color 200, 0, 0
				}
			}
		} else {
			traitref = 5
			color 0, 0, 0
		}
		if (list(1, p) < 10000) {
			pos wx + 30, wy + 61 + cnt * 19
			x = 84
		} else {
			pos wx + 45, wy + 61 + cnt * 19
			x = 70
		}
		gcopy 3, 384 + traitref * 24, 336, 24, 24
		cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, -1
		if (list(1, p) < 10000) {
			pos wx + 270, wy + 66 + cnt * 19 + 2
			mes traitrefn(2)
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = pagesize * page + cnt
			break
		}
	loop
	if (tc == 0 & gAcquirableFeatCount > 0 | ocdata(105, tc) > 0 | cm == 1) {
		if (p > 0) {
			if (list(1, p) < 10000) {
				tid = list(0, p)
				traitmode = 0
				r1 = tc
				gosub *label_0097
				if (traitref(1) >= 0) {
					if (traitref(2) <= gettrait(tc, tid)) {
						if (mode != 1) {
							txt -1, lang("これ以上取得できない。", "You already have maxed out the feat.")
						}
						goto *label_1169
					}
					if (tc == 0) {
						gAcquirableFeatCount--
					} else {
						ocdata(105, tc)--
					}
					addtrait tc, tid, 1
				} else {
					if (traitref(1) >= gettrait(tc, tid)) {
						if (mode != 1) {
							txt -1, lang("これ以上取得できない。", "You already have maxed out the feat.")
						}
						goto *label_1169
					}
					if (cm == 1) {
						gosub *label_0767
						s = lang("これは不利になるフィートだ。本当に取得する？", "This feat handicaps your character. Really proceed?")
						gosub *label_0629
						promptl(0, 0) = strno, "n", "0"
						promptl(0, 1) = stryes, "y", "1"
						promptmax = 2
						val = promptx, 240, 160, 1
						gosub *label_1353
						if (rtval != 1) {
							goto *label_1169
						}
					}
					if (tc == 0) {
						gAcquirableFeatCount++
					} else {
						ocdata(105, tc)++
					}
					addtrait tc, tid, -1
				}
				cs@se = (-10000) + tid
				snd 61
				if (tid == 67) {
					repeat 15, 1
						if (cState(cnt) != 1) {
							continue
						}
						r1 = cnt
						gosub *chara_refresh
					loop
				}
				r1 = tc
				gosub *chara_refresh
				if (mode == 1) {
					if (tc == 0 & gAcquirableFeatCount == 0 | (tc != 0 & ocdata(105, tc) == 0)) {
						return 1
					}
				} else {
					redraw 0
					gosub *label_0625
				}
				goto *label_1169
			}
		}
	}
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 3) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 3
				}
			}
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					csctrl = 0
					goto *label_1251
				}
				if (curmenu == 1) {
					goto *label_1269
				}
				if (curmenu == 2) {
					goto *label_1167
				}
				if (curmenu == 3) {
					goto *label_1060
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1169
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1169
		}
	}
	if (key == "z" | key == "x") {
		p = tc
		if (charamake@se == 0) {
			repeat 16
				if (key == "z") {
					p--
					if (p < 0) {
						p = 16 - 1
					}
				}
				if (key == "x") {
					p++
					if (p == 16) {
						p = 0
					}
				}
				if (cState(p) != 1) {
					continue
				}
				break
			loop
		}
		tc = p
		snd 1
		page = 0
		cs = 0
		goto *label_1169
	}
	if (key == key_cancel) {
		if (mode == 1) {
			return 0
		}
		gosub *label_0623
		goto *label_1623
	}
	if (mode == 1) {
		getkey p, 112
		if (p) {
			gosub *label_1577
			return -1
		}
	}
	goto *label_1170
*label_1171
	if (jp) {
		titlename(0) = "替え玉", "寺生まれ", "にらみつける", "猫騙し", "辻斬り成敗"
		titlename(5) = "チェックメイト", "突撃隣の晩御飯", "再殺部隊", "迷宮の制覇者", "猫まっしぐら"
		titlename(10) = "破壊兵器を破壊した" + _sex(cSex(0)), "浄化者", "ジョン・コナー", "サディストキラー", "エレメンタルマスター"
		titlename(15) = "収穫者", "地球割り", "うみみゃあ！", "リストラ", "中に誰もいませんよ"
		titlename(20) = "神々の黄昏", "まさに善人", "カビキラー", "おうちかえす", "断末魔合唱団"
		titlename(25) = "戦鬼", "13番目の" + _sex(cSex(0)), "だいまどう", "无", "ワンマン・アーミー"
		titlename(30) = "地獄の壁", "盲剣", "マッドサイエンティスト", "マネーの虎", "トレジャーハンター"
		titlename(35) = "お父様", "ステルス" + cdatan(0, 0), "神罰の地上代行者", "パルミア一番！", "スーパー観光客"
		titlename(40) = "老魔法王", "力こそパワー", "二天", "カブ奴隷", "素顔ライダー"
		titlename(45) = "ザ・ベイベー", _onii3(rnd(6), cSex(0)), "母を訪ねて", "旅立ちの日に", "1000人斬り"
		titlename(50) = "しあわせ家族計画", "挽肉の錬金術師", "ハンニバル・レクター", "浮気者", "億万長者"
		titlename(55) = "なんだか聞き覚えがある", "フェリックス・ハニカー", "夜道に注意", "私が町長です", "廃人"
		titlename(60) = "黒ずくめの" + _sex(cSex(0)), "モンスター・ハンター", "終焉を喰らう者", "トバルカイン", "アテナ"
		titlename(65) = "アレス", "クピードー", "バステト", "クマリ", "デウス・エクス・マキナ"
		titlename(70) = "ディントス", "エヌルタ" , "イシス", "カーリー", "クロノス"
		titlename(75) = "ビヨンド・ウィッシュ", "ガネーシャ", "戦を極めしもの", "知を極めしもの", "最果て"
		titlename(80) = "努力の証明・筋力", "努力の証明・耐久", "努力の証明・器用", "努力の証明・感覚", "努力の証明・習得"
		titlename(85) = "努力の証明・意思", "努力の証明・魔力", "努力の証明・魅力", "努力の証明・生命力", "努力の証明・マナ"
		titlename(90) = "烏合の衆", "技術革新", "ありのままで", "魔術士は二度死ぬ", "NECROMANIA"
		titlename(95) = "世界は回る 回るよ世界", "かもめの水兵さん", "レッドキャップ", "愛はティリスを救う", "あつまれ ようせいの森"
		titlename(100) = "技術は自由のために", "いまがﾁｬｿｽ！", "[[BIG]]の力", "牧畜物語", "鉄腕RUSH"
		titlename(105) = "消波ブロック", "牧羊犬", "俺たちの戦いはこれからだ！"
		titlename2(0) = "イークの首領『ルードルボ』を撃破", "ピラミッドの主『ツェン』を撃破", "火炎竜『ヴェスダ』を撃破", "猫使い『ケシー』を撃破", "ミノタウロスの王『ウンガガ』を撃破"
		titlename2(5) = "古城の主『ワイナン』を撃破", "赤き義眼の『クルイツゥア』及び鋼鉄竜『コルゴン』を撃破", "闇の奇形『イスシズル』を撃破", "偽りの預言者『ゼーム』を撃破", "猫の女王『フリージア』を撃破"
		titlename2(10) = "ゼイレン究極破壊兵器『ウティマ』を撃破", "不浄なる者『アズラシズル』を撃破", "《機械のマニ》を撃破", "《風のルルウィ》を撃破", "《元素のイツパロトル》を撃破"
		titlename2(15) = "《収穫のクミロミ》を撃破", "《地のオパートス》を撃破", "《幸運のエヘカトル》を撃破", "《癒しのジュア》を撃破", "《エヘカトルの中の神》を撃破"
		titlename2(20) = "全ての神を撃破", "無邪気な少女『グウェン』を100回殺害", "異形の森の使者『ロミアス』を100回殺害", "迷子の子猫を100回殺害", "吟遊詩人を100回殺害"
		titlename2(25) = "戦術スキルレベル100到達", "射撃スキル100到達", "詠唱、読書、暗記スキル合計300到達", "治癒、瞑想スキル合計200到達", "武器スキル合計300到達"
		titlename2(30) = "軽装備、中装備、重装備スキル合計100到達", "回避、見切り、心眼、盾スキル合計300到達", "遺伝子学、解剖学スキル合計200到達", "交渉、投資スキル合計200到達", "採掘、鍵開け、探知、罠解体、自然鑑定スキル合計200到達"
		titlename2(35) = "裁縫、錬金術、大工、宝石細工スキル合計100到達", "隠密、窃盗スキル合計150到達", "信仰スキル100到達", "料理スキル50到達", "旅歩き、釣りスキル合計50到達"
		titlename2(40) = "魔力の限界、魔力制御、魔道具スキル合計100到達", "重量挙げ、両手持ちスキル合計200到達", "二刀流スキル100到達", "栽培スキル100到達", "乗馬スキル100到達"
		titlename2(45) = "演奏スキル150到達", "妹の日記30冊読破", "合計7321マイル踏破", "旅立たせたペット数10体到達", "金銭を受け取る側での気持ちいいこと1000回到達"
		titlename2(50) = "作った子供の数10体到達", "人体錬成成功数5回到達", "食べた人肉の数1000枚到達", "大神七柱の信仰をAFを賜る程度まで高める", "所持金1億gp到達"
		titlename2(55) = "名声10万到達", "原子爆弾『Cat's Cradle』使用数50到達", "結婚相手30人到達", "ダンジョンの住人数50人到達", "すくつ1000階到達"
		titlename2(60) = "謎の奴隷商人からペットを47回購入", "ユニークモンスター20体撃破", "『秩序のユニコーン』を撃破", "ハンマーを転生させる", "生命力、マナ、速度、運を含めた全主能力2000到達"
		titlename2(65) = "1回の攻撃で2000万ダメージを与える", "愛情の証を1000回受け取る", "妹猫のイベントを1000回クリアする", "少女騎士団を1000回護りきる", "リトルシスターを1000回救助するか殺害する"
		titlename2(70) = "ハンマーで会心の出来を1000回作成", "全ての武器・戦術・射撃スキル2000到達" , "全ての魔法レベル2000到達", "アリーナで1000回勝利", "プレイ時間1000時間突破"
		titlename2(75) = "《The Over Wish》を自身の力で撃破", "所持金100Igp到達", "NPC図鑑を100%コレクトする", "アイテム図鑑を100%コレクトする", "すくつ10000階到達/最大HP20億突破"
		titlename2(80) = "願い/BPを使用せずにPCとペットの筋力を計5000鍛える", "願い/BPを使用せずにPCとペットの耐久を計5000鍛える", "願い/BPを使用せずにPCとペットの器用を計5000鍛える", "願い/BPを使用せずにPCとペットの感覚を計5000鍛える", "願い/BPを使用せずにPCとペットの習得を計5000鍛える"
		titlename2(85) = "願い/BPを使用せずにPCとペットの意思を計5000鍛える", "願い/BPを使用せずにPCとペットの魔力を計5000鍛える", "願い/BPを使用せずにPCとペットの魅力を計5000鍛える", "願い/BPを使用せずにPCとペットの生命を計5000鍛える", "願い/BPを使用せずにPCとペットのマナを計5000鍛える"
		titlename2(90) = "《飢えた猟犬》を撃破", "《古代のミュータント》を撃破", "《氷窟の主》を撃破", "洞窟の主『サーペンテ』を撃破", "犠牲の代弁者『アオクス』を撃破"
		titlename2(95) = "混沌の妖精『カオシー』を撃破", "ポートセリアからポートカプールへの船を利用する", "シークレットゾーンでアイテムを10個交換する", "サウスティリスのサブクエストをすべて達成する", "フェアリゾートの土地を購入する"
		titlename2(100) = "任意のギルドに加入し、グランドマスターに昇進", "《汐路のセリア》の信仰をAFを賜る程度まで高める", "交易品を1スタックで50万GP以上利益を出して売却", "《牧畜のダイボニー》の信仰をAFを賜る程度まで高める", "ペットを牧場で100回繁殖させる"
		titlename2(105) = "《汐路のセリア》を撃破", "《牧畜のダイボニー》を撃破", "ならく5階到達"
	} else {
		titlename(0) = "Decoy", "Born in a Temple", "Leer", "Nekodamashi", "Phantom Slasher"
		titlename(5) = "Checkmate", "The Daily Lunch Show Special", "Repeat Kill Squad", "Champion of the Labyrinths", "Mach Speed Cat"
		titlename(10) = "Destroyed Destructive Weapons", "The Purifier", "John Connor", "Sadist Killer", "Elemental Master"
		titlename(15) = "Harvester", "Earth Splitter", "Mewmewmew!", "You're Fired!", "Nobody's Inside"
		titlename(20) = "Ragnarok", "Do Gooder", "Mold Killer", "Returning Home", "Wailing Choir"
		titlename(25) = "God of War", "The 13th", "Archmage", "Emptiness", "One Man Army"
		titlename(30) = "Hell's Wall", "The Blind Sword", "Mad Scientist", "Dragons' Den", "Treasure Hunter"
		titlename(35) = "Father", "Stealth", "Messenger of Justice", "Best in Palmia!", "Super Tourist"
		titlename(40) = "Elder Demon Pope", "Strength is Power", "Dual Wield Mastery", "Slave to Turnips", "Unmasked Rider"
		titlename(45) = "The Baby", _onii3(rnd(6), cSex(0)), "Search of Mother", "The day we fly on our wings", "1000th Target 'Slayed'"
		titlename(50) = "Happy Family Plan", "Mincemeat Alchemist", "Hannibal Lecter", "The Unfaithful", "Billionaire"
		titlename(55) = "You sound familiar...", "Felix Hoenikker", "Nighttime Predator", "Hello, I am Mayor", "Junkie"
		titlename(60) = "Black Organization Member", "Monster Hunter", "Devourer of Ends", "Tubal-cain", "Athana"
		titlename(65) = "Areus", "Faunus", "Bastet", "Kumari", "Deus Ex Machina"
		titlename(70) = "Dints", "Nurta", "Isis", "Carly", "Chronos"
		titlename(75) = "Beyond Wish", "Ganesa", "Battle Master", "Item Master", "The End?"
		titlename(80) = "POW Charange", "END Charange", "DEX Charange", "PER Charange", "LER Charange"
		titlename(85) = "WIL Charange", "MAG Charange", "CHR Charange", "HP Charange", "MP Charange"
		titlename(90) = "Disorderly Crowd", "Innovation", "Let It Go", "Wizard Only Live Twice", "NECROMANIA"
		titlename(95) = "The world is spinning", "Seagull Sailors", "Redcap", "Love saves the Tyris", "Fairy Crossing: New Horizons"
		titlename(100) = "Technology for freedom", "NOW'S YOUR CHANCE TO BE A", "BIG SHOT", "Pastoralism Moon", "THE TETSUWAN RUSH"
		titlename(105) = "Tetrapod", "Sheep dog", "Censored"
		titlename2(0) = "Defeat <Rodlob> the boss of yeeks", "Defeat <Tuwen> the master of the pyramid", "Defeat <Vesda> the fire dragon", "Defeat <Cacy> the cat tamer", "Defeat <Ungaga> the minotaur king"
		titlename2(5) = "Defeat <Wynan> the lord of the Ancient Castle", "Defeat <Quruiza> the red-eyed Deceiver and <Corgon> the steel dragon", "Defeat <Issizzle> the dark abomination", "Defeat <Zeome> the false prophet", "Defeat <Frisia> the cat queen"
		titlename2(10) = "Defeat <Utima> the destroyer of Xeren", "Defeat <Azzrssil> the impure", "Defeat Mani of Machine", "Defeat Lulwy of Wind", "Defeat Itzpalt of Element"
		titlename2(15) = "Defeat Kumiromi of Harvest", "Defeat Opatos of Earth", "Defeat Ehekatl of Luck", "Defeat Jure of Healing", "Defeat <God inside Ehekatl>"
		titlename2(20) = "Defeat all 8 gods", "Kill <Gwen> the innocent 100 times", "Kill <Lomias> the messenger from Vindale 100 times", "Kill stray cat 100 times", "Kill bard 100 times"
		titlename2(25) = "Reach 100 in Tactics", "Reach 100 in Marksman", "Reach 300 combined in casting, literacy, and memorization", "Reach 200 combined in healing and meditation", "Reach 300 combined in weapon skills"
		titlename2(30) = "Reach 100 combined in light, medium, and heavy armor", "Reach 300 combined in evasion, greater evasion, eye of mind, and shield", "Reach 200 combined in gene engineer and anatomy", "Reach 200 combined in negotiation and investing", "Get 200 mining/lock picking/detection/disarm trap/sense quality combined"
		titlename2(35) = "Reach 100 combined in tailoring, alchemy, carpentry, and jeweler", "Reach 150 combined in stealth and pickpocket", "Reach 100 in faith", "Reach 50 in cooking", "Reach 50 combined in traveling and fishing"
		titlename2(40) = "Reach 100 combined in magic capacity, control magic, and magic device", "Reach 200 combined in weight lifting and two hand", "Reach 100 in dual wield", "Reach 100 in gardening", "Reach 100 in riding"
		titlename2(45) = "Reach 150 in performer", "Read 30 little sister's diary", "Travel more than 7321 miles", "Let 10 pets go on journey", "Prostitute to others 1000 times"
		titlename2(50) = "Have 10 children", "Achieve 5 successful human transmutations", "Eat 1000 human flesh", "Increase favor until an artifact is rewarded for all gods.", "Achieve 100,000,000 gp"
		titlename2(55) = "Achieve 100,000 fame", "Use 50 nuclear bombs", "Achieve 30 marriage partners", "Reach 50 people living in dungeon", "Reach 1000th floor of Void"
		titlename2(60) = "Buy 47 pets from slave master.", "Defeat 20 unique monsters.", "Defeat <The Unicorn of Order>", "Reincarnate a hammer", "Reached 2000 main ability"
		titlename2(65) = "Causes 20 million damage.", "Receive a proof of love 1000 times.", "Clear a sister cat event 1000 times.", "Protect the Knights of the Girl 1000 times.", "Rescue or kill Little Sister 1000 times."
		titlename2(70) = "Create a meeting with a hammer 1000 times.", "All weapons, tactics, and shooting skills reach 2000." , "All magic skills reach 2000.", "Win 1000 times in the arena.", "Over 1000 hours of play time."
		titlename2(75) = "Defeat The Over Wish.", "Achieve 100I gp.", "All Enemy Kill." , "All Item Collect." , "Reach 10000th floor and 2000000000 MaxHP."
		titlename2(80) = "Train POW to a total of 5000.", "Train END to a total of 5000.", "Train DEX to a total of 5000.", "Train PER to a total of 5000.", "Train LER to a total of 5000."
		titlename2(85) = "Train WIL to a total of 5000.", "Train MAG to a total of 5000.", "Train CHR to a total of 5000.", "Train HP to a total of 5000.", "Train MP to a total of 5000."
		titlename2(90) = "Defeat <Hungry hound>", "Defeat <Ruins mutant>", "Defeat <Master of the ice cave>", "Defeat <Servente>", "Defeat <Aocus>"
		titlename2(95) = "Defeat <Chaosy>", "Take a boat from Serria to Kapul", "Exchange 10 items in the Secret Zone", "Complete all SouthTyris subquests", "Buy Fairy island."
		titlename2(100) = "Join any guild and be promoted to Grandmaster", "Increase favor until an artifact is rewarded for Serria", "Sell a stack of trade goods for a profit of 500,000 GP", "Increase favor until an artifact is rewarded for Dybony", "Breed a Pet 100 times at the farm"
		titlename2(105) = "Defeat Serria", "Defeat Dybony", "Reach 5th floor of Abyss"
	}
	listmax = 0
	page = 0
	pagesize = 15
	cs = 0
	tc = 0
	cs_bk = -1
	page_load
	ww = 700
	wh = 400
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	windowanime wx, wy, ww, wh, 10, 4
	redraw 0
	drawmenu 4
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_feat.bmp", 1
	gsel 0
	windowshadow = 1
*label_1172
	listmax = 0
	repeat length(titlename)
		if (cnt < 63 & curmenu == 0) {
			list(0, listmax) = cnt, cnt + 1
			listmax++
		} else {
			if (cnt >= 63 & cnt < 90 & curmenu == 2) {
				list(0, listmax) = cnt, cnt + 1
				listmax++
			} else {
				if (cnt >= 90 & curmenu == 1) {
					list(0, listmax) = cnt, cnt + 1
					listmax++
				}
			}
		}
	loop
	gosub *label_1276
	repeat listmax
		if (ogdata(440 + list(0, cnt)) > 0) {
			s = titlename(list(0, cnt))
		} else {
			s = lang("？？？？？？", "??????")
		}
		pos wx + 30, wy + 61 + cnt * 19
		x = 84
		listn(0, cnt) = s
	loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1173
	redraw 0
	s = lang("称号", "Titles")
	s(1) = lang("決定キー [効果オン/オフ]  ", "Enter [effect on/off]") + strhint5 + lang("条件を満たすことで称号を獲得できる", "Earn titles after fulfilling their conditions")
	i = 0
	display_window (windoww - 730) / 2 + inf_screenx, winposy(430, i) + i * 15, 730, 430, 55, 40
	if (jp) {
		s = "称号名", "条件"
	} else {
		s = "Title Name", "Conditions"
	}
	display_topic s, wx + 46, wy + 36
	display_topic s(1), wx + 255, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 57, wy + 66 + cnt * 19
			gfini 640, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, 4, list(0, p)
		pos wx + 270, wy + 66 + cnt * 19 + 2
		mes titlename2(list(0, p))
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p >= 0) {
		if (ogdata(440 + p) > 0) {
			snd 19
			if (ogdata(440 + p) == 2) {
				ogdata(440 + p) = 1
			} else {
				ogdata(440 + p) = 2
			}
			goto *label_1172
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1172
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1172
		}
	}
	if (key == key_identify) {
		title_pos = list(0, pagesize * page + cs)
		gosub *label_1174
		goto *label_1171
	}
	if (key == key_cancel) {
		gosub *label_0623
		if (ogdata(440) == 2) {
			spact(640 - 600) = 1
		} else {
			spact(640 - 600) = 0
		}
		if (ogdata(443) == 2) {
			spact(639 - 600) = 1
		} else {
			spact(639 - 600) = 0
		}
		if (ogdata(445) == 2) {
			spact(641 - 600) = 1
		} else {
			spact(641 - 600) = 0
		}
		if (ogdata(446) == 2) {
			spact(642 - 600) = 1
		} else {
			spact(642 - 600) = 0
		}
		if (ogdata(486) == 2) {
			spact(643 - 600) = 1
		} else {
			spact(643 - 600) = 0
		}
		if (ogdata(474) == 2) {
			ospact(sId_escape - 661) = 1
		} else {
			ospact(sId_escape - 661) = 0
		}
		if (ogdata(491) == 2) {
			ospact(sId_poundingOut - 661) = 1
		} else {
			ospact(sId_poundingOut - 661) = 0
		}
		if (ogdata(534) == 2) {
			ospact(sId_summonundead - 661) = 1
		} else {
			ospact(sId_summonundead - 661) = 0
		}
		menucycle = 0
		goto *label_1623
	}
	// 称号ページ切り替え
	if (key == key_next | key == key_prev) {
		p = curmenu
		if (key == key_next) {
			curmenu++
			if (curmenu > 2) {
				curmenu = 0
			}
		}
		if (key == key_prev) {
			curmenu--
			if (curmenu < 0) {
				curmenu = 2
			}
		}
		if (p != curmenu) {
			screenupdate = -1
			goto *label_1171
		}
	}
	goto *label_1173
  *label_1174
	snd 26
	page_save
	page = 0
	pagesize = 15
	listmax = 0
	p = 0
	s = ""
	title_description = "", "", ""

	if (title_pos == 0) {
		title_description(1) = lang("\t\t称号の効果：\nイークを召喚できるようになる。\nPCとペットの食事にかかるターンが半分になる。", "\t\tTitle effect:\nAble to summon yeeks.\nHalf the turn to eat.")
		title_description(2) = lang("イークの首領『ルードルボ』殺害数：", "<Rodlob> the boss of yeeks killed: ") + npcmemory(0, 242)
	}
	if (title_pos == 1) {
		title_description(1) = lang("\t\t称号の効果：\nたまに呪いを無効にする。", "\t\tTitle effect:\nSometimes invalidate curses.")
		title_description(2) = lang("ピラミッドの主『ツェン』殺害数：", "<Tuwen> the master of the pyramid killed: ") + npcmemory(0, 257)
	}
	if (title_pos == 2) {
		title_description(0) = "キッ"
		title_description(1) = lang("\t\t称号の効果：\n物理攻撃命中時、稀に相手の軽減率を低下させてダメージを算出する。", "\t\tTitle effect:\nWhen physical attack hits, has a rare chance to deal damage after reducing enemy protection.")
		title_description(2) = lang("火炎竜『ヴェスダ』殺害数：", "<Vesda> the fire dragon killed: ") + npcmemory(0, 140)
	}
	if (title_pos == 3) {
		title_description(1) = lang("\t\t称号の効果：\n猫を召喚できるようになる。", "\t\tTitle effect:\nAble to summon cats.")
		title_description(2) = lang("猫使い『ケシー』殺害数：", "<Cacy> the cat tamer killed: ") + npcmemory(0, 230)
	}
	if (title_pos == 4) {
		title_description(1) = lang("\t\t称号の効果：\nミノタウロスの王『ウンガガ』が通常モンスターとして出現する。", "\t\tTitle effect:\n<Ungaga> the minotaur king will now appear as part of the normal monster roster.")
		title_description(2) = lang("ミノタウロスの王『ウンガガ』殺害数：", "<Ungaga> the minotaur king killed: ") + npcmemory(0, 300)
	}
	if (title_pos == 5) {
		title_description(1) = lang("\t\t称号の効果：\n駒を召喚できるようになる。", "\t\tTitle effect:\nAble to summon chess pieces.")
		title_description(2) = lang("古城の主『ワイナン』殺害数：", "<Wynan> the lord of the Ancient Castle killed: ") + npcmemory(0, 143)
	}
	if (title_pos == 6) {
		title_description(1) = lang("\t\t称号の効果：\n炎の生き物を召喚できるようになる。", "\t\tTitle effect:\nAble to summon flame creatures.")
		title_description(2) = lang("赤き義眼の『クルイツゥア』殺害数：", "<Quruiza> the red-eyed Deceiver killed: ") + npcmemory(0, 144) + "\n" + lang("鋼鉄竜『コルゴン』殺害数：", "<Corgon> the steel dragon killed: ") + npcmemory(0, 145)
	}
	if (title_pos == 7) {
		title_description(1) = lang("\t\t称号の効果：\n女性アンデッドに与えるダメージが増加する。\n混沌の城の主が毎月1日に復活するようになる。", "\t\tTitle effect:\nIncreases damage dealt to female undeads.\nThe lords of Forts of Chaos on the first day of the month.")
		title_description(2) = lang("闇の奇形『イスシズル』殺害数：", "<Issizzle> the dark abomination killed: ") + npcmemory(0, 141)
	}
	if (title_pos == 8) {
		title_description(1) = lang("\t\t称号の効果：\nレシマスの1階に帰還することができる。\n任意のペットを店番に任命することができる。", "\t\tTitle effect:\nCan return to the first floor of Lesimas.\nCan Any pet be assigned to the shop keeper.")
		title_description(2) = lang("偽りの預言者『ゼーム』殺害数：", "<Zeome> the false prophet killed: ") + npcmemory(0, 2)
	}
	if (title_pos == 9) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと任意の街に帰還することができる。", "\t\tTitle effect:\nCan return to any towns you have visited via blessed scroll of return.")
		title_description(2) = lang("猫の女王『フリージア』殺害数：", "<Frisia> the cat queen killed: ") + npcmemory(0, 175)
	}
	if (title_pos == 10) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと任意のノースティリスの混沌の城に帰還することができる。", "\t\tTitle effect:\nCan return to any Forts of Chaos via blessed scroll of return.")
		title_description(2) = lang("ゼイレン究極破壊兵器『ウティマ』殺害数：", "<Utima> the destroyer of Xeren killed: ") + npcmemory(0, 177)
	}
	if (title_pos == 11) {
		title_description(1) = lang("\t\t称号の効果：\nノースティリスの混沌の城の模様替えが出来るようになる。", "\t\tTitle effect:\nCan recolor the castle of chaos in North Tyris.")
		title_description(2) = lang("不浄なる者『アズラシズル』殺害数：", "<Azzrssil> the impure killed: ") + npcmemory(0, 178)
	}
	if (title_pos == 12) {
		title_description(1) = lang("\t\t称号の効果：\n機械のマニ信仰時、みだれうちの回数が最大値で固定される。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《機械のマニ》殺害数：", "<Mani> killed: ") + npcmemory(0, 342)
	}
	if (title_pos == 13) {
		title_description(1) = lang("\t\t称号の効果：\n風のルルウィ信仰時、鈍足の効果で速度が低下しなくなる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《風のルルウィ》殺害数：", "<Lulwy> killed: ") + npcmemory(0, 306)
	}
	if (title_pos == 14) {
		title_description(1) = lang("\t\t称号の効果：\n元素のイツパロトル信仰時、\n火で消失したアイテムをマテリアルに変換できる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《元素のイツパロトル》殺害数：", "<Itzpalt> killed: ") + npcmemory(0, 367)
	}
	if (title_pos == 15) {
		title_description(1) = lang("\t\t称号の効果：\n収穫のクミロミ信仰時、★クミロミ像を無制限に使用できる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《収穫のクミロミ》殺害数：", "<Kumiromi> killed: ") + npcmemory(0, 339)
	}
	if (title_pos == 16) {
		title_description(1) = lang("\t\t称号の効果：\n地のオパートス信仰時、採掘に必要なターン数が大幅に減少する。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《地のオパートス》殺害数：", "<Opatos> killed: ") + npcmemory(0, 338)
	}
	if (title_pos == 17) {
		title_description(1) = lang("\t\t称号の効果：\n幸運のエヘカトル信仰時、\n宝の地図から稀に珍しいものが手に入るようになる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《幸運のエヘカトル》殺害数：", "<Ehekatl> killed: ") + npcmemory(0, 331)
	}
	if (title_pos == 18) {
		title_description(1) = lang("\t\t称号の効果：\n癒しのジュア信仰時、低確率で死を回避できる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《癒しのジュア》殺害数：", "<Jure> killed: ") + npcmemory(0, 366)
	}
	if (title_pos == 19) {
		title_description(1) = lang("\t\t称号の効果：\n願いで《エヘカトルの中の神》を降臨させることができるようになる。", "\t\tTitle effect:\nCan summon <God inside Ehekatl> via wish.")
		title_description(2) = lang("《エヘカトルの中の神》殺害数：", "<God inside Ehekatl> killed: ") + npcmemory(0, 336)
	}
	if (title_pos == 20) {
		title_description(1) = lang("\t\t称号の効果：\nゲロバグが復活する。\n魔術師の収穫を纏めて唱えることができるようになる。", "\t\tTitle effect:\nCan capture any monsters by letting them vomit.\ncan now summon the magic harvest.")
	}
	if (title_pos == 21) {
		title_description(1) = lang("\t\t称号の効果：\nカルマ上限が20上昇する。", "\t\tTitle effect:\nIncreases upper limit of karma by 20.")
		title_description(2) = lang("無邪気な少女『グウェン』殺害数：", "<Gwen> the innocent killed: ") + npcmemory(0, 213)
	}
	if (title_pos == 22) {
		title_description(1) = lang("\t\t称号の効果：\nパーティー会場に異形の森の使者『ロミアス』が存在する場合、\nパーティー開始時に告知される。", "\t\tTitle effect:\nIf <Lomias> the messenger exists in party time, \nit will be announced at its start.")
		title_description(2) = lang("異形の森の使者『ロミアス』殺害数：", "<Lomias> the messenger from Vindale killed: ") + npcmemory(0, 34)
	}
	if (title_pos == 23) {
		title_description(1) = lang("\t\t称号の効果：\n迷子の子猫に帰還の巻物を渡すことができる。\nわが家の任意の地下階層に帰還することができる。", "\t\tTitle effect:\nCan give scrolls of return to stray cats.\nCan return to any level of your home.")
		title_description(2) = lang("迷子の子猫殺害数：", "Stray cats killed: ") + npcmemory(0, 332)
	}
	if (title_pos == 24) {
		title_description(1) = lang("\t\t称号の効果：\n演奏者への投石ダメージが上昇する。\nPCの演奏が下手でも石を投げられなくなる。", "\t\tTitle effect:\nIncrease thrown stone damage to performers.\nNo more rocks flying into the PC performance.")
		title_description(2) = lang("吟遊詩人殺害数：", "Bards killed: ") + npcmemory(0, 326)
	}
	if (title_pos == 25) {
		title_description(1) = lang("\t\t称号の効果：\nスウォームの効果範囲が拡大する。", "\t\tTitle effect:\nExpands effective range of Swarm.")
		title_description(2) = lang("バブル殺害数：", "Bubbles killed: ") + npcmemory(0, 286) + "\n" + lang("ブルーバブル殺害数：", "Blue bubbles killed: ") + npcmemory(0, 285) + "\n" + lang("塊の怪物殺害数：", "Mass monsters killed: ") + npcmemory(0, 287) + "\n" + lang("キューブ殺害数：", "Cubes killed: ") + npcmemory(0, 327)
	}
	if (title_pos == 26) {
	}
	if (title_pos == 27) {
		title_description(1) = lang("\t\t称号の効果：\n装備による上限を無視して詠唱成功率が5%底上げされる。", "\t\tTitle effect:\nIncreases absolute casting success rate by 5%.")
	}
	if (title_pos == 28) {
		title_description(1) = lang("\t\t称号の効果：\nスタミナの自然回復量が上昇する。", "\t\tTitle effect:\nIncreases natural stamina regeneration.")
	}
	if (title_pos == 30) {
		title_description(1) = lang("\t\t称号の効果：\nペットに対する敵意をPCに転嫁する。", "\t\tTitle effect:\nShifts aggro from pets to player.")
	}
	if (title_pos == 31) {
		title_description(1) = lang("\t\t称号の効果：\n盲目状態でも周囲2マスの敵の居場所が把握できる。", "\t\tTitle effect:\nCan see the enemy's place even in the blind.")
	}
	if (title_pos == 32) {
		title_description(1) = lang("\t\t称号の効果：\n残骸の出現率が上昇する。", "\t\tTitle effect:\nIncreases drop chance for monster parts.")
	}
	if (title_pos == 33) {
		title_description(1) = lang("\t\t称号の効果：\n大口投資ができるようになる。\nさらに所持金全てを投資できるようになる。", "\t\tTitle effect:\nInvesting large amounts at a time is now possible.\nIn addition, can invest whole of your gold pieces at once.")
	}
	if (title_pos == 34) {
		title_description(1) = lang("\t\t称号の効果：\n脱出できるようになる。", "\t\tTitle effect:\nCan Escape anytime.")
	}
	if (title_pos == 35) {
		title_description(1) = lang("\t\t称号の効果：\nレシピでの調合時の最大作成可能個数が増加する。", "\t\tTitle effect:\nAble to blend up to more items at once.")
		title_description(2) = lang("最大作成可能個数：", "Max Count:") + (1000 + ((sdata(176, 0) + sdata(177, 0) + sdata(178, 0) + sdata(179, 0)) / 10))
	}
	if (title_pos == 36) {
		title_description(1) = lang("\t\t称号の効果：\n盗みを見咎められたときにたまにうまくやりすごすことができる。", "\t\tTitle effect:\nWhile stealing, you will sometimes be able to skillfully evade detection.")
	}
	if (title_pos == 37) {
		title_description(1) = lang("\t\t称号の効果：\n異教徒に与えるダメージが増加し、同教徒に与えるダメージが減少する。", "\t\tTitle effect:\nIncreases damage dealt to others following a different god while decreasing damage to those following the same god.")
	}
	if (title_pos == 38) {
		title_description(1) = lang("\t\t称号の効果：\n任意の料理を作ることができるようになる。\n一括料理が可能になる。", "\t\tTitle effect:\nAble to make any dish of your choosing.\nBulk cooking becomes possible.")
	}
	if (title_pos == 39) {
		title_description(1) = lang("\t\t称号の効果：\n探索コマンドでユニークモンスターがマップ上に存在する場合\nその方角が分かるようになる。", "\t\tTitle effect:\nSearch command will tell you if a unique monster exists on the map.")
	}
	if (title_pos == 40) {
		title_description(1) = lang("\t\t称号の効果：\n魔道具を失敗することなく扱うことができるようになる。", "\t\tTitle effect: Able to zap rods without failure.\n")
	}
	if (title_pos == 41) {
		title_description(1) = lang("\t\t称号の効果：\n両手持ちのときにスウォームの効果範囲が拡大する。", "\t\tTitle effect:\nWhen two-hand wielding, expands effective range of Swarm.")
	}
	if (title_pos == 42) {
		title_description(1) = lang("\t\t称号の効果：\n二刀流状態のときに二度目の追加打撃が発生することがある。", "\t\tTitle effect:\nWhen dual wielding it is possible to make a 2nd extra attack from an extra attack.")
	}
	if (title_pos == 43) {
		title_description(1) = lang("\t\t称号の効果：\n自動収穫で実っている作物のみを収穫できる。", "\t\tTitle effect:\nCan choose only fruits when auto-harvesting.")
	}
	if (title_pos == 44) {
		title_description(1) = lang("\t\t称号の効果：\n異名を願った時、自由に決められるようになる。", "\t\tTitle effect:\nWhen you ask for a synonym, you will be able to decide freely.")
	}
	if (title_pos == 45) {
		title_description(1) = lang("\t\t称号の効果：\n演奏依頼が出現しやすくなる。", "\t\tTitle effect:\nPart time quests tends to appear up more often.")
	}
	if (title_pos == 46) {
		title_description(1) = lang("\t\t称号の効果：\n妹を召喚できるようになる。", "\t\tTitle effect:\nAble to summon younger sister.")
		title_description(2) = lang("妹の日記読破数：" + ogdata(439) + "冊", "Number of little sister's diary read: " + ogdata(439) + " diaries")
	}
	if (title_pos == 47) {
		title_description(1) = lang("\t\t称号の効果：\nグローバルマップでの移動に要するターン数が減少する。", "\t\tTitle effect:\nReduces amount of turns used when moving on global map.")
		title_description(2) = lang("総歩行距離：" + ogdata(438) + "マイル", "Total distance traveled: " + ogdata(438) + " miles")
	}
	if (title_pos == 48) {
		title_description(1) = lang("\t\t称号の効果：\nわが家に来客を5人まで留め置くことができる。", "\t\tTitle effect:\nUp to 5 guests can be kept at your home.")
		title_description(2) = lang("旅立たせたペットの数:", "Number of pets going on their journey: ") + ogdata(437)
	}
	if (title_pos == 49) {
		title_description(1) = lang("\t\t称号の効果：\n気持ちいいことをしても病気にならなくなる。", "\t\tTitle effect:\nWill not get sick when prostituting.")
		title_description(2) = lang("売り手側で気持ちいいことをした回数： "+ ogdata(436) + "回", "Number of sexes: " + ogdata(436) +  " times")
	}
	if (title_pos == 50) {
		title_description(2) = lang("作った子供の数:", "Your children: ") + ogdata(435)
	}
	if (title_pos == 51) {
		title_description(1) = lang("\t\t称号の効果：\nモツ抜きできるようになる。\n遺伝子合成機で特殊行動の遺伝が可能になる。\n攻撃者の解剖学スキルに応じた確率で残骸の追加ドロップが発生する。", "\t\tTitle effect:\nAble to do Pounding Out.\nAdditional debris drops with a probability that depends on the attacker's anatomy skill.")
		title_description(2) = lang("人体錬成成功数:", "Human transmutations: ") + ogdata(434) + lang("", " times")
	}
	if (title_pos == 52) {
		title_description(1) = lang("\t\t称号の効果：\n人肉を食べても発狂しなくなる。", "\t\tTitle effect:\nEating human flesh no longer causes you to go insane.")
		title_description(2) = lang("食べた人肉の数:", "Human flesh you have eaten: ") + ogdata(433)
	}
	if (title_pos == 53) {
		title_description(1) = lang("\t\t称号の効果：\n神の使徒を制限なく仲間にできる。", "\t\tTitle effect:\nCan keep as many god pets as you wish.")
		s(1) = lang("マニ", "Mani"), lang("ルルウィ", "Lulwy"), lang("イツパロトル", "Itzpalt"), lang("エヘカトル", "Ehekatl"), lang("オパートス", "Opatos"), lang("ジュア", "Jure"), lang("クミロミ", "Kumiromi")
		title_description(2) = lang("信仰の完了状況:\n", "Current state\n")
		repeat 7, 1
			title_description(2) += s(cnt)
			if (ogbit(cnt)) {
				title_description(2) += lang(":○\n", ": Done\n")
			} else {
				title_description(2) += lang(":×\n", ":\n")
			}
		loop
	}
	if (title_pos == 54) {
		title_description(1) = lang("\t\t称号の効果：\nわが家で雇うことのできる使用人の数の上限が上昇する。", "\t\tTitle effect:\nIncreases limit of how many employees you can hire at your home.")
	}
	if (title_pos == 55) {
		title_description(1) = lang("\t\t称号の効果：\nグローバルマップでたまに少女騎士団と遭遇するようになる。", "\t\tTitle effect:\nAllows you to sometimes encounter Knights of the Little Girls while traveling in global map.")
	}
	if (title_pos == 56) {
		title_description(1) = lang("\t\t称号の効果：\n原子爆弾『Cat's Cradle』の効果範囲が拡大する。\n原子爆弾『Cat's Cradle』をまとめ買い出来るようになる。\n原子爆弾『Cat's Cradle』の威力が上昇する。", "\t\tTitle effect:\nIncreases effective range of nuclear bomb explosion.\nAble to buy 10 or 100 atomic bombs at one deal.\nIncreases the damage of nuclear bomb explosion.")
		title_description(2) = lang("原子爆弾『Cat's Cradle』使用数:", "Bombarded atomic bombs: ") + ogdata(431) + "\n" + lang("現在の威力:", "Current damage: ") + (1000 + ogdata(431) * 5)
	}
	if (title_pos == 57) {
		title_description(2) = lang("結婚人数:", "Number of people you married: ") + ogdata(430)
	}
	if (title_pos == 58) {
		title_description(1) = lang("\t\t称号の効果：\n自分の物件に名前を付けられるようになる。", "\t\tTitle effect:\nCan name your home.")
	}
	if (title_pos == 59) {
		title_description(1) = lang("\t\t称号の効果：\n全てのキャラのステータス上限が上昇する。(無効化していても発動)\nすくつの任意の階に帰還できる。\n呪われた帰還の巻物を読む事で、クリップルタウンに行くことが出来る。", "\t\tTitle effect:\nIncreases the status limit.(passive)\nCan return any level of the Void.\nYou can go to Void Town by reading cursed scroll of return.")
	}
	if (title_pos == 60) {
		title_description(1) = lang("\t\t称号の効果：\nグローバルマップでたまに微笑む斬殺者と遭遇するようになる。", "\t\tTitle effect:\nAllows you to sometimes encounter the Smiling Witch while traveling in global map.")
		title_description(2) = lang("謎の奴隷商人からペットを購入した回数:", "Number of deals with the slave master: ") + ogdata(429)
	}
	if (title_pos == 61) {
		title_description(1) = lang("\t\t称号の効果：\n『秩序のユニコーン』が出現するようになる。", "\t\tTitle effect:\nAllows <The Unicorn of Order> to randomly appear.")
		title_description(2) = lang("ユニークモンスター撃破数:", "Unique monsters killed: ") + ogdata(428)
	}
	if (title_pos == 62) {
		title_description(1) = lang("\t\t称号の効果：\nユニークモンスターが何度でも出現する。", "\t\tTitle effect:\nUnique monsters will appear again after defeat.")
		title_description(2) = lang("『秩序のユニコーン』撃破数:", "<The Unicorn of Order> killed: ") + getcnpcmemory4name(0, "The Unicorn of Order")
	}
	if (title_pos == 63) {
		title_description(1) = lang("\t\t称号の効果：\n生きている武器へ付与されるエンチャントが強化される。\n武器強化・魔法強化の巻物で付与されるエンチャントも強化される。\n名前の巻物使用中に次のレベルアップで提示されるエンチャント及び継承できるエンチャントが分かるようになる。", "\t\tTitle effect:\nBuff the strength of enchantments added to living weapons.\nSee the Enchantments presented during the use of the name scroll.")
		title_description(2) = lang("一つのハンマーを転生させた最大数:", "Number of times to reincarnate one hammer: ") + ogdata(427)
	}
	if (title_pos == 64) {
		title_description(1) = lang("\t\t称号の効果：\n潜在能力の下限と上限が50%上昇する。", "\t\tTitle effect:\nPotential is raised by 50%.")
	}
	if (title_pos == 65) {
		title_description(1) = lang("\t\t称号の効果：\nダメージ上限が20億まで上昇する。", "\t\tTitle effect:\nIncreases damage limit to 20 billion.")
	}
	if (title_pos == 66) {
		title_description(1) = lang("\t\t称号の効果：\n好感度が*Love*のペットのHP/MPと与えるダメージが上昇する。", "\t\tTitle effect:\nIncreases pet's HP / MP and damage dealt.")
		title_description(2) = lang("愛情の証を受け取った回数:", "Number of times received a proof of love: ") + ncgdata(0)
	}
	if (title_pos == 67) {
		title_description(1) = lang("\t\t称号の効果：\n妹猫のイベントの報酬が増加する。", "\t\tIncreases rewards for sister cat events.")
		title_description(2) = lang("遊んであげた回数:", "Event clear count : ") + ncgdata(1)
	}
	if (title_pos == 68) {
		title_description(1) = lang("\t\t称号の効果：\n少女騎士団のイベントの報酬が増加する。", "\t\tIncreases rewards for Knights Events.")
		title_description(2) = lang("護りきった回数:", "Event clear count : ") + ncgdata(2)
	}
	if (title_pos == 69) {
		title_description(1) = lang("\t\t称号の効果：\n★リトル捕獲玉を持って遺伝子を残すことで、\n固定アーティファクトの引継ぎが可能になる。", "\t\tArtifacts can be inherited. need to have a little catch ball.")
	}
	if (title_pos == 70) {
		title_description(1) = lang("\t\t称号の効果：\n会心の出来の装備の質が上昇する。\nスタミナが無くなるまで連続で作成することが出来るようになる。", "\t\tIncreases the quality of the equipment in the form of a conspiracy. You will be able to create continuously until you run out of stamina.")
		title_description(2) = lang("会心の出来を作成した回数:", "count : ") + ncgdata(3)
	}
	if (title_pos == 71) {
		title_description(1) = lang("\t\t称号の効果：\nマナ吸収とスタミナ吸収の効果が増加する。", "\t\tIncreases the effects of mana and stamina absorption.")
	}
	if (title_pos == 72) {
		title_description(1) = lang("\t\t称号の効果：\n装備による上限を無視して詠唱成功率が更に5%底上げされる。", "\t\tTitle effect:\nIncreases absolute casting success rate by 5%.")
	}
	if (title_pos == 73) {
		title_description(1) = lang("\t\t称号の効果：\nアリーナに挑戦者が現れる様になる。", "\t\tTitle effect:\nA challenger will appear in the arena.")
		title_description(2) = lang("累計勝利数:", "Wincount : ") + ncgdata(4)
	}
	if (title_pos == 74) {
		title_description(1) = lang("\t\t称号の効果：\n普通にアイテムを願った時、装備を除き得られる個数が増加する。", "\t\tTitle effect:\nWhen you wish for an item, more items will rain down on you.")
	}
	if (title_pos == 75) {
		title_description(1) = lang("\t\t称号の効果：\n願いの杖の合成が可能になる。\n願いの杖に+値まで充填が出来るようになる。", "\t\tTitle effect:\nCan charged rod of wish.")
	}
	if (title_pos == 76) {
		title_description(1) = lang("\t\t称号の効果：\nペットに任命できる店の種類が増加する。\n『ジェン』に2147483647gp支払って装備を購入できるようになる。\n大金を貯金できる貯金箱が出現するようになる。", "\t\tTitle effect:\nThe types of stores that can be appointed as pets increase.\nYou will be able to pay 2,147,483,647gp to <Jen> to purchase equipment.\nA money box will appear where you can save a lot of money.")
	}
	if (title_pos == 77) {
		title_description(1) = lang("\t\t称号の効果：\nシェイドの中身を看破することが出来る。", "\t\tTitle effect:\nCan see through the contents of the shade.")
	}
	if (title_pos == 78) {
		title_description(1) = lang("\t\t称号の効果：\n生成されるアイテムが初めから識別された状態になる。", "\t\tTitle effect:\nItem is identified from the spawning.")
	}
	if (title_pos == 79) {
		title_description(1) = lang("\t\t称号の効果：\n生成されるエンチャントの質が上昇する。\nミラルから特別なガロクの槌がもらえるようになる。", "\t\tTitle effect:\nIncreases the quality of enchantments generated.")
	}
	if (title_pos >= 80 & title_pos < 90) {
		title_description(1) = lang("\t\t称号の効果：\n潜在能力の最大値が5%上昇する。", "\t\tTitle effect:\nIncreases maximum potential by 5%.")
	}
	if (title_pos == 80) {
		title_description(2) = lang("鍛えた筋力:", "Points trained : ") + ncgdata(210)
	}
	if (title_pos == 81) {
		title_description(2) = lang("鍛えた耐久:", "Points trained : ") + ncgdata(211)
	}
	if (title_pos == 82) {
		title_description(2) = lang("鍛えた器用:", "Points trained : ") + ncgdata(212)
	}
	if (title_pos == 83) {
		title_description(2) = lang("鍛えた感覚:", "Points trained : ") + ncgdata(213)
	}
	if (title_pos == 84) {
		title_description(2) = lang("鍛えた習得:", "Points trained : ") + ncgdata(214)
	}
	if (title_pos == 85) {
		title_description(2) = lang("鍛えた意思:", "Points trained : ") + ncgdata(215)
	}
	if (title_pos == 86) {
		title_description(2) = lang("鍛えた魔力:", "Points trained : ") + ncgdata(216)
	}
	if (title_pos == 87) {
		title_description(2) = lang("鍛えた魅力:", "Points trained : ") + ncgdata(217)
	}
	if (title_pos == 88) {
		title_description(2) = lang("鍛えた生命力:", "Points trained : ") + ncgdata(218)
	}
	if (title_pos == 89) {
		title_description(2) = lang("鍛えたマナ:", "Points trained : ") + ncgdata(219)
	}
	if (title_pos == 90) {
		title_description(1) = lang("\t\t称号の効果：\n奴隷の質が上昇する。", "\t\tTitle effect:\nThe quality of the slaves will increase.")
	}
	if (title_pos == 91) {
		title_description(1) = lang("\t\t称号の効果：\n採掘でアイテムが追加で出現することがある。", "\t\tTitle effect:\nAdditional items may appear in mining.")
	}
	if (title_pos == 92) {
		title_description(1) = lang("\t\t称号の効果：\n依頼で入手できる金貨の量が増える。", "\t\tTitle effect:\nIncrease the amount of gold pieces available for requests from residents.")
	}
	if (title_pos == 93) {
		title_description(1) = lang("\t\t称号の効果：\n変異種の洞窟の任意階に帰還できる。", "\t\tTitle effect:\nYou can return to any floor of the mutant cave.")
	}
	if (title_pos == 94) {
		title_description(1) = lang("\t\t称号の効果：\nアンデッド召喚を使用できる。", "\t\tTitle effect:\nCan use undead summoning.")
	}
	if (title_pos == 95) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと混沌の城《妖》に帰還することができる。\n混沌の城《妖》の模様替えが出来るようになる。\n混沌の妖精『カオシー』が毎月１日に復活するようになる。", "\t\tTitle effect:\nCan return to Forts of Chaos<fairy> via blessed scroll of return.\nCan recolor the Forts of Chaos<fairy>.\nThe lords of Forts of Chaos<Fairy> on the first day of the month.")
	}
	if (title_pos == 96) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと別大陸の街に帰還することができる。", "\t\tTitle effect:\nCan return to city on a different continent via blessed scroll of return.")
	}
	if (title_pos == 97) {
		title_description(1) = lang("\t\t称号の効果：\nシークレットゾーンへ帰還することが出来る。", "\t\tTitle effect:\nCan return to secret zone.")
	}
	if (title_pos == 98) {
		title_description(1) = lang("\t\t称号の効果：\nカルマ上限が10上昇する。", "\t\tTitle effect:\nIncreases upper limit of karma by 10.")
		title_description(2) = lang("依頼達成数：", "Requests completed: ") + check_stquest_amount() + " / 8"
	}
	if (title_pos == 99) {
		title_description(1) = lang("\t\t称号の効果：\nフェアリゾート限定の敵NPCが別大陸にも出現するようになる。", "\t\tTitle effect:\nEnemy NPCs that are exclusive to Fairy Zort will now appear on other continents.")
	}
	if (title_pos == 100) {
		title_description(1) = lang("\t\t称号の効果：\nギルド移籍時、ある程度のギルドランクが保持される。", "\t\tTitle effect:\nWhen transferring guilds, a certain amount of guild rank is retained.")
	}
	if (title_pos == 101) {
		title_description(1) = lang("\t\t称号の効果：\n盗賊団との遭遇時、交渉を行うことが出来る。", "\t\tTitle effect:\nWhen encountering bandits, you can negotiate with them.")
	}
	if (title_pos == 102) {
		title_description(1) = lang("\t\t称号の効果：\n荷車の改造をより安く依頼できる。", "\t\tTitle effect:\nYou can ask for cheaper modifications to your cargo wagon.")
	}
	if (title_pos == 103) {
		title_description(1) = lang("\t\t称号の効果：\n牧場にて、乳と卵の出現率が上昇する。", "\t\tTitle effect:\nIncreases the rate at which milk and eggs appear on the farm.")
	}
	if (title_pos == 104) {
		title_description(1) = lang("\t\t称号の効果：\nペットの繁殖力が30上昇する。", "\t\tTitle effect:\nThe Breed Power of Pet is increased by 30.")
		title_description(2) = lang("繁殖数：", "Breed: ") + ncgdata(361)
	}
	if (title_pos == 105) {
		title_description(1) = lang("\t\t称号の効果：\n汐路のセリア信仰時、大雨がすぐに収まる。", "\t\tTitle effect:\nWhen believing in Serria, The heavy rain quickly subsided.")
	}
	if (title_pos == 106) {
		title_description(1) = lang("\t\t称号の効果：\n牧畜のダイボニー信仰時、ペットの繁殖力が更に強化される。", "\t\tTitle effect:\nWhen believing in Dybony, The Breed Power of pets is further enhanced.")
	}
	if (title_pos == 107) {
		title_description(1) = lang("\t\t称号の効果：\n商品交換に必要な小さなメダルの枚数が半分になる。", "\t\tTitle effect:\nThe number of small medals required to exchange goods is halved.")
	}
	if (ogdata(440 + title_pos) == 0) {
		list(0, p) = 0
		listn(0, p) = lang("未取得", "Unacquired")
		p++
		title_description(0) = "", ""
	}
	repeat 3
		if (title_description(cnt) == "") {
			continue
		}
		list(0, p) = 0
		listn(0, p) = ""
		p++
		buf = trimdesc(title_description(cnt), 2)
		notesel buf
		repeat noteinfo(0)
			noteget q, cnt
			p(1) = 66, 0
			if (strlen(q) > p(1)) {
				repeat strlen(q) / p(1) + 1
					if (strmid(q, p(2) + p(1), 2) == "。" | strmid(q, p(2) + p(1), 2) == "、") {
						p(1) += 2
					}
					if (strmid(q, p(2), p(1)) == "") {
						break
					}
					list(0, p) = -1
					listn(0, p) = strmid(q, p(2), p(1))
					p++
					p(2) += p(1)
				loop
			} else {
				list(0, p) = 0
				listn(0, p) = q
				if (cnt == noteinfo(0) - 1) {
					list(0, p) = -1
				}
				p++
			}
		loop
	loop
	if (ogdata(440 + title_pos)) {
		if (p == 0) {
			list(0, p) = 0
			listn(0, p) = lang("特に情報はない", "There is no information about this title.")
			p++
		}
	}
	listmax = p
	pagemax = (listmax - 1) / pagesize
	windowshadow = 1
*label_1175
	key_list = key_enter
	keyrange = 0
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1176
	redraw 0
	if (curmenu == 0) {
		s = lang("称号の情報", "Title information") + " (" + (title_pos + 1) + "/63)"
	}
	if (curmenu == 1) {
		s = lang("称号の情報", "Title information") + " (" + (title_pos + 1 - 90) + "/18)"
	}
	if (curmenu == 2) {
		s = lang("称号の情報", "Title information") + " (" + (title_pos + 1 - 63) + "/27)"
	}
	s(1) = lang("ｷｬﾝｾﾙ [閉じる]", "Shift,Esc [Close]")
	display_window (windoww - 600) / 2 + inf_screenx, winposy(408), 600, 408
	if (ogdata(440 + title_pos) == 0) {
		display_topic lang("？？？？？？", "????????????"), wx + 28, wy + 34
	} else {
		display_topic titlename(title_pos), wx + 28, wy + 34
	}
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 0, 0, 0
		pos wx + 68, wy + 68 + cnt * 18
		if (list(0, p) == (-1)) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		}
		if (list(0, p) == (-2)) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 2
			pos wx + ww - strlen(listn(0, p)) * 6 - 80, wy + 68 + cnt * 18
		}
		mes listn(0, p)
	loop
	redraw 1
	await cfg_wait1
	key_check
	if (key == key_north) {
		snd 5
		title_pos--
		if (curmenu == 0) {
			if (title_pos < 0) {
				title_pos = 62
			}
		}
		if (curmenu == 1) {
			if (title_pos < 90) {
				title_pos = 107
			}
		}
		if (curmenu == 2) {
			if (title_pos < 63) {
				title_pos = 89
			}
		}
		page_load
		cs--
		if (cs < 0) {
			page--
			cs = 14
		}
		if (page < 0) {
			if (curmenu == 0) {
				page = 5
				cs = 3
			}
			if (curmenu == 1) {
				page = 2
				cs = 3
			}
			if (curmenu == 2) {
				page = 2
				cs = 12
			}
		}
		goto *label_1174
	}
	if (key == key_south) {
		snd 5
		title_pos++
		if (curmenu == 0) {
			if (title_pos > 62) {
				title_pos = 0
			}
		}
		if (curmenu == 1) {
			if (title_pos > 107) {
				title_pos = 90
			}
		}
		if (curmenu == 2) {
			if (title_pos > 89) {
				title_pos = 63
			}
		}
		page_load
		cs++
		if (cs >= 15) {
			page++
			cs = 0
		}
		if (curmenu == 0) {
			if (page >= 6) {
				page = 0
			}
		}
		if (curmenu == 1) {
			if (page >= 6) {
				page = 0
			}
		}
		if (curmenu == 2) {
			if (page >= 2) {
				page = 0
			}
		}
		goto *label_1174
	}
	if (key == key_west) {
		key = key_pagedown
	}
	if (key == key_east) {
		key = key_pageup
	}
	if (cs >= keyrange) {
		cs_bk = -1
		cs = keyrange - 1
		if (cs < 0) {
			cs = 0
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1175
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1175
		}
	}
	if (key == key_cancel | key == key_enter) {
		nc_intb_gro1 = (effortcnt() * 5)
		nc_intb_gro2 = 100 - nc_intb_gro1
		return
	}
	goto *label_1176
*label_1177
	if (cc != 0) {
		return
	}
	f = 0
	if (npcmemory(0, 242) != 0) {
		if (ogdata(440) == 0) {
			f = 1
			ogdata(440) = 1
		}
	}
	if (npcmemory(0, 257) != 0) {
		if (ogdata(441) == 0) {
			f = 1
			ogdata(441) = 1
		}
	}
	if (npcmemory(0, 140) != 0) {
		if (ogdata(442) == 0) {
			f = 1
			ogdata(442) = 1
		}
	}
	if (npcmemory(0, 230) != 0) {
		if (ogdata(443) == 0) {
			f = 1
			ogdata(443) = 1
		}
	}
	if (npcmemory(0, 300) != 0) {
		if (ogdata(444) == 0) {
			f = 1
			ogdata(444) = 1
		}
	}
	if (npcmemory(0, 143) != 0) {
		if (ogdata(445) == 0) {
			f = 1
			ogdata(445) = 1
		}
	}
	if (npcmemory(0, 144) != 0 & npcmemory(0, 145) != 0) {
		if (ogdata(446) == 0) {
			f = 1
			ogdata(446) = 1
		}
	}
	if (npcmemory(0, 141) != 0) {
		if (ogdata(447) == 0) {
			f = 1
			ogdata(447) = 1
		}
	}
	if (npcmemory(0, 2) != 0) {
		if (ogdata(448) == 0) {
			f = 1
			ogdata(448) = 1
		}
	}
	/*猫まっしぐら*/
	if (npcmemory(0, 175) != 0) {
		if (ogdata(449) == 0) {
			f = 1
			ogdata(449) = 1
		}
	}
	/*破壊兵器を破壊した(性別)*/
	if (npcmemory(0, 177) != 0) {
		if (ogdata(450) == 0) {
			f = 1
			ogdata(450) = 1
		}
	}
	if (npcmemory(0, 178) != 0) {
		if (ogdata(451) == 0) {
			f = 1
			ogdata(451) = 1
		}
	}
	if (npcmemory(0, 342) != 0) {
		if (ogdata(452) == 0) {
			f = 1
			ogdata(452) = 1
		}
	}
	if (npcmemory(0, 306) != 0) {
		if (ogdata(453) == 0) {
			f = 1
			ogdata(453) = 1
		}
	}
	if (npcmemory(0, 367) != 0) {
		if (ogdata(454) == 0) {
			f = 1
			ogdata(454) = 1
		}
	}
	if (npcmemory(0, 339) != 0) {
		if (ogdata(455) == 0) {
			f = 1
			ogdata(455) = 1
		}
	}
	if (npcmemory(0, 338) != 0) {
		if (ogdata(456) == 0) {
			f = 1
			ogdata(456) = 1
		}
	}
	if (npcmemory(0, 331) != 0) {
		if (ogdata(457) == 0) {
			f = 1
			ogdata(457) = 1
		}
	}
	if (npcmemory(0, 366) != 0) {
		if (ogdata(458) == 0) {
			f = 1
			ogdata(458) = 1
		}
	}
	if (npcmemory(0, 336) != 0) {
		if (ogdata(459) == 0) {
			f = 1
			ogdata(459) = 1
		}
	}
	if (ogdata(452) != 0 & ogdata(453) != 0 & ogdata(454) != 0 & ogdata(455) != 0 & ogdata(456) != 0 & ogdata(457) != 0 & ogdata(458) != 0 & ogdata(459) != 0) {
		if (ogdata(460) == 0) {
			f = 1
			ogdata(460) = 1
		}
	}
	if (npcmemory(0, 213) >= 100) {
		if (ogdata(461) == 0) {
			f = 1
			ogdata(461) = 1
		}
	}
	if (npcmemory(0, 34) >= 100) {
		if (ogdata(462) == 0) {
			f = 1
			ogdata(462) = 1
		}
	}
	if (npcmemory(0, 332) >= 100) {
		if (ogdata(463) == 0) {
			f = 1
			ogdata(463) = 1
		}
	}
	if (npcmemory(0, 326) >= 100) {
		if (ogdata(464) == 0) {
			f = 1
			ogdata(464) = 1
		}
	}
	if (sorg(152, 0) >= 100) {
		if (ogdata(465) == 0) {
			f = 1
			ogdata(465) = 1
		}
	}
	if (sorg(189, 0) >= 100) {
		if (ogdata(466) == 0) {
			f = 1
			ogdata(466) = 1
		}
	}
	if (sorg(150, 0) + sorg(165, 0) + sorg(172, 0) >= 300) {
		if (ogdata(467) == 0) {
			f = 1
			ogdata(467) = 1
		}
	}
	if (sorg(154, 0) + sorg(155, 0) >= 200) {
		if (ogdata(468) == 0) {
			f = 1
			ogdata(468) = 1
		}
	}
	if (sorg(100, 0) + sorg(101, 0) + sorg(102, 0) + sorg(103, 0) + sorg(104, 0) + sorg(105, 0) + sorg(106, 0) + sorg(107, 0) + sorg(108, 0) + sorg(109, 0) + sorg(110, 0) + sorg(111, 0) >= 300) {
		if (ogdata(469) == 0) {
			f = 1
			ogdata(469) = 1
		}
	}
	if (sorg(169, 0) + sorg(170, 0) + sorg(171, 0) >= 100) {
		if (ogdata(470) == 0) {
			f = 1
			ogdata(470) = 1
		}
	}
	if (sorg(173, 0) + sorg(187, 0) + sorg(186, 0) + sorg(168, 0) >= 300) {
		if (ogdata(471) == 0) {
			f = 1
			ogdata(471) = 1
		}
	}
	if (sorg(151, 0) + sorg(161, 0) >= 200) {
		if (ogdata(472) == 0) {
			f = 1
			ogdata(472) = 1
		}
	}
	if (sorg(156, 0) + sorg(160, 0) >= 200) {
		if (ogdata(473) == 0) {
			f = 1
			ogdata(473) = 1
		}
	}
	if (sorg(162, 0) + sorg(163, 0) + sorg(158, 0) + sorg(159, 0) + sorg(175, 0) >= 200) {
		if (ogdata(474) == 0) {
			f = 1
			ogdata(474) = 1
		}
	}
	if (sorg(176, 0) + sorg(177, 0) + sorg(178, 0) + sorg(179, 0) >= 100) {
		if (ogdata(475) == 0) {
			f = 1
			ogdata(475) = 1
		}
	}
	if (sorg(157, 0) + sorg(300, 0) >= 150) {
		if (ogdata(476) == 0) {
			f = 1
			ogdata(476) = 1
		}
	}
	if (sorg(181, 0) >= 100) {
		if (ogdata(477) == 0) {
			f = 1
			ogdata(477) = 1
		}
	}
	if (sorg(184, 0) >= 50) {
		if (ogdata(478) == 0) {
			f = 1
			ogdata(478) = 1
		}
	}
	if (sorg(182, 0) + sorg(185, 0) >= 50) {
		if (ogdata(479) == 0) {
			f = 1
			ogdata(479) = 1
		}
	}
	if (sorg(164, 0) + sorg(174, 0) + sorg(188, 0) >= 100) {
		if (ogdata(480) == 0) {
			f = 1
			ogdata(480) = 1
		}
	}
	if (sorg(167, 0) + sorg(153, 0) >= 200) {
		if (ogdata(481) == 0) {
			f = 1
			ogdata(481) = 1
		}
	}
	if (sorg(166, 0) >= 100) {
		if (ogdata(482) == 0) {
			f = 1
			ogdata(482) = 1
		}
	}
	if (sorg(180, 0) >= 100) {
		if (ogdata(483) == 0) {
			f = 1
			ogdata(483) = 1
		}
	}
	if (sorg(301, 0) >= 100) {
		if (ogdata(484) == 0) {
			f = 1
			ogdata(484) = 1
		}
	}
	if (sorg(183, 0) >= 150) {
		if (ogdata(485) == 0) {
			f = 1
			ogdata(485) = 1
		}
	}
	if (sorg(2, 0) >= 2000 & sorg(3, 0) >= 2000 & sorg(10, 0) >= 2000 & sorg(11, 0) >= 2000 & sorg(12, 0) >= 2000 & sorg(13, 0) >= 2000 & sorg(14, 0) >= 2000 & sorg(15, 0) >= 2000 & sorg(16, 0) >= 2000 & sorg(17, 0) >= 2000 & sorg(18, 0) >= 2000 & sorg(19, 0) >= 2000) {
		if (ogdata(504) == 0) {
			f = 1
			ogdata(504) = 1
		}
	}
	if (sorg(100, 0) >= 2000 & sorg(101, 0) >= 2000 & sorg(102, 0) >= 2000 & sorg(103, 0) >= 2000 & sorg(104, 0) >= 2000 & sorg(105, 0) >= 2000 & sorg(106, 0) >= 2000 & sorg(107, 0) >= 2000 & sorg(108, 0) >= 2000 & sorg(109, 0) >= 2000 & sorg(110, 0) >= 2000 & sorg(111, 0) >= 2000 & sorg(152, 0) >= 2000 & sorg(189, 0) >= 2000) {
		if (ogdata(511) == 0) {
			f = 1
			ogdata(511) = 1
		}
	}
	if (magiclv()) {
		if (ogdata(512) == 0) {
			f = 1
			ogdata(512) = 1
		}
	}
	if (((gPlayTime + timeGetTime() / 1000 - time_begin) / 60 / 60) >= 1000) {
		if (ogdata(514) == 0) {
			f = 1
			ogdata(514) = 1
		}
	}
	if (ogdata(439) >= 30) {
		if (ogdata(486) == 0) {
			f = 1
			ogdata(486) = 1
			txtef 5
			txt -1, lang("あなたは妹を理解してしまった。", "You may have accidentally understood more than you should about your younger sister.")
			dmgcon 0, 11, 1000
			dmgsan 0, 1000
		}
	}
	if (ogdata(438) >= 7321) {
		if (ogdata(487) == 0) {
			f = 1
			ogdata(487) = 1
		}
	}
	if (ogdata(437) >= 10) {
		if (ogdata(488) == 0) {
			f = 1
			ogdata(488) = 1
		}
	}
	if (ogdata(436) >= 1000) {
		if (ogdata(489) == 0) {
			f = 1
			ogdata(489) = 1
		}
	}
	if (ogdata(435) >= 10) {
		if (ogdata(490) == 0) {
			f = 1
			ogdata(490) = 1
		}
	}
	if (ogdata(434) >= 5) {
		if (ogdata(491) == 0) {
			f = 1
			ogdata(491) = 1
		}
	}
	if (ogdata(433) >= 1000) {
		if (ogdata(492) == 0) {
			f = 1
			ogdata(492) = 1
		}
	}
	if (peek(ogdata(432), 0) == 254) {
		if (ogdata(493) == 0) {
			f = 1
			ogdata(493) = 1
		}
	}
	if (cGold(0) >= 100000000) {
		if (ogdata(494) == 0) {
			f = 1
			ogdata(494) = 1
		}
	}
	if (cFame(0) >= 100000) {
		if (ogdata(495) == 0) {
			f = 1
			ogdata(495) = 1
		}
	}
	if (ogdata(431) >= 50) {
		if (ogdata(496) == 0) {
			f = 1
			ogdata(496) = 1
		}
	}
	if (ogdata(430) >= 30) {
		if (ogdata(497) == 0) {
			f = 1
			ogdata(497) = 1
		}
	}
	if (ogdata(20) >= 50) {
		if (ogdata(498) == 0) {
			f = 1
			ogdata(498) = 1
		}
	}
	if (areaVisitedDeepestFloor(42) - areaDangerLevel(42) + 1 >= 1000) {
		if (ogdata(499) == 0) {
			f = 1
			ogdata(499) = 1
		}
	}
	// ならく5層到達
	if (areaVisitedDeepestFloor(210) - areaDangerLevel(210) + 1 >= 5) {
		if (ogdata(547) == 0) {
			f = 1
			ogdata(547) = 1
		}
	}
	if (ogdata(429) >= 47) {
		if (ogdata(500) == 0) {
			f = 1
			ogdata(500) = 1
		}
	}
	if (ogdata(501) == 0) {
		if (ogdata(428) >= 20) {
			f = 1
			ogdata(501) = 1
		}
	}
	if (ogdata(502) == 0) {
		p(82) = findunid("The Unicorn of Order")
		if (p(82)) {
			if (getcnpcmemory(0, p(82) - 1) != 0) {
				f = 1
				ogdata(502) = 1
			}
		}
	}
	if (ogdata(503) == 0) {
		if (ogdata(427)) {
			f = 1
			ogdata(503) = 1
		}
	}
	if (ncgdata(50) >= 100) {
		if (ogdata(516) == 0) {
			f = 1
			ogdata(516) = 1
		}
	}
	if (ogdata(519) == 0) {
		if (areaVisitedDeepestFloor(42) - areaDangerLevel(42) + 1 >= 10000 & cMaxHp(0) >= 2000000000) {
			f = 1
			ogdata(519) = 1
		}
	}
	repeat 10
	if (ogdata(520 + cnt) == 0) {
		if (ncgdata(210 + cnt) >= 5000) {
			f = 1
			ogdata(520 + cnt) = 1
		}
	}
	loop
	if (f == 1) {
		snd 44
		txtef 2
		txt -1, lang("新しい称号を獲得した！", "Earned a new title!")
	}
	return
*label_1178
*label_1179
	curmenu = 1
	listmax = 0
	page = 99
	pagesize = 40
	cs = 0
	cc = 0
	listmax = noteinfo(0)
	keyrange = 0
	key_list(0) = key_enter
	buff = newsbuff
	if (newsbuff == "") {
		buff = "No news"
	}
	notesel buff
	noteadd " - News - ", 0
	noteadd "", 1
	if (noteinfo(0) / (pagesize / 2) \ 2 == 1) {
		repeat pagesize / 2
			noteadd "", 2
		loop
	}
	page = noteinfo(0) / pagesize
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Quest - "
	noteadd ""
	gosub *label_0229
	repeat gNumberOfExistingQuests
		if (qdata(8, cnt) == 0) {
			continue
		}
		rq = cnt
		val = 2
		gosub *label_0233
	loop
	val = 0
	gosub *label_0230
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Quest Item - "
	noteadd ""
	gosub *label_0231
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	gold = 0
	p = limit(cFame(0) / 10, 100, 25000)
	if (cFame(0) >= 25000) {
		p += (cFame(0) - 25000) / 100
	}
	gold += p
	noteadd " - Title & Ranking - "
	noteadd ""
	noteadd lang("名声: ", "Fame: ") + cFame(0)
	noteadd ""
	noteadd lang("死亡回数: ", "Deaths: ") + gDeathCount
	noteadd ""
	repeat 10
		if (gdata(120 + cnt) < 10000) {
			noteadd "" + ranktitle(cnt) + " Rank." + gdata(120 + cnt) / 100
			s = lang("給料: 約 " + calcincome(cnt) + " gold  ", "Pay: About " + calcincome(cnt) + " gold pieces ")
			gold += calcincome(cnt)
			if (cnt == 3 | cnt == 4 | cnt == 5 | cnt == 8) {
			} else {
				s += lang("ノルマ: ", "\nDeadline: ") + gdata(140 + cnt) + lang("日以内", " Days left")
			}
			noteadd s
			noteadd ""
		}
	loop
	noteadd lang("EXバトル: 勝利 " + gdata(802) + "回 最高Lv" + gExArenaLevel, "EX Arena Wins:" + gdata(802) + "  Highest Level:" + cnvrank(gExArenaLevel))
	noteadd ""
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Income & Expense - "
	noteadd ""
	if (jp) {
		noteadd "◆ 給料(毎月1日と15日に支給)"
		noteadd "@BL　合計　　 : 約 " + thousandsep(str(gold)) + strgold
		noteadd ""
		noteadd "◆ 請求書内訳(毎月1日に発行)"
		noteadd "@RE　人件費  : 約 " + thousandsep(str(gCostToHire)) + strgold
		noteadd "@RE　運営費  : 約 " + thousandsep(str(calccostbuilding())) + strgold
		noteadd "@RE　税金    : 約 " + thousandsep(str(calccosttax())) + strgold
		noteadd "@RE　合計　  : 約 " + thousandsep(str(gCostToHire + calccostbuilding() + calccosttax())) + strgold
		noteadd ""
		noteadd "現在未払いの請求書は" + gLeftBill + "枚"
	} else {
		noteadd "Salary (Paid every 1st and 15th day)"
		noteadd "@BL  Sum    : About " + gold + " GP"
		noteadd ""
		noteadd "Bills  (Issued every 1st day)"
		noteadd "@RE  Labor  : About " + gCostToHire + " GP"
		noteadd "@RE  Maint. : About " + calccostbuilding() + " GP"
		noteadd "@RE  Tax    : About " + calccosttax() + " GP"
		noteadd "@RE  Sum    : About " + (gCostToHire + calccostbuilding() + calccosttax()) + " GP"
		noteadd ""
		noteadd "You have " + gLeftBill + " unpaid bills."
	}
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Completed Quests - "
	noteadd ""
	val = 1
	gosub *label_0230
	listmax = noteinfo(0)
	redraw 0
	showtitle lang("ジャーナル", "Journal"), strhint2 + strhint3, 236, 1
	drawmenu 2
	wx = (windoww - 736) / 2 + inf_screenx
	wy = winposy(448)
	snd 59
	windowanime wx, wy, 736, 448, 10, 4
*label_1180
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	gsel 4
	pos 0, 0
	picload_ exedir + "graphic\\book.bmp", 1
	gsel 0
	pos wx, wy
	gcopy 4, 0, 0, 736, 448
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		x = wx + 80 + cnt / 20 * 306
		y = wy + 45 + cnt \ 20 * 16
		noteget s, p
		if (strmid(s, 0, 1) == "@") {
			s(1) = strmid(s, 1, 2)
			s = strmid(s, 3, strlen(s) - 3)
			font lang(cfg_font1, cfg_font2), 10 + en - en * 2, 1
			color 0, 0, 200
			if (s(1) == "QL") {
				color 100, 100, 0
			}
			if (s(1) == "QC") {
				color 0, 100, 100
			}
			if (s(1) == "QM") {
				color 0, 100, 0
			}
			if (s(1) == "RE") {
				color 100, 0, 0
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			}
			if (s(1) == "BL") {
				color 0, 0, 100
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			}
		} else {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			color 0, 0, 0
		}
		pos x, y
		mes s
		if (p \ 20 == 0) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			color 0, 0, 0
			pos x + 90, y + 330
			mes "- " + (p / 20 + 1) + " -"
			if (p \ 40 == 20) {
				if (page < pagemax) {
					pos x + 200, y + 330
					mes "(more)"
				}
			}
		}
	loop
*label_1181
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 2) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 2
				}
			}
			key = ""
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					goto *label_1583
				}
				if (curmenu == 1) {
					goto *label_1179
				}
				if (curmenu == 2) {
					goto *label_1580
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 71
			page++
			goto *label_1180
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 71
			page--
			goto *label_1180
		}
	}
	if (key == key_cancel | key == key_enter) {
		menucycle = 0
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1181



#defcfunc findsupply int __xxx, int __yyy, local __zzz, local __aaa
	__zzz = -1
	__aaa = 0
	inv_getheader 0
	repeat 1 + (__yyy == 1)
		cnt2 = cnt
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (ibit(13, cnt)) {
				continue
			}
			if (qdata(3, __xxx) == 1003) {
				if (refitem(iId(cnt), 5) == 57000) {
					if (iParam1(cnt) / 1000 == qdata(12, __xxx)) {
						if (iParam2(cnt) == 0) {
							if (__yyy == 1) {
								if (cnt2 == 1) {
									__zzz = cnt + 10000
									__aaa = 1
									break
								}
							}
						}
						if (iParam2(cnt) == qdata(13, __xxx)) {
							__zzz = cnt
							__aaa = 1
							break
						}
					}
				}
			}
			if (qdata(3, __xxx) == 1004 | qdata(3, __xxx) == 1011) {
				if (iId(cnt) == qdata(11, __xxx)) {
					__zzz = cnt
					__aaa = 1
					break
				}
			}
		loop
		if (__aaa) {
			break
		}
	loop
	return __zzz
*label_1183
*label_1184
	if (cfg_extrahelp) {
		if (gdata(200 + 4) == 0) {
			if (mode == 0) {
				if (cContinuousActionTurn(0) == 0) {
					gdata(200 + 4) = 1
					ghelp = 4
					gosub *label_1575
					screenupdate = -1
					gosub *label_0623
				}
			}
		}
	}
	gosub *quest_updateQuests
	listmax = 0
	page = 0
	pagesize = 4
	cs = 0
	cc = 0
	cs_bk = -1
	repeat gNumberOfExistingQuests
		if (qdata(1, cnt) != gCurrentMap) {
			continue
		}
		if (qdata(3, cnt) == 0) {
			continue
		}
		if (qdata(8, cnt) != 0) {
			continue
		}
		rc = qdata(0, cnt)
		if (cState(rc) != 1) {
			continue
		}
		list(0, listmax) = cnt, qdata(5, cnt)
		listmax++
	loop
	if (listmax == 0) {
		txt -1, lang("新しい依頼は掲示されていないようだ。", "It seems there are no new notices.")
		goto *label_1617
	}
	gosub *label_1276
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_board.bmp", 1
	gsel 0
	redraw 0
	gsel 4
	fillbg 3, 960, 96, 128, 128
	ww = 560
	h = 140
	wh = h * 4
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	repeat 4
		y = wy + cnt * 120
		window wx + 4, y + 4, ww, h, 0, -1
		window wx, y, ww, h
		pos wx + 20, y + 8
		gcopy 3, 960, 144 + 96, 48, 84
	loop
	hide_popup@00m = 1
	gosub *label_0625
	hide_popup@00m = 0
	gsel 0
*label_1185
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1186
	redraw 0
	s = lang("掲載されている依頼", "Notice Board"), strhint2 + strhint3b
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, inf_ver
	gmode 2
	font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
	pos wx + ww + 20, wy
	color 0, 0, 0
	bmes "Page " + (page + 1) + "/" + (pagemax + 1), 255, 255, 255
	keyrange = 0
	repeat pagesize
		y = wy + cnt * 120 + 20
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		pos wx + 70, y
		gfini 460, 18
		gfdec2 12, 14, 16
		display_key wx + 70, y - 2, cnt
	loop
	cs_listbk
	repeat pagesize
		y = wy + cnt * 120 + 20
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		rq = list(0, p)
		tc = qdata(0, rq)
		val = 0
		gosub *label_0233
		p = pagesize * page + cnt
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		cnt2 = cnt
		cs_list s(3), wx + 96, y - 1, 19
		color 0, 0, 0
		s(2) = "(" + nquestdate + ")"
		pos wx + 344, y + 2
		mes s(2)
		color 0, 0, 0
		s(4) = cdatan(0, tc)
		cutname s(4), 20
		pos wx + 392, y + 2
		mes s(4)
		talk_conv buff, 70
		p = qdata(5, rq) / 5 + 1, 14
		repeat 1
			if (qdata(14, rq) == 3) {
				if (findsupply(rq, 1) != (-1)) {
					if (stat < 10000) {
						color 0, 0, 0
					} else {
						color 80, 80, 80
					}
					break
				}
			}
			if (cLevel(0) * 2 < qdata(5, rq)) {
				color 205, 0, 0
				break
			}
			if (cLevel(0) * 3 / 2 < qdata(5, rq)) {
				color 140, 80, 0
				break
			}
			if (cLevel(0) < qdata(5, rq)) {
				color 0, 0, 205
				break
			}
			color 0, 155, 0
		loop
		if (p < 11) {
			dy = 0
			if (p > 5) {
				font lang(cfg_font1, cfg_font2), 10 - en * 2, 0
				dy = -3
			}
			repeat p
				pos wx + 270 + cnt \ 5 * 13, y + dy + cnt / 5 * 8 + 2
				mes lang("★", "$")
			loop
		} else {
			pos wx + 270, y + 2
			mes lang("★×", "$ x ") + p
		}
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 0, 0, 0
		pos wx + 20, y + 20
		mes buff
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		txtnew
		txt -1, lang("依頼主に会う？", "Do you want to meet the client?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval != 0) {
			goto *label_1185
		}
		tc = qdata(0, p)
		rq = p
		client = tc
		efid = 619
		nc_himo = 1
		gosub *label_1398
		tc = client
		if (cState(0) == 1) {
			questteleport = 1
			gosub *label_1467
		}
		if (chatteleport == 1) {
			chatteleport = 0
			goto *label_0939
		}
		goto *label_1617
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1185
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1185
		}
	}
	if (key == key_cancel) {
		goto *label_1617
	}
	goto *label_1186
*label_1187
*label_1188
	snd 26
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	repeat 245
		if (allyctrl == 2) {
			if (cState(cnt) != 6 & cState(cnt) != 2) {
				continue
			}
		} else {
			if (allyctrl == 1) {
				if (allyctrl == 1) {
					if (cState(cnt) != 10) {
						continue
					}
				}
			} else {
				if (cState(cnt) != 1) {
					continue
				}
			}
			if (allyctrl != 3) {
				if (cnt < 16) {
					if (cCurrentMap(cnt) != gCurrentMap) {
						continue
					}
				}
			}
		}
		if (allyctrl != 3) {
			if (cnt == 0) {
				continue
			}
		}
		if (cbit(971, cnt) == 1 | cRole(cnt) == 20001 | cRole(cnt) == 20003) {
			continue
		}
		if (eqfaction(cnt, "overwish")) {
			continue
		}
		list(0, listmax) = cnt, -cLevel(cnt)
		listmax++
	loop
	gosub *label_1276
	windowshadow = 1
*label_1189
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1190
	redraw 0
	s = lang("NPC一覧", "NPC List"), strhint2 + strhint3
	display_window (windoww - 700) / 2 + inf_screenx, winposy(448), 700, 448
	if (allyctrl == 0) {
		s = lang("給料", "Wage")
	} else {
		s = lang("雇用費(給料)", "Init. Cost(Wage)")
	}
	display_topic lang("NPCの名前", "Name"), wx + 28, wy + 36
	display_topic lang("情報", "Info"), wx + 350, wy + 36
	if (allyctrl != 2 & allyctrl != 3) {
		display_topic s, wx + 490, wy + 36
	}
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 600, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		transmissivity = 0
		if (cId(list(0, p)) == 343) {
			if (userdata2(1, cCnpcId(list(0, p)))) {
				transmissivity = userdata2(1, cCnpcId(list(0, p)))
			}
		}
		if (ocdata(101, list(0, p))) {
			transmissivity = ocdata(101, list(0, p))
		}
		i = getcharapic(list(0, p)), getcharacolor(list(0, p))
		chara_preparepic i, i(1)
		pos wx + 40, wy + 74 + cnt * 19 - 8
		gmode 4, chipc(2, i), chipc(3, i), 256 - transmissivity
		color 0, 0, 0
		grotate 5, 0, 960, 0, chipc(2, i) / (1 + (chipc(3, i) > inf_tiles)), inf_tiles
		gmode 2
		i = list(0, p)
		s = cdatan(0, i)
		cutname s, 36
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		s = "Lv." + cLevel(i) + " "
		if (cSex(i) == 0) {
			s += cnven(strmale)
		} else {
			s += cnven(strfemale)
		}
		s += lang(" ", "(") + calcage(i) + "" + lang("歳", ")")
		pos wx + 372, wy + 66 + cnt * 19 + 2
		mes s
		if (allyctrl != 2 & allyctrl != 3) {
			if (allyctrl == 1) {
				s = thousandsep(str(calchirecost(i) * 20)) + "(" + thousandsep(str(calchirecost(i))) + ")"
			} else {
				s = thousandsep(str(calchirecost(i)))
			}
			pos wx + 512, wy + 66 + cnt * 19 + 2
			mes s + lang(" gold", "gp")
		}
		if (cs == cnt & oom_posinfo == 1) {
			gosub *label_2053
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		return p
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1189
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1189
		}
	}
	if (key == key_cancel) {
		i = 0
		gosub *label_2053
		return -1
	}
	goto *label_1190
*label_1191
*label_1192
	txtnew
	ctalk 0, 10029, 0, tc
	if (stat == 0) {
		txt -1, lang("何を予約する？", "Which item do you want to reserve? ")
	}
	snd 26
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	repeat 800
		if (itemmemory(2, cnt) == 0) {
			continue
		}
		if (refitem(cnt, 9) != 58005) {
			list(0, listmax) = cnt, cnt
			listmax++
		}
	loop
	gosub *label_1276
	windowshadow = 1
*label_1193
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1194
	redraw 0
	s = lang("予約リスト", "Reserve List"), strhint2 + strhint3
	display_window (windoww - 540) / 2 + inf_screenx, winposy(448), 540, 448
	display_topic lang("アイテムの名前", "Name"), wx + 28, wy + 36
	display_topic lang("予約状況", "Status"), wx + 390, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 440, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		gsel 1
		color 0
		boxf 0, 960, chipi(2, 429), chipi(3, 429) + 960
		pos 0, 960
		gcopy 1, chipi(0, 429), chipi(1, 429), chipi(2, 429), chipi(3, 429)
		gfini chipi(2, 429), chipi(3, 429)
		gfdec2 c_col(0, icolref(i)), c_col(1, icolref(i)), c_col(2, icolref(i))
		gsel selcur
		pos wx + 38, wy + 73 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate 1, 0, 960, 0, inf_tiles, inf_tiles
		s = ioriginalnameref(i)
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		pos wx + 400, wy + 66 + cnt * 19 + 2
		if (itemmemory(2, i) == 1) {
			color 120, 120, 120
			mes lang("入荷なし", "-")
		} else {
			color 55, 55, 255
			mes lang("入荷予定", "Reserved")
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		if (p == 289 | p == 732 | p == 798) {
			snd 27
			txt -1, lang("「その本は入手できないね」", cnvtalk("Ah, that book is unavailable."))
			goto *label_1193
		}
		snd 20
		if (itemmemory(2, p) == 1) {
			itemmemory(2, p) = 2
		} else {
			itemmemory(2, p) = 1
		}
		goto *label_1193
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1193
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1193
		}
	}
	if (key == key_cancel) {
		return -1
	}
	goto *label_1194
*label_1191_01
*label_1192_01
	txtnew
	ctalk 0, 10029, 0, tc
	if (stat == 0) {
		txt -1, lang("何を予約する？", "Which item do you want to reserve? ")
	}
	snd 26
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	repeat 800
		if (itemmemory(0, cnt) == 0) {
			continue
		}
		if (refitem(cnt, 9) == 58005) {
			list(0, listmax) = cnt, cnt
			listmax++
		}
	loop
	gosub *label_1276
	windowshadow = 1
*label_1193_01
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1194_01
	redraw 0
	s = lang("予約リスト", "Reserve List"), strhint2 + strhint3
	display_window (windoww - 540) / 2 + inf_screenx, winposy(448), 540, 448
	display_topic lang("アイテムの名前", "Name"), wx + 28, wy + 36
	display_topic lang("予約状況", "Status"), wx + 390, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 440, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		gsel 1
		color 0
		boxf 0, 960, chipi(2, 170), chipi(3, 170) + 960
		pos 0, 960
		gcopy 1, chipi(0, 170), chipi(1, 170), chipi(2, 170), chipi(3, 170)
		gfini chipi(2, 170), chipi(3, 170)
		gfdec2 c_col(0, icolref(i)), c_col(1, icolref(i)), c_col(2, icolref(i))
		gsel selcur
		pos wx + 38, wy + 73 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate 1, 0, 960, 0, inf_tiles, inf_tiles
		s = ioriginalnameref(i)
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		pos wx + 400, wy + 66 + cnt * 19 + 2
		if (itemmemory(2, i) == 0) {
			color 120, 120, 120
			mes lang("入荷なし", "-")
		} else {
			color 55, 55, 255
			mes lang("入荷予定", "Reserved")
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		if (p == 797) {
			snd 27
			txt -1, lang("「そのハーブは入手できないね」", cnvtalk("Ah, that harb is unavailable."))
			goto *label_1193_01
		}
		snd 20
		if (itemmemory(2, p) == 0) {
			itemmemory(2, p) = 3
		} else {
			itemmemory(2, p) = 0
		}
		goto *label_1193_01
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1193_01
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1193_01
		}
	}
	if (key == key_cancel) {
		return -1
	}
	goto *label_1194_01
*label_1195
*label_1196
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	repeat 57 - 1
		if (cState(cnt) == 0) {
			continue
		}
		list(0, listmax) = cnt, -cFame(cnt)
		listmax++
	loop
	gosub *label_1276
	windowshadow = 1
*label_1197
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1198
	redraw 0
	s = lang("冒険者ランク", "Adventurer Rank"), strhint2 + strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	display_topic lang("冒険者の名前とランク", "Name and Rank"), wx + 28, wy + 36
	display_topic lang("名声(Lv)", "Fame(Lv)"), wx + 320, wy + 36
	display_topic lang("現在地", "Location"), wx + 420, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		transmissivity = 0
		if (cId(list(0, p)) == 343) {
			if (userdata2(1, cCnpcId(list(0, p)))) {
				transmissivity = userdata2(1, cCnpcId(list(0, p)))
			}
		}
		if (ocdata(101, list(0, p))) {
			transmissivity = ocdata(101, list(0, p))
		}
		i = getcharapic(list(0, p)), getcharacolor(list(0, p))
		chara_preparepic i, i(1)
		pos wx + 40, wy + 74 + cnt * 19 - 8
		gmode 4, chipc(2, i), chipc(3, i), 256 - transmissivity
		color 0, 0, 0
		grotate 5, 0, 960, 0, chipc(2, i) / (1 + (chipc(3, i) > inf_tiles)), inf_tiles
		gmode 2
		pos wx + 84, wy + 66 + cnt * 19 + 2
		mes cnvrank(p + 1) + lang("位", "")
		i = list(0, p)
		s = "" + cdatan(1, i) + " " + cdatan(0, i)
		cutname s, 26
		cs_list s, wx + 118, wy + 66 + cnt * 19 - 1, 19
		s = "" + cFame(i) + "(" + cLevel(i) + ")"
		pos wx + 402 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
		mes s
		s = mapname(cCurrentMap(i))
		if (s == "") {
			s = lang("不明", "Unknown")
		}
		if (cState(i) == 4) {
			s = lang("病院", "Hospital")
		}
		pos wx + 435, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	i = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		if (cState(p) == 4) {
			return
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1197
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1197
		}
	}
	if (key == key_cancel) {
		return
	}
	goto *label_1198
*label_1199
*label_1200
	if (jp) {
		inputlog = del_str(inputlog, ",")
		inputlog = del_str(inputlog, " ")
		inputlog = del_str(inputlog, "　")
	} else {
		inputlog = getpath(inputlog, 16)
	}
	inputlog = del_str(inputlog, lang("アイテム", "item"))
	inputlog = del_str(inputlog, lang("スキル", "skill "))
	inputlog = del_str(inputlog, lang("スキル", "skill"))
	return
*label_1201
	sdim lockedaka, 30, 17
	redraw 0
	cs = 0
	cs_bk = -1
	list(0, 0) = -1
	windowshadow = 1
	i = 10500
	name_page = 0
	if (val == 3) {
		if (namedscroll == 1) {
			namedscroll = 0
			display_msg screenmsgy, 1
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 12, 0, 0
			inputlog = ""
			gosub *label_1349
			val = 3
			name_page = int(inputlog)
			if (rtval == (-1) | name_page == 0) {
				goto *label_1202
			}
			i = 10500 + (name_page - 1) * 17
			if (val == 3 & ogdata(503) == 2) {
				name_page -= 1
			}
		}
	}
*label_1202
	if (val == 3 & ogdata(503) == 2) {
		goto *label_1202_01
	}
	redraw 0
	pagesize = 0
	if (cs != cs_bk | p == (-2)) {
		s = lang("異名の選択", "Alias Selection"), strhint3b
		if (val == 0) {
			s(1) += " " + key_mode2 + " " + lang("[異名のロック]", "[Lock Alias]") + "  " + oomsest_strhint1
		}
		display_window (windoww - 400) / 2 + inf_screenx, winposy(458), 400, 458
		display_topic lang("異名の候補", "Alias List"), wx + 28, wy + 30
		if (nameFilter != "") {
			pos wx + 210, wy + 38
			mes lang("フィルタ","Filter") + ": " + nameFilter
		}
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 17
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			if (val == 3) {
				randomize i + cnt
			}
			if (list(0, 0) == (-1)) {
				if (lockedaka(cnt) != "") {
					listn(0, cnt) = lockedaka(cnt)
				} else {
					if (val == 3) {
						listn(0, cnt) = random_title(val)
					} else {
						cnt2 = cnt
						listn(0, cnt2) = ""
						repeat 1000
							nickname = random_title()
							if (nameFilter != "") {
								nicknameLower = getpath(nickname, 16)
								if (instr(nicknameLower, , getpath(nameFilter, 16)) < 0) {
									continue
								}
							}
							listn(0, cnt2) = nickname
							break
						loop
						if (listn(0, cnt2) == "") {
							listn(0, cnt2) = random_title()
						}
					}
				}
				list(1, cnt) = i + cnt
			}
			if (cnt == 0) {
				listn(0, cnt) = lang("別の名前を考える", "Reroll")
			}
			if (cnt == 16 & nc_intb_001 == 0) {
				if (ogdata(484) == 2) {
					listn(0, cnt) = lang("自分で決める", "Decide by oneself")
				}
			}
			pos wx + 38, wy + 66 + cnt * 19 - 2
			gcopy 3, cnt * 24 + 72, 30, 24, 18
			cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
			if (lockedaka(cnt) != "") {
				pos wx + 20, wy + 68 + cnt * 19
				mes "*"
			}
		loop
		i += 17
		cs_bk = cs
		list(0, 0) = 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if (key == key_select(cnt)) {
			p = cnt
			break
		} else {
			p = -1
		}
	loop
	if (p != (-1)) {
		if (key == key_select(0)) {
			list(0, 0) = -1
			snd 103
			cs_bk = -1
		} else {
			if (p == 16 & nc_intb_001 == 0) {
				if (ogdata(484) == 2) {
					val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
					inputlog = ""
					gosub *label_1349
					cmaka = inputlog
					repeat 17
						lockedaka(cnt) = ""
					loop
					snd 20
					nameFilter = ""
					return 1
				}
			}
			nameFilter = ""
			if (val == 3) {
				return p
			}
			cmaka = listn(0, p)
			repeat 17
				lockedaka(cnt) = ""
			loop
			return 1
		}
	}
	if (key == key_cancel) {
		nameFilter = ""
		snd 26
		return 0
	}
	if (key == key_mode2) {
		if (val == 0) {
			if (cs != 0) {
				if (lockedaka(cs) == "") {
					lockedaka(cs) = listn(0, cs)
					p = -2
				} else {
					lockedaka(cs) = ""
					p = -2
				}
				snd 20
			}
		}
	}
	if (key = key_msglog) {
		if (val == 0) {
			val = windoww / 2 - 140 + inf_screenx, winposy(60), 14, 0, 0
			inputlog = ""
			gosub *label_1349 // input
			nameFilter = inputlog
			list(0, 0) = -1 // reset list
			snd 103
			cs = 0  // select 0
			cs_bk = -1
			val = 0
		}
	}
	goto *label_1202
*label_1202_01
	redraw 0
	pagesize = 0
	if (cs != cs_bk | p == (-2)) {
		s = lang("異名の選択", "Alias Selection"), strhint3b
		display_window (windoww - 750) / 2 + inf_screenx, winposy(458), 350, 458
		display_topic lang("異名の候補 Page:", "Alias List Page:") + (name_page + 1), wx + 28, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 17
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			randomize i + cnt
			if (list(0, 0) == (-1)) {
				listn(0, cnt) = random_title(val)
				list(1, cnt) = i + cnt
				ibk = i
			}
			if (cnt == 0) {
				listn(0, cnt) = lang("別の名前を考える", "Reroll")
			}
			pos wx + 38, wy + 66 + cnt * 19 - 2
			gcopy 3, cnt * 24 + 72, 30, 24, 18
			cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		s = lang("エンチャント一覧", "Enchantment List"), lang("上記のエンチャントが出現する", "The above Enchantments.")
		display_window (windoww - 50) / 2 + inf_screenx, winposy(458), 400, 458
		if (ibit(10, ci)) {
			display_topic lang("レベルアップ時に現れるエンチャント", "Level up enchantments"), wx + 28, wy + 30
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
			if (cs != 0) {
				nc_intb_living = 1
				reftype = refitem(iId(ci), 5, ci)
				listmax = 0
				repeat 50
					if (listmax >= 8) {
						break
					}
					randomize (50500 + cs + (name_page * 17)) + (iParam1(ci) * 10) + cnt
					exrand_randomize (50500 + cs + (name_page * 17)) + (iParam1(ci) * 10) + cnt
					encadd ci, randomenc(randomenclv(4)), randomencp(0, ogdata(503) == 2), 0, 0, 1
					if (stat != 0) {
						if (rtval == 34) {
							if (rnd(3)) {
								continue
							}
						}
						findenc = 0
						repeat listmax
							if (list_bk(0, cnt) == rtval) {
								if (encpassivecheck(rtval) | list_bk(1, cnt) == rtval(1)) {
									findenc = 1
									break
								}
							}
						loop
						if (findenc) {
							continue
						}
						if (encpassivecheck(rtval)) {
							if (encfindspec(ci, rtval) != (-1)) {
								continue
							}
						}
						list_bk(0, listmax) = rtval, rtval(1)
						if (ibit(18, ci) & iCurseState(ci) <= (-2)) {
							list_bk(1, listmax) = list_bk(1, listmax) * 5 / 2
						}
						val = list_bk(0, listmax), list_bk(1, listmax)
						gosub *label_0297
						color 0, 0, 100
						pos wx + 28, wy + 60
						mes s
						wy += 16
						listmax++
					} else {
						continue
					}
				loop
				nc_intb_living = 0
			}
		}
		wy = 260
		display_topic lang("継承されるエンチャント", "Inherited enchantments"), wx + 28, wy + 60
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		if (cs != 0) {
			wy += 32
			randomize (50500 + cs + (name_page * 17))
			dim ginga, 15
			ginga = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
			gingamax = 0
			cibk2 = ci
			dbid = iId(ci)
			ci = 5480
			dbmode = 3
			gosub *label_2426
			iNumber(ci) = 0
			ci = cibk2
			repeat 10
				p@m42 = rnd(15)
				if (iEnchantmentId(ci, p@m42) == 0) {
					continue
				}
				f@m42 = 0
				repeat gingamax + 1
					if (p@m42 == ginga(cnt)) {
						f@m42 = 1
						break
					}
				loop
				if (f@m42 == 0) {
					i = iMaterial(ci)
					repeat 8
						if (mtenc(cnt * 2, i) == 0) {
							break
						}
						mtencid = mtenc(cnt * 2, i)
						if (mtencid == 0) {
							break
						}
						if (iEnchantmentId(ci, p@m42) == mtencid) {
							if (iEnchantmentPower(ci, p@m42) - mtenc(cnt * 2 + 1, i) <= 0) {
								f@m42 = 1
								break
							}
						}
					loop
				}
				if (f@m42 == 0) {
					repeat length(fixeditemenc)
						if (fixeditemenc(cnt * 2) == 0) {
							break
						}
						if (iEnchantmentId(ci, p@m42) != fixeditemenc(cnt * 2)) {
							continue
						}
						if (iEnchantmentPower(ci, p@m42) - fixeditemenc(cnt * 2 + 1) <= 0) {
							f@m42 = 1
							break
						}
					loop
				}
				if (f@m42 == 1) {
					continue
				}
				if (rnd(4) > gingamax | iEnchantmentPower(ci, p@m42) < 0) {
					ginga(gingamax) = p@m42
					gingamax++
				}
			loop
			repeat gingamax
				if (ginga(cnt) == (-1)) {
					continue
				}
				val = iEnchantmentId(ci, ginga(cnt)), iEnchantmentPower(ci, ginga(cnt))
				gosub *label_0297
				if (val(1) < 0) {
					color 100, 0, 0
				} else {
					color 0, 0, 100
				}
				pos wx + 28, wy + 60
				mes s
				wy += 16
			loop
		}
		val = 3
		cs_bk = cs
		list(0, 0) = 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if (key == key_select(cnt)) {
			p = cnt
			break
		} else {
			p = -1
		}
	loop
	if (p != (-1)) {
		if (key == key_select(0)) {
			name_page++
			i = ibk
			i += 17
			list(0, 0) = -1
			snd 103
			cs_bk = -1
		} else {
			return p
		}
	}
	if (key == key_cancel) {
		nameFilter = ""
		snd 26
		return 0
	}
	goto *label_1202_01
*label_1203
	return
*label_1204
	if (cfg_NC_logapply == 1) {
		if (chatturn > 20) {
			chatdeny = 0
			chatturn = 0
			s = lang("[願い] " + cdatan(1, 0) + " " + cdatan(0, 0) + "は狂喜して叫んだ。「" + inputlog + "！！」" + txtcopy, "[Wish] " + cdatan(1, 0) + " " + cdatan(0, 0) + " goes wild with joy, \"" + inputlog + "!!\" " + cnven(txtcopy))
			gosub *label_NNet
		}
	}
	return
*label_1205
	nc_intb_002 = 0
	msgtemp = ""
	if (gCurrentMap == 210 & ncgdata(307)) {
		txt -1, lang("「だめよ。」", "Nope.")
		goto *label_1204
	}
	txtgod godcheck(), 2414
	throwsstpevent "Wish", 0, "", 0
	txtcopy = ""
	txtef 5
	txt -1, lang("何を望む？", "What do you wish for? ")
	val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
	inputlog = ""
	gosub *label_1349
	nc_strb_001 = inputlog
	throwsstpevent "Wished", 0, inputlog, 0
	*label_3000
	ogdata(71)++
	ncgdata(61)++
	if (nc_intb_002 == 0) {
		txt -1, lang("「" + inputlog + "！！」", cnvtalk(inputlog + "!!"))
	}
	msgtemp = ""
	autosave = 1 * (gCurrentMap != 35)
	if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
		autosave = 0
	}
	tcopy = 1
	if (inputlog == "" | inputlog == " ") {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		return
	}
	if (en) {
		inputlog = getpath(inputlog, 16)
	}
	snd 24
	if (instr(inputlog, 0, "ナスコちゃん") != (-1) | instr(inputlog, 0, "Nasuko Chan") != (-1)) {
		txt -1, lang("「ナスナスゥ？」", "Nasunasu?")
		goto *label_1204
	}
	if (instr(inputlog, 0, "中の神") != (-1) | instr(inputlog, 0, "god inside") != (-1)) {
		txtgod godcheck(), 2416
		if (stat == 0) {
			txt -1, lang("中の神も大変…あ…中の神なんているわけないじゃない！…ねえ、聞かなかったことにしてね。", "There's no God inside.")
		}
		goto *label_1204
	}
	if (instr(inputlog, 0, "中の人") != (-1) | instr(inputlog, 0, "man inside") != (-1)) {
		txtgod godcheck(), 2417
		if ( stat == 0 ) {
			txt -1, lang("中の人も大変ね。", "There's no man inside.")
		}
		goto *label_1204
	}
	if (ogdata(70) == 0) {
		if (get_freeally() != 0) {
			if (ogdata(71) >= 777 + (ogdata(72) > 0) * 7000) {
				f@se = 0
				p@se = 0
				repeat 55, 1
					if (cState(cnt) != 0) {
						if (cId(cnt) == 368) {
							f@se = 1
							break
						}
					}
				loop
				if (f@se == 0) {
					if (instr(inputlog, 0, "願いの神") != (-1) | instr(inputlog, 0, "god of wishing") != (-1)) {
						ogdata(71) = 0
						flt
						initlv = 5
						novoidlv = 1
						characreate -1, 368, cX(0), cY(0)
						gosub *label_1530
						goto *label_1204
					}
				}
			}
		}
	}
	if (inputlog == "エヘカトル" | inputlog == "ehekatl") {
		txt -1, lang("「うみみゅみゅぁ！」", cnvtalk("Meeewmew!"))
		flt
		characreate -1, 331, cX(0), cY(0)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "ehekatl"
		goto *label_1204
	}
	if (inputlog == "ルルウィ" | inputlog == "lulwy") {
		txt -1, lang("「アタシを呼びつけるとは生意気ね。」", cnvtalk("You dare to call my name?"))
		flt
		characreate -1, 306, cX(0), cY(0)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "lulwy"
		goto *label_1204
	}
	if (inputlog == "オパートス" | inputlog == "opatos") {
		txt -1, lang("「フワッハハハァ！呼ばれたぞ！！」", cnvtalk("Muwahahahahahaha! You called me?"))
		flt
		characreate -1, 338, cX(0), cY(0)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "opatos"
		goto *label_1204
	}
	if (inputlog == "クミロミ" | inputlog == "kumiromi") {
		txt -1, lang("「呼んだのは…君…？」", cnvtalk("Was it you... who called for me?"))
		flt
		characreate -1, 339, cX(0), cY(0)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "kumiromi"
		goto *label_1204
	}
	if (inputlog == "マニ" | inputlog == "mani") {
		txt -1, lang("「無遠慮だな、私を呼び出すなど」", cnvtalk("Very impertinent, summoning me here."))
		flt
		characreate -1, 342, cX(0), cY(0)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "mani"
		goto *label_1204
	}
	if (inputlog == "ジュア" | inputlog == "jure") {
		txt -1, lang("「ね、ねぇ！あなたが私を呼んだの？」", cnvtalk("I-I'm not coming down there just because you called me, stupid...!"))
		flt
		characreate -1, 366, cX(0), cY(0)
		cAiHeal(rc) = sId_summonServants
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "jure"
		goto *label_1204
	}
	if (inputlog == "イツパロトル" | inputlog == "itzpalt") {
		txt -1, lang("「汝の召喚に応えよう、定命の者よ」", cnvtalk("Very well. I will go down to you, mortal."))
		flt
		characreate -1, 367, cX(0), cY(0)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "itzpalt"
		goto *label_1204
	}
	f = 0
	repeat usergodmax
		s = cgodShortName(cnt)
		if (inputlog == s) {
			if (cgodGodNpcId(cnt) != "") {
				txtgod cgodShortId(cnt), 16
				flt
				initunid = findunid(cgodGodNpcId(cnt))
				characreate -1, 343, cX(0), cY(0)
				adventothergod usergoddatan(2, cnt)
				f = 1
				break
			}
		}
	loop
	if (f) {
		goto *label_1204
	}
	if (inputlog == "若さ" | inputlog == "若返り" | inputlog == "年" | inputlog == "年齢" | inputlog == "美貌" | inputlog == "age" | inputlog == "youth" | inputlog == "beauty") {
		nc_strb_002 = inputlog
		txtgod godcheck(), 2418
		if ( stat == 0 ) {
			txt -1, lang("ふぅん…そんな願いでいいんだ。", "A typical wish.")
		}
		txt -1, lang("誰の年齢を変更する？", "Change whose age?")
		allyctrl = 3
		gosub *label_1187
		if (stat != (-1)) {
			tc = stat
			txt -1, lang("変更後の年齢は？", "What is the new age?")
			inputlog = ""
			val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
			gosub *label_1349
			name_page = int(inputlog)
			if (name_page < 0) {
				name_page = 0
			}
			cBirthYear(tc) = gYear - name_page
			snd 64
		}
		inputlog = nc_strb_002
		goto *label_1204
	}
	if (inputlog == "通り名" | inputlog == "異名" | inputlog == "aka" | inputlog == "title" | inputlog == "name" | inputlog == "alias") {
		if (gWizard & 0) {
			txtgod godcheck(), 2420
			if ( stat == 0 ) {
				txt -1, lang("だめよ。", "*laugh*")
			}
			goto *label_1204
		}
		nc_intb_001 = 0
		txtnew
		txt -1, lang("誰の異名を変更する？", "Change whose alias?")
		allyctrl = 3
		gosub *label_1187
		if (stat != (-1)) {
			tc = stat
			txt -1, lang("新しい異名は？", "What will the new alias be?")
			val = 0
			gosub *label_1201
			if (stat == 1) {
				txtgod godcheck(), 2419
				if ( stat == 0 ) {
					txt -1, lang(cdatan(0, tc) + "の新しい異名は「" + cmaka + "」。満足したかしら？", cdatan(0, tc) + " will be known as <" + cmaka + ">.")
				}
				msgtemp = cdatan(1, tc) + cdatan(0, tc) + "は今後" + cmaka + "と名乗ることにした。"
				cdatan(1, tc) = cmaka
			} else {
				txtgod godcheck(), 2421
				if ( stat == 0 ) {
					txt -1, lang("あら、そのままでいいの？", "What a waste of a wish!")
				}
				msgtemp = "あら、そのままでいいの？"
			}
		}
		goto *label_1204
	}
	if (inputlog == "ペットフィート" | inputlog == "petfeat") {
		txtnew
		txt -1, lang("誰のフィートを初期化する？", "Reset whose feats?")
		allyctrl = 99
		gosub *ui_selectAlly
		if (stat != (-1)) {
			tc = stat
			featcnt = 0
			repeat 140, 1
				if (cnt == 130) {
					continue
				}
				if (gettrait(p, cnt) != 0) {
					featcnt += stat
					rmfaction p, "trait" + cnt + "," + stat
				}
			loop
			ocdata(105, tc) += featcnt
			txt -1, lang(cdatan(0, tc) + "のフィートを初期化した！", cdatan(0, tc) + "'s feats are completely cleared!")
		}
		goto *label_1204
	}
	if (inputlog == "フィート初期化" | inputlog == "featreset") {
		tc = 0
		featcnt = 0
		repeat 94, 46
			if (cnt == 130) {
				continue
			}
			if (gettrait(0, cnt) != 0) {
				featcnt += stat
				rmfaction 0, "trait" + cnt + "," + stat
			}
			if (cnt == 59) {
				cbitmod 32, 0, 0
			}
		loop
		if (gettrait(0, 19) != 0) {
			featcnt += stat
			rmfaction 0, "trait19," + stat
			trait(19) = 0
		}
		if (gettrait(0, 20) != 0) {
			featcnt += stat
			rmfaction 0, "trait20," + stat
			trait(20) = 0
		}
		if (gettrait(0, 43) != 0) {
			featcnt += stat
			rmfaction 0, "trait43," + stat
			cbitmod 30, 0, 0
			trait(43) = 0
		}
		repeat 24, 1
			if (cnt == 19 | cnt == 20) {
				continue
			}
			if (trait(cnt) != 0) {
				featcnt += trait(cnt)
				trait(cnt) = 0
			}
		loop
		repeat 3, 38
			if (trait(cnt) != 0) {
				featcnt += trait(cnt)
				trait(cnt) = 0
			}
		loop
		repeat 3, 42
			if (cnt == 130) {
				continue
			}
			if (trait(cnt) != 0) {
				featcnt += trait(cnt)
				trait(cnt) = 0
			}
		loop
		spact(601 - 600) = 0
		spact(602 - 600) = 0
		spact(627 - 600) = 0
		spact(618 - 600) = 0
		spact(615 - 600) = 0
		spact(656 - 600) = 0
		ospact(sId_weakShield - 661) = 0
		gAcquirableFeatCount += featcnt
		txt -1, lang("あなたのフィートを初期化した！", "Your feats are completely cleared!")
		goto *label_1204
	}
	if (inputlog == "すくつ初期化" | inputlog == "voidreset") {
		if (areaId(gCurrentMap) == 42) {
			txt -1, lang("すくつにいるときは初期化できない", "Can't reset it in the Void itself.")
		} else {
			txt -1, lang("すくつを初期化した", "Reset the deepest level of the Void you have entered.")
			repeat 500
				if (areaId(cnt) == 42) {
					areaVisitedDeepestFloor(cnt) = 0
					gdata(186) = 0
					break
				}
			loop
		}
		goto *label_1204
	}
	if (inputlog == "名声" | inputlog == "fame") {
		if (cFame(0) >= 1000000) {
			// txtgod godcheck(), 2424
			//if (stat == 0) {
			//	txt -1, lang("…罪なんて犯してないじゃない。", "You aren't a sinner.")
			//}
			txt -1, lang("残念だけど、これ以上の名誉は存在しないわ。", "I can't give you any more fame than you already have.")
			goto *label_1204
		}
		gdata(74) = calcfame(0, 10000)
		txtef 2
		txt -1, lang("" + gdata(74) + "の名声値を手に入れた。", "You gain " + gdata(74) + " fame.")
		incfame 0, gdata(74)
		//txtgod godcheck(), 2423
		//if (stat == 0) {
		//	txt -1, lang("あら…都合のいいことを言うのね。", "What a convenient wish!")
		//}
		txt -1, lang("あら…都合のいいことを言うのね。", "What a convenient wish!")
		goto *label_1204
	}
	if (inputlog == "送還" | inputlog == "repatriation") {
		f = 0
		repeat 245 - 57, 57
				if (cState(cnt) != 1) {
					continue
				}
				if (cRole(cnt) == 10001 | cRole(cnt) == 10018) {
					continue
				}
				if (areaHasBeenConquered(gCurrentMap) == cnt) {
					continue
				}
				if (cId(cnt) == 331) {
					txtgod "ehekatl", 22
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 336) {
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 306) {
					txtgod "lulwy", 22
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 338) {
					txtgod "opatos", 22
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 339) {
					txtgod "kumiromi", 22
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 342) {
					txtgod "mani", 22
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 366) {
					txtgod "jure", 22
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 367) {
					txtgod "itzpalt", 22
					txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
					chara_vanquish cnt
					f = 1
					continue
				}
				if (cId(cnt) == 343) {
					if (cCnpcId(cnt) != (-1)) {
						nc_intb_110 = cnt
						repeat usergodmax
							if (cCnpcId(nc_intb_110) + 1 == findunid(cgodGodNpcId(cnt))) {
								txtgod cgodShortId(cnt), 22
								txt -1, lang(name(nc_intb_110) + "は消え去った。", name(nc_intb_110) + " vanish" + _s(nc_intb_110, 1) + ".")
								chara_vanquish nc_intb_110
								f = 1
								break
							}
						loop
					}
				}
		loop
		if (f == 0) {
			txt -1, lang("送還出来る神がいない。", "There is no god that can repatriate us.")
		} else {
			txt -1, lang("神々を送還した。", "The gods have been repatriated.")
		}
		goto *label_1204
	}
	if (inputlog == "贖罪" | inputlog == "redemption" | inputlog == "atonement") {
		if (cKarma(0) >= 0) {
			txtgod godcheck(), 2424
			if (stat == 0) {
				txt -1, lang("…罪なんて犯してないじゃない。", "You aren't a sinner.")
			}
			goto *label_1204
		}
		modkarma 0, -cKarma(0)
		txtgod godcheck(), 2423
		if (stat == 0) {
			txt -1, lang("あら…都合のいいことを言うのね。", "What a convenient wish!")
		}
		goto *label_1204
	}
	if (ogdata(499) == 2 & (inputlog == "本当の死" | inputlog == "truedeath" | inputlog == "realdeath")) {
		if (gCurrentMap != 42 & gCurrentMap != 210) {
			txt_select -1, lang("ここでは召喚できない。", "Nope."), "", "", "", "", "", "", "", ""
			goto *label_1204
		}
		playbgm "soraochi.mid"
		txt_select -1, lang("*本当に*それがお望みなら…", "If you wish so..."), "", "", "", "", "", "", "", ""
		msg_halt
		animeid = 21
		gosub *label_0630
		if (gCurrentMap == 42) {
			flt
			initlv = 99999
			novoidlv = 1
			characreate -1, 368, cX(0), cY(0)
			if (stat != 0) {
				cdatan(0, rc) = lang("《The Over Wish》", "The Over Wish")
				addfaction rc, "overwish"
				addtrait rc, 58, 4
				addbuff rc, 60, limit(cLevel(rc) * 10, 1, 100000), 10000
				addbuff rc, 61, 1, 10000
				addbuff rc, 63, 1, 10000
				cbitmod 10, rc, 1
				ocbitmod 13, rc, 1
				cdata(9, rc) = -3
				cdata(207, rc) = 30
				cdata(209, rc) = 50
				cdata(220, rc) = 657, 657, 660, 903, 798
				cdata(212, rc) = 51
				lockon rc, 0, 11
				cHate(rc) = 20
				mapTurnCost = 1000000
				txtef 4
				txt_select -1, lang("先制攻撃！", "First Attack!"), "", "", "", "", "", "", "", ""
				txtef 4
				txt_select -1, lang("衰弱の願い！", "A cold wind covers the area..."), "", "", "", "", "", "", "", ""
				animeid = 19
				animode = 0
				gosub *label_0630
				repeat 245
						if (cState(cnt) != 1) {
							continue
						}
						if ( rc == cnt ) {
							continue
						}
						if ( eqfaction(cnt, "overwish")) {
							continue
						}
						nc_intb_001 = cnt
						txt_select -1, lang(name(cnt) + "の強化が立ち消える！", ""), "", "", "", "", "", "", "", ""
						repeat 8 + 8
								if (ocdata(192 + cnt * 3, nc_intb_001) == 0) {
									break
								}
								delbuff nc_intb_001, cnt
								continue cnt
						loop
						addbuff nc_intb_001, 62, 1, 20000, 2100000000
						txtef 4
						txt_select -1, lang(name(cnt) + "の体力が１になった！", ""), "", "", "", "", "", "", "", ""
						cHp(cnt) = 1
					loop
			}
		} else {
			flt
			initlv = 99999
			novoidlv = 1
			characreate -1, 368, cX(0), cY(0)
			if (stat != 0) {
				cdatan(0, rc) = lang("《The Over Wish》", "The Over Wish")
				addfaction rc, "overwish"
				addtrait rc, 58, 4
				repeat 600
					sdataEx(cnt, rc) = 50000000
					if (cnt == 2) {
						sdataEx(cnt, rc) = 40000
					}
				loop
				cbitmod 10, rc, 1
				ocbitmod 13, rc, 1
				cdata(9, rc) = -3
				cdata(207, rc) = 30
				cdata(209, rc) = 50
				cdata(220, rc) = 657, 657, 660, 903, 910
				cdata(212, rc) = 51
				lockon rc, 0, 11
				cHate(rc) = 20
				txtef 4
				txt_select -1, lang("先制攻撃！", "First Attack!"), "", "", "", "", "", "", "", ""
				txtef 4
				txt_select -1, lang("衰弱の願い！", "A cold wind covers the area..."), "", "", "", "", "", "", "", ""
				animeid = 19
				animode = 0
				gosub *label_0630
				repeat 245
								if (cState(cnt) != 1) {
									continue
								}
								if ( rc == cnt ) {
									continue
								}
								if ( eqfaction(cnt, "overwish")) {
									continue
								}
								nc_intb_001 = cnt
								txt_select -1, lang(name(cnt) + "の強化が立ち消える！", ""), "", "", "", "", "", "", "", ""
								repeat 8 + 8
										if (ocdata(192 + cnt * 3, nc_intb_001) == 0) {
											break
										}
										delbuff nc_intb_001, cnt
										continue cnt
								loop
							addbuff nc_intb_001, 62, 1, 20000, 2100000000
							txtef 4
							txt_select -1, lang(name(cnt) + "の体力が１になった！", ""), "", "", "", "", "", "", "", ""
							cHp(cnt) = 1
					loop
			}
		}
		music = 91
		gosub *label_0122
		goto *label_1204
	}
	if (inputlog == "未来" | inputlog == "future") {
		gYear += 1
		repeat 16
			if (gettrait(cnt, 131) == 1) {
				cBirthYear(cnt) += 1
				if (cBirthYear(cnt) > gYear) {
					cBirthYear(cnt) = gYear
				}
			}
		loop
		txt -1, lang("あなたは1年先の未来へ飛んだ。", "You flew to the future.")
		goto *label_1204
	}
	if (inputlog == "過去" | inputlog == "past") {
		if (gYear >= 518) {
			gYear -= 1
			repeat 16
				if (gettrait(cnt, 131) == 1) {
					cBirthYear(cnt) -= 1
				}
				if (cBirthYear(cnt) < gYear) {
					cBirthYear(cnt) = gYear
				}
			loop
			txt -1, lang("あなたは1年後ろの過去へ飛んだ。", "You flew to the past.")
		} else {
			txt -1, lang("これ以上過去には戻せない。", "There is no going back to the past.")
		}
		goto *label_1204
	}
	if (inputlog == "商品入れ替え" | inputlog == "replacement") {
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (chara_isShopKeeper(cnt)) {
				cTimeToRestore(cnt) = getgametime() - 1
			}
		loop
		txt -1, lang("お店に新商品が入荷した。", "New products arrived at the store.")
		goto *label_1204
	}
	if (inputlog == "死" | inputlog == "death") {
		txtgod godcheck(), 2425
		if ( stat == 0 ) {
			txt -1, lang("それがお望みなら…", "If you wish so...")
		}
		if (ogdata(459) == 2) {
			flt
			characreate -1, 336, cX(0), cY(0)
			if (stat != 0) {
				if (gCurrentMap == 42 & gCurrentDungeonLevel >= 1050) {
					addbuff rc, 60, limit(cLevel(rc) * 10, 1, 100000), gCurrentDungeonLevel / 10
					addbuff rc, 61, 1, gCurrentDungeonLevel / 10
				}
				if (gCurrentMap == 42 & gCurrentDungeonLevel >= 10050) {
					addbuff rc, 63, 1, gCurrentDungeonLevel / 10
				}
			}
		} else {
			cHp(0) = -1
			dmghp 0, 99999, -11
		}
		goto *label_1204
	}
	if (inputlog == "仲間" | inputlog == "friend" | inputlog == "company" | inputlog == "ally") {
		evadd 12
		goto *label_1204
	}
	if (inputlog == "金" | inputlog == "金貨" | inputlog == "富" | inputlog == "財産" | inputlog == "money" | inputlog == "gold" | inputlog == "wealth" | inputlog == "fortune") {
		txtef 5
		txt -1, lang("金貨が降ってきた！", "Lots of gold pieces appear.")
		flt
		itemcreate -1, 54, cX(0), cY(0), int(limitf(double(difficulty() / 3 + 1) * 10000, 0, 2147483647))
		txtgod godcheck(), 2415
		goto *label_1204
	}
	if (inputlog == "メダル" | inputlog == "小さなメダル" | inputlog == "ちいさなメダル" | inputlog == "coin" | inputlog == "medal" | inputlog == "small coin" | inputlog == "small medal") {
		txtef 5
		txt -1, lang("小さなメダルが降ってきた！", "Small coins appear.")
		flt
		itemcreate -1, 622, cX(0), cY(0), 3 + rnd(3)
		txtgod godcheck(), 2415
		goto *label_1204
	}
	if (inputlog == "プラチナ" | inputlog == "プラチナ硬貨" | inputlog == "platina" | inputlog == "platinum") {
		txtef 5
		txt -1, lang("プラチナ硬貨が降ってきた！", "Platinum pieces appear.")
		flt
		itemcreate -1, 55, cX(0), cY(0), 5
		txtgod godcheck(), 2415
		goto *label_1204
	}
	if (instr(inputlog, 0, lang("ペットスキル", "petskill")) != (-1)) {
		goto *label_1207_01
	}
	if (instr(inputlog, 0, lang("スキル", "skill")) != (-1)) {
		goto *label_1207
	}
	if (instr(inputlog, 0, lang("アイテム", "item")) != (-1)) {
		goto *label_1206
	}
	if (instr(inputlog, 0, lang("カード", "card")) != (-1)) {
		goto *label_1208
	}
	if (instr(inputlog, 0, lang("剥製", "figure")) != (-1) | instr(inputlog, 0, "はく製") != (-1)) {
		goto *label_1209
	}
	if (instr(inputlog, 0, lang("死体", "corpse")) != (-1)) {
		goto *label_1210
	}
	if (instr(inputlog, 0, lang("エロ本", "pornbook")) != (-1)) {
		goto *label_N030
	}
	if (instr(inputlog, 0, lang("性別変更", "change sex")) != (-1) | inputlog == "性転換" | inputlog == "性" | inputlog == "異性" | inputlog == "sex") {
		txtnew
		txt -1, lang("誰の性別を変更する？", "Change whose sex?")
		allyctrl = 3
		gosub *label_1187
		if (stat != (-1)) {
			tc = stat
			cSex(tc) = 1 - cSex(tc)
			if (tc != 0) {
				if (cImage(tc) == creaturepic(cId(tc), 1 - cSex(tc)) + creaturecolor(cId(tc)) * 1000) {
					cImage(tc) = creaturepic(cId(tc), cSex(tc)) + creaturecolor(cId(tc)) * 1000
				}
			}
			snd 64
			txt -1, lang(cdatan(0, tc) + "は" + _sex(cSex(tc)) + "になった！", name2(tc) + " become" + _s(tc) + " " + _sex(cSex(tc)) + "!")
			txtgod godcheck(), 2422
			if (stat == 0) {
				txt -1, lang("…もう後戻りはできないわよ。", "")
			}
		}
		goto *label_1204
	}
	if (instr(inputlog, 0, lang("体重", "weight")) != (-1)) {
		nc_strb_002 = inputlog
		txtnew
		txt -1, lang("誰の体重を変更する？", "Change whose weight?")
		allyctrl = 3
		gosub *label_1187
		if (stat != (-1)) {
			tc = stat
			txt -1, lang("変更後の体重は？", "What is the new weight?")
			inputlog = ""
			val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
			gosub *label_1349
			name_page = int(inputlog)
			if (name_page < 0) {
				name_page = 0
			}
			cWeight(tc) = name_page
			snd 64
			txt -1, lang(cdatan(0, tc) + "の体重が変化した！ …もう後戻りはできないわよ。", name2(tc) + "Change weight!")
		}
		inputlog = nc_strb_002
		goto *label_1204
	}
	if (instr(inputlog, 0, lang("身長", "height")) != (-1)) {
		nc_strb_002 = inputlog
		txtnew
		txt -1, lang("誰の身長を変更する？", "Change whose height?")
		allyctrl = 3
		gosub *label_1187
		if (stat != (-1)) {
			tc = stat
			txt -1, lang("変更後の身長は？", "What is the new height?")
			inputlog = ""
			val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
			gosub *label_1349
			name_page = int(inputlog)
			if (name_page < 0) {
				name_page = 0
			}
			cHeight(tc) = name_page
			snd 64
			txt -1, lang(cdatan(0, tc) + "の身長が変化した！ …もう後戻りはできないわよ。", name2(tc) + "Change height!")
		}
		inputlog = nc_strb_002
		goto *label_1204
	}
	if (instr(inputlog, 0, lang("呼び出し", "invoke")) != (-1)) {
		f = -1
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			s = cdatan(0, cnt)
			if (en) {
				s = getpath(s, 16)
			}
			if (instr(inputlog, 0, s) != -1) {
				f = 1
				cnt2 = cnt
				repeat 200
					p = 1, -1
					cNextX(cnt2) = cX(0) + rnd(5) * p(rnd(2))
					cNextY(cnt2) = cY(0) + rnd(5) * p(rnd(2))
					cell_check cNextX(cnt2), cNextY(cnt2)
					if (cellaccess == 1) {
						txt -1, lang(cdatan(0, cnt2) + "は" + "呼び出された。", cdatan(0, cnt2) + " was invoked.")
						rowactend cnt2
						ccprev = 0
						cc = cnt2
						gosub *label_1367
						cc = ccprev
						gosub *label_0623
						break
					}
				loop
				break
			}
		loop
		if (f == (-1)) {
			txtgod godcheck(), 2427
			if ( stat == 0 ) {
				txt -1, lang("…そんな人いないじゃない。", "...But nobody came.")
			}
		}
		goto *label_1204
	}
	if (inputlog == "q") {
		txtef 5
		txt -1, lang("うわぁぁぁ！！", "Ahhhhh!!")
		repeat 10
			flt
			characreate -1, 37, cX(0), cY(0)
		loop
		goto *label_1204
	}
	if (inputlog == lang("プレイヤー物件のダンジョン", "my dungeon")) {
		flt
		itemcreate -1, 497, cX(0), cY(0), 0
		item_identify ci, 3
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + ".")
		goto *label_1204
	}
	if (inputlog == lang("タイムマシン", "time machine")) {
		flt
		itemcreate -1, 555, cX(0), cY(0), 20
		item_identify ci, 3
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + ".")
		goto *label_1204
	}
	if (inputlog == "妹" | inputlog == "sister" | inputlog == "younger sister") {
		evadd 100
		goto *label_1204
	}
	if (instr(inputlog, 0, lang("祭壇", "altar")) != (-1)) {
		flt
		itemcreate -1, 171, cX(0), cY(0), 0
		repeat length(isetgod)
			s = godname(godno2godid(isetgod(cnt)))
			if (en) {
				s = getpath(s, 16)
			}
			if (instr(inputlog, 0, s) != (-1)) {
				iParam1(ci) = isetgod(cnt)
				break
			}
		loop
		if (iParam1(ci) == 0) {
			repeat usergodmax
				s = cgodName(cnt)
				if (en) {
					s = getpath(s, 16)
				}
				if (instr(inputlog, 0, s) != (-1)) {
					iParam2(ci) = cnt
					iParam3(ci) = creategoduid(iParam2(ci))
					break
				}
			loop
		}
		item_identify ci, 3
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + ".")
		goto *label_1204
	}
	if (gWizard) {
		if (inputlog == "魔法作成" & gWizard == 1) {
			if (userspellmax < 50) {
				gosub *label_1781
				gosub *label_0623
				goto *label_1623
			} else {
				txt -1, lang("もうこれ以上作れないわよ。", "Nope.")
			}
			goto *label_1204
		}
		if (instr(inputlog, 0, lang("ペット召喚", "makepet")) != (-1) & gWizard == 1) {
			gosub *label_1215
			flt
			characreate -1, dbid, cX(0), cY(0)
			gosub *label_1530
			goto *label_1203
		}
		if (inputlog == "完全復活") {
			txt -1, "復活！"
			gosub *label_1412
			goto *label_1203
		}
		if (inputlog == "奈落の祝福") {
			txt -1, "いくよ！"
			addbuff 0, 66, 10000, 10000
			goto *label_1203
		}
		if (instr(inputlog, 0, "キャラ生成") != (-1)) {
			gosub *label_1215
			flt
			characreate -1, dbid, cX(0), cY(0)
			goto *label_1203
		}
		if (instr(inputlog, 0, "給料テスト") != (-1)) {
			gosub *label_1101
			goto *label_1203
		}
	}
	if (inputlog == "クリスマス中止" | inputlog == "cancel christmas") {
		if (ogbit(9)) {
			txt -1, lang("今年の聖夜祭は既に中止が決まっている。", "This year's Christmas Eve festival has already been canceled.")
		} else {
			ogbitmod 9, 1
			txt -1, lang("今年の聖夜祭は中止になった。", "This year's Christmas Eve festival has been canceled.")
			modkarma 0, 60
		}
		goto *label_1204
	}
	if (instr(inputlog, 0, lang("聖なる武器", "justice weapon")) != (-1)) {
		goto *label_1212
	}
	if (instr(inputlog, 0, lang("邪悪な武器", "evil weapon")) != (-1)) {
		goto *label_1213
	}
	if (instr(inputlog, 0, lang("生きている武器", "living weapon")) != (-1)) {
		goto *label_1214
	}
	if (instr(inputlog, 0, "種族") != -1 | instr(inputlog, 0, "race") != -1) {
		txtnew
		txt -1, lang("誰の種族を変更する？", "Change whose race?")
		allyctrl = 3
		gosub *label_1187
		if (stat != -1) {
			tc = stat
			newRace = -1
			s = inputlog
			sreplace s, s, "種族変更", ""
			sreplace s, s, "change race", ""
			sreplace s, s, "種族", ""
			sreplace s, s, "race", ""
			repeat length(racenamecsv)
				s(1) = getpath(racenamecsv(cnt, 0), 16) // Name
				s(2) = getpath(racenamecsv(cnt, 1), 16) // ID
				if (instr(s, 0, s(1)) != -1 | instr(s, 0, s(2)) != -1) {
					if (racenamecsv(cnt, 1) == "") {
						continue
					}
					if (cdatan(2, tc) == racenamecsv(cnt, 1)) {
						continue
					}
					newRace = cnt
				}
			loop
			if (newRace == -1) {
				newRace = rnd(length(racenamecsv))
			}
			cdatan(2, tc) = racenamecsv(newRace, 1)
			snd 64
			txt -1, lang(cdatan(0, tc) + "は" + racenamecsv(newRace, 0) + "になった！…もう後戻りはできないわよ。", cdatan(0, tc) + " become" + _s(tc) + " " + racenamecsv(newRace, 0) + "!")
		}
		goto *label_1204
	}
*label_1206
	gosub *label_1200
	i = 0
	repeat useritemmax
		p = 0
		cnt2 = cnt
		s = lang(useritemdatan(1, cnt), useritemdatan(0, cnt))
		if (en) {
			s = getpath(s, 16)
		}
		if (s == inputlog) {
			p = 10000
		}
		if (p != 0) {
			citemlist(i) = cnt2 + 1
			dblist(0, i) = 743, p
			i++
		}
	loop
	repeat length(ioriginalnameref)
		if (cnt == 0) {
			continue
		}
		if (cnt == 23 & gWizard == 0) {
			continue
		}
		if (cnt == 290 & gWizard == 0) {
			continue
		}
		if (cnt == 289 & gWizard == 0) {
			continue
		}
		if (cnt == 361 & gWizard == 0) {
			continue
		}
		p = 0
		s = cnvitemname(cnt)
		if (en) {
			s = getpath(s, 16)
		}
		if (s == inputlog) {
			p = 10000
		}
		repeat strlen(inputlog)
			if (instr(s, 0, strmid(inputlog, 0, cnt * (1 + jp))) != (-1)) {
				p = p + 50 * (cnt + 1) + rnd(15)
			}
		loop
		if (p != 0) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	if (i != 0) {
		repeat
			p = 0, 0
			inititemid = 0
			repeat i
				if (dblist(1, cnt) > p(1)) {
					p = dblist(0, cnt), dblist(1, cnt)
					wishid = cnt
				}
			loop
			if (p == 0) {
				f = 0
				break
			}
			if (p == 743) {
				inititemid = citemlist(wishid)
			}
			flt difficulty() + 10, 4
			if (p == 558 | p == 556 | p == 557 | p == 664) {
				fixlv = calcfixlv(3)
			}
			if (p == 630) {
				objfix = 2
			}
			nostack = 1
			nooracle = 1
			itemcreate -1, p, cX(cc), cY(cc), 0
			nooracle = 0
			if (ibit(5, ci) == 1 | iQuality(ci) == 6) {
				if (gWizard == 0) {
					dblist(1, wishid) = 0
					iNumber(ci) = 0
					itemmemory(1, iId(ci))--
					cell_refresh iX(ci), iY(ci)
					continue
				}
			}
			if (iId(ci) == 54) {
				iNumber(ci) = difficulty() * difficulty() * 50 + 20000
			}
			if (iId(ci) == 55) {
				iNumber(ci) = 8 + rnd(5)
			}
			if (iId(ci) == 602) {
				iNumber(ci) = 0
				flt
				itemcreate -1, 516, cX(cc), cY(cc), 3
				iCurseState(ci) = 1
				txtgod godcheck(), 2426
				if (stat == 0) {
					txt -1, lang("あ、それ在庫切れ。", "It's sold out.")
				}
			}
			if (iId(ci) == 792) {
				iNumber(ci) = 3
				iCurseState(ci) = 1
				rndsel = rnd(10)
				if (rndsel < 5) {
					iParam1(ci) = 65000
				} elseif (rndsel < 7) {
					iParam1(ci) = 465000
				} elseif (rndsel < 9) {
					iParam1(ci) = 459000
				} else {
					iParam1(ci) = 390010
				}
				iValue(ci) = 100000
				txt -1, lang("今日のおススメの1本はこれよ。", "This is one of my recommendations today.")
			}
			if (refitem(iId(ci), 5, ci) == 52000 | refitem(iId(ci), 5, ci) == 53000) {
				iNumber(ci) = 3 + rnd(2)
				if (iValue(ci) >= 5000) {
					iNumber(ci) = 3
				}
				if (iValue(ci) >= 10000) {
					iNumber(ci) = 2
				}
				if (iValue(ci) >= 20000) {
					iNumber(ci) = 1
				}
				if (iId(ci) == 559) {
					iNumber(ci) = 2 + rnd(2)
				}
				if (iId(ci) == 502) {
					iNumber(ci) = 2
				}
				if (iId(ci) == 243) {
					iNumber(ci) = 1
				}
				if (iId(ci) == 621) {
					iNumber(ci) = 1
				}
				if (iId(ci) == 706) {
					iNumber(ci) = 1
				}
			}
			if (ogdata(514) == 2 & refitem(iId(ci), 5, ci) > 50000 & iId(ci) != 743) {
				iNumber(ci) += rnd(2) + 1
			}
			item_identify ci, 3
			txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + ".")
			f = 1
			break
		loop
		if (f) {
			goto *label_1204
		}
	}
*label_1207
	gosub *label_1200
	i = 0
	repeat 600
		f = 0
		if (cnt >= 10 & cnt < 20) {
			f = 1
		}
		if (cnt >= 100 & cnt < 400) {
			f = 1
		}
		if (f == 0) {
			continue
		}
		p = 0
		cnt2 = cnt
		s = skillname(cnt2)
		if (en) {
			s = getpath(s, 16)
		}
		if (s == inputlog) {
			p = 10000
		}
		repeat strlen(inputlog) / (1 + jp)
			if (instr(s, 0, strmid(inputlog, cnt * (1 + jp), 1 + jp)) != (-1)) {
				p += 50 + rnd(15)
			}
		loop
		if (p != 0) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	if (i != 0) {
		p = 0, 0
		repeat i
			if (dblist(1, cnt) > p(1)) {
				p = dblist(0, cnt), dblist(1, cnt)
			}
		loop
		if (skillname(p) != "") {
			txtef 5
			if (sorg(p, 0) == 0) {
				txt -1, lang(skillname(p) + "の技術を会得した！", "You learn " + skillname(p) + "!")
				skillgain 0, p, 1
			} else {
				txt -1, lang(skillname(p) + "が上昇した！", "Your " + skillname(p) + " skill improves!")
				skillmod p, 0, 1000
				modgrowth2 0, p, 25
			}
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		goto *label_1204
	}
	txt -1, lang("何もおきない… ", "Nothing happens...")
	goto *label_1204
	*label_1207_01
		gosub *label_1200
		i = 0
		repeat 600
			f = 0
			if (cnt >= 10 & cnt < 20) {
				f = 1
			}
			if (cnt >= 100 & cnt < 400) {
				f = 1
			}
			if (f == 0) {
				continue
			}
			p = 0
			cnt2 = cnt
			s = skillname(cnt2)
			if (en) {
				s = getpath(s, 16)
			}
			if (s == inputlog) {
				p = 10000
			}
			repeat strlen(inputlog) / (1 + jp)
				if (instr(s, 0, strmid(inputlog, cnt * (1 + jp), 1 + jp)) != (-1)) {
					p += 50 + rnd(15)
				}
			loop
			if (p != 0) {
				dblist(0, i) = cnt, p
				i++
			}
		loop
		if (i != 0) {
			p = 0, 0
			repeat i
				if (dblist(1, cnt) > p(1)) {
					p = dblist(0, cnt), dblist(1, cnt)
				}
			loop
			if (skillname(p) != "") {
				nc_intb_001 = p
				txt -1, lang("対象にする仲間は？", "Who is target?")
				allyctrl = 4
				gosub *ui_selectAlly
				if (stat != (-1)) {
					tc = stat
				} else {
					txt -1, lang("何もおきない… ", "Nothing happens...")
					goto *label_1204
				}
				txtef 5
				if (sorg(nc_intb_001, tc) == 0) {
					txt -1, lang(name(tc) + "は" + skillname(nc_intb_001) + "の技術を会得した！", name(tc) + " learn " + skillname(nc_intb_001) + "!")
					skillgain tc, nc_intb_001, 1
					snd 61
				} else {
					txt -1, lang(name(tc) + "は" + skillname(nc_intb_001) + "が上昇した！", name(tc) + " " + skillname(nc_intb_001) + " skill improves!")
					skillmod nc_intb_001, tc, 1000
					modgrowth2 tc, nc_intb_001, 25
					snd 61
				}
			} else {
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			goto *label_1204
		}
		txt -1, lang("何もおきない… ", "Nothing happens...")
		goto *label_1204
*label_1208
	gosub *label_1215
	flt
	characreate 56, dbid, -3, 0
	flt
	itemcreate -1, 504, cX(0), cY(0), 0
	iSubname(ci) = cId(56)
	iColor(ci) = getcharapic(56)
	if (iSubname(ci) == cId_user) {
		inv(33, ci) = cdata(157, 56)
		inv(34, ci) = createserialno(userdatan(0, cdata(157, 56)))
	}
	chara_vanquish 56
	cell_refresh cX(0), cY(0)
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + " from nowhere.")
	goto *label_1204
*label_1209
	gosub *label_1215
	flt
	characreate 56, dbid, -3, 0
	flt
	itemcreate -1, 503, cX(0), cY(0), 0
	collection_make ci, 56
	chara_vanquish 56
	cell_refresh cX(0), cY(0)
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + " from nowhere.")
	goto *label_1204
*label_1210
	gosub *label_1215
	if (dbid == 319) {
		dbid = 176
	}
	meatid@se = dbid
	flt
	itemcreate -1, 204, cX(0), cY(0), 0
	iSubname(ci) = meatid@se
	if (meatid@se == 343) {
		inv(33, ci) = initunid - 1
		inv(34, ci) = createserialno(userdatan(0, inv(33, ci)))
	}
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + " from nowhere.")
	goto *label_1204
*label_1211
	weaponid = 1, 2, 3, 4, 58, 60, 210, 211, 212, 213, 224, 225, 226, 227, 228, 229, 230, 231, 232, 234, 235, 266, 482, 496, 512, 633, 713, 714, 735, 759, 781, 788
	return
*label_1212
	flt
	weaponjasei = 1
	weaponjus = 1
	fixlv = 5
	cnv_str inputlog, lang("聖なる武器", "justice weapon"), ""
	if (rnd(2)) {
		flttypemajor = 10000
		dbid = 0
	} else {
		flttypemajor = 24000
		dbid = 0
	}
	repeat length(weaponid)
		if (instr(inputlog, 0, ioriginalnameref(weaponid(cnt))) != (-1)) {
			dbid = weaponid(cnt)
		}
	loop
	nostack = 1
	nooracle = 1
	itemcreate -1, dbid, cX(0), cY(0), 0
	item_identify ci, 3
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + " from nowhere.")
	goto *label_1204
*label_1213
	flt
	weaponjasei = 1
	weaponjus = -1
	fixlv = 5
	cnv_str inputlog, lang("邪悪な武器", "evil weapon"), ""
	if (rnd(2)) {
		flttypemajor = 10000
		dbid = 0
	} else {
		flttypemajor = 24000
		dbid = 0
	}
	repeat length(weaponid)
		if (instr(inputlog, 0, ioriginalnameref(weaponid(cnt))) != (-1)) {
			dbid = weaponid(cnt)
		}
	loop
	nostack = 1
	nooracle = 1
	itemcreate -1, dbid, cX(0), cY(0), 0
	item_identify ci, 3
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + " from nowhere.")
	goto *label_1204
*label_1214
	flt
	weaponalive = 1
	fixlv = 4
	cnv_str inputlog, lang("生きている武器", "living weapon"), ""
	if (rnd(2)) {
		flttypemajor = 10000
		dbid = 0
	} else {
		flttypemajor = 24000
		dbid = 0
	}
	repeat length(weaponid)
		if (instr(inputlog, 0, ioriginalnameref(weaponid(cnt))) != (-1)) {
			dbid = weaponid(cnt)
		}
	loop
	nostack = 1
	nooracle = 1
	itemcreate -1, dbid, cX(0), cY(0), 0
	item_identify ci, 3
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + " from nowhere.")
	goto *label_1204
*label_1215
	i = 0
	s2 = inputlog
	fix_wish s2
	repeat 800
		p = 0
		s = refchara(cnt, 2, 1)
		if (en) {
			s = getpath(s, 16)
		}
		if (instr(s, 0, s2) != (-1)) {
			p = 1000 - (strlen(s) - strlen(s2)) * 10
		}
		if (p != 0) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	repeat usernpcmax
		p = 0
		s = userdatan(1, cnt)
		if (en) {
			s = getpath(s, 16)
		}
		if (instr(s, 0, s2) != (-1)) {
			p = 1000 - (strlen(s) - strlen(s2)) * 10
		}
		if (p != 0) {
			unlist(i) = cnt
			dblist(0, i) = 343, p
			i++
		}
	loop
	p = 0, 0
	repeat i
		if (dblist(1, cnt) > p(1)) {
			p = dblist(0, cnt), dblist(1, cnt)
			if (p == 343) {
				initunid = unlist(cnt) + 1
			}
		}
	loop
	dbid = p
	if (dbid == 0) {
		dbid = 37
	}
	return
*label_1216
	menucycle = 0
		if (ogdata(36 + sc) == 0) {
			msgdup++
			txt -1, lang("そのキーにはショートカットが割り当てられていない。", "The key is unassigned.")
			gosub *label_0623
			goto *label_1623
		}
		if (ogdata(36 + sc) >= 10000) {
			invsc = ogdata(36 + sc) \ 1000000 \ 10000, ogdata(36 + sc) / 1000000
			invctrl = ogdata(36 + sc) \ 1000000 / 10000, 0
			invcurse = stgdata(36 + sc)
			goto *label_1280
		}
		efid = ogdata(36 + sc)
	if (efid >= 300 & efid < 400) {
		goto *label_1221
	}
	if (efid >= 600) {
		if (mapType == 1) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		}
		if (efid < tailspact) {
			p = -1
			if (efid < 661) {
				if (spact(efid - 600) != 0) {
					p = 1
				}
			} else {
				if (ospact(efid - 661) != 0) {
					p = 1
				}
			}
			repeat length(racenamecsv)
				if (cdatan(2, 0) == racenamecsv(cnt, 1)) {
					cnt2 = cnt
					if (racespact(cnt2, 1)) {
						repeat racespact(cnt2, 1) + 2
							if (cnt == 0 | cnt == 1) {
								continue
							}
							if (racespact(cnt2, cnt) == efid) {
								p = 1
								break
							}
						loop
					}
					break
				}
			loop
			repeat length(classnamecsv)
				if (cdatan(3, 0) == classnamecsv(cnt, 1)) {
					cnt2 = cnt
					if (classspact(cnt2, 1)) {
						repeat classspact(cnt2, 1) + 2
							if (cnt == 0 | cnt == 1) {
								continue
							}
							if (classspact(cnt2, cnt) == efid) {
								p = 1
								break
							}
						loop
					}
					break
				}
			loop
			if (p == (-1)) {
				txt -1, lang("もうその行動はできない。", "You can't use this shortcut any more.")
				gosub *label_0623
				goto *label_1623
			}
		}
		if (efid == 781) {
			gosub *label_1823
		}
		goto *label_1221
	}
	if (efid >= 400) {
		if (mapType == 1) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		}
		if (efid < 550) {
			if (spell(efid - 400) <= 0) {
				msgdup++
				txt -1, lang("その魔法はもう使えない。", "You can't use that spell anymore.")
				gosub *label_0623
				goto *label_1623
			}
		} else {
			if (userspelldata(11, efid - 550) <= 0 | userspelldata(0, efid - 550) <= 0) {
				msgdup++
				txt -1, lang("その魔法はもう使えない。", "You can't use that spell anymore.")
				gosub *label_0623
				goto *label_1623
			}
		}
		goto *label_1243
	}
	goto *label_1623
*label_1217
	txt -1, lang("どの方向を掘る？ ", "Which direction do you want to dig? ")
	val = 0
	gosub *label_1350
	if (stat == 0) {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		goto *label_1623
	}
	refx = x
	refy = y
	tlocx = x
	tlocy = y
	goto *label_1219
*label_1218
	x = cNextX(0)
	y = cNextY(0)
	refx = cNextX(0)
	refy = cNextY(0)
	tlocx = cNextX(0)
	tlocy = cNextY(0)
	if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
		msgdup++
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1219
*label_1219
	if (tlocx == cX(0)) {
		if (tlocy == cY(0)) {
			rowactre = 0
			gosub *label_1380
			goto *label_1617
		}
	}
	if ((chipm(7, map(x, y, 0)) & 4) == 0 | chipm(0, map(x, y, 0)) == 3 | mapType == 1) {
		msgdup++
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		goto *label_1623
	}
	screenupdate = -1
	gosub *label_0623
	goto *label_1449
*label_1220
	txt -1, lang("どの方向に体当たりする？ ", "Which direction do you want to bash? ")
	val = 0
	gosub *label_1350
	if (stat == 0) {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1425
*label_1221
	if (cc == 0) {
		if (gettrait(0, 173) != 0) {
			if (rnd(20) == 0) {
				txt -1, lang(name(cnt) + "は行動を躊躇った。", name(cnt) + " hasitate" + _s(cnt) + " " + his(cnt) + " action.")
				goto *label_1617
			}
		}
	}
	gosub *label_1775
	if (stat == 1) {
		ctalk cc, 427, cc, tc
	}
	gosub *label_1396
	if (stat == 0) {
		gosub *label_0623
		goto *label_1623
	}
	gosub *label_1775
	if (stat == 1) {
		ctalk cc, 428, cc, tc
	}
	goto *label_1617
*label_1222
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	cs = commark(0) \ 1000
	page = commark(0) / 1000
	curmenu = 1
	gosub *label_1823
	repeat 400 - 300, 300
		if (sdata(cnt, cc) > 0) {
			list(0, listmax) = cnt, sdataref(0, cnt) * 1000 + cnt
			listmax++
		}
	loop
	repeat tailspact - 600
		if (spact(cnt) != 0) {
			list(0, listmax) = cnt + 600, sdataref(0, cnt + 600) * 1000 + cnt
			listmax++
		}
	loop
	repeat tailspact - 661
		if (ospact(cnt) != 0) {
			list(0, listmax) = cnt + 661, sdataref(0, cnt + 661) * 1000 + cnt
			listmax++
		}
	loop
	repeat length(racenamecsv)
		if (cdatan(2, cc) == racenamecsv(cnt, 1)) {
			cnt2 = cnt
			if (racespact(cnt2, 1)) {
				repeat racespact(cnt2, 1) + 2
					p = 0
					cnt3 = cnt
					if (cnt3 == 0 | cnt3 == 1) {
						continue
					}
					if (racespact(cnt2, cnt3) <= 600) {
						continue
					}
					if (racespact(cnt2, cnt3) == 668) {
						continue
					}
					repeat listmax
						if (racespact(cnt2, cnt3) == list(0, cnt)) {
							p = -1
							break
						}
					loop
					if (p == 0) {
						list(0, listmax) = racespact(cnt2, cnt3), sdataref(0, racespact(cnt2, cnt3)) * 1000 + racespact(cnt2, cnt3) - 600
						listmax++
					}
				loop
			}
			break
		}
	loop
	repeat length(classnamecsv)
		if (cdatan(3, cc) == classnamecsv(cnt, 1)) {
			cnt2 = cnt
			if (classspact(cnt2, 1)) {
				repeat classspact(cnt2, 1) + 2
					p = 0
					cnt3 = cnt
					if (cnt3 == 0 | cnt3 == 1) {
						continue
					}
					if (classspact(cnt2, cnt3) <= 600) {
						continue
					}
					if (classspact(cnt2, cnt3) == 668) {
						continue
					}
					repeat listmax
						if (classspact(cnt2, cnt3) == list(0, cnt)) {
							p = -1
							break
						}
					loop
					if (p == 0) {
						list(0, listmax) = classspact(cnt2, cnt3), sdataref(0, classspact(cnt2, cnt3)) * 1000 + classspact(cnt2, cnt3) - 600
						listmax++
					}
				loop
			}
			break
		}
	loop
	gosub *label_1276
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_skill.bmp", 1
	gsel 0
	windowshadow = 1
*label_1223
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	drawmenu 1
*label_1224
	redraw 0
	s = lang("能力の発動", "Skill"), strhint2 + strhint3 + strhint7
	display_window (windoww - 600) / 2 + inf_screenx, winposy(438), 600, 438, 0, 60
	display_topic lang("能力の名称", "Name"), wx + 28, wy + 36
	display_topic lang("コスト", "Cost"), wx + 220, wy + 36
	display_topic lang("能力の効果", "Detail"), wx + 320, wy + 36
	pos wx + 46, wy - 16
	gcopy 3, 288 + 14 * 48, 48, 48, 48
	pos wx + ww - 78, wy + wh - 165
	gcopy 3, 960, 96, 72, 144
	pos wx + ww - 168, wy
	gcopy 3, 1032, 96, 102, 48
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 490, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		pos wx + 40, wy + 74 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate 1, (sdataref(0, list(0, p)) - 10) * inf_tiles, 672, 0, inf_tiles, inf_tiles
		s = ""
			repeat 20
				if (ogdata(36 + cnt) == list(0, p)) {
					s = "{" + cnt + "}"
				}
			loop
		cs_list skillname(list(0, p)) + s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		s = "" + sdataref(2, list(0, p)) + " Sp"
		pos wx + 288 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
		mes s
		gosub *label_1248
		pos wx + 325, wy + 66 + cnt * 19 + 2
		mes strmid(s, 0, 34)
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	commark(0) = page * 1000 + cs
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		menucycle = 0
		screenupdate = -1
		efid = p
		gosub *label_0623
		goto *label_1221
	}
	if (key == "sc") {
		snd 20
		p = list(0, pagesize * page + cs)
		if (ogdata(36 + sc) == p) {
			ogdata(36 + sc) = 0
			stgdata(36 + sc) = 0
			stgdata(56 + sc) = 0
			ncgsdata(sc) = ""
			goto *label_1223
		}
		repeat 20
			if (ogdata(36 + cnt) == p) {
				ogdata(36 + cnt) = 0
				stgdata(36 + cnt) = 0
				stgdata(56 + cnt) = 0
				ncgsdata(cnt) = ""
			}
		loop
		ogdata(36 + sc) = p
		txt -1, lang("{" + sc + "}キーにショートカットを割り当てた。", "You have assigned the shortcut to {" + sc + "} key.")
		display_msg inf_screeny + inf_tiles
		goto *label_1223
	}
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 2) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 2
				}
			}
			if (p != curmenu) {
				cw = 0
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					snd 102
					goto *label_1245
				}
				if (curmenu == 1) {
					snd 101
					goto *label_1222
				}
				if (curmenu == 2) {
					snd 102
					goto *label_1245
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1223
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1223
		}
	}
	if (key == key_cancel) {
		cw = 0
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1224
*label_1225
	txt -1, lang("どの方向に？ ", "Which direction? ")
	gosub *label_0623
	val = 0
	gosub *label_1350
	if (stat == 0) {
		txt -1, strinteractfail
		gosub *label_0623
		goto *label_1623
	}
	tc = map(x, y, 1)
	if (tc == 0) {
		txt -1, strinteractfail
		gosub *label_0623
		goto *label_1623
	}
	tc -= 1
	if (tc == 0) {
		if (gMount != 0) {
			tc = gMount
		}
	}
	if (tc != 0) {
		if (petcheck(tc) | gWizard) {
			if (cbit(963, tc) == 0 & cbit(971, tc) == 0 & cRole(tc) != 20001) {
				goto *label_1275
			}
		}
		gosub *label_0623
		invctrl = 10
		snd 100
		goto *label_1280
	}
	txt -1, strinteractfail
	gosub *label_0623
	goto *label_1623
*label_1226
	txt -1, lang("操作する対象の方向は？", "Choose the direction of the target.")
	val = 0
	gosub *label_1350
	if (stat == 0) {
		txt -1, strinteractfail
		gosub *label_0623
		goto *label_1623
	}
	tc = map(x, y, 1)
	if (tc == 0) {
		txt -1, strinteractfail
		gosub *label_0623
		goto *label_1623
	}
	tc -= 1
	f@00m = 0
	if (cfg_interactex == 1) {
		if (tc == 0) {
			if (gMount != 0) {
				promptl(0, promptmax) = name(tc), "null", "" + 0
				promptmax++
				promptl(0, promptmax) = name(gMount), "null", "" + gMount
				promptmax++
				val = promptx, prompty, 200, 1
				gosub *label_1353
				if (stat == 0) {
					gosub *label_0623
					goto *label_1623
				} else {
					if (gMount == rtval) {
						f@00m = 1
					}
					tc = rtval
				}
			}
		} else {
			if (ocdata(106, tc) != 0) {
				promptl(0, promptmax) = name(tc), "null", "" + tc
				promptmax++
				promptl(0, promptmax) = name(ocdata(106, tc)), "null", "" + ocdata(106, tc)
				promptmax++
				val = promptx, prompty, 200, 1
				gosub *label_1353
				if (stat == 0) {
					gosub *label_0623
					goto *label_1623
				} else {
					if (ocdata(106, tc) == rtval) {
						f@00m = 1
					}
					tc = rtval
				}
			}
		}
		gosub *label_0623
	}
	txt -1, lang(name(tc) + "に何をする？ ", "What action do you want to perform to " + him(tc) + "? ")
	p = 0
	if (tc != 0) {
		if (cConfused(0) == 0 & f@00m == 0) {
			promptl(0, promptmax) = lang("話しかける", "Talk"), "null", "" + 0
			promptmax++
			promptl(0, promptmax) = lang("攻撃する", "Attack"), "null", "" + 1
			promptmax++
		}
		if (cbit(963, tc) == 0) {
			if (cbit(971, tc) == 0 & cRole(tc) != 20001) {
				if (petcheck(tc) | gWizard) {
					promptl(0, promptmax) = lang("所持品", "Inventory"), "null", "" + 4
					promptmax++
					promptl(0, promptmax) = lang("装備品", "Wear"), "null", "" + 14
					promptmax++
				} else {
					promptl(0, promptmax) = lang("何かを渡す", "Give"), "null", "" + 2
					promptmax++
				}
				if (cbit(960, tc) == 1) {
					promptl(0, promptmax) = lang("連れ出す", "Bring Out"), "null", "" + 5
					promptmax++
				}
				if (tc < 16) {
					promptl(0, promptmax) = lang("着替えさせる", "Appearance"), "null", "" + 8
					promptmax++
					promptl(0, promptmax) = lang("作戦を決める", "Decide Strategy"), "null", "" + 11
					promptmax++
					found = 0
					repeat length2(csetwork)
						if (areaId(gCurrentMap) == csetwork(0, cnt)) {
							found = 1
							break
						}
					loop
					if (found & f@00m == 0) {
						promptl(0, promptmax) = lang("仕事を任せる", "Assign Work"), "null", "" + 12
						promptmax++
					}
					promptl(0, promptmax) = lang("性格を変える", "Alter Personality"), "null", "" + 13
					promptmax++
					if (sdata(301, tc) != 0 & f@00m == 0) {
						if (ocdata(106, tc) == 0) {
							promptl(0, promptmax) = lang("騎乗させる", "Allow Riding"), "null", "" + 16
						} else {
							promptl(0, promptmax) = lang("騎乗を止めさせる", "Stop Riding"), "null", "" + 16
						}
						promptmax++
					}
					promptl(0, promptmax) = lang("行動の設定", "Actions Setting"), "null", "" + 19
					promptmax++
					if (int(cAiActNum(tc) / 10) > 0) {
						promptl(0, promptmax) = lang("特殊行動の確認", "Confirm actions"), "null", "" + 20
						promptmax++
					}
				}
				if (cRole(tc) == 13) {
					if (cbit(969, tc) == 0) {
						if (ocdata(100, tc) == 20000) {
							promptl(0, promptmax) = lang("着替えさせる", "Appearance"), "null", "" + 15
							promptmax++
						}
					}
				}
				if (tc > 15) {
					if (cRole(tc) == 18 | (cRole(tc) == 4 & cId(tc) == 205)) {
						promptl(0, promptmax) = lang("着替えさせる", "Appearance"), "null", "" + 15
						promptmax++
					}
				}
			}
		}
		promptl(0, promptmax) = lang("言葉を教える", "Teach Words"), "null", "" + 7
		promptmax++
		promptl(0, promptmax) = lang("口調を変える", "Change Tone"), "null", "" + 10
		promptmax++
		if (gCurrentMap != 35) {
			if (cbit(985, tc)) {
				promptl(0, promptmax) = lang("縄を解く", "Release"), "null", "" + 9
				promptmax++
			}
		}
	}
	promptl(0, promptmax) = lang("名前をつける", "Name"), "null", "" + 3
	promptmax++
	if (tc == 0) {
		promptl(0, promptmax) = lang("全員に命令する", "Command All"), "null", "" + 11
		promptmax++
		promptl(0, promptmax) = lang("口調を変える", "Change Tone"), "null", "" + 10
		promptmax++
		if (gdatac(10) == 0) {
			promptl(0, promptmax) = lang("全員黙らせる", "Shut up."), "null", "" + 17
			promptmax++
		} else {
			promptl(0, promptmax) = lang("全員喋らせる", "You can speak now."), "null", "" + 17
			promptmax++
		}
		promptl(0, promptmax) = lang("ペットの順番", "Order of pets"), "null", "" + 18
		promptmax++
	}
	if (0 | gWizard | godcheck(0) == "mayumaka") {
		promptl(0, promptmax) = lang("情報", "Info"), "null", "" + 6
		promptmax++
	}
	val = promptx, prompty, 200, 1
	gosub *label_1353
	if (stat == 0) {
		gosub *label_0623
		goto *label_1623
	}
	p = rtval
	screenupdate = -1
	if (p == 0) {
		gosub *label_0623
		gosub *label_1467
		if (chatteleport == 1) {
			chatteleport = 0
			goto *label_0939
		} else {
			goto *label_1617
		}
	}
	if (p == 1) {
		gosub *label_0623
		gosub *label_1442
		gosub *label_1848
		goto *label_1617
	}
	if (p == 2) {
		gosub *label_0623
		invctrl = 10
		snd 100
		goto *label_1280
	}
	if (p == 3) {
		gosub *label_0623
		goto *label_1231
	}
	if (p == 4) {
		goto *label_1275
	}
	if (p == 5) {
		rc = tc
		gosub *label_1530
		gosub *label_0623
		goto *label_1617
	}
	if (p == 6) {
		csctrl = 4
		snd 26
		cc = tc
		gosub *label_1251
		cc = 0
		goto *label_1623
	}
	if (p == 7) {
		txt -1, lang("どんな言葉を教えようか。", "What sentence should " + name(tc) + " learn? ")
		val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
		inputlog = ""
		gosub *label_1349
		cbitmod 989, tc, 0
		if (inputlog == "") {
			cdatan(4, tc) = ""
		} else {
			cdatan(4, tc) = inputlog
			txtef 9
			txt -1, "" + cdatan(4, tc)
		}
		gosub *label_0623
		goto *label_1623
	}
	if (p == 8) {
		gsel 4
		pos 0, 0
		exist exedir + "user\\graphic\\user_face1.bmp"
		if (strsize != (-1) & cfg_userface1) {
			picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
			ex_userface = 1
		} else {
			picload_ exedir + "graphic\\face1.bmp", 1
			ex_userface = 0
		}
		gsel 0
		ccbk = cc
		cc = tc
		gosub *label_1258
		cc = ccbk
		gosub *label_0623
		goto *label_1623
	}
	if (p == 9) {
		snd 58
		cbitmod 985, tc, 0
		txt -1, lang(name(tc) + "の縄を解いた。", "You release " + name(tc) + ".")
		ctalk tc, 401, 0, tc
		flt
		itemcreate -1, 733, cX(tc), cY(tc), 0
	}
	if (p == 10) {
		gosub *label_1232
		gosub *label_0623
		goto *label_1623
	}
	if (p == 11) {
		ccbk = cc
		cc = tc
		gosub *pet_openStrategyMenu
		cc = ccbk
		gosub *label_0623
		goto *label_1623
	}
	if (p == 12) {
		f = 0
		repeat length2(csetwork)
			if (areaId(gCurrentMap) != csetwork(0, cnt)) {
				continue
			}
			if (sdata(csetwork(1, cnt), tc) == 0) {
				continue
			}
			f = 1
			break
		loop
		if (f) {
			ccbk = cc
			cc = tc
			gosub *label_1716
			cc = ccbk
			gosub *label_0623
			goto *label_1623
		} else {
			txt -1, lang(name(tc) + "に任せられる仕事はない。", "There is no work available that can be assigned to " + name(tc) + ".")
		}
	}
	if (p == 13) {
		gosub *label_1728
		gosub *label_0623
		goto *label_1623
	}
	if (p == 14) {
		cc = tc
		gosub *label_1270
		gosub *label_0623
		goto *label_1623
	}
	if (p == 15) {
		gsel 4
		pos 0, 0
		exist exedir + "user\\graphic\\user_face1.bmp"
		if (strsize != (-1) & cfg_userface1) {
			picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
			ex_userface = 1
		} else {
			picload_ exedir + "graphic\\face1.bmp", 1
			ex_userface = 0
		}
		gsel 0
		ccbk = cc
		cc = tc
		gosub *label_1816
		cc = ccbk
		gosub *label_0623
		goto *label_1623
	}
	if (p == 16) {
		if (ocdata(106, tc) != 0) {
			cell_findspace cX(tc), cY(tc), 1
			if (stat == 0) {
				txt -1, lang("降りるスペースがない。", "There's no place to get off.")
				gosub *label_0623
				goto *label_1623
			}
			cell_setchara ocdata(106, tc), rtval, rtval(1)
			txt -1, lang(name(tc) + "は" + name(ocdata(106, tc)) + "から降りた。", name(tc) + " dismount" + _s(tc) + " from " + name(ocdata(106, tc)) + ".")
			ride_end tc
			gosub *label_0623
			goto *label_1623
		}
		allyctrl = 8
		gosub *ui_selectAlly
		if (stat != (-1)) {
			ccbk = cc
			cc = tc
			tc = stat
			gosub *label_1856
			cc = ccbk
		}
		gosub *label_0623
		goto *label_1623
	}
	if (p == 17) {
		if (gdatac(10) == 0) {
			repeat 15, 1
				if (cState(cnt) == 0) {
					continue
				}
				if (cCanTalk(cnt) != 0) {
					if (cbit(965, cnt) == 0) {
						cbitmod 965, cnt, 1
					}
				}
			loop
			gdatac(10) = 1
		} else {
			repeat 15, 1
				if (cState(cnt) == 0) {
					continue
				}
				if (cCanTalk(cnt) != 0) {
					if (cbit(965, cnt) == 1) {
						cbitmod 965, cnt, 0
					}
				}
			loop
			gdatac(10) = 0
		}
		gosub *label_0623
		goto *label_1623
	}
	if (p == 18) {
		ccbk = cc
		cc = tc
		gosub *label_1227
		cc = ccbk
		gosub *label_0623
		goto *label_1623
	}
	if (p == 19) {
		if (cAiActNum(tc) / 10 < 5 & cdata(211, tc) != 0) {
			repeat (cAiActNum(tc) / 10)
				if (cdata(211, tc) == cdata(220 + cnt, tc)) {
					break
				}
				if (cnt == (cAiActNum(tc) / 10)) {
					cdata(220 + (cAiActNum(tc) / 10), tc) = cdata(211, tc)
					cAiActNum(tc) += 10
					txt -1, lang("" + skillname(cdata(211, tc)) + "を特殊行動に移植した。", "" + skillname(cdata(211, tc)) + " ported to special action.")
				}
			loop
		}
		goto *label_N100
	}
	if (p == 20) {
		goto *label_N110
	}
	gosub *label_0623
	goto *label_1623
*label_1227
	allyctrl = 100
	swap@se = -1, -1
	gosub *ui_selectAlly
	if (stat != (-1)) {
		swap@se(0) = stat
		gosub *ui_selectAlly
		if (stat != (-1)) {
			swap@se(1) = stat
			cInitialX(swap@se(0)) = cX(swap@se(1))
			cInitialY(swap@se(0)) = cY(swap@se(1))
			cInitialX(swap@se(1)) = cX(swap@se(0))
			cInitialY(swap@se(1)) = cY(swap@se(0))
			hpbk = cHp(swap@se(0)), cHp(swap@se(1))
			txt -1, lang("" + cdatan(0, swap@se(0)) + "と" + cdatan(0, swap@se(1)) + "を入れ替えた。", "Swapped positions between " + cdatan(0, swap@se(0)) + " and " + cdatan(0, swap@se(1)) + ".")
			relocate_chara swap@se(0), 56, 1
			relocate_chara swap@se(1), swap@se(0), 1
			relocate_chara 56, swap@se(1), 1
			chara_vanquish 56
			repeat 2
				cState(swap@se(cnt)) = 1
				cX(swap@se(cnt)) = cInitialX(swap@se(cnt))
				cY(swap@se(cnt)) = cInitialY(swap@se(cnt))
				cRelationship(swap@se(cnt)) = 10
				cHp(swap@se(cnt)) = hpbk(cnt)
			loop
		}
	}
	return
*label_1231
	txt -1, lang(name(tc) + "を何と呼ぶ？ ", "What do you want to call " + him(tc) + "? ")
	val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
	inputlog = ""
	input_mode = 1
	gosub *label_1349
	if (inputlog == "") {
		txt -1, lang("名前をつけるのはやめた。", "You changed your mind.")
	} else {
		if (instr(inputlog, 0, "%rndName") != (-1)) {
			strrep inputlog, "%rndName", randomname()
		}
		cdatan(0, tc) = "" + inputlog
		cbitmod 977, tc, 1
		txt -1, lang("" + cdatan(0, tc) + "という名前で呼ぶことにした。", "You named " + him(tc) + " " + cdatan(0, tc) + ".")
	}
	gosub *label_0620
	goto *label_1623
*label_1232
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	folder = exedir + "user\\talk\\"
	dirlist buff, folder + "*.txt"
	notesel buff
	list(0, 0) = -999
	listn(0, 0) = lang("デフォルトの口調", "Default Tone")
	listmax++
	list(0, 1) = -998
	listn(0, 1) = lang("トーク設定", "Default Tone")
	listmax++
	repeat noteinfo(0)
		noteget s, cnt
		list(0, listmax) = listmax
		listn(0, listmax) = s
		listmax++
	loop
	windowshadow = 1
*label_1233
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1234
	redraw 0
	s = lang("口調一覧", "Tone of Voice"), lang("決定 [口調の変更]  ", "Enter [Change Tone] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 432
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("題名", "Title") + "  「" + cdatan(4, tc) + "」", wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 138, wy + 66 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if (p != (-1)) {
		snd 20
		if (p == (-998)) {
			gosub *label_2058
			return 1
		}
		txt -1, lang(name(tc) + "の口調が変わった気がする。", name(tc) + " is somewhat different.")
		if (p == (-999)) {
			cbitmod 989, tc, 0
			cdatan(4, tc) = ""
			return 1
		}
		cbitmod 989, tc, 1
		cdatan(4, tc) = listn(0, p)
		return 1
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1233
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1233
		}
	}
	if (key == key_cancel) {
		return -1
	}
	goto *label_1234
*label_1235
*label_1236
	snd 94
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	if (allyctrl == 0) {
		repeat usernpcmax
			if (instr(userdatan(6, cnt), 0, "_tmp_") == (-1)) {
				continue
			}
			if (instr(userdatan(4, cnt), 0, "/nodownload/") != (-1)) {
				continue
			}
			list(0, listmax) = listmax
			listn(0, listmax) = lang(userdatan(1, cnt) + "(" + userdatan(0, cnt) + ")", userdatan(0, cnt)), userdatan(6, cnt)
			list(1, listmax) = userdata(2, cnt)
			listmax++
		loop
	}
	txt -1, lang("どの者を召喚したいと願うか？", "Which one do you wish to summon?")
	windowshadow = 1
*label_1237
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1238
	redraw 0
	s = lang("カスタムNPC一覧", "Custom NPC"), lang("決定 [召喚]  ", "Enter [Summon] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("名前", "Name"), wx + 28, wy + 36
	display_topic lang("Level", "Level"), wx + 348, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		pos wx + 380, wy + 66 + cnt * 19
		mes "" + list(1, p)
		cs_list s, wx + 85, wy + 66 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if (p != (-1)) {
		listmax = p
		snd 64
		txt -1, listn(0, listmax) + lang("は、あなたの世界に召喚された！", " has been summoned to your world!")
		file = "" + userfile
		gosub *label_1320
		bcopy exedir + "user\\" + listn(1, listmax), exedir + "user\\" + listn(0, listmax) + ".npc"
		gosub *custom_loadCnpcs
		repeat 5480
			if (inv(34, cnt)) {
				getunid4item cnt
			}
		loop
		repeat gNumberOfExistingQuests
			if (qdata(0, cnt) == 0) {
				continue
			}
			if (qdata(3, cnt) == 1008 | qdata(3, cnt) == 1010 & qdata(12, cnt) == 343) {
				getunid4job cnt
			}
		loop
		gosub *custom_cleanUpTemporaryFiles
		gosub *label_1336
		gosub *label_1635
		return 1
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1237
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1237
		}
	}
	if (key == key_cancel) {
		return -1
	}
	goto *label_1238
*label_1239
*label_1240
	snd 59
	gsel 4
	pos 0, 0
	picload_ exedir + "graphic\\book.bmp", 1
	gsel 0
	notesel buff
	noteload exedir + "data\\book.txt"
	p = instr(buff, 0, "" + iParam1(ci) + "," + lang("JP", "EN"))
	if (p == (-1)) {
		return
	}
	buff = strmid(buff, p, instr(buff, p, "%END"))
	notedel 0
	listmax = 0
	page = 0
	pagesize = 40
	cs = 0
	cc = 0
	listmax = noteinfo(0)
	keyrange = 0
	key_list(0) = key_enter
	color 0, 0, 0
*label_1241
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	wx = (windoww - 720) / 2 + inf_screenx
	wy = winposy(468)
	pos wx, wy
	gcopy 4, 0, 0, 736, 448
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		x = wx + 80 + cnt / 20 * 306
		y = wy + 45 + cnt \ 20 * 16
		noteget s, p
		if (p == 0) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
		}
		if (p == 1) {
			font lang(cfg_font1, cfg_font2), 10 + sizefix - en * 2, 0
		}
		if (p > 2) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		}
		pos x, y
		mes s
		if (p \ 20 == 0) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			pos x + 90, y + 330
			mes "- " + (p / 20 + 1) + " -"
		}
	loop
*label_1242
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 71
			page++
			goto *label_1241
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 71
			page--
			goto *label_1241
		}
	}
	if (key == key_cancel | key == key_enter) {
		gosub *label_0623
		return
	}
	goto *label_1242
*label_1243
*label_1244
	if (cc == 0) {
		if (gettrait(0, 173) != 0) {
			if (rnd(20) == 0) {
				txt -1, lang(name(cnt) + "は行動を躊躇った。", name(cnt) + " hesitate" + _s(cnt) + " " + his(cnt) + " action.")
				goto *label_1617
			}
		}
	}
	tc = cc
	gosub *label_1388
	if (stat == 0) {
		goto *label_1623
	}
	goto *label_1617
*label_1245
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	cs = commark(1) \ 1000
	page = commark(1) / 1000
	repeat 200
		p = cnt
		ishighspell = 0
		repeat length(isethighspell)
			if (isethighspell(cnt) == p) {
				ishighspell = 1
				break
			}
		loop
		if ((curmenu == 0 & (ishighspell | cnt >= 100)) | (curmenu == 2 & ishighspell == 0) | (curmenu == 3 & (cnt < 100 | ishighspell))) {
			continue
		}
		if (spell(cnt) > 0) {
			list(0, listmax) = cnt + 400, sdataref(0, 400 + cnt)
			listmax++
		}
	loop
	if (curmenu == 2) {
		repeat userspellmax
			if (userspelldata(11, cnt) > 0 & userspelldata(0, cnt) > 0) {
				list(0, listmax) = cnt + 550, userspelldata(0, cnt)
				listmax++
			}
		loop
	}
	gosub *label_1276
	redraw 0
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_spell.bmp", 1
	gsel 0
	windowshadow = 1
*label_1246
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	drawmenu 1
*label_1247
	redraw 0
	s = lang("魔法の詠唱", "Spell"), strhint2 + strhint3 + strhint7
	display_window (windoww - 720) / 2 + inf_screenx, winposy(438), 720, 438
	display_topic lang("魔法の名称", "Name"), wx + 28, wy + 36
	display_topic lang("消費MP(ｽﾄｯｸ) LV/成功", "Cost(Stock) Lv/Chance"), wx + 220, wy + 36
	display_topic lang("効果", "Effect"), wx + 400, wy + 36
	pos wx + 46, wy - 16
	if (curmenu == 3) {
		gcopy 3, 288 + 23 * 48, 48, 48, 48
	} elseif (curmenu == 2) {
		gcopy 3, 288 + 22 * 48, 48, 48, 48
	} else {
		gcopy 3, 288 + 13 * 48, 48, 48, 48
	}
	pos wx + ww - 78, wy
	gcopy 3, 960, 96, 72, 144
	pos wx + ww - 180, wy
	gcopy 3, 1032, 96, 72, 96
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 620, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		if (i >= 550) {
			p(79) = userspelldata(11, i - 550)
			p(78) = userspelldata(12, i - 550) / 1000000
		} else {
			p(79) = spell(i - 400)
			p(78) = sdata(i, cc)
		}
		pos wx + 40, wy + 74 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate 1, (sdataref(0, i) - 10) * inf_tiles, 672, 0, inf_tiles, inf_tiles
		s = ""
		repeat 20
			if (ogdata(36 + cnt) == list(0, p)) {
				s = "{" + cnt + "}"
			}
		loop
		if (cfg_strackex != 0) {
			strack = ""
			repeat 20
				if (gdatac(750 + cnt) == 0 * 10000 + i) {
					strack = "*"
				}
			loop
		}
		s(1) = skillname(i)
		cutname s(1), 22
		if (cfg_strackex != 0) {
			cs_list strack + s(1) + s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		} else {
			cs_list s(1) + s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		}
		s = "" + calcspellcostmp(i, cc) + " (" + p(79) + ")"
		pos wx + 328 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
		mes s
		gosub *label_1248
		s = strmid(s, 0, 40)
		pos wx + 340, wy + 66 + cnt * 19 + 2
		mes "" + p(78) + "/" + calcspellfail(i, cc) + "%"
		pos wx + 420, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	commark(1) = page * 1000 + cs
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		menucycle = 0
		efid = p
		goto *label_1243
	}
	if (key == "sc") {
		snd 20
		p = list(0, pagesize * page + cs)
		if (ogdata(36 + sc) == p) {
			ogdata(36 + sc) = 0
			stgdata(36 + sc) = 0
			stgdata(56 + sc) = 0
			ncgsdata(sc) = ""
			goto *label_1246
		}
		repeat 20
			if (ogdata(36 + cnt) == p) {
				ogdata(36 + cnt) = 0
				stgdata(36 + cnt) = 0
				stgdata(56 + cnt) = 0
				ncgsdata(cnt) = ""
			}
		loop
		ogdata(36 + sc) = p
		txt -1, lang("{" + sc + "}キーにショートカットを割り当てた。", "You have assigned the shortcut to {" + sc + "} key.")
		display_msg inf_screeny + inf_tiles
		goto *label_1246
	}
	if (cfg_strackex != 0) {
		if (key == key_mode2) {
			i = list(0, pagesize * page + cs)
			if (i != (-1)) {
				p = 750
				repeat 20, 750
					if (gdatac(cnt) \ 10000 == 0) {
						p = cnt
					}
					if (gdatac(cnt) == cc * 10000 + i) {
						p = cnt
						i = 0
						break
					}
				loop
				gdatac(p) = cc * 10000 + i
				sortskilltrack
				snd 20
			}
			display_msg inf_screeny + inf_tiles
			goto *label_1246
		}
	}
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 3) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 3
				}
			}
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					snd 102
					goto *label_1245
				}
				if (curmenu == 1) {
					snd 101
					goto *label_1222
				}
				if (curmenu == 2) {
					snd 102
					goto *label_1245
				}
				if (curmenu == 3) {
					snd 102
					goto *label_1245
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1246
		}
	}
	if (key == key_identify) {
		p = list(0, pagesize * page + cs)
		if (p >= 550) {
			title_pos = p - 550
			gosub *label_1810
			goto *label_1245
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1246
		}
	}
	if (key == key_cancel) {
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1247
*label_1248
*label_1249
	s = ""
	if (sdataref(1, i) / 1000 == 1 | sdataref(1, i) / 1000 == 4) {
		p = sdataref(1, i) \ 1000
		calcbuff -2, p, calcspellpower(i, cc)
		s = "" + dur + lang("ﾀｰﾝ ", "t ") + buffdesc
		return
	}
	calcskill i, cc, calcspellpower(i, cc)
	p(90) = stat
	calcempower i
	if (p(90) == 1) {
		if (dice1 != 0) {
			s += "" + dice1 + "d" + dice2
			if (bonus != 0) {
				if (bonus > 0) {
					s += "+" + bonus
				} else {
					s += bonus
				}
			}
		} else {
			if (i == 461) {
				s += "" + limit(bonus, 1, 100) + "%"
			} else {
				s += lang("ﾊﾟﾜｰ", "Power:") + bonus
			}
		}
		s += " "
	}
	s += skilldesc(i)
	// 神託効果追加
	if (i == 413) {
		s += " " + (150 + (calcspellpower(i, cc) / 5)) + lang("MP回復", "HealMP")
	}
	return

*label_1251
	page = 0
	cs = 0
	curmenu = 0
	if (csctrl == 2 | csctrl == 3) {
		page = 1
	}
*label_1252
	pagesize = 16
	listmax = 0
	if (csctrl != 4 & csctrl != 5) {
		cc = 0
	}
	csskill = -1
	cs_buff = 0
	if (gWizard | godcheck(0) == "mayumaka" | csctrl == 5) {
		if (csctrl != 2 & csctrl != 3) {
			list(0, listmax) = -1, 10000
			listn(0, listmax) = lang("◆ 能力", "Attribute")
			listmax++
			repeat 4 - 2, 2
				if (sdata(cnt, cc) != 0) {
					list(0, listmax) = cnt, sdataref(0, cnt) + 11000
					listmax++
				}
			loop
			repeat 50 - 10, 10
				if (sdata(cnt, cc) != 0) {
					list(0, listmax) = cnt, sdataref(0, cnt) + 11000
					listmax++
				}
			loop
			list(0, listmax) = -1, 15000
			listn(0, listmax) = lang("◆ スペル", "Spell")
			listmax++
			repeat 467 - 400, 400
				if (cnt != 426 & cnt != 427) {
					list(0, listmax) = cnt, sdataref(0, cnt) + 16000
					listmax++
				}
			loop
			repeat userspellmax, 550
				list(0, listmax) = cnt, sdataref(0, cnt) + 16000
				listmax++
			loop
		}
	}
	list(0, listmax) = -1, 20000
	listn(0, listmax) = lang("◆ スキルと特殊能力", "Skill")
	listmax++
	if (csctrl == 3) {
		gosub *skill_setTrainerSkillForCurrentMap
	} else {
		repeat 400 - 150, 150
			f = 0
			if (sdata(cnt, cc) != 0) {
				f = 1
				if (csctrl == 2) {
					if (sorg(cnt, cc) == 0) {
						f = 0
					}
				}
			}
			if (f) {
				list(0, listmax) = cnt, sdataref(0, cnt) + 21000
				listmax++
			}
		loop
	}
	list(0, listmax) = -1, 30000
	listn(0, listmax) = lang("◆ 武器の専門", "Weapon Proficiency")
	listmax++
	repeat 150 - 100, 100
		f = 0
		if (csctrl != 3) {
			if (sdata(cnt, cc) != 0) {
				f = 1
			}
		} else {
			if (sdata(cnt, cc) == 0) {
				if (sdataref(0, cnt) != 0) {
					f = 1
				}
			}
		}
		if (f) {
			list(0, listmax) = cnt, sdataref(0, cnt) + 31000
			listmax++
		}
	loop
	if (csctrl != 2 & csctrl != 3) {
		list(0, listmax) = -1, 40000
		listn(0, listmax) = lang("◆ 耐性と抵抗力", "Resistance")
		listmax++
		repeat 100 - 50, 50
			if (sdata(cnt, cc) != 0) {
				list(0, listmax) = cnt, sdataref(0, cnt) + 41000
				listmax++
			}
		loop
	}
	gosub *label_1276
	gsel 7
	picload_ exedir + "graphic\\ie_sheet.bmp"
	gsel 0
	wx = (windoww - 700) / 2 + inf_screenx
	wy = winposy(400) - 10
	ww = 700
	wh = 400
	redraw 0
	s = lang("キャラクターシート", "Character Sheet")
	if (csctrl == 2) {
		s = lang("能力訓練", "Skill Training")
	}
	if (csctrl == 3) {
		s = lang("能力の習得", "Skill Learning")
	}
	drawmenu 0
	if (mode != 1) {
		snd 94
	}
	windowanime wx, wy, ww, wh, 10, 4
	gsel 4
	pos 0, 0
	exist exedir + "user\\graphic\\user_face1.bmp"
	if (strsize != (-1) & cfg_userface1) {
		picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
		ex_userface = 1
	} else {
		picload_ exedir + "graphic\\face1.bmp", 1
		ex_userface = 0
	}
	if (cPortrait(cc) < 0) {
		s = exedir + "user\\graphic\\face" + abs(cPortrait(cc) + 1) + ".bmp"
		exist s
		if (cPortrait(cc) != (-1)) {
			if (strsize != (-1)) {
				pos 0, 0
				picload_ s, 1
			}
		}
	}
	gsel 0
	if (returnfromportrait == 0) {
		redraw 0
		gmode 6, , , 80
		pos wx + 4, wy + 4
		gcopy 7, 0, 0, 700, 400
		gmode 2
	}
	if (csctrl == 2) {
		txtnew
		txt -1, lang("どの能力を訓練する？", "Train which skill?")
	}
	returnfromportrait = 0
*label_1253
	if (csctrl != 1) {
		display_msg inf_tiles + inf_screeny
	}
	pagemax = (listmax - 1) / pagesize + 1
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	if (csctrl == 1) {
		pagemax = 0
	}
	cs_bk = -1
	redraw 0
	if (csctrl == 0 | csctrl == 4 | csctrl == 5) {
		if (page == 0) {
			s = lang("ｶｰｿﾙ [祝福と呪いの情報]  ", "Cursor [Hint]  ") + strhint6 + strhint2 + strhint3
		} else {
			s = lang("決定 [ボーナスの分配]  ", "Enter [Spend Bonus]  ") + strhint2 + strhint3
		}
	}
	if (csctrl == 1) {
		s = lang("決定ｷｰ [リロール]  " + strhint6 + "Shift,Esc [最終確認]", "Enter Key [Reroll]  " + strhint6 + "Shift,Esc [Confirm]")
	}
	if (csctrl == 2) {
		if (page == 0) {
			s = strhint6 + strhint2 + strhint3
		} else {
			s = lang("決定 [スキルを訓練]  ", "Enter [Train Skill]  ") + strhint2 + strhint3
		}
	}
	if (csctrl == 3) {
		if (page == 0) {
			s = strhint6 + strhint2 + strhint3
		} else {
			s = lang("決定 [スキルを習得]  ", "Enter [Learn Skill]  ") + strhint2 + strhint3
		}
	}
	if (csctrl != 1) {
		if (page != 0) {
			s += "" + key_mode2 + " [" + lang("スキルトラック", "Track Skill") + "]"
		}
	}
	showtitle s, s, 236, 1
*label_1254
	redraw 0
	s = ""
	if (csctrl == 0 | csctrl == 4) {
		if (page != 0) {
			if (cc != 0 & cc <= 15 & ncgdata(100) > 0) {
				s = lang("残り " + cSkillBonus(cc) + " のボーナスをスキルに分配できる(SPP:" + ncgdata(100) + ")", "You can spend " + cSkillBonus(cc) + " bonus points.")
			} else {
				s = lang("残り " + cSkillBonus(cc) + " のボーナスをスキルに分配できる", "You can spend " + cSkillBonus(cc) + " bonus points.")
			}
		}
	}
	display_window2 (windoww - 700) / 2 + inf_screenx, winposy(400) - 10, 700, 400, 7
	if (page == 0) {
		keyrange = 0
		key_list = key_enter
		if (cfg_NC_charasheet == 0) {
			display_topic lang("能力(元の値)  - 潜在能力", "Attributes(Org) - Potential"), wx + 28, wy + 122
			display_topic lang("各種修正", "Combat Rolls"), wx + 400, wy + 253
			display_topic lang("冒険の軌跡", "Trace"), wx + 28, wy + 273
			display_topic lang("祝福と呪い", "Blessing and Hex"), wx + 400, wy + 122
			display_topic lang("その他", "Extra Info"), wx + 220, wy + 273
			if (cPortrait(cc) >= 0) {
				p = cSex(cc) * 64 + cPortrait(cc)
				pos wx + 560, wy + 27
				exist exedir + "user\\graphic\\user_npcface" + p + ".bmp"
				if (strsize != (-1)) {
					gsel 32
					pos 0, 0
					picload_ exedir + "user\\graphic\\user_npcface" + p + ".bmp", 1
					gsel 0
					pos wx + 560, wy + 27
					gzoom 80, 112, 32, 0, 0, 80, 112
				} else {
					if (ex_userface == 1) {
						gzoom 80, 112, 4, p \ 16 * 80, p / 16 * 112, 80, 112
					} else {
						gzoom 80, 112, 4, p \ 16 * 48, p / 16 * 72, 48, 72
					}
				}
			} else {
				s = exedir + "user\\graphic\\face" + abs(cPortrait(cc) + 1) + ".bmp"
				exist s
				if (cPortrait(cc) != (-1)) {
					if (strsize != (-1)) {
						pos wx + 560, wy + 27
						gzoom 80, 112, 4, 0, 0, 80, 112
					}
				} else {
					if (cId(cc) == 343) {
						if (userdata2(0, cCnpcId(cc))) {
							pos wx + 560, wy + 27
							gzoom 80, 112, 100, cCnpcId(cc) \ 16 * 80, cCnpcId(cc) / 16 * 112, 80, 112
						}
					}
				}
			}
			window2 wx + 557, wy + 23, 87, 120, 1, 10
			if (cbit(967, cc) == 1) {
				pos wx + 596 + 22, wy + 86 + 24
				gmode 2, 32, 48
				if (cc == 0) {
					grotate 10 + cc, 32, 0, 0, 24 + cfg_graphicpc * 8, 40 + cfg_graphicpc * 8
				} else {
					grotate 10 + cc, 32, 0, 0, 24 + cfg_graphicnpc * 8, 40 + cfg_graphicnpc * 8
				}
			} else {
				transmissivity = 0
				if (cId(cc) == 343) {
					if (userdata2(1, cCnpcId(cc))) {
						transmissivity = userdata2(1, cCnpcId(cc))
					}
				}
				if (ocdata(101, cc)) {
					transmissivity = ocdata(101, cc)
				}
				i = getcharapic(cc)
				chara_preparepic i, getcharacolor(cc)
				pos wx + 596 + 22, wy + 86 + 24
				gmode 4, chipc(2, i), chipc(3, i), 256 - transmissivity
				color 0, 0, 0
				grotate 5, 0, 960, 0, chipc(2, i) / (1 + (chipc(3, i) > inf_tiles)), inf_tiles
				gmode 2
			}
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			color 20, 10, 0
			s = lang("レベル", "Level"), lang("経験", "EXP"), lang("必要値", "Next Lv"), lang("信仰", "God"), lang("所属", "Guild")
			repeat 5
				pos wx + 355, wy + 46 + cnt * 15
				mes s(cnt)
			loop
			s = lang("名前", "Name"), lang("異名", "Aka"), lang("種族", "Race"), lang("性別", "Sex"), lang("職業", "Class"), lang("年齢", "Age"), lang("身長", "Height"), lang("体重", "Weight")
			repeat 8
				pos wx + 30 + cnt / 4 * 190, wy + 61 + cnt \ 4 * 15
				mes s(cnt)
			loop
			repeat 8
				pos wx + 37, wy + 157 + cnt * 15
				gmode 2, inf_tiles, inf_tiles
				grotate 1, cnt * inf_tiles, 672, 0, inf_tiles, inf_tiles
				pos wx + 54, wy + 151 + cnt * 15
				color 0, 0, 0
				if (cfg_charasheet == 2) {
					p = sdata(10 + cnt + 600, cc) \ 1000
					if (p >= 400) {
						color 0, 0, 255
					} else {
						if (p < 10) {
							color 255, 0, 0
						}
					}
				}
				mes _stats2(cnt)
			loop
			if (cfg_charasheet == 0) {
				s = lang("生命力", "Life"), lang("マナ", "Mana"), lang("狂気度", "Insanity"), lang("速度", "Speed"), "", lang("名声", "Fame"), lang("カルマ", "Karma"), "", lang("打撃修正", "Melee"), lang("射撃修正", "Shoot"), "", "", "", "", "", ""
			} else {
				s = lang("生命力", "Life"), lang("マナ", "Mana"), lang("速度", "Speed"), lang("運", "Luck"), lang("狂気度", "Insanity"), lang("名声", "Fame"), lang("カルマ", "Karma"), lang("信仰P", "Piety"), ""
			}
			repeat 8
				pos wx + 255, wy + 151 + cnt * 15
				color 0, 0, 0
				if (cfg_charasheet == 2) {
					if (cnt == 0 | cnt == 1 | cnt == 2 | cnt == 3) {
						if (cnt == 0) {
							p = 2
						}
						if (cnt == 1) {
							p = 3
						}
						if (cnt == 2) {
							p = 18
						}
						if (cnt == 3) {
							p = 19
						}
						if (sdata(p + 600, cc) \ 1000 >= 400) {
							color 0, 0, 255
						} else {
							if (sdata(p + 600, cc) \ 1000 < 10) {
								color 255, 0, 0
							}
						}
					}
				}
				mes s(cnt)
			loop
			s = lang("ターン", "Turns"), lang("経過日", "Days"), lang("殺害数", "Kills"), lang("総時間", "Time"), "", ""
			repeat 5
				pos wx + 32, wy + 301 + cnt * 15
				mes s(cnt)
			loop
			s = lang("荷車重量", "Cargo Wt"), lang("荷車限界", "Cargo Lmt"), lang("装備重量", "Equip Wt"), lang("最深到達", "Deepest Lv")
			repeat 4
				pos wx + 224, wy + 301 + cnt * 15
				mes s(cnt)
			loop
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
			s = "" + cLevel(cc), "" + cExperience(cc), "" + cRequiredExperience(cc), godname(godcheck(cc)), guildname(cc)
			repeat 5
				pos wx + 410 + en * 5, wy + 45 + cnt * 15
				mes s(cnt)
			loop
			s = cdatan(0, cc), cdatan(1, cc)
			cutname s, 22
			dbidn = cdatan(2, cc)
			dbmode = 2
			gosub *label_1525
			if (cId(cc) == 343) {
				if (userdatan2(0, cCnpcId(cc)) != "") {
					racename = userdatan2(0, cCnpcId(cc))
				}
			}
			cutname racename, 14
			s(2) = cnven(racename)
			dbidn = cdatan(3, cc)
			dbmode = 2
			gosub *label_1526
			if (cId(cc) == 343) {
				if (userdatan2(1, cCnpcId(cc)) != "") {
					classname = userdatan2(1, cCnpcId(cc))
				}
			}
			cutname classname, 14
			s(4) = cnven(lang("" + classname, cdatan(3, cc)))
			if (cSex(cc) == 0) {
				s(3) = cnven(strmale)
			} else {
				s(3) = cnven(strfemale)
			}
			s(5) = "" + calcage(cc) + " " + lang("歳", ""), "" + cHeight(cc) + " cm", "" + cWeight(cc) + " kg"
			repeat 8
				pos wx + 68 + cnt / 4 * 190 + en * ((cnt > 3) * 12), wy + 60 + cnt \ 4 * 15
				mes s(cnt)
			loop
			repeat 8
				cnt2 = cnt
				s = "(" + sorgEx(10 + cnt, cc) + ")"
				if (encfind(cc, 6 * 10000 + 10 + cnt) != (-1)) {
					s += "*"
				}
				pos wx + 92, wy + 151 + cnt * 15
				if (sdata(10 + cnt, cc) >= 10000000 & cfg_NC_stateshorten) {
					mes "" + sdata(10 + cnt, cc) / 1000000 + "M"
				} elseif (sdata(10 + cnt, cc) >= 10000 & cfg_NC_stateshorten) {
					mes "" + sdata(10 + cnt, cc) / 1000 + "K"
				} else {
					mes "" + sdata(10 + cnt, cc)
				}
				pos wx + 124, wy + 151 + cnt * 15
				mes s
				p = sdata(10 + cnt + 600, cc) \ 1000
				pos wx + 176, wy + 152 + cnt * 15
				if (cfg_ST_attributesPotential == 0) {
					if (p >= 450) {
						mes "Extra"
						continue
					}
					if (p >= 400) {
						mes "Superb++"
						continue
					}
					if (p >= 360) {
						mes "Superb+"
						continue
					}
					if (p >= 200) {
						mes "Superb"
						continue
					}
					if (p >= 150) {
						mes "Great"
						continue
					}
					if (p >= 100) {
						mes "Good"
						continue
					}
					if (p >= 50) {
						mes "Bad"
						continue
					}
					mes "Hopeless"
				} else {
					mes strf("%5d%%", p)
				}
			loop
			if (cfg_charasheet == 0) {
				if (sdata(2, cc) >= 100000 & cfg_NC_stateshorten) {
					s(0) = "" + (sdata(2, cc) / 1000) + "K(" + sorgEx(2, cc) + ")"
				} else {
					s(0) = "" + sdata(2, cc) + "(" + sorgEx(2, cc) + ")"
				}
				if (sdata(3, cc) >= 100000 & cfg_NC_stateshorten) {
					s(1) = "" + (sdata(3, cc) / 1000) + "K(" + sorgEx(3, cc) + ")"
				} else {
					s(1) = "" + sdata(3, cc) + "(" + sorgEx(3, cc) + ")"
				}
				s(2) = "" + cInsanity(cc)
				if (cCurrentSpeed(cc) >= 100000 & cfg_NC_stateshorten) {
					s(3) = "" + (cCurrentSpeed(cc) / 1000) + "K(" + sorgEx(18, cc) + ")"
				} else {
					s(3) = "" + cCurrentSpeed(cc) + "(" + sorgEx(18, cc) + ")"
				}
				s(4) = "", "" + cFame(cc), "" + cKarma(cc), "", ""
			} else {
				s = "" + sdata(2, cc) + "(" + sorgEx(2, cc) + ")", "" + sdata(3, cc) + "(" + sorgEx(3, cc) + ")", "" + cCurrentSpeed(cc) + "(" + sorgEx(18, cc) + ")", "" + sdata(19, cc) + "(" + sorgEx(19, cc) + ")", "" + cInsanity(cc), "" + cFame(cc), "" + cKarma(cc), "", "", ""
			}
			repeat 8
				pos wx + 310, wy + 151 + cnt * 15
				mes s(cnt)
			loop
			if (cfg_charasheet > 0) {
				pos wx + 310, wy + 151 + 7 * 15
				mes "" + cPietyPoint(cc) + "/" + int(limitf(double(sdata(181, cc)) * 100, 0, 2147483647))
			}
			val = 0
			gosub *label_1265
			tc = cc
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			color 20, 10, 0
			pos wx + 417, wy + 281 + p(2) * 16
			mes lang("軽減", "Prot")
			pos wx + 590 - en * 16, wy + 281 + p(2) * 16
			mes lang("回避", "Evade")
			attackskill = 106
			evade = calcattackhit(2)
			prot = calcattackdmg(2)
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
			pos wx + 460 + en * 8, wy + 279 + p(2) * 16
			mes "" + (100 - 10000 / (prot + 100)) + "% + " + protdice1 + "d" + protdice2
			pos wx + 625 - en * 8, wy + 279 + p(2) * 16
			if (evade >= 10000000 & cfg_NC_stateshorten) {
				mes "" + evade / 1000000 + "M%"
			} elseif (evade >= 10000 & cfg_NC_stateshorten) {
				mes "" + evade / 1000 + "K%"
			} else {
				mes "" + evade + "%"
			}
			p(2)++
			s = "" + gPlayTurns + "" + lang("ターン", " Turns"), "" + gPlayDays + "" + lang("日", " Days"), "" + gKillCount, "" + cnvplaytime(gPlayTime + timeGetTime() / 1000 - time_begin), "", ""
			repeat 5
				pos wx + 80, wy + 299 + cnt * 15
				mes s(cnt)
			loop
			if (godcheck() == "serria") {
				s = "" + cnvweight(gCargoWeight), cnvweight(gCurrentCartLimit * 3), cnvweight(cSumOfEquipmentWeight(cc)) + " " + cnveqweight(cc), cnvrank(gDeepestDungeonLevel) + lang("階相当", " Level")
			} else {
				s = "" + cnvweight(gCargoWeight), cnvweight(gCurrentCartLimit), cnvweight(cSumOfEquipmentWeight(cc)) + " " + cnveqweight(cc), cnvrank(gDeepestDungeonLevel) + lang("階相当", " Level")
			}
			repeat 4
				pos wx + 287 + en * 14, wy + 299 + cnt * 15
				mes s(cnt)
			loop
			cs_buffmax = 0
			repeat 8 + 8 - 1
				x = wx + 430 + cnt / 3 * 40
				y = wy + 151 + cnt \ 3 * 32
				if (ocdata(192 + cnt * 3, cc) == 0) {
					gmode 4, , , 120
					pos x, y
					gcopy 3, 320, 160, 32, 32
					gmode 2
					continue
				}
				cs_buffmax++
				pos x, y
				gcopy 5, ocdata(192 + cnt * 3, cc) \ 50 * 32, buffy(ocdata(192 + cnt * 3, cc)), 32, 32
				if (cs_buff == cnt) {
					pos x, y
					gfini 32, 32
					gfinc 20, 20, 50
				}
			loop
			if (cs_buffmax != 0) {
				calcbuff -2, ocdata(192 + cs_buff * 3, cc), ocdata(192 + cs_buff * 3 + 1, cc)
				s = "" + buffname(ocdata(192 + cs_buff * 3, cc)) + ": " + ocdata(192 + cs_buff * 3 + 2, cc) + lang("(" + dur + ")ﾀｰﾝの間、", "(" + dur + ") ") + buffdesc
			} else {
				s = lang("今は持続効果を受けていない", "This character isn't currently blessed or hexed.")
			}
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos wx + 108, wy + 366
			mes s
			font lang(cfg_font1, cfg_font2), 11 + sizefix * 2 - en * 2, 1
			color 20, 10, 0
			pos wx + 70, wy + 369 - en * 3
			mes lang("説明:", "Hint:")
		} else {
			gosub *label_N310
		}
	} else {
		display_topic lang("能力の名称", "Name"), wx + 28, wy + 36
		display_topic lang("Lv(潜在)", "Lv(Potential)"), wx + 182, wy + 36
		display_topic lang("効果", "Detail"), wx + 320, wy + 36
		keyrange = 0
		p(1) = 0
		repeat pagesize
			p = pagesize * (page - 1) + cnt
			if (p >= listmax) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange++
			if (list(0, p) < 0) {
				p(1) = 1
				continue
			}
			p(1)++
			if (list(0, p) < 100) {
				x = 52
				dx = 18
			} else {
				x = 70
				dx = 0
			}
			if (p(1) \ 2 == 0) {
				pos wx + x, wy + 66 + cnt * 19
				gfini 595 + dx, 18
				gfdec2 12, 14, 16
			}
			if (list(0, p) < 100) {
				continue
			}
			display_key wx + 58, wy + 64 + cnt * 19, cnt
		loop
	}
	if (page > 0) {
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		cs_listbk
		repeat pagesize
			p = pagesize * (page - 1) + cnt
			if (p >= listmax) {
				break
			}
			if (list(0, p) >= 0) {
				i = list(0, p)
				if (i < 100) {
					x = 54
					p(1) = 10
				} else {
					x = 84
					p(1) = sdataref(0, i) - 10
				}
				pos wx + 38, wy + 75 + cnt * 19
				gmode 2, inf_tiles, inf_tiles
				grotate 1, p(1) * inf_tiles, 672, 0, inf_tiles, inf_tiles
				s = skillnameref(i, cc)
				s = strmid(s, 0, 14)
				if (i >= 50 & i < 100) {
					s = lang("", "Resist ") + cnven(s) + lang("耐性", "")
				}
				if (cfg_strackex != 0) {
					repeat 20
						if (gdatac(750 + cnt) == cc * 10000 + i) {
							s = "*" + s
						}
					loop
				} else {
					repeat 3
						if (gdata(750 + cnt) == cc * 10000 + i) {
							s = "*" + s
						}
					loop
				}
				cs_list s, wx + x, wy + 66 + cnt * 19 - 1, 19
				if (list(0, p) >= 50 & list(0, p) < 100) {
					p(1) = limit(sdata(list(0, p), cc) / 50, 0, 6)
					s = _resist(p(1))
					if (gWizard | godcheck(0) == "mayumaka") {
						s = "" + sdata(list(0, p), cc)
					}
				} else {
					if (list(0, p) >= 550 & list(0, p) < 600) {
						s = str(userspelldata(12, list(0, p) - 550))
						s = strmid(s, -1, 6)
						s = str(userspelldata(12, i - 550) / 1000000) + "." + strmid(s, 0, 3)
						s += "(" + str(userspelldata(12, i - 550) \ 1000) + "%)"
					} else {
						s = str(sdata(list(0, p) + 600, cc))
						s = strmid(s, -1, 6)
						s = "" + sorgEx(i, cc) + "." + strmid(s, 0, 3)
						if (sorgEx(i, cc) != sdata(i, cc)) {
							p(1) = sdata(i, cc) - sorgEx(i, cc)
							if (gWizard | godcheck(0) == "mayumaka") {
								if (p(1) > 0) {
									s += "+" + p(1)
								} else {
									s += p(1)
								}
							}
						}
						s += "(" + sgrowth(i, cc) + "%)"
					}
				}
				pos wx + 280 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
				mes s
				pos wx + 330, wy + 66 + cnt * 19 + 2
				if (list(0, p) >= 550 & list(0, p) < 600) {
					if (userspelldata(0, list(0, p) - 550) < 0) {
						s = "封印済み"
					} else {
						s = skilldescref(i, cc)
					}
				} else {
					s = skilldescref(i, cc)
				}
				mes s
				if (csctrl == 2 | csctrl == 3) {
					if (csctrl == 2) {
						s = "" + calctraincost(i, cc) + "p "
					} else {
						s = "" + calclearncost(i, cc) + "p "
					}
					pos wx + 322 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
					mes s
				} else {
					if (sorgEx(i, cc) != sdata(i, cc)) {
						i = sdata(i, cc) - sorgEx(i, cc)
						if (list(0, p) >= 50) {
							i = i / 50
						} else {
							i = i / 5
						}
						s = ""
						putenclv i
						pos wx + 282, wy + 66 + cnt * 19 + 2
						mes s
					}
				}
			} else {
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
				cs_list listn(0, p), wx + 88, wy + 66 + cnt * 19, 19
				font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			}
		loop
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (page == 0) {
		if (key == "p") {
			if (cc < 16) {
				gosub *label_1258
				if (mode != 1) {
					nowindowanime = 1
				}
				returnfromportrait = 1
				goto *label_1251
			}
		}
		if (key == key_north) {
			cs_buff--
			if (cs_buff < 0) {
				cs_buff = cs_buffmax - 1
			}
			goto *label_1253
		}
		if (key == key_south) {
			cs_buff++
			if (cs_buff >= cs_buffmax) {
				cs_buff = 0
			}
			goto *label_1253
		}
	} else {
		if (csctrl != 1) {
			if (key == key_mode2) {
				repeat keyrange
					i = list(0, pagesize * (page - 1) + cs)
					break
				loop
				if (i != (-1)) {
					if (cfg_strackex != 0) {
						p = 750
						repeat 20, 750
							if (gdatac(cnt) \ 10000 == 0) {
								p = cnt
							}
							if (gdatac(cnt) == cc * 10000 + i) {
								p = cnt
								i = 0
								break
							}
						loop
						gdatac(p) = cc * 10000 + i
						sortskilltrack
						snd 20
					} else {
						p = 750
						repeat 3, 750
							if (gdata(cnt) \ 10000 == 0) {
								p = cnt
							}
							if (gdata(cnt) == cc * 10000 + i) {
								p = cnt
								i = 0
								break
							}
						loop
						gdata(p) = cc * 10000 + i
						snd 20
					}
				}
			}
		}
	}
	if (csctrl == 1) {
		if (key == key_enter) {
			snd 103
			return 0
		}
		if (key == key_cancel) {
			return 1
		}
		goto *label_1255
	}
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * (page - 1) + cnt)
			break
		}
	loop
	if (p != (-1)) {
		csskill = p
		if (csctrl == 2 | csctrl == 3) {
			screenupdate = -1
			gosub *label_0623
			tc = tcbk
			return
		}
		if (csskill >= 400 & csskill < 467 & gWizard == 0 & godcheck(0) == "mayumaka") {
			goto *label_1253
		}
		if (cSkillBonus(cc) < 1 | p < 0 | p < 100) {
			goto *label_1253
		}
		if (sorg(csskill, cc) == 0) {
			snd 27
			goto *label_1253
		}
		getkey p, 17
		if (p) {
			txt -1, lang("ポイントを全て振る？", "Create the same again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 240, 1
			gosub *label_1353
			if (rtval == 0) {
				repeat
					cSkillBonus(cc)--
					skillexp2 csskill, cc, 400, 2, 1000
					p(40) = 15 * (100 + calctraitgrowthrate(cc, csskill)) / 100
					modgrowth cc, csskill, limit(p(40) - sgrowth(csskill, cc) / 15, 2, p(40))
					if (cSkillBonus(cc) == 0) {
						break
					}
				loop
				snd 19
				goto *label_1253
			}
			goto *label_1253
		}
		if (csskill != bpCounter / 10000) {
			bpCounter = csskill * 10000 // Reset BP counter.
		} else {
			if (bpCounter \ 10000 < 9999) {
				bpCounter++ // Increment BP counter.
			}
		}
		NC_intb_ndf = 1
		repeat (bpCounter \ 10000 + 1) / 10 + 1
			cSkillBonus(cc)--
			snd 19
			if (cc != 0 & cc <= 15 & ncgdata(100) > 0) {
				skillmod csskill, cc, 1000
				ncgdata(100)--
			} else {
				skillexp2 csskill, cc, 400, 2, 1000
			}
			p(40) = 15 * (100 + calctraitgrowthrate(cc, csskill)) / 100
			modgrowth cc, csskill, limit(p(40) - sgrowth(csskill, cc) / 15, 2, p(40))
			if (cSkillBonus(cc) == 0) {
				break
			}
		loop
		NC_intb_ndf = 0
		redraw 0
		gosub *label_0625
		goto *label_1253
	}
	if (key == key_pageup) {
		bpCounter = 0 // Reset BP counter.
		page++
		snd 1
		goto *label_1253
	}
	if (key == key_pagedown) {
		bpCounter = 0 // Reset BP counter.
		page--
		snd 1
		goto *label_1253
	}
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			bpCounter = 0 // Reset BP counter.
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 3) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 3
				}
			}
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					csctrl = 0
					goto *label_1251
				}
				if (curmenu == 1) {
					goto *label_1269
				}
				if (curmenu == 2) {
					goto *label_1167
				}
				if (curmenu == 3) {
					goto *label_1060
				}
			}
		}
	}
	if (key == key_cancel) {
		bpCounter = 0 // Reset BP counter.
		menucycle = 0
		if (csctrl == 0) {
			gosub *label_0623
			goto *label_1623
		} else {
			screenupdate = -1
			gosub *label_0623
			tc = tcbk
			return
		}
	}
*label_1255
	goto *label_1254
*label_1256
*label_1257
	rtval = -2
	if (page == 0) {
		if (val == 0) {
			rtval = -2
		}
		if (val == 1) {
			rtval = 100, 0, cPortrait(cc)
		}
		if (val == 2) {
			rtval = 1, 0, pcc(1, cc) \ 1000
			rtvaln = "hair"
		}
		if (val == 3) {
			rtval = 10, 0, pcc(10, cc) \ 1000
			rtvaln = "subhair"
		}
		if (val == 4) {
			rtval = 1, 1, pcc(1, cc) / 1000
		}
		if (val == 5) {
			rtval = 15, 0, pcc(15, cc) \ 1000
			rtvaln = "body"
		}
		if (val == 6) {
			rtval = 9, 0, pcc(9, cc) \ 1000
			rtvaln = "cloth"
		}
		if (val == 7) {
			rtval = 7, 0, pcc(7, cc) \ 1000
			rtvaln = "pants"
		}
		if (val == 8) {
			rtval = -1
			rtvaln = ""
		}
		if (val == 9) {
			if (cc != 0) {
				rtval = 101, 0, cbit(967, cc)
			} else {
				rtval = 16, 0, pcc(16, cc) \ 1000
				rtvaln = "ride"
			}
		}
		if (val == 10) {
			if (cImage(cc) \ 1000 >= 825) {
				rtval = 102, 0, 0
			} else {
				if (cImage(cc) \ 1000 > 660) {
					rtval = 102, 0, cImage(cc) \ 660
				} else {
					rtval = 102, 0, 0
				}
			}
		}
		if (val == 11) {
			rtval = 16, 0, pcc(16, cc) \ 1000
			rtvaln = "ride"
		}
	} else {
		if (val == 0) {
			rtval = 15, 1, pcc(15, cc) / 1000
		}
		if (val == 1) {
			rtval = 9, 1, pcc(9, cc) / 1000
		}
		if (val == 2) {
			rtval = 7, 1, pcc(7, cc) / 1000
		}
		if (val == 3) {
			rtval = 11, 0, pcc(11, cc) \ 1000
			rtvaln = "etc"
		}
		if (val == 4) {
			rtval = 12, 0, pcc(12, cc) \ 1000
			rtvaln = "etc"
		}
		if (val == 5) {
			rtval = 13, 0, pcc(13, cc) \ 1000
			rtvaln = "etc"
		}
		if (val == 6) {
			rtval = 14, 0, pcc(14, cc) \ 1000
			rtvaln = "eye"
		}
		if (val == 7) {
			rtval = -1
			rtvaln = ""
		}
	}
	return
*label_1258
	create_pcpic cc, 0
	page = 0
	pagesize = 19
	cs = 0
	cs_bk = -1
	ww = 380
	wh = 340
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	snd 97
	windowanime wx, wy, ww, wh, 10, 7
	gsel 4
	pos 0, 0
	exist exedir + "user\\graphic\\user_face1.bmp"
	if (strsize != (-1) & cfg_userface1) {
		picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
		ex_userface = 1
	} else {
		picload_ exedir + "graphic\\face1.bmp", 1
		ex_userface = 0
	}
	buffer 7, 1440, 1080
	color 0, 0, 0
	boxf
	repeat 128
		s = exedir + "user\\graphic\\face" + (cnt + 1) + ".bmp"
		exist s
		if (strsize != (-1)) {
			pos cnt \ 16 * 80, cnt / 16 * 112
			picload_ s, 1
		}
	loop
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_mirror.bmp", 1
	gsel 0
	windowshadow = 1
	if (cc != 0) {
		if (cId(cc) != 343) {
			if (cImage(cc) \ 1000 <= 660) {
				cCnpcId(cc) = cImage(cc)
			}
		}
	}
*label_1259
	listmax = 0
	if (page == 0) {
		if (jp) {
			s = "決定    ", "肖像　　", "髪　　　", "副髪　　", "髪の色　", "体　　　", "服　　　", "ﾊﾟﾝﾂ　　", "詳細設定"
		}
		if (en) {
			s = "Done    ", "Portrait", "Hair    ", "Sub Hair", "Hair CL ", "Body    ", "Cloth   ", "Pants   ", "Set Detail"
		}
		if (cc != 0) {
			s(9) = lang("ｶｽﾀﾑｷｬﾗ ", "Custom  ")
			s(10) = lang("ｷｬﾗﾁｯﾌﾟ ", "Chara chip  ")
			s(11) = lang("乗馬時　", "Riding  ")
		} else {
			s(9) = lang("乗馬時　", "Riding  ")
		}
		p = 9 + (cc != 0) * 2
		if (cc == 0) {
			if (gMount != 0) {
				p++
			}
		} else {
			if (ocdata(106, cc) != 0) {
				p++
			}
		}
	} else {
		if (jp) {
			s = "体の色　", "服の色　", "ﾊﾟﾝﾂの色", "ｱｸｾｻﾘ1　", "ｱｸｾｻﾘ2　", "ｱｸｾｻﾘ3　", "目　　　", "基本設定"
		}
		if (en) {
			s = "Body CL ", "Cloth CL", "Pants CL", "Etc1    ", "Etc2    ", "Etc3    ", "Eyes    ", "Set Basic"
		}
		p = 8
	}
	repeat p
		list(0, cnt) = cnt
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop
*label_1260
	if (rtval(1) == 0) {
		dirlist oom_pccn, "graphic\\pcc_" + rtvaln + "*.bmp"
		notesel oom_pccn
		strrep oom_pccn, ".bmp", ""
		dim oom_pcc
		repeat noteinfo(0)
			noteget pcctmp, cnt
			split pcctmp, "_", pcctmp2
			oom_pcc(cnt) = int(pcctmp2(2))
		loop
		sortval oom_pcc, 0
	}
	redraw 0
	pagesize = 0
	s = lang("肖像の変更", "Appearance"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 380) / 2 + inf_screenx, winposy(340) - 12, 380, 374
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	pos wx + ww - 40, wy
	gcopy 3, 960, 96, 48, 120
	i++
	if (i \ 100 < 45) {
		f = i \ 16
	} else {
		f++
	}
	window2 wx + 234, wy + 71, 88, 120, 1, 1
	if (cs == 1 & page == 0) {
		if (cPortrait(cc) >= 0) {
			p = cSex(cc) * 64 + cPortrait(cc)
			pos wx + 238, wy + 75
			exist exedir + "user\\graphic\\user_npcface" + p + ".bmp"
			if (strsize != (-1)) {
				gsel 32
				pos 0, 0
				picload_ exedir + "user\\graphic\\user_npcface" + p + ".bmp", 1
				gsel 0
				pos wx + 238, wy + 75
				gzoom 80, 112, 32, 0, 0, 80, 112
			} else {
				if (ex_userface == 1) {
					gzoom 80, 112, 4, p \ 16 * 80, p / 16 * 112, 80, 112
				} else {
					gzoom 80, 112, 4, p \ 16 * 48, p / 16 * 72, 48, 72
				}
			}
		} else {
			if (cPortrait(cc) != (-1)) {
				pos wx + 238, wy + 75
				gzoom 80, 112, 7, abs(cPortrait(cc) + 2) \ 16 * 80, abs(cPortrait(cc) + 2) / 16 * 112, 80, 112
			} else {
				if (cId(cc) == 343) {
					if (userdata2(0, cCnpcId(cc))) {
						pos wx + 238, wy + 75
						gzoom 80, 112, 100, cCnpcId(cc) \ 16 * 80, cCnpcId(cc) / 16 * 112, 80, 112
					}
				}
			}
		}
	} else {
		if (cbit(967, cc) == 1) {
			pos wx + 280, wy + 130
			gmode 2, 32, 48
			grotate 10 + cc, f / 4 \ 4 * 32, f / 16 \ 4 * 48, 0, 48, 80
		} else {
			transmissivity = 0
			if (cId(cc) == 343) {
				if (userdata2(1, cCnpcId(cc))) {
					transmissivity = userdata2(1, cCnpcId(cc))
				}
			}
			if (ocdata(101, cc)) {
				transmissivity = ocdata(101, cc)
			}
			i = getcharapic(cc)
			chara_preparepic i, getcharacolor(cc)
			pos wx + 280, wy + 130
			gmode 4, chipc(2, i), chipc(3, i), 256 - transmissivity
			color 0, 0, 0
			grotate 5, 0, 960, 0, chipc(2, i), chipc(3, i)
		}
	}
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if (p >= listmax) {
			break
		}
		val = cnt, 0
		gosub *label_1257
		s = listn(0, p)
		if (rtval >= 0) {
			if (rtval(2) >= 0) {
				s += " " + rtval(2)
			} else {
				if (rtval(2) == (-1)) {
					s += " N/A"
				} else {
					s += " u" + (abs(rtval(2)) - 1)
				}
			}
		}
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
		if (rtval != (-2)) {
			pos wx + 30, wy + 66 + cnt * 21 - 5
			gcopy 3, 312, 336, 24, 24
			pos wx + 175, wy + 66 + cnt * 21 - 5
			gcopy 3, 336, 336, 24, 24
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	val = cs, 0
	gosub *label_1257
	p = 0
	if (rtval == (-2)) {
		if (key == key_enter) {
			create_pcpic cc, 1
			return 1
		}
		if (key == key_pageup | key == key_pagedown) {
			key = ""
		}
	} else {
		if (key == key_enter) {
			key = key_pageup
		}
	}
	if (rtval == (-1)) {
		if (key == key_pageup | key == key_pagedown) {
			snd 5
			if (page == 0) {
				page = 1
			} else {
				page = 0
				cs = 8
			}
			goto *label_1259
		}
	}
	if (key == key_pageup) {
		snd 5
		if (rtval == 100) {
			if (cPortrait(cc) < 46 - 1) {
				cPortrait(cc)++
			}
			goto *label_1261
		}
		if (rtval == 101) {
			cbitmod 967, cc, 1
			goto *label_1261
		}
		if (rtval == 102) {
			if (cImage(cc) \ 1000 != 824) {
				if (cImage(cc) \ 1000 <= 660 | cImage(cc) \ 1000 >= 825) {
					cImage(cc) = 661
				} else {
					cImage(cc)++
				}
			}
			goto *label_1261
		}
		if (rtval(1) == 0) {
			if (cfg_pcc == 0) {
				exist exedir + "\\graphic\\pcc_" + rtvaln + "_" + (pcc(rtval, cc) \ 1000 + 1) + ".bmp"
				if (strsize != (-1)) {
					pcc(rtval, cc)++
					p = 1
				}
			} else {
				if (cfg_pcc == 1) {
					if (pcc(rtval, cc) \ 1000 < 999) {
						pcc(rtval, cc)++
						p = 1
					}
				}
			}
		} else {
			if (pcc(rtval, cc) / 1000 < 21) {
				pcc(rtval, cc) += 1000
				p = 1
			}
		}
	}
	if (key == key_pagedown) {
		snd 5
		if (rtval == 100) {
			if (cPortrait(cc) > (-129)) {
				cPortrait(cc)--
			}
			goto *label_1261
		}
		if (rtval == 101) {
			cbitmod 967, cc, 0
			goto *label_1261
		}
		if (rtval == 102) {
			if (cImage(cc) \ 1000 > 660 & cImage(cc) \ 1000 < 825) {
				cImage(cc)--
				if (cImage(cc) \ 1000 <= 660) {
					cImage(cc) = (cId(cc) == 343) * 825 + cCnpcId(cc)
				}
			}
			goto *label_1261
		}
		if (rtval(1) == 0) {
			if (cfg_pcc == 0) {
				exist exedir + "\\graphic\\pcc_" + rtvaln + "_" + (pcc(rtval, cc) \ 1000 - 1) + ".bmp"
				if (pcc(rtval, cc) \ 1000 == 1 & rtval != 15 | strsize != (-1)) {
					pcc(rtval, cc)--
					p = 1
				}
			} else {
				if (cfg_pcc == 1) {
					if (pcc(rtval, cc) \ 1000 > 1 * (rtval == 15)) {
						pcc(rtval, cc)--
						p = 1
					}
				}
			}
		} else {
			if (pcc(rtval, cc) / 1000 > 0) {
				pcc(rtval, cc) -= 1000
				p = 1
			}
		}
	}
	if (key == key_southeast | key == key_next) {
		if (rtval > 0 & rtval < 100 & rtval(1) == 0) {
			if (cfg_pcc == 1) {
				snd 5
				repeat 10
					if (pcc(rtval, cc) \ 1000 < 999) {
						pcc(rtval, cc)++
					} else {
						break
					}
				loop
			}
		}
		if (rtval == 102) {
			if (cImage(cc) \ 1000 <= 660 | cImage(cc) \ 1000 >= 825) {
				cImage(cc) = 661
				cImage(cc) += 9
			} else {
				cImage(cc) += 10
			}
			if (cImage(cc) \ 1000 >= 825) {
				cImage(cc) = 824
			}
		}
	}
	if (key == key_southwest | key == key_prev) {
		if (rtval > 0 & rtval < 100 & rtval(1) == 0) {
			if (cfg_pcc == 1) {
				snd 5
				repeat 10
					if (pcc(rtval, cc) \ 1000 > 1 * (rtval == 15)) {
						pcc(rtval, cc)--
					} else {
						break
					}
				loop
			}
		}
		if (rtval == 102) {
			if (cImage(cc) \ 1000 > 660 & cImage(cc) \ 1000 < 825) {
				cImage(cc) -= 10
				if (cImage(cc) \ 1000 <= 660) {
					cImage(cc) = (cId(cc) == 343) * 825 + cCnpcId(cc)
				}
			}
		}
	}
	create_pcpic cc, 0
	if (key == key_cancel) {
		create_pcpic cc, 1
		return 0
	}
	if (mode == 1) {
		getkey p, 112
		if (p) {
			return -1
		}
	}
*label_1261
	goto *label_1260
	repeat -1
		repeat length(oom_pcc)
			if (pcc_count == oom_pcc(cnt)) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + pcc_count
				p = 1
				break
			}
		loop
		if (p == 1 | pcc_count > oom_pcc(length(oom_pcc) - 1)) {
			if (pcc_count > oom_pcc(length(oom_pcc) - 1)) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + oom_pcc(length(oom_pcc) - 1)
			}
			break
		}
		pcc_count++
	loop
	return
	repeat -1
		repeat length(oom_pcc)
			if (pcc_count == oom_pcc(cnt)) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + pcc_count
				p = 1
				break
			}
		loop
		if (p == 1 | pcc_count < oom_pcc(0)) {
			if (pcc_count < oom_pcc(0)) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + 1 * (rtval == 15)
			}
			break
		}
		pcc_count--
	loop
	return
*label_1262
*label_1263
	create_pcpic cc, 1
	snd 26
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	windowshadow = 1
	listmax = 0
	if (jp) {
		s = "決定    ", "胸部鎧　", "脚部鎧　", "ベルト　", "ｸﾞﾛｰﾌﾞ　", "マント　"
	}
	if (en) {
		s = "Done    ", "Chest   ", "Leg     ", "Belt    ", "Glove   ", "Mantle  "
	}
	p = 6
	repeat p
		list(0, cnt) = cnt
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop
*label_1264
	redraw 0
	pagesize = 0
	s = lang("装備表示の変更", "Parts to hide"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 360) / 2 + inf_screenx, winposy(289) - 12, 360, 289
	s = lang("項目", "Part")
	pagesize = listmax
	display_topic s, wx + 34, wy + 36
	i++
	if (i \ 100 < 45) {
		f = i \ 16
	} else {
		f++
	}
	window2 wx + 234, wy + 60, 88, 120, 1, 1
	pos wx + 280, wy + 120
	gmode 2, 32, 48
	grotate 10 + cc, f / 4 \ 4 * 32, f / 16 \ 4 * 48, 0, 48, 80
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if (p >= listmax) {
			break
		}
		s = listn(0, p)
		if (cnt != 0) {
			if (pcc(20 + cnt - 1, cc) == 0) {
				s += "On"
			} else {
				s += "Off"
			}
			pos wx + 30, wy + 66 + cnt * 21 - 5
			gcopy 3, 312, 336, 24, 24
			pos wx + 175, wy + 66 + cnt * 21 - 5
			gcopy 3, 336, 336, 24, 24
		}
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (cs != 0) {
		if (key == key_enter) {
			key = key_pageup
		}
		if (key == key_pageup | key == key_pagedown) {
			if (pcc(20 + cs - 1, cc) == 0) {
				pcc(20 + cs - 1, cc) = 1
			} else {
				pcc(20 + cs - 1, cc) = 0
			}
			create_pcpic cc, 1
			snd 5
		}
	}
	if (cs == 0 & key == key_enter | key == key_cancel) {
		snd 20
		create_pcpic cc, 1
		return 1
	}
	goto *label_1264
*label_1265
*label_1266
	maxdmg = 0
	maxhit = 0
	p(1) = 0, 0
	attackskill = 106
	ammo = -1
	attacknum = 0
	cw = 0
	repeat 30
		body = 100 + cnt
		if (cdata(body, cc) \ 10000 == 0) {
			continue
		}
		if (cdata(body, cc) / 10000 == 10) {
			continue
		}
		if (cdata(body, cc) / 10000 == 11) {
			continue
		}
		attackrange = 0
		ammo = -1
		cw = cdata(body, cc) \ 10000 - 1
		if (iDiceX(cw) > 0) {
				if (iequiploc(cw) == 10) {
					gosub *label_1814
					gosub *label_1300
				} else {
					attackskill = iSkill(cw)
				}
				p(1)++
				if (cfg_NC_charasheet) {
					s(1) = lang("利武器", "Melee")
				} else {
					s(1) = lang("武器", "Melee") + p(1)
				}
			attacknum++
			if (cfg_NC_charasheet == 0 | p(1) == 1) {
				gosub *label_1267
			} else {
				hit = calcattackhit(1)
				dmg = calcattackdmg(1)
			}
			if (iequiploc(cw) != 10) {
				maxdmg += (dmgmulti * (dice1 * dice2 + dmgfix))
			}
	}
	loop
	if (attackskill == 106) {
		s(1) = lang("格闘", "Unarmed")
		gosub *label_1267
		maxdmg += (dmgmulti * (dice1 * dice2 + dmgfix))
	}
	attacknum = 0
	gosub *label_1299
	if (stat == 1) {
		s(1) = lang("射撃", "Dist")
		gosub *label_1267
	}
	if (cfg_NC_charasheet == 1) {
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
		color 20, 10, 0
		pos wx + 417, wy + 301 + (p(2) + 1) * 15
		mes lang("最大", "Max")
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 460 + en * 8, wy + 299 + (p(2) + 1) * 15
		s = "" + maxdmg + " dmg"
		mes s
	}
	return
*label_1267
	tc = cc
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	color 20, 10, 0
	if (val == 0) {
		if (cfg_NC_charasheet) {
			pos wx + 590, wy + 301 + p(2) * 15
			mes lang("命中", "Hit")
			pos wx + 417, wy + 301 + p(2) * 15
			mes s(1)
		} else {
			pos wx + 590, wy + 281 + p(2) * 16
			mes lang("命中", "Hit")
			pos wx + 417, wy + 281 + p(2) * 16
			mes s(1)
		}
	}
	attackrange = 0
	if (refitem(iId(cw), 5, cw) == 24000) {
		attackrange = 1
	}
	attackvar = 0
	hit = calcattackhit(1)
	dmg = calcattackdmg(1)
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	if (dmgmulti >= 10000000 & cfg_NC_stateshorten) {
		s(2) = "" + (dmgmulti / 1000000) + "M"
	} elseif (dmgmulti >= 10000 & cfg_NC_stateshorten) {
		s(2) = "" + (dmgmulti / 1000) + "K"
	} else {
		s(2) = "" + dmgmulti + "  "
	}
	if (tohit >= 10000000 & cfg_NC_stateshorten) {
		s = "" + (tohit / 1000000) + "M%"
	} elseif (tohit >= 10000 & cfg_NC_stateshorten) {
		s = "" + (tohit / 1000) + "K%"
	} else {
		s = "" + tohit + "%"
	}
	if (val == 0) {
		if (cfg_NC_charasheet) {
			pos wx + 625 - en * 8, wy + 299 + p(2) * 15
			mes s
		} else {
			pos wx + 625 - en * 8, wy + 279 + p(2) * 16
			mes s
		}
	} else {
		s(3) = s
	}
	s = "" + dice1 + "d" + dice2 + cnvfix(dmgfix) + " x" + strmid(s(2), 0, 4 + (int(s(2)) >= 10) + (int(s(2)) >= 100) + (int(s(2)) >= 1000) + (int(s(2)) >= 10000)) + strmid(s(2), -1, 1)
	if (val == 0) {
		if (cfg_NC_charasheet) {
			pos wx + 460 + en * 8, wy + 299 + p(2) * 15
			mes s
		} else {
			pos wx + 460 + en * 8, wy + 279 + p(2) * 16
			mes s
		}
	} else {
		noteadd s(1) + "   : " + fixtxt(s(3), 12) + " " + fixtxt(s, 20)
	}
	p(2)++
	return
*label_1268
	attacknum = 0
	repeat 30
		body = 100 + cnt
		if (cdata(body, cc) / 10000 != 5) {
			continue
		}
		if (cdata(body, cc) \ 10000 == 0) {
			continue
		}
		cw = cdata(body, cc) \ 10000 - 1
		if (iDiceX(cw) == 0) {
			continue
		}
		attacknum++
		if (iequiploc(cw) == 10) {
			continue
		}
		if (cEquipmentType(cc) & 2) {
			if (iWeight(cw) >= 4000) {
				txt -1, lang("装備中の" + itemname(cw) + "は両手にしっくりとおさまる。", itemname(cw) + " fits well for two-hand fighting style.")
			} else {
				if (gettrait(cc, 68) > 0) {
					if (iWeight(cw) <= 1500) {
						txt -1, lang("装備中の" + itemname(cw) + "は体術と併用するのに適している。", itemname(cw) + " is too light for two-hand fighting style.")
					} else {
						txt -1, lang("装備中の" + itemname(cw) + "は体術と併用するには重すぎる。", itemname(cw) + " is too light for two-hand fighting style.")
					}
				} else {
					txt -1, lang("装備中の" + itemname(cw) + "は両手持ちにはやや軽すぎる。", itemname(cw) + " is too light for two-hand fighting style.")
				}
			}
		}
		if (cEquipmentType(cc) & 4) {
			if (attacknum == 1) {
				if (iWeight(cw) >= 4000) {
					txt -1, lang("装備中の" + itemname(cw) + "は利手で扱うにも重すぎる。", itemname(cw) + " is too heavy for two-wield fighting style.")
				}
			} else {
				if (iWeight(cw) > 1500 + gettrait(cc, 19) * 500) {
					txt -1, lang("装備中の" + itemname(cw) + "は片手で扱うには重すぎる。", itemname(cw) + " is too heavy for two-wield fighting style.")
				}
			}
		}
	loop
	if (cc == 0) {
		if (gMount != 0) {
			if (iWeight(cw) >= 4000) {
				txt -1, lang("装備中の" + itemname(cw) + "は乗馬中に扱うには重過ぎる。", itemname(cw) + " is too heavy to use when riding.")
			}
		}
	}
	return
*label_1269
	cc = 0
*label_1270
	oomSEST_log "com_wear"
	page = 0
	pagesize = 14
	listmax = 0
	cs = 0
	cs_bk = -1
	page_load
	page_load2
	curmenu = 1
	mainhand = 0
	repeat 30, 100
		if (cdata(cnt, cc) != 0) {
			if (cc == 0) {
				if (gettrait(0, 206) != 0) {
					if (cdata(cnt, cc) / 10000 == 2) {
						continue
					}
				}
				if (gettrait(0, 203) != 0) {
					if (cdata(cnt, cc) / 10000 == 9) {
						continue
					}
				}
				if (gettrait(0, 205) != 0) {
					if (cdata(cnt, cc) / 10000 == 3) {
						continue
					}
				}
				if (gettrait(0, 217) != 0) {
					if (cdata(cnt, cc) / 10000 == 1) {
						continue
					}
					if (gettrait(0, 217) == (-2)) {
						if (cdata(cnt, cc) / 10000 == 8) {
							continue
						}
					}
				}
				if (gettrait(0, 218) != 0) {
					if (cdata(cnt, cc) / 10000 == 5) {
						continue
					}
				}
			}
			if (mainhand == 0) {
				if (cdata(cnt, cc) / 10000 == 5) {
					mainhand = cnt
				}
			}
			list(0, listmax) = cnt, cdata(cnt, cc) / 10000
			listmax++
		}
	loop
	gosub *label_1276
	redraw 0
	drawmenu
	ww = 690
	wh = 380
	wx = (windoww - 690) / 2 + inf_screenx
	wy = winposy(380)
	if (nowindowanime == 0) {
		snd 95
	}
	windowanime wx, wy, ww, wh, 10, 4
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_wear.bmp", 1
	gsel 0
	windowshadow = 1
*label_1271
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1272
	redraw 0
	s = lang("装備品", "Equipment")
	s(1) = strhint5 + strhint5b + strhint3
	s(1) += "\n" + oom_strhint7 + oom_strhint5 + oom_strhint6
	if (cc != 0) {
		s = lang(name(cc) + "の" + s, s + " of " + name(cc))
	}
	display_window (windoww - 690) / 2 + inf_screenx, winposy(428), 690, 428, 64
	display_topic lang("部位/装備品名称", "Category/Name"), wx + 28, wy + 30
	if (showresist == 0) {
		display_topic lang("重さ", "Weight"), wx + 524, wy + 30
	}
	pos wx + 46, wy - 16
	gcopy 3, 288 + 10 * 48, 48, 48, 48
	pos wx + ww - 106, wy
	gcopy 3, 960, 96, 96, 120
	pos wx, wy + wh - 164
	gcopy 3, 960, 216, 72, 144
	if (showresist) {
		if (cfg_equipex == 1) {
			if (equipfilter >= 0 & showressub == 2) {
				showressub = 0
			}
			pos wx + 260 + (showressub == 0) * 60, wy + 40
			if (showressub == 0) {
				color 0, 0, 0
				repeat length(_resiststr0)
					pos wx + 320 + cnt * 20, wy + 40
					mes _resiststr0(cnt)
				loop
			}
			if (showressub == 1) {
				color 0, 0, 0
				repeat length(_resiststr1)
					pos wx + 260 + cnt * 20, wy + 40
					mes _resiststr1(cnt)
				loop
			}
			if (showressub == 2) {
				color 0, 0, 0
				mes ""
			}
			if (showressub == 3) {
				color 0, 0, 0
				pos wx + 260, wy + 40
				mes lang("熱", "Fi")
				pos wx + 280, wy + 40
				mes lang("酸", "Ac")
				pos wx + 300, wy + 40
				mes lang("浮", "Fl")
				pos wx + 320, wy + 40
				mes lang("寄", "Pa")
				pos wx + 340, wy + 40
				mes lang("腐", "Ro")
				pos wx + 360, wy + 40
				mes lang("電", "Ra")
			}
		} else {
			pos wx + 320, wy + 40
			color 0, 0, 0
			mes lang("火 冷 雷 闇 幻 毒 獄 音 神 沌 魔", "Fi Co Li Da Mi Po Nt So Nr Ch Ma")
		}
	}
	display_note lang("装備重量: ", "Equip weight: ") + cnvweight(cSumOfEquipmentWeight(cc)) + cnveqweight(cc) + lang(" 命中修正:", " Hit Bonus:") + cHitBonus(cc) + lang(" ダメージ修正:", " Damage Bonus:") + cDamageBonus(cc) + "  DV/PV:" + cDv(cc) + "/" + cPv(cc)
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	gmode 2
	keyrange = 0
	f = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 100, wy + 60 + cnt * 19
			gfini 558, 18
			gfdec 12, 14, 16
		}
		q = bodyn(list(1, p))
		if (list(0, p) == mainhand) {
			q = lang("利手", "Hand*")
		}
		pos wx + 22, wy + 60 + cnt * 19 - 4
		gcopy 3, 600 + (list(1, p) - 1) * 24, 336, 24, 24
		pos wx + 46, wy + 60 + cnt * 19 + 3
		mes q
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		display_key wx + 88, wy + 60 + cnt * 19 - 2, cnt
		p(1) = cdata(list(0, p), cc)
		s = "-    ", "-"
		if (p(1) \ 10000 != 0) {
			p(1) = p(1) \ 10000 - 1
			s = itemname(p(1)), cnvweight(iWeight(p(1)))
			if (cfg_useffhp) {
				preparepicitemex p(1)
				p(2) = stat
			} else {
				p(2) = iImage(p(1))
				gsel 1
				color 0
				boxf 0, 960, chipi(2, p(2)), chipi(3, p(2)) + 960
				if (p(2) == 528) {
					gmode 2
					pos 0, 960
					gcopy 1, 0, 768, inf_tiles, inf_tiles
					pos 0, 1008
					gzoom 22, 20, 5, chipc(0, iColor(p(1))) + 8, chipc(1, iColor(p(1))) + 4 + (chipc(3, iColor(p(1))) > inf_tiles) * 8, chipc(2, iColor(p(1))) - 16, chipc(3, iColor(p(1))) - 8 - (chipc(3, iColor(p(1))) > inf_tiles) * 10, 1
					pos 6, 974
					gcopy 1, 0, 1008, 22, 20
					gsel selcur
				} else {
					if (p(2) == 531) {
						pos 8, 1058 - chipc(3, iColor(p(1)))
						gcopy 5, chipc(0, iColor(p(1))) + 8, chipc(1, iColor(p(1))) + 2, chipc(2, iColor(p(1))) - 16, chipc(3, iColor(p(1))) - 8
						gmode 4, , , 150
						color 0, 0, 0
						pos 0, 960 + (chipc(3, iColor(p(1))) == inf_tiles) * 48
						gcopy 1, 144, 768 + (chipc(3, iColor(p(1))) > inf_tiles) * 48, inf_tiles, chipc(3, iColor(p(1))) + (chipc(3, iColor(p(1))) > inf_tiles) * 48
						gmode 2
						gsel selcur
					} else {
						if (p(2) == 529) {
							pos 0, 1056 - chipc(3, iColor(p(1)))
							gcopy 5, chipc(0, iColor(p(1))), chipc(1, iColor(p(1))), chipc(2, iColor(p(1))), chipc(3, iColor(p(1)))
							gmode 2
							gsel selcur
						} else {
							pos 0, 960
							gcopy 1, chipi(0, p(2)), chipi(1, p(2)), chipi(2, p(2)), chipi(3, p(2))
							gfini chipi(2, p(2)), chipi(3, p(2))
							gfdec2 c_col(0, iColor(p(1))), c_col(1, iColor(p(1))), c_col(2, iColor(p(1)))
							gsel selcur
						}
					}
				}
			}
			pos wx + 126, wy + 70 + cnt * 19
			gmode 2, inf_tiles, inf_tiles
			grotate 1, 0, 960, 0, chipi(2, p(2)), chipi(3, p(2))
			if (showresist) {
				if (cfg_equipex == 1) {
					equipinfo p(1), wx + 260 + (showressub == 0) * 60, wy + 60 + cnt * 19 + 2
					s = strmid(s, 0, 10 + (showressub == 0) * 12)
				} else {
					equipinfo p(1), wx + 320, wy + 60 + cnt * 19 + 2
					s = strmid(s, 0, 22)
				}
			}
		} else {
			p(1) = -1
		}
		cs_list s, wx + 140 - 26, wy + 60 + cnt * 19 - 1, 19, 30, p(1) != (-1), p(1)
		pos wx + 640 - strlen(s(1)) * 7, wy + 60 + cnt * 19 + 2
		mes s(1)
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		page_save2
		body = p
		if (cdata(body, cc) \ 10000 != 0) {
			gdata(808) = 1
			ci = cdata(body, cc) \ 10000 - 1
			if (iCurseState(ci) == (-1) | iCurseState(ci) == (-2)) {
				txt -1, lang(itemname(ci) + "は外せない。", "" + itemname(ci) + " can't be taken off.")
				goto *label_1271
			}
			r1 = cc
			gosub *label_1419
			r1 = cc
			gosub *chara_refresh
			snd 13
			txtnew
			txt -1, lang(itemname(ci) + "を外した。", "You unequip " + itemname(ci) + ".")
			if (cdata(body, cc) / 10000 == 5) {
				gosub *label_1268
			}
			redraw 0
			gosub *label_0625
			goto *label_1271
		}
		nowindowanime = 1
		menucycle = 0
		if (cc == 0) {
			invctrl = 6, 0
		} else {
			invctrl = 6, 1
		}
		snd 100
		goto *label_1281
	}
	if (key == key_identify) {
		p = list(0, pagesize * page + cs)
		if (cdata(p, cc) \ 10000 != 0) {
			ci = cdata(p, cc) \ 10000 - 1
			listmax_bk = listmax
			pagesize_bk = pagesize
			pagemax_bk = pagemax
			listnumber = pagesize * page + cs
			fromequip = 1
			gosub *label_1290
			nowindowanime = 1
			returnfromidentify = 0
			screenupdate = -1
			gosub *label_0623
			goto *label_1270
		}
	}
	if (key == key_mode) {
		if (showresist == 1) {
			showresist = 0
		} else {
			showresist = 1
		}
		snd 1
		goto *label_1271
	}
	if (cfg_equipex == 1) {
		if (showresist == 1) {
			if (key == key_msglog) {
				showressub++
				if (equipfilter < 0) {
					if (showressub > 3) {
						showressub = 0
					}
				} else {
					if (showressub > 3) {
						showressub = 0
					}
					if (showressub > 1) {
						showressub = 3
					}
				}
				snd 1
				goto *label_1271
			}
		}
	}
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 3) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 3
				}
			}
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					csctrl = 0
					goto *label_1251
				}
				if (curmenu == 1) {
					goto *label_1270
				}
				if (curmenu == 2) {
					goto *label_1167
				}
				if (curmenu == 3) {
					goto *label_1060
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1271
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1271
		}
	}
	if (showresist == 0 & cc == 0) {
		if (key == key_mode2) {
			invctrl = 101
			gosub *label_2029
			menucycle = 0
			screenupdate = -1
			gosub *label_0623
			goto *label_1269
		}
		if (key == key_msglog) {
			invctrl = 102
			gosub *label_2029
			menucycle = 0
			create_pcpic cc, 1
			screenupdate = -1
			gosub *label_0623
			goto *label_1269
		}
		if (key == key_drink) {
			auto_equip = 1
			gosub *label_2023
			auto_equip = 0
			value = stat
			if (value > 0) {
				var_skill = value \ 10000
				cc = 0
				gosub *label_2032
				listmax = 0
				inv_getheader 0
				repeat invrange, invhead
					if (iNumber(cnt) == 0) {
						continue
					}
					if (iequiploc(cnt) == 0) {
						continue
					}
					if (iCurseState(cnt) < 0) {
						continue
					}
					if (iIdentificationState(cnt) < 3) {
						continue
					}
					value = cnt
					f = 0
					repeat 15
						enc_id = iEnchantmentId(value, cnt) / 10000
						if (enc_id != 3) {
							continue
						}
						enc_id = iEnchantmentId(value, cnt) \ 10000
						enc_pow = iEnchantmentPower(value, cnt)
						if (enc_id == var_skill & enc_pow / 50 + 1 > 0) {
							f = 1
							break
						}
					loop
					if (f) {
						list(0, listmax) = cnt
						listmax++
					}
				loop
				repeat 30
					if (cdata(129 - cnt, cc) == 0) {
						continue
					}
					if (gettrait(cc, 206) != 0) {
						if (cdata(129 - cnt, cc) / 10000 == 2) {
							continue
						}
					}
					if (gettrait(cc, 203) != 0) {
						if (cdata(129 - cnt, cc) / 10000 == 9) {
							continue
						}
					}
					if (gettrait(cc, 205) != 0) {
						if (cdata(129 - cnt, cc) / 10000 == 3) {
							continue
						}
					}
					if (gettrait(cc, 217) != 0) {
						if (cdata(129 - cnt, cc) / 10000 == 1) {
							continue
						}
					}
					if (gettrait(cc, 217) == (-2)) {
						if (cdata(129 - cnt, cc) / 10000 == 8) {
							continue
						}
					}
					if (gettrait(cc, 218) != 0) {
						if (cdata(129 - cnt, cc) / 10000 == 5) {
							continue
						}
					}
					if (cdata(129 - cnt, cc) \ 10000 != 0) {
						continue
					}
					body = cdata(129 - cnt, cc) / 10000
					now_inv = -1
					now_pow = 0
					repeat listmax
						p = list(0, cnt)
						if (funciscanequip(p, body) == 0) {
							continue
						}
						if (iBodyPart(p) != 0) {
							continue
						}
						value = p
						repeat 15
							enc_id = iEnchantmentId(value, cnt) / 10000
							if (enc_id != 3) {
								continue
							}
							enc_id = iEnchantmentId(value, cnt) \ 10000
							enc_pow = iEnchantmentPower(value, cnt)
							if (enc_id == var_skill & (now_inv == (-1) | enc_pow > now_pow)) {
								now_inv = value
								now_pow = enc_pow
								break
							}
						loop
					loop
					if (now_inv != (-1)) {
						body = 129 - cnt
						r1 = cc
						ci = now_inv
						gosub *label_1418
					}
				loop
				r1 = cc
				snd 13
				gosub *chara_refresh
				gosub *label_1268
				create_pcpic cc, 1
				txtef 0
				txtc = 0
				txt -1, lang("" + skillname(var_skill) + "重視の装備に変更した。", "You changed your equipments to the emphasis on skill of " + skillname(var_skill) + ".")
				tcol@txtfunc = 255, 255, 255
			}
			menucycle = 0
			screenupdate = -1
			gosub *label_0623
			goto *label_1269
		}
		if (key == "sc") {
			slot_no = sc
			gosub *label_2033
			menucycle = 0
			create_pcpic cc, 1
			screenupdate = -1
			gosub *label_0623
			goto *label_1269
		}
	}
	if (key == key_cancel) {
		menucycle = 0
		if (cc < 16) {
			create_pcpic cc, 1
		}
		if (equipfilter != 0) {
			equipfilter = 0
		}
		if (var_is_pet_wear) {
			invctrl = 25
			return
		}
		gosub *label_0623
		cc = 0
		goto *label_1623
	}
	goto *label_1272
*label_1273
*label_1274
	if (map(cX(0), cY(0), 6) != 0) {
		if (gCurrentMap != 35 | 0) {
			cell_itemoncell cX(0), cY(0)
			if (stat == 0) {
				cell_featread cX(0), cY(0)
				if (feat(1) == 29) {
					if (gCurrentMap != 35) {
						if (feat < tile_plant + 2) {
							txt -1, lang("芽を摘み取った。", "You nip a young plant.")
							map(cX(0), cY(0), 6) = 0
							goto *label_1617
						}
						if (feat == tile_plant + 3) {
							txt -1, lang("枯れた草を摘み取った。", "You nip a dead plant.")
							map(cX(0), cY(0), 6) = 0
							goto *label_1617
						}
						if (inv_getspace(0) == 0) {
							txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
							gosub *label_0623
							goto *label_1623
						}
						gosub *label_1461
						if (chipm(0, map(cX(0), cY(0), 0)) == 2) {
							val = 1
						} else {
							val = 0
						}
						gosub *label_1460
						if (feat(2) == 40) {
							autosave = 1 * (gCurrentMap != 35)
							if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
								autosave = 0
							}
						}
						gosub *refreshPCBurdenState
						goto *label_1617
					}
				}
				if (mapType == 1) {
					if (feat(1) == 15) {
						if (feat(2) + feat(3) * 100 >= 300 & feat(2) + feat(3) * 100 < 450) {
							txt -1, lang("本当にこの建物を撤去する？（注意！建物と中の物は完全に失われます）", "Really remove this building?")
							promptl(0, 0) = stryes, "y", "0"
							promptl(0, 1) = strno, "n", "1"
							promptmax = 2
							val = promptx, prompty, 160, 1
							gosub *label_1353
							if (rtval != 0) {
								gosub *label_0623
								goto *label_1623
							}
							area = feat(2) + feat(3) * 100
							if (areaId(area) == 39) {
								if (ogdata(23) != 0) {
									txt -1, lang("ダンジョン内イベント進行中はダンジョンを撤去できない。", "Cannot remove dungeon while dungeon even is in progress.")
									gosub *label_0623
									goto *label_1623
								}
								repeat 26
									ogdata(cnt) = 0
								loop
							}
							map(cX(0), cY(0), 6) = 0
							areaId(area) = 0
							removeworker area
							gosub *label_0950
							ctrlFile 13
							snd 58
							txt -1, lang("建物を撤去した。", "You remove the building.")
							goto *label_1617
						}
					}
				}
			}
		}
	}
	cell_itemoncell cX(0), cY(0)
	if (stat == 0) {
		if (mapType == 3 | mapType == 2) {
			if (chipm(0, map(cX(0), cY(0), 0)) == 4) {
				snd 83
				txt -1, lang("雪をかきあつめた。", "You rake up a handful of snow.")
				actionsp 0, 10
				if (stat == 0) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					goto *label_1617
				}
				flt
				itemcreate 0, 587, -1, -1, 0
				if (stat != 0) {
					iCurseState(ci) = 0
					iIdentificationState(ci) = 3
					item_stack 0, ci, 1
				}
				goto *label_1617
			}
		}
		msgdup++
		txt -1, lang("あなたは空気をつかんだ。", "You grasp at the air.")
		gosub *label_0623
		goto *label_1623
	}
	ci = rtval(1)
	if (rtval > 1) {
		invctrl = 3
		snd 100
		goto *label_1280
	}
	if (iOwnState(ci) > 0 & iOwnState(ci) < 3 | iOwnState(ci) == 5) {
		snd 27
		msgdup++
		if (iOwnState(ci) == 2) {
			txt -1, lang("それは持ち運べない。", "You can't carry it.")
		}
		if (iOwnState(ci) == 1 | iOwnState(ci) == 5) {
			txt -1, lang("それはあなたの物ではない。", "It's not your property."), lang("盗むなんてとんでもない。", "You can't just take it."), lang("それは拾えない。", "It's not yours.")
		}
		gosub *label_0623
		goto *label_1623
	}
	if (iNumber(ci) > 1 & iId(ci) != 54 & cfg_picknumber) {
		display_msg screenmsgy, 2
		val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
		inputlog = "" + iNumber(ci)
		gosub *label_1349
		in = int(inputlog)
		if (in > iNumber(ci)) {
			in = iNumber(ci)
		}
		if (in == 0 | rtval == (-1)) {
			gosub *label_0623
			goto *label_1623
		}
	} else {
		in = iNumber(ci)
	}
	gosub *label_1416
	if (stat == 1 | stat == (-1)) {
		goto *label_1617
	} else {
		gosub *label_0623
		goto *label_1623
	}
*label_1275
	if (cContinuousActionTurn(tc) != 0) {
		txt -1, lang(name(tc) + "は忙しい。", name(tc) + " " + is(tc) + " busy now.")
		gosub *label_0623
		goto *label_1623
	}
	menucycle = 1
	invally = 1
	invctrl = 10
	snd 100
	goto *label_1280
*label_1276
	if (listmax < 1) {
		return
	}
	repeat
		p = 0
		repeat listmax - 1
			if (list(1, cnt) > list(1, cnt + 1)) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				p = 1
			}
		loop
		if (p == 0) {
			repeat listmax
				list_bk(0, cnt) = list(0, cnt)
			loop
			break
		}
	loop
	return
*label_1277
	if (listmax < 1) {
		return
	}
	repeat
		p = 0
		repeat listmax - 1
			if (list(1, cnt) < list(1, cnt + 1)) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				p = 1
			}
		loop
		if (p == 0) {
			repeat listmax
				list_bk(0, cnt) = list(0, cnt)
			loop
			break
		}
	loop
	return
*label_1278
	if (listmax < 1) {
		return
	}
	repeat
		p = 0
		repeat listmax - 1
			if (list(1, cnt) > list(1, cnt + 1)) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				s = listn(0, cnt), listn(1, cnt)
				listn(0, cnt) = listn(0, cnt + 1), listn(1, cnt + 1)
				listn(0, cnt + 1) = s, s(1)
				p = 1
			}
		loop
		if (p == 0) {
			break
		}
	loop
	return

#deffunc savecycle
	if (menucycle == 1) {
		menucycle = 0
		if (invally == 0 & invcontainer == 0) {
			lastctrl = invctrl
		}
	}
	return
*label_1280
	cc = 0
*label_1281
	oomSEST_log "com_inventory" + invctrl + "/" + invctrl(1)
	if (invctrl == 22) {
		if (invctrl(1) == 1) {
			gosub *label_1312
		}
	}
	if (menucycle == 1) {
		if (mapType == 1) {
			p = 0
			repeat 12
				if (cycle(cnt, 1) == (-1)) {
					break
				}
				if (cycle(cnt, 1) == invctrl) {
					p = 1
					break
				}
			loop
			if (p == 0) {
				invctrl = cycle(0, 1)
			}
		}
	}
	invmark(11) = 0
	invmark(12) = 0
	page = 0
	pagesize = 16
	listmax = 0
	cs = invmark(invctrl) \ 1000
	page = invmark(invctrl) / 1000
	cs_bk = -1
	page_load
	mainweapon = -1
	repeat 2
		if (cnt == 0) {
			p = -1
			if (invctrl == 2 | invctrl == 6 | invctrl == 10 | invctrl == 12 | invctrl == 16 | invctrl == 20 | invctrl == 21 | invctrl == 23 | invctrl == 24 | invctrl == 25 | invctrl == 34) {
				continue
			}
		}
		if (cnt == 1) {
			p = cc
			if (invctrl == 20 | invctrl == 25) {
				p = tc
			}
			if (invctrl == 27) {
				p = map(tlocx, tlocy, 1) - 1
				if (p == 0 | p == (-1)) {
					continue
				}
			}
			if (invctrl == 3 | invctrl == 11 | invctrl == 22 | invctrl == 28 | invctrl == 35) {
				break
			}
		}
		inv_getheader p
		if (p == (-1)) {
			repeat invrange, invhead
				if (iId(cnt) == 743) {
					getitemid cnt
				}
				checkalter cnt
			loop
		}
		cnt2 = cnt
		if (invctrl != 1 & invctrl != 5 & invctrl != 13 & invctrl != 14 & invctrl != 18 & invctrl != 20 & invctrl != 23 & invctrl != 25 & invctrl != 27 & invctrl != 30 & invctrl != 31 & invctrl != 32) {
			countequip = 0
		} else {
			countequip = 1
		}
		if (invctrl == 11 | invctrl == 12 | invctrl == 25 | invctrl == 27) {
			showmoney = 1
		} else {
			showmoney = 0
		}
		repeat invrange, invhead
			dup roopbuf, iId(cnt)
			if (iNumber(cnt) <= 0) {
				iNumber(cnt) = 0
				continue
			}
			if (roopbuf == 488) {
				iFunction(cnt) = 9
			}
			if (roopbuf == 504) {
				iFunction(cnt) = 38
			}
			if (roopbuf >= maxitemid - 2 | roopbuf < 0) {
				dialog "Invalid Item Id found. Item No:" + cnt + ", Id:" + roopbuf + " has been removed from your inventory."
				iNumber(cnt) = 0
				iId(cnt) = 0
				continue
			}
			if (cnt2 == 0) {
				if (invctrl == 27) {
					if (iX(cnt) != tlocx | iY(cnt) != tlocy) {
						continue
					}
				} else {
					if (invctrl != 11 & invctrl != 22 & invctrl != 28 & invctrl != 35) {
						if (iX(cnt) != cX(cc) | iY(cnt) != cY(cc)) {
							continue
						}
					}
				}
			}
			item_checkknown cnt
			reftype = refitem(roopbuf, 5, cnt)
			if (iOwnState(cnt) == 5) {
				if (ibit(16, cnt) == 0 | invctrl != 14) {
					if (invctrl != 1) {
						continue
					}
				}
			}
			if (countequip == 0) {
				if (iBodyPart(cnt) != 0) {
					continue
				}
			}
			if (iBodyPart(cnt) != 0) {
				if (mainweapon == (-1)) {
					if (reftype == 10000) {
						mainweapon = cnt
					}
				}
			}
			if (cfg_hideitem == 1) {
				if (invctrl == 2 | invctrl == 5 | invctrl == 10 | invctrl == 12 | invctrl == 26 | (invctrl == 24 & invctrl(1) == 5) | (invctrl == 23 & invctrl(1) == 5)) {
					if (ibit(13, cnt)) {
						continue
					}
				}
			}
			if (invctrl == 5) {
				if (reftype != 57000 & reftype != 91000 & roopbuf != 340 & (gettrait(0, 45) == 0 & iMaterial(cnt) != 35 | (gettrait(0, 45) == 1 & reftype >= 50000 & reftype != 60000 & roopbuf != 341 & roopbuf != 339 & roopbuf != 337)) & item_isCookedMilk(cnt) == 0) {
					continue
				}
				if (item_isCookedHarb(cnt)) {
					continue
				}
			}
			if (invctrl == 6) {
				p = cdata(body, cc) / 10000
				if (iequiploc(cnt, p)) {
					if (p == 5) {
						if (iSkill(cnt) == 111) {
							if (eqthrowcheck(cc)) {
								continue
							}
						}
					}
				} else {
					continue
				}
			}
			if (invctrl == 7) {
				if (mapType == 1) {
					if (refitem(roopbuf, 9, cnt) != 53100 | gettrait(cc, 182) != 0 & roopbuf != 621) {
						continue
					}
				} else {
					if (refitem(roopbuf, 2, cnt) == 0 & (roopbuf == 619 & iSubname(cnt) == 30) == 0) {
						continue
					}
					if (gettrait(cc, 182) != 0) {
						continue
					}
					if (cfg_hideitem == 1) {
						if (roopbuf == 687 & iParam2(cnt) != 0) {
							continue
						}
					}
				}
			}
			if (invctrl == 8) {
				if (item_isCookedHarb(cnt) == 0) {
					if (refitem(roopbuf, 4, cnt) == 0 & (gettrait(0, 45) == 0 | (gettrait(0, 45) == 1 & roopbuf != 338))) {
						continue
					} elseif (item_isCookedMilk(cnt)) {
						continue
					}
				}
			}
			if (invctrl == 9) {
				if (refitem(roopbuf, 3, cnt) == 0) {
					continue
				}
			}
			if (invctrl == 11) {
				if (roopbuf == 54 | roopbuf == 55) {
					continue
				}
			}
			if (invctrl == 11 | invctrl == 12) {
				if (shoptrade) {
					if (iWeight(cnt) >= 0) {
						continue
					} else {
						if (reftype != 92000) {
							continue
						}
					}
				} else {
					if (iWeight(cnt) < 0) {
						if (reftype == 92000) {
							continue
						}
					}
				}
				if (iValue(cnt) <= 1) {
					continue
				}
				if (ibit(5, cnt) == 1) {
					continue
				}
				if (iParam3(cnt) < 0) {
					continue
				}
				if (iQuality(cnt) == 6) {
					continue
				}
			}
			if (invctrl == 13) {
				if (iIdentificationState(cnt) >= 3) {
					continue
				}
			}
			if (invctrl == 14) {
				if (iFunction(cnt) == 0 & refitem(roopbuf, 11, cnt) == 0 & ibit(10, cnt) == 0) {
					continue
				}
			}
			if (invctrl == 15) {
				if (roopbuf == 743) {
					continue
				}
				if (reftype == 60000) {
					if (iCount(cnt) == 0) {
						continue
					}
					if (iOwnState(cnt) != 0) {
						continue
					}
				} else {
					if (reftype != 72000) {
						continue
					}
					if (cfg_hideitem == 1) {
						if (iCount(cnt) == 0) {
							if (iParam1(cnt) == 0) {
								continue
							}
						}
					}
				}
			}
			if (invctrl == 16) {
				if (reftype != 57000 & roopbuf != iId_milk) {
					continue
				} else {
					if (iParam2(cnt) != 0) {
						continue
					}
					if (iId(cnt) == 618) {
						if (iSubname(cnt) >= 37) {
							continue
						}
					}
				}
				if (roopbuf == 419) {
					continue
				}
			}
			if (invctrl == 17) {
				if (item_isCookedHarb(cnt) == 0) {
					if (reftype != 52000 & roopbuf != 617) {
						continue
					} elseif (item_isCookedMilk(cnt)) {
						continue
					}
				}
			}
			if (invctrl == 18) {
				if (iId(cidip) == 617) {
					if (roopbuf != 342) {
						continue
					}
				}
				if (cfg_hideitem == 1) {
					if (iId(cidip) == 601) {
						if (reftype != 60001) {
							continue
						}
					}
					if (iId(cidip) == 620) {
						if ((reftype != 57000 & reftype != 60001 & reftype > 50000) | item_isCookedMilk(cnt) != 0) {
							continue
						}
					}
					if (iId(cidip) == 27 | iId(cidip) == 28 | iId(cidip) == 29 | iId(cidip) == 30) {
						if (reftype != 10000 & reftype != 25000 & reftype != 60001 & refitem(roopbuf, 9, cnt) != 24030) {
							continue
						}
					}
					if (iId(cidip) == 262) {
						if (reftype != 10000 & reftype != 25000 & (reftype != 57000 & item_isCookedMilk(cnt) == 0) & reftype != 60001 & refitem(roopbuf, 9, cnt) != 24030) {
							continue
						}
					}
				}
				if (cidip == cnt | roopbuf == 516) {
					continue
				}
			}
			if (invctrl == 19) {
				if (ibit(13, cnt) == 1) {
					continue
				}
				if (ti != (-1)) {
					godidt = godno2godid(iParam1(ti))
					if (godidt == "eyth" & iParam3(ti) != 0) {
						godidt = cgodShortId(iParam2(ti))
					}
					p = getcgodno()
					if (godidt != "") {
						// 従属神か
						if (godcheck() != godidt & goddomaincheck(godidt, godcheck()) == 1) {
							// 祭壇がカスゴ側か
							if (findcgodno(godidt) != (-1)) {
								// 祭壇のカスゴにアイテムを渡せるか
								if (givecheck(cnt, findcgodno(godidt)) == 0) {
									// 渡せないなら
									// 信仰中の神がカスゴか
									if (p != (-1)) {
										// カスゴなら
										if (givecheck(cnt, p) == 0) {
											continue
										}
									} else {
										// 非カスゴなら
										if (refitem(roopbuf, 12, cnt) == 0) {
											continue
										}
									}
								}
							} else {
								// 祭壇側がカスゴでないなら
								// 祭壇側の神の好物か
								if (refitem(roopbuf, 22, cnt) == 0) {
									if (givecheck(cnt, p) == 0) {
										continue
									}
								}
							}
						} else {
							if (p == (-1)) {
								if (refitem(roopbuf, 12, cnt) == 0) {
									continue
								}
							} else {
								if (givecheck(cnt, p) == 0) {
									continue
								}
							}
						}
					}
				}
			}
			if (invctrl == 20) {
				if (roopbuf == 54 | roopbuf == 55) {
					continue
				}
			}
			if (invctrl == 21) {
				if (calcitemvalue(cnt, 0) * iNumber(cnt) < calcitemvalue(citrade, 0) * iNumber(citrade) / 2 * 3) {
					continue
				}
				if (ibit(9, cnt)) {
					continue
				}
			}
			if (invctrl == 22) {
				if (iOwnState(cnt) == 1) {
					continue
				}
			}
			if (invctrl == 23) {
				if (invctrl(1) == 0) {
					if (reftype >= 50000 & reftype != 60000) {
						continue
					}
				}
				if (invctrl(1) == 1) {
					if (reftype != 10000 & reftype != 24000) {
						continue
					}
				}
				if (invctrl(1) == 2) {
					if (reftype < 12000 | reftype >= 24000) {
						if (reftype < 30000 | reftype >= 50000) {
							continue
						}
					}
				}
				if (invctrl(1) == 3) {
					if (ibit(4, cnt) == 0) {
						continue
					}
				}
				if (invctrl(1) == 4) {
					if (iBodyPart(cnt) != 0) {
						continue
					}
				}
				if (invctrl(1) == 5) {
					if (reftype != 56000) {
						continue
					}
				}
				if (invctrl(1) == 6) {
					if (iWeight(cnt) <= 0 | roopbuf == 641) {
						continue
					}
				}
				if (invctrl(1) == 7) {
					if (iQuality(cnt) >= 4 | reftype >= 50000) {
						continue
					}
				}
			}
			if (invctrl == 24) {
				if (invctrl(1) == 0) {
					if (gCurrentMap == 36) {
						if (roopbuf != 687 | iParam2(cnt) == 0) {
							continue
						}
					} else {
						if (iOwnState(cnt) != 4) {
							continue
						}
					}
				} else {
					if (iOwnState(cnt) == 4) {
						continue
					}
				}
				if (invctrl(1) == 2) {
					if (roopbuf != 615) {
						continue
					}
				}
				if (reftype == 72000) {
					continue
				}
				if (invctrl(1) == 3) {
					if (reftype != 57000 & refitem(roopbuf, 9, cnt) != 52002 & roopbuf != 516 & roopbuf != 574 & roopbuf != 620 & roopbuf != 770) {
						continue
					}
				}
				if (invctrl(1) == 8) {
					if (reftype != 55000 & reftype != 54000 & (roopbuf != 619 | iSubname(cnt) != 30)) {
						continue
					}
				}
				if (invctrl(1) == 9) {
					if (reftype >= 50000) {
						continue
					}
				}
				if (invctrl(1) == 10) {
					if (refitem(roopbuf, 9, cnt) != 57001) {
						continue
					}
				}
				if (invctrl(1) == 11) {
					if (reftype != 52000) {
						continue
					}
				}
				if (invctrl(1) == 12) {
					if (refitem(roopbuf, 9, cnt) != 52002 & roopbuf != 516 & roopbuf != 574 & roopbuf != 620 & roopbuf != 770) {
						continue
					}
				}
				if (invctrl(1) == 13) {
					if (reftype != 62000) {
						continue
					}
				}
				if (invctrl(1) == 14) {
					if (iBodyPart(cnt) != 0 | ibit(5, cnt) == 1 | ibit(13, cnt) == 1) {
						continue
					}
					if (cfg_hideitem & item_isCargoGoods(cnt)) {
						continue
					}
					if (invcontainer(1) == cnt) {
						continue
					}
				}
			} else {
				if (iOwnState(cnt) == 4) {
					if (invctrl != 1 & invctrl != 2 & invctrl != 3 & invctrl != 5) {
						continue
					}
				}
			}
			if (invctrl == 26) {
				if (reftype != 52000 & roopbuf != 578 & roopbuf != 685 & roopbuf != 699 & roopbuf != 772 & roopbuf != 575) {
					continue
				}
				if (roopbuf == 685) {
					if (iSubname(cnt) != 0) {
						continue
					}
				}
				if (item_isCookedMilk(cnt)) {
					continue
				}
			}
			if (invctrl == 27) {
				if (cnt2 == 0) {
					if (iOwnState(cnt) != 1) {
						continue
					}
				}
			}
			if (invctrl == invCtrl_Blacksmith) {
				if (smithcheck(cnt, invctrl(1))) {
					continue
				}
			}
			if (invctrl == 31) {
				if (refitem(roopbuf, 9, cnt) != 58500) {
					continue
				}
			}
			if (invctrl == 32) {
				if (roopbuf != 617) {
					continue
				}
			}
			if (invctrl == 33) {
				if (roopbuf == 289 | roopbuf == 290 | roopbuf == 732 | roopbuf == 743 | iQuality(cnt) == 6 | ibit(5, cnt) | ibit(13, cnt) | iBodyPart(cnt) != 0) {
					continue
				}
			}
			if (invctrl == 34) {
				if (reftype != 57000 & roopbuf != 575) {
					continue
				} else {
					if (iParam3(cnt) > 0) {
						continue
					}
				}
			}
			if (equipfilter != 0 & (invctrl == 1 | invctrl == 2 | invctrl == 3 | invctrl == 5 | invctrl == 6 | invctrl == 10 | invctrl == 11 | invctrl == 12 | invctrl == 28 | invctrl == 35)) {
				if (iIdentificationState(cnt) != 3) {
					continue
				}
				if (oomSEST_livingWeapon_search == 1) {
					if (item_isLiving(cnt) == 0) {
						continue
					}
				}
				cnt3 = cnt
				equipfilter_f = 0
				max_power = 0
				getinheritance cnt3, inhlist, inhmax
				dim oom_inheritance, 15
				repeat inhmax
					oom_inheritance(inhlist(cnt)) = 1
				loop
				repeat 15
					if (iEnchantmentId(cnt3, cnt) == 0) {
						break
					}
					if (oom_inheritance_search == 1) {
						if (oom_inheritance(cnt) != 1) {
							continue
						}
					}
					if (equipfilter < 0) {
						if (iEnchantmentId(cnt3, cnt) / 10000 == abs(equipfilter) / 10000 | (iEnchantmentId(cnt3, cnt) / 10000 == 0 & abs(equipfilter) / 10000 == 10)) {
							if (equipfilterpower == 0) {
								if (iEnchantmentPower(cnt3, cnt) > max_power) {
									list(0, listmax) = cnt3, iEnchantmentPower(cnt3, cnt)
									equipfilter_f = 1
									max_power = iEnchantmentPower(cnt3, cnt)
								}
							} else {
								if (iEnchantmentPower(cnt3, cnt) > equipfilterpower) {
									if (iEnchantmentPower(cnt3, cnt) > max_power) {
										list(0, listmax) = cnt3, iEnchantmentPower(cnt3, cnt)
										equipfilter_f = 1
										max_power = iEnchantmentPower(cnt3, cnt)
									}
								}
							}
						}
					} else {
						if (iEnchantmentId(cnt3, cnt) == equipfilter - 1 * (iEnchantmentId(cnt3, cnt) / 10000 == 8 | iEnchantmentId(cnt3, cnt) / 10000 == 9)) {
							if (equipfilterpower == 0) {
								list(0, listmax) = cnt3, iEnchantmentPower(cnt3, cnt)
								equipfilter_f = 1
								break
							} else {
								if (iEnchantmentPower(cnt3, cnt) > equipfilterpower) {
									list(0, listmax) = cnt3, iEnchantmentPower(cnt3, cnt)
									equipfilter_f = 1
									break
								}
							}
						}
					}
				loop
				if (equipfilter_f == 0) {
					continue
				}
			} else {
				list(0, listmax) = cnt, reftype * 1000 + roopbuf
				if (roopbuf == 544) {
					list(1, listmax) += iParam1(cnt) + 900
				} else {
					if (reftype == 72000) {
						if (iCount(cnt) == 0 & iParam1(cnt) == 0) {
							list(1, listmax) += 1000
						}
					}
				}
				if (invctrl == 3) {
					if (iOwnState(cnt) > 0 & iOwnState(cnt) < 3) {
						list(1, listmax) += 99999 * 1000
					}
				}
				if (invctrl == 1 | invctrl == 13) {
					if (iBodyPart(cnt) != 0) {
						list(1, listmax) -= 99999 * 1000
					}
				}
				if (cnt2 == 0) {
					list(1, listmax) -= 99999 * 2000
				}
				if (invctrl == 28) {
					if (ogdata(547) == 2) {
						list(1, listmax) = limitmin(calcmedalvalue(cnt) / 2, 1)
					} else {
						list(1, listmax) = calcmedalvalue(cnt)
					}
				}
				if (invctrl == 35) {
					list(1, listmax) = calcfeavalue(cnt)
				}
				if (invctrl == invCtrl_Cook) {
					if (cfg_ST_sortByExpirationDate) {
						if (iMaterial(cnt) != 35 | iParam3(cnt) == -1) {
							// It won't get rotten or has already been rotten.
							list(1, listmax) = INT_MAX - 1000 + roopbuf
						} else {
							// sort in expiration date
							list(1, listmax) = (iParam3(cnt) - getgametime()) * 1000 + roopbuf
						}
					}
				}
			}
			hack_equipfilter = 0
			listmax++
		loop
	loop
	f = 0
	if (listmax == 0) {
		if (invctrl == 21) {
			txt -1, lang(itemname(citrade) + "に見合う物を所持していない。", "You don't have stuff that match " + itemname(citrade) + ".")
			f = 1
		}
		if (invctrl == 27) {
			if (tc != 0) {
				txt -1, lang(name(tc) + "は盗めるものを所持していない。", name(tc) + " has nothing to steal.")
				f = 1
			} else {
				txt -1, lang("そこに盗めるものはない。", "There's nothing to steal.")
				f = 1
			}
		}
	}
	if (invctrl == 19) {
		item_find 60002, 2
		if (stat == (-1)) {
			msgdup++
			txt -1, lang("ここには祭壇がない。", "There's no altar here.")
			f = 1
		} else {
			ti = stat
		}
	}
	if (invctrl == 27) {
		if (tc > 0) {
			if (cRelationship(tc) == 10 | cRole(tc) == 10001 | cRole(tc) == 10018 | eqfaction(tc, "petshop")) {
				txt -1, lang("仲間からは盗みたくない。", "You don't want to rob your ally.")
				f = 1
			}
		}
	}
	if (invctrl == 24) {
		if (invctrl(1) == 0) {
			if (gCurrentMap == 36) {
				if (gdata(250 + 16) <= 0) {
					txt -1, lang("現在魔術士ギルドのノルマはない。", "You have no quota for Mages Guild.")
					f = 1
				}
			}
		}
	}
	if (f == 1) {
		if (invsubroutine == 1) {
			invsubroutine = 0
			return 0
		}
		gosub *label_0623
		goto *label_1623
	}
*label_1282
	if (equipfilter != 0 & oom_sort == 1) {
		gosub *label_1277
	} else {
		gosub *label_1276
	}
	if (invctrl == 3) {
		if (listmax == 0 & equipfilter == 0) {
			goto *label_1617
		}
	}
	if (returnfromidentify == 0) {
		if (invctrl == 18) {
			valn = itemname(cidip, 1)
		} else {
			if (invctrl == 21) {
				valn = itemname(citrade)
			}
		}
		s = "", lang("どのアイテムを調べる？ ", "Examine what? "), lang("どのアイテムを置く？ ", "Drop what? "), lang("どのアイテムを拾う？ ", "Which item do you want to pick up? "), lang("何を装備する？", "Equip what?"), lang("何を食べよう？ ", "Eat what? "), "", lang("どれを読む？ ", "Read what? "), lang("どれを飲む？ ", "Drink what? "), lang("どれを振る？ ", "Zap what? "), lang("どれを渡す？ ", "Which item do you want to give? "), lang("どれを購入する？ ", "What do you want to buy? "), lang("どれを売却する？ ", "What do you want to sell? "), lang("どのアイテムを鑑定する？ ", "Which item do you want to identify? "), lang("どのアイテムを使用する？ ", "Use what? "), lang("どれを開ける？ ", "Open what? "), lang("何を料理する？ ", "Cook what? "), lang("何を混ぜる？ ", "Blend what? "), lang("何に混ぜる？(" + valn + "の効果を適用するアイテムを選択) ", "Which item do you want to apply the effect of " + valn + "? "), lang("何を神に捧げる？ ", "What do you want to offer to your God? "), lang("何を交換する？ ", "Which item do you want to trade? "), lang(valn + "の代わりに何を提示する？ ", "What do you offer for " + valn + "? "), lang("何を取る？ ", "Take what? "), lang("何を対象にする？ ", "Target what? "), lang("何を入れる？ ", "Put what? "), lang("何をもらう？ ", "Which item do you want to take? "), lang("何を投げる？ ", "Throw what? "), lang("何を盗む？ ", "Steal what? "), lang("何と交換する？ ", "Trade what? "), lang("何を予約する？", "Which item do you want to reserve? "), "", "", "", "", "", lang("何と交換する？ ", "Trade what? "), ""
		if (s(invctrl) != "") {
			txtnew
		}
		if (invsc == 0) {
			if (tc == -1) {
				ctalk 0, 10000 + invctrl, 0, 0
			} else {
				ctalk 0, 10000 + invctrl, 0, tc
			}
			if (stat == 0) {
				s = "", lang("どのアイテムを調べる？ ", "Examine what? "), lang("どのアイテムを置く？ ", "Drop what? "), lang("どのアイテムを拾う？ ", "Which item do you want to pick up? "), lang("何を装備する？", "Equip what?"), lang("何を食べよう？ ", "Eat what? "), "", lang("どれを読む？ ", "Read what? "), lang("どれを飲む？ ", "Drink what? "), lang("どれを振る？ ", "Zap what? "), lang("どれを渡す？ ", "Which item do you want to give? "), lang("どれを購入する？ ", "What do you want to buy? "), lang("どれを売却する？ ", "What do you want to sell? "), lang("どのアイテムを鑑定する？ ", "Which item do you want to identify? "), lang("どのアイテムを使用する？ ", "Use what? "), lang("どれを開ける？ ", "Open what? "), lang("何を料理する？ ", "Cook what? "), lang("何を混ぜる？ ", "Blend what? "), lang("何に混ぜる？(" + valn + "の効果を適用するアイテムを選択) ", "Which item do you want to apply the effect of " + valn + "? "), lang("何を神に捧げる？ ", "What do you want to offer to your God? "), lang("何を交換する？ ", "Which item do you want to trade? "), lang(valn + "の代わりに何を提示する？ ", "What do you offer for " + valn + "? "), lang("何を取る？ ", "Take what? "), lang("何を対象にする？ ", "Target what? "), lang("何を入れる？ ", "Put what? "), lang("何をもらう？ ", "Which item do you want to take? "), lang("何を投げる？ ", "Throw what? "), lang("何を盗む？ ", "Steal what? "), lang("何と交換する？ ", "Trade what? "), lang("何を予約する？", "Which item do you want to reserve? "), "", "", "", "", "", lang("何と交換する？ ", "Trade what? "), ""
				txt -1, s(invctrl)
			}
		}
		if (invctrl == 28) {
			item_find 622, 3, 1
			if (stat != (-1)) {
				p = iNumber(stat)
			} else {
				p = 0
			}
			txt -1, lang("(持っているメダル: " + p + "枚)", "(Coins: " + p + ")")
		}
		if (invctrl == 35) {
			item_find 801, 3, 1
			if (stat != (-1)) {
				p = iNumber(stat)
			} else {
				p = 0
			}
			txt -1, lang("(持っているフェアリンゴ: " + p + "枚)", "(feapple: " + p + ")")
		}
		if (invctrl == 24) {
			if (invctrl(1) == 0) {
				if (gCurrentMap == 36) {
					txt -1, lang("ノルマ残り: " + gdata(250 + 16) + "GP", "" + gdata(250 + 16) + "guild points are needed to gain a rank.")
				}
			}
		}
	}
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_inv.bmp", 1
	gsel 0
	if (returnfromidentify == 0) {
		windowshadow = 1
	}
	returnfromidentify = 0
*label_1283
	if (invsc != 0) {
		f = 0
		repeat listmax
			p = list(0, cnt)
			if (iId(p) == invsc) {
				if (refitem(iId(p), 5, p) != 57000 | stgdata(56 + sc) == iParam2(p)) {
					if ((iCurseState(p) == invcurse & iIdentificationState(p) == 3) | (stgdata(36 + sc) == (-3) & iIdentificationState(p) < 3) | cfg_ST_shortcut == 0) {
						if (iId(p) == 743) {
							if (inv(31, p) != invsc(1)) {
								continue
							}
						}
						ci = p
						f = 1
						if (ibit(4, ci)) {
							if (iCount(ci) <= 0) {
								continue
							}
						}
						break
					}
				}
		}
		loop
		cc = 0
		if (f == 0) {
			inv_find_ex invsc, 0, invcurse
			if (stat == (-1)) {
				txt -1, lang("そのアイテムは存在しない。", "The item doesn't exist.")
			} else {
				txt -1, lang("使用できるアイテムがない。", "You can't do that while you're in a global area.")
			}
			invsc = 0, 0
			invcurse = 0
			gosub *label_0623
			goto *label_1623
		}
		invsc = 0, 0
		if (mapType == 1) {
			if (invctrl == 9 | invctrl == 15 | invctrl == 26) {
				txtnew
				txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
				gosub *label_0623
				goto *label_1623
			}
		}
		goto *label_1285
	}
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	if (menucycle == 1) {
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		y = 34
		x = windoww - 650 + 156
		window2 x, y, 475, 22, 5, 5
		pos x - 28, y - 8
		gcopy 3, 64, 288, 50, 32
		if (dropcontinue) {
			i = 4
		} else {
			if (invally == 1) {
				i = 2
			} else {
				if (invcontainer) {
					i = 3
				} else {
					if (mapType == 1) {
						i = 1
					} else {
						i = 0
					}
				}
			}
		}
		repeat 12
			if (cycle(cnt, i) == (-1)) {
				break
			}
			p = cycle(cnt, i)
			pos x + cnt * 44 + 20, y - 24
			gcopy 3, 288 + invicon(p) * 48, 48, 48, 48
			if (invctrl == p) {
				gmode 5, , , 70
				pos x + cnt * 44 + 20, y - 24
				gcopy 3, 288 + invicon(p) * 48, 48, 48, 48
				gmode 2
			}
			pos x + cnt * 44 + 46 - strlen(invtitle(p)) * 3, y + 7
			color 0, 0, 0
			if (invctrl == p) {
				bmes invtitle(p), 255, 255, 255
			} else {
				bmes invtitle(p), 165, 165, 165
			}
			if (invkey(p) != "") {
				pos x + cnt * 44 + 46, y + 18
				color 0, 0, 0
				bmes "(" + invkey(p) + ")", 235, 235, 235
			}
		loop
		color 0, 0, 0
		pos x + 325, y + 32
		bmes "" + key_prev + "," + key_next + ",Tab " + lang("[メニュー切替]", "[Change]"), 255, 255, 255
	}
*label_1284
	redraw 0
	s = lang(invtitle(invctrl) + "アイテムの選択", invtitle(invctrl))
	s(1) = strhint2 + strhint5 + strhint5b
	if (equipfilter != 0 & (invctrl == 1 | invctrl == 2 | invctrl == 3 | invctrl == 5 | invctrl == 6 | invctrl == 10 | invctrl == 11 | invctrl == 12 | invctrl == 28 | invctrl == 35)) {
		s(1) += strhint3b
	} else {
		s(1) += strhint3
	}
	if (invctrl == 5 | invctrl == 7 | invctrl == 8 | invctrl == 9 | invctrl == 14 | invctrl == 15 | invctrl == 26) {
		s(1) += strhint7
	}
	if (invctrl == 1) {
		s(1) += "" + key_mode2 + " " + lang("[保持指定]", "[Tag No-Drop]")
	}
	if (invctrl == 2) {
		if (dropcontinue == 0) {
			s(1) += "" + key_mode2 + " " + lang("[連続で置く]", "[Multi Drop]")
		}
	}
	if (invctrl == 10) {
		if (cImpression(tc) >= 100) {
			s(1) += oomsest_strhint7
		}
	}
	if (equipfilter == 0) {
		if (invctrl == 1 | invctrl == 2 | invctrl == 3 | invctrl == 5 | invctrl == 6 | invctrl == 10 | invctrl == 11 | invctrl == 12 | invctrl == 28 | invctrl == 35) {
			s(1) += "\n" + oom_strhint1
		}
	} else {
		if (invctrl == 1 | invctrl == 2 | invctrl == 3 | invctrl == 5 | invctrl == 6 | invctrl == 10 | invctrl == 11 | invctrl == 12) {
			s(1) += "\n" + oom_strhint1 + oom_strhint2
		}
	}
	if (invctrl == 2) {
		if (dropcontinue == 0) {
			s(1) += " " + oomsest_strhint2
		}
	}
	if (invctrl == 3) {
		s(1) += " " + oomsest_strhint3
	}
	if (cfg_NC_itemcount != 0) {
		if (invctrl == 1) {
			s(1) += "" + oom_strhint9
		}
	}
	if (invctrl == 25) {
		s(1) += " " + key_wear + " " + lang("[装備選択]", "[Equip]")
	}
	display_window (windoww - 640) / 2 + inf_screenx, winposy(432), 640, 432
	if (invicon(invctrl) != (-1)) {
		pos wx + 46, wy - 14
		gcopy 3, 288 + invicon(invctrl) * 48, 48, 48, 48
	}
	s = lang("重さ", "Weight")
	if (invctrl == 11 | invctrl == 12) {
		s = lang("値段", "Price")
	}
	if (invctrl == 28) {
		s = lang("メダル", "Medal")
	}
	if (invctrl == 35) {
		s = lang("F.リンゴ", "Feapple")
	}
	display_topic s, wx + 526, wy + 30
	s = lang("アイテムの名称", "Name")
	if (equipfilter != 0) {
		s = lang("フィルタ : ", "Filter: ")
		if (equipfilter < 0) {
			s += enccategoryn(encselect)
		} else {
			if (enccategory(encselect) < 80000) {
				s += skillname(equipfilter \ enccategory(encselect))
			} else {
				if (enccategory(encselect) == 80000) {
					s += skillname(encprocref(0, equipfilter \ enccategory(encselect) - 1))
				} else {
					if (enccategory(encselect) == 90000) {
						s += ammoname(equipfilter \ enccategory(encselect) - 1)
					} else {
						s += encetcn(0, equipfilter \ enccategory(encselect) - 21)
					}
				}
			}
		}
		if (equipfilterpower != 0) {
			s = s + " - " + equipfilterpower
		}
		if (oom_inheritance_search) {
			s += lang(" - 継承on", " - only inherited")
		}
		if (oomSEST_livingWeapon_search) {
			s += lang(" - 生き武器on", " - only alive")
		}
		if (oom_sort == 1) {
			s = s + lang(" : 降順", ": descending")
		} else {
			s = s + lang(" : 昇順", ": ascending")
		}
	}
	display_topic s, wx + 28, wy + 30
	if (showresist) {
		if (equipfilter == 0) {
			if (cfg_equipex == 1) {
				if (equipfilter >= 0 & showressub == 2) {
					showressub = 0
				}
				pos wx + 200 + (showressub == 0) * 100, wy + 40
				if (showressub == 0) {
					color 0, 0, 0
					repeat length(_resiststr0)
						pos wx + 300 + cnt * 20, wy + 40
						mes _resiststr0(cnt)
					loop
				}
				if (showressub == 1) {
					color 0, 0, 0
					repeat length(_resiststr1)
						pos wx + 200 + cnt * 20, wy + 40
						mes _resiststr1(cnt)
					loop
				}
				if (showressub == 2) {
					color 0, 0, 0
					mes ""
				}
				if (showressub == 3) {
					color 0, 0, 0
					pos wx + 200, wy + 40
					mes lang("熱", "Fi")
					pos wx + 220, wy + 40
					mes lang("酸", "Ac")
					pos wx + 240, wy + 40
					mes lang("浮", "Fl")
					pos wx + 260, wy + 40
					mes lang("寄", "Pa")
					pos wx + 280, wy + 40
					mes lang("腐", "Ro")
					pos wx + 300, wy + 40
					mes lang("電", "Ra")
				}
			} else {
				pos wx + 300, wy + 40
				color 0, 0, 0
				mes lang("火 冷 雷 闇 幻 毒 獄 音 神 沌 魔", "Fi Co Li Da Mi Po Nt So Nr Ch Ma")
			}
		}
	}
	pos wx + ww - 136, wy - 6
	gcopy 3, 960, 96, 144, 48
	if (showresist == 0) {
		pos wx + ww - 186, wy - 6
		gcopy 3, 960, 144, 48, 72
	}
	pos wx + ww - 246, wy - 6
	gcopy 3, 1008, 144, 48, 72
	pos wx - 6, wy - 6
	gcopy 3, 960, 216, 48, 72
	s = "" + listmax + " items"
	s += lang("  (重さ合計 ", "  (Weight ") + cnvweight(cInventoryWeight(0)) + "/" + cnvweight(cMaxInventoryWeight(0)) + lang("  荷車 ", "  Cargo ") + cnvweight(gCargoWeight) + ")"
	if (invctrl == 25) {
		s = ""
	}
	display_note s
	if (invctrl == 25) {
		x = (windoww - 640) / 2 + inf_screenx + 455
		y = winposy(432) - 32
		w = 200
		h = 102
		window x + 4, y + 4, w, h - h \ 8, 0, -1
		window x, y, w, h - h \ 8, 0, 0
		font lang(cfg_font1, cfg_font2), 12 + en - en * 2, 0
		pos x + 16, y + 17
		mes "DV:" + cDv(tc) + " PV:" + cPv(tc)
		pos x + 16, y + 35
		mes lang("装備重量:", "EquipWt:") + cnvweight(cSumOfEquipmentWeight(tc)) + "" + cnveqweight(tc)
		x = wx + 40
		y = wy + wh - 65 - wh \ 8
		pos x, y
		mes lang("装備箇所:", "Equip:")
		x += 60
		repeat 30, 100
			if (cdata(cnt, tc) == 0) {
				continue
			}
			p = cdata(cnt, tc)
			if (p \ 10000 != 0) {
				color 50, 50, 200
			} else {
				color 100, 100, 100
			}
			pos x, y
			mes "" + bodyn(p / 10000)
			x += (strlen(bodyn(p / 10000)) + 1) * 6
		loop
	}
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		p = list(0, p)
		s = itemname(p, iNumber(p)), cnvweight(iWeight(p) * iNumber(p))
		if (invctrl == 11) {
			s += " " + cnvweight(iWeight(p))
			s(1) = thousandsep(str(calcitemvalue(p, 0))) + " gp"
		}
		if (invctrl == 12) {
			s += " " + cnvweight(iWeight(p))
			s(1) = thousandsep(str(calcitemvalue(p, 1))) + " gp"
		}
		if (invctrl == 28) {
			if (ogdata(547) == 2) {
				s(1) = "" + limitmin(calcmedalvalue(p) / 2, 1) + lang(" 枚", " Coins")
			} else {
				s(1) = "" + calcmedalvalue(p) + lang(" 枚", " Coins")
			}
		}
		if (invctrl == 35) {
			s(1) = "" + calcfeavalue(p) + lang(" 枚", " Coins")
		}
		if (refitem(iId(p), 5, p) == 57000) {
			if (iIdentificationState(p) == 3) {
				if (iMaterial(p) == 35) {
					if (iParam3(p) > 0) {
						if (iParam3(p) - getgametime() >= 0) {
							s += lang("(" + (iParam3(p) - getgametime()) + "時間)", "(Expire in: " + (iParam3(p) - getgametime()) + "h.)")
						}
					}
				}
			}
		}
		if (invctrl != 3 & invctrl != 11 & invctrl != 22 & invctrl != 27 & invctrl != 28 & invctrl != 35) {
			if (p >= 5080) {
				s += lang("(足元)", " (Ground)")
			}
		}
		if (iId(p) == 792) {
				s += "(ID:" + (iParam1(p) + iParam2(p) + iParam3(p)) + ")"
		}
		repeat 20
			if (ogdata(36 + cnt) == iId(p) + invctrl * 10000 + inv(31, p) * 10000 * 100) {
				if (refitem(iId(p), 5, p) != 57000 | stgdata(56 + cnt) == iParam2(p)) {
					if ((stgdata(36 + cnt) == iCurseState(p) & iIdentificationState(p) == 3) | (stgdata(36 + cnt) == (-3) & iIdentificationState(p) < 3) | cfg_ST_shortcut == 0) {
						s += "{" + cnt + "}"
					}
				}
			}
		loop
		display_key wx + 58, wy + 60 + cnt * 19 - 2, cnt
		if (cfg_useffhp) {
			preparepicitemex p
			p(1) = stat
		} else {
			p(1) = iImage(p) \ 1000
			gsel 1
			color 0
			boxf 0, 960, chipi(2, p(1)), chipi(3, p(1)) + 960
			if (p(1) == 528) {
				gmode 2
				pos 0, 960
				gcopy 1, 0, 768, inf_tiles, inf_tiles
				pos 0, 1008
				gzoom 22, 20, 5 + 90 * (iColor(p) > 660 & iColor(p) < 825), chipc(0, iColor(p)) + 8, chipc(1, iColor(p)) + 4 + (chipc(3, iColor(p)) > inf_tiles) * 8, chipc(2, iColor(p)) - 16, chipc(3, iColor(p)) - 8 - (chipc(3, iColor(p)) > inf_tiles) * 10, 1
				pos 6, 974
				gcopy 1, 0, 1008, 22, 20
				gsel selcur
			} else {
				if (p(1) == 531) {
					pos 8, 1058 - chipc(3, iColor(p))
					gcopy 5 + 90 * (iColor(p) > 660 & iColor(p) < 825), chipc(0, iColor(p)) + 8, chipc(1, iColor(p)) + 2, chipc(2, iColor(p)) - 16, chipc(3, iColor(p)) - 8
					gmode 4, , , 150
					color 0, 0, 0
					pos 0, 960 + (chipc(3, iColor(p)) == inf_tiles) * 48
					gcopy 1, 144, 768 + (chipc(3, iColor(p)) > inf_tiles) * 48, inf_tiles, chipc(3, iColor(p)) + (chipc(3, iColor(p)) > inf_tiles) * 48
					gmode 2
					gsel selcur
				} else {
					if (p(1) == 529) {
						pos 0, 1056 - chipc(3, iColor(p))
						gcopy 5 + 90 * (iColor(p) > 660 & iColor(p) < 825), chipc(0, iColor(p)), chipc(1, iColor(p)), chipc(2, iColor(p)), chipc(3, iColor(p))
						gmode 2
						gsel selcur
					} else {
						pos 0, 960
						gcopy 1, chipi(0, p(1)), chipi(1, p(1)), chipi(2, p(1)), chipi(3, p(1))
						gfini chipi(2, p(1)), chipi(3, p(1))
						gfdec2 c_col(0, iColor(p)), c_col(1, iColor(p)), c_col(2, iColor(p))
						gsel selcur
					}
				}
			}
		}
		pos wx + 37, wy + 69 + cnt * 19
		gmode 2, chipi(2, p(1)), chipi(3, p(1))
		grotate 1, 0, 960, 0, chipi(2, p(1)) * inf_tiles / chipi(3, p(1)), inf_tiles
		if (iBodyPart(p) != 0) {
			pos wx + 46, wy + 72 + cnt * 18 - 3
			gcopy 3, 12, 348, 12, 12
			if (p == mainweapon) {
				s += lang("(利腕)", " (Main hand)")
			}
		}
		if (showresist) {
			if (cfg_equipex == 1) {
				if (equipfilter > 0) {
					if (showressub == 2) {
						showressub = 0
					}
				}
				if (refitem(iId(p), 5, p) >= 10000 & refitem(iId(p), 5, p) <= 34000 | iId(p) == 760) {
					equipinfo p, wx + 200 + (showressub == 0) * 100, wy + 60 + cnt * 19 + 2
					s = strmid(s, 0, 10 + (showressub == 0) * 14)
				}
			} else {
				equipinfo p, wx + 300, wy + 60 + cnt * 19 + 2
				s = strmid(s, 0, 24)
			}
		}
		cs_list s, wx + 84, wy + 60 + cnt * 19 - 1, 19, 0, 1, p
		pos wx + 600 - strlen(s(1)) * 7, wy + 60 + cnt * 19 + 2
		mes s(1)
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	if (showmoney) {
		if (showresist == 0) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			gmode 2
			pos wx + 320, wy + 32
			gcopy 3, 0, 392, 24, 24
			color 0, 0, 0
			pos wx + 348, wy + 37 - en * 2
			mes thousandsep(str(cGold(tc))) + " gp"
		}
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	invmark(invctrl) = page * 1000 + cs
	repeat keyrange
		if (invCtrl == invCtrl_Blacksmith && key == "sc") {
			if (sc \ 10) {
				key = key_select(sc - 1)
			}
		}
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (mode == 9) {
		if (listmax == 0) {
			p = -1
			key = key_cancel
		}
	}
	if (p != (-1)) {
		ci = p
		if (invctrl == 12 | (invctrl == 24 & invctrl(1) != 0)) {
			cc = -1
		} else {
			if (invctrl != 6 | invctrl(1) != 1) {
				cc = 0
			}
		}
*label_1285
		cargocheck
		if (stat == 0) {
			goto *label_1287
		}
		if (cc == 0) {
			if (invctrl == 14 | invctrl == 9 | invctrl == 26 | invctrl == 8 | invctrl == 7) {
				if (gettrait(0, 173) != 0) {
					if (rnd(20) == 0) {
						txt -1, lang(name(cnt) + "は行動を躊躇った。", name(cnt) + " cancel" + _s(cnt) + " " + his(cnt) + " action.")
						goto *label_1617
					}
				}
			}
		}
		if (invctrl == 1) {
			listmax_bk = listmax
			pagesize_bk = pagesize
			pagemax_bk = pagemax
			listnumber = pagesize * page + cs
			gosub *label_1290
			goto *label_1280
		}
		if (invctrl == 2) {
			if (ibit(13, ci)) {
				snd 27
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *label_1283
			}
			if (areaId(gCurrentMap) == 30) {
				if (refitem(iId(ci), 5, ci) == 92000) {
					txt -1, lang("シェルター内では荷物を置くことが出来ない。", "You can't drop this item in shelter.")
					snd 27
					goto *label_1283
				}
			}
			if (inv_getspace(-1) == 0) {
				ctalk 0, 10109, 0, 0
				if (stat == 0) {
					txt -1, lang("これ以上は置けない。", "You can't drop items any more.")
				}
				snd 27
				goto *label_1283
			}
			if (mapItemMax != 0) {
				if (inv_sum(-1) > mapItemMax) {
					if (refitem(iId(ci), 5, ci) != 60000) {
						ctalk 0, 10109, 0, 0
						if (stat == 0) {
							txt -1, lang("これ以上は置けない。", "You can't drop items any more.")
						}
						snd 27
						goto *label_1283
					}
				}
			}
			if (iNumber(ci) > 1) {
				txt -1, lang(itemname(ci, 1) + "をいくつ落とす？ (1〜" + iNumber(ci) + ") ", "How many? (1 to " + iNumber(ci) + ")")
				display_msg screenmsgy, 1
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
				inputlog = "" + iNumber(ci)
				gosub *label_1349
				in = int(inputlog)
				if (in > iNumber(ci)) {
					in = iNumber(ci)
				}
				if (in == 0 | rtval == (-1)) {
					goto *label_1283
				}
			} else {
				in = 1
			}
			if (cfg_useffhp) {
				hack_furniture = 1
				if (length(ichipexchangetable) == maxitemid) {
					if (ichipexchangetable(iId(ci)) / 1000000) {
						txt -1, lang("どの向きに置く？", "Which direction?")
						snd 26
						redraw 0
						gsel 4
						x = (cX(0) - scx) * inf_tiles + inf_screenx - 48 * 3
						y = (cY(0) - scy) * inf_tiles + inf_screeny - 48 * 3
						gmode 0
						pos 0, 0
						gcopy 0, x, y, 48 * 7, 48 * 7
						gsel 0
						t = 0
						x = (cX(0) - scx) * inf_tiles + inf_screenx + 24
						y = (cY(0) - scy) * inf_tiles + inf_screeny + 24
						repeat
							t++
							color 0, 0, 0
							if (key_alt == 0) {
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x, y - 48
								grotate 3, 212, 432, 0, 28, 28
								inv(39, ci) = 3
								preparepicitemex ci
								furnituretmp = stat
								pos x, y - 48 - 48
								gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
								grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x, y + 48
								grotate 3, 212, 432, 1.0 * 3.14, 28, 28
								inv(39, ci) = 0
								preparepicitemex ci
								furnituretmp = stat
								pos x, y + 48 + 48
								gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
								grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x + 48, y
								grotate 3, 212, 432, 0.5 * 3.14, 28, 28
								inv(39, ci) = 2
								preparepicitemex ci
								furnituretmp = stat
								pos x + 48 + 48, y
								gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
								grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x - 48, y
								grotate 3, 212, 432, 1.5 * 3.14, 28, 28
								inv(39, ci) = 1
								preparepicitemex ci
								furnituretmp = stat
								pos x - 48 - 48, y
								gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
								grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
							}
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x - 48, y - 48
							grotate 3, 212, 432, 1.75 * 3.14, 28, 28
							inv(39, ci) = 5
							preparepicitemex ci
							furnituretmp = stat
							pos x - 48 - 48, y - 48 - 48
							gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
							grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x + 48, y + 48
							grotate 3, 212, 432, 0.75 * 3.14, 28, 28
							inv(39, ci) = 6
							preparepicitemex ci
							furnituretmp = stat
							pos x + 48 + 48, y + 48 + 48
							gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
							grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x + 48, y - 48
							grotate 3, 212, 432, 0.25 * 3.14, 28, 28
							inv(39, ci) = 7
							preparepicitemex ci
							furnituretmp = stat
							pos x + 48 + 48, y - 48 - 48
							gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
							grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x - 48, y + 48
							grotate 3, 212, 432, 1.25 * 3.14, 28, 28
							inv(39, ci) = 4
							preparepicitemex ci
							furnituretmp = stat
							pos x - 48 - 48, y + 48 + 48
							gmode 2, chipi(2, furnituretmp), chipi(3, furnituretmp)
							grotate 1, 0, 960, 0, chipi(2, furnituretmp), chipi(3, furnituretmp)
							inv(39, ci) = -1
							redraw 1
							redraw 0
							gmode 0
							pos x - 48 * 3 - 24, y - 48 * 3 - 24
							gcopy 4, 0, 0, 48 * 7, 48 * 7
							gmode 2
							await 30
							key_check 1
							if (key == key_alter) {
								continue
							}
							if (key == key_wait | key == key_enter) {
								inv(39, ci) = 0
								break
							}
							if (key == key_south) {
								if (key_alt) {
									continue
								}
								inv(39, ci) = 0
								break
							}
							if (key == key_west) {
								if (key_alt) {
									continue
								}
								inv(39, ci) = 1
								break
							}
							if (key == key_east) {
								if (key_alt) {
									continue
								}
								inv(39, ci) = 2
								break
							}
							if (key == key_north) {
								if (key_alt) {
									continue
								}
								inv(39, ci) = 3
								break
							}
							if (key == key_southwest) {
								inv(39, ci) = 4
								break
							}
							if (key == key_northwest) {
								inv(39, ci) = 5
								break
							}
							if (key == key_southeast) {
								inv(39, ci) = 6
								break
							}
							if (key == key_northeast) {
								inv(39, ci) = 7
								break
							}
							if (key != "") {
								break
							}
						loop
						if (inv(39, ci) == (-1)) {
							inv(39, ci) = 0
							goto *label_1283
						}
						await 80
					}
				}
				hack_furniture = 0
			}
			savecycle
			dropval = 0
			gosub *label_1417
			if (dropcontinue) {
				menucycle = 1
				dropcontinue++
				goto *label_1280
			}
			goto *label_1617
		}
		if (invctrl == 3 | invctrl == 11 | invctrl == 12 | invctrl == 22 | (invctrl == 24 & (invctrl(1) == 3 | invctrl(1) == 5 | invctrl(1) == 8 | invctrl(1) == 9 | invctrl(1) == 10 | invctrl(1) == 11 | invctrl(1) == 12 | invctrl(1) == 13 | invctrl(1) == 14 | invctrl(1) == 99))) {
			if (invctrl != 3 & invctrl != 22) {
				if (ibit(13, ci)) {
					snd 27
					txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
					if (invctrl == 12) {
						cc = 0
					}
					goto *label_1283
				}
			}
			if (invctrl == 24) {
				if (invctrl(1) == 3 | invctrl(1) == 5 | invctrl(1) == 8 | invctrl(1) == 9 | invctrl(1) == 10 | invctrl(1) == 11 | invctrl(1) == 12 | invctrl(1) == 13 | invctrl(1) == 14 | invctrl(1) == 99) {
					if (inv_sum(-1) >= invcontainer) {
						snd 27
						txt -1, lang("これ以上入らない。", "The container is full.")
						goto *label_1283
					}
				}
				if (invctrl(1) == 5) {
					lint_efp = efp * 100
					if (iWeight(ci) >= limitmax(lint_efp, INT_MAX)) {
						snd 27
						txt -1, lang("重さが" + cnvweight(limitmax(lint_efp, INT_MAX)) + "以上の物は入らない。", "The container can only hold items weight less than " + cnvweight(limitmax(lint_efp, INT_MAX)) + ".")
						goto *label_1283
					}
					if (iWeight(ci) <= 0) {
						snd 27
						txt -1, lang("荷物は入らない。", "The container cannot hold cargos")
						goto *label_1283
					}
				}
				if (invctrl(1) == 5) {
					actionsp 0, 10
					if (stat == 0) {
						txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						goto *label_1286
					}
				}
				if (invctrl(1) == 14 | invctrl(1) == 99) {
					if (item_isCargoGoods(ci)) {
						snd 27
						msgdup++
						txt -1, lang("荷物は入らない。", "The container cannot hold cargos")
						goto *label_1283
					}
				}
			}
			if (invctrl == 22) {
				if (invctrl(1) == 1) {
					if (gRightsToSucceedTo < 1) {
						txt -1, lang("遺産の相続権を持っていない。", "You don't have a claim.")
						goto *label_1283
					}
				}
				if (invctrl(1) == 5) {
					actionsp 0, 10
					if (stat == 0) {
						txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						goto *label_1286
					}
				}
			}
			if (iOwnState(ci) > 0 & iOwnState(ci) < 3) {
				snd 27
				msgdup++
				if (iOwnState(ci) == 2) {
					txt -1, lang("それは持ち運べない。", "You can't carry it.")
				}
				if (iOwnState(ci) == 1) {
					txt -1, lang("それはあなたの物ではない。", "It's not your property."), lang("盗むなんてとんでもない。", "You can't just take it."), lang("それは拾えない。", "It's not yours.")
				}
				gosub *label_0623
				goto *label_1623
			}
			page_save
			if (mode == 6 & iNumber(ci) > 1 & invctrl != 22) {
				cancount = 0
				if (invctrl == 11) {
					cancount = limit(cGold(0) / calcitemvalue(ci, 0), 1, iNumber(ci))
					txt -1, lang(itemname(ci, 1) + "をいくつ買う？ (1〜" + cancount + ") ", "How many? (1 to " + iNumber(ci) + ")")
				}
				if (invctrl == 12) {
					txt -1, lang(itemname(ci, 1) + "をいくつ売る？ (1〜" + iNumber(ci) + ") ", "How many? (1 to " + iNumber(ci) + ")")
				}
				display_msg screenmsgy, 2
				if (cancount == 0) {
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
					inputlog = "" + iNumber(ci)
				} else {
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, cancount
					inputlog = "" + cancount
				}
				gosub *label_1349
				in = int(inputlog)
				if (in > iNumber(ci)) {
					in = iNumber(ci)
				}
				if (in > cancount & cancount > 0) {
					in = cancount
				}
				cancount = 0
				if (in == 0 | rtval == (-1)) {
					screenupdate = -1
					gosub *label_0623
					stick p
					cc = 0
					goto *label_1283
				}
			} else {
				if (iNumber(ci) > 1 & iId(ci) != 54 & cfg_picknumber) {
					display_msg screenmsgy, 2
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
					inputlog = "" + iNumber(ci)
					gosub *label_1349
					in = int(inputlog)
					if (in > iNumber(ci)) {
						in = iNumber(ci)
					}
					if (in == 0 | rtval == (-1)) {
						screenupdate = -1
						gosub *label_0623
						stick p
						goto *label_1283
					}
				} else {
					in = iNumber(ci)
				}
			}
			if (mode == 6 & invctrl != 22 & invctrl != 24) {
				if (cfg_shopselectskip == 0) {
					if (invctrl == 11) {
						txt -1, lang(itemname(ci, in) + "を " + in * calcitemvalue(ci, 0) + " gp で買う？", "Do you really want to buy " + itemname(ci, in) + " for " + in * calcitemvalue(ci, 0) + " gold pieces?")
					}
					if (invctrl == 12) {
						txt -1, lang(itemname(ci, in) + "を " + in * calcitemvalue(ci, 1) + " gp で売る？", "Do you really want to sell " + itemname(ci, in) + " for " + in * calcitemvalue(ci, 1) + " gold pieces?")
					}
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval != 0) {
						screenupdate = -1
						gosub *label_0623
						goto *label_1280
					}
				}
				if (invctrl == 11) {
					if (calcitemvalue(ci, 0) * in > cGold(0) & ncgdata(50) == 0) {
						screenupdate = -1
						gosub *label_0623
						txt -1, lang("あなたは財布を開いてがっかりした…", "You check your wallet and shake your head."), lang("もっと稼がないと買えない！", "You need to earn more money!")
						msgkeep = 1
						goto *label_1280
					}
				}
				if (invctrl == 12) {
					if (cRole(tc) != 1009) {
						if (calcitemvalue(ci, 1) * in > cGold(tc)) {
							screenupdate = -1
							gosub *label_0623
							txt -1, lang(name(tc) + "は財布を開いてがっかりした…", name(tc) + " checks " + his(tc) + " wallet and shake " + his(tc) + " head.")
							msgkeep = 1
							goto *label_1280
						}
					}
				}
			}
			gosub *label_1416
			if (stat == 0) {
				goto *label_1280
			}
			if (stat == (-1)) {
				goto *label_1617
			}
			if (invctrl == 22) {
				if (invctrl(1) == 1) {
					gRightsToSucceedTo--
					if (invctrl(1) == 1) {
						txt -1, lang("残り" + gRightsToSucceedTo + "個分のアイテムの相続権を持っている。", "You can claim " + gRightsToSucceedTo + " more heirloom" + _s2(gRightsToSucceedTo) + ".")
					}
				}
				if (invctrl(1) == 4) {
					gGiftCountOfLittleSister++
					invsubroutine = 0
					return 1
				}
			}
			screenupdate = -1
			gosub *label_0623
			goto *label_1280
		}
		if (invctrl == 5) {
			if (ibit(13, ci)) {
				snd 27
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *label_1283
			}
			screenupdate = -1
			gosub *label_0623
			savecycle
			if (cNutrition(0) > 10000 | gettrait(0, 191) < 0) {
				txt -1, lang("今はとても食べられない。", "Your are too full to eat."), lang("腹がさける…", "You are too bloated to eat any more."), lang("まだ腹は減っていない。", "Your stomach can't digest any more.")
				gosub *label_0623
				goto *label_1623
			}
			goto *action_doEat
		}
		if (invctrl == 6) {
			if (gettrait(cc, 161) != 0) {
				if (iWeight(ci) >= 1000) {
					txt -1, lang("それは重すぎて装備できない。", "It's too heavy to equip.")
					goto *label_1283
				}
			}
			r1 = cc
			gosub *label_1418
			r1 = cc
			gosub *chara_refresh
			screenupdate = -1
			gosub *label_0623
			snd 13
			txtnew
			txt -1, lang(itemname(ci) + "を装備した。", "You equip " + itemname(ci) + ".")
			gdata(808) = 1
			if (iCurseState(ci) == (-1)) {
				if (godcheck(cc) == "fuuri") {
					txt -1, lang(name(cc) + "は呪いの神の寵愛を感じた。", "You feel the favor from God of curse.")
				} else {
					txt -1, lang(name(cc) + "は急に寒気がしてふるえた。", "You suddenly feel a chill and shudder.")
				}
			}
			if (iCurseState(ci) == (-2)) {
				if (godcheck(cc) == "fuuri") {
					txt -1, lang(name(cc) + "は呪いの神に見守られている感じがした。", "You feel as God of curse is watching you intently.")
				} else {
					txt -1, lang(name(cc) + "は破滅への道を歩み始めた。", "You are now one step closer to doom.")
				}
			}
			if (iCurseState(ci) == 1) {
				txt -1, lang(name(cc) + "は何かに見守られている感じがした。", "You feel as someone is watching you intently.")
			}
			if (cdata(body, cc) / 10000 == 5) {
				gosub *label_1268
			}
			if (cc == 0) {
				menucycle = 1
			}
			goto *label_1270
		}
		if (invctrl == 7) {
			screenupdate = -1
			gosub *label_0623
			savecycle
			goto *label_1421
		}
		if (invctrl == 8) {
			screenupdate = -1
			gosub *label_0623
			savecycle
			goto *action_doDrink
		}
		if (invctrl == 9) {
			screenupdate = -1
			gosub *label_0623
			savecycle
			goto *label_1424
		}
		if (invctrl == 10) {
			if (invally == 1 & iNumber(ci) > 1 & cfg_transfernumber) {
				display_msg screenmsgy, 2
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
				inputlog = "1"
				gosub *label_1349
				in = int(inputlog)
				if (in > iNumber(ci)) {
					in = iNumber(ci)
				}
				if (in == 0 | rtval == (-1)) {
					screenupdate = -1
					gosub *label_0623
					goto *label_1283
				}
			} else {
				in = 1
			}
			if (ibit(13, ci)) {
				snd 27
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *label_1283
			}
			ti = inv_getfreeid(tc)
			if (cSleep(tc)) {
				txt -1, lang(name(tc) + "は眠っている。", name(tc) + " " + is(tc) + " sleeping.")
				snd 27
				goto *label_1283
			}
			if (cStoned(tc)) {
				txt -1, lang(name(tc) + "は石になっている。", name(tc) + " " + is(tc) + " stoned.")
				snd 27
				goto *label_1283
			}
			if (ti == (-1)) {
				txt -1, lang(name(tc) + "はこれ以上持てない。", his(tc) + " inventory is full.")
				snd 27
				goto *label_1283
			}
			reftype = refitem(iId(ci), 5, ci)
			if (iId(ci) == 729) {
				ctalk 0, 983, 0, tc
				txt -1, lang("あなたは" + name(tc) + "に" + itemname(ci, in) + "をプレゼントした。", "You give " + name(tc) + " " + itemname(ci, in) + ".")
				if ((Seasonal_Check(2, 0) | Seasonal_Check(3, 0)) & ogbit(9) == 0) {
					ctalk 0, 1277, 0, tc
				}
				iNumber(ci) -= in
				gosub *refreshPCBurdenState
				if ((Seasonal_Check(2, 0) | Seasonal_Check(3, 0)) & ogbit(9) == 0) {
					ctalk tc, 1327, 0, tc
					if ( stat == 0 ) {
						ctalk tc, 983, 0, tc
						if ( stat == 0 ) {
							txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」",  " " + cnvtalk("Thank you!"))
						}
					}
				} else {
					ctalk tc, 983, 0, tc
					if (stat == 0) {
						txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」",  " " + cnvtalk("Thank you!"))
					}
				}
				modimp tc, giftvalue(iParam4(ci)) * in
				cEmotionIcon(tc) = 17 + 100 * 3
				if ((Seasonal_Check(2, 0) | Seasonal_Check(3, 0)) & ogbit(9) == 0) {
						isetgiftchristmas3 = 290, 287, 480, 556, 557, 558, 559, 626, 632, 637, 702
						isetgiftchristmas2 = 421, 422, 423, 424, 425, 426, 430
						isetgiftchristmas1 = 770, 640, 574, 553, 549
					if (cdata(17, tc) >= 100) {
						flt
						if (cdata(17, tc) >= 300) {
							itemcreate -1, isetgiftchristmas3(rnd(length(isetgiftchristmas3))), cdata(1, 0), cdata(2, 0), 3
						} elseif (cdata(17, tc) >= 200) {
							itemcreate -1, isetgiftchristmas2(rnd(length(isetgiftchristmas2))), cdata(1, 0), cdata(2, 0), 3
						} else {
							itemcreate -1, isetgiftchristmas1(rnd(length(isetgiftchristmas1))), cdata(1, 0), cdata(2, 0), 3
						}
						ctalk tc, 1277, tc, 0
						if ( stat == 0 ) {
							txt tc, lang("「メリー・クリスマス！」",  " " + cnvtalk("Merry Christmas!"))
						}
						txt -1, lang("プレゼントのお返しをもらった。", "You've got a gift in return.")
					}
				}
				menucycle = 0
				invally = 0
				gosub *label_0623
				goto *label_1623
			}
			if (isflower(ci)) {
				if (Seasonal_Check(4, 0) | Seasonal_Check(5, 0)) {
					ctalk 0, 983, 0, tc
					txt -1, lang("あなたは" + name(tc) + "に" + itemname(ci, in) + "をプレゼントした。", "You give " + name(tc) + " " + itemname(ci, in) + ".")
					if (Seasonal_Check(4, 0)) {
						ctalk 0, 1325, 0, tc
					} else {
						ctalk 0, 1326, 0, tc
					}
					iNumber(ci) -= in
					gosub *refreshPCBurdenState
					if (Seasonal_Check(4, 0)) {
						ctalk tc, 1328, 0, tc
						if ( stat == 0 ) {
							ctalk tc, 983, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」",  " " + cnvtalk("Thank you!"))
							}
						}
						modimp tc, giftvalue(iParam4(ci)) * in
						cEmotionIcon(tc) = 17 + 100 * 3
					} else {
						ctalk tc, 1329, 0, tc
						if ( stat == 0 ) {
							ctalk tc, 983, 0, tc
							if (stat == 0) {
								txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」",  " " + cnvtalk("Thank you!"))
							}
						}
					}
					if (cdata(17, tc) >= 100) {
						isetgiftvalentinesday3 = 7, 8, 9
						isetgiftvalentinesday2 = 5, 6, 7
						isetgiftvalentinesday1 = 2, 3, 4
						flt
						itemcreate -1, 191, cdata(1, 0), cdata(2, 0), 1
						if (cdata(17, tc) >= 300) {
							iParam2(ci) = isetgiftvalentinesday3(rnd(length(isetgiftvalentinesday3)))
						} elseif (cdata(17, tc) >= 200) {
							iParam2(ci) = isetgiftvalentinesday2(rnd(length(isetgiftvalentinesday2)))
						} else {
							iParam2(ci) = isetgiftvalentinesday1(rnd(length(isetgiftvalentinesday1)))
						}
						if (Seasonal_Check(4, 0)) {
							ctalk tc, 1325, tc, 0
						} else {
							ctalk tc, 1326, tc, 0
						}
						txt -1, lang("プレゼントのお返しをもらった。", "You've got a gift in return.")
					}
					menucycle = 0
					invally = 0
					gosub *label_0623
					goto *label_1623
				}
			}

			f = 0
			p = sdata(10, tc) * 500 + sdata(11, tc) * 500 + sdata(153, tc) * 2500 + 25000
			if (cId(tc) == 265) {
				p *= 5
			}
			if (inv_weight(tc) + double(iWeight(ci)) * in > p) {
				f = 1
			}
			cnpcrole = 0
			if (cId(tc) == 343) {
				if (userdata2(5, cCnpcId(tc))) {
					cnpcrole = userdata2(5, cCnpcId(tc))
				}
			}
			if (cId(tc) != 265 & cId(tc) != 326 & cnpcrole != 1) {
				if (reftype == 60000) {
					if (iId(ci) != 93) {
						f = 2
					}
				}
				if (reftype == 64000) {
					f = 3
				}
			}
			if (iWeight(ci) < 0) {
				f = 4
			}
			if (f) {
				s = "", lang("重すぎ", "Too heavy!"), lang("無理", "No way."), lang("いらん", "I don't want it."), lang("イヤ！", "Never!")
				snd 27
				ctalk tc, 1231 + f, 0, tc
				if ( stat == 0 ) {
					txt tc, lang(name(tc) + "「" + s(f) + "」", cnvtalk(s(f)))
				}
				goto *label_1283
			}
			f = 0
			if (cRelationship(tc) == 10) {
				f = 1
			} else {
				itemfilter = ifiltercnv(ci)
				if (iIdentificationState(ci) < 2) {
					snd 27
					ctalk tc, 1236, 0, tc
					if ( stat == 0 ) {
						txt tc, lang("「そんな得体の知れないものはいらない" + _yo() + "」", cnvtalk("I don't want it. It's too creepy."))
					}
					goto *label_1283
				}
				if (iCurseState(ci) <= (-1)) {
					if (cId(tc) == 332 & iId(ci) == 236 & ogdata(463) == 2) {
					} else {
						snd 27
						ctalk tc, 1237, 0, tc
						if ( stat == 0 ) {
							txt tc, lang("「それ、呪われてい" + _ru() + "」", cnvtalk("It's cursed!"))
						}
						goto *label_1283
					}
				}
				if (reftype == 53000) {
					f = 1
					if (instr(itemfilter, 0, "/neg/") != (-1)) {
						f = 0
					}
					if (iId(ci) == 16 | iId(ci) == 245 | iId(ci) == 344 | iId(ci) == 521 | iId(ci) == 522 | iId(ci) == 542 | iId(ci) == 543 | iId(ci) == 572 | iId(ci) == 621 | iId(ci) == 712) {
						f = 0
					}
				}
				if (reftype == 57000) {
					if (iMaterial(ci) != 35 | iParam3(ci) >= 0) {
						if (cNutrition(tc) <= 10000) {
							f = 1
							cNutrition(tc) = 2000
						} else {
							ctalk tc, 1135, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「お腹いっぱいだからいらない" + _yo() + "」", cnvtalk("I'm Fulled."))
							}
							goto *label_1283
						}
					} else {
						ctalk tc, 1238, 0, tc
						if ( stat == 0 ) {
							txt tc, lang("「それ、腐ってい" + _ru() + "」", cnvtalk("It's rotted!"))
						}
						goto *label_1283
					}
				}
				if (reftype == 52000) {
					f = 1
					if (refitem(iId(ci), 9, ci) == 52002) {
						if (cDrunk(tc)) {
							snd 27
							ctalk tc, 1239, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「もう飲めない" + _yo() + "」", cnvtalk("Enough for me."))
							}
							goto *label_1283
						}
					}
					if (instr(itemfilter, 0, "/neg/") != (-1)) {
						f = 0
					}
					if (instr(itemfilter, 0, "/nogive/") != (-1)) {
						f = 0
					}
					if (cbit(978, tc)) {
						if (iId(ci) == 262 | iId(ci) == 519 | iId(ci) == 392) {
							f = 1
							ctalk tc, 1240, 0, tc
							if (stat == 0) {
								txt tc, lang("「おろす…」", cnvtalk("Abortion..."))
							}
						}
					}
				}
				if (iId(ci) == 477 | iId(ci) == 473) {
					if (tc >= 16) {
						f = 2
					}
				}
			}
			if (f) {
				snd 13
				txt -1, lang(itemname(ci, in) + "を渡した。", "You hand " + itemname(ci, in) + " to " + name(tc) + ".")
				ctalk 0, 1290, tc, 0
				if (stat == 0) {
					ctalk 0, 1289, tc, 0
				}
				ctalk tc, 1292, 0, tc
				if (stat == 0) {
					ctalk tc, 1291, 0, tc
				}
				if (iId(ci) == 477 | iId(ci) == 473) {
					txtef 2
					ctalk tc, 1256, cc, tc
					if (stat == 0) {
						txt -1, lang(name(tc) + "は顔を赤らめた。", name(tc) + " blushes.")
					}
					txtef 2
					ctalk tc, 982, 0, tc
					if (ibit(5, ci) == 0) {
						modimp tc, 15 * in
					}
					cEmotionIcon(tc) = 17 + 100 * 3
				}
				if (iId(ci) == 620) {
					if (cbit_isMarried(tc) & implevel(cImpression(tc)) >= 8) {
						ctalk tc, 1139, cc, tc
						if (stat == 0) {
							txt -1, lang(name(tc) + "は顔を赤らめた。", name(tc) + " blushes.")
						}
					} else {
						txtef 8
						txt -1, lang(name(tc) + "は激怒して" + itemname(ci, in) + "を叩き割った。", name(tc) + " throws it on the ground angrily.")
						snd 47
						txtef 9
						ctalk tc, 406, 0, tc
						if (stat == 0) {
							ctalk tc, 1219, 0, tc
							if (stat == 0) {
								txtef 9
								txt tc, lang(name(tc) + "「サイテー！！」", cnvtalk("You scum!")), lang(name(tc) + "「このヘンタイ！」", cnvtalk("What are you trying to do!")), lang(name(tc) + "「ガード！ガード！ガード！」", cnvtalk("Guard! Guard! Guard!"))
							}
						}
						modimp tc, (-20) * in
						cEmotionIcon(tc) = 18 + 100 * 3
						iNumber(ci) -= in
						goto *label_1280
					}
				}
				if (refitem(iId(ci), 5, ci) == 54000) {
					if (readablecheck(tc, ci) == 0) {
						txtef 4
						txt tc, lang(name(tc) + "「読めないよ？」", cnvtalk("I can't read this."))
					}
				}
				iNumber(ci) -= in
				if (f <= 1) {
					item_copy ci, ti
					iNumber(ti) = in
					item_stack tc, ti, 1
				}
				ci = ti
				rc = tc
				gosub *label_1536
				if (iequiploc(ci) != 0) {
					gosub *label_1539
				}
				if (tc < 16) {
					create_pcpic tc, 1
				}
				r1 = tc
				gosub *chara_refresh
				gosub *refreshPCBurdenState
				if (invally == 1) {
					goto *label_1280
				}
				gosub *label_0623
				goto *label_1617
			}
			snd 27
			txt -1, lang(name(tc) + "は" + itemname(ci, in) + "を受け取らない。", name(tc) + " refuse" + _s(tc) + " to take " + itemname(ci, in) + ".")
			goto *label_1283
		}
		if (invctrl == 13) {
			screenupdate = -1
			gosub *label_0623
			item_identify ci, -1, efp
			if (idtresult == 0) {
				txt -1, lang("新しい知識は得られなかった。より上位の鑑定で調べる必要がある。", "You need higher identification to gain new knowledge.")
			} else {
				if (idtresult < 3) {
					txt -1, lang("それは" + itemname(ci, iNumber(ci)) + "だと判明したが、完全には鑑定できなかった。", "The item is half-identified as " + itemname(ci, 1) + ".")
				} else {
					txt -1, lang("それは" + itemname(ci, iNumber(ci)) + "だと完全に判明した。", "The item is fully identified as " + itemname(ci, 1) + ".")
				}
			}
			item_stack 0, ci, 1
			invsubroutine = 0
			if (idtresult == 3) {
				efp -= limitmin(iDifficultyToIdentify(ci), 250)
				if (efp > 0) {
					reftype = refitem(iId(ci), 5, ci)
					inv_getheader 0
					p = 0, 0
					repeat invrange, invhead
						if (efp <= 0) {
							break
						}
						if (iNumber(cnt) == 0 | iIdentificationState(cnt) >= 3) {
							continue
						}
						p(1)++
						item_identify cnt, -1, efp
						efp -= limitmin(iDifficultyToIdentify(cnt), 250)
						if (idtresult != 0) {
							p++
							item_stack 0, cnt, 1
						}
					loop
					if (p != 0 & p(1) != 0) {
						txt -1, lang("さらに、" + p(1) + "個の未判明のアイテムのうち、" + p + "個のアイテムが判明した。", "" + p + " out of " + p(1) + " unknown items are identified.")
					}
				}
			}
			return 1
		}
		if (invctrl == 14) {
			savecycle
			goto *label_1453
		}
		if (invctrl == 16) {
			screenupdate = -1
			gosub *label_0623
			invsubroutine = 0
			return 1
		}
		if (invctrl == 15) {
			screenupdate = -1
			gosub *label_0623
			savecycle
			goto *label_1436
		}
		if (invctrl == 17) {
			cidip = ci
			savecycle
			invctrl = 18
			txtnew
			snd 26
			goto *label_1280
		}
		if (invctrl == 18) {
			screenupdate = -1
			gosub *label_0623
			goto *label_1451
		}
		if (invctrl == 19) {
			if (ibit(13, ci)) {
				snd 27
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *label_1283
			}
			screenupdate = -1
			gosub *label_0623
			savecycle
			goto *label_1092
		}
		if (invctrl == 20) {
			citrade = ci
			invctrl = 21
			snd 26
			goto *label_1280
		}
		if (invctrl == 21) {
			if (ibit(13, ci)) {
				snd 27
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *label_1283
			}
			if (cContinuousActionId(tc) != 0) {
				cContinuousActionId(tc) = 0, 0
				cContinuousActionItem(tc) = 0
			}
			snd 13
			if (ibit(12, citrade)) {
				iCount(citrade) = 0
				ibitmod 12, citrade, 0
			}
			if (iBodyPart(citrade) != 0) {
				p = iBodyPart(citrade)
				cdata(p, tc) = cdata(p, tc) / 10000 * 10000
				iBodyPart(citrade) = 0
			}
			ti = citrade
			gosub *label_1415
			txt -1, lang(itemname(citrade) + "を" + itemname(ci) + "と交換した。", "You receive " + itemname(citrade) + " in exchange for " + itemname(ci) + ".")
			convertartifact ci
			rc = tc
			ci = citrade
			if (cItemWhichWillBeUsed(rc) == ci) {
				cItemWhichWillBeUsed(rc) = 0
			}
			gosub *label_1539
			if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
				gosub *label_1541
			}
			gosub *label_1538
			r1 = tc
			gosub *chara_refresh
			gosub *refreshPCBurdenState
			invsubroutine = 0
			return 1
		}
		if (invctrl == 23) {
			if (invctrl(1) == 4 | invctrl(1) == 5) {
				if (ibit(13, ci)) {
					snd 27
					txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
					goto *label_1283
				}
			}
			item_separate ci
			invsubroutine = 0
			return 1
		}
		if (invctrl == 24) {
			if (invctrl(1) == 0) {
				snd 100
				if (gCurrentMap == 36) {
					if (iNumber(ci) > 1) {
						txt -1, lang(itemname(ci, 1) + "をいくつ納入する？ (1〜" + iNumber(ci) + ") ", "How many? (1 to " + iNumber(ci) + ")")
						display_msg screenmsgy, 1
						val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
						inputlog = "" + iNumber(ci)
						gosub *label_1349
						in = int(inputlog)
						if (in > iNumber(ci)) {
							in = iNumber(ci)
						}
						if (in == 0 | rtval == (-1)) {
							goto *label_1283
						}
					} else {
						in = 1
					}
					gdata(250 + 16) -= (iParam1(ci) + 1) * in
					if (gdata(250 + 16) <= 0) {
						gdata(250 + 16) = 0
					}
					txtef 2
					txt -1, lang(itemname(ci, 1) + "を" + in + "冊納入した", "You deliver " + itemname(ci) + ". ") + "(" + (iParam1(ci) + 1) * in + " Guild Point)"
					if (gdata(250 + 16) == 0) {
						snd 51
						txtef 2
						txt -1, lang("ノルマを達成した！", "You fulfill the quota!")
					}
					iNumber(ci) -= in
				} else {
					qdata(13, gExecutingImmediateQuest) += iWeight(ci) * iNumber(ci)
					txtef 2
					txt -1, lang(itemname(ci) + "を納入した。", "You deliver " + itemname(ci) + ".") + " +" + cnvweight(iWeight(ci) * iNumber(ci)) + lang("  納入済み", " Delivered ") + "(" + cnvweight(qdata(13, gExecutingImmediateQuest)) + ") " + lang("納入ノルマ", "Quota ") + "(" + cnvweight(qdata(12, gExecutingImmediateQuest)) + ")"
					iNumber(ci) = 0
				}
				gosub *refreshPCBurdenState
				goto *label_1280
			}
			if (invctrl(1) == 2) {
				if (cGold(0) < iSubname(ci) & ncgdata(50) == 0) {
					snd 27
					txt -1, lang("金が足りない…", "You don't have enough money.")
					goto *label_1283
				}
				if (gLeftBill <= 0) {
					snd 27
					txt -1, lang("まだ納税する必要はない。", "You don't have to pay your tax yet.")
					goto *label_1280
				}
				costvalue = iSubname(ci)
				cGold(0) -= iSubname(ci)
				gosub *label_N200
				snd 12
				txtef 2
				txt -1, lang(itemname(ci) + "を支払った。", "You pay " + itemname(ci) + ".")
				repeat 245
					if (cdata(0, cnt) == 1 & (cdata(150, cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop") | cnt < 16) ) {
						if ( synccheck(cnt, -1) ) {
							ctalk cnt, 1335, cnt, cnt
						}
					}
				loop
				throwsstpevent "PayTax", 0, "", costvalue
				iNumber(ci)--
				gLeftBill--
				gosub *refreshPCBurdenState
				screenupdate = -1
				gosub *label_0623
				goto *label_1280
			}
		}
		if (invctrl == 25) {
			if (invally == 1 & iNumber(ci) > 1 & cfg_transfernumber) {
				display_msg screenmsgy, 2
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
				inputlog = "1"
				gosub *label_1349
				in = int(inputlog)
				if (in > iNumber(ci)) {
					in = iNumber(ci)
				}
				if (in == 0 | rtval == (-1)) {
					screenupdate = -1
					gosub *label_0623
					goto *label_1283
				}
			} else {
				in = 1
			}
			ti = inv_getfreeid(0)
			if (ti == (-1)) {
				txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
				goto *label_1283
			}
			f = 0
			if (refitem(iId(ci), 5, ci) == 77000 & iId(ci) != iId_smallMedal & implevel(cImpression(tc)) < 7) {
				f = 2
			}
			if (f != 0) {
				s = "", lang("やだ", "No!"), lang("あげないよ", "It's mine."), lang("だめ", "Get off!"), lang("イヤ！", "Never.")
				snd 27
				ctalk tc, 1274, cc, tc
				if ( stat == 0 ) {
					txtef 4
					txt tc, lang(name(tc) + "「" + s(f) + "」", cnvtalk(s(f)))
				}
				goto *label_1283
			}
			if (iBodyPart(ci) != 0) {
				if (iCurseState(ci) == (-1) | iCurseState(ci) == (-2)) {
					txt -1, lang(itemname(ci) + "は呪われていて外せない。", "" + itemname(ci) + " is cursed and can't be taken off.")
					goto *label_1280
				}
				p = iBodyPart(ci)
				cdata(p, tc) = cdata(p, tc) / 10000 * 10000
				iBodyPart(ci) = 0
			}
			if (iId(ci) == 477 | iId(ci) == 473) {
				if (cbit_isMarried(tc) & iId(ci) == 477 & ibit(5, ci) == 1) {
					txt -1, lang(name(tc) + "から思い出の" + itemname(ci, in) + "を大事に受け取った。", name(tc) + " take " + itemname(ci, in) + " with good care.")
					item_copy ci, ti
					iNumber(ti) = in
					item_stack 0, ti, 1
					convertartifact ti
				} elseif (implevel(cImpression(tc)) >= 8 & cbit_isMarried(tc)) {
					txt -1, lang(name(tc) + "は思い出の" + itemname(ci, in) + "を大事にしまい込んだ。", name(tc) + " puts away " + itemname(ci, in) + " with good care.")
					ctalk tc, 1028, 0, tc
				} else {
					txtef 8
					ctalk tc, 1257, cc, tc
					if ( stat == 0 ) {
						txt -1, lang(name(tc) + "は激怒して" + itemname(ci, in) + "を飲み込んだ。", name(tc) + " swallows " + itemname(ci, in) + " angrily.")
					}
					txtef 8
					ctalk tc, 981, 0, tc
					snd 65
					modimp tc, (-20) * in
					cEmotionIcon(tc) = 18 + 100 * 3
				}
				iNumber(ci) -= in
				goto *label_1280
			}
			snd 13
			if (ibit(12, ci)) {
				iCount(ci) = 0
				ibitmod 12, ci, 0
			}
			if (iId(ci) == 54) {
				in = iNumber(ci)
			}
			txt -1, lang(itemname(ci, in) + "を受け取った。", "You take " + itemname(ci, in) + ".")
			ctalk tc, 1290, 0, tc
			if ( stat == 0 ) {
				ctalk tc, 1289, 0, tc
			}
			ctalk 0, 1292, tc, 0
			if ( stat == 0 ) {
				ctalk 0, 1291, tc, 0
			}
			if (iId(ci) == 54) {
				se_moneymod 0, in
				iNumber(ci) = 0
			} else {
				item_copy ci, ti
				iNumber(ci) -= in
				iNumber(ti) = in
				item_stack 0, ti, 1
				convertartifact ti
			}
			rc = tc
			gosub *label_1539
			if (tc < 16) {
				create_pcpic tc, 1
			}
			r1 = tc
			gosub *chara_refresh
			gosub *refreshPCBurdenState
			goto *label_1280
		}
		if (invctrl == 26) {
			savecycle
			gosub *label_1147
			if (stat != 1) {
				if (stat == 0) {
					txt -1, lang("その場所は見えない。", "You can't see the location.")
					gosub *label_0623
				}
				goto *label_1623
			}
			if (chipm(7, map(tlocx, tlocy, 0)) & 4) {
				txt -1, lang("そこには投げられない。", "The location is blocked.")
				gosub *label_0623
				goto *label_1623
			}
			goto *label_1413
		}
		if (invctrl == 27) {
			gosub *label_1462
			invsubroutine = 0
			return 1
		}
		if (invctrl == 28) {
			txtnew
			ti = inv_getfreeid(0)
			if (ti == (-1)) {
				txt -1, lang("これ以上持てない。", "Your inventory is full.")
				snd 27
				goto *label_1280
			}
			item_find 622, 3, 1
			if (stat != (-1)) {
				i = stat
				p = iNumber(i)
			} else {
				p = 0
			}
			if (ogdata(547) == 2) {
				value_item = limitmin(calcmedalvalue(ci) / 2, 1)
			} else {
				value_item = calcmedalvalue(ci)
			}
			max_item_num = p / value_item
			if (max_item_num < 1) {
				txt -1, lang("メダルの数が足りない…", "You don't have enough coins.")
				snd 27
				goto *label_1280
			}
			txt -1, lang(itemname(ci, 1) + "をいくつ交換する？ (1〜" + max_item_num + ") ", "How many? (1 to " + max_item_num + ")")
			display_msg screenmsgy, 2
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, max_item_num
			inputlog = "" + 1
			gosub *label_1349
			in = int(inputlog)
			if (in > max_item_num) {
				in = max_item_num
			}
			if (in == 0 | rtval == (-1)) {
				screenupdate = -1
				gosub *label_0623
				cc = 0
				goto *label_1283
			}
			if (p < value_item * in) {
				txt -1, lang("メダルの数が足りない…", "You don't have enough coins.")
				snd 27
				goto *label_1280
			}
			iNumber(i) -= value_item * in
			snd 12
			item_copy ci, ti
			iNumber(ti) = in
			txt -1, lang("" + itemname(ti) + "を受け取った！", "You receive " + itemname(ti) + "!")
			item_stack 0, ti, 1
			convertartifact ti, 1
			itemmemory(0, iid(ti)) = 1
			if (areaId(gCurrentMap) == 61) {
				ncgdata(360) += in
				if (ncgdata(360) >= 10) {
					newtitle 97
				}
			}
			goto *label_1280
		}
		if (invctrl == 35) {
			txtnew
			ti = inv_getfreeid(0)
			if (ti == (-1)) {
				txt -1, lang("これ以上持てない。", "Your inventory is full.")
				snd 27
				goto *label_1280
			}
			item_find 801, 3, 1
			if (stat != (-1)) {
				i = stat
				p = iNumber(i)
			} else {
				p = 0
			}
			value_item = calcfeavalue(ci)
			max_item_num = p / value_item
			if (max_item_num < 1) {
				txt -1, lang("フェアリンゴの数が足りない…", "You don't have enough coins.")
				snd 27
				goto *label_1280
			}
			txt -1, lang(itemname(ci, 1) + "をいくつ交換する？ (1〜" + max_item_num + ") ", "How many? (1 to " + max_item_num + ")")
			display_msg screenmsgy, 2
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, max_item_num
			inputlog = "" + 1
			gosub *label_1349
			in = int(inputlog)
			if (in > max_item_num) {
				in = max_item_num
			}
			if (in == 0 | rtval == (-1)) {
				screenupdate = -1
				gosub *label_0623
				cc = 0
				goto *label_1283
			}
			if (p < calcfeavalue(ci) * in) {
				txt -1, lang("フェアリンゴの数が足りない…", "You don't have enough coins.")
				snd 27
				goto *label_1280
			}
			iNumber(i) -= calcfeavalue(ci) * in
			snd 12
			item_copy ci, ti
			iNumber(ti) = in
			txt -1, lang("" + itemname(ti) + "を受け取った！", "You receive " + itemname(ti) + "!")
			item_stack 0, ti, 1
			convertartifact ti, 1
			itemmemory(0, iid(ti)) = 1
			goto *label_1280
		}
		if (invctrl == invCtrl_Blacksmith) {
			item_separate ci
			invsubroutine = 0
			return 1
		}
		if (invctrl == 31) {
			invsubroutine = 0
			return 1
		}
		if (invctrl == 32) {
			invsubroutine = 0
			return 1
		}
		if (invctrl == 33) {
			invsubroutine = 0
			return 1
		}
		if (invctrl == 34) {
			invsubroutine = 0
			return 1
		}
	}
	if (invctrl == 1 | invctrl == 2 | invctrl == 3 | invctrl == 5 | invctrl == 6 | invctrl == 10 | invctrl == 11 | invctrl == 12 | invctrl == 28 | invctrl == 35) {
		if (key == key_drink) {
			hack_equipfilter = 1
			gosub *label_2023
			equipfilter = stat
			oom_sort = 1
			screenupdate = -1
			gosub *label_0623
			goto *label_1281
		}
	}
	if (key == key_wear) {
		if (invctrl == 25) {
			var_is_pet_wear = 1
			menucycle = 0
			cc = tc
			gosub *label_1270
			var_is_pet_wear = 0
			menucycle = 1
			goto *label_1281
		}
	}
	if (key == key_identify) {
		if (listmax != 0) {
			ci = list(0, pagesize * page + cs)
			listmax_bk = listmax
			pagesize_bk = pagesize
			pagemax_bk = pagemax
			listnumber = pagesize * page + cs
			gosub *label_1290
			goto *label_1281
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1283
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1283
		}
	}
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			if (dropcontinue) {
				i = 4
			} else {
				if (invally == 1) {
					i = 2
				} else {
					if (invcontainer) {
						i = 3
					} else {
						if (mapType == 1) {
							i = 1
						} else {
							i = 0
						}
					}
				}
			}
			p = -1
			repeat 12
				if (invctrl == cycle(cnt, i)) {
					p = cnt
					break
				}
			loop
			if (p != (-1)) {
				if (key == key_next) {
					p++
					if (cycle(p, i) == (-1)) {
						p = 0
					}
				}
				if (key == key_prev) {
					p--
					if (p < 0) {
						p = cyclemax(i)
					}
				}
				if (invctrl != cycle(p, i)) {
					if (cycle(p, i) == 1 | cycle(p, i) == 2 | cycle(p, i) == 3 | cycle(p, i) == 5 | cycle(p, i) == 6 | cycle(p, i) == 10) {
					} else {
						equipfilter = 0
					}
					invctrl = cycle(p, i)
					snd 100
					screenupdate = -1
					gosub *label_0623
					goto *label_1280
				}
			}
		}
	}
	if (key == key_read & cfg_NC_itemcount != 0) {
		if (invctrl == 1) {
			ci = list(0, pagesize * page + cs)
			if (refitem(iId(ci), 5, ci) > 50000) {
				if (ibit(22, ci) == 0) {
					p = 0
					inv_getheader 0
					repeat invrange, invhead
						if (p == 5) {
							break
						}
						if (iNumber(cnt) == 0) {
							continue
						}
						if (ibit(22, cnt)) {
							p++
						}
					loop
					if (p == 5) {
						txt -1, lang("これ以上数を覚えられない。", "You cant memory " + itemname(ci) + " as count.")
					} else {
						ibitmod 22, ci, 1
						txt -1, lang(itemname(ci) + "の数を覚えることにした。", "You memory " + itemname(ci) + " as count.")
					}
				} else {
					ibitmod 22, ci, 0
					txt -1, lang(itemname(ci) + "の数を覚えるのをやめた。", "You stop memory " + itemname(ci) + " as count.")
				}
			} else {
				txt -1, lang(itemname(ci) + "の数を覚えても意味がない。", "Cant memory " + itemname(ci) + " as count.")
			}
		}
	}
	if (key == key_mode3) {
		if (invctrl == 2 & dropcontinue == 0) {
			txt -1, lang("本当に全てのアイテムを置く？", "Really put all the items?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval == 0) {
				item_count = 0
				inv_getheader 0
				repeat invrange, invhead
					if (inv_getspace(-1) == 0 | (mapItemMax != 0 & inv_sum(-1) > mapItemMax)) {
						break
					}
					ci = cnt
					if (ibit(13, ci) | (areaId(gCurrentMap) == 30 & refitem(iId(ci), 5, ci) == 92000) | iNumber(ci) == 0) {
						continue
					}
					if (iBodyPart(ci) != 0) {
						continue
					}
					item_count++
					in = iNumber(ci)
					dropval = 0
					gosub *label_1417
				loop
				nc_intb_001 = item_count
				item_count = 0
				snd 16
				txtef 0
				txt -1, lang("" + nc_intb_001 + "個のアイテムを置いた。", "put" + nc_intb_001 + "items on the floor.")
				goto *label_1623
			}
		}
		if (invctrl == 3) {
			txt -1, lang("本当に全てのアイテムを拾う？", "Really pickup all the items?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval == 0) {
				item_count = 0
				inv_getheader -1
				repeat invrange, invhead
					if (inv_getspace(0) == 0) {
						break
					}
					ci = cnt
					if (iX(ci) != cX(0) | iY(ci) != cY(0)) {
						continue
					}
					if (iOwnState(ci) != 0 | iNumber(ci) == 0) {
						continue
					}
					item_count++
					in = iNumber(ci)
					gosub *label_1416
				loop
				nc_intb_001 = item_count
				item_count = 0
				snd 16
				txtef 0
				txt -1, lang("" + nc_intb_001 + "個のアイテムを拾った。", "pickup" + nc_intb_001 + "items.")
				goto *label_1623
			}
		}
		if (invctrl == 10) {
			if (cImpression(tc) >= 100) {
				if (cGold(0) == 0 & ncgdata(50) == 0) {
					txt -1, lang("あなたは財布を開いてがっかりした…", "You check your wallet and shake your head.")
				} else {
					if (cGold(tc) == INT_MAX) {
						txt -1, lang(name(tc) + "はこれ以上金貨を持てない。", name(tc) + " can't have any more gp.")
					} else {
						nc_intb_001 = cGold(0)
						if (ncgdata(50) > 0) {
							nc_intb_001 = INT_MAX
						}
						if (nc_intb_001 > 2147483647 - cGold(tc)) {
							nc_intb_001 = 2147483647 - cGold(tc)
						}
						txt -1, lang("いくら渡す？", "How much do I give?")
						val = (windoww - 240) / 2 + inf_screenx, winposy(60), 10, 0, nc_intb_001
						inputlog = "0"
						gosub *label_1349
						in = int(inputlog)
						if (in > 0) {
							costvalue = in
							snd 12
							cGold(tc) += in
							cGold(0) -= in
							gosub *label_N200
							ctalk 0, 1156, 0, tc
							ctalk tc, 1157, tc, 0
							txt -1, lang("" + in + "gpを" + name(tc) + "に渡した。", "Gave " + in + "gp to " + name(tc))
						}
					}
				}
			}
		}
	}
	if (key == key_mode2) {
		if (invctrl == 1) {
			ci = list(0, pagesize * page + cs)
			if (ibit(13, ci) == 0) {
				ibitmod 13, ci, 1
				txt -1, lang(itemname(ci) + "を大事なものに指定した。", "You set " + itemname(ci) + " as no-drop.")
			} else {
				ibitmod 22, ci, 0
				ibitmod 13, ci, 0
				txt -1, lang(itemname(ci) + "はもう大事なものではない。", itemname(ci) + " is no longer set as no-drop.")
			}
		}
		if (invctrl == 2) {
			if (dropcontinue == 0) {
				txt -1, lang("続けてアイテムを置くことができる。", "You can continuously drop items.")
				dropcontinue = 1
				snd 100
				screenupdate = -1
				gosub *label_0623
				goto *label_1280
			}
		}
	}
	if (key == key_mode) {
		if (showresist == 1) {
			showresist = 0
		} else {
			showresist = 1
		}
		snd 1
		goto *label_1283
	}
	if (equipfilter != 0 & key == key_search) {
		oom_sort = 1 - oom_sort
		screenupdate = -1
		gosub *label_0623
		goto *label_1282
	}
	if (cfg_equipex == 1) {
		if (key == key_msglog) {
			if (showresist == 1) {
				showressub++
				if (equipfilter < 0) {
					if (showressub > 3) {
						showressub = 0
					}
				} else {
					if (showressub > 3) {
						showressub = 0
					}
					if (showressub > 1) {
						showressub = 3
					}
				}
				snd 1
			}
			goto *label_1283
		}
	}
	if (key == key_cancel) {
		if (equipfilter != 0) {
			hack_equipfilter = 1
			equipfilter = 0
			screenupdate = -1
			gosub *label_0623
			goto *label_1281
		}
*label_1286
		savecycle
		if (invctrl == 22) {
			if (invctrl(1) == 0) {
				if (listmax > 0) {
					txt -1, lang("まだアイテムが残っているがいい？", "Really leave these items?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval != 0) {
						goto *label_1283
					}
				}
			}
		}
		if (invctrl != 6 | invctrl(1) != 1) {
			cc = 0
		}
		efcancel = 1
		if (invsubroutine == 1) {
			invsubroutine = 0
			return 0
		}
		if (invctrl == 6) {
			screenupdate = -1
			gosub *label_0623
			if (cc == 0) {
				menucycle = 1
			}
			goto *label_1270
		}
		if (invctrl == 11 | invctrl == 12 | invctrl == 22 | invctrl == 28 | invctrl == 35) {
			goto *label_1494
		}
		if (invally == 1) {
			invally = 0
		}
		if (dropcontinue) {
			dropcontinue = 0
			goto *label_1617
		}
		screenupdate = 0
		gosub *label_0623
		goto *label_1623
	}
	if (invctrl == 5 | invctrl == 7 | invctrl == 8 | invctrl == 9 | invctrl == 14 | invctrl == 15 | invctrl == 26) {
		if (key == "sc") {
			p = list(0, pagesize * page + cs)
			if (iWeight(p) < 0) {
				snd 27
				txt -1, lang("荷車の荷物は登録できない。", "You can't make a shortcut for cargo stuff.")
				goto *label_1280
			}
			snd 20
			p = iId(list(0, pagesize * page + cs)) + invctrl * 10000 + inv(31, list(0, pagesize * page + cs)) * 10000 * 100
			p1 = iCurseState(list(0, pagesize * page + cs))
			p2 = 0
			if (iIdentificationState(list(0, pagesize * page + cs)) < 3) {
				p1 = (-3)
			}
			if (refitem(iId(list(0, pagesize * page + cs)), 5, list(0, pagesize * page + cs)) == 57000) {
				p2 = iParam2(list(0, pagesize * page + cs))
			}
			if (ogdata(36 + sc) == p & ((stgdata(36 + sc) == p1 & stgdata(56 + sc) == p2) | cfg_ST_shortcut == 0)) {
				ogdata(36 + sc) = 0
				stgdata(36 + sc) = 0
				stgdata(56 + sc) = 0
				goto *label_1283
			}
			repeat 20
				if (ogdata(36 + cnt) == p & ((stgdata(36 + cnt) == p1 & stgdata(56 + cnt) == p2) | cfg_ST_shortcut == 0)) {
					ogdata(36 + cnt) = 0
					stgdata(36 + cnt) = 0
					stgdata(56 + cnt) = 0
					ncgsdata(cnt) = ""
				}
			loop
			ogdata(36 + sc) = p
			stgdata(36 + sc) = p1
			stgdata(56 + sc) = p2
			ncgsdata(sc) = ""
			repeat 20
				if (gdata(40 + cnt) == p) {
					gdata(40 + cnt) = 0
				}
			loop
			gdata(40 + sc) = p
			txt -1, lang("{" + sc + "}キーにショートカットを割り当てた。", "You have assigned the shortcut to {" + sc + "} key.")
			goto *label_1283
		}
	}
*label_1287
	goto *label_1284
*label_1288
	goto *label_1291



#defcfunc trimdesc str __bbb, int __ccc
	q@m187 = __bbb
	repeat
		await
		p@m187 = instr(q@m187, 0, "\t")
		if (p@m187 != (-1)) {
			q@m187 = strmid(q@m187, 0, p@m187) + strmid(q@m187, p@m187 + 1, 99999)
			continue
		}
		if (__ccc == 1) {
			p@m187 = instr(q@m187, 0, "\n")
			if (p@m187 != (-1)) {
				q@m187 = strmid(q@m187, 0, p@m187) + strmid(q@m187, p@m187 + 1, 99999)
				continue
			}
			p@m187 = instr(q@m187, 0, "#")
			if (p@m187 != (-1)) {
				q@m187 = strmid(q@m187, 0, p@m187)
			}
			if (jp) {
				if (strmid(q@m187, strlen(q@m187) - 3, 2) == "。") {
					q@m187 = strmid(q@m187, 0, strlen(q@m187) - 3)
				}
			} else {
				p@m187 = instr(q@m187, 0, ",")
				if (p@m187 != (-1)) {
					q@m187 = strmid(q@m187, 0, p@m187) + "." + strmid(q@m187, p@m187 + 1, 99999)
					continue
				}
			}
		}
		if (__ccc == 2) {
			p@m187 = instr(q@m187, 0, "#")
			if (p@m187 != (-1)) {
				q@m187 = strmid(q@m187, 0, p@m187) + strmid(q@m187, p@m187 + 1, 99999)
				continue
			}
		}
		break
	loop
	return q@m187
*label_1290
*label_1291
	oomSEST_log "com_identify"
	if (ci < 0) {
		dialog "暫定エラー回避処置です。お手数ですが、どの持ち物メニュー(例えば飲む、振る、食べるなど）から調査(xキー)を押したか報告お願いします。"
		return
	}
	page_save
	page = 0
	pagesize = 15
	listmax = 0
	p = 0
	s = ""
	repeat 4
		description(cnt) = ""
	loop
	reftype = refitem(iId(ci), 5, ci)
	getinheritance ci, inhlist, inhmax
	dbid = iId(ci)
	cibkref = ci
	dbmode = 2
	gosub *label_2426
	dbmode = 17
	gosub *label_2426
	if (iId(ci) == 667) {
		if (iSubname(ci) != 0 & iSubname(ci) != 249 & iSubname(ci) != 176) {
			description(0) = ""
		}
	}
	if (iId(ci) != 743) {
		if (refitem(iId(ci), 5, ci) < 50000 & iParam3(ci) > 0) {
			list(0, p) = 7
			listn(0, p) = lang("元の名前:" + itemname(ci, 0, 0, 1), "Original:" + itemname(ci, 0, 0, 1))
			p++
		}
	}
	if (iIdentificationState(ci) >= 3) {
		buf = trimdesc(description(3), 1)
		if (buf != "") {
			list(0, p) = 7
			listn(0, p) = buf
			p++
		}
	}
	if (iId(ci) == 743) {
		if (useritemdatan(5, inv(31, ci)) != "<ANONYMOUS>") {
			list(0, p) = 7
			listn(0, p) = lang("それは" + useritemdatan(5, inv(31, ci)) + "により作成された", "It is created by " + useritemdatan(5, inv(31, ci)) + ".")
			p++
		}
	}
	if (gWizard) {
		list(0, p) = 7
		listn(0, p) = lang("それは" + weight2str(iWeight(ci)) + "ある", "It weighs " + weight2str(iWeight(ci)))
		if (iWeight(ci) < 0) {
			listn(0, p) += lang("(荷車)", "(Cargo goods)")
		}
		listn(0, p) += lang("", ".")
		p++
	}
	if (iWeight(ci) == 1) {
		list(0, p) = 7
		listn(0, p) = lang("それは羽のように軽い", "It is light as a feather.")
		p++
	}
	if (godcheck() == "krula") {
		list(0, p) = 7
		listn(0, p) = lang("それは金貨" + iValue(ci) + "枚分の価値を持っている", "It is worth a " + iValue(ci) + " gold coins.")
		p++
	}
	if (iIdentificationState(ci) >= 2) {
		if (iMaterial(ci) != 0) {
			list(0, p) = 7
			if (ibit(21, ci) & (iId(ci) != 477 | ibit(5, ci) == 0)) {
				if (iParam2(ci) == 343) {
					if (inv(33, ci) != usernpcmax) {
						listn(0, p) = lang("それは" + userdatan(1, inv(33, ci)) + "の" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					} else {
						listn(0, p) = lang("それは残りカスの" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					}
				} else {
					if (iParam2(ci) == 999) {
						listn(0, p) = lang("それは" + cdatan(0, 0) + "の" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					} else {
						listn(0, p) = lang("それは" + refchara(iParam2(ci), 2, 1) + "の" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					}
				}
			} else {
				listn(0, p) = lang("それは" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
			}
			p++
		}
		if (iId(ci) == 745) {
			list(0, p) = 7
			if (iParam1(ci)) {
				listn(0, p) = lang("それは" + iParam1(ci) + "回使われた", "It was used " + iParam1(ci) + " by you.")
			} else {
				listn(0, p) = lang("それはまだ使われていない", "It has not been used yet.")
			}
			p++
		}
		if (iId(ci) == 619 & iSubname(ci) == 30) {
			list(0, p) = 7
			if (iParam2(ci) != 0) {
				if (iParam1(ci) == 343) {
					if (inv(33, ci) != usernpcmax) {
						listn(0, p) = lang("それは" + userdatan(1, inv(33, ci)) + "と", ".")
					} else {
						listn(0, p) = lang("それは残りカスと", ".")
					}
				} else {
					if (iParam1(ci) == 999) {
						listn(0, p) = lang("それは" + cdatan(0, 0) + "と", ".")
					} else {
						listn(0, p) = lang("それは" + refchara(iParam1(ci), 2, 1) + "と", ".")
					}
				}
				if (iParam2(ci) == 343) {
					if (iParam3(ci) != usernpcmax) {
						listn(0, p) += lang(userdatan(1, iParam3(ci)) + "の薄い本だ", ".")
					} else {
						listn(0, p) += lang("残りカスのあられもない姿が記録された本だ", ".")
					}
				} else {
					if (iParam2(ci) == 999) {
						listn(0, p) += lang(cdatan(0, 0) + "の薄い本だ", ".")
					} else {
						listn(0, p) += lang(refchara(iParam2(ci), 2, 1) + "の薄い本だ", ".")
					}
				}
			} else {
				if (iParam1(ci) == 343) {
					if (inv(33, ci) != usernpcmax) {
						listn(0, p) = lang("それは" + userdatan(1, inv(33, ci)) + "のあられもない姿が記録された本だ", ".")
					} else {
						listn(0, p) = lang("それは残りカスのあられもない姿が記録された本だ", ".")
					}
				} else {
					if (iParam1(ci) == 999) {
						listn(0, p) = lang("それは" + cdatan(0, 0) + "のあられもない姿が記録された本だ", ".")
					} else {
						listn(0, p) = lang("それは" + refchara(iParam1(ci), 2, 1) + "のあられもない姿が記録された本だ", ".")
					}
				}
			}
			p++
		}
		if (iMaterial(ci) == 8) {
			list(0, p) = 7
			listn(0, p) = lang("それは装備している間、エーテルの病の進行を早める", "It speeds up the ether disease while equipping.")
			p++
		}
		if (ibit(1, ci)) {
			list(0, p) = 7
			listn(0, p) = lang("それは酸では傷つかない", "It is acidproof.")
			p++
		}
		if (ibit(2, ci)) {
			list(0, p) = 7
			listn(0, p) = lang("それは炎では燃えない", "It is fireproof.")
			p++
		}
		if (ibit(5, ci)) {
			list(0, p) = 7
			listn(0, p) = lang("それは貴重な品だ", "It is precious.")
			p++
		}
		if (ibit(8, ci)) {
			list(0, p) = 7
			godindext = getgodindex(iParam4(ci))
			if (godindext != (-1)) {
				listn(0, p) = lang("それは" + cnven(cgodshortname(godindext)) + "の祝福を受けている", "It is blessed by " + cnven(cgodshortname(godindext)) + ".")
			} elseif (iParam4(ci) == 1) {
				listn(0, p) = lang("それはマニの祝福を受けている", "It is blessed by Mani.")
			} elseif (iParam4(ci) == 2) {
				listn(0, p) = lang("それはルルウィの祝福を受けている", "It is blessed by Lulwy.")
			} elseif (iParam4(ci) == 3) {
				listn(0, p) = lang("それはイツパロトルの祝福を受けている", "It is blessed by Itzpalt.")
			} elseif (iParam4(ci) == 5) {
				listn(0, p) = lang("それはオパートスの祝福を受けている", "It is blessed by Opatos.")
			} elseif (iParam4(ci) == 6) {
				listn(0, p) = lang("それはジュアの祝福を受けている", "It is blessed by Jure.")
			} elseif (iParam4(ci) == 7) {
				listn(0, p) = lang("それはクミロミの祝福を受けている", "It is blessed by Kumiromi.")
			} else {
				listn(0, p) = lang("それはエヘカトルの祝福を受けている", "It is blessed by Ehekatl.")
			}
			p++
		}
		if (ibit(9, ci)) {
			list(0, p) = 7
			listn(0, p) = lang("それは盗品だ", "It is a stolen item.")
			p++
		}
		if (ibit(10, ci)) {
			list(0, p) = 7
			listn(0, p) = lang("それは生きている", "It is alive.") + " [Lv:" + iParam1(ci) + " Exp:" + limit(iParam2(ci) * 100 / calcexpalive(iParam1(ci)), 0, 100) + "%]"
			p++
		}
		if (reftype == 10000 | reftype == 25000 | refitem(iId(ci), 9, ci) == 24030) {
			if (ibit(14, ci)) {
				list(0, p) = 7
				listn(0, p) = lang("それは" + ioriginalnameref(inv(36, ci) \ 1000) + "が塗られている", "It is put " + ioriginalnameref(inv(36, ci) \ 1000) + " on.")
				if (gWizard) {
					listn(0, p) += " (" + (inv(36, ci) / 1000 / 5 + sdata(iSkill(ci), cc) * 1.5) + "）"
				}
				p++
			}
		}
		if (ibit(16, ci)) {
			list(0, p) = 7
			listn(0, p) = lang("それはショウルームでのみ使用できる。", "It can be only used in a show room.")
			p++
		}
		if (ibit(17, ci)) {
			list(0, p) = 7
			if (iId(ci) == 667) {
				listn(0, p) = lang("それは心温まる手作り品だ", "It is a hand-made item.")
			} else {
				if (gCurrentMap != 35) {
					namae = cdatan(0, 0)
				} else {
					namae = lang("誰か", "someone")
				}
					listn(0, p) = lang("それは" + namae + "により作成された", "It is created by " + namae + ".")
				if (iQuality(ci) == 4) {
					listn(0, p) = lang("それは" + namae + "の良品だ", "It is created by " + namae + ".")
				}
				if (iQuality(ci) == 5) {
					listn(0, p) = lang("それは" + namae + "の秀品だ", "It is created by " + namae + ".")
				}
				if (refitem(iId(ci), 5, ci) == 60000) {
					listn(0, p) = lang("それは" + namae + "が加工を行った", "It is created by " + namae + ".")
				}
				if (iId(ci) == 477 & ibit(5, ci) == 1) {
					listn(0, p) = lang("それは貴重な思い出の品だ", "It is a SP item.")
				}
				// ST_END
			}
			p++
		}
		if (ibit(20, ci)) {
			list(0, p) = 7
			listn(0, p) = lang("それは転移先の目印として機能する。", "It can be only used in a show room.")
			p++
		}
		if (equalsitem(ci, "blacksmith hammer")) {
			list(0, p) = 7
			listn(0, p) = "[Lv:" + iParam1(ci) + " Exp:" + fixtxt("" + double(iParam2(ci) * 100) / double(calcexpalive(iParam1(ci))), 6) + "%]"
			p++
		}
		if (iId(ci) == 618) {
			if (iSubname(ci) >= 37) {
				if (iIdentificationState(ci) == 3) {
					if (iParam2(ci) == 0) {
						list(0, p) = 7
						listn(0, p) = "Point: " + iValue(ci)
						p++
					}
				}
			}
		}
		calcweaponfix iId(ci), ci
		if (iDiceX(ci) != 0) {
			list(0, p) = 5
			listn(0, p) = lang("それは武器として扱うことができる", "It can be wielded as a weapon.") + " (" + iDiceX(ci) + "d" + iDiceY(ci) + lang(" 貫通 ", " Pierce ") + pierce + "%)"
			p++
			_switch_val = iSkill(ci)
			if (_switch_val == 110 | _switch_sw) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは不死の存在に対して威力が通りにくい", "It is ineffective against undeads.")
				p++
				goto *label_1292
				_switch_sw++
			}
			if (_switch_val == 111 | _switch_sw) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは浮遊している存在に対して威力をよく通す", "It is effective againast flying units.")
				p++
				goto *label_1292
				_switch_sw++
			}
			if (_switch_val == 104 | _switch_sw) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは使用者より遅い存在に対して威力をよく通す", "It is effective against units slower than the user.")
				p++
				goto *label_1292
				_switch_sw++
			}
			if (_switch_val == 102 | _switch_sw) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは防具を装備していない存在に対して威力をよく通す", "It is effective against units not wearing armor.")
				p++
				goto *label_1292
				_switch_sw++
			}
			if (_switch_val == 103 | _switch_sw) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは重装備の存在に対して威力をよく通す", "It is effective against units wearing heavy armor.")
				p++
				list(0, p) = 5
				listn(0, p) = lang("それはやどかりに対して威力をよく通す", "It is effective against hermit crabs.")
				p++
				list(0, p) = 5
				listn(0, p) = lang("それはゴーレムに対して威力をよく通す", "It is effective against golems.")
				p++
				list(0, p) = 5
				listn(0, p) = lang("それはスライムに対して威力が通りにくい", "It is ineffective against slimes.")
				p++
				goto *label_1292
				_switch_sw++
			}
			if (_switch_val == 108 | _switch_sw) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは遠隔武器を装備していない存在に対して威力をよく通す", "It is effective against units without a ranged weapon equippped.")
				p++
				goto *label_1292
			}
*label_1292
			if (reftype == 10000) {
				if (iWeight(ci) <= 1500) {
					list(0, p) = 5
					listn(0, p) = lang("それは片手でも扱いやすい", "It is a light weapon.")
					p++
				}
				if (iWeight(ci) >= 4000) {
					list(0, p) = 5
					listn(0, p) = lang("それは両手持ちに適している", "It is a heavy weapon.")
					p++
				}
			}
		}
		if (iHitBonus(ci) != 0 | iDamageBonus(ci) != 0) {
			list(0, p) = 5
			listn(0, p) = lang("それは攻撃修正に" + iHitBonus(ci) + "を加え、ダメージを" + iDamageBonus(ci) + "増加させる", "It modifies hit bonus by " + iHitBonus(ci) + " and damage bonus by " + iDamageBonus(ci) + ".")
			p++
		}
		if ((iPv(ci) != 0 | iDv(ci) != 0) & iId(ci) != iId_egg) {
			list(0, p) = 6
			listn(0, p) = lang("それはDVを" + iDv(ci) + "上昇させ、PVを" + iPv(ci) + "上昇させる", "It modifies DV by " + iDv(ci) + " and PV by " + iPv(ci) + ".")
			p++
		}
	}
	if (iIdentificationState(ci) < 2) {
		list(0, p) = 0
		listn(0, p) = lang("このアイテムに関する知識を得るには、鑑定する必要がある。", "You have to identify the item to gain knowledge.")
		p++
	}
	if (iIdentificationState(ci) >= 3) {
		// ビッグエンチャント
		if (check_bigench(ci) != 0) {
			list(0, p) = 4
			bigbuf = check_bigench(ci)
			if (bigbuf == 1) {
				listn(0, p) = lang("それは運動を阻害しない", "It does not inhibit movement.")
			}
			if (bigbuf == 2) {
				listn(0, p) = lang("それは属性追加ダメージを強化する", "It enhances attribute extra damage.") + "(×" +strf("%.1f",(0.0 + iBigenchantmentPower(ci)) / 10 + 1.0) + ")"
			}
			if (bigbuf == 3) {
				listn(0, p) = lang("それはエンチャント封印に耐性をもつ", "It reduces effects of enchantment sealing.")
			}
			if (bigbuf == 4) {
				listn(0, p) = lang("それは攻撃対象を過剰回復させる", "It over-recovers the target.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 5) {
				listn(0, p) = lang("それは信仰の恩恵を増幅させる", "It amplifies the benefits of religion.") + "(×" + (iBigenchantmentPower(ci) + 1) + ")"
			}
			if (bigbuf == 6) {
				listn(0, p) = lang("それは全ての能力値を維持する", "It maintains all stats.")
			}
			if (bigbuf == 7) {
				listn(0, p) = lang("それはマナの消費を軽減する", "It reduces mana consumption.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 8) {
				listn(0, p) = lang("それは消費したマナを生命力に還元する", "It returns mana consumed to hp.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 9) {
				listn(0, p) = lang("それは稀に攻撃対象のエンチャントを封印する", "It seals up the target enchantment.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 10) {
				listn(0, p) = lang("それは稀に攻撃対象のバフを除去する", "It removes target buffs.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 11) {
				listn(0, p) = lang("それは病気の治りを遅くする", "It slows the healing of the disease.")
			}
			if (bigbuf == 12) {
				listn(0, p) = lang("それは金貨を栄養に変換する", "It converts gold coins into nutrition.")
			}
			if (bigbuf == 13) {
				listn(0, p) = lang("それは使用者を酔わせる", "It intoxicates the user.")
			}
			if (bigbuf == 14) {
				listn(0, p) = lang("それはエーテル病の進行を遅くする", "It slows the ether curse.")
			}
			if (bigbuf == 15) {
				listn(0, p) = lang("それは荷物の重量を軽くする", "It reduces the weight of luggage.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 16) {
				listn(0, p) = lang("それは呪いの影響を軽減する", "It reduces the effect of the curse.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 17) {
				listn(0, p) = lang("それは稀に倒れた味方を蘇らせる", "It revives a rarely fallen ally.") + "(" + iBigenchantmentPower(ci) + "%)"
			}
			if (bigbuf == 18) {
				listn(0, p) = lang("それは媚薬が乾かない", "That aphrodisiac does not dry.")
			}
			if (bigbuf >= 10000) {
				listn(0, p) = lang("それは" + skillname(bigbuf \ 10000) + "を少しずつ成長させる", "It grows " + skillname(bigbuf \ 10000) + " little by little") + "(×" + iBigenchantmentPower(ci) + ")"
			}
			p++
		}
		repeat 15
			if (iEnchantmentId(ci, cnt) == 0) {
				break
			}
			val = iEnchantmentId(ci, cnt), iEnchantmentPower(ci, cnt), 0, reftype
			getencproc encprocref2, ci, val
			gosub *label_0297
			listn(0, p) = lang("それは", "It ") + s
			list(0, p) = rtval, rtval(1)
			if (inhmax > 0) {
				cnt2 = cnt
				repeat inhmax
					if (cnt2 == inhlist(cnt)) {
						list(0, p) += 10000
						break
					}
				loop
			}
			p++
		loop
		if (ibit(15, ci)) {
			list(0, p) = 4
			listn(0, p) = lang("相手は死ぬ", "The enemy dies.")
			p++
		}
		if (gWizard & iId(ci) == 792) {
			list(0, p) = 4
			listn(0, p) = lang("効果１：" + iParam1(ci), "")
			p++
			list(0, p) = 4
			listn(0, p) = lang("効果２：" + iParam2(ci), "")
			p++
			list(0, p) = 4
			listn(0, p) = lang("効果３：" + iParam3(ci), "")
			p++
		}
		if (1) {
			repeat 3
				if (description(cnt) == "") {
					continue
				}
				list(0, p) = 0
				listn(0, p) = ""
				p++
				buf = trimdesc(description(cnt), 2)
				notesel buf
				repeat noteinfo(0)
					noteget q, cnt
					p(1) = 66, 0
					if (strlen(q) > p(1)) {
						repeat strlen(q) / p(1) + 1
							if (strlen(q) > p(2) + p(1)) {
								if (mbsbtype(q, p(2) + p(1)) == 2) {
									p(1) -= 1
								}
							}
							if (strmid(q, p(2) + p(1), 2) == "。" | strmid(q, p(2) + p(1), 2) == "、") {
								p(1) += 2
							}
							if (strmid(q, p(2), p(1)) == "") {
								break
							}
							list(0, p) = -1
							listn(0, p) = strmid(q, p(2), p(1))
							p++
							p(2) += p(1)
							p(1) = 66
						loop
					} else {
						list(0, p) = 0
						listn(0, p) = q
						if (cnt == noteinfo(0) - 1) {
							list(0, p) = -2
						}
						p++
					}
				loop
			loop
		}
	}
	if (p == 0) {
		list(0, p) = 0
		listn(0, p) = lang("特に情報はない", "There is no information about this object.")
		p++
	}
	listmax = p
	pagemax = (listmax - 1) / pagesize
	if (dump_return == 1) {
		dump_return = 0
		return
	}
	snd 26
	windowshadow = 1
*label_1293
	key_list = key_enter
	keyrange = 0
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1294
	redraw 0
	if(inv_getowner(ci) != 56) {
		s = lang("アイテムの知識", "Known Information ") + "\t(" + (listnumber + 1) + "/" + listmax_bk + ")", strhint4 + strhint3 + oomsest_strhint6
	} else {
		s = lang("アイテムの知識", "Known Information "), strhint4 + strhint3
	}
	display_window (windoww - 600) / 2 + inf_screenx, winposy(408), 600, 408
	display_topic itemname(ci), wx + 28, wy + 34
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 68, wy + 68 + cnt * 18
		if (list(0, p) \ 10000 == 1) {
			color 0, 100, 0
		}
		if (list(0, p) \ 10000 == 2) {
			color 0, 0, 100
		}
		if (list(0, p) \ 10000 == 3) {
			color 80, 100, 0
		}
		if (list(0, p) \ 10000 == 4) {
			color 80, 50, 0
		}
		if (list(0, p) \ 10000 == 9) {
			color 180, 0, 0
		}
		if (list(0, p) \ 10000 == 8) {
			color 0, 100, 100
		}
		if (list(0, p) == (-1)) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		}
		if (list(0, p) == (-2)) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 2
			pos wx + ww - strlen(listn(0, p)) * 6 - 80, wy + 68 + cnt * 18
		}
		mes listn(0, p)
		if (list(0, p) > 0) {
			pos wx + 40, wy + 61 + cnt * 18
			gcopy 3, 72 + list(0, p) \ 10000 * 24, 336, 24, 24
		}
		if (list(0, p) > 10000) {
			pos wx + 15, wy + 63 + cnt * 18
			gcopy 3, 384, 360, 24, 24
		}
	loop
	redraw 1
	await cfg_wait1
	key_check
	if(inv_getowner(ci) != 56) {
		if (key == key_north) {
			snd 5
			page_load
			cs--
			if (cs < 0) {
				page--
				cs = pagesize_bk - 1
			}
			listnumber--
			if (listnumber < 0) {
				listnumber = listmax_bk - 1
				page = pagemax_bk
				if (fromequip == 1) {
					cs = listmax_bk \ 14 - 1
					if (cs < 0) {
						cs = 13
					}
				} else {
					cs = listmax_bk \ 16 - 1
					if (cs < 0) {
						cs = 15
					}
				}
			}
			if (fromequip == 1) {
				repeat
					if (cdata(list_bk(0, listnumber), cc) \ 10000 != 0) {
						ci = cdata(list_bk(0, listnumber), cc) \ 10000 - 1
						break
					} else {
						cs--
						if (cs < 0) {
							page--
							cs = pagesize_bk - 1
						}
						listnumber--
						if (listnumber < 0) {
							listnumber = listmax_bk - 1
							page = pagemax_bk
							cs = listmax_bk \ 14 - 1
							if (cs < 0) {
								cs = 13
							}
						}
					}
				loop
			} else {
				ci = list_bk(0, listnumber)
			}
			goto *label_1290
		}
		if (key == key_south) {
			snd 5
			page_load
			cs++
			if (cs >= pagesize_bk) {
				page++
				cs = 0
			}
			listnumber++
			if (listnumber >= listmax_bk) {
				listnumber = 0
				page = 0
				cs = 0
			}
			if (fromequip == 1) {
				repeat
					if (cdata(list_bk(0, listnumber), cc) \ 10000 != 0) {
						ci = cdata(list_bk(0, listnumber), cc) \ 10000 - 1
						break
					} else {
						cs++
						if (cs >= pagesize_bk) {
							page++
							cs = 0
						}
						listnumber++
						if (listnumber >= listmax_bk) {
							listnumber = 0
							page = 0
							cs = 0
						}
					}
				loop
			} else {
				ci = list_bk(0, listnumber)
			}
			goto *label_1290
		}
	}
	if (key == key_west) {
		key = key_pagedown
	}
	if (key == key_east) {
		key = key_pageup
	}
	if (cs >= keyrange) {
		cs_bk = -1
		cs = keyrange - 1
		if (cs < 0) {
			cs = 0
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1293
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1293
		}
	}
	if (inv_getowner(ci) != 56) {
		if (key == key_mode3) {
			gosub *label_N1000
		}
	}
	if (key == key_cancel | key == key_enter) {
		returnfromidentify = 1
		fromequip = 0
		return
	}
	goto *label_1294
*label_1295
*label_1296
	repeat ocdata(155, cc)
		if (cState(ocdata(150, cc) - 1) != 1) {
			unlockon cc, ocdata(150, cc) - 1
			continue
		} else {
			if (synccheck(ocdata(150, cc) - 1, -1) == 0) {
				unlockon cc, ocdata(150, cc) - 1
				continue
			}
		}
		break
	loop
	if (ocdata(155, cc) == 0) {
		gosub *label_1301
		if (listmax != 0) {
			f = 0
			if (cc == 0) {
				p = -3, -1, 0
				p(49) = 3
			} else {
				if (cRelationship(cc) >= 0) {
					p = -3
					p(49) = 1
				} else {
					p = 10, 0
					p(49) = 2
				}
			}
			repeat p(49)
				cnt2 = cnt
				repeat listmax
					if (cRelationship(list(0, cnt)) <= p(cnt2)) {
						lockson cc, list(0, cnt), 2
						f = 1
						break
					}
				loop
				if (f == 1) {
					break
				}
			loop
		}
	}
	if (ocdata(155, cc) == 0 | cBlind(cc) != 0) {
		if (cc == 0) {
			txt -1, lang("ターゲットが見当たらない。", "You find no target.")
			gosub *label_0623
		}
		return 0
	}
	return 1
*label_1297
	txttargetlevel
	txt -1, s
	txt -1, lang("本当に" + name(tc) + "を攻撃する？ ", "Really attack " + name(tc) + "? ")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *label_1353
	if (rtval == 0) {
		gosub *label_0623
		return 1
	} else {
		gosub *label_0623
		return 0
	}
*label_1298
	cc = 0
	gosub *label_1295
	if (stat == 0) {
		goto *label_1623
	}
	tc = ocdata(150, 0) - 1
	if (cRelationship(tc) >= 0) {
		gosub *label_1297
		if (stat == 0) {
			goto *label_1623
		}
	}
	gosub *label_1299
	if (stat == (-1)) {
		msgdup++
		txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
		gosub *label_0623
		goto *label_1623
	}
	if (stat == (-2)) {
		msgdup++
		txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
		gosub *label_0623
		goto *label_1623
	}
	if (stat == (-3)) {
		msgdup++
		txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
		gosub *label_0623
		goto *label_1623
	}
	gosub *label_1441
	goto *label_1617
*label_1299
	cw = -1
	ammo = -1
	attacknum = 0
	repeat 30
		body = 100 + cnt
		if (cdata(body, cc) \ 10000 == 0) {
			continue
		}
		if (cdata(body, cc) / 10000 == 10) {
			cw = cdata(body, cc) \ 10000 - 1
		}
		if (cdata(body, cc) / 10000 == 11) {
			ammo = cdata(body, cc) \ 10000 - 1
		}
	loop
*label_1300
	if (cw == (-1)) {
		cw = 0
		return -1
	}
	if (ammo == (-1)) {
		if (iSkill(cw) != 111) {
			cw = 0
			return -2
		}
	}
	if (ammo != (-1)) {
		if (iSkill(cw) != 111) {
			if (iSkill(cw) != iSkill(ammo)) {
				return -3
			}
		} else {
			ammo = -1
		}
	}
	attackskill = iSkill(cw)
	return 1
*label_1301
	listmax = 0
	repeat 2
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (synccheck(cnt, -1) == 0) {
				continue
			}
			x = cX(cnt)
			y = cY(cnt)
			if (x == cX(cc) & y == cY(cc)) {
				continue
			}
			if (fov_los(cX(cc), cY(cc), x, y) == 0) {
				continue
			}
			if (cbit(6, cnt) == 1) {
				if (cbit(7, cc) == 0) {
					if (cWet(cnt) == 0) {
						continue
					}
				}
			}
			list(0, listmax) = cnt, x, y
			listmax++
			if (listmax >= 500 - 1) {
				break
			}
		loop
		if (listmax != 0) {
			break
		}
	loop
	repeat
		if (listmax < 2) {
			break
		}
		i = 1
		repeat listmax - 1
			p = dist(cX(cc), cY(cc), list(1, cnt), list(2, cnt))
			p(1) = dist(cX(cc), cY(cc), list(1, cnt + 1), list(2, cnt + 1))
			if (p(1) < p) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				i = 0
				break
			}
		loop
		if (i == 1) {
			break
		}
	loop
	return
*label_1302
	r1 = 50
	gosub *label_1374
	goto *label_1617
*label_1303
	txt -1, lang(actlistn(cContinuousActionId(cc)) + "を中断したほうがいいだろうか？ ", "Do you want to cancel " + actlistn(cContinuousActionId(cc)) + "? ")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *label_1353
	return
*label_1304
	txtnew
	if (gCurrentMap == 35) {
		txtef 3
		txt -1, lang("ユーザーマップの中ではセーブできない。それでも終了する？", "You can't save the game in a user made map. Exit anyway?")
	} else {
		txt -1, lang("これまでの冒険を記録して終了する？", "Do you want to save the game and exit?")
	}
	promptl(0, promptmax) = lang("はい", "Exit"), "a", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("いいえ", "Cancel"), "b", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ゲーム設定", "Game Setting"), "c", "" + promptmax
	promptmax++
	val = promptx, prompty, 190, 1
	gosub *label_1353
	if (rtval == 0) {
		if (gCurrentMap != 35) {
			snd 44
			// 無事にセーブフラグ
			if (nc_intb_nightmare) {
				ncgdata(108) = 1
			}
			gosub *label_1339
			txt -1, lang("無事に記録された。", "Your game has been saved successfully.")
			txt -1, lang(name(cc) + "は静かに目を閉じた… (キーを押すと自動終了します)", "You close your eyes and peacefully fade away. (Hit any key to exit)")
			throwsstpevent "GameQuit", 0, "", 0
			msg_halt
			gosub *label_0623
		}
		await 300
		goto *system_quitElona
	}
	if (rtval == 2) {
		snd 20
		goto *label_1598
	}
	gosub *label_0623
	goto *label_1623
*label_1305
	f = 0
	repeat 5
		p = gdata(160 + cnt)
		if (qdata(8, p) == 1) {
			if (qdata(3, p) == 1007 | qdata(3, p) == 1002) {
				f = 1
				break
			}
		}
	loop
	if (ogdata(24) == 1 & gdata(73) != 3) {
		f = 1
	}
	return f
*label_1306
	gosub *label_1305
	if (stat == 1) {
		txt -1, lang("依頼請負中の帰還は法律で禁止されている。それでも帰還する？", "Returning while taking a quest if forbidden. Are you sure you want to return?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval != 0) {
			gosub *label_0623
			return
		}
	}
	p = 0
	i = 7
	if (ogdata(463) == 2) {
		list(0, p) = i, -2
		promptl(0, promptmax) = lang("わが家 任意地下階", "Home specified Lv"), "null", "" + promptmax
		promptmax++
		p++
	}
	list(0, p) = i, 1
	promptl(0, promptmax) = mapname(i), "null", "" + promptmax
	promptmax++
	p++
	repeat 500
		i = 500 - (cnt + 1)
		if (areaId(i) == 0) {
			continue
		}
		if (ogdata(536) == 2) {
			if (efstatus >= 1) {
				if (areaId(i) == 5 | areaId(i) == 11 | areaId(i) == 12 | areaId(i) == 14 | areaId(i) == 15 | areaId(i) == 33 | areaId(i) == 36 | areaId(i) == 43 | areaId(i) == 46 | areaId(i) == areaId_serria | areaId(i) == areaId_tormat | areaId(i) == areaId_khios | areaId(i) == areaId_carlia | areaId(i) == areaId_trian) {
					if (areaOuterMap(i) != gdata(850)) {
						f = 1
					}
				}
			}
		}
		if (areaOuterMap(i) != gdata(850) & f == 0) {
			continue
		}
		if (areaId(i) == 7) {
			continue
		}
		if (areaVisitedDeepestFloor(i) == 0) {
			continue
		}
		f = 0
		if (areaId(i) == 3 | areaId(i) == 25 | areaId(i) == 29 | areaId(i) == 42 | areaId(i) == 39 | areaId(i) == 45 | areaId(i) == 48) {
			f = 1
		}
		if (ogdata(533) == 2) {
			if (areaId(i) == 60) {
				f = 1
			}
		}
		if (ogdata(537) == 2) {
			if (areaId(i) == 61) {
				f = 1
			}
		}
		if (efstatus >= 1) {
			/*帰還の処理?*/
			if (ogdata(449) == 2 | efstatus == 2) {
				if (areaId(i) == 5 | areaId(i) == 11 | areaId(i) == 12 | areaId(i) == 14 | areaId(i) == 15 | areaId(i) == 33 | areaId(i) == 36 | areaId(i) == 43 | areaId(i) == 46 | areaId(i) == areaId_serria | areaId(i) == areaId_tormat | areaId(i) == areaId_khios | areaId(i) == areaId_carlia | areaId(i) == areaId_trian) {
					f = 1
				}
			}
			if (ogdata(450) == 2) {
				if (areaId(i) == 22 | areaId(i) == 23 | areaId(i) == 24) {
					f = 1
				}
			}
			if (ogdata(535) == 2) {
				if (areaId(i) == 59) {
					f = 1
				}
			}
		}
		if (gWizard | 0) {
			if (areaType(i) == 3 | areaType(i) == 2) {
				f = 1
			}
		}
		if (f == 1) {
			if (ogdata(448) == 2) {
				if (areaId(i) == 3) {
					list(0, p) = i, 1
					promptl(0, promptmax) = lang("レシマス 1階", "Lesimas 1st Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
			if (ogdata(533) == 2) {
				if (areaId(i) == 60) {
					list(0, p) = i, -1
					promptl(0, promptmax) = lang("変異種の洞窟 任意階", "Mutant Cave specified Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
			if (ogdata(499) == 2) {
				if (areaId(i) == 42) {
					list(0, p) = i, -1
					promptl(0, promptmax) = lang("すくつ 任意階", "The Void specified Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
			if (areaId(i) == 39) {
				list(0, p) = i, 1
				promptl(0, promptmax) = lang("ダンジョン", "Dungeon"), "null", "" + promptmax
				promptmax++
				p++
			} else {
				if (areaType(i) == 3 | areaType(i) == 2 | areaType(i) == 6) {
					list(0, p) = i, 1
					promptl(0, promptmax) = mapname(i), "null", "" + promptmax
					promptmax++
					p++
				} else {
					list(0, p) = i, areaVisitedDeepestFloor(i)
					promptl(0, promptmax) = mapname(i) + " " + cnvrank(areaVisitedDeepestFloor(i) - areaDangerLevel(i) + 1) + lang("階", " Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
		}
	loop
	listmax = p
	if (listmax == 0) {
		txt -1, lang("この大陸には帰還できる場所が無い。", "You don't know any location you can return to")
		return
	}
	txt -1, lang("どの場所に帰還する？", "Where do you want to go?")
	display_msg inf_screeny + inf_tiles
	val = promptx, prompty, 240 + (listmax / 16 * 240), 1
	gosub *label_1353_001
	gosub *label_0623
	if (rtval >= 0) {
		if (list(1, rtval) == (-1)) {
			txt -1, lang("どの階に帰還する？", "Where Lv do you want to go?")
			if (gWizard) {
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, 100000
			} else {
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, areaVisitedDeepestFloor(list(0, rtval)) - areaDangerLevel(list(0, rtval)) + 1
			}
			inputlog = "1"
			p@se = rtval
			gosub *label_1349
			if (rtval == (-1)) {
				goto *label_1306
			}
			rtval = p@se
			list(1, rtval) = int(inputlog) + areaDangerLevel(list(0, rtval)) - 1
		}
		if (list(1, rtval) == (-2)) {
			txt -1, lang("地下何階に帰還する？", "Where Lv do you want to go?")
			f = 10
			if (ncgdata(5) == 1) {
				f = 20
			}
			if (ncgdata(5) == 2) {
				f = 30
			}
			if (ncgdata(5) == 3) {
				f = 40
			}
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 0, f - 1
			inputlog = "0"
			p@se = rtval
			gosub *label_1349
			if (rtval == (-1)) {
				goto *label_1306
			}
			rtval = p@se
			list(1, rtval) = int(inputlog) + 1
		}
		txt -1, lang("周囲の大気がざわめきだした。", "The air around you becomes charged.")
		if (areaId(gCurrentMap) == 8) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				if (areaHasBeenConquered(gCurrentMap) != (-1)) {
					txt -1, lang("このままダンジョンを出ると、この階のクエストは達成できない…", "The lord of the dungeon might disappear if you escape now.")
				}
			}
		}
		item_find 92000, 0, 1
		if (stat != (-1)) {
			txt -1, lang("このまま帰還すると、交易品は駄目になる…", "The trade article is lost if you escape now.")
		}
		gDestinationMap = list(0, rtval), list(1, rtval)
		gIsReturningOrEscaping = 15 + rnd(15)
	}
	gosub *label_0623
	return
*label_1307
	screenupdate = -1
	gosub *label_0623
	if (iId(ci) == 413) {
		tmat = 51
	}
	if (iId(ci) == 414) {
		tmat = 52
	}
	if (cfg_treasuremachine) {
		rtval = 0
	} else {
		txt -1, lang("" + matname(tmat) + "を使ってガシャガシャする？", "Pay " + matname(tmat) + " to gasha-gasha?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
	}
	if (rtval == 0) {
		if (mat(tmat) > 0) {
			snd 56
			matdelmain tmat
			/*ガシャポンの玉*/
			if (iId(ci) == 413) {
				p = 415
			} else {
				p = 416
			}
			flt
			itemcreate -1, p, cX(cc), cY(cc), 0
			if (stat != 0) {
				iParam2(ci) = 0
				if (iId(ci) == 416) {
					if (rnd(1000) == 0) {
						ibitmod 5, ci, 1
					}
				}
			}
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		} else {
			txt -1, lang("" + matname(tmat) + "を持っていない…", "You don't have " + matname(tmat) + ".")
		}
	}
	goto *label_1617
*label_1308
	if (iId(ci) == 563) {
		if (sorg(iParam1(ci), 0) == 0) {
			txt -1, lang("この本の内容には興味がない。それでも読む？ ", "You are not interested in this book. Do you want to read it anyway? ")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval != 0) {
				return 0
			}
		}
	}
	gdata(91) = 104
	gosub *label_1370
	return 1
*label_1309
	if (gCurrentMap == 35 | gCurrentMap == 6 | gCurrentMap == 40 | gCurrentMap == 49) {
		redraw 0
		snd 27
		txt -1, lang("このマップでは利用できない。", "Can't do it in this area.")
		return
	}
	gosub *label_1595
	redraw 0
	if (gdatan(0) == "") {
		gdatan(0) = random_title(2)
		txt -1, lang("チームネームが決まっていないので、自動的に" + gdatan(0) + "という名前が付けられた。", "Your initial team name is " + gdatan(0) + ". You can change it any time.")
	}
	txtnew
	txt -1, lang("[カスタム機能]何をする？", "[Customize Menu] What do you want to do?")
	promptl(0, promptmax) = lang("ショウルームを記録", "Save current area"), "a", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ペットチームを記録", "Save your pet team"), "b", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("チームネーム変更", "Change your team name"), "c", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("カスタムNPCを作成", "Create custom NPC"), "d", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ｶｽﾀﾑｱｲﾃﾑを作成", "Create custom item"), "e", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("カスタムゴッドを作成", "Create custom god"), "f", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ﾕﾆｰｸﾓﾝｽﾀｰを作成", "Create unique monster"), "g", "" + 8
	promptmax++
	val = promptx, prompty, 240, 1
	gosub *label_1353
	gosub *label_0623
	gosub *label_1595
	if (rtval == 0) {
		if (mapType == 1 | gCurrentMap == 35) {
			redraw 0
			snd 27
			txt -1, lang("このマップは保存できない。", "You can't save this area.")
			return
		}
		txt -1, lang("どのファイル名で保存する？", "Enter file name.")
		redraw 1
		fileext = "eum"
		filedsc = "Elona User Map"
		_fdialog fileext, 17, filedsc, exedir + "user", "default.eum"
		if (stat == 0) {
			return
		}
		userfile = refstr
		gosub *label_1334
		txtef 2
		txt -1, lang("現在地の情報を" + userfile + "に保存した。", "Current area is saved to " + userfile + ".")
		return
	}
	if (rtval == 1) {
		txt -1, lang("どのメンバー構成を記録する？", "Which members do you want to save?")
		dim followerexist, 16
		repeat 16
			followerexist(cnt) = cState(cnt)
		loop
		arenaop = 1, 6
		allyctrl = 2
		gosub *ui_selectAlly
		if (stat == (-1)) {
			return
		}
		lv = 0
		n = 0
		repeat 245
			list(0, cnt) = 0
			if (cnt < 16) {
				if (followerin(cnt) == 1) {
					list(0, cnt) = 1
					lv += cLevel(cnt)
					n++
				}
			}
		loop
		if (listmax == 0) {
			return
		} else {
			lv = lv / n
		}
		txt -1, lang("どのファイル名で保存する？", "Enter file name.")
		redraw 1
		fileext = "ept"
		filedsc = "Elona Pet Team"
		_fdialog fileext, 17, filedsc, exedir + "user", "default.ept"
		if (stat == 0) {
			return
		}
		userfile = refstr
		gosub *label_1335
		txtef 2
		txt -1, lang("ペットチームを" + userfile + "に保存した。", "Your team is saved to " + userfile + ".")
		return
	}
	if (rtval == 2) {
		val = 2
		gosub *label_1201
		if (stat == 0) {
			return
		}
		gdatan(0) = cmaka
		txt -1, lang("あなたはチーム名を" + gdatan(0) + "に決めた。", "Your team name is " + gdatan(0) + " now.")
		return
		return
	}
	if (rtval == 3) {
		gosub *label_1331
		return
	}
	if (rtval == 4) {
		gosub *label_1632
		return
	}
	if (rtval == 5) {
		gosub *label_1740
		return
	}
	if (rtval == 6) {
		if (gCurrentMap == 35) {
			txt -1, lang("この場所からはできない。", "You can't do it in this area.")
			return
		}
		if (cLevel(0) < 10) {
			txt -1, lang("それはレベルが10以上でないとできない。", "You need to be at least level 10 to upload.")
			return
		}
		if (gTimeWhenUplodingBecomesAvailable > getgametime()) {
			snd 27
			txt -1, lang("まだ次のアップロードはできない(" + cnvdate(gTimeWhenUplodingBecomesAvailable, 1) + "まで)", "You can't do this till " + cnvdate(gTimeWhenUplodingBecomesAvailable, 1) + ".")
			return
		}
		gosub *label_0607
		return
	}
	if (rtval == 7) {
		exec exedir + "user\\export.txt", 16
	}
	if (rtval == 8) {
		gosub *label_1776
		return
	}
	return
*label_1310
	oomSEST_log "Dump:Init"
	buff = ""
	notesel buff
	noteadd "Elona Version " + "1.22" + " キャラクター情報 " + gYear + "年" + gMonth + "月" + gDay + "日 " + gHour + "時" + gMinute + "分  " + mdatan(0)
	repeat 16
		if (cState(cnt) == 0) {
			continue
		}
		cc = cnt
		dbidn = cdatan(2, cc)
		dbmode = 2
		gosub *label_1525
		dbidn = cdatan(3, cc)
		dbmode = 2
		gosub *label_1526
		if (cId(cc) == 343) {
			if (userdatan2(0, cCnpcId(cc)) != "") {
				racename = userdatan2(0, cCnpcId(cc))
			}
			if (userdatan2(1, cCnpcId(cc)) != "") {
				classname = userdatan2(1, cCnpcId(cc))
			}
		}
		oomSEST_log "Dump:1"
		noteadd ""
		if (cfg_dump == 0) {
			if (cc > 0) {
				noteadd cdatan(0, cc) + " " + racename + "の" + classname + " " + _sex(cSex(cc)) + " " + calcage(cc) + "歳" + "  " + cHeight(cc) + "cm" + " " + cWeight(cc) + "kg"
				s = "レベル " + cLevel(cc) + " "
				if (cbit(961, cc) == 1) {
					s += "婚約済み "
				}
				noteadd s
				noteadd ""
				continue
			}
		}
		noteadd "  " + fixtxt("" + cdatan(1, cc) + cdatan(0, cc), 34) + _sex(cSex(cc)) + " " + calcage(cc) + "歳" + "  " + cHeight(cc) + "cm" + " " + cWeight(cc) + "kg"
		noteadd ""
		if (cbit(961, cc) == 1) {
			noteadd "婚約済み"
		}
		noteadd ""
		noteadd fixtxt("種族       : " + racename, 30) + fixtxt("信仰      : " + godname(godcheck(cc)), 32)
		noteadd fixtxt("職業       : " + classname, 30) + fixtxt("所属      : " + guildname(), 32)
		if (cc == 0) {
			noteadd fixtxt("レベル     : " + cLevel(cc), 30) + fixtxt("経過日数  : " + gPlayDays, 32)
			noteadd fixtxt("残りBP     : " + cSkillBonus(cc), 30) + fixtxt("経過ターン: " + gPlayTurns, 32)
			noteadd fixtxt("金貨       : " + cGold(cc), 30) + fixtxt("殺害数    : " + gKillCount, 32)
			noteadd fixtxt("プラチナ   : " + cPlatinumCoin(0), 30) + fixtxt("最深到達  : " + gDeepestDungeonLevel + "階相当", 32)
			noteadd fixtxt("プレイ時間 : " + cnvplaytime(gPlayTime + timeGetTime() / 1000 - time_begin), 30)
		} else {
			noteadd fixtxt("レベル     : " + cLevel(cc), 30)
			noteadd fixtxt("残りBP     : " + cSkillBonus(cc), 30)
			noteadd fixtxt("金貨       : " + cGold(cc), 30)
		}
		noteadd ""
		oomSEST_log "Dump:2"
		s(1) = "生命力    : " + sdata(2, cc) + "(" + sorgEx(2, cc) + ")"
		s(2) = "マナ      : " + sdata(3, cc) + "(" + sorgEx(3, cc) + ")"
		s(3) = "狂気度    : " + cInsanity(cc)
		s(4) = "速度      : " + cCurrentSpeed(cc)
		s(5) = "名声度    : " + cFame(cc)
		s(6) = "カルマ    : " + cKarma(cc)
		s(7) = "DV        : " + cDv(cc)
		s(8) = "PV        : " + cPv(cc)
		s(9) = ""
		oomSEST_log "Dump:3"
		repeat 8
			s = ""
			p = sdata(10 + cnt + 600, cc) \ 1000
			if (p >= 450) {
				s += "Extra"
			} elseif (p >= 400) {
				s += "Superb++"
			} elseif (p >= 360) {
				s += "Superb+"
			} elseif (p >= 200) {
				s += "Superb"
			} elseif (p >= 150) {
				s += "Great"
			} elseif (p >= 100) {
				s += "Good"
			} elseif (p >= 50) {
				s += "Bad"
			} else {
				s += "Hopeless"
			}
			s = fixtxt(s, 15)
			s = fixtxt(_stats2(cnt) + "    : " + sdata(10 + cnt, cc) + "(" + sorgEx(10 + cnt, cc) + ")", 24) + s
			noteadd s + s(1 + cnt)
		loop
		noteadd ""
		oomSEST_log "Dump:4"
		val = 1
		gosub *label_1265
		tc = cc
		attackskill = 106
		evade = calcattackhit(2)
		prot = calcattackdmg(2)
		noteadd "回避    : " + evade + "%"
		noteadd "軽減    : " + (100 - 10000 / (prot + 100)) + "% + " + protdice1 + "d" + protdice2
		noteadd ""
		noteadd "---------------------- 装備品 合計重量" + cnvweight(cSumOfEquipmentWeight(cc)) + " " + cnveqweight(cc)
		noteadd ""
		oomSEST_log "Dump:5"
		listmax = 0
		repeat 30, 100
			if (cdata(cnt, cc) != 0) {
				if (cc == 0) {
					if (gettrait(0, 206) != 0) {
						if (cdata(cnt, cc) / 10000 == 2) {
							continue
						}
					}
					if (gettrait(0, 203) != 0) {
						if (cdata(cnt, cc) / 10000 == 9) {
							continue
						}
					}
					if (gettrait(0, 205) != 0) {
						if (cdata(cnt, cc) / 10000 == 3) {
							continue
						}
					}
					if (gettrait(0, 217) != 0) {
						if (cdata(cnt, cc) / 10000 == 1) {
							continue
						}
						if (gettrait(0, 217) == (-2)) {
							if (cdata(cnt, cc) / 10000 == 8) {
								continue
							}
						}
					}
					if (gettrait(0, 218) != 0) {
						if (cdata(cnt, cc) / 10000 == 5) {
							continue
						}
					}
				}
				p(1) = cdata(cnt, cc)
				q2 = "装備なし", ""
				if (p(1) \ 10000 != 0) {
					p(1) = p(1) \ 10000 - 1
					q2 = itemname(p(1)), cnvweight(iWeight(p(1)))
					ci = p(1)
					dump_return = 1
					gosub *label_1290
					notesel buff
				} else {
					listmax = 0
				}
				s = bodyn(cdata(cnt, cc) / 10000)
				if (strmid(s, 0, 2) == "　") {
					s = strmid(s, 2, 2)
				}
				noteadd s + ":"
				noteadd q2 + " " + q2(1)
				repeat listmax
					noteadd listn(0, cnt)
				loop
				noteadd ""
			}
		loop
		oomSEST_log "Dump:6"
		noteadd "---------------------- 特徴"
		noteadd ""
		dump_return = 1
		tc = cc
		gosub *label_1169
		repeat listmax
			if (list(0, cnt) < 0) {
				continue
			}
			if (list(1, cnt) < 10000) {
				continue
			}
			noteadd listn(0, cnt)
		loop
		noteadd ""
		if (cc == 0) {
			noteadd "---------------------- 仲間"
		}
	loop
	oomSEST_log "Dump:8"
	noteadd "---------------------- 称号"
	noteadd ""
	repeat 9
		if (gdata(120 + cnt) < 10000) {
			noteadd "" + ranktitle(cnt) + " Rank." + gdata(120 + cnt) / 100
			s = "給料: 約 " + calcincome(cnt) + " gold  " + "ノルマ: "
			gold += calcincome(cnt)
			if (cnt == 3 | cnt == 4 | cnt == 5 | cnt == 8) {
				s += "なし"
			} else {
				s += "" + gdata(140 + cnt) + "日以内"
			}
			noteadd s
			noteadd ""
		}
	loop
	oomSEST_log "Dump:9"
	s = exedir + "\\save\\" + playerid + ".txt"
	notesave s
	exec s, 16
	cc = 0
	tc = 0
	sdim buff, 10000
	return
*label_1311
	gosub *label_1814
	if (ammo == (-1)) {
		txt -1, lang("矢弾を装備していない。", "You need to equip an ammo.")
		goto *label_1623
	}
	ci = ammo
	listmax = 0
	cs = -1
	repeat 15
		if (iEnchantmentId(ci, cnt) == 0) {
			break
		}
		enc = iEnchantmentId(ci, cnt)
		i = enc / 10000
		if (i != 0) {
			enc = enc \ 10000
			if (i == 9) {
				if (iCount(ci) == cnt) {
					cs = cnt
				}
				list(0, listmax) = cnt
				listmax++
				continue
			}
		}
	loop
	if (listmax == 0) {
		iCount(ci) = -1
		txt -1, lang(itemname(ci) + "は切り替えに対応していない。", itemname(ci) + " isn't capable of changing ammos.")
		goto *label_1623
	}
	snd 90
	cs++
	if (cs >= listmax) {
		iCount(ci) = -1
	} else {
		iCount(ci) = list(0, cs)
	}
	txt -1, lang("現在の装填弾:", "Current Ammo Type:")
	repeat listmax + 1
		if (cnt == 0) {
			s = lang("通常弾", "Normal"), lang("無限", "Unlimited")
		} else {
			p = list(0, cnt - 1)
			i = iEnchantmentPower(ci, p) \ 1000, iEnchantmentPower(ci, p) / 1000
			s = ammoname(iEnchantmentId(ci, p) \ 10000), "" + i + "/" + i(1)
		}
		s = s + ":" + s(1)
		if (iCount(ci) == cnt - 1) {
			s = "[" + s + "]"
			txtef 4
		} else {
			s = " " + s + " "
		}
		txt -1, " " + s
	loop
	goto *label_1623
*label_1312
	inv_getheader -1
	repeat invrange, invhead
		dup roopbuf, iId(cnt)
		if (roopbuf == 504 | roopbuf == 503 | roopbuf == 745) {
			iNumber(cnt) = 0
		}
	loop
	return
*label_1313
	oomSEST_log "fixOnMapEnter"
	repeat 245
		if (cState(cnt) == 1) {
			if (cX(cnt) < 0 | cX(cnt) >= mapWidth | cY(cnt) < 0 | cY(cnt) >= mapHeight) {
				cX(cnt) = 0
				cY(cnt) = 0
			}
		}
	loop
	if (mapType != 5) {
		if (mapItemMax != 0) {
			mapItemMax = 0
		}
	}
	if (gCurrentMap == 7) {
		areaDangerLevel(gCurrentMap) = 0
		areaLastFloor(gCurrentMap) = 10
		if (ncgdata(5) == 1) {
			areaLastFloor(gCurrentMap) = 20
		}
		if (ncgdata(5) == 2) {
			areaLastFloor(gCurrentMap) = 30
		}
		if (ncgdata(5) == 3) {
			areaLastFloor(gCurrentMap) = 40
		}
		areaDefaultAiCalm(gCurrentMap) = 1
		mapDefaultAiCalm = 1
		evadd 17
		welcome_f = 0
		if (cfg_welcomemessage == 1) {
			if (gPreviousMap == gCurrentMap) {
				welcome_f = 1
			}
		}
		calccosthire
	}
	if (areaId(gCurrentMap) == 101 | areaId(gCurrentMap) == 102 | areaId(gCurrentMap) == 103 | areaId(gCurrentMap) == 104) {
		mapDefaultAiCalm = cfg_npcposition
	}
	return
*label_1315
	gdata(184)++
	dim qdata, 20, 500
	sdim qname, 40, 500
	gNumberOfExistingQuests = 0
	gosub *label_0953
	return
*label_1316
	file = "shop" + 3 + ".s2"
	ctrlFile 4
	p = 0
	i = 0
	repeat 600
		if (cnt >= 10 & cnt < 20) {
			p += sorg(cnt, 56)
		}
		if (cnt >= 100 & cnt < 400) {
			i += sorg(cnt, 56)
		}
	loop
	p = (p - 250) / 7
	if (p < 5) {
		p = 5
	} else {
		if (p > 50) {
			p = 50
		}
	}
	i = (i - 250) / 8
	if (i < 5) {
		i = 5
	} else {
		if (i > 40) {
			i = 40
		}
	}
	if (takeover(2) == 0) {
		se_moneymod 0, limit(cGold(56) / 100, 1000, 100000)
	}
	if (takeover(3) == 0) {
		cPlatinumCoin(0) += p
	}
	if (takeover(4) == 0) {
		cSkillBonus(0) += i
	}
	if (takeover(1) == 0) {
		if (mat(399) == 0) {
			nc_intb_001 = mat(1)
			nc_intb_002 = mat(40)
			nc_intb_003 = mat(41)
			repeat 400
				mat(cnt) = 0
			loop
			mat(50) = nc_intb_001
			mat(51) = nc_intb_002
			mat(52) = nc_intb_003
			mat(399) = 1
		} else {
			repeat 400
				mat(cnt) = mat(cnt) / 3
			loop
		}
	} else {
		repeat 400
			mat(cnt) = 0
		loop
	}
	del_chara 56
	return
*label_1317
	ctrlFile 15
	dim spell, 200
	dim spact, 500
	repeat 1200
		sdata(cnt, 56) = sdata(cnt, 0)
		sdata(cnt, 0) = 0
	loop
	repeat 600
		sdataEx(cnt, 56) = sdataEx(cnt, 0)
		sdataEx(cnt, 0) = 0
	loop
	repeat 500
		cdata(cnt, 56) = cdata(cnt, 0)
		cdata(cnt, 0) = 0
	loop
	inv_getheader -1
	repeat invrange, invhead
		iNumber(cnt) = 0
	loop
	f = 0
	inv_getheader 0
	repeat invrange, invhead
		dup roopbuf, iId(cnt)
		if (iNumber(cnt) == 0) {
			continue
		}
		if (roopbuf == 699 & iParam1(cnt) == 1) {
			f = 1
			iParam1(cnt) = 0
			continue
		}
		if (roopbuf != 743) {
			if (refitem(roopbuf, 5, cnt) < 50000 & iParam3(cnt) > 0) {
				iParam3(cnt) = 0
			}
		}
	loop
	inv_getheader 0
	repeat invrange, invhead
		dup roopbuf, iId(cnt)
		if (iNumber(cnt) == 0) {
			continue
		}
		if (roopbuf == 505) {
			if (takeover(8) == 0) {
				ogbitmod 8, 1
			}
		}
		if (roopbuf == 717) {
			if (takeover(7) == 0) {
				lomiaseaster = 1
			}
		}
		if (roopbuf == 511 | refitem(roopbuf, 9, cnt) == 53100) {
			continue
		}
		if (roopbuf == 578) {
			continue
		}
		if (iQuality(cnt) == 6 & f == 0) {
			continue
		}
		if (ibit(5, cnt) & f == 0) {
			continue
		}
		if (refitem(roopbuf, 5, cnt) == 25000) {
			iCount(cnt) = -1
		}
		if (takeover(0)) {
			continue
		}
		if (ibit(17, cnt)) {
			if (roopbuf != 667) {
				ibitmod 17, cnt, 0
			}
		}
		iBodyPart(cnt) = 0
		item_copy cnt, inv_getfreeid(-1)
	loop
	repeat 245
		if (takeover(6) == 0) {
			if (cnt >= 1 & cnt < 16) {
				if (cState(cnt) == 1) {
					continue
				}
			}
		}
		if (cnt == 56) {
			continue
		}
		del_chara cnt
	loop
	if (takeover(5) == 0) {
		gPlayTime = genetemp(805)
	}
	if (takeover(9) == 0) {
		gRandomSeed = genetemp(8)
	}
	return
*label_1318
	ctrlFile 14
	return



#deffunc zipadd str __ddd
	p = 12
	exist folder + __ddd
	len = strsize + p * 2
	lenhead = lensum
	lensum += len
	sdim ziptmp1, p
	ziptmp1 += __ddd
	sdim ziptmp2, p
	ziptmp2 += str(len)
	memexpand filebuff, lensum
	memcpy filebuff, ziptmp1, p, lenhead
	memcpy filebuff, ziptmp2, p, lenhead + p
	sdim filetemp, len - p * 2
	bload folder + __ddd, filetemp, , 0
	memcpy filebuff, filetemp, len - p * 2, lenhead + p * 2
	return
*label_1320
	p = 12
	folder = exedir + "user\\"
	bload folder + file, headtemp, 1024
	gosub *label_1596
	exist folder + file
	zipsize = strsize
	sdim filebuff, zipsize
	bload folder + file, filebuff, zipsize
	lenhead = 1024
	repeat 10000
		sdim ziptmp1, p
		sdim ziptmp2, p
		memcpy ziptmp1, filebuff, p, 0, lenhead
		memcpy ziptmp2, filebuff, p, 0, lenhead + p
		len = int(ziptmp2)
		sdim filetemp, len - p * 2
		memcpy filetemp, filebuff, len - p * 2, 0, lenhead + p * 2
		bsave folder + ziptmp1, filetemp
		lenhead += len
		if (lenhead >= zipsize) {
			break
		}
	loop
	return



#deffunc zipinit2 str __eee, str __fff
	lensum@m188 = 0
	zipfolder@m188 = __eee
	zipfinalfile@m188 = __fff
	sdim filebuff@m188
	return



#deffunc zipadd2 str __ggg
	p@m188 = 50, 40, 10
	exist zipfolder@m188 + __ggg
	len@m188 = strsize + p@m188
	lenhead@m188 = lensum@m188
	lensum@m188 += len@m188
	sdim ziptmp1@m188, p@m188(1)
	ziptmp1@m188 += __ggg
	sdim ziptmp2@m188, p@m188(2)
	ziptmp2@m188 += str(len@m188)
	memexpand filebuff@m188, lensum@m188
	memcpy filebuff@m188, ziptmp1@m188, p@m188(1), lenhead@m188
	memcpy filebuff@m188, ziptmp2@m188, p@m188(2), lenhead@m188 + p@m188(1)
	sdim filetemp@m188, len@m188 - p@m188
	bload zipfolder@m188 + __ggg, filetemp@m188, , 0
	memcpy filebuff@m188, filetemp@m188, len@m188 - p@m188, lenhead@m188 + p@m188
	return



#deffunc zipend2
	bsave zipfolder@m188 + zipfinalfile@m188, filebuff@m188
	return



// CAUTION: This functions does NOT uncompress.
// Extracts inner files from an archive and saves them into each file.
// {__dir}\{__filename} => {__dir}\aaa, {__dir}\bbb, {__dir}\ccc, ...
#deffunc unzip2 str __dir, str __filename
	p@m188 = 50, 40, 10
	exist __dir + __filename
	zipsize@m188 = strsize
	sdim filebuff@m188, zipsize@m188
	bload __dir + __filename, filebuff@m188, zipsize@m188
	lenhead@m188 = 0
	repeat 10000
		sdim ziptmp1@m188, p@m188(1)
		sdim ziptmp2@m188, p@m188(2)
		memcpy ziptmp1@m188, filebuff@m188, p@m188(1), 0, lenhead@m188
		memcpy ziptmp2@m188, filebuff@m188, p@m188(2), 0, lenhead@m188 + p@m188(1)
		len@m188 = int(ziptmp2@m188)
		if (len@m188 == 0) {
			break
		}
		sdim filetemp@m188, len@m188 - p@m188
		memcpy filetemp@m188, filebuff@m188, len@m188 - p@m188, 0, lenhead@m188 + p@m188
		bsave __dir + ziptmp1@m188, filetemp@m188
		lenhead@m188 += len@m188
		if (lenhead@m188 >= zipsize@m188) {
			break
		}
	loop
	return

// NC
// NC専用の技能などを実装している場合の対処
// NCであれば、頭に"nc_"とつけているほうを先に識別する
#defcfunc getnpctxt_nc str __jjj, str __kkk
		nc_strb_001 = getnpctxt("nc_" + __jjj, __kkk)
		if (__kkk == nc_strb_001) {
			nc_strb_001 = getnpctxt(__jjj, __kkk)
		}
 return nc_strb_001

#defcfunc getnpctxt str __jjj, str __kkk
	p@m189 = instr(txtbuff, 0, __jjj)
	if (p@m189 == (-1)) {
		return __kkk
	}
	p@m189 += instr(txtbuff, p@m189, "\"")
	if (p@m189 == (-1)) {
		return __kkk
	}
	return strmid(txtbuff, p@m189 + 1, limit(instr(txtbuff, p@m189 + 1, "\""), 0, 2000))



*label_1328
*label_1329
	if (initunid) {
		cCnpcId(rc) = initunid - 1
		initunid = 0
	}
	cun = cCnpcId(rc)
	cId(rc) = 343
	if (initlv != 0) {
		cLevel(rc) = initlv
	} else {
		cLevel(rc) = limitmin(userdata(2, cun), 1)
	}
	if (voidlv != 0) {
		cLevel(rc) = voidlv * (100 + cLevel(rc) * 2) / 100
		if (cLevel(rc) > 999999) {
			cLevel(rc) = 999999
		}
	}
	cPortrait(rc) = -1
	creaturepack = 0
	cAiActSubFreq(rc) = unaiactsubfreq(cun)
	cAiActNum(rc) = 0
	repeat 5
		if (userdata(15 + cnt, cun) != 0) {
			cdata(215 + cnt, rc) = userdata(15 + cnt, cun)
			cAiActNum(rc)++
		}
		if (userdata(20 + cnt, cun) != 0) {
			cdata(220 + cnt, rc) = userdata(20 + cnt, cun)
			cAiActNum(rc) += 10
		}
	loop
	if (userdatan(5, cun) != "") {
		sdim unres, 6, 32
		csvstr2 unres, userdatan(5, cun)
		repeat
			if (cnt > 15 | unres(cnt) == "") {
				break
			}
			sdata(int(unres(cnt * 2)), rc) += int(unres(cnt * 2 + 1)) * 50
		loop
	}
	cCanTalk(rc) = 1
	cdatan(0, rc) = userdatan(1, cun)
	if (userdata2(6, cun)) {
		cdatan(0, rc) = lang(cdatan(0, rc) + "の" + randomname(), randomname() + " the " + cdatan(0, rc))
	}
	cdatan(5, rc) = userdatan(0, cun)
	cRelationship(rc) = limit(userdata(4, cun), -3, 10)
	cAiCalm(rc) = limit(userdata(7, cun), 1, 5)
	cAiMove(rc) = limit(userdata(8, cun), 0, 100)
	cAiDist(rc) = limit(userdata(9, cun), 1, 100)
	if (userdata(11, cun)) {
		cElementOfUnarmedAttack(rc) = limit(userdata(11, cun), 50 * 100000, 64 * 100000)
	}
	if (userdata2(7, cun)) {
		cDamageReactionInfo(rc) = limit(userdata2(7, cun), 50 + 1 * 1000, 63 + 9999 * 1000)
	}
	cAiHeal(rc) = userdata(10, cun)
	dbidn = userdatan(2, cun)
	dbmode = 3
	gosub *label_1525
	dbidn = userdatan(3, cun)
	dbmode = 3
	gosub *label_1526
	cSex(rc) = userdata(3, cun)
	if (userdata(3, cun) != 0) {
		if (userdata(3, cun) != 1) {
			cSex(rc) = rnd(2)
		}
	}
	if (userdata3(0, cun) > (-1)) {
		cBirthYear(rc) = gYear - userdata3(0, cun)
	}
	if (userdata3(3, cun) > (-1)) {
		cdata(18, rc) = userdata3(3, cun)
	}
	if (userdata(5, cun)) {
		fixlv = limit(userdata(5, cun), 0, 6)
	}
	if (ragnarokflag@se) {
		fixlv = 6
	}
	if (userdatan2(2, cun) != "") {
		cspecialeq = 1
	} else {
		cspecialeq = 0
	}
	cOriginalRelationship(rc) = cRelationship(rc)
	setunid rc, cun
	return



*custom_loadCnpcs
	// Get the list of all "*.npc" and "*.oonpc" files under "user" directory.
	usernpcmax = 0
	getuserfiledata "npc", usernpcmax
	getuserfiledata "oonpc", usernpcmax
	oomSEST_log "[Custom Npc] " + usernpcmax + " cnpcs detected."
	if (usernpcmax > custom_upperLimitOfNumCnpcs) {
		usernpcmax = custom_upperLimitOfNumCnpcs
		oomSEST_log "[Custom Npc] The upper limit of the number of cnpcs is " + usernpcmax + ". The rest won't be loaded."
	}

	dim userdata, 70, usernpcmax + 1
	dim userdata2, 11, usernpcmax + 1
	dim userdata3, 5, usernpcmax + 1
	dim usernpcmatval, 5, usernpcmaxbuffer
	dim usernpcmatneed, 12, usernpcmaxbuffer
	dim userspact, usernpcmax + 1, 22
	dim unaiactsubfreq, usernpcmax + 1
	sdim userdatan, 40, 10, usernpcmax + 1
	sdim userdatan2, 40, 10, usernpcmax + 1
	sdim usertxt, 80 * 1000, usernpcmax + 1
	sdim userracefield, 2000
	sdim userrace, 2000
	sdim userclassfield, 2000
	sdim userclass, 2000
	sdim usernpcmatfaith, 40, usernpcmaxbuffer
	sdim untaglist
	gdata(86) = 0

	// Prepares image buffer.
	buffer 5, 33 * 48, (25 + (usernpcmax / 33 + 1) * 2) * 48 + 32
	pos 0, 0
	picload_ exedir + "\\graphic\\character.bmp", 1
	buffer 100, 16 * 80, (usernpcmax / 16 + 1) * 112
	gmode 0

	tg = 0
	repeat usernpcmax
		oomSEST_log "[Custom Npc] Load: dir=" + userfilelist(1, cnt) + ", file=" + userfilelist(0, cnt)
		cnt2 = tg

		// Extracts inner files from the npc archive.
		unzip2 userfilelist(1, cnt), userfilelist(0, cnt)

		oomSEST_log "[Custom Npc] Load npc definition."

		// Uncompresses and loads "npc1.t" on `userdata` (metadata).
		zOpen hgz, userfilelist(1, cnt) + "npc1.t", 0
		zRead userdata(0, tg), hgz, 70 * 4
		zClose hgz

		/******************************
		* SECTION: Load the graphics. *
		******************************/

		// Uncompresses and loads "npc2.t" on `bmpbuff` (character chip).
		dim bmpbuff, userdata(0, tg)
		oomSEST_log "[Custom Npc] Load character chip."
		zOpen hgz, userfilelist(1, cnt) + "npc2.t", 0
		zRead bmpbuff, hgz, userdata(0, tg)
		zClose hgz

		// Uncompresses and loads "npc3.t" on `txtbuff` (definition).
		sdim txtbuff, userdata(1, tg) + 1
		oomSEST_log "[Custom Npc] Load npc definition (2)."
		zOpen hgz, userfilelist(1, cnt) + "npc3.t", 0
		zRead txtbuff, hgz, userdata(1, tg)
		zClose hgz

		// Uncompresses and loads "npc4.t" on `facebuff` (portrait).
		if (userdata(2, tg) != 0) {
			dim facebuff, userdata(2, tg)
			userdata2(0, tg) = 1
		}
		if (userdata2(0, tg) == 1) {
			oomSEST_log "[Custom Npc] Load portrait."
			zOpen hgz, userfilelist(1, cnt) + "npc4.t", 0
			zRead facebuff, hgz, userdata(2, tg)
			zClose hgz
		}

		// Clean up the temporary files(*.t) to load the graphics.
		cleanuserdir userfilelist(1, cnt)

		/*******************************************
		* SECTION: Load the npc definition itself. *
		*******************************************/
		oomSEST_log "[Custom Npc] Load npc definition (3)."

		// "name."
		// {english name},{japanese name}
		// {english name} is also used as the inner ID.
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		userdatan(0, tg) = s
		userdatan(1, tg) = s(jp)

		// Duplicate check
		s = userfilelist(0, cnt)
		userdatan(6, tg) = s
		if (instr(untaglist, 0, "/" + userdatan(0, tg) + "/") != (-1)) {
			usernpcmax--
			if (instr(s, 0, "_tmp_") == (-1)) {
				msgtemp += lang("同名NPCは読み込まれない。", "A npc of the same name has already been defined.") + "(skipped:" + userdatan(0, tg) + "," + s + ") "
			}
			continue
		}

		// Adds the npc to the list of the loaded npcs.
		untaglist += "/" + userdatan(0, tg) + "/"
		if (instr(s, 0, "_tmp_") != (-1)) {
			gdata(86)++
		}

		oomSEST_log "[Custom Npc] Set basic information."
		userdatan(2, tg) = getnpctxt_nc("race.", "slime")
		userdatan(3, tg) = getnpctxt_nc("class.", "tourist")
		userdatan(4, tg) = getnpctxt_nc("filter.", "")
		userdatan(5, tg) = getnpctxt_nc("resist.", "")
		s = getnpctxt_nc("meleeElem.", "0,0")
		csvstr2 s, s
		userdata(11, tg) = int(s) * 100000 + int(s(1))

		oomSEST_log "[Custom Npc] Set big flags."
		s = getnpctxt_nc("bitOn.", "0,0")
		csvstr2 s, s
		repeat
			p = int(s(cnt))
			if (cnt > 20 | p == 0) {
				break
			}
			HMMBITON userdata(40 + p / 32, cnt2), p \ 32
		loop

		oomSEST_log "[Custom Npc] Set actions."
		s = getnpctxt_nc("aiAct.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			userdata(15 + cnt, cnt2) = int(s(cnt))
		loop
		s = getnpctxt_nc("aiActSub.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			userdata(20 + cnt, cnt2) = int(s(cnt))
		loop

		oomSEST_log "[Custom Npc] Set additional information."
		userdata(12, tg) = int(getnpctxt_nc("spawnType.", "0"))
		userdata(2, tg) = int(getnpctxt_nc("level.", "1"))
		userdata(3, tg) = int(getnpctxt_nc("sex.", "-1"))
		userdata(4, tg) = int(getnpctxt_nc("relation.", "-1"))
		userdata(5, tg) = int(getnpctxt_nc("fixLv.", "0"))
		userdata(6, tg) = int(getnpctxt_nc("rare.", "0"))
		userdata(7, tg) = int(getnpctxt_nc("aiCalm.", "1"))
		userdata(8, tg) = int(getnpctxt_nc("aiMove.", "50"))
		userdata(9, tg) = int(getnpctxt_nc("aiDist.", "1"))
		userdata(10, tg) = int(getnpctxt_nc("aiHeal.", "0"))
		unaiactsubfreq(tg) = int(getnpctxt_nc("aiActSubFreq.", "0"))
		userdata2(1, tg) = limit(int(getnpctxt_nc("transmissivity.", "0")), 0, 256)
		userdata2(2, tg) = int(getnpctxt_nc("dropShadowType.", "0"))
		userdata2(3, tg) = int(getnpctxt_nc("cSetPos.", "16"))
		userdata2(4, tg) = int(getnpctxt_nc("noFoodOrDrink.", "0"))
		userdata2(5, tg) = int(getnpctxt_nc("cnpcRole.", "0"))
		userdata2(6, tg) = int(getnpctxt_nc("randomName.", "0"))
		s = getnpctxt_nc("counterElem.", "0,0")
		csvstr2 s, s
		userdata2(7, tg) = int(s) + int(s(1)) * 1000
		userdata2(8, tg) = int(getnpctxt_nc("chipref.", "0"))
		userdata2(9, tg) = int(getnpctxt_nc("colref.", "0"))
		userdata2(10, tg) = int(getnpctxt_nc("isGodServant.", "0"))
		userdatan2(0, tg) = getnpctxt_nc("raceAlias.", "")
		if (en) {
			userdatan2(0, tg) = getnpctxt_nc("raceAlias_en.", userdatan2(0, tg))
		}
		userdatan2(1, tg) = getnpctxt_nc("classAlias.", "")
		if (en) {
			userdatan2(0, tg) = getnpctxt_nc("classAlias_en.", userdatan2(1, tg))
		}
		userdatan2(3, tg) = getnpctxt_nc("fixFaith.", "")
		// MMA_Contents
		userdatan2(4, tg) = getnpctxt_nc("fixPortrait.", "-2")
		// Embedded user-defined race.
		s = getnpctxt_nc("userRace.", "")
		s = strtrim(s, 3, 13)
		s = strtrim(s, 3, 10)
		if (s != "") {
			if (instr(userrace, 0, s) == (-1)) {
				userrace += s + "\n"
				s = getnpctxt_nc("raceField.", "name,id,id2,playable,sex,pic,pic2,dv,pv,hp,mp,str,end,dex,per,ler,wil,mag,chr,spd,meleeStyle,castStyle,resist,ageRnd,age,blood,breeder,height,skill,trait,figure,description,desc-e")
				s = strtrim(s, 3, 13)
				s = strtrim(s, 3, 10)
				userracefield += s + "\n"
			}
		}

		// Embedded user-defined class.
		s = getnpctxt_nc("userClass.", "")
		s = strtrim(s, 3, 13)
		s = strtrim(s, 3, 10)
		if (s != "") {
			if (instr(userclass, 0, s) == (-1)) {
				userclass += s + "\n"
				s = getnpctxt_nc("classField.", "name,id,playable,str,end,dex,per,ler,wil,mag,chr,spd,equip,skill,description,desc-e")
				s = strtrim(s, 3, 13)
				s = strtrim(s, 3, 10)
				userclassfield += s + "\n"
			}
		}

		userdatan2(2, tg) = getnpctxt_nc("initEquip.", "")
		userdata3(0, tg) = int(getnpctxt_nc("genAge.", "-1"))
		userdata3(1, tg) = int(getnpctxt_nc("genHeight.", "-1"))
		userdata3(2, tg) = int(getnpctxt_nc("genWeight.", "-1"))
		userdata3(3, tg) = int(getnpctxt_nc("tone.", "-1"))
		userdata3(4, tg) = int(getnpctxt_nc("matpet.", "0"))

		s = getnpctxt_nc("matval.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			usernpcmatval(cnt, tg) = int(s(cnt))
		loop
		s = getnpctxt_nc("matneed.", "-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1")
		csvstr2 s, s
		repeat 12
			usernpcmatneed(cnt, tg) = int(s(cnt))
			if ( cnt \ 2 == 1 & usernpcmatneed(cnt, tg) <= 0 ) {
				usernpcmatneed(cnt - 1, tg) = -1
				usernpcmatneed(cnt, tg) = -1
			}
		loop
		usernpcmatfaith(tg) = getnpctxt_nc("matfaith.", "")
		sdim s, 160, 40
		s = getnpctxt_nc("userSpact.", "")
		split s, "|", s
		repeat 22
			if (s(cnt) == "") {
				break
			}
			userspact(tg, cnt) = int(s(cnt))
		loop

		// Npc-specific dialogs.
		p = instr(txtbuff, 0, "%txt")
		txtbuff = strmid(txtbuff, p, instr(txtbuff, 0, "%endTxt") - p + 7)
		usertxt(tg) = strmid(txtbuff, 0, 80 * 400 - 2)

		oomSEST_log "userNpc_update:2.1"
		gsel 9
		file = exedir + "user\\graphic\\cchara_" + userdatan(0, tg) + ".bmp"
		exist file
		if (strsize != (-1)) {
			picload_ file
		} else {
			memfile bmpbuff
			picload_ "MEM:temp.bmp"
		}
		if (ginfo(13) > 50) {
			chipc(0, 33 * 25 + tg) = tg \ 33 * inf_tiles, 25 * inf_tiles + tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles * 2, inf_tiles + userdata2(3, tg) - 8
		} else {
			chipc(0, 33 * 25 + tg) = tg \ 33 * inf_tiles, 25 * inf_tiles + tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles, userdata2(3, tg)
		}
		gsel 5
		pos tg \ 33 * 48, 25 * 48 + tg / 33 * 96
		gcopy 9, 0, 0, 48, 96

		if (userdata2(0, tg) == 1) {
			gsel 100
			pos tg \ 16 * 80, tg / 16 * 112
			memfile facebuff
			picload_ "MEM:", 1
		}

		tg++
	loop

	oomSEST_log "userNpc_update:3"
	gosub *label_1336
	oomSEST_log "userNpc_update:Replace bmp"
	gsel 5
	folder = exedir + "user\\graphic\\"
	dirlist buff, folder + "chara_*.bmp"
	notesel buff
	repeat stat
		noteget file, cnt
		p = int(strmid(file, 6, instr(file, 6, ".")))
		if (p > 824) {
			continue
		}
		if (p <= 660) {
			gsel 5
			pos p \ 33 * inf_tiles, p / 33 * inf_tiles
			picload_ folder + file, 1
		} else {
			gsel 9
			picload_ folder + file
			if (ginfo(13) > 50) {
				chipc(0, p) = (p - 660) \ 33 * inf_tiles, (p - 660) / 33 * inf_tiles * 2, inf_tiles, inf_tiles * 2, inf_tiles + 8
			} else {
				chipc(0, p) = (p - 660) \ 33 * inf_tiles, (p - 660) / 33 * inf_tiles * 2, inf_tiles, inf_tiles, 16
			}
			gsel 95
			pos (p - 660) \ 33 * 48, (p - 660) / 33 * 96
			gcopy 9, 0, 0, 48, 96
		}
	loop

	gsel 5
	dirlist buff, folder + "buffIcon_*.bmp"
	notesel buff
	repeat stat
		noteget file, cnt
		p = int(strmid(file, 9, instr(file, 9, ".")))
		pos p \ 50 * 32, buffy(p)
		picload_ folder + file, 1
	loop

	gsel 0
	if (charaffhpflag) {
		buffer 35, 33 * 48, 25 * 48
		folder = exedir + "user\\graphic\\"
		dirlist buff, folder + "charaEX_*.bmp"
		notesel buff
		repeat stat
			noteget file, cnt
			p = int(strmid(file, 8, instr(file, 8, ".")))
			pos p \ 33 * inf_tiles, p / 33 * inf_tiles
			picload_ folder + file, 1
		loop
		gsel 0
	}

	gosub *custom_loadRaces
	gosub *custom_loadClasses
	gosub *label_1812
	return



*label_1331
	comctrl = 0
	gosub *label_1332
	if (stat == 0) {
		return
	}
	q = refstr
	gosub *custom_loadCnpcs
	initunid = findunid(q)
	txt -1, lang("カスタムNPCを作成した！", "A custom NPC has been successfully generated!")
	flt
	characreate -1, 343, cX(0), cY(0)
	repeat 5480
		if (inv(34, cnt)) {
			getunid4item cnt
		}
	loop
	repeat gNumberOfExistingQuests
		if (qdata(0, cnt) == 0) {
			continue
		}
		if (qdata(3, cnt) == 1008 | qdata(3, cnt) == 1010 & qdata(12, cnt) == 343) {
			getunid4job cnt
		}
	loop
	cRelationship(rc) = -3
	txt -1, lang(name(rc) + "は興奮して襲い掛かってきた。", name(rc) + " is excited and attacks you.")
	folder = exedir + "user\\"
	gosub *custom_cleanUpTemporaryFiles
	return
*label_1332
	fread = 0
	facefile = ""
	cun = usernpcmax
	txt -1, lang("どのファイルからNPCを作成する？", "Use which file to create NPC?")
	redraw 1
	fileext = "txt"
	filedsc = "Custom Npc Text"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if (stat == 0) {
		return 0
	}
	txtfile = refstr
	exist txtfile
	userdata(1, cun) = strsize
	sdim txtbuff, strsize + 1
	bload txtfile, txtbuff
	if (comctrl == 1) {
		s = "%Elona Custom Unique Npc"
	} else {
		s = "%Elona Custom Npc"
	}
	if (instr(txtbuff, 0, s) == (-1)) {
		txt -1, "Invalid File. Aborting."
		return 0
	}
	txt -1, lang("どの画像を埋め込む？", "Embed which picture?")
	redraw 1
	fileext = "bmp"
	filedsc = "Bit Map File"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if (stat == 0) {
		return 0
	}
	bmpfile = refstr
	exist bmpfile
	if (strsize > 30000) {
		txt -1, "The file size must be lower than 30KB. Aborting."
		return 0
	}
	userdata(0, cun) = strsize
	dim bmpbuff, strsize
	bload bmpfile, bmpbuff
	userdata(2, cun) = 0
	dialog lang("ポートレートを埋め込む？", "Embed portrait?"), 2
	if (stat == 6) {
		txt -1, lang("どの画像を埋め込む？(jpg推奨)", "Embed which picture?(.jpg recommended)")
		redraw 1
		dialog "bmp|jpg", 16, "BMP File|JPG File"
		if (stat != 0) {
			facefile = refstr
			exist facefile
			if (strsize > 30000) {
				txt -1, "The file size must be lower than 30KB. Aborting."
				return 0
			}
			userdata(2, cun) = strsize
			dim facebuff, strsize
			bload facefile, facebuff
		}
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\npc1.t", 1, 3
		zWrite userdata(0, cun), hgz, 70 * 4
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\npc1.t", 0
		zRead userdata(0, cun), hgz, 70 * 4
		zClose hgz
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\npc2.t", 1, 3
		zWrite bmpbuff, hgz, userdata(0, cun)
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\npc2.t", 0
		zRead bmpbuff, hgz, userdata(0, cun)
		zClose hgz
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\npc3.t", 1, 3
		zWrite txtbuff, hgz, userdata(1, cun)
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\npc3.t", 0
		zRead txtbuff, hgz, userdata(1, cun)
		zClose hgz
	}
	if (facefile != "") {
		if (fread == 0) {
			zOpen hgz, exedir + "user\\npc4.t", 1, 3
			zWrite facebuff, hgz, userdata(2, cun)
			zClose hgz
		} else {
			zOpen hgz, exedir + "user\\npc4.t", 0
			zRead facebuff, hgz, userdata(2, cun)
			zClose hgz
		}
	}
	s = getnpctxt_nc("name.", "unknown,unknown")
	csvstr2 s, s
	cnpc@st = s
	cnv_filestr s
	if (instr(s, 0, "_tmp_") != (-1)) {
		dialog "The name contains an invalid word \"_tmp_\""
		return 0
	}
	if (peek(s) >= 65 & peek(s) <= 90 | peek(s) == 95 | (peek(s) >= 97 & peek(s) <= 122)) {
	} else {
		dialog "The first letter of the name must be alphabetic."
		return 0
	}
	if (strlen(s) >= 64 | strlen(s(1)) >= 64) {
		dialog "The name is too long."
		return 0
	}
	s(1) = s + ".npc"
	zipinit2 exedir + "user\\", s(1)
	zipadd2 "npc1.t"
	zipadd2 "npc2.t"
	zipadd2 "npc3.t"
	if (facefile != "") {
		zipadd2 "npc4.t"
	}
	zipend2
	mref _refstr, 65
	_refstr = cnpc@st
	return 1



*label_1334
	sdim headtemp, 1024
	id = 0
	lensum = 1024
	sdim filebuff, lensum
	if (usertitle != "") {
		headtemp = "【" + usertitle + "】\n"
	} else {
		headtemp = "【" + mdatan(0) + "】\n"
	}
	headtemp += "" + cdatan(1, 0) + cdatan(0, 0) + "\n"
	headtemp += "\n"
	headtemp += "\n"
	headtemp += "" + 100001 + "\n"
	headtemp += "" + usermsg + "\n"
	headtemp += "" + userrelation + "\n"
	memcpy filebuff, headtemp, 1024, 0
	ctrlFile 20
	repeat 245
		list(0, cnt) = 0
		if (cnt != 0) {
			if (cRole(cnt) != 13) {
				if (cState(cnt) == 1) {
					if (cbit(975, cnt) == 0) {
						list(0, cnt) = 1
					}
				}
			}
		}
	loop
	ctrlFile 22
	gosub *label_1640
	bsave userfile, filebuff
	gosub *custom_cleanUpTemporaryFiles
	return
*label_1335
	sdim headtemp, 1024
	id = 0
	lensum = 1024
	sdim filebuff, lensum
	headtemp = "【" + gdatan(0) + "】(" + n + "体)  Lv" + lv + "\n"
	headtemp += "" + cdatan(1, 0) + cdatan(0, 0) + "\n"
	headtemp += "\n"
	headtemp += "\n"
	headtemp += "" + 100001 + "\n"
	headtemp += "" + n + "\n"
	headtemp += "" + lv + "\n"
	memcpy filebuff, headtemp, 1024, 0
	ctrlFile 22
	bsave userfile, filebuff
	gosub *custom_cleanUpTemporaryFiles
	return
*label_1336
	oomSEST_log "del_userNpc"
	dirlist buff, exedir + "user\\_tmp_*.npc"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	dirlist buff, exedir + "user\\!tmp*.npc"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	return



// Clean up all temporary files(*.t) immediately under "user" directory.
*custom_cleanUpTemporaryFiles
	oomSEST_log "del_userTemp"
	dirlist buff, exedir + "user\\*.t"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	return



*label_1338
	filemod = ""
	sdim loadedbuff, 20000
	memset loadedbuff, 0, 20000
	bufflast = 0
	loadedbuffmax = 20000
	ctrlFile 10
	folder = exedir + "save\\" + playerid + "\\"
	exist folder + "filelist.txt"
	if (strsize != (-1)) {
		delete folder + "filelist.txt"
	}
	loadpickitembuff nowautopickfile
	ctrlFile 7
	gosub *label_1821
	gosub *label_1822
	migration_updateSave
	gosub *label_3223
	repeat 1320
		if (iId(cnt) == 743) {
			getitemid cnt
		}
		checkalter cnt
	loop
	repeat 16
		if (cbit(967, cnt) == 1 | cnt == 0) {
			create_pcpic cnt, 1
		}
	loop
	if (gWizard == 1) {
		cdatan(1, 0) = "*Debug*"
	}
	refreshspeed 0
	gosub *label_1857
	time_begin = timeGetTime() / 1000
	loadtalkconvert
	throwsstpevent "GameLoad", 0, "", 0
	return
*label_1339
	if (gCurrentMap == 35) {
		txtef 3
		txt -1, lang("ユーザーマップの中ではセーブできない。", "The game is not saved in a user map.")
		gosub *label_0623
		return
	}
	oomSEST_log "game_save"
	ctrlFile 2
	file = "inv_" + mid + ".s2"
	ctrlFile 4
	file = exedir + "save\\" + playerid
	dirlist save_buff, file, 5
	notesel save_buff
	save_f = 0
	repeat noteinfo(0)
		noteget save_s, cnt
		if (save_s == playerid) {
			save_f = 1
			break
		}
	loop
	if (save_f == 0) {
		mkdir file
	} else {
	}
	file += "\\"
	notesel filemod
	repeat noteinfo(0)
		noteget save_s, cnt
		if (strmid(save_s, 0, 1) == "*") {
			save_p = 0
		} else {
			save_p = 1
		}
		save_s = strmid(save_s, 1, strlen(save_s))
		if (save_p == 0) {
			bcopy save_s, file + getpath(save_s, 8)
		} else {
			exist file + getpath(save_s, 8)
			if (strsize != (-1)) {
				delete file + getpath(save_s, 8)
			}
		}
	loop
	ctrlFile 8
	filemod = ""
	return
*label_1340
	snd 49
	gPreviousMap2 = gCurrentMap, gCurrentDungeonLevel, cX(0), cY(0)
	gDestinationMap = 35
	gDestinationDungeonLevel = 1
	levelexitby = 2
	goto *label_0939
*label_1341
	buffer 300, windoww, windowh
	mode = 10
	cm = 0
	lomiaseaster = 0
	music = 65
	gosub *label_0122
	cs = 0
	cs_bk = -1
	keyrange = 7
	key_list = "a", "b", "c", "d", "e", "f", "g"
	pagesize = 0
	redraw 0
	gsel 2
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 300
	gmode 0
	pos 0, 0
	picload_ exedir + "\\graphic\\title.bmp", 1
	gzoom windoww, windowh, 300, 0, 0, 800, 600
	gmode 2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	color 255, 255, 255
	pos 20, 20
	mes "Elona version " + "1.22" + "  Developed by Noa"
	pos 20, 38
	mes "Mod version omake20150620 / omake_overhaul20160417 / omake_overhaul_modifyEx20170306fix"
	pos 20, 56
	mes "                                                   / omake_overhaul_modifyEx_Sukutu_Edition 20180517 fix2"
	pos 20, 74
	mes "                                                   / southtyris 20190921T / NasukoCustom " + releaseday
	pos 20, 92
	if (jp) {
		mes "Contributor MSL / View the credits for more"
	} else {
		mes "Contributor f1r3fly, Sunstrike, Schmidt, Elvenspirit / View the credits for more"
		mes "Omake/oo translator: Doorknob"
		mes "Cutscenes translator: AnnaBannana"
	}
	if (jp) {
		s = "冒険の道標", strhint1
	} else {
		s = "Starting Menu", strhint1
	}
	windowshadow = 1
	display_window 80, winposy(308, 1), 320, 370
	cmbg = 4
	x = ww / 5 * 4
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + 160, wy + wh / 2
	grotate 2, cmbg / 2 * 180, cmbg \ 2 * 300, 0, x, y
	gmode 2
	if (jp) {
		s = "Restore an adventurer", "冒険を再開する", "Generate an adventurer", "新しい冒険者を作成する", "Incarnate an adventurer", "冒険者の引継ぎ", "Trophy", "トロフィー", "View the homepage", "ホームページを開く", "Configure", "設定の変更", "Exit", "終了"
	}
	if (en) {
		s = "Restore an Adventurer", "Generate an Adventurer", "Incarnate an Adventurer", "Trophy", "View the Homepage", "Options", "Exit"
	}
	if (water_debug == 0) {
		water_getimage
		water_debug = 1
	}
	gsel 0
	gmode 0
	pos 0, 0
	gcopy 300, 0, 0, windoww, windowh
	gmode 2
*label_1342
	if (cfg_autonumlock) {
		GetKeyboardState keybd_st
		if (peek(keybd_st, 144) == 1) {
			keybd_event 144
			keybd_event 144, 0, 2
		}
	}
	redraw 0
	if (cfg_titleeffect) {
		tx += (rnd(10) + 2) * p(1)
		ty += (rnd(10) + 2) * p(2)
		if (rnd(10) == 0) {
			tx = rnd(800)
			ty = rnd(600)
			p(1) = rnd(9) - 4, rnd(9) - 4
		}
		f = 0
		if (tx > 40 & tx < 500 & ty > 100 & ty < 450) {
			f = 1
		}
		if (f == 0) {
			if (rnd(10) == 0) {
				f = 2
			}
		}
		if (f == 0) {
			water_setripple tx, ty, rnd(300), rnd(4)
		}
		water_calc
	} else {
		water_refresh
	}
	water_draw
	cs_listbk
	repeat 7
		x = wx + 40
		y = cnt * 35 + wy + 50
		display_customkey key_list(cnt), x, y
		if (jp) {
			font lang(cfg_font1, cfg_font2), 11 - en * 2, 0
			pos x + 40, y - 4
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			cs_list s(cnt * 2 + 1), x + 40, y + 8, 19
		} else {
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			cs_list s(cnt), x + 40, y + 1, 19
		}
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (key == "b") {
		snd 20
		geneuse = ""
		goto *label_0741
	}
	if (key == "a") {
		snd 20
		goto *label_1343
	}
	if (key == "c") {
		snd 20
		goto *label_1345
	}
	if (key == "d") {
		snd 20
		title_pos = list(0, pagesize * page + cs)
		goto *label_N010
	}
	if (key == "e") {
		snd 20
		exec homepage, 16
	}
	if (key == "f") {
		snd 20
		goto *label_1598
	}
	if (key == "g") {
		snd 20
		await 400
		goto *system_quitElona
	}
	goto *label_1342
*label_1343
	cs = 0
	cs_bk = -1
	redraw 0
	gsel 4
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	if (jp) {
		s = "どの冒険を再開するんだい？"
	} else {
		s = "Which save game do you want to continue?"
	}
	gosub *label_0629
	file = exedir + "save\\*"
	dirlist buff, file, 5
	notesel buff
	keyrange = 0
	repeat noteinfo(0)
		noteget s, cnt
		file = exedir + "save\\" + s + "\\header.txt"
		exist file
		if (strsize == (-1)) {
			notedel cnt
			if (cnt < noteinfo(0)) {
				continue cnt
			} else {
				break
			}
		}
		bload file, playerheader
		list(0, cnt) = cnt
		listn(0, cnt) = s, "" + playerheader
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	windowshadow = 1
*label_1344
	redraw 0
	if (jp) {
		s = "冒険者の選択", "BackSpace [削除]  " + strhint3b
	} else {
		s = "Game Selection", "BackSpace [Delete]  " + strhint3b
	}
	display_window (windoww - 440) / 2 + inf_screenx, winposy(288, 1), 440, 288
	cs_listbk
	repeat noteinfo(0)
		x = wx + 20
		y = cnt * 40 + wy + 50
		display_key x + 20, y - 2, cnt
		font lang(cfg_font1, cfg_font2), 11 - en * 2, 0
		pos x + 48, y - 4
		mes listn(0, cnt)
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		cs_list listn(1, cnt), x + 48, y + 8, 19
	loop
	cs_bk = cs
	if (noteinfo(0) == 0) {
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 140, wy + 120
		mes "No save files found"
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, cnt)
			break
		}
	loop
	if (p != (-1)) {
		playerid = listn(0, p)
		snd 20
		await 200
		mode = 3
		music = 0
		goto *label_1607
	}
	getkey a, 8
	if (ginfo(2) == 0) {
		if (noteinfo(0) != 0) {
			if (a == 1) {
				p = list(0, cs)
				playerid = listn(0, p)
				if (jp) {
					s = "本当に" + playerid + "を削除していいのかい？"
				} else {
					s = "Do you really want to delete " + playerid + " ?"
				}
				gosub *label_0629
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 200, 1
				gosub *label_1353
				if (rtval != 0) {
					goto *label_1343
				}
				if (jp) {
					s = "本当の本当に" + playerid + "を削除していいのかい？"
				} else {
					s = "Are you sure you really want to delete " + playerid + " ?"
				}
				gosub *label_0629
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 200, 1
				gosub *label_1353
				if (rtval == 0) {
					snd 20
					ctrlFile 9
				}
				goto *label_1343
			}
		}
	}
	if (key == key_cancel) {
		goto *label_1341
	}
	goto *label_1344
*label_1345
	cs = 0
	cs_bk = -1
	redraw 0
	gsel 4
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	if (jp) {
		s = "どの遺伝子を引き継ぐ？"
	} else {
		s = "Which gene do you want to incarnate?"
	}
	gosub *label_0629
	file = exedir + "save\\*"
	dirlist buff, file, 5
	notesel buff
	keyrange = 0
	listmax = 0
	repeat noteinfo(0)
		noteget s, cnt
		file = exedir + "save\\" + s + "\\gene_header.txt"
		exist file
		await
		if (strsize == (-1)) {
			continue
		}
		bload file, playerheader
		list(0, listmax) = listmax
		listn(0, listmax) = s, "" + playerheader
		key_list(listmax) = key_select(listmax)
		keyrange++
		listmax++
	loop
	windowshadow = 1
*label_1346
	redraw 0
	if (jp) {
		s = "遺伝子の選択", strhint3b
	} else {
		s = "Gene Selection", strhint3b
	}
	display_window (windoww - 440) / 2 + inf_screenx, winposy(288, 1), 440, 288
	cs_listbk
	repeat listmax
		x = wx + 20
		y = cnt * 40 + wy + 50
		display_key x + 20, y - 2, cnt
		font lang(cfg_font1, cfg_font2), 11 - en * 2, 0
		pos x + 48, y - 4
		mes listn(0, cnt)
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		cs_list listn(1, cnt), x + 48, y + 8, 19
	loop
	cs_bk = cs
	if (listmax == 0) {
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 140, wy + 120
		mes "No gene files found"
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, cnt)
			break
		}
	loop
	if (p != (-1)) {
		snd 20
		geneuse = listn(0, p)
		playerid = listn(0, p)
		goto *label_0741
	}
	if (key == key_cancel) {
		goto *label_1341
	}
	goto *label_1346
*label_1347
	dim fovlist, 2, 17
	dim fovmap, 17, 17
	if (cVisionDistance(0) < 1) {
		cVisionDistance(0) = 1
	}
	if (cVisionDistance(0) >= 15) {
		cVisionDistance(0) = 15 - 1
	}
	repeat 17
		y = cnt
		repeat 17
			x = cnt
			if (dist(x, y, 17 / 2, 17 / 2) <= 15 / 2) {
				fovmap(x, y) = 1
			}
		loop
	loop
	repeat 17
		y = cnt
		p(1) = 0
		repeat 17
			x = cnt
			p = fovmap(x, y)
			if (p != 0 & p(1) == 0) {
				fovlist(0, y) = x
				p(1) = 1
			}
			if (p == 0 & p(1) == 1) {
				fovlist(1, y) = x
				break
			}
		loop
	loop
	return
*label_1348
	if (wparam == 27) {
		if (ginfo(2) == 0) {
			ime_esc = 1
		}
	}
	return
*label_1349
	snd 26
	x = val
	y = val(1)
	dx = val(2) * 16 + 60
	font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
	inputfail = 0
	sdim inputlog2
	title "Elona" + " ver " + "1.22" + " / oomSESTep NasukoCustom" + releaseday
	if (val(4) != 0) {
		val(5) = val(4)
		val(4) = int(inputlog)
		if (strlen(str(val(5))) >= 3) {
			dx += strlen(str(val(5))) * 8
		}
		redraw 0
		pos x + 24, y + 4
		gfini dx - 42, 35
		gfdec 60, 60, 60
		repeat
			redraw 0
			window2 x + 20, y, dx - 40, 36, 0, 2
			pos x + dx / 2 - 56, y - 32
			gcopy 3, 128, 288, 128, 32
			pos x + 28, y + 4
			gcopy 3, 312, 336, 24, 24
			pos x + dx - 51, y + 4
			gcopy 3, 336, 336, 24, 24
			inputlog2 = "" + int(inputlog) + "(" + val(5) + ")"
			pos x + dx - 70 - strlen(inputlog2) * 8 + 8, y + 11
			color 255, 255, 255
			mes inputlog2
			redraw 1
			await cfg_wait1
			key_check
			if (key == key_enter) {
				f = 1
				break
			}
			if (key == key_cancel) {
				if (val(3) == 1) {
					f = -1
					break
				}
			}
			if (key == key_west) {
				snd 5
				val(4)--
				if (val(4) < 1) {
					val(4) = val(5)
				}
			}
			if (key == key_northwest) {
				snd 5
				if (val(4) == 1) {
					val(4) = val(5)
				} else {
					val(4) -= 100
				}
				if (val(4) < 1) {
					val(4) = 1
				}
			}
			if (key == key_southwest) {
				snd 5
				if (val(4) == 1) {
					val(4) = val(5)
				} else {
					val(4) -= 10
				}
				if (val(4) < 1) {
					val(4) = 1
				}
			}
			if (key == key_east) {
				snd 5
				val(4)++
				if (val(4) > val(5)) {
					val(4) = 1
				}
				if (val(4) < 0) {
					val(4) = 0
				}
			}
			if (key == key_northeast) {
				snd 5
				if (val(4) == val(5)) {
					val(4) = 1
				} else {
					val(4) += 100
				}
				if (val(4) > val(5)) {
					val(4) = val(5)
				}
			}
			if (key == key_southeast) {
				snd 5
				if (val(4) == val(5)) {
					val(4) = 1
				} else {
					val(4) += 10
				}
				if (val(4) > val(5)) {
					val(4) = val(5)
				}
			}
			if (key == key_south) {
				snd 5
				val(4) = 1
			}
			if (key == key_north) {
				snd 5
				val(4) = val(5)
			}
			inputlog = "" + val(4)
		loop
		if (f == (-1)) {
			inputlog = ""
			rtval = -1
		}
		keywait = 1
		key = ""
		rtval = 0
		return
	}
	redraw 0
	objmode 2, 0
	if (cfg_msg_box == 0) {
		pos x + 4, y + 4
		mesbox inputlog, dx - 8, 26, 1, val(2) * (1 + en)
	} else {
		pos x, y
		mesbox inputlog, 600, 0, 5, val(2) * (1 + en)
		pos x + 4, y + 4
		gfini dx - 1, 35
		gfdec 60, 60, 60
		aplsel "Elona" + " ver " + "1.22"
		if (stat == 1) {
			dialog "Failed to get WINDOW ID", 1
			clrobj 1
			cfg_msg_box = 0
			goto *label_1349
		}
		aplobj "", 1
		if (stat == 1) {
			dialog "Failed to get OBJECT ID", 1
			clrobj 1
			cfg_msg_box = 0
			goto *label_1349
		}
	}
	notesel inputlog
	p(1) = 2
	ime_esc = 0
	onkey 1
	repeat
		if (ginfo(2) == 0) {
			objsel 1
		} else {
			objprm 1, ""
			inputlog = ""
			await 100
			continue cnt
		}
		if (nc_macromode != 0) {
			if (strmid(nc_key_log(nc_key_row), 0, strlen("Paste,")) == "Paste,") {
				split nc_key_log(nc_key_row), ",", nc_key_buff
				inputlog = nc_key_buff(1) + "\n"
				nc_key_row++
			} else {
				txt -1, lang("(マクロ)入力中にPaste以外の命令が実行されました(行:", "(Macro)A command other than Paste was executed while typing.(row:") + nc_key_row + ") "
				nc_macromode = 0
				nc_key_row = 0
				txt -1, lang("マクロを停止した。", "Stopped macro.")
				return
			}
		}
		redraw 0
		await 40
		window2 x, y, dx, 36, 0, 2
		pos x + dx / 2 - 60, y - 32
		gcopy 3, 128, 288, 128, 32
		if (cfg_msg_box == 1) {
			pos x + 8, y + 4
			if (imeget() != 0) {
				gcopy 3, 48, 336, 24, 24
			} else {
				gcopy 3, 24, 336, 24, 24
			}
			apledit p(2), 2, 0
			if (p(2) > val(2) * (1 + en) - 2) {
				pos x + 8, y + 4
				gcopy 3, 72, 336, 24, 24
			}
			if (cnt \ 20 < 10) {
				p(1) = p(1) * 2
			} else {
				p(1) = p(1) / 2
			}
			apledit p(2), 0
			p(4) = 0
			repeat p(2)
				p(3) = peek(inputlog, p(4))
				if (p(3) >= 129 & p(3) <= 159 | (p(3) >= 224 & p(3) <= 252)) {
					p(4) += 2
				} else {
					p(4) += 1
				}
			loop
			gmode 4, , , p(1) / 2 + 50
			pos x + 34 + p(4) * 8, y + 5
			color 0, 0, 0
			gcopy 3, 0, 336, 12, 24
			gmode 2
			color 255, 255, 255
			pos x + 36, y + 9
			noteget s, 0
			mes s
		}
		if (instr(inputlog, 0, "\n") != (-1)) {
			rtval = 0
			break
		}
		if (instr(inputlog, 0, "\t") != (-1)) {
			objprm 1, ""
			inputlog = ""
			if (val(3) == 1) {
				ime_esc = 1
			}
		}
		redraw 1
		if (val(3) == 1) {
			if (ime_esc == 1) {
				inputlog = ""
				keywait = 1
				key = ""
				break
			}
		}
	loop
	gmode 2
	clrobj 1
	if (inputfail) {
		cfg_msg_box = 0
		goto *label_1349
	}
	if (input_mode == 1) {
		cnv_filestr inputlog
	}
	input_mode = 0
	if (en) {
		cnv_str inputlog, "\"", "'"
	}
	rm_crlf inputlog
	onkey 0
	return
*label_1350
	snd 26
	redraw 0
	gsel 4
	x = (cX(0) - scx) * inf_tiles + inf_screenx - 48
	y = (cY(0) - scy) * inf_tiles + inf_screeny - 48
	gmode 0
	pos 0, 0
	gcopy 0, x, y, 48 * 3, 48 * 3
	gsel 0
	t = 0
*label_1351
	t++
	gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
	color 0, 0, 0
	x = (cX(0) - scx) * inf_tiles + inf_screenx + 24
	y = (cY(0) - scy) * inf_tiles + inf_screeny + 24
	if (key_alt == 0) {
		pos x, y - 48
		grotate 3, 212, 432, 0, 28, 28
		pos x, y + 48
		grotate 3, 212, 432, 1.0 * 3.14, 28, 28
		pos x + 48, y
		grotate 3, 212, 432, 0.5 * 3.14, 28, 28
		pos x - 48, y
		grotate 3, 212, 432, 1.5 * 3.14, 28, 28
	}
	pos x - 48, y - 48
	grotate 3, 212, 432, 1.75 * 3.14, 28, 28
	pos x + 48, y + 48
	grotate 3, 212, 432, 0.75 * 3.14, 28, 28
	pos x + 48, y - 48
	grotate 3, 212, 432, 0.25 * 3.14, 28, 28
	pos x - 48, y + 48
	grotate 3, 212, 432, 1.25 * 3.14, 28, 28
	redraw 1
	redraw 0
	gmode 0
	pos x - 48 - 24, y - 48 - 24
	gcopy 4, 0, 0, 48 * 3, 48 * 3
	gmode 2
	await 30
	key_check 1
	x = cX(0)
	y = cY(0)
	if (key == key_alter) {
		goto *label_1352
	}
	if (key == key_wait | key == key_enter) {
		tlocx = x
		tlocy = y
		keyhalt = 1
		return 1
	}
	if (key == key_north) {
		if (key_alt) {
			goto *label_1352
		} else {
			y -= 1
		}
	}
	if (key == key_south) {
		if (key_alt) {
			goto *label_1352
		} else {
			y += 1
		}
	}
	if (key == key_west) {
		if (key_alt) {
			goto *label_1352
		} else {
			x -= 1
		}
	}
	if (key == key_east) {
		if (key_alt) {
			goto *label_1352
		} else {
			x += 1
		}
	}
	if (key == key_northwest) {
		x -= 1
		y -= 1
	}
	if (key == key_northeast) {
		x += 1
		y -= 1
	}
	if (key == key_southwest) {
		x -= 1
		y += 1
	}
	if (key == key_southeast) {
		x += 1
		y += 1
	}
	if (key != "") {
		if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
			x = cX(0)
			y = cY(0)
			keyhalt = 1
			return 0
		}
		if (x == cX(0) & y == cY(0)) {
			return 0
		}
		tlocx = x
		tlocy = y
		keyhalt = 1
		return 1
	}
*label_1352
	goto *label_1351
*label_1353
	snd 26
	csprev = cs
	cs = 0
	cs_bk = -1
	redraw 0
	gsel 3
	gmode 0
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
	repeat promptmax
		if (promptl(1, cnt) == "null") {
			promptl(1, cnt) = key_select(cnt)
		}
		pos cnt * 24 + 624, 30
		gcopy 3, 0, 30, 24, 18
		pos cnt * 24 + 629, 31
		color 50, 60, 80
		bmes promptl(1, cnt), 250, 240, 230
	loop
	gsel 0
	sx = val - val(2) / 2
	sy = val(1) - promptmax * 10
	pos sx + 12, sy + 12
	gfini val(2) - 17, promptmax * 20 + 43 - 18
	gfdec 60, 60, 60
	keyhalt = 1
	if (val(3) == 2) {
		dx = 200, 10
		dy = sy + 140
		val(5) = val(4)
		val(4) = 1
		val = 1
		if (strlen(str(val(5))) >= 3) {
			dx += strlen(str(val(5))) * 8
		}
		pos dx(1) + sx + 24, dy + 4
		gfini dx - 42, 35
		gfdec 60, 60, 60
	}
	if (cfg_putgrass == 1) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗ"
		loop
	}
	if (cfg_putgrass == 2) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "、", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "。", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "！", "ｗｗｗ！"
			sreplace promptl(0, cnt), promptl(0, cnt), "？", "ｗｗｗ？"
		loop
	}
*label_1354
	redraw 0
	gmode 2
	if (val(3) == 2) {
		window2 dx(1) + sx + 20, dy, dx - 40, 36, 0, 2
		pos dx(1) + sx + dx / 2 - 56, dy - 32
		gcopy 3, 128, 288, 128, 32
		pos dx(1) + sx + 28, dy + 4
		gcopy 3, 312, 336, 24, 24
		pos dx(1) + sx + dx - 51, dy + 4
		gcopy 3, 336, 336, 24, 24
		inputlog2 = "" + int(inputlog) + "(" + val(5) + ")"
		pos dx(1) + sx + dx - 70 - strlen(inputlog2) * 8 + 8, dy + 11
		color 255, 255, 255
		mes inputlog2
		inputlog = "" + val(4)
	}
	window2 sx + 8, sy + 8, val(2) - 16, promptmax * 20 + 42 - 16, 0, 0
	pos sx - 16, sy
	gcopy 3, 64, 288, 50, 32
	color 255, 255, 255
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	keyrange = 0
	cs_listbk
	repeat promptmax
		pos sx + 30, cnt * 20 + sy + 22
		gcopy 3, cnt * 24 + 624, 30, 24, 24
		cs_list promptl(0, cnt), sx + 56, cnt * 20 + sy + 21, 19
		key_list(cnt) = promptl(1, cnt)
		keyrange++
	loop
	cs_bk = cs
	if (rpmode) {
		window_recipe2
		color 255, 255, 255
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	rtval = -1
	repeat promptmax
		if (invCtrl == invCtrl_Blacksmith && key == "sc") {
			if (sc \ 10) {
				key = key_select(sc - 1)
			}
		}
		if (key == promptl(1, cnt)) {
			rtval = int(promptl(2, cnt))
			break
		}
	loop
	if (val(3) == 2) {
		val = int(inputlog)
		if (key == key_west | key == key_pagedown) {
			snd 5
			val(4)--
			if (val(4) < 1) {
				val(4) = val(5)
			}
		}
		if (key == key_east | key == key_pageup) {
			snd 5
			val(4)++
			if (val(4) > val(5)) {
				val(4) = 1
			}
		}
	}
	if (rtval != (-1)) {
		promptmax = 0
		cs = csprev
		return 1
	}
	if (val(3) != 0) {
		if (key == key_cancel) {
			promptmax = 0
			cs = csprev
			return 0
		}
	}
	goto *label_1354
*label_1353_001
	snd 26
	csprev = cs
	cs = 0
	cs_bk = -1
	redraw 0
	gsel 3
	gmode 0
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
	repeat promptmax
		if (promptl(1, cnt) == "null") {
			promptl(1, cnt) = key_select(cnt)
		}
		pos cnt * 24 + 624, 30
		gcopy 3, 0, 30, 24, 18
		pos cnt * 24 + 629, 31
		color 50, 60, 80
		bmes promptl(1, cnt), 250, 240, 230
	loop
	gsel 0
	sx = val - val(2) / 2
	sy = val(1) - limitmax(16, promptmax) * 10
	pos sx + 12, sy + 12
	gfini val(2) - 17, limitmax(16, promptmax) * 20 + 43 - 18
	gfdec 60, 60, 60
	keyhalt = 1
	if (cfg_putgrass == 1) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗ"
		loop
	}
	if (cfg_putgrass == 2) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "、", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "。", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "！", "ｗｗｗ！"
			sreplace promptl(0, cnt), promptl(0, cnt), "？", "ｗｗｗ？"
		loop
	}
*label_1354_001
	redraw 0
	gmode 2
	window2 sx + 8, sy + 8, val(2) - 16, limitmax(promptmax, 16) * 20 + 42 - 16, 0, 0
	pos sx - 16, sy
	gcopy 3, 64, 288, 50, 32
	color 255, 255, 255
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	keyrange = 0
	cs_listbk
	repeat promptmax
		pos sx + 30 + (cnt / 16 * 240), sy + 22 + (cnt \ 16 * 20)
		gcopy 3, cnt * 24 + 624, 30, 24, 24
		cs_list promptl(0, cnt), sx + 56 + (cnt / 16 * 240), sy + 21 + (cnt \ 16 * 20), 19
		key_list(cnt) = promptl(1, cnt)
		keyrange++
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	rtval = -1
	repeat promptmax
		if (key == promptl(1, cnt)) {
			rtval = int(promptl(2, cnt))
			break
		}
	loop
	if (rtval != (-1)) {
		promptmax = 0
		cs = csprev
		return 1
	}
	if (val(3) != 0) {
		if (key == key_pageup) {
			if (keyrange >= 16) {
				if (cs < 16) {
					cs += 16
					if (cs >= keyrange) {
						cs = (keyrange - 1)
					}
				} else {
					cs -= 16
					if (cs < 0) {
						cs += 16
						if (cs >= keyrange) {
							cs = (keyrange - 1)
						}
					}
				}
				goto *label_1354_001
			}
		}
		if (key == key_pagedown) {
			if (keyrange >= 16) {
				if (cs < 16) {
					cs += 16
					if (cs >= keyrange) {
						cs = (keyrange - 1)
					}
				} else {
					cs -= 16
					if (cs < 0) {
						cs += 16
						if (cs >= keyrange) {
							cs = (keyrange - 1)
						}
					}
				}
				goto *label_1354_001
			}
		}
		if (key == key_cancel) {
			promptmax = 0
			cs = csprev
			return 0
		}
	}
	goto *label_1354_001
*label_1355
*label_1356
	notesel dbm
	buff = ""
	if (dbm == "") {
		noteadd "Elona" + " v" + "1.22" + " Debug Console    Type \"?\" for help. Hit ESC to exit."
		noteadd ""
	}
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	objmode 2
	pos 0, 24
	mesbox dbm, 800, 576, 0
	pos 0, 0
	mesbox buff, 800, 24, 1
	objsel 2
*label_1357
	await 20
	stick a
	if (a == 128) {
		goto *label_1358
	}
	if (a == 32) {
		gosub *label_1359
	}
	goto *label_1357
*label_1358
	clrobj 1
	clrobj 2
	if (dbg_exitshowroom == 1) {
		dbg_exitshowroom = 0
		levelexitby = 4
		goto *label_0939
	}
	goto *label_1623
*label_1359
*label_1360
	if (instr(buff, 0, "?") != (-1)) {
		noteadd "\t1\t\tShows charainfo."
		noteadd "\t2\t\tShows pc equipment."
		noteadd "\t3\t\tShows pc inventory."
		noteadd "\t4\t\tBegin/end var-comparison."
		noteadd "\t5\t\tShows core game data."
		noteadd "\tdel\t\tDeletes current log."
		noteadd "\tquest\t\tLists all the quests."
		noteadd "\tclient\t\tLists all the clients."
		noteadd "\texitroom\tLeaves current show-room."
		noteadd "\twizard\t\tEnables wizard mode."
		noteadd ""
		noteadd "\tThe commands below can be used in the Wizard mode."
		noteadd "\tgain_spell\tPC gains all spells."
		noteadd "\tgain_spact\tPC gains all special actions."
		noteadd "\tgain_exp\tPC gains a billion of exp."
		noteadd "\tgain_fame\tPC gains fame."
		noteadd "\tallinv\t\tDisplays all the items in the map."
		noteadd ""
		noteadd "\tThe commands below should be only used to deal with certain problems."
		noteadd "\t108fix\t\tTurns all the NPCs in the map hostile."
		noteadd "\tadvreset\tRemoves all items from adventureres."
		noteadd "\tfixcorrupt1\tTries to fix corrputed save files."
		noteadd "\tfreemove\tEnables freemove."
		noteadd "\tresetmap\tResets towns and some areas."
		noteadd "\tfixmap\t\tFixes possible bugs for current map."
		noteadd "\tmapinfo\t\tShows map info."
		noteadd ""
		noteadd "\too commands"
		noteadd "\tunique\t\tShows generation counter of the new unique monsters"
		noteadd "\tfixrelation1\tUNAVAILABLE IN CURRENT VERSION."
		noteadd "\tshowfaction\tShows characters' factions in the current area."
		noteadd "\tcontainerize\tUpdates old containers."
		noteadd ""
		noteadd "\toom commands"
		noteadd "\tfixai [Character No.]\tUNAVAILABLE IN CURRENT VERSION."
		noteadd "\tresetchipm\tResets building appearance in global map."
		noteadd ""
		noteadd "\toomSE commands"
		noteadd "\tusernpc\tShows all installed CNPCs."
		noteadd "\tuseritem\tShows all installed CItems."
		noteadd "\tusergod\tShows all installed CGods."
		noteadd "\tuserrace\tShows all installed CRaces."
		noteadd "\tuserclass\tShows all installed CClasses."
		noteadd "\tyoungerladyreset\tReset younger lady flag."
		noteadd "\tpetaireset\tReset pet's AI"
		noteadd "\tinheritance [Item No.]\tOutput inheritance marks added to the specified item."
		noteadd "\tfixammoenc\tUNAVAILABLE IN CURRENT VERSION."
		noteadd "\tfixhammer\tUpdates the hammer title to fit the current hammer level."

		noteadd ""
		noteadd "\toomSEST commands"
		noteadd "\twish_count\tShows wishing count, the number of wishing from wells."
		noteadd "\tupdateoomseskills\tMigrates oomSE skills."
		noteadd "\tupdateST\tUpdate SouthTyris."
		noteadd "\tcheckTitle\tCheck Title."
		noteadd "\telapse_day[wizard only]\t1 day will elapse."
		noteadd "\telapse_week[wizard only]\t1 week will elapse."
		noteadd "\telapse_month[wizard only]\t1 month will elapse."
		noteadd "\telapse_year[wizard only]\t1 year will elapse."
		noteadd "\tgameclear[wizard only]\tCompletes the the main scenario."
		noteadd "\tgamereset[wizard only]\tReset all flags about the main scenario."

		goto *label_1361
	}
	if (int(buff) == 1) {
		repeat 245
			noteadd "" + cnt + ":" + cdatan(0, cnt) + "\n\tExist:" + cState(cnt) + "\tRespawn:" + splittime(cTimeToRevive(cnt)) + "\tRole:" + cRole(cnt)
			noteadd "\tReader:" + cdatan(0, ocdata(190, cnt)) + "\n\tLocation:" + mapname(cCurrentMap(cnt)) + "\n\tJob:" + ocPetJob(cnt)
		loop
		goto *label_1361
	}
	if (int(buff) == 2) {
		repeat 30
			p = 100 + cnt
			if (cdata(p, 0) != 0) {
				p(1) = cdata(p, 0)
				s = "" + p + "\t" + p(1) + "\t"
				if (p(1) \ 10000 > 0) {
					s += itemname(p(1) \ 10000 - 1)
				}
				noteadd s
			}
		loop
		goto *label_1361
	}
	if (int(buff) == 3) {
		inv_getheader 0
		repeat invrange, invhead
			noteadd "" + cnt + "\t" + itemname(cnt) + "\t"
		loop
		goto *label_1361
	}
	if (int(buff) == 4) {
		if (dbg_compare == 0) {
			sdim cdatan2, 40, 10, 245
			dim cdata2, 500, 245
			dim sdata2, 600 * 2, 245
			dim inv2, 70, 5480
		}
		noteadd "cdata"
		repeat 245
			cnt2 = cnt
			repeat 500
				s = ""
				if (cnt == 6 | cnt == 10) {
					s = "*"
				}
				if (dbg_compare == 0) {
					cdata2(cnt, cnt2) = cdata(cnt, cnt2)
				}
				if (dbg_compare == 1) {
					if (cdata2(cnt, cnt2) != cdata(cnt, cnt2)) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + cdata2(cnt, cnt2) + "\t->" + cdata(cnt, cnt2)
					}
				}
			loop
		loop
		noteadd "cdatan"
		repeat 245
			cnt2 = cnt
			repeat 10
				s = ""
				if (dbg_compare == 0) {
					cdatan2(cnt, cnt2) = cdatan(cnt, cnt2)
				}
				if (dbg_compare == 1) {
					if (cdatan2(cnt, cnt2) != cdatan(cnt, cnt2)) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + cdatan2(cnt, cnt2) + "\t->" + cdatan(cnt, cnt2)
					}
				}
			loop
		loop
		noteadd "skill"
		repeat 245
			cnt2 = cnt
			repeat 600 * 2
				s = ""
				if (dbg_compare == 0) {
					sdata2(cnt, cnt2) = sdata(cnt, cnt2)
				}
				if (dbg_compare == 1) {
					if (sdata2(cnt, cnt2) != sdata(cnt, cnt2)) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + sdata2(cnt, cnt2) + "\t->" + sdata(cnt, cnt2)
					}
				}
			loop
		loop
		noteadd "inv"
		repeat 5480
			cnt2 = cnt
			repeat 70
				s = ""
				if (dbg_compare == 0) {
					inv2(cnt, cnt2) = inv(cnt, cnt2)
				}
				if (dbg_compare == 1) {
					if (inv2(cnt, cnt2) != inv(cnt, cnt2)) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + inv2(cnt, cnt2) + "\t->" + inv(cnt, cnt2)
					}
				}
			loop
		loop
		if (dbg_compare == 0) {
			dbg_compare = 1
			noteadd "Var_comparison begins."
		} else {
			dbg_compare = 0
		}
		goto *label_1361
	}
	if (int(buff) == 5) {
		repeat 1000
			noteadd "" + cnt + "\t" + gdata(cnt)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "del") != (-1) | buff == "\n") {
		dbm = ""
		goto *label_1361
	}
	if (instr(buff, 0, "freemove") != (-1)) {
		dbg_freemove = 1
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "resetmap") != (-1)) {
		gosub *label_1315
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "exitroom") != (-1)) {
		if (gCurrentMap == 35) {
			dbg_exitshowroom = 1
			noteadd "Done."
		} else {
			noteadd "Wrong map."
		}
		goto *label_1361
	}
	if (instr(buff, 0, "removequest") != (-1)) {
		repeat gNumberOfExistingQuests
			if (qdata(8, cnt) != 0) {
				if (qdata(9, cnt) == (-1)) {
					qdata(8, cnt) = 0
				}
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixmap") != (-1)) {
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (cX(cnt) < 0 | cX(cnt) >= mapWidth | cY(cnt) < 0 | cY(cnt) >= mapHeight) {
				cX(cnt) = 0
				cY(cnt) = 0
			}
		loop
		repeat 400, 5080
			if (iNumber(cnt) <= 0) {
				continue
			}
			if (iX(cnt) < 0 | iX(cnt) >= mapWidth | iY(cnt) < 0 | iY(cnt) >= mapHeight) {
				iX(cnt) = 0
				iY(cnt) = 0
			}
		loop
		cell_refresh 0, 0
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "advreset") != (-1)) {
		repeat 40 - 1, 16
			rc = cnt
			inv_getheader rc
			repeat invrange, invhead
				cnt2 = cnt
				repeat 70
					inv(cnt, cnt2) = 0
				loop
			loop
			repeat 30, 100
				cdata(cnt, rc) = 0
			loop
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "resetbuff") != (-1)) {
		repeat 16
			cdata(280 + cnt * 3, 0) = 0
			ocdata(192 + cnt * 3, 0) = 0
			cdata(281 + cnt * 3, 0) = 0
			ocdata(193 + cnt * 3, 0) = 0
			cdata(282 + cnt * 3, 0) = 0
			ocdata(194 + cnt * 3, 0) = 0
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixcorrupt1") != (-1)) {
		repeat 57
			rc = cnt
			inv_getheader rc
			repeat invrange, invhead
				cnt2 = cnt
				if (iId(cnt) >= 800 | iId(cnt) <= 0 | iNumber(cnt) <= 0) {
					repeat 70
						inv(cnt, cnt2) = 0
					loop
				}
				if (iBodyPart(cnt) != 0) {
					iBodyPart(cnt) = 0
				}
			loop
			repeat 30, 100
				cdata(cnt, rc) = cdata(cnt, rc) / 10000 * 10000
			loop
			if (cnt >= 16 & cRole(cnt) != 10001 & cRole(cnt) != 10018 & eqfaction(cnt, "petshop") == 0) {
				cState(cnt) = 5
				gosub *label_1533
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixcorrupt2") != (-1)) {
		repeat 245
			cnt2 = cnt
			repeat length(racenamecsv)
				if (cdatan(2, cnt2) == racenamecsv(cnt, 1)) {
					cMeleeAttackType(cnt2) = racevaluecsv(cnt, 18)
					cSpecialAttackType(cnt2) = racevaluecsv(cnt, 19)
				}
			loop
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixpcc") != (-1)) {
		repeat length(racenamecsv)
			if (cdatan(2, 0) == racenamecsv(cnt, 1)) {
				cImage(0) = racevaluecsv(cnt, 3)
				if (cSex(0) == 1) {
					if (racevaluecsv(cnt, 4)) {
						cImage(0) = racevaluecsv(cnt, 4)
					}
				}
				break
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixpet1") != (-1)) {
		repeat 244, 1
			if (petcheck(cnt)) {
				if (findfaction(cnt, "pet", "0") == 0) {
					addfaction cnt, "pet,0"
				}
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixpet2") != (-1)) {
		repeat 244, 1
			if (petcheck(cnt)) {
				cRelationship(cnt) = 10
				cOriginalRelationship(cnt) = 10
				cHate(cnt) = 0
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixpet3") != (-1)) {
		repeat 244, 1
			if (petcheck(cnt)) {
				cRelationship(cnt) = 10
				cOriginalRelationship(cnt) = 10
				cHate(cnt) = 0
				rmfaction cnt, "pet"
				addfaction cnt, "pet,0"
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixfeat1") != (-1)) {
		repeat 245
			if (gettrait(cnt, 8)) {
				p = stat
				if (p <= 3) {
					continue
				}
				settrait cnt, 8, 3
				if (cnt == 0) {
					gAcquirableFeatCount += p - 3
				} else {
					ocdata(105, cnt) += p - 3
				}
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "client") != (-1)) {
		dim mapclient, 1000
		repeat 500
			if (qdata(0, cnt) == 0) {
				i = cnt
				continue
			}
			noteadd "id:" + cnt + " name:" + qname(cnt) + " map:" + mapname(qdata(1, cnt))
			mapclient(qdata(1, cnt))++
		loop
		repeat 1000
			if (mapclient(cnt) != 0) {
				noteadd "" + mapname(cnt) + ":" + mapclient(cnt), 1
			}
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "mapchara") != (-1)) {
		repeat 189, 56
			noteadd "id:" + cnt + " name:" + cdatan(0, cnt)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "108fix") != (-1)) {
		repeat 245
			if (cnt < 57) {
				continue
			}
			if (cState(cnt) == 1) {
				cRelationship(cnt) = -3
				cOriginalRelationship(cnt) = -3
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "test") != (-1)) {
		repeat 500
			noteadd "" + cnt + ":" + mapname(cnt) + "/" + areaId(cnt)
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "mapinfo") != (-1)) {
		noteadd "gArea\t\t:" + gCurrentMap
		noteadd "gLevel\t\t:" + gCurrentDungeonLevel
		noteadd "file\t\t:" + "mdata_" + mid + ".s2"
		noteadd "pc x/y\t\t:" + cX(0) + "/" + cY(0)
		noteadd "map max w/h\t:" + mapWidth + "/" + mapHeight
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "showfaction") != (-1)) {
		repeat 245
			noteadd "" + cnt + "\t" + cdatan(0, cnt) + "(" + getrelation(cnt) + ")\n\t" + faction(cnt)
		loop
		repeat 50, 245
			noteadd "" + cnt + "\t\t" + faction(cnt)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "quest") != (-1)) {
		noteadd "gQuest:" + gExecutingImmediateQuestType + " gQuestRef:" + gExecutingImmediateQuest + " gQuestStatus:" + gdata(73) + " rq:" + rq
		repeat 5
			p = gdata(160 + cnt)
			noteadd "quest" + cnt + " " + p + " exist" + qdata(3, p) + " status" + qdata(8, p) + " var" + qdata(4, p) + " encount" + qdata(10, p)
		loop
		repeat gNumberOfExistingQuests
			noteadd "" + cnt + " " + qdata(0, cnt) + "/" + qdata(1, cnt)
		loop
		goto *label_1361
	}
	/*称号を全部獲得できる　未実装*/
	if (instr(buff, 0, "achievement") != (-1) && gWizard == 1) {
		repeat 10
		if (ogdata(520 + cnt) == 0) {
			ogdata(520 + cnt) = 1
		}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "gamereset") != (-1) && gWizard == 1) {
		gdata(250 + 2) = 0
		gdata(250 + 3) = 0
		gdata(250 + 4) = 0
		gdata(250 + 5) = 0
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "updateST") != (-1)) {
		initializeSouthTyrisTowns
		if (gCurrentMap == areaId_tormat) {
			if (gCurrentDungeonLevel == 1) {
				f = 0
				repeat 188, 57
					if (cId(cnt) == 386) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					f = get_freechara()
					if (f != (-1)) {
						flt
						characreate -1, 386, 26, 2
						cRole(rc) = 3300
					}
				}
				noteadd "Added NPC."
			}
		}
		if (gCurrentMap == areaId_serria) {
			if (gCurrentDungeonLevel == 1) {
				f = 0
				repeat 188, 57
					if (cId(cnt) == 387) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					f = get_freechara()
					if (f != (-1)) {
						flt
						characreate -1, 387, 30, 6
						cRole(rc) = 3301
					}
				}
				f = 0
				repeat 188, 57
					if (cId(cnt) == 389) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					f = get_freechara()
					if (f != (-1)) {
						flt
						characreate -1, 389, 3, 33
						cRole(rc) = 3303
					}
				}
				noteadd "Added NPC."
			}
		}
		if (gCurrentMap == areaId_carlia) {
			if (gCurrentDungeonLevel == 1) {
				f = 0
				repeat 188, 57
					if (cId(cnt) == 388) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					f = get_freechara()
					if (f != (-1)) {
						flt
						characreate -1, 388, 30, 23
						cRole(rc) = 3302
					}
				}
				noteadd "Added NPC."
			}
		}
		if (gCurrentMap == areaId_khios) {
			if (gCurrentDungeonLevel == 1) {
				f = 0
				repeat 188, 57
					if (cId(cnt) == 392) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					f = get_freechara()
					if (f != (-1)) {
						flt
						characreate -1, 392, 23, 13
						cRole(rc) = 3306
					}
				}
				noteadd "Added NPC."
			}
		}
		if (gCurrentMap == areaId_trian) {
			if (gCurrentDungeonLevel == 1) {
				f = 0
				repeat 188, 57
					if (cId(cnt) == 391) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					f = get_freechara()
					if (f != (-1)) {
						flt
						characreate -1, 391, 15, 15
						cRole(rc) = 3305
					}
				}
				noteadd "Added NPC."
			}
		}
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "checkTitle") != (-1)) {
		// 棄てられた農村地
		if (gCurrentMap == 58) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				f = 0
				repeat 188, 57
					if (eqfaction(cnt, "st_ruralboss") & cState(cnt) == 1) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					newtitle 90
				}
				noteadd "Added Title."
			}
		}
		// 古代の遺跡
		if (gCurrentMap == 57) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				f = 0
				repeat 188, 57
					if (eqfaction(cnt, "st_ruinboss") & cState(cnt) == 1) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					newtitle 91
				}
				noteadd "Added Title."
			}
		}
		// 氷窟
		if (gCurrentMap == 62) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				f = 0
				repeat 188, 57
					if (eqfaction(cnt, "nc_subquest_ice") & cState(cnt) == 1) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					newtitle 92
				}
				noteadd "Added Title."
			}
		}
		// 変異種の洞窟
		if (gCurrentMap == 60) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				f = 0
				repeat 188, 57
					if (eqfaction(cnt, "st_caveboss") & cState(cnt) == 1) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					newtitle 93
				}
				noteadd "Added Title."
			}
		}
		// 忘れられた実験場
		if (gCurrentMap == 63) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				f = 0
				repeat 188, 57
					if (eqfaction(cnt, "nc_isekiboss") & cState(cnt) == 1) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					newtitle 94
				}
				noteadd "Added Title."
			}
		}
		// 混沌の城
		if (gCurrentMap == 59) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				f = 0
				repeat 188, 57
					if (eqfaction(cnt, "st_feaboss") & cState(cnt) == 1) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					newtitle 95
				}
				noteadd "Added Title."
			}
		}
		//フェアリゾート購入済み
		if (ncgdata(201) == 1) {
			newtitle 99
			noteadd "Added Title."
		}
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fix_armor") != (-1)) {
		repeat 16
			if (cState(cnt) != 1) {
				continue
			}
			nc_intb_001 = cnt
			repeat 30
				body = 100 + cnt
				if (cdata(body, nc_intb_001) \ 10000 == 0) {
					continue
				}
				nc_intb_002 = (cdata(body, nc_intb_001) \ 10000) - 1
				if (iCurseState(nc_intb_002) < 0) {
					continue
				}
				r1 = nc_intb_001
				gosub *label_1419
			loop
			inv_getheader cnt
			repeat invrange, invhead
				if (iCurseState(cnt) < 0) {
					continue
				}
				iBodyPart(cnt) = 0
			loop
			r1 = nc_intb_001
			gosub *chara_refresh
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fix_trait") != (-1)) {
		repeat 16
			if (cState(cnt) != 1) {
				continue
			}
			if (gettrait(cnt, 96) != 0) {
				featcnt = stat
				rmfaction cnt, "trait96," + featcnt
				addfaction cnt, "trait130," + featcnt
			}
			if (gettrait(cnt, 97) != 0) {
				featcnt = stat
				rmfaction cnt, "trait97," + featcnt
				addfaction cnt, "trait131," + featcnt
			}
			if (gettrait(cnt, 98) != 0) {
				featcnt = stat
				rmfaction cnt, "trait98," + featcnt
				addfaction cnt, "trait132," + featcnt
			}
			if (cnt == 0) {
				if (gettrait(cnt, 100) != 0) {
					featcnt = stat
					rmfaction cnt, "trait100," + featcnt
					addfaction cnt, "trait250," + featcnt
				}
				if (gettrait(cnt, 101) != 0) {
					featcnt = stat
					rmfaction cnt, "trait101," + featcnt
					addfaction cnt, "trait251," + featcnt
				}
				if (gettrait(cnt, 102) != 0) {
					featcnt = stat
					rmfaction cnt, "trait102," + featcnt
					addfaction cnt, "trait252," + featcnt
				}
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fix_ai") != (-1)) {
		repeat 188, 57
			if (cState(cnt) == 1) {
				if (cAiActSubFreq(cnt) == 101) {
					cAiActSubFreq(cnt) = 100
				}
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fix_magicbookshop") != (-1)) {
		repeat 800
			if (itemmemory(2, cnt) == 2) {
				itemmemory(2, cnt) = 1
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fix_haizin") != (-1)) {
		repeat 188, 57
			memset sdataEx(0, cnt), 0, 600 * 4
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fix_eter") != (-1)) {
		if (gEtherDiseaseStage == 0) {
			repeat 40
				gdata(700 + cnt) = 0
			loop
			noteadd "Done."
		}
		goto *label_1361
	}
	if (instr(buff, 0, "eter") != (-1)) {
		repeat 40
			noteadd str(700 + cnt) + ":" + gdata(700 + cnt)
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "wish_count") != (-1)) {
		noteadd "Wish count: " + gWishCount
		noteadd "Probability that you lost chance to wish in next well:\n" + (90 * gWishCount / (gWishCount + 1)) + "%"
		goto *label_1361
	}
	if (instr(buff, 0, "updateoomseskills") != (-1)) {
		repeat 245
			cnt2@tmp = cnt
			cAiHeal(cnt) = migration_oomse2oomsestId(cAiHeal(cnt))
			repeat 10, 215
				cdata(cnt, cnt2@tmp) = migration_oomse2oomsestId(cdata(cnt, cnt2@tmp))
			loop
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "gameclear") != (-1) & gWizard == 1) {
		gdata(250 + 2) = 200
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "haizin") != (-1) & gWizard == 1) {
		ogdata(499) = 1
		goto *label_1361
	}
	if (instr(buff, 0, "bigench") != (-1) & gWizard == 1) {
		iBigenchantmentId(0) = 10002
		iBigenchantmentPower(0) = 5
		goto *label_1361
	}
	if (instr(buff, 0, "meisei") != (-1) & gWizard == 1) {
		cFame(0) = 1000000
		goto *label_1361
	}
	if (instr(buff, 0, "allheal") != (-1) & gWizard == 1) {
		repeat 16
				if (ocdata(192 + cnt * 3, 0) == 0 ) {
						continue
				}
				delbuff 0, cnt
				continue cnt
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "Gamebreak") != (-1) & gWizard == 1) {
		repeat 2
		sdata(2 + 600, cnt) = 2000 * 1000000
		sdata(3 + 600, cnt) = 2000 * 1000000
		sdata(10 + 600, cnt) = 2000 * 1000000
		sdata(11 + 600, cnt) = 2000 * 1000000
		sdata(12 + 600, cnt) = 2000 * 1000000
		sdata(13 + 600, cnt) = 2000 * 1000000
		sdata(14 + 600, cnt) = 2000 * 1000000
		sdata(15 + 600, cnt) = 2000 * 1000000
		sdata(16 + 600, cnt) = 2000 * 1000000
		sdata(17 + 600, cnt) = 2000 * 1000000
		sdata(18 + 600, cnt) = 2000 * 1000000
		sdata(19 + 600, cnt) = 2000 * 1000000
		sdataEx(2, cnt) = 97999
		sdataEx(3, cnt) = 97999
		sdataEx(10, cnt) = 97999
		sdataEx(11, cnt) = 97999
		sdataEx(12, cnt) = 97999
		sdataEx(13, cnt) = 97999
		sdataEx(14, cnt) = 97999
		sdataEx(15, cnt) = 97999
		sdataEx(16, cnt) = 97999
		sdataEx(17, cnt) = 97999
		sdataEx(18, cnt) = 97999
		sdataEx(19, cnt) = 97999
	loop
		noteadd "99999に"
		goto *label_1361
	}
	if (instr(buff, 0, "elapse_day") != (-1) && gWizard == 1) {
		gDay++
		datetime_normalizeGameDate
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "elapse_week") != (-1) && gWizard == 1) {
		gDay += 7
		datetime_normalizeGameDate
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "elapse_month") != (-1) && gWizard == 1) {
		gMonth++
		datetime_normalizeGameDate
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "elapse_year") != (-1) && gWizard == 1) {
		gYear++
		repeat 16
			if (gettrait(cnt, 97) == 1) {
				cBirthYear(cnt)++
				if (cBirthYear(cnt) > gYear) {
					cBirthYear(cnt) = gYear
				}
			}
		loop
		datetime_normalizeGameDate
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "crash") != (-1)) {
		f = rnd(0)
		noteadd "Wizard mode activated."
		goto *label_1361
	}
	if (instr(buff, 0, "wizard") != (-1)) {
		gWizard = 1
		cdatan(1, 0) = "*Debug*"
		noteadd "Wizard mode activated."
		goto *label_1361
	}
	if (instr(buff, 0, "natural") != (-1)) {
		gWizard = 0
		cdatan(1, 0) = "*Debug*"
		noteadd "Wizard mode inactivated."
		goto *label_1361
	}
	if (instr(buff, 0, "resetstquest") != (-1) & gWizard) {
		ncgdata(152) = 0
		ncgdata(153) = 0
		noteadd "Reset."
		goto *label_1361
	}
	if (instr(buff, 0, "magicall") != (-1) & gWizard) {
		repeat 67
			sdata(1000 + cnt, 0) = 2000000000
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "outputinv") != (-1)) {
		delstr buff, "outputinv"
		p = int(buff)
		noteadd itemname(p)
		repeat 70
			noteadd "inv(" + cnt + ", " + p + ") = " + inv(cnt, p)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "outputfileloaded") != (-1)) {
		sreplace buff, loadedbuff, "/", "\n"
		notesel buff
		notesave exedir + "loadedBuff.txt"
		noteunsel
		noteadd "Done."
		exec exedir + "loadedBuff.txt", 16
		goto *label_1361
	}
	if (instr(buff, 0, "unique") != (-1)) {
		noteadd lang("オークの隊長『ゴダ』\t\t", "<Goda> the captain of orc\t") + npcmemory(1, 25)
		noteadd lang("マッドサイエンティスト\t\t", "<Mad scientist>\t\t\t") + npcmemory(1, 26)
		noteadd lang("堕天使『イスカ』\t\t", "<Isca> the fallen angel\t\t") + npcmemory(1, 27)
		noteadd lang("『ダンジョンクリーナー』\t", "<Dungeon cleaner>\t\t") + npcmemory(1, 32)
		repeat usernpcmax
			if (userdata(12, cnt) == 2) {
				se_length = strlen(userdatan(1, cnt))
				s = "\t"
				if (se_length < 8 * 1) {
					s += "\t"
				}
				if (se_length < 8 * 2) {
					s += "\t"
				}
				if (se_length < 8 * 3) {
					s += "\t"
				}
				if (se_length < 8 * 4) {
					s += "\t"
				}
				noteadd userdatan(1, cnt) + s + str(getcnpcmemory(1, cnt))
			}
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "usernpc") != (-1)) {
		repeat usernpcmax
			se_length = strlen(userdatan(1, cnt))
			s = "\t"
			if (se_length < 8 * 1) {
				s += "\t"
			}
			if (se_length < 8 * 2) {
				s += "\t"
			}
			if (se_length < 8 * 3) {
				s += "\t"
			}
			if (se_length < 8 * 4) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + userdatan(1, cnt) + s + userdatan(0, cnt)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "useritem") != (-1)) {
		repeat useritemmax
			se_length = strlen(useritemdatan(1, cnt))
			s = "\t"
			if (se_length < 8 * 1) {
				s += "\t"
			}
			if (se_length < 8 * 2) {
				s += "\t"
			}
			if (se_length < 8 * 3) {
				s += "\t"
			}
			if (se_length < 8 * 4) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + useritemdatan(1, cnt) + s + useritemdatan(0, cnt)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "usergod") != (-1)) {
		repeat usergodmax
			se_length = strlen(cgodName(cnt))
			s = "\t"
			if (se_length < 8 * 1) {
				s += "\t"
			}
			if (se_length < 8 * 2) {
				s += "\t"
			}
			if (se_length < 8 * 3) {
				s += "\t"
			}
			if (se_length < 8 * 4) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + cgodName(cnt) + s + cgodId(cnt)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "userrace") != (-1)) {
		repeat length(racenamecsv)
			se_length = strlen(racenamecsv(cnt, 0))
			s = "\t"
			if (se_length < 8 * 1) {
				s += "\t"
			}
			if (se_length < 8 * 2) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + racenamecsv(cnt, 0) + s + racenamecsv(cnt, 1)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "userclass") != (-1)) {
		repeat length(classnamecsv)
			se_length = strlen(classnamecsv(cnt, 0))
			s = "\t"
			if (se_length < 8 * 1) {
				s += "\t"
			}
			if (se_length < 8 * 2) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + classnamecsv(cnt, 0) + s + classnamecsv(cnt, 1)
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "youngerladyreset") != (-1)) {
		repeat 1
			if (ogdata(27) != (-1)) {
				break
			}
			f@se = 1
			repeat 40 - 1, 16
				if (cRole(cnt) == 20000 | ocdata(100, cnt) == 20000) {
					f@se = 0
					break
				}
			loop
			if (f@se) {
				ogdata(27) = 0
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "petaireset") != (-1)) {
		repeat 15, 1
			cnt2 = cnt
			if (cState(cnt) == 0) {
				continue
			}
			if (cId(cnt) == 343) {
				initunid = cCnpcId(cnt) + 1
			}
			characreate 56, cId(cnt), -3, 0
			cDamageReactionInfo(cnt) = cDamageReactionInfo(56)
			cAiCalm(cnt) = cAiCalm(56)
			cAiMove(cnt) = cAiMove(56)
			cAiDist(cnt) = cAiDist(56)
			cAiActSubFreq(cnt) = cAiActSubFreq(56)
			cAiHeal(cnt) = cAiHeal(56)
			cAiActNum(cnt) = cAiActNum(56)
			repeat 10, 215
				cdata(cnt, cnt2) = cdata(cnt, 56)
			loop
			cElementOfUnarmedAttack(cnt) = cElementOfUnarmedAttack(56)
			chara_vanquish 56
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixhammer") != (-1)) {
		repeat 200
			if (iNumber(cnt) == 0) {
				continue
			}
			if (equalsitem(cnt, "blacksmith hammer")) {
				if (ogdata(427) < iEnhancement(cnt)) {
					ogdata(427) = iEnhancement(cnt)
				}
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "inheritance") != (-1)) {
		delstr buff, "inheritance"
		p = int(buff)
		noteadd itemname(p)
		noteadd "Page\tId\tName"
		repeat 1700
			randomize 10500 + cnt
			s = "" + (cnt / 17 + 1) + "\t" + (10500 + cnt) + "\t" + random_title(3)
			if (cnt \ 17 == 0) {
				s += lang("(選択不可)", "(Unavailable)")
			}
			randomize 50500 + cnt
			dim ginga, 15
			ginga = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
			gingamax = 0
			cibk2 = ci
			ci = 5480
			dbid = iId(p)
			dbmode = 3
			gosub *label_2426
			iNumber(ci) = 0
			ci = cibk2
			repeat 10
				p@m42 = rnd(15)
				if (iEnchantmentId(p, p@m42) == 0) {
					continue
				}
				f@m42 = 0
				repeat gingamax + 1
					if (p@m42 == ginga(cnt)) {
						f@m42 = 1
						break
					}
				loop
				if (f@m42 == 0) {
					i = iMaterial(p)
					repeat 8
						if (mtenc(cnt * 2, i) == 0) {
							break
						}
						mtencid = mtenc(cnt * 2, i)
						if (mtencid == 0) {
							break
						}
						if (iEnchantmentId(p, p@m42) == mtencid) {
							if (iEnchantmentPower(p, p@m42) - mtenc(cnt * 2 + 1, i) <= 0) {
								f@m42 = 1
								break
							}
						}
					loop
				}
				if (f@m42 == 0) {
					repeat length(fixeditemenc)
						if (fixeditemenc(cnt * 2) == 0) {
							break
						}
						if (iEnchantmentId(p, p@m42) != fixeditemenc(cnt * 2)) {
							continue
						}
						if (iEnchantmentPower(p, p@m42) - fixeditemenc(cnt * 2 + 1) <= 0) {
							f@m42 = 1
							break
						}
					loop
				}
				if (f@m42 == 1) {
					continue
				}
				if (rnd(4) > gingamax | iEnchantmentPower(p, p@m42) < 0) {
					ginga(gingamax) = p@m42
					gingamax++
				}
			loop
			randomize
			repeat gingamax
				s += "\t" + (ginga(cnt) + 1)
			loop
			noteadd s
		loop
		goto *label_1361
	}
	if (instr(buff, 0, "enchantmentlist") != (-1) & gWizard) {
		delstr buff, "enchantmentlist"
		ci = int(buff)
		buff = ""
		nc_intb_living = 1
		notesel buff_list
		noteadd "Page\t\tId\t\tName"
		repeat 1000000
			title str(cnt) + "/1000000"
			randomize 10500 + cnt
			s3 = random_title(3)
			if (cnt \ 17 == 0) {
				s3 += lang("(選択不可)", "(Unavailable)")
			}
			s2 = "" + (cnt / 17 + 1) + "\t\t" + (10500 + cnt) + "\t\t" + s3
			repeat 50 - strlen(s3)
				s2 += " "
			loop
			cnt2 = cnt
			repeat 50
				randomize 50500 + cnt2 + cnt + 10
				exrand_randomize 50500 + cnt2 + cnt + 10
				encadd ci, randomenc(randomenclv(4)), randomencp(0, 0), 0, 0, 1
				if (stat != 0) {
					if (rtval == 34) {
						if (rnd(3)) {
							continue
						}
					}
					if (encpassivecheck(rtval)) {
						if (encfindspec(ci, rtval) != (-1)) {
							continue
						}
					}
					list_bk(0, listmax) = rtval, rtval(1)
					val = list_bk(0, listmax), list_bk(1, listmax)
					gosub *label_0297
					noteadd s2 + cnven(s)
					break
				} else {
					continue
				}
			loop
		loop
		notesave "list.txt"
		nc_intb_living = 0
		goto *label_1361
	}
	if (instr(buff, 0, "searchnameEX") != (-1)) {
		f = 0
		delstr buff, "searchnameEX"
		noteadd "検索結果:" + buff
		repeat 2000000000
			randomize 10500 + cnt
			if (cnt \ 17 == 0) {
				continue
			}
			if (instr(buff, 0, random_title(3)) != (-1)) {
				noteadd "" + (cnt / 17 + 1) + "Pに存在します"
				f = 1
				break
			}
		loop
		if (f == 0) {
			noteadd "見つかりませんでした"
		}
		goto *label_1361
	}
	if (instr(buff, 0, "searchnameP") != (-1)) {
		f = 0
		delstr buff, "searchnameP"
		noteadd "検索結果:" + buff
		repeat 100000000
			randomize 10500 + cnt
			if (cnt \ 17 == 0) {
				continue
			}
			if (instr(buff, 0, random_title(3)) != (-1)) {
				noteadd "" + (cnt / 17 + 1) + "Pに存在します"
				f = 1
				break
			}
		loop
		if (f == 0) {
			noteadd "見つかりませんでした"
		}
		goto *label_1361
	}
	if (instr(buff, 0, "searchname") != (-1)) {
		f = 0
		delstr buff, "searchname"
		noteadd "検索結果:" + buff
		repeat 1000000
			randomize 10500 + cnt
			if (cnt \ 17 == 0) {
				continue
			}
			if (instr(buff, 0, random_title(3)) != (-1)) {
				noteadd "" + (cnt / 17 + 1) + "Pに存在します"
				f = 1
				break
			}
		loop
		if (f == 0) {
			noteadd "見つかりませんでした"
		}
		goto *label_1361
	}
	if (instr(buff, 0, "fixammoenc") != (-1)) {
		repeat 200
			cnt2 = cnt
			repeat 15
				if (iEnchantmentId(cnt2, cnt) / 10000 != 9) {
					continue
				}
				if (iEnchantmentPower(cnt2, cnt) > 999999) {
					iEnchantmentPower(cnt2, cnt) = 999999
				}
			loop
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "cell_refreshAll") != (-1)) {
		repeat mapHeight
			cnt2 = cnt
			repeat mapWidth
				cell_refresh cnt, cnt2
			loop
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "resetfaction") != (-1)) {
		rmfaction 0, "nature"
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixadventurer1") != (-1)) {
		repeat 55 - 16, 16
			rmfaction cnt, "pet"
			rmfaction cnt, "align"
			addfaction cnt, "align,neutral"
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "containerize") != (-1)) {
		repeat 5480
			ci = cnt
			gosub *itemGen_containerize
			if (iId(ci) == 492) {
				iCount(ci) = 10
			}
			if (iId(ci) == 493) {
				iCount(ci) = 17
				iFunction(ci) = 1503
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixbyakko") != (-1)) {
		repeat 244, 1
			if (cId(cnt) == 343) {
				if (userdatan(0, cnt) == "byakko") {
					cAiActSubFreq(cnt) = 0
					cdata(220, cnt) = 0, 0, 0, 0, 0
					cAiActNum(cnt) = 5
					cbitmod 16, cnt, 0
				}
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixfaction2") != (-1)) {
		repeat 244, 1
			if (cState(cnt) != 0) {
				r1 = cnt
				resetfaction r1
				refreshfaction r1
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixrelation1") != (-1)) {
		cRelationship(0) = 10
		cOriginalRelationship(0) = 10
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixguild1") != (-1)) {
		if (areaId(gCurrentMap) == 36 | areaId(gCurrentMap) == 14 | areaId(gCurrentMap) == 11) {
			if (gCurrentDungeonLevel == 3) {
				if (mapType == 5) {
					mapType = 2
				}
			}
		}
		noteadd "Done."
		goto *label_1361
	}
	if (gWizard | 0) {
		if (instr(buff, 0, "gain_spell") != (-1)) {
			repeat 549 - 400, 400
				skillgain 0, cnt, cLevel(r1), 100 * 100
			loop
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "gain_spact") != (-1)) {
			repeat 661 - 600
				if (sdataref(0, cnt + 600) != 0) {
					spact(cnt) = 1
				}
			loop
			repeat tailspact - 661
				if (sdataref(0, cnt + 661) != 0) {
					ospact(cnt) = 1
				}
			loop
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "allinv") != (-1)) {
			repeat 5480
				if (cnt < 5080) {
					if (cnt >= 200) {
						if ((cnt - 200) \ 20 == 0) {
							noteadd "-------------------" + cdatan(0, (cnt - 200) / 20 + 1)
						}
					}
				}
				if (cnt == 5080) {
					noteadd "---------------MAP INV"
				}
				noteadd "" + cnt + "\t" + iNumber(cnt) + "\t" + itemname(cnt) + " it:" + iTurn(cnt)
			loop
			goto *label_1361
		}
		if (instr(buff, 0, "mapinv") != (-1)) {
			repeat 5480 - 5080
				if (cnt == 5080) {
					noteadd "---------------MAP INV"
				}
				if (iNumber(cnt) != 0) {
					noteadd "" + cnt + "\t" + iNumber(cnt) + "\t" + itemname(cnt) + " it:" + iTurn(cnt)
				}
			loop
			goto *label_1361
		}
		if (instr(buff, 0, "gain_exp") != (-1)) {
			cExperience(0) += 1000000000
			r1 = 0
			r2 = 0
			gosub *label_0661
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "gain_fame") != (-1)) {
			incfame 0, 10000
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "gain_money") != (-1)) {
			se_moneymod 0, 100000000
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "gain_faith") != (-1)) {
			modpiety 10000, 0
			modpiety 1, 0
			cPrayingPoint(0) = 2000
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "gain_userspell") != (-1)) {
			repeat userspellmax
				userspelldata(11, cnt) += limitmax(calcuserspellcoststock(cnt) * 200, 2147483647)
			loop
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "settarget") != (-1)) {
			word = buff
			p = 0
			i = strlen(word)
			s = "", ""
			repeat 40
				s(cnt) = ""
				getstr s(cnt), word, limit(p, 0, i), 32
				if (strsize > i) {
					break
				}
				p += strsize
			loop
			cc = int(s(1))
			lockon cc, int(s(2)), 10
			cHate(cc) = 80
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "join_guild") != (-1)) {
			word = buff
			p = 0
			i = strlen(word)
			s = "", ""
			repeat 40
				s(cnt) = ""
				getstr s(cnt), word, limit(p, 0, i), 32
				if (strsize > i) {
					break
				}
				p += strsize
			loop
			joinguild 0, s(1)
			ogdata(250) = 0, 0, 0, 0, 0
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "update_nefia") != (-1)) {
			gdata(79) = 1
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "gain_guildmasterpoint") != (-1)) {
			ogdata(253) += 5
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "mod_rank") != (-1)) {
			modrank 8, 5000, 8
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "gain_featpoint") != (-1)) {
			gAcquirableFeatCount += 50
			repeat 244, 1
				if (petcheck(cnt)) {
					ocdata(105, cnt) += 50
				}
			loop
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "set_trait") != (-1)) {
			word = buff
			p = 0
			i = strlen(word)
			s = "", "0", "0", "0"
			repeat 40
				s(cnt) = ""
				getstr s(cnt), word, limit(p, 0, i), 32
				if (strsize > i) {
					break
				}
				p += strsize
			loop
			r1 = int(s(1))
			tid = int(s(2))
			p = int(s(3))
			settrait r1, tid, p
			noteadd "Done."
			goto *label_1361
		}
		if (instr(buff, 0, "tgm") != (-1)) {
			if (dbg_godmode) {
				dbg_godmode = 0
				dbg_freesp = 0
				noteadd "god mode off."
			} else {
				dbg_godmode = 1
				dbg_freesp = 1
				noteadd "god mode on."
			}
			goto *label_1361
		}
		if (instr(buff, 0, "tai") != (-1)) {
			if (dbg_autoidentify) {
				dbg_autoidentify = 0
				noteadd "auto identify off."
			} else {
				dbg_autoidentify = 10
				noteadd "auto identify on."
			}
			goto *label_1361
		}
		if (instr(buff, 0, "gain_imp") != -1) {
			repeat 244, 1
				if (petcheck(cnt)) {
					cImpression(cnt) += 300
				}
			loop
			noteadd "Done."
			goto *label_1361
		}
	}
	if (instr(buff, 0, "resetchipm") != (-1)) {
		repeat 500
			areaExAppearance(cnt) = 0
			areaExAppearanceColor(cnt) = 0
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "resetcai") != (-1)) {
		repeat 16
			nc_aicnt = cnt
			repeat 10
				nc_aicnt2 = cnt
				repeat aipage * 15
					nc_ai(nc_aicnt, nc_aicnt2, cnt) = 0
				loop
			loop
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixaisp") != (-1)) {
		delstr buff, "fixaisp"
		repeat 229, 16
			if (cAiActSubFreq(cnt) == 101) {
				cAiActSubFreq(int(buff)) = 25
			}
		loop
		noteadd "Done."
		goto *label_1361
	}
	if (instr(buff, 0, "fixai") != (-1)) {
		delstr buff, "fixai"
		if (cId(int(buff)) != 343) {
			characreate 56, cId(int(buff)), -3, 0
			cAiCalm(int(buff)) = cAiCalm(56)
			ocdata(162, int(buff)) = cAiCalm(56)
			chara_vanquish 56
		}
		noteadd "Done."
		goto *label_1361
	}
	noteadd "Unknown command. Type \"?\" for help. Hit ESC to exit."
	goto *label_1361
	goto *label_1360
*label_1361
	noteadd ""
	objprm 1, dbm
	objprm 2, ""
	return
*label_1362
	mutexstring = "Elona_" + dir_exe
	CreateMutexA 0, 0, strtrim(mutexstring, 3, '\\')
	mutex_handle = stat
	func_2
	if (stat == 183) {
		dialog lang("二重起動のため終了します。", "The program is already running."), 1
		end
	}
	return



#defcfunc efstatusfix int __nnn, int __ooo, int __ppp, int __qqq
	if (efstatus <= (-2)) {
		return __nnn
	}
	if (efstatus == (-1)) {
		return __ooo
	}
	if (efstatus == 0) {
		return __ppp
	}
	return __qqq
*label_1364
*label_1365
	if (map(cX(0), cY(0), 6) == 0) {
		return 0
	}
	if (feat(1) == 0 >= 24 & feat(1) == 0 <= 28) {
		return 0
	}
	atxspot = 11
	atxlv = limitmax(gCurrentDungeonLevel, 2000)
	if (mapType == 20) {
		atxspot = 9
	}
	if (mapType == 21) {
		atxspot = 12
	}
	if (mapType == 22) {
		atxspot = 10
	}
	if (mapType == 23) {
		atxspot = 12
	}
	if (mapType == 1) {
		atxlv = difficulty() / 2 + rnd(10)
		if (atxlv > 30) {
			atxlv = 30 + rnd(rnd(atxlv - 30) + 1)
		}
		if (4 <= gdata(62) & gdata(62) < 9) {
			atxspot = 10
		}
		if (264 <= gdata(62) & gdata(62) < 363) {
			atxspot = 11
		}
		if (9 <= gdata(62) & gdata(62) < 13) {
			atxspot = 10
		}
		if (13 <= gdata(62) & gdata(62) < 17) {
			atxspot = 11
		}
	}
	axtskill = 161
	cell_featread cX(0), cY(0)
	if (feat(1) == 24) {
		atxlv = limitmax(gCurrentDungeonLevel + rnd(10), 2000)
		atxspot = 16
		axtskill = 159
	}
	if (feat(1) == 27) {
		atxlv = limitmax(gCurrentDungeonLevel + rnd(10), 2000)
		atxspot = 16
		axtskill = 159
	}
	if (feat(1) == 25) {
		atxlv = limitmax(gCurrentDungeonLevel + rnd(10), 2000)
		atxspot = 14
		axtskill = 163
	}
	if (feat(1) == 26) {
		atxlv = limitmax(gCurrentDungeonLevel + rnd(10), 2000)
		atxspot = 13
		axtskill = 185
	}
	if (feat(1) == 28) {
		atxlv = limitmax(gCurrentDungeonLevel + rnd(10), 2000)
		atxspot = 15
		axtskill = 180
	}
	if (rnd(10) == 0) {
		ctalk cc, 1324, cc, cc, atxspot
		if ( stat == 0 ) {
			ctalk cc, 1323, cc, cc
		}
	}
	if (rnd(7) == 0) {
		repeat 1
			i = 5
			if (atxspot == 13) {
				if (sdata(axtskill, 0) < rnd(atxlv * 2 + 1) | rndex(10 + sorgEx(axtskill, 0) / 20) == 0) {
					txt -1, lang("釣りに失敗した。", "Your fishing attempt fails.")
					skillexp2 185, 0, 5
					break
				}
				i = 2
				skillexp2 185, 0, 40
			}
			if (atxspot == 14) {
				if (sdata(axtskill, 0) < rnd(atxlv * 2 + 1) | rndex(10 + sorgEx(axtskill, 0) / 20) == 0) {
					txt -1, lang("採掘に失敗した。", "Your mining attempt fails.")
					skillexp2 163, 0, 5
					break
				}
				i = 1
				skillexp2 163, 0, 40
			}
			if (atxspot == 15) {
				if (sdata(axtskill, 0) < rnd(atxlv * 2 + 1) | rndex(10 + sorgEx(axtskill, 0) / 20) == 0) {
					txt -1, lang("採取に失敗した。", "Your searching attempt fails.")
					skillexp2 180, 0, 5
					break
				}
				i = 3
				skillexp2 180, 0, 30
			}
			if (atxspot == 16) {
				if (sdata(axtskill, 0) < rnd(atxlv * 2 + 1) | rndex(10 + sorgEx(axtskill, 0) / 20) == 0) {
					txt -1, lang("採取に失敗した。", "Your searching attempt fails.")
					skillexp2 159, 0, 5
					break
				}
				i = 3
				skillexp2 159, 0, 30
			}
			matgetmain random_material(atxspot, atxlv), limit(rnd(3) + sdata(axtskill, 0) / 15, 1, 12), i
		loop
	}
	if (rnd(50 + gettrait(0, 159) * 20) == 0) {
		s = lang("もう何もない。", "You can't find anything anymore.")
		if (feat(1) == 26) {
			s = lang("泉は干上がった。", "The spring dries up.")
		}
		if (feat(1) == 25) {
			s = lang("鉱石を掘りつくした。", "There's no more ore around.")
		}
		if (feat(1) == 28) {
			s = lang("もう目ぼしい植物は見当たらない。", "There's no more plant around.")
		}
		txt -1, s
		rowactend cc
		map(cX(0), cY(0), 6) = 0
	}
	return
*label_1366
	cell_featset movx, movy, 0
	if (godcheck(cc) == "mani") {
		txt -1, lang(name(cc) + "は罠を解体した。", "You dismantle the trap.")
		repeat rndex2(3 + cPietyPoint(cc) / 4000) + 1
			olist = 13, 14, 15, 16
			olistmax = 4
			atxspot = olist(rnd(olistmax))
			matgetmain random_material(atxspot, 5 + (cPietyPoint(cc) / 400)), rndex(10) + 1
		loop
	} else {
		txt -1, lang(name(cc) + "は罠を解除した。", "You disarm the trap.")
	}
	return
*label_1367
	if (cfg_scroll) {
		if (cc == 0) {
			gosub *label_0643
		}
	}
	map(cX(cc), cY(cc), 1) = 0
	cX(cc) = cNextX(cc)
	cY(cc) = cNextY(cc)
	map(cNextX(cc), cNextY(cc), 1) = cc + 1
	if (cc == 0) {
		if (gMount != 0) {
			cX(gMount) = cX(0)
			cY(gMount) = cY(0)
		}
	} else {
		if (ocdata(106, cc) != 0) {
			cX(ocdata(106, cc)) = cX(cc)
			cY(ocdata(106, cc)) = cY(cc)
		}
	}
	gosub *label_1670
	return
*label_1368
	if (cContinuousActionId(cc) == 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は" + itemname(ci) + "の演奏をはじめた。", name(cc) + " start" + _s(cc) + " to play " + itemname(ci) + ".")
		}
		cContinuousActionId(cc) = 6
		cContinuousActionTurn(cc) = 61
		cContinuousActionItem(cc) = ci
		cQualityOfPerformance(cc) = 40
		cTipGold(cc) = 0
		if (cc == 0) {
			performtips = 0
			repeat 15, 1
				if (cState(cnt) != 1) {
					continue
				}
				if (synccheck(cnt, -1) == 0) {
					continue
				}
				if (cContinuousActionId(cnt) != 0) {
					continue
				}
				if (sdata(183, cnt) == 0) {
					continue
				}
				if (ocdata(6, cnt) != 0) {
					continue
				}
				cContinuousActionId(cnt) = 10006
				cContinuousActionTurn(cnt) = 61
				cQualityOfPerformance(cnt) = 40
				cTipGold(cnt) = 0
				txt -1, lang(name(cnt) + "は" + name(cc) + "の演奏に合わせて歌いはじめた。", name(cnt) + " began singing in accordance with " + name(cc) + "'s performance.")
			loop
			throwsstpevent "Performance", cc, itemname(ci), sdata(183, cc)
		}
		return
	}
	if (cContinuousActionId(cc) == 10006 | cContinuousActionId(cc) == 20006) {
		if (cc != 0) {
			if (cContinuousActionId(0) != 6 & cContinuousActionId(0) != 10006) {
				cContinuousActionTurn(cc) = 0
			} else {
				cContinuousActionTurn(cc) = cContinuousActionTurn(0)
			}
		}
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (cContinuousActionId(cc) == 30006) {
			cTipGold(cc) = 0
			cQualityOfPerformance(cc) = 40
			if (cContinuousActionTurn(cc) \ 10 == 0) {
				if (synccheck(cc, -1)) {
						ctalk cc, 421, cc, cc
							if (stat == 0) {
								txtef 4
								txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
							}
				}
				repeat 245
					if (cState(cnt) != 1) {
						continue
					}
					if (getgametime() >= cTimeInterestRevive(cnt)) {
						cInterest(cnt) = 100
					}
					if (synccheck(cc, -1)) {
						if (cVisionFlag(cnt) != msync) {
							continue
						}
					} else {
						if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3) {
							continue
						}
					}
					if (cInterest(cnt) <= 0) {
						continue
					}
					if (cSleep(cnt) > 0) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if (map(x, y, 1) == 0) {
						continue
					}
					tc = cnt
					if (tc == cc) {
						continue
					}
					if (cContinuousActionId(tc) != 0) {
						continue
					}
					if (cRelationship(cc) == cRelationship(tc)) {
						aniref = 0
						animeid = 11
						anix = cX(tc)
						aniy = cY(tc)
						gosub *label_0630
						addbuff tc, 5, sdata(183, cc) * 5 + 50, 16
						addbuff tc, 7, sdata(183, cc) * 5 + 100, 16
						addbuff tc, 12, sdata(183, cc) * 5 + 100, 16
						skillexp2 183, cc, 50, 0, 0
						continue
					}
				loop
			}
		}
		if (cContinuousActionId(cc) == 30007) {
			cTipGold(cc) = 0
			cQualityOfPerformance(cc) = 40
			if (cContinuousActionTurn(cc) \ 10 == 0) {
				if (synccheck(cc, -1)) {
						ctalk cc, 421, cc, cc
							if (stat == 0) {
								txtef 4
								txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
							}
				}
				repeat 245
					if (cState(cnt) != 1) {
						continue
					}
					if (getgametime() >= cTimeInterestRevive(cnt)) {
						cInterest(cnt) = 100
					}
					if (synccheck(cc, -1)) {
						if (cVisionFlag(cnt) != msync) {
							continue
						}
					} else {
						if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3) {
							continue
						}
					}
					if (cInterest(cnt) <= 0) {
						continue
					}
					if (cSleep(cnt) > 0) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if (map(x, y, 1) == 0) {
						continue
					}
					tc = cnt
					if (tc == cc) {
						continue
					}
					if (cContinuousActionId(tc) != 0) {
						continue
					}
					if (cRelationship(cc) == cRelationship(tc)) {
						aniref = 0
						animeid = 11
						anix = cX(tc)
						aniy = cY(tc)
						gosub *label_0630
						addbuff tc, 1, sdata(183, cc) * 5 + 100, 16
						addbuff tc, 3, sdata(183, cc) * 10 + 500, 16
						addbuff tc, 10, sdata(183, cc) * 10 + 100, 16
						addbuff tc, 18, 1500, 11
						skillexp2 183, cc, 50, 0, 0
						continue
					}
				loop
			}
		}
		if (cContinuousActionId(cc) == 30008) {
			cTipGold(cc) = 0
			cQualityOfPerformance(cc) = 40
			if (cContinuousActionTurn(cc) \ 10 == 0) {
				if (synccheck(cc, -1)) {
							ctalk cc, 421, cc, cc
							if (stat == 0) {
								txtef 4
								txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
							}
				}
				repeat 245
					if (cState(cnt) != 1) {
						continue
					}
					if (getgametime() >= cTimeInterestRevive(cnt)) {
						cInterest(cnt) = 100
					}
					if (synccheck(cc, -1)) {
						if (cVisionFlag(cnt) != msync) {
							continue
						}
					} else {
						if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3) {
							continue
						}
					}
					if (cInterest(cnt) <= 0) {
						continue
					}
					if (cSleep(cnt) > 0) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if (map(x, y, 1) == 0) {
						continue
					}
					tc = cnt
					if (tc == cc) {
						continue
					}
					if (cContinuousActionId(tc) != 0) {
						continue
					}
					if (cRelationship(tc) == (-1) | cRelationship(tc) == (-2) | cRelationship(tc) == (-3)) {
						aniref = 0
						animeid = 2
						anix = cX(tc)
						aniy = cY(tc)
						gosub *label_0630
						addbuff tc, 6, sdata(183, cc) * 5 + 50, 11
						addbuff tc, 8, sdata(183, cc) * 5 + 100, 11
						dmghp tc, role((sdata(183, cc) / 10) + 2, (sdata(183, cc) / 5) + 5, (sdata(183, cc) * 10) / cContinuousActionTurn(cc)), cc, 57
						if (rnd(3) == 0) {
							unlockon tc, cc
							cHate(tc) = 0
						}
						skillexp2 183, cc, 50, 0, 0
						continue
					}
				loop
			}
		}
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (cContinuousActionId(cc) == 10006) {
			if (cContinuousActionTurn(cc) \ 10 == 0) {
				if (synccheck(cc, -1)) {
					if (rnd(10) == 0) {
						ctalk cc, 421, cc, cc
						if (stat == 0) {
							txtef 4
							txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
						}
					}
				}
			}
		} else {
			if (cContinuousActionTurn(cc) \ 10 == 0 & (cContinuousActionId(cc) == 6 | cContinuousActionId(cc) == 20006)) {
				if (synccheck(cc, -1)) {
					ctalk cc, 1224, cc, cc
					if ( stat == 0 ) {
						if (rnd(10) == 0) {
							txtef 4
							txt -1, lang("ﾁｬﾗﾝ♪ ", "*Tiki*"), lang("ﾎﾟﾛﾝ♪ ", "*Dan*"), lang("ﾀﾞｰﾝ♪ ", "*Lala*")
						}
						txtef 4
						txt -1, lang("ｼﾞｬﾝ♪ ", "*Cha*")
					}
				}
			}
		}
		if (cContinuousActionTurn(cc) \ 20 == 0 & (cContinuousActionId(cc) == 6 | cContinuousActionId(cc) == 10006 | cContinuousActionId(cc) == 20006)) {
			gold = 0
			make_sound cX(cc), cY(cc), 5, 1, 1, cc
			repeat 245
				if (cContinuousActionId(cc) != 10006) {
					ci = cContinuousActionItem(cc)
				}
				if (cState(cnt) != 1) {
					continue
				}
				if (getgametime() >= cTimeInterestRevive(cnt)) {
					cInterest(cnt) = 100
				}
				if (synccheck(cc, -1)) {
					if (cVisionFlag(cnt) != msync) {
						continue
					}
				} else {
					if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3) {
						continue
					}
				}
				if (cInterest(cnt) <= 0) {
					continue
				}
				if (cSleep(cnt) > 0) {
					continue
				}
				x = cX(cnt)
				y = cY(cnt)
				if (map(x, y, 1) == 0) {
					continue
				}
				tc = cnt
				if (tc == cc) {
					continue
				}
				if (cContinuousActionId(tc) != 0) {
					continue
				}
				if (cRelationship(tc) == (-3)) {
					if (cHate(tc) == 0) {
						if (synccheck(tc, -1)) {
							txt -1, lang(name(tc) + "は激怒した。", name(tc) + " get" + _s(tc) + " angry.")
						}
					}
					cHate(tc) = 30
					continue
				}
				if (cc == 0) {
					cInterest(tc) -= rnd(15)
					cTimeInterestRevive(tc) = getgametime() + 12
				}
				if (cInterest(tc) <= 0) {
					if (synccheck(cc, -1)) {
						txtef 9
						ctalk tc, 978, cc, tc
						if (stat == 0) {
							ctalk tc, 1225, cc, tc
							if (stat == 0) {
								txtef 9
								if (jp) {
									txt tc, "「飽きた」", "「前にも聴いたよ」", "「またこの曲か…」"
								}
								if (en) {
									txt tc, cnvtalk("Boring."), cnvtalk("I've heard this before."), cnvtalk("This song again?")
								}
							}
						}
					}
					cInterest(tc) = 0
					continue
				}
				performance = sdata(183, cc)
				if (petcheck(cc)) {
					if (sdata(183, 0) < sdata(183, cc)) {
						performance = sdata(183, 0)
					}
				} else {
					if (performance < cLevel(tc) * 2 / 3) {
						if (rnd(3) == 0) {
							if (performance_check()) {
								cQualityOfPerformance(cc) -= cLevel(tc) / 2
								if (synccheck(cc, -1)) {
									txtef 9
									ctalk tc, 977, cc, tc
									if (stat == 0) {
										ctalk tc, 1226, cc, tc
										if (stat == 0) {
											txtef 9
											if (jp) {
												txt tc, "「引っ込め！」", "「うるさい！」", "「下手っぴ！」", "「何のつもりだ！」"
											}
											if (en) {
												txt tc, cnvtalk("Boo boo!"), cnvtalk("Shut it!"), cnvtalk("What are you doing!"), cnvtalk("You can't play shit.")
											}
										}
									}
									ctalk tc, 976, cc, tc
									if (stat == 0) {
										txt -1, lang("" + name(tc) + "は石を投げた。", name(tc) + " throw" + _s(tc) + " a rock.")
									}
								}
								dmg = rnd(cLevel(tc) + 1) + 1
								if (cId(tc) == 29) {
									dmg = cLevel(tc) * 2 + rnd(100)
								}
								if (tc == 0 & ogdata(464) == 2) {
									dmg = cLevel(tc) * 2 + rnd(100)
								}
								dmghp cc, dmg, -8
								if (cState(cc) == 0) {
									break
								}
								continue
							} else {
								if (cdata(140, cc) != 10006) {
									txtef 8
									txt -1, lang(name(tc) + "は嫌な顔をした。", name(tc) + " glare" + _s(tc) + " at you.")
									ctalk tc, 1282, cc, tc
								}
							}
						}
					} else {
						if (gCurrentMap == 5) {
							if (cId(tc) == 29) {
								if (tc >= 57) {
									cExperience(tc) += 500000
								}
							}
						}
					}
				}
				if (rnd(3) == 0) {
					if (cContinuousActionId(cc) == 10006) {
						p = cQualityOfPerformance(cc) * cQualityOfPerformance(cc) * (100 + gettrait(cc, 72) * 10) / 100 / 1000 + rnd(10)
					} else {
						p = cQualityOfPerformance(cc) * cQualityOfPerformance(cc) * (100 + iParam1(ci) / 5) / 100 / 1000 + rnd(10)
					}
					p = limit(cGold(tc) * limit(p, 1, 100) / 125, 0, performance * 100)
					if (petcheck(tc)) {
						p = rnd(limit(p, 1, 100)) + 1
					}
					if (chara_isShopKeeper(tc)) {
						p /= 5
					}
					if (gExecutingImmediateQuestType == 1009 & ogdata(33) == 1) {
						p *= 2
					}
					if (p > cGold(tc)) {
						p = cGold(tc)
					}
					cGold(tc) -= p
					se_moneymod cc, p
					gold += p
				}
				if (cLevel(tc) > performance) {
					continue
				}
				p = rnd(cLevel(tc) + 1) + 1
				if (rnd(performance + 1) > rnd(cLevel(tc) * 2 + 1)) {
					if (gExecutingImmediateQuestType == 1009) {
						if (tc >= 57) {
							cImpression(tc) += rnd(3)
							calcpartyscore
						}
					}
					if (rnd(2) == 0) {
						cQualityOfPerformance(cc) += p
					} else {
						if (rnd(2) == 0) {
							cQualityOfPerformance(cc) -= p
						}
					}
				}
				if (cContinuousActionId(cc) == 10006) {
					if (gettrait(cc, 72)) {
						if (rnd(10) < calctraitscore(stat)) {
							dmgcon tc, 8, 500
						}
					}
					if (petcheck(cc)) {
						continue
					}
				} else {
					if (findbuff(cc, 62) == (-1) | check_bigench(ci) == 3) {
						if (encfindspec(ci, 60) != (-1)) {
							if (rnd(15) == 0) {
								dmgcon tc, 8, 500
							}
						}
					}
					if (iId(ci) == 725) {
						if (rnd(15) == 0) {
							if (tc >= 57) {
								if (cQuality(tc) != 6) {
									dmghp tc, 9999, 0, 57
								}
							}
						}
					}
				}
				if (rnd(performance + 1) > rnd(cLevel(tc) * 5 + 1)) {
					if (rnd(3) == 0) {
						if (synccheck(cc, -1)) {
							txtef 9
							ctalk tc, 975, cc, tc
							if (stat == 0) {
								ctalk tc, 1227, cc, tc
									if (stat == 0) {
									txtef 9
									if (jp) {
										txt tc, name(tc) + "は歓声を上げた。", name(tc) + "は目を輝かせた。", "「ブラボー」", "「いいぞ！」", name(tc) + "はうっとりした。", name(tc) + "は" + name(cc) + "の" + skillnameref(183, cc) + "を褒め称えた。"
									}
									if (en) {
										txt tc, name(tc) + " clap" + _s(tc) + ".", name(tc) + " listen" + _s(tc) + " to " + name(cc) + your(cc) + " music joyfully.", cnvtalk("Bravo!"), cnvtalk("Nice song."), cnvtalk("Scut!"), name(tc) + " " + is(tc) + " excited!"
									}
								}
							}
						}
						cQualityOfPerformance(cc) += cLevel(tc) + 5
						if (cc == 0) {
							if (petcheck(tc) == 0) {
								if (rnd(performtips * 2 + 2) == 0) {
									x = limit(cX(cc) - 1 + rnd(3), 0, mapWidth - 1)
									y = limit(cY(cc) - 1 + rnd(3), 0, mapHeight - 1)
									cell_check2 x, y
									if (cellaccess == 0) {
										continue
									}
									if (fov_los(cX(tc), cY(tc), x, y) == 0) {
										continue
									}
									objlv = 0
									if ((cContinuousActionId(cc) == 10006 & gettrait(cc, 72)) | (findbuff(cc, 62) == -1 & encfindspec(ci, 49) != -1)) {
										flt calcobjlv(cQualityOfPerformance(cc) / 8), calcfixlv(3 + (rnd(4) == 0))
									}
									if (objlv == 0) {
										flt calcobjlv(cQualityOfPerformance(cc) / 10), calcfixlv(3)
									}
									flttypemajor = fsetperform(rnd(length(fsetperform)))
									dbid = 0
									if (gExecutingImmediateQuestType == 1009) {
										if (rnd(150) == 0) {
											dbid = 241
										}
										if (rnd(150) == 0) {
											dbid = 622
										}
										if (cLevel(tc) > 15) {
											if (rnd(1000) == 0) {
												dbid = 725
											}
										}
										if (cLevel(tc) > 10) {
											if (rnd(800) == 0) {
												dbid = 726
											}
										}
									} else {
										if (rnd(10) == 0) {
											dbid = 724
										}
										if (rnd(250) == 0) {
											dbid = 55
										}
									}
									if (gExecutingImmediateQuestType == 1009 & ogdata(33) == 1) {
										flt calcobjlv(cQualityOfPerformance(cc) / 6), calcfixlv(3 + (rnd(2) == 0))
										flttypemajor = fsetperform2(rnd(length(fsetperform2)))
										if (rnd(50) == 0) {
											dbid = 505
										}
										if (rnd(50) == 0) {
											dbid = 622
										}
										if (rnd(80) == 0) {
											dbid = 706
										}
										if (rnd(80) == 0) {
											dbid = 737
										}
										if (rnd(100) == 0) {
											dbid = 290
										}
										if (rnd(100) == 0) {
											dbid = 626
										}
									}
									itemcreate -1, dbid, x, y, 1
									if (stat != 0) {
										iNumber(ci)--
										cell_refresh iX(ci), iY(ci)
										ccbk = cc
										cc = tc
										animeid = 15
										if (cfg_useffhp) {
											aniref = iImage(ci), iColor(ci), ci
										} else {
											aniref = iImage(ci), iColor(ci)
										}
										anix = iX(ci)
										aniy = iY(ci)
										gosub *label_0630
										cc = ccbk
										iNumber(ci)++
										cell_refresh iX(ci), iY(ci)
										performtips++
									}
								}
							}
						}
					}
				}
			loop
			if (gold != 0) {
				cTipGold(cc) += gold
				if (synccheck(cc, -1)) {
					snd 11
				}
			}
		}
		return
	}
	repeat 1
		if (cc != 0) {
			break
		}
		if (cContinuousActionId(cc) == 30006 | cContinuousActionId(cc) == 30007 | cContinuousActionId(cc) == 30008) {
			txt -1, lang("歌い終わった。", "It is a finish.")
			break
		}
		if (cQualityOfPerformance(cc) < 0) {
			txt -1, lang("まるで駄目だ…", "It is a waste of time.")
			break
		}
		if (cQualityOfPerformance(cc) < 20) {
			txt -1, lang("不評だった…", "Almost everyone ignores you.")
			break
		}
		if (cQualityOfPerformance(cc) < 40) {
			txt -1, lang("もっと練習しなくては…", "You need to practice lot more.")
			break
		}
		if (cQualityOfPerformance(cc) == 40) {
			txt -1, lang(skillnameref(183, cc) + "を終えた。", name(cc) + " finish" + _s(cc, 1) + " " + his(cc) + " performance.")
			break
		}
		if (cQualityOfPerformance(cc) < 60) {
			txt -1, lang("いまいちだ。", "Not good.")
			break
		}
		if (cQualityOfPerformance(cc) < 80) {
			txt -1, lang("手ごたえがあった。", "People seem to like your performance.")
			break
		}
		if (cQualityOfPerformance(cc) < 100) {
			txt -1, lang("納得できる" + skillnameref(183, cc) + "ができた。", his(cc) + " performance is successful.")
			break
		}
		if (cQualityOfPerformance(cc) < 120) {
			txt -1, lang("大盛況だ！", "Wonderful!")
			break
		}
		if (cQualityOfPerformance(cc) < 150) {
			txt -1, lang("素晴らしい！", "Great performance. Everyone cheers you.")
			break
		}
		txt -1, lang("歴史に残る名演だ！", "A Legendary stage!")
		break
	loop
	if (cQualityOfPerformance(cc) > 40) {
		if (cContinuousActionId(cc) == 10006) {
			cQualityOfPerformance(cc) = cQualityOfPerformance(cc) * (100 + gettrait(cc, 72) * 10) / 100
		} else {
			cQualityOfPerformance(cc) = cQualityOfPerformance(cc) * (100 + iParam1(ci) / 5) / 100
		}
	}
	if (cTipGold(cc) != 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は合計 " + thousandsep(str(cTipGold(cc))) + strgold + "のおひねりを貰った。", "The audience gives " + name(cc) + " total of " + cTipGold(cc) + " gold pieces.")
		}
		if (cc == 0) {
			if (cTipGold(cc) > ncgdata(65)) {
				ncgdata(65) = cTipGold(cc)
				yarikomi = 13
				gosub *label_N311
			}
		}
	}
	rowactend cc
	r1 = cQualityOfPerformance(cc) - performance + 50
	if (r1 > 0) {
		gosub *label_0674
	}
	return
*label_1369
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 11
		cContinuousActionTurn(cc) = 25 + rnd(10)
		cContinuousActionTarget(cc) = tc
		if (cc == 0 & tc == 0) {
			cContinuousActionId(tc) = 11, 50
		} else {
			cContinuousActionId(tc) = 11, 2000000
		}
		cContinuousActionTarget(tc) = cc + 10000
		if (synccheck(cc, -1)) {
			ctalk cc, 1205, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は服を脱ぎ始めた。", name(cc) + " begin" + _s(cc) + " to take " + his(cc) + " clothes off.")
			}
		}
		if (cc == 0) {
			throwsstpevent "ClothOut", tc, "", 0
		}
		return
	}
	sexhost = 1
	tc = cContinuousActionTarget(cc)
	if (tc >= 10000) {
		tc -= 10000
		sexhost = 0
	}
	if (cState(tc) != 1 | cContinuousActionId(tc) != 11) {
		if (synccheck(cc, -1)) {
			ctalk cc, 980, cc, tc
			if (stat == 0) {
				ctalk cc, 1207, cc, tc
				if (stat == 0) {
					txt cc, lang("「そ、その" + _sex2(cSex(tc)) + "とは体だけの関係" + _da() + _ore(3) + "は何も知らないから、命だけは…！」", "\"I-I don't really know that " + _sex2(cSex(tc)) + ". Please spare my life!\"")
				}
			}
		}
		rowactend cc
		rowactend tc
		return
	} else {
		if (cc != tc & cContinuousActionId(tc) == 11) {
			if (cContinuousActionTurn(tc) >= 1000000 & cContinuousActionTurn(tc) <= 2000000 - 200) {
				goto *label_nc_sexskip
			}
		}
	}
	if (cc == 0) {
		p = gettrait(cc, 74)
		if (p == 0 | rnd(10) >= calctraitscore(p)) {
				if (trophycheck(7) == 2) {
					actionsp 0, rnd(2)
				} else {
					actionsp 0, 1 + rnd(2)
				}
		}
		if (stat == 0) {
			txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
			rowactend cc
			rowactend tc
			return
		}
		if (gettrait(0, 250) > 0 & cNutrition(0) <= 12000) {
			cNutrition(0) += 160
		}
	}
	cEmotionIcon(cc) = 17 + 100 * 3
	if (cContinuousActionTurn(cc) > 0) {
		if (sexhost == 0) {
			if (cContinuousActionTurn(cc) \ 5 == 0) {
				if (synccheck(cc, -1)) {
					txtef 9
					ctalk cc, 1164, cc, tc
					if (stat == 0) {
						ctalk cc, 1163, cc, tc
						if (stat == 0) {
							ctalk cc, 999, cc, tc
							if (stat == 0) {
								ctalk cc, 1206, cc, tc
								if (stat == 0) {
									txtef 9
									if (jp) {
										txt cc, "「きくぅ」", "「もふもふ」", "「くやしい、でも…」", "「はぁはぁ！」", "「ウフフフ」"
									}
									if (en) {
										txt cc, cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("Come on!")
									}
								}
							}
						}
					}
				}
			}
			if (cc == 0 | tc == 0) {
				if (rnd(5) == 0) {
					item_find 2001, 4
					if (stat != (-1)) {
						snd 57
						txtef 4
						txt -1, lang(" *チャプ* ", "*sploosh*"), lang(" *バシャ* ", "*splash*")
					}
				}
			}
		}
		return
	}
*label_nc_sexskip
	if (sexhost == 0) {
		rowactend cc
		return
	}
	repeat 2
		if (cnt == 0) {
			c = cc
		} else {
			c = tc
		}
		cDrunk(cc) = 0
		if (cnt == 1) {
			if (rnd(3) == 0) {
				dmgcon c, 11, 500
			}
			if (rnd(5) == 0) {
				dmgcon c, 3, 500
			}
			dmgcon c, 11, 300
			if (godcheck(c) != "danalin") {
				healsan c, 10
			}
			skillexp2 11, c, 250 + (c >= 57) * 1000
			skillexp2 15, c, 250 + (c >= 57) * 1000
		}
		if (cc == 0 & petcheck(tc) | (ogdata(489) == 2 & (cc == 0 | tc == 0 | petcheck(cc) | petcheck(tc)))) {
		} else {
			if (rnd(15) == 0) {
				dmgcon c, 12, 200
			}
		}
		skillexp2 17, c, 250 + (c >= 57) * 1000
	loop
	if (rnd(100) < cAphropower(cc)) {
		txt -1, lang(name(tc) + "は" + name(cc) + "の防具に染み付いた媚薬を嗅いだ。", name(tc) + " sniffed an aphrodisiac.")
		dmgcon tc, 13, 100
	}
	if (trophycheck(14) == 2) {
		sexvalue = sdata(17, cc) * (100 + cAphropower(cc) + rnd(50 + gettrait(cc, 74) * 75)) + 100
	} else {
		sexvalue = sdata(17, cc) * (50 + cAphropower(cc) + rnd(50 + gettrait(cc, 74) * 50)) + 100
	}
	if (guildcheck(0) == "prostitute" & gdata(128) == 100 & cc == 0) {
		sexvalue *= 2
	}
	if ((cId(cc) == 249 | cId(cc) == 302) & cQuality(cc) == 6 & tc == 0) {
		sistersex = 1
		evadd 23
	} else {
		if (synccheck(cc, -1)) {
			if (cc == 0 | tc == 0) {
				item_find 2001, 4
				if (stat != (-1)) {
					p = cc, tc
					repeat 2
						txt -1, lang(name(p(cnt)) + "の魅力は復活した。", name(p(cnt)) + your(p(cnt)) + " charisma is restored.")
						if (cdata(247, p(cnt)) < 0) {
							cdata(247, p(cnt)) = 0
						}
						r1 = p(cnt)
						gosub *chara_refresh
					loop
				}
			}
			if (tc != 0) {
				if (sdata(151, tc) != 0) {
					repeat 2
						efcibk = ci
						efcancel = 0
						obvious = 1
						efsource = 0
						efbad = 0
						if (limitmax(sqrt(sdata(151, tc)), 10) > rnd(100)) {
							efstatus = 1
						} else {
							efstatus = 0
						}
						efid = 439 + cnt
						efp = 100
						gosub *label_1404
					loop
					skillexp2 151, tc, 60
				}
			}
			if (cc == 0) {
				txtef 9
				ctalk 0, 1166, 0, tc
				if (stat == 0) {
					ctalk 0, 1165, 0, tc
					if (stat == 0) {
						ctalk 0, 998, 0, tc
					}
				}
			}
			if (gettrait(cc, 250) > 0) {
				if (cRelationship(tc) == (-1) | cRelationship(tc) == (-2) | cRelationship(tc) == (-3)) {
					dmghp tc, sdata(17, cc) / 2, cc
				}
			}
			if (cState(tc) == 1) {
				txtef 9
				ctalk tc, 1166, cc, tc
				if (stat == 0) {
					ctalk tc, 1165, cc, tc
						if (stat == 0) {
						ctalk tc, 998, cc, tc
						if (stat == 0) {
							ctalk tc, 1208, cc, tc
							if (stat == 0) {
								txtef 9
								if (jp) {
									txt tc, "「よかった" + _yo(3) + "！」", "「す、すごい" + _yo(3) + "！」", "「も、もうだめ" + _da(3) + "！」", "「は、激しかった" + _yo(3) + "！」", "「か、完敗" + _da(3) + "！」"
								}
								if (en) {
									txt tc, "\"You are awesome!", "\"Oh my god....", "\"Okay, okay, you win!", "\"Holy...!"
								}
							}
						}
					}
				}
			}
		}
		nc_intb_100 = 0
		if (cc == 0) {
			if (cRole(tc) == 3120) {
				if (rnd(20) + 1 < limit(rnd(cLevel(tc) * 2 + 1) - sdata(17, cc), 1, 15) - (gettrait(cc, 74) * 2)) {
					txtef 3
					txt -1, lang("客が料金を渋り、怒って襲いかかってきた！", "The customer balked at the price and angrily attacked you!")
					lockon tc, 0, 3
					cHate(tc) = 20
					cEmotionIcon(tc) = 18 + 100 * 3
					nc_intb_100 = 1
				}
			}
		}
		if (nc_intb_100 == 0 & tc != 0) {
			if ((cc == 0 & petcheck(tc)) == 0) {
				if ((cc == 0 & cId(tc) == 343 & cQuality(tc) == 6) == 0) {
					if (petcheck(cc) == 0 | petcheck(tc) == 0) {
						if (cGold(tc) >= sexvalue) {
							if (cState(tc) == 1) {
								txtef 20
								if (synccheck(cc, -1)) {
									ctalk tc, 1209, cc, tc
									if (stat == 0) {
										txt tc, lang("「さあ、小遣いを受け取って" + _kure(3) + "」", "Here, take this.\"")
									}
									ctalk cc, 1253, tc, cc
								}
							}
						} else {
							if (cState(tc) == 1) {
								txtef 20
								if (synccheck(cc, -1)) {
									ctalk tc, 1210, cc, tc
									if (stat == 0) {
										txt tc, lang("「これが" + _ore(3) + "の財布の中身の全て" + _da() + "」", "Take this money, it's all I have!\"")
									}
									if (rnd(3) == 0 & cc != 0) {
										ctalk cc, 1255, tc, cc
										if ( stat == 0 ) {
											txt -1, lang(name(cc) + "は激怒した。「なめてんの？」", name(cc) + " gets furious, " + cnvtalk("And you think you can just run away?"))
										}
										lockon cc, tc, 11
										cHate(cc) = 20
									} else {
										ctalk cc, 1254, tc, cc
									}
								}
							}
							if (cGold(tc) <= 0) {
								cGold(tc) = 1
							}
							sexvalue = cGold(tc)
						}
						cGold(tc) -= sexvalue
						if (cc == 0) {
							if (sexvalue > ncgdata(62)) {
								ncgdata(62) = sexvalue
								yarikomi = 5
								gosub *label_N311
							}
							modimp tc, 5
							flt
							itemcreate -1, 54, cX(cc), cY(cc), sexvalue
							if (stat) {
								txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
							}
							if (cRole(tc) != 3120) {
								modkarma 0, -1
							}
							ogdata(436)++
							gosub *label_1177
							// ST_Guild
							if (stgdata(16) > 0) {
								stgdata(16) -= sexvalue
								if (stgdata(16) < 0) {
									stgdata(16) = 0
								}
								txtef 2
								txt -1, lang("娼婦ギルドのノルマ達成まで、あと金貨" + stgdata(16) + "枚相当の稼ぎを出す必要がある。", "You need to earn " + stgdata(16) + "more gold coins for the quota.")
							}
						} else {
							se_moneymod cc, sexvalue
						}
					}
				}
			}
		}
		if (gExecutingImmediateQuestType == 1020) {
			if (cc == 0 & cRole(tc) == 3120) {
				cImpression(tc) = 100
				cRole(tc) = 3121
				qdata(13, gExecutingImmediateQuest)++
				txtef 9
				txt -1, lang("[依頼のノルマまで、残り" + limitmin(qdata(12, gExecutingImmediateQuest) - qdata(13, gExecutingImmediateQuest), 0) + "人]", "left " + limitmin(qdata(12, gExecutingImmediateQuest) - qdata(13, gExecutingImmediateQuest), 0) + " to complete the quest.")
			}
		}
		r1 = -1
		if (ocbit(11, cc)) {
			if (gettrait(cc, 185)) {
				r1 = tc
			}
		}
		if (ocbit(11, tc)) {
			if (gettrait(tc, 185)) {
				r1 = cc
			}
		}
		if (r1 != (-1)) {
			r2 = sdata(17, r1) * 50 + 100
			if (petcheck(r1)) {
				r2 /= 4
			} else {
				cnpcrole = 0
				if (cId(r1) == 343) {
					if (userdata2(5, cCnpcId(r1))) {
						cnpcrole = userdata2(5, cCnpcId(r1))
					}
				}
				if (cId(r1) == 335 | cId(r1) == 386 | cnpcrole == 3 | eqfaction(r1, "whole")) {
					r2 *= 4
				}
			}
			modstress limit(r2, 0, 7500) * (-1)
		}
	}
	rowactend cc
	rowactend tc
	return
*label_1370
	if (cc != 0) {
		rowactend cc
		return
	}
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 10
		cContinuousActionItem(cc) = ci
		cContinuousActionTarget(cc) = tc
		if (gdata(91) == 105) {
			txt -1, lang(itemname(ci, 1) + "に目星をつけた。", "You target " + itemname(ci, 1) + ".")
			cContinuousActionTurn(cc) = 2 + limit(iWeight(ci) / 500, 0, 50)
		}
		if (gdata(91) == 100) {
			if (mapType == 5 | mapType == 3 | mapType == 2) {
				txt -1, lang("寝る仕度を始めた。", "You lie down.")
				cContinuousActionTurn(cc) = 5
			} else {
				txt -1, lang("露営の準備を始めた。", "You start to camp.")
				cContinuousActionTurn(cc) = 20
			}
		}
		if (gdata(91) == 101) {
			txt -1, lang(itemname(ci, 1) + "の建設を始めた。", "You start to construct " + itemname(ci, 1) + ".")
			cContinuousActionTurn(cc) = 25
		}
		if (gdata(91) == 102) {
			txt -1, lang(itemname(ci, 1) + "のハッチを回し始めた。", "You start to pull the hatch.")
			cContinuousActionTurn(cc) = 10
		}
		if (gdata(91) == 103) {
			txt -1, lang(itemname(ci, 1) + "を掘り始めた。", "You start to pick " + itemname(ci, 1) + ".")
			cContinuousActionTurn(cc) = 10 + limit(iWeight(ci) / (1 + sdata(10, 0) * 10 + sdata(180, 0) * 40), 1, 100)
		}
		if (gdata(91) == 104) {
			if (gWeather == 0 | gWeather == 3) {
				if (gTimeWhenTextbookBecomesAvailable > getgametime()) {
					txt -1, lang("もう飽きた。", "You are bored.")
					rowactend cc
					return
				}
			}
			gTimeWhenTextbookBecomesAvailable = getgametime() + 48
			if (iId(ci) == 563) {
				txt -1, lang(skillname(iParam1(ci)) + "の学習を始めた。", "You begin to study " + skillname(iParam1(ci)) + ".")
			} else {
				txt -1, lang("トレーニングを始めた。", "You start training.")
			}
			if (gWeather != 0 & gWeather != 3) {
				if (gCurrentMap == 30 | (mapIndoorOrOutdoor == 1 & (mapType == 5 | mapType == 3 | mapType == 2))) {
					txt -1, lang("外が悪天候なので、じっくりと取り組むことにした。", "The weather's bad outside, you have plenty of time to waste.")
				}
			}
			cContinuousActionTurn(cc) = 50
		}
		gosub *label_0623
		return
	}
	tc = cContinuousActionTarget(cc)
	if (cContinuousActionTurn(cc) > 0) {
		if (gdata(91) == 103) {
			if (rnd(5) == 0) {
				skillexp2 180, 0, 20, 4
			}
			if (rnd(6) == 0) {
				if (rnd(55) > sorg(10, cc) + 25) {
					skillexp2 10, cc, 50
				}
			}
			if (rnd(8) == 0) {
				if (rnd(55) > sorg(11, cc) + 28) {
					skillexp2 11, cc, 50
				}
			}
			if (rnd(10) == 0) {
				if (rnd(55) > sorg(15, cc) + 30) {
					skillexp2 15, cc, 50
				}
			}
			if (rnd(4) == 0) {
				ctalk cc, 1320, cc, cc
				if ( stat == 0 ) {
					txtef 9
					if (jp) {
						txt -1, " *ザクッ* ", " *♪* ", " *ズシュ* ", " *ジャリ* "
					}
					if (en) {
						txt -1, "*sing*", "*pull*", "*thud*", "*rumble*", "*gasp*"
					}
				}
			}
		}
		if (gdata(91) == 104) {
			p = 25
			if (gWeather != 0 & gWeather != 3) {
				if (gCurrentMap == 30) {
					p = 5
				}
				if (gCurrentMap != 30 & mapIndoorOrOutdoor == 1) {
					if (mapType == 5 | mapType == 3 | mapType == 2) {
						p = 5
						gMinute += 30
						if (gMinute > 1440) {
							gHour += 24
							gMinute = gMinute \ 1440
							gSecond = 0
							cibk = ci
							gosub *label_1611
							ci = cibk
						}
					}
				}
			}
			if (iId(ci) == 563) {
				if (rnd(p) == 0) {
					skillexp2 iParam1(ci), cc, 25
				}
				if ( rnd(10) == 0 ) {
					ctalk cc, 1321, cc, cc
				}
			} else {
				if (rnd(p) == 0) {
					skillexp2 randattb(), cc, 25
				}
				if ( rnd(10) == 0 ) {
					ctalk cc, 1322, cc, cc
				}
			}
		}
		if (gdata(91) == 105) {
			if (iId(ci) == 688) {
				if (rnd(15) == 0) {
					rowactend cc
					txt -1, lang("突然ふたが閉まった！", "Suddenly, the iron maiden falls forward.")
					dmghp cc, 9999, -18
					return
				}
			}
			if (iId(ci) == 689) {
				if (rnd(15) == 0) {
					rowactend cc
					txt -1, lang("突然ギロチンが落ちてきた！", "Suddenly, the guillotine is activated.")
					dmghp cc, 9999, -19
					return
				}
			}
			f = 0
			f2 = 0
			tg = inv_getowner(ci)
			if (tg != (-1)) {
				if (cOriginalRelationship(tg) == (-3)) {
					f2 = 1
				}
			}
			i = sdata(300, 0) * 5 + sdata(12, 0) + 25
			if (gHour >= 19 | gHour < 7) {
				i = i * 15 / 10
			}
			if (iQuality(ci) == 3) {
				i = i * 8 / 10
			}
			if (iQuality(ci) >= 4) {
				i = i * 5 / 10
			}
			noise = 8
			if (sdata(157, 0) > 0) {
				noise += sdata(157, 0) / 30
			}
			make_sound cX(0), cY(0), 5, noise
			repeat 229, 16
				if (cState(cnt) != 1) {
					continue
				}
				if (cSleep(cnt) != 0 | cStoned(cnt) != 0) {
					continue
				}
				if (dist(cX(cnt), cY(cnt), cX(0), cY(0)) > 5) {
					continue
				}
				if (f2 == 1) {
					if (cnt != tg) {
						continue
					}
				}
				p = rnd(i + 1) * (80 + (synccheck(cnt, -1) == 0) * 50 + dist(cX(cnt), cY(cnt), cX(0), cY(0)) * 20) / 100
				if (cnt < 57) {
					p = p * 2 / 3
				}
				if (rnd(sdata(13, cnt) + 1) > p) {
					if (synccheck(cnt, -1)) {
						txt -1, lang(name(cnt) + "は窃盗を見咎めた。", name(cnt) + " notice" + _s(cnt) + " you,")
					} else {
						txt -1, lang(name(cnt) + "は不振な物音に気づいた。", name(cnt) + " hear" + _s(cnt) + " loud noise,")
					}
					if (cRole(cnt) == 14) {
						ctalk cnt, 1260, cnt, cc
						if ( stat == 0 ) {
							txt cnt, lang("「貴様、何をしている！」", cnvtalk("You there, stop!")), lang("「スタァァップ！」", cnvtalk("You there, stop!"))
						}
					} else {
						ctalk cnt, 1259, cnt, cc
						if ( stat == 0 ) {
							txt cnt, lang("「ガード！ガード！」", cnvtalk("Guards! Guards!"))
						}
					}
					if (ogdata(476) == 2 & rnd(4) == 0) {
						ctalk cc, 1261, cc, cnt
						if ( stat == 0 ) {
							txt cnt, lang(name(0) + "「お兄ちゃ〜ん」", "\"Brother!\"")
						}
						ctalk cnt, 1262, cnt, cc
						if ( stat == 0 ) {
							txt cnt, lang("「なんだ、妹か」", "\"Huh, it's just a younger sister.\"")
						}
						txt -1, lang("あなたはうまくやりすごした。", "You skillfully evaded detection.")
					} else {
						cEmotionIcon(cnt) = 20 + 100 * 5
						f = 1
						modimp cnt, -5
					}
				}
			loop
			if (f) {
				txt -1, lang("盗みを見咎められた！", "You are found stealing.")
				modkarma 0, -5
				p = inv_getowner(ci)
				if (tg != (-1)) {
					if (cId(p) != 202) {
						if (cSleep(tg) == 0 & cStoned(tg) == 0) {
							cRelationship(tg) = -2
							hostileaction 0, tg
							modimp tg, -20
						}
					}
				}
				gohostile
			}
			if (tg != (-1)) {
				if (cState(tg) != 1) {
					if (f != 1) {
						txt -1, lang("対象は死んでいる", "The target is dead.")
						f = 1
					}
				}
				if (cRole(tg) == 20) {
					if (f != 1) {
						txt -1, lang("それは盗めない。", "It can't be stolen.")
						f = 1
					}
				}
				if (dist(cX(cc), cY(cc), cX(tg), cY(tg)) >= 3) {
					if (f != 1) {
						txt -1, lang("対象が見当たらない。", "You lose the target.")
						f = 0
					}
				}
			}
			if (iNumber(ci) <= 0) {
				f = 1
			}
			if (ibit(5, ci) == 1) {
				if (f != 1) {
					txt -1, lang("それは盗めない。", "It can't be stolen.")
					f = 1
				}
			}
			if (iWeight(ci) >= sdata(10, 0) * 500) {
				if (f != 1) {
					txt -1, lang("重すぎて手に負えない。", "It's too heavy.")
					f = 1
				}
			}
			if (itemusingfind(ci, 1) != (-1)) {
				if (f != 1) {
					txt -1, lang("そのアイテムは他の誰かが使用中だ。", "Someone else is using the item.")
					f = 1
				}
			}
			if (f) {
				txt -1, lang("行動を中断した。", "You abort stealing.")
				rowactend cc
			}
		}
		return
	}
	if (gdata(91) == 105) {
		tg = inv_getowner(ci)
		if (tg != (-1)) {
			if (cState(tg) != 1) {
				txt -1, lang("行動を中断した。", "You abort stealing.")
				rowactend cc
				return
			}
		}
		in = 1
		if (iId(ci) == 54) {
			in = iNumber(ci)
		}
		ti = inv_getfreeid(0)
		if (ti == (-1)) {
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return
		}
		if (iBodyPart(ci) != 0) {
			tc = inv_getowner(ci)
			if (tc != (-1)) {
				p = iBodyPart(ci)
				cdata(p, tc) = cdata(p, tc) / 10000 * 10000
			}
			iBodyPart(ci) = 0
			r1 = tc
			gosub *chara_refresh
		}
		if (ibit(12, ci)) {
			iCount(ci) = 0
			ibitmod 12, ci, 0
		}
		item_copy ci, ti
		iNumber(ti) = in
		ibitmod 9, ti, 1
		iOwnState(ti) = 0
		iNumber(ci) -= in
		if (iNumber(ci) <= 0) {
			cell_refresh iX(ci), iY(ci)
		}
		txt -1, lang(itemname(ti) + "を盗んだ。", "You successfully steal " + itemname(ti) + ".")
		if (iId(ci) == 54) {
			snd 11
			iNumber(ti) = 0
			se_moneymod 0, in
		} else {
			item_stack 0, ti, 1
			snd 14 + rnd(2)
		}
		gosub *refreshPCBurdenState
		skillexp2 300, 0, limit(iWeight(ti) / 25, 0, 450) + 50
		r1 = 0
		gosub *label_0672
		if (cKarma(0) >= (-30)) {
			if (rnd(3) == 0) {
				txt -1, lang("あなたは良心の呵責を感じた。", "You feel the stings of conscience.")
				modkarma 0, -1
			}
		}
		if (tc != (-1)) {
			throwsstpevent "StealItem", tc, itemname(ti, 1), 1
		} else {
			throwsstpevent "StealItem", 0, itemname(ti, 1), 0
		}
	}
	if (gdata(91) == 100) {
		txt -1, lang("あなたは眠り込んだ。", "You fall asleep.")
		gosub *label_1373
	}
	if (gdata(91) == 101) {
		snd 58
		txt -1, lang(itemname(ci, 1) + "を作り終えた。", "You finish constructing" + itemname(ci, 1) + ".")
		in = 1
		dropval = 1
		gosub *label_1417
	}
	if (gdata(91) == 102) {
		txt -1, lang(itemname(ci, 1) + "のハッチを回し終えた。", "You finish pulling the hatch of " + itemname(ci, 1) + ".")
		chatteleport = 1
		gPreviousMap2 = gCurrentMap, gCurrentDungeonLevel, cX(0), cY(0)
		gDestinationMap = 30
		gDestinationDungeonLevel = iCount(ci)
		levelexitby = 2
		snd 49
	}
	if (gdata(91) == 103) {
		txt -1, lang(itemname(ci, 1) + "を収穫した(" + cnvweight(iWeight(ci)) + ")", "You harvest " + itemname(ci, 1) + ". (" + cnvweight(iWeight(ci)) + ")")
		gosub *label_1416
	}
	if (gdata(91) == 104) {
		if (iId(ci) == 563) {
			txt -1, lang(skillname(iParam1(ci)) + "の学習を終えた。", "You finish studying " + skillname(iParam1(ci)) + ".")
		} else {
			txt -1, lang("トレーニングを終えた。", "You finish training.")
		}
	}
	rowactend cc
	return
*label_1371
	redraw 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh - inf_verh
	gmode 2
	gosub *label_0625
	if (screenupdate == 0) {
		redraw 1
	}
	screenupdate = 0
	return
*label_1372
	gsel 4
	gmode 0
	pos 0, 0
	picload_ exedir + "\\graphic\\bg_night.bmp", 1
	pos 0, 0
	gzoom windoww, windowh - inf_verh, 4, 0, 0, 640, 480, 1
	gsel 0
	return
*label_1373
	if (gCurrentMap == 13) {
		txt -1, lang("しかし、大事な用を思い出して飛び起きた。", "But you can't sleep right now.")
		gdata(98) = 0
		return
	}
	if (cdata(142, 0) != (-1)) {
		throwsstpevent "Sleep", gdata(98), itemname(cdata(142, 0), 1), gdata(98) != 0
	} else {
		throwsstpevent "Sleep", gdata(98), "", gdata(98) != 0
	}
	repeat 245
		if (cState(cnt) != 1) {
			continue
		}
		if (cRole(cnt) == 13 & cbit(969, cnt) != 0 | cRole(cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop") | cRole(cnt) == 18 | cnt < 16) {
			if (synccheck(cnt, -1)) {
				ctalk cnt, 960, cnt, cnt
			}
		}
	loop
	if (gCatchesGodSignal) {
		txtgod godcheck(), 10
	}
	redraw 0
	hide_popup@00m = 1
	gosub *label_1372
	musicloop = 1
	music = 78
	gosub *label_0122
	msg_halt
	repeat 20
		gmode 4, , , cnt * 10
		gosub *label_1371
		await 200
	loop
	gmode 2
	cc = 0
	repeat 57
		tc = cnt
		cWet(tc) = 0
		cPoisoned(tc) = 0
		cSleep(tc) = 0
		cConfused(tc) = 0
		cBlind(tc) = 0
		if (gettrait(tc, 195) != 0) {
			cBlind(tc) = 1000
		}
		cParalyzed(tc) = 0
		cStoned(tc) = 0
		cDimmed(tc) = 0
		cDrunk(tc) = 0
		cBleeding(tc) = 0
		cGravity(tc) = 0
		gContinuousActiveHours = 0
		cHp(tc) = cMaxHp(tc)
		cMp(tc) = cMaxMp(tc)
		cSp(tc) = cMaxSp(tc)
		healcon tc, 12, 7 + rnd(7)
		healcon tc, 13, 0
		if (cbit(986, tc)) {
			cAnorexiaCount(tc) -= rnd(6)
		} else {
			cAnorexiaCount(tc) -= rnd(3)
		}
		if (cAnorexiaCount(tc) < 0) {
			cure_anorexia tc
			cAnorexiaCount(tc) = 0
		}
		if (godcheck(tc) != "danalin") {
			healsan tc, 10
		}
		if (cbit(21, tc)) {
			cbitmod 974, tc, 1
		}
		if (gettrait(tc, 58)) {
			ocbitmod 9, tc, 1
		}
		ocbitmod 10, tc, 1
	loop
	f = 0
	repeat 16
		if (cnt == 0) {
			continue
		}
		if (cImpression(cnt) < 200) {
			continue
		}
		if (cState(cnt) != 1) {
			continue
		}
		f = 1
		break
	loop
	if (f == 1 & gettrait(0, 178) == 0) {
		gosub *label_N250
		if (stat != (-1)) {
			cc = 0
			tc = stat
			nightfall = 1
			gosub *label_1467
			nightfall = 0
		}
	}
	mode = 9
	timeslept = 7 + rnd(5)
	repeat timeslept
		gHour++
		gosub *label_1611
		if (mode != 9) {
			gosub *label_1372
			mode = 9
		}
		gContinuousActiveHours = 0
		gMinute = 0
		cc = 0
		gosub *label_1371
		await 500
	loop
	if (gCurrentMap != 30) {
		if (gCurrentMap != 41) {
			gosub *label_1805
		}
	}
	if (gdata(98) != 0) {
		tc = -1
		repeat 245 - 1, 1
			if (cbit(962, cnt) == 1) {
				if (cState(cnt) == 1) {
					tc = cnt
					break
				}
			}
		loop
		if (tc != (-1)) {
			s = lang("遺伝子", "Gene")
			file = "bg_re14"
			buff = lang("" + name(tc) + "とあなたは熱い一夜を供にした。新たな遺伝子が生成された。", "You spent a night with " + name(tc) + ". A new gene is created.")
			f = 0
			if (ogdata(509) == 2) {
				inv_getheader 0
				repeat invrange, invhead
					if (iid(cnt) == 699) {
						iParam1(cnt) = 1
						f = 1
					}
				loop
				if (f == 1) {
					buff += lang("この遺伝子は固定アーティファクトを含んでいる。", "")
				}
				f = 0
			}
			listmax = 0
			list(0, listmax) = 1
			listn(0, listmax) = lang("ふぅ", "Sweet.")
			listmax++
			cbitmod 962, tc, 0
			gosub *label_1097
			gosub *label_1318
		}
	}
	if (ogdata(30) != 0) {
		tc = -1
		repeat 245 - 1, 1
			if (cbit(962, cnt) == 1) {
				if (cState(cnt) == 1) {
					tc = cnt
					break
				}
			}
		loop
		if (tc != (-1)) {
			s = lang("子供", "Children")
			file = "bg_re14"
			buff = lang("" + name(tc) + "とあなたは熱い一夜を供にした。子供が生まれた。", "You spent a night with " + name(tc) + ". A new child is born.")
			listmax = 0
			list(0, listmax) = 1
			listn(0, listmax) = lang("ふぅ", "Sweet.")
			listmax++
			cbitmod 962, tc, 0
			gosub *label_1097
			flt calcobjlv(cLevel(ogdata(30))), 1
			novoidlv = 1
			if (cId(ogdata(30)) == 319 | cId(ogdata(30)) == 368) {
				chid = 176
			} else {
				if (rnd(2)) {
					chid = cId(ogdata(30))
				} else {
					chid = 0
				}
			}
			if (rnd(10)) {
				fltnrace = cdatan(2, ogdata(30))
			} else {
				p = 75, 41, 160, 176, 6, 278, 169, 330, 91, 161, 284, 335
				chid = p(rnd(12))
			}
			if (chid == 343) {
				initunid = cCnpcId(ogdata(30)) + 1
			}
			characreate 56, chid, -3, 0
			if (stat != 0) {
				cBirthYear(rc) = gYear
				if (instr(cdatan(0, ogdata(30)), 0, lang("の子供", "child")) != (-1)) {
					sreplace cdatan(0, rc), cdatan(0, ogdata(30)), "の子供", "の子孫"
				} else {
					cdatan(0, rc) = lang(cdatan(0, ogdata(30)) + "の子供", "child of " + cdatan(0, ogdata(30)))
				}
				p = rnd(10)
				if (p >= 0 & p < 5) {
					if (cId(ogdata(30)) != 343) {
						cImage(rc) = cImage(ogdata(30))
					}
				}
				if (p >= 5 & p < 9) {
					cImage(rc) = rnd(33) * 2 + 1 + cSex(rc)
					if (cImage(ogdata(30)) > 660) {
						cCnpcId(rc) = cCnpcId(ogdata(30))
					}
				}
				if (cId(ogdata(30)) != 212 & cId(ogdata(30)) != 331 & cId(ogdata(30)) != 336 & cId(ogdata(30)) != 338 & cId(ogdata(30)) != 339 & cId(ogdata(30)) != 340 & cId(ogdata(30)) != 342 & cId(ogdata(30)) != 366 & cId(ogdata(30)) != 367) {
					cAiCalm(rc) = cAiCalm(ogdata(30))
					cAiMove(rc) = cAiMove(ogdata(30))
					cAiDist(rc) = cAiDist(ogdata(30))
					cAiActSubFreq(rc) = cAiActSubFreq(ogdata(30))
					cAiHeal(rc) = cAiHeal(ogdata(30))
					cAiActNum(rc) = cAiActNum(ogdata(30))
					repeat 10
						cdata(215 + cnt, rc) = cdata(215 + cnt, ogdata(30))
					loop
					ocbitmod 0, rc, 1
				}
				rc = 56
				gosub *label_1530
			}
			ogdata(31)++
			ogdata(435)++
			gosub *label_1177
		}
	}
	gosub *label_1371
	if (cdata(142, 0) != (-1)) {
		throwsstpevent "Awake", gdata(98), itemname(cdata(142, 0), 1), gdata(98) != 0
	} else {
		throwsstpevent "Awake", gdata(98), "", gdata(98) != 0
	}
	ogdata(30) = 0
	gdata(98) = 0
	mode = 0
	wake_up
	cNutrition(cc) -= 1500 / (gettrait(0, 158) + 1)
	if (ocbit(11, cc)) {
		modstress 750
	}
	txtef 2
	txt -1, lang("" + timeslept + "時間眠った。あなたはリフレッシュした。", "You have slept for " + timeslept + " hours. You are refreshed.")
	f = 0
	if (cContinuousActionItem(0) == (-1)) {
		f = 1
	} else {
		ci = cContinuousActionItem(0)
		if (iParam1(ci) == 0 | iNumber(ci) == 0 | refitem(iId(ci), 9, ci) != 60004) {
			f = 1
		}
	}
	if (f) {
		txt -1, lang("まあまあの目覚めだ。", "You wake up feeling so so.")
	} else {
		i = 0
		repeat 8, 10
			i += sorg(cnt, 0)
		loop
		i = limit(i / 6, 10, 1000)
		exp = i * i * i / 10
		if (ncgdata(205) > 0) {
			exp *= 1.0 + int(ncgdata(205) / 2500) / 10 + 0.1
			ncgdata(205) = 0
		}
		if (gSleepExperience >= 1000000) {
			gSleepExperience = gSleepExperience / 100 * iParam1(ci)
		} else {
			gSleepExperience = gSleepExperience * iParam1(ci) / 100
		}
		grown = 0
		repeat
			if (gSleepExperience >= exp) {
				gSleepExperience -= exp
			} else {
				if (cnt != 0) {
					break
				}
			}
			modgrowth2 0, 10 + rnd(8), 1
			grown++
			if (cnt > 6) {
				if (rnd(5) == 0) {
					gSleepExperience = 0
					break
				}
			}
		loop
		txtef 2
		txt -1, lang("心地よい目覚めだ。潜在能力が伸びた(計" + grown + "%)", "You wake up feeling good. Your potential increases. (Total:" + grown + "%)")
	}
	msg_halt
	hide_popup@00m = 0
	gosub *label_0122
	autosave = 1 * (gCurrentMap != 35)
	if (cfg_noautosave > 1 & gettrait(0, 190) == 0) {
		autosave = 0
	}
	repeat 245
		if (cState(cnt) != 1) {
			continue
		}
		if (cRole(cnt) == 13 & cbit(969, cnt) != 0 | cRole(cnt) == 10001 | cRole(cnt) == 10018 | eqfaction(cnt, "petshop") | cRole(cnt) == 18 | cnt < 16) {
			if (synccheck(cnt, -1)) {
				ctalk cnt, 959, cnt, cnt
			}
		}
	loop
	if (gCatchesGodSignal) {
		txtgod godcheck(), 2434
	}
	return
*label_1374
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 4
		cContinuousActionTurn(cc) = r1
		txt -1, lang("あなたは横になった。", "You lie down to rest.")
		gosub *label_0623
		return
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (cContinuousActionTurn(cc) \ 2 == 0) {
			healsp cc, 1
		}
		if (cContinuousActionTurn(cc) \ 3 == 0) {
			healhp cc, 1
			healmp cc, 1
		}
		return
	}
	if (gContinuousActiveHours >= 30) {
		f = 0
		if (gContinuousActiveHours >= 50) {
			f = 1
		} else {
			if (rnd(2) == 0) {
				f = 1
			}
		}
		if (f == 1) {
			txt -1, lang("あなたはそのまま眠りにおちた…", "After a short while, you drop off to sleep.")
			cContinuousActionItem(cc) = -1
			gosub *label_1373
			rowactend cc
			return
		}
	}
	txt -1, lang("あなたは休息を終えた。", "You finished taking a rest.")
	rowactend cc
	return
*label_1375
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 3
		cContinuousActionTurn(cc) = 20
		if (gWeather == 3) {
			cContinuousActionTurn(cc) = cContinuousActionTurn(cc) * 13 / 10
		}
		if (gWeather == 4) {
			cContinuousActionTurn(cc) = cContinuousActionTurn(cc) * 16 / 10
		}
		if (gWeather == 2 | chipm(0, map(cX(cc), cY(cc), 0)) == 4) {
			cContinuousActionTurn(cc) = cContinuousActionTurn(cc) * 22 / 10
		}
		if (gWeather == 1) {
			cContinuousActionTurn(cc) = cContinuousActionTurn(cc) * 5 / 10
		}
		if (ogdata(487) == 2) {
			cContinuousActionTurn(cc) = cContinuousActionTurn(cc) * 8 / 10
		}
		cContinuousActionTurn(cc) = cContinuousActionTurn(cc) * 100 / (100 + gSevenLeagueBootEffect + sdata(182, 0))
		return
	}
	if (cTurn(0) \ 20 == 0) {
		if (cNutrition(0) <= 5000 & gettrait(0, 191) == 0) {
			inv_getheader cc
			f = 0
			repeat invrange, invhead
				if (iNumber(cnt) == 0) {
					continue
				}
				if (refitem(iId(cnt), 5, cnt) == 91000) {
					f = 1
					ci = cnt
					break
				}
			loop
			if (f == 1) {
				if (synccheck(cc, -1)) {
					txt -1, lang(npcn(cc) + itemname(ci, 1) + "を食べ終えた。", name(cc) + " " + have(cc) + " finished eating " + itemname(ci, 1) + ".")
				}
				gosub *label_1383
			}
		}
	}
	if (gWeather == 2 | chipm(0, map(cX(cc), cY(cc), 0)) == 4) {
		if (gProtectsFromBadWeather == 0) {
			if (rnd(100) == 0) {
				if (cbit(5, 0) == 0 | cGravity(0) > 0) {
					txtef 9
					if (jp) {
						txt -1, " *ずぶっ* ", " *ザシュ* ", " *ズボ* ", " *ズサッ* "
					}
					if (en) {
						txt -1, " *kisssh*", "*thudd*", "*siz*", "*clump*", "*skritch*"
					}
					cContinuousActionTurn(cc) += 10
				}
			}
			if (rnd(1000) == 0) {
				txtef 8
				if (jp) {
					txt -1, "積雪のせいで旅程が遅れている。", "雪道を進むのは大変な苦労だ。", "深い雪に脚をとられている。"
				}
				if (en) {
					txt -1, "Snow delays your travel.", "You are caught in a snowdrift.", "It's hard to walk on a snowy road."
				}
				cContinuousActionTurn(cc) += 50
			}
		}
		if (cNutrition(0) <= 2000) {
			if (cbit(986, 0) == 0 & cNullifyDamage(0) < 100 & gettrait(0, 191) == 0) {
				snd 18
				txt -1, lang("空腹のあまり、あなたは積もっている雪を腹にかきこんだ。", "You are too hungry. You chow down snow.")
				cNutrition(cc) += 5000
				gosub *label_1384
				dmgcon 0, 7, 1000
			}
		}
	}
	if (gWeather == 4) {
		if (gProtectsFromBadWeather == 0) {
			if (rnd(100) == 0) {
				if (cbit(5, 0) == 0 | cGravity(0) > 0) {
					txtef 9
					if (jp) {
						txt -1, " *びしゃ* ", " *ザブッ* ", " *パシャッ* ", " *ざぶ* "
					}
					if (en) {
						txt -1, "*drip*", "*sip*", "*drizzle*", "*splash*", "*kissh*"
					}
					cContinuousActionTurn(cc) += 5
				}
			}
			if (cConfused(0) == 0) {
				if (rnd(500) == 0) {
					txtef 8
					if (jp) {
						txt -1, "雨が激しすぎてどこを歩いているかもわからない！", "あまりにも視界が悪すぎる。", "豪雨のせいで前が全く見えない。"
					}
					if (en) {
						txt -1, "It's raining heavily. You lose your way.", "You can't see a thing!"
					}
					cConfused(0) = 10
				}
			} else {
				if (rnd(5) == 0) {
					cConfused(0) = 10
				}
			}
		}
		cBlind(0) = 3
		if (gettrait(0, 195) != 0) {
			cBlind(0) = 1000
		}
	}
	if (cContinuousActionTurn(cc) > 0) {
		gMinute++
		return
	}
	traveldone = 1
	gDistanceBetweenTown += 4
	rowactend cc
	return
*label_1376
	if (rowactre != 0) {
		return
	}
	ci = cContinuousActionItem(cc)
	gosub *label_1723
	return
*label_1377
	flt
	f = 1
	if (rnd(200) == 0) {
		if (finditemid("blacksmith hammer")) {
			inititemid = stat
			itemcreate cc, 743, -1, -1, 0
			f = 0
		}
	}
	// 大物
	if (rnd(limitmin(200 - (sdata(185, 0) / 10), 100)) == 0 & f) {
		// 雑魚の王 どこでも釣れる
		fish = 41
		if (rnd(3) == 0) {
			// 洞窟のヌシ 洞窟系のマップでのみ釣れる
			if (areaType(gCurrentMap) == 20) {
				fish = 37
			}
			// 不死魚 死者の洞窟内でのみ釣れる
			if (areaId(gCurrentMap) == 17) {
				fish = 38
			}
			// 灼熱魚 炎の塔でのみ釣れる
			if (areaId(gCurrentMap) == 16) {
				fish = 39
			}
			// 深淵魚 すくつもしくはならくでのみ釣れる
			if (areaId(gCurrentMap) == 42 | areaId(gCurrentMap) == 210) {
				fish = 40
			}
			// 永遠魚 異型のランダムネフィアもしくはエーテルの風が吹いている時の屋外でのみ釣れる
			if (oabit(14, gCurrentMap) | (gWeather == 1 & mapIndoorOrOutdoor == 2)) {
				fish = 42
			}
			// 終末魚 地獄のランダムネフィアでのみ釣れる
			if (oabit(5, gCurrentMap)) {
				fish = 43
			}
			// 雪魚 雪が降っている時の屋外でのみ釣れる
			if (gWeather == 2 & mapIndoorOrOutdoor == 2) {
				fish = 45
			}
			// 船魚 天候が雷雨の時のポート・セリアかポート・カプールでのみ釣れる
			if (gWeather == 4 & (areaId(gCurrentMap) == areaId_serria | areaId(gCurrentMap) == 11)) {
				fish = 46
			}
			// メカジキ 1000分の1の確率で釣れる
			if (rnd(1000) == 0 | (fish != 41 & rnd(1000) == 0)) {
				fish = 44
			}
		}
	}
	if (f) {
		itemcreate cc, fishdata(7, fish), -1, -1, 0
		iSubname(ci) = fish
		iValue(ci) = fishdata(6, fish)
		iWeight(ci) = fishdata(5, fish)
		if (fish >= 37) {
			iWeight(ci) = fishdata(5, fish) * (rndex(areaDangerLevel(gCurrentMap)) + 10)
			iValue(ci) = fishdata(6, fish) * (iWeight(ci) / 10)
			ilight(ci) = 7
			iParam1(ci) = rndex(2000000000)
			iParam3(ci) = 0
		}
		if (iId(ci) == 619 & iSubname(ci) == 30) {
			iImage(ci) = 429
			iColor(ci) = 0
			repeat
				iParam1(ci) = rnd(368)
				if (iParam1(ci) == 212 | iParam1(ci) == 340) {
					continue
				}
				if (iParam1(ci) > 353 & iParam1(ci) < 366) {
					iParam1(ci) = 343
				}
				if (iParam1(ci) == 343) {
					if (usernpcmax == 0) {
						continue
					}
					inv(33, ci) = rnd(usernpcmax)
					inv(34, ci) = createserialno(userdatan(0, inv(33, ci)))
				}
				break
			loop
		}
	}
	if (cc == 0) {
		txt -1, lang(itemname(ci, 1) + "を釣り上げた！", "You get " + itemname(ci, 1) + "!")
		if (fish >= 37) {
			txtef 2
			txt -1, lang("これは大物だ！", "This is a big one!")
			if (synccheck(cc, -1)) {
				snd 60
			}
		}
	}
	item_stack cc, ci, 1
	return
*label_1378
	if (cContinuousActionId(cc) == 0) {
		txt -1, lang("釣りを始めた。", "You start fishing.")
		snd 87
		if (rowactre == 0) {
			cContinuousActionItem(cc) = ci
		}
		cContinuousActionId(cc) = 7
		cContinuousActionTurn(cc) = 100
		racount = 0
		fishstat = 0
		gsel 9
		pos 0, 0
		picload_ exedir + "\\graphic\\fishing.bmp"
		gsel 0
		return
	}
	if (rowactre != 0) {
		gosub *label_1365
		return
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (rnd(5) == 0) {
			fishstat = 1
			gosub *label_1376
		}
		if (fishstat == 1) {
			if (rnd(5) == 0) {
				if (cfg_ST_fishingAnimation == 1) {
					repeat 4 + rnd(4)
						redraw 0
						fishanime = 1, 3 + rnd(3)
						addefmap fishx, fishy, 4, 2
						if (gLeftTurnsOfTimestop == 0) {
							scrturn++
						}
						gosub *label_0623
						redraw 1
						await cfg_wait1 * 2
					loop
				}
				if (rnd(3) == 0) {
					fishstat = 2
				}
				if (rnd(6) == 0) {
					fishstat = 0
				}
				fishanime = 0
			}
		}
		if (fishstat == 2) {
			fishanime = 2
			if (cfg_ST_fishingAnimation == 1) {
				snd 46
				cEmotionIcon(0) = 20 + 100 * 2
				repeat 8 + rnd(10)
					redraw 0
					if (gLeftTurnsOfTimestop == 0) {
						scrturn++
					}
					gosub *label_0623
					redraw 1
					await cfg_wait1 * 2
				loop
			}
			if (rnd(10)) {
				fishstat = 3
			} else {
				fishstat = 0
			}
			fishanime = 0
		}
		if (fishstat == 3) {
			fishanime = 3
			if (cfg_ST_fishingAnimation == 1) {
				repeat 28 + rnd(15)
					if (cnt \ 7 == 0) {
						snd 89
					}
					redraw 0
					fishanime(1) = cnt
					if (gLeftTurnsOfTimestop == 0) {
						scrturn++
					}
					gosub *label_0623
					addefmap fishx, fishy, 5, 2
					redraw 1
					await cfg_wait1 * 2
				loop
			}
			if (fishdata(3, fish) >= rnd(sdata(185, 0) + 1)) {
				fishstat = 0
			} else {
				fishstat = 4
			}
			fishanime = 0
		}
		if (fishstat == 4) {
			fishanime = 4
			if (cfg_ST_fishingAnimation == 1) {
				snd 88
				repeat 21
					redraw 0
					fishanime(1) = cnt
					if (cnt == 1) {
						addefmap fishx, fishy, 1, 3
					}
					if (gLeftTurnsOfTimestop == 0) {
						scrturn++
					}
					gosub *label_0623
					redraw 1
					await cfg_wait1 * 2
				loop
				snd 14 + rnd(2)
			}
			fishanime = 0
			rowactend cc
			gosub *label_1377
			r1 = 0
			if (iId(ci) == 618) {
				r1 = fishdata(3, iSubname(ci))
			}
			gosub *label_0677
			cEmotionIcon(0) = 6 + 100 * 3
			ci = nc_intb_101
			if (inv_getspace() == 0) {
				txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
				return
			}
			txtnew
			txt -1, lang("もう一度釣る？", "Try again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			valhinan = val
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval == 0) {
				if (iCount(ci) == 0) {
					txt -1, lang("釣竿には餌が付いていない。", "You need a bait to fish.")
					txt -1, lang("餌を一括装着する？", "Will you put food all at once?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval != 0) {
						return
					}
					ti = ci
					invsubroutine = 1
					invctrl = 32, 0
					gosub *label_1280
					if (stat == 0) {
						return
					}
					item_separate ti
					txt -1, lang(itemname(ci) + "を" + itemname(ti) + "に装着した。", "Added" + itemname(ti) + "to" + itemname(ci) + ".")
					iParam4(ti) = iParam1(ci)
					repeat
						if (iNumber(ci) == 0) {
							break
						}
						iCount(ti) += rnd(10) + 15
						removeitem ci, 1
					loop
					ci = ti
				}
				if (cSp(0) < 50) {
					if (cSp(0) < rnd(75)) {
						txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						dmgsp 0, sdataref(2, 185) / 2 + 1
						goto *label_1410
					}
				}
				dmgsp 0, rnd(sdataref(2, 185) / 2 + 1) + sdataref(2, 185) / 2 + 1
				item_separate ci
				nc_intb_101 = ci
				cContinuousActionItem(cc) = ci
				iCount(ci)--
				item_autostack cc, ci
				txt -1, lang("釣りを始めた。", "You start fishing.")
				snd 87
				cContinuousActionId(cc) = 7
				cContinuousActionTurn(cc) = 100
				racount = 0
				fishstat = 0
				gsel 9
				pos 0, 0
				picload_ exedir + "\\graphic\\fishing.bmp"
				gsel 0
				return
			}
		}
		if (rnd(10) == 0) {
			dmgsp cc, 1
		}
		return
	}
	txt -1, lang("何も釣れなかった…", "A waste of a time...")
	rowactend cc
	ci = nc_intb_101
	txtnew
	txt -1, lang("もう一度釣る？", "Try again?")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	valhinan = val
	val = promptx, prompty, 160, 1
	gosub *label_1353
	if (rtval == 0) {
		if (iCount(ci) == 0) {
			txt -1, lang("釣竿には餌が付いていない。", "You need a bait to fish.")
			txt -1, lang("餌を一括装着する？", "Will you put food all at once?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval != 0) {
				return
			}
			ti = ci
			invsubroutine = 1
			invctrl = 32, 0
			gosub *label_1280
			if (stat == 0) {
				return
			}
			item_separate ti
			txt -1, lang(itemname(ci) + "を" + itemname(ti) + "に装着した。", "Added" + itemname(ti) + "to" + itemname(ci) + ".")
			iParam4(ti) = iParam1(ci)
			repeat
				if (iNumber(ci) == 0) {
					break
				}
				iCount(ti) += rnd(10) + 15
				removeitem ci, 1
			loop
			ci = ti
		}
		if (cSp(0) < 50) {
			if (cSp(0) < rnd(75)) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp 0, sdataref(2, 185) / 2 + 1
				goto *label_1410
			}
		}
		dmgsp 0, rnd(sdataref(2, 185) / 2 + 1) + sdataref(2, 185) / 2 + 1
		item_separate ci
		nc_intb_101 = ci
		cContinuousActionItem(cc) = ci
		iCount(ci)--
		item_autostack cc, ci
		txt -1, lang("釣りを始めた。", "You start fishing.")
		snd 87
		cContinuousActionId(cc) = 7
		cContinuousActionTurn(cc) = 100
		racount = 0
		fishstat = 0
		gsel 9
		pos 0, 0
		picload_ exedir + "\\graphic\\fishing.bmp"
		gsel 0
		return
	}
	return
*label_1379
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 8
		cContinuousActionTurn(cc) = 40
		txt -1, lang("採取を始めた。", "You start to search the spot.")
		racount = 0
		return
	}
	if (rowactre != 0) {
		gosub *label_1365
		return
	}
	rowactend cc
	return
*label_1380
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 9
		cContinuousActionTurn(cc) = 20
		if (rowactre == 0) {
			txt -1, lang("地面を掘り始めた。", "You start to dig the ground.")
		} else {
			txt -1, lang("探索を始めた。", "You start to dig the spot.")
		}
		racount = 0
		return
	}
	if (rowactre != 0) {
		gosub *label_1365
		return
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (cTurn(cc) \ 5 == 0) {
			ctalk 0, 1302, 0, 0
			if ( stat == 0 ) {
				txtef 4
				txt -1, lang(" *ざくっ* ", "*clink*"), lang(" *カキン* ", "*smash*"), lang(" *ごつっ* ", "*thud*"), lang(" *じゃり* ", "*sing*"), lang(" *♪* ", "*sigh*")
			}
		}
		return
	}
	txt -1, lang("地面を掘り終えた。", "You finish digging.")
	if (mapType == 1) {
		inv_getheader 0
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iId(cnt) == 621) {
				if (iParam1(cnt) != 0) {
					if (iParam1(cnt) == cX(0)) {
						if (iParam2(cnt) == cY(0)) {
							if (iParam3(cnt) == gCurrentMap | iParam3(cnt) == 0) {
								snd 23
								txtef 5
								txt -1, lang(" *ガチッ* …何かがある！", "*click* ...something is there!")
								msg_halt
								snd 24
								flt
								itemcreate -1, 622, cX(0), cY(0), 2 + rnd(3)
								flt
								itemcreate -1, 55, cX(0), cY(0), 1 + rnd(3)
								flt
								itemcreate -1, 54, cX(0), cY(0), rnd(10000) + 2000
								if (ogdata(457) == 2 & godcheck(cc) == "ehekatl") {
									if (rnd(20) == 0) {
										flt
										itemcreate -1, 655, cX(0), cY(0), 0
									}
									if (rnd(20) == 0) {
										flt
										itemcreate -1, 662, cX(0), cY(0), 0
									}
									if (rnd(20) == 0) {
										flt
										itemcreate -1, 702, cX(0), cY(0), 0
									}
								}
								if (godcheck() == "krula") {
									nc_intb_krula = rnd(5)
									// ハズレ 全部fixlv2 + 呪い
									if (nc_intb_krula == 0) {
										if (rnd(50) >= limit(cPietyPoint(0) / 400, 1, 30)) {
											nc_intb_krula++
										} else {
											snd 117
											txtef 8
											txt -1, lang("宝箱に触れた途端、あなたは不気味な感覚に襲われた。", "As soon as you touched the treasure chest, you felt an eerie sensation.")
											repeat 4
												flt calcobjlv(difficulty() + 15)
												fixlv = 2
												flttypemajor = fsetchest(rnd(length(fsetchest)))
												itemcreate -1, 0, cX(0), cY(0), 0
												iCurseState(ci) = (-1)
											loop
										}
									}
									// 小さいハズレ fixlv2固定
									if (nc_intb_krula == 1) {
										if (rnd(50) >= limit(cPietyPoint(0) / 400, 1, 30)) {
											nc_intb_krula++
										} else {
											snd 117
											txtef 8
											txt -1, lang("宝箱に触れた途端、あなたはひどい頭痛におそわれた！", "As soon as you touched the treasure chest, A foul stench floods " + name(tc) + your(tc) + " nostrils!")
											repeat 4
												flt calcobjlv(difficulty() + 15)
												fixlv = 2
												flttypemajor = fsetchest(rnd(length(fsetchest)))
												itemcreate -1, 0, cX(0), cY(0), 0
											loop
										}
									}
									// ふつう
									if (nc_intb_krula == 2) {
										repeat 4
											flt calcobjlv(difficulty() + 20), calcfixlv(3)
											if (cnt == 0) {
												fixlv = 5
											}
											flttypemajor = fsetchest(rnd(length(fsetchest)))
											itemcreate -1, 0, cX(0), cY(0), 0
										loop
									}
									// 小あたり fixlv4固定
									if (nc_intb_krula == 3) {
										snd 64
										txtef 2
										txt -1, lang("宝箱に触れた途端、クルーラの笑い声が聞こえた。「にゃははっ！」", "Mew! You could hear krula laughing.")
										repeat 4
											flt calcobjlv(difficulty() + 20)
											fixlv = 4
											flttypemajor = fsetchest(rnd(length(fsetchest)))
											itemcreate -1, 0, cX(0), cY(0), 0
										loop
									}
									// 大あたり fixlv5固定
									if (nc_intb_krula == 4) {
										snd 64
										txtef 2
										txt -1, lang("宝箱に触れた途端、クルーラの温かい眼差しを感じた。「にゃーはははっ！」", "MewMewMew! You could hear krula laughing.")
										repeat 4
											flt calcobjlv(difficulty() + 25)
											fixlv = 5
											flttypemajor = fsetchest(rnd(length(fsetchest)))
											itemcreate -1, 0, cX(0), cY(0), 0
										loop
										flt
										itemcreate -1, 54, cX(0), cY(0), rndex((cfame(0) / 300) * 1000) + ((cfame(0) / 300) * 100)
										flt
										itemcreate -1, 55, cX(0), cY(0), rndex(10) + 3
									}
								} else {
									repeat 4
										flt calcobjlv(difficulty() + 10), calcfixlv(3)
										if (cnt == 0) {
											fixlv = 5
										}
										flttypemajor = fsetchest(rnd(length(fsetchest)))
										itemcreate -1, 0, cX(0), cY(0), 0
									loop
								}

								txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
								autosave = 1 * (gCurrentMap != 35)
								if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
									autosave = 0
								}
								iNumber(cnt)--
								throwsstpevent "TreasureDigging", 0, "", 0
								break
							}
						}
					}
				}
			}
		loop
	}
	spillfrag refx, refy, 1
	rowactend cc
	return
*label_1381
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 5
		cContinuousActionTurn(cc) = 40
		if (ogdata(456) == 2 & godcheck(cc) == "opatos") {
			cContinuousActionTurn(cc) = 5
		}
		if (rowactre == 0) {
			txt -1, lang("壁を掘りはじめた。", "You start to dig the wall.")
		} else {
			txt -1, lang("鉱石を掘り始めた。", "You start to dig the mining spot.")
		}
		if (chipm(0, map(refx, refy, 0)) == 6) {
			txt -1, lang("この壁はとても固そうだ！", "These walls look pretty hard!")
		}
		countdig = 0
		racount = 0
		pickax = 0
		inv_getheader cc
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iId(cnt) == 93) {
				pickax = 1
				break
			}
		loop
		return
	}
	if (rowactre != 0) {
		gosub *label_1365
		return
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (rnd(5) == 0) {
			dmgsp cc, 1
		}
		countdig++
		f = 0
		if (pickax == 1) {
			if (chipm(0, map(refx, refy, 0)) == 6) {
				if (rnd(12000) / 2 < sdata(10, cc) + sdata(163, cc) * 10) {
					f = 1
				}
				p = 30 / 2 - sdata(163, cc) / 2
				if (p > 0) {
					if (countdig <= p) {
						f = 0
					}
				}
			} else {
				if (rnd(1500) / 2 < sdata(10, cc) + sdata(163, cc) * 10) {
					f = 1
				}
				p = 20 / 2 - sdata(163, cc) / 2
				if (p > 0) {
					if (countdig <= p) {
						f = 0
					}
				}
			}
		} else {
			if (chipm(0, map(refx, refy, 0)) == 6) {
				if (rnd(12000) < sdata(10, cc) + sdata(163, cc) * 10) {
					f = 1
				}
				p = 30 - sdata(163, cc) / 2
				if (p > 0) {
					if (countdig <= p) {
						f = 0
					}
				}
			} else {
				if (rnd(1500) < sdata(10, cc) + sdata(163, cc) * 10) {
					f = 1
				}
				p = 20 - sdata(163, cc) / 2
				if (p > 0) {
					if (countdig <= p) {
						f = 0
					}
				}
			}
		}
		if (f == 1 | (gdata(250 + 0) == 2 & gCurrentMap == 7)) {
			rtval = 0
			if (rnd(5) == 0) {
				rtval = 54
			}
			if (rnd(8 - (areaType(gCurrentMap) == 20) * 4) == 0) {
				rtval = -1
			}
			if (map(refx, refy, 6) != 0) {
				cell_featread refx, refy
				if (feat(1) == 22) {
					gosub *label_1448
				}
			}
			map(refx, refy, 0) = tile_tunnel
			spillfrag refx, refy, 2
			x = refx
			y = refy
			snd 45
			if (cfg_NC_workshortening == 0 | autodig_f == 0) {
				animeid = 14
				aniref = 5
				gosub *label_0630
			}
			txt -1, lang("壁を掘り終えた。", "You finished digging the wall.")
			if (gdata(250 + 0) == 2 & gCurrentMap == 7) {
				flt
				itemcreate -1, 208, digx, digy, 0
				iCurseState(ci) = -1
				txt -1, lang("何かを見つけた。", "You found something out of crushed heaps of rock.")
				gdata(250 + 0) = 3
			} else {
				if (rtval != 0 & gCurrentMap != 30) {
					if (rtval > 0) {
						flt
						itemcreate -1, rtval, digx, digy, 0
					} else {
						if (rtval == (-1)) {
							if (rnd(20) == 0) {
								if (rnd(2) == 0) {
									flt
									itemcreate -1, 50, digx, digy, 0
								} else {
									flt
									itemcreate -1, 222, digx, digy, 0
								}
							} else {
								flt calcobjlv(gCurrentDungeonLevel), calcfixlv(3)
								flttypemajor = 77000
								itemcreate -1, 0, digx, digy, 0
							}
							if (ogdata(531) == 2) {
								if (rnd(5) == 0) {
									if (rnd(20) == 0) {
										if (rnd(2) == 0) {
											flt
											itemcreate -1, 50, digx, digy, 0
										} else {
											flt
											itemcreate -1, 222, digx, digy, 0
										}
									} else {
										flt calcobjlv(gCurrentDungeonLevel), calcfixlv(3)
										flttypemajor = 77000
										itemcreate -1, 0, digx, digy, 0
									}
								}
							}
						}
					}
					txt -1, lang("何かを見つけた。", "You found something out of crushed heaps of rock.")
				}
			}
			gosub *label_0664
			rowactend cc
		} else {
			if (cTurn(cc) \ 5 == 0) {
				ctalk 0, 1302, 0, 0
				if ( stat == 0 ) {
					txtef 4
					txt -1, lang(" *ざくっ* ", "*clink*"), lang(" *カキン* ", "*smash*"), lang(" *ごつっ* ", "*thud*"), lang(" *じゃり* ", "*sing*"), lang(" *♪* ", "*sigh*")
				}
			}
		}
		return
	}
	txt -1, lang("背中が痛い…掘るのを諦めた。", "Your back hurts...You give up digging.")
	rowactend cc
	return
*label_1382
	if (cContinuousActionId(cc) == 0) {
		cContinuousActionId(cc) = 1
		cContinuousActionTurn(cc) = 8
		if (cc < 16) {
			if (ogdata(440) == 2) {
				cContinuousActionTurn(cc) = 4
			}
		}
		cContinuousActionItem(cc) = ci
		if (synccheck(cc, -1)) {
			snd 18
			if (iOwnState(ci) == 1 & cc < 16) {
				txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "をこっそりと口に運んだ。", name(cc) + " start" + _s(cc) + " to eat " + itemname(ci, 1) + " in secret.")
			} else {
				txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "を口に運んだ。", name(cc) + " start" + _s(cc) + " to eat " + itemname(ci, 1) + ".")
			}
			if (iId(ci) == 204 & iSubname(ci) == 344) {
				txt cc, lang("「いただきマンモス」", cnvtalk("Let's eatammoth."))
			}
		}
		return
	}
	if (cContinuousActionTurn(cc) > 0) {
		return
	}
	if (synccheck(cc, -1)) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を食べ終えた。", name(cc) + " " + have(cc) + " finished eating " + itemname(ci, 1) + ".")
	}
	gosub *label_1383
	rowactend cc
	return
*label_1383
	cieat = ci
	gosub *food_applyEatingEffect
	ci = cieat
	if (cc == 0) {
		item_identify ci, 1
	}
	chara_unequip ci
	if (stat == 1) {
		r1 = cc
		gosub *chara_refresh
	}
	if (iId(ci) != 797) {
		iNumber(ci)--
	}
	if (ci >= 5080) {
		cell_refresh iX(ci), iY(ci)
	} else {
		if (cc == 0) {
			gosub *refreshPCBurdenState
		}
	}
	if (cc == 0) {
		gosub *label_1384
	} else {
		if (ci == cItemWhichWillBeUsed(cc)) {
			cItemWhichWillBeUsed(cc) = 0
		}
		if (cbit(987, cc)) {
			if (iMaterial(ci) == 35) {
				if (iParam3(ci) < 0) {
					ctalk cc, 1248, cc, cc
					if ( stat == 0 ) {
						txtef 9
						if (jp) {
							txt cc, "「うぐぐ！なんだこの飯は！」", "「うっ！」", "「……！！」", "「あれれ…」", "「…これは何の嫌がらせですか」", "「まずい！」"
						}
						if (en) {
							txt cc, cnvtalk("Yuck!!"), cnvtalk("....!!"), cnvtalk("W-What..."), cnvtalk("Are you teasing me?"), cnvtalk("You fool!")
						}
					}
					dmghp cc, 999, -12
					if (cState(cc) != 1) {
						if (cRelationship(cc) > 0) {
							modkarma 0, -5
						} else {
							modkarma 0, -1
						}
					}
					modimp tc, -25
					return
				}
			}
		}
	}
	chara_anorexia cc
	if (iId(ci) == 755 & rnd(3) | (iId(ci) == 756 & rnd(10) == 0)) {
		if (synccheck(cc, -1)) {
			txtef 8
			txt -1, lang(name(cc) + "はもちを喉につまらせた！", name(cc) + " choke" + _s(cc) + " on mochi!")
			ctalk cc, 1243, cc, cc
			if (stat == 0) {
				txt cc, lang("「むがっ」", cnvtalk("Mm-ghmm"))
			}
		}
		cChoked(cc)++
	}
	return
*label_1384
	txtef 2
	if (cNutrition(cc) >= 12000) {
		txt -1, lang("もう当分食べなくてもいい。", "Phew! You are pretty bloated."), lang("こんなに食べたことはない！", "You've never eaten this much before!"), lang("信じられないぐらい満腹だ！", "Your stomach is unbelievably full!")
		return
	}
	if (cNutrition(cc) >= 10000) {
		txt -1, lang("あなたは満足した。", "You are satisfied!"), lang("満腹だ！", "This hearty meal has filled your stomach."), lang("あなたは食欲を満たした。", "You really ate!"), lang("あなたは幸せそうに腹をさすった。", "You pat your stomach contentedly.")
		return
	}
	if (cNutrition(cc) >= 5000) {
		txt -1, lang("まだ食べられるな…", "You can eat more."), lang("あなたは腹をさすった。", "You pat your stomach."), lang("少し食欲を満たした。", "You satisfied your appetite a little.")
		return
	}
	if (cNutrition(cc) >= 2000) {
		txt -1, lang("まだまだ食べたりない。", "You are still a bit hungry."), lang("物足りない…", "Not enough..."), lang("まだ空腹だ。", "You want to eat more."), lang("少しは腹の足しになったか…", "Your stomach is still somewhat empty.")
		return
	}
	if (cNutrition(cc) >= 1000) {
		txt -1, lang("全然食べたりない！", "No, it was not enough at all."), lang("腹の足しにもならない。", "You still feel very hungry."), lang("すぐにまた腹が鳴った。", "You aren't satisfied.")
		return
	}
	txt -1, lang("こんな量では意味がない！", "It didn't help you from starving!"), lang("これぐらいでは、死を少し先に延ばしただけだ。", "It prolonged your death for seconds."), lang("無意味だ…もっと栄養をとらなければ。", "Empty! Your stomach is still empty!")
	return
*label_1385
	if (noread == 1) {
		noread = 0
		return
	}
	if (cContinuousActionId(cc) == 0) {
		r4 = 1
		if (iId(ci) == 687) {
			if (iParam2(ci) != 0) {
				txt -1, lang("それは既に解読済みだ。", "You already have decoded the book.")
				return
			}
		}
		if (cBlind(cc) != 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
			}
			return
		}
		if (iCount(ci) == 0 & iId(ci) == 798) {
			if (synccheck(cc, -1)) {
				txt -1, lang(itemname(ci, 1) + "の魔力が足りない。", name(cc) + " dont" + _s(cc) + " to read " + itemname(ci, 1) + ".")
				return
			}
		}
		cContinuousActionId(cc) = 2
		if (iId(ci) == 619 & iSubname(ci) == 30) {
			cContinuousActionTurn(cc) = 25 + rnd(10)
		} else {
			if (iId(ci) == 783) {
				p = 50
			} else {
				if (iId(ci) == 687) {
					p = 50 + iParam1(ci) * 50 + iParam1(ci) * iParam1(ci) * 20
				} else {
					p = sdataref(4, efid)
				}
			}
			cContinuousActionTurn(cc) = p / (2 + sdata(150, 0)) + 1
			item_separate ci
		}
		cContinuousActionItem(cc) = ci
		if (synccheck(cc, -1)) {
			txt -1, lang(npcn(cc) + itemname(ci, 1) + "を読み始めた。", name(cc) + " start" + _s(cc) + " to read " + itemname(ci, 1) + ".")
		}
		if (findbuff(cc, 64) != (-1)) {
			if (iId(ci) != 783 & iId(ci) != 687) {
				txt -1, lang("今は一瞬で読める。", "Very Easy.")
				gosub *label_0665
				cContinuousActionTurn(cc) = 0
			}
		} elseif (gettrait(cc, 78)) {
			if (iId(ci) != 783 & iId(ci) != 687) {
				ancient = 0
				repeat length(isethighspell)
					if (isethighspell(cnt) + 400 == efid) {
						ancient = 1
						break
					}
				loop
				if (ancient == 0 & itemmemory(2, iId(ci)) != 0 & calcread(sdataref(4, efid), efid, 50)) {
					txt -1, lang("楽勝だ。", "Easy.")
					r4 = iCount(ci) * cContinuousActionTurn(cc)
					gosub *label_0665
					cContinuousActionTurn(cc) = 0
					iCount(ci) = 0
				}
			}
		}
		return
	}
	if (iId(ci) == 619 & iSubname(ci) == 30) {
		actionsp 0, 1 + rnd(2)
		if (stat == 0) {
			txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
			rowactend cc
			rowactend tc
			return
		}
	}
	if (cContinuousActionTurn(cc) > 0) {
		if (iId(ci) == 619 & iSubname(ci) == 30) {
			cEmotionIcon(cc) = 17 + 100 * 3
			repeat 245
				if (cState(cnt) != 1) {
					continue
				}
				if (synccheck(cc, -1)) {
					if (cVisionFlag(cnt) != msync) {
						continue
					}
				} else {
					if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3) {
						continue
					}
				}
				if (cSleep(cnt) > 0 | cStoned(cnt) > 0) {
					continue
				}
				x = cX(cnt)
				y = cY(cnt)
				if (map(x, y, 1) == 0) {
					continue
				}
				tc = cnt
				if (tc == cc) {
					continue
				}
				if (cContinuousActionId(tc) != 0) {
					continue
				}
				if (rnd(5) == 0) {
					if (synccheck(cc, -1)) {
						txtef 9
						ctalk tc, 423, cc, tc, iParam1(ci)
						if (stat == 0) {
							ctalk tc, 424, cc, tc
						}
					}
				}
			loop
			if (cContinuousActionTurn(cc) \ 5 == 0) {
				if (synccheck(cc, -1)) {
					ctalk cc, 1305, cc, cc, inv(25, ci)
					if ( stat == 0 ) {
						ctalk cc, 1304, cc, cc
						if ( stat == 0 ) {
							txtef 9
							if (jp) {
								txt cc, "*シュッシュ*", "「くっ…」", "「あっ」", "「はぁはぁ！」", "「ふぅふぅ」"
							} else {
								txt cc, cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("come on!")
							}
						}
					}
				}
			}
		} else {
			ci = cContinuousActionItem(cc)
			cibkread = ci
			gosub *label_0665
			if ( cdata(141, cc) \ 5 == 0 ) {
				if ( synccheck(cc, -1) ) {
					ctalk cc, 1303, cc, cc
				}
			}
			if (iId(ci) == 783) {
				return
			}
			if (iId(ci) == 687) {
				r2 = 50 + iParam1(ci) * 50 + iParam1(ci) * iParam1(ci) * 20
				r3 = 0
			} else {
				r2 = sdataref(4, efid)
				r3 = efid
			}
			if (iCurseState(ci) >= 1) {
				r2 = r2 * 100 / 120
			}
			if (iCurseState(ci) <= (-1)) {
				r2 = r2 * 150 / 100
			}
			gosub *label_0714
			ci = cibkread
			if (stat == 0) {
				rowactend cc
				iCount(ci)--
				if (iCount(ci) < 0) {
					iCount(ci) = 0
				}
				if (iCount(ci) == 0 & iId(ci) != 798) {
					iNumber(ci)--
					if (ci >= 5080) {
						cell_refresh iX(ci), iY(ci)
					} else {
						gosub *refreshPCBurdenState
					}
					if (synccheck(cc, -1)) {
						txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
						ctalk cc, 1310, cc, cc
					}
				} else {
					item_autostack cc, ci
				}
			}
		}
		return
	}
	if (synccheck(cc, -1)) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を読み終えた。", name(cc) + " " + have(cc) + " finished reading the book.")
		if (iQuality(ci) == 6 & iId(ci) != 798) {
			allyctrl = 4
			gosub *ui_selectAlly
			if (stat != (-1)) {
				rc = stat
				rc_subact = int(cAiActNum(rc) / 10)
				if (rc_subact == 5) {
					txt -1, lang(cdatan(0, rc) + "はこれ以上新しい技能を覚えることが出来ない。", cdatan(0, rc) + "cannot learn any more skills.")
				} else {
					snd 24
					txtnew
					txtef 2
					txt -1, lang(cdatan(0, rc) + "は" + skillname(efid) + "を習得した！", cdatan(0, rc) + " learns " + skillname(efid) + "!")
					cdata(220 + rc_subact, rc) = efid
					cAiActNum(rc) += 10
				}
			}
		}
		if (iId(ci) == 619 & iSubname(ci) == 30) {
				ctalk cc, 1307, cc, cc, inv(25, ci)
				if ( stat == 0 ) {
					ctalk cc, 1306, cc, cc
				}
				if (jp) {
					txt -1, "あなたは満足した。", "あなたは爽快な気分になった。", "あなたは自己嫌悪に陥った。", "あなたは最低だ。", "あなたは冷静さを取り戻した。"
				} else {
					txt -1, "You feel satisfied.", "You feel an exhilarating rush.", "You feel disgusted with yourself.", "You feel awful.", "You regain your composure."
				}
		}
	}
	if (iId(ci) == 619 & iSubname(ci) == 30) {
		addbuff cc, 12, 300 + (iEnhancement(ci) * 15), 60
		animeload 11, cc
		if (ocbit(11, cc)) {
			if (gettrait(cc, 185)) {
				modstress -150
			}
		}
	} else {
		if (iId(ci) == 783) {
			if (iParam1(ci) == 0) {
				rowactend cc
				return 1
			}
			txt -1, lang(itemname(ci, 1) + "を覚えた！", "You learned the recipe!")
			recipememory(iSubname(ci))++
			item_identify ci, 1
			removeitem ci, 1
			if (synccheck(cc, -1)) {
				txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
				ctalk cc, 1310, cc, cc
			}
			rowactend cc
			return 1
		}
		if (iId(ci) == 687) {
			item_identify ci, 3
			txt -1, lang(itemname(ci, 1) + "を解読した！", "You finished decoding " + itemname(ci, 1) + "!")
			iParam2(ci) = 1
			iCount(ci) = 1
			ibitmod 4, ci, 0
			item_stack 0, ci, 1
		} else {
			if (iId(ci) == 798) {
				gosub *label_N001
			}
			if (findbuff(cc, 64) != (-1)) {
				skillgain cc, efid, 1 * r4, (((rnd(100 / 2 + 1) + 100 / 2) * (90 + sdata(165, cc) + (sdata(165, cc) > 0) * 20) / limit(100 + spell(efid - 400) / 2, 50, 1000) + 1) * r4 ) / 2
			} else {
				skillgain cc, efid, 1 * r4, ((rnd(100 / 2 + 1) + 100 / 2) * (90 + sdata(165, cc) + (sdata(165, cc) > 0) * 20) / limit(100 + spell(efid - 400) / 2, 50, 1000) + 1) * r4
			}
			gosub *label_0678
			if (itemmemory(2, iId(ci)) == 0) {
				itemmemory(2, iId(ci)) = 1
			}
		}
		item_identify ci, 1
		if (iId(ci) != 687) {
			iCount(ci)--
			if (iCount(ci) < 0) {
				iCount(ci) = 0
			}
			if (iCount(ci) == 0 & iId(ci) != 798) {
				removeitem ci, 1
				if (synccheck(cc, -1)) {
					txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
					ctalk cc, 1310, cc, cc
				}
			} else {
				item_autostack cc, ci
			}
		}
	}
	rowactend cc
	return 1
*label_1386
	if (cBlind(cc) != 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
		}
		return
	}
	if (iId(ci) == 742) {
		snd 59
		txt -1, lang("すくつの探索を許可する、という内容の文面が形式的に書いてある。", "According to the card, you are permitted to explore the void now.")
		return 1
	}
	if (iId(ci) == 791) {
		snd 59
		if (gCurrentMap != 210) {
			txt -1, lang("あなたは少し身震いした。周囲の大気がざわめきだした。", "You shuddered a little. The air around you becomes charged.")
			if (areaId(210) != 210) {
				areaId(210) = 210
				areaAppearance(210) = 0
				areaType(210) = 20
				areaX(210) = 0
				areaY(210) = 1
				areaEntranceType(210) = 1
				areaTileSet(210) = 1
				areaTileType(210) = 0
				areaTurnCost(210) = 10000000
				areaDangerLevel(210) = 50
				areaLastFloor(210) = 99999999
				areaIndoorOrOutdoor(210) = 1
				areaIsFixed(210) = 0
				areaDefaultAiCalm(210) = 0
			}
			ncgdata(203) = 1
			gDestinationMap = 210, 1
			gIsReturningOrEscaping = 15 + rnd(15)
		} else {
			txt -1, lang("ここでは使用できない。", "Nope.")
		}
		return 1
	}
	if (iId(ci) == 563) {
		gosub *label_1308
		if (stat == 1) {
			return 1
		} else {
			return 0
		}
	}
	if (iId(ci) == 668) {
		snd 59
		txt -1, lang("レイチェルという作家による、心あたたまる童話集だ。", "It's a lovely fairy tale written by Rachel.")
		return 1
	}
	tc = cc
	item_identify ci, 1
	gosub *label_1240
	return 1



#deffunc calcmagiccontrol int __rrr, int __sss
	if (sdata(188, __rrr) != 0) {
		if (cRelationship(__rrr) >= 0 & cRelationship(__sss) >= 0 | (cRelationship(__rrr) == (-1) & cRelationship(__sss) == (-1)) | (cRelationship(__rrr) <= (-2) & cRelationship(__sss) <= (-2))) {
			if (relationbetween(cc, tc) >= (-1)) {
				if (sdata(188, __rrr) * 5 > rnd(dmg + 1)) {
					dmg = 0
				} else {
					dmg = rnd(dmg * 100 / (100 + sdata(188, __rrr) * 10) + 1)
				}
				if (sdataref(3, efid) == 10000) {
					if (nc_gettrait(__rrr, 111) > 0) {
						dmg = 0
					}
				}
				if (dmg < 1) {
					if (synccheck(__sss, -1) & weaponenc == 0) {
						txt -1, lang(name(__sss) + "は巻き込みを免れた。", "The spell passes through " + name(__sss) + ".")
					}
					skillexp2 188, __rrr, 8, 4
					return 1
				}
				skillexp2 188, __rrr, 30, 2
			}
		}
	}
	if (sdataref(3, efid) == 9006) {
		if (cRelationship(__rrr) >= 0 & cRelationship(__sss) >= 0 | (cRelationship(__rrr) == (-1) & cRelationship(__sss) == (-1)) | (cRelationship(__rrr) <= (-2) & cRelationship(__sss) <= (-2))) {
			if (relationbetween(cc, tc) >= (-1)) {
				if (nc_gettrait(__rrr, 111) > 0) {
					dmg = 0
					if (dmg < 1) {
						if (synccheck(__sss, -1) & weaponenc == 0) {
							txt -1, lang(name(__sss) + "は巻き込みを免れた。", "The spell passes through " + name(__sss) + ".")
						}
						return 1
					}
				}
			}
		}
	}
	return 0
*label_1388
*label_1389
	spellbk = efid
	ccbk = cc
	gosub *label_1390
	if (stat == 1) {
		if (cContinuousActionId(ccbk) != 20003 | cContinuousActionTurn(ccbk) == 0) {
			if (efid >= 550 & efid <= 599) {
				repeat 3, 6
					p = userspelldata(cnt, efid - 550)
					if (p == 0) {
						break
					}
					p = p - 1, efp / 3
					if (p == 19) {
						cPietyPoint(ccbk) -= p(1)
					} else {
						if (p == 20) {
							dmghp ccbk, p(1) * 2 / 3, -2
						} else {
							if (p == 21) {
								dmgsp ccbk, p(1) / 15
							} else {
								if (p == 23) {
									cBleeding(ccbk) += p(1) / 25
								} else {
									if (p == 24) {
										calcbuff -1, 2, p(1)
										addbuff ccbk, 2, p(1), dur, 1
									} else {
										if (p == 25) {
											cInsane(ccbk) += p(1) / 8
										} else {
											if (p == 28) {
												cParalyzed(ccbk) += p(1) / 10
											} else {
												if (p == 29) {
													cDimmed(ccbk) += (rndex(p(1) / 2 + 1) + p(1) / 2) / 24
												}
											}
										}
									}
								}
							}
						}
					}
				loop
			}
			cc = ccbk
			r1 = cc
			r2 = spellbk
			gosub *label_0669
		}
		return 1
	}
	return 0
*label_1390
	efsource = 3
	efstatus = 0
	efp = calcspellpower(efid, cc)
	if (gettrait(cc, 219)) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "の血は熱くなった。", his(cc) + " blood starts boiling.")
		}
		efsource = 0
		return 0
	}
	if (gettrait(cc, 171)) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は魔法を使えない。", name(cc) + " cannot use magic.")
		}
		efsource = 0
		return 0
	}
	if (cc == 0) {
		if (cfg_overcastspell) {
			if (delaymagic == 0) {
				if (calcspellcostmp(efid, cc) > cMp(cc)) {
					txt -1, lang("マナが足りないが、それでも詠唱を試みる？", "You are going to over-cast the spell. Are you sure?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval != 0) {
						gosub *label_0623
						efsource = 0
						return 0
					}
				}
				screenupdate = -1
				gosub *label_0623
			}
		}
		if (efid >= 550 & efid <= 599) {
			f = 0
			p(1) = efp / 3
			repeat 3, 6
				p = userspelldata(cnt, efid - 550)
				if (p == 0) {
					break
				}
				p = p - 1
				if (p == 0) {
					if (gHour < 10 | gHour > 15) {
						f = 1
						break
					}
				} else {
					if (p == 1) {
						if (gHour >= 7 & gHour < 19) {
							f = 1
							break
						}
					} else {
						if (p == 2) {
							if (gWeather != 3) {
								f = 1
								break
							}
						} else {
							if (p == 3) {
								if (gWeather != 4) {
									f = 1
									break
								}
							} else {
								if (p == 4) {
									if (gWeather != 0) {
										f = 1
										break
									}
								} else {
									if (p == 5) {
										if (gWeather != 2) {
											f = 1
											break
										}
									} else {
										if (p >= 6 & p <= 17) {
											if (gMonth != p - 5) {
												f = 1
												break
											}
										} else {
											if (p == 18) {
												i = 0
												repeat 15, 1
													if (cState(cnt) == 1) {
														i++
													}
												loop
												if (i == 0) {
													f = 1
													break
												}
												repeat 15, 1
													if (cState(cnt) == 1) {
														if (cMp(cnt) < p(1) / i) {
															f = 1
															break
														}
													}
												loop
												if (f) {
													break
												}
												repeat 15, 1
													if (cState(cnt) == 1) {
														dmgmp cnt, p(1) / i
													}
												loop
											} else {
												if (p == 19) {
													if (cPietyPoint(cc) < p(1)) {
														f = 1
														break
													}
												} else {
													if (p == 21) {
														if (cSp(cc) < p(1) / 15) {
															f = 1
															break
														}
													} else {
														if (p == 26) {
															if (mapIndoorOrOutdoor == 2) {
																f = 1
																break
															}
														} else {
															if (p == 27) {
																if (mapIndoorOrOutdoor != 2) {
																	f = 1
																	break
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			loop
			if (f) {
				txt -1, lang("今は使えない。", "You cannot use that spell now.")
				efsource = 0
				return 0
			}
			if (delaymagic) {
				delaymagic = 0
			} else {
				f = 0
				repeat 3, 6
					p = userspelldata(cnt, efid - 550)
					if (p == 0) {
						break
					}
					if (p - 1 == 22) {
						f = 1
						break
					}
				loop
				if (f) {
					cContinuousActionId(cc) = 20003
					cContinuousActionTurn(cc) = 3 + limit(p(1) / 150, 0, 2147483644)
					cContinuousActionItem(cc) = efid
					efsource = 0
					txt -1, lang(name(cc) + "は" + skillname(efid) + "の魔法の詠唱をはじめた。", name(cc) + " begin" + _s(cc) + " casting " + skillname(efid) + ".")
					return 1
				}
			}
		}
	}
	gosub *label_1397
	if (stat == 0) {
		efsource = 0
		return 0
	}
	if (cc != 0) {
		if (sdataref(1, efid) == 7) {
			oomSEST_log "skSummon"
			if (cRelationship(cc) == 10 | gCurrentMap == 40 | gCurrentMap == 49) {
				efsource = 0
				return 0
			}
			if (gPlayTurns \ 10 > 4) {
				efsource = 0
				return 0
			}
		}
	}
	if (sdataref(1, efid) >= 1 & sdataref(1, efid) <= 4) {
		if (gettrait(cc, 79)) {
			if (rnd(100) < calctraitscore(stat)) {
				if (cc == 0 | rnd(3) == 0) {
					magiccritical = 1
				}
			}
		}
	}
	if (cc == 0 | (cc != 0 & npccostmp == 1)) {
		if (cc == 0) {
			if (efid >= 550 & efid <= 599) {
				userspelldata(11, efid - 550) -= calcuserspellcoststock(efid - 550)
				if (userspelldata(11, efid - 550) < 0) {
					userspelldata(11, efid - 550) = 0
				}
			} else {
				spell(efid - 400) -= calcspellcoststock(efid, cc)
				if (spell(efid - 400) < 0) {
					spell(efid - 400) = 0
				}
			}
		}
		mp = calcspellcostmp(efid, cc)
		if (godcheck(cc) == "ehekatl") {
			graceofgod = cPietyPoint(cc) / 500
			if (graceofgod > 40) {
				graceofgod = 40
			}
			mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
		}
		nc_intb_001 = 0
		nc_intb_002 = 0
		nc_intb_003 = 0
		repeat 30, 100
			dup roopbuf, cdata(cnt, cc)
			if (roopbuf \ 10000 == 0) {
				continue
			}
			nc_intb_002 = roopbuf \ 10000 - 1
			if (inv(37, nc_intb_002) == 7) {
				nc_intb_001 += iBigenchantmentPower(nc_intb_002)
				continue
			}
			if (inv(37, nc_intb_002) == 8) {
				nc_intb_003 += iBigenchantmentPower(nc_intb_002)
				continue
			}
		loop
		if (nc_intb_001 > 0) {
			mp = mp * (100 - nc_intb_001) / 100
		}
		if (nc_intb_003 > 0) {
			healamo = (mp / 100) * nc_intb_003
			healhp cc, healamo
			if (showdamagecheck(healamo)) {
				if (synccheck(tc, -1)) {
					mondmgn(mondmgcnt) = "" + healamo
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, cc, cc
					ccolor 110
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		}
		if (nc_gettrait(cc, 112) == 0 | rnd(4)) {
			dmgmp cc, mp
		}
		if (cState(cc) != 1) {
			efsource = 0
			magiccritical = 0
			return 1
		}
	}
	if (cConfused(cc) != 0 | cDimmed(cc) != 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は混乱しながらも魔法の詠唱を試みた。", name(cc) + " try" + _s(cc) + " to cast a spell in confusion.")
			ctalk cc, 1276, cc, tc, efid
		}
		tcbk = tc
		gosub *label_0714
		tc = tcbk
		if (stat == 0) {
			efsource = 0
			magiccritical = 0
			return 1
		}
	} else {
		if (synccheck(cc, -1)) {
			if (cc == 0) {
				if (cc == tc) {
					ctalk cc, 965, cc, cc
				} else {
					ctalk cc, 968, cc, tc
				}
				if (stat == 0) {
					txt -1, lang(name(cc) + "は" + skillname(efid) + "の" + _cast(cSpecialAttackType(cc)), name(cc) + " cast " + skillname(efid) + ".")
				}
				ctalk cc, 422, cc, cc, efid
				ncgdata(66)++
			} else {
				if (cc == tc) {
					ctalk cc, 965, cc, cc
				} else {
					ctalk cc, 968, cc, tc
				}
				if (stat == 0) {
					txt -1, lang(name(cc) + "は" + _cast(cSpecialAttackType(cc)), name(cc) + "" + _cast(cSpecialAttackType(cc)))
				}
				ctalk cc, 422, cc, cc, efid
			}
		}
	}
	if (findbuff(cc, 2) != (-1)) {
		if (synccheck(cc, -1)) {
			txt -1, lang("沈黙の霧が詠唱を阻止した。", "The mist of silence interrupts a spell.")
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if (oabit(0, gCurrentMap)) {
		if (cc == 0) {
			txt -1, lang("「ここじゃ魔法は ごはっとだぜ！」", "\"Magic is forbidden here!\"")
		}
		if (synccheck(cc, -1)) {
			txt -1, lang("不思議な力が詠唱を阻止した。", "A mysterious power prevents casting.")
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if (gCurrentMap == 210 & ncgdata(309)) {
		if (cc < 56) {
			txt -1, lang("「ここじゃ魔法は ごはっとだぜ！」", "\"Magic is forbidden here!\"")
		}
		if (synccheck(cc, -1)) {
			txt -1, lang("不思議な力が詠唱を阻止した。", "A mysterious power prevents casting.")
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if (rnd(100) >= calcspellfail(efid, cc) | findbuff(cc, 93) != (-1)) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は詠唱に失敗した。", name(cc) + " fail" + _s(cc) + " to cast a spell.")
			animeid = 8
			gosub *label_0630
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if (noeffect == 1) {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		efsource = 0
		magiccritical = 0
		return 1
	}

	efp = calcspellpower(efid, cc)
	if (efid < 550 | efid > 599) {
		if (findbuff(cc, buffId_sealEnchantment) == (-1)) {
			p = encfind(cc, encId_enhanceSpell)
			if (p != (-1)) {
				lint_efp = int(1.0 * efp * (100 + p / 10) / 100)
				efp = limitmax(lint_efp, INT_MAX)
			}
		}
	}

	rapidmagic = 0
	if (cbit(20, cc) & sdataref(1, efid) == 2) {
		if (godcheck(cc) == "itzpalt") {
			rapidmagic = int(logf(1.0 + cPietyPoint(cc))) + 2 + rnd(2) - rnd(2)
		} else {
			rapidmagic = 1 + (rnd(3) != 0) + (rnd(2) != 0)
		}
	}
	if (rapidmagic) {
		bk_efp = efp
		repeat rapidmagic
			gosub *label_1398
			if (cState(tc) != 1) {
				gosub *label_1295
				if (stat == 0) {
					break
				} else {
					tc = ocdata(150, cc) - 1
				}
			}
			efp = bk_efp
		loop
		rapidmagic = 0
	} else {
		if (efid == 454) {
			efid = 1144
		}
		gosub *label_1398
	}
	if (gCurrentMap != 210 & efid == 441 & cc == 0) {
		nc_intb_100 = 0
		*label_RapidWish
		if (spell(441 - 400) <= 0) {
			msgdup++
			txt -1, lang("願いのストックがなくなったため、連続使用を中止した。", "There is no stock of Wish.")
			efsource = 0
			magiccritical = 0
			return 1
		}
		if (99 >= calcspellfail(441, 0)) {
			if (nc_intb_100 > 0) {
				msgdup++
				txt -1, lang("成功率が100%ではなくなったため、連続使用を中止した。", "The success rate was no longer 100%, so continuous use was discontinued.")
			}
			efsource = 0
			magiccritical = 0
			return 1
		}
		if (nc_intb_100 == 0) {
			txtnew
			txt -1, lang("同じ願いをもう一度叶える？", "Wish again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptl(0, 2) = lang("指定回数", "Specified Times"), "c", "2"
			promptmax = 3
			valhinan = val
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval == 2) {
				txt -1, lang("何回願う？", "How many times do you wish?")
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 0, 100000
				inputlog = "" + 1
				p@se = rtval
				gosub *label_1349
				if (rtval == (-1)) {
					efsource = 0
					magiccritical = 0
					return 1
				}
				rtval = p@se
				nc_intb_100 = int(inputlog)
			}
		}
		if (rtval == 0 | nc_intb_100) {
			inputlog = nc_strb_001
			gosub *label_3000
			spell(441 - 400) -= calcspellcoststock(441, 0)
			if (spell(441 - 400) < 0) {
				spell(441 - 400) = 0
			}
			mp = calcspellcostmp(441, 0)
			if (godcheck(0) == "ehekatl") {
				graceofgod = cPietyPoint(0) / 500
				if (graceofgod > 40) {
					graceofgod = 40
				}
				mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
			}
			nc_intb_001 = 0
			nc_intb_002 = 0
			nc_intb_003 = 0
			repeat 30, 100
				dup roopbuf, cdata(cnt, 0)
				if (roopbuf \ 10000 == 0) {
					continue
				}
				nc_intb_002 = roopbuf \ 10000 - 1
				if (inv(37, nc_intb_002) == 7) {
					nc_intb_001 += iBigenchantmentPower(nc_intb_002)
					continue
				}
				if (inv(37, nc_intb_002) == 8) {
					nc_intb_003 += iBigenchantmentPower(nc_intb_002)
					continue
				}
			loop
			if (nc_intb_001 > 0) {
				mp = mp * (100 - nc_intb_001) / 100
			}
			if (nc_intb_003 > 0) {
				healamo = (mp / 100) * nc_intb_003
				healhp 0, healamo
				if (showdamagecheck(healamo)) {
					if (synccheck(tc, -1)) {
						mondmgn(mondmgcnt) = "" + healamo
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, 0, 0
						ccolor 110
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			dmgmp 0, mp
			if (cState(0) != 1) {
				efsource = 0
				magiccritical = 0
				return 1
			}
			cc = ccbk
			r1 = cc
			r2 = spellbk
			gosub *label_0669
		} else {
			efsource = 0
			magiccritical = 0
			return 1
		}
		if (nc_intb_100) {
			nc_intb_100 -= 1
			if (nc_intb_100 == 0) {
				efsource = 0
				magiccritical = 0
				return 1
			}
		}
		goto *label_RapidWish
	}
	efsource = 0
	magiccritical = 0
	return 1
*label_1391
	tc = cc
	efsource = 4
	if (potionspill | potionthrow | potiondip) {
		if (potionthrow) {
			lint_efp = efp * potionthrow / 100
			efp = limitmax(lint_efp, INT_MAX)
			efstatus = iCurseState(ci)
		}
		if (potiondip) {
			oom_bk_ci = ci
			ci = cidip
		}
	} else {
		efstatus = iCurseState(ci)
		cColer = 0
		if (iId(ci) == 519 & (iColor(ci) == 0 | iColor(ci) == 1 | iColor(ci) == 12)) {
			cColer = 1
		}
		if (synccheck(tc, -1)) {
			if (iId(ci) != 792 | rndcnt == 1) {
				snd 17
				txt -1, lang(npcn(tc) + itemname(ci, 1) + "を飲み干した。", name(tc) + " drink" + _s(tc) + " " + itemname(ci, 1) + ".")
			}
		}
	}
	if (potionspill == 0) {
		if (potionthrow) {
			r1 = ccthrowpotion
		} else {
			r1 = tc
		}
		if (gettrait(r1, 84)) {
			efp = efp + calc3traitmulti(stat, efp)
		}
		lint_efp = efp * (iEnhancement(ci) + 1)
		efp = limitmax(lint_efp, INT_MAX)
	}
	if (potiondip == 1) {
		potiondip = 0
		ci = oom_bk_ci
		return 1
	}
	gosub *label_1398
	if (potionspill | potionthrow) {
		potionspill = 0
		potionthrow = 0
	} else {
		if (obvious == 1) {
			if (tc == 0) {
				item_identify ci, 1
			}
		}
		iNumber(ci)--
		if (ci >= 5080) {
			cell_refresh iX(ci), iY(ci)
		} else {
			if (tc == 0) {
				gosub *refreshPCBurdenState
			}
		}
	}
	cNutrition(tc) += 150
	if (petcheck(tc)) {
		if (cNutrition(tc) > 12000) {
			if (rnd(5) == 0) {
				chara_vomit tc
			}
		}
	}
	return 1
*label_1392
	if (iParam1(ci) < (-5) | iParam3(ci) >= 20 | (iId(ci) == 602 & gdata(250 + 10) <= 0)) {
		valn = itemname(ci)
		txt -1, lang(valn + "は涸れている。", valn + " is dry.")
		return 1
	}
	snd 17
	valn = itemname(ci)
	txt -1, lang(name(cc) + "は" + valn + "の水をすくって飲んだ。", name(cc) + " draw" + _s(cc) + " water from " + valn + ".")
	tc = cc
	cibk = ci
	p = rnd(100)
	repeat 1
		if (cc != 0) {
			if (rnd(15) == 0) {
				txt -1, lang(name(cc) + "は井戸に落ちた！ ", name(cc) + " falls in the well!")
				txtef 9
				ctalk cc, 1267, cc, cc
				if ( stat == 0 ) {
					txt cc, name(cc) + lang("「手を伸ばせー」", " yells, " + cnvtalk("G-Give me your hands!"))
				}
				ctalk 0, 1268, 0, cc
				if (cbit(5, cc) == 1 & cGravity(cc) == 0) {
					txt -1, lang("しかしすぐに浮いてきた… ", "Soon " + he(cc) + " floats up to the surface.")
					ctalk cc, 1269, cc, cc
				} else {
					dmghp cc, 9999, -1
				}
				break
			}
		}
		if (iId(ci) == 602) {
			if (rnd(2) == 0) {
				efid = 1113
				gosub *label_1398
				break
			}
		}
		if (p > 70) {
			p = rnd(5)
			if (p == 0) {
				efid = 1112
				efp = 100
				gosub *label_1398
				break
			}
			if (p == 1) {
				efid = 1110
				efp = 100
				gosub *label_1398
				break
			}
			if (p == 2) {
				efid = 1111
				efp = 100
				gosub *label_1398
				break
			}
			if (p == 3) {
				efid = 1109
				efp = 100
				gosub *label_1398
				break
			}
			if (p == 4) {
				efid = 1108
				efp = 100
				gosub *label_1398
				break
			}
		}
		if (p > 55) {
			flt
			itemcreate -1, 54, cX(cc), cY(cc), rndex(sdata(159, cc) / 2 * 50 + 100) + 1
			txt -1, lang(name(cc) + "は水の中に金貨を見つけた。", name(cc) + " find" + _s(cc) + " some gold pieces in water.")
			break
		}
		if (p > 45) {
			p = rnd(8) + 10
			if (rnd(5) > 2) {
				skillmod p, cc, 1000
			} else {
				skillmod p, cc, -1000
			}
			break
		}
		if (p > 40) {
			if (cLevel(cc) < 5) {
				break
			}
			if (synccheck(cc, -1)) {
				txt -1, lang("" + name(cc) + "は何かいけないものを飲み込んだ。", name(cc) + " swallow" + _s(cc) + " something bad.")
			}
			tc = cc
			flag_alien = 1
			gosub *label_0816
			break
		}
		if (p > 35) {
			txt -1, lang("井戸から何かが出てきた！", "Something comes out from the well!")
			repeat 1 + rnd(3)
				flt calcobjlv(cLevel(cc) * 3 / 2 + 3), calcfixlv(2)
				characreate -1, 0, cX(cc), cY(cc)
			loop
			break
		}
		if (p > 33) {
			efid = 1113
			gosub *label_1398
			break
		}
		if (p > 20) {
			efid = 454
			gosub *label_1398
			break
		}
		if (p == 0) {
			if (rnd(gWishCount + 1)) {
				if (rnd(10)) {
					txtef 5
					txt -1, lang("ものすごい幸運が訪れた…ような気がしたが気のせいだった。", "You feel as a stroke of good fortune passed by.")
					break
				} else {
					txtef 5
					txt -1, lang("ものすごい幸運が訪れた…ような気がしたが妹だった。", "An incredible fortune comes knocking... or so you thought. It was a younger sister.")
					flt
					characreate -1, 176, cX(cc), cY(cc)
				}
			}
			gWishCount++
			efid = 441
			gosub *label_1398
			break
		}
		if (cc == 0) {
			txt -1, lang("この水は清涼だ。", "Phew, fresh water tastes good.")
		}
	loop
	ci = cibk
	if (cc != 0) {
		cNutrition(cc) += 4000
	} else {
		cNutrition(cc) += 500
	}
	if (iId(ci) == 602) {
		gdata(250 + 10)--
	} else {
		iParam1(ci) -= rnd(3)
		iParam3(ci) += rnd(3)
		if (iParam3(ci) >= 20) {
			txt -1, lang(itemname(ci) + "は完全に干上がった。", itemname(ci) + " has completely dried up.")
			return 1
		}
	}
	if (iParam1(ci) < (-5)) {
		txt -1, lang(itemname(ci) + "は干上がった。", itemname(ci) + " has dried up.")
	}
	return 1
*label_1393
	tc = cc
	tlocx = cX(cc)
	tlocy = cY(cc)
	efstatus = iCurseState(ci)
	efsource = 2
	if (cBlind(cc) != 0 | findbuff(cc, 93) != (-1)) {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
		}
		efsource = 0
		return
	}
	if (cDimmed(cc) != 0 | cConfused(cc) != 0) {
		if (rnd(4) != 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "はふらふらした。", name(cc) + " stagger" + _s(cc) + ".")
			}
			efsource = 0
			return
		}
	}
	if (synccheck(cc, -1) & iId(ci) != 792) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を読んだ。", name(cc) + " read" + _s(cc) + " " + itemname(ci, 1) + ".")
	}
	if (iId(ci) != 621) {
		iNumber(ci)--
		if (ci >= 5080) {
			cell_refresh iX(ci), iY(ci)
		} else {
			gosub *refreshPCBurdenState
		}
		skillexp2 150, cc, 25, 2
	}
	if (iId(ci) == 502) {
		efp = 400
	} else {
		if (iId(ci) == 501) {
			efp = 200
		} else {
			if (iId(ci) == 500) {
				efp = 70
			}
		}
	}
	if (iId(ci) == 431) {
		if (ibit(8, ci)) {
			if (tc != 0) {
				godindext = getgodindex(iParam4(ci))
				if (godindext != (-1)) {
					godidt = cgodShortId(godindext)
				} else {
					godidt = godno2godid(iParam4(ci))
				}
				if (godcheck(tc) != godidt) {
					believegod tc, godidt
					txtef 5
					txt -1, lang(name(tc) + "は" + godname(godcheck(tc)) + "に改宗した。", name(tc) + " become a follower of " + godname(godcheck(tc)) + ".")
					ctalk tc, 1279, tc, tc
					if ( stat == 0 ) {
						ctalk tc, 1278, tc, tc
					}
					r1 = tc
					gosub *chara_refresh
				}
			}
		}
	}
	gosub *label_1398
	if (cc == 0) {
		if (obvious == 1) {
			item_identify ci, 1
		}
	}
	return 1
*label_1394
	if (iCount(ci) <= 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang(itemname(ci, 1) + "を振った。", "You zap " + itemname(ci, 1) + ".")
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		return
	}
	efstatus = iCurseState(ci)
	if (efstatus >= 1) {
		efstatus = 0
	}
	efsource = 1
	gosub *label_1397
	if (stat == 0) {
		efsource = 0
		return 0
	}
	if (efid >= 400 & efid < 600) {
		if (stat == 0 & sdataref(3, efid) / 1000 * 1000 == 2000 | noeffect == 1) {
			if (synccheck(cc, -1)) {
				redraw 0
				txt -1, lang(itemname(ci, 1) + "を振った。", "You zap " + itemname(ci, 1) + ".")
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			goto *label_1395
		}
	}
	if (synccheck(cc, -1)) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を振った。", name(cc) + " zap" + _s(cc) + " " + itemname(ci, 1) + ".")
	}
	lint_efp = efp * (100 + sdata(174, cc) * 10 + sdata(16, cc) / 2 + sdata(13, cc) / 2) / 100
	efp = limitmax(lint_efp, INT_MAX)
	if (iId(ci) == 18) {
		efp += iEnhancement(ci) * 100
	}
	if (efid >= 400 & efid < 600) {
		f = 0
		r1 = sdata(174, cc) * 20 + 100
		if (iCurseState(ci) >= 1) {
			r1 = r1 * 125 / 100
		}
		if (iCurseState(ci) <= (-1)) {
			r1 = r1 * 50 / 100
		} else {
			if (rnd(2)) {
				f = 1
			}
		}
		if (rnd(sdataref(4, efid) + 1) / 2 <= r1) {
			f = 1
		}
	} else {
		f = 1
	}
	if (rnd(30) == 0 | findbuff(cc, 93) != (-1)) {
		f = 0
	}
	if (ogdata(480) == 2) {
		f = 1
	}
	if (f == 1 | iId(ci) == 290 | cc != 0) {
		gosub *label_1398
		if (cc == 0) {
			if (obvious == 1) {
				item_identify ci, 1
			}
		}
		gosub *label_0676
	} else {
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は杖をうまく使えなかった。", name(cc) + " fail to use the power of the rod.")
		}
	}
*label_1395
	efsource = 0
	if (iNumber(ci) == 0) {
		if (ci >= 5080) {
			cell_refresh iX(ci), iY(ci)
			return 1
		}
	}
	item_separate ci
	nc_intb_200 = stat
	iCount(ci)--
	item_autostack cc, ci
	if (iId(ci) == 290 & inv_getowner(ci) == 0 & cfg_NC_wish) {
		nc_intb_201 = 1
		nc_intb_100 = 0
		repeat
			nc_intb_201 = 0
			inv_getheader 0
			repeat invrange, invhead
				if (iNumber(cnt) == 0) {
					continue
				}
				if (iId(cnt) != 290) {
					continue
				}
				if (iCount(cnt) <= 0) {
					continue
				}
				nc_intb_201 += iNumber(cnt) * iCount(cnt)
			loop
			if (nc_intb_201 <= 0) {
				break
			}
			rtval = 1
			if (nc_intb_100 == 0 & (gCurrentMap != 210 | ncgdata(307) == 0)) {
				txtnew
				txt -1, lang("同じ願いをもう一度叶える？(残り:", "Wish again?(Amount:") + nc_intb_201 + ")"
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptl(0, 2) = lang("指定回数", "Specified Times"), "c", "2"
				promptmax = 3
				valhinan = val
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval == 2) {
					txt -1, lang("何回願う？", "How many times do you wish?")
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 0, nc_intb_201
					inputlog = "" + 1
					p@se = rtval
					gosub *label_1349
					if (rtval == (-1)) {
						break
					}
					rtval = p@se
					nc_intb_100 = int(inputlog)
				}
			}
			if (rtval == 0 | nc_intb_100) {
				inputlog = nc_strb_001
				gosub *label_3000
				if (iNumber(nc_intb_200) == 0 || iCount(nc_intb_200) <= 0) {
					inv_getheader 0
					repeat invrange, invhead
						if (iNumber(cnt) == 0) {
							continue
						}
						if (iId(cnt) != 290) {
							continue
						}
						if (iCount(cnt) <= 0) {
							continue
						}
						ci = cnt
						break
					loop
				} else {
					ci = nc_intb_200
				}
				efsource = 0
				if (iNumber(ci) == 0) {
					if (ci >= 5080) {
						cell_refresh iX(ci), iY(ci)
						return 1
					}
				}
				item_separate ci
				nc_intb_200 = stat
				iCount(ci)--
				item_autostack cc, ci
			} else {
				break
			}
			if (nc_intb_100) {
				nc_intb_100 -= 1
				if (nc_intb_100 == 0) {
					break
				}
			}
		loop
	}
	return 1
*label_1396
	if (efid == 646) {
		if (cbit(973, tc) == 1) {
			if (cRelationship(cc) == (-3)) {
				repeat 57
					if (cState(cnt) == 1) {
						if (cRelationship(cnt) == 10) {
							lockon cc, cnt, 12
							break
						}
					}
				loop
			}
			return 0
		}
	}
	if (efid >= 761 & efid <= 780) {
		if (cc == 0) {
			gosub *label_1746
			if (rtval != 1) {
				gosub *label_0623
				return 0
			}
			gosub *label_0623
			if (cPrayingPoint(cc) < 1000) {
				txt -1, lang(godname(godcheck(cc)) + "は" + name(cc) + "に無関心だ。", godname(godcheck(cc)) + " is indifferent to you.")
				return 0
			}
		}
	}
	gosub *label_1397
	if (stat == 0) {
		return 0
	}
	if (sdataref(3, efid) / 1000 * 1000 != 3000 & sdataref(3, efid) / 1000 * 1000 != 10000) {
		if (cConfused(cc) != 0 | cBlind(cc) != 0) {
			if (rnd(5) == 0) {
				if (synccheck(cc, -1)) {
					txt -1, lang(name(cc) + "は頭を振った。", name(cc) + " shake" + _s(cc) + " " + his(cc) + " head.")
				}
				return 1
			}
		}
	}
	if (efid >= 600) {
		if (efid != 791) {
			if (cc == 0) {
				if (sdataref(2, efid) > 0) {
					if (cSp(0) < 50) {
						if (cSp(0) < rnd(75)) {
							txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
							dmgsp 0, sdataref(2, efid) / 2 + 1
							return 1
						}
					}
					if (efid >= 663 & efid <= 673) {
						if (spell(sdataref(6, efid) - 400) <= 0) {
							msgdup++
							txt -1, lang(skillname(sdataref(6, efid)) + "のストックがない。", "There is no stock of " + skillname(sdataref(6, efid)) + ".")
							return 1
						}
						spell(sdataref(6, efid) - 400) -= calcspellcoststock(sdataref(6, efid), cc) * 10
						if (spell(sdataref(6, efid) - 400) < 0) {
							spell(sdataref(6, efid) - 400) = 0
						}
					}
					dmgsp 0, rnd(sdataref(2, efid) / 2 + 1) + sdataref(2, efid) / 2 + 1
				}
			}
			if (efid == 790) {
				if (ocbit(10, cc) == 0) {
					if (cc == 0) {
						txt -1, lang("今は使えない。", "You can't use that right now.")
					}
					return 1
				}
			}
			skillexp2 sdataref(0, efid), cc, 25
		}
	}
	efp = calcspellpower(efid, cc)
	if (noeffect == 1) {
		if (efid != 300) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			return 1
		}
	}
	if (efid >= 779 & efid <= 780) {
		if (gCatchesGodSignal) {
			if (efid == 779) {
				p = 14
			} else {
				if (efid == 780) {
					p = 15
				}
			}
			txtgod godcheck(), p
		}
	}
	if (efid == 781) {
		if (getcgodno(cc) != (-1)) {
			efid = cgodSpecialPowerId(stat)
		}
	}
	if (efid == 810) {
		if (getcgodno(cc) != (-1)) {
			txtgod godcheck(), 20
		}
	}
	gosub *label_1398
	if (stat == 0) {
		return 0
	}
	if (efid >= 779 & efid <= 780) {
		gosub *god_consumePCPietyByMiracle
	}
	return 1
*label_1397
	noeffect = 0
	if (efid > tailspact) {
		tc = cc
		return 1
	}
	tg = sdataref(3, efid) / 1000 * 1000
	if (efsource == 1) {
		if (tg == 3000) {
			tg = 8000
		}
	}
	if (sdataref(1, efid) == 7) {
		if (cc == 0) {
			tc = 0
			return 1
		}
	}
	if (tg == 8000) {
		if (cc == 0) {
			tc = 0
			txt -1, lang("どの方向？", "Which direction?")
			gosub *label_0623
			gosub *label_1350
			if (stat == 0) {
				return 0
			}
			if (map(tlocx, tlocy, 1) == 0) {
				noeffect = 1
				obvious = 0
				return 1
			}
			tc = map(tlocx, tlocy, 1) - 1
		} else {
			if (efid == 405 | efid == 501) {
				tlocx = cX(cc)
				tlocy = cY(cc)
				return 1
			}
			if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) > sdataref(3, efid) \ 1000 + 1) {
				return 0
			}
			tlocx = cX(tc)
			tlocy = cY(tc)
		}
		return 1
	}
	if (tg == 7000 | (tg == 9000 & tgloc == 1 & cc == 0)) {
		if (cc == 0) {
			if (tg == 9000) {
				if (fov_los(cX(cc), cY(cc), tglocx, tglocy) == 0) {
					if (stat == 0) {
						txt -1, lang("その場所は見えない。", "You can't see the location.")
						gosub *label_0623
					}
					obvious = 0
					return 0
				}
				tlocx = tglocx
				tlocy = tglocy
			} else {
				gosub *label_1147
				if (stat != 1) {
					if (stat == 0) {
						txt -1, lang("その場所は見えない。", "You can't see the location.")
						gosub *label_0623
					}
					obvious = 0
					return 0
				}
			}
		} else {
			if (fov_los(cX(tc), cY(tc), cX(cc), cY(cc)) == 0) {
				return 0
			}
			tlocx = cX(tc)
			tlocy = cY(tc)
		}
		return 1
	}
	if (tg == 3000 | tg == 10000) {
		if (efid == 661) {
			cw = -1
			repeat 30
				dup roopbuf, cdata(100 + cnt, cc)
				if (roopbuf \ 10000 == 0) {
					continue
				}
				if (roopbuf / 10000 == 10) {
					cw = roopbuf \ 10000 - 1
				}
			loop
			if (cw == (-1)) {
				return 0
			}
		}
		p(44) = 0
		if (ocdata(155, cc) > 0) {
			calcskill efid, cc, calcspellpower(efid, cc)
			if (ele == 50 | ele == 51 | ele == 52 | ele == 53 | ele == 54 | ele == 57) {
				if (gettrait(cc, ele + 38) >= 2) {
					tc = ocdata(150, cc) - 1
					if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) > 7) {
						if (cc == 0) {
							msgdup++
							txt -1, lang("射程距離外だ。", "It's out of range.")
							gosub *label_0623
						}
						return 0
					}
					if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc)) == 0) {
						return 0
					}
					p(44) = 1
				}
			}
		}
		if (p(44) == 0) {
			if (cc != 0) {
				if (sdataref(1, efid) == 3) {
					if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) > sdataref(3, efid) \ 1000 + 1) {
						return 0
					}
					if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc)) == 0) {
						return 0
					}
				}
			}
			tc = cc
		}
		tlocx = cX(tc)
		tlocy = cY(tc)
		return 1
	}
	if (tg == 2000 | tg == 6000 | tg == 9000) {
		if (cc == 0) {
			gosub *label_1295
			if (stat == 0) {
				obvious = 0
				return 0
			}
			tc = ocdata(150, 0) - 1
			if (hostileactioncheck(efid)) {
				if (cRelationship(tc) >= 0) {
					gosub *label_1297
					if (stat == 0) {
						obvious = 0
						return 0
					}
				}
			}
		}
		if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) > sdataref(3, efid) \ 1000 + 1) {
			if (cc == 0) {
				msgdup++
				txt -1, lang("射程距離外だ。", "It's out of range.")
				gosub *label_0623
			}
			return 0
		}
		if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc)) == 0) {
			return 0
		}
		tlocx = cX(tc)
		tlocy = cY(tc)
		return 1
	}
	if (tg == 5000) {
		if (cc == 0) {
			if (efsource == 3) {
				txt -1, lang("どの方向に唱える？ ", "Which direction do you want to cast the spell? ")
			} else {
				txt -1, lang("どの方向に振る？ ", "Which direction do you want to zap the wand? ")
			}
			gosub *label_0623
			val = 0
			gosub *label_1350
			if (stat == 0) {
				txt -1, lang("それは無理だ。", "It's impossible.")
				obvious = 0
				return 0
			}
		}
	}
	return 1
// 魔法効果
*label_1398
	dmgdisplayflag = 2
	efcibk = ci
	efcancel = 0
	obvious = 1
	if (efsource != 4 & efsource != 1 & efsource != 2) {
		efstatus = 0
	}
	if (efsource != 3) {
		efsource = 0
	}
	efbad = 0
	if (efid >= 300) {
		if (efid < tailspact) {
			if (efid == 647) {
				if (cId(cc) == 317) {
					if (cc != 0 & petcheck(cc) == 0) {
						if (cQuality(cc) == 6 | cRole(cc) != 0 | cbit(963, cc) == 1 | cbit(976, cc) == 1) {
						} else {
							if (cHp(cc) < cMaxHp(cc) / 4) {
								if (rnd(100) >= limit(cHp(cc) * 100 / (cMaxHp(cc) / 4), 0, 100)) {
									goto *label_1404
								}
							}
						}
					}
				}
			}
			f = 0
			if (sdataref(1, efid) / 1000 == 1) {
				f = 1
				p = sdataref(1, efid) \ 1000
				if (bdataref(0, p) == 2) {
					efbad = 1
				}
			}
			if (sdataref(1, efid) == 7) {
				efbad = 1
			}
			if (efbad == 0) {
				if (efstatus >= 1) {
					lint_efp = efp * 150 / 100
					efp = limitmax(lint_efp, INT_MAX)
				}
				if (efstatus <= (-1)) {
					efp = efp / 2
				}
			} else {
				if (efstatus >= 1) {
					efp = efp / 2
				}
				if (efstatus <= (-1)) {
					lint_efp = efp * 150 / 100
					efp = limitmax(lint_efp, INT_MAX)
				}
			}
			if (f) {
				procbody = *label_1796
				gosub *label_1794
				goto *label_1409
			}
			calcskill efid, cc, efp
			calcempower efid
			if (rapidmagic) {
				lint_efp = efp * 13 / 20 + 1
				efp = limitmax(lint_efp, INT_MAX)
				dice1 = dice1 * 13 / 20 + 1
				dice2 = dice2 * 13 / 20 + 1
				bonus = bonus * 13 / 20 + 1
			}
			if (cc == 0) {
				if (magiccritical) {
					txtef 3
					txt -1, lang("全力全開！ ", "Full power release!")
				}
			}
			_switch_val = sdataref(1, efid)
			if (_switch_val == 10 | _switch_sw) {
				_switch_sw = 0
				animeid = 18
				gosub *label_0630
				gosub *label_1442
				gosub *label_1848
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 1 | _switch_sw) {
				_switch_sw = 0
				get_route cX(cc), cY(cc), tlocx, tlocy
				if (stat == 0) {
					goto *label_1403
				}
				animeid = 0
				gosub *label_0630
				dx = cX(cc)
				dy = cY(cc)
				repeat 20
					route_info dx, dy, cnt
					if (stat == 0) {
						break
					} else {
						if (stat == (-1)) {
							continue
						}
					}
					if (dist(dx, dy, cX(cc), cY(cc)) > sdataref(3, efid) \ 1000 + 1) {
						break
					}
					if (dx == cX(cc) & dy == cY(cc)) {
						continue
					}
					if (ele == 50) {
						mapitem_fire dx, dy
					}
					if (ele == 51) {
						mapitem_cold dx, dy
					}
					if (map(dx, dy, 1) != 0) {
						tc = map(dx, dy, 1) - 1
						attack_weakGuard // from bolt spells
						if (cc != tc) {
							if (gMount != 0) {
								if (gMount == cc) {
									if (tc == 0) {
										continue
									}
								}
							}
							if (ocdata(107, cc) != 0) {
								if (tc == ocdata(107, cc)) {
									continue
								}
							}
							if (magiccritical) {
								lint_damage = longint(rolemax(dice1, dice2, bonus))
							} else {
								lint_damage = longint(role(dice1, dice2, bonus))
							}
							if (lint_damage > 2000000000) {
								lint_damage = 2000000000
							}
							calcmagiccontrol cc, tc
							if (stat == 1) {
								continue
							}
							if (synccheck(tc, -1) & weaponenc == 0) {
								if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
									gdata(809) = 2
									txt3rd = 1
									txt -1, lang("ボルトは" + name(tc) + "に命中し", "The bolt hits " + name(tc) + " and")
								} else {
									txt -1, lang("ボルトが" + name(tc) + "に命中した。", "The bolt hits " + name(tc) + ".")
								}
							}
							magicflag@se = 1
							dmghp tc, int(lint_damage), cc, ele, elep
						}
					}
				loop
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 3 | _switch_sw) {
				_switch_sw = 0
				chainbomb = 0
				ccbk = cc
				if (efid == 644) {
					stxt cc, lang(name(cc) + "は爆発した。", name(cc) + " explode" + _s(cc) + ".")
				}
*label_1399
				cbitmod 972, cc, 0
				range = sdataref(3, efid) \ 1000 + 1
				if (efid == 644) {
					range = 2
				}
				if (efid != 404 & efid != 637 & efid != 403) {
					if (cc != tc) {
						animeid = 1
						gosub *label_0630
					}
					aniref = range
					animeid = 2
					anix = tlocx
					aniy = tlocy
					gosub *label_0630
				}
				repeat range * 2 + 1
					dy = tlocy - range + cnt
					if (dy < 0 | dy >= mapHeight) {
						continue
					}
					repeat range * 2 + 1
						dx = tlocx - range + cnt
						if (dx < 0 | dx >= mapWidth) {
							continue
						}
						if (dist(tlocx, tlocy, dx, dy) > range) {
							continue
						}
						if (fov_los(tlocx, tlocy, dx, dy) == 0) {
							continue
						}
						if (map(dx, dy, 1) == 0) {
							continue
						}
						tc = map(dx, dy, 1) - 1
						attack_weakGuard // from ball spells
						if (efid == 637) {
							f = 0
							if (cc == 0 | cRelationship(cc) >= 0) {
								if (cRelationship(tc) >= 0) {
									f = 1
								}
							} else {
								if (cRelationship(tc) <= (-1)) {
									f = 1
								}
							}
							if (f == 1) {
								animeid = 11
								gosub *label_0630
								txt -1, lang(name(tc) + "の狂気は消え去った。", name(tc) + " " + is(tc) + " completely sane again.")
								healsan tc, efp / 10
								healcon tc, 11, 9999
							}
							continue
						}
						if (dx == cX(cc) & dy == cY(cc)) {
							continue
						}
						if (gMount != 0) {
							if (gMount == cc) {
								if (tc == 0) {
									continue
								}
							}
						}
						if (ocdata(107, cc) != 0) {
							if (tc == ocdata(107, cc)) {
								continue
							}
						}
						if (ele == 50) {
							mapitem_fire dx, dy
						}
						if (ele == 51) {
							mapitem_cold dx, dy
						}
						if (cc != tc) {
							if (magiccritical) {
								lint_damage = longint(rolemax(dice1, dice2, bonus))
							} else {
								lint_damage = longint(role(dice1, dice2, bonus))
							}
							if (lint_damage > 2000000000) {
								lint_damage = 2000000000
							}
							lint_damage = lint_damage * 100 / (75 + dist(tlocx, tlocy, dx, dy) * 25)
							calcmagiccontrol cc, tc
							if (stat == 1) {
								continue
							}
							if (efid == 644) {
								if (synccheck(tc, -1) & weaponenc == 0) {
									if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
										gdata(809) = 2
										txt3rd = 1
										txt -1, lang("爆風は" + name(tc) + "に命中し", "The explosion hits " + name(tc) + " and")
									} else {
										txt -1, lang("爆風が" + name(tc) + "に命中した。", "The explosion hits " + name(tc) + ".")
									}
								}
								if (cbit(18, tc)) {
									chainbomblist(chainbomb) = tc
									chainbomb++
									continue
								}
							} else {
								if (synccheck(tc, -1) & weaponenc == 0) {
									if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
										gdata(809) = 2
										txt3rd = 1
										txt -1, lang("ボールは" + name(tc) + "に命中し", "The ball hits " + name(tc) + " and")
									} else {
										txt -1, lang("ボールが" + name(tc) + "に命中した。", "The Ball hits " + name(tc) + ".")
									}
								}
							}
							magicflag@se = 1
							dmghp tc, int(lint_damage), cc, ele, elep
						}
					loop
				loop
				if (efid == 644) {
					cHp(cc) = -1
					dmghp cc, 9999999, -16
				}
				if (chainbomb > 0) {
*label_1400
					chainbomb--
					if (chainbomb < 0) {
						goto *label_1401
					}
					cc = chainbomblist(chainbomb)
					tlocx = cX(cc)
					tlocy = cY(cc)
					if (cState(cc) == 1) {
						calcskill efid, cc, efp
						stxt cc, lang(name(cc) + "は誘爆した。", name(cc) + " explode" + _s(cc) + ".")
						goto *label_1399
					}
					goto *label_1400
				}
*label_1401
				cc = ccbk
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 2 | _switch_sw) {
				_switch_sw = 0
				attack_weakGuard // from arrow spells
				animeid = 1
				gosub *label_0630
				if (magiccritical) {
					lint_damage = longint(rolemax(dice1, dice2, bonus))
				} else {
					lint_damage = longint(role(dice1, dice2, bonus))
				}
				if (lint_damage > 2000000000) {
					lint_damage = 2000000000
				}
				if (synccheck(tc, -1) & weaponenc == 0) {
					if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
						gdata(809) = 2
						txt3rd = 1
						txt -1, lang("矢は" + name(tc) + "に命中し", "The arrow hits " + name(tc) + " and")
					} else {
						txt -1, lang("矢が" + name(tc) + "に命中した。", "The arrow hits " + name(tc) + ".")
					}
				}
				magicflag@se = 1
				dmghp tc, int(lint_damage), cc, ele, elep
				orgdmg = lint_damage
				check_adddamage_arrow
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 4 | _switch_sw) {
				_switch_sw = 0
				procbody = *label_1795
				gosub *label_1794
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 6 | _switch_sw) {
				_switch_sw = 0
				attack_weakGuard // from various spacts
				ctalk cc, 427, cc, tc
				if (cSpecialAttackType(cc) != 0) {
					if (synccheck(cc, -1)) {
						if (cc == 0) {
							txt -1, lang(name(cc) + "は" + skillname(efid) + "の" + _cast(cSpecialAttackType(cc)), name(cc) + " cast " + skillname(efid) + ".")
						} else {
							txt -1, lang(name(cc) + "は" + _cast(cSpecialAttackType(cc)), name(cc) + "" + _cast(cSpecialAttackType(cc)))
						}
					}
				} else {
					if (efid == 601) {
						if (synccheck(cc, -1)) {
							if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
								gdata(809) = 2
								if (cfg_dmgtxttype) {
									txt -1, lang(aln(cc) + name(tc) + "の血を吸った。", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood.")
								} else {
									txt -1, lang(aln(cc) + name(tc) + "の血を吸い", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood and")
								}
							} else {
								txt -1, lang(name(cc) + "に血を吸われた。", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood.")
							}
							cNutrition(cc) += 150
						}
					} else {
						if (efid == 660) {
							ctalk cc, 427, cc, tc
							if (stat == 0) {
								txt cc, lang("「余分な機能は削除してしまえ」", cnvtalk("Delete."))
							}
							if (eqfaction(tc, "overwish")) {
								txt -1, lang("しかし、効果はなかった。", "But it produces no effect.")
								goto *label_1403
							}
							cHp(tc) = cMaxHp(tc) / 12 + 1
							goto *label_1403
						} else {
							if (efid == sId_addattack) {
								gdata(809) = 2
								ctalk cc, 427, cc, tc
								if (stat == 0) {
									txt -1, lang(name(cc) + "は連撃を繰り出した。", name(cc) + " launched a series of attacks.")
								}
								ele = cElementOfUnarmedAttack(cc) / 100000
								elep = cElementOfUnarmedAttack(cc) \ 100000
								animeid = 9
								gosub *label_0630
								if (cfg_dmgtxttype) {
									txt -1, lang(aln(cc) + name(tc) + "を" + _melee(2, cMeleeAttackType(cc)) + "で" + _melee(3, cMeleeAttackType(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(3, cMeleeAttackType(cc)) + ".")
								} else {
									txt -1, lang(aln(cc) + name(tc) + "を" + _melee(2, cMeleeAttackType(cc)) + "で" + _melee(0, cMeleeAttackType(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeAttackType(cc)) + " and")
								}
								dmgmulti = 0.5 + double(sdata(10, cc) + sdata(106, cc) / 5 + sdata(152, cc) * 2) / 40
								dice1 = 2
								dice2 = sdata(106, cc) / 8 + 5
								dmgfix = sdata(10, cc) / 8 + sdata(106, cc) / 8 + cDamageBonus(cc)
								lint_damage = role(dice1, dice2, bonus) * dmgmulti
								if (lint_damage > 2000000000) {
									lint_damage = 2000000000
								}
								dmghp tc, int(lint_damage), cc, ele, elep
								animeid = 9
								gosub *label_0630
								if (cState(tc) == 1) {
									if (cfg_dmgtxttype) {
										txt -1, lang("更に" + aln(cc) + name(tc) + "を" + _melee(2, cMeleeAttackType(cc)) + "で" + _melee(3, cMeleeAttackType(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(3, cMeleeAttackType(cc)) + ".")
									} else {
										txt -1, lang("更に" + aln(cc) + name(tc) + "を" + _melee(2, cMeleeAttackType(cc)) + "で" + _melee(0, cMeleeAttackType(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeAttackType(cc)) + " and")
									}
									dmgmulti = 0.5 + double(sdata(10, cc) + sdata(106, cc) / 5 + sdata(152, cc) * 2) / 40
									dice1 = 2
									dice2 = sdata(106, cc) / 8 + 5
									dmgfix = sdata(10, cc) / 8 + sdata(106, cc) / 8 + cDamageBonus(cc)
									lint_damage = role(dice1, dice2, bonus) * dmgmulti
									if (lint_damage > 2000000000) {
										lint_damage = 2000000000
									}
									dmghp tc, int(lint_damage), cc, ele, elep
								}
								ctalk cc, 428, cc, tc
								goto *label_1403
							} elseif (efid == sId_falseSwipe) {
								gdata(809) = 2
								if (cc == 0) {
									ctalk cc, 427, cc, tc
									if (stat == 0) {
									txt -1, lang(name(cc) + "の みねうち！", name(cc) + " used False Swipe!")
									}
								} else {
									ctalk cc, 427, cc, tc
									if (stat == 0) {
									txt -1, lang("あいての " + name(cc) + "の みねうち！", "The opposing " + name(cc) + "used False Swipe!")
									}
								}
								if (cfg_dmgtxttype == 0) {
									txt -1, lang(aln(cc) + name(tc) + "を峰で打ち", name(cc) + " strike" + _s(cc) + " " + name(tc) + " with back of the blade and")
								}
								animeid = 9
								gosub *label_0630
							} elseif (synccheck(cc, -1)) {
								if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
									gdata(809) = 2
									if (cfg_dmgtxttype) {
										txt -1, lang(aln(cc) + name(tc) + "を" + elename(ele) + _melee(2, cMeleeAttackType(cc)) + "で" + _melee(3, cMeleeAttackType(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(3, cMeleeAttackType(cc)) + ".")
									} else {
										txt -1, lang(aln(cc) + name(tc) + "を" + elename(ele) + _melee(2, cMeleeAttackType(cc)) + "で" + _melee(0, cMeleeAttackType(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeAttackType(cc)) + " and")
									}
								} else {
									txt -1, lang(name(tc) + "は" + name(cc) + "に" + elename(ele) + _melee(2, cMeleeAttackType(cc)) + "で" + _melee(1, cMeleeAttackType(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeAttackType(cc)) + ".")
								}
							}
						}
					}
				}
				dmghp tc, role(dice1, dice2, bonus), cc, ele, elep
				ctalk cc, 428, cc, tc
				if (efid == 617) {
					dmgcon tc, 6, elep
				}
				if (efid == 618) {
					dmgcon tc, 2, elep
				}
				if (efid == 614) {
					cNutrition(tc) -= 8 * 100
					if (synccheck(tc, -1)) {
						txtef 8
						txt -1, lang(name(tc) + "はお腹が減った。", "Suddenly " + name(tc) + " feel" + _s(tc) + " hungry.")
					}
					r1 = tc
					gosub *label_0720
				}
				if (efid == 613) {
					p = rnd(20 - 10)
					if (cQuality(tc) >= 4 & rnd(4) | encfind(tc, 6 * 10000 + 10 + p) != (-1) | have_bigench(tc, 6) == 1) {
						p = -1
					}
					if (p != (-1)) {
						i = sorgEx(10 + p, tc) + cdata(240 + p, tc)
						if (i > 0) {
							i = i * efp / 2000 + 1
							cdata(240 + p, tc) -= i
						}
						if (synccheck(tc, -1)) {
							txtef 8
							txt -1, lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
						}
						r1 = tc
						gosub *chara_refresh
					}
				}
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 7 | _switch_sw) {
				_switch_sw = 0
				if (cc == 0) {
					if (gCrowdDensity + 100 >= 245 - 57) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						obvious = 0
						goto *label_1403
					}
				}
				p = 3
				efp = (efp / 25 + efp * efp / 10000 + cLevel(cc)) / 2
				if (efp < 1) {
					efp = 1
				}
				if (efid == 641) {
					efp = 15 + rnd(8)
				}
				if (efid == 639) {
					efp = 2 + rnd(18)
				}
				if (efid == 642) {
					efp = 15 + rnd(15)
				}
				if (efid == 640) {
					efp = 5 + rnd(12)
				}
				if (efid == 643) {
					p = 10
				}
				if (efid == 788 | efid == 789 | efid == 792) {
					efp = cLevel(cc)
				}
				if (efid == 795) {
					efp = sdata(180, cc) + 1
					p = 1
				}
				if (efid == 796) {
					efp = efp + 2
					p = 1
				}
				repeat 1 + rnd(p)
					flt calcobjlv(efp), 2
					dbid = 0
					if (efid == 425) {
						fltn "wild"
					}
					if (efid == 642) {
						fltn "fire"
					}
					if (efid == 641) {
						fltn "pawn"
					}
					if (efid == 639) {
						fltn "cat"
					}
					if (efid == 640) {
						fltn "yeek"
					}
					if (efid == 643) {
						dbid = 176
					}
					if (efid == 788) {
						fltn "dragon"
					}
					if (efid == 789) {
						fltn "dragon"
						fixlv = 3
						npcrare = 1
					}
					if (efid == 792) {
						fltn "undead"
						fixlv = 3
						npcrare = 1
					}
					if (efid == 795) {
						dbid = 500
						initlv = objlv
					}
					if (efid == 796) {
						fltn "undead"
					}
					noencpfix = 1
					nc_skipflag = 1
					characreate -1, dbid, cX(tc), cY(tc)
					if (stat != 0) {
						if (efid == 795 | efid == 796) {
							if (cc == 0) {
								cdata(9, rc) = 10
								cdata(69, rc) = 10
							} else {
								cdata(9, rc) = cdata(9, cc)
								cdata(69, rc) = cdata(69, cc)
							}
						}
						if (efid == 425) {
							if (cc == 0) {
								if (cdata(25, rc) != 6) {
									if (gettrait(cc, 104) != 0) {
										if (findfaction(rc, "family", "wild")) {
											cdata(9, rc) = 10
											cdata(69, rc) = 10
										}
									}
								}
							}
						}
						if (efid != 643) {
							if (cId(rc) == cId(cc)) {
								chara_vanquish rc
								continue cnt
							}
							if (relationbetween(rc, cc) == 10) {
								addfaction rc, "pet," + cc
								ocdata(10, rc) = 1
								ocdata(0, rc) = 3
							}
						}
						ctalk rc, 736, rc, cc
						resetfaction rc
						if (nc_gettrait(cc, 117) > 0) {
							addbuff rc, 5, efp / 100, 50
							addbuff rc, 7, efp / 100, 50
							addbuff rc, 18, efp / 300, 50
						}
					}
				loop
				if (synccheck(cc, -1)) {
					txt -1, lang("魔法でモンスターが召喚された。", "Several monsters come out from a portal.")
				}
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 5 | _switch_sw) {
				_switch_sw = 0
				tcprev = tc
				if (gMount != 0) {
					if (gMount == tc) {
						goto *label_1403
					}
				}
				if (ocdata(107, tc) != 0) {
					goto *label_1403
				}
				if (efid == 408) {
					tc = cc
				}
				if ((efid == 619 | efid == 620 | efid == 635) & nc_himo == 0) {
					ctalk cc, 427, cc, tc
				} else {
					nc_himo = 0
				}
				if (efid == 619) {
					telex = cX(tc)
					teley = cY(tc)
					tc = cc
				}
				if (efid == 620) {
					telex = cX(cc)
					teley = cY(cc)
				}
				if (efid == 409 | efid == 635) {
					if (map(tlocx, tlocy, 1) == 0) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						obvious = 0
						goto *label_1403
					}
					tc = map(tlocx, tlocy, 1) - 1
				}
				if (gCurrentMap == 40 | gCurrentMap == 49 | mapType == 1 | gCurrentMap == 37 | gCurrentMap == 41) {
					if (synccheck(tc, -1)) {
						txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
					}
					goto *label_1403
				}
				if (efid == 635) {
					if (findbuff(cc, 62) == (-1) | have_bigench(cc, 3) == 1) {
						if (encfind(cc, 22) != (-1)) {
							if (synccheck(tc, -1)) {
								txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
							}
							goto *label_1403
						}
					}
					p = rndex(cGold(tc) / 10 + 1)
					if (rnd(sdata(13, tc)) > rnd(sdata(12, cc) * 4) | cbit(15, tc) == 1) {
						txt -1, lang(name(tc) + "は自分の財布を守った。", name(tc) + " guard" + _s(tc) + " " + his(tc) + " wallet from a thief.")
						p = 0
					}
					if (p != 0) {
						snd 12
						cGold(tc) -= p
						txt -1, lang(name(cc) + "は" + name(tc) + "から" + p + "枚の金貨を奪った。", name(cc) + " steal" + _s(cc) + " " + p + " gold pieces from " + name(tc) + ".")
						se_moneymod cc, p
					}
					tc = cc
					if (gMount != 0) {
						if (gMount == tc) {
							goto *label_1403
						}
					}
					if (ocdata(107, tc) != 0) {
						goto *label_1403
					}
				}
				if (efid == 619) {
					if (gMount != 0) {
						if (gMount == tc) {
							goto *label_1403
						}
					}
					if (ocdata(107, tc) != 0) {
						goto *label_1403
					}
				} else {
					if (encfind(tc, 22) != (-1) & (findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1) | (cc != tc & findfaction(tc, "regist", "teleport"))) {
						if (synccheck(tc, -1)) {
							txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
						}
						goto *label_1403
					}
				}
				tx = cX(tc)
				ty = cY(tc)
				if (tc == 0 & efid == 408 & rndtelepo != 1) {
					tm@00m = -1
					snd 100
					gosub *label_2054
					if (stat != (-1)) {
						tm@00m = stat
					}
				}
				if (synccheck(tc, -1)) {
					snd 72
				}
*label_1402
				efidprev = efid
				repeat 200
					if (efidprev == 410 | efidprev == 627) {
						p = -1, 1
						cNextX(tc) = rnd(mapWidth - 2) + 1
						cNextY(tc) = rnd(mapHeight - 2) + 1
						_dis = dist(cX(tc), cY(tc), cNextX(tc), cNextY(tc))
						if (_dis > 7 | _dis < 4) {
							continue
						}
					} else {
						if (efidprev == 619) {
							cNextX(tc) = telex + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
							cNextY(tc) = teley + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
						} else {
							if (efidprev == 620) {
								cNextX(tc) = telex + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
								cNextY(tc) = teley + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
							} else {
								if (tm@00m != (-1)) {
									cNextX(tc) = iX(tm@00m) + (cnt != 0 * (rnd(3) - rnd(3)))
									cNextY(tc) = iY(tm@00m) + (cnt != 0 * (rnd(3) - rnd(3)))
								} else {
									cNextX(tc) = rnd(mapWidth - 2) + 1
									cNextY(tc) = rnd(mapHeight - 2) + 1
									if (dist(cX(tc), cY(tc), cNextX(tc), cNextY(tc)) < 8) {
										continue
									}
								}
							}
						}
					}
					cell_check cNextX(tc), cNextY(tc)
					if (cellaccess == 1) {
						if (efidprev == 619) {
						} else {
							if (efidprev == 620) {
								if (synccheck(cc, -1)) {
									txt -1, lang(name(tc) + "は引き寄せられた。", name(tc) + " " + is(tc) + " drawn.")
								}
							} else {
								if (synccheck(cc, -1)) {
									if (efidprev == 635) {
										ctalk cc, 428, cc, tc
										txt -1, lang("泥棒は笑って逃げた。", "A thief escapes laughing.")
									} else {
										txt -1, lang(name(tc) + "は突然消えた。", "Suddenly, " + name(tc) + " disappear" + _s(tc) + ".")
										if (tm@00m != (-1)) {
											if (rnd(10) == 0 & areaType(gCurrentMap) != 5) {
												ibitmod 20, tm@00m, 0
												txt -1, lang(itemname(tm@00m, 1) + "は転移用の目印としての機能を失った。", itemname(tm@00m, 1) + " lost its magical power as a teleporting marker.")
											}
										}
									}
								}
							}
						}
						if (efidprev == 619 | efidprev == 620) {
							ctalk cc, 428, cc, tc
						}
						rowactend cc
						ccprev = cc
						cc = tc
						gosub *label_1367
						cc = ccprev
						if (tc == 0) {
							gosub *label_0623
						}
						break
					}
				loop
				tm@00m = -1
				tc = tcprev
				goto *label_1403
				_switch_sw++
			}
			if (_switch_val == 8 | _switch_sw) {
				_switch_sw = 0
				get_route cX(cc), cY(cc), tlocx, tlocy
				if (stat == 0) {
					goto *label_1403
				}
				if (ele) {
					valn = skillname(ele) + lang("の", " breath")
				} else {
					valn = lang("", "breath")
				}
				if (synccheck(cc, -1)) {
					ctalk cc, 427, cc, tc
					txt -1, lang(name(cc) + "は" + valn + "ブレスを吐いた。", name(cc) + " bellow" + _s(cc) + " " + valn + " from " + his(cc) + " mouth.")
					ctalk cc, 428, cc, tc
				}
				dx = cX(cc)
				dy = cY(cc)
				breath_list
				animeid = 3
				gosub *label_0630
				repeat maxbreath
					dx = breathlist(0, cnt)
					dy = breathlist(1, cnt)
					if (fov_los(cX(cc), cY(cc), dx, dy) == 0) {
						continue
					}
					if (dx == cX(cc) & dy == cY(cc)) {
						continue
					}
					if (gMount != 0) {
						if (gMount == cc) {
							if (tc == 0) {
								continue
							}
						}
					}
					if (ocdata(107, cc) != 0) {
						if (tc == ocdata(107, cc)) {
							continue
						}
					}
					if (ele == 50) {
						mapitem_fire dx, dy
					}
					if (ele == 51) {
						mapitem_cold dx, dy
					}
					if (map(dx, dy, 1) != 0) {
						tc = map(dx, dy, 1) - 1
						attack_weakGuard // from breath
						if (cc != tc) {
							dmg = role(dice1, dice2, bonus)
							calcmagiccontrol cc, tc
							if (stat == 1) {
								continue
							}
							if (synccheck(tc, -1) & weaponenc == 0) {
								if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
									gdata(809) = 2
									txt3rd = 1
									if (cfg_dmgtxttype) {
										txt -1, lang("ブレスは" + name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
									} else {
										txt -1, lang("ブレスは" + name(tc) + "に命中し", "The breath hits " + name(tc) + " and")
									}
								} else {
									txt -1, lang("ブレスは" + name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
								}
							}
							dmghp tc, dmg, cc, ele, elep
						}
					}
				loop
				goto *label_1403
			}
			if (_switch_val == 11 | _switch_sw) {
				_switch_sw = 0
				txtef 4
				txt -1, lang(elemeteor(ele) + "が落ちてきた！", "Innumerable " + elemeteor(ele) + " fall all over the area!")
				animeid = 22
				gosub *label_0630
				repeat mapHeight
					dy = cnt
					repeat mapWidth
						dx = cnt
						if (rnd(3) == 0) {
							map(dx, dy, 0) = 12 + rnd(2)
						}
						if (ele == 50) {
							if (rnd(40) == 0) {
								addmef dx, dy, 5, 24, rnd(4) + 3, 50
							}
						}
						if (ele == 70) {
							if (rnd(10) == 0) {
								addmef dx, dy, 6, 27, -1, elep / 500, cc, 620, 0, 0
							}
						}
						if (ele == 71) {
							if (rnd(10) == 0) {
								addmef dx, dy, 6, 27, -1, elep / 500, cc, 205, 0, 0
							}
						}
						if (map(dx, dy, 1) != 0) {
							tc = map(dx, dy, 1) - 1
							attack_weakGuard // from meteor
							if (ogdata(505) != 2) {
								dmg = int(limitf(double(sdata(16, cc)) * efp / 10, 1, 20000000))
							} else {
								dmg = int(limitf(double(sdata(16, cc)) * efp / 10, 1, 2000000000))
							}
							magicflag@se = 1
							dmghp tc, dmg, cc, ele, elep
						}
					loop
				loop
				goto *label_1403
				_switch_sw++
			}
			if (efsource == 3) {
				if (_switch_val == 12 | _switch_sw) {
					_switch_sw = 0
					procbody = *label_1798
					gosub *label_1794
					goto *label_1403
					_switch_sw++
				}
				if (_switch_val == 13 | _switch_sw) {
					_switch_sw = 0
					procbody = *label_1797
					gosub *label_1794
					goto *label_1403
					_switch_sw++
				}
			}
			goto *label_1404
			goto *label_1403
*label_1403
			goto *label_1409
		} else {
			if (efstatus >= 1) {
				lint_efp = efp * 150 / 100
				efp = limitmax(lint_efp, INT_MAX)
			}
			if (efstatus <= (-1)) {
				efp = 50
			}
		}
	}
*label_1404
	_switch_val = efid
	if (_switch_val == 636 | _switch_sw) {
		_switch_sw = 0
		txtef 8
		if (jp) {
			ctalk cc, 427, cc, tc
			ctalk cc, 969, cc, tc
			if (stat == 0) {
				txtef 8
				txt -1, name(tc) + "は" + name(cc) + "の腹の亀裂から蛆虫が沸き出るのを見た。", name(tc) + "は" + name(cc) + "が屍を貪る姿を目撃した。", name(tc) + "は" + name(cc) + "の恐ろしい瞳に震えた。", name(tc) + "は" + name(cc) + "の触手に絡まる臓物に吐き気を感じた。"
			}
			ctalk cc, 428, cc, tc
		}
		if (en) {
			txt -1, name(tc) + " see" + _s(tc) + " maggots breed in the rent stomach of " + name(cc) + ".", name(tc) + " see" + _s(tc) + " " + name(cc) + " chow" + _s(cc) + " dead bodies.", name(tc) + " shudder" + _s(tc) + " at " + name(cc) + your(cc) + " terrifying eyes.", name(tc) + " feel" + _s(tc) + " sick at entrails caught in " + name(cc) + your(cc) + " tentacles."
		}
		dmgsan tc, rnd(role(dice1, dice2, bonus) + 1)
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1136 | _switch_sw) {
		_switch_sw = 0
		if (mapType != 1) {
			txt -1, lang("それはグローバルマップで読む必要がある。", "You need to read it while you are in the global map.")
			goto *label_1410
		}
		if (efstatus <= (-1)) {
			if (rnd(5) == 0) {
				txt -1, lang("呪われた地図は触れると崩れ落ちた。", "The cursed map crumbles as you touch.")
				iNumber(ci)--
				if (ci >= 5080) {
					cell_refresh iX(ci), iY(ci)
				}
				goto *label_1410
			}
		}
		if (iParam1(ci) == 0) {
			item_separate ci
			repeat 1000
				dx = 4 + rnd(mapWidth - 8)
				dy = 3 + rnd(mapHeight - 6)
				if (dx >= 50 & dy >= 39 & dx <= 73 & dy <= 54) {
					continue
				}
				x = 1, -1, 0, 0
				y = 0, 0, 1, -1
				repeat 4
					f = 1
					cnt2 = cnt
					repeat 3
						p = map(dx + x(cnt2) * cnt, dy + y(cnt2) * cnt, 0)
						if (264 <= p & p < 363 | (chipm(7, p) & 4)) {
							f = 0
							break
						}
					loop
					if (f == 1) {
						break
					}
				loop
				if (f == 1) {
					break
				}
			loop
			iParam1(ci) = dx
			iParam2(ci) = dy
			iParam3(ci) = gCurrentMap
		}
		if (iParam3(ci) == gCurrentMap | iParam3(ci) == 0) {
			txt -1, lang("何かの場所を記した地図のようだ…", "There's a mark on the map...")
			throwsstpevent "ReadTreasureMap", 0, "", 0
			snd 59
			gsel 4
			pos 0, 0
			picload_ exedir + "graphic\\paper.bmp", 1
			gsel 0
			redraw 0
			ww = 400
			wh = 300
			wx = (windoww - ww) / 2 + inf_screenx
			wy = winposy(wh)
			gmode 2
			pos wx, wy
			gcopy 4, 0, 0, ww, wh
			gmode 1, inf_tiles, inf_tiles
			repeat 5
				y = cnt + iParam2(ci) - 2
				sy = cnt * inf_tiles + wy + 26
				repeat 7
					x = cnt + iParam1(ci) - 3
					sx = cnt * inf_tiles + wx + 46
					p = map(x, y, 0)
					pos sx + 1, sy + 1
					gcopy 2, p \ 33 * inf_tiles, p / 33 * inf_tiles
					if (x == iParam1(ci)) {
						if (y == iParam2(ci)) {
							pos sx, sy
							font lang(cfg_font1, cfg_font2), 40 - en * 2, 2
							color 255, 20, 20
							mes lang("○", "O")
						}
					}
				loop
			loop
			gmode 2
			pos wx, wy
			gcopy 4, 400, 0, ww, wh
			redraw 1
			press
			snd 71
		} else {
			snd 59
			txt -1, lang("この地図は別の大陸の地図だ。", "This map is a map of another continent.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1135 | _switch_sw) {
		_switch_sw = 0
		if (efstatus <= (-1)) {
			if (tc == 0) {
				eatstatus efstatus, tc
			} else {
				txt -1, lang("媚薬は呪われていた。" + name(tc) + "は" + name(0) + "を軽蔑のまなざしで見つめた。", "This love potion is cursed. " + name(tc) + " look" + _s(tc) + " at " + name(0) + " with a contemptuous glance.")
				modimp tc, -15
			}
			healcon tc, 13, efp * 5
			obvious = 0
			goto *label_1410
		}
		cEmotionIcon(tc) = 17 + 100 * 3
		if (potionspill | potionthrow) {
			txt -1, lang(name(tc) + "は恋の予感がした。", name(tc) + " sense" + _s(tc) + " a sigh of love,")
			modimp tc, efp / 15
			dmgcon tc, 7, 100
			dmgcon tc, 13, 200
			if (rnd(10000) < limitmax(efp / 200, 100)) {
				animeload 15, tc
				itemcreate -1, 785, cX(tc), cY(tc), 0
				if (stat) {
					if (tc == 0) {
						ibitmod 5, ci, 1
					} else {
						iSubname(ci) = cId(tc)
						if (iSubname(ci) == 343) {
							inv(33, ci) = cCnpcId(tc)
							inv(34, ci) = createserialno(userdatan(0, cCnpcId(tc)))
						}
					}
				}
			}
			f = 0
			repeat limitmin(efp / 100, 1)
				lovemiracle tc
			loop
			f = 0
			if (tc != 0) {
				if (ccthrowpotion == 0) {
					if (efp > 100) {
						modkarma 0, limit(efp / 100 * (-1), -20, 0)
					}
				}
			}
			goto *label_1410
		}
		if (tc == 0) {
			txt -1, lang(name(tc) + "は興奮した！", "You are excited!")
		} else {
			txt -1, lang(name(tc) + "は" + name(0) + "を熱いまなざしで見つめた。", name(tc) + " give" + _s(tc) + " " + name(0) + " the eye.")
		}
		if (rnd(10000) < limitmax(efp / 200, 100)) {
			animeload 15, tc
			itemcreate -1, 785, cX(tc), cY(tc), 0
			if (stat) {
				if (tc == 0) {
					ibitmod 5, ci, 1
				} else {
					iSubname(ci) = cId(tc)
					if (iSubname(ci) == 343) {
						inv(33, ci) = cCnpcId(tc)
						inv(34, ci) = createserialno(userdatan(0, cCnpcId(tc)))
					}
				}
			}
		}
		f = 0
		repeat limitmin(efp / 100, 1)
			lovemiracle tc
		loop
		f = 0
		modimp tc, efp / 4
		dmgcon tc, 7, 500
		dmgcon tc, 13, efp * 2
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 654 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			ctalk cc, 427, cc, tc
			ctalk cc, 967, cc, tc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は" + name(tc) + "の口の中に何かを送り込んだ！", name(cc) + " put" + _s(cc) + " something into " + name(tc) + your(tc) + " body!")
			}
			ctalk cc, 428, cc, tc
		}
		gosub *label_0816
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 626 | _switch_sw) {
		_switch_sw = 0
		txt -1, lang("あなたは自分の状態を調べた。", "You examine yourself.")
		animeload 10, tc
		gosub *label_1164
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1101 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			snd 107
			if (efstatus <= (-1)) {
				ctalk tc, 950, tc, tc
				if (stat == 0) {
					ctalk tc, 429, tc, tc
					if (stat == 0) {
						ctalk tc, 1214, tc, tc
						if (stat == 0) {
							if (tc == 0) {
								txt -1, lang("うわ、これは呪われている。なんだかやばい味だ…", "Geee it's cursed! The taste is very dangerous.")
							} else {
								txtef 9
								txt tc, lang("「ぺっぺっ、まずー」", cnvtalk("Argh, the milk is cursed!"))
							}
						}
					}
				}
			} else {
				ctalk tc, 949, tc, tc
				if (stat == 0) {
					ctalk tc, 430, tc, tc
					if (stat == 0) {
						ctalk tc, 1213, tc, tc
						if (stat == 0) {
							if (tc == 0) {
								txt -1, lang("濃厚で病み付きになりそうな味だ。", "The taste is very thick, almost addictive.")
							} else {
								txtef 9
								txt tc, lang("「うまー」", cnvtalk("Yummy!"))
							}
						}
					}
				}
			}
		}
		if (efstatus >= 1) {
			god_applyBlessedFoodEffect tc, ci, calcfixexp(tc, ci)
			modheight tc, rnd(5) + 1
		}
		cNutrition(tc) += 1000 * (efp / 100)
		if (efstatus <= (-1)) {
			modheight tc, (rnd(5) + 1) * (-1)
		}
		if (tc == 0) {
			gosub *label_1384
		}
		eatstatus efstatus, tc
		animeload 15, tc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1102 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			if (efstatus <= (-1)) {
				ctalk tc, 431, tc, tc
				if (stat == 0) {
					ctalk tc, 1212, tc, tc
					if (stat == 0) {
						txtef 9
						txt tc, lang("「うぃっ…」", "*Hic*"), lang("「まずいぜ」", cnvtalk("Ah, bad booze.")), lang("「げー♪」", cnvtalk("Ugh...")), lang("「腐ったミルクみたいな味だ」", cnvtalk("Bah, smells like rotten milk."))
					}
				}
			} else {
				ctalk tc, 432, tc, tc
				if (stat == 0) {
					ctalk tc, 1211, tc, tc
					if (stat == 0) {
						txtef 9
						txt tc, lang("「うぃっ！」", "*Hic*"), lang("「うまいぜ」", cnvtalk("Ah, good booze.")), lang("「らららー♪」", cnvtalk("La-la-la-la.")), lang("「ひっく」", cnvtalk("I'm going to heaven.")), lang("「ふぅ」", cnvtalk("Whew!")), lang("「たまらないわ」", cnvtalk("I'm revived!")), lang("「んまっ♪」", cnvtalk("Awesome."))
					}
				}
			}
		}
		if (godcheck(0) == "dorein") {
			efp *= 2
		}
		if (trophycheck(15) == 2) {
			dmgcon tc, 8, efp * 2
		} else {
			dmgcon tc, 8, efp
		}
		eatstatus efstatus, tc
		if (ocbit(11, tc)) {
			if (gettrait(tc, 186)) {
				modstress limit(efp, 0, 1500) * (-1)
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1116 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			if (tc == 0) {
				txt -1, lang("ぐわぁぁ！", "Arrrrg!")
			}
			txt -1, lang("酸が" + name(tc) + "を溶かした。", "The sulfuric acid melts " + name(tc) + ".")
		}
		if (cbit(978, tc)) {
			cbitmod 978, tc, 0
			if (ocdata(52, tc) == 330) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
					txtef 9
					ctalk tc, 970, tc, tc
				}
			} else {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
					txtef 9
					ctalk tc, 970, tc, tc
				}
			}
			ocdata(52, tc) = 0
			ocdata(53, tc) = 0
		}
		if (eqfaction(tc, "acidresist") == 0) {
			dmghp tc, efp * efstatusfix(500, 400, 100, 50) / 1000, -15, 63, efp
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1103 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			ctalk tc, 1337, tc, tc
			if (stat == 0) {
				if (tc == 0) {
					txt -1, lang("*ごくっ* 綺麗な水だ。", "*quaff* The water is refreshing.")
				} else {
					txt -1, lang(" *ごくっ* ", "*quaff*")
				}
			}
		}
		sickifcursed efstatus, tc, 1
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1146 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang("*シュワワ*", "*quaff*")
			ctalk tc, 1339, tc, tc
			if (stat == 0) {
				txt -1, lang("刺激的！", "Juicy!")
			}
			txt -1, lang(name(tc) + "のスタミナが少し回復した。", name(tc) + " restore" + _s(tc) + " some stamina.")
		}
		healsp tc, efp / 4
		sickifcursed efstatus, tc, 1
		if (showdamagecheck(efp / 4)) {
			if (synccheck(tc, -1)) {
				mondmgn(mondmgcnt) = "*" + (efp / 4) + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1147 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang("*ごくり*", "*quaff*")
			ctalk tc, 1340, tc, tc
			txt -1, lang(name(tc) + "のスタミナはかなり回復した。", name(tc) + " greatly restore" + _s(tc) + " stamina.")
		}
		healsp tc, efp
		sickifcursed efstatus, tc, 1
		if (showdamagecheck(efp)) {
			if (synccheck(tc(cnt), -1)) {
				mondmgn(mondmgcnt) = "*" + efp + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc(cnt), cc
				ccolor 110
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1142 | _switch_sw) {
		_switch_sw = 0
		if (cdatan(2, tc) == "snail") {
			food_meltBySalt tc
		} else {
			if (synccheck(tc, -1)) {
				txtef 9
				ctalk tc, 1246, tc, tc
				if (stat == 0) {
					txt tc, lang("「しょっぱ〜」", cnvtalk("Salty!"))
				}
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1130 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			ctalk tc, 1338, tc, tc
			if (stat == 0) {
				if (tc == 0) {
					txt -1, lang("*ごくっ* まずい！", "*quaff* Yucky!")
				} else {
					txt -1, lang(" *ごくっ* ", "*quaff*")
				}
			}
		}
		sickifcursed efstatus, tc, 1
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 300 | _switch_sw) {
		_switch_sw = 0
		if (gExecutingImmediateQuestType == 1008 | gExecutingImmediateQuestType == 1010 | gExecutingImmediateQuestType == 1021) {
			if (gdata(73) != 3) {
				txt -1, lang("そんなことをしている余裕はない！", "You have no time for it!")
				return 0
			}
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, efid) / 2 + 1) + sdataref(2, efid) / 2 + 1
		}
		invsubroutine = 1
		invctrl = 27, 0
		snd 100
		gosub *label_1280
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 301 | _switch_sw) {
		_switch_sw = 0
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, efid) / 2 + 1) + sdataref(2, efid) / 2 + 1
		}
		if (gMount != 0) {
			if (tc == cc) {
				cell_findspace cX(0), cY(0), 1
				if (stat == 0) {
					txt -1, lang("降りるスペースがない。", "There's no place to get off.")
					goto *label_1410
				}
				cell_setchara gMount, rtval, rtval(1)
				txt -1, lang(name(gMount) + "から降りた。", "You dismount from " + name(gMount) + ".")
				txtef 9
				ctalk gMount, 997, cc, gMount
				if (stat == 0) {
					if (cbit(25, gMount)) {
						ctalk gMount, 1230, cc, gMount
					} else {
						ctalk gMount, 1231, cc, gMount
					}
					if (stat == 0) {
						txtef 9
						if (jp) {
							txt gMount, name(gMount) + "「ふぅ」", name(gMount) + "「乗り心地はよかった？」", name(gMount) + "「疲れた…」", name(gMount) + "「またいつでも乗ってね♪」"
						}
						if (en) {
							txt gMount, name(gMount) + " " + cnvtalk("Phew."), name(gMount) + " " + cnvtalk("How was my ride?"), name(gMount) + " " + cnvtalk("Tired...tired..."), name(gMount) + " " + cnvtalk("It was nice.")
						}
					}
				}
				ride_end
				goto *label_1410
			}
		}
		if (tc >= 16 | cRole(tc) == 20001) {
			txt -1, lang("仲間にしか騎乗できない。", "You can only ride an ally.")
			goto *label_1410
		}
		if (cbit(963, tc) == 1 | cbit(971, tc) == 1) {
			txt -1, lang("護衛対象には騎乗できない。", "You can't ride a client.")
			goto *label_1410
		}
		if (tc == cc) {
			if (gMount == 0) {
				txt -1, lang(name(cc) + "は自分に乗ろうとした。", "You try to ride yourself.")
			}
			goto *label_1410
		}
		if (cCurrentMap(tc) != 0) {
			txt -1, lang("その仲間はこの場所に滞在中だ。", "The ally currently stays in this area.")
			goto *label_1410
		}
		if (gMount != 0) {
			txt -1, lang("現在" + name(cc) + "は" + name(gMount) + "に騎乗している。", name(cc) + " " + is(cc) + " currently riding " + name(gMount) + ".")
			goto *label_1410
		}
		if (ocdata(107, tc) != 0) {
			txt -1, lang("現在" + name(tc) + "は" + name(ocdata(107, tc)) + "が騎乗している。", name(ocdata(107, tc)) + " " + is(ocdata(107, tc)) + " currently riding " + name(tc) + ".")
			goto *label_1410
		}
		if (ocdata(106, tc) != 0) {
			txt -1, lang("現在" + name(tc) + "は" + name(ocdata(106, tc)) + "に騎乗している。", name(tc) + " " + is(tc) + " currently riding " + name(ocdata(106, tc)) + ".")
			goto *label_1410
		}
		ride_begin tc
		txtef 9
		ctalk gMount, 996, cc, gMount
		if ( stat == 0 ) {
			if (cbit(25, gMount)) {
					ctalk gMount, 1228, cc, gMount
			} else {
					ctalk gMount, 1229, cc, gMount
			}
			if (stat == 0) {
				txtef 9
				if (jp) {
					txt gMount, name(gMount) + "「うぐぅ」", name(gMount) + "「ダイエットしてよ…」", name(gMount) + "「いくよ！」", name(gMount) + "「やさしくしてね♪」"
				}
				if (en) {
					txt gMount, name(gMount) + " " + cnvtalk("Awww."), name(gMount) + " " + cnvtalk("You should go on a diet."), name(gMount) + " " + cnvtalk("Let's roll!"), name(gMount) + " " + cnvtalk("Be gentle.")
				}
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 183 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			f = 0
			inv_getheader cc
			repeat invrange, invhead
				if (iNumber(cnt) == 0) {
					continue
				}
				if (iSkill(cnt) == 183) {
					ci = cnt
					f = 1
					break
				}
			loop
			if (f == 0) {
				return 0
			}
		}
		if (sdata(183, cc) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は演奏のやり方を知らない。", name(cc) + " " + does(cc == 0) + "n't know how to play an instrument.")
				return 0
			}
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, efid) / 2 + 1) + sdataref(2, efid) / 2 + 1
		}
		gosub *label_1368
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 184 | _switch_sw) {
		_switch_sw = 0
		if (sdata(184, 0) == 0) {
			txt -1, lang("料理の仕方を知らない。", "You don't know how to cook.")
			return 0
		}
		cooktool = ci
		invsubroutine = 1
		invctrl = 16
		snd 100
		gosub *label_1280
		if (stat == 0) {
			return 0
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			p = rnd(sdataref(2, efid) / 2 + 1) + sdataref(2, efid) / 2 + 1
			if (gettrait(0, 86)) {
				p -= p * calctraitscore(stat) / 10
			}
			dmgsp 0, p
		}
		if (ogdata(478) == 2) {
			gosub *label_1655
		} else {
			gosub *label_0785
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 185 | _switch_sw) {
		_switch_sw = 0
		if (sdata(185, 0) == 0) {
			txt -1, lang("釣りの仕方を知らない。", "You don't know how to fish.")
			return 0
		}
		if (inv_getspace() == 0) {
			txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
			return 0
		}
		if (iCount(ci) == 0) {
			txt -1, lang("釣竿には餌が付いていない。", "You need a bait to fish.")
			txt -1, lang("餌を一括装着する？", "Will you put food all at once?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval != 0) {
				return 0
			}
			ti = ci
			invsubroutine = 1
			invctrl = 32, 0
			gosub *label_1280
			if (stat == 0) {
				return 0
			}
			item_separate ti
			txt -1, lang(itemname(ci) + "を" + itemname(ti) + "に装着した。", "Added" + itemname(ti) + "to" + itemname(ci) + ".")
			iParam4(ti) = iParam1(ci)
			repeat
				if (iNumber(ci) == 0) {
					break
				}
				iCount(ti) += rnd(10) + 15
				removeitem ci, 1
			loop
			return 0
		}
		f = 0
		repeat 3
			y = cY(cc) + cnt - 1
			x = cX(cc)
			if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
				continue
			}
			if (chipm(0, map(x, y, 0)) == 3) {
				f = 1
				break
			}
		loop
		if (f == 0) {
			repeat 3
				y = cY(cc)
				x = cX(cc) + cnt - 1
				if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
					continue
				}
				if (chipm(0, map(x, y, 0)) == 3) {
					f = 1
					break
				}
			loop
		}
		if (f == 0) {
			msgdup++
			txt -1, lang("釣りをする場所が見当たらない。", "This isn't a good place to fish.")
			gosub *label_0623
			return 0
		}
		if (chipm(0, map(cX(0), cY(0), 0)) == 3) {
			txt -1, lang("水の中からは釣れない。", "You can't fish while swimming.")
			gosub *label_0623
			return 0
		}
		if (cX(0) - x > 0) {
			cDirection(0) = 1
		}
		if (cX(0) - x < 0) {
			cDirection(0) = 2
		}
		if (cY(0) - y > 0) {
			cDirection(0) = 3
		}
		if (cY(0) - y < 0) {
			cDirection(0) = 0
		}
		gdata(35) = cDirection(0)
		fishx = x
		fishy = y
		addefmap fishx, fishy, 1, 3
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, 185) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, 185) / 2 + 1) + sdataref(2, 185) / 2 + 1
		}
		item_separate ci
		nc_intb_101 = ci
		iCount(ci)--
		item_autostack cc, ci
		rowactre = 0
		gosub *label_1378
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 406 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 407 | _switch_sw) {
		_switch_sw = 0
		if (efstatus <= (-1)) {
			if (synccheck(tc, -1)) {
				if (godcheck(tc) == "fuuri") {
					txt -1, lang(name(tc) + "は呪いの神の寵愛を感じた。", name(tc) + " feel" + _s(tc) + " the favor from God of curse.")
				} else {
					txt -1, lang(name(tc) + "は悪魔が笑う声を聞いた。", name(tc) + " hear" + _s(tc) + " devils laugh.")
				}
			}
			goto *label_1407
		}
		gosub *label_1798
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1120 | _switch_sw) {
		_switch_sw = 0
		txtef 5
		txt -1, lang(name(tc) + "は黄金の輝きに包まれた！", "A golden aura wraps " + name(tc) + "!")
		gosub *label_1412
		animeid = 5
		gosub *label_0630
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1117 | _switch_sw) {
		_switch_sw = 0
		if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		snd 24
		txt -1, lang("たくさんの素材が降ってきた！", "Some materials fall from above!")
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 0 & gettrait(0, 190) == 0 & oom_material == 1 | cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
			oom_material = 0
		}
		repeat rnd(3) + 3 + (efstatus >= 1) * 6
			olist = 13, 14, 15, 16
			atxspot = olist(rnd(4))
			if (efstatus >= 0) {
				p = random_material(atxspot, 10 + (efstatus * 10))
			} else {
				olist = 0, 1, 10, 11, 20, 21, 30, 31
				p = olist(rnd(8))
			}
			matgetmain p, 1
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 632 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 454 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 1144 | _switch_sw) {
		_switch_sw = 0
		if (tc != 0) {
			goto *label_1408
		}
		if (efid == 632) {
			ctalk cc, 427, cc, tc
			txt -1, lang(name(cc) + "は" + name(tc) + "を気の狂いそうな眼差しで見た。", name(cc) + " cast" + _s(cc) + " an insane glance on " + name(tc) + ".")
			if (rnd(3)) {
				goto *label_1410
			}
		}
		if (tc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		if (findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1) {
			if (encfind(tc, 33) != (-1)) {
				if (rnd(5)) {
					txt -1, lang("あなたは変異を受け付けなかった。", "You resist the threat of mutation.")
					goto *label_1410
				}
			}
		}
*label_1405
		f = 0
		p = 1
		if (efid == 1144) {
			p = 2 + rnd(3)
		}
		repeat p
			repeat 100
				tid = rnd(46)
				traitmode = 0
				r1 = 0
				gosub *label_0097
				if (stat == 0 | traitref != 1) {
					continue
				}
				if (rnd(2)) {
					p = 1
				} else {
					p = -1
				}
				if (gettrait(0, tid) >= traitref(2)) {
					p = -1
				}
				if (gettrait(0, tid) <= traitref(1)) {
					p = 1
				}
				if (efstatus <= (-1)) {
					if (p == 1) {
						continue
					}
				} else {
					if (p == (-1)) {
						if (efstatus >= 1) {
							if (rnd(3) == 0) {
								continue
							}
						}
						if (efid == 1144) {
							continue
						}
					}
				}
				addtrait 0, tid, p
				txt -1, lang("あなたは変容した！ ", "You mutate.")
				if (efid == 632) {
					ctalk cc, 428, cc, tc
				}
				if (p > 0) {
					txtef 2
					txt -1, traitrefn(0)
					throwsstpevent "Mutation", 0, traitrefn(0), p
				} else {
					txtef 3
					txt -1, traitrefn(1)
					throwsstpevent "Mutation", 0, traitrefn(1), p
				}
				animeload 8, 0
				f = 1
				break
			loop
		loop
		if (f == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		r1 = 0
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1121 | _switch_sw) {
		_switch_sw = 0
		if (tc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		if (efstatus <= (-1)) {
			if (synccheck(tc, -1)) {
				txt -1, lang("これは呪われている！", "It's cursed!")
			}
			goto *label_1405
		}
		olistmax = 0
		repeat 222
			if (gettrait(0, cnt) == 0) {
				continue
			}
			if (efstatus >= 1 & gettrait(0, cnt) > 0) {
				continue
			}
			olist(olistmax) = cnt
			olistmax++
		loop
		f = 0
		if (olistmax > 0) {
			repeat 1 + (efstatus >= 0) + rnd(2)
				repeat 100
					tid = olist(rnd(olistmax))
					if (gettrait(0, tid) == 0) {
						continue
					}
					traitmode = 0
					r1 = 0
					gosub *label_0097
					if (stat == 0 | traitref != 1) {
						continue
					}
					if (gettrait(0, tid) > 0) {
						p = -1
					}
					if (gettrait(0, tid) < 0) {
						p = 1
					}
					settrait 0, tid, 0
					txt -1, lang("あなたは元の自分に近づいた気がした。", "You are now one step closer to yourself.")
					if (p > 0) {
						txtef 2
						txt -1, traitrefn(0)
						throwsstpevent "MutationCured", tc, traitrefn(0), p
					} else {
						txtef 3
						txt -1, traitrefn(1)
						throwsstpevent "MutationCured", tc, traitrefn(1), p
					}
					f = 1
					break
				loop
			loop
		}
		if (f == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		r1 = 0
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 411 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		invsubroutine = 1
		invctrl = 13
		snd 100
		gosub *label_1280
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 461 | _switch_sw) {
		_switch_sw = 0
		if (mapType == 1) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		if (efstatus <= (-1)) {
			txt -1, lang("冥界から死霊が呼び出された！", "Hoards of undead raise from the hell!")
			repeat 4 + rnd(4)
				flt calcobjlv(difficulty()), calcfixlv(3)
				fltn "undead"
				characreate -1, 0, cX(0), cY(0)
			loop
			obvious = 0
			goto *label_1410
		}
		allyctrl = 2
		gosub *label_1187
		if (stat == (-1)) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		if (bonus < rnd(100)) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "の力は冥界に及ばなかった。", name(cc) + your(cc) + " prayer doesn't reach the underworld.")
			}
			goto *label_1410
		}
		rc = stat
		gosub *label_0738
		cxinit = cX(cc)
		cyinit = cY(cc)
		place_chara rc, cxinit, cyinit
		cCurrentMap(rc) = 0
		txtef 5
		txt -1, cnven(cdatan(0, rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
		ctalk rc, 1263, rc, cc
		if ( stat == 0 ) {
			txt rc, lang("「ありがとう！」", cnvtalk("Thanks!"))
		}
		animeid = 19
		animode = 100 + rc
		gosub *label_0630
		snd 120
		cEmotionIcon(rc) = 17 + 100 * 3
		if (cc == 0) {
			modimp rc, 15
			if (rc >= 16 & cRole(rc) != 10001 & cRole(rc) != 10018 & eqfaction(rc, "petshop") == 0) {
				modkarma 0, 2
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 412 | _switch_sw) {
		_switch_sw = 0
		if (efstatus >= 1) {
			if (synccheck(tc, -1)) {
				txt -1, lang(name(tc) + "は聖なる光に包み込まれた。", name(tc) + " " + is(tc) + " surrounded by a holy aura.")
			}
		} else {
			if (efstatus <= (-1)) {
				if (synccheck(tc, -1)) {
					if (godcheck(tc) == "fuuri") {
						txt -1, lang(name(tc) + "は呪いの神の寵愛を感じた。", name(tc) + " feel" + _s(tc) + " the favor from God of curse.")
					} else {
						txt -1, lang(name(tc) + "は悪魔が笑う声を聞いた。", name(tc) + " hear" + _s(tc) + " devils laugh.")
					}
				}
				goto *label_1407
			}
		}
		gosub *label_1797
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 413 | _switch_sw) {
		_switch_sw = 0
		if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		if (efstatus <= (-1)) {
			artifactlocation = ""
			txt -1, lang("何かがあなたの耳元でささやいたが、あなたは聞き取ることができなかった。", "You hear a sepulchral whisper but the voice is too small to distinguish a word.")
			goto *label_1410
		}
		if (tc == 0) {
			if (artifactlocation == "") {
				txt -1, lang("まだ特殊なアイテムは生成されていない。", "No artifacts have been generated yet.")
			} else {
				notesel artifactlocation
				repeat noteinfo(0)
					noteget s, 0
					txt -1, cnven(s)
					notedel 0
				loop
			}
		}
		if (efp > 0) {
			healmp cc, 150 + (efp / 5)
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は何かに見守られている感じがした。", name(cc) + " feel as someone is watching you intently.")
				txt -1, lang(name(cc) + "のマナが回復した。", name(cc) + your(cc) + " mana is restored.")
				animeid = 5
				gosub *label_0630
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1000 | _switch_sw) {
			_switch_sw = 0
			if (cc == 0) {
				tc = 0
				txt -1, lang("どの方向？", "Which direction?")
				gosub *label_0623
				gosub *label_1350
				if (stat == 0) {
					iCount(ci) += 1
					return 0
				}
				if (map(tlocx, tlocy, 1) == 0) {
					noeffect = 1
					obvious = 0
					return 1
				}
				tc = map(tlocx, tlocy, 1) - 1
			} else {
				if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) > sdataref(3, efid) \ 1000 + 1) {
					iCount(ci) += 1
					return 0
				}
				tlocx = cX(tc)
				tlocy = cY(tc)
			}
			if (synccheck(tc, -1)) {
				txt -1, lang(name(tc) + "は不気味な光に包み込まれた。", name(tc) + " " + is(tc) + " surrounded by a black aura.")
			}
			gosub *label_2061
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == 1104 | _switch_sw) {
		_switch_sw = 0
		if (tc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		f = 0
		repeat 1 + (efstatus >= 1)
			cnt2 = cnt
			repeat 2000
				await
				p = rnd(467 - 400) + 400
				if (p == 441) {
					if (rnd(10)) {
						continue
					}
				}
				if (p == 409 | p == 425 | p == 437 | p == 439 | p == 440 | p == 461 | p == 465 | p == 466) {
				} else {
					if (rnd(2)) {
						continue
					}
				}
				if (efstatus >= 0) {
					if (sdataref(0, p) != 0) {
						if (cnt2 == 0) {
							s = lang("突然、", "Suddenly, ")
						} else {
							s = lang("さらに、", "Furthermore, ")
						}
						skillgain 0, p, 1, 100 * 2
						txtef 2
						txt -1, lang(s + name(0) + "は" + skillname(p) + "の魔法の知識を得た。", s + "you gain knowledge of a spell, " + skillname(p) + ".")
						snd 24
						f = 1
						break
					}
				} else {
					p = p - 400
					if (spell(p) > 0) {
						spell(p) = 0
						txt -1, lang("これは呪われている！", "It's cursed!")
						txtef 3
						txt -1, lang("突然、" + name(0) + "は" + skillname(p + 400) + "の魔法の知識を失った。", "Suddenly, you lose knowledge of a spell, " + skillname(p + 400) + ".")
						snd 117
						animeload 14, 0
						f = 1
						break
					}
				}
			loop
		loop
		if (f == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1143 | _switch_sw) {
		_switch_sw = 0
		if (efstatus <= 0) {
			if (cLevel(tc) <= 1) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				obvious = 0
				goto *label_1410
			}
			repeat iEnhancement(ci) + 1
				if (cLevel(tc) <= 1) {
					break
				}
				cLevel(tc)--
				cExperience(tc) = 0
				r1 = tc
				gosub *label_0663
			loop
			txtef 8
			txt -1, lang(name(tc) + "のレベルが下がった…", name(tc) + " lose" + _s(tc) + " a level...")
		} else {
			repeat iEnhancement(ci) + 1
				cExperience(tc) = cRequiredExperience(tc)
				r1 = tc
				r2 = 0
				gosub *label_0661
			loop
			if (synccheck(tc, -1)) {
				snd 60
			}
		}
		if (efstatus <= (-1)) {
			txt -1, lang("これは呪われている！", "It's cursed!")
			repeat 50 - 10, 10
				if (rnd(3) == 0) {
					if (cnt <= 17) {
						if (sdata(cnt, tc) != 0) {
							skillexp2 cnt, tc, -1000
						}
					}
				}
			loop
			animeload 8, tc
		}
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	// ランダムポーション
	if (_switch_val == 1150 | _switch_sw) {
		_switch_sw = 0
		rndcnt = 0
		nc_intb_100 = iValue(ci)
		repeat
			if (rndcnt == 3) {
				break
			}
			rndcnt += 1
			if (rndcnt == 1) {
				rndeffect = iParam1(ci) / 10000
				rndturn   = iParam1(ci) \ 10000
			}
			if (rndcnt == 2) {
				rndeffect = iParam2(ci) / 10000
				rndturn   = iParam2(ci) \ 10000
			}
			if (rndcnt == 3) {
				rndeffect = iParam3(ci) / 10000
				rndturn   = iParam3(ci) \ 10000
			}
			// dialog "eff:" + rndeffect + " " + "turn:" + rndturn
			randomize iParam1(ci) + iParam2(ci) + iParam3(ci) + rndcnt
			lint_efp = ((rnd(500) + 1) * 10) + (100 * (iEnhancement(ci) * (iEnhancement(ci) / 3 + 1) + 1))
			efp = limitmax(lint_efp, INT_MAX)
			if (rndeffect < 5) {
				continue
			}
			if (rndeffect == 5) {
				if (synccheck(tc, -1)) {
					ctalk tc, 1337, tc, tc
					if (stat == 0) {
						if (tc == 0) {
							txt -1, lang("*ごくっ* 綺麗な水だ。", "*quaff* The water is refreshing.")
						} else {
							txt -1, lang(" *ごくっ* ", "*quaff*")
						}
					}
					sickifcursed efstatus, tc, 1
				}
				continue
			} elseif(rndeffect == 6) {
				if (synccheck(tc, -1)) {
					if (efstatus <= (-1)) {
						ctalk tc, 431, tc, tc
						if (stat == 0) {
							ctalk tc, 1212, tc, tc
							if (stat == 0) {
								txtef 9
								txt tc, lang("「うぃっ…」", "*Hic*"), lang("「まずいぜ」", cnvtalk("Ah, bad booze.")), lang("「げー♪」", cnvtalk("Ugh...")), lang("「腐ったミルクみたいな味だ」", cnvtalk("Bah, smells like rotten milk."))
							}
						}
					} else {
						ctalk tc, 432, tc, tc
						if (stat == 0) {
							ctalk tc, 1211, tc, tc
							if (stat == 0) {
								txtef 9
								txt tc, lang("「うぃっ！」", "*Hic*"), lang("「うまいぜ」", cnvtalk("Ah, good booze.")), lang("「らららー♪」", cnvtalk("La-la-la-la.")), lang("「ひっく」", cnvtalk("I'm going to heaven.")), lang("「ふぅ」", cnvtalk("Whew!")), lang("「たまらないわ」", cnvtalk("I'm revived!")), lang("「んまっ♪」", cnvtalk("Awesome."))
							}
						}
					}
				}
				if (trophycheck(15) == 2) {
					dmgcon tc, 8, efp
				} else {
					dmgcon tc, 8, efp
				}
				continue
			} elseif (rndeffect == 7) {
				efid = 402
				gosub *label_1391
			} elseif (rndeffect == 8) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "はひどい頭痛におそわれた！", "A foul stench floods " + name(tc) + your(tc) + " nostrils!")
				}
				dmgcon tc, 5, efp
				continue
			} elseif (rndeffect == 9) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "は痺れた！", name(tc) + " get" + _s(tc) + " numbness!")
				}
				dmgcon tc, 3, efp
				continue
			} elseif (rndeffect == 10) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "は墨を浴びた！", "Ink squirts into " + name(tc) + your(tc) + " face!")
				}
				dmgcon tc, 4, efp
				continue
			} elseif (rndeffect == 11) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "は甘い液体を浴びた！", "Strange sweet liquid splashes onto " + name(tc) + "!")
				}
				dmgcon tc, 2, efp
				continue
			} elseif (rndeffect == 12) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "は毒を浴びた！", name(tc) + " " + is(tc) + " hit by poison!")
				}
				if (cbit(978, tc)) {
					cbitmod 978, tc, 0
					if (ocdata(52, tc) == 330) {
						if (synccheck(tc, -1)) {
							txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
							txtef 9
							ctalk tc, 970, tc, tc
						}
					} else {
						if (synccheck(tc, -1)) {
							txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
							txtef 9
							ctalk tc, 970, tc, tc
						}
					}
					ocdata(52, tc) = 0
					ocdata(53, tc) = 0
				}
				dmgcon tc, 1, efp
				continue
			} elseif (rndeffect == 13) {
				if (synccheck(tc, -1)) {
					if (efstatus <= (-1)) {
						snd 117
						txt -1, lang(name(tc) + "の肉体は蝕まれた。", name(tc) + your(tc) + " body is damaged.")
					} else {
						txt -1, lang(name(tc) + "の肉体は復活した。", name(tc) + your(tc) + " body is restored.")
						animeload 10, tc
					}
					if (efstatus >= 1) {
						txt -1, lang("さらに、" + name(tc) + "の肉体は強化された。", "In addition, " + his(tc) + " body is enchanted.")
						animeload 10, tc
					}
				}
				p = 10, 11, 12, 17, 18, -1
				repeat
					if (p(cnt) == (-1)) {
						break
					}
					i = p(cnt) + 240 - 10
					if (efstatus <= (-1)) {
						if (cQuality(tc) <= 3) {
							cdata(i, tc) -= rnd(sorgEx(p(cnt), tc)) / 5 + rnd(5)
							continue
						}
					}
					if (cdata(i, tc) < 0) {
						cdata(i, tc) = 0
					}
					if (efstatus >= 1) {
						cdata(i, tc) = sorgEx(p(cnt), tc) / 10 + 5
					}
				loop
				continue
			} elseif (rndeffect == 14) {
					if (synccheck(tc, -1)) {
						if (efstatus <= (-1)) {
							snd 117
							txt -1, lang(name(tc) + "の精神は蝕まれた。", name(tc) + your(tc) + " spirit is damaged.")
						} else {
							txt -1, lang(name(tc) + "の精神は復活した。", name(tc) + your(tc) + " spirit is restored.")
							animeload 10, tc
						}
						if (efstatus >= 1) {
							txt -1, lang("さらに、" + name(tc) + "の精神は強化された。", "In addition, " + his(tc) + " spirit is enchanted.")
							animeload 10, tc
						}
					}
					p = 14, 13, 16, 15, 19, -1
					repeat
						if (p(cnt) == (-1)) {
							break
						}
						i = p(cnt) + 240 - 10
						if (efstatus <= (-1)) {
							if (cQuality(tc) <= 3) {
								cdata(i, tc) -= rnd(sorgEx(p(cnt), tc)) / 5 + rnd(5)
								continue
							}
						}
						if (cdata(i, tc) < 0) {
							cdata(i, tc) = 0
						}
						if (efstatus >= 1) {
							cdata(i, tc) = sorgEx(p(cnt), tc) / 10 + 5
						}
					loop
					continue
			} elseif(rndeffect == 15) {
				if (efstatus >= 1) {
					repeat 18 - 10, 10
						modgrowth2 tc, cnt, rnd(efp / 200 + 3) + 1
					loop
					txt -1, lang(name(tc) + "の全ての能力の潜在能力が上昇した。", name(tc) + your(tc) + " potential of every attribute expands.")
					animeid = 19
					animode = 100 + tc
					gosub *label_0630
					snd 61
				} else {
					i = rnd(18 - 10) + 10
					valn = skillname(i)
					if (efstatus == 0) {
						txt -1, lang(name(tc) + "の" + valn + "の潜在能力が上昇した。", name(tc) + your(tc) + " potential of " + valn + " expands.")
						modgrowth2 tc, i, rnd(efp / 200 + 3) + 1
						snd 24
					} else {
						txt -1, lang(name(tc) + "の" + valn + "の潜在能力が減少した。", name(tc) + your(tc) + " potential of " + valn + " decreases.")
						modgrowth2 tc, i, (rnd(efp / 200 + 3) + 1) * (-1)
						snd 117
					}
				}
				autosave = 1 * (gCurrentMap != 35)
				if (cfg_noautosave > 0 & gettrait(0, 190) == 0 & cc != 0 | cfg_noautosave > 2 & gettrait(0, 190) == 0) {
					autosave = 0
				}
				continue
			} elseif(rndeffect == 16) {
				efid = 442
				gosub *label_1391
				continue
			} elseif(rndeffect == 17) {
				efid = 444
				gosub *label_1391
				continue
			} elseif(rndeffect == 18) {
				efid = 445
				gosub *label_1391
				continue
			} elseif(rndeffect == 19) {
				efid = 446
				gosub *label_1391
				continue
			} elseif(rndeffect == 20) {
				efid = 448
				gosub *label_1391
				continue
			} elseif(rndeffect == 21) {
				efid = 447
				gosub *label_1391
				continue
			} elseif(rndeffect == 22) {
				efid = 449
				gosub *label_1391
				continue
			} elseif(rndeffect == 23) {
				efid = 443
				gosub *label_1391
				continue
			} elseif(rndeffect == 24) {
				f = 0
				repeat 10
					p = rnd(61 - 50) + 50
					if (sorg(p, tc) >= 150) {
						f++
						resistmod tc, p, 50 * (-1)
						if (f >= efp / 100) {
							break
						}
					}
				loop
				if (f == 0) {
					txt -1, lang("何も起こらなかったようだ。", "Nothing happens.")
					obvious = 0
				} else {
					snd 38
				}
				continue
			} elseif(rndeffect == 25) {
				if (synccheck(tc, -1)) {
					if (tc == 0) {
						txt -1, lang("ぐわぁぁ！", "Arrrrg!")
					}
					txt -1, lang("酸が" + name(tc) + "を溶かした。", "The sulfuric acid melts " + name(tc) + ".")
				}
				if (cbit(978, tc)) {
					cbitmod 978, tc, 0
					if (ocdata(52, tc) == 330) {
						if (synccheck(tc, -1)) {
							txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
							txtef 9
							ctalk tc, 970, tc, tc
						}
					} else {
						if (synccheck(tc, -1)) {
							txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
							txtef 9
							ctalk tc, 970, tc, tc
						}
					}
					ocdata(52, tc) = 0
					ocdata(53, tc) = 0
				}
				dmghp tc, efp * efstatusfix(500, 400, 100, 50) / 1000, -15, 63, efp
				continue
			} elseif(rndeffect == 26) {
				if (synccheck(tc, -1)) {
					if (tc == 0) {
						txt -1, lang("ぐわぁぁ！", "Arrrrg!")
					}
					txt -1, lang("薬が" + name(tc) + "の胃の中で爆発した。", "The sulfuric acid melts " + name(tc) + ".")
				}
				aniref = 0
				animeid = 2
				anix = cX(tc)
				aniy = cY(tc)
				dmghp tc, efp * 10, tc, 658
				continue
			} elseif(rndeffect == 27) {
				efp = limit(efp / 100, 50, 2000)
				if (tc != 0) {
					if (cId(tc) == 222 & cRelationship(tc) == 10 & cImage(tc) != 360) {
						txt -1, lang(name(tc) + "の顔が変異した！", name(tc) + "'s face mutates!")
						animeload 8, tc
						cImage(tc) = 360
						cPortrait(tc) = -1
					}
					if (cId(tc) == 250 & cRelationship(tc) == 10 & cImage(tc) != 500) {
						txt -1, lang(name(tc) + "の姿が変異した！", name(tc) + "'s skin mutates!")
						animeload 8, tc
						if (gCurrentMap == 59) {
							cImage(tc) = 455
						} else {
							cImage(tc) = 500
						}
						cPortrait(tc) = -1
						goto *label_1410
					}
					txt -1, lang("何もおきない… ", "Nothing happens...")
				}
				snd 64
				if (efstatus >= 0) {
					txtef 2
					txt -1, lang("エーテルの抗体があなたの体内に行き渡った。", "Your Ether Disease is cured greatly.")
					modcorrupt efp * (-10)
				} else {
					txtef 8
					txt -1, lang("エーテルの病菌があなたの体内に行き渡った。", " The Ether Disease spreads around your body.")
					modcorrupt 200
				}
				continue
			} elseif(rndeffect == 28) {
				if (efstatus <= (-1)) {
					if (tc == 0) {
						eatstatus efstatus, tc
					} else {
						txt -1, lang("媚薬は呪われていた。" + name(tc) + "は" + name(0) + "を軽蔑のまなざしで見つめた。", "This love potion is cursed. " + name(tc) + " look" + _s(tc) + " at " + name(0) + " with a contemptuous glance.")
						modimp tc, -15
					}
					healcon tc, 13, efp * 5
					obvious = 0
					continue
				}
				cEmotionIcon(tc) = 17 + 100 * 3
				if (potionspill | potionthrow) {
					if (godcheck(0) == "dorein") {
						efp *= 2
					}
					txt -1, lang(name(tc) + "は恋の予感がした。", name(tc) + " sense" + _s(tc) + " a sigh of love,")
					modimp tc, efp / 15
					dmgcon tc, 7, 100
					dmgcon tc, 13, efp
					f = 0
					repeat limitmin(efp / 100, 1)
						lovemiracle tc
					loop
					f = 0
					if (tc != 0) {
						if (ccthrowpotion == 0) {
							if (efp > 100) {
								modkarma 0, limit(efp / 100 * (-1), -20, 0)
							}
						}
					}
					goto *label_1410
				}
				if (tc == 0) {
					txt -1, lang(name(tc) + "は興奮した！", "You are excited!")
				} else {
					txt -1, lang(name(tc) + "は" + name(0) + "を熱いまなざしで見つめた。", name(tc) + " give" + _s(tc) + " " + name(0) + " the eye.")
				}
				f = 0
				repeat limitmin(efp / 100, 1)
					lovemiracle tc
				loop
				f = 0
				modimp tc, efp / 4
				dmgcon tc, 7, 500
				dmgcon tc, 13, efp * 2
				continue
			} elseif(rndeffect == 29) {
				txt -1, lang(name(tc) + "の血は沸きあがるように熱くなった。", name(tc) + your(tc) + " blood burns and a new strength fills " + his(tc) + " body!")
				skillexp2 18, tc, efstatusfix((-1) * (efp * 4), (-1) * (efp * 2), efp * 2, efp * 4)
				if (efstatus == 1) {
					modgrowth2 tc, 18, efp / 100
					txtef 2
					txt -1, lang("あつつ！", "It really burns!")
				}
				continue
			} elseif(rndeffect == 30) {
				if (efstatus <= 0) {
					if (cLevel(tc) <= 1) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						obvious = 0
						continue
					}
					repeat iEnhancement(ci) + 1
						if (cLevel(tc) <= 1) {
							break
						}
						cLevel(tc)--
						cExperience(tc) = 0
						r1 = tc
						gosub *label_0663
					loop
					txtef 8
					txt -1, lang(name(tc) + "のレベルが下がった…", name(tc) + " lose" + _s(tc) + " a level...")
				} else {
					cExperience(tc) = cRequiredExperience(tc)
					r1 = tc
					r2 = 0
					gosub *label_0661
					if (synccheck(tc, -1)) {
						snd 60
					}
				}
				if (efstatus <= (-1)) {
					txt -1, lang("これは呪われている！", "It's cursed!")
					repeat 50 - 10, 10
						if (rnd(3) == 0) {
							if (cnt <= 17) {
								if (sdata(cnt, tc) != 0) {
									skillexp2 cnt, tc, -1000
								}
							}
						}
					loop
					animeload 8, tc
				}
				continue
			} elseif(rndeffect == 31) {
				if (synccheck(tc, -1)) {
					txt -1, lang("*シュワワ*", "*quaff*")
					ctalk tc, 1339, tc, tc
					if (stat == 0) {
						txt -1, lang("刺激的！", "Juicy!")
					}
					txt -1, lang(name(tc) + "のスタミナが少し回復した。", name(tc) + " restore" + _s(tc) + " some stamina.")
				}
				healsp tc, efp / 4
				sickifcursed efstatus, tc, 1
				if (showdamagecheck(efp / 4)) {
					if (synccheck(tc, -1)) {
						mondmgn(mondmgcnt) = "*" + (efp / 4) + "*"
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
						ccolor 110
						if (stat == 0) {
							mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
				continue
			} elseif(rndeffect == 32) {
				addbuff tc, 18, efp / 2, efp / 100 + 10
				continue
			} elseif(rndeffect == 33) {
				addbuff tc, 62, efp / 2, efp / 100 + 10
				continue
			} elseif(rndeffect == 34) {
				addbuff tc, 63, efp / 2, efp / 100 + 10
				continue
			} elseif(rndeffect == 35) {
				addbuff tc, 16, efp / 2, 20
				continue
			} elseif(rndeffect == 36) {
				bfcc = cc
				cc = tc
				throwsstpevent "Mewmewmew", cc, "", 0
				txtef 4
				txt -1, lang("うみみゃぁ！", "Mewmewmew!")
				animeid = 19
				animode = 0
				nodropbodyparts = 1
				gosub *label_0630
				repeat 245
					if (cState(cc) != 1) {
						continue
					}
					if (cState(cnt) != 1) {
						continue
					}
					if (cc == cnt) {
						continue
					}
					tc = cnt
					if (nc_intb_100 < 25000) {
						dmghp tc, efp * 2, cc
					} else {
						dmghp tc, efp * 5, cc
					}
				loop
				tc = cc
				cc = bfcc
				continue
			} elseif(rndeffect == 37) {
				txt cc, lang("「余分な機能は削除してしまえ」", cnvtalk("Delete."))
				if (eqfaction(tc, "overwish")) {
						txt -1, lang("しかし、効果はなかった。", "But it produces no effect.")
						continue
				}
				if (nc_intb_100 < 25000) {
					cHp(tc) = cMaxHp(tc) / 2 + 1
				} else {
					cHp(tc) = cMaxHp(tc) / 12 + 1
				}
				continue
			} elseif(rndeffect == 38) {
				animeload 10, tc
				snd 64
				message@st = ""
				repeat limit(4 + rnd(efp / 50 + 1), 1, 15)
					flt calcobjlv(efp / 10), calcfixlv(3)
					dbid = 0
					dbid = 54
					p = 400 + rndex2(limit(efp, 1, 2000000))
					if (rnd(30) == 0) {
						dbid = 55
						p = 1
					}
					if (rnd(80) == 0) {
						dbid = 622
						p = 1
					}
					if (nc_intb_100 < 50000) {
						if (rnd(2000) == 0) {
							dbid = 290
							p = 1
						}
					}
					nostack = 1
					itemcreate -1, dbid, cX(tc), cY(tc), p
					message@st += lang(itemname(ci) + "が降ってきた！", itemname(ci) + " fall" + _s2(iNumber(ci)) + " down!")
					if (cfg_animewait > 0) {
						txt -1, message@st
						redraw 1
						message@st = ""
					}
					item_stack -1, ci
				loop
				continue
			} elseif(rndeffect == 39) {
				if (nc_intb_100 < 50000) {
					txtef 5
					txt -1, lang("ものすごい幸運が訪れた…ような気がしたが気のせいだった。", "You feel as a stroke of good fortune passed by.")
					continue
				}
				gWishCount++
				efid = 441
				gosub *label_1398
				continue
			} elseif(rndeffect == 40) {
				healmp tc, efp / 2 + rnd(efp / 2 + 1)
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "のマナが回復した。", name(tc) + your(tc) + " mana is restored.")
					animeid = 5
					gosub *label_0630
				}
				continue
			} elseif(rndeffect == 41) {
				txt -1, lang("瓶から何かが出てきた！", "Something comes out from the well!")
				repeat 1 + rnd(3)
					flt calcobjlv(cLevel(tc) * 3 / 2 + 3), calcfixlv(2)
					characreate -1, 0, cX(tc), cY(tc)
				loop
				continue
			} elseif(rndeffect == 42) {
				txt -1, lang("瓶から何かが大量に出てきた！", "Something many comes out from the well!")
				repeat 10 + rnd(3)
					flt calcobjlv(cLevel(tc) * 3), calcfixlv(2)
					characreate -1, 0, cX(tc), cY(tc)
				loop
				continue
			} elseif(rndeffect == 43) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "は瓶の破片で傷ついた！", "Strange sweet liquid splashes onto " + name(tc) + "!")
				}
				dmgcon tc, 9, efp / 2
				continue
			} elseif(rndeffect == 44) {
				if (mapType != 1) {
					gWeather = 1
					if (gMonth \ 3 != 0 & gLastEtherwindMonth != gMonth) {
						gLastEtherwindMonth = gMonth
					}
					envonly = 1
					gosub *label_0122
					txt -1, lang("終末の日が訪れた。", "Let's Ragnarok!")
					if (oomSEST_noAnimation == 0) {
						msg_halt
					}
					animeid = 21
					gosub *label_0630
					repeat 200
						repeat 2
							x = rnd(mapWidth)
							y = rnd(mapHeight)
							map(x, y, 0) = 37
						loop
						x = rnd(inf_screenw) + scx
						y = rnd(inf_screenh) + scy
						if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight | rnd(5) == 0) {
							x = rnd(mapWidth)
							y = rnd(mapHeight)
						}
						addmef x, y, 5, 24, rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
						mapitem_fire x, y
						if (cnt \ 4 == 0) {
							flt 100, calcfixlv(3)
							if (rnd(4)) {
								fltnrace = "dragon"
							} else {
								fltnrace = "giant"
							}
							characreate -1, 0, x, y
							if (stat != 0) {
								cbitmod 964, rc, 1
							}
						}
						if (cnt \ 7 == 0) {
							if (oomSEST_noAnimation == 0) {
								gosub *label_0623
							}
							if (rnd(7)) {
								snd 6
							} else {
								snd 45
							}
							if (oomSEST_noAnimation == 0) {
								await 25
							}
						}
					loop
				}
				continue
			} elseif(rndeffect == 45) {
				f = 0
				p = 2 + rnd(3)
				repeat p
					repeat 100
						tid = rnd(46)
						traitmode = 0
						r1 = 0
						gosub *label_0097
						if (stat == 0 | traitref != 1) {
							continue
						}
						if (rnd(2)) {
							p = 1
						} else {
							p = -1
						}
						if (gettrait(0, tid) >= traitref(2)) {
							p = -1
						}
						if (gettrait(0, tid) <= traitref(1)) {
							p = 1
						}
						if (efstatus <= (-1)) {
							if (p == 1) {
								continue
							}
						} else {
							if (p == (-1)) {
								if (efstatus >= 1) {
									if (rnd(3) == 0) {
										continue
									}
								}
									continue
							}
						}
						addtrait 0, tid, p
						txt -1, lang("あなたは変容した！ ", "You mutate.")
						if (p > 0) {
							txtef 2
							txt -1, traitrefn(0)
						} else {
							txtef 3
							txt -1, traitrefn(1)
						}
						animeload 8, 0
						f = 1
						break
					loop
				loop
				if (f == 0) {
					txt -1, lang("何もおきない… ", "Nothing happens...")
					obvious = 0
				}
				r1 = 0
				continue
			} elseif(rndeffect == 46) {
				efid = 404
				gosub *label_1393
				continue
			} elseif(rndeffect == 47) {
				bfcc = cc
				cc = tc
				efid = 460
				gosub *label_1393
				tc = cc
				cc = bfcc
				continue
			} elseif(rndeffect == 48) {
				bfcc = cc
				cc = tc
				efid = 465
				gosub *label_1393
				tc = cc
				cc = bfcc
				continue
			} elseif(rndeffect == 49) {
				addbuff tc, 10, efp / 2, efp / 100 + 10
				continue
			} elseif(rndeffect == 50) {
				efid = 456
				gosub *label_1393
				continue
			}
		loop
		r1 = tc
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1151 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		invsubroutine = 1
		invctrl = 23, 0
		snd 100
		cibk = ci
		gosub *label_1280
		if (iQuality(ci) < 4 | iQuality(ci) == 6) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			obvious = 0
			goto *label_1410
		}
		if (iCurseState(cibk) == 1 & iNumber(cibk) > 0) {
			snd 24
			txt -1, lang(itemname(ci) + "は強い銀色の光に包まれた。", itemname(ci) + " " + is2(iNumber(ci)) + " surrounded by a silver aura.")
			if (iHitBonus(ci) < 999) {
				iHitBonus(ci)++
			}
			if (iDamageBonus(ci) < 999) {
				iDamageBonus(ci)++
			}
			if (iDv(ci) < 999) {
				iDv(ci)++
			}
			if (iPv(ci) < 999) {
				iPv(ci)++
			}
			repeat iNumber(cibk)
				if (iHitBonus(ci) < 999) {
					iHitBonus(ci)++
				}
				if (iDamageBonus(ci) < 999) {
					iDamageBonus(ci)++
				}
				if (iDv(ci) < 999) {
					iDv(ci)++
				}
				if (iPv(ci) < 999) {
					iPv(ci)++
				}
			loop
			iNumber(cibk) = 0
		} else {
			snd 24
			txt -1, lang(itemname(ci) + "は銀色の光に包まれた。", itemname(ci) + " " + is2(iNumber(ci)) + " surrounded by a silver aura.")
			if (iHitBonus(ci) < 999) {
				iHitBonus(ci)++
			}
			if (iDamageBonus(ci) < 999) {
				iDamageBonus(ci)++
			}
			if (iDv(ci) < 999) {
				iDv(ci)++
			}
			if (iPv(ci) < 999) {
				iPv(ci)++
			}
		}
		txt -1, lang(itemname(ci) + "に変化した。", itemname(ci) + " " + is2(iNumber(ci)) + "changed.")
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1105 | _switch_sw) {
		_switch_sw = 0
		if (iId(ci) == 243 & ibit(5, ci)) {
			if (tc == 0) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				goto *label_1410
			}
			snd 24
			nc_intb_003 = 0
			repeat 26
				if (horse_getskill(tc, cnt) > 0 & cnt != iParam1(ci)) {
					nc_intb_003++
				}
			loop
			if (nc_intb_003 >= 5) {
				txt -1, lang("あなたの馬はこれ以上新しいスキルを習得できない。", "No more new skills to learn.")
				goto *label_1410
			}
			if (horse_getskill(tc, iParam1(ci)) >= iParam2(ci)) {
				txt -1, lang("このスキルは既に習得している。", "This skill has already been learned.")
			} else {
				if (horse_getskill(tc, iParam1(ci)) > 0) {
					txtef 2
					txt -1, lang("" + name(tc) + "の" + nc_horskilln(iParam1(ci)) + "のレベルがアップした！", name(tc) + " gain" + _s(tc) + " a skill of " + nc_horskilln(iParam1(ci)) + "!")
					rmfaction tc, "horskill" + iParam1(ci) + "," + horse_getskill(nc_intb_002, iParam1(ci))
					addfaction tc, "horskill" + iParam1(ci) + "," + iParam2(ci)
				} else {
					txtef 2
					txt -1, lang("" + name(tc) + "は" + nc_horskilln(iParam1(ci)) + "の技術を会得した！", name(tc) + " gain" + _s(tc) + " a skill of " + nc_horskilln(iParam1(ci)) + "!")
					addfaction tc, "horskill" + iParam1(ci) + "," + iParam2(ci)
				}
			}
			goto *label_1410
		}
		promptmax = 0
		repeat
			await
			p = rnd(400 - 100) + 100
			if (sdataref(0, p) != 0) {
				if (efstatus >= 0) {
					if (cnt < efstatusfix(0, 0, 100, 2000)) {
						if (sdata(p, tc) != 0) {
							continue
						}
					}
					promptl(0, promptmax) = skillname(p), "null", "" + p
					promptmax++
					if (promptmax >= 4) {
						break
					}
				} else {
					if (sdata(p, tc) == 0) {
						continue
					}
					if (synccheck(tc, -1)) {
						snd 38
						txt -1, lang("これは呪われている！", "It's cursed!")
					}
					skillexp2 p, tc, -1000
					break
				}
			}
		loop
		if (efstatus >= 0) {
			txt -1, lang("どの技術を獲得する？", "Learn which skill?")
			val = promptx, prompty, 220, 1
			gosub *label_1353
			if (rtval == (-1)) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
			} else {
				skillgain tc, rtval, 1
				if (synccheck(tc, -1)) {
					snd 24
					txtef 2
					txt -1, lang("" + name(tc) + "は" + skillname(rtval) + "の技術を獲得した！", name(tc) + " gain" + _s(tc) + " a skill of " + skillname(rtval) + "!")
				}
			}
		}
		r1 = tc
		gosub *chara_refresh
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1107 | _switch_sw) {
		_switch_sw = 0
		if (godcheck(tc) == "eyth") {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		if (efstatus <= (-1)) {
			txt -1, lang("" + godname(godcheck(tc)) + "は" + name(tc) + "の信仰に疑問を抱いた。", name(tc) + your(tc) + " god doubts " + his(tc) + " faith.")
			txtgod godcheck(), 2406
			snd 117
			animeload 14, tc
			skillexp2 181, tc, -1000
			goto *label_1410
		}
		txtef 2
		txt -1, lang("" + name(tc) + "は" + godname(godcheck(tc)) + "の暖かい眼差しを感じた。", name(tc) + " feel" + _s(tc) + " as if " + godname(godcheck(tc)) + " is watching " + him(tc) + ".")
		txtgod godcheck(), 2404
		if (efstatus >= 1) {
			txtef 2
			txt -1, lang("空から三つ葉のクローバーがふってきた。", "A three-leaved falls from the sky.")
			txtgod godcheck(), 2405
		}
		animeid = 19
		animode = 100 + tc
		gosub *label_0630
		snd 120
		cPrayingPoint(tc) += 500
		if (cPrayingPoint(tc) > 2000) {
			cPrayingPoint(tc) = 2000
		}
		modpiety 75, tc
		skillexp2 181, tc, 1000 + (efstatus >= 1) * 750, 6, 1000
		r1 = tc
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1119 | _switch_sw) {
		_switch_sw = 0
		repeat 1 + (efstatus >= 1)
			cnt2 = cnt
			repeat
				await
				p = rnd(400 - 100) + 100
				if (sdataref(0, p) != 0) {
					if (sorg(p, tc) == 0) {
						continue
					}
					modgrowth2 tc, p, efp * efstatusfix(-4, -2, 5, 5) / 100
					if (cnt2 == 0) {
						s = lang("", "The ")
					} else {
						s = lang("さらに", "Furthermore, the ")
					}
					if (efstatus >= 0) {
						if (synccheck(tc, -1)) {
							snd 24
							txtef 2
							txt -1, lang(s + "" + name(tc) + "の" + skillname(p) + "の技術の潜在能力が上昇した。", s + "potential of " + name(tc) + your(tc) + " " + skillname(p) + " skill increases.")
						}
					} else {
						if (synccheck(tc, -1)) {
							snd 117
							txtef 3
							txt -1, lang("" + name(tc) + "の" + skillname(p) + "の技術の潜在能力が減少した。", "The potential of " + name(tc) + your(tc) + " " + skillname(p) + " skill decreases.")
						}
					}
					break
				}
			loop
		loop
		r1 = tc
		gosub *chara_refresh
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1106 | _switch_sw) {
		_switch_sw = 0
		i = rnd(20 - 10) + 10
		skillexp2 i, tc, efstatusfix(-2000, -2000, -1000, -250)
		animeid = 6
		gosub *label_0630
		r1 = tc
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1139 | _switch_sw) {
		_switch_sw = 0
		txt -1, lang(name(tc) + "の血は沸きあがるように熱くなった。", name(tc) + your(tc) + " blood burns and a new strength fills " + his(tc) + " body!")
		repeat iEnhancement(ci) + 1
			skillexp2 18, tc, efstatusfix(-4000, -1000, 8000, 12000)
			if (efstatus == 1) {
				modgrowth2 tc, 18, 15
				txtef 2
				txt -1, lang("あつつ！", "It really burns!")
			}
			r1 = tc
			gosub *chara_refresh
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1113 | _switch_sw) {
		_switch_sw = 0
		oomSEST_log "efPotential:Begin"
		if (efstatus >= 1) {
			repeat 18 - 10, 10
				modgrowth2 tc, cnt, rnd(sgrowth(cnt, tc) / 20 + 3) + 1
			loop
			txt -1, lang(name(tc) + "の全ての能力の潜在能力が上昇した。", name(tc) + your(tc) + " potential of every attribute expands.")
			animeid = 19
			animode = 100 + tc
			gosub *label_0630
			snd 61
		} else {
			i = rnd(18 - 10) + 10
			valn = skillname(i)
			if (efstatus == 0) {
				txt -1, lang(name(tc) + "の" + valn + "の潜在能力が上昇した。", name(tc) + your(tc) + " potential of " + valn + " expands.")
				modgrowth2 tc, i, rnd(sgrowth(i, tc) / 10 + 10) + 1
				snd 24
			} else {
				txt -1, lang(name(tc) + "の" + valn + "の潜在能力が減少した。", name(tc) + your(tc) + " potential of " + valn + " decreases.")
				modgrowth2 tc, i, (rnd(sgrowth(i, tc) / 10 + 10) + 1) * (-1)
				snd 117
			}
		}
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 0 & gettrait(0, 190) == 0 & cc != 0 | cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		oomSEST_log "efPotential:End"
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 653 | _switch_sw) {
		_switch_sw = 0
		if (tc < 57) {
			goto *label_1410
		}
		if (cQuality(tc) >= 4) {
			goto *label_1410
		}
		if (cRole(tc) != 0) {
			goto *label_1410
		}
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (ocbit(8, tc)) {
				goto *label_1410
			}
		}
		txt -1, lang(name(tc) + "は消え去った。", name(tc) + " vanish" + _s(tc, 1) + ".")
		chara_vanquish tc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 430 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 429 | _switch_sw) {
		_switch_sw = 0
		if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		p = 1
		if (efid == 430) {
			p = 2
		}
		repeat p
			repeat mapHeight
				y = cnt
				repeat mapWidth
					x = cnt
					p = dist(cX(tc), cY(tc), x, y)
					if (efstatus <= (-1)) {
						if (efid == 429) {
							map(x, y, 2) = tile_default
						}
						if (efid == 430) {
							map(x, y, 5) = 0
							mapbitmod 0, x, y, 0
						}
						continue
					}
					if (p < 7 | rndex(efp + 1) > rndex(p * 8 + 1) | efstatus >= 1) {
						if (efid == 429) {
							map(x, y, 2) = map(x, y, 0)
						}
						if (efid == 430) {
							if (map(x, y, 6) != 0 | map(x, y, 5) != 0) {
								map(x, y, 2) = map(x, y, 0)
								mapbitmod 0, x, y, 1
							}
						}
					}
				loop
			loop
		loop
		if (efstatus <= (-1)) {
			txt -1, lang("あれ…？あなたは軽い記憶障害を受けた。", "Hmm? You suffer minor memory defect.")
		} else {
			if (efid == 429) {
				txt -1, lang(name(tc) + "は周囲の地形を察知した。", name(tc) + " sense" + _s(tc) + " nearby locations.")
			}
			if (efid == 430) {
				txt -1, lang(name(tc) + "は周囲の物質を感知した。", name(tc) + " sense" + _s(tc) + " nearby objects.")
			}
		}
		animeload 10, tc
		redraw 0
		gosub *label_0622
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 658 | _switch_sw) {
		_switch_sw = 0
		attack_weakGuard // from Decapitation
		if (cHp(tc) > cMaxHp(tc) / 8) {
			goto *label_1410
		}
		if (synccheck(tc, -1)) {
			snd 105
			ctalk cc, 1295, tc, cc
			txtef 3
			txt -1, lang(" *ブシュッ* ", "*Gash*")
			if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
				gdata(809) = 2
				txt3rd = 1
				txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
			} else {
				txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
			}
		}
		dmghp tc, cMaxHp(tc) + 1, cc, 658
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_poundingOut | _switch_sw) {
		_switch_sw = 0
		attack_weakGuard // from Pounding Out
		if (tc == 0) {
			txt -1, lang("あなたは自分の内臓を抜き取ろうと思ったがやめた…", "You try to take bodyparts from yourself.")
			goto *label_1410
		}
		if (ocbit(7, tc)) {
			txt -1, lang("これは幻だ。", "Phantom cannot be taken parts.")
			goto *label_1410
		}
		if (cbit(985, tc)) {
			txt -1, lang("吊るしたままでは内臓を抜き取れない。", "You can't take bodyparts from a hung creature.")
			goto *label_1410
		}
		if (cHp(tc) > cMaxHp(tc) / 8) {
			txt -1, lang("もっと弱らせないと内臓を抜き取れない。", "The target needs to be weakened.")
			goto *label_1410
		}
		txt -1, lang("どの内臓を抜き取る？", "Take out which?")
		promptl(0, promptmax) = lang("皮", "skin"), "a", "" + 337
		promptmax++
		promptl(0, promptmax) = lang("体液", "blood"), "b", "" + 338
		promptmax++
		promptl(0, promptmax) = lang("瞳", "eye"), "c", "" + 339
		promptmax++
		promptl(0, promptmax) = lang("心臓", "heart"), "d", "" + 340
		promptmax++
		promptl(0, promptmax) = lang("骨片", "bone"), "e", "" + 341
		promptmax++
		val = promptx, prompty, 140, 1
		gosub *label_1353
		if (rtval == (-1)) {
			partid = rnd(5) + 337
		} else {
			partid = rtval
		}
		if (synccheck(tc, -1)) {
			snd 105
			txtef 3
			txt -1, lang(" *ブシュッ* ", "*Gash*")
			if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
				gdata(809) = 2
				txt3rd = 1
				txt -1, lang(name(cc) + "は" + name(tc) + "の" + ioriginalnameref(partid) + "を抜き取り", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + " and")
			} else {
				txt -1, lang(name(cc) + "は" + name(tc) + "の" + ioriginalnameref(partid) + "を抜き取った。", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + ".")
			}
		}
		nodropbodyparts = 2
		dmghp tc, cMaxHp(tc) + 1, cc, 658
		nodropbodyparts = 0
		flt
		itemcreate -1, partid, cX(tc), cY(tc), 0
		if (stat != 0) {
			remain_make ci, tc
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 440 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 439 | _switch_sw) {
		_switch_sw = 0
		if (efid == 439) {
			if (synccheck(tc, -1)) {
				if (efstatus <= (-1)) {
					snd 117
					txt -1, lang(name(tc) + "の肉体は蝕まれた。", name(tc) + your(tc) + " body is damaged.")
				} else {
					txt -1, lang(name(tc) + "の肉体は復活した。", name(tc) + your(tc) + " body is restored.")
					animeload 10, tc
				}
				if (efstatus >= 1 | (efsource == 3 & rnd(5000) < efp)) {
					txt -1, lang("さらに、" + name(tc) + "の肉体は強化された。", "In addition, " + his(tc) + " body is enchanted.")
					animeload 10, tc
				}
			}
			p = 10, 11, 12, 17, 18, -1
		}
		if (efid == 440) {
			if (synccheck(tc, -1)) {
				if (efstatus <= (-1)) {
					snd 117
					txt -1, lang(name(tc) + "の精神は蝕まれた。", name(tc) + your(tc) + " spirit is damaged.")
				} else {
					txt -1, lang(name(tc) + "の精神は復活した。", name(tc) + your(tc) + " spirit is restored.")
					animeload 10, tc
				}
				if (efstatus >= 1 | (efsource == 3 & rnd(5000) < efp)) {
					txt -1, lang("さらに、" + name(tc) + "の精神は強化された。", "In addition, " + his(tc) + " spirit is enchanted.")
					animeload 10, tc
				}
			}
			p = 14, 13, 16, 15, 19, -1
		}
		repeat
			if (p(cnt) == (-1)) {
				break
			}
			i = p(cnt) + 240 - 10
			if (efstatus <= (-1)) {
				if (cQuality(tc) <= 3) {
					cdata(i, tc) -= rnd(sorgEx(p(cnt), tc)) / 5 + rnd(5)
					continue
				}
			}
			if (cdata(i, tc) < 0) {
				cdata(i, tc) = 0
			}
			if (efstatus >= 1) {
				cdata(i, tc) = sorgEx(p(cnt), tc) / 10 + 5
			}
		loop
		r1 = tc
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 441 | _switch_sw) {
		_switch_sw = 0
		gosub *label_1205
		screenupdate = -1
		gosub *label_0620
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1141 | _switch_sw) {
		_switch_sw = 0
*label_1406
		if (tc != 0 | gCurrentMap == 210) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		if (gIsReturningOrEscaping != 0 | gDestinationMap == 200) {
			txt -1, lang("脱出を中止した。", "The air around you gradually loses power.")
			gIsReturningOrEscaping = 0
		} else {
			gosub *label_1305
			if (stat == 1) {
				txt -1, lang("依頼請負中の帰還は法律で禁止されている。それでも帰還する？", "Returning while taking a quest if forbidden. Are you sure you want to return?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval != 0) {
					goto *label_1410
				}
			}
			txt -1, lang("周囲の大気がざわめきだした。", "The air around you becomes charged.")
			if (areaId(gCurrentMap) == 8) {
				if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
					if (areaHasBeenConquered(gCurrentMap) != (-1)) {
						txt -1, lang("このままダンジョンを出ると、この階のクエストは達成できない…", "The lord of the dungeon might disappear if you escape now.")
					}
				}
			}
			item_find 92000, 0, 1
			if (stat != (-1)) {
				txt -1, lang("このまま帰還すると、交易品は駄目になる…", "The trade article is lost if you escape now.")
			}
			gDestinationMap = gdata(850), 1
			if (efstatus <= (-1)) {
				if (rnd(3) == 0) {
					gDestinationMap = 41, 1
				}
				if (ogdata(499) == 2) {
					gDestinationMap = 200, 1
				}
			}
			gIsReturningOrEscaping = 5 + rnd(10)
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_escape | _switch_sw) {
		_switch_sw = 0
		goto *label_1406
		_switch_sw++
	}
	if (_switch_val == 428 | _switch_sw) {
		_switch_sw = 0
		if (cId(tc) == 332 & ogdata(463) == 2) {
			obvious = 0
			if (tc < 57 | cQuality(tc) >= 4 | cRole(tc) != 0) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				goto *label_1410
			}
			txt tc, lang("「ありがとう！これでおうちかえれう！」", "\"Thank you! I can finally return home now!\"")
			animeload 10, tc
			txt -1, lang(name(tc) + "は次元の扉を開けた。", "A dimensional door opens in frond of " + him(tc))
			if (efstatus <= (-1)) {
				animeid = 20
				anic = tc
				gosub *label_0630
				txt -1, lang(name(tc) + "は収容所に送られた。", "The door is connected to the prison...")
			} else {
				txt -1, lang(name(tc) + "はおうちへ帰っていった。", name(tc) + " returned " + his(tc) + " home.")
				snd 72
				animeload 5, tc
			}
			chara_vanquish tc
			goto *label_1410
		}
		if (tc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		if (gIsReturningOrEscaping != 0) {
			txt -1, lang("帰還を中止した。", "The air around you gradually loses power.")
			gIsReturningOrEscaping = 0
		} else {
			gosub *label_1306
			if (efstatus <= (-1)) {
				if (rnd(3) == 0) {
					gDestinationMap = 41, 1
				}
				if (ogdata(499) == 2) {
					gDestinationMap = 200, 1
				}
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 621 | _switch_sw) {
		_switch_sw = 0
		healmp tc, efp / 2 + rnd(efp / 2 + 1)
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "のマナが回復した。", name(tc) + your(tc) + " mana is restored.")
			animeid = 5
			gosub *label_0630
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 624 | _switch_sw) {
		_switch_sw = 0
		healmp tc, role(dice1, dice2, bonus)
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "は周囲からマナを吸い取った。", name(tc) + " absorb" + _s(tc) + " mana from the air.")
			animeid = 5
			gosub *label_0630
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1108 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "は毒を浴びた！", name(tc) + " " + is(tc) + " hit by poison!")
		}
		if (cColer == 1 & ocdata(191, tc) != 0) {
			ocdata(191, tc) = 0
			txt -1, lang(name(tc) + "の輝きが消えた。", name(tc) + " " + is(tc) + " Stop shine.")
		}
		if (cbit(978, tc)) {
			cbitmod 978, tc, 0
			if (ocdata(52, tc) == 330) {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
					txtef 9
					ctalk tc, 970, tc, tc
				}
			} else {
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
					txtef 9
					ctalk tc, 970, tc, tc
				}
			}
			ocdata(52, tc) = 0
			ocdata(53, tc) = 0
		}
		dmgcon tc, 1, efp
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1111 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "は墨を浴びた！", "Ink squirts into " + name(tc) + your(tc) + " face!")
		}
		dmgcon tc, 4, efp
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1109 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "はひどい頭痛におそわれた！", "A foul stench floods " + name(tc) + your(tc) + " nostrils!")
		}
		dmgcon tc, 5, efp
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1110 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "は痺れた！", name(tc) + " get" + _s(tc) + " numbness!")
		}
		dmgcon tc, 3, efp
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1112 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "は甘い液体を浴びた！", "Strange sweet liquid splashes onto " + name(tc) + "!")
		}
		dmgcon tc, 2, efp
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 645 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 1114 | _switch_sw) {
		_switch_sw = 0
*label_1407
		if (efid == 645) {
			if (synccheck(tc, -1)) {
				ctalk cc, 427, cc, tc
				txt -1, lang(name(cc) + "は" + name(tc) + "を指差して呪いの言葉を呟いた。", name(cc) + " point" + _s(cc) + " " + name(tc) + " and mutter" + _s(cc) + " a curse.")
				ctalk cc, 428, cc, tc
			}
		}
		p = 75 + sdata(19, tc)
		if (findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1) {
			if (encfind(tc, 43) != (-1)) {
				p += encfind(tc, 43) / 2
			}
		}
		if (rnd(p) > efp / 2 + (efstatus <= (-1)) * 100) {
			goto *label_1410
		}
		if (petcheck(tc) | tc == 0 & efid == 645) {
			if (rnd(3)) {
				if (gettrait(0, 42)) {
					txt -1, lang("あなたは祈祷を捧げ呪いのつぶやきを無効にした。", "Your prayer nullifies the curse.")
					goto *label_1410
				}
			}
			if (rnd(2)) {
				if (ogdata(441) == 2) {
					txt 0, lang("「破ぁ！！」あなたは気合いを込めて呪いのつぶやきを吹き飛ばした。", "\"HA!!\" You yelled and nullified the curse by fight.")
					goto *label_1410
				}
			}
		}
		i = 0
		repeat 30, 100
			if (cdata(cnt, tc) \ 10000 == 0) {
				continue
			}
			p(i) = cdata(cnt, tc) \ 10000 - 1
			if (iCurseState(p(i)) == 1) {
				if (rnd(10)) {
					continue
				}
			}
			i++
		loop
		if (i == 0) {
			inv_getheader tc
			repeat 200
				p = invhead + rnd(invrange)
				if (iNumber(p) == 0) {
					continue
				}
				if (iCurseState(p) == 1) {
					if (rnd(10)) {
						continue
					}
				}
				i = 1
				break
			loop
		}
		if (i > 0) {
			i = p(rnd(i))
			if (ibit(18, i)) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				obvious = 0
				goto *label_1410
			}
		}
		if (i > 0) {
			valn = itemname(i, 1, 1)
			if (iCurseState(i) == (-1)) {
				iCurseState(i) = -2
			} else {
				iCurseState(i) = -1
			}
			if (synccheck(tc, -1)) {
				txt -1, lang(name(tc) + "の" + valn + "は黒く輝いた。", name(tc) + your(tc) + " " + valn + " glows black.")
			}
			r1 = tc
			gosub *chara_refresh
			snd 117
			animeload 14, tc
			item_stack tc, i, 1
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1118 | _switch_sw) {
		_switch_sw = 0
		f = 0
		repeat 10
			p = rnd(61 - 50) + 50
			if (sorg(p, tc) >= 150) {
				f++
				resistmod tc, p, 50 * (-1)
				if (f >= efp / 100) {
					break
				}
			}
		loop
		if (f == 0) {
			txt -1, lang("何も起こらなかったようだ。", "Nothing happens.")
			obvious = 0
		} else {
			snd 38
		}
		r1 = tc
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1138 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 1123 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 1122 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 1137 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0 & petcheck(cc)) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		flt cLevel(0) / 2 + 5, 3
		p = 0
		if (rnd(3) == 0) {
			fltn "man"
		}
		if (efid == 1138) {
			txt -1, lang("なんと、あなたには生き別れた血の繋がっていないぬこの妹がいた！", "How...! You suddenly get a younger cat sister!")
			p = 210
		}
		if (efid == 1123) {
			if (efstatus >= 1) {
				repeat 10000
					imocolor = rnd(19) + 1
					if (lightdata(3, imocolor) < 24) {
						imocolor *= -1
						break
					}
				loop
				txt -1, lang("なんと、あなたには生き別れた血の繋がっていない光る妹がいた！", "How...! You suddenly get a shining younger sister!")
			} else {
				if (efstatus <= (-1)) {
					imocolor = rnd(18) + 2
					if (imocolor == 12) {
						txt -1, lang("なんと、あなたには生き別れた血の繋がっていない透明な妹がいた！", "How...! You suddenly get a invisible younger sister!")
					} else {
						txt -1, lang("なんと、あなたには生き別れた血の繋がっていない変な色の妹がいた！", "How...! You suddenly get a strange colored younger sister!")
					}
				} else {
					txt -1, lang("なんと、あなたには生き別れた血の繋がっていない妹がいた！", "How...! You suddenly get a younger sister!")
				}
			}
			p = 176
			ogdata(439)++
			gosub *label_1177
		}
		if (efid == 1137) {
			txt -1, lang("お嬢さんが空から降ってきた！", "A young lady falls from the sky.")
			p = 211
		}
		novoidlv = 1
		clnum = -1
		nomagicdevice = 1
		noenchant = 1
		noencpfix = 1
		nc_skipflag = 1
		characreate 56, p, -3, 0
		clnum = 0
		if (imocolor != 0) {
			if (imocolor > 0) {
				if (imocolor == 12) {
					ocbitmod 1, 56, 1
				} else {
					cImage(56) += imocolor * 1000
				}
			} else {
				ocdata(191, 56) = -imocolor
			}
			imocolor = 0
		}
		rc = 56
		gosub *label_1530
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 435 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0 | tc == 0 | tc < 16) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		if (gCurrentMap == 6 | gCurrentMap == 40 | gCurrentMap == 49 | gCurrentMap == 210 | oabit(17, gCurrentMap) | oabit(18, gCurrentMap)) {
			obvious = 0
			txt -1, lang("この場所では効果がない。", "The effect doesn't work in this area.")
			goto *label_1410
		}
		f = 1
		inv_find 663, cc
		if (stat != (-1)) {
			lint_efp = efp * 3 / 2
			efp = limitmax(lint_efp, INT_MAX)
		}
		if (rndex2(efp / 15 + 5) < cLevel(tc)) {
			f = 0
		}
		if (findfaction(tc, "family", "wild") & trophycheck(12) == 2) {
			f = 1
		}
		if (cQuality(tc) >= 4 | cRole(tc) != 0 | cbit(976, tc) == 1) {
			f = -1
		}
		if (gWizard == 1) {
			f = 1
		}
		if (eqfaction(tc, "nc_sheep")) {
			f = -1
		}
		if (f == 1) {
			rc = tc
			gosub *label_1530
			check_quest
		} else {
			if (f == 0) {
				txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			} else {
				txt -1, lang(name(tc) + "は支配できない。", name(tc) + " cannot be charmed.")
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 436 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 437 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 455 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 634 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 456 | _switch_sw) {
		_switch_sw = 0
		if (efid == 436) {
			p = 3, 2 + rnd(efp / 50 + 1)
			txt -1, lang("蜘蛛の巣が辺りを覆った。", "The ground is covered with thick webbing.")
		}
		if (efid == 437) {
			txt -1, lang("辺りを濃い霧が覆った。", "The air is wrapped in a dense fog.")
			p = 3, 2 + rnd(efp / 50 + 1)
		}
		if (efid == 455) {
			txt -1, lang("酸の水溜りが発生した。", "Acid puddles are generated.")
			p = 2, 2 + rnd(efp / 50 + 1)
		}
		if (efid == 456) {
			txt -1, lang("火柱が発生した。", "Walls of fire come out from the ground.")
			p = 2, 2 + rnd(efp / 50 + 1)
		}
		if (efid == 634) {
			txt -1, lang("エーテルの霧が発生した。", "Ether mist spreads.")
			p = 2, 1 + rnd(efp / 100 + 2)
		}
		snd 68
		x = tlocx
		y = tlocy
		gosub *label_1826
		repeat p(1)
			x = rnd(p) + tlocx - rnd(p)
			y = rnd(p) + tlocy - rnd(p)
			gosub *label_1826
			if (stat == (-1)) {
				continue cnt
			}
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1145 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		invsubroutine = 1
		invctrl = 23, 0
		snd 100
		gosub *label_1280
		if (iQuality(ci) < 4 | iQuality(ci) == 6) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			obvious = 0
			goto *label_1410
		}
		txt -1, lang("アーティファクトの新しい銘は？", "What do you want to name this artifact?")
		val = 3
		nc_intb_001 = 1
		namedscroll = efstatus
		gosub *label_1201
		if (stat == 0) {
			obvious = 0
			randomize
			goto *label_1410
		}
		p = stat
		iSubname(ci) = list(1, p) + 40000
		randomize
		txt -1, lang("それは" + listn(0, p) + "という銘になった。", "It's now called " + listn(0, p) + ".")
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 49 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		invsubroutine = 1
		invctrl = 23, 7
		snd 100
		gosub *label_1280
		f = stat
		if (stat == 0) {
			goto *label_1410
		}
		if (iQuality(ci) >= 4 | ibit(10, ci) == 1) {
			txt -1, lang("そのアイテムに改良の余地はない。", "This item leaves no room for improvement.")
			fixmaterial = 0
			objfix = 0
			goto *label_1410
		}
		randomize iParam1(efcibk)
		equip = iBodyPart(ci)
		animeload 8, cc
		fixmaterial = iMaterial(ci)
		iQuality(ci) = 4
		gosub *label_0315
		randomize iParam1(efcibk)
		iSubname(ci) = iSubname(efcibk)
		repeat 15
			if (iEnchantmentId(efcibk, cnt)) {
				encadd ci, iEnchantmentId(efcibk, cnt), inv(41 + cnt * 2, efcibk)
			}
		loop
		randomize
		txt -1, lang("それは" + itemname(ci, 1) + "になった。", "It becomes " + itemname(ci, 1) + ".")
		if (equip != 0) {
			cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
			iBodyPart(ci) = equip
		}
		r1 = cc
		gosub *chara_refresh
		fixmaterial = 0
		objfix = 0
		ci = efcibk
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 50 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		efstatus = iCurseState(ci)
		ruce = iNumber(ci)
		nc_intb_001 = iParam1(ci)
		invsubroutine = 1
		invctrl = 23, 0
		snd 100
		gosub *label_1280
		f = stat
		if (stat == 0) {
			goto *label_1410
		}
		if (iQuality(ci) <= 3 | iQuality(ci) == 6 | ibit(10, ci) == 1) {
			txt -1, lang("そのアイテムに使用することは出来ない。", "This item leaves no room for improvement.")
			fixmaterial = 0
			objfix = 0
			goto *label_1410
		}
		if (nc_intb_001 == 0) {
			txt -1, lang("強化するエンチャントを選ぶ必要がある。", "You need to choose an enchantment to strengthen.")
			reftype = refitem(iId(ci), 5, ci)
			listmax = 0
			repeat 15
				if (iEnchantmentId(ci, cnt) == 0) {
					break
				}
				list(0, listmax) = rtval, rtval(1)
				val = iEnchantmentId(ci, cnt), iEnchantmentPower(ci, cnt), 0, reftype
				getencproc encprocref2, ci, val
				gosub *label_0297
				if (iEnchantmentPower(ci, cnt) >= limitmax((ogdata(427) + 1) * 1000, 2000000000)) {
					s += lang("(上限)", "(limit)")
				}
				promptl(0, promptmax) = s, "null", "" + promptmax
				promptmax++
				listmax++
			loop
			if (listmax > 0) {
				val = promptx, prompty, 600, 1
				gosub *label_1353
				if (rtval == (-1)) {
					txtnew
					txt -1, lang("何も起きない…", "Use Stop.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				} elseif (iEnchantmentId(ci, rtval) >= 90000 & iEnchantmentId(ci, rtval) <= 90005) {
					txtnew
					txt -1, lang("特殊弾には使用できない。", "Cannot be used for ammo enchant.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				} elseif ((iEnchantmentId(ci, rtval) >= 45 & iEnchantmentId(ci, rtval) <= 47) | iEnchantmentId(ci, rtval) == 21) {
					txtnew
					txt -1, lang("能力変化系以外のマイナスエンチャントには使用できない。", "Cannot be used for bad enchant.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				} elseif (iEnchantmentPower(ci, rtval) >= limitmax((ogdata(427) + 1) * 1000, 2000000000)) {
					txtnew
					txt -1, lang("そのエンチャントは既に上限を突破している。", "Cannot be used for limit enchant.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				}
			}
			equip = iBodyPart(ci)
			rucemax = (limitmax((ogdata(427) + 1) * 1000, 2000000000) - iEnchantmentPower(ci, rtval)) / 50
			if (rucemax < ruce) {
				ruce = rucemax
			}
			if (ruce < 1) {
				ruce = 1
			}
			in = 1
			crtval = 0
			if (ruce > 1) {
					crtval = rtval
					txt -1, lang("いくつ使用する？ (1〜" + ruce + ") ", "How many? (1 to " + ruce + ")")
					display_msg screenmsgy, 2
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, ruce
					inputlog = "" + 1
					gosub *label_1349
					in = int(inputlog)
					if (in > ruce) {
						in = ruce
					}
					if (in <= 0) {
						in = 1
					}
					rtval = crtval
			}
			animeload 8, cc
			iEnchantmentPower(ci, rtval) += 50 * in
			if (iEnchantmentPower(ci, rtval) >= limitmax((ogdata(427) + 1) * 1000, 2000000000)) {
				iEnchantmentPower(ci, rtval) = limitmax((ogdata(427) + 1) * 1000, 2000000000)
			}
			txtef 2
			txt -1, lang("選択した" + itemname(ci, 1) + "のエンチャントは強化された。", "It becomes " + itemname(ci, 1) + ".")
			if (equip != 0) {
				cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
				iBodyPart(ci) = equip
			}
			r1 = cc
			gosub *chara_refresh
			fixmaterial = 0
			objfix = 0
			ci = efcibk
			iNumber(ci) -= in
			cell_refresh iX(ci), iY(ci)
			autosave = 1 * (gCurrentMap != 35)
			if (cfg_noautosave > 2 & gettrait(0, 189) == 0) {
				autosave = 0
			}
			goto *label_1410
		}
		if (efstatus >= 0) {
			txt -1, lang("強化するエンチャントを選ぶ必要がある。", "You need to choose an enchantment to strengthen.")
			reftype = refitem(iId(ci), 5, ci)
			listmax = 0
			repeat 15
				if (iEnchantmentId(ci, cnt) == 0) {
					break
				}
				list(0, listmax) = rtval, rtval(1)
				val = iEnchantmentId(ci, cnt), iEnchantmentPower(ci, cnt), 0, reftype
				getencproc encprocref2, ci, val
				gosub *label_0297
				if (iEnchantmentPower(ci, cnt) >= limitmax(ncgdata(63) * 200, 2000000000)) {
					s += lang("(上限)", "(limit)")
				}
				promptl(0, promptmax) = s, "null", "" + promptmax
				promptmax++
				listmax++
			loop
			if (listmax > 0) {
				val = promptx, prompty, 600, 1
				gosub *label_1353
				if (rtval == (-1)) {
					txtnew
					txt -1, lang("何も起きない…", "Use Stop.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				} elseif (iEnchantmentId(ci, rtval) >= 90000 & iEnchantmentId(ci, rtval) <= 90005) {
					txtnew
					txt -1, lang("特殊弾には使用できない。", "Cannot be used for ammo enchant.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				} elseif ((iEnchantmentId(ci, rtval) >= 45 & iEnchantmentId(ci, rtval) <= 47) | iEnchantmentId(ci, rtval) == 21) {
					txtnew
					txt -1, lang("能力変化系以外のマイナスエンチャントには使用できない。", "Cannot be used for bad enchant.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				} elseif (iEnchantmentPower(ci, rtval) >= limitmax(ncgdata(63) * 200, 2000000000)) {
					txtnew
					txt -1, lang("そのエンチャントは既に上限を突破している。", "Cannot be used for limit enchant.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				}
			}
		} else {
			animeload 8, cc
			repeat 15
				if (iEnchantmentId(ci, cnt) == 0 & cnt > 0) {
					iEnchantmentId(ci, (cnt - 1)) = 0
					break
				}
				if (iEnchantmentId(ci, cnt) == 0) {
					break
				}
				if (cnt == 14) {
					iEnchantmentId(ci, cnt) = 0
					break
				}
			loop
			txt -1, lang(itemname(ci) + "のエンチャントを一つ消去した。", itemname(ci) + " removes an enchantment.")
			ci = efcibk
			iNumber(ci) -= 1
			gosub *chara_refresh
			gosub *label_0623
			goto *label_1623
		}
		equip = iBodyPart(ci)
		rucemax = (limitmax(ncgdata(63) * 200, 2000000000) - iEnchantmentPower(ci, rtval)) / ((ogdata(427) + 1) * 500) + 1
		if (rucemax < ruce) {
			ruce = rucemax
		}
		if (ruce < 1) {
			ruce = 1
		}
		in = 1
		crtval = 0
		if (efstatus == 0) {
				crtval = rtval
				txt -1, lang("いくつ使用する？ (1〜" + ruce + ") ", "How many? (1 to " + ruce + ")")
				display_msg screenmsgy, 2
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, ruce
				inputlog = "" + 1
				gosub *label_1349
				in = int(inputlog)
				if (in > ruce) {
					in = ruce
				}
				if (in <= 0) {
					in = 1
				}
				rtval = crtval
		}
		animeload 8, cc
		iEnchantmentPower(ci, rtval) += (ogdata(427) + 1) * 500 * in
		if(iEnchantmentPower(ci, rtval) >= limitmax(ncgdata(63) * 200, 2000000000)) {
			iEnchantmentPower(ci, rtval) = limitmax(ncgdata(63) * 200, 2000000000)
		}
		txtef 2
		txt -1, lang("選択した" + itemname(ci, 1) + "のエンチャントは強化された。", "It becomes " + itemname(ci, 1) + ".")
		if (efstatus == 1) {
			repeat
				randomize 50500 + cnt
				dim ginga, 15
				ginga = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
				gingamax = 0
				cibk2 = ci
				ci = 5480
				dbid = iId(p)
				dbmode = 3
				gosub *label_2426
				iNumber(ci) = 0
				ci = cibk2
				repeat 10
					p@m42 = rnd(15)
					if (iEnchantmentId(p, p@m42) == 0) {
						continue
					}
					f@m42 = 0
					repeat gingamax + 1
						if (p@m42 == ginga(cnt)) {
							f@m42 = 1
							break
						}
					loop
					if (f@m42 == 0) {
						i = iMaterial(p)
						repeat 8
							if (mtenc(cnt * 2, i) == 0) {
								break
							}
							mtencid = mtenc(cnt * 2, i)
							if (mtencid == 0) {
								break
							}
							if (iEnchantmentId(p, p@m42) == mtencid) {
								if (iEnchantmentPower(p, p@m42) - mtenc(cnt * 2 + 1, i) <= 0) {
									f@m42 = 1
									break
								}
							}
						loop
					}
					if (f@m42 == 0) {
						repeat length(fixeditemenc)
							if (fixeditemenc(cnt * 2) == 0) {
								break
							}
							if (iEnchantmentId(p, p@m42) != fixeditemenc(cnt * 2)) {
								continue
							}
							if (iEnchantmentPower(p, p@m42) - fixeditemenc(cnt * 2 + 1) <= 0) {
								f@m42 = 1
								break
							}
						loop
					}
					if (f@m42 == 1) {
						continue
					}
					if (rnd(4) > gingamax | iEnchantmentPower(p, p@m42) < 0) {
						ginga(gingamax) = p@m42
						gingamax++
					}
				loop
				randomize
				kf = 0
				repeat gingamax
					if(rtval == ginga(cnt)) {
						kf = 1
					}
					if(rtval != ginga(cnt) & ginga(cnt) != -1) {
						kf = 0
						break
					}
				loop
				if (kf == 1) {
					i = 10500 + cnt
					iSubname(ci) = i + 40000
					txt -1, lang("それは" + itemname(ci, 1) + "という銘になった。", "It's now called " + itemname(ci, 1) + ".")
					break
				}
			loop
		}
		if (equip != 0) {
			cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
			iBodyPart(ci) = equip
		}
		r1 = cc
		gosub *chara_refresh
		fixmaterial = 0
		objfix = 0
		ci = efcibk
		iNumber(ci) -= in
		cell_refresh iX(ci), iY(ci)
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 21 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 1127 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		nc_intb_099 = iId(efcibk)
		nc_intb_098 = iCurseState(efcibk)
		if (iIdentificationState(efcibk) < 3) {
			nc_intb_098 = (-3)
		}
		invsubroutine = 1
		invctrl = 23, 0
		snd 100
		gosub *label_1280
		f = stat
		if (iQuality(ci) == 5 | ibit(10, ci) == 1) {
			if (efid == 1127) {
				f = 0
			}
		}
		equip = iBodyPart(ci)
		if (f == 1) {
			if (iQuality(ci) == 6) {
				if (efp < 350) {
					txt -1, lang("アーティファクトの再生成にはパワーが足りない。", "More magic power is needed to reconstruct an artifact.")
					goto *label_1410
				}
				animeload 8, cc
				txt -1, lang(name(cc) + "の" + itemname(ci, 1) + "は再生成された。", name(cc) + your(cc) + " " + itemname(ci, 1, 1) + " is reconstructed.")
				iNumber(ci)--
				cell_refresh iX(ci), iY(ci)
				flt
				if (iId(ci) == 743) {
					inititemid = inv(31, ci) + 1
				}
				itemcreate 0, iId(ci), -1, -1, 0
			} else {
				*label_loopmat
				animeload 8, cc
				if (efp <= 70) {
					if (rnd(3) == 0) {
						fixmaterial = 35
					}
				}
				s = itemname(ci, 1, 1)
				nc_intb_101 = iPv(ci)
				nc_intb_102 = iDv(ci)
				nc_intb_103 = iDamageBonus(ci)
				nc_intb_104 = iHitBonus(ci)
				nc_intb_105 = iDiceX(ci)
				nc_intb_106 = iDiceY(ci)
				nc_intb_107 = iMaterial(ci)
				nc_intb_108 = iValue(ci)
				objlv = 0
				objfix = efp / 100
				randomize
				gosub *label_0315
				txt -1, lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
				transformsstat
				if (iId(efcibk) == 630 | iId(efcibk) == 743) {
					promptl(0, 0) = lang("確認", "OK"), "y", "0"
					promptmax = 1
					valhinan = val
					val = promptx, prompty, 160, 1
					gosub *label_1353
					r1 = cc
					gosub *chara_refresh
					fixmaterial = 0
					objfix = 0
					goto *label_1410
				}
				txtnew
				txt -1, lang("もう一度変化させる？", "Try again?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				valhinan = val
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval == 0) {
					nc_intb_100 = (-1)
					inv_getheader 0
					repeat invrange, invhead
						if (iNumber(cnt) == 0) {
							continue
						}
						if (nc_intb_099 == iId(cnt) & nc_intb_098 == (-3) & iIdentificationState(cnt) < 3) {
							nc_intb_100 = cnt
							break
						}
						if (nc_intb_099 == iId(cnt) & nc_intb_098 == iCurseState(cnt)) {
							nc_intb_100 = cnt
							break
						}
					loop
					if (nc_intb_100 > (-1)) {
						iNumber(nc_intb_100)--
						goto *label_loopmat
					} else {
						txt -1, lang("素材変化に必要な同種のアイテムがもうない。", "There are no more items of the same kind needed for material change.")
					}
				}
			}
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		if (equip != 0) {
			cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
			iBodyPart(ci) = equip
		}
		r1 = cc
		gosub *chara_refresh
		fixmaterial = 0
		objfix = 0
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1128 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		snd 24
		p = rnd(efp + 1) / 100 + 1
		gRightsToSucceedTo += p
		txtef 5
		txt -1, lang("あなたは遺産相続人として認められた(+" + p + ")", "You claim the right of succession. (+" + p + ")")
		txt -1, lang("今やあなたは" + gRightsToSucceedTo + "個の遺産を相続できる。", "You can now inherit " + gRightsToSucceedTo + " items.")
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1124 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 1125 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		invsubroutine = 1
		if (efid == 1124) {
			invctrl = 23, 1
		} else {
			invctrl = 23, 2
		}
		snd 100
		gosub *label_1280
		if (stat == 1) {
			if (iEnhancement(ci) < efp / 100) {
				snd 24
				txt -1, lang(itemname(ci) + "は黄金の光に包まれた。", itemname(ci) + " " + is2(iNumber(ci)) + " surrounded by a golden aura.")
				iEnhancement(ci)++
				repeat 15
					if (iEnchantmentId(ci, cnt) == 0) {
						c = cnt
						break
					}
				loop
				if (c < (efp / 200) & ibit(10, ci) == 0) {
					txt -1, lang("更に、" + itemname(ci) + "に新たな力を付与することが出来る。", itemname(ci) + " deems your heroic deeds worthy enough and further unleases its hidden power!")
					txt -1, lang("それは…", "It...")
					randomize
					reftype = refitem(iId(ci), 5, ci)
					listmax = 0
					repeat 50
						if (listmax >= 8) {
							break
						}
						encadd ci, randomenc(randomenclv(4)), randomencp(0, ogdata(503) == 2), 0, 0, 1
						if (stat != 0) {
							if (ogdata(503) != 2) {
								if (rtval == 52) {
									continue
								}
								if (rtval == 53) {
									continue
								}
							}
							if (rtval == 34) {
								if (rnd(3)) {
									continue
								}
							}
							findenc = 0
							repeat listmax
								if (list(0, cnt) == rtval) {
									if (encpassivecheck(rtval) | list(1, cnt) == rtval(1)) {
										findenc = 1
										break
									}
								}
							loop
							if (findenc) {
								continue
							}
							if (ogdata(503) != 2) {
								if (encfindspec(ci, rtval) != (-1)) {
									continue
								}
							}
							list(0, listmax) = rtval, rtval(1)
							val = list(0, listmax), list(1, listmax), 0, 0
							gosub *label_0297
							promptl(0, promptmax) = s, "null", "" + promptmax
							promptmax++
							listmax++
						} else {
							continue
						}
					loop
					if (listmax > 0) {
						val = promptx, prompty, 500, 1
						gosub *label_1353
						if (rtval == (-1)) {
							randomize
							exrand_randomize timeGetTime()
							r1 = cc
							txtnew
							txt -1, lang("選択しなかった。", "No Select.")
							gosub *chara_refresh
							gosub *label_0623
							goto *label_1623
						} else {
							txtnew
							txtef 2
							txt -1, lang(itemname(ci) + "にエンチャントを付与した。", itemname(ci) + " vibrates as if she is pleased.")
							encadd ci, list(0, rtval), list(1, rtval), 0, 1
						}
					}
				}
			} else {
				txt -1, lang(itemname(ci) + "は抵抗した。", itemname(ci) + " resist" + _s2(iNumber(ci)) + ".")
			}
			r1 = cc
			gosub *chara_refresh
		} else {
			obvious = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 630 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	// 充填(巻物)
	if (_switch_val == 1129 | _switch_sw) {
		_switch_sw = 0
		if (efid != 630) {
			if (cc != 0) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				obvious = 0
				goto *label_1410
			}
		} else {
			if (cc == 0) {
				if (gChargePower < 10) {
					txt -1, lang("充填するには最低でも魔力の貯蓄が10必要だ。", "You need at least 10 recharge powers to recharge items.")
					goto *label_1410
				}
			}
		}
		f = 0
		if (cc == 0) {
			invsubroutine = 1
			invctrl = 23, 3
			snd 100
			gosub *label_1280
			f = stat
		} else {
			inv_getheader cc
			listmax = 0
			repeat invrange, invhead
				if (iNumber(cnt) == 0) {
					continue
				}
				reftype = refitem(iId(cnt), 5, cnt)
				if (reftype != 54000 & reftype != 56000) {
					continue
				}
				if (iCount(cnt) > 1) {
					continue
				}
				list(0, listmax) = cnt
				listmax++
			loop
			if (listmax) {
				ci = list(0, rnd(listmax))
				f = 1
			}
		}
		if (f == 1) {
			dbid = iId(ci)
			cibkref = ci
			dbmode = 2
			gosub *label_2426
			orgichargelevel = ichargelevel
			if (ichargelevel < 1 | (iId(ci) == 290 & ogdata(515) != 2) | iId(ci) == 480 | iId(ci) == 289 | iId(ci) == 732 | (iId(ci) == 687 & iParam2(ci) != 0) | (iQuality(ci) == 6 & iId(ci) != 798)) {
				txt -1, lang("それは充填ができないようだ。", "You can't recharge this item.")
				item_autostack cc, ci
				goto *label_1410
			}
			if (reftype == 54000) {
				if (iId(ci) != 697 & iId(ci) != 434 & iId(ci) != 696 & iId(ci) != 481 & iId(ci) != 289 & iId(ci) != 252) {
					ichargelevel *= 2
				}
			}
			if (reftype == 56000 & iEnhancement(ci) > 0) {
				ichargelevel += ichargelevel / 2 * iEnhancement(ci) + 1
			}
			f = 1
			if (iCount(ci) > ichargelevel) {
				f = -1
			}
			if (iId(ci) == 290 & iCount(ci) < iEnhancement(ci)) {
				f = 1
			}
			if (f == (-1)) {
				txt -1, lang(itemname(ci) + "はこれ以上充填できないようだ。", itemname(ci) + " cannot be recharged anymore.")
				item_autostack cc, ci
				goto *label_1410
			}
			if (cc == 0) {
				if (efid == 630) {
					gChargePower -= 10
					txt -1, lang("魔力の貯蓄を10消費した(残り" + gChargePower + ")", "You spend 10 recharge powers. (Total:" + gChargePower + ")")
				}
			} else {
				txt -1, lang(name(cc) + "は" + itemname(ci) + "にマナを込めた。", name(cc) + " spend quarter my mana.")
				dmgmp cc, cMaxMp(cc) / 4
			}
			if (rnd(efp / 25 + 1) == 0) {
				f = 0
			}
			if (refitem(iId(ci), 5, ci) == 54000) {
				if (rnd(4) == 0) {
					f = 0
				}
			}
			if (rnd(ichargelevel * ichargelevel + 1) == 0) {
				f = 0
			}
			if (f == 1) {
				p = 1 + rnd(orgichargelevel / 2 + 1) + iEnhancement(ci) / 5
				if (p + iCount(ci) > ichargelevel) {
					p = ichargelevel - iCount(ci) + 1
				}
				if (refitem(iId(ci), 5, ci) == 54000) {
					p = 1
				}
				if (iId(ci) == 290) {
					p = limit(sdata(174, cc) / 1000 , 1, iEnhancement(ci) - iCount(ci))
				}
				txt -1, lang(itemname(ci) + "は充填された(+" + p + ")", itemname(ci) + " " + is2(iNumber(ci)) + " recharged by +" + p + ".")
				iCount(ci) += p
				item_autostack cc, ci
				animeload 8, cc
			} else {
				if (nc_gettrait(cc, 114) == 0) {
					if (rnd(4) + iEnhancement(ci) == 0 & iId(ci) != 798 & iId(ci) != 290) {
						txt -1, lang(itemname(ci) + "は破裂した。", itemname(ci) + " explode" + _s2(iNumber(ci)) + ".")
						iNumber(ci)--
						gosub *refreshPCBurdenState
						goto *label_1410
					}
				}
				txt -1, lang(itemname(ci) + "への充填は失敗した。", "You fail to recharge " + itemname(ci) + ".")
			}
		} else {
			obvious = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 629 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		invsubroutine = 1
		invctrl = 23, 5
		snd 100
		gosub *label_1280
		if (stat == 1) {
			dbid = iId(ci)
			cibkref = ci
			dbmode = 2
			gosub *label_2426
			repeat 1
				if (ichargelevel == 1) {
					p = 100
					break
				}
				if (ichargelevel == 2) {
					p = 25
					break
				}
				if (ichargelevel <= 4) {
					p = 5
					break
				}
				if (ichargelevel <= 6) {
					p = 3
					break
				}
				p = 1
			loop
			animeload 8, cc
			p = p * iCount(ci)
			gChargePower += p
			txt -1, lang(itemname(ci) + "を破壊して" + p + "の魔力を抽出した(計" + gChargePower + ")", "You destroy " + itemname(ci) + " and extract " + p + " recharge powers. (Total:" + gChargePower + ")")
			iNumber(ci) = 0
			gosub *refreshPCBurdenState
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 504 | _switch_sw) {
		_switch_sw = 0
		nc_intb_001 = 0
		cell_featread cX(cc), cY(cc)
		if (feat(1) == 11) {
				repeat mapWidth
					f = cnt
					repeat mapHeight
						cell_featread f, cnt
						if (feat(1) == 10) {
							cNextX(cc) = f
							cNextY(cc) = cnt
							nc_intb_001 = 1
							break
						}
					loop
					if (nc_intb_001) {
						break
					}
				loop
				if (nc_intb_001) {
					cell_check cNextX(cc), cNextY(cc)
					if (cellaccess == 1) {
						if (synccheck(cc, -1)) {
							snd 72
							txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
						}
						rowactend cc
						redraw 0
						gosub *label_0623
						gosub *label_1367
					} else {
						repeat 245
								if (cState(cnt) != 1) {
									continue
								}
								if (cc == cnt) {
									continue
								}
								if (cX(cnt) == cNextX(cc)) {
									if (cY(cnt) == cNextY(cc)) {
										cell_swap cc, cnt
										if (synccheck(cc, -1)) {
											snd 72
											ctalk cc, 10100, cnt, cc
											if (stat == 0) {
												txt -1, lang(name(cnt) + "と入れ替わった。", "You displace " + name(cnt) + ".")
											}
										}
										gosub *label_0623
										gosub *label_1367
										break
									}
								}
						loop
					}
			} else {
				txt -1, lang("何もおきない…", "Nothing happens...")
			}
		} else {
			repeat mapWidth
				f = cnt
				repeat mapHeight
					cell_featread f, cnt
					if (feat(1) == 11) {
						cNextX(cc) = f
						cNextY(cc) = cnt
						nc_intb_001 = 1
						break
					}
				loop
				if (nc_intb_001) {
					break
				}
			loop
			if (nc_intb_001) {
				cell_check cNextX(cc), cNextY(cc)
				if (cellaccess == 1) {
					if (synccheck(cc, -1)) {
						snd 72
						txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
					}
					rowactend cc
					redraw 0
					gosub *label_0623
					gosub *label_1367
				} else {
					repeat 245
							if (cState(cnt) != 1) {
								continue
							}
							if (cc == cnt) {
								continue
							}
							if (cX(cnt) == cNextX(cc)) {
								if (cY(cnt) == cNextY(cc)) {
									cell_swap cc, cnt
									if (synccheck(cc, -1)) {
										snd 72
										ctalk cc, 10100, cnt, cc
										if (stat == 0) {
											txt -1, lang(name(cnt) + "と入れ替わった。", "You displace " + name(cnt) + ".")
										}
									}
									gosub *label_0623
									gosub *label_1367
									break
								}
							}
					loop
				}
			} else {
				txt -1, lang("何もおきない…", "Nothing happens...")
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 647 | _switch_sw) {
		_switch_sw = 0
		tc = cc
		ctalk cc, 427, cc, tc
		if (tc == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		animeload 8, tc
		txt -1, lang(name(tc) + "は覚醒した！", name(tc) + " has awoken!")
		flt calcobjlv(cLevel(tc) + 3), 2
		fixlv = cQuality(tc)
		initlv = cLevel(tc)
		s = "god", "demon", "amorphs"
		fltn s(rnd(3))
		characreate 56, 0, -3, 0
		cdatan(0, 56) = cdatan(0, tc)
		cSex(56) = cSex(tc)
		if (gExecutingImmediateQuestType == 1008) {
			qdata(12, gExecutingImmediateQuest) = cId(56)
		}
		relocate_chara 56, tc, 1
		cHp(tc) = cMaxHp(tc)
		cMp(tc) = cMaxMp(tc)
		cSp(tc) = cMaxSp(tc)
		ctalk cc, 428, cc, tc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 628 | _switch_sw) {
		ctalk cc, 427, cc, tc
		_switch_sw = 0
*label_1408
		if (tc == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		f = 1
		if (efp / 10 + 10 < cLevel(tc)) {
			f = 0
		}
		if (cQuality(tc) >= 4 | cRole(tc) != 0 | cbit(963, tc) == 1 | cbit(976, tc) == 1) {
			f = -1
		}
		if (tc < 57) {
			f = 0
		}
		if (f == 1) {
			animeload 8, tc
			if (efid == 632) {
				ctalk cc, 427, cc, tc
			}
			txt -1, lang(name(tc) + "は変化した。", name(tc) + " change" + _s(tc) + ".")
			ctalk cc, 428, cc, tc
			flt calcobjlv(cLevel(tc) + 3), 2
			characreate 56, 0, -3, 0
			relocate_chara 56, tc, 1
			lockon tc, cc, 13
			cbitmod 970, tc, 0
			check_quest
		} else {
			if (f == 0) {
				txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			} else {
				txt -1, lang(name(tc) + "は変化できない。", name(tc) + " cannot be changed.")
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1140 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		invsubroutine = 1
		invctrl = 23, 6
		snd 100
		gosub *label_1280
		if (stat == 1) {
			autosave = 1 * (gCurrentMap != 35)
			if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
				autosave = 0
			}
			animeload 8, cc
			if (efstatus >= 0) {
				if (iWeight(ci) > 0) {
					iWeight(ci) = limit(iWeight(ci) * (100 - efp / 10) / 100, 1, iWeight(ci))
					if (iPv(ci) > 0) {
						iPv(ci) -= iPv(ci) / 10 + 1 + (efstatus < 1)
					}
					if (iDamageBonus(ci) > 0) {
						iDamageBonus(ci) -= iDamageBonus(ci) / 10 + 1 + (efstatus < 1)
					}
				}
				txt -1, lang("" + itemname(ci, 1) + "は羽が生えたように軽くなった。", itemname(ci, 1) + " becomes light as a feather.")
			} else {
				iWeight(ci) = iWeight(ci) * 150 / 100 + 1000
				if (iPv(ci) > 0) {
					iPv(ci) += limit(iPv(ci) / 10, 1, 5)
				}
				if (iDamageBonus(ci) > 0) {
					iDamageBonus(ci) += limit(iDamageBonus(ci) / 10, 1, 5)
				}
				txt -1, lang("" + itemname(ci, 1) + "はずしりと重くなった。", itemname(ci, 1) + " becomes heavy.")
			}
			gosub *refreshPCBurdenState
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		r1 = cc
		gosub *chara_refresh
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1132 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		invsubroutine = 1
		invctrl = 23, 4
		snd 100
		gosub *label_1280
		f = stat
		if (f) {
			if (iQuality(ci) > 4 | ibit(5, ci) == 1) {
				f = 0
			}
		}
		if (f == 1) {
			autosave = 1 * (gCurrentMap != 35)
			if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
				autosave = 0
			}
			animeload 8, cc
			fltbk = refitem(iId(ci), 5, ci)
			valuebk = calcitemvalue(ci, 0)
			iNumber(ci) = 0
			repeat
				await
				flt calcobjlv(efp / 10) + 5, calcfixlv(3)
				if (cnt < 10) {
					flttypemajor = fltbk
				}
				itemcreate 0, 0, -1, -1, 0
				if (stat == 0) {
					continue
				}
				if (iValue(ci) > valuebk * 3 / 2 + 1000) {
					iNumber(ci) = 0
					continue
				} else {
					break
				}
			loop
			txt -1, lang("それは" + itemname(ci, 1) + "に変容した。", "It is metamorphosed into " + itemname(ci, 1) + ".")
			gosub *refreshPCBurdenState
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 457 | _switch_sw) {
		_switch_sw = 0
		_switch_sw++
	}
	if (_switch_val == 438 | _switch_sw) {
		_switch_sw = 0
		x = tlocx
		y = tlocy
		f = 1
		if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
			f = 0
		} else {
			if (chipm(7, map(x, y, 0)) & 4) {
				if (homemapmode == 0) {
					if (efid != 457) {
						f = 0
					} else {
						if (chipm(0, map(x, y, 0)) == 3) {
							f = 0
						}
					}
				}
			}
			if (map(x, y, 1) != 0 | (map(x, y, 6) != 0 & efid != 457)) {
				f = 0
			}
		}
		if (f == 1) {
			if (efid == 438) {
				if (homemapmode == 0) {
					txt -1, lang("床が盛り上がってきた。", "A wall appears.")
					p = tile_wall
				} else {
					p = tile
				}
				if (map(x, y, 0) != p) {
					snd 65
				}
				map(x, y, 0) = p
				map(x, y, 2) = p
			}
			if (efid == 457) {
				cell_featread x, y
				if (feat(1) == 21) {
					if (areaType(gCurrentMap) == 5) {
						if (feat == tile_doorclosed1) {
							cell_featset x, y, tile_doorclosed2, 21, rnd(efp / 10 + 1)
						} else {
							if (feat == tile_doorclosed2) {
								cell_featset x, y, tile_doorclosed3, 21, rnd(efp / 10 + 1)
							} else {
								if (feat == tile_doorclosed3) {
									cell_featset x, y, tile_doorclosed4, 21, rnd(efp / 10 + 1)
								} else {
									cell_featset x, y, tile_doorclosed1, 21, rnd(efp / 10 + 1)
								}
							}
						}
						txt -1, lang("扉の種類が変わった。", "The kind of the door changed.")
						goto *label_1410
					} else {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *label_1410
					}
				} else {
					if (map(x, y, 6) != 0) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *label_1410
					}
				}
				snd 65
				if (chipm(0, map(x, y, 0)) == 6) {
					txt -1, lang("この壁は魔法を受け付けないようだ。", "These walls seem to resist your magic.")
					goto *label_1410
				}
				txt -1, lang("扉が出現した。", "A door appears.")
				cell_featset x, y, tile_doorclosed1, 21, rnd(efp / 10 + 1)
				if (chipm(7, map(x, y, 0)) & 4) {
					map(x, y, 0) = tile_tunnel
				}
			}
		} else {
			if (homemapmode == 0) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			obvious = 0
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 631 | _switch_sw) {
		_switch_sw = 0
		txtef 4
		ctalk cc, 966, cc, tc
		if (stat == 0) {
			txtef 4
			txt -1, lang("スウォーム！", "Swarm!")
		}
		repeat 245
			if (cState(cc) != 1) {
				continue
			}
			if (cState(cnt) != 1) {
				continue
			}
			if (cc == cnt) {
				continue
			}
			tc = cnt
			if (relationbetween(cc, tc) != (-3)) {
				continue
			}
			dx = cX(tc)
			dy = cY(tc)
			if (dist(cX(cc), cY(cc), dx, dy) > sdataref(3, 631) \ 1000 + 1 + (ogdata(465) == 2 & cc == 0) + (ogdata(481) == 2 & cc == 0 & (cEquipmentType(cc) & 2) != 0)) {
				continue
			}
			if (fov_los(cX(cc), cY(cc), dx, dy) == 0) {
				continue
			}
			animeid = 9
			gosub *label_0630
			gosub *label_1442
			gosub *label_1848
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 659 | _switch_sw) {
		_switch_sw = 0
		if (mapType == 1) {
			goto *label_1410
		}
		if (map(cX(cc), cY(cc), 6) != 0) {
			goto *label_1410
		}
		cell_featset cX(cc), cY(cc), 0, 14, 7, cc
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は何かを投下した。", name(cc) + " drop" + _s(cc) + " something on the ground.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 466 | _switch_sw) {
		_switch_sw = 0
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (cc == cnt) {
				continue
			}
			if (cbit(31, cnt)) {
				continue
			}
			tc = cnt
			dx = cX(tc)
			dy = cY(tc)
			if (dist(cX(cc), cY(cc), dx, dy) > 2 * 2) {
				continue
			}
			if (synccheck(tc, -1)) {
				txt -1, lang(name(tc) + "は重力を感じた。", name(tc) + " feel" + _s(tc) + " gravity.")
			}
			cGravity(tc) += 100 + rnd(100)
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 657 | _switch_sw) {
		_switch_sw = 0
		throwsstpevent "Mewmewmew", cc, "", 0
		ctalk cc, 427, cc, tc
		if (stat == 0) {
			txtef 4
			txt -1, lang("うみみゃぁ！", "Mewmewmew!")
		}
		nodropbodyparts = 1
		if (areaId(gCurrentMap) != 30 | cfg_NC_workshortening != 2) {
			animeid = 19
			animode = 0
			gosub *label_0630
		}
		repeat 245
			if (cState(cc) != 1) {
				continue
			}
			if (cState(cnt) != 1) {
				continue
			}
			if (cc == cnt) {
				continue
			}
			tc = cnt
			dmghp tc, 9999999, cc
		loop
		ctalk cc, 428, cc, tc
		nodropbodyparts = 0
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 656 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(cc, -1)) {
			ctalk cc, 427, cc, tc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は仲間を鼓舞した。", name(cc) + " cheer" + _s(cc) + ".")
			}
		}
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (cc == cnt) {
				continue
			}
			tc = cnt
			if ((cc != 0 | eqfaction(tc, "pcchild") == 0) & cRelationship(cc) != cRelationship(tc)) {
				continue
			}
			dx = cX(tc)
			dy = cY(tc)
			if (dist(cX(cc), cY(cc), dx, dy) > sdataref(3, 656) \ 1000 + 1) {
				continue
			}
			if (fov_los(cX(cc), cY(cc), dx, dy) == 0) {
				continue
			}
			if (synccheck(tc, -1)) {
				txtef 4
				txt -1, lang(name(tc) + "は興奮した！", name(tc) + " " + is(tc) + " excited!")
			}
			addbuff tc, 5, sdata(17, cc) * 5 + 50, 15
			addbuff tc, 7, sdata(17, cc) * 5 + 100, 60
			addbuff tc, 18, 1500, 30
		loop
		ctalk cc, 428, cc, tc
		workshortf = 0
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 910 | _switch_sw) {
		_switch_sw = 0
		txtef 4
		ctalk cc, 966, cc, tc
		if (stat == 0) {
			txtef 4
			txt -1, lang("破滅の手！", "Crash Hand!")
		}
		repeat 245
			if (cState(cc) != 1) {
				continue
			}
			if (cState(cnt) != 1) {
				continue
			}
			if (cc == cnt) {
				continue
			}
			tc = cnt
			if (relationbetween(cc, tc) != (-3)) {
				continue
			}
			dx = cX(tc)
			dy = cY(tc)
			if (dist(cX(cc), cY(cc), dx, dy) > sdataref(3, 631) \ 1000 + 1 + (ogdata(465) == 2 & cc == 0) + (ogdata(481) == 2 & cc == 0 & (cEquipmentType(cc) & 2) != 0)) {
				continue
			}
			if (fov_los(cX(cc), cY(cc), dx, dy) == 0) {
				continue
			}
			animeid = 9
			dmghp tc, cMaxHp(tc) / 2, cc, 658
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 911 | _switch_sw) {
		_switch_sw = 0
		if (sdata(183, cc) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == 0) + "n't know how to sing.")
				return 0
			}
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, 183) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, 183) / 2 + 1) + sdataref(2, 183) / 2 + 1
		}
		cContinuousActionId(cc) = 30006
		cContinuousActionTurn(cc) = 61
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_1368
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 912 | _switch_sw) {
		_switch_sw = 0
		if (sdata(183, cc) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == 0) + "n't know how to sing.")
				return 0
			}
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, 183) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, 183) / 2 + 1) + sdataref(2, 183) / 2 + 1
		}
		cContinuousActionId(cc) = 30007
		cContinuousActionTurn(cc) = 61
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_1368
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 913 | _switch_sw) {
		_switch_sw = 0
		if (sdata(183, cc) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == 0) + "n't know how to sing.")
				return 0
			}
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, 183) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, 183) / 2 + 1) + sdataref(2, 183) / 2 + 1
		}
		cContinuousActionId(cc) = 30008
		cContinuousActionTurn(cc) = 61
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_1368
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_reinforcement | _switch_sw) {
		_switch_sw = 0
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, 183) / 2 + 1
					goto *label_1410
				}
			}
		}
		ctalk cc, 427, cc, cc
		if (stat == 0) {
			txt -1, lang("「ガード！ガード！」", "Guards!")
		}
		repeat rnd(3) + 1
			flt
			initlv = limitmin(sorg(152, cc) / 3, 1)
			characreate -1, 76, cX(cc), cY(cc)
			cRelationship(rc) = -1
			cOriginalRelationship(rc) = -1
		loop
		if (synccheck(cc, -1)) {
			ctalk cc, 428, cc, cc
			if (stat == 0) {
				txt -1, lang("ガードが駆けつけてきた。", "Several Guards come out from a portal.")
			}
		}
		goto *label_1403
		_switch_sw++
	}
	if (_switch_val == sId_cutoff | _switch_sw) {
		_switch_sw = 0
		if (cSp(0) < 50) {
			if (cSp(0) < rnd(75)) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp 0, sdataref(2, efid) / 2 + 1
				goto *label_1410
			}
		}
		cw = find_eq(cc, 10002)
		if (cw != (-1)) {
			if (iId(cw) == 224 | iId(cw) == 741 | iId(cw) == 266 | iId(cw) == 57) {
				ctalk cc, 427, cc, tc
				if (stat == 0) {
					txt -1, lang(name(cc) + "は居合切りを繰り出した。", name(cc) + " perform a surgical strike.")
				}
				multicritical = 1
				attack_weakGuard
				gosub *label_1442
				gosub *label_1848
				ctalk cc, 428, cc, tc
				efid = 0
				goto *label_1410
			}
		}
		cw = 0
		msgdup++
		txt -1, lang("刀を装備していない。", "You need to equip a katana.")
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_robbery | _switch_sw) {
		_switch_sw = 0
		if (cSp(0) < 50) {
			if (cSp(0) < rnd(75)) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp 0, sdataref(2, efid) / 2 + 1
				goto *label_1410
			}
		}
		attack_weakGuard
		ctalk cc, 427, cc, tc
		if (stat == 0) {
			txt -1, lang(name(cc) + "は強奪を仕掛けようとした。", name(cc) + " tried to rob.")
		}
		p = rndex(cGold(tc) / 5 + 1)
		if (rnd(sdata(13, tc)) > rnd(sdata(12, cc) * 4) | cbit(15, tc) == 1) {
			txt -1, lang(name(tc) + "は自分の財布を守った。", name(tc) + " guard" + _s(tc) + " " + his(tc) + " wallet from a thief.")
			p = 0
		}
		if (p != 0) {
			snd 12
			cGold(tc) -= p
			txt -1, lang(name(cc) + "は" + name(tc) + "から" + p + "枚の金貨を奪った。", name(cc) + " steal" + _s(cc) + " " + p + " gold pieces from " + name(tc) + ".")
			se_moneymod cc, p
		}
		gosub *label_1442
		gosub *label_1848
		ctalk cc, 428, cc, tc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_angryblow | _switch_sw) {
		_switch_sw = 0
		if (cSp(0) < 50) {
			if (cSp(0) < rnd(75)) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp 0, sdataref(2, efid) / 2 + 1
				goto *label_1410
			}
		}
		ctalk cc, 427, cc, tc
		attack_weakGuard
		if (stat == 0) {
			txt -1, lang(name(cc) + "は怒りの一撃を繰り出した。", name(cc) + " unleashed a blow of anger.")
		}
		gosub *label_1442
		gosub *label_1848
		txt -1, lang(name(cc) + "は反動を受けた！", name(cc) + " received a reaction!")
		dmghp cc, limit(cHp(cc) / 3, 0, cHp(cc)), -2
		ctalk cc, 428, cc, tc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_swimming | _switch_sw) {
		_switch_sw = 0
		if (cSp(0) < 50) {
			if (cSp(0) < rnd(75)) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp 0, sdataref(2, efid) / 2 + 1
				goto *label_1410
			}
		}
		if (cWet(cc) > 0) {
			ctalk cc, 427, cc, cc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は水の流れを利用した。", name(cc) + " utilized the flow of water.")
			}
			addbuff cc, 5, sdata(185, cc) * 5 + 200, 20
			ctalk cc, 428, cc, cc
		} else {
			if (cc == 0) {
				txt -1, lang("水気が無いと使用できない。", name(cc) + " Cannot be used without water.")
			}
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_shadowalternation | _switch_sw) {
		_switch_sw = 0
		if (cSp(0) < 50) {
			if (cSp(0) < rnd(75)) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp 0, sdataref(2, efid) / 2 + 1
				goto *label_1410
			}
		}
		ctalk cc, 427, cc, cc
		if (stat == 0) {
			txt -1, lang(name(cc) + "は影分身の術を繰り出した。", name(cc) + " performed the shadow clone technique.")
		}
		repeat 229, 16
			if (cState(cnt) != 1) {
				continue
			}
			distance = dist(cX(cnt), cY(cnt), cX(cc), cY(cc))
			if (cRelationship(cnt) == (-3) & distance < 6) {
					if (cOriginalRelationship(cnt) >= (-2)) {
						cHate(cnt) = 0
						cEmotionIcon(cnt) = 21 + 100 * 2
						txt -1, lang(name(cnt) + "は" + name(cc) + "を見失った。", name(cc) + " Too far away.")
					} elseif (cOriginalRelationship(cnt) == (-3)) {
						cRelationship(cnt) = (-2)
						cHate(cnt) = 0
						cEmotionIcon(cnt) = 21 + 100 * 2
						txt -1, lang(name(cnt) + "は" + name(cc) + "を見失った。", name(cc) + " Too far away.")
					}
			}
		loop
		addbuff cc, 5, sdata(152, cc) * 5 + 50, 10
		ctalk cc, 428, cc, cc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_genedeprivation | _switch_sw) {
			_switch_sw = 0
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			attack_weakGuard
			if (tc == 0) {
				txt -1, lang("自分の遺伝子を奪うことは出来ない。", "You try to take bodyparts from yourself.")
				goto *label_1410
			}
			if (cbit(985, tc)) {
				txt -1, lang("吊るしたままでは遺伝子を奪うことは出来ない。", "You can't take bodyparts from a hung creature.")
				goto *label_1410
			}
			if (cHp(tc) > cMaxHp(tc) / 8) {
				txt -1, lang("もっと弱らせないと遺伝子を奪うことは出来ない。", "The target needs to be weakened.")
				goto *label_1410
			}
			if (synccheck(tc, -1)) {
				ctalk cc, 427, cc, tc
				snd 105
				txtef 3
				txt -1, lang(" *ブシュッ* ", "*Gash*")
				if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
					gdata(809) = 2
					txt3rd = 1
					txt -1, lang(name(cc) + "は" + name(tc) + "から遺伝子を奪い", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + " and")
				} else {
					txt -1, lang(name(cc) + "は" + name(tc) + "の遺伝子を奪った。", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + ".")
				}
			}
			dmghp tc, cMaxHp(tc) + 1, cc, 658
			addbuff cc, 12, sdata(151, cc) * 5 + 200, 20
			ctalk cc, 428, cc, tc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_instantreading | _switch_sw) {
			_switch_sw = 0
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			ctalk cc, 427, cc, cc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は魔法書を構えた。", name(cc) + " read a book intensly.")
			}
			addbuff cc, 64, 100, 3 + (sdata(150, cc) / 20)
			ctalk cc, 428, cc, cc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_backshot | _switch_sw) {
			_switch_sw = 0
			gosub *label_1299
			if (stat == (-1)) {
				if (cc == 0) {
					msgdup++
					txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
				}
				goto *label_1410
			}
			if (stat == (-2)) {
				if (cc == 0) {
					msgdup++
					txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
				}
				goto *label_1410
			}
			if (stat == (-3)) {
				if (cc == 0) {
					msgdup++
					txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
				}
				goto *label_1410
			}
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			ctalk cc, 427, cc, tc
			gosub *label_1441
			repeat 200
				cNextX(cc) = rnd(mapWidth - 2) + 1
				cNextY(cc) = rnd(mapHeight - 2) + 1
				_dis = dist(cX(cc), cY(cc), cNextX(cc), cNextY(cc))
				if (_dis > 7 | _dis < 4) {
					continue
				}
				cell_check cNextX(cc), cNextY(cc)
				if (cellaccess == 1) {
					if (synccheck(cc, -1)) {
						snd 72
						txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
					}
					rowactend cc
					redraw 0
					gosub *label_0623
					break
				}
			loop
			ctalk cc, 428, cc, tc
			gosub *label_1367
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_inspiringcommand | _switch_sw) {
		_switch_sw = 0
		if (cSp(0) < 50) {
			if (cSp(0) < rnd(75)) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp 0, sdataref(2, efid) / 2 + 1
				goto *label_1410
			}
		}
		ctalk cc, 427, cc, cc
		if (stat == 0) {
			txt -1, lang(name(cc) + "は奮起の号令を行った！", name(cc) + " issued an inspirational command!")
		}
		f = 0
		repeat 15, 1
			if (cState(cnt) == 6) {
				rc = cnt
				gosub *label_0738
				cxinit = cX(cc)
				cyinit = cY(cc)
				place_chara rc, cxinit, cyinit
				cCurrentMap(rc) = 0
				txtef 5
				txt -1, cnven(cdatan(0, rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
				ctalk rc, 1263, rc, cc
				if ( stat == 0 ) {
					txt rc, lang("「ありがとう！」", cnvtalk("Thanks!"))
				}
				f += 1
				animeid = 19
				animode = 100 + rc
				gosub *label_0630
				snd 120
				cEmotionIcon(rc) = 17 + 100 * 3
				if (cc == 0) {
					modimp rc, 10
				}
				p = 10, 11, 12, 17, 18, 14, 13, 16, 15, 19, -1
				repeat
					if (p(cnt) == (-1)) {
						break
					}
					i = p(cnt) + 240 - 10
					cdata(i, rc) -= sorgEx(p(cnt), rc) / 4
				loop
			}
		loop
		animeload 11, cc
		addbuff cc, 1, sdata(152, cc) * (2 + (f * 2)) + 50, 15
		addbuff cc, 7, sdata(152, cc) * (2 + (f * 2)) + 50, 15
		f = 0
		ctalk cc, 428, cc, cc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_punishment | _switch_sw) {
			_switch_sw = 0
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			ctalk cc, 427, cc, cc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は敵に神罰を下そうとした。", name(cc) + " tried to punish the enemy.")
			}
			repeat 229, 16
				if (cState(cnt) != 1) {
					continue
				}
				distance = dist(cX(cnt), cY(cnt), cX(cc), cY(cc))
				if (cRelationship(cnt) == (-3) & distance < 6) {
						addbuff cnt, 13, sdata(181, cc) * 5 + 100, 10 + (sdata(181, cc) / 5)
						snd 117
						animeload 14, cnt
				}
			loop
			ctalk cc, 428, cc, cc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_battlefielddance | _switch_sw) {
			_switch_sw = 0
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			ctalk cc, 427, cc, cc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は舞を踊った。", name(cc) + " danced a dance.")
			}
			f = 0
			repeat 229, 16
				if (cState(cnt) != 1) {
					continue
				}
				distance = dist(cX(cnt), cY(cnt), cX(cc), cY(cc))
				if (cRelationship(cnt) == (-3) & distance < 6) {
						f += 1
				}
			loop
			animeload 11, cc
			addbuff cc, 5, (sdata(173, cc) * (f * 2 + 1)) + 50, 15
			if (f >= 3) {
				addbuff cc, 7, (sdata(173, cc) * (f * 2 + 1)) + 50, 15
			}
			if (f >= 5) {
				addbuff cc, 1, (sdata(173, cc) * (f * 2 + 1)) + 50, 15
			}
			f = 0
			ctalk cc, 428, cc, cc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_guide | _switch_sw) {
			_switch_sw = 0
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			ctalk cc, 427, cc, cc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は感覚を研ぎ澄ませた。", name(cc) + " sharpened your senses.")
			}
				repeat mapHeight
					y = cnt
					repeat mapWidth
						x = cnt
						p = dist(cX(cc), cY(cc), x, y)
						if (p < 16) {
								map(x, y, 2) = map(x, y, 0)
								if (map(x, y, 6) != 0 | map(x, y, 5) != 0) {
									mapbitmod 0, x, y, 1
								}
						}
					loop
				loop
			txt -1, lang(name(cc) + "は周囲の地形を察知した。", name(cc) + " sense" + _s(cc) + " nearby locations.")
			animeload 10, cc
			redraw 0
			gosub *label_0622
			ctalk cc, 428, cc, cc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_pleasant | _switch_sw) {
			_switch_sw = 0
			if (tc == cc) {
				txt -1, lang("それは無理だ。", "It's impossible.")
				goto *label_1410
			}
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			ctalk cc, 427, cc, tc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は" + name(tc) + "を魅了した。", name(cc) + " seduce" + name(tc))
				cEmotionIcon(tc) = 17 + 100 * 3
			}
			gosub *label_1369
			ctalk cc, 428, cc, tc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_charisma | _switch_sw) {
			_switch_sw = 0
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			ctalk cc, 427, cc, tc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は" + name(tc) + "をじっと見据えた。", name(cc) + " stare at" + name(tc))
			}
			if (gCurrentMap == 6 | gCurrentMap == 40 | gCurrentMap == 49 | gCurrentMap == 210 | oabit(17, gCurrentMap) | oabit(18, gCurrentMap)) {
				obvious = 0
				txt -1, lang("この場所では効果がない。", "The effect doesn't work in this area.")
				goto *label_1410
			}
			f = 1
			if (findfaction(tc, "family", "wild") & trophycheck(12) == 2) {
				f = 1
			}
			if ((sdata(156, cc) / 5) < cLevel(tc)) {
				f = 0
			}
			if (cQuality(tc) >= 4 | cRole(tc) != 0 | cbit(976, tc) == 1) {
				f = -1
			}
			if (eqfaction(tc, "nc_sheep")) {
				f = -1
			}
			if (f == 1) {
				rc = tc
				gosub *label_1530
				check_quest
			} else {
				if (f == 0) {
					txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
				} else {
					txt -1, lang(name(tc) + "は支配できない。", name(tc) + " cannot be charmed.")
				}
			}
			ctalk cc, 428, cc, tc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_zenithrow | _switch_sw) {
			_switch_sw = 0
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, efid) / 2 + 1
					goto *label_1410
				}
			}
			f = 0
			if (cGold(cc) > 0) {
				if (cGold(cc) >= (sdata(160, cc) * 100)) {
					f = sdata(160, cc) * 100
				} else {
					f = cGold(cc)
				}
				cGold(cc) -= f
				ctalk cc, 427, cc, tc
				if (stat == 0) {
					txt -1, lang(name(cc) + "は" + name(tc) + "に金貨を投げつけた！", name(cc) + " throw gold coins at" + name(tc))
				}
				animeload 11, tc
				dmghp tc, f / 20, cc, 658
				ctalk cc, 428, cc, tc
			} else {
				txt -1, lang("金貨が足りない。", "Not enough gold coins.")
			}
			f = 0
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_blowofconfidence | _switch_sw) {
		_switch_sw = 0
		cw = -1
		repeat 30
			body = 100 + cnt
			if (cdata(body, cc) \ 10000 == 0) {
				continue
			}
			if (cdata(body, cc) / 10000 == 5) {
				cw = cdata(body, cc) \ 10000 - 1
				if (ibit(17, cw) == 1) {
					break
				}
				cw = -1
			}
		loop
		if (cw != (-1)) {
				txtef 4
				ctalk cc, 427, cc, cc
				if (stat == 0) {
					txtef 4
					txt -1, lang("自信の一撃！", "Swarm!")
				}
				repeat 245
					if (cState(cc) != 1) {
						continue
					}
					if (cState(cnt) != 1) {
						continue
					}
					if (cc == cnt) {
						continue
					}
					tc = cnt
					if (relationbetween(cc, tc) != (-3)) {
						continue
					}
					dx = cX(tc)
					dy = cY(tc)
					if (dist(cX(cc), cY(cc), dx, dy) > sdataref(3, 631) \ 1000 + 1 + (ogdata(465) == 2 & cc == 0) + (ogdata(481) == 2 & cc == 0 & (cEquipmentType(cc) & 2) != 0)) {
						continue
					}
					if (fov_los(cX(cc), cY(cc), dx, dy) == 0) {
						continue
					}
					animeid = 9
					gosub *label_0630
					gosub *label_1442
					gosub *label_1848
				loop
				ctalk cc, 428, cc, cc
		} else {
			cw = 0
			msgdup++
			txt -1, lang("自作武器を装備していない。", "You need to equip a self make weapon.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_fightstep | _switch_sw) {
			_switch_sw = 0
			if (cc == 0) {
				if (cSp(0) < 50) {
					if (cSp(0) < rnd(75)) {
						txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						dmgsp 0, sdataref(2, efid) / 2 + 1
						goto *label_1410
					}
				}
			}
			ctalk cc, 427, cc, tc
			repeat 200
				cNextX(cc) = cX(tc) + rnd(cnt / 20 + 2) - rnd(cnt / 20 + 2)
				cNextY(cc) = cY(tc) + rnd(cnt / 20 + 2) - rnd(cnt / 20 + 2)
				cell_check cNextX(cc), cNextY(cc)
				if (cellaccess == 1) {
					if (synccheck(cc, -1)) {
						snd 72
						txt -1, lang(name(cc) + "は接近した。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
					}
					rowactend cc
					redraw 0
					gosub *label_0623
					break
				}
			loop
			gosub *label_1367
			_dis = dist(cX(cc), cY(cc), cX(tc), cY(tc))
			if (_dis < 2) {
				gosub *label_1442
				gosub *label_1848
				efid = sId_fightstep
				gosub *label_1442
				gosub *label_1848
				efid = sId_fightstep
				gosub *label_1442
				gosub *label_1848
			}
			ctalk cc, 428, cc, tc
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == sId_slamming | _switch_sw) {
		_switch_sw = 0
		if (tc == cc) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			goto *label_1410
		}
		f = -1
		repeat 30
			body = 100 + cnt
			if (cdata(body, tc) \ 10000 == 0) {
				continue
			}
			if (cdata(body, tc) / 10000 == 5) {
				f = cdata(body, tc) \ 10000 - 1
				break
			}
		loop
		if (f == -1) {
			txt -1, lang(name(cc) + "の叩きつけは空振った！", name(cc) + " battering ram strikes out!")
			goto *label_1410
		}
		attack_weakGuard
		ctalk cc, 427, cc, tc
		if (stat == 0) {
			txt -1, lang(name(cc) + "は武器に向かって叩きつけた！", name(cc) + " has slammed into a weapon!")
		}
		dmgmulti = 0.5 + double(sdata(10, cc) + sdata(106, cc) / 5 + sdata(152, cc) * 2) / 40
		dmghp tc, role(iDiceX(f), iDiceY(f), iDamageBonus(f)) * dmgmulti, cc
		ctalk cc, 428, cc, tc
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_wofintimidation) {
		if (cc != 0) {
			txt -1, lang(npcn(cc) + "口笛で威嚇した。", name(cc) + " blow" + _s(cc) + " on the whistle.")
			f = 1
		}
		txtef 9
		txt -1, lang(" *ピーーーー* ", "*Peeeeeeeeeep* ")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		repeat 229, 16
			if (cState(cnt) != 1) {
				continue
			}
			if (cSleep(cnt) != 0) {
				continue
			}
			if (dist(cX(cnt), cY(cnt), cX(cc), cY(cc)) > 10) {
				continue
			}
			if (relationbetween(cc, cnt) >= (-1)) {
				continue
			}
			if (sdata(17, cc) > rnd(cLevel(cnt) + cLevel(cc))) {
				turn_aggro cnt, cc, 80
			}
			if (godcheck(cc) == "dybony") {
				if ((cPietyPoint(cc) / 100) + 1 >= cLevel(cnt)) {
					if (findfaction(cnt, "family", "wild")) {
						dmgcon cnt, 6, rnd(cPietyPoint(cc) / 5 + 1) + 100
					}
				}
			}

		loop
		goto *label_1454
	}
	if (_switch_val == 1131 | _switch_sw) {
		_switch_sw = 0
		if (tc != 0) {
			if (cId(tc) == 222 & cRelationship(tc) == 10 & cImage(tc) != 360) {
				txt -1, lang(name(tc) + "の顔が変異した！", name(tc) + "'s face mutates!")
				animeload 8, tc
				cImage(tc) = 360
				cPortrait(tc) = -1
				goto *label_1410
			}
			if (cId(tc) == 250 & cRelationship(tc) == 10 & cImage(tc) != 500) {
				txt -1, lang(name(tc) + "の姿が変異した！", name(tc) + "'s skin mutates!")
				animeload 8, tc
				if (gCurrentMap == 59) {
					cImage(tc) = 455
				} else {
					cImage(tc) = 500
				}
				cPortrait(tc) = -1
				goto *label_1410
			}
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		snd 64
		if (efstatus >= 0) {
			txtef 2
			txt -1, lang("エーテルの抗体があなたの体内に行き渡った。", "Your Ether Disease is cured greatly.")
			modcorrupt efp * (-10)
		} else {
			txtef 8
			txt -1, lang("エーテルの病菌があなたの体内に行き渡った。", " The Ether Disease spreads around your body.")
			modcorrupt 200
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1148 | _switch_sw) {
		_switch_sw = 0
		if (tc != 0) {
			if (cId(tc) == 222 & cRelationship(tc) == 10) {
				if (cImage(tc) != 360 & efstatus != 1) {
					// 未変異かつ非祝福抗体の場合
					cImage(tc) = 360
					cPortrait(tc) = -1
					animeload 8, tc
				} elseif (cImage(tc) == 360 & efstatus >= 1) {
					// 変異中かつ祝福抗体の場合
					cImage(tc) = 359
					cPortrait(tc) = 13
					animeload 10, tc
				} else {
					// それ以外(変異中かつ非祝福抗体 or 未変異かつ祝福抗体)
					txt -1, lang("何もおきない… ", "Nothing happens...")
					goto *label_1410
				}
				txt -1, lang(name(tc) + "の顔が変異した！", name(tc) + "'s face mutates!")
				goto *label_1410
			}
			if (cId(tc) == 250 & cRelationship(tc) == 10) {
				if (cImage(tc) != 455 & cImage(tc) != 500 & efstatus != 1) {
					animeload 8, tc
					if (gCurrentMap == 59) {
						cImage(tc) = 455
					} else {
						cImage(tc) = 500
					}
					cPortrait(tc) = -1
				} elseif (cImage(tc) == 500 & efstatus >= 1) {
					// 変異中かつ祝福抗体の場合
					cImage(tc) = 390
					cPortrait(tc) = -1
					animeload 10, tc
				} else {
					// それ以外(変異中かつ非祝福抗体 or 未変異かつ祝福抗体)
					txt -1, lang("何もおきない… ", "Nothing happens...")
					goto *label_1410
				}
				txt -1, lang(name(tc) + "の姿が変異した！", name(tc) + "'s skin mutates!")
				goto *label_1410
			}
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		if (efstatus >= 0) {
			gosub *label_SESTItem_EtherCureCorruptionPotion
		} else {
			txtef 8
			txt -1, lang("エーテルの病菌があなたの体内に行き渡った。", " The Ether Disease spreads around your body.")
			modcorrupt 1000
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 633 | _switch_sw) {
		_switch_sw = 0
		if (tc != 0) {
			goto *label_1410
		}
		txtef 8
		ctalk cc, 427, cc, tc
		txt -1, lang(name(cc) + "に睨まれ、あなたはエーテルに侵食された。", name(cc) + " gazes at you. Your Ether Disease deteriorates.")
		ctalk cc, 428, cc, tc
		modcorrupt 100
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 638 | _switch_sw) {
		_switch_sw = 0
		ctalk cc, 427, cc, tc
		ctalk cc, 428, cc, tc
		_switch_sw++
	}
	if (_switch_val == 648 | _switch_sw) {
		_switch_sw = 0
		if (efid == 648) {
			if (synccheck(tc, -1)) {
				ctalk cc, 974, cc, tc
				if (stat == 0) {
					txt -1, lang(name(cc) + "は" + name(tc) + "を罵倒した。", name(cc) + " insult" + _s(cc) + " " + name(tc) + ".")
				}
				txtef 9
				ctalk cc, 1000, cc, tc
				if (stat == 0) {
					ctalk cc, 1203, cc, tc
					if (stat == 0) {
						txtef 9
						if (jp) {
							if (cSex(cc) == 0) {
								txt cc, "「すっこんでろ雑魚め」", "「オマエ程度が戦うだと？」", "「すぐに殺してやるよ」", "「消えろザコめ」", "「このかたつむり野郎」", "「すぐにミンチにしてやるよ」"
							} else {
								if (rnd(2)) {
									txt cc, "「グシャグシャにしてやるわ」", "「地べたを這いずりなさい」", "「ウージッムシ♪ウージッムシ♪」", "「目障りよ」", "「もがけ。苦しめ！」", "「その下品な眼をくりぬくの」"
								} else {
									txt cc, "「このカタツムリが」", "「どうしたの？もう終わりなの？」", "「潔く、くたばりなさい」", "「生まれてきたことを後悔するのね」", "「このブタめ」", "「すぐにミンチにしてあげる」"
								}
							}
						} else {
							if (rnd(2)) {
								txt cc, cnvtalk("You suck!"), cnvtalk("You will die alone."), cnvtalk("Bow down before me."), cnvtalk("Go jump off a bridge."), cnvtalk("Bang your head against the wall!"), cnvtalk("Why do you sniff under your dog's tail?")
							} else {
								txt cc, cnvtalk("The world is against you because you are a unsavory decomposing virus."), cnvtalk("You are no better than a immoral guzzling bureaucrat."), cnvtalk("You are so lowly."), cnvtalk("Get off me.")
							}
						}
					}
				}
			}
		}
		dmgcon tc, 7, 200
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 652 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			ctalk cc, 427, cc, tc
			txt -1, lang(name(cc) + "は" + name(tc) + "を睨み付けた。", name(cc) + " gaze" + _s(cc) + " at " + name(tc) + ".")
			ctalk cc, 428, cc, tc
		}
		dmgmp tc, rnd(20) + 1
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 1133 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "は炎に包まれた。", name(tc) + " " + is(tc) + " surrounded by flames.")
		}
		dim inrange, mapWidth, mapHeight
		searchrangeinit cX(tc), cY(tc), limit(efp / 100 - 1, 0, 20)
		if (stat) {
			repeat mapWidth
				cnt2 = cnt
				repeat mapHeight
					if (inrange(cnt2, cnt)) {
						if ((chipm(7, map(cnt2, cnt, 0)) & 4) == 0) {
							if (rnd(3)) {
								addmef cnt2, cnt, 5, 24, rnd(15) + 25, efp / 2, cc
								mapitem_fire cnt2, cnt
							}
						}
					}
				loop
			loop
		}
		addmef cX(tc), cY(tc), 5, 24, rnd(15) + 25, efp, cc
		mapitem_fire cX(tc), cY(tc)
		return
		_switch_sw++
	}
	if (_switch_val == 651 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			ctalk cc, 427, cc, tc
			txt -1, lang(name(cc) + "は" + name(tc) + "のバックパックを漁った。", name(cc) + " loot" + _s(cc) + " " + name(tc) + your(tc) + " backpack.")
		}
		p = -1
		inv_getheader tc
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iId(cnt) == 618) {
				p = cnt
				break
			}
		loop
		if (p == (-1)) {
			inv_getheader tc
			repeat invrange, invhead
				if (iNumber(cnt) == 0) {
					continue
				}
				if (ibit(5, cnt)) {
					continue
				}
				if (refitem(iId(cnt), 5, cnt) != 57000 & item_isCookedMilk(cnt) == 0) {
					continue
				}
				if (item_isCookedHarb(cnt)) {
					continue
				}
				p = cnt
				break
			loop
		}
		if (p == (-1)) {
			goto *label_1410
		}
		ci = p
		if (ibit(6, ci)) {
			if (synccheck(tc, -1)) {
				txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "の異臭に気付き手をひっこめた。", name(cc) + " notice" + _s(cc) + " unusual odor from " + itemname(ci, 1) + " and step" + _s(cc) + " back.")
			}
			goto *label_1410
		}
		rowact_item ci
		if (synccheck(tc, -1)) {
			snd 18
			txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "を食べた！", name(cc) + " eat" + _s(cc) + " " + itemname(ci, 1) + "!")
			ctalk cc, 428, cc, tc
		}
		healhp cc, cMaxHp(cc) / 3
		gosub *label_1383
		gosub *refreshPCBurdenState
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 464 | _switch_sw) {
		// Wizard's Harvest
		_switch_sw = 0
		animeload 10, tc
		rtval = 0
		if (ogdata(460) == 2) {
			rtval = 0
			txtnew
			txt -1, lang("纏めて唱える？", "Collectively recite?")
			promptl(0, 0) = stryes, "y", "1"
			promptl(0, 1) = strno, "n", "0"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
		}
			hroop = 1
			if (rtval == 1) {
				repeat
					if (spell(efid - 400) < 0) {
						spell(efid - 400) = 0
						break
					}
					spell(efid - 400) -= calcspellcoststock(efid, cc)
					hroop += 1
				loop
			}
			herp = 0
			hert = 0
			herw = 0
			herg = 0
			hergs = 0
			repeat hroop
				if (rtval == 0 | cnt == 0) {
					snd 64
				}
				message@st = ""
				repeat limit(4 + rnd(efp / 50 + 1), 1, 15)
					flt calcobjlv(efp / 10), calcfixlv(3)
					dbid = 54
					p = 400 + rndex2(limit(efp, 1, 2000000))
					if (rnd(30) == 0) {
						dbid = 55
						p = 1
					}
					if (rnd(80) == 0) {
						dbid = 622
						p = 1
					}
					if (rnd(2000) == 0) {
						dbid = 290
						p = 1
					}
					if (rtval == 1) {
						if (dbid == 55) {
							herp++
						}
						if (dbid == 622) {
							hert++
						}
						if (dbid == 290) {
							herw++
						}
						if (dbid == 54) {
							herg(0) = limitmax(herg + p, 2140000000)
							if (herg >= 2140000000) {
								hergs++
								herg = 0
							}
						}
					}
					if (hroop == 1) {
						nostack = 1
						itemcreate -1, dbid, cX(cc), cY(cc), p
						if (stat) {
							message@st += lang(itemname(ci) + "が降ってきた！", itemname(ci) + " fall" + _s2(iNumber(ci)) + " down!")
						}
						if (cfg_animewait > 0) {
							txt -1, message@st
							redraw 1
							message@st = ""
						}
						item_stack -1, ci
					} else {
						if (cnt < 10000 & cnt \ 100 == 0) {
							skillexp2 efid, cc, 200
						}
					}
				loop
				if (cfg_animewait == 0 & rtval == 0) {
					txt -1, message@st
					redraw 1
				}
			loop
			if (rtval == 1) {
				txt -1, lang("沢山のアイテムが降ってきた！", "")
				txtnew
				txt -1, lang("金貨:" + hergs + "スタック + " + herg + "枚 ", "")
				while hergs >= 0
					flt calcobjlv(efp / 10), calcfixlv(3)
					nostack = 1
					itemcreate -1, 54, cX(cc), cY(cc), herg
					item_stack -1, ci
					herg = 2147483647
					hergs--
				wend
				if (herp > 0) {
					flt calcobjlv(efp / 10), calcfixlv(3)
					nostack = 1
					itemcreate -1, 55, cX(cc), cY(cc), herp
					item_stack -1, ci
				}
				if (hert > 0) {
					flt calcobjlv(efp / 10), calcfixlv(3)
					nostack = 1
					itemcreate -1, 622, cX(cc), cY(cc), hert
					item_stack -1, ci
				}
				if (herw > 0) {
					flt calcobjlv(efp / 10), calcfixlv(3)
					nostack = 1
					itemcreate -1, 290, cX(cc), cY(cc), herw
					item_stack -1, ci
				}
				txt -1, lang("プラチナ硬貨:" + herp + "枚 " + "小さなメダル:" + hert + "枚 " + " 願いの杖:" + herw + "本 " , "")
				if (hroop > 10000) {
					hroop = 10000
				}
				if (nc_gettrait(cc, 112) == 0 | rnd(4)) {
					dmgmp cc, mp * (hroop - 1)
				}
			}
			goto *label_1410
			_switch_sw++
	}
	if (_switch_val == 463 | _switch_sw) {
		_switch_sw = 0
		snd 72
		lint_efp = efp * 100
		txt -1, lang("あなたは四次元のポケットを召喚した。(収納可能重量:", "You summon 4 dimensional pocket.(Stowable weight:") + cnvweight(limitmax(lint_efp, INT_MAX)) + ")"
		invfile = 8
		file = "shoptmp.s2"
		ctrlFile 4
		file = "shop" + invfile + ".s2"
		tmpload "" + file
		exist exedir + "tmp\\" + file
		if (strsize != (-1)) {
			ctrlFile 3
			inv_getheader -1
			repeat invrange, invhead
				if (iId(cnt) == 743) {
					getitemid cnt
				}
				checkalter cnt
				if (inv(34, cnt)) {
					getunid4item cnt
				}
			loop
		} else {
			inv_getheader -1
			repeat invrange, invhead
				iNumber(cnt) = 0
			loop
		}
		shoptrade = 0
		menucycle = 1
		invsubroutine = 1
		invctrl = 22, 5
		invcontainer = limit(efp / 10 + 10, 10, 300)
		mode = 6
		snd 100
		gosub *label_1280
		invcontainer = 0
		file = "shop" + invfile + ".s2"
		ctrlFile 4
		file = "shoptmp.s2"
		ctrlFile 3
		mode = 0
		goto *label_1410
	}
	// 充填(魔法)
	if (_switch_val == 503 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		f = 0
		invsubroutine = 1
		invctrl = 23, 3
		snd 100
		gosub *label_1280
		f = stat
		if (f == 1) {
			dbid = iId(ci)
			cibkref = ci
			dbmode = 2
			gosub *label_2426
			orgichargelevel = ichargelevel
			if (ichargelevel < 1 | (iId(ci) == 290 & ogdata(515) != 2) | iId(ci) == 480 | iId(ci) == 289 | iId(ci) == 732 | (iId(ci) == 687 & iParam2(ci) != 0) | (iQuality(ci) == 6 & iId(ci) != 798)) {
				txt -1, lang("それは充填ができないようだ。", "You can't recharge this item.")
				item_autostack cc, ci
				goto *label_1410
			}
			if (reftype == 54000) {
				if (iId(ci) != 697 & iId(ci) != 434 & iId(ci) != 696 & iId(ci) != 481 & iId(ci) != 289 & iId(ci) != 252) {
					ichargelevel *= 2
				}
			}
			if (reftype == 56000 & iEnhancement(ci) > 0) {
				ichargelevel += ichargelevel / 2 * iEnhancement(ci) + 1
			}
			f = 1
			if (iCount(ci) > ichargelevel) {
				f = -1
			}
			if (iId(ci) == 290 & iCount(ci) < iEnhancement(ci)) {
				f = 1
			}
			if (f == (-1)) {
				txt -1, lang(itemname(ci) + "はこれ以上充填できないようだ。", itemname(ci) + " cannot be recharged anymore.")
				item_autostack cc, ci
				goto *label_1410
			}
			p = 1 + rnd(orgichargelevel / 2 + 1) + iEnhancement(ci) / 5
			if (p + iCount(ci) > ichargelevel) {
				p = ichargelevel - iCount(ci) + 1
			}
			if (refitem(iId(ci), 5, ci) == 54000) {
				p = 1
			}
			if (iId(ci) == 290) {
				p = limit(sdata(174, cc) / 1000 , 1, iEnhancement(ci) - iCount(ci))
			}
			txt -1, lang(itemname(ci) + "は充填された(+" + p + ")", itemname(ci) + " " + is2(iNumber(ci)) + " recharged by +" + p + ".")
			iCount(ci) += p
			item_autostack cc, ci
			animeload 8, cc
		}
		goto *label_1410
		_switch_sw++
	}
	// 劣悪変化(魔法)
	if (_switch_val == 505 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		nc_intb_100 = calcspellfail(505, 0)
		efp = 10
		invsubroutine = 1
		invctrl = 23, 0
		snd 100
		gosub *label_1280
		f = stat
		equip = iBodyPart(ci)
		if (f == 1) {
			if (iQuality(ci) == 6) {
				txt -1, lang("アーティファクトの再生成にはパワーが足りない。", "More magic power is needed to reconstruct an artifact.")
				goto *label_1410
			} else {
				*label_loopmat2
				animeload 8, cc
				if (rnd(3) == 0) {
					fixmaterial = 35
				}
				s = itemname(ci, 1, 1)
				nc_intb_101 = iPv(ci)
				nc_intb_102 = iDv(ci)
				nc_intb_103 = iDamageBonus(ci)
				nc_intb_104 = iHitBonus(ci)
				nc_intb_105 = iDiceX(ci)
				nc_intb_106 = iDiceY(ci)
				nc_intb_107 = iMaterial(ci)
				nc_intb_108 = iValue(ci)
				objlv = 0
				objfix = efp / 100
				randomize
				gosub *label_0315
				txt -1, lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
				if (nc_intb_100 == 100) {
					transformsstat
					txtnew
					txt -1, lang("もう一度変化させる？", "Try again?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					valhinan = val
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval == 0) {
						if (spell(505 - 400) == 0) {
							txt -1, lang("劣悪変化のストックがなくなったため、連続使用を中止した。", "There is no stock of Pooriation.")
							if (equip != 0) {
								cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
								iBodyPart(ci) = equip
							}
							r1 = cc
							gosub *chara_refresh
							fixmaterial = 0
							objfix = 0
							goto *label_1410
						}
						if (99 >= calcspellfail(505, 0)) {
							msgdup++
							txt -1, lang("成功率が100%ではなくなったため、連続使用を中止した。", "The success rate was no longer 100%, so continuous use was discontinued.")
							if (equip != 0) {
								cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
								iBodyPart(ci) = equip
							}
							r1 = cc
							gosub *chara_refresh
							fixmaterial = 0
							objfix = 0
							goto *label_1410
						}
						spell(505 - 400) -= calcspellcoststock(505, 0)
						if (spell(505 - 400) < 0) {
							spell(505 - 400) = 0
						}
						mp = calcspellcostmp(505, 0)
						if (godcheck(0) == "ehekatl") {
							graceofgod = cPietyPoint(0) / 500
							if (graceofgod > 40) {
								graceofgod = 40
							}
							mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
						}
						nc_intb_001 = 0
						nc_intb_002 = 0
						nc_intb_003 = 0
						repeat 30, 100
							dup roopbuf, cdata(cnt, 0)
							if (roopbuf \ 10000 == 0) {
								continue
							}
							nc_intb_002 = roopbuf \ 10000 - 1
							if (inv(37, nc_intb_002) == 7) {
								nc_intb_001 += iBigenchantmentPower(nc_intb_002)
								continue
							}
							if (inv(37, nc_intb_002) == 8) {
								nc_intb_003 += iBigenchantmentPower(nc_intb_002)
								continue
							}
						loop
						if (nc_intb_001 > 0) {
							mp = mp * (100 - nc_intb_001) / 100
						}
						if (nc_intb_003 > 0) {
							healamo = (mp / 100) * nc_intb_003
							healhp 0, healamo
							if (showdamagecheck(healamo)) {
								if (synccheck(tc, -1)) {
									mondmgn(mondmgcnt) = "" + healamo
									mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, 0, 0
									ccolor 110
									if (stat == 0) {
										mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
									}
									mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
								}
							}
						}
						if (nc_gettrait(cc, 112) == 0 | rnd(4)) {
							dmgmp 0, mp
						}
						if (cState(0) != 1) {
							efsource = 0
							magiccritical = 0
							return 1
						}
						cc = ccbk
						r1 = cc
						r2 = spellbk
						gosub *label_0669
						goto *label_loopmat2
					}
				}
			}
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		if (equip != 0) {
			cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
			iBodyPart(ci) = equip
		}
		r1 = cc
		gosub *chara_refresh
		fixmaterial = 0
		objfix = 0
		goto *label_1410
		_switch_sw++
	}
	// 素材変化(魔法)
	if (_switch_val == 506 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1410
		}
		nc_intb_100 = calcspellfail(506, 0)
		efp = 180
		invsubroutine = 1
		invctrl = 23, 0
		snd 100
		gosub *label_1280
		f = stat
		if (iQuality(ci) == 5 | ibit(10, ci) == 1) {
			f = 0
		}
		equip = iBodyPart(ci)
		if (f == 1) {
			if (iQuality(ci) == 6) {
				txt -1, lang("アーティファクトの再生成にはパワーが足りない。", "More magic power is needed to reconstruct an artifact.")
				goto *label_1410
			} else {
				*label_loopmat3
				animeload 8, cc
				if (efp <= 70) {
					if (rnd(3) == 0) {
						fixmaterial = 35
					}
				}
				s = itemname(ci, 1, 1)
				nc_intb_101 = iPv(ci)
				nc_intb_102 = iDv(ci)
				nc_intb_103 = iDamageBonus(ci)
				nc_intb_104 = iHitBonus(ci)
				nc_intb_105 = iDiceX(ci)
				nc_intb_106 = iDiceY(ci)
				nc_intb_107 = iMaterial(ci)
				nc_intb_108 = iValue(ci)
				objlv = 0
				objfix = efp / 100
				randomize
				gosub *label_0315
				txt -1, lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
				if (nc_intb_100 == 100) {
					transformsstat
					txtnew
					txt -1, lang("もう一度変化させる？", "Try again?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					valhinan = val
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval == 0) {
						if (spell(506 - 400) == 0) {
							txt -1, lang("素材変化のストックがなくなったため、連続使用を中止した。", "There is no stock of Pooriation.")
							if (equip != 0) {
								cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
								iBodyPart(ci) = equip
							}
							r1 = cc
							gosub *chara_refresh
							fixmaterial = 0
							objfix = 0
							goto *label_1410
						}
						if (99 >= calcspellfail(506, 0)) {
							msgdup++
							txt -1, lang("成功率が100%ではなくなったため、連続使用を中止した。", "The success rate was no longer 100%, so continuous use was discontinued.")
							if (equip != 0) {
								cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
								iBodyPart(ci) = equip
							}
							r1 = cc
							gosub *chara_refresh
							fixmaterial = 0
							objfix = 0
							goto *label_1410
						}
						spell(506 - 400) -= calcspellcoststock(505, 0)
						if (spell(506 - 400) < 0) {
							spell(506 - 400) = 0
						}
						mp = calcspellcostmp(506, 0)
						if (godcheck(0) == "ehekatl") {
							graceofgod = cPietyPoint(0) / 500
							if (graceofgod > 40) {
								graceofgod = 40
							}
							mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
						}
						nc_intb_001 = 0
						nc_intb_002 = 0
						nc_intb_003 = 0
						repeat 30, 100
							dup roopbuf, cdata(cnt, 0)
							if (roopbuf \ 10000 == 0) {
								continue
							}
							nc_intb_002 = roopbuf \ 10000 - 1
							if (inv(37, nc_intb_002) == 7) {
								nc_intb_001 += iBigenchantmentPower(nc_intb_002)
								continue
							}
							if (inv(37, nc_intb_002) == 8) {
								nc_intb_003 += iBigenchantmentPower(nc_intb_002)
								continue
							}
						loop
						if (nc_intb_001 > 0) {
							mp = mp * (100 - nc_intb_001) / 100
						}
						if (nc_intb_003 > 0) {
							healamo = (mp / 100) * nc_intb_003
							healhp 0, healamo
							if (showdamagecheck(healamo)) {
								if (synccheck(tc, -1)) {
									mondmgn(mondmgcnt) = "" + healamo
									mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, 0, 0
									ccolor 110
									if (stat == 0) {
										mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
									}
									mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
								}
							}
						}
						if (nc_gettrait(cc, 112) == 0 | rnd(4)) {
							dmgmp 0, mp
						}
						if (cState(0) != 1) {
							efsource = 0
							magiccritical = 0
							return 1
						}
						cc = ccbk
						r1 = cc
						r2 = spellbk
						gosub *label_0669
						goto *label_loopmat3
					}
				}
			}
		} else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		if (equip != 0) {
			cdata(equip, cc) = cdata(equip, cc) / 10000 * 10000 + ci + 1
			iBodyPart(ci) = equip
		}
		r1 = cc
		gosub *chara_refresh
		fixmaterial = 0
		objfix = 0
		goto *label_1410
		_switch_sw++
	}
	// 脱倦怠感
	if (_switch_val == 507 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "のスタミナが回復した。", name(tc) + " restore" + _s(tc) + " stamina.")
		}
		healdmg = role(dice1, dice2, bonus)
		healsp tc, healdmg
		if (showdamagecheck(healdmg)) {
			if (synccheck(tc, -1)) {
				mondmgn(mondmgcnt) = "*" + healdmg + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		animeid = 5
		gosub *label_0630
		goto *label_1410
		_switch_sw++
	}
	// 空腹充足
	if (_switch_val == 508 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "の空腹が癒えた。", name(tc) + " hunger was quenched.")
		}
		if (cNutrition(0) < 15000) {
			cNutrition(0) = 15000
		}
		animeid = 5
		gosub *label_0630
		goto *label_1410
		_switch_sw++
	}
	// リフレッシュ
	if (_switch_val == 510 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "の状態異常が癒えた。", name(tc) + " malfunction was quenched.")
		}
		cPoisoned(tc) = 0
		cSleep(tc) = 0
		cConfused(tc) = 0
		cBlind(tc) = 0
		if (gettrait(tc, 195) != 0) {
			cBlind(tc) = 1000
		}
		cParalyzed(tc) = 0
		cStoned(tc) = 0
		cChoked(tc) = 0
		cDimmed(tc) = 0
		cDrunk(tc) = 0
		cBleeding(tc) = 0
		cGravity(tc) = 0
		if (have_bigench(tc, 11) == 0) {
			cAphrodisiac(tc) = 0
			cSick(tc) = 0
		}
		animeid = 5
		gosub *label_0630
		goto *label_1410
		_switch_sw++
	}
	// 石化の視線
	if (_switch_val == 511 | _switch_sw) {
		_switch_sw = 0
		charastone cc, tc, efp
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 661 | _switch_sw) {
		_switch_sw = 0
		cw = -1
		repeat 30
			body = 100 + cnt
			if (cdata(body, cc) \ 10000 == 0) {
				continue
			}
			if (cdata(body, cc) / 10000 == 10) {
				cw = cdata(body, cc) \ 10000 - 1
			}
		loop
		if (cw != (-1)) {
			if (iSkill(cw) == 110 | nc_atk_loopf) {
				gosub *label_1299
				if (stat == (-1)) {
					if (cc == 0) {
						msgdup++
						txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
					}
					return 0
				}
				if (stat == (-2)) {
					if (cc == 0) {
						msgdup++
						txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
					}
					return 0
				}
				if (stat == (-3)) {
					if (cc == 0) {
						msgdup++
						txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
					}
					return 0
				}
				txtef 4
				ctalk cc, 963, cc, tc
				if (stat == 0) {
					txtef 4
					txt -1, lang("みだれうち！", "Rapid shot!")
				}
				*label_RapidR
				p = 8
				if (godcheck(cc) == "mani") {
					p += limit(sqrt(cPietyPoint(cc)) / 100, 1, 10)
				}
				p = rnd(p) + 1
				if (ogdata(452) == 2 & godcheck(cc) == "mani") {
					p = 8 + limit(sqrt(cPietyPoint(cc)) / 100, 1, 10) + 1
				}
				repeat p
					listmax = 0
					repeat 229, 16
						if (cState(cnt) != 1) {
							continue
						}
						if (synccheck(cnt, -1) == 0) {
							continue
						}
						if (cRelationship(cnt) >= 0) {
							continue
						}
						x = cX(cnt)
						y = cY(cnt)
						if (fov_los(cX(cc), cY(cc), x, y) == 0) {
							continue
						}
						if (cbit(6, cnt) == 1) {
							if (cbit(7, cc) == 0) {
								if (cWet(cnt) == 0) {
									continue
								}
							}
						}
						list(0, listmax) = cnt
						listmax++
					loop
					if (listmax == 0) {
						break
					}
					tc = list(0, rnd(listmax))
					gosub *label_1441
				loop
				if (trophycheck(9) == 2 & rnd(3) == 0) {
					txtef 4
					txt -1, lang("もう一回！", "One more shot!")
					goto *label_RapidR
				}
				goto *label_1410
			}
		}
		cw = 0
		if (cc == 0) {
			msgdup++
			txt -1, lang("銃を装備していない。", "You need to equip a gun.")
		}
		return 0
	}
	if (_switch_val == 662 | _switch_sw) {
		_switch_sw = 0
		attack_weakGuard // from Eat
		if (cc == 0) {
			if (tc != 0) {
				if (cRelationship(tc) == 10 | cRole(tc) == 10001 | cRole(tc) == 10018 | eqfaction(tc, "petshop")) {
					txt -1, lang("仲間は食べたくない。", "You don't want to eat your ally.")
					goto *label_1410
				}
				if (ocbit(7, tc)) {
					txt -1, lang("これは幻だ。", "Phantom cannot be eaten.")
					goto *label_1410
				}
			}
			if (cNutrition(cc) > 10000 | gettrait(cc, 191) < 0) {
				txt -1, lang("今はとても食べられない。", "Your are too full to eat."), lang("腹がさける…", "You are too bloated to eat any more."), lang("まだ腹は減っていない。", "Your stomach can't digest any more.")
				goto *label_1410
			}
		} else {
			txt -1, lang(name(tc) + "は" + name(cc) + "に食らい付かれた。", name(tc) + " is eaten by " + name(cc) + ".")
		}
		if (cbit(985, tc)) {
			if (cc == 0) {
				txt -1, lang("吊るしたままでは食べられない。", "Target needs to be released before devouring.")
			}
			goto *label_1410
		}
		if (tc == cc) {
			if (cc == 0) {
				txt -1, lang(name(cc) + "は自分を食べようとした。", "You try to eat yourself.")
			}
			goto *label_1410
		}
		if (cHp(tc) > cMaxHp(tc) / 8) {
			if (cc == 0) {
				txt -1, lang("もっと弱らせないと食べられない。", "The target needs to be weakened.")
			} else {
				txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			}
			goto *label_1410
		}
		if (synccheck(tc, -1)) {
			snd 18
			ctalk cc, 1347, cc, tc
			if ( stat == 0 ) {
				txtef 4
				txt -1, lang(" *んがぐっぐ* ", "*Gash*")
			}
			ctalk tc, 1349, tc, cc
			if (tc >= 16) {
				gdata(809) = 2
				txt3rd = 1
				txt -1, lang(name(cc) + "は" + name(tc) + "を食べて", name(cc) + " eats " + name(tc))
			} else {
				txt -1, lang(name(cc) + "は" + name(tc) + "を食べた。", name(cc) + " swallows " + name(tc) + " whole.")
			}
		}
		nodropbodyparts = 2
		dmghp tc, cMaxHp(tc) + 1, cc, 658
		nodropbodyparts = 0
		if (gettrait(cc, 45) == 0) {
			dmgsan cc, 15
			dmgcon cc, 11, 150
		}
		if (gCurrentMap != 35) {
			dim fdlist, 2, 10
			repeat fdmax
				fdlist(0, cnt) = 0, 0
			loop
			fdmax = 0
			if (fdmax < 10) {
				fdlist(0, fdmax) = 10, 30
				fdmax++
			}
			if (fdmax < 10) {
				fdlist(0, fdmax) = 11, 40
				fdmax++
			}
			if (fdmax < 10) {
				fdlist(0, fdmax) = 17, 10
				fdmax++
			}
			nutrition = 3500
			if (cId(tc) == 344) {
				ctalk cc, 1247, cc, cc
				if (stat == 0) {
					txt cc, lang("「いただきマンモス」", cnvtalk("Let's eatammoth."))
				}
			}
			if (cc == 0) {
				s = refchara(cId(tc), 8, 1)
				if (instr(s, 0, "/man/") != (-1)) {
					ncgdata(67)++
					if (gettrait(0, 41)) {
						ctalk cc, 1275, cc, cc
						if ( stat == 0 ) {
							txt -1, lang("ウマイ！", "Delicious!")
						}
						txt -1, lang("これはあなたの大好きな人肉だ！", "It's your favorite human flesh!")
					} else {
						if (ogdata(492) == 2) {
							txt -1, lang("これは人肉だ…が、あなたは特に気にならなかった。", "This is human flesh... however, you don't particularly mind the taste.")
						} else {
							txt -1, lang("これは人肉だ…うぇぇ！", "Eeeek! It's human flesh!")
							dmgsan cc, 15
							dmgcon cc, 11, 150
						}
						if (gettrait(0, 41) == 0) {
							if (rnd(5) == 0) {
								tid = 41
								traitmode = 0
								r1 = 0
								gosub *label_0097
								txtef 2
								txt -1, traitrefn(0)
								settrait 0, 41, 1
							}
						}
					}
					ogdata(433)++
					gosub *label_1177
				} else {
					if (gettrait(0, 41)) {
						txt -1, lang("人肉の方が好みだが…", "You would've rather eaten human flesh.")
						nutrition = nutrition * 2 / 3
					}
				}
			}
			dbmode = 12
			dbid = cId(tc)
			gosub *label_2067
			repeat fdmax
				i = 2000
				if (cNutrition(cc) >= 5000) {
					p = (cNutrition(cc) - 5000) / 25
					i = i * 100 / (100 + p)
				}
				if (cc != 0) {
					i = 2000
				}
				if (i > 0) {
					skillexp fdlist(0, cnt), cc, fdlist(1, cnt) * i / 100
				}
			loop
			if (cdatan(2, tc) == "servant") {
				txtef 3
				txt -1, lang("使徒を…食ってる…", "It's eating...the Angel...?")
				repeat 245
					if (cState(cnt) != 1) {
						continue
					}
					if (synccheck(cc, -1)) {
						if (cVisionFlag(cnt) != msync) {
							continue
						}
					} else {
						if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3) {
							continue
						}
					}
					if (cnt == cc) {
						continue
					}
					if (rnd(3)) {
						continue
					}
					chara_vomit cnt
				loop
			}
			if (cId(tc) == 28) {
				evadd 18, cc
			}
			if (cId(tc) == 29) {
				txt -1, lang("ロイターの肩は最高だ。。", "Loyter's shoulder is the best.")
				skillexp 111, cc, 500
			}
			if (cId(tc) == 31) {
				txt -1, lang("シーナの尻は最高だ。", "Shena's ass is the best.")
			}
			if (cId(tc) == 34) {
				txt cc, lang("「…本当に食べてしまったのか？」", "\"...err..you really ate that thing? Oh well..\"")
			}
			if (cId(tc) == 237 | cId(tc) == 244 | cId(tc) == 245 | cId(tc) == 321) {
				tlocx = cX(cc)
				tlocy = cY(cc)
				efid = 644
				tcbk = tc
				gosub *label_1398
				tc = tcbk
			}
			if (cId(tc) == 278) {
				efid = 454
				efp = 100
				tcbk = tc
				tc = cc
				gosub *label_1398
				tc = tcbk
			}
			if (cId(tc) == 319) {
				if (cRole(tc) != 13) {
					txtef 2
					txt -1, lang(name(cc) + "は進化した。", name(cc) + " evolve" + _s(cc) + ".")
					skillmod 2, cc, 1000
					skillmod 3, cc, 1000
					repeat 400 - 100, 100
						if (sdataref(0, cnt) == 0 | sorg(cnt, cc) == 0) {
							continue
						}
						modgrowth2 cc, cnt, rnd(10) + 1
					loop
				}
			}
			if (cbit(23, tc) | cbit(27, tc)) {
				txtef 2
				txt -1, lang(cdatan(0, tc) + "は腹の中で分裂した！", cdatan(0, tc) + " split" + _s(tc) + " in " + name(cc) + your(cc) + " stomach!")
				nutrition *= 10
			}
			if (cc == 0) {
				if (cId(tc) == 176 | cId(tc) == 249) {
					repeat 15
						if (cfg_youngersistervoice != 0 & isyoungersistervoice != 0) {
							if (rnd(2) == 0) {
								snd 150 + (cSex(0) == 1)
							}
							await 100
						}
						txtef 20
						if (jp) {
							txt -1, "「" + _onii(cSex(0)) + "ちゃんー」", "「" + _onii(cSex(0)) + "ちゃん！」", "「" + _onii(cSex(0)) + "ちゃ〜ん」", "「" + _onii(cSex(0)) + "ちゃんっ」", "「" + _onii(cSex(0)) + "ちゃん？」", "「" + _onii(cSex(0)) + "〜ちゃん」", "「" + _onii(cSex(0)) + "ちゃん♪」"
						} else {
							txt -1, "\"" + _onii(cSex(0)) + "chan-\"", "\"" + _onii(cSex(0)) + "chan!\"", "\"" + _onii(cSex(0)) + "chaa~n\"", "\"" + _onii(cSex(0)) + "chan\"", "\"" + _onii(cSex(0)) + "chan?\"", "\"" + _onii(cSex(0)) + "~chan\"", "\"" + _onii(cSex(0)) + "chan♪\""
						}
					loop
				}
				if (cId(tc) == 213) {
					modkarma 0, 5
				}
				p = cAiHeal(tc)
				if (p >= 400 & p < 600) {
					snd 24
					skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sdata(165, cc) + (sdata(165, cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
					txtef 2
					txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", s + "You gain knowledge of a spell, " + skillname(p) + ".")
				}
				repeat 10
					p = cdata(215 + cnt, tc)
					if (p >= 400 & p < 600) {
						snd 24
						skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sdata(165, cc) + (sdata(165, cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
						txtef 2
						txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", "You gain knowledge of a spell, " + skillname(p) + ".")
					}
				loop
				repeat length(racenamecsv)
					if (cdatan(2, tc) == racenamecsv(cnt, 1)) {
						cnt2 = cnt
						repeat racespact(cnt2, 1)
							p = racespact(cnt2, 2 + cnt)
							if (p >= 400 & p < 600) {
								snd 24
								skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sdata(165, cc) + (sdata(165, cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
								txtef 2
								txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", "You gain knowledge of a spell, " + skillname(p) + ".")
							}
						loop
						break
					}
				loop
				repeat length(classnamecsv)
					if (cdatan(3, tc) == classnamecsv(cnt, 1)) {
						cnt2 = cnt
						repeat classspact(cnt2, 1)
							p = classspact(cnt2, 2 + cnt)
							if (p >= 400 & p < 600) {
								snd 24
								skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sdata(165, cc) + (sdata(165, cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
								txtef 2
								txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", s + "you gain knowledge of a spell, " + skillname(p) + ".")
							}
						loop
						break
					}
				loop
			}
			if (nutrition >= 3000) {
				if (rnd(10) == 0 | cNutrition(cc) >= 12000) {
					modweight cc, rnd(3) + 1, cNutrition(cc) >= 12000
				}
			}
			cNutrition(cc) += nutrition
			if (cc == 0) {
				gosub *label_1384
			}
			ctalk cc, 1348, cc, tc
			chara_anorexia cc
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 761 | _switch_sw) {
		_switch_sw = 0
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		animeload 11, cc
		if (synccheck(cc, -1)) {
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txt -1, lang(name(cc) + "の集中力が飛躍的に上昇した！", his(cc) + " mental acuity heightenes!")
			}
		}
		p = sdataref(1, efid) \ 1000
		calcbuff -1, p, cPietyPoint(cc)
		addbuff cc, p, cPietyPoint(cc), dur
		r1 = cc
		gosub *chara_refresh
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 762 | _switch_sw) {
		_switch_sw = 0
		cw = -1
		repeat 30
			body = 100 + cnt
			if (cdata(body, cc) \ 10000 == 0) {
				continue
			}
			if (cdata(body, cc) / 10000 == 10) {
				cw = cdata(body, cc) \ 10000 - 1
			}
		loop
		if (cw != (-1)) {
			if (iSkill(cw) == 108 | iSkill(cw) == 109) {
				if (iQuality(cw) < 5) {
					cw = 0
					msgdup++
					txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
					return 0
				}
				gosub *label_1299
				if (stat == (-1)) {
					msgdup++
					txt -1, lang("射撃用の道具を装備していない。", "You need to equip a ranged weapon.")
					return 0
				}
				if (stat == (-2)) {
					msgdup++
					txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
					return 0
				}
				if (stat == (-3)) {
					msgdup++
					txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
					return 0
				}
				if (gCatchesGodSignal) {
					txtgod godcheck(), 15
				}
				txtef 4
				ctalk cc, 962, cc, tc
				if (stat == 0) {
					txtef 4
					txt -1, lang("アローレイン！", "Arrow Rain!")
				}
				repeat 229, 16
					if (cState(cnt) != 1) {
						continue
					}
					if (synccheck(cnt, -1) == 0) {
						continue
					}
					if (cRelationship(cnt) >= 0) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if (fov_los(cX(cc), cY(cc), x, y) == 0) {
						continue
					}
					if (cbit(6, cnt) == 1) {
						if (cbit(7, cc) == 0) {
							if (cWet(cnt) == 0) {
								continue
							}
						}
					}
					tc = cnt
					animeid = 9
					gosub *label_0630
					gosub *label_1441
				loop
				gosub *god_consumePCPietyByMiracle
				goto *label_1410
			}
		}
		cw = 0
		msgdup++
		txt -1, lang("弓を装備していない。", "You need to equip a bow.")
		return 0
	}
	if (_switch_val == 763 | _switch_sw) {
		_switch_sw = 0
		// Show Kumiromi's line if you can catch the god signal.
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		if (synccheck(cc, -1)) {
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txt -1, lang("豊穣祭の始まりだ！", "The Harvest Festival has begun!")
			}
		}
		// Get the buff ID.
		p = sdataref(1, efid) \ 1000
		r1 = cc
		gosub *buff_addGodMiracleBuff
		repeat 245 - 1, 1
			if (cState(cnt) != 1) {
				continue
			}
			if (cRelationship(cnt) < 0) {
				continue
			}
			if (godcheck(cnt) != "kumiromi") {
				continue
			}
			if (cPietyPoint(cnt) < 50) {
				continue
			}
			r1 = cnt
			gosub *buff_addGodMiracleBuff
			cPietyPoint(cnt) = cPietyPoint(cnt) * 55 / 100
		loop
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 764 | _switch_sw) {
		_switch_sw = 0
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		ctalk cc, 962, cc, tc
		p = sdataref(1, efid) \ 1000
		calcbuff -1, p, cPietyPoint(cc)
		repeat 16
			if (cState(cnt) != 1) {
				continue
			}
			animeload 11, cnt
			if (synccheck(cnt, -1)) {
				txt -1, lang(name(cnt) + "は不思議な光に包まれた！", name(cnt) + " is enveloped in a mysterious aura of light!")
			}
			addbuff cnt, p, cPietyPoint(cc), dur
		loop
		r1 = cc
		gosub *chara_refresh
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 765 | _switch_sw) {
		_switch_sw = 0
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		animeload 11, cc
		if (synccheck(cc, -1)) {
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txt -1, lang(name(cc) + "にオパートスが乗り移った。", his(cc) + " soul has been overtaken by embodiment of Opatos.")
			}
		}
		p = sdataref(1, efid) \ 1000
		calcbuff -1, p, cPietyPoint(cc)
		addbuff cc, p, cPietyPoint(cc), dur
		r1 = cc
		gosub *chara_refresh
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 766 | _switch_sw) {
		_switch_sw = 0
		gosub *label_1295
		if (stat == 0) {
			return 0
		}
		tc = ocdata(150, 0) - 1
		if (cRelationship(tc) >= 0) {
			gosub *label_1297
			if (stat == 0) {
				return 0
			}
		}
		cw = -1
		repeat 30
			body = 100 + cnt
			if (cdata(body, cc) \ 10000 == 0) {
				continue
			}
			if (cdata(body, cc) / 10000 == 10) {
				cw = cdata(body, cc) \ 10000 - 1
			}
		loop
		if (cw != (-1)) {
			if (iSkill(cw) == 110) {
				if (iQuality(cw) < 5) {
					cw = 0
					msgdup++
					txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
					return 0
				}
				gosub *label_1299
				if (stat == (-1)) {
					msgdup++
					txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
					return 0
				}
				if (stat == (-2)) {
					msgdup++
					txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
					return 0
				}
				if (stat == (-3)) {
					msgdup++
					txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
					return 0
				}
				if (iCount(ammo) == (-1)) {
					msgdup++
					txt -1, lang("特殊弾が装填されていない。", "You need to eqiup a special ammo.")
					return 0
				}
				if (iEnchantmentPower(ammo, iCount(ammo)) \ 1000 < 3) {
					msgdup++
					txt -1, lang("残弾が足りない。", "You do not have enough special ammo.")
					return 0
				}
				if (gCatchesGodSignal) {
					txtgod godcheck(), 15
				}
				txtef 4
				ctalk cc, 962, cc, tc
				if (stat == 0) {
					txtef 4
					txt -1, lang("全弾発射！", "Full Burst!")
				}
				rounds = iEnchantmentPower(ammo, iCount(ammo)) \ 1000 / 3
				repeat 3
					gosub *label_1441
				loop
				rounds = 0
				gosub *god_consumePCPietyByMiracle
				goto *label_1410
			}
		}
		cw = 0
		msgdup++
		txt -1, lang("銃を装備していない。", "You need to equip a gun.")
		return 0
	}
	if (_switch_val == 767 | _switch_sw) {
		_switch_sw = 0
		cw = find_eq(cc, 759)
		if (cw != (-1)) {
			if (iQuality(cw) < 5) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if (gCatchesGodSignal) {
				txtgod godcheck(), 14
			}
			animeload 11, cc
			if (synccheck(cc, -1)) {
				ctalk cc, 962, cc, tc
				if (stat == 0) {
					txt -1, lang(name(cc) + "のライトセーバーは眩く輝いた！", his(cc) + " lightsabre gleams brightly with blinding light!")
				}
			}
			p = sdataref(1, efid) \ 1000
			calcbuff -1, p, cPietyPoint(cc)
			addbuff cc, p, cPietyPoint(cc), dur
			r1 = cc
			gosub *chara_refresh
			gosub *label_1409
			gosub *god_consumePCPietyByMiracle
			goto *label_1410
		}
		cw = 0
		msgdup++
		txt -1, lang("ライトセーバーを装備していない。", "You need to equip a lightsabre.")
		return 0
		_switch_sw++
	}
	if (_switch_val == 768 | _switch_sw) {
		_switch_sw = 0
		// Show Ehekatl's line if you can catch the god signal.
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		animeload 11, cc
		if (synccheck(cc, -1)) {
			txtef 2
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 2
				txt -1, lang(name(cc) + "はエヘカトルに見守られている感じがした。", name(cc) + " feel" + _s(cc) + " as if Ehekatl was watching " + him(cc) + " intently.")
			}
		}
		// Get the buff ID.
		p = sdataref(1, efid) \ 1000
		r1 = cc
		gosub *buff_addGodMiracleBuff
		repeat 245 - 1, 1
			if (cState(cnt) != 1) {
				continue
			}
			if (cRelationship(cnt) < 0) {
				continue
			}
			if (godcheck(cnt) != "ehekatl") {
				continue
			}
			if (cPietyPoint(cnt) < 50) {
				continue
			}
			r1 = cnt
			gosub *buff_addGodMiracleBuff
			cPietyPoint(cnt) = cPietyPoint(cnt) * 55 / 100
		loop
		gosub *label_1409 // Reset some of global state.
		gosub *god_consumePCPietyByMiracle
		goto *label_1410 // Go to the end of this switch statement.
		_switch_sw++
	}
	if (_switch_val == 769 | _switch_sw) {
		_switch_sw = 0
		gosub *label_1732
		cw = stat
		if (cw == (-1)) {
			cw = 0
			msgdup++
			txt -1, lang("杖を装備していない。", "You need to equip a staff.")
			return 0
		}
		if (ibit(13, cw)) {
			txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
			return 0
		}
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		txtef 4
		ctalk cc, 962, cc, tc
		if (stat == 0) {
			txtef 4
			txt -1, lang(name(cc) + "は" + itemname(cw) + "を破壊して魔力を放出した！", name(cc) + " destroy" + _s(cc) + " " + itemname(cw) + " and expels massive magical energy contained within!")
		}
		efp = 0
		repeat 15
			if (iEnchantmentId(cw, cnt) == 0) {
				break
			}
			if (iEnchantmentId(cw, cnt) == 34) {
				if (iEnchantmentPower(cw, cnt) > (-1)) {
					lint_efp = iEnchantmentPower(cw, cnt) * cPietyPoint(cc) * 3 / 10000
					efp = limitmax(lint_efp, INT_MAX)
					break
				}
			}
		loop
		range = 2 + efp / 100
		repeat range * 2 + 1
			dy = cY(cc) - range + cnt
			if (dy < 0 | dy >= mapHeight) {
				continue
			}
			repeat range * 2 + 1
				dx = cX(cc) - range + cnt
				if (dx < 0 | dx >= mapWidth) {
					continue
				}
				if (map(dx, dy, 1) == 0) {
					continue
				}
				tc = map(dx, dy, 1) - 1
				if (dist(cX(tc), cY(tc), dx, dy) > range) {
					continue
				}
				if (fov_los(cX(tc), cY(tc), dx, dy) == 0) {
					continue
				}
				if (relationbetween(cc, tc) >= (-1)) {
					animeid = 11
					gosub *label_0630
					if (synccheck(tc, -1)) {
						txt -1, lang(name(tc) + "のマナが回復した。", name(tc) + your(tc) + " mana is restored.")
					}
					healmp tc, efp
				}
			loop
		loop
		cdata(iBodyPart(cw), cc) = cdata(iBodyPart(cw), cc) / 10000 * 10000
		iBodyPart(cw) = 0
		iNumber(cw)--
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 770 | _switch_sw) {
		_switch_sw = 0
		cw = find_eq(cc, 10005)
		if (cw != (-1)) {
			if (iQuality(cw) < 5) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if (gCatchesGodSignal) {
				txtgod godcheck(), 15
			}
			txtef 4
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 4
				txt -1, lang("大地の一撃！", "Earth strike!")
			}
			animeid = 23
			gosub *label_0630
			dice1 = cPietyPoint(cc) * 3 / 2000
			dice2 = sdata(10, 0)
			repeat mapHeight
				dy = cnt
				repeat mapWidth
					dx = cnt
					if (map(dx, dy, 1) != 0) {
						tc = map(dx, dy, 1) - 1
						attack_weakGuard // from Earth Strike
						if (tc == cc) {
							continue
						}
						dmg = role(dice1, dice2)
						dmghp tc, dmg, cc
					}
				loop
			loop
			gosub *god_consumePCPietyByMiracle
			goto *label_1410
			_switch_sw++
		}
		cw = 0
		msgdup++
		txt -1, lang("大槌を装備していない。", "You need to equip a blunt.")
		return 0
	}
	if (_switch_val == 771 | _switch_sw) {
		_switch_sw = 0
		cw = find_eq(cc, 10007)
		if (cw != (-1)) {
			if (iQuality(cw) < 5) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			tc = 0
			txt -1, lang("どの方向？", "Which direction?")
			gosub *label_1350
			tc = map(tlocx, tlocy, 1) - 1
			if (stat == 0 | tc <= 0) {
				txt -1, lang("それは無理だ。", "It's impossible.")
				return 0
			}
			if (gCatchesGodSignal) {
				txtgod godcheck(), 15
			}
			txtef 4
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 4
				txt -1, lang("聖者の怒り！", "Saint's Wrath!")
			}
			multicritical = 1
			lockon 0, tc, 14
			if (cbit(6, tc) == 1) {
				if (cbit(7, 0) == 0) {
					if (cWet(tc) == 0) {
						unlockson 0
					}
				}
			}
			if (keybd_attacking == 0) {
				keybd_wait = 1
				keybd_attacking = 1
			}
			gosub *label_1442
			gosub *label_1848
			gosub *god_consumePCPietyByMiracle
			goto *label_1410
			_switch_sw++
		}
		cw = 0
		msgdup++
		txt -1, lang("槍を装備していない。", "You need to equip a polearm.")
		return 0
	}
	if (_switch_val == 772 | _switch_sw) {
		_switch_sw = 0
		gosub *label_1733
		cw = stat
		if (cw != (-1)) {
			if (ibit(13, cw)) {
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				return 0
			}
			if (iQuality(cw) < 5) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if (gCatchesGodSignal) {
				txtgod godcheck(), 15
			}
			txtef 4
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 4
				txt -1, lang(name(cc) + "は" + itemname(cw) + "の魔力を臨界まで高めて解き放った！", name(cc) + " muster" + _s(cc) + " massive magical energy for " + itemname(cw) + " to its limits and releases!")
			}
			animeid = 19
			animode = 100
			gosub *label_0630
			snd 120
			listmax = 0
			repeat 15
				if (iEnchantmentId(cw, cnt) == 0) {
					break
				}
				if (iEnchantmentId(cw, cnt) / 10000 == 7) {
					if (iEnchantmentPower(cw, cnt) > (-1)) {
						list(0, listmax) = iEnchantmentId(cw, cnt) \ 10000, (iEnchantmentPower(cw, cnt) + sdata(16, cc) * 10) * (cPietyPoint(cc) / 2000)
						listmax++
					}
				}
			loop
			repeat 245
				if (cState(cnt) != 1) {
					continue
				}
				x = cX(cnt)
				y = cY(cnt)
				if (map(x, y, 1) == 0) {
					continue
				}
				tc = cnt
				attack_weakGuard // from Catastrophe
				repeat listmax
					dmg = list(1, cnt)
					calcmagiccontrol cc, tc
					if (stat == 1) {
						continue
					}
					dmghp tc, dmg, cc, list(0, cnt), 1000
				loop
			loop
			txtef 3
			txt -1, lang(itemname(cw) + "は壊れた……", itemname(cw) + " turns to dust...")
			cdata(iBodyPart(cw), cc) = cdata(iBodyPart(cw), cc) / 10000 * 10000
			iBodyPart(cw) = 0
			iNumber(cw)--
			gosub *god_consumePCPietyByMiracle
			goto *label_1410
		}
		cw = 0
		msgdup++
		txt -1, lang("杖を装備していない。", "You need to equip a staff.")
		return 0
	}
	if (_switch_val == 773 | _switch_sw) {
		_switch_sw = 0
		cw = find_eq(cc, 10011)
		if (cw != (-1)) {
			if (iQuality(cw) < 5) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if (gCatchesGodSignal) {
				txtgod godcheck(), 15
			}
			txtef 4
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 4
				txt -1, lang("魂の収穫！", "Soul Harvest!")
			}
			multicritical = 1
			efp = limit(encfind(cc, 80025) / 200, 1, 5)
			se_range = 3
			repeat se_range * 2 + 1
				se_dy = cY(cc) - se_range + cnt
				if (se_dy < 0 | se_dy >= mapHeight) {
					continue
				}
				repeat se_range * 2 + 1
					se_dx = cX(cc) - se_range + cnt
					if (se_dx < 0 | se_dx >= mapWidth) {
						continue
					}
					if (map(se_dx, se_dy, 1) == 0) {
						continue
					}
					tc = map(se_dx, se_dy, 1) - 1
					attack_weakGuard // from Soul Harvest
					if (dist(cX(tc), cY(tc), se_dx, se_dy) > se_range) {
						continue
					}
					if (fov_los(cX(tc), cY(tc), se_dx, se_dy) == 0) {
						continue
					}
					if (cRelationship(cc) == cRelationship(tc)) {
						continue
					}
					efid = 773
					gosub *label_1442
					gosub *label_1848
					if (cHp(tc) > cMaxHp(tc) * efp / 8) {
						continue
					}
					if (synccheck(tc, -1)) {
						snd 105
						ctalk cc, 1295, tc, cc
						txtef 3
						txt -1, lang(" *ブシュッ* ", "*Gash*")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
							gdata(809) = 2
							txt3rd = 1
							txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
						} else {
							txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
						}
					}
					dmghp tc, cMaxHp(tc), cc, 658
					gosub *label_1410
				loop
			loop
			gosub *god_consumePCPietyByMiracle
			goto *label_1410
		}
		cw = 0
		msgdup++
		txt -1, lang("鎌を装備していない。", "You need to equip a scythe.")
		return 0
	}
	if (_switch_val == 774 | _switch_sw) {
		_switch_sw = 0
		if (gCatchesGodSignal) {
			txtgod godcheck(), 15
		}
		if (synccheck(cc, -1)) {
			txtef 2
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 2
				txt -1, lang("どこかでダイスを転がす音が聞こえたような気がした。", "You think you just heard a dice being rolled across a surface somewhere.")
			}
		}
		p = -1
		if (rnd(20)) {
			animeid = 19
			animode = 100 + cc
			gosub *label_0630
			snd 120
			p = 86 + rnd(5)
		} else {
			snd 117
			animeload 14, cc
			p = 91 + rnd(4)
		}
		calcbuff -1, p, cPietyPoint(cc)
		addbuff cc, p, cPietyPoint(cc), dur
		r1 = cc
		gosub *chara_refresh
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 775 | _switch_sw) {
		_switch_sw = 0
		p(98) = sdataref(1, efid) \ 1000
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		animeload 8, cc
		if (synccheck(cc, -1)) {
			txtef 2
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 2
				txt -1, lang(name(cc) + "は分身した！", name(cc) + " split" + _s(cc) + "!")
			}
		}
		repeat 7
			flt
			fixlv = 5
			ally = 1
			characreate -1, -2, cX(cc), cY(cc)
			cRelationship(rc) = 10
			cOriginalRelationship(rc) = 10
			calcbuff -1, p(98), cPietyPoint(cc)
			addbuff rc, p(98), cPietyPoint(cc), dur
		loop
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 776 | _switch_sw) {
		_switch_sw = 0
		p(98) = sdataref(1, efid) \ 1000
		cw = find_eq(cc, 10003)
		if (cw != (-1)) {
			if (iQuality(cw) < 5) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if (gCatchesGodSignal) {
				txtgod godcheck(), 15
			}
			snd 107
			animeload 15, cc
			if (synccheck(cc, -1)) {
				ctalk cc, 962, cc, tc
				if (stat == 0) {
					txt -1, lang(name(cc) + "の剣は雷を帯びた！", his(cc) + " sword is wrapped in lightning!")
				}
			}
			calcbuff -1, p(98), cPietyPoint(cc)
			addbuff cc, p(98), cPietyPoint(cc), dur
			r1 = tc
			gosub *chara_refresh
			gosub *label_1409
			gosub *god_consumePCPietyByMiracle
			goto *label_1410
		}
		cw = 0
		msgdup++
		txt -1, lang("短剣を装備していない。", "You need to equip a short sword.")
		return 0
	}
	if (_switch_val == 777 | _switch_sw) {
		_switch_sw = 0
		ci = -1
		inv_getheader cc
		repeat invrange, invhead
			if (iNumber(cnt) <= 0) {
				continue
			}
			if (iId(cnt) != 687) {
				continue
			}
			if (iParam1(cnt) < 10) {
				continue
			}
			if (iParam2(cnt) == 0) {
				continue
			}
			ci = cnt
			break
		loop
		if (ci != (-1)) {
			if (gCatchesGodSignal) {
				txtgod godcheck(), 15
			}
			txtef 4
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txtef 4
				txt -1, lang("荒れ狂う水が津波を巻き起こした！", "Violent waves suddenly stirs from still water engulfing those standing in a massive tsunami!")
			}
			repeat mapHeight
				dy = cnt
				repeat mapWidth
					dx = cnt
					if (map(dx, dy, 1) != 0) {
						if (chipm(0, map(dx, dy, 0)) == 3) {
							tc = map(dx, dy, 1) - 1
							attack_weakGuard // from Call of Cthulu
							dmg = int(limitf(sdata(16, cc) * cPietyPoint(cc) / 2000, 1, 20000000))
							dmghp tc, dmg, cc, 51, 1000
						}
					}
				loop
			loop
			gosub *god_consumePCPietyByMiracle
			goto *label_1410
		}
		ci = 0
		msgdup++
		txt -1, lang("古書物を持っていない。", "You need an ancient book.")
		return 0
	}
	if (_switch_val == 778 | _switch_sw) {
		_switch_sw = 0
		p(98) = sdataref(1, efid) \ 1000
		if (gCatchesGodSignal) {
			txtgod godcheck(), 14
		}
		snd 117
		animeload 14, cc
		if (synccheck(cc, -1)) {
			ctalk cc, 962, cc, tc
			if (stat == 0) {
				txt -1, lang(name(cc) + "の体は深きものに近づいた……。", his(cc) + " body transfigures ever closer to that of the Deep One...")
			}
		}
		calcbuff -1, p(98), cPietyPoint(cc)
		addbuff cc, p(98), cPietyPoint(cc), dur
		r1 = cc
		gosub *chara_refresh
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 783 | _switch_sw) {
		_switch_sw = 0
		repeat 1 + rnd(3)
			flt cLevel(cc), 1
			fltnrace = cdatan(2, cc)
			characreate -1, 0, cX(cc), cY(cc)
			if (stat != 0) {
				resetfaction rc
				if (relationbetween(rc, cc) == 10) {
					addfaction rc, "pet," + cc
					ocdata(10, rc) = 1
					ocdata(0, rc) = 3
				}
			}
		loop
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は護衛を召喚した。", "Several guards come out from a portal.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 784 | _switch_sw) {
		_switch_sw = 0
		txtef 9
		txt -1, lang(name(cc) + "は大声で悲鳴をあげた。", name(cc) + " scream" + _s(cc) + " loudly.")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		if (ocdata(155, cc)) {
			tc = ocdata(150, cc) - 1
			repeat 245
				if (cState(cnt) != 1) {
					continue
				}
				if (dist(cX(cnt), cY(cnt), cX(cc), cY(cc)) > 10) {
					continue
				}
				if (relationbetween(cc, cnt) != 10) {
					continue
				}
				turn_aggro cnt, tc, 80
			loop
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 786 | _switch_sw) {
		_switch_sw = 0
		if (cCnpcId(cc) == usernpcmax) {
			return 0
		}
		repeat 1 + rnd(3)
			flt cLevel(cc), 2
			fltselect = 2
			noencpfix = 1
			nc_skipflag = 1
			characreate -1, 0, cX(tc), cY(tc)
			if (stat != 0) {
				if (cId(cc) == cId(rc)) {
					f = 1
					if (cId(cc) == 343) {
						if (cCnpcId(rc) != cCnpcId(cc)) {
							f = 0
						}
					}
					if (f) {
						chara_vanquish rc
						continue cnt
					}
				}
				resetfaction rc
				if (relationbetween(rc, cc) == 10) {
					addfaction rc, "pet," + cc
					ocdata(10, rc) = 1
					ocdata(0, rc) = 3
				}
			}
		loop
		if (synccheck(cc, -1)) {
			txt -1, lang("魔法でモンスターが召喚された。", "Several monsters come out from a portal.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 787 | _switch_sw) {
		_switch_sw = 0
		p(67) = 0
		if (getfactionvalue(cc, "pet") != "") {
			if (rnd(3) == 0) {
				p(67) = 1
			}
		} else {
			p(67) = 1 + rnd(3)
		}
		repeat p(67)
			flt
			dbid = cId(cc)
			if (dbid == 343) {
				initunid = cCnpcId(cc) + 1
			}
			noencpfix = 1
			noenchant = 1
			mode = 1
			characreate -1, dbid, cX(tc), cY(tc)
			mode = 0
			if (stat) {
				if (cId(rc) != cId(cc) | cCnpcId(rc) != cCnpcId(cc)) {
					chara_vanquish rc
					continue
				}
				resetfaction rc
				addfaction rc, "pet," + cc
			}
		loop
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は仲間を喚んだ。", name(cc) + " call" + _s(cc) + " to allies for help.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 790 | _switch_sw) {
		_switch_sw = 0
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "のスタミナが完全に回復した。", name(tc) + " completely restore" + _s(tc) + " all stamina.")
		}
		healsp tc, cMaxSp(tc)
		if (showdamagecheck(cMaxSp(tc))) {
			if (synccheck(tc, -1)) {
				mondmgn(mondmgcnt) = "*" + cMaxSp(tc) + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		ocbitmod 10, tc, 0
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 791 | _switch_sw) {
		_switch_sw = 0
		if (sdata(183, cc) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == 0) + "n't know how to sing.")
				return 0
			}
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, 183) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, 183) / 2 + 1) + sdataref(2, 183) / 2 + 1
		}
		cContinuousActionId(cc) = 10006
		cContinuousActionTurn(cc) = 61
		cQualityOfPerformance(cc) = 40
		cTipGold(cc) = 0
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		if (cc == 0) {
			performtips = 0
			repeat 15, 1
				cnt2 = cnt
				if (cState(cnt2) != 1) {
					continue
				}
				if (synccheck(cnt2, -1) == 0) {
					continue
				}
				if (cContinuousActionId(cnt2) != 0) {
					continue
				}
				if (sdata(183, cnt2) == 0) {
					continue
				}
				f = 0
				if (cAiCalm(cnt2) == 5) {
					cnpcrole = 0
					if (cId(cnt2) == 343) {
						if (userdata2(5, cCnpcId(cnt2))) {
							cnpcrole = userdata2(5, cCnpcId(cnt2))
						}
					}
					if (cId(cnt2) == 326 | cnpcrole == 1) {
						if (ocdata(49, cnt2) != 0) {
							continue
						}
						inv_getheader cnt2
						repeat invrange, invhead
							if (iNumber(cnt) == 0) {
								continue
							}
							if (iSkill(cnt) == 183) {
								ci = cnt
								f = 1
								break
							}
						loop
					}
				} else {
					if (ocdata(6, cnt2) != 0) {
						continue
					}
				}
				if (f) {
					txt -1, lang(name(cnt2) + "は" + name(cc) + "に合わせて" + itemname(ci) + "の演奏をはじめた。", name(cnt2) + " start" + _s(cnt2) + " to play " + itemname(ci) + ".")
					cContinuousActionId(cnt2) = 20006
					cContinuousActionItem(cnt2) = ci
				} else {
					txt -1, lang(name(cnt2) + "は" + name(cc) + "に合わせて歌いはじめた。", name(cnt2) + " joins the troupe with " + name(cc) + " and start" + _s(cnt2) + " singing.")
					cContinuousActionId(cnt2) = 10006
				}
				cContinuousActionTurn(cnt2) = 61
				cQualityOfPerformance(cnt2) = 40
				cTipGold(cnt2) = 0
			loop
		}
		gosub *label_1368
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 791 | _switch_sw) {
		_switch_sw = 0
		if (sdata(183, cc) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == 0) + "n't know how to sing.")
				return 0
			}
		}
		if (cc == 0) {
			if (cSp(0) < 50) {
				if (cSp(0) < rnd(75)) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp 0, sdataref(2, 183) / 2 + 1
					goto *label_1410
				}
			}
			dmgsp 0, rnd(sdataref(2, 183) / 2 + 1) + sdataref(2, 183) / 2 + 1
		}
		cContinuousActionId(cc) = 10006
		cContinuousActionTurn(cc) = 61
		cQualityOfPerformance(cc) = 40
		cTipGold(cc) = 0
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_1368
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 793 | _switch_sw) {
		_switch_sw = 0
		cc = tc
		if (cc == 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		f = 1
		if (cContinuousActionItem(cc) != 0 | cc == gMount | cbit(985, cc) | ocdata(107, cc) != 0) {
			f = 0
		}
		if (f) {
			animeload 8, cc
			metamorphosis cc
			rcref = stat
			if (rcref != (-1)) {
				cContinuousActionItem(cc) = cImage(cc)
				cpicref = 0
				dbid = rcref
				dbmode = 2
				gosub *label_2067
				cImage(cc) = cpicref
				txt -1, lang(name(cc) + "は" + refchara(rcref, 2, 1) + "に変化した。", name(cc) + " change" + _s(cc) + " to " + refchara(rcref, 2, 1) + ".")
			}
		} else {
			txt -1, lang(name(cc) + "は変化できない。", name(cc) + " cannot be changed.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 3001 | _switch_sw) {
		_switch_sw = 0
		txtef 4
		txt -1, lang("魔法で津波が召喚された！", "Using magic, a tsunami is summoned and submerges the region!")
		repeat mapHeight
			dy = cnt
			repeat mapWidth
				dx = cnt
				if (rnd(3) == 0) {
					map(dx, dy, 0) = 165
				}
			loop
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 3002 | _switch_sw) {
		_switch_sw = 0
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		snd 24
		flt cLevel(0) / 2 + 5
		itemcreate -1, 687, cX(0), cY(0), 0
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + ".")
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == 3003 | _switch_sw) {
		_switch_sw = 0
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		snd 64
		txtef 5
		if (gWeather == 1) {
			txt -1, lang("セリア「……残念だけど、この風は僕の手では止められないんだ」", "A calm voice echoes, " + cnvtalk("Unfortunately, I can't stop the ethereal wind."))
			iCount(ci) = 0
			goto *label_1454
		}
		if (gWeather == 0) {
			txt -1, lang("セリア「……今はまだ僕の出番じゃないみたいだね」", "A calm voice echoes, " + cnvtalk("well, It's not the turn yet."))
			iCount(ci) = 0
			goto *label_1454
		}
		preweather = gWeather
		gWeather = 0
		txt -1, lang("セリア「大丈夫、僕が必ず旅路を導くから」", "A calm voice echoes, " + cnvtalk("Leave it to me."))
		txt -1, lang("天候が変わった。", "The weather changes.")
		throwsstpevent "WeatherChanged", 0, _weather(preweather), 0
		envonly = 1
		gosub *label_0122
		goto *label_1454
	}
	if (_switch_val == 3004 | _switch_sw) {
		_switch_sw = 0
		if (iValue(ci) == 0) {
			txt -1, lang("宝玉の中には金貨が入っていない。いくら入れる？", "There are no gold coins inside the jewel. How much do you want?")
			promptmax = 0
			if (cGold(0) >= 1000 | ncgdata(50) > 0) {
				promptl(0, promptmax) = "1000GP", key_select(promptmax), "0"
				promptmax++
			}
			if (cGold(0) >= 10000 | ncgdata(50) > 0) {
				promptl(0, promptmax) = "10000GP", key_select(promptmax), "1"
				promptmax++
			}
			if (cGold(0) >= 100000 | ncgdata(50) > 0) {
				promptl(0, promptmax) = "100000GP", key_select(promptmax), "2"
				promptmax++
			}
			if (cGold(0) >= 1000000 | ncgdata(50) > 0) {
				promptl(0, promptmax) = "1000000GP", key_select(promptmax), "3"
				promptmax++
			}
			promptl(0, promptmax) = lang("今は入れない",　"Not now."), key_select(promptmax), "4"
			promptmax++
			val = promptx, prompty, 180, 1
			gosub *label_1353
			if (rtval == 0) {
				snd 12
				cGold(0) -= 1000
				gosub *label_N200
				iValue(ci) = 1000
				txt -1, lang("1000枚の金貨を入れた。", "put in 1000GP.")
				txtef 5
				txt -1, lang("クルーラ「……にゃあ？これだけかにゃ〜？……一応やってみるけど、あんまり期待しないでほしいにゃあ」", "A calm voice echoes, " + cnvtalk("mew...That's it? I'll give it a shot, but... don't get your hopes up too high."))
				goto *label_1410
			}
			if (rtval == 1) {
				snd 12
				cGold(0) -= 10000
				gosub *label_N200
				iValue(ci) = 10000
				txt -1, lang("10000枚の金貨を入れた。", "put in 10000GP.")
				txtef 5
				txt -1, lang("クルーラ「……にゃあ、そこそこかにゃあ、とりあえずやってみるにゃあ」", "A calm voice echoes, " + cnvtalk("mew...OK, let's do it."))
				goto *label_1410
			}
			if (rtval == 2) {
				snd 12
				cGold(0) -= 100000
				gosub *label_N200
				iValue(ci) = 100000
				txt -1, lang("100000枚の金貨を入れた。", "put in 100000GP.")
				txtef 5
				txt -1, lang("クルーラ「にゃふぅ、いい感じの額だにゃあ、そこそこ期待してほしいにゃあ」", "A calm voice echoes, " + cnvtalk("mew...OK, you can count on it."))
				goto *label_1410
			}
			if (rtval == 3) {
				snd 12
				cGold(0) -= 1000000
				gosub *label_N200
				iValue(ci) = 1000000
				txt -1, lang("1000000枚の金貨を入れた。", "put in 1000000GP.")
				txtef 5
				txt -1, lang("クルーラ「にゃははは！いいにゃあ、ふとっぱらだにゃあ！期待して待っているといいにゃあ！」", "A calm voice echoes, " + cnvtalk("mew! So many gold coins! I'll have to live up to your expectations. mewmewmew!"))
				goto *label_1410
			}
			txt -1, lang("クルーラ「……にゃあ？」", "A calm voice echoes, " + cnvtalk("mew...?"))
			iCount(ci) = 0
			goto *label_1410
		} else {
			dim nc_crula_itemshaffle, 3
			nc_crula_itemshaffle = 287, 287, 287
			nc_crula_itemcount = 0
			if (iValue(ci) == 1000) {
				// 1000GP
				// 60% 30% 10%
				nc_crula_itemshaffle = 635, 620, 621
				nc_crula_itemcount = 1 + rnd(2)
			}
			if (iValue(ci) == 10000) {
				// 10000GP
				nc_crula_itemshaffle = 640, 621, 626
				nc_crula_itemcount = 1 + rnd(2)
			}
			if (iValue(ci) == 100000) {
				// 10000GP
				if (rnd(2)) {
					nc_crula_itemshaffle = 621, 626, 655
				} else {
					nc_crula_itemshaffle = 621, 626, 662
				}
				nc_crula_itemcount = 1 + rnd(3)
			}
			if (iValue(ci) == 1000000) {
				// 1000000GP
				if (rnd(2)) {
					nc_crula_itemshaffle = 621, 626, 290
				} else {
					if (rnd(2)) {
						nc_crula_itemshaffle = 621, 655, 290
					} else {
						nc_crula_itemshaffle = 621, 662, 290
					}
				}
				nc_crula_itemcount = 2 + rnd(2)
			}
			iCount(ci) = 0
			iValue(ci) = 0
			snd 64
			txtef 5
			txt -1, lang("クルーラ「にゃはは、これでどーかにゃ？」", "A calm voice echoes, " + cnvtalk("mew...How about this?"))
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
			nc_intb_001 = rnd(10)
			flt
			if (nc_intb_001 == 0) {
				itemcreate -1, nc_crula_itemshaffle(2), cX(0), cY(0), nc_crula_itemcount
			} else {
				if (nc_intb_001 <= 3) {
					itemcreate -1, nc_crula_itemshaffle(1), cX(0), cY(0), nc_crula_itemcount
				} else {
					itemcreate -1, nc_crula_itemshaffle(0), cX(0), cY(0), nc_crula_itemcount
				}
			}
			autosave = 1 * (gCurrentMap != 35)
			if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
				autosave = 0
			}
			txt -1, lang("宝玉の中身は再び空っぽになった。", "The jewel was empty again.")
		}
		goto *label_1410
	}
	if (_switch_val == 785 | _switch_sw) {
		_switch_sw = 0
		get_route cX(cc), cY(cc), tlocx, tlocy
		if (stat == 0) {
			goto *label_1410
		}
		animeid = 0
		gosub *label_0630
		dx = cX(cc)
		dy = cY(cc)
		repeat 20
			route_info dx, dy, cnt
			if (stat == 0) {
				break
			} else {
				if (stat == (-1)) {
					continue
				}
			}
			if (dist(dx, dy, cX(cc), cY(cc)) > sdataref(3, efid) \ 1000 + 1) {
				break
			}
			if (dx == cX(cc) & dy == cY(cc)) {
				continue
			}
			if (map(dx, dy, 1) != 0) {
				tc = map(dx, dy, 1) - 1
				attack_weakGuard // from Wave Motion Gun
				if (cc != tc) {
					if (tc >= 56 & petcheck(tc) == 0) {
						if (synccheck(tc, -1)) {
							txt -1, lang(name(tc) + "は巻き込みを免れた。", "The spell passes through " + name(tc) + ".")
						}
					} else {
						if (synccheck(tc, -1)) {
							txt -1, lang("波動砲が" + name(tc) + "に命中した。", "The wave motion gun hits " + name(tc) + ".")
						}
						dmghp tc, cMaxHp(tc) / 2, cc
					}
				}
			}
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_weakShield | _switch_sw) {
		_switch_sw = 0
		p(98) = sdataref(1, _switch_val) \ 1000
		animeload 11, cc
		calcbuff -1, p(98), 15
		addbuff cc, p(98), 15, dur
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_kumiromisCutter | _switch_sw) {
		_switch_sw = 0
		se_range = 2
		repeat se_range * 2 + 1
			se_dy = cY(cc) - se_range + cnt
			if (se_dy < 0 | se_dy >= mapHeight) {
				continue
			}
			repeat se_range * 2 + 1
				se_dx = cX(cc) - se_range + cnt
				if (se_dx < 0 | se_dx >= mapWidth) {
					continue
				}
				if (map(se_dx, se_dy, 1) == 0) {
					continue
				}
				tc = map(se_dx, se_dy, 1) - 1
				attack_weakGuard // from Kumiromi's cutter
				if (relationbetween(cc, tc) != (-3)) {
					continue
				}
				if (dist(cX(tc), cY(tc), se_dx, se_dy) > se_range) {
					continue
				}
				if (fov_los(cX(tc), cY(tc), se_dx, se_dy) == 0) {
					continue
				}
				if (cRelationship(cc) == cRelationship(tc)) {
					continue
				}
				efid = sId_kumiromisCutter
				gosub *label_1442
				gosub *label_1848
				if (cHp(tc) > cMaxHp(tc) / 2) {
					continue
				}
				if (synccheck(tc, -1)) {
					snd 105
					ctalk cc, 1295, tc, cc
					txtef 3
					txt -1, lang(" *ブシュッ* ", "*Gash*")
					if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
						gdata(809) = 2
						txt3rd = 1
						txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
					} else {
						txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
					}
				}
				dmghp tc, cMaxHp(tc) + 1, cc, 658
				gosub *label_1410
			loop
		loop
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_summonServants | _switch_sw) {
		_switch_sw = 0
		if (cCnpcId(cc) == usernpcmax) {
			return 0
		}
		dbid = 0
		if (cId(cc) != 343) {
			if (cId(cc) == 306) {
				dbid = 263
			}
			if (cId(cc) == 331) {
				dbid = 260
			}
			if (cId(cc) == 338) {
				dbid = 265
			}
			if (cId(cc) == 339) {
				dbid = 261
			}
			if (cId(cc) == 342) {
				dbid = 262
			}
			if (cId(cc) == 366) {
				dbid = 266
			}
			if (cId(cc) == 367) {
				dbid = 264
			}
		} else {
			repeat usergodmax
				if (cCnpcId(cc) == findunid(cgodGodNpcId(cnt)) - 1) {
					dbid = 343
					initunid_tmp = findunid(cgodServantId(cnt))
					break
				}
			loop
		}
		if (dbid == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			goto *label_1410
		}
		ragnarokflag@se = 1
		repeat 1 + rnd(5)
			flt 100, calcfixlv(3)
			initlv = cLevel(cc) * 2 / 3
			if (dbid == 343) {
				initunid = initunid_tmp
			}
			characreate -1, dbid, cX(cc), cY(cc)
			if (stat != 0) {
				resetfaction rc
				addfaction rc, "pet," + cc
				ocbitmod 7, rc, 1
				ocdata(0, rc) = 3
				cRelationship(rc) = cRelationship(cc)
				cOriginalRelationship(rc) = cRelationship(cc)
			}
		loop
		ragnarokflag@se = 0
		if (synccheck(cc, -1)) {
			txt -1, lang("眷属が召喚された。", "Servants come out from a portal.")
		}
		goto *label_1410
		_switch_sw++
	}
	if (_switch_val == sId_maelstromOfTheAbyss | _switch_sw) {
		_switch_sw = 0
		txtef 4
		ctalk cc, 962, cc, tc
		if (stat == 0) {
			txtef 4
			txt -1, lang("荒れ狂う水が津波を巻き起こした！", "Tunami all over the area of ocean!")
		}
		repeat mapHeight
			dy = cnt
			repeat mapWidth
				dx = cnt
				map(dx, dy, 0) = 165
			loop
		loop
		repeat mapHeight
			dy = cnt
			repeat mapWidth
				dx = cnt
				if (map(dx, dy, 1) != 0) {
					tc = map(dx, dy, 1) - 1
					if (tc == cc) {
						continue
					}
					attack_weakGuard // from sId_maelstromOfTheAbyss
					dice1 = sdata(16, cc) / 50 * (cInsanity(tc) + cInsanity(cc) + 200) / 200
					dice2 = sdata(16, cc) / 10
					bonus = cInsanity(tc)
					dmg = rolemax(dice1, dice2, bonus)
					dmghp tc, dmg, cc, 64, 1000
					cInsanity(tc) = limit(cInsanity(tc) + sdata(16, cc) / 10 + rnd(sdata(16, cc) / 100 + 1), 0, 2000000000)
				}
			loop
		loop
		cInsanity(cc) = limit(cInsanity(cc) + sdata(16, cc) / 10 + rnd(sdata(16, cc) / 100 + 1), 0, 2000000000)
		goto *label_1410
	}
	if (_switch_val == sId_angerofsea | _switch_sw) {
		_switch_sw = 0
		if (cc == 0) {
			if (gCatchesGodSignal) {
				txtgod godcheck(), 14
			}
		}
		txtef 4
		ctalk cc, 962, cc, tc
		if (stat == 0) {
			txtef 4
			txt -1, lang("荒波が一帯を覆う！", "Rough waves cover the whole area!")
		}
		repeat mapHeight
			dy = cnt
			repeat mapWidth
				dx = cnt
				if (map(dx, dy, 1) != 0) {
					tc = map(dx, dy, 1) - 1
					if (tc == cc) {
						continue
					}
					if (map(dx, dy, 0) == 165) {
						txtef 3
						txt -1, lang("*ゴゴゴゴゴ*", "*gruuuuu*")
						if (cQuality(tc) < 6) {
							cHp(tc) = -999000
						}
						dmghp tc, 999, -11
					}
				}
			loop
		loop
		repeat mapHeight
			dy = cnt
			repeat mapWidth
				dx = cnt
				if (rnd(3) == 0) {
					map(dx, dy, 0) = 165
				}
			loop
		loop
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
	}
	if (_switch_val == sId_tprosperity | _switch_sw) {
		_switch_sw = 0
		if (ncgdata(106) == 1) {
			txt -1, lang("既に繁栄の兆候が発生している。", "Signs of prosperity are already occurring.")
			goto *label_1410
		}
		if (cc == 0) {
			if (gCatchesGodSignal) {
				txtgod godcheck(), 14
			}
		}
		snd 64
		txtef 5
		txt -1, lang("繁栄の兆候が発生した！", "Signs of prosperity on the ranch have occurred!")
		ncgdata(106) = 1
		gosub *label_1409
		gosub *god_consumePCPietyByMiracle
		goto *label_1410
	}
*label_1409
*label_1410
	ci = efcibk
	efstatus = 0
	efsource = 0
	multicritical = 0
	magiccritical = 0
	return 1
*label_1411
	subloop = 1
	if (gMount != 0) {
		if (tc == gMount | tc == 0) {
			subloop = 2
			if (tc == gMount) {
				tc(1) = 0
			} else {
				tc(1) = gMount
			}
		}
	}
	if (tc != 0) {
		if (ocdata(106, tc) != 0) {
			subloop = 2
			tc(1) = ocdata(106, tc)
		} else {
			if (ocdata(107, tc) != 0) {
				subloop = 2
				tc(1) = ocdata(107, tc)
			}
		}
	}
	repeat subloop
		if (magiccritical) {
			healdmg = rolemax(dice1, dice2, bonus)
		} else {
			healdmg = role(dice1, dice2, bonus)
		}
		if (findbuff(tc(cnt), 70) != (-1)) {
			healdmg /= 10
		}
		healhp tc(cnt), healdmg
		healcon tc(cnt), 6
		healcon tc(cnt), 1, 50
		healcon tc(cnt), 5, 50
		healcon tc(cnt), 7, 30
		healcon tc(cnt), 9, 20
		if (godcheck(tc(cnt)) != "danalin") {
			healsan tc(cnt), 1
		}
		if (showdamagecheck(healdmg)) {
			if (synccheck(tc(cnt), -1)) {
				mondmgn(mondmgcnt) = "" + healdmg
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc(cnt), cc
				ccolor 110
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
	loop
	return
*label_1412
	cPoisoned(tc) = 0
	cSleep(tc) = 0
	cConfused(tc) = 0
	cBlind(tc) = 0
	if (gettrait(tc, 195) != 0) {
		cBlind(tc) = 1000
	}
	cParalyzed(tc) = 0
	cStoned(tc) = 0
	cChoked(tc) = 0
	cDimmed(tc) = 0
	cDrunk(tc) = 0
	cBleeding(tc) = 0
	cGravity(tc) = 0
	if (have_bigench(tc, 11) == 0) {
		cAphrodisiac(tc) = 0
	}
	gContinuousActiveHours = 0
	cHp(tc) = cMaxHp(tc)
	cMp(tc) = cMaxMp(tc)
	cSp(tc) = cMaxSp(tc)
	return
*label_1413
	if (synccheck(cc, -1)) {
		txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "を投げた。", name(cc) + " throw" + _s(cc) + " " + itemname(ci, 1) + ".")
	}
	skillexp2 111, cc, 30, 0, 4
	if (dist(cX(cc), cY(cc), tlocx, tlocy) * 4 > rnd(sdata(111, cc) + 10) + sdata(111, cc) / 4 & rnd(10) != 0) {
		x = tlocx + rnd(2) - rnd(2)
		y = tlocy + rnd(2) - rnd(2)
		if (x >= 0) {
			if (y >= 0) {
				if (x < mapWidth) {
					if (y < mapHeight) {
						if ((chipm(7, map(x, y, 0)) & 4) == 0) {
							tlocx = x
							tlocy = y
						}
					}
				}
			}
		}
	}
	animeid = 15
	if (cfg_useffhp) {
		aniref = iImage(ci), iColor(ci), ci
	} else {
		aniref = iImage(ci), iColor(ci)
	}
	anix = tlocx
	aniy = tlocy
	gosub *label_0630
	ti = inv_getfreeid(-1)
	removeitem ci, 1
	if (iId(ci) == 685 | iId(ci) == 699) {
		if (ti != (-1)) {
			item_copy ci, ti
			iNumber(ti) = 1
			iX(ti) = tlocx
			iY(ti) = tlocy
			ci = ti
		}
	}
	if (cc == 0) {
		gosub *refreshPCBurdenState
	}
	animeid = 14
	x = tlocx
	y = tlocy
	gosub *label_0630
	if (iId(ci) == 685 | iId(ci) == 699) {
		snd 91
		cell_refresh iX(ci), iY(ci)
		if (map(tlocx, tlocy, 1) != 0) {
			tc = map(tlocx, tlocy, 1) - 1
			txt -1, lang(name(tc) + "に見事に命中した！", "It hits " + name(tc) + "!")
			if (iId(ci) == 685) {
				if (gWizard == 0) {
					if (gCurrentMap == 6 | gCurrentMap == 40 | gCurrentMap == 49 | gCurrentMap == 35 | gCurrentMap == 210) {
						txt -1, lang("この場所では効果がない。", "This doesn't work in this area.")
						goto *label_1617
					}
					if (tc < 57 | cRole(tc) != 0 | cQuality(tc) == 6 | cbit(976, tc) == 1) {
						txt -1, lang("その生物には無効だ。", "The creature can't be captured.")
						goto *label_1617
					}
					if (eqfaction(tc, "nc_sheep")) {
						txt -1, lang("その生物には無効だ。", "The creature can't be captured.")
						goto *label_1617
					}
					if (ibit(5, ci) == 0 & cLevel(tc) > iParam2(ci)) {
						txt -1, lang("その生物を捕獲するには、より高レベルのモンスターボールが必要だ。", "Power level of the ball is not enough to capture the creature.")
						goto *label_1617
					}
					if (cHp(tc) > cMaxHp(tc) / 10) {
						txt -1, lang("捕獲するためにはもっと弱らせる必要がある。", "You need to weaken the creature to capture it.")
						goto *label_1617
					}
				}
				txtef 2
				txt -1, lang(name(tc) + "をモンスターボールに捕獲した。", "You capture " + name(tc) + ".")
				animeload 8, tc
				iSubname(ci) = cId(tc)
				iParam3(ci) = cLevel(tc)
				iWeight(ci) = limit(cWeight(tc), 10000, 100000)
				iValue(ci) = 1000
				if (iSubname(ci) == 343) {
					inv(33, ci) = cCnpcId(tc)
					inv(34, ci) = createserialno(userdatan(0, cCnpcId(tc)))
				}
			} else {
				if (cId(tc) != 319 | petcheck(tc) | cbit(976, tc)) {
					txt -1, lang("何もおきない… ", "Nothing happens...")
					goto *label_1617
				}
				if (gCurrentMap == 6 | gCurrentMap == 40 | gCurrentMap == 49 | gCurrentMap == 35 | gCurrentMap == 210) {
					txt -1, lang("この場所では効果がない。", "This doesn't work in this area.")
					goto *label_1617
				}
				rc = tc
				txtef 2
				txt -1, lang(name(tc) + "をリトル捕獲玉に捕獲した。それはモンスターボールに姿を変えた。", "You capture " + name(tc) + ".")
				animeload 8, tc
				iId(ci) = 685
				iFunction(ci) = 33
				iSubname(ci) = cId(tc)
				iParam3(ci) = cLevel(tc)
				iWeight(ci) = limit(cWeight(tc), 10000, 100000)
				iValue(ci) = 1000
				ibitmod 5, ci, 1
			}
			chara_vanquish tc
			check_quest
		}
		goto *label_1617
	}
	if (refitem(iId(ci), 5, ci) == 52000 | iId(ci) == 772 | iId(ci) == 575) {
		if (iId(ci) != 601) {
			if (synccheck(tlocx, tlocy)) {
				repeat 1
					if (iId(ci) == 587) {
						snd 86
						break
					}
					if (iId(ci) == 575) {
						break
					}
					snd 47
				loop
			}
			if (map(tlocx, tlocy, 1) != 0) {
				tc = map(tlocx, tlocy, 1) - 1
				if (synccheck(tc, -1)) {
					txt -1, lang(name(tc) + "に見事に命中した！", "It hits " + name(tc) + "!")
					wet tc, 25
				}
				rowact_check tc
				if (iId(ci) == 587) {
					if (synccheck(tc, -1)) {
						if (tc != 0) {
							txtef 9
							txt tc, lang("「いてー！」", cnvtalk("Hey!")), lang("「やったな」", cnvtalk("Now you did it.")), lang(" *クスクス* ", "*chuckle*"), lang("「キャハハ」", cnvtalk("Tee-hee-hee!")), lang("「こやつめ」", cnvtalk("You'll pay for this.")), lang("「むむっ」", "*grin*")
						}
					}
					goto *label_1617
				}
				if (iId(ci) == 772) {
					if (synccheck(tc, -1)) {
						txtef 4
						txt -1, lang(" *ぷちゅ* ", "*crumble*")
					}
					if (iParam3(ci) == (-1)) {
						if (synccheck(tc, -1)) {
							txtef 4
							txt -1, lang(name(tc) + "は怒りに体を奮わせた！", name(tc) + " " + is(tc) + " engulfed in fury!")
						}
						cFurious(tc) += rnd(10) + 5
					}
					goto *label_1617
				}
				cColer = 0
				if (iId(ci) == 519 & (iColor(ci) == 0 | iColor(ci) == 1 | iColor(ci) == 12)) {
					cColer = 1
				}
				if (iId(ci) == 575) {
					f = iWeight(ci) / 500
					if (f < 1) {
						f = 1
					}
					p = 250 + rnd(15)
					if (p == 263) {
						p = 264
					}
					if (findbuff(tc, 63) == (-1)) {
						cdata(p, tc) += rnd(f) + 5
					}
					animeload 8, tc
					if (p == 250) {
						s = lang("毒", "Poisoned")
					}
					if (p == 251) {
						s = lang("睡眠", "Sleep")
					}
					if (p == 252) {
						s = lang("麻痺", "Paralyzed")
					}
					if (p == 253) {
						s = lang("盲目", "Blinded")
					}
					if (p == 254) {
						s = lang("混乱", "Confused")
					}
					if (p == 255) {
						s = lang("恐怖", "Fear")
					}
					if (p == 256) {
						s = lang("朦朧", "Dimmed")
					}
					if (p == 257) {
						s = lang("酔払い", "Drunk")
					}
					if (p == 258) {
						s = lang("出血", "Bleeding")
					}
					if (p == 259) {
						s = lang("濡れ", "Wet")
					}
					if (p == 260) {
						s = lang("狂気", "Insane")
					}
					if (p == 261) {
						s = lang("病気", "Sick")
					}
					if (p == 262) {
						s = lang("重力", "Gravity")
					}
					if (p == 264) {
						s = lang("怒り", "Furious")
					}
					if (synccheck(tc, -1)) {
						txtef 4
						txt -1, lang(" *べちゃ* ", "*crumble*")
						if (findbuff(tc, 63) == (-1)) {
							txtef 4
							txt -1, lang(name(tc) + "は" + s + "状態になった！", name(tc) + " is in " + s + " state!")
						}
					}
					goto *label_1617
				}
				if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
					hostileaction cc, tc
				}
				ccthrowpotion = cc
				potionthrow = 100
				cc = tc
				dbmode = 15
				dbid = iId(ci)
				gosub *label_2426
				cc = ccthrowpotion
				goto *label_1617
			}
			if (iId(ci) == 587) {
				if (map(tlocx, tlocy, 4) != 0) {
					cell_itemlist tlocx, tlocy
					f = 0
					repeat listmax
						p = list(0, cnt)
						if (iId(p) == 541) {
							if (synccheck(tlocx, tlocy)) {
								txt -1, lang(itemname(p, 1) + "に命中して、雪だるまは崩れた。", "It hits " + itemname(p, 1) + " and breaks it.")
							}
							iNumber(p)--
							f = 1
							break
						}
					loop
					if (f == 1) {
						cell_refresh tlocx, tlocy
						goto *label_1617
					}
				}
			}
			if (iId(ci) == 587) {
				if (chipm(0, map(tlocx, tlocy, 0)) == 4) {
					goto *label_1617
				}
				if (synccheck(tlocx, tlocy)) {
					txt -1, lang("それは地面に落ちて溶けた。", "It falls on the ground and melts.")
				}
			} else {
				if (synccheck(tlocx, tlocy)) {
					txt -1, lang("それは地面に落ちて砕けた。", "It falls on the ground and shatters.")
				}
			}
			if (iId(ci) == 772) {
				if (synccheck(tlocx, tlocy)) {
					txtef 4
					txt -1, lang(" *ぷちゅ* ", "*crumble*")
				}
				goto *label_1617
			}
			if (iId(ci) == 575) {
				snd 65
				if (synccheck(tlocx, tlocy)) {
					txtef 4
					txt -1, lang(" *べちゃ* ", "*crumble*")
				}
				goto *label_1617
			}
			lint_efp = 50 + sdata(111, cc) * 10
			efp = limitmax(lint_efp, INT_MAX)
			if (iId(ci) == 392) {
				addmef tlocx, tlocy, 3, 19, rnd(15) + 5, efp, cc
				goto *label_1617
			}
			if (iId(ci) == 577) {
				lint_efp = 100 * (iEnhancement(ci) + 1)
				efp = limitmax(lint_efp, INT_MAX)
				dim inrange, mapWidth, mapHeight
				searchrangeinit tlocx, tlocy, limit(efp / 100 - 1, 0, 20)
				if (stat) {
					repeat mapWidth
						cnt2 = cnt
						repeat mapHeight
							if (inrange(cnt2, cnt)) {
								if ((chipm(7, map(cnt2, cnt, 0)) & 4) == 0) {
									if (rnd(3)) {
										addmef cnt2, cnt, 5, 24, rnd(15) + 25, efp / 2, cc
										mapitem_fire cnt2, cnt
									}
								}
							}
						loop
					loop
				}
				addmef tlocx, tlocy, 5, 24, rnd(15) + 25, efp, cc
				mapitem_fire tlocx, tlocy
				goto *label_1617
			}
			addmef tlocx, tlocy, 6, 27, -1, efp, cc, iId(ci), iCurseState(ci), iColor(ci)
			goto *label_1617
		}
	}
	if (synccheck(tlocx, tlocy)) {
		txt -1, lang("それは地面に落ちて砕けた。", "It falls on the ground and shatters.")
		snd 47
	}
	if (iId(ci) == 578) {
		if (moneybox(iParam2(ci)) != 2147483647) {
			flt
			itemcreate -1, 54, tlocx, tlocy, iParam1(ci)
		} else {
			repeat iParam1(ci)
				itemcreate -1, 54, tlocx, tlocy, 2147483647
			loop
		}
	}
	goto *label_1617
*label_1414
	item_find 60002, 2
	if (stat != (-1)) {
		ci = stat
		s = godno2godid(iParam1(ci))
		if (iParam3(ci) != 0) {
			s = cgodShortId(iParam2(ci))
		}
		if (s != godcheck()) {
			prayctrl = 0
			gosub *label_1087
			goto *label_1617
		}
	}
	goto *label_1091
*label_1415
	p(66) = int((double(strf("%0.0f", (-0.5) * ((double(calcitemvalue(ti, 0) * iNumber(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) > 0) - (double(calcitemvalue(ti, 0) * iNumber(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) < 0)) + double(calcitemvalue(ti, 0) * iNumber(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1))) - (double(calcitemvalue(ti, 0) * iNumber(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) < double(strf("%0.0f", (-0.5) * ((double(calcitemvalue(ti, 0) * iNumber(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) > 0) - (double(calcitemvalue(ti, 0) * iNumber(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) < 0)) + double(calcitemvalue(ti, 0) * iNumber(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1))))) * (-1))
	if (p(66) < iNumber(ci)) {
		iNumber(ci) -= p(66)
		p = inv_getfreeid(0)
		item_copy ci, p
		iNumber(p) = p(66)
		item_exchange p, ti
		ci = p
	} else {
		item_exchange ci, ti
	}
	return
*label_1416
	if (cc != (-1)) {
		if (iId(ci) == 54 | iId(ci) == 55) {
			snd 11
			ti = ci
			in = iNumber(ci)
			iNumber(ci) = 0
			msgkeep = 1
			ctalk cc, 10105, cc, cc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
				ctalk cc, 1105, cc, cc
				if (stat == 0) {
					ctalk cc, 1104, cc, cc
				}
			}
			cell_refresh iX(ci), iY(ci)
			if (iId(ci) == 54) {
				se_moneymod cc, in
			} else {
				addplat cc, in
			}
			return 1
		}
	}
	if (cc == 0) {
		if (gMount != 0) {
			if (cContinuousActionId(gMount) != 0) {
				if (cContinuousActionItem(gMount) == ci) {
					txt -1, lang("それは" + name(gMount) + "が使用中だ。", name(gMount) + " " + is(gMount) + " using it.")
					return 1
				}
			}
		}
		if (refitem(iId(ci), 5, ci) == 57000) {
			if (iOwnState(ci) == 4) {
				if (cContinuousActionId(0) == 0) {
					if (inv_getspace(0) == 0) {
						txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
						return 0
					}
					gdata(91) = 103
					gosub *label_1370
					return -1
				}
			}
		}
		if (iOwnState(ci) == 3) {
			if (iCurseState(ci) != 1) {
				txt -1, lang(itemname(ci) + "を撤去する？ （注意！中の物は完全に失われます）", "Do you want to remove " + itemname(ci) + "? ")
			} else {
				txt -1, lang(itemname(ci) + "を撤去する？", "Do you want to remove " + itemname(ci) + "? ")
			}
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval == 0) {
				snd 58
				if (iCurseState(ci) != 1) {
					if (iId(ci) == 555) {
						midbk = mid
						mid = "" + 30 + "_" + (100 + iCount(ci))
						tmpload "mdata_" + mid + ".s2"
						exist exedir + "tmp\\mdata_" + mid + ".s2"
						if (strsize != (-1)) {
							ctrlFile 11
						}
						mid = midbk
						iCount(ci) = 0
						iOwnState(ci) = 0
					}
				} else {
					iOwnState(ci) = 0
				}
			} else {
				return 0
			}
		}
		if (inv_getfreeid(cc) == (-1)) {
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return 0
		}
	}
	itemcopy = 0
	inumbk = iNumber(ci) - in
	iNumber(ci) = in
	if (cc == 0) {
		if (gettrait(0, 215) != 0) {
			if (refitem(iId(ci), 5, ci) == 56000) {
				if (iCount(ci) > 0) {
					itemcopy = 2
				}
			}
		}
		if (gettrait(0, 216) != 0) {
			if (refitem(iId(ci), 5, ci) == 52000 & item_isCookedMilk(ci) == 0) {
				if (iId(ci) != 262 & iId(ci) != 559 & iId(ci) != 793) {
					if (rnd(5) == 0) {
						itemcopy = 3
					}
				}
			}
		}
	}
	if (itemcopy == 0) {
		item_stack cc, ci
		if (stat == 0) {
			itemcopy = 1
		}
	}
	if (itemcopy) {
		ti = inv_getfreeid(cc)
		if (ti == (-1)) {
			iNumber(ci) = inumbk + in
			if (invctrl == 12) {
				txt -1, lang("店の倉庫が一杯のため売れない。", "Shopkeeper's inventory is full.")
			} else {
				txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			}
			return 0
		}
		item_copy ci, ti
		iNumber(ti) = in
	}
	iNumber(ci) = inumbk
	if (itemcopy == 2) {
		dbmode = 14
		dbid = iId(ti)
		gosub *label_2426
		txt -1, lang("あなたは" + itemname(ti) + "から魔力を吸い取った。", "You absorb magic from " + itemname(ti) + ".")
		if (efid >= 400 & efid < 467) {
			spell(efid - 400) += iCount(ti) * 5 * iNumber(ti)
		} else {
			healmp 0, iCount(ti) * 5 * iNumber(ti)
		}
		iCount(ti) = 0
	}
	if (itemcopy == 3) {
		txt -1, lang("あなたの手から毒が滴った。", "Poison drips from your hands.")
		iId(ti) = 262
		iImage(ti) = 354
		iColor(ti) = _randcolor((262 + gRandomSeed) \ 6)
		iValue(ti) = 120
		iEnhancement(ti) = 0
		ibitmod 5, ti, 0
	}
	if (iOwnState(ti) < 0) {
		iOwnState(ti) = 0
	}
	if (ibit(12, ti)) {
		iCount(ti) = 0
		ibitmod 12, ti, 0
	}
	inv(39, ti) = 0
	if (mode == 6) {
		if (refitem(iId(ti), 5, ti) == 57000) {
			if (iMaterial(ti) == 35) {
				if (invctrl == 11 | invctrl == 22) {
					if (invctrl == 22 & invctrl(1) == 3) {
						if (iParam3(ti) > 0) {
							iParam3(ti) += getgametime()
						}
					} elseif (invctrl == 22 & invctrl(1) == 14) { // Take it from trash can.
						// It has expiration date and has not been rotten.
						if (iParam3(ti) > 0) {
							// Its expiration date has been over.
							if (iParam3(ti) <= getgametime()) {
								// Get rotten.
								iParam3(ti) = -1
							}
						}
					} else {
						if (iParam3(ti) != 0) {
							iParam3(ti) = getgametime() + refitem(iId(ti), 19, ti)
							if (iParam2(ti) != 0) {
								iParam3(ti) += 72
							}
						}
					}
				}
				if (invctrl == 24 & invctrl(1) == 3) {
					if (iParam3(ti) > 0) {
						iParam3(ti) = iParam3(ti) - getgametime()
					}
				}
			}
		}
		if (invctrl == 11) {
			msgkeep = 1
			txt -1, lang(itemname(ti, in) + "を買った。", "You buy " + itemname(ti, in) + ".")
			sellgold = limitmax(calcitemvalue(ti, 0) * in, 2000000000)
			snd 12
			cGold(0) -= sellgold
			gosub *label_N200
			se_moneymod tc, sellgold
			if (refitem(iId(ti), 5, ti) == 92000) {
				iParam2(ti) = calcitemvalue(ti, 0)
			}
		}
		if (invctrl == 12) {
			msgkeep = 1
			sellgold = calcitemvalue(ci, 1) * in
			if (ibit(9, ti) == 0) {
				txt -1, lang(itemname(ti, in) + "を売った。", "You sell " + itemname(ti, in) + ".")
				if (refitem(iId(ti), 5, ti) == 92000) {
					if ((sellgold - (iParam2(ti) * in)) >= 500000) {
						newtitle 102
					}
				}
			} else {
				ibitmod 9, ti, 0
				txt -1, lang("盗品の" + itemname(ti, in) + "を売却した。", "You sell " + itemname(ti, in) + ".(Stolen item sold) ")
				if (gdata(250 + 19) > 0) {
					gdata(250 + 19) -= sellgold
					if (gdata(250 + 19) < 0) {
						gdata(250 + 19) = 0
					}
					txt -1, lang("盗賊ギルドのノルマ達成まで、あと金貨" + gdata(250 + 19) + "枚相当の盗品を売却する必要がある。", "You still need to sell stuff worth " + gdata(250 + 19) + " gold pieces in order to advance ranks in the Thieves Guild.")
				}
			}
			snd 11
			se_moneymod 0, sellgold
			cGold(tc) -= sellgold
			if (cGold(tc) < 0) {
				cGold(tc) = 0
			}
			iIdentificationState(ti) = 3
		}
		if (invctrl == 22 | invctrl == 24) {
			snd 14 + rnd(2)
			msgkeep = 1
			if (invctrl == 22) {
				ctalk 0, 10106, 0, 0
				if (stat == 0) {
					txt -1, lang(name(0) + "は" + itemname(ti, in) + "を取り出した。", name(0) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
				}
			} else {
				ctalk 0, 10107, 0, 0
				if (stat == 0) {
					txt -1, lang(itemname(ti, in) + "を保管した。", "You put " + itemname(ti, in) + " in the container.")
				}
			}
		} else {
			r1 = 0
			r2 = sellgold
			gosub *label_0666
		}
	} else {
		cell_refresh iX(ci), iY(ci)
		map(iX(ci), iY(ci), 5) = map(iX(ci), iY(ci), 4)
		snd 14 + rnd(2)
		msgkeep = 1
		ctalk cc, 10105, cc, cc
		if (stat == 0) {
			txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
			ctalk cc, 1105, cc, cc
			if (stat == 0) {
				ctalk cc, 1104, cc, cc
			}
		}
	}
	if (cc == 0) {
		if (iId(ti) == 255) {
			inv_getheader -1
			if (mapCampfireExists == 1) {
				f = 0
				repeat invrange, invhead
					if (iNumber(cnt) == 0) {
						continue
					}
					if (iId(cnt) == 255) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					mapCampfireExists = 0
					gosub *label_0122
				}
			}
		}
		convertartifact ti
		ti = stat
		if (areaId(gCurrentMap) == 101) {
			if (mode == 0) {
				gosub *label_0931
			}
		}
		if (gCurrentMap == 7) {
			if (mode == 0) {
				gosub *housing_calculateHomeValue
			}
		}
		gosub *refreshPCBurdenState
	}
	if (cc == (-1)) {
		gosub *refreshPCBurdenState
	}
	return 1
*label_1417
	inumbk = iNumber(ci) - in
	iNumber(ci) = in
	iX(ci) = cX(cc)
	iY(ci) = cY(cc)
	itemturn ci
	item_stack -1, ci
	if (stat == 0 | dropval == 0) {
		ti = inv_getfreeid(-1)
		if (ti == (-1)) {
			ctalk 0, 10109, 0, 0
			if (stat == 0) {
				txt -1, lang("もう周りに物を置くスペースがない！ ", "The place is too crowded. You can't drop stuff anymore.")
			}
			gosub *label_0623
			return 0
		}
		item_copy ci, ti
	}
	if (dropval == 1) {
		if (iOwnState(ti) != 2) {
			if (iCount(ci) == 0) {
				iCount(ti) = gNextShelterSerialId + 100
				gNextShelterSerialId++
			}
		}
		iOwnState(ti) = 3
	}
	iNumber(ci) = inumbk
	inv(39, ci) = 0
	cell_refresh iX(ti), iY(ti)
	if (dropval == 0) {
		screenupdate = -1
		gosub *label_0623
		if (item_count == 0) {
			snd 16
			ctalk 0, 10108, 0, 0
			if (stat == 0) {
				txt -1, lang(itemname(ti, in) + "を地面に置いた。", "You drop " + itemname(ti, in) + ".")
			}
		}
	}
	gosub *refreshPCBurdenState
	if (iId(ti) == 516) {
		item_find 60002, 0
		if (stat != (-1)) {
			p = stat
			godidt = godno2godid(iParam1(p))
			if (godidt == "eyth" & iParam3(p) != 0) {
				godidt = cgodShortId(iParam2(p))
			}
			if (gettrait(0, 194) == 0) {
				if (godidt == godcheck()) {
					if (iCurseState(ti) != 1) {
						snd 64
						iCurseState(ti) = 1
						txtef 2
						txt -1, lang("水は祝福を受けた。", "The water is blessed.")
					}
				} else {
					snd 117
					iCurseState(ti) = -1
					txtef 3
					txt -1, lang("水は黒く輝いた。", "The water glows black.")
				}
			}
		}
	}
	if (areaId(gCurrentMap) == 101) {
		if (mode == 0) {
			gosub *label_0931
		}
	}
	if (gCurrentMap == 7) {
		if (mode == 0) {
			gosub *housing_calculateHomeValue
		}
	}
	if (iId(ti) == 255) {
		mapCampfireExists = 1
		gosub *label_0122
	}
	return 1
*label_1418
	if (ci == (-1)) {
		return 0
	}
	if (cdata(body, r1) \ 10000 != 0) {
		return 0
	}
	if (iBodyPart(ci) != 0) {
		return 0
	}
	item_separate ci
	if (r1 == 0) {
		item_identify ci, 2
	}
	iBodyPart(ci) = body
	cdata(body, r1) = cdata(body, r1) / 10000 * 10000 + ci + 1
	return 1
*label_1419
	p = cdata(body, r1) \ 10000
	if (p == 0) {
		rtval = -2
		return
	}
	ci = p - 1
	cdata(body, r1) = cdata(body, r1) / 10000 * 10000
	iBodyPart(ci) = 0
	item_stack r1, ci
	return
*label_1420
	repeat 30, 100
		if (cdata(cnt, r1) / 10000 == body) {
			p = cdata(cnt, r1) \ 10000
			if (p == 0) {
				continue
			}
			p--
			iBodyPart(p) = 0
			cdata(cnt, r1) = cdata(cnt, r1) / 10000 * 10000
		}
	loop
	return
*label_1421
	if (iId(ci) == 783) {
		if (iSubname(ci) == 0) {
			txt -1, lang("最後に調合したアイテムを、レシピに加えることができる。(まだ未実装)", "You can add a recipe of the item you previously created.(Not implemented yet)")
			goto *label_1617
		}
	}
	efid = 0
	dbmode = 13
	dbid = iId(ci)
	cibkref = ci
	gosub *label_2426
	if (efid == 1115) {
		goto *label_0915
	}
	goto *label_1617
*action_doEat
	if (cc == 0) {
		cargocheck
		if (stat == 0) {
			gosub *label_0623
			goto *label_1623
		}
		if (itemusingfind(ci) > 0) {
			txt -1, lang("そのアイテムは他の誰かが使用中だ。", "Someone else is using the item.")
			goto *label_1623
		}
	} else {
		if (itemusingfind(ci) != (-1)) {
			tc = itemusingfind(ci)
			if (tc != cc) {
				rowactend tc
				if (synccheck(cc, -1)) {
					txt -1, lang(name(cc) + "は" + name(tc) + "の食べ物を横取りした。", name(cc) + " snatch" + _s(cc) + " " + name(tc) + your(tc) + " food.")
				}
			}
		}
	}
	cEmotionIcon(cc) = 16 + 100
	gosub *label_1382
	goto *label_1617
*action_doDrink
	dbmode = 15
	dbid = iId(ci)
	gosub *label_2426
	goto *label_1617
*label_1424
	dbmode = 14
	dbid = iId(ci)
	gosub *label_2426
	gosub *label_1394
	if (stat == 0) {
		if (cc == 0) {
			gosub *label_0623
			goto *label_1623
		} else {
			if (iCount(ci) <= 0) {
			}
			goto *label_1560
		}
	}
	goto *label_1617
*label_1425
	if (map(x, y, 5) != 0) {
		if (mapitemfind(x, y, 526) != (-1)) {
			ci = mapitemfind(x, y, 526)
			item_separate ci
			snd 73
			txt -1, lang(itemname(ci) + "に体当たりした。", "You throw your weight against " + itemname(ci) + ".")
			if (iOwnState(ci) == 5 | iParam1(ci) <= 0) {
				txt -1, lang("もう実はないようだ… ", "It seems there are no fruits left on the tree.")
				goto *label_1617
			}
			if (iParam2(ci) == 505) {
				iParam1(ci)--
				if (iParam1(ci) <= 0) {
					iImage(ci) = 592
					cell_refresh x, y
				}
				if (y + 1 < mapHeight) {
					if ((chipm(7, map(x, y + 1, 0)) & 4) == 0) {
						y++
					}
				}
				flt
				characreate -1, 176, x, y
				txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
				skillexp2 180, 0, 10
			} else {
				treeid = ci
				iImage(treeid) = 592
				cell_refresh x, y
				if (y + 1 < mapHeight) {
					if ((chipm(7, map(x, y + 1, 0)) & 4) == 0) {
						y++
					}
				}
				repeat iParam1(treeid)
					if (nc_gettrait(0, 118) > 0) {
						if (rnd(2)) {
							flt
							itemcreate -1, iParam2(treeid), x, y, 0
						}
					}
					flt
					itemcreate -1, iParam2(treeid), x, y, 0
				loop
				txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(reeid)) + " down from the tree.")
				skillexp2 180, 0, 10 * iParam1(treeid)
				iParam1(treeid) = 0
			}
			goto *label_1617
		}
		if (mapitemfind(x, y, 747) != (-1)) {
			ci = mapitemfind(x, y, 747)
			item_separate ci
			snd 73
			txt -1, lang(itemname(ci) + "に体当たりした。", "You throw your weight against " + itemname(ci) + ".")
			if (iOwnState(ci) == 5 | iParam1(ci) <= 0) {
				txt -1, lang("もう実はないようだ… ", "It seems there are no fruits left on the tree.")
				goto *label_1617
			}
			if (iParam2(ci) == 505) {
				iParam1(ci)--
				if (iParam1(ci) <= 0) {
					iImage(ci) = 592
					cell_refresh x, y
				}
				if (y + 1 < mapHeight) {
					if ((chipm(7, map(x, y + 1, 0)) & 4) == 0) {
						y++
					}
				}
				flt
				characreate -1, 176, x, y
				txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
				skillexp2 180, 0, 10
			} else {
				treeid = ci
				iImage(treeid) = 592
				cell_refresh x, y
				if (y + 1 < mapHeight) {
					if ((chipm(7, map(x, y + 1, 0)) & 4) == 0) {
						y++
					}
				}
				repeat iParam1(treeid)
					if (iParam2(treeid) != 54) {
						if (nc_gettrait(0, 118) > 0) {
							if (rnd(2)) {
								flt
								itemcreate -1, iParam2(treeid), x, y, 0
							}
						}
						flt
						itemcreate -1, iParam2(treeid), x, y, 0
					} else {
						if (nc_gettrait(0, 118) > 0) {
							if (rnd(2)) {
								flt
								itemcreate -1, iParam2(treeid), x, y, 1000
							}
						}
						flt
						itemcreate -1, iParam2(treeid), x, y, 1000
					}
					if (iParam2(treeid) == 619) {
							iSubname(ci) = 30
							iImage(ci) = 429
							iColor(ci) = 0
							repeat
								iParam1(ci) = rnd(368)
								if (iParam1(ci) == 212 | iParam1(ci) == 340) {
									continue
								}
								if (iParam1(ci) > 353 & iParam1(ci) < 366) {
									iParam1(ci) = 343
								}
								if (iParam1(ci) == 343) {
									if (usernpcmax == 0) {
										continue
									}
									inv(33, ci) = rnd(usernpcmax)
									inv(34, ci) = createserialno(userdatan(0, inv(33, ci)))
								}
								break
							loop
						}
						if (iParam2(treeid) == 734) {
							iValue(ci) = rnd((sdata(180, 0) / 5) + 5) + 10
						}
				loop
				txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(reeid)) + " down from the tree.")
				skillexp2 180, 0, 10 * iParam1(treeid)
				iParam1(treeid) = 0
			}
			goto *label_1617
		}
	}
	if (map(x, y, 1) != 0) {
		tc = map(x, y, 1) - 1
		if (cSleep(tc) == 0) {
			if (cc == 0) {
				if (cRelationship(tc) >= 0) {
					gosub *label_1297
					if (stat == 0) {
						goto *label_1623
					}
				}
			}
			if (cChoked(tc)) {
				snd 73
				txt -1, lang(name(cc) + "は" + name(tc) + "に全力で体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + " at full power.")
				dmghp tc, sdata(10, cc) * 5, cc
				if (cState(tc) == 1) {
					txt -1, lang(name(tc) + "はもちを吐き出した。", name(tc) + " spit" + _s(tc) + " mochi.")
					ctalk tc, 1244, cc, tc
					if (stat == 0) {
						txt tc, lang("「助かったよ！」", cnvtalk("You saved me!"))
					}
					cChoked(tc) = 0
					modimp tc, 10
				}
			} else {
				snd 73
				txt -1, lang(name(cc) + "は" + name(tc) + "に体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + ".")
				hostileaction cc, tc
			}
		} else {
			snd 73
			txt -1, lang(name(cc) + "は" + name(tc) + "に体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + ".")
			txt -1, lang(name(tc) + "は睡眠を妨害された。", name(cc) + " disturb" + _s(cc) + " " + his(tc) + " sleep.")
			modkarma cc, -1
			cEmotionIcon(tc) = 18 + 100 * 4
		}
		cSleep(tc) = 0
		goto *label_1617
	}
	if (map(x, y, 6) != 0) {
		cell_featread x, y
		if (feat(1) == 30) {
			map(x, y, 6) = 0
			spillfrag x, y, 2
			flt calcobjlv(gCurrentDungeonLevel * (gCurrentMap != 30)), calcfixlv(2)
			flttypemajor = fsetbarrel(rnd(length(fsetbarrel)))
			itemcreate -1, 0, x, y, 0
			if (synccheck(cc, -1)) {
				snd 73
				txt -1, lang(name(cc) + "は壷を割った。", name(cc) + " shatter" + _s(cc) + " the pot.")
				snd 45
				animeid = 14
				gosub *label_0630
			}
			goto *label_1617
		}
		if (feat(1) == 21) {
			snd 73
			p = feat(2) * 3 + 30
			if (gCurrentMap == 41) {
				p *= 20
			}
			if (rnd(p) < sdata(10, cc) & rnd(2) | p * 2 < sdata(10, cc)) {
				txt -1, lang("扉に体当たりして破壊した。", "You bash up the door. The door is destroyed.")
				if (feat(2) > sdata(10, cc)) {
					skillexp2 10, cc, (feat(2) - sdata(10, cc)) * 15
				}
				cell_featset x, y, 0, 0, 0, 0
				goto *label_1617
			} else {
				txt -1, lang("扉に体当たりした。", "You bash up the door.")
				if (gCurrentMap == 41) {
					txt -1, lang("さすがに牢獄の扉は頑丈だ。", "As might be expected, the door of the Jail is hard.")
				}
				if (rnd(4) == 0) {
					tc = cc
					efid = 1109
					efp = 200
					gosub *label_1398
				}
				if (rnd(3) == 0) {
					tc = cc
					efid = 1110
					efp = 200
					gosub *label_1398
				}
				if (rnd(3) == 0) {
					if (cQuality(cc) < 4 & encfind(cc, 6 * 10000 + 10) == (-1) & have_bigench(cc, 6) == 0) {
						cdata(240, cc)--
						r1 = cc
						gosub *chara_refresh
						if (synccheck(cc, -1)) {
							txtef 8
							txt -1, lang(name(cc) + "は筋肉を痛めた。", name(cc) + " hurt" + _s(cc) + " " + his(cc) + " muscle.")
						}
					}
				}
				if (rnd(3) == 0) {
					if (feat(2) > 0) {
						feat(2)--
						cell_featset x, y, feat(0), feat(1), feat(2), feat(3)
						if (synccheck(cc, -1)) {
							txt -1, lang("扉は少しだけ壊れた。", "The door is cracked a bit.")
						}
					}
				}
				goto *label_1617
			}
		}
	}
	txt -1, lang(name(cc) + "は空気に体当たりした。", name(cc) + " bash" + _s(cc, 1) + " up the air.")
	snd 4
	goto *label_1617
	gosub *label_1426
	if (cc == 0) {
	}
	return
*label_1426
	listmax2 = 0
	if (cc == 0) {
		repeat 15
			y = cY(cc) - 15 / 2 + cnt
			if (y < 0 | y >= mapHeight) {
				continue
			}
			repeat fovlist(1, cnt), fovlist(0, cnt)
				x = cX(cc) - 15 / 2 + cnt
				if (x < 0 | x >= mapWidth) {
					continue
				}
				if (map(x, y, 1) != 0) {
					p = map(x, y, 1) - 1
					if (cc != p) {
						if (fov_los(cX(cc), cY(cc), x, y) != 0) {
							listmax2++
						}
					}
				}
			loop
		loop
	} else {
		repeat cVisionDistance(cc) - 2
			y = cY(cc) - cVisionDistance(cc) / 2 + cnt + 1
			if (y < 0 | y >= mapHeight) {
				continue
			}
			repeat cVisionDistance(cc) - 2
				x = cX(cc) - cVisionDistance(cc) / 2 + cnt + 1
				if (x < 0 | x >= mapWidth) {
					continue
				}
				if (map(x, y, 1) != 0) {
					p = map(x, y, 1) - 1
					if (cc != p) {
						if (fov_los(cX(cc), cY(cc), x, y) != 0) {
							listmax2++
						}
					}
				}
			loop
		loop
	}
	return
*label_1427
	f = 0
	if (cDimmed(cc) != 0) {
		if (cDimmed(cc) + 10 > rnd(60)) {
			f = 1
		}
	}
	if (cDrunk(cc) != 0) {
		if (rnd(5) == 0 & trophycheck(2) != 2) {
			txtef 9
			txt -1, lang(" *ふらり* ", "*stagger*")
			f = 1
		}
	}
	if (cAphrodisiac(cc) != 0) {
		if (rnd(25) == 0 & trophycheck(2) != 2) {
			txtef 9
			txt -1, lang(" *ふらり* ", "*stagger*")
			f = 1
		}
	}
	if ((cConfused(cc) != 0 & trophycheck(2) != 2) | f == 1) {
		cNextX(cc) = cX(cc) + rnd(3) - 1
		cNextY(cc) = cY(cc) + rnd(3) - 1
	}
	if (gMount != 0) {
		if (cContinuousActionId(gMount) != 0) {
			if (cContinuousActionTurn(gMount) > 0) {
				ctalk gMount, 1137, gMount, 0
				if (stat == 0) {
					txt -1, lang(name(gMount) + "はあなたを睨み付けた。", name(gMount) + " stares in your face.")
				}
				cContinuousActionId(gMount) = 0, 0
			}
		}
	}
	cell_check cNextX(cc), cNextY(cc)
	if (cInventoryWeightType(0) >= 4) {
		msgdup++
		txt -1, lang("潰れていて動けない！ ", "You carry too much to move!")
		gosub *label_0623
		goto *label_1623
	}
	if (cellchara != (-1) & cellchara != 0) {
		tc = cellchara
		if (cRelationship(tc) == 0 & key_shift & (cId(tc) == 343 & cQuality(tc) == 6) == 0 | cRelationship(tc) >= 10 | (cRelationship(tc) == (-1) & cfg_ignoredislike != 0) | (cRelationship(tc) == 0 & (areaId(gCurrentMap) == 101 | areaId(gCurrentMap) == 102))) {
			if (cbit(985, tc) == 0 & relationbetween(cc, tc) >= (-1)) {
				if (mapType == 1) {
					goto *label_1428
				}
				if (cfg_scroll) {
					cNextX(0) = cX(tc)
					cNextY(0) = cY(tc)
					gosub *label_0643
				}
				cell_swap cc, tc
				ctalk 0, 10100, tc, 0
				if (stat == 0) {
					txt -1, lang(name(tc) + "と入れ替わった。", "You displace " + name(tc) + ".")
				}
				if (cId(tc) == 271) {
					if (rnd(5) == 0) {
						if (cSleep(tc) == 0 & cStoned(tc) == 0) {
							p = rnd(limit(cGold(cc), 0, 20) + 1)
							if (cbit(15, cc)) {
								p = 0
							}
							if (p != 0) {
								snd 11
								cGold(cc) -= p
								se_moneymod tc, p
								txt tc, lang("「おっと、ごめんよ」", cnvtalk("Ops, sorry.")), lang("「気をつけな」", cnvtalk("Watch it."))
							}
						}
					}
				}
				if (cContinuousActionId(tc) == 1) {
					if (cContinuousActionTurn(tc) > 0) {
						ctalk tc, 1137, tc, 0
						if (stat == 0) {
							txt -1, lang(name(tc) + "はあなたを睨み付けた。", name(tc) + " stares in your face.")
						}
						cContinuousActionId(tc) = 0, 0
					}
				}
				gosub *label_1430
				gosub *label_1670
				goto *label_1617
			}
		}
		if (running) {
			if (cRelationship(tc) >= (-2) | keybd_wait >= 40) {
				goto *label_1623
			}
		}
		if (cRelationship(tc) <= (-1)) {
			lockon 0, tc, 15
			if (cbit(6, tc) == 1) {
				if (cbit(7, 0) == 0) {
					if (cWet(tc) == 0) {
						unlockson 0
					}
				}
			}
			if (keybd_attacking == 0) {
				keybd_wait = 1
				keybd_attacking = 1
			}
			gosub *label_1442
			gosub *label_1848
			goto *label_1617
		}
		gosub *label_1467
		if (chatteleport == 1) {
			chatteleport = 0
			goto *label_0939
		}
		goto *label_1617
	} else {
		keybd_attacking = 0
	}
	if (mapType == 1) {
		if (dbg_freemove) {
			x = cNextX(0)
			y = cNextY(0)
			if (x >= 0 & x < mapWidth & y >= 0 & y < mapHeight) {
				if (map(x, y, 1) == 0) {
					cellaccess = 1
				}
			}
		}
	}
	if (cellaccess == 1) {
*label_1428
		if (mapType == 1) {
			if (264 <= map(cNextX(cc), cNextY(cc), 0) & map(cNextX(cc), cNextY(cc), 0) < 363) {
				goto *label_1623
			}
		}
		goto *label_1429
	}
	if (gCurrentDungeonLevel == 1 | mapType == 6) {
		if (mapType != 1 & gCurrentMap != areaId_carlia) {
			if (cNextX(cc) < 0 | cNextX(cc) > mapWidth - 1 | cNextY(cc) < 0 | cNextY(cc) > mapHeight - 1) {
				txt -1, lang(mdatan(0) + "を去る？ ", "Do you want to leave " + mdatan(0) + "? ")
				if (mapType == 7 | ogdata(24) == 1) {
					if (gdata(73) != 3) {
						if (qdata(3, gExecutingImmediateQuest) != 1021) {
							if (qdata(12, gExecutingImmediateQuest) >= qdata(13, gExecutingImmediateQuest)) {
								txt -1, lang("注意！現在のクエストは失敗に終わってしまう。", "Warning! You are going to abandon your current quest.")
							}
						} else {
							if (qdata(13, gExecutingImmediateQuest) > 0) {
								txt -1, lang("注意！現在のクエストは失敗に終わってしまう。", "Warning! You are going to abandon your current quest.")
							}
						}
					}
				}
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				gosub *label_0623
				if (rtval == 0) {
					gdata(60) = cX(0)
					gdata(61) = cY(0)
					snd 49
					gCurrentDungeonLevel--
					levelexitby = 4
					goto *label_0939
				}
				goto *label_1623
			}
		}
	}
	if (cellfeat != (-1)) {
		if (cellfeat == 21) {
			goto *label_1429
		}
		keyhalt = 1
		if (cellfeat == 23) {
			snd 99
			goto *label_1184
		}
		if (cellfeat == 31) {
			snd 99
			gosub *label_0603
			goto *label_1617
		}
		if (cellfeat == 33) {
			menucycle = 1
			gosub *label_1501
			goto *label_1623
		}
	}
	if (cConfused(0) != 0) {
		msgdup++
		txt -1, lang(" *ごつん* ", "*bump*")
		gosub *label_0623
	} else {
		if (cc == 0) {
			if (autodig_f == 1) {
				if (areaType(gCurrentMap) != 1) {
					if (cNextX(0) >= 0 & cNextX(0) < mapWidth & cNextY(0) >= 0 & cNextY(0) < mapHeight) {
						goto *label_1218
					}
				}
			}
		}
	}
	goto *label_1623
*label_1429
	if (cbit(975, cc)) {
		goto *label_1617
	}
	dx = cNextX(cc)
	dy = cNextY(cc)
	if (petcheck(cc)) {
		if (cc != 0) {
			if (dx != cX(cc)) {
				if (cX(cc) > dx) {
					cDirection(cc) = 1
				} else {
					cDirection(cc) = 2
				}
			}
			if (dy != cY(cc)) {
				if (cY(cc) > dy) {
					cDirection(cc) = 3
				} else {
					cDirection(cc) = 0
				}
			}
		}
	}
	if (map(dx, dy, 6) != 0) {
		cell_featread dx, dy
		if (feat(1) == 21) {
			goto *label_1439
		}
		if (feat(1) == 30) {
			x = dx
			y = dy
			goto *label_1425
		}
	}
	if (map(cX(cc), cY(cc), 8) != 0) {
		i = map(cX(cc), cY(cc), 8) - 1
		if (mef(0, i) == 1) {
			if (mapEffect_isImmuneToCobweb(cc) == FALSE) {
				if (rndex(mef(5, i) + 25) < rndex(sdata(10, cc) + sdata(12, cc) + 1) | cWeight(cc) > 100) {
					if (synccheck(cc, -1)) {
						txt -1, lang(name(cc) + "は蜘蛛の巣を振り払った。", name(cc) + " destroy" + _s(cc) + " the cobweb.")
					}
					delmef i
				} else {
					mef(5, i) = mef(5, i) * 3 / 4
					if (synccheck(cc, -1)) {
						txt -1, lang(name(cc) + "は蜘蛛の巣にひっかかった。", name(cc) + " " + is(cc) + " caught in a cobweb.")
					}
					goto *label_1617
				}
			}
		}
	}
	if (mapType == 1) {
		if (cc == 0) {
			if (traveldone == 0) {
				gosub *label_1375
				keybd_wait = 1
				goto *label_1617
			} else {
				traveldone = 0
			}
		}
	}
	gosub *label_1367
	p = map(cX(cc), cY(cc), 0)
	if (chipm(0, p) == 3) {
		addefmap cX(cc), cY(cc), 1, 3
		if (eqfaction(cc, "aqua") == 1 | findbuff(cc, 97) != (-1)) {
			ocbitmod 12, cc, 1
			refreshspeed cc
		}
	} else {
		if (ocbit(12, cc)) {
			ocbitmod 12, cc, 0
			refreshspeed cc
		}
	}
	gosub *label_1430
	if (mapType == 1) {
		if (cc == 0) {
			encounter = 0
			gdata(62) = map(cX(cc), cY(cc), 0)
			if (map(cX(cc), cY(cc), 6) == 0) {
				p = map(cX(cc), cY(cc), 0)
				if (rnd(30) == 0) {
					encounter = 1
					if (sdata(182, 0) != 0) {
						if (rnd(1 + sqrt(limit(sdata(182, 0), 0, 10000) / 5))) {
							encounter = 0
						}
					}
				}
				if (gWeather == 4) {
					if (rnd(10) == 0) {
						encounter = 1
					}
				}
				if (gWeather == 1) {
					if (rnd(13) == 0) {
						encounter = 1
					}
				}
				if (33 <= p & p < 66) {
					if (rnd(2) == 0) {
						encounter = 0
					}
					if (rnd(100) == 0) {
						encounter = 2
					}
				}
				if (ogdata(500) == 2) {
					if (rnd(limit(300 - (sdata(19, 0) / 10), 100, 300)) == 0) {
						encounter = 6
					}
				}
				if (ogdata(495) == 2) {
					if (rnd(limit(300 - (sdata(19, 0) / 10), 100, 300)) == 0) {
						encounter = 5
					}
				}
				if (rnd(limitmin(220 + cLevel(0) * 10 - limit(ogdata(101) / (sdata(182, 0) * 10 + gCurrentCartLimit / 4000), 0, 220 + cLevel(0) * 10), 1)) == 0) {
					encounter = 4
					if (godcheck() == "serria") {
						if (rnd(8)) {
							encounter = 0
						}
					}
				}
				if (rnd(20) == 0) {
					repeat 5
						rq = gdata(160 + cnt)
						if (qdata(3, rq) == 1007) {
							if (qdata(8, rq) == 1) {
								if (qdata(4, rq) == 0) {
									if (qdata(10, rq) < 2) {
										encounter = 3
										encounterref = rq
										qdata(10, rq)++
										break
									}
								}
							}
						}
					loop
				}
			}
			if (encounter >= 4) {
				encounterlv = cFame(0) / 1000
				if (encounterlv < 1) {
					endounterlv = 1
				}
				levelexitby = 4
				goto *label_0939
			}
			if (encounter == 3) {
				txt -1, lang("暗殺者につかまった。あなたはクライアントを守らなければならない。", "You are caught by assassins. You have to protect your client.")
				msg_halt
				gPreviousMap2 = gCurrentMap, gCurrentDungeonLevel, cX(0), cY(0)
				levelexitby = 4
				goto *label_0939
			}
			if (encounter == 2) {
				encounterlv = 10 + rnd(100)
				levelexitby = 4
				goto *label_0939
			}
			if (encounter == 1) {
				p = dist_town()
				encounterlv = p * 3 / 2 - 10
				if (cFame(0) <= 1000) {
					encounterlv /= 2
				}
				if (33 <= map(cX(cc), cY(cc), 0) & map(cX(cc), cY(cc), 0) < 66) {
					encounterlv /= 2
				} else {
					if (gWeather == 1) {
						encounterlv = encounterlv * 3 / 2 + 10
					}
				}
				if (encounterlv < 0) {
					encounterlv = 1
				}
				valn = lang(" (最も近い街までの距離:" + p + " 敵勢力:", " (Distance from nearest town:" + p + " Enemy strength:")
				repeat 1
					if (encounterlv < 5) {
						valn += lang("プチ級", "Putit Rank")
						break
					}
					if (encounterlv < 10) {
						valn += lang("オーク級", "Orc Rank")
						break
					}
					if (encounterlv < 20) {
						valn += lang("グリズリー級", "Grizzly Bear Rank")
						break
					}
					if (encounterlv < 30) {
						valn += lang("ドレイク級", "Drake Rank")
						break
					}
					if (encounterlv < 40) {
						valn += lang("リッチ級", "Lich Rank")
						break
					}
					valn += lang("ドラゴン級", "Dragon Rank")
				loop
				valn += ")"
				txt -1, lang("襲撃だ！", "Ambush!") + valn
				msg_halt
				levelexitby = 4
				goto *label_0939
			}
			encounter = 0
		}
	}
	goto *label_1617
*label_1430
	if (cc == 0) {
		gdata(60) = -1
		gdata(61) = -1
		x = cX(0)
		y = cY(0)
		if (key_shift & gdata(30) == 0 & cConfused(0) == 0 & cDimmed(0) == 0) {
			if (mapType != 1) {
				gdata(30) = 1
				cell_check cX(cc) + 1, cY(cc)
				gdata(33) = cellaccess
				cell_check cX(cc) - 1, cY(cc)
				gdata(31) = cellaccess
				cell_check cX(cc), cY(cc) + 1
				gdata(34) = cellaccess
				cell_check cX(cc), cY(cc) - 1
				gdata(32) = cellaccess
			}
		}
		if (map(x, y, 4) != 0) {
			if (cBlind(0) == 0) {
				if (cfg_autopick) {
					if (areaType(gCurrentMap) != 5 | areaId(gCurrentMap) == 31 | areaId(gCurrentMap) == 30) {
						if (key_ctrl != 1) {
							x = cX(0)
							y = cY(0)
							cnt3 = 0
							gosub *label_1645
						}
					}
				}
				if (map(x, y, 4) != 0) {
					txt -1, txtitemoncell(x, y)
				}
			} else {
				txt -1, lang("地面に何かがあるようだ。", "You sense something under your foot.")
			}
		}
		if (cfg_notforsale) {
			if (mapbit(3, x, y) == 1) {
				txt -1, lang("ここは非売品エリアだ。", "Here is not-for-sale area.")
			}
		}
		p = chipm(0, map(x, y, 0))
		if (p != 0) {
			if (tname(p) != "") {
				txt -1, lang("足元には" + tname(p) + "がある。", "You walk into " + tname(p) + ".")
			}
			if (p == 3) {
				snd 46
			}
			if (p == 4) {
				addefmap cX(cc), cY(cc), 3, 10, dirsub, rnd(2)
				if (keybd_wait <= cfg_walkwait * cfg_startrun | cTurn(0) \ 2 == 0 | mapType == 1) {
					snd 83 + foot \ 3
					foot += 1 + rnd(2)
				}
			}
		} else {
			if (mapType == 1) {
				addefmap cX(cc), cY(cc), 2, 10, dirsub
				snd 81 + foot \ 2
				foot++
			}
		}
		if (map(x, y, 6) != 0) {
			cell_featread x, y
			if (feat(1) == 32) {
				txtef 5
				txt -1, lang(" *キラン* ", "*twinkle*")
			}
			if (feat(1) == 15) {
				txt -1, mapname(feat(2) + feat(3) * 100, 1)
				if (areaId(feat(2) + feat(3) * 100) == 8) {
					if (cfg_extrahelp) {
						if (gdata(200 + 6) == 0) {
							if (mode == 0) {
								if (cContinuousActionTurn(0) == 0) {
									gdata(200 + 6) = 1
									ghelp = 6
									gosub *label_1575
								}
							}
						}
					}
				}
			}
			if (feat(1) == 34) {
				txt -1, txtbuilding(feat(2), feat(3))
			}
			if (feat(1) == 11) {
				txt -1, lang("降り階段がある。", "There is a stair leading downwards here.")
			}
			if (feat(1) == 10) {
				txt -1, lang("昇り階段がある。", "There is a stair leading upwards here.")
			}
			if (feat(1) == 24) {
				txt -1, lang("何かが見つかりそうだ。", "You can search this location to collect some materials.")
			}
			if (feat(1) == 27) {
				txt -1, lang("何かの残骸がある。", "You can collect materials from the remains lying here.")
			}
			if (feat(1) == 25) {
				txt -1, lang("採掘場がある。", "You can collect materials from the mining spot here.")
			}
			if (feat(1) == 26) {
				txt -1, lang("泉がある。", "You can collect materials from the spring here.")
			}
			if (feat(1) == 28) {
				txt -1, lang("色んな植物が生えている。", "You can collect materials from plants here.")
			}
			if (feat(1) == 29) {
				if (feat(2) == 36) {
					s = lang("野菜", "vegetable")
				}
				if (feat(2) == 37) {
					s = lang("果物", "fruit")
				}
				if (feat(2) == 38) {
					s = lang("ハーブ", "herb")
				}
				if (feat(2) == 39) {
					s = lang("何か", "strange")
				}
				if (feat(2) == 40) {
					s = lang("アーティファクト", "artifact")
				}
				if (feat(2) == 41) {
					s = lang("宝石", "gem")
				}
				if (feat(2) == 42) {
					s = lang("魔法の木", "magic")
				}
				if (feat == tile_plant) {
					txt -1, lang("" + s + "の種が植えてある。", "A " + s + " seed is planted.")
				}
				if (feat == tile_plant + 1) {
					txt -1, lang("" + s + "が育っている。", "A " + s + " bud is growing.")
				}
				if (feat == tile_plant + 2) {
					txt -1, lang("" + s + "の実が成っている。", "A " + s + " tree has bore a lot of fruit.")
				}
				if (feat == tile_plant + 3) {
					txt -1, lang("" + s + "の草は枯れてしまっている… ", "A " + s + " tree has withered...")
				}
				if (key_ctrl == 1 & gCurrentMap != 35) {
					hack_autofarm = 1
					if (feat < tile_plant + 2 & ogdata(483) != 2) {
						txt -1, lang("芽を摘み取った。", "You nip a young plant.")
						map(cX(0), cY(0), 6) = 0
						return
					}
					if (feat == tile_plant + 3 & ogdata(483) != 2) {
						txt -1, lang("枯れた草を摘み取った。", "You nip a dead plant.")
						map(cX(0), cY(0), 6) = 0
						return
					}
					if (inv_getspace(0) == 0) {
						txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
						gosub *label_0623
						return
					}
					if (feat == tile_plant + 2 | ogdata(483) != 2) {
						gosub *label_1461
						if (chipm(0, map(cX(0), cY(0), 0)) == 2) {
							val = 1
						} else {
							val = 0
						}
						gosub *label_1460
						if (feat(2) == 40) {
							autosave = 1 * (gCurrentMap != 35)
							if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
								autosave = 0
							}
						}
						gosub *refreshPCBurdenState
					}
					hack_autofarm = 0
					return
				}
			}
			if (feat(1) >= 24 & feat(1) <= 28) {
				if (cfg_extrahelp) {
					if (gdata(200 + 5) == 0) {
						if (mode == 0) {
							if (cContinuousActionTurn(0) == 0) {
								gdata(200 + 5) = 1
								ghelp = 5
								gosub *label_1575
							}
						}
					}
				}
			}
		}
		if (map(x, y, 5) != 0) {
			if (key_ctrl == 1 & gCurrentMap != 35) {
				hack_autob = 1
				if (mapitemfind(x, y, 526) != (-1)) {
					autob = mapitemfind(x, y, 526)
					snd 73
					if (iOwnState(autob) == 0 & iParam1(autob) != 0) {
						item_separate autob
						autob_x = x
						autob_y = y
						if (iParam2(autob) == 505) {
							iParam1(autob)--
							if (iParam1(autob) <= 0) {
								iImage(autob) = 592
								cell_refresh autob_x, autob_y
							}
							if (y + 1 < mapHeight) {
								if ((chipm(7, map(autob_x, autob_y + 1, 0)) & 4) == 0) {
									autob_y++
								}
							}
							flt
							characreate -1, 176, autob_x, autob_y
							txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
							skillexp2 180, 0, 10
						} else {
							treeid = autob
							iImage(treeid) = 592
							cell_refresh autob_x, autob_y
							if (y + 1 < mapHeight) {
								if ((chipm(7, map(autob_x, autob_y + 1, 0)) & 4) == 0) {
									autob_y++
								}
							}
							repeat iParam1(treeid)
								flt
								itemcreate -1, iParam2(treeid), autob_x, autob_y, 0
							loop
							txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(treeid)) + " down from the tree.")
							skillexp2 180, 0, 10 * iParam1(treeid)
							iParam1(treeid) = 0
						}
						return
					}
				}
				if (mapitemfind(x, y, 747) != (-1)) {
					autob = mapitemfind(x, y, 747)
					snd 73
					if (iOwnState(autob) == 0 & iParam1(autob) != 0) {
						item_separate autob
						autob_x = x
						autob_y = y
						if (iParam2(autob) == 505) {
							iParam1(autob)--
							if (iParam1(autob) <= 0) {
								iImage(autob) = 592
								cell_refresh autob_x, autob_y
							}
							if (y + 1 < mapHeight) {
								if ((chipm(7, map(autob_x, autob_y + 1, 0)) & 4) == 0) {
									autob_y++
								}
							}
							flt
							characreate -1, 176, autob_x, autob_y
							txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
							skillexp2 180, 0, 10
						} else {
							treeid = autob
							iImage(treeid) = 592
							cell_refresh autob_x, autob_y
							if (y + 1 < mapHeight) {
								if ((chipm(7, map(autob_x, autob_y + 1, 0)) & 4) == 0) {
									autob_y++
								}
							}
							repeat iParam1(treeid)
								flt
								if (iParam2(treeid) != 54) {
									itemcreate -1, iParam2(treeid), autob_x, autob_y, 0
								} else {
									itemcreate -1, iParam2(treeid), autob_x, autob_y, 1000
								}
								if (iParam2(treeid) == 619) {
										iSubname(ci) = 30
										iImage(ci) = 429
										iColor(ci) = 0
										repeat
											iParam1(ci) = rnd(368)
											if (iParam1(ci) == 212 | iParam1(ci) == 340) {
												continue
											}
											if (iParam1(ci) > 353 & iParam1(ci) < 366) {
												iParam1(ci) = 343
											}
											if (iParam1(ci) == 343) {
												if (usernpcmax == 0) {
													continue
												}
												inv(33, ci) = rnd(usernpcmax)
												inv(34, ci) = createserialno(userdatan(0, inv(33, ci)))
											}
											break
										loop
									}
									if (iParam2(treeid) == 734) {
										iValue(ci) = rnd((sdata(180, 0) / 5) + 5) + 10
									}
							loop
							txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(treeid)) + " down from the tree.")
							skillexp2 180, 0, 10 * iParam1(treeid)
							iParam1(treeid) = 0
						}
						return
					}
				}
				hack_autob = 0
			}
		}
		if (key_ctrl) {
			hack_plant = 1
			if (map(x, y, 4) == 0 & map(x, y, 6) == 0) {
				oom_seedlistmax = 0
				dim oom_seedlist
				inv_getheader 0
				repeat invrange, invhead
					if (iNumber(cnt) <= 0) {
						continue
					}
					if (refitem(iId(cnt), 9, cnt) != 58500) {
						continue
					}
					if (ibit(13, cnt) == 1) {
						continue
					}
					cnt2 = cnt
					repeat 20
							if (ogdata(36 + cnt) \ 1000000 / 10000 != 14) {
								continue
							}
							if (iId(cnt2) == ogdata(36 + cnt) \ 1000000 \ 10000) {
								oom_seedlist(oom_seedlistmax) = cnt2
								oom_seedlistmax++
								break
							}
					loop
				loop
				if (oom_seedlistmax) {
					bk_ci = ci
					ci = oom_seedlist(rnd(oom_seedlistmax))
					gosub *label_1457
					ci = bk_ci
				}
			}
			hack_plant = 0
		}
	}
	return
*label_1431
	if (dbg_freemove) {
		txt -1, lang("デバッグ中はその操作はできない。", "You can't perform the action while in the debug mode.")
		goto *label_1623
	}
	item_find 631, 3, -1
	if (stat != (-1)) {
		if (mapType == 3 | mapType == 2) {
			ci = stat
			goto *label_1143
		}
	}
	cell_featread cX(cc), cY(cc)
	movelevelbystairs = 0
	if (val == 1) {
		if (mapitemfind(cX(cc), cY(cc), 753) != (-1)) {
			txt -1, lang("本当にこたつの中に入る？", "Really get into the Kotatsu?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval != 0) {
				gosub *label_0623
				goto *label_1623
			}
			txt -1, lang("まっくらだ！", "It's dark here!")
			cBlind(0) += 2
			if (gettrait(0, 195) != 0) {
				cBlind(0) = 1000
			}
			goto *label_1617
		}
	}
	if (gCurrentMap == 7 | areaId(gCurrentMap) == 39) {
		if (val == 1) {
			if (mapitemfind(cX(cc), cY(cc), 751) != (-1)) {
				if (gCurrentDungeonLevel >= areaLastFloor(gCurrentMap)) {
					txt -1, lang("これ以上降りられない。", "You can't go down any more.")
					goto *label_1623
				} else {
					movelevelbystairs = 2
				}
			}
		}
		if (val == 2) {
			if (mapitemfind(cX(cc), cY(cc), 750) != (-1)) {
				if (gCurrentDungeonLevel <= areaDangerLevel(gCurrentMap) | (areaId(gCurrentMap) == 39 & gCurrentDungeonLevel == 1)) {
					txt -1, lang("これ以上昇れない。", "You can't go up any more.")
					goto *label_1623
				} else {
					movelevelbystairs = 1
				}
			}
		}
	}
	if (movelevelbystairs == 0) {
		if (mapType != 1) {
			if (val == 1) {
				if (feat(1) != 11) {
					txt -1, lang("降りる階段は見つからない。", "There're no downstairs here.")
					gosub *label_0623
					goto *label_1623
				} else {
					movelevelbystairs = 1
					f = 0
					if (oabit(13, gCurrentMap)) {
						if (areaHasBeenConquered(gCurrentMap) == (-1)) {
							f = 1
						}
					}
					if (gCurrentMap == 42 & gCurrentDungeonLevel >= gdata(186) | f) {
						txt -1, lang("階段は不思議なバリアで塞がれている。", "The path is blocked by a strange barrier.")
						goto *label_1623
					}
					if (gCurrentMap == 210 & areaHasBeenConquered(gCurrentMap) | f) {
						txt -1, lang("階段は不思議なバリアで塞がれている。", "The path is blocked by a strange barrier.")
						goto *label_1623
					}
				}
			}
			if (val == 2) {
				if (gCurrentMap == 210) {
					txt -1, lang("あなたは階段を昇ろうとしたが、不思議なバリアで塞がれていたので登れなかった。", "You tried to climb the stairs.")
					goto *label_1623
				}
				if (feat(1) != 10) {
					txt -1, lang("昇る階段は見つからない。", "There're no upstairs here.")
					gosub *label_0623
					goto *label_1623
				} else {
					movelevelbystairs = 2
				}
			}
		}
	}
	if (feat == tile_downlocked) {
		f = 0
		if (gCurrentDungeonLevel == 3) {
			if (gdata(250 + 2) >= 65) {
				f = 1
			}
		}
		if (gCurrentDungeonLevel == 17) {
			if (gdata(250 + 2) >= 115) {
				f = 1
			}
		}
		if (gCurrentDungeonLevel == 25) {
			if (gdata(250 + 2) >= 125) {
				f = 1
			}
		}
		if (gCurrentDungeonLevel == 44) {
			if (gdata(250 + 2) >= 125) {
				f = 1
			}
		}
		if (f == 1) {
			if (gCurrentDungeonLevel == 44) {
				txt -1, lang("厳重に封印された扉の前に立つと、三つの魔石が鈍い光を放った。", "The magic stones shine softly as you approach the sealed door.")
			} else {
				txt -1, lang("扉の鍵を開けた。", "You unlock the door")
			}
			snd 23
			cell_featset cX(cc), cY(cc), tile_downstairs, 11
			goto *label_1617
		}
		snd 22
		txt -1, lang("鍵のかかった扉が行く手を塞いでいる。", "The door is locked. It seems you need a specific key to unlock the door.")
		goto *label_1617
	}
	if (areaId(gCurrentMap) == 8) {
		if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
			if (areaHasBeenConquered(gCurrentMap) != (-1)) {
				txt -1, lang("クエストを放棄して階を移動する？", "Really give up the quest and move over?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval != 0) {
					gosub *label_0623
					goto *label_1623
				}
			}
		}
	}
	if (movelevelbystairs) {
		actionsp 0, 15
		if (stat == 0 | cInventoryWeightType(0) >= 3) {
			if (stat == 0 | rnd(4 + 1 - cInventoryWeightType(0)) == 0) {
				txt -1, lang("うわああ！" + name(0) + "は階段から足を踏み外した。", "Noooo! You lost your step and roll down!")
				dmghp cc, cMaxHp(cc) * (cInventoryWeight(0) * 10 / cMaxInventoryWeight(0) + 10) / 100 + 1, -7
				msg_halt
			}
			if (cState(0) == 0) {
				goto *label_1608
			}
		}
	}
	if (feat(1) == 15) {
		if (feat(2) + feat(3) * 100 == 35) {
			comctrl = 0
			gosub *label_1144
			if (stat == 1) {
				goto *label_1340
			} else {
				goto *label_1623
			}
		}
	}
	snd 49
	levelexitby = 4
	if (movelevelbystairs == 2) {
		if (gCurrentMap = areaId_carlia) {
			if (gCurrentDungeonLevel == 1) {
				gDestinationMap = 44
				gDestinationDungeonLevel = 1
				levelexitby = 2
			}
		}
	}
	goto *label_0939
*label_1432
*label_1433
	item_find 636, 3
	if (stat == (-1)) {
		txt -1, lang("ロックピックを所持していない。", "You don't have lockpicks.")
		return 0
	}
	ti = stat
	txt -1, lang("ロックピックを使用した。", "You use a lockpick.")
	snd 22
	item_find 637, 3
	if (stat != (-1)) {
		i = sdata(158, 0) * 150 / 100 + 5
		txt -1, lang("スケルトンキーも使用した。", "You also use the skeleton key.")
	} else {
		i = sdata(158, 0)
	}
	f = 0
	if (i * 2 < val) {
		txt -1, lang("この鍵を開ける技術はない。", "The lock mechanism is beyond your skill.")
		f = 1
	}
	if (f == 0) {
		if (i / 2 >= val) {
			txt -1, lang("楽勝だ。", "Easy.")
		} else {
			if (rnd(rnd(i * 2) + 1) < val) {
				txt -1, lang("開錠に失敗した。", "You fail to unlock it.")
				f = 1
				skillexp2 158, cc, val / 10 + 1
			}
		}
	}
	if (f) {
		if (rnd(3) == 0) {
			iNumber(ti)--
			cell_refresh iX(ti), iY(ti)
			txt -1, lang("ロックピックは壊れた。", "Your lockpick breaks.")
		}
		txtnew
		txt -1, lang("もう一度試みる？", "Try again?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		valhinan = val
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval == 0) {
			goto *label_1434
		}
		return 0
	}
	goto *label_1435
*label_1434
	val = valhinan
	goto *label_1433
*label_1435
	txt -1, lang("開錠に成功した。", "You successfully unlock it.")
	r1 = cc
	r2 = val
	gosub *label_0667
	return 1
*label_1436
	if (iId(ci) == 361) {
		modkarma 0, -10
		invctrl = 22, 0
		invfile = iParam1(ci)
		snd 23
		gosub *label_1493
		screenupdate = -1
		gosub *label_0623
		goto *label_1617
	}
	if (iId(ci) == 560) {
		invctrl = 24, 0
		snd 100
		goto *label_1280
	}
	if (iId(ci) == 616) {
		invctrl = 24, 2
		snd 100
		goto *label_1280
	}
	if (iId(ci) == 600) {
		snd 22
		txt -1, lang("足枷を外した。", "You unlock the shackle.")
		if (gCurrentMap == 33) {
			if (gCurrentDungeonLevel == 1) {
				if (gdata(250 + 8) == 0) {
					if (cState(gdata(250 + 9)) == 1) {
						tc = findchara(203)
						if (tc != 0) {
							txtef 9
							txt -1, lang("モイアー「馬鹿やろう！！」", "Moyer yells, " + cnvtalk("You idiot!"))
							lockon gdata(250 + 9), tc, 16
							cHate(gdata(250 + 9)) = 1000
						}
						gdata(250 + 8) = 1
					}
				}
			}
		}
		goto *label_1617
	}
	if (iCount(ci) != 0) {
		invfile = iCount(ci)
		invcontainer(1) = iId(ci)
		if (iId(ci) == 641) {
			refweight = -1
			dup ciweight, iWeight(ci)
		} else {
			refweight = 0
		}
		if (iCount(ci) == 3) {
			if (gCurrentMap != 7) {
				txt -1, lang("それは家の中でのみ使用できる。", "You can only use it at your home.")
				gosub *label_0623
				goto *label_1623
			}
		}
		if (iCount(ci) == 4 | iCount(ci) == 6 | contafurniturecheck(iId(ci)) != (-1)) {
			if (areaType(gCurrentMap) != 5) {
				txt -1, lang("それは自分の物件でのみ使用できる。", "You can only use it at your home.")
				gosub *label_0623
				goto *label_1623
			}
		}
		if (iCount(ci) == 5) {
			if (areaId(gCurrentMap) != 102) {
				txt -1, lang("それは店の中でのみ使用できる。", "You can only use it at your shop")
				gosub *label_0623
				goto *label_1623
			}
		}
		file = "shoptmp.s2"
		ctrlFile 4
		file = "shop" + invfile + ".s2"
		tmpload "" + file
		exist exedir + "tmp\\" + file
		if (strsize != (-1)) {
			ctrlFile 3
			inv_getheader -1
			repeat invrange, invhead
				if (iId(cnt) == 743) {
					getitemid cnt
				}
				checkalter cnt
				if (inv(34, cnt)) {
					getunid4item cnt
				}
			loop
		} else {
			inv_getheader -1
			repeat invrange, invhead
				iNumber(cnt) = 0
			loop
		}
		shoptrade = 0
		invsubroutine = 1
		invctrl = 22, 2
		if (invfile == 3) {
			txt -1, lang("残り" + gRightsToSucceedTo + "個分のアイテムの相続権を持っている。", "You can claim " + gRightsToSucceedTo + " more heirloom" + _s2(gRightsToSucceedTo) + ".")
			invctrl(1) = 1
		}
		if (invcontainer(1) == 794) {
			invcontainer = 30
			menucycle = 1
			invctrl(1) = 99
		}
		if (invcontainer(1) == 641) {
			invcontainer = 8
			menucycle = 1
			invctrl(1) = 3
		}
		if (invcontainer(1) == 579) {
			invcontainer = 50
			menucycle = 1
			invctrl(1) = 3
		}
		if (invfile == 10) {
			invcontainer = 100
			menucycle = 1
			invctrl(1) = 13
		}
		if (invfile == 17) {
			invcontainer = 0
			invctrl(1) = 13
		}
		if (contafurniturecheck(invcontainer(1)) != (-1)) {
			invcontainer = isetcontafurniture(1, stat)
			menucycle = 1
			invctrl(1) = isetcontafurniture(2, stat)
		}
		mode = 6
		snd 100
		gosub *label_1280
		invcontainer = 0
		if (refweight == (-1)) {
			// クーラーボックスの重量を初期化する
			// 重量変更処理そのものを廃止すると、クーラーボックスに内容物があるデータで
			// 内容物の重量が加算された状態から変更できなくなるため
			refweight = iorgweight(iId_coolerBox)
		}
		file = "shop" + invfile + ".s2"
		ctrlFile 4
		file = "shoptmp.s2"
		ctrlFile 3
		if (refweight != 0) {
			ciweight = refweight
			gosub *refreshPCBurdenState
		}
		gosub *label_0623
		mode = 0
		goto *label_1617
	}
	item_separate ci
	if (iParam1(ci) != 0) {
		if (iParam2(ci) != 0) {
			val = iParam2(ci)
			gosub *label_1432
			if (stat == 0) {
				screenupdate = -1
				gosub *label_0623
				goto *label_1617
			}
		}
	}
	if (iParam1(ci) == 0) {
		txt -1, lang("中身は空っぽだ。", "It's empty!")
	} else {
		if (iId(ci) == 752) {
			gosub *label_1438
		} else {
			gosub *label_1437
		}
		item_stack cc, ri
	}
	screenupdate = -1
	gosub *label_0623
	goto *label_1617
*label_1437
	snd 23
	txt -1, lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
	if (oomSEST_noAnimation == 0) {
	msg_halt
	}
	ri = ci
	if (iId(ri) == 394) {
		tc = cc
		efid = 1117
		efp = 100 + iParam1(ri) * 10
		iParam1(ri) = 0
		iParam2(ri) = 0
		iParam3(ri) = 0
		gosub *label_1398
		goto *label_1617
	}
	if (oabit(16, gCurrentMap)) {
		if (iId(ri) == 240 & iParam2(ri) != 0) {
			val = iParam2(ri)
			gosub *label_0718
			if (stat == 1) {
				txt -1, lang(name(cc) + "は罠を解除した。", "You disarm the trap.")
			} else {
				txt -1, lang("罠だ！", "It's trap!")
				gosub *label_1825
				gosub *label_0623
				goto *label_1617
			}
		}
	}
	p = 3 + rnd(5)
	if (iId(ri) == 415 | iId(ri) == 416 | iId(ri) == 734) {
		p = 1
	}
	randomize iParam3(ri)
	repeat p
		dbid = 0
		if (cnt == 0) {
			p = 3
		} else {
			p = 2
		}
		if (iId(ri) == 239) {
			if (cnt == 0 & rnd(3) == 0) {
				p = 4
			} else {
				p = 3
			}
			if (rnd(60) == 0) {
				dbid = 559
			}
		}
		flt calcobjlv(iParam1(ri)), calcfixlv(p)
		flttypemajor = fsetchest(rnd(length(fsetchest)))
		if (cnt > 0) {
			if (rnd(3) != 0) {
				if (rnd(3) != 0) {
					flttypeminor = 0
					flttypemajor = 68000
				} else {
					flttypemajor = 0
					flttypeminor = 77001
				}
			}
		}
		if (iId(ri) == 241) {
			if (rnd(3) != 0) {
				flttypeminor = 0
				flttypemajor = 68000
			} else {
				flttypemajor = 0
				flttypeminor = 77001
			}
		}
			/*ガシャポンの玉開封？*/
		if (iId(ri) == 415 | iId(ri) == 416) {
			flttypeminor = 0
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			fixlv = 3
			if (iId(ri) == 416) {
				fixlv = 4
			}
			if (rnd(30) == 0) {
				dbid = 559
			}
			if (iId(ri) == 416 & ibit(5, ri)) {
				p = rnd(3)
				if (p == 0) {
					dbid = 639
				}
				if (p == 1) {
					dbid = 655
				}
				if (p == 2) {
					dbid = 662
				}
			}
		}
		in = 0
		if (iId(ri) == 734) {
			dbid = 54
			randomize
			if (rnd(75) == 0) {
				in = 50 * iValue(ci)
			} else {
				in = rnd(iValue(ci) / 10 + 1) + 1
			}
		}
		if (iId(ri) == 284) {
			dbid = 54
			in = rnd(1000) + 1
			if (rnd(5) == 0) {
				in = rnd(9) + 1
			}
			if (rnd(10) == 0) {
				in = rnd(5000) + 5000
			}
			if (rnd(20) == 0) {
				in = rnd(20000) + 10000
			}
		}
		itemcreate -1, dbid, cX(0), cY(0), in
	loop
	randomize
	f = 0
	if (iId(ri) != 734) {
		if (rnd(10) == 0) {
			f = 1
		}
	}
	if (iId(ri) == 239 | iId(ri) == 240) {
		p = rnd(3)
		if (gettrait(0, 170)) {
			p++
		}
		repeat p
			flt calcobjlv(iParam1(ri))
			flttypeminor = 77001
			oo_num = rnd(rnd(10) + 1) + 1
			if (rnd(5) == 0) {
				oo_num *= rnd(3) + 1
			}
			itemcreate -1, 0, cX(0), cY(0), oo_num
		loop
		// クルーラ信仰時の地図追加
		if (godcheck() == "krula") {
			if (rnd(50) >= limit(cPietyPoint(0) / 400, 1, 30)) {
				itemcreate -1, 621, cX(0), cY(0), 1
			}
		}
		if (rnd(5) == 0) {
			f = 1
		}
	}
	if (f) {
		flt
		oo_num = 1
		if (gettrait(0, 170)) {
			oo_num += limit(iParam1(ri) / 50, 0, 10000 - oo_num)
		}
		oo_num += rnd(1 + rnd(1 + limit(iParam1(ri) / 10, 0, 10000 - oo_num)))
		itemcreate -1, 622, cX(0), cY(0), oo_num
	}
	if (iId(ri) == 415 | iId(ri) == 416) {
		if (rnd(100) == 1) {
			itemcreate -1, 685, cX(0), cY(0), 0
			iSubname(ci) = 176
		}
	}
	if (iId(ri) == 415 | iId(ri) == 416) {
		if (rnd(1000) == 1) {
			itemcreate -1, 685, cX(0), cY(0), 0
			iSubname(ci) = 210
		}
	}
	snd 24
	txt -1, lang(itemname(ri) + "から溢れ出た高級品が、足元に散らばった。", "Several quality goods spread out from " + itemname(ri) + ".")
	autosave = 1 * (gCurrentMap != 35)
	if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
		autosave = 0
	}
	iParam1(ri) = 0
	if (iId(ri) != 734) {
		iParam2(ri) = 0
	}
	iParam3(ri) = 0
	if (iId(ri) == 284) {
		modkarma 0, -4
	}
	if (iId(ri) == 283) {
		modkarma 0, -8
	}
	return
*label_1438
	oomSEST_log "new year gift"
	snd 23
	txt -1, lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
	msg_halt
	snd 24
	randomize
	ri = ci
	cc = 0
	iParam1(ri) = 0
	oomSEST_log "new year gift1"
	if (iParam3(ri) < 100) {
		if (rnd(3) == 0) {
			oomSEST_log "new year gift1-1"
			if (synccheck(cc, -1)) {
				txt -1, lang("悪意を持った何かが袋から飛び出してきた！", "Something jumps out from the pack!")
			}
			repeat 3 + rnd(3)
				flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(2)
				characreate -1, 0, cX(cc), cY(cc)
			loop
			return
		}
		if (rnd(3) == 0) {
			oomSEST_log "new year gift1-2"
			if (synccheck(cc, -1)) {
				txt -1, lang("罠だ！お年玉袋は発火した。", "It's trap! The gift ignites.")
			}
			repeat 6
				tlocx = cX(0) + rnd(3) - rnd(3)
				tlocy = cY(0) - rnd(3) + rnd(3)
				if (tlocx < 0 | tlocx >= mapWidth | tlocy < 0 | tlocy >= mapHeight) {
					continue
				}
				addmef tlocx, tlocy, 5, 24, rnd(15) + 20, 50, 0
				mapitem_fire tlocx, tlocy
			loop
			return
		}
		if (synccheck(cc, -1)) {
			txt -1, lang("中には呪いの手紙が入っていた。", "You find a cursed letter inside.")
		}
		efid = 1114
		efp = 1000
		tc = 0
		gosub *label_1398
		return
	}
	oomSEST_log "new year gift2"
	if (iParam3(ri) < 200) {
		if (rnd(4) == 0) {
			if (synccheck(cc, -1)) {
				txtef 5
				txt -1, lang(" *チリリリリーン* ", "*ring ring ring*")
			}
			flt
			characreate -1, 328 + rnd(2), cX(cc), cY(cc)
			if (stat != 0) {
				if (cRelationship(cc) <= (-3)) {
					cRelationship(rc) = -1
					cOriginalRelationship(rc) = -1
				}
			}
			return
		}
		if (rnd(5) == 0) {
			if (synccheck(cc, -1)) {
				txt -1, lang("妹が入っていた！", "The pack contains your younger sister!")
			}
			flt
			characreate -1, 176, cX(cc), cY(cc)
			if (stat != 0) {
				cGold(rc) = 5000
			}
			return
		}
		if (synccheck(cc, -1)) {
			txt -1, lang("何かが袋から出てきた。", "There's something inside the pack.")
		}
		flt
		itemcreate -1, isetgiftminor(rnd(length(isetgiftminor))), cX(0), cY(0), 1
		return
	}
	oomSEST_log "new year gift3"
	if (rnd(3) == 0) {
		if (synccheck(cc, -1)) {
			txtef 5
			txt -1, lang(" *チリリリリーン* ", "*ring ring ring*")
		}
		repeat 2 + rnd(3)
			flt
			characreate -1, 328 + rnd(2), cX(cc), cY(cc)
			if (stat != 0) {
				if (cRelationship(cc) <= (-3)) {
					cRelationship(rc) = -1
					cOriginalRelationship(rc) = -1
				}
			}
		loop
		return
	}
	oomSEST_log "new year gift4"
	if (rnd(50) == 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang("これは素晴らしい贈り物だ！", "This is truly a wonderful gift!")
		}
		flt
		itemcreate -1, isetgiftgrand(rnd(length(isetgiftgrand))), cX(0), cY(0), 1
		return
	}
	oomSEST_log "new year gift5"
	if (synccheck(cc, -1)) {
		txt -1, lang("何かが袋から出てきた。", "There's something inside the pack.")
	}
	flt
	itemcreate -1, isetgiftmajor(rnd(length(isetgiftmajor))), cX(0), cY(0), 1
	oomSEST_log "new year gift end"
	return
*label_1439
	cell_featread dx, dy
	if (feat == tile_doorclosed4 & feat(2) > 0) {
		if (cc == 0) {
			val = feat(2)
			gosub *label_1432
			if (stat == 0) {
				screenupdate = -1
				gosub *label_0623
				await 100
				goto *label_1617
			}
			feat(2) = 0
		} else {
			goto *label_1617
		}
	}
	if (feat(2) > 0) {
		f = 0
		if (rndex(feat(2) * 20 + 150) < sdata(158, cc) * 20 + 20) {
			f = 1
		}
	} else {
		f = 1
	}
	if (ocdata(2, cc) == 1) {
		f = 0
	}
	if (f) {
		if (feat(2) > 0) {
			r1 = cc
			r2 = feat(2)
			gosub *label_0667
		}
		if (feat == tile_doorclosed1) {
			cell_featset dx, dy, tile_dooropen1, 20, 0, -1
		} else {
			if (feat == tile_doorclosed2) {
				cell_featset dx, dy, tile_dooropen2, 20, 0, -1
			} else {
				if (feat == tile_doorclosed3) {
					cell_featset dx, dy, tile_dooropen3, 20, 0, -1
				} else {
					if (feat == tile_doorclosed4) {
						cell_featset dx, dy, tile_dooropen4, 20, 0, -1
					} else {
						cell_featset dx, dy, tile_dooropen, 20, 0, -1
					}
				}
			}
		}
		if (synccheck(cc, -1)) {
			txt -1, lang(name(cc) + "は扉を開けた。", name(cc) + " open" + _s(cc) + " the door.")
			if (feat == tile_doorclosed1) {
				snd 48
			} else {
				if (feat == tile_doorclosed2) {
					snd 67
				} else {
					if (feat == tile_doorclosed3) {
						snd 71
					} else {
						if (feat == tile_doorclosed4) {
							snd 48
						} else {
							if (mapTileType == 8) {
								snd 67
							} else {
								if (mapTileType == 9) {
									snd 71
								} else {
									snd 48
								}
							}
						}
					}
				}
			}
		}
	} else {
		if (ocdata(2, cc) != 1) {
			msgdup++
			if (synccheck(cc, -1)) {
				snd 22
				txt -1, lang(aln(cc) + "開錠に失敗した。", name(cc) + " fail" + _s(cc) + " to open the door.")
			}
		}
	}
	if (cc == 0) {
		await 100
	}
	goto *label_1617
*label_1440
	txt -1, lang("何を閉める？", "Which door do you want to close? ")
	gosub *label_0623
	val = 0
	gosub *label_1350
	if (stat == 0) {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		goto *label_1623
	}
	cell_featread x, y
	if (feat(1) != 20) {
		txt -1, lang("その方向に閉められるものはない。", "There's nothing to close.")
		gosub *label_0623
		goto *label_1623
	}
	if (map(x, y, 1) != 0) {
		txt -1, lang("何かが邪魔で閉められない。", "There's something on the floor.")
		gosub *label_0623
		goto *label_1623
	}
	if (feat == tile_dooropen1) {
		cell_featset x, y, tile_doorclosed1, 21, -1, -1
	} else {
		if (feat == tile_dooropen2) {
			cell_featset x, y, tile_doorclosed2, 21, -1, -1
		} else {
			if (feat == tile_dooropen3) {
				cell_featset x, y, tile_doorclosed3, 21, -1, -1
			} else {
				if (feat == tile_dooropen4) {
					cell_featset x, y, tile_doorclosed4, 21, -1, -1
				} else {
					cell_featset x, y, tile_doorclosed, 21, -1, -1
				}
			}
		}
	}
	txt -1, lang(name(cc) + "は扉を閉めた。", name(cc) + " close the door.")
	goto *label_1617
*label_1441
	if (cc != 0) {
		if (efid != 661) {
			if (godcheck(cc) == "mani" & cPietyPoint(cc) >= 200) {
				if (ocdata(155, cc) >= 3) {
					if (rnd(25) == 0) {
						efid = 661
						gosub *label_1775
						if (stat == 1) {
							ctalk cc, 427, cc, tc
						}
						bk_cw@00m = cw
						gosub *label_1396
						cw = bk_cw@00m
						if (stat == 1) {
							gosub *label_1775
							if (stat == 1) {
								ctalk cc, 428, cc, tc
							}
							return
						}
					}
				}
			}
		}
	}
	dmgdisplayflag = 1 * (cfg_dmgmonitortype < 2)
	if (zerorangefire == 0) {
		dim dmgpack, 5, 245
	}
	attackrange = 1
	ele = 0
	ammoproc = -1
	ammox = cX(tc)
	ammoy = cY(tc)
	attackitem = cw
	if (ammo != (-1)) {
		if (cc != 0) {
			if (petcheck(cc) == 0 | gCurrentMap == 40 | gCurrentMap == 49) {
				if (cTurn(cc) \ 5 == 0) {
					p(2) = 0
					if (ocdata(155, cc) >= 5) {
						if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) >= 5) {
							p(2) = 1
						} else {
							p(2) = 5
						}
					} else {
						if (badstatuscheck(cc) == 0) {
							p(2) = 3
						} else {
							if (cLevel(tc) > cLevel(cc)) {
								p(2) = 2
							} else {
								if (rnd(25) == 0) {
									p(2) = 4
								}
							}
						}
					}
					if (loadedammo(ammo, p(2)) == 0) {
						repeat 2
							if (encpfindspec(ammo, 90000 + p(2), p) != (-1)) {
								if (p(1) \ 1000 > 0) {
									txt -1, lang(aln(cc) + ammoname(p(2)) + "を装填した。", "You load " + ammoname(p(2)) + ".")
									iCount(ammo) = p
									break
								}
							}
							p(2) = 0
						loop
					}
				}
			} else {
				if (ocdata(9, cc) > 0) {
					if (loadedammo(ammo, ocdata(9, cc) - 1) == 0) {
						if (encpfindspec(ammo, 90000 + ocdata(9, cc) - 1, p) != (-1)) {
							if (p(1) \ 1000 > 0) {
								txt -1, lang(aln(cc) + ammoname(ocdata(9, cc) - 1) + "を装填した。", "You load " + ammoname(ocdata(9, cc) - 1) + ".")
								iCount(ammo) = p
							}
						} else {
							ocdata(9, cc) = 0
						}
					}
				}
				if (ocdata(9, cc) == 0) {
					if (iCount(ammo) != (-1)) {
						txt -1, lang(aln(cc) + "通常弾を装填した。", name(cc) + " load normal ammo.")
						iCount(ammo) = -1
					}
				}
			}
		}
		if (iCount(ammo) != (-1)) {
			if (iEnchantmentPower(ammo, iCount(ammo)) \ 1000 <= 0) {
				txt -1, lang("通常弾を装填した。", "You load normal ammo.")
				iCount(ammo) = -1
			} else {
				ammoproc = iEnchantmentId(ammo, iCount(ammo)) \ 10000
				if (cc == 0) {
					if (cSp(0) < 50) {
						if (cSp(0) < rnd(75)) {
							txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
							dmgsp 0, encammoref(2, ammoproc) / 2 + 1
							ammoproc = -1
							return 1
						}
					}
					dmgsp 0, rnd(encammoref(2, ammoproc) + 1)
				}
				if (ammoproc == 4) {
					if (counterattack) {
						txt -1, lang("今は使えない。", "You can't use that ammo right now.")
						ammoproc = -1
						return 1
					}
				}
				if (efid == 766) {
					iEnchantmentPower(ammo, iCount(ammo)) -= rounds
				} else {
					f = 1
					if (gettrait(cc, 77)) {
						if (rnd(100) < (stat * 20) + 10) {
							f = 0
						}
					}
					if (f) {
						iEnchantmentPower(ammo, iCount(ammo))--
					}
				}
			}
		}
	}
	if (ocbit(11, cc)) {
		if (gettrait(cc, 180)) {
			if (ammoproc == (-1)) {
				modstress -75
			} else {
				modstress -1250
			}
		}
	}
	if (cfg_dmgmonitor != 0 & cfg_dmgmonitortype == 2 & zerorangefire == 1) {
		dim dmgpack, 5, 245
	}
	if (ammoproc == 0) {
		ammoprocbk = 0
		repeat 3
			ele = 0
			extraattack = 0
			gosub *label_1444
			if (cState(tc) != 1) {
				gosub *label_1295
				if (stat == 0) {
					break
				} else {
					tc = ocdata(150, cc) - 1
				}
			}
		loop
	} else {
		if (ammoproc == 5) {
			ammoprocbk = 5
			repeat 10
				ele = 0
				gosub *label_1301
				if (listmax == 0) {
					break
				}
				tc = list(0, rnd(listmax))
				if (cc == 0 | cRelationship(cc) >= 0) {
					if (cRelationship(tc) >= 0) {
						if (cnt != 0) {
							continue cnt + (rnd(5) == 0)
						}
					}
				} else {
					if (cRelationship(tc) == (-3)) {
						continue cnt + (rnd(5) == 0)
					}
				}
				extraattack = 0
				gosub *label_1444
			loop
		} else {
			extraattack = 0
			gosub *label_1444
		}
	}
	if (cfg_dmgmonitortype > 1 & zerorangefire == 0 | (cfg_dmgmonitortype == 2 & zerorangefire == 1)) {
		repeat 245
			if (dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0) {
				continue
			}
			if (synccheck(cnt, -1) == 1) {
				if (cfg_dmgtxttype == 1) {
					if (oom_attack_f == 1) {
						// TODO: Don't repeat yourself.
						if (dmgpack(2, cnt) == 0) {
							if (dmgpack(3, cnt) == 0) {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃を避けた。", cdatan(0, cnt) + " evade" + _s(cnt) + " attack.")
							} else {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃に巻き込まれた。", cdatan(0, cnt) + " " + is(cnt) + " attacked.")
							}
						} else {
							if (dmgpack(2, cnt) == 1) {
								nAttack@st = ""
							} elseif (dmgpack(2, cnt) == 2) {
								nAttack@st = lang("2回", " twice")
							} else {
								nAttack@st = dmgpack(2, cnt) + lang("回", " times")
							}
							txt -1, lang("" + name(cc) + "は" + cdatan(0, cnt) + "を" + nAttack@st + "攻撃した。", name(cc) + " attacked " + cdatan(0, cnt) + " " + nAttack@st + ".")
						}
					}
				}
			}
			if (showdamagecheck(dmgpack(1, cnt))) {
				if (dmgpack(2, cnt) != 0 | dmgpack(3, cnt) \ 1000 != 0) {
					mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 111
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					continue
				}
			}
			if (cfg_dmgmonitor3 == 1) {
				if (dmgpack(2, cnt) == 0 & dmgpack(3, cnt) / 1000 == 0) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 106
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		loop
	}
	attackvar = 0
	ammoproc = -1
	ammoprocbk = -1
	return
*label_1442
	if (cc != 0) {
		if (efid != 631) {
			if (cDamageReactionInfo(tc)) {
				if (distance < 6) {
					if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc))) {
						gosub *label_1299
						if (stat == 1) {
							gosub *label_1441
						}
					}
				}
				if (cHp(cc) < cMaxHp(cc) / 2) {
					return
				}
			}
		}
	}
	dmgdisplayflag = 1 * (cfg_dmgmonitortype < 2)
	dim dmgpack, 5, 245
	attacknum = 0
	attackrange = 0
	attackskill = 106
	ammo = -1
	ele = 0
	if (cEquipmentType(cc) & 1) {
		if (limit(sqrt(sdata(168, cc)) - 3, 1, 5) + cbit(30, cc) * 5 > rnd(100)) {
			gosub *label_1845
			if (gettrait(cc, 43) >= 2) {
				p = stat
				if (limit(sqrt(sdata(168, cc)) - 3, 1, 5) + (p == 3) * 5 > rnd(100)) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
					gosub *label_1845
				}
			}
		}
	}
	repeat 30
		body = 100 + cnt
		if (cdata(body, cc) \ 10000 == 0) {
			continue
		}
		if (cdata(body, cc) / 10000 == 10) {
			continue
		}
		if (cdata(body, cc) / 10000 == 11) {
			continue
		}
		attackrange = 0
		ammo = -1
		ele = 0
		cw = cdata(body, cc) \ 10000 - 1
		attackitem = cw
		if (iDiceX(cw) > 0) {
			attacknum++
			extraattack = 0
			if (iequiploc(cw) == 10) {
				gosub *label_1814
				gosub *label_1300
				if (stat == 1) {
					zerorangefire = 1
					gosub *label_1441
				}
			} else {
				attackskill = iSkill(cw)
				gosub *label_1443
			}
		}
	loop
	if (attackskill == 106) {
		extraattack = 0
		gosub *label_1443
	}
	attackvar = 0
	if (cfg_dmgmonitortype == 3) {
		repeat 245
			if (dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0) {
				continue
			}
			if (synccheck(cnt, -1)) {
				if (cfg_dmgtxttype == 1) {
					if (oom_attack_f == 1) {
						// TODO: Don't repeat yourself.
						if (dmgpack(2, cnt) == 0) {
							if (dmgpack(3, cnt) == 0) {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃を避けた。", cdatan(0, cnt) + " evade" + _s(cnt) + " attack.")
							} else {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃に巻き込まれた。", cdatan(0, cnt) + " " + is(cnt) + " attacked.")
							}
						} else {
							if (dmgpack(2, cnt) == 1) {
								nAttack@st = ""
							} elseif (dmgpack(2, cnt) == 2) {
								nAttack@st = lang("2回", " twice")
							} else {
								nAttack@st = dmgpack(2, cnt) + lang("回", " times")
							}
							txt -1, lang("" + name(cc) + "は" + cdatan(0, cnt) + "を" + nAttack@st + "攻撃した。", name(cc) + " attacked " + cdatan(0, cnt) + " " + nAttack@st + ".")
						}
					}
				}
			}
			if (showdamagecheck(dmgpack(1, cnt))) {
				if (dmgpack(2, cnt) != 0 | dmgpack(3, cnt) \ 1000 != 0) {
					mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 111
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					continue
				}
			}
			if (cfg_dmgmonitor3 == 1) {
				if (dmgpack(2, cnt) == 0 & dmgpack(3, cnt) / 1000 == 0) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 106
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		loop
	}
	zerorangefire = 0
	return
*label_1443
	if (cfg_dmgmonitor != 0 & cfg_dmgmonitortype == 2) {
		dim dmgpack, 5, 245
	}
	gosub *label_1444
	if (cfg_dmgmonitortype == 2) {
		repeat 245
			if (dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0) {
				continue
			}
			if (synccheck(cnt, -1) == 1) {
				if (cfg_dmgtxttype == 1) {
					if (oom_attack_f == 1) {
						// TODO: Don't repeat yourself.
						if (dmgpack(2, cnt) == 0) {
							if (dmgpack(3, cnt) == 0) {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃を避けた。", cdatan(0, cnt) + " evade" + _s(cnt) + " attack.")
							} else {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃に巻き込まれた。", cdatan(0, cnt) + " " + is(cnt) + " attacked.")
							}
						} else {
							if (dmgpack(2, cnt) == 1) {
								nAttack@st = ""
							} elseif (dmgpack(2, cnt) == 2) {
								nAttack@st = lang("2回", " twice")
							} else {
								nAttack@st = dmgpack(2, cnt) + lang("回", " times")
							}
							txt -1, lang("" + name(cc) + "は" + cdatan(0, cnt) + "を" + nAttack@st + "攻撃した。", name(cc) + " attacked " + cdatan(0, cnt) + " " + nAttack@st + ".")
						}
					}
				}
			}
			if (showdamagecheck(dmgpack(1, cnt))) {
				if (dmgpack(2, cnt) != 0 | dmgpack(3, cnt) \ 1000 != 0) {
					mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 111
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					continue
				}
			}
			if (cfg_dmgmonitor3 == 1) {
				if (dmgpack(2, cnt) == 0 & dmgpack(3, cnt) / 1000 == 0) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 106
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		loop
	}
	return
*label_1444
	oom_attack_f = 1
	if (cState(cc) != 1) {
		return
	}
	if (cState(tc) != 1) {
		return
	}
	if (cFear(cc) != 0) {
		oom_attack_f = 0
		msgdup++
		txt -1, lang(name(cc) + "は怖気づいた。", name(cc) + " " + is(cc) + " frightened.")
		return
	}
	if (gettrait(cc, 188) == (-1) | (gCurrentMap == 210 & ncgdata(311) & cc < 56)) {
		oom_attack_f = 0
		msgdup++
		txt -1, lang(name(cc) + "は攻撃できない。", name(cc) + " can't attack.")
		return
	}
	if (cfg_dmgmonitortype == 1) {
		dim dmgpack, 5, 245
		dmgdisplayflag = 1 * (cfg_dmgmonitortype < 2)
	}
	dmgpack(0, tc)++
	if (map(cX(tc), cY(tc), 8) != 0) {
		i = map(cX(tc), cY(tc), 8) - 1
		if (mef(0, i) == 2) {
			if (rnd(2) == 0) {
				if (cfg_dmgmonitortype < 2 & cfg_dmgmonitor3 == 1) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, tc, cc
					ccolor 106
					if (stat == 0) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
				if (synccheck(cc, -1)) {
					if (cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0) {
						txt -1, lang(name(cc) + "は霧の中の幻影を攻撃した。", name(cc) + " attack" + _s(cc) + " an illusion in the mist.")
					}
				}
				return
			}
		}
	}
	if (attackrange == 1) {
		if (efid != (-4)) {
			animeid = attackskill
			aniref = cw
			gosub *label_0630
		}
	}
	if (attacknum > 1 | cc != 0) {
	}
	expmodifer = 1 + cbit(985, tc) * 15 + cbit(23, tc) + cbit(27, tc) + (gCurrentMap == 35) + oabit(8, gCurrentMap) * 15
	hit = calcattackhit()
	i = 0
	if (hit == 1) {
		attack_weakGuard // from physical attack
		if (critical) {
			if (cc == 0) {
				if (efid != (-13) & efid != (-15)) {
					if (cfg_dmgtxttype == 0) {
						ctalk cc, 1344, cc, tc
						if ( stat == 0 ) {
							txtef 3
							txt -1, lang("会心の一撃！ ", "Critical Hit!")
						}
					}
				}
			}
		}
		dmg = calcattackdmg()
		dmgbk = dmg
		if (synccheck(cc, -1)) {
			if (cc == 0 | (cfg_npcattackanime == 1 & petcheck(cc)) | cfg_npcattackanime == 2) {
				if (cfg_attackanime) {
					if (efid != (-15)) {
						animeid = 12
					} else {
						animeid = 24
					}
					aniref = dmg * 100 / cMaxHp(tc)
					gosub *label_0630
				}
			}
		}
		if (attackskill != 106) {
			if (iQuality(cw) >= 4) {
				if (iQuality(cw) == 6) {
					if (iParam3(cw) > 0 & iId(cw) != 743) {
						s(1) = itemName(cw)
					} else {
						s(1) = lang("", "The ") + iknownnamecnv(cw)
					}
				} elseif (iSubname(cw) >= 40000) {
					randomize iSubname(cw) - 40000
					if (iParam3(cw) > 0 & iId(cw) != 743) {
						s(1) = itemName(cw)
					} else {
						s(1) = random_title(1)
					}
					randomize timeGetTime()
				} else {
					if (iParam3(cw) > 0 & iId(cw) != 743) {
						s(1) = itemName(cw)
					} else {
						s(1) = lang("", "The ") + iknownnamecnv(cw)
					}
				}
				if (iParam3(cw) == 0 | iId(cw) == 743) {
					if (iQuality(cw) == iQuality_godly) {
						s(1) = lang("《", "{") + s(1) + lang("》", "}")
					} else {
						s(1) = lang("『", "<") + s(1) + lang("』", ">")
					}
				}
				if (synccheck(cc, -1)) {
					if (rnd(5) == 0) {
						if (cfg_dmgtxttype == 0) {
							txtef 9
							txt -1, lang(name(cc) + "は" + s(1) + "を誇らしげに構えた。", name(cc) + " wield" + _s(cc) + " " + s(1) + " proudly.")
						}
					}
				}
				i = 1
			}
		}
		if (attackskill == 106) {
			if (cElementOfUnarmedAttack(cc) != 0) {
				ele = cElementOfUnarmedAttack(cc) / 100000
				elep = cElementOfUnarmedAttack(cc) \ 100000
			}
		}
		if (synccheck(tc, -1)) {
			if (cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0) {
				if (extraattack) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
				}
				if (cfg_dmgtxttype == 1) {
					txt -1, lang(aln(cc) + name(tc) + "を攻撃した。", name(cc) + " " + _melee(1, cMeleeAttackType(cc)) + _s(cc) + " " + name(tc) + ".")
				} else {
					if (attackskill == 106) {
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を" + _melee(0, cMeleeAttackType(cc)), name(cc) + " " + _melee(0, cMeleeAttackType(cc)) + _s(cc) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + _melee(1, cMeleeAttackType(cc)), name(cc) + " " + _melee(1, cMeleeAttackType(cc)) + _s(cc) + " " + name(tc) + ".")
						}
					}
					if (attackskill == 108) {
						s = lang("弓", "bow")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 109) {
						s = lang("クロスボウ", "crossbow")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 110) {
						s = lang("銃", "gun")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 100) {
						s = lang("長剣", "sword")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 104) {
						s = lang("槍", "spear")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を突き刺して", name(cc) + " stab" + _s(cc) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で刺された。", name(cc) + " stab" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 105) {
						s = lang("杖", "staff")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を打って", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で打たれた。", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 101) {
						s = lang("短剣", "dagger")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を突き刺して", name(cc) + " stab" + _s(cc) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で刺された。", name(cc) + " stab" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 103) {
						s = lang("鈍器", "mace")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を打って", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で打たれた。", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 102) {
						s = lang("斧", "axe")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 107) {
						s = lang("鎌", "scythe")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if (attackskill == 111) {
						s = itemname(cw, 1, 1, 1)
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							gdata(809) = 2
							txt -1, lang(aln(cc) + name(tc) + "に" + s + "を投げ", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						} else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s + "で攻撃された。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s + ".")
						}
					}
				}
			}
		}
		dmgpack(2, tc)++
		dmghp tc, dmg + overdamage, cc, ele, elep
		if (rtdmg > cMaxHp(tc) / 20 | rtdmg > sdata(154, tc) | rnd(5) == 0) {
			if (critical) {
				skillexp2 186, cc, limit(limit(cPv(tc), 0, 10000) * limit(rtdmg, 1, 100000) / 250 + 60, 60, 300) / expmodifer, 2
			}
			skillexp2 attackskill, cc, limit(sdata(173, tc) * 2 - sdata(attackskill, cc) + 1, 5, 150) / expmodifer, 0, 4
			if (attackrange == 0) {
				skillexp2 152, cc, limit(limit(cPv(tc), 0, 10000) * limit(rtdmg, 1, 100000) / 250 + 20, 20, 100) / expmodifer, 0, 4
				if (cEquipmentType(cc) & 2) {
					p = 20
					if (sdata(173, tc) > sdata(167, cc)) {
						p = limitmax(sdata(173, tc) - sdata(167, cc) + p, 100)
					}
					skillexp2 167, cc, p / expmodifer, 0, 4
				}
			} else {
				if (attackskill == 111 | iId(cw) == 230) {
					skillexp2 152, cc, limit(limit(cPv(tc), 0, 10000) * limit(rtdmg, 1, 10000) / 250 + 10, 10, 50) / expmodifer, 0, 4
				} else {
					skillexp2 189, cc, limit(limit(cPv(tc), 0, 10000) * limit(rtdmg, 1, 10000) / 250 + 25, 25, 125) / expmodifer, 0, 4
				}
			}
			if (attackskill != 106) {
				if (cEquipmentType(cc) & 4) {
					cw2 = -1
					repeat 30
						body = 100 + cnt
						if (cdata(body, cc) \ 10000 == 0) {
							continue
						}
						if (cdata(body, cc) / 10000 == 10) {
							cw2 = cdata(body, cc) \ 10000 - 1
							break
						}
					loop
					if (cw != cw2) {
						p = 20
						if (sdata(173, tc) > sdata(166, cc)) {
							p = limitmax(sdata(173, tc) - sdata(166, cc) + p, 100)
						}
						skillexp2 166, cc, p / expmodifer, 0, 4
					}
				}
			}
			if (cc == 0 & gMount != 0 | ocdata(106, cc) != 0) {
				p = 30
				if (sdata(173, tc) > sdata(301, cc)) {
					p = limitmax(sdata(173, tc) - sdata(301, cc) + p, 150)
				}
				skillexp2 301, cc, p / expmodifer, 0, 5
			}
			if (cState(tc) == 1) {
				skillexp2 carmor(tc), tc, limit(250 * rtdmg / cMaxHp(tc) + 1, 3, 250) / expmodifer, 0, 5
				if (cEquipmentType(tc) & 1) {
					skillexp2 168, tc, limit(160 * rtdmg / cMaxHp(tc) + 40, 40, 200) / expmodifer, 0, 4
				}
			}
			if (attackskill != 106) {
				cw = attackitem
				if (ibit(10, cw)) {
					if (cbit(985, tc) == 0) {
						exp = limit(rtdmg, 0, cMaxHp(tc)) / 5
						gosub *label_1771
					}
				}
			}
		} else {
			if (critical) {
				skillexp2 186, cc, 60 / expmodifer, 2
			}
		}
		critical = 0
		if (attackskill == 106) {
			if (cEquipmentType(cc) == 0) {
				if (gettrait(cc, 69)) {
					if (rnd(100) < calctraitscore(stat)) {
						dmgcon tc, 7, 50 + int(sqrt(sdata(106, cc))) * 15
					}
				}
			}
			gosub *label_1693
			check_adddamage_punch
		} else {
			gosub *label_1445
		}
		dmg = dmgbk
		if (cCutCounterattack(tc) > 0) {
			if (attackrange == 0) {
				if (ogdata(505) != 2) {
					dmghp cc, int(limitf(double(dmg) * cCutCounterattack(tc) / 100 + 1, 1, 20000000)), tc, 61, 100
				} else {
					dmghp cc, int(limitf(double(dmg) * cCutCounterattack(tc) / 100 + 1, 1, 2000000000)), tc, 61, 100
				}
			}
		}
		if (cDamageReactionInfo(tc) != 0) {
			p = cDamageReactionInfo(tc) \ 1000
			ccbk = cc
			repeat 1
				if (attackrange == 0) {
					if (p == 61) {
						if (synccheck(cc, -1)) {
							txtef 8
							txt -1, lang("棘が" + name(cc) + "に刺さった。", name(cc) + " " + is(cc) + " stuck by several thorns.")
						}
						dmghp cc, limit(dmg / 10, 1, cMaxHp(tc) / 10), tc, p, cDamageReactionInfo(tc) / 1000
						break
					} else {
						if (p == 62) {
							if (synccheck(cc, -1)) {
								txtef 8
								txt -1, lang("エーテルの棘が" + name(cc) + "に刺さった。", name(cc) + " " + is(cc) + " stuck by several ether thorns.")
							}
							dmghp cc, limit(dmg / 10, 1, cMaxHp(tc) / 10), tc, p, cDamageReactionInfo(tc) / 1000
							break
						} else {
							if (p == 63) {
								if (attackskill != 106) {
									if (rnd(5) == 0) {
										item_acid cc, cw
									}
								}
							} else {
								if (synccheck(cc, -1)) {
									txtef 8
									txt -1, lang(elename(p) + "オーラが" + name(cc) + "を襲った。", name(cc) + " " + is(cc) + " stuck by several " + elename(p) + " thorns.")
								}
								dmghp cc, limit(dmg / 10, 1, cMaxHp(tc) / 10), tc, p, cDamageReactionInfo(tc) / 1000
								break
							}
						}
					}
				}
				if (dmg > cMaxHp(tc) / 10) {
					cc = tc
					tlocx = cX(cc)
					tlocy = cY(cc)
					if (p == 63) {
						if (synccheck(tc, -1)) {
							txtef 8
							txt -1, lang("酸が飛び散った。", "Acids spread over the ground.")
						}
						efid = 455
						efp = cDamageReactionInfo(tc) / 1000
						gosub *label_1398
						break
					}
				}
			loop
			cc = ccbk
		}
		if(eqfaction(tc, "overwish") & rnd(10) == 0 & cHp(tc) >= 0) {
			txtef 8
			txt_select -1, lang(name(cc) + "に破滅の願いが降りかかる！", ""), "", "", "", "", "", "", "", ""
			animeid = 20
			animode = cc
			gosub *label_0630
			addbuff cc, 62, 1, 20000, 2100000000
			txtef 4
			txt_select -1, lang(name(cc) + "の魂が削られた！", ""), "", "", "", "", "", "", "", ""
			cHp(cc) -= (cMaxHp(cc) / 2) + rnd(100000)
			dmghp cc, 10000, tc, 61, 100
		}
		ccadd = cc
		tcadd = tc
		cc = tc
		tc = ccadd
		check_adddamage_count carmor(cc)
		cc = ccadd
		tc = tcadd
	} else {
		if (synccheck(cc, -1)) {
			if (cc == 0 | (cfg_npcattackanime == 1 & petcheck(cc)) | cfg_npcattackanime == 2) {
				snd 4
			}
		}
		if (sdata(attackskill, cc) > sdata(173, tc) | rnd(5) == 0) {
			p = limit(sdata(attackskill, cc) - sdata(173, tc) / 2 + 1, 1, 60) / expmodifer
			skillexp2 173, tc, p, 0, 4
			skillexp2 187, tc, p, 0, 4
		}
	}
	if (cfg_dmgmonitortype == 1) {
		if (showdamagecheck(dmgpack(1, cnt))) {
			repeat 245
				if (dmgpack(3, cnt) \ 1000 == 0) {
					continue
				}
				mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
				ccolor 105
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 255, 255, 255, 150, 150, 150
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			loop
		}
		if (cfg_dmgtxttype == 1) {
			if (oom_attack_f == 1) {
				repeat 245
					if (synccheck(cnt, -1) == 1) {
						if (dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0) {
							continue
						}
						// TODO: Don't repeat yourself.
						if (dmgpack(2, cnt) == 0) {
							if (dmgpack(3, cnt) == 0) {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃を避けた。", cdatan(0, cnt) + " evade" + _s(cnt) + " attack.")
							} else {
								txt -1, lang("" + cdatan(0, cnt) + "は攻撃に巻き込まれた。", cdatan(0, cnt) + " " + is(cnt) + " attacked.")
							}
						} else {
							txt -1, lang("" + name(cc) + "は" + cdatan(0, cnt) + "を攻撃した。", name(cc) + " attacked " + cdatan(0, cnt) + ".")
						}
					}
				loop
			}
		}
	}
	if (hit == (-1)) {
		if (synccheck(cc, -1)) {
			if (cfg_dmgmonitortype < 2 & cfg_dmgmonitor3 == 1) {
				mondmgn(mondmgcnt) = "miss"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, tc, cc
				ccolor 106
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
			if (cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0) {
				if (extraattack) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
				}
				if (petcheck(tc)) {
					txt -1, lang(aln(tc) + name(cc) + "の攻撃を避けた。", name(tc) + " evade" + _s(tc) + " " + name(cc) + ".")
				} else {
					txt -1, lang(aln(cc) + "攻撃をかわされた。", name(cc) + " miss" + _s(cc, 1) + " " + name(tc) + ".")
				}
			}
		}
		ccadd = cc
		tcadd = tc
		cc = tc
		tc = ccadd
		check_adddamage_count 187
		cc = ccadd
		tc = tcadd
	}
	if (hit == (-2)) {
		if (synccheck(cc, -1)) {
			if (cfg_dmgmonitortype < 2 & cfg_dmgmonitor3 == 1) {
				mondmgn(mondmgcnt) = "evade!!"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, tc, cc
				ccolor 107
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
			if (cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0) {
				if (extraattack) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
				}
				if (petcheck(tc)) {
					txt -1, lang(aln(tc) + name(cc) + "の攻撃を華麗に避けた。", name(tc) + " skillfully evade" + _s(tc) + " " + name(cc) + ".")
				} else {
					txt -1, lang(aln(cc) + "攻撃を華麗にかわされた。", name(tc) + " skillfully evade" + _s(tc) + " " + name(cc) + ".")
				}
			}
		}
		if (gettrait(tc, 71)) {
			if (rnd(10) < calctraitscore(stat)) {
				counterattack++
			}
		}
		ccadd = cc
		tcadd = tc
		cc = tc
		tc = ccadd
		check_adddamage_count 187
		cc = ccadd
		tc = tcadd
	}
	if (tc == 0) {
		gdata(30) = 0
	}
	rowact_check tc
	if (extraattack == 0) {
		if (attackrange) {
			if (rnd(100) < cExtraShot(cc)) {
				ammoproc = -1
				extraattack++
				goto *label_1444
			}
		} else {
			if (rnd(100) < cExtraAttack(cc)) {
				extraattack++
				goto *label_1444
			}
		}
	} else {
		if (attackskill == 100 | attackskill == 101) {
			if (gettrait(cc, 75) > 1) {
				if (extraattack < stat) {
					if (rnd(100) < cExtraAttack(cc)) {
						extraattack++
						goto *label_1444
					}
				}
			}
		}
		if (extraattack == 1) {
			if (attackrange == 0) {
				if (cc == 0) {
					if (ogdata(482) == 2) {
						if (cEquipmentType(cc) & 4) {
							if (rnd(200) < cExtraAttack(cc)) {
								extraattack++
								goto *label_1444
							}
						}
					}
				}
			} else {
				if (attackskill == 109 | (attackskill == 110 & godcheck(cc) == "mani") | (attackskill == 108 & godcheck(cc) == "lulwy")) {
					extraattack++
					goto *label_1444
				}
			}
		}
		if (extraattack > 1) {
			if (attackskill == 109) {
				if (extraattack <= limit(sdata(109, cc) / 200 + 1, 1, 6)) {
					extraattack++
					goto *label_1444
				}
			}
			if (attackskill == 110 & godcheck(cc) == "mani" | (attackskill == 108 & godcheck(cc) == "lulwy")) {
				if (extraattack <= limit(sqrt(cPietyPoint(cc)) / 100 + 1, 1, 4)) {
					extraattack++
					goto *label_1444
				}
			}
		}
	}
	return
*label_1445
	if (ammo == (-1)) {
		oom_pot_enchant = attackitem
	} else {
		oom_pot_enchant = ammo
	}
	if (ibit(14, oom_pot_enchant)) {
		_switch_val = inv(36, oom_pot_enchant) \ 1000
		if (_switch_val == 27) {
			dmgcon tc, 4, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
		} else {
			if (_switch_val == 28) {
				dmgcon tc, 5, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
			} else {
				if (_switch_val == 29) {
					dmgcon tc, 3, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
				} else {
					if (_switch_val == 30) {
						dmgcon tc, 2, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
					} else {
						if (_switch_val == 262) {
							dmgcon tc, 1, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
						}
					}
				}
			}
		}
		if (rnd(30) == 0) {
			ibitmod 14, oom_pot_enchant, 0
			inv(36, oom_pot_enchant) = 0
			txt -1, lang(itemname(oom_pot_enchant) + "に塗られた毒を使い切った。", name(cc) + " exhausted poison dipped on " + itemname(oom_pot_enchant) + ".")
		}
	}
	if (ibit(6, oom_pot_enchant)) {
		dmgcon tc, 13, 5 + sdata(attackskill, cc) * 1.5
		if (rnd(20) == 0) {
			if (check_bigench(oom_pot_enchant) != 18) {
				ibitmod 6, oom_pot_enchant, 0
				txt -1, lang(itemname(oom_pot_enchant) + "に塗られた媚薬を使い切った。", name(cc) + " exhausted poison dipped on love potion.")
			}
		}
	}
	if (attackskill == 102) {
		if (gettrait(cc, 64)) {
			p = stat
			if (rnd(2) == 0) {
				dmgcon tc, 9, calctraitscore(p) * 50 + 100
			}
		}
	}
	if (attackskill == 103) {
		if (gettrait(cc, 65)) {
			if (rnd(10) < calctraitscore(stat)) {
				dmgcon tc, 7, 50 + int(sqrt(sdata(103, cc))) * 15
			}
		}
	}
	if (check_bigench(cw) == 4 & cState(tc) == 1) {
		gdata(809) = 1
		healdmg = ((((dmgbk + overdamage) / 100) * iBigenchantmentPower(cw)) + (iBigenchantmentPower(cw) * 10)) * (-1)
		healhp tc, healdmg
		if (showdamagecheck(healdmg)) {
			if (synccheck(tc, -1)) {
				mondmgn(mondmgcnt) = "" + healdmg
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if (stat == 0) {
					mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		animeid = 5
		gosub *label_0630
		txt -1, lang(name(tc) + "は過剰に回復した。", name(tc) + " " + is(tc) + " completely healed.")
	}
	if (check_bigench(cw) == 13) {
		dmgcon cc, 8, 10
	}
	if (check_bigench(cw) == 9 & cState(tc) == 1) {
		if (rnd(100) < iBigenchantmentPower(cw)) {
			addbuff tc, 62, 1, 20, 2100000000
			snd 117
			animeload 14, tc
		}
	}
	if (check_bigench(cw) == 10 & cState(tc) == 1) {
		if (rnd(100) < iBigenchantmentPower(cw)) {
			repeat 16
				if ( cdata(192 + cnt * 3, tc) == 0 ) {
					break
				}
				if ( cdata(192 + cnt * 3, tc) == 13 | cdata(192 + cnt * 3, tc) == 15 | cdata(192 + cnt * 3, tc) == 81) {
					continue
				}
				if ( cdata(192 + cnt * 3, tc) >= 19 & cdata(192 + cnt * 3, tc) < 29 ) {
					continue
				}
				if ( cdata(192 + cnt * 3, tc) >= 85 & cdata(192 + cnt * 3, tc) < 95 ) {
					continue
				}
				delbuff tc, cnt
				break
			loop
			snd 117
			animeload 14, tc
		}
	}
	repeat 15
		dmgdisplayflag = 0
		if (cfg_dmgtxttype == 1) {
			weaponenc = 1
			if (cfg_dmgmonitortype == 0) {
				weaponenc = 0
			}
		}
		weaponenc(1) = cfg_dmgmonitor4
		cw = attackitem
		if (iEnchantmentId(cw, cnt) == 0) {
			break
		}
		enc = iEnchantmentId(cw, cnt)
		if (findbuff(cc, 62) == (-1) | check_bigench(cw) == 3) {
			if (enc == 36) {
				p = rnd(iEnchantmentPower(cw, cnt) / 50 + 1) + 1
				if (ogdata(511) == 2) {
					p *= 2
				}
				healsp cc, p
				dmgsp tc, p / 2
				continue
			}
			if (enc == 38) {
				p = rnd(iEnchantmentPower(cw, cnt) / 25 + 1) + 1
				p = p * (50 + sdata(attackskill, cc)) / 50
				if (ogdata(511) == 2) {
					p *= 2
				}
				healmp cc, p
				if (cState(tc) != 1) {
					continue
				}
				dmgmp tc, p
				continue
			}
			if (enc == 37) {
				if (rnd(66) == 0) {
					if (cId(cc) == 176 | cId(cc) == 249) {
						evadd 101, cc
					} else {
						evadd 18, cc
					}
				}
				continue
			}
			if (enc == 40) {
				if (gLeftTurnsOfTimestop == 0) {
					if (counterattack == 0) {
						if (rnd(25) == 0) {
							ctalk cc, 1285, cc, cc
							txtef 9
							txt -1, lang(name(cc) + "は時を止めた。", name(cc) + " stop" + _s(cc) + " time.")
							if (gCurrentMap == 210) {
								stopthetimebegin limitmax(iEnchantmentPower(cw, cnt) / 100, 4) + 2
							} else {
								stopthetimebegin iEnchantmentPower(cw, cnt) / 100 + 1 + 1
							}
						}
					}
					continue
				}
			}
			if (enc == 57) {
				s = refchara(cId(tc), 8, 1)
				if (instr(s, 0, "/dragon/") != (-1)) {
					gdata(809) = 1
					if (ogdata(505) != 2) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					} else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
			if (enc == 61) {
				s = refchara(cId(tc), 8, 1)
				if (instr(s, 0, "/god/") != (-1)) {
					gdata(809) = 1
					if (ogdata(505) != 2) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					} else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
			if (enc == 62) {
				s = refchara(cId(tc), 8, 1)
				if (instr(s, 0, "/man/") != (-1)) {
					gdata(809) = 1
					if (ogdata(505) != 2) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					} else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
			if (enc == 58) {
				s = refchara(cId(tc), 8, 1)
				if (instr(s, 0, "/undead/") != (-1)) {
					gdata(809) = 1
					if (ogdata(505) != 2) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					} else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
		}
		i = enc / 10000
		if (i != 0) {
			enc = enc \ 10000
			if (findbuff(cc, 62) == (-1) | check_bigench(cw) == 3) {
				if (i == 7) {
					if (orgdmg <= 1) {
						continue
					}
					ele = enc
					if (cState(tc) != 1) {
						continue
					}
					gdata(809) = 1
					p = iEnchantmentPower(cw, cnt)
					if (check_bigench(cw) == 2) {
						p *= 1.0 + (iBigenchantmentPower(cw) / 10)
					}
					if (ogdata(505) != 2) {
						exrand_rnd rtval@m9, int(limitf(double(orgdmg) * (100 + p) / 1000 + 1, 1, 20000000))
					} else {
						exrand_rnd rtval@m9, int(limitf(double(orgdmg) * (100 + p) / 1000 + 1, 1, 2000000000))
					}
					dmghp tc, rtval@m9 + 5, cc, ele, p / 2 + 100
					subdmg = 0
					ele = 0
					continue
				}
				if (i == 8) {
					if (cState(tc) != 1) {
						continue
					}
					if (enc >= 30) {
						continue
					}
					tcbk = tc
					getencproc encprocref2, cw, enc + 80000
					p = encprocref(1, enc)
					if (encprocref2) {
						p = encprocref2(1)
					}
					if (p == 3000 | p == 10000) {
						tc = cc
					}
					p = encprocref(5, enc)
					if (p < 50) {
						p *= 1 + sdata(174, cc) / 20
						if (p > 50) {
							p = 50
						}
					}
					enc = encprocref(0, enc)
					if (encprocref2) {
						p = encprocref2(5)
						enc = encprocref2(0)
					}
					if (enc == 658 & efid == 773) {
						continue
					}
					tlocx = cX(tc)
					tlocy = cY(tc)
					if (rnd(100) < p) {
						efid = enc
						lint_efp = iEnchantmentPower(cw, cnt) + refattackskill(attackskill, cc) * 10
						efp = limitmax(lint_efp, INT_MAX)
						if (efid == 631 | efid == 661) {
							if (nc_atk_loopf) {
								continue
							} else {
								nc_atk_loopf = 1
							}
						}
						ctalk cc, 1300, tc, cc
						gosub *label_1398
						if (enc != 658) {
							skillexp2 174, cc, 2
						}
					}
					tc = tcbk
					ele = 0
					continue
				}
			}
			continue
		}
	loop
	check_adddamage
	gosub *label_1693
	if (cState(tc) == 1) {
		if (cSleep(tc) > 0) {
			if (cQuality(tc) < 6) {
				if (nc_gettrait(cc, 101) > 0) {
					if (rnd(10) == 0) {
						snd 105
						ctalk cc, 1295, tc, cc
						txtef 3
						txt -1, lang(" *ブシュッ* ", "*Gash*")
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0) {
							gdata(809) = 2
							txt3rd = 1
							txt -1, lang(name(cc) + "は" + name(tc) + "に致命的な一撃を与え", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
						} else {
							txt -1, lang(name(cc) + "は" + name(tc) + "に致命的な一撃を与えた。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
						}
					}
				}
			}
		}
	}
	if (ammoproc == 4) {
		ctalk cc, 1285, cc, cc
		txtef 9
		txt -1, lang(name(cc) + "は時を止めた。", name(cc) + " stop" + _s(cc) + " time.")
		stopthetimebegin 6
	}
	if (ammoproc == 3) {
		if (cState(tc) == 1) {
			gdata(809) = 1
			dmghp tc, orgdmg * 2 / 3, cc, rnd(61 - 50) + 50, sdata(attackskill, cc) * 10 + 100
			subdmg = 0
		}
	}
	if (ammoproc == 1) {
		tcbk = tc
		tlocx = cX(tc)
		tlocy = cY(tc)
		efid = 460
		lint_efp = sdata(attackskill, cc) * 8 + 10
		efp = limitmax(lint_efp, INT_MAX)
		gosub *label_1398
		tc = tcbk
	}
	weaponenc = 0, 0
	return
*label_1446
	msgdup++
	txt -1, lang("周囲を注意深く調べた。", "You search the surroundings carefully.")
	if (gCurrentMap == 35) {
		inv_getheader -1
		p = 9999
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iOwnState(cnt) != 5) {
				continue
			}
			if (iId(cnt) != 748 & iId(cnt) != 743) {
				continue
			}
			if (iId(cnt) == 743 & iFunction(cnt) != 1000) {
				continue
			}
			if (p > dist(iX(cnt), iY(cnt), cX(0), cY(0))) {
				p = dist(iX(cnt), iY(cnt), cX(0), cY(0))
				ci = cnt
			}
		loop
		if (p != 9999) {
			repeat
				if (p <= 3) {
					txt -1, lang("辺りの空気は息苦しいほどの緊張に包まれている。", "The air around you is filled with strained silence.")
				}
				if (p <= 9) {
					txt -1, lang("微かだが、あなたの心臓はトクンと脈打った。", "Your heart starts beating in your chest.")
					break
				}
				if (p <= 16) {
					txt -1, lang("まだだ、まだ遠い…", "Still, still lying far ahead.")
					break
				}
				if (iId(ci) == 748) {
					txt -1, lang("あなたは青い水晶の存在を感じた。", "You sense a blue crystal lying somewhere in this area.")
				} else {
					if (iId(ci) == 743 & iFunction(ci) == 1000) {
						txt -1, lang("あなたは" + useritemdatan(4, inv(31, ci)) + "の存在を感じた。", "You sense a " + useritemdatan(4, inv(31, ci)) + " lying somewhere in this area.")
					}
				}
				break
			loop
		}
	}
	repeat 11
		y = cY(cc) + cnt - 5
		if (y < 0 | y >= mapHeight) {
			continue
		}
		repeat 11
			x = cX(cc) + cnt - 5
			if (x < 0 | x >= mapWidth) {
				continue
			}
			if (map(x, y, 6) != 0) {
				cell_featread x, y
				refx = x
				refy = y
				if (abs(cY(cc) - y) <= 1 & abs(cX(cc) - x) <= 1) {
					if (feat(1) == 14) {
						if (feat(0) == 0) {
							gosub *label_0715
							if (stat == 1) {
								revealtrap x, y
								txt -1, lang("罠を発見した。", "You discover a trap.")
							}
						}
					}
					if (feat(1) == 22) {
						gosub *label_0715
						if (stat == 1 | 0) {
							gosub *label_1448
							txt -1, lang("隠れた通路を発見した。", "You discover a hidden path.")
						}
					}
				}
				if (feat(1) == 32) {
					if (gCurrentMap != 35) {
						if (cX(cc) == x & cY(cc) == y) {
							snd 24
							txt -1, lang("なんと小さなメダルを見つけた！", "You find a small coin!")
							map(x, y, 6) = 0
							flt
							itemcreate -1, 622, x, y, 0
						} else {
							if (dist(cX(cc), cY(cc), x, y) > 2) {
								txt -1, lang("この辺りには何かがありそうな予感がする…", "You sense something.")
							} else {
								txt -1, lang("あなたは何かが輝くのを目にした。", "You see something shines.")
							}
						}
					}
				}
			}
		loop
	loop
	if (sdata(159, 0) > 0) {
		rc = 0
		repeat 188, 57
			if (cState(cnt) != 1) {
				continue
			}
			if (cOriginalRelationship(cnt) != (-3)) {
				continue
			}
			if (rc) {
				if (dist(cX(0), cY(0), cX(cnt), cY(cnt)) < dist(cX(0), cY(0), cX(rc), cY(rc))) {
					rc = cnt
				}
			} else {
				rc = cnt
			}
		loop
		if (rc) {
			s = direction2(0, rc)
			p = dist(cX(0), cY(0), cX(rc), cY(rc))
			repeat 1
				if (p < 6) {
					break
				} elseif (p < 12) {
					s = lang(s + "の方から殺気を感じる…", "You sense a thirst for blood nearby from " + s + "...")
				} elseif (p < 20) {
					if (sdata(159, 0) > 5) {
						s = lang(s + "の方から敵の気配を感じる…", "You sense the enemy's presence from " + s + "...")
					}
				} elseif (p < 35) {
					if (sdata(159, 0) > 10) {
						s = lang(s + "の方から微かに敵の気配を感じる…", "You somewhat sense the enemy's presence from " + s + "...")
					}
				} elseif (sdata(159, 0) > 15) {
					s = lang("遠く" + s + "の方から微かに敵の気配を感じる…", "You somewhat sense the enemy's presence far away from " + s + "...")
				}
				txtef 9
				if (s != direction2(0, rc)) {
					txt -1, s
				}
				break
			loop
		}
	}
	if (ogdata(479) == 2) {
		rc = 0
		repeat 188, 57
			if (cState(cnt) != 1) {
				continue
			}
			if (cQuality(cnt) < 6) {
				continue
			}
			if (rc) {
				if (dist(cX(0), cY(0), cX(cnt), cY(cnt)) < dist(cX(0), cY(0), cX(rc), cY(rc))) {
					rc = cnt
				}
			} else {
				rc = cnt
			}
		loop
		if (rc) {
			s = direction2(0, rc)
			p = dist(cX(0), cY(0), cX(rc), cY(rc))
			repeat 1
				if (p < 6) {
					break
				} elseif (p < 12) {
					s = lang(s + "の方に珍しいモンスターの気配を感じる…", "You sense a thirst for Unique nearby from " + s + "...")
				} elseif (p < 20) {
					s = lang(s + "の方から珍しいモンスターの気配を感じる…", "You sense the Unique presence from " + s + "...")
				} elseif (p < 35) {
					s = lang(s + "の方から微かに珍しいモンスターの気配を感じる…", "You somewhat sense the Unique presence from " + s + "...")
				} else {
					s = lang("遠く" + s + "の方から微かに珍しいモンスターの気配を感じる…", "You somewhat sense the Unique presence far away from " + s + "...")
				}
				txtef 9
				if (s != direction2(0, rc)) {
					txt -1, s
				}
				break
			loop
		}
	}
	cell_featread cX(cc), cY(cc)
	if (feat(1) == 14) {
		if (feat(0) == tile_trap) {
			if (godcheck() == "mani") {
				if (cc == 0) {
					movx = cX(cc)
					movy = cY(cc)
					gosub *label_1366
				}
			}
		}
	}
	if (feat(1) >= 24 & feat(1) <= 28) {
		rowactre = 1, cX(cc), cY(cc)
		if (feat(1) == 24) {
			gosub *label_1380
		}
		if (feat(1) == 27) {
			gosub *label_1380
		}
		if (feat(1) == 26) {
			gosub *label_1378
		}
		if (feat(1) == 25) {
			gosub *label_1381
		}
		if (feat(1) == 28) {
			gosub *label_1379
		}
	}
	goto *label_1617



#deffunc revealtrap int __ttt, int __uuu
	cell_featset __ttt, __uuu, tile_trap, -1, -1
	return
*label_1448
	map(refx, refy, 0) = tile_tunnel
	cell_featset refx, refy, 0, 0
	return
*label_1449
	if (cSp(cc) < 0) {
		txt -1, lang("疲れ過ぎて無理だ。", "You are too exhausted to do that.")
		gosub *label_0623
		goto *label_1623
	}
	rowactre = 0
	digx = tlocx
	digy = tlocy
	gosub *label_1381
	goto *label_1617
	goto *label_1452



#deffunc dipcursed int __vvv
	if (refitem(iId(__vvv), 5, __vvv) == 57000) {
		if (iMaterial(__vvv) == 35) {
			txt -1, lang(itemname(__vvv) + "は腐ってしまった…", "" + itemname(__vvv) + " rots.")
			iParam3(__vvv) = -1
			iImage(__vvv) = 336
			cell_refresh iX(__vvv), iY(__vvv)
			return
		} else {
			txt -1, lang(itemname(__vvv) + "に変化はない。", "" + itemname(__vvv) + " remains unchanged.")
			return
		}
	}
	if (refitem(iId(__vvv), 5, __vvv) < 50000) {
		safe_subtract iEnhancement(__vvv), 1
		txt -1, lang(itemname(__vvv) + "は錆びてしまった…", "" + itemname(__vvv) + " rusts.")
		if (inv_getowner(__vvv) != (-1)) {
			r1 = inv_getowner(__vvv)
			gosub *chara_refresh
		}
		return
	}
	txt -1, lang("何もおきない… ", "Nothing happens...")
	return
*label_1451
*label_1452
	oomSEST_log "proc_dip"
	if (iId(cidip) == 617) {
		if (iParam4(ci) != 0 & iParam4(ci) != iParam1(cidip)) {
			txt -1, lang("今装着している餌は失われる。本当に装着する？", "The attached baits will be lost. Are you sure?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval != 0) {
				goto *label_1623
			}
		}
		item_separate ci
		item_num cidip, -1
		snd 13
		txt -1, lang(itemname(cidip, 1) + "を" + itemname(ci) + "に装着した。", "You bait " + itemname(ci) + " with " + itemname(cidip, 1) + ".")
		if (iParam4(ci) == iParam1(cidip)) {
			iCount(ci) += rnd(10) + 15
		} else {
			iCount(ci) = rnd(10) + 15
			iParam4(ci) = iParam1(cidip)
		}
		goto *label_1617
	}
	snd 17
	if (refitem(iId(cidip), 5, cidip) == 52000) {
		if (refitem(iId(ci), 9, ci) == 60001) {
			item_separate ci
			item_num cidip, -1
			if (iId(cidip) != 601) {
				txt -1, lang(itemname(cidip, 1) + "を" + itemname(ci) + "に浸した。", "You dip " + itemname(ci) + " into " + itemname(cidip, 1) + ".")
				if (iId(ci) == 602) {
					txt -1, lang("井戸は汚れた。", "The holy well is polluted.")
					goto *label_1617
				}
				if (iParam3(ci) >= 20) {
					txt -1, lang(itemname(ci) + "は完全に枯れている。", itemname(ci) + " is completely dry.")
					goto *label_1617
				}
				txt -1, lang(itemname(ci) + "は一瞬輝いた。", itemname(ci) + " shines for a moment.")
				if (iId(cidip) == 587) {
					txt -1, lang("こんな量では… ", "Snow just melts.")
				} else {
					iParam1(ci) += rnd(3)
				}
				goto *label_1617
			} else {
				if (iParam1(ci) < (-5) | iParam3(ci) >= 20 | (iId(ci) == 602 & gdata(250 + 10) <= 0)) {
					valn = itemname(ci)
					txt -1, lang(valn + "は涸れている。", valn + " is dry.")
					txt -1, lang("あっ！空き瓶を井戸に落としてしまった…", "Oops! You drop the empty bottle into the well...")
					goto *label_1617
				}
				if (inv_getfreeid(0) == (-1)) {
					item_num cidip, 1
					txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
					goto *label_1617
				}
				if (iId(ci) == 602) {
					gdata(250 + 10)--
					flt
					itemcreate 0, 516, -1, -1, 0
					if (stat != 0) {
						iCurseState(ci) = 1
					}
				} else {
					iParam1(ci) -= 3
					flt 20
					flttypemajor = 52000
					itemcreate 0, 0, -1, -1, 0
				}
				txt -1, lang("空き瓶に水をすくった。", "You draw water from the well into the empty bottle.")
				txt -1, lang(itemname(ci, 1) + "を手に入れた。", "You get " + itemname(ci, 1) + ".")
				item_stack 0, ci, 1
				goto *label_1617
			}
		}
	}
	if (iId(cidip) == 27 | iId(cidip) == 28 | iId(cidip) == 29 | iId(cidip) == 30 | iId(cidip) == 262) {
		if (iId(cidip) == 262) {
			if (refitem(iId(ci), 5, ci) == 57000 | item_isCookedMilk(ci)) {
				item_num cidip, -1
				item_separate ci
				txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
				ctalk 0, 1251, 0, 0
				if ( stat == 0 ) {
					txt -1, lang("あなたはにやりと笑った。", "You grin.")
				}
				if (iCurseState(cidip) <= (-1)) {
					dipcursed ci
				}
				ibitmod 14, ci, 1
				goto *label_1617
			}
		}
		if (refitem(iId(ci), 5, ci) == 10000 | refitem(iId(ci), 5, ci) == 25000 | refitem(iId(ci), 9, ci) == 24030) {
			item_num cidip, -1
			item_separate ci
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci) + ".")
			ctalk 0, 1250, 0, 0
			if (iCurseState(cidip) <= (-1)) {
				dipcursed ci
			}
			ibitmod 14, ci, 1
			potiondip = 1
			dbmode = 15
			dbid = iId(cidip)
			gosub *label_2426
			inv(36, ci) = efp * 1000 + dbid
			goto *label_1617
		}
	}
	if (iId(cidip) == 620) {
		if (refitem(iId(ci), 5, ci) == 57000 | item_isCookedMilk(ci)) {
			if (iCurseState(cidip) != 1) {
				item_num cidip, -1
				item_separate ci
			}
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
			ctalk 0, 1252, 0, 0
			if ( stat == 0 ) {
				txt -1, lang("あなたはうしろめたさを感じた…", "You kind of feel guilty...")
			}
			if (iCurseState(cidip) <= (-1)) {
				dipcursed ci
			}
			ibitmod 6, ci, 1
			goto *label_1617
		}
		if (refitem(iId(ci), 5, ci) < 50000) {
			item_num cidip, -1
			item_separate ci
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci) + ".")
			ctalk 0, 1252, 0, 0
			if ( stat == 0 ) {
				txt -1, lang("あなたはうしろめたさを感じた…", "You kind of feel guilty...")
			}
			if (iCurseState(cidip) <= (-1)) {
				dipcursed ci
			}
			ibitmod 6, ci, 1
			goto *label_1617
		}
	}
	if (iId(cidip) == 375) {
		if (refitem(iId(ci), 5, ci) == 57000) {
			item_num cidip, -1
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
			if (iCurseState(cidip) <= (-1)) {
				dipcursed ci
			} else {
				if (iParam3(ci) > getgametime()) {
					iParam3(ci) = getgametime() + 1
					txt -1, lang(itemname(ci) + "は腐りそうだ。", itemname(ci) + " is likely to rot.")
					item_stack 0, ci, 1
				} else {
					txt -1, lang("何もおきない… ", "Nothing happens...")
				}
			}
			goto *label_1617
		}
	}
	if (iId(cidip) == 376) {
		if (refitem(iId(ci), 5, ci) == 57000) {
			item_num cidip, -1
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
			if (iCurseState(cidip) <= (-1)) {
				dipcursed ci
			} else {
				if (iParam3(ci) > getgametime()) {
					iParam3(ci) = 0
					txt -1, lang(itemname(ci) + "はもう腐らない。", itemname(ci) + " doesn't rot anymore.")
					item_stack 0, ci, 1
				} else {
					txt -1, lang("何もおきない… ", "Nothing happens...")
				}
			}
			goto *label_1617
		}
	}
	if (iId(cidip) == 519) {
		if (iCurseState(cidip) == 1) {
			in = iNumber(cidip)
		} else {
			in = 1
			item_separate ci
		}
		item_num cidip, -1
		iColor(ci) = iColor(cidip)
		txt -1, lang("あなたは" + itemname(ci) + "を染めた。", "You dye " + itemname(ci) + ".")
		if (inv_getowner(ci) == (-1)) {
			cell_refresh iX(ci), iY(ci)
		}
		if (iBodyPart(ci) != 0) {
			create_pcpic cc, 1
		}
		goto *label_1617
	}
	if (iId(cidip) == 566) {
		if (iCurseState(cidip) == 1) {
			in = iNumber(cidip)
		} else {
			in = 1
			item_separate ci
		}
		txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci) + ".")
		if (iCurseState(cidip) <= (-1)) {
			dipcursed ci
		} else {
			ibitmod 1, ci, 1
			txt -1, lang(itemname(ci) + "は酸から守られた。", itemname(ci) + " gain" + _s2(in) + " acidproof.")
		}
		item_num cidip, -1
		goto *label_1617
	}
	if (iId(cidip) == 736) {
		if (iCurseState(cidip) == 1) {
			in = iNumber(cidip)
		} else {
			in = 1
			item_separate ci
		}
		txt -1, lang(itemname(ci, in) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci, in) + ".")
		if (iCurseState(cidip) <= (-1)) {
			dipcursed ci
		} else {
			if (iId(ci) == 567) {
				txt -1, lang("いいアイデアだ！しかし…", "A good idea! But...")
			} else {
				ibitmod 2, ci, 1
				txt -1, lang(itemname(ci) + "は熱から守られた。", itemname(ci) + " gain" + _s2(in) + " fireproof.")
			}
		}
		item_num cidip, -1
		goto *label_1617
	}
	if (iId(cidip) == 516) {
		item_num cidip, -1
		if (ibit(18, ci)) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1617
		}
		if (iCurseState(cidip) == 1) {
			txtef 2
			txt -1, lang(itemname(ci) + "は銀色に輝いた。", itemname(ci) + " shine" + _s2(iNumber(ci)) + " silvery.")
			iCurseState(ci) = 1
			item_stack 0, ci, 1
			r1 = cc
			gosub *chara_refresh
			goto *label_1617
		}
		if (iCurseState(cidip) == (-1)) {
			txtef 8
			txt -1, lang(itemname(ci) + "は黒いオーラに包まれた。", itemname(ci) + " " + is2(iNumber(ci)) + " wrapped by a dark aura.")
			if (iCurseState(ci) == (-1)) {
				iCurseState(ci) = -2
			} else {
				iCurseState(ci) = -1
			}
			item_stack 0, ci, 1
			r1 = cc
			gosub *chara_refresh
			goto *label_1617
		}
		if (iCurseState(cidip) == (-2)) {
			txtef 8
			txt -1, lang(itemname(ci) + "は黒いオーラに包まれた。", itemname(ci) + " " + is2(iNumber(ci)) + " wrapped by a dark aura.")
			iCurseState(ci) = -2
			item_stack 0, ci, 1
			r1 = cc
			gosub *chara_refresh
			goto *label_1617
		}
	}
	txt -1, lang("何もおきない… ", "Nothing happens...")
	goto *label_1617
*label_1453
	oomSEST_log "act_use"
	screenupdate = -1
	gosub *label_0623
	tc = cc
	tlocx = cX(cc)
	tlocy = cY(cc)
	if (ibit(7, ci) == 1) {
		if (getgametime() < iCount(ci)) {
			txt -1, lang("そのアイテムが次に使用できるのは" + cnvdate(iCount(ci), 1) + "だ。", "This item will be usable again at " + cnvdate(iCount(ci), 1) + ".")
			gosub *label_0623
			goto *label_1623
		}
		item_separate ci
		iCount(ci) = getgametime() + iParam3(ci)
	}
	if (ibit(4, ci) == 1) {
		if (iCount(ci) <= 0) {
			txt -1, lang("それはもう使えない。", "It's out of charge.")
			gosub *label_0623
			goto *label_1623
		}
		item_separate ci
		iCount(ci)--
		item_autostack cc, ci
	}
	if (refitem(iId(ci), 9, ci) == 58500) {
		goto *label_1457
	}
	if (refitem(iId(ci), 9, ci) == 59500) {
		blendtool = ci
		goto *label_1123
	}
	if (refitem(iId(ci), 9, ci) == 60004 | iId(ci) == iId_kotatsu) {
		if (gContinuousActiveHours < 15 & gWizard == 0) {
			txt -1, lang("まだ眠たくない。", "You don't feel sleepy yet.")
			gosub *label_0623
			goto *label_1623
		}
		gdata(91) = 100
		gosub *label_1370
		goto *label_1617
	}
	if (iId(ci) == 413 | iId(ci) == 414) {
		goto *label_1307
	}
	if (iId(ci) == 312 | iId(ci) == 313 | iId(ci) == 314 | iId(ci) == 315) {
		atxid = 1
		gosub *label_1066
		goto *label_1617
	}
	if (iFunction(ci) == 1 | iFunction(ci) == 2 | iFunction(ci) == 3 | iFunction(ci) == 4 | iFunction(ci) == 1506) {
		if (iFunction(ci) == 1506) {
			prodtype = 5
		} else {
			prodtype = iFunction(ci)
		}
		snd 26
		invctrl = 0
		gosub *label_1056
		goto *label_1617
	}
	if (ibit(10, ci)) {
		if (iParam2(ci) < calcexpalive(iParam1(ci)) & 0 == 0) {
			if (ibit(18, ci) == 0 | iCurseState(ci) < 1) {
				txt -1, lang("この武器はまだ血を吸い足りない。", "The weapon needs more blood.")
			} else {
				txt -1, lang("この武器はまだあなたを認めていない。", "This weapon does not yet deem you worthy.")
			}
		} else {
			txtnew
			if (ibit(18, ci) == 0 | iCurseState(ci) < 1) {
				txt -1, lang(itemname(ci) + "は十分に血を吸い成長できる！", itemname(ci) + " sucked enough blood and ready to grow!")
				randomize iSubname(ci)
				exrand_randomize iSubname(ci)
				if (iParam1(ci) >= 4 + rnd(12)) {
					txt -1, lang("しかし、なんだか様子がおかしい…", "But you sense something weird.")
				}
			} else {
				txt -1, lang(itemname(ci) + "はあなたを認め秘められた力を発揮する！", itemname(ci) + " deems your heroic deeds worthy enough and further unleases its hidden power!")
			}
			txt -1, lang("それは…", "It...")
			reftype = refitem(iId(ci), 5, ci)
			listmax = 0
			repeat 50
				if (listmax >= 8) {
					break
				}
				randomize iSubname(ci) + iParam1(ci) * 10 + cnt
				exrand_randomize iSubname(ci) + iParam1(ci) * 10 + cnt
				encadd ci, randomenc(randomenclv(4)), randomencp(0, ogdata(503) == 2), 0, 0, 1
				if (stat != 0) {
					if (rtval == 34) {
						if (rnd(3)) {
							continue
						}
					}
					findenc = 0
					repeat listmax
						if (list(0, cnt) == rtval) {
							if (encpassivecheck(rtval) | list(1, cnt) == rtval(1)) {
								findenc = 1
								break
							}
						}
					loop
					if (findenc) {
						continue
					}
					if (encpassivecheck(rtval)) {
						if (encfindspec(ci, rtval) != (-1)) {
							continue
						}
					}
					list(0, listmax) = rtval, rtval(1)
					val = list(0, listmax), list(1, listmax), 0, 0
					gosub *label_0297
					promptl(0, promptmax) = s, "null", "" + promptmax
					promptmax++
					listmax++
				} else {
					continue
				}
			loop
			if (ibit(18, ci) & iCurseState(ci) <= (-2)) {
				repeat listmax
					list(1, cnt) = list(1, cnt) * 5 / 2
					val = list(0, cnt), list(1, cnt), 0, 0
					gosub *label_0297
					promptl(0, cnt) = s, "null", "" + cnt
				loop
			}
			if (listmax > 0) {
				val = promptx, prompty, 500, 1
				gosub *label_1353
				if (rtval == (-1)) {
					txtnew
					txt -1, lang(itemname(ci) + "は不満そうに震えた。", itemname(ci) + " vibrates as if she is displeased.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *chara_refresh
					gosub *label_0623
					goto *label_1623
				} else {
					encadd ci, list(0, rtval), list(1, rtval), 0, 1
				}
			}
			txtnew
			iEnhancement(ci)++
			txtef 2
			txt -1, lang(itemname(ci) + "は嬉しげに震えた。", itemname(ci) + " vibrates as if she is pleased.")
			if (ibit(18, ci) == 0 | iCurseState(ci) < 1) {
				randomize iSubname(ci)
				exrand_randomize iSubname(ci)
				if (iParam1(ci) >= 4 + rnd(12)) {
					txt -1, lang("その力は次第に脅威になっている。", "Its power is becoming a threat.")
					encadd ci, 45, 50
					if (stat == 0) {
						iEnchantmentId(ci, (15 - 1)) = 0
						txt -1, lang(itemname(ci) + "はエンチャントを消した。", itemname(ci) + " removes an enchantment.")
					}
				}
			}
			iParam2(ci) = 0
			iParam1(ci)++
			randomize
			exrand_randomize timeGetTime()
		}
		r1 = cc
		gosub *chara_refresh
		gosub *label_0623
		goto *label_1623
	}
	_switch_val = iFunction(ci)
	if (_switch_val == 24) {
		x = cX(cc)
		y = cY(cc)
		if (mapType == 1) {
			txt -1, lang("ここでは使えない。", "You can't place it here.")
			gosub *label_0623
			goto *label_1623
		}
		if (map(x, y, 6) != 0) {
			txt -1, lang("ここには置けない。", "You can't place it here.")
			goto *label_1623
		}
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		cell_featset x, y, 0, 14, 7, cc
		txt -1, lang("地雷を設置した。", "You set up the mine.")
		snd 58
		goto *label_1454
	}
	if (_switch_val == 44) {
		if (inv_getowner(ci) != (-1)) {
			txt -1, lang("床に置かないと使えない。", "You need to put it on the ground.")
			gosub *label_0623
			goto *label_1623
		}
		txt -1, lang("あなたは" + itemname(ci, 1) + "に座った。", "You sit on " + itemname(ci, 1) + ".")
		promptl(0, promptmax) = lang("くつろぐ", "Relax."), "null", "" + 0
		promptmax++
		if (iParam1(ci) != 1) {
			promptl(0, promptmax) = lang("マイチェアにする", "It's my chair."), "null", "" + 1
			promptmax++
		}
		if (iParam1(ci) != 2) {
			promptl(0, promptmax) = lang("お客用のチェアにする", "It's for my guest."), "null", "" + 2
			promptmax++
		}
		if (iParam1(ci) != 0) {
			promptl(0, promptmax) = lang("誰でも座っていい", "It's free to use."), "null", "" + 3
			promptmax++
		}
		val = promptx, prompty, 260, 1
		gosub *label_1353
		if (stat == 0) {
			goto *label_1454
		}
		if (rtval == 0) {
			txt -1, lang("あなたは存分にくつろいだ。", "You relax as much as you like.")
			goto *label_1454
		}
		if (rtval == 1) {
			txt -1, lang(itemname(ci, 1) + "はあなた専用の席になった！", itemname(ci, 1) + " is your seat now.")
			iParam1(ci) = 1
			goto *label_1454
		}
		if (rtval == 2) {
			txt -1, lang(itemname(ci, 1) + "は訪問者の席になった！", itemname(ci, 1) + " is used by your guests now.")
			iParam1(ci) = 2
			goto *label_1454
		}
		if (rtval == 3) {
			txt -1, lang(itemname(ci, 1) + "は誰でも座っていい席になった！", itemname(ci, 1) + " can be used by anyone.")
			iParam1(ci) = 0
			goto *label_1454
		}
		goto *label_1454
	}
	if (_switch_val == 8) {
		f = 0
		if (mapType == 5) {
			f = 1
		}
		if (gCurrentDungeonLevel == 3) {
			if (gdata(128) < 3000) {
				if (areaId(gCurrentMap) == 36 & guildcheck(0) == "mage" | (areaId(gCurrentMap) == 14 & guildcheck(0) == "thieve") | (areaId(gCurrentMap) == 11 & guildcheck(0) == "fighter")) {
					f = 1
				}
			}
		}
		if (areaId(gCurrentMap) == 3 & gdata(250 + 2) >= 200) {
			f = 1
		}
		/*混沌の城模様替え*/
		if (areaId(gCurrentMap) == 22 | areaId(gCurrentMap) == 23 | areaId(gCurrentMap) == 24) {
			if (ogdata(451) == 2) {
			f = 1
			}
		}
		if (areaId(gCurrentMap) == 59) {
			if (ogdata(535) == 2) {
				f = 1
			}
		}
		if (areaId(gCurrentMap) == 47 | areaId(gCurrentMap) == 48) {
			f = 1
		}
		if (f == 0) {
			txt -1, lang("それはここでは使えない。", "You can't use it here.")
			gosub *label_0623
			goto *label_1623
		}
		screenupdate = -1
		gosub *label_0623
		goto *label_0917
		goto *label_1454
	}
	if (_switch_val == 19) {
		txt -1, lang("誰を対象にする？", "Make up who?")
		val = 0
		gosub *label_1350
		f = 0
		if (stat != 0) {
			if (map(x, y, 1) > 0) {
				tc = map(x, y, 1) - 1
				if (tc < 16) {
					screenupdate = -1
					gosub *label_0623
					ccbk = cc
					cc = tc
					gosub *label_1263
					cc = ccbk
					f = 1
				}
			}
		}
		if (f == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		gosub *label_0623
		goto *label_1623
		goto *label_1454
	}
	if (_switch_val == 15) {
		efid = 184
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 16) {
		efid = 185
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 17) {
		efid = 183
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 14) {
		if (cc == 0) {
			if (iNumber(ci) < 5) {
				txt -1, lang("雪が足りない…", "You need more snow.")
				gosub *label_0623
				goto *label_1623
			}
			removeitem ci, 5
		}
		flt
		itemcreate -1, 541, cX(0), cY(0), 0
		if (synccheck(cc, -1)) {
			snd 86
			txt -1, lang(name(cc) + "は雪だるまを作った！", name(cc) + " make" + _s(cc) + " a snow man!")
		}
		goto *label_1454
	}
	if (_switch_val == 13) {
		snd 6
		if (gTorch == 0) {
			gTorch = 1
			txt -1, lang("松明を灯した。", "You light up the torch.")
		} else {
			gTorch = 0
			txt -1, lang("松明を消した。", "You put out the fire.")
		}
		r1 = 0
		gosub *chara_refresh
		goto *label_1454
	}
	if (_switch_val == 9) {
		gosub *label_1308
		if (stat == 1) {
			goto *label_1617
		} else {
			gosub *label_0623
			goto *label_1623
		}
		goto *label_1454
	}
	if (_switch_val == 5) {
		txt -1, lang("何に聴診器を当てる？", "Auscultate who?")
		gosub *label_0623
		val = 0
		gosub *label_1350
		if (stat == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			gosub *label_0623
			goto *label_1623
		}
		tc = map(x, y, 1) - 1
		if (tc == 0) {
			txt -1, lang(" *ドクン ドクン* ", "You blush.")
			gdata(94) = 0
			goto *label_1617
		}
		if (petcheck(tc)) {
			if (cState(tc) == 1) {
				gdata(94) = 0
				if (cbit(966, tc) == 1) {
					cbitmod 966, tc, 0
					txt -1, lang(name(tc) + "から聴診器を外した。", "You no longer watch on " + his(tc) + " health.")
					ctalk tc, 984, 0, tc
					goto *label_1617
				}
				txt -1, lang("あなたは" + name(tc) + "に聴診器を当てた。", "You start to keep an eye on " + his(tc) + " health.")
				if (cSex(tc) == 1) {
					ctalk tc, 989, 0, tc
					if (stat == 0) {
						txt -1, lang("" + name(tc) + "は顔を赤らめた。", name(tc) + " blush" + _s(tc, 1) + ".")
						txtef 4
						txt tc, lang("「キャー」", cnvtalk("Pervert!"))
					}
				} else {
					txtef 4
					ctalk tc, 989, 0, tc
				}
				cbitmod 966, tc, 1
				goto *label_1617
			}
		}
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		goto *label_1623
		goto *label_1454
	}
	if (_switch_val == 23) {
		txt -1, lang("誰を紐で結ぶ？", "Leash who?")
		gosub *label_0623
		val = 0
		gosub *label_1350
		f = 0
		if (stat != 0) {
			if (map(x, y, 1) > 0) {
				tc = map(x, y, 1) - 1
				if (tc == 0) {
					if (cBlind(0) == 0) {
						if (mapType != 1) {
							if (gCurrentMap != 40) {
								repeat 16
									if (cnt == 0) {
										continue
									}
									if (cState(cnt) != 1) {
										continue
									}
									if (gMount == cnt) {
										continue
									}
									if (ocdata(107, cnt) != 0) {
										continue
									}
									if (cbit(968, cnt) == 1) {
										cHate(cnt) = 0
										unlockson cnt
										tc = 0
										cc = cnt
										efid = 619
										nc_himo = 1
										gosub *label_1398
									}
								loop
								txt -1, lang("あなたは紐を引っ張った。", "You pull the leash.")
								goto *label_1454
							}
						}
					}
				} else {
					if (cbit(968, tc) == 0) {
						if (tc >= 16 & cRole(tc) != 10001 & cRole(tc) != 10018 & eqfaction(tc, "petshop") == 0) {
							if (rnd(5) == 0) {
								txt -1, lang(name(tc) + "が激しく抵抗したため紐は切れた。", "The leash is cut as " + name(tc) + " resists.")
								iNumber(ci)--
								cell_refresh iX(ci), iY(ci)
								gosub *refreshPCBurdenState
								goto *label_1454
							}
						}
						cbitmod 968, tc, 1
						txt -1, lang("あなたは" + name(tc) + "を紐でくくりつけた。", "You leash " + name(tc) + ".")
						txtef 9
						ctalk tc, 404, 0, tc
						if (stat == 0) {
							txtef 9
							txt -1, lang(name(tc) + "は呻き声を洩らした。「アン…♪」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("Pervert!"))
						}
					} else {
						cbitmod 968, tc, 0
						txt -1, lang("あなたは" + name(tc) + "にくくりつけた紐をほどいた。", "You unleash " + name(tc) + ".")
						txtef 9
						ctalk tc, 403, 0, tc
						if (stat == 0) {
							txtef 9
							txt -1, lang(name(tc) + "は呻き声を洩らした。「はぁはぁ…」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("D-don't sto....N-nothing!"))
						}
					}
					animeload 8, tc
				}
				f = 1
			}
		}
		if (f == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *label_1454
	}
	if (_switch_val == 45) {
		if (gCurrentMap == 35) {
			txt -1, lang("このエリアでは使えない。", "You cant use it in this area.")
			gosub *label_0623
			goto *label_1623
		}
		txt -1, lang("誰を吊るす？", "Hang who?")
		gosub *label_0623
		val = 0
		gosub *label_1350
		f = 0
		if (stat != 0) {
			if (map(x, y, 1) > 0) {
				tc = map(x, y, 1) - 1
				if (cHp(tc) >= cMaxHp(tc) / 5 & tc != 0) {
					if (gWizard == 0) {
						txt -1, lang("もっと弱らせないと吊るせない。", "The target needs to be weakened.")
						goto *label_1623
					}
				}
				if (tc != 0) {
					if (tc < 16) {
						txt -1, lang("仲間を吊るすなんてとんでもない！", "Hanging your ally is a brutal idea!")
						goto *label_1623
					}
				}
				if (cbit(985, tc)) {
					txt -1, lang("それは既に吊るされている。", "It's already hanged up.")
					goto *label_1623
				}
				if (tc == 0) {
					txt -1, lang("どれくらいの間？", "How many turns?")
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, 10000
					inputlog = "" + 1
					gosub *label_1349
					ncgdata(204) = int(inputlog)
				}
				snd 58
				cbitmod 985, tc, 1
				if (tc == 0) {
					txt -1, lang("あなたは自分自身を吊るした…", "You hang up yourself.")
				} else {
					txt -1, lang("あなたは" + name(tc) + "を吊るした。", "You hang up " + name(tc) + ".")
				}
				ctalk tc, 402, 0, tc
				if (stat == 0) {
					txt -1, lang(name(tc) + "は呻き声を洩らした。「アン…♪」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("Pervert!"))
				}
				animeload 8, tc
				iNumber(ci)--
				cell_refresh iX(ci), iY(ci)
				gosub *refreshPCBurdenState
				f = 1
			}
		}
		if (f == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *label_1454
	}
	if (_switch_val == 6) {
		txt -1, lang(itemname(ci, 1) + "再生した。", "You play " + itemname(ci, 1) + ".")
		music = iParam1(ci) + 50 + 1
		/*
		if (music >= 92 - 1) {
			music = 92 - 2
		}
		*/
		mapBgm = music
		gosub *label_0122
		goto *label_1454
	}
	if (_switch_val == 10) {
		screenupdate = -1
		gosub *label_0623
		goto *label_1602
		goto *label_1454
	}
	if (_switch_val == 7) {
		if (oabit(13, gCurrentMap)) {
			txt -1, lang("それはここでは使えない。", "You can't use it here.")
			gosub *label_0623
			goto *label_1623
		}
		if (iOwnState(ci) != 3) {
			if (mapIsFixed == 0 | gCurrentMap == 13 | gCurrentMap == 30) {
				if (gCurrentMap == 2) {
					txt -1, lang("ワールドマップで建設するべきだ。", "You can only build it in the world map.")
				} else {
					txt -1, lang("ここには建てられない。", "You can't build it here.")
				}
				gosub *label_0623
				goto *label_1623
			}
			gdata(91) = 101
			gosub *label_1370
			goto *label_1617
		}
		if (areaId(gCurrentMap) == 8) {
			if (gCurrentDungeonLevel == areaLastFloor(gCurrentMap)) {
				if (areaHasBeenConquered(gCurrentMap) != (-1)) {
					txt -1, lang("クエストを放棄してシェルターに避難する？", "Really give up the quest and evacuate to the shelter?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval != 0) {
						gosub *label_0623
						goto *label_1623
					}
				}
			}
		}
		gdata(91) = 102
		gosub *label_1370
		goto *label_1454
	}
	if (_switch_val == 11) {
		if (moneybox(iParam2(ci)) > cGold(0) & ncgdata(50) == 0) {
			txt -1, lang("金貨が足りない…", "You count your coins and sigh...")
			gosub *label_0623
			goto *label_1623
		}
		if (iCurseState(ci) >= 0) {
			if (moneybox(iParam2(ci)) != 2147483647) {
				if (iParam1(ci) >= 1000000000) {
					txt -1, lang("貯金箱は一杯だ。", "The money box is full.")
					gosub *label_0623
					goto *label_1623
				}
			} else {
				if (iParam1(ci) >= 2000000000) {
					txt -1, lang("貯金箱は一杯だ。", "The money box is full.")
					gosub *label_0623
					goto *label_1623
				}
			}
			item_separate ci
			snd 12
			cGold(0) -= moneybox(iParam2(ci))
			gosub *label_N200
			if (moneybox(iParam2(ci)) != 2147483647) {
				iParam1(ci) += moneybox(iParam2(ci))
			} else {
				iParam1(ci) += 1
			}
			iWeight(ci) += 100
		} else {
			cGold(0) -= moneybox(iParam2(ci))
			gosub *label_N200
			flt
			itemcreate -1, 54, cX(0), cY(0), moneybox(iParam2(ci))
			if (stat) {
				txt -1, lang("あなたは金貨を落としてしまった。", "You have dropped your coins.")
			} else {
				txt -1, lang("あなたは金貨を落としてしまったが、すぐに拾い直した。", "You have dropped your coins. quickly picked it back up.")
			}
		}
		goto *label_1454
	}
	if (_switch_val == 20) {
		efid = 458
		efp = 400
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 47) {
		if (gCurrentMap != 35) {
			txt -1, lang("それは鈍く輝いた。", "It glows dully.")
			goto *label_1454
		}
		if (iOwnState(ci) != 5) {
			txt -1, lang("水晶には領域の記憶が宿っていない。この場所の所有者が配置した水晶を探す必要がある。", "The crystal isn't filled with the memory of this place. You need to find ones placed by the owner of this area.")
			goto *label_1454
		}
		allyctrl = 0
		gosub *label_1236
		if (stat != 1) {
			goto *label_1454
		}
		snd 118
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		goto *label_1454
	}
	if (_switch_val == 22) {
		snd 118
		if (mapType != 3 & mapType != 2) {
			txt -1, lang("それは街でしか使えない。", "You can only use it in a town.")
			goto *label_1454
		}
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		txt -1, lang("突然、あなたの目の前に異次元へのゲートが現れた。", "Suddenly, a strange gate opens.")
		comctrl = 2
		gosub *label_1144
		if (stat == 1) {
			goto *label_1340
		}
		goto *label_1454
	}
	if (_switch_val == 49) {
		txt -1, lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd 58
		efid = 49
		efp = 100
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 50) {
		txt -1, lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd 58
		efid = 50
		efp = 100
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 21) {
		txt -1, lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd 58
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		fixmaterial = iMaterial(ci)
		efid = 21
		efp = 500
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 25) {
		txt -1, lang(itemname(ci, 1) + "を使った。", "You hold " + itemname(ci, 1) + " up high.")
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		efid = 637
		efp = 500
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 26) {
		if (mapType == 1) {
			snd 64
			iCount(ci) += 8640
			txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
			pbk = 0
			cbk = 0
			gosub *label_N950
		} else {
			txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
			gdata(250 + 12) = 1
			snd 64
			txtef 5
			txt -1, lang("オパートス「フハハハ！間もなく、この地に変動が起こるであろう！」", "A voice echoes, " + cnvtalk("Muwahahaha! I shall shake the land for you!"))
		}
		goto *label_1454
	}
	if (_switch_val == 34) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		txtef 5
		txt -1, lang("ジュア「べ、別にあんたのためにするんじゃないからね。バカっ！」", "A voice echoes, " + cnvtalk("I-I'm not doing for you! Silly!"))
		efid = 637
		efp = 5000
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 43) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		snd 64
		txtef 5
		txt -1, lang("エヘカトル「呼んだ？呼んだ？」", "A voice echoes, " + cnvtalk("Did you call me? Call me?"))
		addbuff tc, 19, 77, 2500
		modgrowth2 tc, 19, 20
		goto *label_1454
	}
	if (_switch_val == 27) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		snd 64
		txtef 5
		preweather = gWeather
		if (gWeather == 1) {
			txt -1, lang("ルルウィ「あさはかね。エーテルの風を止めてあげるとでも思ったの？」", "A rather angry voice echoes, " + cnvtalk("Listen my little slave. Did you really think I would turn a hand in this filthy wind for you?"))
			goto *label_1454
		}
		p = gWeather
		repeat
			if (rnd(10) == 0) {
				gWeather = 0
			}
			if (rnd(10) == 0) {
				gWeather = 3
			}
			if (rnd(15) == 0) {
				gWeather = 4
			}
			if (rnd(20) == 0) {
				gWeather = 2
			}
			if (gWeather != p) {
				break
			}
		loop
		txt -1, lang("ルルウィ「あらあら、定命の分際でそんなおねだりするの？ウフフ…今回は特別よ」", "An impish voice echoes, " + cnvtalk("Ah you ask too much for a mortal. Still, it is hard to refuse a call from such a pretty slave like you."))
		txt -1, lang("天候が変わった。", "The weather changes.")
		envonly = 1
		gosub *label_0122
		if (preweather != gWeather) {
			throwsstpevent "WeatherChanged", 0, _weather(preweather), 0
		}
		goto *label_1454
	}
	if (_switch_val == 28) {
		if (mapType == 1) {
			txt -1, lang("ここでは使えない。", "You can't place it here.")
			gosub *label_0623
			goto *label_1623
		}
		if (cX(0) != 33 | cY(0) != 16) {
			if (gdata(250 + 213) == 1) {
				txt -1, lang("ここはクエストの目標位置ではない。本当にここに設置する？", "This location is not your quest goal. Really place it here?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval != 0) {
					gosub *label_0623
					goto *label_1623
				}
			}
		}
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		txt -1, lang("原子爆弾を設置した。逃げろォー！", "You set up the nuke...now run!!")
		snd 58
		addmef cX(cc), cY(cc), 7, 632, 10, 100, cc
		throwsstpevent "SetNuke", 0, "", 0
		goto *label_1454
	}
	if (_switch_val == 48) {
		if (gCurrentMap != 35 | usermapid == 0) {
			txt -1, lang("それはこの場所ではみすぼらしく見える。", "It looks so dumb here.")
			goto *label_1454
		}
		txt -1, lang("この石像を見つめていると、何かを投げつけたくなってうずうずしてきた！", "Watching this strange statue makes you want to throw something at it!")
		gosub *label_0613
		goto *label_1454
	}
	if (_switch_val == 29) {
		if (iParam1(ci) != 251) {
			settrait 0, iParam1(ci), 1
		}
		if (iParam1(ci) == 169) {
			settrait 0, 162, 0
		}
		if (iParam1(ci) == 162) {
			settrait 0, 169, 0
		}
		if (iParam1(ci) == 251) {
			settrait 0, 251, gettrait(0, 251) + 1
			ncgdata(71)++
		}
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		txt -1, lang("あなたは新たなフィートを獲得した！", "You gain a new feat.")
		animeload 10, 0
		r1 = cc
		gosub *chara_refresh
		goto *label_1454
	}
	if (_switch_val == 30) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		if (iId(ci) == 743) {
			if (equalsitem(ci, "Plamja's gem stone")) {
				removeallfire
			}
		}
		efid = iParam1(ci)
		efp = iParam2(ci)
		tc = cc
		efstatus = 0
		gosub *label_1398
		goto *label_1454
	}
	if (_switch_val == 41) {
		txt -1, lang("誰にクミロミの秘密の経験を使う？", "Who do you want to use the secret experience of Kumiromi to?")
		gosub *label_0623
		val = 0
		gosub *label_1350
		if (stat == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			gosub *label_0623
			goto *label_1623
		}
		tc = map(x, y, 1) - 1
		if (iCurseState(ci) == (-2)) {
			if (petcheck(tc)) {
				snd 117
				animeload 14, tc
				iNumber(ci)--
				cell_refresh iX(ci), iY(ci)
				ocdata(105, tc) = 0
				txt -1, lang("「汚れたね」", cnvtalk(cnven(he(tc)) + " got dirty.")), lang("「…これが…君の望んでいた結果？」", cnvtalk(cnven(he(tc)) + " got dirty."))
				txtef 8
				txt -1, lang(name(tc) + "は新たなフィートを取得できなくなった", name(tc) + " lost the right to obtain new feats.")
				goto *label_1454
			}
			if (tc == 0) {
				snd 117
				animeload 14, tc
				iNumber(ci)--
				cell_refresh iX(ci), iY(ci)
				gAcquirableFeatCount = 0
				txt -1, lang("「汚れたね」", cnvtalk("You got dirty.")), lang("「…これが…君の望んでいた結果？」", cnvtalk("...are you satisfied now?"))
				txtef 8
				txt -1, lang(name(tc) + "は新たなフィートを取得できなくなった", name(tc) + " lost the right to obtain new feats.")
				goto *label_1454
			}
		} else {
			if (petcheck(tc)) {
				migration_normalizeFieldsOfJewelOfLoveAndKumiromisExperience tc
				if (ocdata(109, tc) > cLevel(tc)) {
					txt -1, lang("クミロミの声がした。「ダメ…経験…足りない…」", "Kumiromi talks to you, " + cnvtalk("No..." + he(tc) + " " + is(tc) + "n't...experienced enough...for this..."))
					gosub *label_0623
					goto *label_1623
				}
				snd 64
				animeload 10, tc
				ocdata(109, tc) += 10
				iNumber(ci)--
				cell_refresh iX(ci), iY(ci)
				ocdata(105, tc)++
				txt -1, lang("「…よく…経験をつんだね…酬いてあげる…」", cnvtalk("..." + he(tc) + " " + have(tc) + " acquired enough...experience...I shall reward " + him(tc) + "..."))
				txtef 5
				txt -1, lang("クミロミは" + name(tc) + "を祝福した。" + name(tc) + "は新たなフィートを取得できるようになった！", "Kumiromi blesses " + him(tc) + ". " + cnven(he(tc)) + " can obtain one more feat now!")
				goto *label_1454
			}
			if (tc == 0) {
				if (gNextLevelMinusOneKumiromisExperienceBecomesAvailable > cLevel(0)) {
					txt -1, lang("クミロミの声がした。「ダメ…経験…足りない…」", "Kumiromi talks to you, " + cnvtalk("No...you aren't...experienced enough...for this..."))
					gosub *label_0623
					goto *label_1623
				}
				snd 64
				animeload 10, tc
				gNextLevelMinusOneKumiromisExperienceBecomesAvailable += 10
				iNumber(ci)--
				cell_refresh iX(ci), iY(ci)
				gAcquirableFeatCount++
				txt -1, lang("「…よく…経験をつんだね…酬いてあげる…」", cnvtalk("...You have acquired enough...experience...I shall reward you..."))
				txtef 5
				txt -1, lang("クミロミは" + name(tc) + "を祝福した。" + name(tc) + "は新たなフィートを取得できるようになった！", "Kumiromi blesses you. You can obtain one more feat now!")
				goto *label_1454
			}
		}
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		goto *label_1454
	}
	if (_switch_val == 42) {
		snd 38
		txtef 8
		txt -1, lang("何だか嫌な予感がする…", "You have a bad feeling about this...")
		goto *label_1454
	}
	if (_switch_val == 46) {
		txtnew
		txt -1, lang("本当に首を吊る？", "Really hang yourself?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval != 0) {
			goto *label_1617
		}
		ctalk 0, 1266, 0, 0
		dmghp 0, 99999, -20
		goto *label_1454
	}
	if (_switch_val == 33) {
		if (iSubname(ci) == 0) {
			txt -1, lang("モンスターボールは空っぽだ。", "This ball is empty.")
			goto *label_1454
		}
		if (get_freeally() == 0 | gettrait(0, 184) < 0) {
			txt -1, lang("仲間はこれ以上増やせない。", "Your party is full.")
			goto *label_1454
		}
		txt -1, lang(itemname(ci, 1) + "を使用した。", "You activate " + itemname(ci, 1) + ".")
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		flt
		initlv = iParam3(ci)
		novoidlv = 1
		clnum = -1
		nomagicdevice = 1
		noenchant = 1
		noencpfix = 1
		if (iSubname(ci) == 343) {
			if (inv(33, ci) != usernpcmax) {
				initunid = inv(33, ci) + 1
			}
		}
		characreate 56, iSubname(ci), -3, 0
		clnum = 0
		rc = 56
		gosub *label_1530
		goto *label_1454
	}
	if (_switch_val == 31) {
		x = cX(cc)
		y = cY(cc)
		cell_featread x, y
		if (feat(1) != 29) {
			txt -1, lang("それは種を植えた場所で使わなければならない。", "You don't see any plant on the ground.")
			goto *label_1454
		}
		if (feat == tile_plant + 2) {
			txt -1, lang("この作物は既に成長しきっている。", "The plant has already grown full.")
			goto *label_1454
		}
		if (feat == tile_plant + 3) {
			feat = tile_plant + 1
			gosub *label_1459
			txt -1, lang("枯れた植物に生命が宿った。", "The plant revives.")
		} else {
			feat++
			txt -1, lang("植物は成長した。", "The plant grows.")
		}
		cell_featset x, y, feat, feat(1), feat(2), feat(3)
		animeload 8, 0
		goto *label_1454
	}
	if (_switch_val == 32) {
		txtnew
		txt -1, lang("まずは素体となる仲間を選ぶ必要がある。", "Choose an original body.")
		rc = 0
		allyctrl = 5
		gosub *ui_selectAlly
		if (stat == (-1)) {
			goto *label_1617
		}
		rc = stat
		txtnew
		txt -1, lang("遺伝子を取り出す仲間を選ぶ必要がある。この仲間は合成後、永久に失われる。", "Choose a gene. Once you extract a gene, the subject will be lost forever.")
		repeat
			allyctrl = 5
			gosub *ui_selectAlly
			f = stat
			if (f == (-1)) {
				break
			}
			if (cbit(966, f)) {
				txtnew
				txt -1, lang("遺伝子を取り出すには聴診器を外す必要がある。", he(f) + " is your precious ally! You need to unwatch " + his(f) + " health to extract " + his(f) + " gene.")
				continue
			}
			break
		loop
		if (f == (-1)) {
			goto *label_1617
		}
		tc = f
		gosub *label_0623
		txtnew
		txt -1, lang("本当に" + cdatan(0, rc) + "に" + cdatan(0, tc) + "の遺伝子を組み込む？", "Really add " + cdatan(0, tc) + "'s gene to " + cdatan(0, rc) + "?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval != 0) {
			goto *label_1617
		}
		rtval = 0
		if (ogdata(491) == 2) {
			txtnew
			txt -1, lang("どちらの遺伝子を組み込む？", "Which add gene?")
			promptl(0, 0) = lang("能力値", "Attributes"), "a", "0"
			promptl(0, 1) = lang("技能", "skill"), "b", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
		}
		txtnew
		txtef 5
		txt -1, lang("" + cdatan(0, rc) + "は" + cdatan(0, tc) + "の遺伝子を受けついだ！", "" + cdatan(0, rc) + " has inherited " + cdatan(0, tc) + "'s gene!")
		if (eqfaction(tc, "whole") & (eqfaction(rc, "whole") == 0)) {
			txtef 8
			txt -1, lang("" + cdatan(0, rc) + "は娼婦になった。", "" + cdatan(0, rc) + " has changed whole.")
			addfaction rc, "whole"
			ocdata(49, rc) = 0
			cAiCalm(rc) = 5
		}
		animeid = 20
		anic = rc
		gosub *label_0630
		if (rtval == 0) {
			gosub *label_1456
			if (stat != (-1)) {
				cdata(stat, rc) = rtval * 10000
				txtef 2
				txt -1, lang(cdatan(0, rc) + "は新しい" + bodyn(rtval) + "を得た！", cdatan(0, rc) + " gains new " + bodyn(rtval) + "!")
				r1 = rc
				gosub *refreshSpeedPenaltyByTooManyBodyParts
			}
			gosub *getExtractableSkill
			if (stat != 0) {
				repeat 2
					if (rtval(cnt) == (-1)) {
						break
					}
					skillgain rc, rtval(cnt), 1
					txtef 2
					txt -1, lang(cdatan(0, rc) + "は" + skillname(rtval(cnt)) + "の技術を覚えた！", cdatan(0, rc) + " learns " + skillname(rtval(cnt)) + " skill!")
				loop
			}
			if (cLevel(tc) > cLevel(rc)) {
				lv = (cLevel(tc) - cLevel(rc)) / 2 + 1
				repeat lv
					r1 = rc
					r2 = 1
					gosub *label_0661
				loop
				txtef 2
				txt -1, lang(cdatan(0, rc) + "はレベル" + cLevel(rc) + "になった！", cdatan(0, rc) + " is now level " + cLevel(rc) + "!")
				listmax = 0
				repeat 18 - 10, 10
					list(0, listmax) = cnt, sorg(cnt, tc)
					listmax++
				loop
				gosub *label_1276
				repeat 3
					p = listmax - cnt - 1
					i = list(0, p)
					if (list(1, p) > sorg(i, rc)) {
						p = (list(1, p) - sorg(i, rc)) * 500
						p = limit(p * 10 / limit(lv, 2, 10), 1000, 10000)
						skillmod i, rc, p
					}
				loop
			}
		} else {
			rc_subact = 0
			tc_subact = 0
			rc_subact = int(cAiActNum(rc) / 10)
			tc_subact = int(cAiActNum(tc) / 10)
			if (rc_subact == 5) {
				txt -1, lang(cdatan(0, rc) + "はこれ以上新しい技能を覚えることが出来ない。", cdatan(0, rc) + "cannot learn any more skills.")
			} else {
				if(tc_subact == 0) {
					txt -1, lang(cdatan(0, tc) + "から技能を得ることは出来なかった…", "couldn't get skills from " + cdatan(0, tc) + " ...")
				} else {
					txtnew
					txtef 2
					if (cdata(211, tc) != 0 & rnd(10) == 0) {
						getactid = cdata(211, tc)
					} else {
						getactid = cdata(220 + rnd(tc_subact), tc)
					}
					if(getactid <= 0) {
						if (getactid == 0) {
							bufstr = "何もしない"
						}
						if (getactid == -1) {
							bufstr = "近接攻撃"
						}
						if (getactid == -2) {
							bufstr = "遠隔攻撃"
						}
						if (getactid == -3) {
							bufstr = "接近待ち"
						}
						if (getactid == -4) {
							bufstr = "ランダム移動"
						}
						if (getactid == -9994) {
							bufstr = "媚薬投擲"
						}
						if (getactid == -9995) {
							bufstr = "トマト投擲"
						}
						if (getactid == -9996) {
							bufstr = "塩投擲"
						}
						if (getactid == -9997) {
							bufstr = "ポーション投擲 No.1"
						}
						if (getactid == -9998) {
							bufstr = "ポーション投擲 No.2"
						}
						if (getactid == -9999) {
							bufstr = "ポーション投擲 No.3"
						}
						txt -1, lang(cdatan(0, rc) + "は" + bufstr + "を習得した！", cdatan(0, rc) + " learns " + bufstr + "!")
					} else {
						txt -1, lang(cdatan(0, rc) + "は" + skillname(getactid) + "を習得した！", cdatan(0, rc) + " learns " + skillname(getactid) + "!")
					}
					cdata(220 + rc_subact, rc) = getactid
					cAiActNum(rc) += 10
					if (cAiActSubFreq(rc) == 0) {
						cAiActSubFreq(rc) = 20
					}
				}
			}
		}
		if (ocdata(191, tc)) {
			i = getcharapic(rc)
			if (chipc(3, i) > 48) {
				if (lightdata(3, ocdata(191, tc)) >= 24 & lightdata(3, ocdata(191, tc)) < 48) {
					ocdata(191, rc) = ocdata(191, tc)
				}
			} else {
				if (lightdata(3, ocdata(191, tc)) < 24) {
					ocdata(191, rc) = ocdata(191, tc)
				}
			}
		}
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 1 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		skillexp2 151, 0, 1200 + (cbit(23, tc) == 0 & cbit(27, tc) == 0) * limit(cLevel(tc) * 8 / 3, 0, 4000)
		chara_vanquish tc
		randomize
		screenupdate = -1
		gosub *label_0623
		cc = rc
		csctrl = 4
		snd 26
		gosub *label_1251
		cc = 0
		goto *label_1454
	}
	if (_switch_val == 35) {
		txt -1, lang("あなたはアイアンメイデンの中に入った。", "You enter the iron maiden.")
		txtef 9
		ctalk 0, 1264, 0, 0
		if ( stat == 0 ) {
			txt -1, lang("「わくわく♪」", cnvtalk("Interesting!"))
		}
		txt -1, lang("突然誰かが蓋を閉めた。", "Suddenly, someone closes the door.")
		txtef 9
		txt -1, lang("「ニヤリ」", "*Grin*")
		dmghp 0, 9999, -18
		goto *label_1454
	}
	if (_switch_val == 36) {
		txt -1, lang("あなたはギロチンに首をつっこんでみた。", "You set your head on the guillotine.")
		txtef 9
		ctalk 0, 1265, 0, 0
		if ( stat == 0 ) {
			txt -1, lang("「わくわく♪」", cnvtalk("Interesting!"))
		}
		txt -1, lang("突然誰かがギロチンの刃を落とした。", "Suddenly, someone activates the guillotine.")
		txtef 9
		txt -1, lang("「ニヤリ」", "*Grin*")
		dmghp 0, 9999, -19
		goto *label_1454
	}
	if (_switch_val == 39) {
		if (cc > 15) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1454
		}
		if (cc != 0) {
			txt -1, lang(npcn(cc) + itemname(ci, 1) + "を鳴らした。", name(cc) + " blow" + _s(cc) + " on the " + itemname(ci, 1) + ".")
			f = 1
		}
		txtef 9
		txt -1, lang(" *ピーーーー* ", "*Peeeeeeeeeep* ")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		repeat 229, 16
			if (cState(cnt) != 1) {
				continue
			}
			if (cSleep(cnt) != 0) {
				continue
			}
			if (dist(cX(cnt), cY(cnt), cX(cc), cY(cc)) > 10) {
				continue
			}
			if (relationbetween(cc, cnt) >= (-1)) {
				continue
			}
			if (sdata(17, cc) > rnd(cLevel(cnt) + cLevel(cc))) {
				turn_aggro cnt, cc, 80
			}
		loop
		goto *label_1454
	}
	if (_switch_val == 38) {
		gosub *label_0623
		val = 0
		gosub *label_1350
		f = 0
		if (stat != 0) {
					tc = map(tlocx, tlocy, 1) - 1
					if (tc == (-1)) {
						txt -1, lang("それは無理だ。", "It's impossible.")
						goto *label_1454
					}
					if (cId(tc) != cId_android | iSubname(ci) == 0 | iSubname(ci) == 212 | iSubname(ci) == 340) {
						f = 1
					}
					if (iSubname(ci) == 306 & npcmemory(0, 306) < 100) {
						f = 1
					}
					if (iSubname(ci) == 331 & npcmemory(0, 331) < 100) {
						f = 1
					}
					if (iSubname(ci) == 336 & npcmemory(0, 336) < 100) {
						f = 1
					}
					if (iSubname(ci) == 338 & npcmemory(0, 338) < 100) {
						f = 1
					}
					if (iSubname(ci) == 339 & npcmemory(0, 339) < 100) {
						f = 1
					}
					if (iSubname(ci) == 342 & npcmemory(0, 342) < 100) {
						f = 1
					}
					if (iSubname(ci) == 366 & npcmemory(0, 366) < 100) {
						f = 1
					}
					if (iSubname(ci) == 367 & npcmemory(0, 367) < 100) {
						f = 1
					}
					if (f) {
						txt -1, lang("それは無理だ。", "It's impossible.")
						goto *label_1454
					}
					aimonster = iSubname(ci)
					flt
					if (aimonster == 343) {
						initunid = inv(33, ci) + 1
						ocdata(55, tc) = inv(33, ci) + 1
					} else {
						ocdata(55, tc) = 0
					}
					ocdata(49, tc) = 0
					ocdata(50, tc) = 0
					cibk = ci
					ocdata(54, tc) = aimonster
					characreate 56, aimonster, -3, 0
					cAiCalm(tc) = cAiCalm(56)
					cAiMove(tc) = cAiMove(56)
					cAiDist(tc) = cAiDist(56)
					cAiActSubFreq(tc) = cAiActSubFreq(56)
					cAiHeal(tc) = cAiHeal(56)
					cAiActNum(tc) = cAiActNum(56)
					repeat 10
						cdata(215 + cnt, tc) = cdata(215 + cnt, 56)
					loop
					chara_vanquish 56
					ci = cibk
					snd 64
					txt -1, lang("あなたは" + name(tc) + "に" + itemname(ci, 1) + "を通した。", "You pass " + itemname(ci, 1) + " through the card reader in " + name(tc) + ".")
					txtef 9
					txt tc, lang(name(tc) + "「がしゃーんがしゃーん」", " *clank* *clank* ")
					f = 1
		}
		if (f == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *label_1454
	}
	if (_switch_val == 51) {
		txt -1, lang("誰を鞭で叩く？", "Whipping who?")
		gosub *label_0623
		val = 0
		gosub *label_1350
		f = 0
		if (stat != 0) {
			if (map(x, y, 1) > 0) {
					tc = map(x, y, 1) - 1
					if (tc == 0) {
						if (gMount == 0) {
							snd 36
							txt -1, lang("あなたは自分を鞭で叩いた…", "You whipping self...")
							ctalk 0, 1108, 0, 0
							goto *label_1454
						} else {
							snd 36
							txt -1, lang("あなたは鞭で" + name(gMount) + "に喝を入れた。", "You whipping " + name(tc) + ".")
							if (synccheck(tc, -1)) {
								txtef 4
								txt -1, lang(name(gMount) + "は興奮した！", name(gMount) + " " + is(tc) + " excited!")
							}
							addbuff gMount, 5, sdata(17, cc) * 5 + 50, 10
							addbuff gMount, 7, sdata(17, cc) * 5 + 100, 10
							goto *label_1454
						}
					} else {
						f = 0
						snd 36
						txt -1, lang("あなたは鞭で" + name(tc) + "を叩いた。", "You whipping " + name(tc) + ".")
						sdim naturevalues, 3
						getfactionvalues tc, "nature", naturevalues
						repeat stat
							s = getfactionlabel(naturen, naturevalues(cnt))
							if (s == "マゾヒスト") {
								f = 1
								break
							}
						loop
						if (eqfaction(tc, "likewhip") | f == 1) {
							txtef 9
							txt -1, lang(name(tc) + "は呻き声を洩らした。", name(tc) + " glares at you.")
							ctalk tc, 1109, 0, tc
							if (stat == 0) {
								txtef 9
								txt tc, lang("「はぁはぁ…」", cnvtalk("D-don't sto....N-nothing!"))
							}
							if (synccheck(tc, -1)) {
								txtef 4
								txt -1, lang(name(tc) + "は興奮した！", name(tc) + " " + is(tc) + " excited!")
							}
							addbuff tc, 5, sdata(17, cc) * 5 + 50, 10
							addbuff tc, 7, sdata(17, cc) * 5 + 100, 10
							addbuff tc, 18, 1500, 10
							if (implevel(cImpression(tc)) < 5) {
								modimp tc, 1
							}
						} else {
							txtef 8
							txt -1, lang(name(tc) + "は嫌な顔をした。", name(tc) + " glares at you.")
							ctalk tc, 1108, 0, tc
							modimp tc, -1
						}
						if (petcheck(tc)) {
							inv_getheader tc
							repeat invrange, invhead
								if (iNumber(cnt) != 0 & refitem(iId(cnt), 5, cnt) == 77000) {
									ti = inv_getfreeid(0)
									if (ti == (-1)) {
										txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
										break
									}
									item_copy cnt, ti
									iNumber(ti) = iNumber(cnt)
									iNumber(cnt) = 0
									item_stack 0, ti, 1
									convertartifact ti
									txt -1, lang(name(tc) + "から" + itemname(ti) + "を取った。", "" + itemname(ti) + " falls at " + name(tc) + "'s feet.")
									break
								}
							loop
						}
					}
					f = 1
				}
		}
		if (f == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *label_1454
	}
	if (_switch_val == 52 | _switch_sw) {
		_switch_sw = 0
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *label_1410
		}
		ti = ci
		invsubroutine = 1
		invctrl = 34, 0
		snd 100
		gosub *label_1280
		if (stat == 0) {
			goto *label_1454
		}
		if (iNumber(ci) > 1) {
			txt -1, lang("" + itemname(ci, 1) + "をいくつ肥料にする？ (1〜" + iNumber(ci) + ")","How many? (1 to " + iNumber(ci) + ")")
			display_msg screenmsgy, 1
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
			inputlog = "" + iNumber(ci)
			gosub *label_1349
			in = int(inputlog)
			if (in > iNumber(ci)) {
				in = iNumber(ci)
			}
			if (in == 0 | rtval == (-1)) {
				goto *label_1454
			}
		} else {
			in = 1
		}
		animeload 8, cc
		txt -1, lang("" + in + "個の" + itemname(ci, 1) + "を肥料にした。", "Fertilized" + in + " " + itemname(ci, 1) + ".")
		repeat in
			if (rnd(20) == 0 | iId(ci) == 575) {
				if (iParam1(ti) >= iParam3(ti)) {
					txt -1, lang("これ以上新しい実は生らない。", "Dont New fruit grows.")
					break
				} else {
					txtef 2
					txt -1, lang("新しい実がついた！", "A New fruit grows!")
					iParam1(ti) += 1
					iImage(ti) = 591
				}
				animeload 8, cc
			}
		loop
		removeitem ci, in
		goto *label_1454
		_switch_sw++
	}
	if (_switch_val == 53) {
		if (mapType == 1) {
			txt -1, lang("ここでは使えない。", "You can't use it here.")
			goto *label_1454
		}
		txt -1, lang("あなたは卵を孵そうとした。", "You hatched an egg.")
		animeload 8, cc
		flt
		initlv = iPv(ci)
		novoidlv = 1
		childid = iCount(ci)
		if (childid == 0) {
			childid = 330
		}
		if (childid == 319 | childid == 368) {
			childid = 176
		}
		if (childid == 343) {
			initunid = iDv(ci) + 1
		}
		if (childid == (-1)) {
			childid = cId(cc)
			if (childid == 343) {
				initunid = iDv(ci) + 1
			}
		}
		nc_intb_100 = ci
		characreate -1, childid, cX(cc), cY(cc)
		if (stat != 0) {
			ci = nc_intb_100
			cBirthYear(rc) = gYear
			if (cRelationship(rc) == 10 | cRelationship(rc) == 0) {
				cRelationship(rc) = (-1)
				cOriginalRelationship(rc) = (-1)
			}
			if ((iCurseState(ci) == 0 & rnd(2)) | iCurseState(ci) == 1) {
				cRelationship(rc) = (-1)
				cOriginalRelationship(rc) = (-1)
			}
			if (iCurseState(ci) < 0) {
				cRelationship(rc) = (-3)
				cOriginalRelationship(rc) = (-3)
			}
			if (ibit(5, ci)) {
				cdatan(0, rc) = lang(cdatan(0, 0) + "の子供", "child of " + cdatan(0, 0))
				if (cRelationship(rc) == (-1)) {
					addfaction rc, "pcchild"
				}
			} else {
				if (iSubname(ci) == 343) {
					if (cCnpcId(cc) != usernpcmax) {
						cdatan(0, rc) = lang(userdatan(1, cCnpcId(cc)) + "の子供", "child of " + userdatan(0, cCnpcId(cc), 2, 1))
					} else {
						cdatan(0, rc) = lang("残りカスの子供", "child of garbage")
					}
				} else {
					cdatan(0, rc) = lang(refchara(iSubname(ci), 2, 1) + "の子供", "child of " + refchara(iSubname(ci), 2, 1))
				}
			}
			txt -1, lang("卵から" + cdatan(0, rc) + "が孵った。", cdatan(0, rc) + "hatched from an egg.")
			ctalk cc, 1138, cc, rc
			iNumber(ci)--
		} else {
			txt -1, lang("孵すスペースがない。", "You can't use it here.")
		}
		goto *label_1454
	}
	if (_switch_val == 54) {
		if (iNumber(ci) > 1) {
			txt -1, lang(itemname(ci, 1) + "をいくつ使用する？", "How many?")
			display_msg screenmsgy, 1
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNumber(ci)
			inputlog = "" + iNumber(ci)
			gosub *label_1349
			in = int(inputlog)
			if (in > iNumber(ci)) {
				in = iNumber(ci)
			}
			if (in == 0 | rtval == (-1)) {
				goto *label_1454
			}
		} else {
			in = 1
		}
		snd 12
		iNumber(ci) -= in
		cPlatinumCoin(0) = limitaddition(cPlatinumCoin(0), in)
		goto *label_1454
	}

	if (_switch_val == 1000) {
		if (gCurrentMap != 35) {
			txt -1, lang("それは鈍く輝いた。", "It glows dully.")
			goto *label_1454
		}
		if (iOwnState(ci) != 5) {
			txt -1, lang("このアイテムには領域の記憶が宿っていない。この場所の所有者が配置したアイテムを探す必要がある。", "The crystal isn't filled with the memory of this place. You need to find ones placed by the owner of this area.")
			goto *label_1454
		}
		gosub *label_1678
		if (stat != 1) {
			goto *label_1454
		}
		snd 118
		iNumber(ci)--
		cell_refresh iX(ci), iY(ci)
		goto *label_1454
	}
	if (_switch_val == 1001) {
		outputmapimage iCurseState(ci)
		snd 44
		txt -1, lang("周囲の風景をカメラに収めた。", "You captured the surrounding landscape with a camera.")
		goto *label_1454
	}
	if (_switch_val == 1501) {
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1454
		}
		txtnew
		txt -1, lang(name(cc) + "は" + itemname(ci) + "を使い始めた。", " ")
		cContinuousActionId(cc) = 25001
		cContinuousActionTurn(cc) = 30 + rnd(11)
		cContinuousActionItem(cc) = ci
		goto *label_1454
	}
	if (_switch_val == 1502) {
		if (mapType == 1) {
			txt -1, lang("それはここでは使えない。", "You can't use it here.")
			iCount(ci) = 0
			gosub *label_0623
			goto *label_1623
		}
		noseed@se = 1
		repeat 200
			if (iNumber(cnt) == 0) {
				continue
			}
			if (refitem(iId(cnt), 9, cnt) == 58500) {
				noseed@se = 0
				break
			}
		loop
		if (noseed@se) {
			txt -1, lang("それは種を持っていなければ使えない。", "You don't have seeds to plant.")
			iCount(ci) = 0
			gosub *label_0623
			goto *label_1623
		}
		crop_count = 0
		repeat mapWidth
			cnt2 = cnt
			repeat mapHeight
				if (map(cnt2, cnt, 6) != 0) {
					continue
				}
				if (chipm(0, map(cnt2, cnt, 0)) != 2) {
					continue
				}
				crop_count++
			loop
		loop
		if (crop_count == 0) {
			txt -1, lang("それは種を蒔く畑がなければ使えない。", "No crops here.")
			iCount(ci) = 0
			gosub *label_0623
			goto *label_1623
		}
		if (ogdata(455) == 2 & godcheck() == "kumiromi") {
			iCount(ci) = 0
		}
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		txt -1, lang("あなたは" + crop_count + "個の種を植えられる。どの種を植える？", "You can plant " + crop_count + " seeds. Which seeds would you plant?")
		invsubroutine = 1
		invctrl = 31, 0
		gosub *label_1280
		if (stat == 0) {
			snd 64
			txtef 5
			txt -1, lang("クミロミ「……またね」", "You hear a quiet voice, " + cnvtalk("...See you."))
			goto *label_1454
		}
		repeat mapWidth
			cnt2 = cnt
			repeat mapHeight
				if (map(cnt2, cnt, 6) != 0) {
					continue
				}
				if (chipm(0, map(cnt2, cnt, 0)) != 2) {
					continue
				}
				feat = tile_plant, 29, iMaterial(ci)
				gosub *label_1459
				cell_featset cnt2, cnt, tile_plant, 29, iMaterial(ci), feat(3)
				removeitem ci, 1
				if (iNumber(ci) == 0) {
					break
				}
			loop
			if (iNumber(ci) == 0) {
				break
			}
		loop
		snd 64
		txtef 5
		txt -1, lang("クミロミ「…これで…いいかい？」", "Someone whispers, " + cnvtalk("...Is it okay?"))
		goto *label_1454
	}
	if (_switch_val == 1503) {
		txtnew
		txt -1, lang("ゴミ箱を空にする？", "Do you empty the trash?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval == 0) {
			trash_clear
		}
		goto *label_1454
	}
	if (_switch_val == 1504) {
		if (areaType(gCurrentMap) != 5) {
			txt -1, lang("それは自分の物件でのみ使用できる。", "You can only use it at your home.")
			goto *label_1454
		}
		anvil = 0
		repeat 5480
			if (iNumber(cnt) <= 0) {
				continue
			}
			if (iId(cnt) == 493) {
				anvil = 1
				break
			}
		loop
		if (anvil == 0) {
			txt -1, lang("トラッシュカンが必要だ。", "Requires an Trashcan.")
			goto *label_1454
		}
		txtnew
		if (iCurseState(ci) == 1) {
			txt -1, lang("付近のアイテムを全てゴミ箱に片付ける？", "Do you into the trash on area?")
		} else {
			txt -1, lang("足元のアイテムをゴミ箱に片付ける？", "Do you into the trash?")
		}
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval == 0) {
			inv_getheader -1
			repeat invrange, invhead
				if (iNumber(cnt) > 0 & iId(cnt) != 493 & refitem(iId(cnt), 5, cnt) != 92000 & iOwnState(cnt) != 3) {
					if (iCurseState(ci) == 1) {
						trash_push cnt
						iNumber(cnt) = 0
						if (iX(cnt) >= 0 & iX(cnt) < mapWidth & iY(cnt) >= 0 & iY(cnt) < mapHeight) {
							cell_refresh iX(cnt), iY(cnt)
						}
					} else {
						if (iX(cnt) == cX(0) & iY(cnt) == cY(0)) {
							trash_push cnt
							iNumber(cnt) = 0
						}
					}
				}
			loop
			trash_throw
			cell_refresh cX(0), cY(0)
			snd 55
			if (iCurseState(ci) == 1) {
				txt -1, lang("付近のアイテムをすべてゴミ箱に片付けた。", "You into the trash item.")
			} else {
				txt -1, lang("足元のアイテムをゴミ箱に片付けた。", "You into the trash item.")
			}
			ctalk 0, 1136, 0, 0
		}
		goto *label_1454
	}
	if (_switch_val == 1505) {
		tcchat = tc
		allyctrl = 4
		gosub *ui_selectAlly
		if (stat != (-1)) {
			rc = stat
			cc = rc
			csctrl = 4
			snd 26
			gosub *label_1251
			cc = 0
			gosub *label_1465
			buff = ""
		}
		goto *label_1454
	}
	if (_switch_val == 2000) {
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1454
		}
		cw = ci
		snd 100
		gosub *label_1735
		if (stat) {
			extend = 0
			cContinuousActionId(cc) = 20012
			cContinuousActionTurn(cc) = 25 - gettrait(cc, 70) * 5 + rnd(11)
			cContinuousActionItem(cc) = cw
		} else {
			obvious = 0
		}
		goto *label_1454
	}
	if (_switch_val == 2001) {
		if (cc != 0) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_1454
		}
		txtnew
		txt -1, lang(name(cc) + "は入浴をはじめた。", name(cc) + " start" + _s(cc) + " bathing.")
		cContinuousActionId(cc) = 20001
		cContinuousActionTurn(cc) = 25 + rnd(10)
		goto *label_1454
	}
	if (_switch_val == 2002) {
		txt -1, lang("誰を対象にする？", "Who do you want to use the jewel of love to?")
		gosub *label_0623
		val = 0
		gosub *label_1350 // Query direction.
		f = 0
		if (stat != 0) { // not canceled.
			if (map(x, y, 1) > 0) { // there is someone.
				tc = map(x, y, 1) - 1
				if (cId(tc) != iSubname(ci) | (iSubname(ci) == cId_user & cCnpcId(tc) != inv(33, ci))) {
					txt -1, lang("これは異なるペットとの愛情の証だ。", "It is not " + his(tc) + " jewel of love.")
					goto *label_1454
				}
				if (petcheck(tc) == 0) {
					txt -1, lang(cdatan(0, tc) + "はあなたのペットではない。", he(tc) + " is not your ally.")
					goto *label_1454
				}
				if (implevel(cImpression(tc)) < 8) { // less than *Love*
					txt -1, lang("愛情が足りない。", his(tc) + " love with you is not enough.")
					goto *label_1454
				}
				migration_normalizeFieldsOfJewelOfLoveAndKumiromisExperience tc
				if (ocdata(109, tc) > cLevel(tc)) {
					txt -1, lang("経験が足りない。", he(tc) + " is not experienced enough.")
					goto *label_1454
				}
				snd 64
				ocdata(109, tc) += 10
				iNumber(ci)--
				cell_refresh iX(ci), iY(ci)
				ocdata(105, tc)++
				txtef 5
				txt -1, lang(cdatan(0, tc) + "は新たなフィートを取得できるようになった！", name(tc) + " can obtain one more feat now!")
				f = 1
			}
		}
		if (f == 0) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *label_1454
	}
*label_1454
	gosub *refreshPCBurdenState
	goto *label_1617



// rc: The base character
// tc: The extracted character
*getExtractableSkill
	if (chara_splits(tc)) {
		return 0
	}

	randomize cId(tc)
	dbmax = 0
	repeat 100
		rtval = rnd(190 - 150) + 150
		if (sdata(rtval, rc) == 0) {
			if (sdata(rtval, tc) > 0) {
				dblist(0, dbmax) = rtval
				dbmax++
			}
		}
	loop

	if (dbmax < 2) {
		specialSkills@st = sId_firearm, sId_pickpocket, sId_riding
		repeat length(specialSkills@st)
			if (sdata(specialSkills@st(cnt), rc) == 0) {
				if (sdata(specialSkills@st(cnt), tc) > 0) {
					dblist(0, dbmax) = specialSkills@st(cnt)
					dbmax++
				}
			}
		loop
	}

	rtval = dblist(0, 0), -1
	if (dbmax >= 2) {
		if (rnd(3) == 0) {
			repeat dbmax - 1, 1
				if (dblist(0, cnt) != rtval) {
					rtval(1) = dblist(0, cnt)
					break
				}
			loop
		}
	}
	randomize
	return dbmax



*label_1456
	dbmax = 0
	s(1) = refchara(cId(tc), 8, 1)
	if (instr(s(1), 0, "/man/") != (-1)) {
		return -1
	}
	if (cbit(23, tc) | cbit(27, tc)) {
		return -1
	}
	rtval(1) = -1
	repeat 30, 100
		if (cdata(cnt, rc) == 0) {
			rtval(1) = cnt
		}
	loop
	if (rtval(1) == (-1)) {
		return -1
	}
	repeat 30, 100
		f = cdata(cnt, tc) / 10000
		if (f == 11 | f == 10 | f == 4) {
			continue
		}
		if (f != 0) {
			dblist(0, dbmax) = f
			dbmax++
		}
	loop
	if (dbmax == 0) {
		return -1
	}
	randomize cId(tc)
	repeat 3
		rtval = dblist(0, rnd(dbmax))
		f = 0
		repeat 30, 100
			if (cdata(cnt, rc) == 0) {
				continue
			}
			if (cdata(cnt, rc) / 10000 == rtval) {
				f = 1
			}
		loop
		if (f) {
			break
		}
	loop
	if (f == 0) {
		randomize
		return rtval(1)
	}
	dim dblist, 2, 800
	repeat 30, 100
		dblist(0, cdata(cnt, tc) / 10000)++
	loop
	repeat 25
		rtval = rnd(15) + 1
		f = 0
		repeat 30, 100
			if (cdata(cnt, rc) / 10000 == rtval) {
				f++
			}
		loop
		if (f < dblist(0, rtval)) {
			f = -1
			break
		}
	loop
	randomize
	if (f == (-1)) {
		return rtval(1)
	} else {
		return -1
	}
*label_1457
	screenupdate = -1
	gosub *label_0623
	if (mapType == 1) {
		txt -1, lang("この場所には埋められない。", "You can't plant it here.")
		gosub *label_0623
		if (hack_plant) {
			return
		} else {
			goto *label_1623
		}
	}
	if (map(cX(cc), cY(cc), 6) != 0) {
		txt -1, lang("この場所には埋められない。", "You can't plant it here.")
		gosub *label_0623
		if (hack_plant) {
			return
		} else {
			goto *label_1623
		}
	}
	if (chipm(0, map(cX(0), cY(0), 0)) == 2) {
		val = 1
	} else {
		val = 0
	}
	feat = tile_plant, 29, iMaterial(ci)
	gosub *label_1459
	if (jp) {
		s = ""
		if (val) {
			s = "畑に"
		}
		s += itemname(ci, 1) + "を埋めた。"
	} else {
		s = "You plant " + itemname(ci, 1)
		if (val) {
			s += " on the field."
		} else {
			s += "."
		}
	}
	txt -1, s
	snd 55
	removeitem ci, 1
	cell_featset cX(cc), cY(cc), tile_plant, 29, iMaterial(ci), feat(3)
	skillexp2 180, 0, 300
	if (hack_plant) {
		return
	} else {
		goto *label_1623
	}
*label_1458
	feat(3)--
	if (feat(3) \ 50 == 0) {
		if (feat(3) >= 50) {
			if (sdata(180, 0) < 300 | p@se < 300) {
				feat = tile_plant + 3
			} else {
				feat++
				gosub *label_1459
			}
		} else {
			feat++
			gosub *label_1459
		}
	}
	return
*label_1459
	feat(3) = 4 + rnd(4 + 1)
	p = 10
	if (feat(2) == 41) {
		p = 15
	}
	if (feat(2) == 42) {
		p = 25
	}
	if (feat(2) == 38) {
		p = 30
	}
	if (feat(2) == 39) {
		p = 25
	}
	if (feat(2) == 40) {
		p = 40
	}
	if (val == 0) {
		p = p * 3 / 2
	}
	if (feat == tile_plant) {
		if (gWeather < 3) {
			p = p * 2
		}
	}
	gosub *label_1761
	if (p(1) < rnd(p + 1) | rnd(20) == 0) {
		feat(3) += 50
	}
	return
*label_1460
	p = 15
	if (feat(2) == 41) {
		p = 25
	}
	if (feat(2) == 42) {
		p = 30
	}
	if (feat(2) == 38) {
		p = 40
	}
	if (feat(2) == 39) {
		p = 35
	}
	if (val == 0) {
		p = p * 2
	}
	if (gWeather < 3) {
		p = p * 4 / 3
	}
	gosub *label_1761
	if (p(1) < rnd(p + 1) | rnd(5) == 0 | feat(2) == 40) {
		map(cX(0), cY(0), 6) = 0
		return
	}
	feat = tile_plant
	gosub *label_1459
	cell_featset cX(cc), cY(cc), feat, feat(1), feat(2), feat(3)
	txtef 2
	txt -1, lang("新しい芽が息吹いている！", "A new plant grows!")
	return
*label_1461
	skillexp2 180, 0, 75
	snd 55
	flt sdata(180, 0) / 2 + 15, 2
	dbid = 0
	harvestsis = 0
	if (feat(2) == 39) {
		flttypemajor = fsetplantunknown(rnd(length(fsetplantunknown)))
		if (rnd(100) == 0) {
			dbid = 559
		}
		if (rnd(50) == 0 | Seasonal_Check(0, 0)) {
			harvestsis = 1
		}
	}
	if (feat(2) == 40 | (feat(2) == 39 & rnd(50) == 0)) {
		flttypemajor = fsetplantartifact(rnd(length(fsetplantartifact)))
		fixlv = 4
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
	}
	if (feat(2) == 40 & rnd(500) == 0) {
		dbid = 776
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
	}
	if (feat(2) == 36) {
		flttypeminor = 57003
	}
	if (feat(2) == 37) {
		flttypeminor = 57004
	}
	if (feat(2) == 38) {
		flttypeminor = 58005
	}
	if (feat(2) == 41) {
		flttypeminor = 77001
	}
	if (feat(2) == 42) {
		flttypemajor = 56000
	}
	dim farmers, 15
	limfarmers = 0
	repeat 15, 1
		if (cState(cnt) != 1) {
			continue
		}
		if (ocdata(104, cnt) != 180) {
			continue
		}
		if (getgametime() <= cTimeToRestore(cnt)) {
			continue
		}
		farmers(limfarmers) = cnt
		limfarmers++
	loop
	repeat limfarmers
		worker = farmers(cnt)
		skillexp2 180, worker, 75
		objlv += sdata(180, worker) / 3
	loop
	if (harvestsis == 1) {
		txt -1, lang("妹を収穫した！", "You harvest a younger sister!")
		flt
		imofarmer = 1
		characreate -1, 176, cX(cc), cY(cc)
	} else {
		harvest = 1
		if (nc_gettrait(0, 118) > 0) {
			itemcreate 0, dbid, -1, -1, 2
		} else {
			itemcreate 0, dbid, -1, -1, 0
		}
		if (iCurseState(ci) == 1) {
			if (limfarmers) {
				reftype = refitem(iId(ci), 5, ci)
				if (reftype == 57000) {
					worker = farmers(rnd(limfarmers))
					s = godcheck(worker)
					if (s != "eyth" & s != "elder brother") {
						iParam4(ci) = cGod(worker)
						if (iParam4(ci) == 0) {
							iParam4(ci) = blesscgod(worker)
						}
						if (iParam4(ci) != 0) {
							ibitmod 8, ci, 1
						}
					}
				}
			}
		}
		if (reftype == 32000 | reftype == 34000) {
			encadd ci, 3 * 10000 + 180, 150 + randomencp()
		}
		harvest = 0
		txt -1, lang(itemname(ci, 1) + "を収穫した。", "You harvest " + itemname(ci, 1) + ".")
		item_stack 0, ci, 1
	}
	return
*label_1462
	gdata(91) = 105
	gosub *label_1370
	return



#deffunc clientguide int
	j@m193 = 0
	repeat 5
		p@m193 = gdata(160 + cnt)
		if (qdata(8, p@m193) == 1) {
			if (gCurrentDungeonLevel == 1) {
				i@m193 = -1
				if (qdata(3, p@m193) == 1011) {
					if (qdata(1, p@m193) == gCurrentMap) {
						i@m193 = qdata(10, p@m193)
					}
				}
				if (qdata(3, p@m193) == 1002) {
					if (qdata(1, qdata(10, p@m193)) == gCurrentMap) {
						i@m193 = qdata(0, qdata(10, p@m193))
					}
				}
				if (i@m193 != (-1)) {
					f@m193 = 0
					repeat cnt
						if (gdata(160 + cnt) == p@m193) {
							f@m193 = 1
							break
						}
					loop
					if (f@m193 == 0) {
						rtval(j@m193) = i@m193
						j@m193++
					}
				}
			}
		}
	loop
	return j@m193

#deffunc clientguide2 int
	j@m193 = 5
	repeat 5
		p@m193 = gdata(160 + cnt)
		if (qdata(8, p@m193) == 1) {
			if (gCurrentDungeonLevel == 1) {
				i@m193 = -1
				if (qdata(1, p@m193) == gCurrentMap) {
					i@m193 = p@m193
				}
				if (i@m193 != (-1)) {
					rtval(j@m193) = i@m193
					j@m193++
				}
			}
		}
	loop
	return j@m193

#include "talk.hsp"

*label_1492
	if (tc > 0) {
		if (cRole(tc) == 1009) {
			gosub *label_1497
		}
	}
	mode = 6
	file = "shoptmp.s2"
	ctrlFile 4
	if (cShopStoreId(tc) == 0) {
		if (cRole(tc) == 1010 | cRole(tc) == 2003) {
			cShopStoreId(tc) = 1
		} elseif (cRole(tc) == 3001) {
			cShopStoreId(tc) = 3001
		} else {
			gNextInventorySerialId++
			cShopStoreId(tc) = gNextInventorySerialId
		}
		gosub *shop_restock
	} else {
		if (getgametime() >= cTimeToRestore(tc)) {
			gosub *shop_restock
		} else {
			file = "shop" + invfile + ".s2"
			ctrlFile 3
		}
	}
	invfile = cShopStoreId(tc)
	goto *label_1494
*label_1493
	mode = 6
	file = "shoptmp.s2"
	ctrlFile 4
	file = "shop" + invfile + ".s2"
	ctrlFile 3
	shoptrade = 0
	if (tc > 0) {
		if (cRole(tc) == 1009) {
			shoptrade = 1
		}
	}
	goto *label_1280
*label_1494
	file = "shop" + invfile + ".s2"
	ctrlFile 4
	file = "shoptmp.s2"
	ctrlFile 3
	mode = 0
	return



*label_1497
	dim trate, 8
	repeat 8
		trate(cnt) = 100
	loop
	if (gCurrentMap == 5) {
		trate(0) = 190
		trate(1) = 70
		trate(3) = 130
		trate(2) = 85
		trate(6) = 250
		trate(7) = 160
	}
	if (gCurrentMap == 11) {
		trate(0) = 65
		trate(1) = 130
		trate(4) = 175
		trate(5) = 65
		trate(2) = 70
		trate(6) = 400
		trate(7) = 250
	}
	if (gCurrentMap == 15) {
		trate(0) = 160
		trate(2) = 75
		trate(4) = 75
		trate(1) = 175
		trate(6) = 130
		trate(7) = 80
	}
	if (gCurrentMap == 12) {
		trate(0) = 160
		trate(3) = 75
		trate(2) = 160
		trate(6) = 280
		trate(7) = 100
	}
	if (gCurrentMap == 14) {
		trate(0) = 85
		trate(3) = 70
		trate(5) = 160
		trate(2) = 190
		trate(6) = 190
		trate(7) = 90
	}
	if (gCurrentMap == 33) {
		trate(1) = 325
		trate(0) = 310
		trate(3) = 280
		trate(5) = 190
		trate(2) = 220
		trate(6) = 75
		trate(7) = 160
	}
	if (gCurrentMap == 36) {
		trate(1) = 235
		trate(0) = 190
		trate(3) = 100
		trate(5) = 160
		trate(2) = 160
		trate(6) = 100
		trate(7) = 70
	}
	// South Tyris BEGIN
	if (gCurrentMap == areaId_serria)  : trate = 55,  100, 130, 90,  100, 65,  180, 90
	if (gCurrentMap == areaId_tormat)  : trate = 80,  140, 130, 100, 115, 80,  85,  80
	if (gCurrentMap == areaId_khios)   : trate = 135, 120, 120, 100, 120, 100, 130, 100
	if (gCurrentMap == areaId_carlia)  : trate = 140, 80,  100, 90,  100, 90,  130, 80
	if (gCurrentMap == areaId_trian)   : trate = 130, 90,  80,  80,  65,  120, 140, 90
	// South Tyris END

	randomize getgametime() / 100
	repeat 10
		trate(cnt) += rnd(15) - rnd(45)
	loop
	randomize
	return



#deffunc addbuilding int __zzz, int __aaa, int __bbb, int __ccc
	p@m194 = -1
	repeat 10
		if (bddata(0, __zzz, cnt) == 0) {
			p@m194 = cnt
			break
		}
	loop
	if (p@m194 == (-1)) {
		return
	}
	bddata(0, __zzz, p@m194) = __aaa, __bbb, __ccc, bdref(0, __aaa) + 363
	return
*label_1499
*label_1500
	if (initeco) {
		gdata(815) = 15
	}
	bkdata = gCurrentMap, gCurrentDungeonLevel, cX(0), cY(0)
	snd 44
	gosub *label_1339
	mode = 11
	cX(0) = 0
	cY(0) = 0
	scx = cX(0)
	scy = cY(0)
	repeat 500
		if (areaId(cnt) == 0) {
			continue
		}
		if (areaQuestTownId(cnt) == 0) {
			continue
		}
		gCurrentMap = areaId(cnt)
		gCurrentDungeonLevel = 1
		if (gCurrentMap != bkdata(0) | gCurrentDungeonLevel != bkdata(1)) {
			gosub *label_0942
		}
		p = areaQuestTownId(cnt)
		if (initeco) {
			if (p == 1) {
				addbuilding p, 1, 27, 22
				addbuilding p, 1, 28, 23
			}
			if (p == 2) {
				addbuilding p, 2, 42, 31
				addbuilding p, 2, 43, 33
			}
			if (p == 3) {
			}
			if (p == 4) {
				addbuilding p, 5, 12, 34
			}
			if (p == 5) {
				addbuilding p, 6, 4, 16
			}
			if (p == 6) {
			}
			if (p == 7) {
				addbuilding p, 3, 60, 33
			}
		}
		gosub *label_0941
	loop
	gCurrentMap = bkdata(0)
	gCurrentDungeonLevel = bkdata(1)
	cX(0) = bkdata(2)
	cY(0) = bkdata(3)
	gdata(79) = 1
	mode = 3
	mapsubroutine = 1
	gosub *label_0942
	initeco = 0
	msgtemp = ""
	return
*label_1501
	listmax = 0
	page = 0
	pagesize = 13
	cs = 0
	cc = 0
	cs_bk = -1
	snd 99
	curmenu = 0
	redraw 0
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_politics.bmp", 1
	gsel 0
	fillbg 3, 960, 96, 128, 128
	gosub *label_0625
	windowshadow = 1
	city = areaQuestTownId(gCurrentMap)
	lv = 0
	redraw 0
	cs_bk = -1
	listmax = 0
	repeat 100
		list(0, cnt) = -1
	loop
	repeat 100
		if (podata(0, cnt) != gCurrentMap) {
			continue
		}
		list(0, listmax) = cnt
		listmax++
	loop
	pagemax = (listmax - 1) / pagesize
*label_1502
	cs_bk = -1
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	redraw 0
	s = lang("ポストチャート", "City Chart"), strhint3b
	display_window (windoww - 580) / 2 + inf_screenx, winposy(400), 580, 400
	keyrange = 0
	j = 0
	n = 0
	color 0, 0, 0
	cs_listbk
	if (areaQuestTownId(gCurrentMap) == 0 | gCurrentDungeonLevel != 1) {
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		pos wx + 40, wy + 50
		mes lang("この場所には経済活動がない。", "There's no economy running in this area.")
	} else {
		display_topic lang("渡すアイテム", "Give Item"), wx + 40, wy + 34
		display_topic lang("受け取るアイテム", "Take Item"), wx + 220, wy + 34
		display_topic lang("手数料", "Tax"), wx + 380, wy + 34
		listmax = 0
		repeat 13
			if (list(0, cnt + (page * 13)) == (-1)) {
				continue
			}
			y = wy + 70 + n * 20
			x = wx + 40
			list(1, cnt) = list(0, cnt + (page * 13))
			key_list(cnt) = key_select(cnt)
			keyrange++
			display_key x, y, cnt
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			pos x - 2, y + jp * 2
			color 0, 0, 0
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			item_find podata(1, cnt + (page * 13)), 3, 1
			if (stat != (-1)) {
				p = iNumber(stat)
			} else {
				p = 0
			}
			if (jp) {
				s = ioriginalnameref(podata(1, list(0, cnt + (page * 13))))
			} else {
				s = ioriginalnameref(podata(1, list(0, cnt + (page * 13)))) + ioriginalnameref2(podata(1, list(0, cnt + (page * 13))))
			}
			cs_list s, x + 30, y, 19
			pos x + 210 - 2, y + jp * 2
			if (podata(2, list(0, cnt + (page * 13))) == 55) {
				if (jp) {
					s = ioriginalnameref(podata(2, list(0, cnt + (page * 13)))) + "x" + podata(3, list(0, cnt + (page * 13)))
				} else {
					s = ioriginalnameref(podata(2, list(0, cnt + (page * 13)))) + ioriginalnameref2(podata(2, list(0, cnt + (page * 13)))) + "x" + podata(3, list(0, cnt + (page * 13)))
				}
			} else {
				if (jp) {
					s = ioriginalnameref(podata(2, list(0, cnt + (page * 13))))
				} else {
					s = ioriginalnameref(podata(2, list(0, cnt + (page * 13)))) + ioriginalnameref2(podata(2, list(0, cnt + (page * 13))))
				}
			}
			mes s
			pos x + 370 - 2, y + jp * 2
			if (podata(2, list(0, cnt + (page * 13))) == 55) {
				s = "======="
			} else {
				s = "" + podata(3, list(0, cnt + (page * 13))) + "gp"
			}
			mes s
			n++
		loop
		if (keyrange != 0) {
			cs_bk = cs
		}
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(1, cnt)
			break
		}
	loop
	if (p != (-1)) {
		item_find podata(1, p), 3, 1
		if (stat != (-1)) {
			ti = iNumber(stat)
		} else {
			ti = 0
		}
		if (ti <= 0) {
			snd 27
			txt -1, lang("交換に必要なアイテムが足りない。", "Not enough items for exchange.")
			goto *label_1502
		}
		if (podata(2, p) == 55) {
			snd 12
			item_find podata(1, p), 3, 1
			iNumber(stat) -= 1
			addplat 0, podata(3, p)
			txt -1, lang("プラチナ硬貨を交換した。", "platinum coin were exchanged.")
			goto *label_1502
		}
		ti = inv_getfreeid(0)
		if (ti == (-1)) {
			snd 27
			txt -1, lang("これ以上持てない。", "Your inventory is full.")
			goto *label_1502
		}
		if (cGold(0) < podata(3, p) & ncgdata(50) == 0) {
			txt -1, lang("お金が足りない…", "You don't have enough money...")
			goto *label_1502
		}
		snd 12
		cGold(0) -= podata(3, p)
		gosub *label_N200
		item_find podata(1, p), 3, 1
		iNumber(stat) -= 1
		flt
		itemcreate 0, podata(2, p), -1, -1, 0
		iCurseState(ci) = 0
		snd 12
		txt -1, lang(itemname(ci, 1) + "を交換した。", itemname(ci, 1) + " were exchanged.")
		item_stack 0, ci
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1502
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1502
		}
	}
	if (key == key_cancel) {
		gosub *label_0623
		return
	}
	goto *label_1502
*label_1503
	goto *label_1506



#deffunc showeconomy int __ddd, int __eee, str __fff, int __ggg, int __hhh
	pos __ddd, __eee
	color 0, 0, 0
	mes __fff
	pos __ddd + 130, __eee
	mes "" + __ggg
	p@m195 = __ggg - __hhh
	if (p@m195 >= 0) {
		color 0, 0, 150
	} else {
		color 150, 0, 0
	}
	pos __ddd + 130 + ginfo(14) + 12, __eee
	mes "(" + p@m195 + ")"
	return
*label_1505
*label_1506
	curmenu = 1
	key_list(0) = key_enter
	keyrange = 0
	pagesize = 1
	listmax = 2
	redraw 0
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_politics.bmp", 1
	gsel 0
	fillbg 3, 960, 96, 128, 128
	gosub *label_0625
	gsel 7
	pos 0, 0
	picload_ exedir + "graphic\\ie_scroll.bmp"
	gsel 0
	windowshadow = 1
	snd 92
	drawmenu 3
	city = 1
	ww = 540
	wh = 440
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
*label_1507
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1508
	redraw 0
	s = strhint2 + strhint3b
	showscroll wx, wy, ww, wh
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	if (areaQuestTownId(gCurrentMap) == 0 | gCurrentDungeonLevel != 1) {
		pos wx + 40, wy + 60
		mes lang("この場所には経済活動がない。", "There's no economy running in this area.")
	} else {
		if (page == 0) {
			display_topic lang("街の概要", "Town Information"), wx + 65, wy + 50
			display_topic lang("街の財政", "Town Finance"), wx + 65, wy + 150
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
			x = wx + 50
			y = wy + 80
			showeconomy x, y, lang("人口", "Population"), podata(100, city), podata(101, city)
			x = wx + 50
			y = wy + 180
			showeconomy x, y, lang("基本税", "Basic Tax") + " (" + gdata(820) + "%)", podata(102, city), podata(103, city)
			showeconomy x, y + 16, lang("消費税", "Excise Tax") + " (" + podata(150, city) + "%)", podata(104, city), podata(105, city)
		}
		if (page == 1) {
			display_topic lang("人口推移の詳細", "Population Detail"), wx + 65, wy + 50
			display_topic lang("収支の詳細", "Finance Detail"), wx + 65, wy + 200
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
		}
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 2) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 2
				}
			}
			key = ""
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					goto *label_1501
				}
				if (curmenu == 1) {
					goto *label_1505
				}
				if (curmenu == 2) {
					goto *label_1509
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1507
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1507
		}
	}
	if (key != "") {
		gosub *label_0623
		return
	}
	goto *label_1508
*label_1509
*label_1510
	listmax = 0
	page = 0
	pagesize = 13
	cs = 0
	cs_bk = -1
	curmenu = 2
	city = areaQuestTownId(gCurrentMap)
	list(0, listmax) = 1
	listn(0, listmax) = lang("この国の首都は" + mapname(gdata(815)) + "だ。", "The capital of this country is " + mapname(gdata(815)) + ".")
	listmax++
	if (mapType != 3) {
		goto *label_1511
	}
	list(0, listmax) = 0
	listn(0, listmax) = lang("この街の消費税は" + podata(150, city) + "%だ。", "The consumption tax in this city is " + podata(150, city) + "%.")
	listmax++
	p = rnd(1000)
	list(0, listmax) = 0
	listn(0, listmax) = lang("この街の井戸水の汚染は深刻だ(死者" + p + "人）。", "The well is polluted. (" + p + " people have died.)")
	listmax++
	list(0, listmax) = 0
	listn(0, listmax) = lang("この街では殺人が許される。", "Murder is allowed in this city.")
	listmax++
*label_1511
	redraw 0
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_politics.bmp", 1
	gsel 0
	fillbg 3, 960, 96, 128, 128
	gosub *label_0625
	gsel 7
	pos 0, 0
	picload_ exedir + "graphic\\ie_scroll.bmp"
	gsel 0
	windowshadow = 1
	snd 92
	drawmenu 3
	city = 1
	ww = 480
	wh = 400
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
*label_1512
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1513
	redraw 0
	s = strhint2 + strhint3b
	showscroll wx, wy, ww, wh
	display_topic lang("法律", "Law"), wx + 65, wy + 45
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	color 0, 0, 0
	pos wx + 185, wy + 52
	mes lang("国法", "Global")
	if (mapType == 3) {
		pos wx + 285, wy + 52
		mes lang("" + mapname(gCurrentMap) + "の法", "Law of " + mapname(gCurrentMap))
	}
	pos wx + 155, wy + 46
	gmode 2
	gcopy 3, 312, 360, 24, 24
	pos wx + 255, wy + 46
	gmode 2
	gcopy 3, 288, 360, 24, 24
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 74, wy + 76 + cnt * 19
			gfini 365, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 72, wy + 76 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		cs_list s, wx + 100, wy + 76 + cnt * 19 - 1, 19, 0, 0
		pos wx + 42, wy + 68 + cnt * 19 + 2
		gmode 2
		gcopy 3, 288 + list(0, p) * 24, 360, 24, 24
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 2) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 2
				}
			}
			key = ""
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					goto *label_1501
				}
				if (curmenu == 1) {
					goto *label_1505
				}
				if (curmenu == 2) {
					goto *label_1509
				}
			}
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1512
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1512
		}
	}
	if (key == key_cancel) {
		gosub *label_0623
		return
	}
	goto *label_1513
	area = bkdata2
	city = areaQuestTownId(area)
	tlocx = areaX(area)
	tlocy = areaY(area)
	tlocinitx = tlocx
	tlocinity = tlocy
	scposval = 1
	cityfov = 3
	citybuilding = 3
*label_1514
	redraw 0
	sxfix = 0
	syfix = 0
	gosub *label_0632
	val = cityfov
	gosub *label_0636
	gosub *label_0637
	gosub *label_0625
	dx = (tlocx - scx) * inf_tiles + inf_screenx
	dy = (tlocy - scy) * inf_tiles + inf_screeny
	if (dy + inf_tiles <= windowh - inf_verh) {
		pos dx, dy * (dy > 0)
		gfini inf_tiles - (dx + inf_tiles > windoww) * (dx + inf_tiles - windoww), inf_tiles + (dy < 0) * inf_screeny - (dy + inf_tiles > windowh - inf_verh) * (dy + inf_tiles - windowh + inf_verh)
		gfinc 50, 50, 100
	}
	txttargetnpc tlocx, tlocy, 1
	gosub *label_1522
	redraw 1
	key_direction
	if (stat == 1) {
		x = tlocx + kdx
		y = tlocy + kdy
		if (x >= 0 & y >= 0 & x < mapWidth & y < mapHeight) {
			tlocx += kdx
			tlocy += kdy
		}
	}
	await cfg_wait1
	key_check
	if (key == key_enter) {
		p = 0
		repeat 10
			if (bddata(0, city, cnt) != 0) {
				p++
			} else {
				cbd = cnt
				break
			}
		loop
		if (p >= citybuilding) {
			txtnew
			snd 27
			txt -1, lang("この街はこれ以上の施設を所有できない。", "The city can't hold any more building.")
			goto *label_1515
		}
		cell_featread tlocx, tlocy
		if (feat(0) != 0) {
			txtnew
			snd 27
			txt -1, lang("その場所には建てられない。", "You can't build here.")
			goto *label_1515
		}
		if (dist(tlocx, tlocy, tlocinitx, tlocinity) < cityfov) {
			gosub *label_1517
		} else {
			txtnew
			snd 27
			txt -1, lang("その場所は街から離れすぎている。", "This location is too far from the town.")
		}
		goto *label_1515
	}
	if (key == key_cancel) {
		goto *label_1516
	}
*label_1515
	goto *label_1514
*label_1516
	scposval = 0
	return
*label_1517
	snd 99
	listmax = 0
	page = 0
	pagesize = 4
	cs = 0
	cc = 0
	cs_bk = -1
	repeat 7
		if (cnt == 0) {
			continue
		}
		list(0, listmax) = cnt, 1
		listmax++
	loop
	gosub *label_1276
	windowshadow = 1
*label_1518
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	txtnew
	txt -1, lang("どの設備を建設する？", "What do you want to build?")
*label_1519
	redraw 0
	s = lang("設備一覧", "Building List"), strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		y = wy + 60 + cnt * 70
		pos wx + 100, y
		gfini 350, 18
		gfdec2 12, 14, 16
		display_key wx + 88, y, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		p = list(0, p)
		y = wy + 60 + cnt * 70
		pos wx + 20, y
		gmode 2
		gcopy 2, bdref(0, p) * inf_tiles, 528, inf_tiles, inf_tiles
		cs_list bdrefn(p), wx + 114, y, 19
		color 0, 0, 0
		pos wx + 360, y + 2
		mes "" + bdref(1, p) + "k gp"
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	gosub *label_1522
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		if (podata(200, city) < bdref(1, p)) {
			snd 27
			txtnew
			txt -1, lang("予算が足りない…", "Your city can't afford it...")
			goto *label_1520
		}
		podata(200, city) -= bdref(1, p)
		snd 58
		txtnew
		txt -1, lang(bdrefn(p) + "を建設した！", "You have built a " + bdrefn(p) + "!")
		bddata(0, city, cbd) = p, tlocx, tlocy, bdref(0, p) + 363
		gosub *label_0950
		return p
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1518
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1518
		}
	}
	if (key == key_cancel) {
		return -1
	}
*label_1520
	goto *label_1519
*label_1521
	tlocinitx = 0
	tlocinity = 0
	return
*label_1522
	x = windoww - 200
	y = 10
	window2 x, y, 190, 26
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	gmode 2
	pos x - 28, y + 2
	gcopy 3, 0, 392, 24, 24
	pos x + 12, y + 7 - en * 2
	mes lang("予算:", "Budget:") + " " + podata(200, city) + "k gp"
	return
*label_1523
	repeat length(racenamecsv)
		if (cdatan(2, r1) == racenamecsv(cnt, 1)) {
			cdata(158, r1) = raceid2(cnt)
			break
		}
	loop
	return
*label_1524
	dim racebit, 10, 78
	return
*label_1525
	if (dbmode == 1) {
		listmax = 0
		repeat length(racenamecsv)
			if (raceplayable(cnt)) {
				listn(1, listmax) = racenamecsv(cnt, 1)
				list(0, listmax) = 1 - raceplayable(cnt)
				listmax++
			}
		loop
		if (cfg_extrarace) {
			repeat length(racenamecsv)
				if (raceplayable(cnt) == 0) {
					listn(1, listmax) = racenamecsv(cnt, 1)
					list(0, listmax) = 1 - raceplayable(cnt)
					listmax++
				}
			loop
		}
		return
	}
	racename = "なし"
	rtval = 0
	repeat length(racenamecsv)
		if (dbidn == racenamecsv(cnt, 1)) {
			cnt2 = cnt
			if (dbmode == 16) {
				if (dbspec == 7) {
					rtval = raceblood(cnt2)
				}
				if (dbspec == 9) {
					rtval = racebreeder(cnt2)
				}
				break
			}
			if (dbmode == 2) {
				racename = racenamecsv(cnt2, 0)
				cpicref = racepic(cnt2)
				break
			}
			if (dbmode == 11) {
				buff = lang(racedescriptioncsv(cnt2, 0), racedescriptioncsv(cnt2, 1))
				ref1 = racepic(cnt2)
				if (racepic2(cnt2)) {
					ref2 = racepic2(cnt2)
				} else {
					ref2 = racepic(cnt2)
				}
				break
			}
			if (dbmode == 9) {
				rtval = raceplayable(cnt2)
				break
			}
			if (dbmode == 3) {
				cdatan(2, rc) = racenamecsv(cnt2, 1)
				cdata(158, rc) = raceid2(cnt2)
				cMeleeAttackType(rc) = racemeleestyle(cnt2)
				cSpecialAttackType(rc) = racecaststyle(cnt2)
				cBirthYear(rc) = gYear - (rnd(raceagernd(cnt2) + 1) + raceage(cnt2))
				cHeight(rc) = raceheight(cnt2)
				cbitmod 983, rc, raceblood(cnt2)
				if (rnd(100) < racesex(cnt2)) {
					cSex(rc) = 0
				} else {
					cSex(rc) = 1
				}
				if (mode == 1) {
					cSex(rc) = cmsex
				}
				cImage(rc) = racepic(cnt2)
				if (cSex(rc) == 1) {
					if (racepic2(cnt2)) {
						cImage(rc) = racepic2(cnt2)
					}
				}
				if (raceresist(cnt2) == 1) {
					sdata(53, rc) = 500
					sdata(58, rc) = 500
					sdata(56, rc) = 500
					sdata(50, rc) = 80
				}
				if (raceresist(cnt2) == 2) {
					sdata(60, rc) = 200
					sdata(53, rc) = 200
					sdata(58, rc) = 200
					sdata(56, rc) = 200
					sdata(54, rc) = 200
					sdata(57, rc) = 200
					sdata(59, rc) = 200
				}
				if (raceresist(cnt2) == 3) {
					sdata(60, rc) = 500
				}
				cDvCorrectionValue(rc) = racedv(cnt2)
				cPvCorrectionValue(rc) = racepv(cnt2)
				skillinit 2, rc, racehp(cnt2)
				skillinit 3, rc, racemp(cnt2)
				skillinit 10, rc, racestr(cnt2)
				skillinit 11, rc, raceend(cnt2)
				skillinit 12, rc, racedex(cnt2)
				skillinit 13, rc, raceper(cnt2)
				skillinit 14, rc, raceler(cnt2)
				skillinit 15, rc, racewil(cnt2)
				skillinit 16, rc, racemag(cnt2)
				skillinit 17, rc, racechr(cnt2)
				skillinit 18, rc, racespd(cnt2)
				repeat 30
					if (raceskillcsv(cnt2, cnt) == 0) {
						break
					}
					skillinit raceskillcsv(cnt2, cnt) / 10000, rc, raceskillcsv(cnt2, cnt) \ 10000
				loop
				s(1) = racefigurecsv(cnt2)
				gosub *label_0731
				break
			}
		}
	loop
	return rtval
*label_1526
	if (dbmode == 3) {
		if (norandomclass == 0) {
			if (fixlv < 6) {
				if (difficulty() > 5) {
					if (rnd(200) == 0) {
						guild = 0
						repeat length(classnamecsv)
							if (dbidn == classnamecsv(cnt, 1)) {
								guild = classguild(cnt)
								break
							}
						loop
						if (guild) {
							olistmax = 0
							repeat length(classnamecsv)
								if (classguild(cnt) != guild) {
									continue
								}
								if (dbidn == classnamecsv(cnt, 1)) {
									continue
								}
								listn(1, olistmax) = classnamecsv(cnt, 1)
								olistmax++
							loop
							if (olistmax) {
								dbidn = listn(1, rnd(olistmax))
							}
						}
					}
				}
			}
		} else {
			norandomclass = 0
		}
	}
	if (dbmode == 1) {
		listmax = 0
		repeat length(classnamecsv)
			if (classplayable(cnt)) {
				listn(1, listmax) = classnamecsv(cnt, 1)
				listmax++
			}
		loop
		return
	}
	classname = lang("なし", "unemployed")
	if (dbidn == "") {
		cequipment = 0
		return
	}
	rtval = 0
	if (dbmode == 11) {
		buff = ""
	}
	repeat length(classnamecsv)
		if (dbidn == classnamecsv(cnt, 1)) {
			cnt2 = cnt
			if (dbmode == 16) {
				if (dbspec == 4) {
					rtval = classequip(cnt2)
				}
				break
			}
			if (dbmode == 2) {
				classname = classnamecsv(cnt2, 0)
				break
			}
			if (dbmode == 11) {
				classname = classnamecsv(cnt2, 0)
				buff = lang(classdescriptioncsv(cnt2, 0), classdescriptioncsv(cnt2, 1))
				p(0) = classstr(cnt2)
				p(1) = classend(cnt2)
				p(2) = classdex(cnt2)
				p(3) = classper(cnt2)
				p(4) = classler(cnt2)
				p(5) = classwil(cnt2)
				p(6) = classmag(cnt2)
				p(7) = classchr(cnt2)
				p(8) = classspd(cnt2)
				break
			}
			if (dbmode == 9) {
				rtval = classplayable(cnt2)
				break
			}
			if (dbmode == 3) {
				cdatan(3, rc) = classnamecsv(cnt2, 1)
				cequipment = classequip(cnt2)
				skillinit 10, rc, classstr(cnt2)
				skillinit 11, rc, classend(cnt2)
				skillinit 12, rc, classdex(cnt2)
				skillinit 13, rc, classper(cnt2)
				skillinit 14, rc, classler(cnt2)
				skillinit 15, rc, classwil(cnt2)
				skillinit 16, rc, classmag(cnt2)
				skillinit 17, rc, classchr(cnt2)
				skillinit 18, rc, classspd(cnt2)
				repeat 30
					if (classskillcsv(cnt2, cnt) == 0) {
						break
					}
					skillinit classskillcsv(cnt2, cnt) / 10000, rc, classskillcsv(cnt2, cnt) \ 10000
				loop
				break
			}
		}
	loop
	return rtval
*label_1530
	if (gettrait(0, 184) < 0) {
		txt -1, lang("仲間はこれ以上増やせない。", "Your party is full.")
		return -1
	}
*label_1531
	f = get_freeally()
	if (f == 0) {
		txt -1, lang("仲間の最大数に達しているため、仲間にできなかった…", "Your party is already full. You can't invite someone anymore.")
		return -1
	}
	relocate_chara rc, f
	oc = stat
	cRelationship(rc) = 10
	cFame(rc) = 0
	cOriginalRelationship(rc) = 10
	cRole(rc) = 0
	if (ocdata(162, rc)) {
		cAiCalm(rc) = ocdata(162, rc)
	}
	cbitmod 970, rc, 0
	cbitmod 979, rc, 0
	cbitmod 985, rc, 0
	cbitmod 964, rc, 0
	cbitmod 991, rc, 0
	resetfaction rc
	rmfaction rc, "pet"
	addfaction rc, "pet,0"
	snd 64
	txtef 5
	txt -1, lang(cdatan(0, rc) + "が仲間に加わった！", cdatan(0, rc) + " join" + _s(rc) + " your party!")
	ctalk rc, 1377, 0, rc
	throwsstpevent "JoinParty", rc, "", 0
	return 1
*label_1532
	if (geneuse != "") {
		if (takeover(6) == 0) {
			repeat 15, 1
				cnt2 = cnt
				if (cbit(967, cnt2) == 1 | cdatan(0, cnt2) == "") {
					del_chara cnt2
					continue
				}
				if (cState(cnt2) == 1) {
					memcpy sdata(0, 15 + cnt2), sdata(0, cnt2), 600 * 4 * 2
					memcpy sdataEx(0, 15 + cnt2), sdataEx(0, cnt2), 600 * 4
					memcpy cState(15 + cnt2), cState(cnt2), 500 * 4
					memcpy ocdata(0, 15 + cnt2), ocdata(0, cnt2), 250 * 4
					if (cAiActSubFreq(15 + cnt2) == 101) {
						cAiActSubFreq(15 + cnt2) = 20
					}
					repeat 10
						cdatan(cnt, 15 + cnt2) = cdatan(cnt, cnt2)
					loop
					repeat 30, 100
						cdata(cnt, 15 + cnt2) = cdata(cnt, 15 + cnt2) / 10000 * 10000
					loop
					faction(15 + cnt2) = faction(cnt2)
					rmfaction 15 + cnt2, "pet"
					rmfaction 15 + cnt2, "align"
					addfaction 15 + cnt2, "align,neutral"
					addfaction 15 + cnt2, "formerpet"
					cbitmod 961, 15 + cnt2, 0
					cbitmod 966, 15 + cnt2, 0
					cbitmod 968, 15 + cnt2, 0
					cbitmod 975, 15 + cnt2, 0
					cRelationship(15 + cnt2) = 0
					cOriginalRelationship(15 + cnt2) = 0
					cdata(156, 15 + cnt2) = 100
					cState(15 + cnt2) = 3
					cdatan(1, 15 + cnt2) = random_title()
					cRole(15 + cnt2) = 13
					cFame(15 + cnt2) = limit(cLevel(15 + cnt2) * cLevel(15 + cnt2) * 30 + rndex(cLevel(15 + cnt2) * 1000 + 100) + rnd(500), 1, 1000000)
					cCurrentMap(15 + cnt2) = 4, 1
					cImpression(15 + cnt2) = limit(cImpression(cnt2) * 2 / 3, 50, 300)
					ocdata(30, 15 + cnt2) = limit(cImpression(15 + cnt2) / 100, 1, 3)
					cHireCount(15 + cnt2) = 0
					cBirthYear(15 + cnt2) -= genetemp(10) - gYear
					del_chara cnt2
				}
			loop
		}
	}
	repeat 40 - 1, 16
		if (cState(cnt) == 3) {
			continue
		}
		rc = cnt
		gosub *label_1533
	loop
	return
*label_1533
	flt 0, 4
	novoidlv = 1
	initlv = rnd(60 + difficulty()) + 1
	p = 75, 41, 160
	characreate rc, p(rnd(3)), -1, -1
	cRelationship(rc) = 0
	cOriginalRelationship(rc) = 0
	cdata(156, rc) = 100
	cState(rc) = 3
	cImage(rc) = rnd(33) * 2 + 1 + cSex(rc)
	cdatan(0, rc) = randomname()
	cdatan(1, rc) = random_title()
	cRole(rc) = 13
	p = rnd(450)
	if (areaId(p) == 0 | areaId(p) == 7 | areaType(p) == 7) {
		p = 4
	}
	if (rnd(4) == 0) {
		p = 5
	}
	if (rnd(4) == 0) {
		p = 11
	}
	if (rnd(6) == 0) {
		p = 12
	}
	cCurrentMap(rc) = p, 1
	cFame(rc) = limit(cLevel(rc) * cLevel(rc) * 30 + rndex(cLevel(rc) * 200 + 100) + rnd(500), 1, 1000000)
	return
*label_1534
	repeat 15, 1
		rc = cnt
		if (cPeriodOfContract(rc) != 0) {
			if (cPeriodOfContract(rc) < getgametime()) {
				if (cRole(rc) == 20001) {
					txt -1, lang(cdatan(0, rc) + "との契約期間が切れた。", "The period of contract with " + cdatan(0, rc) + " has been expired.")
					if (cState(rc) == 1) {
						map(cX(rc), cY(rc), 1) = 0
					}
					del_chara rc
					if (cfg_NC_contractarart == 1) {
						snd 200
					}
				}
			}
		}
		if (ocdata(104, rc) == 159) {
			if (cState(rc) != 9) {
				continue
			}
			if (rnd(60) == 0 | areaId(cCurrentMap(rc)) == 7) {
				repeat 10
					if (rnd(4) == 0) {
						p = rnd(500 - 450) + 450
					} else {
						p = rnd(300)
					}
					if (areaId(p) == 0 | p == 7 | areaType(p) == 7 | p == 9) {
						p = 4
					}
					if (cnt < 5) {
						if (areaType(p) != 3) {
							continue
						}
					}
					break
				loop
				cCurrentMap(rc) = p, 1
			}
		}
	loop
	repeat 40 - 1, 16
		rc = cnt
		cc = rc
		if (cPeriodOfContract(rc) != 0) {
			if (cPeriodOfContract(rc) < getgametime()) {
				cPeriodOfContract(rc) = 0
				cbitmod 969, rc, 0
				cRelationship(rc) = 0
				txt -1, lang(cdatan(0, rc) + "との契約期間が切れた。", "The period of contract with " + cdatan(0, rc) + " has been expired.")
				if (cfg_NC_contractarart == 1) {
					snd 200
				}
			}
		}
		if (cCurrentMap(rc) == gCurrentMap) {
			continue
		}
		if (cState(rc) == 5) {
			gosub *label_1533
			continue
		}
		if (cState(rc) == 4) {
			if (getgametime() >= cTimeToRevive(rc)) {
				f@00m = 0
				if (rnd(3) | ocdata(100, rc) == 20000 | eqfaction(rc, "formerpet")) {
					f@00m = 1
				} else {
					if (ocdata(30, rc)) {
						f@00m = 1
						ocdata(30, rc)--
					}
				}
				if (f@00m == 1) {
					addnews 3, rc
					cState(rc) = 3
					if (ocdata(100, rc) == 20000) {
						p = rnd(5) + 1
						repeat p
							r1 = rc
							r2 = 1
							gosub *label_0661
						loop
					}
				} else {
					addnews 5, rc
					del_chara rc
					gosub *label_1533
				}
				continue
			}
		}
		if (ocdata(190, rc) != 0) {
			if (rnd(100) == 0) {
				leaveparty ocdata, rc
			}
		} else {
			if (rnd(60) == 0) {
				repeat 1000
					p = rnd(39) + 16
					if (ocdata(190, p) == 0 | ocdata(190, p) == p) {
						if (cbit(969, p) == 0) {
							ocdata(190, rc) = p
							ocdata(190, p) = p
							cCurrentMap(rc) = cCurrentMap(p)
							break
						}
					}
				loop
			}
		}
		if (ocdata(190, rc) == 0 | ocdata(190, rc) == rc) {
			if (rnd(60) == 0) {
				repeat 10
					if (rnd(4) == 0) {
						p = rnd(500 - 450) + 450
					} else {
						p = rnd(300)
					}
					if (areaId(p) == 0) {
						continue cnt
					}
					if (p == 7 | areaType(p) == 7 | p == 9) {
						p = 4
					}
					if (cnt < 5) {
						if (areaType(p) != 3) {
							continue
						}
					}
					break
				loop
				if (ogdata(20) > 10) {
					if (rnd(50) == 0) {
						repeat 450 - 300, 300
							if (areaId(cnt) == 39) {
								p = cnt
								break
							}
						loop
					}
				}
				cCurrentMap(rc) = p, 1
				if (ocdata(190, rc) == rc) {
					repeat 40 - 1, 16
						if (ocdata(190, cnt) == rc) {
							cCurrentMap(cnt) = p, 1
						}
					loop
				}
			}
		}
		if (rnd(200) == 0) {
			if (areaType(cCurrentMap(rc)) != 3 & areaId(cCurrentMap(rc)) != 39) {
				gosub *label_1537
			}
		}
		if (rnd(20) == 0) {
			val = rndex(limit(cLevel(rc), 1, 1000) * limit(cLevel(rc), 1, 1000) / 40 + 5) - rndex(limit(cLevel(rc), 1, 1000) * limit(cLevel(rc), 1, 1000) / 50 + 5)
			incfame rc, val
			if (val > 0) {
				addplat rc, rndex(val)
			}
		}
		if (rnd(2000) == 0) {
			val = rndex(limit(cLevel(rc), 1, 1000) * limit(cLevel(rc), 1, 1000) / 20 + 10) + 10
			addplat rc, val / 2 + rndex(val / 2 + 1)
			incfame rc, val
			addnews 4, rc
			gosub *label_1537
		}
		if (cExperience(rc) >= cRequiredExperience(rc)) {
			r1 = rc
			r2 = 0
			gosub *label_0661
		}
	loop
	notesel newsbuff
	if (noteinfo(0) > 195) {
		repeat noteinfo(0) - 195
			notedel 0
		loop
	}
	return
*label_1535
	repeat 40 - 1, 16
		rc = cnt
		cc = rc
		if (cState(rc) != 3) {
			continue
		}
		if (rnd(20) == 0) {
			advfavoriteskill rc
			csskill = rtval(rnd(stat))
			if (sorg(csskill, rc) == 0) {
				skillgain rc, csskill
			}
			skillexp2 csskill, rc, limit(cLevel(rc), 1, 1000) * 50
			repeat 2
				csskill = rnd(400 - 100) + 100
				if (sorg(csskill, rc) == 0) {
					continue cnt
				}
				skillexp2 csskill, rc, limit(cLevel(rc), 1, 1000) * 20
			loop
		}
		if (rnd(20) == 0) {
			advfavoritestat rc
			csskill = stat
			modgrowth2 rc, csskill, 10
			repeat 2
				csskill = 10 + rnd(8)
				modgrowth2 rc, csskill, 2
			loop
		}
		if (rnd(200) < cPlatinumCoin(rc)) {
			advfavoriteskill rc
			csskill = rtval(rnd(stat))
			if (sorg(csskill, rc) == 0) {
				skillgain rc, csskill
			}
			if (sdata(600 + csskill, rc) \ 1000 < 400) {
				if (cPlatinumCoin(rc) >= calctraincost(cnt, rc)) {
					cPlatinumCoin(rc) -= calctraincost(csskill, rc)
					p(40) = 15 * (100 + calctraitgrowthrate(rc, csskill)) / 100
					modgrowth rc, csskill, limit(p(40) - sgrowth(csskill, rc) / 15, 2, p(40) - (csskill < 18) * 10)
				}
			}
			olistmax = 0
			repeat 400 - 100, 100
				if (sorg(cnt, rc) == 0) {
					continue
				}
				if (sdata(600 + cnt, rc) \ 1000 == 400) {
					continue
				}
				if (cPlatinumCoin(rc) < calctraincost(cnt, rc)) {
					continue
				}
				olist(olistmax) = cnt
				olistmax++
			loop
			if (olistmax > 0) {
				repeat 20
					csskill = olist(rnd(olistmax))
					if (cPlatinumCoin(rc) < calctraincost(csskill, rc)) {
						break
					}
					cPlatinumCoin(rc) -= calctraincost(csskill, rc)
					p(40) = 15 * (100 + calctraitgrowthrate(rc, csskill)) / 100
					modgrowth rc, csskill, limit(p(40) - sgrowth(csskill, rc) / 15, 2, p(40) - (csskill < 18) * 10)
				loop
			}
		}
		if (rnd(2000) < cPlatinumCoin(rc)) {
			olistmax = 0
			val = 0
			repeat 400 - 100, 100
				if (sdataref(0, cnt) == 0) {
					continue
				}
				if (sorg(cnt, rc) != 0) {
					val++
					continue
				}
				olist(olistmax) = cnt
				olistmax++
			loop
			if (olistmax > 0) {
				val = limitmin(val - length(mainskill), 0)
				if (cPlatinumCoin(rc) >= 15 + 3 * val) {
					csskill = olist(rnd(olistmax))
					cPlatinumCoin(rc) -= 15 + 3 * val
					skillgain rc, csskill
				}
			}
		}
		if (rnd(2000) == 0) {
			olistmax = 0
			repeat 224
				traitmode = 0
				tid = cnt
				if (tid == 96) {
					continue
				}
				r1 = rc
				gosub *label_0097
				if (stat == 1) {
					if (traitref == 0) {
						if (traitref(1) >= 0) {
							if (traitref(2) > gettrait(rc, tid)) {
								olist(0, olistmax) = cnt, cnt + 1
								olistmax++
							}
						}
					}
				}
			loop
			if (olistmax > 0) {
				tid = olist(0, rnd(olistmax))
				traitmode = 0
				r1 = rc
				gosub *label_0097
				addtrait rc, tid, 1
				r1 = rc
				gosub *chara_refresh
			}
		}
		if (rnd(2000) == 0) {
			skillmod 18, rc, 1000 * 3
		}
	loop
	return
*label_1536
	if (ocdata(107, rc) != 0 | rc == gMount) {
		return
	}
	a = refitem(iId(ci), 5, ci)
	if (a == 57000 | a == 52000 | a == 53000) {
		cItemWhichWillBeUsed(rc) = ci
	}
	return
*label_1537
	f = 0
	inv_getheader rc
	repeat 10
		ci = invhead + rnd(invrange)
		if (iNumber(ci) == 0) {
			f = 1
			break
		}
		if (iBodyPart(ci) != 0) {
			continue
		}
		if (iNumber(ci) != 0) {
			if (cItemWhichWillBeUsed(rc) == ci) {
				cItemWhichWillBeUsed(rc) = 0
			}
			iNumber(ci) = 0
			f = 1
			break
		}
	loop
	if (f == 0) {
		return 0
	}
	flt cLevel(rc), 4
	dbid = 0
	if (rnd(3) == 0) {
		flttypemajor = fsetwear(rnd(length(fsetwear)))
	} else {
		flttypemajor = fsetitem(rnd(length(fsetitem)))
	}
	if (flttypemajor == 10000 | flttypemajor == 24000) {
		if (ocdata(100, rc) == 20000) {
			if (flttypemajor == 10000) {
				if (rnd(2)) {
					if (finditemid("rapier")) {
						inititemid = stat
						dbid = 743
					}
				}
			}
		}
		if (rnd(50) == 0) {
			weaponjasei = 1
			fixlv = 5
		}
	}
	itemcreate rc, dbid, -1, -1, 0
	if (stat == 0) {
		return 0
	}
	iIdentificationState(ci) = 3
	if (iQuality(ci) >= 4) {
		if (refitem(iId(ci), 5, ci) < 50000) {
			valn = itemname(ci)
			addnews 1, rc
		}
	}
	gosub *label_1540
	return
*label_1538
	p = inv_getfreeid(tc)
	if (p != (-1)) {
		return p
	}
	repeat 100
		p = rnd(invrange) + invhead
		if (iBodyPart(p) == 0) {
			iNumber(p) = 0
			if (cItemWhichWillBeUsed(tc) == p) {
				cItemWhichWillBeUsed(tc) = 0
			}
			break
		}
	loop
	return p
*label_1539
	if (cfg_petequip == 1 & (rc > 0 & rc < 16)) {
		return
	}
	inv_getheader rc
	repeat invrange, invhead
		ci = cnt
		if (iNumber(cnt) == 0 | iBodyPart(cnt) != 0) {
			continue
		}
		gosub *label_1540
	loop
	return
*label_1540
	i = iequiploc(ci)
	if (i != 0) {
		if (i == 10) {
			calcweaponfix iId(ci), ci
			if (iSkill(ci) != 111 & iSkill(ci) != 108) {
				if (rangemap_pow(0) * 2 > rangemap_pow(1) + rangemap_pow(2)) {
					i = 5
				}
			}
		}
		r1 = rc
		eqdup = 0
		repeat 30, 100
			if (cdata(cnt, rc) / 10000 == i) {
				bodylist(eqdup) = cnt
				eqdup++
			}
		loop
		if (eqdup == 0) {
			return
		}
		repeat eqdup
			body = bodylist(cnt)
			i = cdata(body, rc) \ 10000
			if (i == 0) {
				gosub *label_1418
				break
			}
			i--
			f = 0
			if (iValue(ci) >= iValue(i)) {
				f = 1
			}
			if (eqdup > cnt + 1) {
				if (cdata(bodylist(cnt + 1), rc) \ 10000 == 0) {
					f = 0
				} else {
					if (iValue(i) >= iValue(cdata(bodylist(cnt + 1), rc) \ 10000 - 1)) {
						f = 0
					}
				}
			}
			if (f == 1) {
				cibk = ci
				gosub *label_1419
				ci = cibk
				gosub *label_1418
				break
			}
		loop
	}
	return
*label_1541
	haveweapon = 0
	repeat 100
		f = 0
		inv_getheader rc
		repeat 4
			ci = invhead + rnd(invrange)
			if (iNumber(ci) == 0) {
				f = 1
				break
			}
			if (iBodyPart(ci) != 0) {
				continue
			}
			if (ibit(12, ci)) {
				continue
			}
			if (iNumber(ci) != 0) {
				iNumber(ci) = 0
				f = 1
				break
			}
		loop
		if (f == 0) {
			ci = invhead + invrange - 1
		}
		if (cRole(rc) == 13) {
			flt cLevel(rc), 3
		} else {
			flt cLevel(rc), calcfixlv(2)
		}
		mustequip = 0
		repeat 30, 100
			p = cdata(cnt, rc) / 10000
			if (p == 0) {
				break
			}
			if (cdata(cnt, rc) \ 10000 != 0) {
				if (p == 5) {
					if (haveweapon == 0) {
						if (refitem(iId(cdata(cnt, rc) \ 10000 - 1), 5, cdata(cnt, rc) \ 10000 - 1) == 10000) {
							haveweapon = 1
						}
					}
				}
				continue
			}
			if (p == 5) {
				if (haveweapon == 0) {
					flttypemajor = 10000
					mustequip = 1
					break
				}
			}
			if (p == 1) {
				flttypemajor = 12000
				mustequip = 1
				break
			}
			if (p == 4) {
				flttypemajor = 16000
				mustequip = 1
				break
			}
			if (p == 10) {
				flttypeminor = 24001
				mustequip = 1
				break
			}
			if (p == 11) {
				flttypeminor = 25001
				mustequip = 1
				break
			}
		loop
		if (mustequip == 0) {
			break
		}
		dbid = 0
		if (flttypemajor == 10000) {
			if (ocdata(100, rc) == 20000) {
				if (rnd(2)) {
					if (finditemid("rapier")) {
						inititemid = stat
						dbid = 743
					}
				}
			}
		}
		itemcreate rc, dbid, -1, -1, 0
		if (stat == 0) {
			break
		}
		iIdentificationState(ci) = 3
		if (iQuality(ci) >= 4) {
			if (refitem(iId(ci), 5, ci) < 50000) {
				if (cRole(rc) == 13) {
					valn = itemname(ci)
					addnews 1, rc
				}
			}
		}
		gosub *label_1540
		if (cRole(rc) != 13) {
			if (rnd(3)) {
				break
			}
		}
	loop
	return
*label_1542
	repeat 188, 57
		if (cState(cnt) == 0) {
			continue
		}
		if (cRole(cnt) == 0) {
			continue
		}
		if (cQuality(cnt) == 6) {
			continue
		}
		if (cRole(cnt) == 3) {
			continue
		}
		i = -1
		repeat 500
			if (qdata(0, cnt) == 0) {
				i = cnt
				break
			}
		loop
		cnt2 = cnt
		repeat 500
			if (qdata(0, cnt) == cnt2) {
				if (qdata(1, cnt) == gCurrentMap) {
					i = -1
					break
				}
			}
		loop
		if (i == (-1)) {
			break
		}
		qdata(0, i) = cnt
		qdata(1, i) = gCurrentMap
		qname(i) = cdatan(0, cnt)
		cRelatedQuestId(cnt) = i + 1
		gNumberOfExistingQuests = i + 1
	loop
	return
*label_1543
	qdata(6, rq) = ((qdata(5, rq) + 3) * 100 + rnd(qdata(5, rq) * 30 + 200) + 400) * rewardfix / 100
	qdata(6, rq) = qdata(6, rq) * 100 / (100 + qdata(5, rq) * 2 / 3)
	if (qdata(14, rq) == 3 | qdata(14, rq) == 2) {
		return
	}
	if (qdata(3, rq) == 1001) {
		if (oqdata(0, rq)) {
			qdata(6, rq) = qdata(6, rq) * (100 + isetfamily(0, oqdata(0, rq))) / 100
		}
	} else {
		if (qdata(3, rq) == 1008 | qdata(3, rq) == 1010) {
			i = 0
			if (qdata(12, rq) != 343) {
				i = refchara(qdata(12, rq), 10)
			} else {
				if (qdata(13, rq) != usernpcmax) {
					i = userdata(2, qdata(13, rq))
				}
			}
			qdata(6, rq) = qdata(6, rq) * (100 + limit(i / 5 * 25, 0, 400)) / 100
		}
	}
	return

*label_1545
	qdata(3, rq) = 0
	qdata(14, rq) = 0
	qdata(8, rq) = 0
	qdata(2, rq) = (rnd(3) + 1) * 24 + getgametime()
	qdata(7, rq) = 0
	if (rnd(3) == 0) {
		return
	}
	if (rnd(14) == 0) {
		i = -1
		repeat 300
			n = rnd(245 - 57) + 57
			if (n == qdata(0, rq)) {
				continue
			}
			if (cState(n) != 1) {
				continue
			}
			if (cRelationship(n) != 0 | (cRole(n) != 4 & cRole(n) != 14)) {
				continue
			}
			flt 40, 2
			flttypemajor = fsetcollect(rnd(length(fsetcollect)))
			itemcreate n, 0, -1, -1, 0
			if (stat != 0) {
				iCount(ci) = rq
				i = n, iId(ci)
				ibitmod 12, ci, 1
				break
			} else {
				i = -1
				break
			}
		loop
		if (i != (-1)) {
			qdata(10, rq) = i
			qdata(11, rq) = i(1)
			qdata(1, rq) = gCurrentMap
			rewardfix = 60
			qdata(7, rq) = 5
			qdata(3, rq) = 1011
			qdata(14, rq) = 3
			qdata(4, rq) = 0
			qdata(9, rq) = rnd(3) + 2
			qdata(5, rq) = cLevel(i) / 3
		}
		return
	}
	if (cFame(0) >= 30000) {
		if (rnd(13) == 0) {
			qdata(5, rq) = rnd(difficulty() + 1)
			qdata(5, rq) = roundmargin(qdata(5, rq), cLevel(0))
			minlevel = limit(qdata(5, rq) / 7, 5, 30)
			if (rnd(30) == 0 | Seasonal_Check(0, 0)) {
				flt qdata(5, rq), 2
				characreate 56, 176, -3, 0
			} else {
				repeat 50
					flt qdata(5, rq), 2
					characreate 56, 0, -3, 0
					if (cmshade) {
						continue
					}
					if (cLevel(rc) < minlevel) {
						continue
					}
					break
				loop
			}
			qdata(12, rq) = cId(56)
			if (cId(56) == 343) {
				qdata(13, rq) = cCnpcId(56)
				qdata(15, rq) = createserialno(userdatan(0, cCnpcId(56)))
			}
			qdata(2, rq) = (rnd(6) + 2) * 24 + getgametime()
			qdata(7, rq) = 0
			qdata(3, rq) = 1010
			qdata(14, rq) = 1
			qdata(4, rq) = 0
			qdata(7, rq) = 5
			qdata(9, rq) = -1
			rewardfix = 140
			chara_vanquish 56
			return
		}
	}
	if (cFame(0) >= 50000) {
		if (rnd(20) == 0) {
			qdata(5, rq) = rnd(difficulty() + 1)
			qdata(5, rq) = roundmargin(qdata(5, rq), cLevel(0))
			minlevel = limit(qdata(5, rq) / 4, 5, 30)
			if (rnd(30) == 0 | Seasonal_Check(0, 0)) {
				flt qdata(5, rq), 2
				characreate 56, 176, -3, 0
			} else {
				repeat 50
					flt qdata(5, rq), 2
					characreate 56, 0, -3, 0
					if (cmshade) {
						continue
					}
					if (cLevel(rc) < minlevel) {
						continue
					}
					break
				loop
			}
			qdata(12, rq) = cId(56)
			if (cId(56) == 343) {
				qdata(13, rq) = cCnpcId(56)
				qdata(15, rq) = createserialno(userdatan(0, cCnpcId(56)))
			}
			qdata(2, rq) = (rnd(6) + 2) * 24 + getgametime()
			qdata(7, rq) = 0
			qdata(3, rq) = 1008
			qdata(14, rq) = 8
			qdata(4, rq) = 0
			qdata(7, rq) = 1
			qdata(9, rq) = -1
			rewardfix = 175
			chara_vanquish 56
			return
		}
	}
	if (rnd(11) == 0) {
		qdata(2, rq) = (rnd(6) + 2) * 24 + getgametime()
		qdata(3, rq) = 1007
		qdata(14, rq) = 6
		qdata(4, rq) = rnd(3)
		qdata(10, rq) = 0
		qdata(7, rq) = 5
		repeat
			qdata(12, rq) = asettown(rnd(length(asettown)))
			if (qdata(12, rq) != gCurrentMap) {
				break
			}
		loop
		p = qdata(1, qdata(12, rq))
		if (qdata(4, rq) == 0) {
			rewardfix = 140 + dist(areaX(gCurrentMap), areaY(gCurrentMap), areaX(p), areaY(p)) * 2
			qdata(9, rq) = rnd(8) + 6
			qdata(5, rq) = limit(rnd(difficulty() * 5 + 1) + 1, 1, 80)
		}
		if (qdata(4, rq) == 1) {
			rewardfix = 130 + dist(areaX(gCurrentMap), areaY(gCurrentMap), areaX(p), areaY(p)) * 2
			qdata(9, rq) = rnd(5) + 2
			qdata(5, rq) = limit(rewardfix / 10 + 1, 1, 40)
		}
		if (qdata(4, rq) == 2) {
			rewardfix = 80 + dist(areaX(gCurrentMap), areaY(gCurrentMap), areaX(p), areaY(p)) * 2
			qdata(9, rq) = rnd(8) + 6
			qdata(5, rq) = limit(rewardfix / 20 + 1, 1, 40)
		}
		if (qdata(12, rq) == 33 | gCurrentMap == 33) {
			rewardfix = rewardfix * 180 / 100
		}
		return
	}
	if (rnd(23 - (ogdata(485) == 2) * 10) == 0 | (gCurrentMap == 15 & rnd(8) == 0)) {
		qdata(5, rq) = limit(rnd(sdata(183, 0) + 10), int(1.5 * sqrt(sdata(183, 0))) + 1, cFame(0) / 1000 + 10)
		qdata(2, rq) = (rnd(6) + 2) * 24 + getgametime()
		qdata(7, rq) = 0
		qdata(3, rq) = 1009
		qdata(14, rq) = 7
		qdata(4, rq) = 0
		qdata(7, rq) = 0
		qdata(12, rq) = limit(qdata(5, rq) * 10 + rnd(50), 50, 6000)
		qdata(13, rq) = 0
		qdata(9, rq) = -1
		rewardfix = 0
		return
	}
	if (rnd(30) == 0 | (gCurrentMap == 12 & rnd(2) == 0)) {
		qdata(5, rq) = limit(rnd(difficulty() * 3 + 1) + 1, 1, 50)
		qdata(2, rq) = (rnd(6) + 2) * 24 + getgametime()
		qdata(3, rq) = 1006
		qdata(14, rq) = 5
		qdata(4, rq) = 0
		qdata(7, rq) = 5
		qdata(9, rq) = -1
		qdata(12, rq) = limit(15000 + qdata(5, rq) * 2500, 15000, 200000)
		qdata(13, rq) = 0
		rewardfix = 60 + qdata(5, rq) * 2
		return
	}
	if (rnd(8) == 0) {
		qdata(5, rq) = limit(rnd(difficulty() * 5 + 1) + 1, 1, 80)
		qdata(5, rq) = roundmargin(qdata(5, rq), cLevel(0))
		qdata(2, rq) = (rnd(6) + 2) * 24 + getgametime()
		qdata(7, rq) = 0
		qdata(3, rq) = 1001
		qdata(14, rq) = 1
		qdata(4, rq) = 0
		qdata(7, rq) = 1
		qdata(9, rq) = -1
		flt calcobjlv(qdata(5, rq) + 1), 1
		characreate 56, 0, -3, 0
		sdim factionref, 10, 3
		getfactionvalues rc, "family", factionref
		i = stat
		if (i) {
			s = factionref(rnd(i))
			repeat length2(csetfamily) - 1, 1
				if (csetfamily(0, cnt) == s) {
					oqdata(0, rq) = cnt
					break
				}
			loop
		}
		chara_vanquish 56
		rewardfix = 135
		return
	}
	if (rnd(6) == 0) {
		i = -1
		repeat gNumberOfExistingQuests
			p = rnd(gNumberOfExistingQuests)
			repeat gNumberOfExistingQuests
				if (qdata(3, cnt) == 1002) {
					if (qdata(10, cnt) == p) {
						p = -1
						break
					}
				}
			loop
			if (p == (-1)) {
				continue
			}
			if (qdata(0, p) != 0) {
				if (qdata(1, p) != gCurrentMap | 0) {
					i = p
					break
				}
			}
		loop
		if (i != (-1)) {
			p = qdata(1, i)
			rewardfix = 70 + dist(areaX(gCurrentMap), areaY(gCurrentMap), areaX(p), areaY(p)) * 2
			if (p == 33 | gCurrentMap == 33) {
				rewardfix = rewardfix * 175 / 100
			}
			qdata(10, rq) = i
			repeat
				flt
				dbmode = 1
				flttypemajor = fsetdeliver(rnd(length(fsetdeliver)))
				gosub *label_2426
				if (dbid == 743) {
					continue
				}
				break
			loop
			qdata(12, rq) = flttypemajor
			qdata(7, rq) = 5
			if (flttypemajor == 54000) {
				qdata(7, rq) = 2
			}
			if (flttypemajor == 77000) {
				qdata(7, rq) = 3
			}
			if (flttypemajor == 64000) {
				qdata(7, rq) = 77000
			}
			if (flttypemajor == 60000) {
				qdata(7, rq) = 60000
			}
			qdata(11, rq) = dbid
			qdata(3, rq) = 1002
			qdata(14, rq) = 2
			qdata(4, rq) = 0
			qdata(9, rq) = rnd(12) + 3
			qdata(5, rq) = limit(rewardfix / 20 + 1, 1, 25)
		}
		return
	}
	if (rnd(6) == 0) {
		qdata(3, rq) = 1003
		qdata(14, rq) = 3
		qdata(9, rq) = rnd(6) + 2
		qdata(7, rq) = 5
		qdata(12, rq) = rnd(9 - 1) + 1
		if (qdata(12, rq) == 4) {
			qdata(7, rq) = 52000
		}
		if (qdata(12, rq) == 6) {
			qdata(7, rq) = 25000
		}
		if (qdata(12, rq) == 1) {
			qdata(7, rq) = 25000
		}
		if (qdata(12, rq) == 5) {
			qdata(7, rq) = 52000
		}
		if (qdata(12, rq) == 7) {
			qdata(7, rq) = 77000
		}
		if (qdata(12, rq) == 2) {
			qdata(7, rq) = 56000
		}
		if (qdata(12, rq) == 3) {
			qdata(7, rq) = 53000
		}
		qdata(13, rq) = rnd(10 - 3) + 3
		qdata(5, rq) = qdata(13, rq) * 3
		rewardfix = 60 + qdata(5, rq)
		return
	}
	if (rnd(5) == 0) {
		qdata(3, rq) = 1004
		qdata(14, rq) = 3
		qdata(9, rq) = rnd(6) + 2
		repeat
			flt
			dbmode = 1
			flttypemajor = fsetsupply(rnd(length(fsetsupply)))
			gosub *label_2426
			if (dbid == 743) {
				continue
			}
			break
		loop
		qdata(7, rq) = 5
		qdata(11, rq) = dbid
		qdata(5, rq) = limit(rnd(difficulty() + 5) + 1, 1, 30)
		rewardfix = 65 + qdata(5, rq)
		return
	}
	return 1
*label_1546
	repeat gNumberOfExistingQuests
		if (qdata(3, cnt) == 0) {
			continue
		}
		if (qdata(8, cnt) != 1) {
			continue
		}
		if (qdata(9, cnt) < 0) {
			continue
		}
		rq = cnt
		qdata(9, rq)--
		if (qdata(9, rq) == 0) {
			val = qdata(3, rq)
			gosub *label_1549
		}
	loop
	return
*label_1547
	if (gExecutingImmediateQuestType == 1006) {
		inv_getheader 0
		repeat invrange, invhead
			if (iOwnState(cnt) == 4) {
				iNumber(cnt) = 0
			}
		loop
		gosub *refreshPCBurdenState
	}
	if (gdata(73) != 3) {
		if (gExecutingImmediateQuestType >= 1000) {
			rq = gExecutingImmediateQuest
		}
		if (gExecutingImmediateQuestType == 1007) {
			if (qdata(8, rq) == 0) {
				gExecutingImmediateQuestType = 0, 0, 0, 0
				return
			} else {
				txt -1, lang("あなたはクライアントを置き去りにした。", "You left your client.")
			}
		}
		if (gExecutingImmediateQuestType == 1009 & qdata(12, gExecutingImmediateQuest) <= qdata(13, gExecutingImmediateQuest)) {
			txt -1, lang("パーティーは終了した。", "The party is over.")
			calcpartyscore2
			txt -1, lang("最終得点は" + qdata(13, gExecutingImmediateQuest) + "ポイントだった！", "Your final score is " + qdata(13, gExecutingImmediateQuest) + " points!")
			gdata(73) = 3
			qdata(8, gExecutingImmediateQuest) = 3
			txtef 2
			txt -1, lang("パーティーは大盛況だった！", "People had a hell of a good time!")
			gosub *label_1073
			ogdata(33) = 0
		} elseif (gExecutingImmediateQuestType == 1006 & qdata(12, gExecutingImmediateQuest) < qdata(13, gExecutingImmediateQuest)) {
			gdata(73) = 3
			qdata(8, gExecutingImmediateQuest) = 3
			txtef 2
			txt -1, lang("無事に納入を終えた！", "You complete the task!")
			msg_halt
		} elseif (gExecutingImmediateQuestType == 1020 & qdata(12, gExecutingImmediateQuest) <= qdata(13, gExecutingImmediateQuest)) {
			txt -1, lang("もてなしは終了した。", "The hospitality was over.")
			txt -1, lang("あなたは" + qdata(13, gExecutingImmediateQuest) + "人の客を取った！", "You could have entertained " + qdata(13, gExecutingImmediateQuest) + " people!")
			gdata(73) = 3
			qdata(8, gExecutingImmediateQuest) = 3
			txtef 2
			txt -1, lang("無事に依頼を終えた！", "People had a hell of a good time!")
			msg_halt
		} else {
			val = gExecutingImmediateQuestType
			gosub *label_1549
			msg_halt
		}
	}
	gExecutingImmediateQuestType = 0, 0, 0, 0
	return
*label_1548
	rc = 0
	gosub *label_0740
	skillexp2 17, 0, -500
	skillexp2 15, 0, -500
	levelexitby = 4
	gCurrentDungeonLevel = 0
	goto *label_0939
*label_1549
	if (val == 1) {
		areaWinningStreakInArena(gPreviousMap2) = 0
		txt -1, lang("あなたは敗北した。", "You were defeated.")
		modrank 0, -100
	}
	if (val >= 1000) {
		txt -1, lang(qname(rq) + "から受けた依頼は失敗に終わった。", "You have failed the quest taken from " + qname(rq) + ".")
		if (qdata(3, rq) == 1002) {
			qdata(15, qdata(10, rq))--
			txtef 8
			txt -1, lang("あなたは重大な罪を犯した!", "You commit a serious crime!")
			modkarma 0, -20
		}
		if (qdata(3, rq) == 1007) {
			txtef 8
			txt -1, lang("あなたは護衛の任務を果たせなかった。", "You have failed to protect the client.")
			repeat 16
				if (cnt != 0) {
					if (cbit(963, cnt) == 1) {
						if (qdata(13, rq) == cId(cnt)) {
							tc = cnt
							cbitmod 963, cnt, 0
							if (cState(tc) == 1) {
								if (qdata(4, rq) == 0) {
									s = lang("「おい、暗殺者が私の後ろにいるぞ」", cnvtalk("Hey, the assassins are killing me."))
									p = -11
								}
								if (qdata(4, rq) == 1) {
									s = lang("「毒が、毒がー！」", cnvtalk("Poison! P-P-Poison in my vein!!"))
									p = -4
								}
								if (qdata(4, rq) == 2) {
									s = lang("「時間切れだ。こうなったら…」" + name(tc) + "は火をかぶった。", cnvtalk("I missed the deadline. I don't have a right to live anymore.") + " " + name(tc) + " pours a bottole of molotov cocktail over " + him(tc) + "self.")
									addmef cX(0), cY(0), 5, 24, rnd(15) + 25, efp, 0
									mapitem_fire cX(tc), cY(tc)
									p = -9
								}
								txtef 9
								txt -1, s
								dmghp tc, 999999, p
							}
							cState(tc) = 0
							break
						}
					}
				}
			loop
			modkarma 0, -10
		}
		if (qdata(3, rq) == 1009) {
			ogdata(33) = 0
		}
		qdata(3, rq) = 0
		qdata(8, rq) = 0
	}
	decfame 0, 40
	p = stat
	txtef 3
	txt -1, lang("名声値を" + p + "失った。", "You lose " + p + " fame.")
	return
*label_1550
	repeat 16
		if (followerin(cnt) == 0) {
			continue
		}
		if (cHp(cnt) < cMaxHp(cnt) / 2) {
			cHp(cnt) = cMaxHp(cnt) / 2
		}
		cSp(cnt) = cMaxSp(cnt)
		refreshspeed cnt
	loop
	snd 69
	if (gCurrentMap == 49) {
		txtef 2
		if (horseracewin(0) != 0) {
			txt -1, lang("1着:", "1st:") + cdatan(0, horseracewin(0)) + " "
		}
		if (horseracewin(1) > 0) {
			txtef 3
			txt -1, lang("2着:", "2nd:") + cdatan(0, horseracewin(1)) + " "
		}
		if (horseracewin(2) > 0) {
			txtef 4
			txt -1, lang("3着:", "3rd:") + cdatan(0, horseracewin(2)) + " "
		}
		if (petarenawin == 1) {
			txtef 2
			txt -1, lang("あなたのチームは勝利した！", "Your team is victorious!")
			if (nc_horse_002 != 2 & nc_horse_002 != 3) {
				txtef 2
				txt -1, lang("" + gdata(74) + "の名声値を手に入れた。", "You gain " + gdata(74) + " fame.")
				incfame 0, gdata(74)
				modrank 9, 100, 2
				areaWinningStreakInPetArena(gPreviousMap2)++
				if (areaWinningStreakInPetArena(gPreviousMap2) \ 20 == 0) {
					matgetmain 52, 1
				} else {
					if (areaWinningStreakInPetArena(gPreviousMap2) \ 5 == 0) {
						matgetmain 51, 1
					}
				}
			}
			if (nc_horse_002 == 2) {
				music = 74
				musicloop = 1
				gosub *label_0122
				repeat 16
					if (followerin(cnt) == 0) {
						continue
					}
					nc_intb_002 = cnt
					nc_intb_003 = 0
					repeat 26
						if (horse_getskill(nc_intb_002, cnt) > 0) {
							nc_intb_003++
						}
					loop
					if (nc_intb_003 >= 3) {
						txtef 2
						txt -1, lang("あなたの馬はこれ以上新しいスキルを習得できない。", "No more new skills to learn.")
						break
					}
					repeat
						nc_intb_001 = rnd(12)
						if (horse_getskill(nc_intb_002, nc_intb_001) > 0) {
							continue
						}
						addfaction nc_intb_002, "horskill" + nc_intb_001 + "," + 1
						break
					loop
					txtef 2
					txt -1, lang("あなたの馬は新しいスキルを習得した！", "Your horse has learned a new skill!")
					break
				loop
			} else {
				if (nc_horse_002 == 3) {
					music = 74
					musicloop = 1
					gosub *label_0122
					repeat 16
						if (followerin(cnt) == 0) {
							continue
						}
						nc_intb_002 = cnt
						nc_intb_003 = 0
						repeat 26
							if (horse_getskill(nc_intb_002, cnt) > 0) {
								nc_intb_003++
							}
						loop
						if (nc_intb_003 >= 3) {
							txtef 2
							txt -1, lang("あなたの馬はこれ以上新しいスキルを習得できない。", "No more new skills to learn.")
							break
						}
						repeat
							nc_intb_001 = rnd(27)
							if (nc_intb_001 > 11 & nc_intb_001 < 21) {
								continue
							}
							if (nc_intb_001 >= 21 & rnd(2)) {
								continue
							}
							if (horse_getskill(nc_intb_002, nc_intb_001) > 0) {
								continue
							}
							addfaction nc_intb_002, "horskill" + nc_intb_001 + "," + (rnd(3) + 3)
							break
						loop
						txtef 2
						txt -1, lang("あなたの馬は新しいスキルを習得した！", "Your horse has learned a new skill!")
						break
					loop
				} else {
					if (rnd(10) == 0) {
						music = 74
						musicloop = 1
						gosub *label_0122
						repeat 16
							if (followerin(cnt) == 0) {
								continue
							}
							nc_intb_002 = cnt
							nc_intb_003 = 0
							repeat 26
								if (horse_getskill(nc_intb_002, cnt) > 0) {
								  nc_intb_003++
								}
							loop
							if (nc_intb_003 >= 3) {
								txtef 2
								txt -1, lang("あなたの馬はこれ以上新しいスキルを習得できない。", "No more new skills to learn.")
								break
							}
							repeat
								nc_intb_001 = rnd(27)
								if (nc_intb_001 > 11 & nc_intb_001 < 21) {
									continue
								}
								if (nc_intb_001 >= 21 & rnd(2)) {
									continue
								}
								if (horse_getskill(nc_intb_002, nc_intb_001) > 0) {
									continue
								}
								nc_intb_003 = rnd(limitmax((100 - gdata(129) / 100) / 25, 2) + 1) + 1
								addfaction nc_intb_002, "horskill" + nc_intb_001 + "," + nc_intb_003
								break
							loop
							txtef 2
							txt -1, lang("あなたの馬は新しいスキルを習得した！", "Your horse has learned a new skill!")
							break
						loop
					}
				}
			}
		} else {
			txtef 8
			txt -1, lang("あなたのチームは敗北した。", "Your team is defeated.")
			if (nc_horse_002 != 2 & nc_horse_002 != 3) {
				areaWinningStreakInPetArena(gPreviousMap2) = 0
				modrank 9, -100
				decfame 0, 60
				p = stat
				txtef 3
				txt -1, lang("名声値を" + p + "失った。", "You lose " + p + " fame.")
			}
		}
		return
	}
	if (petarenawin == 1) {
		txtef 2
		txt -1, lang("あなたのチームは勝利した！", "Your team is victorious!")
		txtef 2
		txt -1, lang("" + gdata(74) + "の名声値を手に入れた。", "You gain " + gdata(74) + " fame.")
		if (arenaimport == 1) {
			gdata(802)++
			if (enemylv > gExArenaLevel) {
				txt -1, lang("EXバトルの撃破相手LVの記録を更新した(Lv" + gExArenaLevel + " → " + enemylv + " )", "You've made a new record. (Lv" + gExArenaLevel + " to " + enemylv + " )")
				gExArenaLevel = enemylv
			}
		} else {
			incfame 0, gdata(74)
			modrank 1, 100, 2
		}
		areaWinningStreakInPetArena(gPreviousMap2)++
		if (areaWinningStreakInPetArena(gPreviousMap2) \ 20 == 0) {
			matgetmain 52, 1
		} else {
			if (areaWinningStreakInPetArena(gPreviousMap2) \ 5 == 0) {
				matgetmain 51, 1
			}
		}
	} else {
		txtef 8
		txt -1, lang("あなたのチームは敗北した。", "Your team is defeated.")
		areaWinningStreakInPetArena(gPreviousMap2) = 0
		modrank 1, -100
		decfame 0, 60
		p = stat
		if (arenaop == 0) {
			txtef 3
			txt -1, lang("名声値を" + p + "失った。", "You lose " + p + " fame.")
		}
	}
	return
*label_1551
	music = 74
	musicloop = 1
	gosub *label_0122
	gdata(73) = 3
	if (gExecutingImmediateQuestType == 1) {
		snd 69
		txtef 2
		txt -1, lang("あなたは勝利した！", "You are victorious!")
		txtef 2
		txt -1, lang("" + gdata(74) + "の名声値を手に入れた。", "You gain " + gdata(74) + " fame.")
		modrank 0, 100, 2
		incfame 0, gdata(74)
		ncgdata(4) += 1
		if (ogdata(513) == 0) {
			if (ncgdata(4) >= 1000) {
				f = 1
				ogdata(513) = 1
			}
		}
		if (f == 1) {
			snd 44
			txtef 2
			txt -1, lang("新しい称号を獲得した！", "Earned a new title!")
		}
		txt -1, lang("外への階段が現れた。", "Stairs appear.")
		map_placeupstairs mapWidth / 2, mapHeight / 2
		areaWinningStreakInArena(gPreviousMap2)++
		if (areaWinningStreakInArena(gPreviousMap2) \ 20 == 0) {
			matgetmain 52, 1
		} else {
			if (areaWinningStreakInArena(gPreviousMap2) \ 5 == 0) {
				matgetmain 51, 1
			}
		}
		rc = 0
		repeat 188, 57
			if (cRole(cnt) == 20000 | ocdata(100, cnt) == 20000) {
				rc = cnt
				break
			}
		loop
		if (rc) {
			if (ogdata(27) == (-1)) {
				cbitmod 976, rc, 0
			} else {
				txt -1, lang(cdatan(0, rc) + "は修行の旅に出るつもりだ。　見送る？ ", cdatan(0, rc) + " is about to undergo a journey to train. See her off?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval == 0) {
					txt -1, lang(cdatan(0, rc) + "は旅に出た！", cdatan(0, rc) + " departs on her journey!")
					repeat 50
						tc = rnd(39) + 16
						if (ocdata(30, tc)) {
							if (rnd(cImpression(tc) / 100 + 1) == 0) {
								ocdata(30, tc)--
							}
							continue
						} else {
							if (eqfaction(tc, "formerpet")) {
								continue
							}
							break
						}
						if (cnt == 49) {
							tc = rnd(39) + 16
						}
					loop
					addnews 5, tc
					del_chara tc
					cbitmod 966, rc, 0
					cbitmod 968, rc, 0
					relocate_chara rc, tc
					cRelationship(rc) = 0
					cOriginalRelationship(rc) = 0
					cdata(156, rc) = 100
					cState(rc) = 4
					cTimeToRevive(rc) = getgametime() + 24 + rnd(24 / 2)
					if (jp) {
						cdatan(1, rc) = strmid(cdatan(0, rc), 0, instr(cdatan(0, rc), 0, "『"))
						cdatan(0, rc) = strmid(cdatan(0, rc), instr(cdatan(0, rc), 0, "『"), instr(cdatan(0, rc), 0, "』"))
					} else {
						cdatan(1, rc) = strmid(cdatan(0, rc), instr(cdatan(0, rc), 0, "> the ") + 6, 40)
					}
					cRole(rc) = 13
					ocdata(100, rc) = 20000
					cFame(rc) = limit(cLevel(rc) * cLevel(rc) * 30 + rndex(cLevel(rc) * 200 + 100) + rnd(500), 1, 1000000)
					map(cX(rc), cY(rc), 1) = 0
					ogdata(27) = -1
				}
			}
		}
	}
	if (gExecutingImmediateQuestType == 1001 | gExecutingImmediateQuestType == 1010 | gExecutingImmediateQuestType == 1021) {
		qdata(8, gExecutingImmediateQuest) = 3
		txtef 2
		txt -1, lang("エリアを制圧した！", "The area is secured!")
	}
	if (gExecutingImmediateQuestType == 1007) {
		txtef 2
		txt -1, lang("エリアを制圧した！", "The area is secured!")
	}
	if (gExecutingImmediateQuestType == 1008) {
		gLeftMinutesOfExecutingQuest = 0
		qdata(8, gExecutingImmediateQuest) = 3
		txtef 2
		txt -1, lang("討伐に成功した！", "You successfully slay the target.")
	}
	return
*label_1552
	snd 51
	p = qdata(6, rq)
	if (qdata(3, rq) == 1006) {
		if (qdata(12, rq) != 0) {
			if (qdata(12, rq) * 125 / 100 < qdata(13, rq)) {
				p = limit(p * qdata(13, rq) / qdata(12, rq), p, p * 3)
				if (ogdata(532) == 2) {
					p *= 2
				}
			}
		}
	}
	if (qdata(3, rq) == 1021) {
		if (qdata(13, rq) == 0) {
			p = int(p * (qdata(12, rq) * 0.5 + 1.0))
			if (ogdata(532) == 2) {
				p *= 2
			}
		}
	}
	nc_intb_001 = 0
	if (p != 0) {
		nc_intb_001 = p
		flt
		itemcreate -1, 54, cX(0), cY(0), p
	}
	if (qdata(3, rq) == 1002) {
		p = rnd(2) + 1 + (nc_intb_001 / 7500)
	} else {
		p = 1 + (nc_intb_001 / 7500)
	}
	if (qdata(3, rq) == 1008 | qdata(3, rq) == 1010) {
		p = 2 + (rnd(100) < rnd(cFame(0) / 5000 + 1)) + (nc_intb_001 / 7500)
	}
	flt
	itemcreate -1, 55, cX(0), cY(0), p
	if (qdata(3, rq) == 1009) {
		if (qdata(12, rq) * 150 / 100 < qdata(13, rq)) {
			flt
			itemcreate -1, 724, cX(0), cY(0), 1 + qdata(13, rq) / 10
		}
	}
	if (qdata(3, rq) == 1020) {
		eggench = 10010, 10011, 10012, 10013, 10014, 10015, 10016, 10017
		flt
		if (qdata(12, rq) + 2 < qdata(13, rq)) {
			itemcreate -1, 573, cX(0), cY(0), (qdata(13, rq) - qdata(12, rq)) / 2 + 1
			iCurseState(ci) = 0
			iSubname(ci) = 250
			ibitmod 5, ci, 1
			iEnchantmentId(ci, 0) = eggench(rnd(length(eggench)))
			iEnchantmentPower(ci, 0) = 500
			iEnchantmentId(ci, 1) = iEnchantmentId(ci, 0) + 50000
			iEnchantmentPower(ci, 1) = 450
			iParam4(ci) = 0
			ibitmod 8, ci, 0
		} else {
			itemcreate -1, 573, cX(0), cY(0), 1
			iCurseState(ci) = 0
			iSubname(ci) = 250
			ibitmod 5, ci, 1
			iEnchantmentId(ci, 0) = eggench(rnd(length(eggench)))
			iEnchantmentPower(ci, 0) = 500
			iEnchantmentId(ci, 1) = iEnchantmentId(ci, 0) + 50000
			iEnchantmentPower(ci, 1) = 450
			iParam4(ci) = 0
			ibitmod 8, ci, 0
		}
	}
	if (qdata(7, rq) != 0) {
		p = rnd(rnd(4) + 1) + 1
		if (qdata(3, rq) == 1008 | qdata(3, rq) == 1010 | qdata(3, rq) == 1021) {
			p += 2
		}
		repeat p
			fixlv = 2
			if (rnd(2)) {
				fixlv = 3
				if (rnd(12) == 0) {
					fixlv = 4
				}
			}
			flt qdata(5, rq) / 2 + 1, calcfixlv(fixlv)
			if (qdata(7, rq) < 10000) {
				if (qdata(7, rq) == 1) {
					flttypemajor = fsetwear(rnd(length(fsetwear)))
				}
				if (qdata(7, rq) == 2) {
					flttypemajor = fsetmagic(rnd(length(fsetmagic)))
				}
				if (qdata(7, rq) == 3) {
					flttypemajor = fsetarmor(rnd(length(fsetarmor)))
				}
				if (qdata(7, rq) == 4) {
					flttypemajor = fsetweapon(rnd(length(fsetweapon)))
				}
				if (qdata(7, rq) == 5) {
					flttypemajor = fsetrewardsupply(rnd(length(fsetrewardsupply)))
				}
			} else {
				flttypemajor = qdata(7, rq)
			}
			itemcreate -1, 0, cX(0), cY(0), 0
		loop
	}
	modkarma 0, 1
	ncgdata(70)++
	gdata(74) = calcfame(0, qdata(5, rq) * 3 + 10)
	txtef 2
	txt -1, lang(qname(rq) + "から受けた依頼を完了した。", "You have completed the quest taken from " + qname(rq) + ".")
	txtef 2
	txt -1, lang("" + gdata(74) + "の名声値を手に入れた。", "You gain " + gdata(74) + " fame.")
	incfame 0, gdata(74)
	txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
	if (qdata(3, rq) == 1002) {
		qdata(15, qdata(10, rq))--
	}
	qdata(3, rq) = 0
	qdata(8, rq) = 0
	autosave = 1 * (gCurrentMap != 35)
	if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
		autosave = 0
	}
	return
*label_1553
	oomSEST_log "Scene:Init"
	if (gPlayedScene < sceneid) {
		gPlayedScene = sceneid
	}
	if (cfg_story == 0) {
		return
	}
	scene_cut = 0
	msgtempprev = msgtemp
	scenemode = 1
	sdim actor, 20, 3, 10
	file = "void"
	y1 = 60
	y2 = windowh - 60
	notesel buff
	noteload lang("scene1.hsp", "scene2.hsp")
	s = "{" + sceneid + "}"
	scidx = instr(buff, 0, s)
	if (scidx == (-1)) {
		goto *label_1558
	}
	scidx += strlen(s)
*label_1554
	oomSEST_log "Scene:Loop"
	await
	stick a, 128
	if (a == 128) {
		scene_cut = 1
	}
	if (scene_cut == 1) {
		goto *label_1558
	}
	notesel buff
	noteload lang("scene1.hsp", "scene2.hsp")
	cs = 0
	key_list = key_enter
	scidxtop = scidx
	scidxtop = 0
	val = 0
*label_1555
	p(1) = instr(buff, scidx, "{") + scidx
	if (p(1) == (-1)) {
		goto *label_1558
	}
	p(2) = instr(buff, scidx, "}") + scidx + 1
	if (p(2) == (-1)) {
		goto *label_1558
	}
	if (scidxtop != 0) {
		scidx = p(1)
		goto *label_1557
	}
	s = strmid(buff, p(1), p(2) - p(1))
	scidx = p(2) + 1
	if (s == "{txt}") {
		scidxtop = scidx
		val = 0
		goto *label_1556
	}
	if (instr(s, 0, "{chat_") != (-1)) {
		rc = int(strmid(s, 6, 1))
		scidxtop = scidx
		val = 1
		goto *label_1556
	}
	if (s == "{fade}") {
		gsel 4
		color 0, 0, 0
		boxf
		gsel 0
		gosub *label_0648
		goto *label_1556
	}
	if (s == "{fadein}") {
		repeat 25
			redraw 1
			pos 0, 0
			gmode 4, , , cnt * 15
			pos 0, 0
			gcopy 4, 0, 0, windoww, windowh
			gmode 2
			await 10
		loop
		goto *label_1556
	}
	if (s == "{wait}") {
		scidxtop = scidx
		val = 2
		goto *label_1556
	}
	if (s == "{end}") {
		await 1000
		goto *label_1558
	}
	p(3) = instr(buff, scidx, "\"") + scidx + 1
	p(4) = instr(buff, p(3), "\"") + p(3)
	s(1) = strmid(buff, p(3), p(4) - p(3))
	scidx = p(4) + 1
	if (s == "{pic}") {
		file = s(1)
		goto *label_1556
	}
	if (s == "{mc}") {
		music = -1
		if (s(1) == "mcUnrest2") {
			music = 84
		}
		if (s(1) == "mcTown1") {
			music = 51
		}
		if (s(1) == "mcMemory") {
			music = 89
		}
		if (s(1) == "mcIntro") {
			music = 90
		}
		if (music == (-1)) {
			musicfile(91) = s(1)
			music = 91
			gosub *label_0122
		} else {
			gosub *label_0122
		}
		goto *label_1556
	}
	if (s == "{se}") {
		folder = exedir + "sound\\"
		sndload folder + s(1), 28
		snd 28
		goto *label_1556
	}
	if (instr(s, 0, "{actor_") != (-1)) {
		rc = int(strmid(s, 7, 1))
		csvsort s, s(1), 44
		actor(0, rc) = s, s(1), s(2)
	}
*label_1556
	goto *label_1555
*label_1557
	buff = strmid(buff, scidxtop, scidx - scidxtop)
	p = noteinfo(0)
	repeat noteinfo(0)
		noteget s, p - cnt - 1
		if (s == "") {
			notedel p - cnt - 1
		}
	loop
	redraw 0
	gsel 4
	gmode 0
	pos 0, 0
	picload_ exedir + "\\graphic\\" + file + ".bmp", 1
	pos 0, y1
	gzoom windoww, y2 - y1, 4, 0, 0, 640, 480
	gmode 2
	color 5, 5, 5
	boxf 0, 0, windoww, y1
	boxf 0, y2, windoww, windowh
	if (val == 1) {
		gsel 0
		redraw 0
		gmode 0
		pos 0, 0
		gcopy 4, 0, 0, windoww, windowh
		gmode 2
		tc = 0
		gosub *label_1467
		goto *label_1554
	}
	if (val == 2) {
		gsel 0
		redraw 0
		gmode 0
		pos 0, 0
		gcopy 4, 0, 0, windoww, windowh
		gmode 2
		redraw 1
		await 1000
		goto *label_1554
	}
	font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
	x = 44
	repeat noteinfo(0)
		y = y1 + 31 + (9 - noteinfo(0) / 2 + cnt) * 20
		noteget s, cnt
		x = windoww / 2 - strlen(s) * 4
		dx = 80 + strlen(s) * 8
		if (dx < 180) {
			dx = 0
		}
		pos windoww / 2, y + 4
		gmode 6, 344, 72, 70
		grotate 3, 456, 144, 0, dx, 72
		color 20, 20, 20
	loop
	x = 40
	repeat noteinfo(0)
		y = y1 + 28 + (9 - noteinfo(0) / 2 + cnt) * 20
		noteget s, cnt
		x = windoww / 2 - strlen(s) * 4
		color 10, 10, 10
		pos x, y
		bmes s, 240, 240, 240
	loop
	gsel 0
	color 500, 500, 500
	repeat 15, 1
		redraw 0
		await 30
		stick a, 128
		if (a == 128) {
			scene_cut = 1
		}
		gmode 4, , , cnt * 16
		pos 0, 0
		gcopy 4, 0, 0, windoww, windowh
		redraw 1
	loop
	gmode 2
	redraw 0
	gmode 0
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gmode 2
	redraw 0
	x@txtfunc = windoww - 120
	y@txtfunc = windowh - 60
	anime_halt
	redraw 0
	color 5, 5, 5
	boxf 0, 0, windoww, y1
	boxf 0, y2, windoww, windowh
	goto *label_1554
*label_1558
	oomSEST_log "Scene:Exit"
	gsel 4
	color 0, 0, 0
	boxf
	gsel 0
	gosub *label_0648
	scenemode = 0
	msgtemp = msgtempprev
	msgtempprev = ""
	return



#deffunc ai_check
	repeat 3
		if (dir == 2) {
			cNextX(cc) = cX(cc) + 1
			cNextY(cc) = dirchk(cnt, p) + cY(cc)
		}
		if (dir == 1) {
			cNextX(cc) = cX(cc) - 1
			cNextY(cc) = dirchk(cnt, p) + cY(cc)
		}
		if (dir == 3) {
			cNextY(cc) = cY(cc) - 1
			cNextX(cc) = dirchk(cnt, p) + cX(cc)
		}
		if (dir == 0) {
			cNextY(cc) = cY(cc) + 1
			cNextX(cc) = dirchk(cnt, p) + cX(cc)
		}
		cell_check cNextX(cc), cNextY(cc)
		if (cellaccess == 1) {
			break
		}
		if (cellchara != (-1)) {
			if (relationbetween(cc, cellchara) == (-3)) {
				lockson cc, cellchara, 3
			} else {
				blockedbychara = 1
			}
		}
		if (cellfeat != (-1)) {
			if (cellfeat == 21) {
				cellaccess = 1
				break
			}
		}
	loop
	locksorder cc
	if (cellaccess == 1) {
		return 1
	}
	return 0
*label_1560
	if (cbit(985, cc)) {
		if (synccheck(cc, -1)) {
			if (rnd(30) == 0) {
				tc = cc
				ctalk cc, 993, cc, cc
				if (stat == 0) {
					txt cc, lang("「もっとぶって" + _yo(2) + "」", cnvtalk("Release me now.")), lang("「こんなことして、許さない" + _yo() + "」", cnvtalk("I won't forget this.")), lang("「何をする" + _nda(2) + "」", cnvtalk("Hit me!"))
				}
			}
		}
		cHate(cc) = 0
		goto *label_1617
	}
	if (synccheck(cc, -1) == 0) {
		if (cBlind(0) == 0) {
			if (rnd(4) == 0) {
				if (mapType != 1) {
					if (cbit(968, cc)) {
						if (gCurrentMap != 40 & (ocdata(80, cc) == 0 | (ocdata(80, cc) != 0 & cfg_petlead == 0))) {
							if (petcheck(cc)) {
								cHate(cc) = 0
								unlockson cc
							} else {
								if (rnd(2)) {
									ctalk cc, 1272, cc, 0
									if ( stat == 0 ) {
										txt cc, lang("「痛っ！」", cnvtalk("Ouch!")), lang("「やめて！」", cnvtalk("Stop it!"))
									}
									hostileaction 0, cc
								}
								if (rnd(4) == 0) {
									cbitmod 968, cc, 0
									txtef 9
									txt -1, lang(name(cc) + "は巻きついていた紐をほどいた。", name(cc) + " untangle" + _s(cc) + " the leash.")
									ctalk cc, 1273, cc, 0
								}
							}
							tc = 0
							efid = 619
							nc_himo = 1
							gosub *label_1398
							goto *label_1617
						}
					}
				}
			}
		}
	}
	if (cbit(972, cc)) {
		tlocx = cX(cc)
		tlocy = cY(cc)
		efid = 644
		gosub *label_1398
		goto *label_1617
	}
	repeat ocdata(161, cc)
		if (cState(ocdata(156, cc) - 1) != 1) {
			unwatchon cc, ocdata(156, cc) - 1
		}
	loop
	repeat ocdata(155, cc)
		if (cState(ocdata(150, cc) - 1) != 1) {
			unlockon cc, ocdata(150, cc) - 1
		}
	loop
	if (ocdata(155, cc) == 0 & ocdata(161, cc) == 0) {
		cHate(cc) = 0
	}
	if (areaType(gCurrentMap) != 1) {
		if (oabit(15, gCurrentMap) == 0 & oabit(18, gCurrentMap) == 0) {
			if (cRelationship(cc) >= 10) {
				cHate(cc)--
				if (cHate(cc) <= 0) {
					if (ocdata(0, cc) == 1 | ocdata(0, cc) == 2 | ocdata(0, cc) == 3) {
						if (cTurn(cc) \ 10 == 0) {
							if (ocdata(0, cc) == 1) {
								searchfov = 15
								searchdist = 7
							} else {
								if (ocdata(0, cc) == 2 | ocdata(0, cc) == 3) {
									searchfov = 7
									searchdist = 3
								}
							}
							if (ocdata(0, cc) == 1 | ocdata(0, cc) == 2) {
								ypoint = cY(cc)
								xpoint = cX(cc)
							} else {
								ypoint = cY(0)
								xpoint = cX(0)
							}
							gosub *label_1836
							if (ecount != 0) {
								if (cbit(979, cc) == 0) {
									unwatcheson cc
									repeat ecount
										watcheson cc, searchene(cnt)
										if (stat == 0) {
											break
										}
									loop
									watchesorder cc
									cHate(cc) = 30
								}
							}
							gosub *label_1829
							if (ecount != 0) {
								if (cbit(979, cc) == 0) {
									unlockson cc
									repeat ecount
										lockson cc, searchene(cnt), 4
										if (stat == 0) {
											break
										}
									loop
									locksorder cc
									cHate(cc) = 30
								}
							}
						}
					}
					if (pcattacker != 0) {
						if (cRelationship(pcattacker) <= (-3)) {
							if (cState(pcattacker) == 1) {
								if (fov_los(cX(cc), cY(cc), cX(pcattacker), cY(pcattacker))) {
									cHate(cc) = 10
									lockson cc, pcattacker, 5
								}
							}
						}
					}
					if (ocdata(155, cc) == 0) {
						if (ocdata(155, 0) != 0) {
							if (relationbetween(0, ocdata(150, 0) - 1) == (-3)) {
								if (cState(ocdata(150, 0) - 1) == 1) {
									if (fov_los(cX(cc), cY(cc), cX(ocdata(150, 0) - 1), cY(ocdata(150, 0) - 1))) {
										cHate(cc) = 10
										lockson cc, ocdata(150, 0) - 1, 6
									}
								}
							}
						}
					}
				}
			}
		}
		if (areaType(gCurrentMap) != 3 | cTurn(cc) \ 5 == 0) {
			if (ocdata(161, cc) == 0) {
				searchfov = 3
				searchdist = 1
				ypoint = cY(cc)
				xpoint = cX(cc)
				gosub *label_1836
				if (ecount != 0) {
					if (cbit(979, cc) == 0) {
						repeat ecount
							watcheson cc, searchene(cnt)
							if (stat == 0) {
								break
							}
						loop
						watchesorder cc
						if (cHate(cc) <= 0) {
							cHate(cc) = 5
						}
					}
				}
			}
			if (ocdata(155, cc) == 0) {
				searchfov = 3
				searchdist = 1
				ypoint = cY(cc)
				xpoint = cX(cc)
				gosub *label_1829
				if (ecount != 0) {
					if (cbit(979, cc) == 0) {
						repeat ecount
							lockson cc, searchene(cnt), 7
							if (stat == 0) {
								break
							}
						loop
						locksorder cc
						if (cHate(cc) <= 0) {
							cHate(cc) = 5
						}
					}
				}
			}
		}
	}
	repeat ocdata(161, cc)
		if (cbit(6, ocdata(156, cc) - 1) == 1) {
			if (cbit(7, cc) == 0) {
				if (cWet(ocdata(156, cc) - 1) == 0) {
					if (rnd(5)) {
						unwatchon cc, ocdata(156, cc) - 1
					}
				}
			}
		}
	loop
	repeat ocdata(155, cc)
		if (cbit(6, ocdata(150, cc) - 1) == 1) {
			if (cbit(7, cc) == 0) {
				if (cWet(ocdata(150, cc) - 1) == 0) {
					if (rnd(5)) {
						unlockon cc, ocdata(150, cc) - 1
					}
				}
			}
		}
	loop
	if (cRole(cc) == 13) {
		if (ocdata(190, cc) != 0) {
			if (ocdata(155, cc) == 0 & ocdata(155, ocdata(190, cc)) != 0) {
				lockson cc, ocdata(150, ocdata(190, cc)) - 1, 8
				cHate(cc) = cHate(ocdata(190, cc))
				cEmotionIcon(cc) = 18 + 100 * 2
			}
			if (ocdata(155, cc) != 0 & ocdata(155, ocdata(190, cc)) == 0) {
				lockson ocdata(190, cc), ocdata(150, cc) - 1, 9
				cHate(cc) = cHate(ocdata(190, cc))
				cEmotionIcon(cc) = 18 + 100 * 2
			}
		}
	}
	if (gCurrentMap == 40) {
		if (cRelationship(cc) != (-3)) {
			if (cRelationship(cc) != 10) {
				if (rnd(40) == 0) {
					txtef 4
					txt cc, lang("「いいぞ！」", cnvtalk("Come on!")), lang("「もっとやれー」", cnvtalk("More blood!")), lang("「血をみせろー」", cnvtalk("Beat'em!")), lang("「頑張って！」", cnvtalk("Use your brain!")), lang("「うぉぉぉぉ！」", cnvtalk("Wooooo!")), lang("「行けぇ！」", cnvtalk("Go go!")), lang("「頭を使えよ」", cnvtalk("Good fighting.")), lang("「きゃー」", cnvtalk("Yeeee!"))
				}
				goto *label_1564
			}
		}
		cHate(cc) = 100
		if (cRelationship(cc) == 10) {
			p = -3, enemyteam, 15
		} else {
			p = 10, 1, 16
		}
		if (ocdata(155, cc)) {
			i = ocdata(150, cc) - 1
			if (cRelationship(i) == p & cState(i) == 1 & i >= p(1) & i < p(1) + p(2)) {
				if (rnd(10) != 0) {
					tc = i
					goto *label_1562
				}
			}
		}
		lockson cc, p(1), 10
		repeat 100
			i = rnd(p(2)) + p(1)
			if (cState(i) == 1) {
				if (cRelationship(i) == p) {
					lockson cc, i, 11
					if (stat == 0) {
						break
					}
				}
			}
		loop
		if (ocdata(155, cc)) {
			if (cRelationship(ocdata(150, cc) - 1) != p | cState(ocdata(150, cc) - 1) != 1) {
				unlockon cc, ocdata(150, cc) - 1
				f = 0
				repeat p(2), p(1)
					if (cState(cnt) == 1) {
						if (cRelationship(cnt) == p) {
							f = 1
							lockson cc, cnt, 12
							if (stat == 0) {
								break
							}
						}
					}
				loop
				if (f == 0) {
					if (cRelationship(cc) == 10) {
						petarenawin = 1
					} else {
						petarenawin = 2
					}
					goto *label_1617
				}
			}
		}
	}
	if (gCurrentMap == 33) {
		if (cc != gdata(250 + 9)) {
			if (cc > 16) {
				if (gdata(250 + 8) != 0) {
					if (cState(gdata(250 + 9)) == 1) {
						lockon cc, gdata(250 + 9), 19
						cHate(cc) = 500
					}
				}
			}
		}
	}
	if (ocdata(155, cc)) {
		i = ocdata(150, cc) - 1
		if (gMount != 0) {
			if (i == gMount) {
				if (rnd(3)) {
					lockon cc, 0, 20
				}
			}
			if (i == 0) {
				if (cRelationship(cc) <= (-2)) {
					if (rnd(3) == 0) {
						lockon cc, gMount, 21
					}
				}
			}
		}
		if (i != 0) {
			if (ocdata(106, i) != 0) {
				if (rnd(3) == 0) {
					lockon cc, ocdata(106, i), 22
				}
			} else {
				if (ocdata(107, i) != 0) {
					if (rnd(3)) {
						lockon cc, ocdata(107, i), 23
					}
				}
			}
		}
	}
	if (ocdata(0, cc) == 4 & gCurrentMap != 40) {
		unlockson cc
		cHate(cc) = 0
	}
	tc = 0
	if (cdatan(4, cc) != "" & cbit(989, cc) == 0) {
		if (rnd(30) == 0) {
			txtef 9
			txt -1, "" + cdatan(4, cc)
		}
	} else {
		if (cCanTalk(cc) != 0 | cbit(989, cc)) {
			if (cbit(965, cc) == 0) {
				if (cTurn(cc) \ 5 == 0) {
					if (rnd(4) == 0) {
						if (cX(0) > cX(cc) - 10 & cX(0) < cX(cc) + 10) {
							if (cY(0) > cY(cc) - 10 & cY(0) < cY(cc) + 10) {
								if (cContinuousActionId(0) != 6) {
									if (cHate(cc) <= 0) {
										nc_intb_calmsex = (-1)
										// ペットなら低確率で気持ちいいこと誘導
										if (cc > 0 & cc < 16) {
											if (rnd(10) == 0) {
												repeat 16
													if (cc == cnt) {
														continue
													}
													if (cState(cnt) != 1) {
														continue
													}
													if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) == 1) {
														txtef 9
														ctalk cc, 1162, cc, cnt
														if (stat != 0) {
															nc_intb_calmsex = cnt
															break
														} else {
															ctalk cc, 1161, cc, cnt
															if (stat != 0) {
																nc_intb_calmsex = cnt
																break
															}
														}
													}
												loop
												if (nc_intb_calmsex != (-1)) {
													if (cHate(nc_intb_calmsex) <= 0) {
														tc = nc_intb_calmsex
														if (cContinuousActionId(tc) == 0 & cContinuousActionId(cc) == 0) {
															unlockon cc, tc
															gosub *label_1369
															goto *label_1617
														}
													}
												}
											}
										}
										txtef 9
										ctalk cc, 100, cc, cc
									}
									*label_nc_calmskip
									if (ocdata(155, cc)) {
										if (cHate(cc) > 0) {
											if (cbit(985, cc) == 0) {
												txtef 9
												ctalk cc, 101, cc, ocdata(150, cc) - 1
											}
										}
									}
								}
							}
						}
						if (ogdata(28)) {
							if (findchara(210, 6, 1)) {
								if (cRole(stat) == 20005) {
									txtef 9
									txt stat, lang("「" + _onii4(cSex(0)) + "たすけてー！」", "\"Help me, " + _onii4(cSex(0)) + "!\""), lang("「うわーん！　" + _onii4(cSex(0)) + "！」", "\"Waaah! " + _onii4(cSex(0)) + "!\""), lang("「うわーん！　うわーん！」", "\"Waaah! Waaah!\""), lang("「うわーん！」", "\"Waaah!\"")
								}
							}
						}
					}
				}
			}
		}
		if (cdata(26, 0) \ 10 == 0) {
			repeat 245
				if ( cdata(26, 0) / 10 \ 10 == cnt \ 10 ) {
					if ( cdata(0, cnt) == 2 ) {
						ctalk cnt, 1376, cnt, cnt
					}
				}
			loop
		}
	}
	if (cRelationship(cc) >= 0) {
		if (cChoked(0)) {
			if (dist(cX(0), cY(0), cX(cc), cY(cc)) == 1) {
				x = cX(0)
				y = cY(0)
				goto *label_1425
			}
		}
	}
	if (cHp(cc) < cMaxHp(cc) / (4 - (ocdata(1, cc) == 1) * 2) & cAiActSubFreq(cc) != 101) {
		if (cTurn(cc) \ 10 == 0) {
			txtef 9
			ctalk cc, 420, cc, cc
		}
		if (godcheck(cc) == "jure") {
			if (cPietyPoint(cc) >= 200) {
				if (rnd(20) == 0) {
					efid = 623
					gosub *label_1396
					if (stat == 1) {
						goto *label_1617
					}
				}
			}
		}
		listmax = 0
		if (cAiHeal(cc) != 0) {
			list(0, listmax) = cAiHeal(cc), 0
			listmax++
		}
		if (spellbookcheck(cc)) {
			repeat olistmax
				p(87) = olist(cnt)
				if (iId(p(87)) == 249 | iId(p(87)) == 250 | iId(p(87)) == 251) {
					if (readablecheck(cc, p(87))) {
						list(0, listmax) = stat, p(87)
						listmax++
					}
				}
			loop
		}
		if (listmax) {
			p = rnd(listmax)
			efid = list(0, p)
			if (efid >= 400 & efid < 600) {
				bookmagic = list(1, p)
				item_separate bookmagic
				gosub *label_1773
				if (stat == 1) {
					goto *label_1617
				} else {
					if (stat == 2) {
						goto *label_1424
					}
				}
			} else {
				if (efid >= 600) {
					gosub *label_1396
					if (stat == 1) {
						goto *label_1617
					}
				}
			}
		}
		inv_getheader cc
		f = 0
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (refitem(iId(cnt), 9, cnt) == 52001 & (iId(cnt) != 286 & iId(cnt) != 285)) {
				f = 1
				ci = cnt
				break
			}
		loop
		if (f == 1) {
			goto *action_doDrink
		}
	}
	if (cItemWhichWillBeUsed(cc) == 0) {
		goto *label_1561
	}
	ci = cItemWhichWillBeUsed(cc)
	if (iNumber(ci) <= 0) {
		cItemWhichWillBeUsed(cc) = 0
		goto *label_1561
	}
	a = refitem(iId(ci), 5, ci)
	if (cRelationship(cc) != 0) {
		cItemWhichWillBeUsed(cc) = 0
	}
	if ((a == 57000 | item_isCookedMilk(ci)) & item_isCookedHarb(ci) == 0) {
		if (cRelationship(cc) == 10 & cNutrition(cc) > 6000) {
			f = 0
			if (petcheck(cc)) {
				if (cId(cc) == 176 | cId(cc) == 249) {
					if (sorg(184, cc) != 0) {
						inv_getheader cc
						repeat invrange, invhead
							if (iNumber(cnt) == 0) {
								continue
							}
							if (iId(cnt) == 256) {
								f = 1
								break
							}
						loop
					}
				}
			}
			if (f == 1) {
				if (iParam2(ci) == 0) {
					snd 25
					item_separate ci
					s = itemname(ci)
					iNumber(ci)--
					flt
					nostack = 1
					itemcreate cc, 667, -1, -1, 0
					if (rnd(3) == 0) {
						ibitmod 15, ci, 1
					}
					if (rnd(3) == 0) {
						ibitmod 6, ci, 1
					}
					item_checkknown ci
					item_stack cc, ci
					txt -1, lang(name(cc) + "は" + s + "を料理してお弁当を作った。", name(cc) + " cook" + _s(cc) + " " + s + " and make a lunch.")
					ctalk cc, 1336, cc, cc
					skillexp2 184, cc, 30
				}
			}
		} else {
			goto *action_doEat
		}
	}
	if ((a == 52000 & item_isCookedMilk(ci) == 0) | item_isCookedHarb(ci)) {
		if (cRelationship(cc) != 10 | (refitem(iId(ci), 9, ci) != 52001 | iId(ci) == 286 | iId(ci) == 285) | item_isCookedHarb(ci)) {
			goto *action_doDrink
		}
	}
	if (a == 53000) {
		goto *label_1421
	}
	cItemWhichWillBeUsed(cc) = 0
*label_1561
	if (cHate(cc) > 0 | cRelationship(cc) == 10) {
		if (cBlind(cc) != 0) {
			if (rnd(10) > 2) {
				goto *label_1564
			}
		}
		if (cConfused(cc) != 0) {
			if (rnd(10) > 3) {
				goto *label_1564
			}
		}
	}
	if (cRelationship(cc) == 10) {
		if (ocdata(155, cc) == 0) {
			if (ocdata(5, cc) != 1) {
				if (cTurn(cc) \ 50 == 0) {
					if (cNutrition(cc) <= 6000 & gMount != cc & ocdata(107, cc) == 0) {
						inv_getheader cc
						f = 0
						repeat invrange, invhead
							if (iNumber(cnt) == 0) {
								continue
							}
							if (cId(cc) == 176 | cId(cc) == 249 & iId(cnt) == 667) {
								continue
							}
							if ((refitem(iId(cnt), 5, cnt) == 57000 | item_isCookedMilk(cnt)) & item_isCookedHarb(cnt) == 0) {
								f = 1
								ci = cnt
								break
							}
						loop
						if (f == 1) {
							goto *action_doEat
						} else {
							txtef 9
							ctalk cc, 419, cc, cc
						}
					}
				}
			}
			if (map(cX(cc), cY(cc), 4) != 0) {
				cell_itemoncell cX(cc), cY(cc)
				if (stat == 1) {
					ci = rtval(1)
					p = refitem(iId(ci), 5, ci)
					if (ocdata(4, cc) != 1) {
						if (cNutrition(cc) <= 6000 & gMount != cc & ocdata(107, cc) == 0) {
							if ((p == 57000 | item_isCookedMilk(ci)) & item_isCookedHarb(ci) == 0 & iId(ci) != 755 & iId(ci) != 756 & ibit(5, ci) == 0) {
								if (iOwnState(ci) <= 0) {
									if (iCurseState(ci) >= 0) {
										goto *action_doEat
									}
								}
							}
							if (p == 60001) {
								if (iOwnState(ci) <= 1) {
									if (iParam1(ci) >= (-5)) {
										if (iParam3(ci) < 20) {
											if (iId(ci) != 602) {
												goto *action_doDrink
											}
										}
									}
								}
							}
						}
					}
					if (ocdata(3, cc) != 1) {
						if (p == 68000 | p == 77000) {
							if (iOwnState(ci) <= 0) {
								if (ibit(5, ci) == 0) {
									if (mapType != 5) {
										in = iNumber(ci)
										if (gMount != cc & ocdata(107, cc) == 0) {
											gosub *label_1416
											if (stat == 1) {
												goto *label_1617
											}
										}
									}
								}
							}
						}
						if (cfg_autopick & ocdata(3, cc) == 2) {
							if (areaType(gCurrentMap) != 5 | areaId(gCurrentMap) == 31 | areaId(gCurrentMap) == 30) {
									x = cX(cc)
									y = cY(cc)
									cnt3 = cc
									gosub *label_1645
							}
						}
					}
				}
			}
			if (cCurrentMap(cc) == gCurrentMap) {
				if (cbit(969, cc) == 0) {
					goto *label_1564
				}
			}
		}
	}
	if (ocdata(161, cc)) {
		tc = ocdata(156, cc) - 1
		goto *label_1837
	}
	if (ocdata(155, cc)) {
		tc = ocdata(150, cc) - 1
	}
*label_1562
	if (cHate(cc) > 0 | cRelationship(cc) == 10) {
		distance = dist(cX(tc), cY(tc), cX(cc), cY(cc))
		if (cRelationship(cc) == 10) {
			if (tc == 0) {
				if (distance > 2 | rnd(3)) {
					retreat = 0
					goto *label_1567
				} else {
					goto *label_1564
				}
			}
		}
		if (cFear(cc) != 0) {
			retreat = 1
			goto *label_1567
		} else {
			retreat = 0
		}
		if (cBlind(cc) != 0) {
			if (rnd(3)) {
				goto *label_1564
			}
		}
		if (cHate(cc) <= 0) {
			if (cAiCalm(cc) == 5) {
				if (cContinuousActionId(cc) == 0) {
					goto *label_1564
				}
			}
		}
		if (gCurrentMap == 40 | (ocdata(0, cc) != 4 & (ocdata(0, cc) != 5 | rnd(3) == 0))) {
			if (distance < 8) {
				if (eqfaction(cc, "debuffer")) {
					if (rnd(10) == 0) {
						sdim buffervalues, 2
						getfactionvalues cc, "debuffby", buffervalues
						if (stat != 0) {
							p(74) = int(buffervalues(rnd(stat)))
							if (usablecheck(p(74), cc)) {
								p(73) = stat
								if (p(74) / 10000 == 9) {
									dbmode = 14
									dbid = p(74) \ 10000
									gosub *label_2426
									if (findbuff(tc, sdataref(1, efid) \ 1000) == (-1)) {
										ci = p(73)
										goto *label_1424
									}
								}
							}
						}
					}
				}
				if (distance > 1) {
					if (eqfaction(cc, "spellattacker")) {
						if (rnd(10) == 0) {
							sdim attackvalues, 4
							getfactionvalues cc, "spellattackby", attackvalues
							if (stat != 0) {
								p(74) = int(attackvalues(rnd(stat)))
								if (usablecheck(p(74), cc)) {
									p(73) = stat
									if (p(74) / 10000 == 9) {
										ci = p(73)
										goto *label_1424
									}
								}
							}
						}
					}
				}
				if (petcheck(cc)) {
					if (eqfaction(cc, "decoy")) {
						f = 0
						if (rnd(10) == 0) {
							f = 1
						} else {
							if (rnd(5) == 0) {
								if (relationbetween(cc, tc) == (-3)) {
									if (ocdata(150, tc) - 1 != cc) {
										f = 1
									}
								}
							}
						}
						if (f) {
							if (getfactionvalue(cc, "decoyby") != "") {
								p(74) = int(refstr)
								if (usablecheck(p(74), cc)) {
									p(73) = stat
									if (p(74) / 10000 == 14) {
										ci = p(73)
										goto *label_1453
									}
								}
							}
						}
					}
					// 作戦が早めに回復のときは体力が1/2以上、そうでないときは1/4以上あるなら、
					if (cHp(cc) >= cMaxHp(cc) / (4 - (ocdata(1, cc) == 1) * 2)) {
						// 現在ディバイドモードのバフがかかっていなければ
						if (findbuff(cc, buffId_weakShield) == -1) {
							// ガーディアンフィートを持っていれば
							if (gettrait(cc, 62)) {
								f@oo2019 = 0
								if (relationbetween(cc, tc) == -3) {
									if (rnd(5) == 0) {
										f@oo2019 = 1
									}
								}
								if (f@oo2019) {
									efid = sId_weakShield
									gosub *label_0623
									goto *label_1221
								}
							}
						}
					}
				}
			}
		}
		if (distance != cAiDist(cc)) {
			if (rnd(100) < cAiMove(cc)) {
				goto *label_1567
			}
		}
		goto *label_1570
	}
*label_1563
	if (oabit(15, gCurrentMap) == 0 & oabit(18, gCurrentMap) == 0) {
		if (synccheck(cc, -1)) {
			if (cTurn(cc) \ 10 == 1) {
				ecount = 0
				memset searchene, 0, 15 * 4
				if (ocdata(0, cc) == 1) {
					searchfov = 15
					searchdist = 7
				} else {
					if (ocdata(0, cc) == 2 | ocdata(0, cc) == 3) {
						searchfov = 7
						searchdist = 3
					} else {
						searchfov = 5
						searchdist = 2
					}
				}
				ypoint = cY(cc)
				xpoint = cX(cc)
				if (ocdata(0, cc) == 3) {
					tcbk = tc
					if (petcheck(cc)) {
						ypoint = cY(0)
						xpoint = cX(0)
					} else {
						if (getfactionvalue(cc, "pet") != "") {
							tc = int(refstr)
							ypoint = cY(tc)
							xpoint = cX(tc)
						}
					}
					tc = tcbk
				}
				gosub *label_1836
				if (ecount != 0) {
					if (cbit(979, cc) == 0) {
						unwatcheson cc
						repeat ecount
							watcheson cc, searchene(cnt)
							if (stat == 0) {
								break
							}
						loop
						if (ocdata(161, cc)) {
							watchesorder cc
							cHate(cc) = 30
							goto *label_1564
						}
					}
				}
				gosub *label_1829
				if (ecount != 0) {
					if (cbit(979, cc) == 0) {
						unlockson cc
						repeat ecount
							lockson cc, searchene(cnt), 13
							if (stat == 0) {
								break
							}
						loop
						if (ocdata(155, cc)) {
							locksorder cc
							cHate(cc) = 30
							cEmotionIcon(cc) = 18 + 100 * 2
							goto *label_1564
						}
					}
				}
			}
		}
	}
	if (tc == 0) {
		r1 = tc
		r2 = cc
		gosub *label_0719
		if (stat == 1) {
			if (relationbetween(cc, tc) == (-3) | factionbetween(cc, tc) == (-3)) {
				if (cRelationship(cc) > (-3)) {
					cRelationship(cc) = -3
				}
				if (gettrait(tc, 59) >= 2) {
					r1 = tc
					gosub *label_1846
				}
				if (gettrait(tc, 132)) {
					if (rnd(10) < calctraitscore(stat)) {
						addbuff tc, 5, sorgEx(18, tc) * 5 + 50, 5
					}
				}
				lockson cc, tc, 14
				locksorder cc
				cHate(cc) = 30
				cEmotionIcon(cc) = 18 + 100 * 2
			}
		}
	}
	goto *label_1564
*label_1564
	if (cAiCalm(cc) == 4) {
		tc = 0
		distance = dist(cX(tc), cY(tc), cX(cc), cY(cc))
		goto *label_1567
	}
	if (ocdata(190, cc) != 0 & ocdata(190, cc) != cc) {
		if (cCurrentMap(cc) == cCurrentMap(ocdata(190, cc))) {
			tc = ocdata(190, cc)
			distance = dist(cX(tc), cY(tc), cX(cc), cY(cc))
			goto *label_1567
		}
	}
	if (rnd(5) != 0) {
		goto *label_1617
	}
	if (cDrunk(cc) != 0) {
		if (synccheck(cc, -1)) {
			ctalk cc, 433, cc, cc
			if (cdatan(2, cc) == "cat" & stat == 0) {
				if (cDrunk(cc) < 5) {
					cDrunk(cc) += 40
				}
*label_1565
				if (jp) {
					if (rnd(3) == 0) {
						txt cc, "「米さ米種だろ♪」", "「飲ま飲まイェイ！！」", "「飲ま飲ま飲まイェイ！！」"
						goto *label_1566
					}
					if (rnd(4) == 0) {
						txt cc, "「字ベロ♪指♪ラマ♪ｸﾏｰ!!して♪パンチラ♪」", "「アロー♪アーロン♪スゲェ♪ピカソ♪算段ビーフ♪」", "「キスすごい肉♪脱線してんの♪さらに肉♪」"
						goto *label_1566
					}
					if (rnd(4) == 0) {
						txt cc, "「キープダルシム♪アゴスタディーイェイ♪並フェイスで大きい筆入れ♪」", "「ハロー♪猿ー♪すげー♪うん入る♪」"
						goto *label_1566
					}
					if (rnd(4) == 0) {
						txtef 4
						txt -1, " *ﾋﾟﾛﾘ〜ﾋﾟﾛﾘ〜* "
						goto *label_1566
					}
					txt cc, "「マイアヒー♪」", "「マイアフゥー♪」", "「マイアホー♪」"
					goto *label_1566
				} else {
					if (rnd(2) == 0) {
						txt cc, cnvtalk("Vrei sa pleci dar♪"), cnvtalk("Numa numa yay!!"), cnvtalk("Numa numa numa yay!!")
						goto *label_1566
					}
					txt cc, cnvtalk("Mai-Ya-Hi♪"), cnvtalk("Mai-Ya-Hoo♪"), cnvtalk("Mai-Ya-Ha Ma Mi A♪")
					goto *label_1566
				}
				goto *label_1565
			}
		}
	}
*label_1566
	if (cc > 16) {
		if (mapType == 3 | mapType == 2) {
			if (gHour >= 22 | gHour < 7) {
				if (cContinuousActionId(cc) == 0) {
					if (rnd(100) == 0) {
						dmgcon cc, 2, 4000
					}
				}
			}
		}
	}
	if (cItemWhichWillBeUsed(cc) == 0) {
		if (cRelationship(cc) != 10) {
			if (gCurrentMap == 13) {
				if (gExecutingImmediateQuestType == 1009) {
					if (rnd(30) == 0) {
						flt 20
						if (rnd(4) == 0) {
							flttypemajor = 57000
						} else {
							flttypemajor = 52000
							if (rnd(8)) {
								flttypeminor = 52002
							}
						}
						itemcreate cc, 0, -1, -1, 0
						if (stat == 1) {
							cItemWhichWillBeUsed(cc) = ci
						}
					}
				}
			}
			if (gCurrentMap == 33 | gCurrentMap == 29) {
				if (cId(cc) == 35 | cId(cc) == 211) {
					if (synccheck(cc, -1)) {
						if (chipm(0, map(cX(cc), cY(cc), 0)) == 4) {
							if (rnd(4) == 0) {
								if (cState(gdata(250 + 9)) == 1) {
									if (synccheck(gdata(250 + 9), -1)) {
										flt
										itemcreate cc, 587, -1, -1, 0
										if (stat == 1) {
											tlocx = cX(gdata(250 + 9))
											tlocy = cY(gdata(250 + 9))
											txtef 9
											txt cc, lang("「化け物め！」", cnvtalk("Filthy monster!")), lang("「くたばれっ」", cnvtalk("Go to hell!")), lang("「退治してやるぅ！」", cnvtalk("I'll get rid of you.")), lang("「くらえー！」", cnvtalk("Eat this!"))
											goto *label_1413
										}
									}
								}
							}
							if (rnd(12) == 0) {
								itemlist -1, 541
								f = 0
								repeat listmax
									ti = list(0, cnt)
									if (iX(ti) >= scx & iX(ti) < scx + inf_screenw & iY(ti) >= scy & iY(ti) < scy + inf_screenh) {
										f = 1
										break
									}
								loop
								tlocx = iX(ti)
								tlocy = iY(ti)
								if (f == 1) {
									flt
									itemcreate cc, 587, -1, -1, 0
									if (stat == 1) {
										goto *label_1413
									}
								}
							}
							if (rnd(10) == 0) {
								if (map(cX(cc), cY(cc), 4) == 0) {
									flt
									itemcreate -1, 541, cX(cc), cY(cc), 0
									if (stat == 1) {
										snd 86
										txt -1, lang(name(cc) + "は" + itemname(ci) + "を作った！", name(cc) + " make" + _s(cc) + " " + itemname(ci) + "!")
										goto *label_1617
									}
								}
							}
							if (rnd(12) == 0) {
								flt
								itemcreate cc, 587, -1, -1, 0
								if (stat == 1) {
									tlocx = cX(0)
									tlocy = cY(0)
									txtef 9
									txt cc, lang(" *クスクス* ", "*grin*"), lang("「えいっ」", cnvtalk("Fire in the hole!")), lang("「うりゃ」", cnvtalk("Tee-hee-hee!")), lang("「くらえー！」", cnvtalk("Eat this!")), lang("「危ないっ！」", cnvtalk("Watch out!")), lang("「避けてー」", cnvtalk("Scut!"))
									goto *label_1413
								}
							}
						}
					}
				}
			}
			if (cNutrition(cc) <= 6000) {
				if (cRole(cc) != 10001 & cRole(cc) != 10018 & eqfaction(cc, "petshop") == 0) {
					flag = 0
					if (cId(cc) == 343) {
						if (userdata2(4, cCnpcId(cc))) {
							flag = 1
						}
					} else {
						if (ocdata(103, cc)) {
							flag = 1
						}
					}
					if (flag == 0) {
						if (cVisionFlag(cc) != msync | rnd(5)) {
							if (cbit(986, cc) == 0) {
								cNutrition(cc) += 5000
							} else {
								cNutrition(cc) -= 3000
							}
						} else {
							flt 20
							p = rnd(4), 0
							if (p == 0 | cbit(986, cc)) {
								flttypemajor = 57000
							}
							if (p == 1) {
								flttypemajor = 52000
							}
							if (p == 2 | p == 3) {
								flttypeminor = 52002
							}
							itemcreate cc, p(1), -1, -1, 0
							if (stat == 1) {
								if (iId(ci) == 577 | iId(ci) == 601) {
									if (iId(ci) == 577) {
										if (rnd(5) == 0) {
											iNumber(ci) = 0
										}
									} else {
										iNumber(ci) = 0
									}
								} else {
									cItemWhichWillBeUsed(cc) = ci
									if (cbit(986, cc) == 0) {
										cNutrition(cc) += 5000
									} else {
										cNutrition(cc) -= 3000
									}
								}
							}
						}
					}
				}
			}
		}
	}
	if (cAiCalm(cc) == 5) {
		cnpcrole = 0
		if (cId(cc) == 343) {
			if (userdata2(5, cCnpcId(cc))) {
				cnpcrole = userdata2(5, cCnpcId(cc))
			}
		}
		if (cId(cc) == 326 | cnpcrole == 1) {
			if (ocdata(49, cc) == 0) {
				if (rnd(5) == 0) {
					efid = 183
					gosub *label_1398
					goto *label_1617
				}
			}
		}
		if (cId(cc) == 320 | cId(cc) == 280 | cnpcrole == 2) {
			if (synccheck(cc, -1)) {
				tc = 0
				distance = dist(cX(tc), cY(tc), cX(cc), cY(cc))
				if (distance < 8) {
					if (cdatan(2, 0) == "snail") {
						tlocx = cX(0)
						tlocy = cY(0)
						flt
						itemcreate cc, 698, -1, -1, 0
						if (stat == 1) {
							if (synccheck(cc, -1)) {
								txtef 9
								txt cc, lang("「なめくじだ！」", cnvtalk("Snail!")), lang("「殺す！」", cnvtalk("Kill!"))
							}
							goto *label_1413
						}
					}
				}
			}
		}
		if (cId(cc) == 335 | cId(r1) == 386 | cId(cc) == 352 | cnpcrole == 3 | eqfaction(cc, "whole")) {
			if (ocdata(49, cc) == 0) {
				if (tc == 0) {
					if (rnd(10) == 0) {
						repeat 40, 57
							if (cState(cnt) != 1) {
								continue
							}
							if (rnd(3) == 0) {
								continue
							}
							if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) < 6) {
								if (fov_los(cX(cc), cY(cc), cX(cnt), cY(cnt))) {
									lockon cc, cnt, 24
									tc = cnt
									break
								}
							}
						loop
					}
				} else {
					distance = dist(cX(tc), cY(tc), cX(cc), cY(cc))
					if (distance == 1) {
						if (cContinuousActionId(tc) == 0) {
							unlockon cc, tc
							gosub *label_1369
							goto *label_1617
						}
					}
					if (distance < 6) {
						goto *label_1567
					}
				}
			}
		}
		cNextX(cc) = rnd(3) - 1 + cX(cc)
		cNextY(cc) = rnd(3) - 1 + cY(cc)
		cell_check cNextX(cc), cNextY(cc)
		if (cellaccess == 1) {
			goto *label_1429
		}
	}
	if (cAiCalm(cc) == 1) {
		cNextX(cc) = rnd(3) - 1 + cX(cc)
		cNextY(cc) = rnd(3) - 1 + cY(cc)
		cell_check cNextX(cc), cNextY(cc)
		if (cellaccess == 1) {
			goto *label_1429
		}
	}
	if (cAiCalm(cc) == 2) {
		if (mapDefaultAiCalm == 1 & dist(cX(cc), cY(cc), cInitialX(cc), cInitialY(cc)) > 2) {
			cNextX(cc) = cX(cc) + rnd(2) * ((cX(cc) > cInitialX(cc)) * (-1) + (cX(cc) < cInitialX(cc)))
			cNextY(cc) = cY(cc) + rnd(2) * ((cY(cc) > cInitialY(cc)) * (-1) + (cY(cc) < cInitialY(cc)))
		} else {
			cNextX(cc) = rnd(3) - 1 + cX(cc)
			cNextY(cc) = rnd(3) - 1 + cY(cc)
		}
		cell_check cNextX(cc), cNextY(cc)
		if (cellaccess == 1) {
			goto *label_1429
		}
	}
	goto *label_1617
*label_1567
	if (cc < 16) {
		if (rnd(100) == 0) {
			gosub *label_1755
		}
		if (rnd(100) == 0) {
			gosub *label_1756
		}
	}
	if (tc == cc) {
		unlockon cc, tc
		goto *label_1617
	}
	if (cdata(203, cc) <= 0) {
		cdata(205, cc) = cX(tc)
		cdata(206, cc) = cY(tc)
		if (retreat | cAiDist(cc) * (cHate(cc) > 0) > distance) {
			cdata(205, cc) = cX(cc) + (cX(cc) - cX(tc))
			cdata(206, cc) = cY(cc) + (cY(cc) - cY(tc))
		}
		if (ahead) {
			cdata(205, cc) = cX(tc)
			cdata(206, cc) = cY(tc)
			ahead = 0
		}
	} else {
		cdata(203, cc)--
	}
	blockedbychara = 0
	cNextX(cc) = (cdata(205, cc) > cX(cc)) - (cdata(205, cc) < cX(cc)) + cX(cc)
	cNextY(cc) = (cdata(206, cc) > cY(cc)) - (cdata(206, cc) < cY(cc)) + cY(cc)
	x = cNextX(cc)
	y = cNextY(cc)
	cell_check x, y
	if (cellaccess == 1) {
		goto *label_1429
	}
	if (cellchara != (-1)) {
		tc = cellchara
		f = 0
		if (cQuality(cc) > 3 & cLevel(cc) > cLevel(tc) | cbit(985, tc)) {
			if ((cRelationship(cc) == 10 & cRelationship(tc) == 10) != 1) {
				if (ocdata(190, cc) == 0 | ocdata(190, cc) != ocdata(190, tc)) {
					f = 1
				}
			}
		}
		if (ocdata(155, cc)) {
			if (ocdata(10, cc) == 1 & ocdata(10, tc) == 0) {
				if (tc != 0) {
					if (relationbetween(cc, tc) >= (-1)) {
						if (cContinuousActionTurn(tc) == 0) {
							f = 1
						}
					}
				}
			}
			if (tc == ocdata(150, cc) - 1) {
				f = 0
			}
		}
		if (petcheck(cc) & cbit(985, tc)) {
			f = 0
		}
		if (f) {
			cell_swap cc, tc
			if (stat) {
				if (synccheck(cc, -1)) {
					txt -1, lang(name(cc) + "は" + name(tc) + "を押しのけた。", name(cc) + " displace" + _s(cc) + " " + name(tc) + ".")
				}
				if (cContinuousActionId(tc) == 1) {
					if (cContinuousActionTurn(tc) > 0) {
						if (synccheck(cc, -1)) {
							ctalk tc, 1137, tc, cc
							if (stat == 0) {
								txt -1, lang(name(tc) + "は" + name(cc) + "を睨み付けた。", name(tc) + " glare" + _s(tc) + " " + name(cc) + ".")
							}
						}
						rowactend tc
					}
				}
				gosub *label_1670
			}
			goto *label_1617
		}
	}
	if (cc > 16) {
		if (cQuality(cc) > 3) {
			if (cRelationship(cc) <= (-2)) {
				if (x >= 0) {
					if (x < mapWidth) {
						if (y >= 0) {
							if (y < mapHeight) {
								if (chipm(7, map(x, y, 0)) & 4) {
									if (rnd(4) == 0) {
										map(x, y, 0) = tile_tunnel
										snd 45
										animeid = 14
										gosub *label_0630
										spillfrag x, y, 2
										if (synccheck(cc, -1)) {
											txt -1, lang(name(cc) + "は壁を破壊した！", name(cc) + " crush" + _s(cc, 1) + " the wall!")
										}
										goto *label_1617
									}
								}
							}
						}
					}
				}
			}
		}
	}
	if (abs(cdata(205, cc) - cX(cc)) >= abs(cdata(206, cc) - cY(cc))) {
		gosub *label_1568
		if (stat == 1) {
			goto *label_1429
		}
		gosub *label_1569
		if (stat == 1) {
			goto *label_1429
		}
	} else {
		gosub *label_1569
		if (stat == 1) {
			goto *label_1429
		}
		gosub *label_1568
		if (stat == 1) {
			goto *label_1429
		}
	}
	if (cdata(203, cc) > 0) {
		cNextX(cc) = rnd(3) - 1 + cX(cc)
		cNextY(cc) = rnd(3) - 1 + cY(cc)
		cell_check cNextX(cc), cNextY(cc)
		if (cellaccess == 1) {
			goto *label_1429
		}
	} else {
		if (blockedbychara == 1) {
			cdata(203, cc) = 3
		} else {
			cdata(203, cc) = 6
		}
		dir = dir(1 + rnd(2))
		if (dir == 1) {
			cdata(205, cc) = cX(cc) - 6
			cdata(206, cc) = cY(tc)
		}
		if (dir == 2) {
			cdata(205, cc) = cX(cc) + 6
			cdata(206, cc) = cY(tc)
		}
		if (dir == 3) {
			cdata(206, cc) = cY(cc) - 6
			cdata(205, cc) = cX(tc)
		}
		if (dir == 0) {
			cdata(206, cc) = cY(cc) + 6
			cdata(205, cc) = cX(tc)
		}
	}
	goto *label_1617
*label_1568
	if (cdata(205, cc) > cX(cc)) {
		if (cdata(206, cc) > cY(cc)) {
			p = 1
		} else {
			p = 0
		}
		dir = 2, 0, 3
		ai_check
		if (stat == 1) {
			return 1
		}
	}
	if (cdata(205, cc) < cX(cc)) {
		if (cdata(206, cc) < cY(cc)) {
			p = 0
		} else {
			p = 1
		}
		dir = 1, 0, 3
		ai_check
		if (stat == 1) {
			return 1
		}
	}
	return 0
*label_1569
	if (cdata(206, cc) > cY(cc)) {
		if (cdata(205, cc) > cX(cc)) {
			p = 1
		} else {
			p = 0
		}
		dir = 0, 1, 2
		ai_check
		if (stat == 1) {
			return 1
		}
	}
	if (cdata(206, cc) < cY(cc)) {
		if (cdata(205, cc) > cX(cc)) {
			p = 0
		} else {
			p = 1
		}
		dir = 3, 1, 2
		ai_check
		if (stat == 1) {
			return 1
		}
	}
	return 0
*label_1570
	if (tc == 0 | petcheck(tc)) {
		pcattacker = cc
		if (ogdata(470) == 2) {
			if (gCurrentMap != 40) {
				lockon cc, 0, 25
			}
		}
	}
	if (gCurrentMap != 40) {
		if (ocdata(0, cc) == 4 | (ocdata(0, cc) == 5 & rnd(3))) {
			goto *label_1617
		}
	}
	if (cAiActNum(cc) \ 10 == 0) {
		act = 0
		bookmagic = 0
	} else {
		frequency_read = 10
		if (getfactionvalue(cc, "AI_read") != "") {
			frequency_read = int(refstr)
		}
		repeat 50
			act = cdata(215 + rnd(cAiActNum(cc) \ 10), cc)
			bookmagic = 0
			if (cAiActSubFreq(cc) != 0) {
				if (cAiActSubFreq(cc) == 101) {
						act = 0
						gosub *label_N120
						if (act != 0) {
							break
						}
				} else {
					if (cAiActSubFreq(cc) > rnd(100)) {
						if (cAiActNum(cc) / 10 != 0) {
							act = cdata(220 + rnd(cAiActNum(cc) / 10), cc)
						}
					}
				}
			}
			if (ocdata(7, cc) == 0) {
				repeat length(racenamecsv)
					if (cdatan(2, cc) == racenamecsv(cnt, 1)) {
						if (racespact(cnt, 0) > rnd(100)) {
							act = racespact(cnt, 2 + rnd(racespact(cnt, 1)))
						}
						break
					}
				loop
			}
			if (ocdata(8, cc) == 0) {
				repeat length(classnamecsv)
					if (cdatan(3, cc) == classnamecsv(cnt, 1)) {
						if (classspact(cnt, 0) > rnd(100)) {
							act = classspact(cnt, 2 + rnd(classspact(cnt, 1)))
						}
						break
					}
				loop
			}
			if (ocdata(49, cc) == 0) {
				if (cId(cc) == 343) {
					if (cCnpcId(cc) != usernpcmax) {
						if (userspact(cCnpcId(cc), 0) > rnd(100)) {
							act = userspact(cCnpcId(cc), 2 + rnd(userspact(cCnpcId(cc), 1)))
						}
					}
				} else {
					if (cId(cc) == 262 & ocdata(54, cc) == 343) {
						if (ocdata(55, cc) - 1 != usernpcmax) {
							if (userspact(ocdata(55, cc) - 1, 0) > rnd(100)) {
								act = userspact(ocdata(55, cc) - 1, 2 + rnd(userspact(ocdata(55, cc) - 1, 1)))
							}
						}
					}
				}
			}
			if (sdata(165, cc) != 0) {
				if (frequency_read > rnd(100)) {
					if (spellbookcheck(cc)) {
						p(87) = olist(rnd(olistmax))
						if (readablecheck(cc, p(87))) {
							act = stat
							bookmagic = p(87)
							item_separate bookmagic
						}
					}
				}
			}
			if (cPietyPoint(cc) >= 200) {
				if (godcheck(cc) == "lulwy") {
					if (rnd(50) == 0) {
						act = 625
					}
				} else {
					if (getcgodno(cc) != (-1)) {
						god_no = stat
						if (cgodSpecialPowerId(god_no) != 0) {
							if (cgodSpecialPowerId(god_no) / 1000 == 0) {
								if (rnd(10 + sdataref(2, cgodSpecialPowerId(god_no))) == 0) {
									act = 781
									sdataref(0, act) = sdataref(0, cgodSpecialPowerId(god_no)), sdataref(1, cgodSpecialPowerId(god_no)), sdataref(2, cgodSpecialPowerId(god_no)), sdataref(3, cgodSpecialPowerId(god_no)), sdataref(4, cgodSpecialPowerId(god_no))
									skillname(act) = skillname(cgodSpecialPowerId(god_no))
									skilldesc(act) = skilldesc(cgodSpecialPowerId(god_no))
									skillencdesc(act) = skillencdesc(cgodSpecialPowerId(god_no))
								}
							}
						}
					}
				}
			}
			if (act >= 400 & act < tailspact) {
				if (act == 403 | act == 404 | act == 405) {
					act = 0
					continue
				} else {
					if (act == 631) {
						if (ocdata(155, cc) < 2) {
							continue
						}
					} else {
						if (act == 629 | act == 790 | act == 791) {
							continue
						}
					}
				}
				if (sdataref(1, act) / 1000 == 1) {
					if (bdataref(0, sdataref(1, act) \ 1000) == 1) {
						if (findbuff(cc, sdataref(1, act) \ 1000) != (-1)) {
							continue
						}
					} else {
						if (bdataref(0, sdataref(1, act) \ 1000) == 2) {
							if (findbuff(tc, sdataref(1, act) \ 1000) != (-1)) {
								continue
							}
						}
					}
				}
			}
			break
		loop
	}
	if (act >= (-10000) & act <= (-9994)) {
		if (distance < 8) {
			if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc))) {
				tlocx = cX(tc)
				tlocy = cY(tc)
				if (act == (-9999)) {
					flt
					flttypemajor = 52000
					itemcreate cc, isetthrowpotionminor(rnd(length(isetthrowpotionminor))), -1, -1, 0
					if (stat != 0) {
						iEnhancement(ci) = sdata(111, cc) / 10
						if (iEnhancement(ci) > 100) {
							iEnhancement(ci) = 100
						}
					}
				}
				if (act == (-9998)) {
					if (ocdata(50, cc) == 0) {
						flt
						flttypemajor = 52000
						itemcreate cc, isetthrowpotionmajor(rnd(length(isetthrowpotionmajor))), -1, -1, 0
						if (stat != 0) {
							iEnhancement(ci) = sdata(111, cc) / 10
							if (iEnhancement(ci) > 100) {
								iEnhancement(ci) = 100
							}
						}
					}
					if (ocdata(50, cc) == 1) {
						flt
						itemcreate cc, 577, -1, -1, 0
					}
					if (ocdata(50, cc) == 2) {
						repeat 1
							flt
							flttypemajor = 52000
							itemcreate cc, isetthrowpotionmajor(rnd(length(isetthrowpotionmajor))), -1, -1, 0
							if (stat != 0) {
								if (iId(ci) == 577) {
									iNumber(ci) = 0
									continue cnt
								}
							}
							break
						loop
					}
					if (stat != 0) {
						if (iId(ci) == 577 & cId(cc) == 211) {
						if (rnd(20) == 0) {
								iEnhancement(ci) = rnd(3) + 1
							}
						}
						iEnhancement(ci) += sdata(111, cc) / 10
						if (iEnhancement(ci) > 100) {
							iEnhancement(ci) = 100
						}
					}
				}
				if (act == (-9997)) {
					flt
					flttypemajor = 52000
					itemcreate cc, isetthrowpotiongreater(rnd(length(isetthrowpotiongreater))), -1, -1, 0
				}
				if (act == (-9996)) {
					flt
					itemcreate cc, 698, -1, -1, 0
				}
				if (act == (-9995)) {
					flt
					itemcreate cc, 772, -1, -1, 0
					if (stat == 1) {
						iParam3(ci) = -1
					}
				}
				if (act == (-9994)) {
					flt
					itemcreate cc, 620, -1, -1, 0
					if (stat == 1) {
						iCurseState(ci) = 1
						iEnhancement(ci) = sdata(17, cc) / 25
						if (iEnhancement(ci) > 100) {
							iEnhancement(ci) = 100
						}
					}
				}
				if (stat == 1) {
					goto *label_1413
				}
				goto *label_1617
			}
		}
	}
	if (act == (-4)) {
		cNextX(cc) = rnd(3) - 1 + cX(cc)
		cNextY(cc) = rnd(3) - 1 + cY(cc)
		cell_check cNextX(cc), cNextY(cc)
		if (cellaccess == 1) {
			goto *label_1429
		}
		goto *label_1617
	}
	if (act == (-2)) {
		if (distance < 6) {
			if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc))) {
				gosub *label_1299
				if (stat == 1) {
					gosub *label_1441
					goto *label_1617
				}
			}
		}
	}
	if (act >= 400) {
		if (act < 600) {
			efid = act
			gosub *label_1773
			if (stat == 1) {
				goto *label_1617
			} else {
				if (stat == 2) {
					goto *label_1424
				}
			}
		}
	}
	if (act >= 600) {
		efid = act
		gosub *label_1775
		if (stat == 1) {
			ctalk cc, 427, cc, tc
		}
		gosub *label_1396
		if (stat == 1) {
			gosub *label_1775
			if (stat == 1) {
				ctalk cc, 428, cc, tc
			}
			goto *label_1617
		}
	}
	if (act == (-3)) {
		if (distance == 1) {
			gosub *label_1442
			gosub *label_1848
		} else {
			if (rnd(3) == 0 | petcheck(cc)) {
				if (distance < 6 + (gettrait(cc, 66) > 0) * 3) {
					if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc))) {
						gosub *label_1299
						if (stat == 1) {
							gosub *label_1441
						}
					}
				}
			}
		}
		goto *label_1617
	}
	if (distance == 1) {
		gosub *label_1442
		gosub *label_1848
		goto *label_1617
	}
	if (distance < 6 + (gettrait(cc, 66) > 0) * 3) {
		if (fov_los(cX(cc), cY(cc), cX(tc), cY(tc))) {
			gosub *label_1299
			if (stat == 1) {
				gosub *label_1441
				goto *label_1617
			}
		}
	}
	if (cAiDist(cc) <= distance) {
		if (rnd(3) == 0) {
			goto *label_1617
		}
	}
	if (rnd(5) == 0) {
		cHate(cc)--
	}
	if (rnd(100) < cAiMove(cc)) {
		goto *label_1567
	}
	goto *label_1617
*label_1571
	page = quickpage
	listmax = 0
	snd 5
	cs = -1
*label_1572
	listmax = 0
	if (page == 3) {
		page = 2
	}
	if (page == (-1)) {
		page = 0
	}
	if (page == 0) {
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("ヘルプ", "Help"), key_help
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("ログ", "Log"), key_msglog
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("シート", "Chara"), key_charainfo
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("日誌", "Journal"), key_journal
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("信仰", "God"), cfg_key_godinfo
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
	}
	if (page == 1) {
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("装備", "Wear"), key_wear
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("休息", "Rest"), key_rest
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("魔法", "Spell"), key_cast
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("技能", "Skill"), key_skill
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("射撃", "Fire"), key_fire
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("掘る", "Dig"), key_dig
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
	}
	if (page == 2) {
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("祈る", "Pray"), key_pray
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("装填", "Ammo"), key_ammo
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("干渉", "Interact"), key_interact
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("体当り", "Bash"), key_bash
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("大魔法", "Ancient"), cfg_key_cast_ancient
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("異界魔法", "Another"), cfg_key_cast_another
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
	}
	s = lang("情報", "Info"), lang("行動", "Action"), lang("特殊", "Etc"), "null"
	p = page - 1
	if (p == (-1)) {
		p = 3
	}
	listn(0, 0) = s(p)
	listn(0, 4) = s(page)
	p = page + 1
	if (p == 3) {
		p = 3
	}
	listn(0, 8) = s(p)
	t = 0
*label_1573
	redraw 0
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	tx = 50
	ty = windowh - 255
	x = 25, 50, 50, 100, 100, 100, 150, 150, 175
	y = 50, 15, 85, 0, 50, 100, 15, 85, 50
	s = "○コマンド"
	gmode 2
	repeat 9
		p = cnt
		if (listn(0, p) == "null") {
			continue
		}
		pos x(cnt) + tx, y(cnt) + ty
		if (cnt == 0 | cnt == 4 | cnt == 8) {
			gcopy 3, 360, 192, 48, 48
		} else {
			gcopy 3, 360, 144, 48, 48
		}
		gmode 5, , , (t + cnt) \ 10 * (t + cnt) \ 10 * 12 * ((t + cnt) \ 50 < 10)
		if (cs == cnt) {
			gmode 5, , , 140
		}
		pos x(cnt) + tx, y(cnt) + ty
		if (cnt == 0 | cnt == 4 | cnt == 8) {
			gcopy 3, 360, 192, 48, 48
		} else {
			gcopy 3, 360, 144, 48, 48
		}
		gmode 2
		s = listn(0, p)
		pos x(cnt) + tx + 25 - strlen(s) * 3, y(cnt) + ty + 19
		color 0, 0, 0
		bmes s, 255, 255, 255
	loop
	t++
	redraw 1
	await cfg_wait1
	key_check 2
	if (key == key_north) {
		key = listn(1, 3)
		cs = 3
	}
	if (key == key_south) {
		key = listn(1, 5)
		cs = 5
	}
	if (key == key_west) {
		cs = 0
	}
	if (key == key_east) {
		cs = 8
	}
	if (key == key_northwest) {
		key = listn(1, 1)
		cs = 1
	}
	if (key == key_northeast) {
		key = listn(1, 6)
		cs = 6
	}
	if (key == key_southwest) {
		key = listn(1, 2)
		cs = 2
	}
	if (key == key_southeast) {
		key = listn(1, 7)
		cs = 7
	}
	if (key == key_cancel) {
		cs = -1
		snd 5
		key = ""
		goto *label_1574
	}
	if (key != "") {
		if (cs == (-1)) {
			snd 5
			key = ""
			goto *label_1574
		}
		if (key == key_enter) {
			key = listn(1, cs)
			goto *label_1574
		}
	}
	if (key == "" | cs == 1 | cs == 6 | cs == 2 | cs == 7) {
		if (cs != (-1)) {
			key = listn(1, cs)
			goto *label_1574
		}
	}
	goto *label_1573
*label_1574
	if (cs == 0 | key == key_northeast) {
		cs = -1
		snd 5
		page--
		screenupdate = -1
		gosub *label_0623
		goto *label_1572
	}
	if (cs == 8 | key == key_northwest) {
		cs = -1
		snd 5
		page++
		screenupdate = -1
		gosub *label_0623
		goto *label_1572
	}
	quickpage = page
	cs = 0
	gosub *label_0623
	quickkeywait = 1
	return
*label_1575
	gsel 3
	pos 960, 96
	picload_ exedir + "\\graphic\\deco_help.bmp", 1
	gsel 0
	page = 0
	notesel buff
	noteload exedir + "data\\exhelp.txt"
	p = instr(buff, 0, "%" + ghelp + "," + lang("JP", "EN"))
	if (p == (-1)) {
		dialog "help index not found " + "%" + ghelp + "," + lang("JP", "EN")
		return
	}
	buff = strmid(buff, p, instr(buff, p, "%END"))
	notedel 0
	if (noteinfo(0) == 0) {
		return
	}
	throwsstpevent "TravelGuide", 0, "", ghelp
	snd 53
	repeat
		redraw 0
		gmode 2
		dx = 480
		dy = 175
		window2 (windoww - dx) / 2 + inf_screenx, winposy(dy), dx, dy, 4, 0
		wx = (windoww - dx) / 2 + inf_screenx
		wy = winposy(dy)
		window2 (windoww - 325) / 2 + inf_screenx, winposy(dy) + 6, 325, 32, 0, 1
		pos wx + 5, wy + 4
		gcopy 3, 960, 96, 48, 48
		pos wx + dx - 55, wy + 4
		gcopy 3, 960, 96, 48, 48
		pos wx + 10, wy + 42
		gcopy 3, 960, 144, 96, 120
		font lang(cfg_font1, cfg_font2), 16 - en * 2, 1
		pos wx + 142, wy + 13
		color 80, 60, 50
		bmes lang("- ノルンの冒険ガイド -", "- Norne's travel guide -"), 255, 245, 235
		tx = wx + 120
		ty = wy + 55
		font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
		color 30, 30, 30
		gmesx = tx
		gmesy = ty
		gmesw = 330
		gmescol = 30, 30, 30
		gmestype = 1
		repeat 10
			noteget s, page
			page++
			if (page > noteinfo(0) | s == "") {
				break
			}
			gmes s
		loop
		gmode 2
		redraw 1
		help_halt
		if (page >= noteinfo(0)) {
			break
		}
	loop
	return
*label_1576
	if (jp) {
		return
	}
	repeat 24
		if (instr(s(cnt), 0, "(") == (-1)) {
			continue
		}
		s(cnt) = cnven(strmid(s(cnt), instr(s(cnt), 0, "(") + 1, instr(s(cnt), 0, ")") - instr(s(cnt), 0, "(") - 1))
	loop
	return
*label_1577
	snd 26
	listmax = 0
	page = 0
	pagesize = 18
	cs = 0
	cc = 0
	cs_bk = -1
	page_bk = 0
	cs_bk2 = 0
	if (mode != 1) {
		gsel 4
		repeat 8
			pos cnt \ 4 * 180, cnt / 4 * 300
			picload_ exedir + "graphic\\g" + (cnt + 1) + ".bmp", 1
		loop
		gsel 0
	} else {
		cs = 3
		cs_bk2 = cs
	}
	notesel buff
	noteload exedir + "data\\" + lang("manual_JP.txt", "manual_ENG.txt")
	list(0, 0) = 0
	listn(0, 0) = lang("キーの一覧", "Key List")
	listmax++
	repeat noteinfo(0)
		noteget q, cnt
		p = instr(q, 0, "{}")
		if (p != (-1)) {
			list(0, listmax) = cnt + 1
			listn(0, listmax) = strmid(q, instr(q, 0, "}") + 2, 999)
			listmax++
		}
	loop
	windowshadow = 1
*label_1578
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1579
	redraw 0
	s = "Elona In-Game Help", strhint2 + strhint3b
	if (mode == 1) {
		display_window (windoww - 780) / 2 + inf_screenx, winposy(496, 1), 780, 496
	} else {
		display_window (windoww - 780) / 2 + inf_screenx, winposy(496) - 24, 780, 496
	}
	display_topic lang("項目", "Topic"), wx + 34, wy + 36
	if (mode == 1) {
		p = 2
	} else {
		p = 4
	}
	cmbg = page \ 5
	x = ww / 5 * 2
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 4, wy + wh / 2
	grotate p, cmbg \ 4 * 180, cmbg / 4 \ 2 * 300, 0, x, y
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
	loop
	if (cs_bk2 == 0 & page_bk == 0) {
		x = wx + 188
		y = wy + 6
		display_topic lang("アイテムに関するキー", "Item Keys"), x + 18, y + 30
		display_topic lang("行動に関するキー", "Action Keys"), x + 18, y + 142
		display_topic lang("情報に関するキー", "Information Keys"), x + 18, y + 256
		display_topic lang("その他のキー", "Other Keys"), x + 18, y + 328
		color 0, 0, 0
		s = "アイテムを取る(get)", key_get, "アイテムを置く(drop)", key_drop, "アイテムを調べる(examine)", key_inventory, "装備する(wear,wield)", key_wear, "食べる(eat)", key_eat
		s(10) = "飲む(quaff)", key_drink, "読む(read)", key_read, "振る(zap)", key_zap, "道具を使う(tool)", key_use, "調合(blend)", key_dip, "投げる(throw)", key_throw, "装填(ammo)", key_ammo
		gosub *label_1576
		repeat 12
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 6 * 290, y + 58 + cnt \ 6 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 6 * 290, y + 57 + cnt \ 6 * 14
			mes s(cnt * 2 + 1)
		loop
		s = "周囲を調べる(search)", key_search, "魔法を唱える(cast)", key_cast, "干渉する(interact)", key_interact, "階段を降りる,入る(go down)", key_godown, "階段を昇る(go up)", key_goup
		s(10) = "その場で待機(wait)", key_wait, "ターゲットを指定(target)", key_target, "射撃する(fire)", key_fire, "能力を使う(apply)", key_skill, "体当たりする(bash)", key_bash, "穴を掘る(dig)", key_dig, "鍵を開ける(open)", key_open, "", ""
		gosub *label_1576
		repeat 12
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 6 * 290, y + 170 + cnt \ 6 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 6 * 290, y + 169 + cnt \ 6 * 14
			mes s(cnt * 2 + 1)
		loop
		s = "能力・スキル情報(chara)", key_charainfo, "冒険日誌を表示(journal)", key_journal, "ヘルプを表示(help)", key_help, "メッセージログを表示(log)", key_msglog
		s(8) = "マテリアル表示(material)", key_material, "特徴の表示(feat)", key_trait
		gosub *label_1576
		repeat 6
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 3 * 290, y + 284 + cnt \ 3 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 3 * 290, y + 283 + cnt \ 3 * 14
			mes s(cnt * 2 + 1)
		loop
		s = "セーブして終了(save)", key_save, "神に祈る(pray)", key_pray, "神に捧げる(offer)", key_offer, "ドアを閉める(close)", key_close, "与える(give)", key_give, "", "", ""
		gosub *label_1576
		repeat 6
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 3 * 290, y + 356 + cnt \ 3 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 3 * 290, y + 355 + cnt \ 3 * 14
			mes s(cnt * 2 + 1)
		loop
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		pos x + 38, y + 408
		mes lang("F8 マップのエクスポート  F9 インタフェース非表示  F11 キャラ情報の出力\nF12 コンソールの表示", "F8 Export map  F9 Hide interface  F11 Export chara sheet\nF12 Console")
	} else {
		s(1) = listn(0, pagesize * page_bk + cs_bk2)
		display_topic s(1), wx + 206, wy + 36
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		p = list(0, pagesize * page_bk + cs_bk2)
		gmesx = wx + 216
		gmesy = wy + 60
		gmesw = 510
		gmescol = 30, 30, 30
		gmestype = 0
		repeat noteinfo(0) - p, p
			noteget s1, cnt
			i = instr(s1, 0, "{")
			if (i != (-1)) {
				break
			}
			gmes s1
		loop
	}
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		cs_list s, wx + 66, wy + 66 + cnt * 19 - 1, 19, 0
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if (p != (-1)) {
		snd 20
		page_bk = page
		cs_bk2 = cs
		goto *label_1578
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1578
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1578
		}
	}
	if (key == key_cancel) {
		return
	}
	goto *label_1579
*label_1580
*label_1581
	curmenu = 2
	key_list(0) = key_enter
	keyrange = 0
	pagesize = 0
	redraw 0
	gsel 7
	pos 0, 0
	picload_ exedir + "graphic\\ie_scroll.bmp"
	gsel 0
	windowshadow = 1
	snd 92
	drawmenu 2
	ww = limit(windoww - 90, windoww - 90, 720)
	wh = 440
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	windowanime wx, wy, ww, wh, 10, 4
	s = lang("何かキーを押すと閉じる", "Hit any key to close")
	showscroll wx, wy, ww, wh
	net_read
	buff = ""
	notesel buff
	header = instr(netbuf, 0, "<!--START-->") + 13
	repeat
		s = ""
		tail = instr(netbuf, header, "%")
		if (tail == (-1)) {
			break
		}
		header += tail + 1
		tail = instr(netbuf, header, "%")
		s += strmid(netbuf, header, tail) + "  "
		header += tail + 1
		tail = instr(netbuf, header, "%")
		s += strmid(netbuf, header + 4, tail - 4)
		header += tail + 1
		tail = instr(netbuf, header, "%")
		header += tail + 2
		s += "\n"
		buff += "" + s
	loop
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	color 30, 20, 10
	i = 0
	repeat 20
		if (i >= 20) {
			break
		}
		noteget s, cnt
		if (en) {
			cnv_str s, "&quot;", "\""
		}
		if (s == "") {
			if (cnt == 0) {
				s = "No new messages received."
			}
			break
		}
		talk_conv s, (ww - 110 - en * 50) / 7
		i += stat
		pos wx + 48, (19 - i) * 16 + wy + 48
		mes s
		i++
	loop
	redraw 1
*label_1582
	await cfg_wait1
	key_check
	cursor_check
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 2) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 2
				}
			}
			key = ""
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					goto *label_1583
				}
				if (curmenu == 1) {
					goto *label_1179
				}
				if (curmenu == 2) {
					goto *label_1580
				}
			}
		}
	}
	if (key != "") {
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1582
*label_1583
*label_1584
	curmenu = 0
	windowshadow = 1
	key_list(0) = key_enter
	keyrange = 0
	pagesize = 0
	redraw 0
	wx = inf_msgx - 2
	wy = inf_msgy - (inf_maxlog - 3) * inf_msgspace - 1
	ww = windoww - inf_msgx + 6
	wh = (inf_maxlog - 3) * inf_msgspace, 1, -1
	snd 93
	showtitle lang("過去のメッセージ", "Log"), lang("何かキーを押すと閉じる", "Hit any key to close"), 236, 1
	drawmenu 2
	windowanimecorner wx, wy, ww, wh, 8, 4
	if (cfg_exlog) {
		p = (windoww - inf_msgx) / 192
		window2 wx, wy, ww, wh, 1, -1
		repeat inf_maxlog - 3
			cnt2 = cnt
			pos cnt
			repeat p + 1
				if (cnt == p) {
					x = (windoww - inf_msgx) \ 192
				} else {
					x = 192
				}
				pos cnt * 192 + inf_msgx, inf_msgy - (cnt2 + 1) * inf_msgspace
				gcopy 3, 496, 536 + cnt2 \ 4 * inf_msgspace, x, inf_msgspace
			loop
		loop
		repeat p + 1
			if (cnt == p) {
				sx = (windoww - inf_msgx) \ 192
			} else {
				sx = 192
			}
			pos cnt * 192 + inf_msgx, inf_msgy
			gcopy 3, 496, 528, sx, 6
		loop
		gsel 4
		gmode 0
		color 0, 0, 0
		boxf
		repeat inf_maxlog - 3
			p = msgline - cnt - 3
			if (p < 0) {
				p += inf_maxlog
			} else {
				if (p >= inf_maxlog) {
					p -= inf_maxlog
				}
			}
			if (p < 0) {
				continue
			}
			pos inf_msgx, inf_msgy - cnt * inf_msgspace
			gcopy 8, 0, p * inf_msgspace, windoww - inf_msgx, inf_msgspace
		loop
		gsel 0
		gmode 2
		pos 0, -3
		gcopy 4, 0, 0, windoww, inf_msgy
	} else {
		gsel 4
		repeat 8
			pos cnt \ 4 * 180, cnt / 4 * 300
			picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
		loop
		gsel 0
		s = lang("過去のメッセージ", "Log"), lang("何かキーを押すと閉じる", "Hit any key to close")
		x = windoww - 90
		display_window (windoww - x) / 2 + inf_screenx, winposy(432), x, 432
		display_topic lang("メッセージログの内容", "Message"), wx + 28, wy + 30
		cmbg++
		x = ww / 5 * 2
		y = wh - 80
		gmode 4, 180, 300, 50
		pos wx + ww / 4, wy + wh / 2
		grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 20
			p = msgline - cnt
			if (p < 0) {
				p += inf_maxlog
			} else {
				if (p >= inf_maxlog) {
					p -= inf_maxlog
				}
			}
			if (p < 0) {
				continue
			}
			pos wx + 28, (19 - cnt) * 16 + wy + 58
			mes msg(p)
		loop
	}
	redraw 1
*label_1585
	await cfg_wait1
	key_check
	cursor_check
	if (menucycle == 1) {
		if (key == key_next | key == key_prev) {
			p = curmenu
			if (key == key_next) {
				curmenu++
				if (curmenu > 2) {
					curmenu = 0
				}
			}
			if (key == key_prev) {
				curmenu--
				if (curmenu < 0) {
					curmenu = 2
				}
			}
			key = ""
			if (p != curmenu) {
				screenupdate = -1
				gosub *label_0623
				if (curmenu == 0) {
					goto *label_1583
				}
				if (curmenu == 1) {
					goto *label_1179
				}
				if (curmenu == 2) {
					goto *label_1580
				}
			}
		}
	}
	if (key != "") {
		if (gCurrentMap == 40 | gCurrentMap == 49) {
			goto *label_1620
		}
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1585

#include "config.hsp"

*label_1602
	snd 59
	gsel 4
	pos 0, 0
	picload_ exedir + "graphic\\book.bmp", 1
	gsel 7
	pos 0, 0
	picload_ exedir + "\\graphic\\g1.bmp", 0
	gsel 0
	listmax = 0
	page = 0
	pagesize = 12
	cs = 0
	cc = 0
	notesel buff
	noteload lang("scene1.hsp", "scene2.hsp")
	p = 0
	repeat 200
		s = "{" + cnt + "}"
		p = instr(buff, 0, s)
		if (p != (-1)) {
			if (cnt <= gPlayedScene) {
				list(0, listmax) = cnt, p
				listmax++
			}
		}
	loop
	redraw 0
	txt -1, lang("どのシーンを再生する？", "Which scene do you want to replay?")
*label_1603
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	wx = (windoww - 720) / 2 + inf_screenx
	wy = winposy(468)
*label_1604
	redraw 0
	pos wx, wy
	gcopy 4, 0, 0, 736, 448
	x = 240
	y = 320
	gmode 4, 180, 300, 100
	color 0, 0, 0
	pos wx + 190, wy + 220
	grotate 7, 0, 0, 0, x, y
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		display_key wx + 394, wy + 91 + cnt * 22 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 6
	color 0, 0, 0
	pos wx + 90, wy + 50
	mes "Elona - Scene playback"
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 0
	color 0, 0, 0
	pos wx + 390, wy + 50
	mes lang("アンロックされたシーンを再生できます。\nシーンNoは連続していません。", "You can play the unlocked scenes.")
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		cs_list lang("シーン No.", "Scene No. ") + i, wx + 424, wy + 91 + cnt * 22 - 1, 19
	loop
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
	color 0, 0, 0
	pos wx + 500, wy + 375
	mes "- " + (page + 1) + " -"
	if (page < pagemax) {
		pos wx + 590, wy + 375
		mes "(more)"
	}
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		sceneid = p
		gosub *label_1553
		screenupdate = -1
		gosub *label_0621
		txtnew
		txt -1, lang("シーンの再生を終えた。", "The scene has been played.")
		goto *label_1602
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 71
			page++
			goto *label_1603
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 71
			page--
			goto *label_1603
		}
	}
	if (key == key_cancel | key == key_enter) {
		gosub *label_0122
		gosub *label_0623
		goto *label_1623
	}
	goto *label_1604
*label_1605
	inv_getheader 0
	p = 0, 0
	p = 0, 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		i = refitem(iId(cnt), 5, cnt)
		if (i != 53000 & i != 52000 & i != 56000 & i != 54000 & i >= 50000) {
			continue
		}
		if (iIdentificationState(cnt) < 5) {
			item_identify cnt, 250, -1
			item_stack 0, cnt
			p(1)++
			if (idtresult == 5) {
				p++
			}
		}
	loop
	return
*label_1606
	gYear = 517, 8, 12, 16, 10
	quickpage = 1
	if (defload != "") {
		exist exedir + "save\\" + defload + "\\header.txt"
		if (strsize == (-1)) {
			exist exedir + "save\\sav_" + defload + "\\header.txt"
			if (strsize != (-1)) {
				defload = "sav_" + defload
			} else {
				defload = ""
			}
		}
		if (defload == "") {
			dialog "Invalid defLoadFolder. name"
		} else {
			buff = ""
			notesel buff
			file = exedir + "save\\trophy"
			exist file + ".txt"
			if (strsize != (-1)) {
				noteload file + ".txt"
				repeat noteinfo(0)
					noteget troget, cnt
					trophy(cnt) = int(troget)
				loop
			}
			playerid = defload
			mode = 3
			music = 0
			goto *label_1607
		}
	}
	buff = ""
	notesel buff
	file = exedir + "save\\trophy"
	exist file + ".txt"
	if (strsize != (-1)) {
		noteload file + ".txt"
		repeat noteinfo(0)
			noteget troget, cnt
			trophy(cnt) = int(troget)
		loop
	}
	goto *label_1341
*label_1607
	mtilefilecur = -1
	firstturn = 1
	msgtemp = "  Lafrontier presents Elona ver " + "1.22" + ". Welcome traveler! "
	if (cfg_NC_saveconfig & mode != 5) {
		gosub *label_1590
		gosub *label_1591
		gosub *label_1592
	}
	if (cfg_net) {
		gosub *label_0601
	}
	if (mode == 4) {
		repeat 9
			gdata(120 + cnt) = 5000
		loop
		gVersion = int(double("1.22") * 1000)
		gdata(40 + 1) = 424
		gdata(40 + 2) = 300
		gdata(40 + 3) = 631
		gNextInventorySerialId = 1000
		gNextShelterSerialId = 100
		dbgchara = 23
		playerid = "sav_noa"
		gPcXInWorldMap = 22
		gPcYInWorldMap = 21
		gPreviousMap = -1
		gRandomSeed = rnd(800) + 2
		gdata(9) = rnd(200) + 2
		gCurrentMap = 4
		gCurrentDungeonLevel = 0
		gEntranceType = 7
		mapstartx = 22
		mapstarty = 21
		gCurrentMap = 5
		gCurrentDungeonLevel = 1
		gEntranceType = 7
		mapstartx = 10
		mapstarty = 23
		initlv = 50
		rc = 0
		flt 100
		characreate 0, 84, -3, 0
		gosub *label_0736
		repeat 3
		loop
		gYear = 517, 12, 30, 1, 10
		gPlayedScene = 50
		gdata(250 + 7) = 1
		areaOuterMap(7) = 4
		gdata(850) = areaOuterMap(gCurrentMap)
		gAcquirableFeatCount = 2
		gSaveCountOfLittleSister = 1000
		gRightsToSucceedTo = 1000
		gHomeScale = 0
		gNumberOfWaitingGuests = 2
		gChargePower = 1000
		cGod(0) = 2, 1000, 1000
		gdata(250 + 203) = 1000
		se_moneymod 0, 1000000
		cPlatinumCoin(0) = 30
		cFame(0) = 65000
		gdata(250 + 2) = 100
		r1 = 0
		gosub *chara_refresh
		flt
		itemcreate 0, 284, -1, -1, 0
		iNumber(ci) = 20
		iCurseState(ci) = 1
		flt
		itemcreate 0, 127, -1, -1, 0
		iNumber(ci) = 20
		iCurseState(ci) = 1
		flt
		itemcreate 0, 617, -1, -1, 0
		iNumber(ci) = 20
		flt
		itemcreate 0, 671, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 749, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 748, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 601, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 342, -1, -1, 0
		iNumber(ci) = 12
		flt
		itemcreate 0, 343, -1, -1, 0
		iNumber(ci) = 50
		flt
		itemcreate 0, 519, -1, -1, 0
		iNumber(ci) = 50
		iColor(ci) = 4
		flt
		itemcreate 0, 622, -1, -1, 0
		iNumber(ci) = 50000
		flt
		itemcreate 0, 603, -1, -1, 0
		iNumber(ci) = 5
		flt
		itemcreate 0, 620, -1, -1, 0
		iNumber(ci) = 5
		flt
		itemcreate 0, 736, -1, -1, 0
		iNumber(ci) = 5
		flt
		itemcreate 0, 566, -1, -1, 0
		iNumber(ci) = 5
		flt
		itemcreate 0, 516, -1, -1, 0
		iNumber(ci) = 5
		iCurseState(ci) = 1
		flt
		itemcreate 0, 262, -1, -1, 0
		iNumber(ci) = 5
		flt
		itemcreate 0, 632, -1, -1, 0
		iNumber(ci) = 10
		iCurseState(ci) = -1
		flt
		itemcreate 0, 632, -1, -1, 0
		iNumber(ci) = 10
		iCurseState(ci) = 0
		flt
		itemcreate 0, 204, -1, -1, 0
		iSubname(ci) = 330
		iNumber(ci) = 10
		flt
		itemcreate 0, 636, -1, -1, 0
		iNumber(ci) = 3
		iCurseState(ci) = 0
		flt
		itemcreate 0, 342, -1, -1, 0
		iCount(ci) = 100
		flt
		itemcreate 0, 350, -1, -1, 0
		iNumber(ci) = 20
		flt
		itemcreate 0, 707, -1, -1, 0
		flt
		itemcreate 0, 719, -1, -1, 0
		flt
		itemcreate 0, 666, -1, -1, 0
		flt
		itemcreate 0, 686, -1, -1, 0
		flt
		itemcreate 0, 721, -1, -1, 0
		flt
		itemcreate 0, 772, -1, -1, 0
		flt
		itemcreate 0, 773, -1, -1, 0
		flt
		itemcreate 0, 774, -1, -1, 0
		flt
		itemcreate 0, 775, -1, -1, 0
		flt
		itemcreate 0, 776, -1, -1, 0
		flt
		itemcreate 0, 777, -1, -1, 0
		flt
		itemcreate 0, 778, -1, -1, 0
		flt
		itemcreate 0, 779, -1, -1, 0
		flt
		itemcreate 0, 780, -1, -1, 0
		flt
		itemcreate 0, 781, -1, -1, 0
		flt
		itemcreate 0, 782, -1, -1, 0
		flt
		itemcreate 0, 784, -1, -1, 0
		flt
		itemcreate 0, 785, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 786, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 787, -1, -1, 0
		flt
		itemcreate 0, 788, -1, -1, 0
		flt
		itemcreate 0, 789, -1, -1, 0
		flt
		itemcreate 0, 790, -1, -1, 0
		flt
		itemcreate 0, 791, -1, -1, 0
		flt
		itemcreate 0, 792, -1, -1, 0
		flt
		itemcreate 0, 260, -1, -1, 0
		iNumber(ci) = 100
		gdata(40 + 1) = 789 + 14 * 10000
		gdata(40 + 2) = 790 + 14 * 10000
		repeat 1200
			recipememory(cnt) = 1
		loop
		flt
		itemcreate 0, 783, -1, -1, 0
		flt
		itemcreate 0, 783, -1, -1, 0
		flt
		itemcreate 0, 783, -1, -1, 0
		iSubname(ci) = 787 + 400
		flt
		itemcreate 0, 783, -1, -1, 0
		iSubname(ci) = 555 + 400
		itemcreate 0, 672, -1, -1, 0
		iParam1(ci) = 164
		flt
		itemcreate 0, 566, -1, -1, 0
		iNumber(ci) = 10
		iCurseState(ci) = 1
		flt
		itemcreate 0, 566, -1, -1, 0
		iNumber(ci) = 10
		iCurseState(ci) = -1
		flt
		itemcreate 0, 566, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 55, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 385, -1, -1, 0
		iNumber(ci) = 10
		flt
		itemcreate 0, 672, -1, -1, 0
		iNumber(ci) = 10
		iParam1(ci) = 169
		flt
		itemcreate 0, 672, -1, -1, 0
		iNumber(ci) = 10
		iParam1(ci) = 162
		flt
		itemcreate 0, 771, -1, -1, 0
		iNumber(ci) = 100
		flt
		itemcreate 0, 761, -1, -1, 0
		flt
		itemcreate 0, 769, -1, -1, 0
		flt
		itemcreate 0, 763, -1, -1, 0
		flt
		itemcreate 0, 764, -1, -1, 0
		flt
		itemcreate 0, 768, -1, -1, 0
		flt
		itemcreate 0, 766, -1, -1, 0
		flt
		itemcreate 0, 752, -1, -1, 0
		if (stat != 0) {
			iParam3(ci) = 240
			iNumber(ci) = 50
		}
		flt
		itemcreate 0, 755, -1, -1, 0
		if (stat != 0) {
			iParam3(ci) = 240
			iNumber(ci) = 50
		}
		flt
		itemcreate 0, 756, -1, -1, 0
		if (stat != 0) {
			iParam3(ci) = 240
			iNumber(ci) = 50
		}
		repeat 40
			flt 50, 5
			flttypemajor = 56000
			itemcreate 0, -1, -1, -1, 0
			flt 50, 5
			flttypemajor = 34000
			itemcreate 0, -1, -1, -1, 0
			flt 50, 5
			flttypemajor = 32000
			itemcreate 0, -1, -1, -1, 0
		loop
		cbitmod 20, 0, 1
		mode = 0
		gosub *refreshPCBurdenState
		repeat 55
			mat(cnt) = 200
		loop
		gosub *label_1532
		create_pcpic 0, 1
		cdatan(1, 0) = random_title()
		cdatan(0, 0) = randomname()
		mode = 2
	}
	if (mode == 5) {
		gYear = 517, 8, 12, 1, 10
		gPcXInWorldMap = 22
		gPcYInWorldMap = 21
		gPreviousMap = -1
		gdata(850) = 4
		ghelp = 1
		gCurrentMap = 7
		gCurrentDungeonLevel = 1
		gEntranceType = 4
		gHomeScale = 0
		gosub *label_0953
		gVersion = int(double("1.22") * 1000)
		gWeather = 3, 6
		repeat 20
			gdata(120 + cnt) = 10000
		loop
		gosub *label_1532
		if (gettrait(0, 184) < 0) {
			gdata(250 + 7) = 1
		}
		r1 = 0
		gosub *chara_refresh
		initializeSouthTyrisTowns
		mode = 2
		evadd 2
		evadd 24
		sceneid = 0
		gosub *label_1553
	}
	if (mode == 2) {
		gNextInventorySerialId = 1000
		gNextShelterSerialId = 100
		gosub *blending_clearRecipeMemory
		throwsstpevent "NewGame", 0, "", 0
	}
	if (mode == 3) {
		gosub *label_1338
	}
	gosub *label_1347
	if (cfg_NC_logapply == 1) {
		NNetflag = 0
		rndtextid = rnd(3)
		s = "お兄ちゃ〜ん", "…本当に起動してしまったのか？", "うみみゃあ！！"
		s = lang("" + cdatan(1, 0) + " " + cdatan(0, 0) + "がゲームを起動しました。" + s(rndtextid), "" + cdatan(1, 0) + " " + cdatan(0, 0) + " has launched the game.")
		gosub *label_NNet
	}
	goto *label_0942
*label_1608
	oomSEST_log "main_init:Begin"
	sound = 0
	ct = 0
	repeat 200
		if (mef(0, cnt) == 0) {
			break
		}
		if (mef(0, cnt) == 5) {
			if (mapIndoorOrOutdoor == 2) {
				if (mapType != 1) {
					if (gWeather == 3 | gWeather == 4) {
						delmef cnt
						continue
					}
					dx = mef(2, cnt)
					dy = mef(3, cnt)
					i = mef(6, cnt)
					p = 0
					if (rnd(35) == 0) {
						p = 3
						if (dist(dx, dy, cX(0), cY(0)) < 6) {
							sound = 6
						}
					}
					repeat p
						x = rnd(2) + dx - rnd(2)
						y = rnd(2) + dy - rnd(2)
						if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
							f = 0
							continue
						}
						if (chipm(7, map(x, y, 0)) & 4) {
							map(x, y, 0) = 37
							continue 0
						}
						addmef x, y, 5, 24, rnd(15) + 20, 50, i
						mapitem_fire x, y
					loop
				}
			}
		}
		if (mef(0, cnt) == 7) {
			txtef 3
			txt -1, lang(" *", "*") + mef(4, cnt) + lang("* ", "*")
		}
		if (mef(4, cnt) != (-1)) {
			mef(4, cnt)--
			if (mef(4, cnt) == 0) {
				delmef cnt
			}
		}
	loop
	if (sound != 0) {
		snd sound
	}
	gspd = cCurrentSpeed(0) * (100 + cSpeedPercentage(0)) / 100
	if (gspd < 10) {
		gspd = 10
	}
	turncost = (mapTurnCost - cTurnCost(0)) / gspd + 1
	if (evnum != 0) {
		evproc = 1
		gosub *label_1630
		evproc = 0
		evnum--
		evlist(evnum) = 0
		if (chatteleport == 1) {
			chatteleport = 0
			goto *label_0939
		}
		goto *label_1608
	}
	if (cState(0) != 1) {
		goto *label_1628
	}
	if (mapType == 1) {
		if (cContinuousActionTurn(0) > 2) {
			cTurnCost(0) = mapTurnCost
			goto *label_1609
		}
	}
	repeat 245
		if (cState(cnt) != 1) {
			continue
		}
		spd = cCurrentSpeed(cnt) * (100 + cSpeedPercentage(cnt)) / 100
		if (spd < 10) {
			spd = 10
		}
		cTurnCost(cnt) += spd * turncost
	loop
*label_1609
	gSecond += turncost / 5 + 1
	if (gSecond >= 60) {
		gPlayTurns++
		cc = 0
		if (gPlayTurns \ 20 == 0) {
			gosub *label_0938
		}
		if (gPlayTurns \ 10 == 1) {
			gosub *label_0779
		}
		gMinute += gSecond / 60
		if (gLeftMinutesOfExecutingQuest > 0) {
			gLeftMinutesOfExecutingQuest -= gSecond / 60
			if (gdata(87) > gLeftMinutesOfExecutingQuest / 10) {
				txtef 9
				txt -1, lang("クエスト[残り" + (gLeftMinutesOfExecutingQuest + 1) + "分]", "" + (gLeftMinutesOfExecutingQuest + 1) + " min left for the quest.")
				gdata(87) = gLeftMinutesOfExecutingQuest / 10
				if (gExecutingImmediateQuestType == 1021) {
					nc_intb_001 = -1
					txtef 3
					txt -1, lang("モンスター達が羊に向かっている！", "The monsters are coming towards Sheep!")
					repeat 188, 57
						if (cState(cnt) == 1) {
							if (eqfaction(cnt, "nc_sheep")) {
								nc_intb_001 = cnt
							}
						}
					loop
					repeat 188, 57
						if (cState(cnt) == 1) {
							if (eqfaction(cnt, "nc_sheep") == 0) {
								cRelationship(cnt) = -3
								lockon cnt, nc_intb_001, 29
								cHate(cnt) = 250
							}
						}
					loop
				}
			}
			if (gLeftMinutesOfExecutingQuest <= 0) {
				gLeftMinutesOfExecutingQuest = 0
				evadd 14
			}
		}
		gSecond = gSecond \ 60
		if (gMinute >= 60) {
			gHour += gMinute / 60
			gMinute = gMinute \ 60
			gosub *label_1611
		}
	}
	oomSEST_log "main_init:End"
	goto *label_1612
*label_1610
	if (gWeather == 2) {
		// 雪が降らない地域の場合に雨にする
		// マクロで記述するとうまく条件を反転できなかったので暫定的に直接書く
		if ((isNorthtyris == 0) | (gPcXInWorldMap < 65 & gPcYInWorldMap > 10)) {
			if (gettrait(0, 222) == 0) {
				gWeather = 3
				envonly = 1
				gosub *label_0122
				gHoursUntilWeatherChanges += 3
				txt -1, lang("天候が変わった。", "The weather changes.")
			}
		}
	}
	if (gWeather == 4 | gWeather == 3) {
		if (isColdClimate) {
			gWeather = 2
			envonly = 1
			gosub *label_0122
			gHoursUntilWeatherChanges += 3
			txt -1, lang("天候が変わった。", "The weather changes.")
		}
	}
	return
*label_1611
	oomSEST_log "Advance_hour:Begin"
	if (areaId(gCurrentMap) == 101) {
		gosub *label_0931
	}
	if (gCurrentMap == 7) {
		gosub *housing_calculateHomeValue
	}
	if (mapType == 1) {
		gPcXInWorldMap = cX(0)
		gPcYInWorldMap = cY(0)
	}
	if (gWeather != 1) {
		if (gettrait(0, 222) != 0) {
			gWeather = 2
		}
	}
	gHoursUntilWeatherChanges--
	gosub *label_1610
	if (gHoursUntilWeatherChanges < 0) {
		gHoursUntilWeatherChanges = rnd(22) + 2
		p = gWeather
		repeat 1
			if (gMonth \ 3 == 0) {
				if (gDay >= 1 & gDay <= 10) {
					if (gLastEtherwindMonth != gMonth) {
						if (rnd(15) < gDay + 5) {
							gWeather = 1
							txtef 3
							txt -1, lang("エーテルの風が吹き始めた。すぐに避難しなくては。", "Ether Wind starts to blow. You need to find a shelter!")
							gLastEtherwindMonth = gMonth
							gHoursUntilWeatherChanges = rnd(24) + 24
							break
						}
					}
				}
			}
			if (gWeather != 1) {
				if (gettrait(0, 222) != 0) {
					gWeather = 2
					gHoursUntilWeatherChanges = rnd(12) + 6
					break
				}
			}
			if (p == 0) {
				weatherbk = 0
				if (gettrait(0, 209) != 0) {
					if (rnd(4) == 0) {
						gWeather = 3
						txt -1, lang("あなたは雨雲を引き寄せた。", "You draw a rain cloud.")
						break
					}
				}
				if (isColdClimate) {
					if (rnd(2) == 0) {
						gWeather = 2
						txt -1, lang("雪が降ってきた。", "It starts to snow.")
						break
					}
				} else {
					if (rnd(10) == 0 | (godcheck() == "inari" & rnd(4) == 0)) {
						gWeather = 3
						txt -1, lang("雨が降り出した。", "It starts to rain.")
						break
					}
					if (rnd(40) == 0) {
						gWeather = 4
						txt -1, lang("突然どしゃぶりになった。", "Suddenly, rain begins to pour down from the sky.")
						break
					}
					if (rnd(60) == 0) {
						gWeather = 2
						txt -1, lang("雪が降ってきた。", "It starts to snow.")
						break
					}
				}
			}
			if (p == 3) {
				if (rnd(4) == 0) {
					gWeather = 0
					txt -1, lang("雨は止んだ。", "It stops raining.")
					break
				}
				if (rnd(15) == 0) {
					if (godcheck() != "inari" | rnd(3) == 0) {
						gWeather = 4
						txt -1, lang("雨が本格的に降り出した。", "The rain becomes heavier.")
						if (godcheck() == "serria" & ogdata(545) == 2) {
							gWeather = 0
							txt -1, lang("…しかし、すぐに雨は止んだ。", "...But, the rain soon stopped.")
						}
						break
					}
				}
			}
			if (p == 4) {
				if (rnd(3) == 0) {
					gWeather = 3
					txt -1, lang("雨は小降りになった。", "The rain becomes lighter.")
					break
				}
			}
			if (p == 1) {
				if (rnd(2) == 0 & gWeather == 1) {
					gWeather = 0
					txt -1, lang("エーテルの風は止んだ。", "The Ether Wind dissipates.")
					if (gettrait(0, 222) != 0) {
						gWeather = 2
					}
					break
				}
			}
			if (p == 2) {
				if (rnd(3) == 0) {
					gWeather = 0
					txt -1, lang("雪は止んだ。", "It stops raining.")
					break
				}
			}
		loop
		if (gWeather == 4) {
			if (cfg_extrahelp) {
				if (gdata(200 + 11) == 0) {
					if (mode == 0) {
						if (cContinuousActionTurn(0) == 0) {
							gdata(200 + 11) = 1
							ghelp = 11
							gosub *label_1575
						}
					}
				}
			}
		}
		if (gWeather == 2) {
			if (cfg_extrahelp) {
				if (gdata(200 + 12) == 0) {
					if (mode == 0) {
						if (cContinuousActionTurn(0) == 0) {
							gdata(200 + 12) = 1
							ghelp = 12
							gosub *label_1575
						}
					}
				}
			}
		}
		if (gWeather == 1) {
			if (cfg_extrahelp) {
				if (gdata(200 + 13) == 0) {
					if (mode == 0) {
						if (cContinuousActionTurn(0) == 0) {
							gdata(200 + 13) = 1
							ghelp = 13
							gosub *label_1575
						}
					}
				}
			}
		}
		if (p != gWeather) {
			envonly = 1
			gosub *label_0122
		}
	}
	gosub *label_0947
	gosub *label_1534
	gosub *label_0775
	if (mapType == 1) {
		if (rnd(3) == 0) {
			gContinuousActiveHours++
		}
		if (rnd(15) == 0) {
			if (mode == 0) {
				txt -1, lang("仮眠をとった。", "You take a nap.")
				gContinuousActiveHours -= 3
				if (gContinuousActiveHours < 0) {
					gContinuousActiveHours = 0
				}
			}
		}
	} else {
		if (gCurrentMap != 30) {
			gContinuousActiveHours++
		}
	}
	if (gHour == 6) {
		txtef 5
		txt -1, lang("夜が明けた。", "Day breaks.")
	}
	if (gContinuousActiveHours >= 15) {
		if (cfg_extrahelp) {
			if (gdata(200 + 9) == 0) {
				if (mode == 0) {
					if (cContinuousActionTurn(0) == 0) {
						gdata(200 + 9) = 1
						ghelp = 9
						gosub *label_1575
					}
				}
			}
		}
	}
	if (cNutrition(0) < 5000) {
		if (cfg_extrahelp) {
			if (gdata(200 + 10) == 0) {
				if (mode == 0) {
					if (cContinuousActionTurn(0) == 0) {
						gdata(200 + 10) = 1
						ghelp = 10
						gosub *label_1575
					}
				}
			}
		}
	}
	if (gHour >= 24) {
		if (gNumberOfWaitingGuests < 3 + (ogdata(488) == 2) * 2) {
			if (rnd(8 + gNumberOfWaitingGuests * 5) == 0) {
				gNumberOfWaitingGuests++
			}
		}
		txtef 5
		txt -1, lang("一日が終わり、日付が変わった。", "A day passes and a new day begins.")
		gosub *label_0927
		gosub *label_1754
		gosub *label_1535
		repeat 10
			p = 120 + cnt
			if (gdata(p) >= 10000) {
				gdata(p) = 10000
				continue
			}
			if (cnt == 3 | cnt == 4 | cnt == 5 | cnt == 8) {
				continue
			}
			gdata(140 + cnt)--
			if (gdata(140 + cnt) <= 0) {
				modrank cnt, (gdata(p) / 12 + 100) * (-1)
				gdata(140 + cnt) = ranknorma(cnt)
			}
		loop
		snd 74
		evadd 10
		gPlayDays += gHour / 24
		gDay += gHour / 24
		gHour = gHour \ 24
		if (gDay >= 31) {
			gMonth++
			gDay = gDay - 30
			if (gMonth \ 2 == 0) {
				gdata(250 + 10)++
			}
		}
		if (gMonth >= 13) {
			gYear++
			repeat 16
				if (gettrait(cnt, 131) == 1) {
					cBirthYear(cnt)++
					if (cBirthYear(cnt) > gYear) {
						cBirthYear(cnt) = gYear
					}
				}
			loop
			gMonth = 1
			gLastMonthWhenTrainerVisited = 0
			gWishCount = limit(gWishCount - 1, 0, 10)
			ogdata(31) = 0
			ogbitmod 9, 0
		}
		if (Seasonal_Check(0, 1)) {
			txt -1, lang("今日は妹の日だ。", "Today is younger sister's day.")
		}
		if (Seasonal_Check(1, 1)) {
			txt -1, lang("今日はベイベーの日だ。", "Today's Party Day!")
		}
		if (ogbit(9) == 0) {
			if (Seasonal_Check(2, 1)) {
				txt -1, lang("今日はクリスマスイブだ。", "Today is Christmas Eve.")
			}
			if (Seasonal_Check(3, 1)) {
				txt -1, lang("今日はクリスマスだ。", "Today is Christmas.")
			}
		}
		if (Seasonal_Check(4, 1)) {
			txt -1, lang("今日はバレンタインデーだ。", "Today is Valentine's Day.")
		}
		if (Seasonal_Check(5, 1)) {
			txt -1, lang("今日はアフターバレンタインデーだ。", "Today is After Valentine's Day.")
		}
		/*
		if (Seasonal_Check(6, 1)) {
			txt -1, lang("今日は七草の節句だ。", "Today is Seven herbs Festival.")
		}
		if (Seasonal_Check(7, 1)) {
			txt -1, lang("今日は桃の節句だ。", "Today is Doll's Festival.")
		}
		if (Seasonal_Check(8, 1)) {
			txt -1, lang("今日は納税強化デーだ。", "Today is Tax Week.")
		}
		if (Seasonal_Check(9, 1)) {
			txt -1, lang("今日は愚者の日だ。", "Today is Fools' Day.")
		}
		if (Seasonal_Check(10, 1)) {
			txt -1, lang("今日はドラゴンころしの日だ。", "Today is Dragon Slayer's Day.")
		}
		if (Seasonal_Check(11, 1)) {
			txt -1, lang("今日は黄金週間だ。", "Today is Golden Week.")
		}
		if (Seasonal_Check(12, 1)) {
			txt -1, lang("今日は菖蒲の節句だ。", "Today is Midsummer Festival.")
		}
		if (Seasonal_Check(13, 1)) {
			txt -1, lang("今日は夏至祭だ。", "Today is Iris Festival.")
		}
		if (Seasonal_Check(14, 1)) {
			txt -1, lang("今日は笹の節句だ。", "Today is Weaver's Festival.")
		}
		if (Seasonal_Check(15, 1)) {
			txt -1, lang("今日は銀狼節だ。", "Today is Silver Wolf Days.")
		}
		if (Seasonal_Check(16, 1)) {
			txt -1, lang("今日は納涼祭だ。", "Today is Lantern Festival.")
		}
		if (Seasonal_Check(17, 1)) {
			txt -1, lang("今日は防衛者の日だ。", "Today is Defenders' Day.")
		}
		if (Seasonal_Check(18, 1)) {
			txt -1, lang("今日はハロウィンイブだ。", "Today is Halloween Eve.")
		}
		if (Seasonal_Check(19, 1)) {
			txt -1, lang("今日はハロウィンだ。", "Today is Halloween.")
		}
		*/
		if (gDay == 1 | gDay == 15) {
			gosub *label_1102
		}
	if (ogdata(447) == 2) {
		if (gDay == 1) {
			ogdata(400) = 1
			ogdata(401) = 1
			ogdata(402) = 1
		}
	}
	if (ogdata(535) == 2) {
		if (gDay == 1) {
			ogdata(403) = 1
		}
	}
		if (gdata(250 + 203) == 1 | gdata(250 + 203) == 3 | gdata(250 + 203) == 5 | gdata(250 + 203) == 7 | gdata(250 + 203) == 9) {
			if (areaId(gCurrentMap) != 33) {
				if (rnd(20) == 0) {
					gdata(250 + 203)++
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
		if (ncgdata(155) == 1 | ncgdata(155) == 3) {
			if (areaId(gCurrentMap) != areaId_serria) {
				if (rnd(20) == 0) {
					ncgdata(155)++
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
		if (ncgdata(157) == 10) {
			if (areaId(gCurrentMap) != areaId_khios) {
				if (rnd(20) == 0) {
					ncgdata(157)++
					snd 44
					txtef 2
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
	}
	if (mode == 0) {
		if (mapType == 1) {
			if (rnd(40) == 0) {
				cPietyPoint(0)--
			}
			cPrayingPoint(0) += 4
			if (cPrayingPoint(0) > 2000) {
				cPrayingPoint(0) = 2000
			}
		} else {
			if (rnd(5) == 0) {
				cPietyPoint(0)--
			}
			cPrayingPoint(0) += 32
			if (cPrayingPoint(0) > 2000) {
				cPrayingPoint(0) = 2000
			}
		}
		repeat 15, 1
			if (cState(cnt) != 1) {
				continue
			}
			f = 0
			if (mapType == 1) {
				if (rnd(40) == 0) {
					f = 1
				}
			} else {
				if (rnd(5) == 0) {
					f = 1
				}
			}
			if (f) {
				skillexp2 181, cnt, 200, 6, 1000
				modpiety 5, cnt
			}
		loop
		gosub *label_1718
	}
	if (cPietyPoint(0) < 0) {
		cPietyPoint(0) = 0
	}
	if (cContinuousActionTurn(0) != 0) {
		if (cContinuousActionId(0) != 3) {
			gosub *label_0623
		}
	}
	if (gCurrentMap != 30) {
		if (gCurrentMap != 41) {
			gosub *label_1094
		}
	}
	repeat 245
		dup roopbuf, cdata(0, cnt)
		if (roopbuf == 1) {
			ctalk cnt, 1373, cnt, cnt
		}
		if (roopbuf == 2) {
			ctalk cnt, 1375, cnt, cnt
		}
	loop
	txtgod godcheck(), 2432
	throwsstpevent "Hour", 0, "", 0
	oomSEST_log "Advance_hour:End"
	return
*label_1612
	if (ct >= 245) {
		goto *label_1608
	}
	if (cState(ct) != 1) {
		ct++
		goto *label_1612
	}
	if (cTurnCost(ct) >= mapTurnCost) {
		cTurnCost(ct) -= mapTurnCost
	} else {
		ct++
		goto *label_1612
	}
*label_1613
	cc = ct
	cSpeedPercentage(cc) = cSpeedPercentageInNextTurn(cc)
	cTurn(cc)++
	gosub *label_1616
	if (ct > 0 & ct < 16) {
		p = cTurn(ct) \ 10
		if (p == 1) {
			cc = ct
			gosub *label_0779
		}
		if (p == 2) {
			r1 = ct
			gosub *label_0672
		}
		if (p == 3) {
			r1 = ct
			r2 = 1
			gosub *label_0675
		}
		if (cTurn(ct) \ 20 == 0) {
			r1 = ct
			gosub *label_1712
		}
	}
	if (ct == 0) {
		tnew = 1
		p = carmor(0)
		if (p == 169) {
			pcnoise = 60
		} else {
			if (p == 170) {
				pcnoise = 40
			} else {
				pcnoise = 20
			}
		}
		refreshspeed 0
		gosub *label_1857
		p = cTurn(0) \ 10
		if (p == 1) {
			repeat 16
				if (cState(cnt) == 1) {
					r1 = cnt
					gosub *label_0671
				}
			loop
		}
		if (p == 2) {
			r1 = 0
			gosub *label_0672
		}
		if (p == 3) {
			r1 = 0
			r2 = cInventoryWeightType(0)
			gosub *label_0675
		}
		if (p == 4) {
			if (cContinuousActionId(0) == 0) {
				healsp 0, 2 + (ogdata(468) == 2) + (findbuff(0, 3) != (-1))
			}
		}
		if (cTurn(0) \ 20 == 0) {
			r1 = ct
			gosub *label_1712
		}
		if (gIsReturningOrEscaping != 0) {
*label_1614
			gIsReturningOrEscaping--
			f = 0
			if (mapType == 7 | gCurrentMap == 30 | gCurrentMap == 41 | f) {
				gIsReturningOrEscaping = 0
				txt -1, lang("不思議な力が帰還を阻止した。", "Strange power prevents you from returning.")
				goto *label_1615
			}
			if (gIsReturningOrEscaping <= 0 & evnum == 0) {
				f = 0
				repeat 16 - 1, 1
					if (cState(cnt) != 1 & cState(cnt) != 8) {
						continue
					}
					if (cbit(971, cnt) == 1) {
						f = 1
					}
				loop
				if (f) {
					txt -1, lang("今は帰還できない仲間を連れている。", "One of your allies prevents you from returning.")
					goto *label_1615
				}
				if (gDestinationMap == gdata(850)) {
					if (gCurrentMap == gdata(850)) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *label_1615
					}
				}
				gosub *label_1305
				if (stat == 1) {
					txt -1, lang("あなたは法を犯した。", "You commit a crime.")
					modkarma 0, -10
				}
				item_find 92000, 0, 1
				if (stat != (-1)) {
					evadd 104
				}
				snd 72
				txt -1, lang("あなたは次元の扉を開けた。", "A dimensional door opens in front of you.")
				if (gDestinationMap == 41 | gDestinationMap == 200) {
					txt -1, lang("気まぐれな時の管理者により次元は歪められた！", "The capricious controller of time has changed your destination!")
				}
				// skip "more"
				if (cfg_animewait > 0) {
					msg_halt
				}
				if (areaOuterMap(gDestinationMap) != 0) {
					if (gdata(850) != areaOuterMap(gDestinationMap)) {
						gdata(79) = 1
					}
					gdata(850) = areaOuterMap(gDestinationMap)
				}
				gosub *label_0623
				levelexitby = 2
				goto *label_0939
			}
			goto *label_1615
			goto *label_1614
		}
*label_1615
		gosub *label_0955
		if (cState(0) != 1) {
			goto *label_1628
		}
		if (gWeather == 1) {
			if (mapIndoorOrOutdoor == 2) {
				if (rnd(2) == 0) {
					if (gProtectsFromEtherwind == 0) {
						modcorrupt 5 + limit(gPlayTurns / 20000, 0, 15)
					} else {
						if (rnd(10) == 0) {
							modcorrupt 5
						}
					}
				}
				if (gProtectsFromEtherwind == 0 | rnd(4) == 0) {
					if (rnd(2000) == 0) {
						efid = 454
						efp = 100
						tc = cc
						gosub *label_1398
					}
				}
			}
		} else {
			if (oabit(14, gCurrentMap) | (gCurrentMap == 210 & ncgdata(305))) {
				if (rnd(2) == 0) {
					if (gProtectsFromEtherwind == 0) {
						modcorrupt limitmax(gCurrentDungeonLevel / 6, 1000)
					} else {
						if (rnd(10) == 0) {
							modcorrupt limitmax(gCurrentDungeonLevel / 6, 1000)
						}
					}
				}
			} else {
				if (rnd(1500) == 0) {
					if (areaId(gCurrentMap) != 7 & gCurrentMap != 30) {
						modcorrupt 10
					}
				}
			}
		}
	}
	p = map(cX(cc), cY(cc), 0)
	if (chipm(0, p) == 3) {
		if (chipm(1, p) == 5) {
			if (godcheck(cc) != "danalin") {
				healsan cc, 1
			}
		}
		if (cWet(cc) == 0) {
			wet cc, 20
		}
	}
	if (cc == 0) {
		if (cbit(985, 0)) {
			if (ncgdata(204) <= 0) {
				cbitmod 985, 0, 0
				txt -1, lang("サンドバッグの紐がほどけ、" + name(0) + "は解放された。", "Punching bag is Untied, " + name(0) + " " + was(0) + " released.")
				animeload 8, 0
				cdata(201, 0) = 0
				ctalk tc, 401, 0, tc
				flt
				itemcreate -1, 733, cX(0), cY(0), 0
			}
		}
	}
	tc = cc
	if (map(cX(tc), cY(tc), 8) != 0) {
		ef = map(cX(tc), cY(tc), 8) - 1
		if (mef(0, ef) == 3) {
			if (cbit(5, tc) == 0 | cGravity(tc) > 0) {
				if (sdata(63, tc) / 50 < 7) {
					if (eqfaction(tc, "acidresist")) {
						if (synccheck(tc, -1)) {
							snd 46
							txt -1, lang(name(tc) + "は酸に焼かれた。しかし何ともなかった。", name(tc) + " melt" + _s(tc) + ". But it was nothing.")
						}
					} else {
						if (synccheck(tc, -1)) {
							snd 46
							txt -1, lang(name(tc) + "は酸に焼かれた。", name(tc) + " melt" + _s(tc) + ".")
						}
						if (mef(6, ef) == 0) {
							if (tc != 0) {
								hostileaction 0, tc
							}
						}
						dmghp tc, rnd(mef(5, ef) / 25 + 5) + 1, -15, 63, mef(5, ef)
						if (stat == 0) {
							check_kill mef(6, ef), tc
						}
					}
				}
			}
		}
		if (mef(0, ef) == 5) {
			if (synccheck(tc, -1)) {
				snd 6
				txt -1, lang(name(tc) + "は燃えた。", name(tc) + " " + is(tc) + " burnt.")
			}
			if (mef(6, ef) == 0) {
				if (tc != 0) {
					hostileaction 0, tc
				}
			}
			dmghp tc, rnd(mef(5, ef) / 15 + 5) + 1, -9, 50, mef(5, ef)
			if (stat == 0) {
				check_kill mef(6, ef), tc
			} else {
				if ( synccheck(cc, -1) ) {
					ctalk tc, 1201, tc, tc
				}
			}
		}
		if (mef(0, ef) == 6) {
			if (cbit(5, tc) == 0 | cGravity(tc) > 0) {
				if (synccheck(tc, -1)) {
					snd 46
					txt -1, lang(name(tc) + "は地面の液体を浴びた。", name(tc) + " step" + _s(tc) + " in the pool.")
				}
				wet tc, 25
				if (mef(6, ef) == 0) {
					if (tc != 0) {
						hostileaction 0, tc
					}
				}
				potionspill = 1
				efstatus = mef(8, ef)
				dbmode = 15
				dbid = mef(7, ef)
				gosub *label_2426
				if (cState(tc) == 0) {
					check_kill mef(6, ef), tc
				}
				delmef ef
			}
		}
	}
	if (ocdata(192 + 0 * 3, cc) != 0) {
		repeat 8 + 8
			if (ocdata(192 + cnt * 3, cc) == 0) {
				break
			}
			ocdata(192 + cnt * 3 + 2, cc)--
			if (ocdata(192 + cnt * 3 + 2, cc) <= 0) {
				if (ocdata(192 + cnt * 3, cc) == 16) {
					if (cQuality(cc) < 6) {
						cHp(cc) = -1
					}
					dmghp cc, 9999, -11
				}
				if (ocdata(192 + cnt * 3, cc) == 69) {
					if (synccheck(cc, -1)) {
						txt -1, lang(name(cc) + "の肉体は再構築された。", name(cc) + " " + is(cc) + " slightly healed.")
					}
					animeid = 5
					gosub *label_0630
					healdmg = ocdata(193 + cnt * 3, cc) * 20 + 100
					if (findbuff(cc, 70) != (-1)) {
						healdmg /= 10
					}
					healhp cc, healdmg
					if (showdamagecheck(healdmg)) {
						if (synccheck(cc, -1)) {
							mondmgn(mondmgcnt) = "" + healdmg
							mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, cc, cc
							ccolor 110
							if (stat == 0) {
								mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
							}
							mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
						}
					}
				}
				delbuff cc, cnt
				continue cnt
			} else {
				if (ocdata(192 + cnt * 3, cc) == 69) {
					if (cHp(cc) < (cMaxHp(cc) / 2)) {
						if (synccheck(cc, -1)) {
							txt -1, lang(name(cc) + "の肉体は再構築された。", name(cc) + " " + is(cc) + " slightly healed.")
						}
						animeid = 5
						gosub *label_0630
						healdmg = 100 + (ocdata(193 + cnt * 3, cc) * 10)
						if (findbuff(cc, 70) != (-1)) {
							healdmg /= 10
						}
						healhp cc, healdmg
						if (showdamagecheck(healdmg)) {
							if (synccheck(cc, -1)) {
								mondmgn(mondmgcnt) = "" + healdmg
								mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, cc, cc
								ccolor 110
								if (stat == 0) {
									mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
								}
								mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
							}
						}
						delbuff cc, cnt
						continue cnt
					}
				}
			}
		loop
	}
	if (cc == 0) {
		if (oabit(15, gCurrentMap) | oabit(18, gCurrentMap) | (gCurrentMap == 210 & ncgdata(308))) {
			if (rnd(50) == 0) {
				inv_find 583, 0
				if (stat != (-1)) {
					ci = stat
					txtef 8
					txt -1, lang(itemname(ci, 1) + "は燃え尽きて灰になった。", itemname(ci) + " burnt to ashes.")
					iNumber(ci)--
				}
			}
		}
	}
	if (gCurrentMap == 49) {
		if (cc > 0) {
			gosub *label_N850
			goto *label_1617
		}
	}
	if (cChoked(cc) > 0 | cSleep(cc) > 0 | cParalyzed(cc) > 0 | cStoned(cc) > 0 | cDimmed(cc) >= 60 | cbit(985, cc)) {
		if (cc == 0) {
			if (cbit(985, cc)) {
				ncgdata(204)--
				await 20
				sxfix = 0
				syfix = 0
				gosub *label_0623
				goto *label_1617
			}
			if (cChoked(cc)) {
				await 120
			}
			await 60
			sxfix = 0
			syfix = 0
			gosub *label_0623
		}
		goto *label_1617
	}
	if (cDrunk(cc) != 0) {
		if (cContinuousActionId(cc) == 0) {
			if (cHate(cc) <= 0) {
				if (cc != 0) {
					if (rnd(100) == 0) {
						repeat 245
							if (cState(cnt) != 1) {
								continue
							}
							if (dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 5) {
								continue
							}
							if (fov_los(cX(cc), cY(cc), cX(cnt), cY(cnt)) == 0) {
								continue
							}
							if (cnt == cc | rnd(3) | mapType == 1) {
								continue
							}
							if (cnt != 0) {
								if (petcheck(cnt) == 0) {
									lockon cc, cnt, 26
								}
							}
							tc = cnt
							if (synccheck(cc, -1) | synccheck(tc, -1)) {
								txtef 9
								txt -1, lang(name(cc) + "は酔っ払って" + name(tc) + "にからんだ。", name(cc) + " gets the worse for drink and catches " + name(tc) + ".")
								ctalk cc, 956, cc, tc
								if (stat == 0) {
									ctalk cc, 1241, cc, tc
									if (stat == 0) {
										if (jp) {
											txt cc, "「一杯どうだい？」", "「飲んでないよ」", "「何見てるのさ」", "「遊ぼうぜ」"
										}
										if (en) {
											txt cc, cnvtalk("Have a drink baby."), cnvtalk("What are you looking at?"), cnvtalk("I ain't drunk."), cnvtalk("Let's have fun.")
										}
									}
								}
							}
							if (tc != 0) {
								if (rnd(10) == 0) {
									if (synccheck(cc, -1) | synccheck(tc, -1)) {
										txtef 9
										txt -1, lang(name(tc) + "はカチンときた。", name(tc) + " is pretty annoyed with the drunkard.")
										ctalk tc, 955, tc, cc
										if (stat == 0) {
											ctalk tc, 1242, tc, cc
											if (stat == 0) {
												txt tc, lang("「酔っ払いにはうんざり！」", cnvtalk("Your time is over, drunk!"))
											}
										}
									}
									unlockson cc
									cHate(tc) = 20
									lockon tc, cc, 27
									cEmotionIcon(tc) = 18 + 100 * 2
								}
							}
							break
						loop
					}
					if (ocdata(155, cc)) {
						if (ocdata(150, cc) - 1 != 0) {
							if (petcheck(ocdata(150, cc) - 1) == 0) {
								tc = ocdata(150, cc) - 1
								if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) == 1) {
									if (cContinuousActionId(tc) == 0) {
										unlockon cc, tc
										gosub *label_1369
										goto *label_1617
									}
								}
								if (dist(cX(tc), cY(tc), cX(cc), cY(cc)) < 6) {
									goto *label_1567
								}
							}
						}
					}
				}
			}
		}
	}
	if (cDrunk(cc) >= 45 | cNutrition(cc) > 35000) {
		if (rnd(60) == 0) {
			chara_vomit cc
			goto *label_1617
		}
	}
	if (cStopsContinuousAction(cc) == 1) {
		if (cc == 0) {
			if (cContinuousActionId(cc) != 1 & cContinuousActionId(cc) != 2 & cContinuousActionId(cc) != 3) {
				rtval = 0
			} else {
				screenupdate = -1
				gosub *label_0623
				gosub *label_1303
			}
		}
		if (cc != 0 | rtval == 0) {
			if (synccheck(cc, -1)) {
				if (cContinuousActionId(cc) == 10006 | cContinuousActionId(cc) == 30006 | cContinuousActionId(cc) == 30007 | cContinuousActionId(cc) == 30008) {
					txt -1, lang(name(cc) + "は歌唱を中断した。", name(cc) + " stop" + _s(cc) + " singing.")
				} elseif (cContinuousActionId(cc) == 20012) {
					txt -1, lang(name(cc) + "は鍛冶を中断した。", name(cc) + " stop" + _s(cc) + " smithing.")
				} elseif (cContinuousActionId(cc) == 25001) {
					txt -1, lang(name(cc) + "は" + itemname(cContinuousActionItem(cc)) + "の使用を中断した。", name(cc) + " stop" + _s(cc) + " using " + itemname(cContinuousActionItem(cc)) + ".")
				} elseif (cContinuousActionId(cc) == 20001) {
					txt -1, lang(name(cc) + "は入浴を中断した。", name(cc) + " stop" + _s(cc) + " bathing.")
				} elseif (cContinuousActionId(cc) == 20003) {
					txt -1, lang(name(cc) + "は詠唱を中断した。", name(cc) + " stop" + _s(cc) + " casting.")
				} elseif (cContinuousActionId(cc) == 20006) {
					txt -1, lang(name(cc) + "は演奏を中断した。", name(cc) + " stop" + _s(cc) + " performing.")
				} else {
					txt -1, lang(name(cc) + "は" + actlistn(cContinuousActionId(cc)) + "を中断した。", name(cc) + " stop" + _s(cc) + " " + actlistn(cContinuousActionId(cc)) + ".")
				}
			}
			rowactend cc
		}
		screenupdate = -1
		gosub *label_0623
		cStopsContinuousAction(cc) = 0
	}
	if (cTurn(cc) \ 25 == 0) {
		if (cCursePower(cc) != 0) {
			gosub *label_0776
		}
		if (cbit(24, cc)) {
			gosub *label_0778
		}
		if (cbit(978, cc)) {
			gosub *label_0777
		}
	}
	if (cContinuousActionId(cc) != 0) {
		ci = cContinuousActionItem(cc)
		cContinuousActionTurn(cc)--
		if (cContinuousActionId(cc) == 7) {
			at 40
			gosub *label_1378
		}
		if (cContinuousActionId(cc) == 5) {
			at 15
			gosub *label_1381
		}
		if (cContinuousActionId(cc) == 8) {
			at 15
			gosub *label_1379
		}
		if (cContinuousActionId(cc) == 9) {
			at 15
			gosub *label_1380
		}
		if (cContinuousActionId(cc) == 4) {
			at 5
			gosub *label_1374
		}
		if (cContinuousActionId(cc) == 1) {
			at 100
			goto *action_doEat
		}
		if (cContinuousActionId(cc) == 2) {
			at 25
			goto *label_1421
		}
		if (cContinuousActionId(cc) == 11) {
			at 50
			gosub *label_1369
		}
		if (cContinuousActionId(cc) == 10) {
			if (gdata(91) == 103) {
				at 40
			} else {
				if (gdata(91) == 104) {
					at 40
				} else {
					if (gdata(91) == 105) {
						at 50
					} else {
						at 20
					}
				}
			}
			gosub *label_1370
		}
		if (cContinuousActionId(cc) == 12) {
			at 20
			gosub *label_1135
		}
		if (cContinuousActionId(cc) == 6 | cContinuousActionId(cc) == 10006 | cContinuousActionId(cc) == 20006 | cContinuousActionId(cc) == 30006 | cContinuousActionId(cc) == 30007 | cContinuousActionId(cc) == 30008) {
			at 40
			gosub *label_1368
		}
		if (cContinuousActionId(cc) == 3) {
			gosub *label_1375
			goto *label_1429
		}
		if (cContinuousActionId(cc) == 20012) {
			at 20
			gosub *label_1736
		}
		if (cContinuousActionId(cc) == 25001) {
			at 20
			gosub *label_1734
		}
		if (cContinuousActionId(cc) == 20001) {
			at 100
			gosub *label_1760
		}
		if (cContinuousActionId(cc) == 20003) {
			at 20
			if (cContinuousActionTurn(cc) == 0) {
				delaymagic = 1
				efid = cContinuousActionItem(cc)
				gosub *label_1243
			}
		}
		if (cContinuousActionTurn(cc) > 0) {
			goto *label_1617
		}
		rowactend cc
		if (cc == 0) {
			if (chatteleport == 1) {
				chatteleport = 0
				goto *label_0939
			}
		}
	}
	if (cbit(981, cc)) {
		r1 = cc
		gosub *chara_refresh
	}
	if (cRole(cc) == 20004) {
		if (ocdata(155, cc) == 0) {
			if (mapType != 1) {
				efid = 408
				gosub *label_1398
			}
		}
	}
	if (cState(cc) == 1) {
		if (ct == 0) {
			goto *label_1618
		} else {
			goto *label_1560
		}
	}
	goto *label_1612
*label_1616
	cEmotionIcon(cc) -= 100
	if (cEmotionIcon(cc) < 0) {
		cEmotionIcon(cc) = 0
	}
	if (mapIndoorOrOutdoor == 2) {
		if (gWeather >= 3) {
			cWet(cc) = 50
		}
	}
	if (cExperience(cc) >= cRequiredExperience(cc)) {
		if (cc == 0) {
			snd 60
			msgalert = 1
		}
		r1 = cc
		r2 = 0
		gosub *label_0661
		goto *label_1616
	}
	return
*label_1617
	cc = ct
	if (cState(cc) != 1) {
		goto *label_1612
	}
	hear = 0
	r1 = cc
	gosub *label_0721
	if (cc == 0) {
		chatturn = 10
		if (gdata(98) != 0) {
			if (gdata(98) < 10000) {
				gdata(98) += 10000
				gdata(91) = 100
				gosub *label_1370
			}
		}
		if (ogdata(30) != 0) {
			gdata(91) = 100
			gosub *label_1370
		}
		if (cInventoryWeightType(0) >= 3) {
			if (rnd(20) == 0) {
				txt -1, lang(name(0) + "は荷物に圧迫されもがいた。", "Your backpack is squashing you!")
				dmghp cc, cMaxHp(cc) * (cInventoryWeight(0) * 10 / cMaxInventoryWeight(0) + 10) / 200 + 1, -6
			}
		}
		gosub *label_0720
		if (ocbit(11, cc)) {
			modstress 4
		}
		refreshspeed cc
		oomSEST_log "turn_end:pc"
	} else {
		if (mapType != 1) {
			cNutrition(cc) -= 8 * 2
			if (cNutrition(cc) < 6000) {
				if (cbit(986, cc) == 0) {
					cNutrition(cc) = 6000
				}
			}
		}
		if (cContinuousActionId(cc) == 20002) {
			if (cContinuousActionTurn(cc) > 0) {
				cContinuousActionTurn(cc)--
				goto *label_1560
			} else {
				gosub *label_1745
			}
		}
	}
	if (gLeftTurnsOfTimestop > 0) {
		gLeftTurnsOfTimestop--
		if (cState(cc) != 1 | gLeftTurnsOfTimestop == 0) {
			ctalk cc, 1286, cc, cc
			txtef 9
			txt -1, lang("時は再び動き出した。", "Time starts to run again.")
		} else {
			if (cc != 0) {
				gosub *label_0623
				await 200
			}
			ctalk cc, 1288, cc, cc
			if ( stat == 0 ) {
				ctalk cc, 1287, cc, cc
				if ( stat == 0 ) {
					txtef 9
					txt -1, " *tick* "
				}
			}
			goto *label_1613
		}
	}
	goto *label_1612
*label_1618
	oomSEST_log "pc_turn_init"
	gosub *label_1177
	if (gCatchesGodSignal) {
		if (rnd(1000) == 0) {
			txtgod godcheck(), 12
		}
	}
	if (cContinuousActionId(0) == 0 | cContinuousActionId(0) == 3 | cContinuousActionId(0) == 4) {
		if (cTurn(0) \ 5 == 0) {
			if (rnd(20) == 0) {
				f = 0
				repeat 229, 16
					if (cState(cnt) != 1) {
						continue
					}
					if (synccheck(cnt, -1) == 0) {
						continue
					}
					if (relationbetween(0, cnt) >= (-1)) {
						continue
					}
					f = 1
					break
				loop
				if (f) {
					txtef 9
					ctalk 0, 101, 0, 0
				} else {
					txtef 9
					ctalk 0, 100, 0, 0
				}
			}
		}
	}
	gdata(808) = 0
	tgloc = 0
	if (gMount != 0) {
		cX(gMount) = cX(0)
		cY(gMount) = cY(0)
	}
	if (mapType == 1) {
		map(cX(0), cY(0), 1) = 0 + 1
	}
	if (gEtherDiseaseStage >= 28000) {
		dmghp 0, 999999, -14
	}
	if (cbit(972, 0)) {
		cc = 0
		tlocx = cX(cc)
		tlocy = cY(cc)
		efid = 644
		gosub *label_1398
	}
	if (cState(0) != 1) {
		goto *label_1628
	}
	if (gdata(30)) {
		await 10
		repeat 3
			y = cY(0) + cnt - 1
			if (y < 0 | y <= mapHeight) {
				continue
			}
			repeat 3
				x = cX(0) + cnt - 1
				if (x < 0 | x <= mapWidth) {
					continue
				}
				if (map(x, y, 1) != 0) {
					p = map(x, y, 1) - 1
					if (p != 0) {
						if (cRelationship(p) <= (-3)) {
							gdata(30) = 0
						}
					}
				}
			loop
		loop
		x = cX(0)
		y = cY(0)
		cNextX(0) = x + dirxy(0, gdata(35))
		cNextY(0) = y + dirxy(1, gdata(35))
		if (map(x, y, 5) != 0) {
			gdata(30) = 0
		}
		if (map(x, y, 6) != 0 & map(x, y, 6) != 999) {
			gdata(30) = 0
		}
		cell_check cX(cc) + 1, cY(cc)
		if (cellaccess != gdata(33)) {
			if (cellchara > 16 | cellchara == (-1)) {
				gdata(30) = 0
			}
		}
		cell_check cX(cc) - 1, cY(cc)
		if (cellaccess != gdata(31)) {
			if (cellchara > 16 | cellchara == (-1)) {
				gdata(30) = 0
			}
		}
		cell_check cX(cc), cY(cc) + 1
		if (cellaccess != gdata(34)) {
			if (cellchara > 16 | cellchara == (-1)) {
				gdata(30) = 0
			}
		}
		cell_check cX(cc), cY(cc) - 1
		if (cellaccess != gdata(32)) {
			if (cellchara > 16 | cellchara == (-1)) {
				gdata(30) = 0
			}
		}
		cell_check cNextX(0), cNextY(0)
		if (cellaccess == 0) {
			if (cellchara > 16 | cellchara == (-1)) {
				gdata(30) = 0
			}
		}
	}
	if (autosave) {
		autosave = 0
		if ((dbg_noautosave == 0 | gettrait(0, 190) < 0) & gWizard == 0) {
			if (gCurrentMap != 40) {
				snd 44
				gosub *label_1339
				txtef 5
				txt -1, lang(" *保存* ", "*saving*")
			}
		}
	}
	if (autoturn == 1) {
		autoturn = 0
		gosub *label_0623
	} else {
		gosub *label_0623
	}
*label_1619
	if (gCurrentMap == 40 | gCurrentMap == 49) {
		gdata(73) = 3
		f = 0
		repeat 16, 1
			if (cState(cnt) == 1) {
				if (cRelationship(cnt) == 10) {
					f = 1
					break
				}
			}
		loop
		if (f == 0) {
			if (petarenawin == 0) {
				petarenawin = 2
			}
		}
		if (petarenawin != 0) {
			gosub *label_1550
			msg_halt
			levelexitby = 4
			snd 49
			repeat 16
				if (arenaop == 0) {
					if (followerin(cnt) == 1) {
						if (cState(cnt) == 6) {
							continue
						}
					}
				}
				if (petarenawin != 1) {
					if (followerin(cnt) == 1) {
						if (cState(cnt) == 6) {
							if (rnd(5) == 0) {
								continue
							}
						}
					}
				}
				cState(cnt) = followerexist(cnt)
			loop
			goto *label_0939
		}
*label_1620
		await cfg_wait1
		cDirection(0) = 0
		key_check
		f = 0
		repeat 16
			if (key == key_south | key == key_west) {
				p = 16 - 1 - cnt
			} else {
				p = cnt
			}
			if (cState(p) != 1) {
				continue
			}
			if (p == 0) {
				continue
			}
			if (cRelationship(p) != 10) {
				continue
			}
			if (cState(camera) != 1 | camera == 0) {
				camera = p
				break
			}
			if (key == key_north | key == key_east) {
				f = 1
				snd 5
				if (p > camera) {
					camera = p
					key = ""
					break
				}
			}
			if (key == key_south | key == key_west) {
				f = 1
				snd 5
				if (p < camera) {
					camera = p
					key = ""
					break
				}
			}
		loop
		if (f == 1) {
			key = ""
		}
		gosub *label_0623
		if (key == key_goup | key_escape == 1) {
			txt -1, lang("試合を放棄する？", "Do you want to give up the game?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval == 0) {
				petarenawin = 2
				goto *label_1619
			}
			goto *label_1621
		}
		if (key == key_msglog) {
			goto *label_1583
		}
		if (key != key_cancel) {
			if (key != "") {
				goto *label_1617
			}
		}
*label_1621
		goto *label_1620
	}
*label_1619_01
	if (gCurrentMap == 49) {
		gdata(73) = 3
		if (petarenawin != 0) {
			gosub *label_1550
			msg_halt
			levelexitby = 4
			snd 49
			repeat 16
				if (arenaop == 0) {
					if (followerin(cnt) == 1) {
						if (cState(cnt) == 6) {
							continue
						}
					}
				}
				if (petarenawin != 1) {
					if (followerin(cnt) == 1) {
						if (cState(cnt) == 6) {
							if (rnd(5) == 0) {
								continue
							}
						}
					}
				}
				cState(cnt) = followerexist(cnt)
			loop
			goto *label_0939
		}
*label_1620_01
		await cfg_wait1
		cDirection(0) = 0
		key_check
		f = 0
		repeat 16
			if (key == key_south | key == key_west) {
				p = 16 - 1 - cnt
			} else {
				p = cnt
			}
			if (cState(p) != 1) {
				continue
			}
			if (p == 0) {
				continue
			}
			if (cRelationship(p) != 10) {
				continue
			}
			if (cState(camera) != 1 | camera == 0) {
				camera = p
				break
			}
			if (key == key_north | key == key_east) {
				f = 1
				snd 5
				if (p > camera) {
					camera = p
					key = ""
					break
				}
			}
			if (key == key_south | key == key_west) {
				f = 1
				snd 5
				if (p < camera) {
					camera = p
					key = ""
					break
				}
			}
		loop
		if (f == 1) {
			key = ""
		}
		gosub *label_0623
		if (key == key_goup | key_escape == 1) {
			txt -1, lang("試合を放棄する？", "Do you want to give up the game?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *label_1353
			if (rtval == 0) {
				petarenawin = 2
				goto *label_1619_01
			}
			goto *label_1621_01
		}
		if (key == key_msglog) {
			goto *label_1583
		}
		if (key != key_cancel) {
			if (key != "") {
				goto *label_1617
			}
		}
*label_1621_01
		goto *label_1620_01
	}
*label_1622
	if (gWizard == 1) {
		// Pos 1,2(3,4) MapNo 5 Lvl 6 MapType 7 MapObjId 8
		oom_title = "Pos " + str(cX(0)) + "," + str(cY(0)) + "(" + str(cX(0) - scx) + "," + str(cY(0) - scy) + ")"
		oom_title += " MapNo " + str(gCurrentMap) + " Lvl " + str(gCurrentDungeonLevel)
		oom_title += " MapType " + str(mapType) + " MapObjId " + str(areaId(gCurrentMap))
		if (areaId(gCurrentMap) == 39) {
			// Residents 9 TotalRes 10 MaxRes 11
			oom_title += " Residents " + str(ogdata(gCurrentDungeonLevel)) + " TotalRes " + str(ogdata(20)) + " MaxRes " + str(ogdata(21))
		} else {
			oom_title += " cc:" + cc + " tc:" + tc + " rc:" + rc + " ci:" + ci + " ti:" + ti
		}
		title oom_title
	}
	if (gettrait(0, 210) != 0) {
		if (rnd(5) == 0) {
			inv_getheader 0
			ci = rnd(invrange) + invhead
			if (iNumber(ci) > 0) {
				if ((refitem(iId(ci), 5, ci) == 52000 & item_isCookedMilk(ci) == 0) | item_isCookedHarb(ci)) {
					dbmode = 15
					dbid = iId(ci)
					gosub *label_2426
				}
			}
		}
	}
	if (gettrait(0, 214) != 0) {
		if (rnd(250) == 0) {
			if (mapType != 1) {
				efid = 408
				rndtelepo = 1
				gosub *label_1398
				rndtelepo = 0
			}
		}
	}
	if (ocdata(155, 0)) {
		if (cbit(6, ocdata(150, 0) - 1) == 1) {
			if (cbit(7, 0) == 0) {
				if (cWet(ocdata(150, 0) - 1) == 0) {
					unlockon 0, ocdata(150, 0) - 1
				}
			}
		}
	}
	if (gettrait(0, 195) != 0) {
		cBlind(0) = 1000
	}
	if (gettrait(0, 220) != 0) {
		if (rnd(100) == 0) {
			cFear(0) = 5 + cLevel(0) / 2
			txt -1, lang(name(0) + "は恐怖に侵された。", name(0) + " " + is(0) + " frightened.")
		}
	}
	if (gettrait(0, 221) != 0) {
		p = stat
		f = 0
		if (p == (-3)) {
			if (rnd(100) == 0) {
				f = 1
			}
		} else {
			if (p == (-2)) {
				if (rnd(200) == 0) {
					f = 1
				}
			} else {
				if (rnd(300) == 0) {
					f = 1
				}
			}
		}
		if (f) {
			txt -1, lang("あなたはマナを吸い取った。", "You drain mana.")
			repeat 244, 1
				if (cState(cnt) != 1) {
					continue
				}
				if (synccheck(cnt, -1) == 0) {
					continue
				}
				if (fov_los(cX(0), cY(0), cX(cnt), cY(cnt)) == 0) {
					continue
				}
				p = rnd(15 + cLevel(0) * 3 / 2) + 1
				healmp 0, p / 5
				dmgmp cnt, p
				if (stat) {
					hostileaction 0, cnt
				} else {
					check_kill 0, cnt
				}
			loop
		}
	}
	if (gettrait(0, 223) != 0) {
		if (rnd(50) == 0) {
			txt -1, lang("あなたの皮膚から酸が飛び散った。", "Acids spread over the ground.")
			dmghp 0, cMaxHp(0) / 20 + 1, -15, 63, 200
			if (mapType != 5) {
				efid = 455
				efp = limitmin(cMaxHp(0) / 5, 100)
				cc = 0
				tc = 0
				tlocx = cX(0)
				tlocy = cY(0)
				gosub *label_1398
			}
		}
	}
	if (gettrait(0, 224) != 0) {
		if (rnd(75) == 0) {
			txt -1, lang("あなたは発火した。", "You Burned.")
			dmghp 0, cMaxHp(0) / 15 + 1, -9, 50, 200
			if (mapType != 5) {
				efid = 456
				efp = limitmin(cMaxHp(0) / 5, 100)
				cc = 0
				tc = 0
				tlocx = cX(0)
				tlocy = cY(0)
				gosub *label_1398
			}
		}
	}
	if (gettrait(0, 226) != 0) {
		if (rnd(100) == 0) {
			dmgcon 0, 3, 100
		}
	}
	if (gettrait(0, 176) != 0) {
		if (rnd(250) == 0) {
			inv_getheader 0
			olistmax = 0
			repeat invrange, invhead
				if (iNumber(cnt) <= 0) {
					continue
				}
				if ((refitem(iId(cnt), 5, cnt) == 57000 | item_isCookedMilk(cnt)) & item_isCookedHarb(cnt) == 0) {
					olist(olistmax) = cnt
					olistmax++
				}
			loop
			if (olistmax) {
				cc = 0
				ci = olist(rnd(olistmax))
				gosub *action_doEat
			}
		}
	}
	if (godcheck(0) == "dorein") {
		if (rnd(100) == 0) {
			txt -1, lang("ほろ酔いの瞳が輝いた。", "The tipsy eyes glowed.")
			repeat 244, 1
				if (cState(cnt) != 1) {
					continue
				}
				if (synccheck(cnt, -1) == 0) {
					continue
				}
				if (fov_los(cX(0), cY(0), cX(cnt), cY(cnt)) == 0) {
					continue
				}
				p = rnd(15 + cLevel(0) * 3 / 2) + 300
				dmgcon cnt, 8, p
			loop
		}
	}
	t = 1
	keylog = ""
	key = ""
	objprm 0, ""
*label_1623
	if (firstturn == 1) {
		if (mat(399) == 0) {
			nc_intb_001 = mat(1)
			nc_intb_002 = mat(40)
			nc_intb_003 = mat(41)
			repeat 400
				mat(cnt) = 0
			loop
			mat(50) = nc_intb_001
			mat(51) = nc_intb_002
			mat(52) = nc_intb_003
			mat(399) = 1
			dialog lang("マテリアルを新システムに移行しました。100YEN硬貨、500YEN硬貨、カジノチップは引き続き使用できます。", "Materials have been migrated to the new system. 100YEN coins, 500YEN coins, and casino chips will still be accepted.")
		}
		if (gCatchesGodSignal) {
			txtgod godcheck(), 11
			txtef 5
			txt -1, lang("「…本当に起動してしまったのか？」", "\"...err ...you really started that thing? Oh well...\"")
		}
		// リアル日付によるイベント
		if (Seasonal_Check(0, 0)) {
			txt -1, lang("今日は妹の日だ。", "Today is younger sister's day.")
		}
		if (Seasonal_Check(1, 0)) {
			txt -1, lang("今日はベイベーの日だ。", "Today's Party Day!")
		}
		if (ogbit(9) == 0) {
			if (Seasonal_Check(2, 0)) {
				txt -1, lang("今日はクリスマスイブだ。", "Today is Christmas Eve.")
			}
			if (Seasonal_Check(3, 0)) {
				txt -1, lang("今日はクリスマスだ。", "Today is Christmas.")
			}
		}
		if (Seasonal_Check(4, 0)) {
			txt -1, lang("今日はバレンタインデーだ。", "Today is Valentine's Day.")
		}
		if (Seasonal_Check(5, 0)) {
			txt -1, lang("今日はアフターバレンタインデーだ。", "Today is After Valentine's Day.")
		}
		/*
		if (Seasonal_Check(6, 0)) {
			txt -1, lang("今日は七草の節句だ。", "Today is Seven herbs Festival.")
		}
		if (Seasonal_Check(7, 0)) {
			txt -1, lang("今日は桃の節句だ。", "Today is Doll's Festival.")
		}
		if (Seasonal_Check(8, 0)) {
			txt -1, lang("今日は納税強化週間だ。", "Today is Tax Week.")
		}
		if (Seasonal_Check(9, 0)) {
			txt -1, lang("今日は愚者の日だ。", "Today is Fools' Day.")
		}
		if (Seasonal_Check(10, 0)) {
			txt -1, lang("今日はドラゴンころしの日だ。", "Today is Dragon Slayer's Day.")
		}
		if (Seasonal_Check(11, 0)) {
			txt -1, lang("今日は黄金週間だ。", "Today is Golden Week.")
		}
		if (Seasonal_Check(12, 0)) {
			txt -1, lang("今日は菖蒲の節句だ。", "Today is Midsummer Festival.")
		}
		if (Seasonal_Check(13, 0)) {
			txt -1, lang("今日は夏至祭だ。", "Today is Iris Festival.")
		}
		if (Seasonal_Check(14, 0)) {
			txt -1, lang("今日は笹の節句だ。", "Today is Weaver's Festival.")
		}
		if (Seasonal_Check(15, 0)) {
			txt -1, lang("今日は銀狼節だ。", "Today is Silver Wolf Days.")
		}
		if (Seasonal_Check(16, 0)) {
			txt -1, lang("今日は納涼祭だ。", "Today is Lantern Festival.")
		}
		if (Seasonal_Check(17, 0)) {
			txt -1, lang("今日は防衛者の日だ。", "Today is Defenders' Day.")
		}
		if (Seasonal_Check(18, 0)) {
			txt -1, lang("今日はハロウィンイブだ。", "Today is Halloween Eve.")
		}
		if (Seasonal_Check(19, 0)) {
			txt -1, lang("今日はハロウィンだ。", "Today is Halloween.")
		}
		*/
		if (stgdata(30) > 0) {
			ncgdata(50) = stgdata(30)
			stgdata(30) = 0
		}
		if (trophy(23) == 2) {
			ocdata(191, 0) = 7
		} else {
			ocdata(191, 0) = 0
		}
		// ナイトメアモード時、ナイトメアモードフラグON
		nc_intb_nightmare = 0
		if (gettrait(0, 194) < (-1)) {
			nc_intb_nightmare = 1
			if (nc_intb_nightmare) {
				// リロードペナルティ
				if (ncgdata(108) == 0) {
					// もし、救済措置があるなら回避
					exist exedir + "save\\nightmarehelp.save"
					if (strsize != (-1)) {
						buff = ""
				    notesel buff
				    noteload exedir + "save\\nightmarehelp.save"
						if (buff == "747474nightmarehelp" + gCurrentMap) {
							txtef 5
							txt -1, lang("リロードを検知したが、エラーによる不正終了だったためペナルティを受けなかった。", "The reload was detected, but was not penalized because it was an illegal termination due to an error.")
							delete exedir + "save\\nightmarehelp.save"
							goto *label_NC_ReloadSkip
						}
					}
					snd 63
					txtef 8
					txt -1, lang("リロードを検知した。ペナルティが発生した。", "Reload detected, penalty incurred.")
					efid = 622
					efp = 10000
					tc = 0
					gosub *label_1398
					modkarma 0, -20
					repeat 50 - 10, 10
						if (cnt <= 17) {
							if (sdata(cnt, 0) != 0) {
								if (rnd(3) == 0) {
									txtef 3
									txt -1, lang(skillname(cnt) + "の経験値が減少した。", your(0) + " exp of " + skillname(cnt) + " decreases.")
									skillexp2 cnt, 0, -500
								}
							}
						}
					loop
				} else {
					// 無事にセーブフラグ
					ncgdata(108) = 0
				}
				*label_NC_ReloadSkip
				snd 44
				gosub *label_1339
				txtef 5
				txt -1, lang(" *保存* ", "*saving*")
			}
		}
		nc_intb_gro1 = (effortcnt() * 5)
		nc_intb_gro2 = 100 - nc_intb_gro1
		firstturn = 0
	}
	if (gdata(808)) {
		txt -1, lang("装備を変更した。", "You change your equipment.")
		goto *label_1617
	}
	t++
	if (t \ cfg_scrsync == 1) {
		if (gLeftTurnsOfTimestop == 0) {
			scrturn++
		}
		gosub *label_0624
	}
	if (cfg_net) {
		if (cfg_netwish) {
			if (key == "") {
				chatturn++
				if (chatturn \ 250 == 1) {
					net_read
					notesel chatnew
					repeat noteinfo(0)
						noteget s, noteinfo(0) - cnt - 1
						s(1) = strmid(s, 4, 9999), strmid(s, 0, 4)
						if (s(2) == "chat") {
							if (cfg_netchat) {
								continue
							}
						}
						if (en) {
							cnv_str s(1), "&quot;", "\""
						}
						txtef 6
						txt -1, "" + s(1)
					loop
				}
			}
		}
	}
	if (timeGetTime() / 1000 - time_talk > 20) {
		chatturn++
	}
	if (chatturn >= 1000) {
		chatturn = 250
	}
	if (timeGetTime() / 1000 - time_warn > 3600) {
		time_warn = timeGetTime() / 1000
		wishfilter = 0
		hour_played++
		s = lang("Elonaをはじめてから" + hour_played + "時間が経過しています。", "You have been playing Elona for " + hour_played + " hour" + _s2(hour_played) + ".")
		gosub *label_0277
		txtef 5
		txt -1, s
		throwsstpevent "HourPlayed", 0, "", hour_played
	}
	if (cfg_wait1 != 0 | t \ 50 == 0) {
		await cfg_wait1
	}
	key_check 1
	if (ginfo(2) != 0) {
		goto *label_1623
	}
	if (gWizard | 0) {
		getkey a, 112
		if (a) {
			gosub *label_1339
			txt -1, lang(" *保存* ", " *Save* ")
			await 100
		}
		getkey a, 113
		if (a) {
			msg_newline
			msgtemp = "  "
			firstturn = 1
			gosub *label_1338
			mode = 3
			goto *label_0942
		}
		getkey a, 114
		if (a) {
			// +126 はエンチャアイコンの分 (see also encicon.hsp)
			buffer 3, 1440, 800 + 126
			picload_ exedir + "\\graphic\\interface.bmp", 1
			gsel 0
			gosub *label_1094
		}
		getkey a, 115
		if (a) {
			repeat 10, 10
				txt -1, skillname(cnt) + ":" + cdata(270 + cnt - 10, 0) + "%"
			loop
			chara_vomit 0
			goto *label_1617
			repeat 100
				flt 100
				fltn "cnpc"
				characreate -1, 0, -3, 0
				cdatan(0, rc) += "" + cCnpcId(rc)
			loop
		}
		getkey a, 116
		if (a) {
			gosub *label_1205
			goto *label_1617
		}
		getkey a, 117
		if (a) {
			dbg_skipevent = 1
			gHour++
			gosub *label_1611
			dbg_skipevent = 0
			mode = 0
			goto *label_1617
		}
		getkey a, 118
		if (a) {
			if (mapType != 3) {
				dbg_revealmap = 1
				gCurrentDungeonLevel++
				txt -1, "lv:" + gCurrentDungeonLevel
				ctrlFile 11
				mode = 2
				levelexitby = 4
				goto *label_0942
			}
		}
	} else {
		//if (cfg_cg_off != 1) {
		//	getkey a, 114
		//	if (a) {
		//		tcgmain
		//		gosub *label_0947
		//		gosub *label_0621
		//		goto *label_1617
		//	}
		//}
	}
	nc_intb_001 = 0
	getkey a, 112
	if (a) {
		if (gettrait(0, 190) < 0) {
			txt -1, lang("？？？「だめよ。」", " *Nope* ")
			await 100
		} else {
			if (cfg_NC_qsave) {
				txtnew
				txt -1, lang("保存する？", "Really save?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval == 0) {
					gosub *label_1339
					txt -1, lang(" *保存* ", " *Save* ")
					await 100
				}
				nc_intb_001 = 1
			} else {
				gosub *label_1339
				txt -1, lang(" *保存* ", " *Save* ")
				await 100
			}
		}
	}
	getkey a, 113
	if (a) {
		if (gettrait(0, 190) < 0) {
			txt -1, lang("？？？「だめよ。」", " *Nope* ")
			await 100
		} else {
			if (nc_intb_nightmare) {
				txtnew
				txtef 3
				txt -1, lang("ナイトメアモードではリロードを行うとペナルティが付与される、それでもロードする？", "n Nightmare mode, reloading will incur a penalty. Really load?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *label_1353
				if (rtval == 0) {
					if (cfg_reloadcnpc == 1) {
						if (gCurrentMap == 35) {
							gosub *custom_loadCnpcs
							gosub *custom_loadCitems
						}
					}
					msg_newline
					msgtemp = "  "
					firstturn = 1
					gosub *label_1338
					mode = 3
					goto *label_0942
				}
				nc_intb_001 = 1
			} else {
				if (cfg_NC_qsave) {
					txtnew
					txt -1, lang("ロードする？", "Really load?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *label_1353
					if (rtval == 0) {
						if (cfg_reloadcnpc == 1) {
							if (gCurrentMap == 35) {
								gosub *custom_loadCnpcs
								gosub *custom_loadCitems
							}
						}
						msg_newline
						msgtemp = "  "
						firstturn = 1
						gosub *label_1338
						mode = 3
						goto *label_0942
					}
					nc_intb_001 = 1
				} else {
					if (cfg_reloadcnpc == 1) {
						if (gCurrentMap == 35) {
							gosub *custom_loadCnpcs
							gosub *custom_loadCitems
						}
					}
					msg_newline
					msgtemp = "  "
					firstturn = 1
					gosub *label_1338
					mode = 3
					goto *label_0942
				}
			}
		}
	}
	getkey a, 114
	if (a) {
		gosub *label_N450
		gosub *label_0623
		keywait = 1
		goto *label_1623
	}
	getkey a, 115
	if (a) {
		gosub *label_N300
		gosub *label_0623
		keywait = 1
		goto *label_1623
	}
	getkey a, 119
	if (a) {
		gosub *label_1309
		gosub *label_0623
		keywait = 1
		goto *label_1623
	}
	getkey a, 120
	if (a) {
		redraw 0
		gmode 2
		sxfix = 0
		syfix = 0
		gosub *label_0632
		gosub *label_0633
		gosub *label_0637
		p = windoww / 192
		repeat p + 1
			if (cnt == p) {
				sx = windoww \ 192
			} else {
				sx = 192
			}
			pos cnt * 192, inf_msgy
			gcopy 3, 496, 528, sx, 5
		loop
		redraw 1
		press
		gosub *label_0621
		snd 20
		goto *label_1623
	}
	getkey a, 122
	if (a) {
		gosub *label_1310
		await 500
		goto *label_1623
	}
	getkey a, 123
	if (a) {
		goto *label_1356
	}
	getkey a, 16
	if (a) {
		getkey a, 8
		if (a) {
			promptmax = 0
			exist exedir + "save\\" + playerid + "\\" + "autopick.txt"
			if (strsize != (-1)) {
				promptl(0, promptmax) = "autopick.txt", "null", "" + 0
				promptmax++
			}
			repeat 4, 1
				exist exedir + "save\\" + playerid + "\\" + "autopick_" + cnt + ".txt"
				if (strsize != (-1)) {
					promptl(0, promptmax) = "autopick_" + cnt + ".txt", "null", "" + cnt
					promptmax++
				}
			loop
			if (promptmax > 1) {
				val = promptx, prompty, 220, 1
				gosub *label_1353
				if (rtval == (-1)) {
					rtval = 0
				}
			} else {
				promptmax = 0
				rtval = 0
			}
			loadpickitembuff rtval
			if (rtval == 0) {
				txt -1, lang("autopick.txtを再読み込みした。", "Reloaded autopick.txt.")
			} else {
				txt -1, lang("autopick_" + rtval + ".txtを再読み込みした。", "Reloaded autopick_" + rtval + ".txt.")
			}
			await 200
			gosub *label_0623
			goto *label_1623
		}
	}
	if (key == "" | nc_intb_001 == 1) {
		nc_intb_001 = 0
		goto *label_1623
	}
	if (key == key_enter) {
		key = key_search
		cell_featread cX(cc), cY(cc)
		if (feat(1) == 11 | mapType == 1) {
			key = key_godown
		}
		if (feat(1) == 10) {
			key = key_goup
		}
		if (feat(1) >= 24 & feat(1) <= 28) {
			key = key_search
		}
		inv_getheader -1
		p = 0
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iX(cnt) != cX(cc) | iY(cnt) != cY(cc)) {
				continue
			}
			if (refitem(iId(cnt), 5, cnt) == 72000) {
				p = 1
			}
			if (refitem(iId(cnt), 9, cnt) == 60001) {
				p = 2
			}
			if (refitem(iId(cnt), 5, cnt) == 60002) {
				p = 3, cnt
			}
			if (iFunction(cnt) != 0 | refitem(iId(cnt), 11, cnt) != 0) {
				p = 4
			}
			if (refitem(iId(cnt), 2, cnt) != 0) {
				p = 5
			}
			if (iId(cnt) == 631) {
				key = key_godown
			}
			if (iId(cnt) == 750) {
				if (gCurrentMap == 7 | areaId(gCurrentMap) == 39) {
					key = key_goup
				}
			}
			if (iId(cnt) == 751) {
				if (gCurrentMap == 7 | areaId(gCurrentMap) == 39) {
					key = key_godown
				}
			}
			if (iId(cnt) == 753) {
				key = key_godown
			}
		loop
		if (key == key_godown | key == key_goup) {
			p = -1
		}
		if (p == 0) {
			if (key == key_enter) {
				key = key_search
			}
		}
		if (p == 1) {
			key = key_open
		}
		if (p == 2) {
			key = key_dip
		}
		if (p == 3) {
			if (godcheck() != "eyth") {
				key = key_offer
			} else {
				key = key_pray
			}
		}
		if (p == 4) {
			key = key_use
		}
		if (p == 5) {
			key = key_read
		}
	}
	if (mousel == 1) {
		mousemove = 1
		automove--
		ematan p, windoww / 2 - mousex, (windowh - inf_verh) / 2 - mousey
		p = p * 360 / 255
		if (p >= 338) {
			p = p - 360
		}
		s = key_south, key_southwest, key_west, key_northwest, key_north, key_northeast, key_east, key_southeast
		repeat 8
			if (p <= cnt * 45 + 23 & p > cnt * 45 - 23) {
				key = s(cnt)
			}
		loop
		await 100
	}
	if (key != "") {
		gosub *label_1624
	}
	if (key == key_quick) {
		gosub *label_1571
		gosub *label_0623
	}
	if (key == "sc") {
		if (ogdata(36 + sc) == (-1) & ncgsdata(sc) != "") {
			sdim nc_key_log, 64, 100
	  	dim nc_key_roop, 100
			folder = exedir + "user\\macro\\"
			macrofolder = folder + ncgsdata(sc)
			buff = ""
	    notesel buff
	    noteload macrofolder
	    repeat 100
	      noteget nc_key_log(cnt), cnt
	      if (nc_key_log(cnt) == "") {
	        break
	      }
	    loop
	    nc_macrorow = 0
	    nc_macromode = 1
			redraw 1
			goto *label_1623
		}
		goto *label_1216
	}
	menucycle = 1
	if (key == key_quickinv) {
		invctrl = lastctrl
		snd 100
		goto *label_1280
	}
	if (key == key_throw) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			invctrl = 26
			snd 100
			goto *label_1280
		}
	}
	if (key == key_inventory) {
		invctrl = 1
		snd 100
		goto *label_1280
	}
	if (key == key_drop) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			invctrl = 2
			snd 100
			goto *label_1280
		}
	}
	if (key == key_eat) {
		invctrl = 5
		snd 100
		goto *label_1280
	}
	if (key == key_read) {
		invctrl = 7
		snd 100
		goto *label_1280
	}
	if (key == key_drink) {
		invctrl = 8
		snd 100
		goto *label_1280
	}
	if (key == key_zap) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			invctrl = 9
			snd 100
			goto *label_1280
		}
	}
	if (key == key_use) {
		invctrl = 14
		snd 100
		goto *label_1280
	}
	if (key == key_open) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			invctrl = 15
			snd 100
			goto *label_1280
		}
	}
	if (key == key_dip) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			invctrl = 17
			snd 100
			goto *label_1280
		}
	}
	if (key == key_charainfo) {
		csctrl = 0
		goto *label_1251
	}
	if (key == key_material) {
		goto *label_1060
	}
	if (key == key_trait) {
		goto *label_1167
	}
	if (key == key_wear) {
		goto *label_1269
	}
	if (key == cfg_key_cast_ancient) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			curmenu = 2
			snd 102
			goto *label_1245
		}
	}
	if (key == cfg_key_cast_another) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			curmenu = 3
			snd 102
			goto *label_1245
		}
	}
	if (key == key_cast) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			curmenu = 0
			snd 102
			goto *label_1245
		}
	}
	if (key == key_skill) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			snd 101
			goto *label_1222
		}
	}
	if (key == key_msglog) {
		goto *label_1583
	}
	if (key == key_journal) {
		goto *label_1179
	}
	menucycle = 0
	if (key == key_offer) {
		if (mapType == 1) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			invctrl = 19
			snd 100
			item_find 60002, 2
			ti = stat
			goto *label_1280
		}
	}
	if (key == key_help) {
		gosub *label_1577
		gosub *label_0623
		goto *label_1623
	}
	if (key == key_haizinhelp) {
		gosub *label_N901
		gosub *label_0623
		goto *label_1623
	}
	if (key == key_rest) {
		goto *label_1302
	}
	if (key == key_interact) {
		if (mapType == 1 & 0 == 0) {
			gosub *label_2025
			goto *label_1623
		} else {
			goto *label_1226
		}
	}
	if (key == key_target) {
		findlocmode = 1
		gosub *label_1147
		findlocmode = 0
		goto *label_1623
	}
	if (key == key_fire) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			goto *label_1298
		}
	}
	if (key == key_give) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			goto *label_1225
		}
	}
	if (key == key_get | key == key_get2) {
		goto *label_1274
	}
	if (key == key_look) {
		if (mapType != 1) {
			goto *label_1152
		} else {
			gosub *label_1147
			goto *label_1623
		}
	}
	if (key == key_save | key_escape == 1) {
		goto *label_1304
	}
	if (key == key_dig) {
		goto *label_1217
	}
	if (key == cfg_key_autodig) {
		autodig_f = 1 - autodig_f
		if (autodig_f) {
			txt -1, lang("自動採掘をオンにした。", "You switched the automatic mining mode.")
		} else {
			txt -1, lang("自動採掘をオフにした。", "You switched the automatic mining mode.")
		}
		goto *label_1623
	}
	if (key == key_bash) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			goto *label_1220
		}
	}
	if (key == key_search) {
		goto *label_1446
	}
	if (key == key_close) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			goto *label_1440
		}
	}
	if (key == key_pray) {
		if (mapType == 1 & 0 == 0) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *label_1623
		} else {
			if (gettrait(0, 175)) {
				txt -1, lang("あなたは神を信じない。", "You do not believe in gods.")
				gosub *label_0623
				goto *label_1623
			}
			goto *label_1414
		}
	}
	if (key == cfg_key_godinfo) {
		prayctrl = 1
		gosub *label_1087
		goto *label_1617
	}
	if (key == key_ammo) {
		goto *label_1311
	}
	if (key == cfg_key_info) {
		viewinfo = 1 - viewinfo
		goto *label_1623
	}
	if (key == cfg_NC_key_music) {
		gosub *label_N400
		goto *label_1623
	}
	if (key == cfg_NC_key_macro) {
		gosub *label_M000
		goto *label_1623
	}
	if (key_tab) {
		gosub *label_0602
		gosub *label_0623
		goto *label_1623
	}
	p = 0
	if (key == key_north) {
		p = 1
		cNextX(0) = cX(0)
		cNextY(0) = cY(0) - 1
		gdata(35) = 3
		dirsub = 0
	}
	if (key == key_south) {
		p = 1
		cNextX(0) = cX(0)
		cNextY(0) = cY(0) + 1
		gdata(35) = 0
		dirsub = 4
	}
	if (key == key_west) {
		p = 1
		cNextX(0) = cX(0) - 1
		cNextY(0) = cY(0)
		gdata(35) = 1
		dirsub = 6
	}
	if (key == key_east) {
		p = 1
		cNextX(0) = cX(0) + 1
		cNextY(0) = cY(0)
		gdata(35) = 2
		dirsub = 2
	}
	if (key == key_northwest) {
		p = 1
		cNextX(0) = cX(0) - 1
		cNextY(0) = cY(0) - 1
		gdata(35) = 3
		dirsub = 7
	}
	if (key == key_northeast) {
		p = 1
		cNextX(0) = cX(0) + 1
		cNextY(0) = cY(0) - 1
		gdata(35) = 3
		dirsub = 1
	}
	if (key == key_southwest) {
		p = 1
		cNextX(0) = cX(0) - 1
		cNextY(0) = cY(0) + 1
		gdata(35) = 0
		dirsub = 5
	}
	if (key == key_southeast) {
		p = 1
		cNextX(0) = cX(0) + 1
		cNextY(0) = cY(0) + 1
		gdata(35) = 0
		dirsub = 3
	}
	cDirection(0) = gdata(35)
	if (p == 1) {
		goto *label_1427
	}
	if (key == key_godown) {
		val = 1
		goto *label_1431
	}
	if (key == key_goup) {
		val = 2
		goto *label_1431
	}
	if (key == key_wait) {
		goto *label_1617
	}
	if (key == key_enter) {
		gosub *label_0623
		goto *label_1623
	}
	if (key == key_abysstitle) {
		if (ncgdata(72) > 0) {
			snd 96
			goto *label_N600
		}
	}
	if (key == key_title) {
		snd 96
		menucycle = 4
		curmenu = 0
		goto *label_1171
	}
	if (key != "") {
		if (key != key_cancel) {
			if (key != key_alter) {
				msgdup++
				txt -1, lang("?キーを押すと、コマンドの一覧が見られる。", "Hit ? key to display help.")
				gosub *label_0623
			}
		}
	}
	goto *label_1623
*label_1624
	if (gAngbandFlag != (-1)) {
		if (mapType != 1) {
			if (gAngbandFlag == 0) {
				if (key == "Q") {
					txt -1, lang("え…", "What...")
					gAngbandFlag++
					gosub *label_0623
					goto *label_1623
				}
			} else {
				if (gAngbandFlag == 1) {
					if (key == "y") {
						txt -1, lang("まさか…", "No...no...")
						gAngbandFlag++
						gosub *label_0623
						goto *label_1623
					}
				} else {
					if (gAngbandFlag == 2) {
						if (key == "@") {
							txt -1, lang("うわぁぁぁ！！", "Ahhhhh!!")
							repeat 10
								flt
								characreate -1, 37, cX(0), cY(0)
							loop
							gAngbandFlag = -1
							gosub *label_0623
							goto *label_1617
						}
					}
					gAngbandFlag = 0
				}
				gAngbandFlag = 0
			}
		}
	}
	return
*label_1625
	snd 51
	music = -1
	gosub *label_0122
	txt -1, lang("信じられない！あなたはネフィアの迷宮「レシマス」を制覇した！", "Unbelievable! You conquered Lesimas!")
	gosub *label_0623
	buff = ""
	notesel buff
	file = exedir + "save\\trophy"
	repeat 25
		if (gettrait(0, 171 + cnt) < 0 & trophy(cnt) == 0) {
			txtef 2
			txt -1, lang("新しいトロフィーを獲得した！", "You get a new trophy!")
			trophy(cnt) = 1
		}
		noteadd "" + trophy(cnt)
	loop
	notesave file + ".txt"
	txtsetwinword 3
	repeat 3
		promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
		promptmax++
	loop
	promptl(0, promptmax) = lang("(自分の言葉を伝える)", "(Communicate your words)"), key_select(3), "" + promptmax
	promptmax++
	val = promptx, prompty, 310, 0
	gosub *label_1353
	if (rtval == 3) {
		await 100
		val = (windoww - 310) / 2 + inf_screenx, winposy(90), 16, 1, 0
		inputlog = ""
		gosub *label_1349
		if (inputlog == "") {
			wincomment = "" + promptl(0, 0)
		} else {
			wincomment = inputlog
		}
	} else {
		wincomment = "" + promptl(0, rtval)
	}
	repeat 16
		if (cState(cnt) == 1) {
			ctalk cnt, 1134, cnt, 0
		}
	loop
	mode = 7
	screenupdate = -1
	gosub *label_0623
	if (jp) {
		msg_clear
		txt -1, "「お前がここに辿り着くことは」台座から、何かの声が聞こえる。"
		flt
		characreate -1, 23, cX(0), cY(0)
		music = 69
		gosub *label_0122
		msg_halt
		msg_clear
		txt -1, "「決まっていたことなのだ…遅かれ早かれな」"
		txt -1, "部屋の空気が突然緊張し、あなたの前に端麗な青年が現れた。"
		txt -1, "「我々からすれば、複雑性の一面に過ぎないが、人間は運命とでも呼ぶのだろう？」"
		msg_halt
		msg_clear
		txt -1, "あなたは懸命に脚の震えを抑えようとしたが、難しかった。"
		txt -1, "華奢に見える幼顔の男の影は、人のものではない。"
		txt -1, "あどけない瞳の奥に、あなたは底知れない力と闇を感じた。"
		msg_halt
		msg_clear
		txt -1, "「ネフィアの永遠の盟約に基づき」青年は台座の横の死体を指し、皮肉な微笑を送った。"
		txt -1, "「この哀れな老人が守っていたものは、今からお前のものだ」"
		msg_halt
		msg_clear
		txt -1, "あなたは、台座の上に置かれている絢爛な装飾の本を、いぶかしげに眺めた。"
		msg_halt
		tc = findchara(23)
		gosub *label_1467
		msg_clear
		txt -1, "青年は悪戯っぽくニヤリと笑い、壁に寄りかかった。"
		msg_halt
		msg_clear
		chara_vanquish findchara(23)
		screenupdate = -1
		gosub *label_0623
		txt -1, "…どれくらい時間がたっただろう。氷の瞳の男は、いつの間にか姿を消していた。あなたは不安を振り払い、ゆっくりと本に手を伸ばした…"
		msg_halt
	}
	mode = 0
	music = 71
	gosub *label_0122
	gosub *label_0647
	redraw 0
	gsel 4
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	pos 0, 0
	gzoom windoww, windowh, 4, 0, 0, 640, 480
	gsel 0
	gosub *label_0648
	pos 0, 0
	gcopy 4, 0, 0, windoww, windowh
	gsel 4
	pos 0, 0
	picload_ exedir + "\\graphic\\g1.bmp", 1
	gsel 0
	s = lang("" + cdatan(1, 0) + cdatan(0, 0) + "に祝福あれ！あなたは遂にレシマスの秘宝を手にいれた！", "Blessing to " + cdatan(0, 0) + ", " + cdatan(1, 0) + "! You've finally aquired the codex!")
	gosub *label_0629
	s = lang("*勝利*", "*Win*"), "" + strhint3
	windowshadow = 1
	ww = 680
	wh = 488
	pagesize = 0
	display_window windoww / 2 - ww / 2, windowh / 2 - wh / 2, ww, wh
	cmbg = 0
	x = ww / 3 - 20
	y = wh - 140
	gmode 4, 180, 300, 250
	pos wx + ww - 120, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("制覇までの軌跡", "Trace"), wx + 28, wy + 40
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	color 0, 0
	pos wx + 40, wy + 76
	mes lang("" + 517 + "年" + 8 + "月" + 12 + "日に、あなたはノースティリスに到着した。", "In the year " + 517 + ", " + 12 + "/" + 8 + ", you arrived at North Tyris.")
	mes ""
	mes lang("最深で" + gDeepestDungeonLevel + "階相当まで到達し、" + gKillCount + "匹の敵を殺して、", "You've killed " + gKillCount + " creatures and reached\nmaximum of " + cnvrank(gDeepestDungeonLevel) + " level of dungeons.")
	mes lang("現在" + calcscore() + "点のスコアを叩き出している。", "Your score is " + calcscore() + " points now.")
	mes ""
	mes lang("" + gYear + "年" + gMonth + "月" + gDay + "日にレシマスを制覇して、", "In the year " + gYear + ", " + gDay + "/" + gMonth + ", you conquered Lesimas.")
	mes lang("あなたは「" + wincomment + "」とコメントした。", "Upon killing Zeome, you said, " + cnvtalk("" + wincomment))
	mes ""
	mes lang("…あなたの旅はまだ終わらない。", "Your journey continues...")
	mes ""
	if (jp) {
		titlename(0) = "無魔法", "虚弱", "優柔不断", "一神教者", "無神論者"
		titlename(5) = "暴食", "バッドコミュニケーション", "純情", "終生誓願", "トリガーハッピー"
		titlename(10) = "殺生忌避", "文盲", "動物敵対", "孤独", "性依存症"
		titlename(15) = "アルコール依存症", "ギャンブラー", "清廉潔白", "復活不可", "一期一会"
		titlename(20) = "食事不可", "オワタ式", "成長不可", "ハードモード", "Zen"
	} else {
		titlename(0) = "Nil Magic", "Flimsy", "Indecisiveness", "Monotheist", "Atheist"
		titlename(5) = "Bulimia", "Bad Communication", "Chaste", "Lifelong Vow", "Trigger Happy"
		titlename(10) = "Abhors Killing", "Illiterate", "Animal Discord", "Lonely", "Hypersexual Disorder"
		titlename(15) = "Alcoholism", "Gambling Addiction", "Pacifist", "One Life", "Once-in-a-lifetime chance"
		titlename(20) = "Can not eat", "1hit death", "not growth", "Hard Mode", "Zen"
	}
	if (gettrait(0, 193) < (-1)) {
		titlename(22) = lang("オール1", "All 1")
	}
	if (gettrait(0, 194) < (-1)) {
		titlename(23) = lang("ナイトメアモード", "Nightmare Mode")
	}
	f = 0
	repeat 23
		if (gettrait(0, 171 + cnt) < 0) {
			f = 1
		}
	loop
	if (f == 1) {
		mes lang("今回制覇したマイナスフィートは次の通りだ。", "The minus feet you've just captured are as follows.")
		repeat 25
			if (gettrait(0, 171 + cnt) < 0) {
				mes "＊" + titlename(cnt) + "＊"
			}
		loop
		f = 0
	}
	redraw 1
	key_list = key_enter
	keyrange = 0
	throwsstpevent "ConqueredLesimas", cc, wincomment, calcscore()
*label_1626
	await cfg_wait1
	key_check
	cursor_check
	if (key == key_cancel) {
		goto *label_1627
	}
	goto *label_1626
*label_1627
	gosub *label_0621
	txt -1, lang("達成のシーンをもう一度再現する？", "You want to watch this event again?")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *label_1353
	if (rtval == 0) {
		goto *label_1625
	}
	gdata(250 + 2) = 180
	gosub *label_0623
	return
*label_1628
	cc = 0
	snd 50
	screenupdate = -1
	gosub *label_0623
	throwsstpevent "Dead", cc, "", 0
	if (gExecutingImmediateQuestType) {
		goto *label_1548
	}
	if (oabit(13, gCurrentMap)) {
		screenupdate = -1
		gosub *label_0621
		levelexitby = 3
		goto *label_0939
	}
	if (gCatchesGodSignal) {
		txtgod godcheck(), 2407
		if (stat) {
			msg_halt
		}
	}
	txt -1, lang("さようなら… ", "Good bye... ")
	txt -1, lang("遺言は？", "You leave a dying message.")
	if (gettrait(0, 189) != 0) {
		ctrlFile 9
	}
	await 100
	val = (windoww - 310) / 2 + inf_screenx, winposy(90), 16, 1, 0
	inputlog = ""
	gosub *label_1349
	if (inputlog == "") {
		txtsetlastword
	} else {
		lastword = lang("「", "\"") + inputlog + lang("」", "\"")
	}
	throwsstpevent "Lastword", 0, inputlog, 0
	buff = ""
	notesel buff
	file = exedir + "save\\bone"
	exist file + ".txt"
	if (strsize != (-1)) {
		noteload file + ".txt"
	}
	s = cdatan(1, cc) + " " + cdatan(0, cc) + lang("", " ") + lastword
	lenfix s, 60
	s += lang("" + gYear + "年" + gMonth + "月" + gDay + "日", "" + gYear + "/" + gMonth + "/" + gDay)
	noteadd "", 0
	noteadd s, 1
	s = lang(mdatan(0) + "で" + ndeathcause, cnven(ndeathcause) + " in " + mdatan(0) + ".")
	noteadd s, 2
	s = "" + calcscore() + "," + cImage(cc)
	noteadd s, 3
	if (noteinfo(0) >= 80 * 4) {
		repeat noteinfo(0) - 80 * 4, 80 * 4
			notedel 80 * 4
		loop
	}
	page = 0
	repeat
		p(1) = 0
		repeat 80 - 1
			p = cnt * 4
			noteget s(10), p + 3
			csvsort s, s(10), 44
			p(2) = int(s)
			noteget s(10), p + 7
			csvsort s, s(10), 44
			p(3) = int(s)
			if (p(3) > p(2)) {
				if (cnt == page) {
					page = cnt + 1
				} else {
					if (cnt + 1 == page) {
						page = cnt
					}
				}
				repeat 3, 1
					noteget s, p + cnt
					noteget s(1), p + 4 + cnt
					noteadd s, p + 4 + cnt, 1
					noteadd s(1), p + cnt, 1
				loop
				p(1) = 1
			}
		loop
		if (p(1) == 0) {
			break
		}
	loop
	repeat noteinfo(0) / 4
		noteadd "" + cnvrank(cnt + 1) + lang("位", ""), cnt * 4, 1
	loop
	notesave file + ".txt"
	redraw 0
	gsel 4
	pos 0, 0
	picload_ exedir + "graphic\\void.bmp", 1
	gsel 0
	gosub *label_1629
	if (gettrait(0, 189) != 0) {
		s = lang("あなたの旅は幕を閉じた。さようなら…（キーを押すと終了します）", "You have been buried. Bye...(Hit any key to exit)")
		gosub *label_0629
		redraw 1
		press
		if (cfg_NC_logapply == 1) {
			s = "" + lang("[死亡ログ/復活不可モード]" + cdatan(1, 0) + " " + cdatan(0, 0) + "は" + mdatan(0) + "で" + ndeathcause + lastword, "[Dead Log/One Life]" + cdatan(1, 0) + " " + cdatan(0, 0) + " " + ndeathcause + " in " + mdatan(0) + " " + lastword)
			gosub *label_NNet
		}
		goto *system_quitElona
	} else {
		s = lang("あともう少しで埋葬される…", "You are about to be buried...")
		if (nc_intb_nightmare) {
			s = lang("ナイトメアモード時は埋まることができない。", "It cannot be filled when in nightmare mode.")
		}
	}
	gosub *label_0629
	promptl(0, promptmax) = lang("這い上がる", "Crawl up"), "a", "0"
	promptmax++
	if (nc_intb_nightmare == 0) {
		promptl(0, promptmax) = lang("埋まる", "Lie on your back"), "b", "1"
		promptmax++
	}
	if (cfg_ST_exchangeCrawlUpOrBuried & nc_intb_nightmare == 0) {
		// Swap "Crawl up" and "Lie on your back"
		s@tmp = promptl(0, 0)
		promptl(0, 0) = promptl(0, 1)
		promptl(0, 1) = s@tmp
		// Swap values.
		s@tmp = promptl(2, 0)
		promptl(2, 0) = promptl(2, 1)
		promptl(2, 1) = s@tmp
	}
	val = promptx, 100, 240, 1
	gosub *label_1353
	if (rtval == 1) {
		gosub *label_1629
		s = lang("あなたは埋められた。さようなら…（キーを押すと終了します）", "You have been buried. Bye...(Hit any key to exit)")
		gosub *label_0629
		redraw 1
		press
		goto *system_quitElona
	}
	s = "dead" + lang(cdatan(1, 0) + cdatan(0, 0) + "は" + mdatan(0) + "で" + ndeathcause + lastword, cdatan(1, 0) + " " + cdatan(0, 0) + " " + ndeathcause + " in " + mdatan(0) + " " + lastword)
	if (gWizard == 0) {
		net_send s
		if (cfg_NC_logapply == 1) {
			s = "" + lang("[死亡ログ]" + cdatan(1, 0) + " " + cdatan(0, 0) + "は" + mdatan(0) + "で" + ndeathcause + lastword, "[Dead Log]" + cdatan(1, 0) + " " + cdatan(0, 0) + " " + ndeathcause + " in " + mdatan(0) + " " + lastword)
			gosub *label_NNet
		}
	}
	if (gettrait(0, 195) != 0) {
		cBlind(0) = 1000
	}
	screenupdate = -1
	gosub *label_0621
	levelexitby = 3
	goto *label_0939
*label_1629
	notesel buff
	redraw 0
	gmode 0
	pos 0, 0
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gmode 2
	x = 135
	y = 134
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 138, 131, 100
	p = page - 4
	if (p >= 80) {
		p = 80 - 8
	}
	if (p < 0) {
		p = 0
	}
	repeat 8, p
		p = cnt * 4
		y += 46
		if (cnt == page) {
			s = "New!"
		} else {
			s = " " + cnvrank(cnt + 1) + lang("位", "")
		}
		pos x - 80, y + 10
		color 10, 10, 10
		mes s
		if (p >= noteinfo(0)) {
			s = "no entry"
		} else {
			noteget s, p + 1
		}
		pos x, y
		color 10, 10, 10
		mes s
		if (p >= noteinfo(0)) {
			continue
		}
		noteget s, p + 2
		pos x, y + 20
		color 10, 10, 10
		mes s
		noteget s(10), p + 3
		csvsort s, s(10), 44
		pos x + 480, y + 20
		color 10, 10, 10
		mes "" + s + lang("点", "")
		p = int(s(1)) \ 1000
		chara_preparepic p
		pos x - 22, y + 12
		gmode 2, chipc(2, p), chipc(3, p)
		grotate 5, 0, 960, 0, chipc(2, p) / (1 + (chipc(3, p) > inf_tiles)), inf_tiles
	loop
	return
*label_1630
	oomSEST_log "event"
	_switch_val = evid()
	if (_switch_val == 8 | _switch_sw) {
		_switch_sw = 0
		gosub *label_1551
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 14 | _switch_sw) {
		_switch_sw = 0
		if (gExecutingImmediateQuestType == 1009) {
			txt -1, lang("パーティーは終了した。", "The party is over.")
			calcpartyscore
			calcpartyscore2
			txt -1, lang("最終得点は" + qdata(13, gExecutingImmediateQuest) + "ポイントだった！", "Your final score is " + qdata(13, gExecutingImmediateQuest) + " points!")
			if (qdata(12, gExecutingImmediateQuest) <= qdata(13, gExecutingImmediateQuest)) {
				gdata(73) = 3
				qdata(8, gExecutingImmediateQuest) = 3
				txtef 2
				txt -1, lang("パーティーは大盛況だった！", "People had a hell of a good time!")
				gosub *label_1073
			} else {
				txtef 8
				txt -1, lang("パーティーはぐだぐだになった…", "The party turned out to be a big flop...")
			}
			ogdata(33) = 0
		}
		if (gExecutingImmediateQuestType == 1006) {
			if (qdata(12, gExecutingImmediateQuest) < qdata(13, gExecutingImmediateQuest)) {
				gdata(73) = 3
				qdata(8, gExecutingImmediateQuest) = 3
				txtef 2
				txt -1, lang("無事に納入を終えた！", "You complete the task!")
				msg_halt
			} else {
				txtef 8
				txt -1, lang("納入は間に合わなかった…", "You fail to fulfill your task...")
			}
		}
		if (gExecutingImmediateQuestType == 1008) {
			txtef 8
			txt -1, lang("討伐に失敗した…", "You failed to slay the target...")
		}
		if (gExecutingImmediateQuestType == 1020) {
			txt -1, lang("もてなしは終了した。", "The hospitality was over.")
			txt -1, lang("あなたは" + qdata(13, gExecutingImmediateQuest) + "人の客を取った！", "You could have entertained " + qdata(13, gExecutingImmediateQuest) + " people!")
			if (qdata(12, gExecutingImmediateQuest) <= qdata(13, gExecutingImmediateQuest)) {
				gdata(73) = 3
				qdata(8, gExecutingImmediateQuest) = 3
				txtef 2
				txt -1, lang("無事に依頼を終えた！", "People had a hell of a good time!")
				msg_halt
			}
		}
		if (gExecutingImmediateQuestType == 1021) {
			if (qdata(12, gExecutingImmediateQuest) == 0) {
				txtef 8
				txt -1, lang("あなたは護衛の任務を果たせなかった。", "You have failed to protect the sheep.")
				modkarma 0, -10
			} else {
				music = 74
				musicloop = 1
				gosub *label_0122
				gdata(73) = 3
				qdata(8, gExecutingImmediateQuest) = 3
				txtef 2
				txt -1, lang("無事に護衛を終えた！", "You complete the task!")
				msg_halt
			}
		}
		levelexitby = 4
		snd 49
		chatteleport = 1
		return
		_switch_sw++
	}
	if (_switch_val == 1 | _switch_sw) {
		_switch_sw = 0
		throwsstpevent "ZeomeKilled", cc, "", 0
		gosub *label_1625
		flt
		characreate -1, 23, cX(0), cY(0)
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 27 | _switch_sw) {
		_switch_sw = 0
		if (gCurrentMap == 35) {
			goto *label_1631
		}
		flt
		novoidlv = 1
		characreate -1, 319, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		txtef 4
		txt -1, lang("ビッグダディの肩から、リトルシスターが滑り落ちた。「Mr Bubbles！！」", "The little sister slips from Big Daddy's shoulder, " + cnvtalk("Mr.Bubbles!"))
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 200 | _switch_sw) {
		_switch_sw = 0
		if (gCurrentMap == 35) {
			goto *label_1631
		}
		flt
		novoidlv = 1
		characreate -1, 390, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		cRole(rc) = 3304
		txtef 4
		txt -1, lang("主に捕まっていた何者かが、地面に落ちた。", "Something that had been captured by the Dragon fell to the ground.")
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 28 | _switch_sw) {
		_switch_sw = 0
		txtef 5
		txt -1, lang("…ぅっぅぅ…っぅぅっぅううううみみゃぁ！！！", "memememw...MEMEMEM...MEWWWWWW!")
		msg_halt
		animeid = 21
		gosub *label_0630
		flt
		characreate -1, 336, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		cdata(215, rc) = -1
		cdata(220, rc) = 612, 459, 620, 601
		cAiActNum(rc) = 41
		ocbitmod 7, rc, 1
		ocbitmod 13, rc, 0
		cbitmod 26, rc, 0
		cbitmod 28, rc, 0
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 2 | _switch_sw) {
		_switch_sw = 0
		tc = findchara(34)
		gosub *label_1467
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 24 | _switch_sw) {
		_switch_sw = 0
		initeco = 1
		gosub *label_1500
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 3 | _switch_sw) {
		_switch_sw = 0
		tc = findchara(2)
		gosub *label_1467
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 11 | _switch_sw) {
		_switch_sw = 0
		if (findchara(1) != 0) {
			tc = findchara(1)
		} else {
			tc = findchara(249)
		}
		gosub *label_1467
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 23 | _switch_sw) {
		_switch_sw = 0
		if (findchara(302) != 0) {
			tc = findchara(302)
		} else {
			if (findchara(317, 6) != 0) {
				tc = findchara(317, 6)
			} else {
				tc = findchara(249)
			}
		}
		gosub *label_1467
		gdata(171) = 23
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 12 | _switch_sw) {
		_switch_sw = 0
		gosub *label_0623
		s = lang("ペットとの再会", "Reunion with your pet")
		file = "bg_re13"
		buff = lang("あなたは懐かしい鳴き声に気付いて、ふと歩みを止めた。なんと、船が難破した時に居なくなったあなたのペットが、嬉しそうに走ってくる！あなたのペットは…", "As you approach the mining town, you notice a familiar call and stop walking. Your old pet who got separated from you during the shipwreck is now running towards you joyfully! Your pet is...")
		listmax = 0
		list(0, listmax) = 1
		listn(0, listmax) = lang("犬だ！", "a dog!")
		listmax++
		list(0, listmax) = 2
		listn(0, listmax) = lang("猫だ！", "a cat!")
		listmax++
		list(0, listmax) = 3
		listn(0, listmax) = lang("クマだ！", "a bear!")
		listmax++
		list(0, listmax) = 4
		listn(0, listmax) = lang("少女だ！", "a little girl!")
		listmax++
		if (ogbit(8)) {
			list(0, listmax) = 5
			listn(0, listmax) = lang("妹だ！", "a younger sister!")
			listmax++
		}
		// You enter Vernis for the first time.
		if (gCurrentMap == 5 & gdata(250 + 7) == 0) {
			gdata(250 + 7) = 1
			list(0, listmax) = 6
			listn(0, listmax) = lang("人違いだ...", "Just a wrong person...")
			listmax++
		}
		gosub *label_1097
		p = 3
		if (rtval == 1) {
			p = 165
		}
		if (rtval == 2) {
			p = 164
		}
		if (rtval == 3) {
			p = 108
		}
		if (rtval == 4) {
			p = 166
		}
		if (rtval == 5) {
			p = 176
		}
		if (rtval == 6) {
			goto *label_1631
		}
		flt
		initlv = cLevel(0) * 2 / 3 + 1
		novoidlv = 1
		characreate -1, p, cX(cc), cY(cc)
		gosub *label_1530
		ogbitmod 8, 0
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 13 | _switch_sw) {
		_switch_sw = 0
		music = 80
		gosub *label_0122
		s = lang("結婚", "Marriage")
		file = "bg_re14"
		buff = lang("長い交際の末、遂にあなたと" + name(marry) + "は固い絆で結ばれた。婚儀の後、あなたの元に幾つか祝儀品が届けられた。", "At last, you and " + name(marry) + " are united in marriage! After the wedding ceremony, you receive some gifts.")
		listmax = 0
		list(0, listmax) = 1
		listn(0, listmax) = lang("生涯をあなたに捧げる", "Without you, life has no meaning.")
		listmax++
		gosub *label_1097
		repeat 5
			flt calcobjlv(cLevel(marry) + 5), calcfixlv(3)
			flttypemajor = fsetchest(rnd(length(fsetchest)))
			itemcreate -1, 0, cX(0), cY(0), 0
		loop
		flt
		itemcreate -1, 477, cX(0), cY(0), 0
		iQuality(ci) = 5
		iEnhancement(ci) = 1
		iCurseState(ci) = 1
		ibitmod 5, ci, 1
		ibitmod 17, ci, 1
		ibitmod 21, ci, 1
		iParam2(ci) = cId(marry)
		if (cId(marry) == 343) {
			inv(33, ci) = cCnpcId(marry)
			inv(34, ci) = createserialno(userdatan(0, cCnpcId(marry)))
		}
		iSubname(ci) = 0
		repeat 15
			p = reinforcecheck(cnt, ci)
			if (p == (-1)) {
				break
			}
			if (p) {
					inv(40 + cnt * 2, ci) = 0
					inv(41 + cnt * 2, ci) = 0
			}
		loop
		flt
		itemcreate -1, 477, cX(0), cY(0), 0
		iQuality(ci) = 5
		iEnhancement(ci) = 1
		iCurseState(ci) = 1
		ibitmod 5, ci, 1
		ibitmod 17, ci, 1
		ibitmod 21, ci, 1
		iParam2(ci) = 999
		iSubname(ci) = 0
		repeat 15
			p = reinforcecheck(cnt, ci)
			if (p == (-1)) {
				break
			}
			if (p) {
					inv(40 + cnt * 2, ci) = 0
					inv(41 + cnt * 2, ci) = 0
			}
		loop
		itemcreate -1, 559, cX(0), cY(0), 0
		flt
		itemcreate -1, 55, cX(0), cY(0), rnd(3) + 2
		if (trophycheck(8) == 2) {
			flt
			itemcreate -1, 622, cX(0), cY(0), 3 + rnd(3)
			flt
			itemcreate -1, 55, cX(0), cY(0), 5 + rnd(3)
		}
		txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		ogdata(430)++
		gosub *label_1177
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 29 | _switch_sw) {
		_switch_sw = 0
		boss = 1
		music = 62
		gosub *label_0122
		dim voidboss, 0
		if (gCurrentMap == 210) {
			voidboss = 26, 27, 28, 29, 140, 34, 141, 143, 144, 145, 242, 25, 257, 230, 202, 37, 33, 80, 332, 306, 331, 338, 339, 342, 366, 367
		} else {
			voidboss = 26, 27, 28, 29, 140, 34, 141, 143, 144, 145, 242, 25, 257, 230, 202, 37, 33, 80, 332
		}
		if (gdata(250 + 222) == 1000) {
			voidboss(length(voidboss)) = 300
		}
		if (gdata(250 + 2) >= 200) {
			voidboss(length(voidboss)) = 23
			voidboss(length(voidboss)) = 2
			voidboss(length(voidboss)) = 146
			voidboss(length(voidboss)) = 139
		}
		if (gdata(250 + 203) == 1001) {
			voidboss(length(voidboss)) = 222
		}
		if (ncgdata(155) >= 1000) {
			voidboss(length(voidboss)) = 390
		}
		if (ncgdata(158) >= 1000) {
			voidboss(length(voidboss)) = 393
		}
		if (npcmemory(0, 175) >= 1) {
			voidboss(length(voidboss)) = 175
		}
		if (npcmemory(0, 177) >= 1) {
			voidboss(length(voidboss)) = 177
		}
		if (npcmemory(0, 178) >= 1) {
			voidboss(length(voidboss)) = 178
		}
		randomize gYear + gCurrentDungeonLevel
		c = voidboss(rnd(length(voidboss)))
		randomize
		flt
		fixlv = 4
		initlv = limit(gCurrentDungeonLevel / 4, 50, 250)
		characreate -1, c, -3, 0
		cbitmod 976, rc, 1
		cRelationship(rc) = -3
		cOriginalRelationship(rc) = -3
		boss = 0
		tc = rc
		areaHasBeenConquered(gCurrentMap) = tc
		txtef 3
		txt -1, lang("気をつけろ！この階は" + mapname(gCurrentMap) + "の守護者、" + cdatan(0, tc) + "によって守られている。", "Be aware! This level is guarded by the lord of " + mapname(gCurrentMap) + ", " + cdatan(0, tc) + ".")
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 4 | _switch_sw) {
		_switch_sw = 0
		boss = 1
		repeat
			gosub *label_0937
			fixlv = 4
			initlv = gCurrentDungeonLevel + rnd(5)
			if (oabit(7, gCurrentMap)) {
				if (oabit(6, gCurrentMap)) {
					initlv = gCurrentDungeonLevel * 3 + rnd(5)
				} else {
					npcrare = 1
				}
			}
			if (oabit(0, gCurrentMap)) {
				initlv = initlv * 3 / 2
				dbid = 282
			} else {
				if (oabit(8, gCurrentMap)) {
					initlv = initlv * 3 / 2
				} else {
					if (oabit(3, gCurrentMap)) {
						olistmax = 0
						repeat length(csetquestboss)
							if (npcmemory(0, csetquestboss(cnt) / 10000) == 0) {
								continue
							}
							if (initlv < csetquestboss(cnt) \ 10000) {
								continue
							}
							olist(olistmax) = csetquestboss(cnt) / 10000
							olistmax++
						loop
						repeat usernpcmax
							if (userdata(12, cnt) != 2) {
								continue
							}
							if (getcnpcmemory(0, cnt) == 0) {
								continue
							}
							if (initlv < userdata(2, cnt)) {
								continue
							}
							olist(olistmax) = 343 + (cnt + 1) * 10000
							olistmax++
						loop
						p = olist(rnd(olistmax))
						dbid = p \ 10000
						initunid = p / 10000
						nospartifact = 1
						noenchant = 1
					} else {
						if (oabit(6, gCurrentMap)) {
							charakind = 0
							dbid = -2
							initlv = objlv + rnd(5)
							nospartifact = 1
						} else {
							if (oabit(10, gCurrentMap)) {
								gosub *label_1793
								if (charakind < length(csetgodservant)) {
									fixgod = godno2godid(charakind + 1)
								} else {
									fixgod = cgodShortId(charakind - length(csetgodservant))
								}
							}
						}
					}
				}
			}
			if (oabit(17, gCurrentMap) | oabit(18, gCurrentMap)) {
				initlv = 6666
				dbid = 336
			}
			characreate 56, dbid, -3, 0
			if (stat == 0) {
				continue
			} else {
				gosub *label_1759
				relocate_chara 56, -1, -3
				modnpcmemory 1, rc, 1
				cHp(rc) = cMaxHp(rc)
				cMp(rc) = cMaxMp(rc)
				cSp(rc) = cMaxSp(rc)
				cbitmod 976, rc, 1
				fixgod = ""
				if (oabit(17, gCurrentMap) | oabit(18, gCurrentMap)) {
						cbitmod 6, rc, 1
						cbitmod 28, rc, 1
						cbitmod 39, rc, 1
						addbuff rc, 60, 100, 10000
						addbuff rc, 61, 100, 10000
						addbuff rc, 63, 100, 10000
						cdata(215, rc) = -1
						cdata(220, rc) = 903, 904, 900
						cAiActNum(rc) = 31
						cRole(rc) = 3004
						txtef 3
						txt -1, lang("けたたましい警報が鳴り響いた！", "*beeeeeep!* An alarm sounds loudly!")
						repeat 188, 57
							if (cState(cnt) == 1) {
								cRelationship(cnt) = -3
								lockon cnt, 0, 29
								cHate(cnt) = 250
							}
						loop
				}
				break
			}
		loop
		boss = 0
		tc = rc
		areaHasBeenConquered(gCurrentMap) = tc
		cdatan(0, rc) += " Lv" + cLevel(rc)
		txt -1, lang("どうやら最深層まで辿り着いたらしい…", "It seems you have reached the deepest level of this dungeon.")
		txtef 3
		txt -1, lang("気をつけろ！この階は" + mapname(gCurrentMap) + "の守護者、" + cdatan(0, tc) + "によって守られている。", "Be aware! This level is guarded by the lord of " + mapname(gCurrentMap) + ", " + cdatan(0, tc) + ".")
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 5 | _switch_sw) {
		_switch_sw = 0
		music = 64
		gosub *label_0122
		snd 51
		repeat 1 + oabit(9, gCurrentMap) * 3
			flt
			flttypemajor = 54000
			itemcreate -1, 0, cX(0), cY(0), 0
			flt
			itemcreate -1, 236, cX(0), cY(0), 0 // 帰還の巻物
			nostack = 1
			flt
			itemcreate -1, 54, cX(0), cY(0), 0 // 金貨
			gold@st = (rnd((cFame(0) / 20) + 1) + rnd((cFame(0) / 20) + 1) + 1) * 10
			iNumber(ci) = 200 + iNumber(ci) * 5 + gold@st
			item_stack -1, ci
			flt
			oo_num = 1 + rnd(2)
			if (gettrait(0, 170)) {
				oo_num += limit(gCurrentDungeonLevel / 25, 0, 10000 - oo_num)
			}
			oo_num += rnd(1 + limit(gCurrentDungeonLevel / 5, 0, 10000 - oo_num))
			itemcreate -1, 55, cX(0), cY(0), oo_num // プラチナ硬貨
			flt
			itemcreate -1, 239, cX(0), cY(0), 0 // 宝石宝箱
			iParam2(ci) = 0
			// 孤独
			if (oabit(2, gCurrentMap)) {
				repeat 10
					flt
					itemcreate -1, 422 + rnd(6), cX(0), cY(0), 0 // ハーブ系
				loop
			}
			if (oabit(5, gCurrentMap)) {
				flt
				if (finditemid("artifacts fusion license")) {
					inititemid = stat
					itemcreate -1, 743, cX(0), cY(0), 3 // カルネアデスの板
				}
			}
			// 異形
			if (oabit(14, gCurrentMap)) {
				flt
				itemcreate -1, 559, cX(0), cY(0), 0 // エーテル抗体
				iEnhancement(ci) = limitmax(gCurrentDungeonLevel / 30, 2000)
				flt
				itemcreate -1, 793, cX(0), cY(0), 3 // *エーテル抗体*
			}
			// 《白夜》
			if (oabit(17, gCurrentMap)) {
				flt
				itemcreate -1, 797, cX(0), cY(0), 0 // ★インフィーア
				iEnhancement(ci) = limitmax(gCurrentDungeonLevel / 30, 2000)
				flt
				itemcreate -1, 559, cX(0), cY(0), 3 // エーテル抗体
				iEnhancement(ci) = limitmax(gCurrentDungeonLevel / 30, 2000)
				flt
				if (finditemid("artifacts fusion license")) {
					inititemid = stat
					itemcreate -1, 743, cX(0), cY(0), 50 // カルネアデスの板
				}
				flt
				itemcreate -1, 239, cX(0), cY(0), 10 // 宝石宝箱
				iParam2(ci) = 0
			}
			// 《極夜》
			if (oabit(18, gCurrentMap)) {
				flt
				itemcreate -1, 798, cX(0), cY(0), 0 // ★全部の魔法書
				iEnhancement(ci) = limitmax(gCurrentDungeonLevel / 30, 2000)
				flt
				itemcreate -1, 559, cX(0), cY(0), 3 // エーテル抗体
				iEnhancement(ci) = limitmax(gCurrentDungeonLevel / 30, 2000)
				flt
				if (finditemid("artifacts fusion license")) {
					inititemid = stat
					itemcreate -1, 743, cX(0), cY(0), 50 // カルネアデスの板
				}
				flt
				itemcreate -1, 239, cX(0), cY(0), 10 // 宝石宝箱
				iParam2(ci) = 0
			}
		loop
		// フェアリゾートのネフィア
		if (areaOuterMap(gCurrentMap) == 47) {
			flt
			itemcreate -1, 801, cX(0), cY(0), 1 + (gCurrentDungeonLevel / 20)
		}
		if (gCurrentMap == 42) {
			flt
			itemcreate -1, 685, cX(0), cY(0), 0 // モンスターボール
			ibitmod 5, ci, 1
			iParam2(ci) = 10000
			iColor(ci) = 2
			iValue(ci) = 10000
		} elseif (gCurrentMap == 210) {
			flt
			if (finditemid("artifacts fusion license")) {
				inititemid = stat
				itemcreate -1, 743, cX(0), cY(0), 3 + (gCurrentDungeonLevel / 50) // カルネアデスの板
			}
		} else {
			if (rndex(10000) < 250) {
				flt
				itemcreate -1, 793, cX(0), cY(0), 0 // *エーテル抗体*
			}
		}
		txtef 2
		txt -1, lang("クエストを達成した！", "You have completed the quest!")
		snd 51
		txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		modrank 2, 300, 8
		gdata(74) = calcfame(0, gCurrentDungeonLevel * 30 + 200)
		txtef 2
		txt -1, lang("" + gdata(74) + "の名声値を手に入れた。", "You gain " + gdata(74) + " fame.")
		incfame 0, gdata(74)
		if (gCurrentMap == 42) {
			if (gCurrentDungeonLevel > 1050) {
				flt
				fixlv = 5
				flttypemajor = isetabyss(rnd(length(isetabyss)))
				itemcreate -1, 0, cX(0), cY(0), 0
				repeat 15
					if (iEnchantmentId(ci, cnt) == 0) {
						break
					}
					iEnchantmentPower(ci, cnt) = limitmax(iEnchantmentPower(ci, cnt) * (rnd((gCurrentDungeonLevel - 50) / 100 + 1) + 10), 2000000000)
				loop
			}
			areaHasBeenConquered(gCurrentMap) = 0
			if (gdata(186) - 49 > ncgdata(68)) {
				ncgdata(68) = gdata(186) - 49
			}
			gdata(186) = gdata(186) + 5
			txt -1, lang("この階の封印が解けたようだ！", "The seal of this level is now broken!")
		} elseif (gCurrentMap == 210) {
			flt
			fixlv = 5
			flttypemajor = isetabyss(rnd(length(isetabyss)))
			itemcreate -1, 0, cX(0), cY(0), 0
			repeat 15
				if (iEnchantmentId(ci, cnt) == 0) {
					break
				}
				iEnchantmentPower(ci, cnt) = limitmax(iEnchantmentPower(ci, cnt) * (rnd((gCurrentDungeonLevel - 50) / 5 + 1) + 100), 2100000000)
				if (ncgdata(350) > 0 & iEnchantmentPower(ci, cnt) > 0) {
					iEnchantmentPower(ci, cnt) += (iEnchantmentPower(ci, cnt) / 10) * rnd(ncgdata(350)) + 1
				}
			loop
			add_bigench 1
			if ((gCurrentDungeonLevel - 49) \ 50 == 0) {
				flt
				fixlv = 5
				flttypemajor = isetabyss(rnd(length(isetabyss)))
				itemcreate -1, 0, cX(0), cY(0), 0
				repeat 15
					if (iEnchantmentId(ci, cnt) == 0) {
						break
					}
					iEnchantmentPower(ci, cnt) = limitmax(iEnchantmentPower(ci, cnt) * (rnd((gCurrentDungeonLevel - 50) / 5 + 1) + 100), 2100000000)
					if (ncgdata(350) > 0 & iEnchantmentPower(ci, cnt) > 0) {
						iEnchantmentPower(ci, cnt) += (iEnchantmentPower(ci, cnt) / 10) * rnd(ncgdata(350)) + 1
					}
				loop
				add_bigench 2
			}
			areaHasBeenConquered(gCurrentMap) = 0
			if ((gCurrentDungeonLevel - 49) > ncgdata(72)) {
				ncgdata(72) = (gCurrentDungeonLevel - 49)
			}
			ncgdata(203) = gCurrentDungeonLevel
			txt -1, lang("この階の封印が解けたようだ！", "The seal of this level is now broken!")
		} else {
			areaHasBeenConquered(gCurrentMap) = -1
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 16 | _switch_sw) {
		_switch_sw = 0
		txt -1, lang("あなたは無事に護衛の任務を終えた。", "You complete the escort.")
		tc = evdata2(evnum - (evnum != 0) * 1)
		gosub *label_1467
		rq = evdata1(evnum - (evnum != 0) * 1)
		gosub *label_1552
		chara_vanquish evdata2(evnum - (evnum != 0) * 1)
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 15 | _switch_sw) {
		_switch_sw = 0
		repeat gNumberOfExistingQuests
			if (qdata(3, cnt) == 1007) {
				if (qdata(8, cnt) == 1) {
					if (qdata(13, cnt) == evdata1(evnum - (evnum != 0) * 1)) {
						rq = cnt
						val = qdata(3, rq)
						gosub *label_1549
						break
					}
				}
			}
		loop
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 6 | _switch_sw) {
		_switch_sw = 0
		// Nightmare
		if (nc_intb_nightmare) {
			repeat 50 - 10, 10
				if (cnt <= 17) {
					if (sdata(cnt, 0) != 0) {
						if (rnd(3) == 0) {
							skillexp2 cnt, 0, -500
						}
					}
				}
			loop
			cGold(0) -= cGold(0) / 2
		} else {
			if (cFame(0) > 1000) {
				repeat 50 - 10, 10
					if (cnt <= 17) {
						if (sdata(cnt, 0) != 0) {
							if (rnd(3) == 0) {
								skillexp2 cnt, 0, limit((cFame(0) / 100) * 5, 100, 500) * (-1)
							}
						}
					}
				loop
				if (cKarma(0) < (-30)) {
					modkarma 0, 10
				}
			} else {
				txt -1, lang("名声が1000に達していないので能力値の減少はない。", "Death penalty won't be applied until you hit fame 1000.")
			}
			cGold(0) -= cGold(0) / 3
		}
		if (gEtherDiseaseStage >= 28000) {
			modcorrupt -2000
		}
		txt -1, lang("金貨を幾らか失った…", "You lost some money.")
		decfame 0, 10
		if (eqfaction(0, "slime")) {
			rmfaction 0, "slime"
		}
		if (eqfaction(0, "dragon")) {
			rmfaction 0, "dragon"
			ospact(782 - 661) = 0
		}
		if (eqfaction(0, "golem")) {
			rmfaction 0, "golem"
		}
		r1 = 0
		gosub *chara_refresh
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 20 | _switch_sw) {
		_switch_sw = 0
		dmghp evdata1(evnum - (evnum != 0) * 1), 9999, -11
		cRole(evdata1(evnum - (evnum != 0) * 1)) = 0
		cState(evdata1(evnum - (evnum != 0) * 1)) = 0
		flt
		itemcreate -1, 55, cX(evdata1(evnum - (evnum != 0) * 1)), cY(evdata1(evnum - (evnum != 0) * 1)), 4
		gdata(250 + 203) = 1001
		tc = findchara(221)
		if (tc != 0) {
			if (cState(tc) == 1) {
				txtef 4
				txt -1, lang("パエル「おかあさんーー！！」", cnvtalk("M-mom...!!"))
				cRelationship(tc) = -3
				cHate(tc) = 1000
				lockon tc, 0, 28
			}
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 7 | _switch_sw) {
		_switch_sw = 0
		gosub *label_0649
		press
		screenupdate = -1
		gosub *label_0621
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 10 | _switch_sw) {
		_switch_sw = 0
		gosub *label_1546
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 19 | _switch_sw) {
		_switch_sw = 0
		txtef 6
		txt -1, "" + usermsg
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 25 | _switch_sw) {
		_switch_sw = 0
		gNumberOfWaitingGuests--
		if (get_freechara() == (-1)) {
			txt -1, lang("ゲストは行方不明になった。", "The guest lost his way.")
			goto *label_1631
		}
		if (rnd(3)) {
			p = 0
			tc = 0
			repeat 100
				i = rnd(40 - 1) + 16
				if (cState(i) == 3) {
					if (cbit(969, i) == 0) {
						cCurrentMap(i) != gCurrentMap
						if (cRelationship(i) >= 0) {
							if (rnd(25) < p) {
								break
							}
							if (tc == 0) {
								tc = i
								p++
								if (cImpression(tc) < 25) {
									if (rnd(12) == 0) {
										break
									}
								}
								if (cImpression(tc) < 0) {
									if (rnd(4)) {
										break
									}
								}
								continue
							}
							if (cImpression(cnt) < cImpression(i)) {
								tc = i
								p++
							}
						}
					}
				}
			loop
			if (tc == 0) {
				txt -1, lang("ゲストはすでに居なくなっていた。", "It seems the guest has already left your house.")
				goto *label_1631
			}
			cState(tc) = 1
			rc = tc
			cxinit = cX(0)
			cyinit = cY(0)
			place_chara rc, cxinit, cyinit
		} else {
			flt 0, 2
			repeat 1
				if (rnd(3) == 0 & guildcheck(0) == "prostitute") {
						flt
						initlv = rnd(5) + (50 - gdata(128) / 200)
						fixlv = 6
            characreate -1, 274, -3, 0
						cRelationship(rc) = 0
						cOriginalRelationship(rc) = 0
						cRole(rc) = 3004
						cGold(rc) = 1000 * cLevel(rc)
						cdatan(0, rc) = lang("『お金持ちのパパ』", "<Rich customers>")
						break
				}
				if (rnd(10) == 0 & cGold(0) >= 1000000) {
            initunid = findunid("eggplant putit")
            if (initunid) {
							  flt
							  initlv = 50
							  fixlv = 6
                characreate -1, 343, -3, 0
                cRole(rc) = 3
								cRelationship(rc) = 0
								cOriginalRelationship(rc) = 0
								cSex(rc) = 1
								cRole(rc) = 3003
								cShopStoreId(rc) = 3003
								cShopRank(rc) = limit((cGold(0) / 10000) + (cFame(0) / 100), 10, 10000)
								cdatan(0, rc) = lang("『がらくた売りのプチナス』", "<The junk Shop eggplant putit>")
								break
            }
				}
				if (rnd(10) == 0 & cMaxSp(0) >= 300) {
						flt
						initlv = 50
						fixlv = 6
						characreate -1, 214, -3, 0
						cRelationship(rc) = 0
						cOriginalRelationship(rc) = 0
						cSex(rc) = 0
						cRole(rc) = 3002
						cShopStoreId(rc) = 3002
						cShopRank(rc) = limit(cMaxSp(0) / 5, 10, 10000)
						cdatan(0, rc) = lang("ラムネ売り『シュア』", "<Shua> the soda Shop")
						break
				}
				if (rnd(10) == 0 & cFame(0) >= 75000) {
						flt
						initlv = 50
						fixlv = 6
						characreate -1, 1, -3, 0
						cSex(rc) = 1
						cRole(rc) = 3001
						cShopStoreId(rc) = 3001
						cShopRank(rc) = limit(cFame(0) / 500, 10, 10000)
						cdatan(0, rc) = lang("宝石商人『エーリィ』", "<Elly> the jwely Shop")
						break
				}
				if (rnd(10) == 0 & customitemfind(0, "blacksmith hammer") >= 0) {
						if (iEnhancement(citemno@st) >= 1) {
								flt
								initlv = 50
								fixlv = 6
								characreate -1, 250, -3, 0
								cRelationship(rc) = 0
								cOriginalRelationship(rc) = 0
								cSex(rc) = 1
								cImage(rc) = 500
								cdatan(0, rc) = lang("妖精の鍛冶士『ルージィ』", "<lurgy> the metallurgy fairy")
								cRole(rc) = 3000
								cInterest(rc) = 0
								faction(rc) = ""
								addfaction rc, "family,man"
								addfaction rc, "align,neutral"
								addfaction rc, "god,eyth"
								addfaction rc, "lurgy"
								break
						}
				}
				if (gLastMonthWhenTrainerVisited != gMonth | rnd(5) == 0) {
					if (rnd(3)) {
						characreate -1, 333, -3, 0
						cRole(rc) = 2005
						break
					}
				}
				if (rnd(10) == 0) {
					characreate -1, 334, -3, 0
					cRole(rc) = 2006
					break
				}
				if (rnd(10) == 0) {
					characreate -1, 1, -3, 0
					cRole(rc) = cRole_visitingWanderingVendor
					cShopRank(rc) = limit(cFame(0) / 100, 10, 1000)
					break
				}
				if (rnd(4) == 0) {
					characreate -1, 9, -3, 0
					cRole(rc) = 2000
					cPortrait(rc) = -1
					break
				}
				if (rnd(4) == 0) {
					characreate -1, 176, -3, 0
					cRole(rc) = 2001
					break
				}
				characreate -1, 16, -3, 0
				cRole(rc) = 2002
				break
			loop
			tc = rc
			cRelationship(tc) = 0
			cOriginalRelationship(tc) = 0
			cbitmod 964, tc, 1
		}
		cbitmod 982, tc, 1
		i = 0
		flag = 0
		repeat 16 + 1
			if (cnt == 0) {
				c = tc
			} else {
				c = cnt - 1
			}
			if (cState(c) != 1) {
				continue
			}
			if (gMount != 0) {
				if (c == gMount) {
					continue
				}
			}
			if (ocdata(107, c) != 0) {
				continue
			}
			inv_getheader -1
			p = 0, 6
			repeat invrange, invhead
				if (iNumber(cnt) == 0) {
					continue
				}
				if (iFunction(cnt) != 44) {
					continue
				}
				if (c == tc) {
					if (iParam1(cnt) == 2) {
						cell_swap c, -1, iX(cnt), iY(cnt)
						i = cnt
						p = cnt
						break
					} else {
						continue
					}
				}
				if (i == 0) {
					break
				} else {
					if (cnt == i) {
						continue
					}
				}
				if (c == 0) {
					if (iParam1(cnt) == 1) {
						p = cnt
						flag = 1
						break
					}
				} else {
					if (flag) {
						p(2) = dist(iX(cnt), iY(cnt), iX(i), iY(i))
						if (p(2) < p(1)) {
							if (map(iX(cnt), iY(cnt), 1) == 0) {
								p = cnt, p(2)
							}
						}
					}
				}
			loop
			if (p != 0) {
				cell_swap c, -1, iX(p), iY(p)
			}
			cDirection(c) = direction(cX(c), cY(c), cX(tc), cY(tc))
			if (c == 0) {
				gdata(35) = cDirection(c)
			}
		loop
		gosub *label_1467
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 17 | _switch_sw) {
		_switch_sw = 0
		i = 0
		repeat 244, 1
			if (cState(cnt) != 1) {
				continue
			}
			if (welcome_f != 1) {
				if (cRole(cnt) != 13) {
					if (cRole(cnt) != 3) {
						if (cRole(cnt) != 0 | cRelationship(cnt) == 0 | cCurrentMap(cnt) == gCurrentMap) {
							tc = cnt
							cEmotionIcon(cnt) = 6 + 100 * 20
							txtef 9
							ctalk cnt, 104, cnt, cnt
							if (stat == 0) {
								i++
							}
						}
					}
				}
			}
			if (cnt <= 15) {
				if (ocdata(104, cnt) == 185) {
					if (getgametime() <= cTimeToRestore(cnt)) {
						continue
					}
					inv_find 342, cnt
					if (stat == (-1)) {
						continue
					}
					pole = stat
					angler = cnt
					ccbk = cc
					repeat rnd(getgametime() - cTimeToRestore(angler))
						if (rnd(15)) {
							continue
						}
						if (inv_getspace(angler) == 0 | iCount(pole) == 0) {
							break
						}
						iCount(pole)--
						ci = pole
						cc = angler
						gosub *label_1723
						if (fishdata(3, fish) >= rnd(sdata(185, angler) + 1)) {
							continue
						}
						gosub *label_1377
						r1 = 0
						if (iId(ci) == 618) {
							r1 = fishdata(3, iSubname(ci))
						}
						gosub *label_0677
					loop
					cc = ccbk
					cTimeToRestore(angler) = getgametime() + 1
				} else {
					if (ocdata(104, cnt) == 184) {
						if (getgametime() <= cTimeToRestore(cnt)) {
							continue
						}
						cooktool = -1
						cook = cnt
						isetheader = cook, -1
						repeat 2
							inv_getheader isetheader(cnt)
							repeat invrange, invhead
								if (cooktool != (-1)) {
									break
								}
								if (iNumber(cnt) <= 0) {
									continue
								}
								if (iFunction(cnt) == 15) {
									cooktool = cnt
								}
							loop
						loop
						if (cooktool == (-1)) {
							continue
						}
						ccbk = cc
						cibk = ci
						repeat rnd(getgametime() - cTimeToRestore(cook)) * 2
							if (rnd(15)) {
								continue
							}
							if (inv_getspace(cook) == 0) {
								break
							}
							ci = -1
							inv_getheader cook
							repeat invrange, invhead
								if (iNumber(cnt) <= 0) {
									continue
								}
								if (refitem(iId(cnt), 5, cnt) == 57000) {
									if (iParam2(cnt) != 0) {
										continue
									}
									ci = cnt
									break
								}
							loop
							if (ci == (-1)) {
								break
							}
							if (cbit(961, cook) == 1 & implevel(cImpression(cook)) >= 8 & rnd(5) == 0) {
								ciref = ci
								flt
								itemcreate cook, 667, -1, -1, 0
								iSubname(ci) = cId(cook)
								iCurseState(ci) = iCurseState(ciref)
								ibitmod 8, ci, ibit(8, ciref)
								iParam4(ci) = iParam4(ciref)
								if (iSubname(ci) == 343) {
									inv(33, ci) = cCnpcId(cook)
									inv(34, ci) = createserialno(userdatan(0, cCnpcId(cook)))
								}
								iNumber(ciref)--
							} else {
								cc = cook
								gosub *label_1744
							}
						loop
						cc = ccbk
						ci = cibk
						cTimeToRestore(cook) = getgametime() + 1
					}
				}
			}
		loop
		if (welcome_f != 1) {
			repeat limit(i, 0, 3)
				txtef 9
				if (jp) {
					txt -1, "「おかえり」", "「よう戻ったか」", "「無事で何よりです」", "「おかか♪」", "「待ってたよ」", "「おかえりなさい！」"
				}
				if (en) {
					txt -1, cnvtalk("Welcome home!"), cnvtalk("Hey, dear."), cnvtalk("You're back!"), cnvtalk("I was waiting for you."), cnvtalk("Nice to see you again.")
				}
			loop
		}
		tc = 0
		repeat 245
			if (cState(cnt) != 1) {
				continue
			}
			if (cRole(cnt) == 18) {
				tc = cnt
				break
			}
		loop
		if (tc != 0) {
			if (cTimeToRestore(tc) != 0) {
				if (getgametime() >= cTimeToRestore(tc)) {
					gNumberOfWaitingGuests += rnd(4)
					cTimeToRestore(tc) = 0
				}
			}
			if (cfg_guest == 0) {
				if (gNumberOfWaitingGuests != 0) {
					gosub *label_1467
				}
			}
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 21 | _switch_sw) {
		_switch_sw = 0
		if (mapType == 1) {
			goto *label_1631
		}
		throwsstpevent "NukeExploded", 0, "", 0
		txtef 3
		txt -1, lang(" *ゴゴゴゴゴゴ* ", "* RRROOM-KABOOOOM*")
		msg_halt
		gsel 7
		pos 0, 0
		picload_ exedir + "graphic\\bg22.bmp"
		gsel 4
		pos windoww / 2 - 1, windowh / 2 - 1
		gmode 0, 640, 480
		grotate 7, 0, 0, 0, windoww + 4, windowh + 4
		gsel 7
		picload_ exedir + "graphic\\anime9.bmp"
		gsel 0
		dx = windoww / 2
		dy = (windowh - inf_verh) / 2
		p = 0, 0, 0, 0, 0
		color 0, 0, 0
		repeat 40
			if (cnt == 14) {
				snd 108
			}
			redraw 0
			color 0, 0, 0
			if (cnt < 16) {
				pos 0, 0
			} else {
				pos 5 - rnd(10), 5 - rnd(10)
			}
			gmode 0
			gcopy 4, 0, 0, windoww, windowh
			if (cnt > 8) {
				p--
			} else {
				p++
			}
			gmode 4, 192, 48, 255 - p * 5
			pos dx, dy
			grotate 7, cnt / 2 \ 2 * 192, 408, 0, limit(p * 32, 0, 192), limit(p * 8, 0, 48)
			if (cnt > 14) {
				p(1)++
			} else {
				if (cnt < 12) {
					p(1) = cnt / 2 \ 2
				} else {
					if (cnt >= 12) {
						p(1) = cnt \ 3
					}
				}
			}
			gmode 2, 96, 48
			pos dx, dy - limit(cnt * 3 / 2, 0, 18) - 16
			grotate 7, p(1) * 96, 288, 0, limit(cnt * 12, 0, 144), limit(cnt * 6, 0, 72)
			if (cnt > 4) {
				p(2)++
				p(3)++
			}
			gmode 4, 96, 96, limit(p(2) * 6, 0, 100)
			pos dx, dy - limit(p(2) * 2, 0, 40)
			grotate 7, 0, 0, 0, limit(p(2) * 8, 0, 240), limit(p(2) * 5, 0, 96)
			gmode 4, 96, 96, p(3) * 10
			pos dx, dy - limit(p(3) * 2, 0, 160) - 6
			grotate 7, 96, 0, 0, limit(p(3) * 10, 0, 96), limit(p(3) * 10, 0, 96)
			gmode 4, 192, 80, limit(p(3) * 5, 0, 100)
			pos dx, dy - 4
			grotate 7, cnt / 4 \ 2 * 192, 96, 0, limit(p(2) * 8, 0, 400), limit(p(2), 0, 48)
			gmode 4, 192, 96, p(3) * 10
			pos dx, dy - 48 - limit(p(3) * 2, 0, 148)
			grotate 7, cnt / 3 \ 2 * 192, 96, 0, 192, 96
			redraw 1
			await cfg_animewait + 50
		loop
		gmode 2
		gosub *label_0621
		tlocx = evdata1(evnum - (evnum != 0) * 1)
		tlocy = evdata2(evnum - (evnum != 0) * 1)
		if (ogdata(496) == 2) {
			range = 51
		} else {
			range = 31
		}
		ele = 59
		aniref = range
		animeid = 17
		anix = tlocx
		aniy = tlocy
		gosub *label_0630
		gosub *label_0623
		repeat range * 2 + 1
			dy = tlocy - range + cnt
			if (dy < 0 | dy >= mapHeight) {
				continue
			}
			repeat range * 2 + 1
				dx = tlocx - range + cnt
				if (dx < 0 | dx >= mapWidth) {
					continue
				}
				if (dist(tlocx, tlocy, dx, dy) > range) {
					continue
				}
				f = 0
				if (chipm(7, map(dx, dy, 0)) & 4) {
					f = 1
				}
				if (rnd(4) | f == 1) {
					map(dx, dy, 0) = 37
				}
				if (rnd(10) == 0 | f == 1) {
					addmef dx, dy, 5, 24, rnd(15) + 20, 50
				}
				if (map(dx, dy, 1) != 0) {
					tc = map(dx, dy, 1) - 1
					dmg = 1000 + (ogdata(496) == 2) * ogdata(431) * 5
					dmghp tc, dmg, -17
				}
				mapitem_fire dx, dy
			loop
		loop
		if (evdata1(evnum - (evnum != 0) * 1) == 33) {
			if (evdata2(evnum - (evnum != 0) * 1) == 16) {
				if (gCurrentMap == 15) {
					if (gdata(250 + 213) == 1) {
						gdata(250 + 213) = 2
						snd 44
						txtef 2
						txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
					}
				}
			}
		}
		if (mapType == 3 | mapType == 2) {
			modkarma 0, (-80) + gettrait(0, 162) * 60
		} else {
			modkarma 0, -10
		}
		ogdata(431)++
		gosub *label_1177
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 18 | _switch_sw) {
		_switch_sw = 0
		if (mapType == 1) {
			goto *label_1631
		}
		if (gMonth \ 3 != 0 & gLastEtherwindMonth != gMonth) {
			gLastEtherwindMonth = gMonth
		}
		gWeather = 1
		envonly = 1
		gosub *label_0122
		txt -1, lang("終末の日が訪れた。", "Let's Ragnarok!")
		if (oomSEST_noAnimation == 0) {
			msg_halt
		}
		animeid = 21
		gosub *label_0630
		repeat 200
			repeat 2
				x = rnd(mapWidth)
				y = rnd(mapHeight)
				map(x, y, 0) = 37
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight | rnd(5) == 0) {
				x = rnd(mapWidth)
				y = rnd(mapHeight)
			}
			addmef x, y, 5, 24, rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
			mapitem_fire x, y
			if (cnt \ 4 == 0) {
				flt 100, calcfixlv(3)
				if (rnd(4)) {
					fltnrace = "dragon"
				} else {
					fltnrace = "giant"
				}
				characreate -1, 0, x, y
				if (stat != 0) {
					cbitmod 964, rc, 1
				}
			}
			if (cnt \ 7 == 0) {
				if (oomSEST_noAnimation == 0) {
					gosub *label_0623
				}
				if (rnd(7)) {
					snd 6
				} else {
					snd 45
				}
				if (oomSEST_noAnimation == 0) {
					await 25
				}
			}
		loop
		throwsstpevent "Ragnarok", evdata1(evnum - (evnum != 0) * 1), "", 0
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 22 | _switch_sw) {
		_switch_sw = 0
		if (evdata1(evnum - (evnum != 0) * 1) == 0) {
			txtef 3
			txt -1, lang("けたたましい警報が鳴り響いた！", "*beeeeeep!* An alarm sounds loudly!")
			repeat 188, 57
				if (cState(cnt) == 1) {
					cRelationship(cnt) = -3
					lockon cnt, 0, 29
					cHate(cnt) = 250
				}
			loop
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 26 | _switch_sw) {
		_switch_sw = 0
		if (mapType != 1) {
			txt -1, lang("強盗があなたに目をつけた！", "Blaggers pick on you!")
			repeat 3
				flt
				initlv = difficulty()
				characreate -1, 215, cX(0), cY(0)
			loop
		}
		goto *label_1631
	}
	if (_switch_val == 100 | _switch_sw) {
		_switch_sw = 0
		gosub *label_0623
		s = lang("妹との再会", "Reunion with your younger sister")
		file = "bg_re13"
		buff = lang("あなたは懐かしい声に気付いて、ふと歩みを止めた。なんと、生き別れたあなたの妹が、嬉しそうに走ってくる！あなたの妹は…", "You notice a familiar call and stop walking. Your younger sister who has separated from you since birth is now running towards you joyfully! Your sister is...")
		listmax = 0
		list(0, listmax) = 1
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		list(0, listmax) = 2
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		list(0, listmax) = 3
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		list(0, listmax) = 4
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		gosub *label_1097
		p = 176
		flt
		initlv = cLevel(0) * 2 / 3 + 1
		novoidlv = 1
		characreate -1, p, cX(0), cY(0)
		gosub *label_1530
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 101 | _switch_sw) {
		_switch_sw = 0
		if (mapType == 1) {
			goto *label_1631
		}
		envonly = 1
		gosub *label_0122
		txt -1, lang("妹の日が訪れた。", "Younger sisters are here! Let's party!")
		if (evdata2(evnum - (evnum != 0) * 1) == 0) {
			if (oomSEST_noAnimation == 0) {
				msg_halt
			}
		}
		animeid = 21
		gosub *label_0630
		repeat 200
			repeat 2
				x = rnd(mapWidth)
				y = rnd(mapHeight)
				map(x, y, 0) = 37
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight | rnd(5) == 0) {
				x = rnd(mapWidth)
				y = rnd(mapHeight)
			}
			addmef x, y, 5, 24, rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
			mapitem_fire x, y
			if (cnt \ 4 == 0) {
				if (rnd(3) != 0) {
					flt 100, calcfixlv(3)
					characreate -1, 176, x, y
					if (stat != 0) {
						cbitmod 964, rc, 1
						if (evdata2(evnum - (evnum != 0) * 1) == 1) {
							cRole(rc) = 16
						}
						if (rnd(3) == 0) {
							p = rnd(18) + 2
							if (p == 12) {
								ocbitmod 1, rc, 1
							} else {
								cImage(rc) += p * 1000
							}
						}
						if (rnd(4) == 0) {
							repeat 10000
								p = rnd(19) + 1
								if (lightdata(3, p) < 24) {
									ocdata(191, rc) = p
									break
								}
							loop
						}
						if (rnd(20) == 0) {
							ocbitmod 1, rc, 1
						}
					}
				} else {
					flt 100, calcfixlv(3)
					if (gCurrentMap != 42) {
						if (evdata2(evnum - (evnum != 0) * 1) == 1) {
							initlv = difficulty() * 2
						} else {
							initlv = cLevel(evdata1(evnum - (evnum != 0) * 1)) * 2 / 3 + 1
						}
					}
					characreate -1, 176, x, y
					if (stat != 0) {
						cbitmod 964, rc, 1
						cImage(rc) = 286
						if (evdata2(evnum - (evnum != 0) * 1) == 1) {
							cRole(rc) = 16
						}
						if (rnd(3) == 0) {
							p = rnd(18) + 2
							if (p == 12) {
								ocbitmod 1, rc, 1
							} else {
								cImage(rc) += p * 1000
							}
						}
						if (rnd(4) == 0) {
							repeat 10000
								p = rnd(19) + 1
								if (lightdata(3, p) >= 24 & lightdata(3, p) < 48) {
									ocdata(191, rc) = p
									break
								}
							loop
						}
						if (rnd(20) == 0) {
							ocbitmod 1, rc, 1
						}
					}
				}
			}
			if (cnt \ 7 == 0) {
				if (oomSEST_noAnimation == 0) {
					gosub *label_0623
				}
				if (rnd(7)) {
					snd 6
				} else {
					snd 45
				}
				if (oomSEST_noAnimation == 0) {
					await 25
				}
			}
			repeat 2
				txtef 9
				if (jp) {
					txt -1, "「" + _onii(cSex(0)) + "ちゃんー」", "「" + _onii(cSex(0)) + "ちゃん！」", "「" + _onii(cSex(0)) + "ちゃ〜ん」", "「" + _onii(cSex(0)) + "ちゃんっ」", "「" + _onii(cSex(0)) + "ちゃん？」", "「" + _onii(cSex(0)) + "〜ちゃん」", "「" + _onii(cSex(0)) + "ちゃん♪」"
				} else {
					txt -1, "\"" + _onii(cSex(0)) + "chan-\"", "\"" + _onii(cSex(0)) + "chan!\"", "\"" + _onii(cSex(0)) + "chaa~n\"", "\"" + _onii(cSex(0)) + "chan\"", "\"" + _onii(cSex(0)) + "chan?\"", "\"" + _onii(cSex(0)) + "~chan\"", "\"" + _onii(cSex(0)) + "chan♪\""
				}
			loop
		loop
		if (evdata2(evnum - (evnum != 0) * 1) == 1) {
			gohostile
		}
		throwsstpevent "SisterRagnarok", evdata1(evnum - (evnum != 0) * 1), "", 0
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 102 | _switch_sw) {
		_switch_sw = 0
		p(99) = 0
		flt calcobjlv(gCurrentDungeonLevel), 1
		initlv = evdata1(evnum - (evnum != 0) * 1)
		if (rnd(15) == 0) {
			p(99) = rnd(2) + 3
			initlv = initlv * p(99) / 2
		}
		novoidlv = 1
		if (rnd(30) == 0) {
			p = 176
		} else {
			p = 21
		}
		characreate -1, p, evdata2(evnum - (evnum != 0) * 1) \ 1000000 / 1000, evdata2(evnum - (evnum != 0) * 1) \ 1000
		if (stat != 0) {
			cc = evdata2(evnum - (evnum != 0) * 1) / 1000000
			cOriginalRelationship(rc) = cRelationship(cc)
			cRelationship(rc) = cOriginalRelationship(rc)
			if (p(99)) {
				cImage(rc) += 3 * 1000
			}
			if (getfactionvalue(cc, "pet") != "") {
				addfaction rc, "pet," + refstr
			} else {
				addfaction rc, "pet," + cc
			}
			repeat 245
				if (cState(cnt) != 1) {
					continue
				}
				if (ocdata(155, cnt) == 0) {
					continue
				}
				unlockon cnt, rc
			loop
			txtef 4
			if (cId(rc) == 21) {
				txt -1, lang("死者はゾンビになった。", "The dead reanimates as a zombie.")
			} else {
				txt -1, lang("死者は妹になった。", "The dead reanimates as a younger sister.")
			}
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 103 | _switch_sw) {
		_switch_sw = 0
		tc = findchara(166, 6)
		gosub *label_1467
		gdata(171) = 23
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 104 | _switch_sw) {
		_switch_sw = 0
		repeat 15
			item_find 92000, 0, 1
			if (stat != (-1)) {
				ci = stat
				txt -1, lang(itemname(ci) + "は破損して売り物にならなくなった。", itemname(ci) + " has been damaged beyond recognition and is nwo worthless.")
				removeitem ci, iNumber(ci)
			} else {
				break
			}
		loop
		autosave = 1 * (gCurrentMap != 35)
		if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
			autosave = 0
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 105 | _switch_sw) {
		_switch_sw = 0
		repeat 229, 16
			dup roopbuf, cState(cnt)
			if (roopbuf != 2) {
				if (roopbuf != 1) {
					continue
				}
			}
			if (cId(cnt) == 211) {
				if (cQuality(cnt) != 6) {
					continue
				}
				tc = cnt
				break
			}
			if (cId(cnt) == 176) {
				cQuality(cnt) = 5
				tc = cnt
				break
			}
		loop
		gosub *label_1467
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 106 | _switch_sw) {
		_switch_sw = 0
		cc = 0
		gosub *label_0715
		if (stat == 1) {
			tc = cc
			efid = 430
			lint_efp = sdata(159, cc) * 15 + 20 + sdata(13, cc)
			efp = limitmax(lint_efp, INT_MAX)
			gosub *label_1398
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 107 | _switch_sw) {
		_switch_sw = 0
		tc = findchara(210, 6)
		gosub *label_1467
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 108 | _switch_sw) {
		_switch_sw = 0
		txtef 3
		txt -1, lang("襲撃だ！", "Ambush!")
		repeat 188, 57
			if (cState(cnt) != 1) {
				continue
			}
			s = getfactionvalue(cnt, "guild")
			if (s == "") {
				continue
			}
			if (getfactionvalue(0, "guild") == s) {
				continue
			}
			cRelationship(cnt) = -3
			cOriginalRelationship(cnt) = -3
			cHate(cnt) = 250
		loop
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 109 | _switch_sw) {
		_switch_sw = 0
		if (mapType == 1) {
			goto *label_1631
		}
		envonly = 1
		gosub *label_0122
		txt -1, lang("あなたは神の怒りに触れた！", "Gods got furious!")
		if (evdata2(evnum - (evnum != 0) * 1) == 0) {
			msg_halt
		}
		animeid = 21
		gosub *label_0630
		ragnarokflag@se = 1
		repeat 200
			repeat 2
				x = rnd(mapWidth)
				y = rnd(mapHeight)
				map(x, y, 0) = 37
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight | rnd(5) == 0) {
				x = rnd(mapWidth)
				y = rnd(mapHeight)
			}
			addmef x, y, 5, 24, rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
			mapitem_fire x, y
			if (cnt \ 4 == 0) {
				flt 100, calcfixlv(3)
				gosub *label_1793
				initlv = 100
				characreate -1, dbid, x, y
				if (stat != 0) {
					gosub *label_1759
					cbitmod 964, rc, 1
					cbitmod 976, rc, 1
					if (evdata2(evnum - (evnum != 0) * 1) == 1) {
						cRole(rc) = 16
					}
				}
			}
			if (cnt \ 7 == 0) {
				gosub *label_0623
				if (rnd(7)) {
					snd 6
				} else {
					snd 45
				}
				await 25
			}
		loop
		ragnarokflag@se = 0
		if (evdata2(evnum - (evnum != 0) * 1) == 1) {
			gohostile
		}
		goto *label_1631
		_switch_sw++
	}
	if (_switch_val == 110 | _switch_sw) {
		_switch_sw = 0
		tc = findchara(263, 6)
		gosub *label_1467
		goto *label_1631
	}
	if (_switch_val == 2402 | _switch_sw) {
		_switch_sw = 0
		tc = evdata1(evnum - (evnum != 0) * 1)
		txtef 8
		txt_select -1, lang(godname(godcheck(tc)) + "は激怒した。", godname(godcheck(tc)) + " is enraged."), "", "", "", "", "", "", "", ""
		redraw 1
		efid = 622
		efp = 10000
		gosub *label_1398
		goto *label_1631
	}
	if (_switch_val == 2403 | _switch_sw) {
		_switch_sw = 0
		tc = evdata1(evnum - (evnum != 0) * 1)
		txtef 2
		txt_select -1, lang(name(tc) + "は" + godname(godcheck(tc)) + "の暖かい眼差しを感じた。", name(tc) + " feel" + _s(tc) + " as if " + godname(godcheck(tc)) + " is watching you."), "", "", "", "", "", "", "", ""
		if ( isgodtxtfile ) {
			cdata(63, tc) += 1 * 7
			modpiety 1, tc
		}
		else {
			cdata(63, tc) += 500
			modpiety 75, tc
		}
		goto *label_1631
	}
	if (_switch_val == 2404 | _switch_sw) {
		_switch_sw = 0
		tc = evdata1(evnum - (evnum != 0) * 1)
		txt_select -1, lang("" + godname(godcheck(tc)) + "は" + name(tc) + "の信仰に疑問を抱いた。", cnven(godname(godcheck(tc))) + " doubts " + name(tc) + your(tc) + " faith."), "", "", "", "", "", "", "", ""
		cdata(62, tc) = cdata(62, tc) * 85 / 100
		cdata(63, tc) = 0
		goto *label_1631
	}
*label_1631
	return
	return
	return
*label_1632
	gosub *label_1633
	if (stat == 0) {
		return
	}
	q = refstr
	gosub *custom_loadCitems
	inititemid = finditemid(q)
	txt -1, lang("カスタムアイテムを作成した！", "You created a custom item!")
	flt
	itemcreate -1, 743, cX(0), cY(0), 0
	repeat 5480
		if (iId(cnt) == 743) {
			getitemid cnt
		}
	loop
	gosub *custom_cleanUpTemporaryFiles
	return
*label_1633
	fread = 0
	cun = useritemmax
	txt -1, lang("どのファイルからアイテムを作成する？", "Use which file to create item?")
	redraw 1
	fileext = "txt"
	filedsc = "Custom Item Text"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if (stat == 0) {
		return 0
	}
	txtfile = refstr
	exist txtfile
	useritemdata(1, cun) = strsize
	sdim txtbuff, strsize + 1
	bload txtfile, txtbuff
	if (instr(txtbuff, 0, "%Elona Custom Item") == (-1)) {
		txt -1, "Invalid File. Aborting."
		return 0
	}
	txt -1, lang("どの画像を埋め込む？", "Embed which picture?")
	redraw 1
	fileext = "bmp"
	filedsc = "Bit Map File"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if (stat == 0) {
		return 0
	}
	bmpfile = refstr
	exist bmpfile
	if (strsize > 30000) {
		txt -1, "The file size must be lower than 30KB. Aborting."
		return 0
	}
	useritemdata(0, cun) = strsize
	dim bmpbuff, strsize
	bload bmpfile, bmpbuff
	if (fread == 0) {
		zOpen hgz, exedir + "user\\item1.t", 1, 3
		zWrite useritemdata(0, cun), hgz, 75 * 4
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\item1.t", 0
		zRead useritemdata(0, cun), hgz, 75 * 4
		zClose hgz
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\item2.t", 1, 3
		zWrite bmpbuff, hgz, useritemdata(0, cun)
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\item2.t", 0
		zRead bmpbuff, hgz, useritemdata(0, cun)
		zClose hgz
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\item3.t", 1, 3
		zWrite txtbuff, hgz, useritemdata(1, cun)
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\item3.t", 0
		zRead txtbuff, hgz, useritemdata(1, cun)
		zClose hgz
	}
	s = getnpctxt_nc("name.", "unknown,unknown")
	csvstr2 s, s
	cnv_filestr s
	if (instr(s, 0, "_tmp_") != (-1)) {
		dialog "The name contains an invalid word \"_tmp_\""
		return 0
	}
	if (peek(s) >= 65 & peek(s) <= 90 | peek(s) == 95 | (peek(s) >= 97 & peek(s) <= 122)) {
	} else {
		dialog "The first letter of the name must be alphabetic."
		return 0
	}
	if (strlen(s) >= 64 | strlen(s(1)) >= 64) {
		dialog "The name is too long."
		return 0
	}
	zipinit2 exedir + "user\\", s + ".item"
	zipadd2 "item1.t"
	zipadd2 "item2.t"
	zipadd2 "item3.t"
	zipend2
	mref _refstr, 65
	_refstr = s
	return 1



*custom_loadCitems
	// Get the list of all "*.item" and "*.ooitem" files under "user" directory.
	useritemmax = 0
	getuserfiledata "item", useritemmax
	getuserfiledata "ooitem", useritemmax
	oomSEST_log "[Custom Item] " + useritemmax + " citems detected."
	if (useritemmax > custom_upperLimitOfNumCitems) {
		useritemmax = custom_upperLimitOfNumCitems
		oomSEST_log "[Custom Item] The upper limit of the number of citems is " + useritemmax + ". The rest won't be loaded."
	}

	dim useritemdata, 75, useritemmax + 1
	sdim useritemdatan, 40, 10, useritemmax + 1
	sdim useritemtxt, 80 * 50, 4, useritemmax + 1
	sdim untaglistitem
	dim useritemencprocref, 7, 10, useritemmax + 1
	dim useritemmatval, 5, useritemmaxbuffer
	dim useritemmatneed, 12, useritemmaxbuffer
	sdim useritemmatfaith, 40, useritemmaxbuffer
	ogdata(34) = 0

	// Prepares image buffer.
	buffer 30, 33 * 48, (useritemmax / 33 + 1) * 96
	boxf
	gmode 0

	tg = 0
	repeat useritemmax
		oomSEST_log "[Custom Item] Load: dir=" + userfilelist(1, cnt) + ", file=" + userfilelist(0, cnt)
		cnt2 = tg

		// Extracts inner files from the item archive.
		unzip2 userfilelist(1, cnt), userfilelist(0, cnt)

		// Uncompresses and loads "item1.t" on `useritemdata` (metadata).
		zOpen hgz, userfilelist(1, cnt) + "item1.t", 0
		zRead useritemdata(0, tg), hgz, 75 * 4
		zClose hgz

		// Uncompresses and loads "item2.t" on `bmpbuff` (item chip).
		dim bmpbuff, useritemdata(0, tg)
		zOpen hgz, userfilelist(1, cnt) + "item2.t", 0
		zRead bmpbuff, hgz, useritemdata(0, tg)
		zClose hgz

		// Uncompresses and loads "item3.t" on `txtbuff` (definition).
		sdim txtbuff, useritemdata(1, tg) + 1
		zOpen hgz, userfilelist(1, cnt) + "item3.t", 0
		zRead txtbuff, hgz, useritemdata(1, tg)
		zClose hgz

		// Clean up the temporary files(*.t) to load the graphics.
		cleanuserdir userfilelist(1, cnt)

		/*******************************************
		* SECTION: Load the god definition itself. *
		*******************************************/
		oomSEST_log "[Custom Item] Load item definition."

		// "name."
		// {english name},{japanese name}
		// {english name} is also used as the inner ID.
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		useritemdatan(0, tg) = s
		useritemdatan(1, tg) = s(jp)

		// Duplicate check
		s = userfilelist(0, cnt)
		useritemdatan(6, tg) = s
		if (instr(untaglistitem, 0, "/" + useritemdatan(0, tg) + "/") != (-1)) {
			useritemmax--
			if (instr(s, 0, "_tmp_") == (-1)) {
				msgtemp += lang("同名アイテムは読み込まれない。", "An item of the same name has already been defined.") + "(skipped:" + useritemdatan(0, tg) + "," + s + ") "
			}
			continue
		}

		// Adds the item to the list of the loaded npcs.
		untaglistitem += "/" + useritemdatan(0, tg) + "/"
		if (instr(s, 0, "_tmp_") != (-1)) {
			ogdata(34)++
		}

		useritemdatan(2, tg) = getnpctxt_nc("ialphanameref.", "")
		useritemdatan(3, tg) = getnpctxt_nc("ifilterref.", "")
		useritemdatan(4, tg) = getnpctxt_nc("iknownnameref.", useritemdatan(1, tg))
		if (en) {
			useritemdatan(4, tg) = getnpctxt_nc("iknownnameref_en.", useritemdatan(4, tg))
		}
		useritemdatan(5, tg) = getnpctxt_nc("author.", lang("プレイヤー", "a player"))
		if (en) {
			useritemdatan(5, tg) = getnpctxt_nc("author_en.", useritemdatan(5, tg))
		}
		useritemdatan(7, tg) = getnpctxt_nc("isnd.", "")
		useritemdatan(8, tg) = getnpctxt_nc("icounterword.", "")
		useritemdata(2, tg) = int(getnpctxt_nc("iorgvalue.", "5000"))
		useritemdata(3, tg) = int(getnpctxt_nc("iorgweight.", "3000"))
		useritemdata(4, tg) = int(getnpctxt_nc("dicex.", "0"))
		useritemdata(5, tg) = int(getnpctxt_nc("dicey.", "0"))
		useritemdata(6, tg) = int(getnpctxt_nc("fixdamage.", "0"))
		useritemdata(7, tg) = int(getnpctxt_nc("fixhit.", "0"))
		useritemdata(8, tg) = int(getnpctxt_nc("dodgevalue.", "0"))
		useritemdata(9, tg) = int(getnpctxt_nc("protectvalue.", "0"))
		useritemdata(10, tg) = int(getnpctxt_nc("relaskill.", "0"))
		useritemdata(11, tg) = int(getnpctxt_nc("material.", "0"))
		useritemdata(12, tg) = int(getnpctxt_nc("identifydef.", "0"))
		useritemdata(13, tg) = int(getnpctxt_nc("ilight.", "0"))
		useritemdata(14, tg) = int(getnpctxt_nc("reftype.", "60000"))
		useritemdata(15, tg) = int(getnpctxt_nc("reftypeminor.", "0"))
		useritemdata(16, tg) = int(getnpctxt_nc("ibitvaluable.", "0"))
		useritemdata(17, tg) = int(getnpctxt_nc("objlv.", "10"))
		useritemdata(18, tg) = limit(int(getnpctxt_nc("fixlv.", "2")), 0, 6)
		useritemdata(19, tg) = int(getnpctxt_nc("givegod.", "-1"))
		repeat 9
			s = getnpctxt_nc("fixenc" + cnt + ".", "0,0")
			csvstr2 s, s
			useritemdata(20 + cnt * 2, tg) = int(s)
			useritemdata(20 + cnt * 2 + 1, tg) = int(s(1))
			s = getnpctxt_nc("fixenc" + cnt + "invoke.", "0,0,0,0,0,0")
			csvstr2 s, s
			sid = int(s)
			if (sid < 400) {
				continue
			}
			useritemencprocref(0, cnt, tg) = useritemdata(20 + cnt * 2, tg), sid, int(s(1)), int(s(2)), int(s(3)), int(s(4)), limit(int(s(5)), 0, 90)
		loop
		useritemdata(38, tg) = int(getnpctxt_nc("icolref.", "0"))
		useritemdata(39, tg) = tg
		useritemdata(40, tg) = int(getnpctxt_nc("isetpos.", "0"))
		useritemdata(41, tg) = int(getnpctxt_nc("ipilepos.", "8"))
		useritemdata(42, tg) = int(getnpctxt_nc("idropshadow.", "40"))
		useritemdata(43, tg) = int(getnpctxt_nc("irare.", "1000"))
		useritemdata(44, tg) = int(getnpctxt_nc("ipierce.", "0"))
		s = getnpctxt_nc("irangepow.", "100, 20, 20, 20, 20, 20, 20, 20, 20, 20")
		csvstr2 s, s
		repeat 10
			useritemdata(45 + cnt, tg) = int(s(cnt))
		loop
		s = getnpctxt_nc("irangehit.", "100, 20, 20, 20, 20, 20, 20, 20, 20, 20")
		csvstr2 s, s
		repeat 10
			useritemdata(55 + cnt, tg) = int(s(cnt))
		loop
		useritemdata(65, tg) = int(getnpctxt_nc("inameonly.", "0"))
		useritemdata(66, tg) = int(getnpctxt_nc("ieffect.", "0"))
		useritemdata(67, tg) = int(getnpctxt_nc("cargoitem.", "0"))
		repeat 3, 1
			useritemdata(67 + cnt, tg) = int(getnpctxt_nc("isub" + cnt + ".", "0"))
		loop
		useritemdata(71, tg) = int(getnpctxt_nc("ispawnType.", "0"))
		useritemdata(72, tg) = int(getnpctxt_nc("drinkable.", "0"))
		useritemdata(73, tg) = int(getnpctxt_nc("drinkefid.", "0"))
		useritemdata(74, tg) = int(getnpctxt_nc("drinkefp.", "0"))

		s = getnpctxt_nc("matval.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			useritemmatval(cnt, tg) = int(s(cnt))
		loop
		s = getnpctxt_nc("matneed.", "-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1")
		csvstr2 s, s
		repeat 12
			useritemmatneed(cnt, tg) = int(s(cnt))
			if (cnt\2 == 1 & useritemmatneed(cnt, tg) <= 0) {
				useritemmatneed(cnt - 1, tg) = -1
				useritemmatneed(cnt, tg) = -1
			}
		loop
		useritemmatfaith(tg) = getnpctxt_nc("matfaith.", "")

		// Item description in details window.
		p = instr(txtbuff, 0, "%txt")
		txtbuff = strmid(txtbuff, p, instr(txtbuff, 0, "%endTxt") - p + 7)
		repeat 4
			if (jp) {
				hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",JP")
				if (hajime == -1) {
					hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",EN")
				}
			} else {
				hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",EN")
				if (hajime == -1) {
					hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",JP")
				}
			}
			useritemtxt(cnt, tg) = strmid(txtbuff, hajime, instr(txtbuff, hajime + 1, "%"))
			notesel useritemtxt(cnt, tg)
			notedel 0
			if (instr(useritemtxt(cnt, tg), 0, "nodescription") != (-1)) {
				useritemtxt(cnt, tg) = ""
			}
		loop

		gsel 9
		file = exedir + "user\\graphic\\citem_" + useritemdatan(0, tg) + ".bmp"
		exist file
		if (strsize != (-1)) {
			picload_ file
		} else {
			memfile bmpbuff
			picload_ "MEM:temp.bmp"
		}
		if (ginfo(13) > 50) {
			chipi(0, 33 * 25 * 2 + tg) = tg \ 33 * inf_tiles, tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles * 2, inf_tiles + useritemdata(40, tg), useritemdata(41, tg), useritemdata(42, tg)
		} else {
			chipi(0, 33 * 25 * 2 + tg) = tg \ 33 * inf_tiles, tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles, useritemdata(40, tg), useritemdata(41, tg), useritemdata(42, tg)
		}
		gsel 30
		pos tg \ 33 * 48, tg / 33 * 96
		gcopy 9, 0, 0, 48, 96

		tg++
	loop

	gsel 30
	chipi(0, 33 * 25 * 2 + useritemmax) = useritemmax \ 33 * inf_tiles, useritemmax / 33 * inf_tiles * 2, inf_tiles, inf_tiles, 0, 0, 0
	color 250, 250, 250
	boxf useritemmax \ 33 * 48, useritemmax / 33 * 96, useritemmax \ 33 * 48 + 48, useritemmax / 33 * 96 + 48

	// Defines null item for fallback.
	useritemdatan(0, useritemmax) = ""
	useritemdatan(1, useritemmax) = "残りカス"
	useritemdatan(2, useritemmax) = ""
	useritemdatan(3, useritemmax) = ""
	useritemdatan(4, useritemmax) = "残りカス"
	useritemdatan(5, useritemmax) = "プレイヤー"
	useritemdata(2, useritemmax) = 0
	useritemdata(3, useritemmax) = 0
	useritemdata(4, useritemmax) = 0
	useritemdata(5, useritemmax) = 0
	useritemdata(6, useritemmax) = 0
	useritemdata(7, useritemmax) = 0
	useritemdata(8, useritemmax) = 0
	useritemdata(9, useritemmax) = 0
	useritemdata(10, useritemmax) = 0
	useritemdata(11, useritemmax) = 0
	useritemdata(12, useritemmax) = 0
	useritemdata(13, useritemmax) = 0
	useritemdata(14, useritemmax) = 60000
	useritemdata(15, useritemmax) = 0
	useritemdata(16, useritemmax) = 0
	useritemdata(17, useritemmax) = 10
	useritemdata(18, useritemmax) = 2
	useritemdata(19, useritemmax) = -1
	repeat 9
		useritemdata(20 + cnt * 2, useritemmax) = 0
		useritemdata(20 + cnt * 2 + 1, useritemmax) = 0
	loop
	useritemdata(38, useritemmax) = 0
	useritemdata(39, useritemmax) = useritemmax
	useritemdata(40, useritemmax) = 0
	useritemdata(41, useritemmax) = 8
	useritemdata(42, useritemmax) = 40
	useritemdata(43, useritemmax) = 1000
	useritemdata(44, useritemmax) = 0
	s = "100, 20, 20, 20, 20, 20, 20, 20, 20, 20"
	csvstr2 s, s
	repeat 10
		useritemdata(45 + cnt, useritemmax) = int(s(cnt))
	loop
	s = "100, 20, 20, 20, 20, 20, 20, 20, 20, 20"
	csvstr2 s, s
	repeat 10
		useritemdata(55 + cnt, useritemmax) = int(s(cnt))
	loop
	useritemdata(65, useritemmax) = 0
	useritemdata(66, useritemmax) = 0
	useritemdata(67, useritemmax) = 0
	useritemdata(68, useritemmax) = 0
	useritemdata(69, useritemmax) = 0
	useritemdata(70, useritemmax) = 0
	useritemdata(71, useritemmax) = 0
	useritemdata(72, useritemmax) = 0
	useritemdata(73, useritemmax) = 0
	useritemdata(74, useritemmax) = 0
	repeat 4
		useritemtxt(cnt, useritemmax) = ""
	loop

	gosub *label_1635
	gsel 0
	return



*label_1635
	dirlist buff, exedir + "user\\_tmp_*.item"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	dirlist buff, exedir + "user\\!tmp*.item"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	return



#deffunc setitemid int __kkk, int __lll
	inv(31, __kkk) = __lll
	useritemdata(39, __lll) = __lll
	return



#deffunc getitemid int __mmm
	if (inv(32, __mmm) == 0) {
		inv(31, __mmm) = iParam1(__mmm)
		inv(32, __mmm) = iParam2(__mmm)
		iParam1(__mmm) = 0
		iParam2(__mmm) = 0
	}
	p = getitemindex(inv(32, __mmm))
	if (p != (-1)) {
		setitemid __mmm, p
	} else {
		p = getitemindex(inv(32, __mmm) - 1)
		if (p != (-1)) {
			inv(32, __mmm) = inv(32, __mmm) - 1
			setitemid __mmm, p
		}
	}
	if (p == (-1)) {
		setitemid __mmm, useritemmax
	}
	return f



#defcfunc finditemid str __nnn
	f@st = 0
	repeat useritemmax
		if (__nnn == useritemdatan(0, cnt)) {
			f@st = 1 + cnt
			break
		}
	loop
	return f@st



*itemGen_initCItem
	if (inititemid) {
		inv(31, ci) = inititemid - 1
		inititemid = 0
	}
	cun = inv(31, ci)
	iImage(ci) = 657
	iId(ci) = 743
	iNumber(ci) = 1
	iValue(ci) = useritemdata(2, cun)
	iWeight(ci) = useritemdata(3, cun)
	iDiceX(ci) = useritemdata(4, cun)
	iDiceY(ci) = useritemdata(5, cun)
	iDamageBonus(ci) = useritemdata(6, cun)
	iHitBonus(ci) = useritemdata(7, cun)
	iDv(ci) = useritemdata(8, cun)
	iPv(ci) = useritemdata(9, cun)
	iSkill(ci) = useritemdata(10, cun)
	iFunction(ci) = useritemdata(66, cun)
	iColor(ci) = useritemdata(38, cun)
	iMaterial(ci) = useritemdata(11, cun)
	iDifficultyToIdentify(ci) = useritemdata(12, cun)
	iParam1(ci) = useritemdata(68, cun)
	iParam2(ci) = useritemdata(69, cun)
	iParam3(ci) = useritemdata(70, cun)
	p = 0
	repeat strlen(useritemdatan(0, cun))
		p += peek(useritemdatan(0, cun), cnt)
	loop
	s = str(peek(useritemdatan(0, cun), 0)) + str(p) + str(peek(useritemdatan(0, cun), strlen(useritemdatan(0, cun)) - 1))
	ichargelevel = 0
	infilterref = useritemdatan(3, cun)
	inv(32, ci) = int(s)
	reftype = useritemdata(14, cun)
	reftypeminor = useritemdata(15, cun)
	ibitmod 5, ci, useritemdata(16, cun)
	if (useritemdata(66, cun) == 1000) {
		ibitmod 16, ci, 1
	}
	if (useritemdata(66, cun) == 30) {
		ibitmod 7, ci, 1
	}
	if (useritemdata(18, cun)) {
		fixlv = useritemdata(18, cun)
	}
	fixeditemenc = useritemdata(20, cun), useritemdata(21, cun), useritemdata(22, cun), useritemdata(23, cun), useritemdata(24, cun), useritemdata(25, cun), useritemdata(26, cun), useritemdata(27, cun), useritemdata(28, cun), useritemdata(29, cun), useritemdata(30, cun), useritemdata(31, cun), useritemdata(32, cun), useritemdata(33, cun), useritemdata(34, cun), useritemdata(35, cun), useritemdata(36, cun), useritemdata(37, cun), 0
	setitemid ci, cun
	return



*label_1640
	folder = exedir + "user\\"
	ogdata(34) = 0
	sdim untaglistitem
	repeat 5480 - 200, 200
		if (iNumber(cnt) > 0) {
			if (iId(cnt) == 743) {
				exist folder + useritemdatan(6, inv(31, cnt))
				if (strsize != (-1)) {
					if (inv(31, cnt) != useritemmax) {
						if (instr(untaglistitem, 0, "/" + useritemdatan(0, inv(31, cnt)) + "/") == (-1)) {
							if (ogdata(34) < 100) {
								bcopy folder + useritemdatan(6, inv(31, cnt)), folder + "_tmp_" + ogdata(34) + ".item"
								zipadd "_tmp_" + ogdata(34) + ".item"
								untaglistitem += "/" + useritemdatan(0, inv(31, cnt)) + "/"
								ogdata(34)++
							}
						}
					}
				}
			}
		}
	loop
	return



#defcfunc ioriginalnamecnv int __ooo
	if (iId(__ooo) == 743) {
		return useritemdatan(1, inv(31, __ooo))
	}
	return ioriginalnameref(iId(__ooo))



#defcfunc ioriginalname2cnv int __ci
	if (iId(__ci) == 743) {
		return useritemdatan(8, inv(31, __ci))
	}
	return ioriginalnameref2(iId(__ci))



#defcfunc iknownnamecnv int __ppp
	if (iId(__ppp) == 743) {
		return useritemdatan(4, inv(31, __ppp))
	}
	return iknownnameref(iId(__ppp))



#defcfunc ialphanamecnv int __qqq
	if (iId(__qqq) == 743) {
		return useritemdatan(2, inv(31, __qqq))
	}
	return ialphanameref(iId(__qqq))



#defcfunc ifiltercnv int __rrr
	if (iId(__rrr) == 743) {
		return useritemdatan(3, inv(31, __rrr))
	}
	return filter_item(iId(__rrr))
*label_1645
	inv_getheader -1
	repeat invrange, invhead
		notesel autopickbuff
		if (iNumber(cnt) > 0) {
			if (iOwnState(cnt) < 1) {
				if (iX(cnt) == x & iY(cnt) == y) {
					item_checkknown cnt
					cnt2 = cnt
					repeat noteinfo(0)
						p = 0
						p(1) = 0
						noteget buff, cnt
						if (instr(buff, 0, "#") != (-1)) {
							continue
						}
						s = buff
						if (instr(s, 0, "!!") != (-1)) {
							getstr s, s, 2
						} else {
							if (instr(s, 0, "!") != (-1) | instr(s, 0, "~") != (-1)) {
								getstr s, s, 1
							}
						}
						if (instr(s, 0, "?") != (-1)) {
							getstr s, s, 0, 63
						}
						s = strtrim(s, 0, ' ')
						while instr(s, 0, "  ") != -1
							sreplace s, s, "  ", " "
						wend
						s = " " + s + " "
						if (instr(s, 0, lang("すべての", " all ")) != -1) {
							p(1) = 1
							delstr s, "すべての"
							sreplace s, s, lang("すべての", " all "), " "
						}
						if (instr(s, 0, lang("名称不明の", " unknown ")) != -1) {
							if (iIdentificationState(cnt2) != 0) {
								continue
							}
							sreplace s, s, lang("名称不明の", " unknown "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("鑑定段階1の", " identify stage1 ")) != -1) {
							if (iIdentificationState(cnt2) != 1) {
								continue
							}
							sreplace s, s, lang("鑑定段階1の", " identify stage1 "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("鑑定段階2の", " identify stage2 ")) != -1) {
							if (iIdentificationState(cnt2) != 2) {
								continue
							}
							sreplace s, s, lang("鑑定段階2の", " identify stage2 "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("鑑定段階3の", " identify stage3 ")) != -1) {
							if (iIdentificationState(cnt2) != 3) {
								continue
							}
							sreplace s, s, lang("鑑定段階3の", " identify stage3 "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("無価値の", " worthless ")) != -1) {
							if (iValue(cnt2) > 10) {
								continue
							}
							sreplace s, s, lang("無価値の", " worthless "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("腐った", " rotten ")) != -1) {
							if (refitem(iId(cnt2), 5, cnt2) != 57000) {
								continue
							}
							if (iParam3(cnt2) >= 0) {
								continue
							}
							sreplace s, s, lang("腐った", " rotten "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("腐りきった", " zombie ")) != -1) {
							if (refitem(iId(cnt2), 5, cnt2) != 57000) {
								continue
							}
							if (iSubname(cnt2) != 21 & iSubname(cnt2) != 47 & iSubname(cnt2) != 48 & iSubname(cnt2) != 49 & iSubname(cnt2) != 99 & iSubname(cnt2) != 100 & iSubname(cnt2) != 101 & iSubname(cnt2) != 257 & iSubname(cnt2) != 254) {
								continue
							}
							sreplace s, s, lang("腐りきった", " zombie "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("ドラゴンの", " dragon's ")) != -1) {
							if (iId(cnt2) != 204 & refitem(iId(cnt2), 5, cnt2) != 62000) {
								continue
							}
							if (iSubname(cnt2) != 120 & iSubname(cnt2) != 121 & iSubname(cnt2) != 122 & iSubname(cnt2) != 123 & iSubname(cnt2) != 124 & iSubname(cnt2) != 125) {
								continue
							}
							sreplace s, s, lang("ドラゴンの", " dragon's "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("空っぽの", " empty ")) != -1) {
							if (refitem(iId(cnt2), 5, cnt2) != 72000) {
								continue
							}
							if (iParam1(cnt2) != 0) {
								continue
							}
							sreplace s, s, lang("空っぽの", " empty "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("粗悪な", " bad ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iQuality(cnt2) != 1) {
								continue
							}
							sreplace s, s, lang("粗悪な", " bad "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("良質な", " good ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iQuality(cnt2) != 2) {
								continue
							}
							sreplace s, s, lang("良質な", " good "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("高品質な", " great ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iQuality(cnt2) != 3) {
								continue
							}
							sreplace s, s, lang("高品質な", " great "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("奇跡の", " miracle ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iQuality(cnt2) != 4) {
								continue
							}
							sreplace s, s, lang("奇跡の", " miracle "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("神器の", " godly ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iQuality(cnt2) != 5) {
								continue
							}
							sreplace s, s, lang("神器の", " godly "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("特別な", " special ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iQuality(cnt2) != 6) {
								continue
							}
							sreplace s, s, lang("特別な", " special "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("貴重な", " precious ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (ibit(5, cnt2) != 1) {
								continue
							}
							sreplace s, s, lang("貴重な", " precious "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("祝福された", " blessed ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iCurseState(cnt2) != 1) {
								continue
							}
							sreplace s, s, lang("祝福された", " blessed "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("呪われた", " cursed ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iCurseState(cnt2) != (-1)) {
								continue
							}
							sreplace s, s, lang("呪われた", " cursed "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("堕落した", " doomed ")) != -1) {
							if (iIdentificationState(cnt2) < 2) {
								continue
							}
							if (iCurseState(cnt2) != (-2)) {
								continue
							}
							sreplace s, s, lang("堕落した", " doomed "), " "
							p(1) = 1
						}
						if (instr(s, 0, lang("生きている", " alive ")) != -1) {
							if (ibit(10, cnt2) != 1) {
								continue
							}
							sreplace s, s, lang("生きている", " alive "), " "
							p(1) = 1
						}
						s = strtrim(s, 0, ' ')
						while instr(s, 0, "  ") != -1
							sreplace s, s, "  ", " "
						wend
						s(1) = cnvitemname(iId(cnt2))
						if (instr(s(1), 0, s) != -1 & iIdentificationState(cnt2) != 0) {
							p = 1
						} else {
							if (p(1) == 0) {
								continue
							}
							if (instr(s, 0, lang("アイテム", "item")) != -1) {
								p = 1
							}
							if (instr(s, 0, lang("装備品", "equipment")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) >= 50000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("近接武器", "melee weapon")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 10000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("兜", "helm")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 12000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("盾", "shield")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 14000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("鎧", "armor")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 16000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("靴", "boots")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 18000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("腰当", "belt")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 19000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("マント", "cloak")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 20000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("グローブ", "gloves")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 22000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("遠隔武器", "ranged weapon")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 24000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("矢弾", "ammo")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 25000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("指輪", "ring")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 32000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("首輪", "necklace")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 34000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("ポーション", "potion")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 52000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("巻物", "scroll")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 53000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("魔法書", "spellbook")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 54000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("本", "book")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 55000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("魔法の杖", "rod")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 56000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("食べ物", "foods")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 57000 & item_isCookedMilk(cnt2) == 0) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("道具", "tool")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 59000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("家具", "furniture")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 60000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("井戸", "well")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 60001) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("祭壇", "altar")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 60002) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("残骸", "bodyparts")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 62000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("ジャンク", "junk")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 64000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("金貨", "gold piece")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 68000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("プラチナ硬貨", "platinum coin")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 69000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("宝箱", "chest")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 72000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("鉱石", "ore")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 77000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("樹木", "tree")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 80000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("旅糧", "traveler's food")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 91000) {
									continue
								}
								p = 1
							}
							if (instr(s, 0, lang("交易品", "cargo")) != -1) {
								if (refitem(iId(cnt2), 5, cnt2) != 92000) {
									continue
								}
								p = 1
							}
						}
						if (p == 1) {
							if (instr(buff, 0, "!!") != (-1)) {
								if (instr(buff, 0, "?") != (-1)) {
									if (cnt3 == 0) {
										txt -1, lang(itemname(cnt2) + "を破壊する？", "Destroy " + itemname(cnt2) + "?")
										promptl(0, 0) = stryes, "y", "0"
										promptl(0, 1) = strno, "n", "1"
										promptmax = 2
										val = promptx, prompty, 160, 1
										gosub *label_1353
										if (rtval != 0) {
											gosub *label_0623
											break
										}
									} else {
										txt -1, lang(name(cnt3) + "に" + itemname(cnt2) + "を破壊してもらう？", "Destroy " + itemname(cnt2) + "?")
										promptl(0, 0) = stryes, "y", "0"
										promptl(0, 1) = strno, "n", "1"
										promptmax = 2
										val = promptx, prompty, 160, 1
										gosub *label_1353
										if (rtval != 0) {
											gosub *label_0623
											break
										}
									}
								}
								if (cfg_autodestroysound) {
									snd 45
								}
								iNumber(cnt2) = 0
								if (synccheck(cnt3, -1)) {
									ctalk cnt3, 1107, cnt3, cnt3
									if (stat == 0) {
										ctalk cnt3, 1106, cnt3, cnt3
									}
									txt -1, lang(name(cnt3) + "は" + itemname(cnt2) + "を破壊した。", itemname(cnt2) + " was destroyed. ")
								}
								cell_refresh x, y
								map(x, y, 5) = map(x, y, 4)
								break
							}
							if (instr(buff, 0, "!") != (-1)) {
								if (ibit(5, cnt2) == 0) {
									if (instr(buff, 0, "?") != (-1)) {
										if (cnt3 == 0) {
											txt -1, lang(itemname(cnt2) + "を破壊する？", "Destroy " + itemname(cnt2) + "?")
											promptl(0, 0) = stryes, "y", "0"
											promptl(0, 1) = strno, "n", "1"
											promptmax = 2
											val = promptx, prompty, 160, 1
											gosub *label_1353
											if (rtval != 0) {
												gosub *label_0623
												break
											}
										} else {
											txt -1, lang(name(cnt3) + "に" + itemname(cnt2) + "を破壊してもらう？", "Destroy " + itemname(cnt2) + "?")
											promptl(0, 0) = stryes, "y", "0"
											promptl(0, 1) = strno, "n", "1"
											promptmax = 2
											val = promptx, prompty, 160, 1
											gosub *label_1353
											if (rtval != 0) {
												gosub *label_0623
												break
											}
										}
									}
									if (cfg_autodestroysound) {
										snd 45
									}
									iNumber(cnt2) = 0
									if (synccheck(cnt3, -1)) {
										ctalk cnt3, 1107, cnt3, cnt3
										if (stat == 0) {
											ctalk cnt3, 1106, cnt3, cnt3
										}
										txt -1, lang(name(cnt3) + "は" + itemname(cnt2) + "を破壊した。", itemname(cnt2) + " was destroyed. ")
									}
									cell_refresh x, y
									map(x, y, 5) = map(x, y, 4)
								}
								break
							}
							if (instr(buff, 0, "~") != (-1)) {
								break
							}
							if (instr(buff, 0, "?") != (-1)) {
								if (cnt3 == 0) {
									txt -1, lang(itemname(cnt2) + "を拾う？", "Pick up " + itemname(cnt2) + "?")
									promptl(0, 0) = stryes, "y", "0"
									promptl(0, 1) = strno, "n", "1"
									promptmax = 2
									val = promptx, prompty, 160, 1
									gosub *label_1353
									if (rtval != 0) {
										gosub *label_0623
										break
									}
								} else {
									txt -1, lang(name(cnt3) + "に" + itemname(cnt2) + "を拾ってもらう？", "Pick up " + itemname(cnt2) + "?")
									promptl(0, 0) = stryes, "y", "0"
									promptl(0, 1) = strno, "n", "1"
									promptmax = 2
									val = promptx, prompty, 160, 1
									gosub *label_1353
									if (rtval != 0) {
										gosub *label_0623
										break
									}
								}
							}
							if (instr(buff, 0, "%") != (-1)) {
								autosave = 1 * (gCurrentMap != 35)
							}
							if (instr(buff, 0, "=") != (-1)) {
								txt -1, lang(itemname(cnt2) + "を大事なものに指定した。", "You set " + itemname(cnt2) + " as no-drop.")
								ibitmod 13, cnt2, 1
							}
							if (instr(buff, 0, ":sound") != (-1)) {
								snd 200
							}
							in = iNumber(cnt2)
							ci = cnt2
							cc = cnt3
							gosub *label_1647
							break
						}
					loop
				}
			}
		}
	loop
	noteunsel
	return



#deffunc loadpickitembuff int __sss
	sdim autopickbuff, 256, 500
	if (__sss == 0) {
		exist exedir + "save\\" + playerid + "\\" + "autopick.txt"
		if (strsize != (-1)) {
			notesel autopickbuff
			noteload exedir + "save\\" + playerid + "\\" + "autopick.txt"
			noteunsel
		}
	} else {
		exist exedir + "save\\" + playerid + "\\" + "autopick_" + __sss + ".txt"
		if (strsize != (-1)) {
			notesel autopickbuff
			noteload exedir + "save\\" + playerid + "\\" + "autopick_" + __sss + ".txt"
			noteunsel
		}
	}
	nowautopickfile = __sss
	exist exedir + "save\\" + playerid + "\\" + "customname.txt"
	if (strsize != (-1)) {
		buff = ""
		notesel buff
		noteload exedir + "save\\" + playerid + "\\" + "customname.txt"
		repeat noteinfo(0)
			noteget s, cnt
			cnamelist(cnt) = s
		loop
	}
	return
*label_1647
	if (cc != (-1)) {
		if (iId(ci) == 54 | iId(ci) == 55) {
			if (cfg_autopicksound) {
				snd 11
			}
			ti = ci
			in = iNumber(ci)
			iNumber(ci) = 0
			msgkeep = 1
			ctalk cc, 10105, cc, cc
			if (stat == 0) {
				txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
				ctalk cc, 1105, cc, cc
				if (stat == 0) {
					ctalk cc, 1104, cc, cc
				}
			}
			if (p == 1) {
				notesel autopickbuff
			}
			cell_refresh iX(ci), iY(ci)
			map(iX(ci), iY(ci), 5) = map(iX(ci), iY(ci), 4)
			if (iId(ci) == 54) {
				se_moneymod cc, in
			} else {
				addplat cc, in
			}
			return 1
		}
	}
	if (cc == 0) {
		if (gMount != 0) {
			if (cContinuousActionId(gMount) != 0) {
				if (cContinuousActionItem(gMount) == ci) {
					txt -1, lang("それは" + name(gMount) + "が使用中だ。", name(gMount) + " " + is(gMount) + " using it.")
					return 1
				}
			}
		}
		if (inv_getfreeid(cc) == (-1)) {
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return 0
		}
	}
	inumbk = iNumber(ci) - in
	iNumber(ci) = in
	if (cc == 0) {
		if (gettrait(0, 215) != 0) {
			if (refitem(iId(ci), 5, ci) == 56000) {
				if (iCount(ci) > 0) {
					dbmode = 14
					dbid = iId(ci)
					gosub *label_2426
					txt -1, lang("あなたは" + itemname(ci) + "から魔力を吸い取った。", "You absorb magic from " + itemname(ci) + ".")
					if (efid >= 400 & efid < 600) {
						spell(efid - 400) += iCount(ci) * 5 * iNumber(ci)
					} else {
						healmp 0, iCount(ci) * 5 * iNumber(ci)
					}
					iCount(ci) = 0
				}
			}
		}
		if (gettrait(0, 216) != 0) {
			if (refitem(iId(ci), 5, ci) == 52000) {
				if (iId(ci) != 262 & iId(ci) != 559 & iId(ci) != 793 & item_isCookedMilk(ci) == 0) {
					if (rnd(5) == 0) {
						txt -1, lang("あなたの手から毒が滴った。", "Poison drips from your hands.")
						iId(ti) = 262
						iImage(ti) = 354
						iColor(ti) = _randcolor((262 + gRandomSeed) \ 6)
						iValue(ti) = 120
						iEnhancement(ti) = 0
						ibitmod 5, ti, 0
					}
				}
			}
		}
	}
	if (iOwnState(ci) < 0) {
		iOwnState(ci) = 0
	}
	if (ibit(12, ci)) {
		iCount(ci) = 0
		ibitmod 12, ci, 0
	}
	inv(39, ci) = 0
	item_stack cc, ci
	if (stat == 0) {
		ti = inv_getfreeid(cc)
		if (ti == (-1)) {
			iNumber(ci) = inumbk + in
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return 0
		}
		item_copy ci, ti
		iNumber(ti) = in
	}
	iNumber(ci) = inumbk
	cell_refresh iX(ci), iY(ci)
	map(iX(ci), iY(ci), 5) = map(iX(ci), iY(ci), 4)
	if (cfg_autopicksound) {
		snd 14 + rnd(2)
	}
	msgkeep = 1
	ctalk cc, 10105, cc, cc
	if (stat == 0) {
		txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
		ctalk cc, 1105, cc, cc
		if (stat == 0) {
			ctalk cc, 1104, cc, cc
		}
	}
	if (p == 1) {
		notesel autopickbuff
	}
	if (cc == 0) {
		if (iId(ti) == 255) {
			inv_getheader -1
			if (mapCampfireExists == 1) {
				f = 0
				repeat invrange, invhead
					if (iNumber(cnt) == 0) {
						continue
					}
					if (iId(cnt) == 255) {
						f = 1
						break
					}
				loop
				if (f == 0) {
					mapCampfireExists = 0
					gosub *label_0122
				}
			}
		}
		convertartifact ti
		ti = stat
		if (areaId(gCurrentMap) == 101) {
			if (mode == 0) {
				gosub *label_0931
			}
		}
		if (gCurrentMap == 7) {
			if (mode == 0) {
				gosub *housing_calculateHomeValue
			}
		}
		gosub *refreshPCBurdenState
	}
	if (cc == (-1)) {
		gosub *refreshPCBurdenState
	}
	return 1



#deffunc delstr var __ttt, str __uuu
	repeat
		if (instr(__ttt, 0, __uuu) == (-1)) {
			break
		} else {
			memcpy __ttt, __ttt, strlen(__ttt) - (instr(__ttt, 0, __uuu) + strlen(__uuu)), instr(__ttt, 0, __uuu), instr(__ttt, 0, __uuu) + strlen(__uuu)
			memset __ttt, 0, strlen(__uuu), strlen(__ttt) - strlen(__uuu)
		}
	loop
	return
*label_1649
*label_1650
	if (cfg_showroomlog == 0) {
		return
	}
	buff = "\n##########この行より下のみ手動で編集可##########\n"
	notesel buff
	exist exedir + "user\\showroom_log.txt"
	if (strsize != (-1)) {
		noteload exedir + "user\\showroom_log.txt"
	}
	if (peek(listn(0, p), 0) == 42) {
		getstr listn(0, p), listn(0, p), 1
	}
	if (instr(buff, 0, listn(0, p)) == (-1)) {
		noteadd listn(0, p), 2
	}
	noteadd listn(0, p), 0, 1
	if (cfg_showroomlog != 6) {
		repeat
			if (noteinfo(0) > cfg_showroomlog * 100 + 2) {
				notedel cfg_showroomlog * 100 + 2
			} else {
				break
			}
		loop
	}
	notesave exedir + "user\\showroom_log.txt"
	noteunsel
	return



#defcfunc bsearch int __vvv, int __www, int __xxx, var __yyy, int __zzz
	if (bm@m2 == 0) {
		dim bm@m2, 49
		VirtualProtect bm@m2, 49 * 4, 64, azsd@m2
		pbm@m2 = varptr(bm@m2)
		bm@m2(0) = -2115204267, 262380, 274041600, 1972065875, 33456916, 843888143, 578115583
		bm@m2(7) = 1161412659, -1836183796, -1962934272, -1240528811, -784658412, 8815631, 994050048
		bm@m2(14) = -344191931, -963937301, 65721, 12422400, -201326596, -12153429, -1064974029
		bm@m2(21) = -125084034, 287094287, -1648588479, -1024, 2093497167, -1958089745, -1240528827
		bm@m2(28) = -1240530684, 1006580348, -1976863289, -1946282404, 1099761789, 941374207, -125100939
		bm@m2(35) = 2089679147, -7995593, 1569400436, -1974515704, 339351316, 274041624, 1166797940
		bm@m2(42) = 79040264, -2054421759, -1024, 2081180987, -3636302, -916758945, 195
	}
	prm@m2 = __www + __vvv, __xxx - __vvv, varptr(__yyy), __zzz
	return callfunc(prm@m2, pbm@m2, 4)
*label_1652



#deffunc tmpload str __aaa
	writeloadedbuff "" + __aaa
	if (stat == (-1)) {
		return
	}
	word = __aaa
	exist exedir + "save\\" + playerid + "\\" + word
	if (strsize != (-1)) {
		if (cfg_datacopy == 0) {
			bcopy exedir + "save\\" + playerid + "\\" + word, exedir + "tmp\\" + word
		} else {
			chdir exedir + "save\\" + playerid + "\\"
			fxcopy word, exedir + "tmp\\"
			chdir exedir
		}
	}
	return



#deffunc writeloadedbuff str __bbb
	if (__bbb == "") {
		return -1
	}
	word = __bbb
	lkey = strlen(word)
	pbuf = varptr(loadedbuff)
	if (bsearch(0, pbuf, loadedbuffmax, word, lkey) != (-1)) {
		return -1
	}
	poke loadedbuff, bufflast, word
	bufflast += strlen(word)
	poke loadedbuff, bufflast, "/"
	bufflast++
	if (bufflast + 500 > loadedbuffmax) {
		memexpand loadedbuff, loadedbuffmax + 2000
		memset loadedbuff, 0, 2000, loadedbuffmax
		loadedbuffmax += 2000
	}
	return 0
*label_1655
	listmax = 0
	page = 0
	pagesize = 9
	cs_bk = -1
	cs = cook_cs
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_inv.bmp", 1
	gsel 0
	windowshadow = 1
	redraw 0
	repeat 9
		list(0, cnt) = cnt + 1
		p = cnt + 2
		if (iParam1(ci) != 10000) {
			list(1, cnt) = limit(sdata(184, 0) * 3 + iParam1(cooktool) / 15 - p * p, 5, 100 + iParam1(cooktool) / 2 - p * p)
		} else {
			list(1, cnt) = limit((sdata(184, 0) / 2) + iParam1(cooktool) / 30 - p * p * (p / 3), 1, 100 + iParam1(cooktool) / 2 - p * p)
		}
		if (list(1, cnt) > 100) {
			list(1, cnt) = 100
		}
		if (iId(ci) == 743) {
			listn(0, cnt) = foodname(iParam1(ci) / 1000, "" + ioriginalnamecnv(ci), list(0, cnt), iSubname(ci), inv(33, ci)), "" + list(1, cnt) + "%"
		} elseif (iId(ci) == 618) {
			listn(0, cnt) = foodname(iParam1(ci) / 1000, "" + fishdatan(iSubname(ci)), list(0, cnt), iSubname(ci), inv(33, ci)), "" + list(1, cnt) + "%"
		} elseif (iId(ci) == iId_milk) {
			if (ibit(5, ci)) {
				listn(0, cnt) = foodname(9, cdatan(0, 0), list(0, cnt), iSubname(ci), inv(33, ci)), "" + list(1, cnt) + "%"
			} else {
				listn(0, cnt) = foodname(9, "", list(0, cnt), iSubname(ci), inv(33, ci)), "" + list(1, cnt) + "%"
			}
		} else {
			if (ibit(5, ci)) {
				listn(0, cnt) = foodname(iParam1(ci) / 1000, cdatan(0, 0), list(0, cnt), iSubname(ci), inv(33, ci)), "" + list(1, cnt) + "%"
			} else {
				listn(0, cnt) = foodname(iParam1(ci) / 1000, "", list(0, cnt), iSubname(ci), inv(33, ci)), "" + list(1, cnt) + "%"
			}
		}
		listmax++
	loop
*label_1656
	redraw 0
	s = lang("料理", "Cooking")
	display_window (windoww - 730) / 2 + inf_screenx, winposy(430, 0), 730, 430, 55, 40
	s = lang("料理名", "Recipe"), strhint3, lang("確率", "Success rate")
	display_topic s, wx + 46, wy + 36
	display_topic s(2), wx + 555, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 57, wy + 66 + cnt * 19
			gfini 640, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		cs_list listn(0, p), wx + 80, wy + 66 + cnt * 19 - 1, 19
		pos wx + 590, wy + 66 + cnt * 19 + 2
		mes listn(1, p)
	loop
	if (keyrange != 0) {
		cs_bk = cs
		cook_cs = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	nc_intb_005 = 0
	repeat keyrange
		if (key == key_select(cnt)) {
			if (key != key_cancel) {
				p = pagesize * page + cnt
				txt -1, lang("いくつ料理する？(1~", "How meny?(1~") + iNumber(ci) + ")"
				nc_intb_005 = iNumber(ci)
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, nc_intb_005
				inputlog = "1"
				p@se = rtval
				gosub *label_1349
				rtval = p@se
				if (rtval == (-1)) {
					nc_intb_004 = 1
				} else {
					nc_intb_004 = int(inputlog)
				}
			}
			break
		}
	loop
	if (nc_intb_004 == 1) {
		if (p >= 0) {
			snd 25
			item_separate ci
			nc_strb_001 = itemname(ci)
			if (rnd(100) < list(1, p)) {
				make_dish ci, list(0, p)
				if (inv(3, ci) == 191 | inv(3, ci) == 192 | refitem(inv(3, ci), 9, ci) == 57004) {
					if (gettrait(cc, 103)) {
						iEnhancement(ci) = calctraitscore(stat)
					}
				}
				txt -1, lang(itemname(cooktool) + "で" + nc_strb_001 + "を料理して、" + itemname(ci, 1) + "を作った。", "You cook " + nc_strb_001 + " with " + itemname(cooktool, 1) + " and make " + itemname(ci, 1) + ".")
				ctalk cc, 1336, cc, cc
			} else {
				make_dish ci, rnd(2) + 1
				txt -1, lang(itemname(cooktool) + "で" + nc_strb_001 + "を料理したが失敗したため、" + itemname(ci, 1) + "ができた。", "You cooked " + nc_strb_001 + " with " + itemname(cooktool) + " but failed, so you made " + itemname(ci, 1) + ".")
				ctalk cc, 1103, cc, cc
			}
			throwsstpevent "Cooking", 0, itemname(ci), inv(3, ci), inv(25, ci) / 1000, inv(26, ci)
			r1 = iParam2(ci)
			item_autostack cc, ci
			if (r1 > 2) {
				skillexp2 184, 0, 30 + r1 * 5
			}
			gosub *refreshPCBurdenState
			gosub *label_0623
			return
		}
	} elseif (nc_intb_004 > 1) {
		if (p >= 0) {
			r1 = 0
			snd 25
			nc_strb_001 = itemname(ci)
			nc_intb_102 = 0
			nc_intb_103 = 0
			repeat nc_intb_004
				item_separate ci
				nc_intb_001 = stat
				if (rnd(100) < list(1, p)) {
					make_dish ci, list(0, p)
					if (inv(3, ci) == 191 | refitem(inv(3, ci), 9, ci) == 57004) {
						if (gettrait(cc, 103)) {
							iEnhancement(ci) = calctraitscore(stat)
						}
					}
					nc_intb_102++
				} else {
					make_dish ci, rnd(2) + 1
					nc_intb_103++
				}
				item_autostack cc, ci, 1
				r1 += iParam2(ci)
				ci = nc_intb_001
				nc_intb_005 = (cnt + 1)
				if (cc == 0) {
					if (cSp(0) < 50) {
						if (cSp(0) < rnd(75)) {
							txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
							dmgsp 0, sdataref(2, efid) / 2 + 1
							break
						}
					}
					nc_intb_006 = rnd(sdataref(2, efid) / 2 + 1) + sdataref(2, efid) / 2 + 1
					if (gettrait(0, 86)) {
						nc_intb_006 -= nc_intb_006 * calctraitscore(stat) / 10
					}
					dmgsp 0, nc_intb_006
				}
			loop
			repeat nc_intb_005
				skillexp2 184, 0, 30 + ((r1 / nc_intb_005) * 5)
			loop
			txt -1, lang(itemname(cooktool) + "で" + nc_strb_001 + "を" + nc_intb_005 + "回料理した。", "You cook " + nc_strb_001 + " with " + itemname(cooktool, 1) + " " + f + "time.")
			txt -1, lang(listn(0, p) + "を" + nc_intb_102 + "回作り、" + nc_intb_103 + "回失敗した。", "You cooked " + listn(0, p) + " " + nc_intb_102 + " times and " + nc_intb_103 + " failed.")
			gosub *refreshPCBurdenState
			gosub *label_0623
			return
		}
	}
	if (key == key_cancel) {
		gosub *label_0623
		return
	}
	goto *label_1656



#defcfunc oabit int __ccc, int __ddd
	if (__ddd >= 450 & __ddd < 500) {
		HMMBITCHECK oadata(__ddd - 450), __ccc
		return abs(stat)
	}
	return 0



#deffunc oabitmod int __eee, int __fff, int __ggg
	if (__ggg == 0) {
		HMMBITOFF oadata(__fff - 450), __eee
		return
	}
	HMMBITON oadata(__fff - 450), __eee
	return
*label_1659
	exist exedir + "NGwords.txt"
	if (strsize == (-1)) {
		buff = "阻。\n棒。\n赤。\nﾋ｡｣\n仝"
		bsave exedir + "NGwords.txt", buff, 25
	}
	notesel ngwordsbuff
	noteload exedir + "NGwords.txt"
	noteunsel
	return



#defcfunc checkngwords str __hhh
	flag = 0
	buff = __hhh
	notesel ngwordsbuff
	repeat noteinfo(0)
		noteget s, cnt
		if (instr(buff, 0, s) != (-1)) {
			flag = 1
			break
		}
	loop
	noteunsel
	return flag



#defcfunc mbsbtypebyte int __iii
	return __iii >= 129 & __iii <= 159 | (__iii >= 224 & __iii <= 252)



#defcfunc mbsbtype var __jjj, int __kkk
	bcnt@m4 = __kkk
	repeat __kkk
		if (mbsbtypebyte(peek(__jjj, __kkk - cnt - 1)) == 0) {
			bcnt@m4 = cnt
			break
		}
	loop
	if (bcnt@m4 \ 2) {
		return 2
	} else {
		return mbsbtypebyte(peek(__jjj, __kkk))
	}
*label_1663

#deffunc rewriteai int __lll
	if (ocbit(0, __lll)) {
		return
	}
	if (cId(__lll) == 211) {
		if (ocdata(49, __lll) == 0) {
			cdata(220, __lll) = -9998
		} else {
			cdata(220, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 230) {
		if (ocdata(49, __lll) == 0) {
			cdata(220, __lll) = 639
		} else {
			cdata(220, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 237 | cId(__lll) == 244 | cId(__lll) == 245 | cId(__lll) == 321) {
		if (ocdata(49, __lll) == 0) {
			cbitmod 18, __lll, 1
			cdata(215, __lll) = 644
		} else {
			cbitmod 18, __lll, 0
			cdata(215, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 249) {
		if (ocdata(50, __lll) == 0) {
			cdata(220, __lll) = 643
		} else {
			cdata(220, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 264 | cId(__lll) == 288 | cId(__lll) == 290) {
		if (ocdata(49, __lll) == 0) {
			cbitmod 20, __lll, 1
		} else {
			cbitmod 20, __lll, 0
		}
		return
	}
	if (cId(__lll) == 285 | cId(__lll) == 286 | cId(__lll) == 287) {
		if (ocdata(49, __lll) == 0) {
			cbitmod 23, __lll, 1
		} else {
			cbitmod 23, __lll, 0
		}
		return
	}
	if (cId(__lll) == 320) {
		if (ocdata(49, __lll) == 0) {
			cdata(220, __lll) = -9996
		} else {
			cdata(220, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 327) {
		if (ocdata(49, __lll) == 0) {
			cbitmod 27, __lll, 1
		} else {
			cbitmod 27, __lll, 0
		}
		return
	}
	if (cId(__lll) == 330) {
		if (ocdata(49, __lll) == 0) {
			cdata(220, __lll) = 654
		} else {
			cdata(220, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 331) {
		if (ocdata(49, __lll) == 0) {
			cdata(220, __lll) = 657
		} else {
			cdata(220, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 336) {
		if (ocdata(49, __lll) == 0) {
			cdata(224, __lll) = 657
		} else {
			cdata(224, __lll) = -1
		}
		return
	}
	if (cId(__lll) == 341) {
		if (ocdata(49, __lll) == 0) {
			cdata(220, __lll) = 466
		} else {
			cdata(220, __lll) = 659
		}
		return
	}
	if (cId(__lll) == 317) {
		if (ocdata(49, __lll) == 0) {
			cdata(224, __lll) = 454
		} else {
			cdata(224, __lll) = 648
		}
		return
	}
	return
*label_1665
	if (gdata(73) != 3) {
		txt -1, lang("あなたは少女騎士団を置き去りにした。", "You leave Knights of the Little Girls to their own devices and bravely run away.")
		gosub *label_1666
		msg_halt
	}
	ogdata(24) = 0
	gExecutingImmediateQuestType = 0, 0, 0, 0
	return
*label_1666
	gdata(73) = 3
	txtef 8
	txt -1, lang("あなたは少女騎士団を護れなかった。", "You have failed to protect the Knights of the Little Girls.")
	modkarma 0, -10
	decfame 0, 40
	p = stat
	txtef 3
	txt -1, lang("名声値を" + p + "失った。", "You lose " + p + " fame.")
	return



#defcfunc exist_escorttarget int __mmm
	f@m119 = 0
	repeat 188, 57
		if (cState(cnt) == 1) {
			if (cId(cnt) == __mmm) {
				f@m119++
			}
		}
	loop
	return f@m119



#deffunc mtencremove int __nnn, int __ooo, int __ppp
	enc@m48 = mtenc(__ooo * 2, __ppp)
	if (enc@m48 == 0) {
		return
	}
	encp@m48 = mtenc(__ooo * 2 + 1, __ppp)
	repeat 15
		if (iEnchantmentId(__nnn, cnt) == enc@m48) {
			iEnchantmentPower(__nnn, cnt) -= encp@m48
			if (__ppp == 24 & iEnchantmentPower(__nnn, cnt) < 0) {
				iEnchantmentPower(__nnn, cnt) += 50
			}
			if (__ppp == 7 & iEnchantmentPower(__nnn, cnt) < 0) {
				iEnchantmentPower(__nnn, cnt) += 50
			}
			if (iEnchantmentPower(__nnn, cnt) == 0) {
				iEnchantmentId(__nnn, cnt) = 0
			}
			break
		}
	loop
	if (enc@m48 < 10000) {
		p@m48 = enc@m48
	} else {
		p@m48 = enc@m48 / 10000
	}
	iValue(__nnn) = iValue(__nnn) * 100 / encref(1, p@m48)
	sortenc __nnn
	return



#defcfunc checkalpha str __qqq
	namae = __qqq
	alpha@m63 = 0
	repeat strlen(namae)
		if (strmid(namae, cnt, 2) != "ー" & peek(namae, cnt) != 131) {
			alpha@m63 = 0
			break
		}
		alpha@m63++
		continue cnt + 2
	loop
	return alpha@m63 == strlen(namae) / 2
*label_1670
	movx = cX(cc)
	movy = cY(cc)
	if (map(movx, movy, 6) != 0) {
		cell_featread movx, movy
		if (feat(1) == 14) {
			if (feat(2) == 7) {
				if (cbit(5, cc) == 1 & cGravity(cc) == 0 | cbit(31, cc) == 1) {
					return
				}
			}
			if (feat(0) != tile_trap & petcheck(cc)) {
				gosub *label_0715
				if (stat == 1) {
					revealtrap movx, movy
					feat(0) = tile_trap
				}
			}
			refdiff = 100 + gCurrentDungeonLevel * 3
			if (feat(0) == tile_trap) {
				refdiff = refdiff / 3
				if (cc < 16) {
					if (sdata(175, cc) != 0) {
						val = gCurrentDungeonLevel
						gosub *label_0718
						if (stat == 1) {
							gosub *label_1366
							return
						} else {
							txt -1, lang(name(cc) + "は罠の解除に失敗した。", "You fail to disarm the trap.")
						}
					}
				}
			}
			gosub *label_0716
			if (stat == 1) {
				if (synccheck(cc, -1)) {
					txt -1, lang(name(cc) + "は罠を避けた。", name(cc) + " evade" + _s(cc) + " a trap.")
				}
				if (cc < 16) {
					revealtrap movx, movy
				}
			} else {
				if (cc < 16) {
					revealtrap movx, movy
					snd 70
				}
				efsource = 5
				if (synccheck(cc, -1)) {
					txt -1, lang(aln(cc) + "罠にかかった！", name(cc) + " activate" + _s(cc) + " a trap!")
				}
				if (feat(2) == 4) {
					if (synccheck(cc, -1)) {
						txt -1, lang("墨が噴き出した。", "Gallons of ink spreads.")
					}
					dmgcon cc, 4, 100 + gCurrentDungeonLevel * 2
				}
				if (feat(2) == 6) {
					if (synccheck(cc, -1)) {
						txt -1, lang("刺激的な匂いがただよう。", "Stimulative gas spreads.")
					}
					dmgcon cc, 3, 100 + gCurrentDungeonLevel * 2
				}
				if (feat(2) == 5) {
					if (synccheck(cc, -1)) {
						txt -1, lang("臭い匂いがたちこめた。", "Smelly gas spreads.")
					}
					dmgcon cc, 5, 100 + gCurrentDungeonLevel * 2
				}
				if (feat(2) == 3) {
					cell_featset movx, movy, 0
					if (encfind(cc, 22) != (-1) & (findbuff(cc, 62) == (-1) | have_bigench(cc, 3) == 1) | findfaction(cc, "regist", "teleport")) {
						if (synccheck(cc, -1)) {
							txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
						}
						return
					}
					repeat 200
						cNextX(cc) = rnd(mapWidth - 2) + 1
						cNextY(cc) = rnd(mapHeight - 2) + 1
						cell_check cNextX(cc), cNextY(cc)
						if (cellaccess == 1) {
							if (synccheck(cc, -1)) {
								snd 72
								txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
							}
							rowactend cc
							redraw 0
							gosub *label_0623
							break
						}
					loop
					goto *label_1367
				}
				if (feat(2) == 0) {
					if (synccheck(cc, -1)) {
						txt -1, lang("槍が地面から飛び出した。", "Several spears fly out from the ground.")
					}
					if (cbit(5, cc) == 1 & cGravity(cc) == 0) {
						if (synccheck(cc, -1)) {
							txt -1, lang("しかし" + name(cc) + "には届かなかった。", "But they don't reach " + name(cc) + ".")
						}
					} else {
						dmghp cc, rnd(gCurrentDungeonLevel * 2 + 10), -1
					}
				}
				if (feat(2) == 1) {
					if (synccheck(cc, -1)) {
						txt -1, lang("毒ガスが噴き出した。", "Poisonous gas spreads.")
					}
					dmgcon cc, 1, 100 + gCurrentDungeonLevel * 2
				}
				if (feat(2) == 2) {
					if (synccheck(cc, -1)) {
						txt -1, lang("催眠ガスが噴き出した。", "Sleeping gas spreads.")
					}
					dmgcon cc, 2, 100 + gCurrentDungeonLevel * 2
				}
				if (feat(2) == 7) {
					txtef 9
					txt -1, lang(" *チュドーン！* ", "*kabooom*")
					aniref = 0
					animeid = 2
					anix = movx
					aniy = movy
					gosub *label_0630
					cell_featset movx, movy, 0
					if (gCurrentMap == 210 & ncgdata(306)) {
						dmghp cc, 1000000 + gCurrentDungeonLevel * 10000 + (cHp(cc) / 2), -1
					} else {
						dmghp cc, 100 + rnd(200), -1
					}
				}
				efsource = 0
			}
		}
	}
	return



#defcfunc thousandsep str __rrr
	if (cfg_thousandsep == 0) {
		return __rrr
	}
	dim numberfmt@m6, 6
	lpdecimalsep@m6 = "."
	lpthousandsep@m6 = ","
	numberfmt@m6 = 0, 0, 3, varptr(lpdecimalsep@m6), varptr(lpthousandsep@m6), 1
	sdim lpnumberstr@m6
	GetNumberFormatA , , __rrr, varptr(numberfmt@m6), varptr(lpnumberstr@m6), 64
	return lpnumberstr@m6



#deffunc searchrangeinit int __sss, int __ttt, int __uuu
	if (__uuu < 1) {
		return 0
	}
	dim checked@m7, mapWidth, mapHeight
	searchrange __sss, __ttt - 1, __uuu, 1
	searchrange __sss + 1, __ttt, __uuu, 2
	searchrange __sss, __ttt + 1, __uuu, 3
	searchrange __sss - 1, __ttt, __uuu, 4
	return 1



#deffunc searchrange int __vvv, int __www, int __xxx, int __yyy
	if (__vvv < 0 | __www < 0 | __vvv >= mapWidth | __www >= mapHeight) {
		return
	}
	if (__xxx <= checked@m7(__vvv, __www)) {
		return
	}
	if (__xxx - 1 < 0) {
		return
	}
	checked@m7(__vvv, __www) = __xxx
	inrange(__vvv, __www) = 1
	if (__yyy != 3) {
		searchrange __vvv, __www - 1, __xxx - 1, 1
	}
	if (__yyy != 4) {
		searchrange __vvv + 1, __www, __xxx - 1, 2
	}
	if (__yyy != 1) {
		searchrange __vvv, __www + 1, __xxx - 1, 3
	}
	if (__yyy != 2) {
		searchrange __vvv - 1, __www, __xxx - 1, 4
	}
	return
*label_1674
	csetquestboss = 2420014, 2570028, 1400025, 2300025, 3000031, 1430025, 1440024, 1450016, 1410028, 20055, 1750080, 1770080, 1780080, 250025, 260006, 270042, 320020
	csetguildmember = 289, 295, 293
	csetguildmaster = 288, 291, 292
	csetgodservant = 262, 263, 264, 260, 265, 266, 261
	return



*custom_loadClasses
	exist exedir + "data\\oo_class.csv"
	if (strsize == (-1)) {
		dialog lang("dataフォルダにoo_class.csvが存在しません。", "oo_class.csv is missing from data folder.")
		goto *system_quitElona
	}
	notesel buff
	noteload exedir + "data\\oo_class.csv"
	userline = noteinfo(0) - 2
	buff += userclass
	sdim classnamecsv, 64, noteinfo(0) - 2, 2
	sdim classdescriptioncsv, 300, noteinfo(0) - 2, 2
	dim classplayable, noteinfo(0) - 2
	dim classstr, noteinfo(0) - 2
	dim classend, noteinfo(0) - 2
	dim classdex, noteinfo(0) - 2
	dim classper, noteinfo(0) - 2
	dim classler, noteinfo(0) - 2
	dim classwil, noteinfo(0) - 2
	dim classmag, noteinfo(0) - 2
	dim classchr, noteinfo(0) - 2
	dim classspd, noteinfo(0) - 2
	dim classequip, noteinfo(0) - 2
	dim classskillcsv, noteinfo(0) - 2, 30
	dim classspact, noteinfo(0) - 2, 22
	dim classguild, noteinfo(0) - 2
	dim classtool, noteinfo(0) - 2
	dim classtrait, noteinfo(0) - 2, 10
	sdim splitcsv, 64, 20, 2
	noteget s, 0
	csvstr2d splitcsv, 0, s, 20
	repeat noteinfo(0) - 2
		cnt2 = cnt
		if (cnt2 >= userline) {
			notesel userclassfield
			noteget buff2, cnt2 - userline
			csvstr2d splitcsv, 0, buff2, 20
			noteunsel
		}
		noteget buff2, cnt2 + 2
		csvstr2d splitcsv, 1, buff2, 20
		classnamecsv(cnt2, 0) = getcsvfield(splitcsv, "name")
		classnamecsv(cnt2, 1) = getcsvfield(splitcsv, "id")
		if (en) {
			classnamecsv(cnt2, 0) = classnamecsv(cnt2, 1)
		}
		classplayable(cnt2) = int(getcsvfield(splitcsv, "playable"))
		classstr(cnt2) = int(getcsvfield(splitcsv, "str"))
		classend(cnt2) = int(getcsvfield(splitcsv, "end"))
		classdex(cnt2) = int(getcsvfield(splitcsv, "dex"))
		classper(cnt2) = int(getcsvfield(splitcsv, "per"))
		classler(cnt2) = int(getcsvfield(splitcsv, "ler"))
		classwil(cnt2) = int(getcsvfield(splitcsv, "wil"))
		classmag(cnt2) = int(getcsvfield(splitcsv, "mag"))
		classchr(cnt2) = int(getcsvfield(splitcsv, "chr"))
		classspd(cnt2) = int(getcsvfield(splitcsv, "spd"))
		classequip(cnt2) = int(getcsvfield(splitcsv, "equip"))
		classguild(cnt2) = int(getcsvfield(splitcsv, "guild"))
		classtool(cnt2) = int(getcsvfield(splitcsv, "tool"))
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "skill")
		split s, "|", s
		repeat 30
			if (s(cnt) == "") {
				break
			}
			classskillcsv(cnt2, cnt) = int(s(cnt))
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "spact")
		split s, "|", s
		repeat 22
			if (s(cnt) == "") {
				break
			}
			p = int(s(cnt))
			if (p == 464 | p == 441 | p == 660 | p == 657 | p == sId_overCureOfJure | p == sId_superSpeed | p == sId_opatosBarrier | p == sId_kumiromisCutter | p == sId_kumiromisCutter_se | p == sId_enchantmentSeal | p == sId_enchantmentSeal_se) {
				p = -1
			}
			classspact(cnt2, cnt) = p
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "trait")
		split s, "|", s
		repeat 10
			if (s(cnt) == "") {
				break
			}
			classtrait(cnt2, cnt) = int(s(cnt))
		loop
		classdescriptioncsv(cnt2, 0) = getcsvfield(splitcsv, "description")
		classdescriptioncsv(cnt2, 1) = getcsvfield(splitcsv, "desc-e")
	loop
	noteunsel
	return



*custom_loadRaces
	exist exedir + "data\\o_race.csv"
	if (strsize == (-1)) {
		dialog "dataフォルダにo_race.csvが存在しません。"
		goto *system_quitElona
	}
	exist exedir + "data\\nc_race.csv"
	if (strsize == (-1)) {
		dialog "dataフォルダにnc_race.csvが存在しません。"
		goto *system_quitElona
	}
	notesel buff
	noteload exedir + "data\\o_race.csv"
	notesel buff2
  noteload exedir + "data\\nc_race.csv"
	buff += buff2
	buff2 = ""
	notesel buff
	userline = noteinfo(0) - 2
	buff += userrace
	sdim racenamecsv, 64, noteinfo(0) - 2, 2
	sdim racefigurecsv, 64, noteinfo(0) - 2
	sdim racedescriptioncsv, 300, noteinfo(0) - 2, 2
	dim raceid2, noteinfo(0) - 2
	dim raceplayable, noteinfo(0) - 2
	dim racesex, noteinfo(0) - 2
	dim racepic, noteinfo(0) - 2
	dim racepic2, noteinfo(0) - 2
	dim racedv, noteinfo(0) - 2
	dim racepv, noteinfo(0) - 2
	dim racehp, noteinfo(0) - 2
	dim racemp, noteinfo(0) - 2
	dim racestr, noteinfo(0) - 2
	dim raceend, noteinfo(0) - 2
	dim racedex, noteinfo(0) - 2
	dim raceper, noteinfo(0) - 2
	dim raceler, noteinfo(0) - 2
	dim racewil, noteinfo(0) - 2
	dim racemag, noteinfo(0) - 2
	dim racechr, noteinfo(0) - 2
	dim racespd, noteinfo(0) - 2
	dim racemeleestyle, noteinfo(0) - 2
	dim racecaststyle, noteinfo(0) - 2
	dim raceresist, noteinfo(0) - 2
	dim raceagernd, noteinfo(0) - 2
	dim raceage, noteinfo(0) - 2
	dim raceblood, noteinfo(0) - 2
	dim racebreeder, noteinfo(0) - 2
	dim raceheight, noteinfo(0) - 2
	dim raceskillcsv, noteinfo(0) - 2, 30
	dim racespact, noteinfo(0) - 2, 22
	dim racetrait, noteinfo(0) - 2, 10
	sdim splitcsv, 64, 40, 2
	noteget s, 0
	csvstr2d splitcsv, 0, s, 40
	repeat noteinfo(0) - 2
		cnt2 = cnt
		if (cnt2 >= userline) {
			notesel userracefield
			noteget buff2, cnt2 - userline
			csvstr2d splitcsv, 0, buff2, 40
			noteunsel
		}
		noteget buff2, cnt2 + 2
		csvstr2d splitcsv, 1, buff2, 40
		racenamecsv(cnt2, 0) = getcsvfield(splitcsv, "name")
		racenamecsv(cnt2, 1) = getcsvfield(splitcsv, "id")
		// OOENおよびOOENhは誤ったo_race.csvを配布しており、その中には"kobold"と書かれている。
		// 英語のスペルとしてはそちらが正しいが、既存のセーブとの互換性が壊れるためここで正規化する。
		if (racenamecsv(cnt2, 1) == "kobold") {
			racenamecsv(cnt2, 1) = "kobolt"
		}
		if (en) {
			racenamecsv(cnt2, 0) = racenamecsv(cnt2, 1)
		}
		// 逆に、OOENおよびOOENh以外のomakeヴァリアントでは"kobolt"という名前でo_race.csvが配布されているため、
		// 表示上の名前を"kobold"に正規化しておく。
		if (racenamecsv(cnt2, 0) == "kobolt") {
			racenamecsv(cnt2, 0) = "kobold"
		}
		raceid2(cnt2) = int(getcsvfield(splitcsv, "id2"))
		raceplayable(cnt2) = int(getcsvfield(splitcsv, "playable"))
		racesex(cnt2) = int(getcsvfield(splitcsv, "sex"))
		racepic(cnt2) = int(getcsvfield(splitcsv, "pic"))
		racepic2(cnt2) = int(getcsvfield(splitcsv, "pic2"))
		racedv(cnt2) = int(getcsvfield(splitcsv, "dv"))
		if (racedv(cnt2) == 0) {
			racedv(cnt2) = 100
		}
		racepv(cnt2) = int(getcsvfield(splitcsv, "pv"))
		if (racepv(cnt2) == 0) {
			racepv(cnt2) = 100
		}
		racehp(cnt2) = int(getcsvfield(splitcsv, "hp"))
		racemp(cnt2) = int(getcsvfield(splitcsv, "mp"))
		racestr(cnt2) = int(getcsvfield(splitcsv, "str"))
		raceend(cnt2) = int(getcsvfield(splitcsv, "end"))
		racedex(cnt2) = int(getcsvfield(splitcsv, "dex"))
		raceper(cnt2) = int(getcsvfield(splitcsv, "per"))
		raceler(cnt2) = int(getcsvfield(splitcsv, "ler"))
		racewil(cnt2) = int(getcsvfield(splitcsv, "wil"))
		racemag(cnt2) = int(getcsvfield(splitcsv, "mag"))
		racechr(cnt2) = int(getcsvfield(splitcsv, "chr"))
		racespd(cnt2) = int(getcsvfield(splitcsv, "spd"))
		racemeleestyle(cnt2) = int(getcsvfield(splitcsv, "meleeStyle"))
		racecaststyle(cnt2) = int(getcsvfield(splitcsv, "castStyle"))
		raceresist(cnt2) = int(getcsvfield(splitcsv, "resist"))
		raceagernd(cnt2) = int(getcsvfield(splitcsv, "ageRnd"))
		raceage(cnt2) = int(getcsvfield(splitcsv, "age"))
		raceblood(cnt2) = int(getcsvfield(splitcsv, "blood"))
		racebreeder(cnt2) = int(getcsvfield(splitcsv, "breeder"))
		raceheight(cnt2) = int(getcsvfield(splitcsv, "height"))
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "skill")
		split s, "|", s
		repeat 30
			if (s(cnt) == "") {
				break
			}
			raceskillcsv(cnt2, cnt) = int(s(cnt))
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "spact")
		split s, "|", s
		repeat 22
			if (s(cnt) == "") {
				break
			}
			p = int(s(cnt))
			if (p == 464 | p == 441 | p == 660 | p == 657 | p == sId_overCureOfJure | p == sId_superSpeed | p == sId_opatosBarrier | p == sId_kumiromisCutter | p == sId_kumiromisCutter_se | p == sId_enchantmentSeal | p == sId_enchantmentSeal_se) {
				p = -1
			}
			racespact(cnt2, cnt) = p
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "trait")
		split s, "|", s
		repeat 10
			if (s(cnt) == "") {
				break
			}
			racetrait(cnt2, cnt) = int(s(cnt))
		loop
		racefigurecsv(cnt2) = getcsvfield(splitcsv, "figure")
		racedescriptioncsv(cnt2, 0) = getcsvfield(splitcsv, "description")
		racedescriptioncsv(cnt2, 1) = getcsvfield(splitcsv, "desc-e")
	loop
	noteunsel
	return



*label_1677
	notesel buff
	noteload "o_creature.csv"
	maxcharaid = noteinfo(0) - 1
	dim creaturepic, maxcharaid, 2
	dim creaturecolor, maxcharaid
	sdim splitcsv, 64, 50, 2
	noteget s, 0
	csvstr2d splitcsv, 0, s, 50
	repeat maxcharaid
		cnt2 = cnt
		noteget buff2, cnt2 + 1
		csvstr2d splitcsv, 1, buff2, 50
		creaturepic(cnt2, 0) = int(getcsvfield(splitcsv, "pic"))
		creaturepic(cnt2, 1) = int(getcsvfield(splitcsv, "pic2"))
		if (creaturepic(cnt2, 1) == 0) {
			creaturepic(cnt2, 1) = creaturepic(cnt2, 0)
		}
		creaturecolor(cnt2) = int(getcsvfield(splitcsv, "color"))
	loop
	noteunsel
	return
*label_1678
	snd 94
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	repeat useritemmax
		if (instr(useritemdatan(6, cnt), 0, "_tmp_") == (-1)) {
			continue
		}
		if (instr(useritemdatan(3, cnt), 0, "/nodownload/") != (-1)) {
			continue
		}
		list(0, listmax) = listmax
		listn(0, listmax) = lang(useritemdatan(1, cnt) + "(" + useritemdatan(0, cnt) + ")", useritemdatan(0, cnt)), useritemdatan(6, cnt)
		listmax++
	loop
	txt -1, lang("どのアイテムを召喚したいと願うか？", "Which one do you wish to summon?")
	windowshadow = 1
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1679
	redraw 0
	s = lang("カスタムアイテム一覧", "Custom Item"), lang("決定 [召喚]  ", "Enter [Summon] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("名前", "Name"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 85, wy + 66 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if (p != (-1)) {
		listmax = p
		snd 64
		txt -1, listn(0, listmax) + lang("は、あなたの世界に召喚された！", " has been summoned to your world!")
		file = "" + userfile
		gosub *label_1320
		bcopy exedir + "user\\" + listn(1, listmax), exedir + "user\\" + listn(0, listmax) + ".item"
		gosub *custom_loadCitems
		repeat 5480
			if (iId(cnt) == 743) {
				getitemid cnt
			}
		loop
		gosub *custom_cleanUpTemporaryFiles
		gosub *label_1336
		gosub *label_1635
		return 1
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1237
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1237
		}
	}
	if (key == key_cancel) {
		return -1
	}
	goto *label_1679
*label_1680
	goto *label_1683



#defcfunc rndex int __zzz
	exrand_rnd rtval@m9, limit(__zzz, 1, 50000)
	return rtval@m9



#defcfunc rndex2 int __aaa
	exrand_rnd rtval@m9, limit(__aaa, 1, 2000000000)
	return rtval@m9
*label_1683



#defcfunc ogbit int __bbb
	HMMBITCHECK ogdata(432), __bbb
	return abs(stat)



#deffunc ogbitmod int __ccc, int __ddd
	if (__ddd == 0) {
		HMMBITOFF ogdata(432), __ccc
		return
	}
	HMMBITON ogdata(432), __ccc
	return



// Find the files having the specified extention, `__extension`, under the
// `user` directory.
// __numFiles: The number of the found files.
// userfilelist: The list of the found files.
#deffunc getuserfiledata str __extension, var __numFiles
	chdir exedir + "user\\"
	dirlist2h 130
	dirlist2 p, "*." + __extension, 1, 0
	dirlist2r buff
	notesel buff
	p(77) = noteinfo(0)
	if (p(77) > 0) {
		sortnote buff, 1
		repeat p(77)
			noteget s, cnt
			csvstr2 s, s
			userfilelist(0, __numFiles) = s(0)
			userfilelist(1, __numFiles) = exedir + "user\\" + s(1)
			__numFiles++
		loop
	}
	noteunsel
	chdir exedir
	return



// Clean up all temporary files(*.t) under the specified directory.
#deffunc cleanuserdir str __dir
	oomSEST_log "[Custom] Clean up temporary files: dir=" + __dir
	dirlist buff, __dir + "*.t"
	notesel buff
	repeat stat
		noteget file, cnt
		delete __dir + file
	loop
	return



#deffunc trash_reset
	dim trashinv, 70, 400
	trashcnt = 0
	return



#deffunc trash_push int __hhh, int __iii
	if (__hhh < 0 | trashcnt < 0 | length2(trashinv) <= trashcnt) {
		return
	}
	if (iOwnState(__hhh) > 0) {
		return
	}
	repeat 70
		trashinv(cnt, trashcnt) = inv(cnt, __hhh)
	loop
	trashinv(0, trashcnt) += __iii
	trashinv(5, trashcnt) = 0
	trashinv(6, trashcnt) = 0
	trashcnt++
	return



#deffunc trash_pop int __jjj
	if (__jjj < 0 | trashcnt <= 0 | length2(trashinv) < trashcnt) {
		return
	}
	trashcnt--
	repeat 70
		inv(cnt, __jjj) = trashinv(cnt, trashcnt)
	loop
	trashinv(0, trashcnt) = 0
	return



#deffunc trash_throw
	if (trashcnt <= 0 | mode == 6) {
		return
	}
	prep@m57 = p@m57
	preinvrange = invrange
	preinvhead = invhead
	premode = mode
	preinvfile = invfile
	invfile = 17
	file = "shoptmp17.s2"
	ctrlFile 4
	file = "shop" + 17 + ".s2"
	tmpload "" + file
	exist exedir + "tmp\\" + file
	if (strsize != (-1)) {
		ctrlFile 3
	} else {
		inv_getheader -1
		repeat invrange, invhead
			iNumber(cnt) = 0
		loop
	}
	mode = 6
	repeat length2(trashinv)
		if (trashcnt <= 0) {
			break
		}
		trashid = inv_getfreeid(-1)
		if (trashid == (-1)) {
			item_compress 10
			trashid = inv_getfreeid(-1)
			if (trashid == (-1)) {
				break
			}
		}
		trash_pop trashid
		item_stack -1, trashid
	loop
	file = "shop" + 17 + ".s2"
	ctrlFile 4
	file = "shoptmp17.s2"
	ctrlFile 3
	mode = premode
	invfile = preinvfile
	invhead = preinvhead
	invrange = preinvrange
	p@m57 = prep@m57
	return



#deffunc trash_clear
	prep@m57 = p@m57
	preinvrange = invrange
	preinvhead = invhead
	premode = mode
	preinvfile = invfile
	invfile = 17
	file = "shoptmp17.s2"
	ctrlFile 4
	file = "shop" + 17 + ".s2"
	tmpload "" + file
	exist exedir + "tmp\\" + file
	if (strsize != (-1)) {
		ctrlFile 3
	} else {
		inv_getheader -1
		repeat invrange, invhead
			iNumber(cnt) = 0
		loop
	}
	mode = 6
	trashremovecnt = 0
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) != 0) {
			iNumber(cnt) = 0
			trashremovecnt++
		}
	loop
	if (trashremovecnt > 0) {
		txt -1, lang("ゴミ箱の中身を捨てた。", "Garbage disposal from trash.")
	}
	file = "shop" + 17 + ".s2"
	ctrlFile 4
	file = "shoptmp17.s2"
	ctrlFile 3
	mode = premode
	invfile = preinvfile
	invhead = preinvhead
	invrange = preinvrange
	p@m57 = prep@m57
	return
*label_1693
	dmgdisplayflag = 0
	repeat 8 + 8
		if (ocdata(192 + cnt * 3, cc) == 0) {
			break
		}
		if (cState(tc) != 1) {
			break
		}
		if (orgdmg <= 1) {
			break
		}
		if (ocdata(192 + cnt * 3, cc) < 29 | ocdata(192 + cnt * 3, cc) > 39) {
			continue
		}
		ele = ocdata(192 + cnt * 3, cc) + 21
		gdata(809) = 1
		dmghp tc, rndex(int(double(orgdmg) * (100 + ocdata(192 + cnt * 3 + 1, cc)) / 1000 + 1)) + 5, cc, ele, ocdata(192 + cnt * 3 + 1, cc) / 2 + 100
		subdmg = 0
		ele = 0
		continue
	loop
	if (gettrait(cc, 60) == 2) {
		s = refchara(cId(tc), 8, 1)
		if (instr(s, 0, "/wild/") != (-1)) {
			gdata(809) = 1
			dmghp tc, orgdmg / 2, cc
			subdmg = 0
		}
	}
	if (gettrait(cc, 61) == 2) {
		s = refchara(cId(tc), 8, 1)
		if (instr(s, 0, "/demon/") != (-1)) {
			gdata(809) = 1
			dmghp tc, orgdmg / 2, cc
			subdmg = 0
		}
	}
	if (gettrait(cc, 98) == 2) {
		s = refchara(cId(tc), 8, 1)
		if (instr(s, 0, "/element/") != (-1)) {
			gdata(809) = 1
			dmghp tc, orgdmg / 2, cc
			subdmg = 0
		}
	}
	return



#defcfunc getsql str __kkk
	if (lpeek(tmparr(sql_colid_(__kkk, tmparr), n@sqle), strlen(tmparr(i@sqle, n@sqle)) + 4) == 1) {
		return int(tmparr(sql_colid_(__kkk, tmparr), n@sqle))
	}
	return tmparr(sql_colid_(__kkk, tmparr), n@sqle)



#deffunc outputmapimage int __lll
	bkselcur = selcur
	selcur = 34
	buffer 34, mapWidth * inf_tiles, mapHeight * inf_tiles
	light@m85 = gdata(89)
	if (gTorch == 1) {
		if (mapType >= 20 & mapType <= 23) {
			light@m85 -= 50
		}
	}
	scrturn@m85 = scrturn / 5
	px@m85 = cX(0) * inf_tiles
	py@m85 = cY(0) * inf_tiles
	redraw 0
	repeat mapHeight
		y@m85 = cnt
		dy@m85 = y@m85 * inf_tiles
		color 0, 0, 0
		repeat mapWidth
			x@m85 = cnt
			dx@m85 = x@m85 * inf_tiles
			if (cfg_camera == 0 | cfg_camera == 1) {
				if (x@m85 == mapWidth - 1) {
					if (y@m85 == cY(0)) {
						if (cState(0) == 1) {
							ani@m85 = cTurn(0) \ 4 * 32
							if (mapType == 1) {
								gmode 6, 32, 16, 85
								color 0, 0, 0
								pos px@m85 + 24, py@m85 + 27
								grotate 3, 240, 384, 0, 20, 10
								gmode 2, 32, 48
								pos px@m85 + 24, py@m85 + 14
								grotate 10, ani@m85, cDirection(0) * 48, 0, 16, 24
							} else {
								if (cbit(985, 0)) {
									gmode 2, 48, 96, 80
									pos px@m85 + 26 - 11, py@m85 - 32 + 11
									func_2 1, 96, 816, -80, 48, 96
									pos px@m85, py@m85 - 63
									gcopy 1, 96, 816, 48, 96
									py@m85 -= 24
								}
								if (chipm(0, ground@m85) == 3 & cbit(985, 0) == 0) {
									gmode 4, 32, 20, 146
									color 0, 0, 0
									pos px@m85 + 24, py@m85 + 36
									grotate 10, ani@m85, cDirection(0) * 48 + 28, 0, 24 + cfg_graphicpc * 8, 16 + cfg_graphicpc * 4
									gmode 2, 32, 28
									pos px@m85 + 24, py@m85 + 16
									grotate 10, ani@m85, cDirection(0) * 48, 0, 24 + cfg_graphicpc * 8, 24 + cfg_graphicpc * 4
								} else {
									gmode 6, , , 110
									color 0, 0, 0
									pos px@m85 + 8, py@m85 + 20 + cbit(985, 0) * 24
									gcopy 3, 240, 384, 32, 16
									gmode 2, 32, 48
									pos px@m85 + 24, py@m85 + 8
									grotate 10, ani@m85, cDirection(0) * 48, 0, 24 + cfg_graphicpc * 8, 40 + cfg_graphicpc * 8
								}
								if (cbit(985, 0)) {
									pos px@m85, py@m85
									gcopy 1, 96, 768, 48, 48
									py@m85 += 24
								}
							}
							gmode 2
							color 0, 0, 0
							if (cFurious(0) != 0) {
								pos px@m85, py@m85 - 24 - 24 * cbit(985, 0)
								gcopy 3, 32, 608, 16, 16
							}
							if (cEmotionIcon(0) != 0) {
								draw_emo 0, px@m85 + 4, py@m85 - 32 - 24 * cbit(985, 0)
							}
						}
					}
				}
			}
			ground@m85 = map(x@m85, y@m85, 2)
			sel@m85 = 2
			gmode 0, inf_tiles, inf_tiles
			pos dx@m85, dy@m85
			wall@m85 = 0
			if (chipm(2, ground@m85) == 2) {
				if (y@m85 < mapHeight - 1) {
					if (chipm(2, map(x@m85, y@m85 + 1, 2)) != 2) {
						if (map(x@m85, y@m85 + 1, 2) != tile_fog) {
							ground@m85 += 33
						}
					}
				}
			}
			if (chipm(2, ground@m85)) {
				wall@m85 = 1
			}
			if (chipm(3, ground@m85) != 0) {
				gcopy sel@m85, (ground@m85 \ 33 + (scrturn@m85 \ (chipm(3, ground@m85) + 1) - (scrturn@m85 \ (chipm(3, ground@m85) + 1) == chipm(3, ground@m85)) * 2 * (chipm(3, ground@m85) != 0))) * inf_tiles, ground@m85 / 33 * inf_tiles
			} else {
				gcopy sel@m85, ground@m85 \ 33 * inf_tiles, ground@m85 / 33 * inf_tiles
			}
			gmode 2, inf_tiles, inf_tiles
			if (map(x@m85, y@m85, 7) != 0) {
				p@m85 = map(x@m85, y@m85, 7) \ 10, map(x@m85, y@m85, 7) / 10
				if (p@m85(1)) {
					gcopy 5, p@m85(1) * inf_tiles + 288, 1152
				}
				if (p@m85) {
					if (p@m85 > 6) {
						p@m85 = 6
					}
					gcopy 5, p@m85 * inf_tiles, 1152
				}
			}
			if (efmap(1, x@m85, y@m85) > 0) {
				p@m85 = efmap(0, x@m85, y@m85)
				if (mefsubref(2, p@m85) == 1) {
					gmode 4, 32, 32, efmap(1, x@m85, y@m85) * 12 + 30
					pos dx@m85 + 24, dy@m85 + 24
					grotate 3, mefsubref(0, p@m85) + efmap(3, x@m85, y@m85) * 32, mefsubref(1, p@m85), 0.785 * efmap(2, x@m85, y@m85), 32, 32
				} else {
					gmode 4, 32, 32, 150
					pos dx@m85 + 8, dy@m85 + 8
					gcopy 3, mefsubref(0, p@m85) + efmap(1, x@m85, y@m85) * 32, mefsubref(1, p@m85)
				}
				gmode 2, inf_tiles, inf_tiles
			}
			if (map(x@m85, y@m85, 6) != 0) {
				p@m85 = map(x@m85, y@m85, 6) \ 1000
				if (p@m85 != 999 & p@m85 != 0) {
					pos dx@m85, dy@m85 - chipm(5, p@m85)
					gcopy 2, p@m85 \ 33 * inf_tiles, p@m85 / 33 * inf_tiles, inf_tiles, 48 + chipm(6, p@m85)
				}
				if (mapType == 1) {
					p@m85 = map(x@m85, y@m85, 6) / 100000 \ 100 + map(x@m85, y@m85, 6) / 10000000 * 100
					if (areaId(p@m85) == 8) {
						if (areaVisitedDeepestFloor(p@m85) == areaLastFloor(p@m85)) {
							pos dx@m85 + 16, dy@m85 - 16
							gcopy 3, 32, 624, 16, 16
						} else {
							if (areaVisitedDeepestFloor(p@m85) != 0) {
								pos dx@m85 + 16, dy@m85 - 16
								gcopy 3, 48, 624, 16, 16
							}
						}
					}
				}
			}
			if (cfg_camera == 0 | cfg_camera == 2) {
				if (areaId(gCurrentMap) == 7 | areaId(gCurrentMap) == 39 | areaId(gCurrentMap) > 100) {
					if (oommap(x@m85, y@m85, 0) != 0) {
						if (cfg_useffhp == 1) {
							preparepicitemexoom
							p@m85 = stat
							if (cfg_objectshadow) {
								if (chipi(6, p@m85)) {
									gmode 2, chipi(2, p@m85), chipi(3, p@m85), 80
									if (chipi(3, p@m85) == inf_tiles) {
										pos dx@m85 + chipi(2, p@m85) / 2 + chipi(6, p@m85) / 80 + 2, dy@m85 - chipi(4, p@m85) + 22
										if (chipi(4, p@m85) < 24) {
											func_1 1, 0, 960, chipi(6, p@m85) / 2, chipi(2, p@m85), chipi(3, p@m85)
										}
									} else {
										pos dx@m85 + chipi(2, p@m85) / 2 + chipi(6, p@m85) / 4, dy@m85 - chipi(4, p@m85) + 46
										func_1 1, 0, 960, chipi(6, p@m85) * 2, chipi(2, p@m85), chipi(3, p@m85)
									}
									gmode 2
								}
							}
							pos dx@m85, dy@m85 - chipi(4, p@m85)
							if (chipi(7, p@m85) == 0) {
								gcopy 1, 0, 960, chipi(2, p@m85), chipi(3, p@m85)
							} else {
								gcopy 1, chipi(0, p@m85) + (scrturn@m85 \ (chipi(7, p@m85) + 1) - (scrturn@m85 \ (chipi(7, p@m85) + 1) == chipi(7, p@m85)) * 2 * (chipi(7, p@m85) != 0)) * inf_tiles, chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
							}
						} else {
							p@m85 = oommap(x@m85, y@m85, 1)
							i@m85 = oommap(x@m85, y@m85, 3)
							gsel 1
							color 0
							boxf 0, 960, chipi(2, p@m85), chipi(3, p@m85) + 960
							pos 0, 960
							gcopy 1, chipi(0, p@m85), chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
							gfini chipi(2, p@m85), chipi(3, p@m85)
							gfdec2 c_col(0, i@m85), c_col(1, i@m85), c_col(2, i@m85)
							gsel selcur
							if (cfg_objectshadow) {
								if (chipi(6, p@m85)) {
									gmode 2, chipi(2, p@m85), chipi(3, p@m85), 80
									if (chipi(3, p@m85) == inf_tiles) {
										pos dx@m85 + chipi(2, p@m85) / 2 + chipi(6, p@m85) / 80 + 2, dy@m85 - chipi(4, p@m85) + 22
										if (chipi(4, p@m85) < 24) {
											func_1 1, 0, 960, chipi(6, p@m85) / 2, chipi(2, p@m85), chipi(3, p@m85)
										}
									} else {
										pos dx@m85 + chipi(2, p@m85) / 2 + chipi(6, p@m85) / 4, dy@m85 - chipi(4, p@m85) + 46
										func_1 1, 0, 960, chipi(6, p@m85) * 2, chipi(2, p@m85), chipi(3, p@m85)
									}
									gmode 2
								}
							}
							pos dx@m85, dy@m85 - chipi(4, p@m85)
							if (chipi(7, p@m85) == 0) {
								gcopy 1, 0, 960, chipi(2, p@m85), chipi(3, p@m85)
							} else {
								gcopy 1, chipi(0, p@m85) + (scrturn@m85 \ (chipi(7, p@m85) + 1) - (scrturn@m85 \ (chipi(7, p@m85) + 1) == chipi(7, p@m85)) * 2 * (chipi(7, p@m85) != 0)) * inf_tiles, chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
							}
						}
					}
				}
				if (map(x@m85, y@m85, 8) != 0) {
					p2@m85 = map(x@m85, y@m85, 8) - 1
					p@m85 = mef(1, p2@m85) \ 10000, mef(1, p2@m85) / 10000
					pos dx@m85, dy@m85 - chipi(4, p@m85)
					if (chipi(7, p@m85)) {
						p@m85 += (scrturn@m85 + p2@m85) \ (chipi(7, p@m85) + 1) - ((scrturn@m85 + p2@m85) \ (chipi(7, p@m85) + 1) == chipi(7, p@m85)) * 2 * (chipi(7, p@m85) != 0)
					}
					if (mef(1, p2@m85) > 10000) {
						gsel 1
						color 0
						boxf 0, 960, chipi(2, p@m85), chipi(3, p@m85) + 960
						if (p@m85 == 528) {
							gmode 2
							pos 0, 960
							gcopy 1, 0, 768, inf_tiles, inf_tiles
							pos 0, 1008
							gzoom 22, 20, 5 + 90 * (p@m85(1) > 660 & p@m85(1) < 825), chipc(0, p@m85(1)) + 8, chipc(1, p@m85(1)) + 4 + (chipc(3, p@m85(1)) > inf_tiles) * 8, chipc(2, p@m85(1)) - 16, chipc(3, p@m85(1)) - 8 - (chipc(3, p@m85(1)) > inf_tiles) * 10, 1
							pos 6, 974
							gcopy 1, 0, 1008, 22, 20
							gsel selcur
						} else {
							if (p@m85 == 531) {
								pos 8, 1058 - chipc(3, p@m85(1))
								gcopy 5 + 90 * (p@m85(1) > 660 & p@m85(1) < 825), chipc(0, p@m85(1)) + 8, chipc(1, p@m85(1)) + 2, chipc(2, p@m85(1)) - 16, chipc(3, p@m85(1)) - 8
								gmode 4, , , 150
								color 0, 0, 0
								pos 0, 960 + (chipc(3, p@m85(1)) == inf_tiles) * 48
								gcopy 1, 144, 768 + (chipc(3, p@m85(1)) > inf_tiles) * 48, inf_tiles, chipc(3, p@m85(1)) + (chipc(3, p@m85(1)) > inf_tiles) * 48
								gmode 2
								gsel selcur
							} else {
								if (p@m85 == 529) {
									pos 0, 1056 - chipc(3, p@m85(1))
									gcopy 5 + 90 * (p@m85(1) > 660 & p@m85(1) < 825), chipc(0, p@m85(1)), chipc(1, p@m85(1)), chipc(2, p@m85(1)), chipc(3, p@m85(1))
									gmode 2
									gsel selcur
								} else {
									pos 0, 960
									gcopy 1, chipi(0, p@m85), chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
									gfini chipi(2, p@m85), chipi(3, p@m85)
									gfdec2 c_col(0, p@m85(1)), c_col(1, p@m85(1)), c_col(2, p@m85(1))
									gsel selcur
								}
							}
						}
						gcopy 1, 0, 960, inf_tiles, inf_tiles
					} else {
						gcopy 1, chipi(0, p@m85), chipi(1, p@m85), inf_tiles, inf_tiles
					}
				}
				if (cfg_useffhp) {
					if (map(x@m85, y@m85, 5) != 0) {
						if (map(x@m85, y@m85, 5) < 0) {
							p@m85 = -map(x@m85, y@m85, 5)
							flooritem@m85 = p@m85 \ 1000 + 5080, p@m85 / 1000 \ 1000 + 5080, p@m85 / 1000000 \ 1000 + 5080
							stackh@m85 = 0
							repeat 3
								cnt2@m85 = 2 - cnt
								if (flooritem@m85(cnt2@m85) == 999 + 5080) {
									continue
								}
								preparepicitemex flooritem@m85(cnt2@m85)
								p@m85 = stat
								if (mapType == 1) {
									gmode 2, chipi(2, p@m85), chipi(3, p@m85)
									pos dx@m85 + 24, dy@m85 + 24 - stackh@m85 / 2
									grotate 1, 0, 960, 0, 24, 24
								} else {
									pos dx@m85, dy@m85 - chipi(4, p@m85) - stackh@m85
									if (chipi(7, p@m85) == 0) {
										gcopy 1, 0, 960, chipi(2, p@m85), chipi(3, p@m85)
									} else {
										gcopy 1, chipi(0, p@m85) + (scrturn@m85 \ (chipi(7, p@m85) + 1) - (scrturn@m85 \ (chipi(7, p@m85) + 1) == chipi(7, p@m85)) * 2 * (chipi(7, p@m85) != 0)) * inf_tiles, chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
									}
								}
								stackh@m85 += chipi(5, p@m85)
								if (p@m85 == 531 | p@m85 == 529) {
									if (chipc(3, i@m85) == 96) {
										stackh@m85 += 44
									}
								}
							loop
						} else {
							if (map(x@m85, y@m85, 5) == 363) {
								p@m85 = wpeek(map(x@m85, y@m85, 5), 0)
								i@m85 = wpeek(map(x@m85, y@m85, 5), 2)
								preparepicitem_func p@m85, i@m85
							} else {
								if (mapinv(x@m85, y@m85) != (-1) & mapinv(x@m85, y@m85) != 0) {
									preparepicitemex mapinv(x@m85, y@m85) - 1
									p@m85 = stat
								} else {
									p@m85 = -1
								}
							}
							if (p@m85 != (-1)) {
								if (mapType == 1) {
									gmode 2, chipi(2, p@m85), chipi(3, p@m85)
									pos dx@m85 + 24, dy@m85 + 24
									grotate 1, 0, 960, 0, 24, 24
								} else {
									pos dx@m85, dy@m85 - chipi(4, p@m85)
									if (chipi(7, p@m85) == 0) {
										gcopy 1, 0, 960, chipi(2, p@m85), chipi(3, p@m85)
									} else {
										gcopy 1, chipi(0, p@m85) + (scrturn@m85 \ (chipi(7, p@m85) + 1) - (scrturn@m85 \ (chipi(7, p@m85) + 1) == chipi(7, p@m85)) * 2 * (chipi(7, p@m85) != 0)) * inf_tiles, chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
									}
								}
							}
						}
					}
				} else {
					if (map(x@m85, y@m85, 5) != 0) {
						if (map(x@m85, y@m85, 5) < 0) {
							p@m85 = -map(x@m85, y@m85, 5)
							flooritem@m85 = p@m85 \ 1000 + 5080, p@m85 / 1000 \ 1000 + 5080, p@m85 / 1000000 \ 1000 + 5080
							stackh@m85 = 0
							repeat 3
								cnt2@m85 = 2 - cnt
								if (flooritem@m85(cnt2@m85) == 999 + 5080) {
									continue
								}
								p@m85 = iImage(flooritem@m85(cnt2@m85))
								i@m85 = iColor(flooritem@m85(cnt2@m85))
								gsel 1
								color 0
								boxf 0, 960, chipi(2, p@m85), chipi(3, p@m85) + 960
								if (p@m85 == 528) {
									gmode 2
									pos 0, 960
									gcopy 1, 0, 768, inf_tiles, inf_tiles
									pos 0, 1008
									gzoom 22, 20, 5 + 90 * (i@m85 > 660 & i@m85 < 825), chipc(0, i@m85) + 8, chipc(1, i@m85) + 4 + (chipc(3, i@m85) > inf_tiles) * 8, chipc(2, i@m85) - 16, chipc(3, i@m85) - 8 - (chipc(3, i@m85) > inf_tiles) * 10, 1
									pos 6, 974
									gcopy 1, 0, 1008, 22, 20
									gsel selcur
								} else {
									if (p@m85 == 531) {
										pos 8, 1058 - chipc(3, i@m85)
										gcopy 5 + 90 * (i@m85 > 660 & i@m85 < 825), chipc(0, i@m85) + 8, chipc(1, i@m85) + 2, chipc(2, i@m85) - 16, chipc(3, i@m85) - 8
										gmode 4, , , 150
										color 0, 0, 0
										pos 0, 960 + (chipc(3, i@m85) == inf_tiles) * 48
										gcopy 1, 144, 768 + (chipc(3, i@m85) > inf_tiles) * 48, inf_tiles, chipc(3, i@m85) + (chipc(3, i@m85) > inf_tiles) * 48
										gmode 2
										gsel selcur
									} else {
										if (p@m85 == 529) {
											pos 0, 1056 - chipc(3, i@m85)
											gcopy 5 + 90 * (i@m85 > 660 & i@m85 < 825), chipc(0, i@m85), chipc(1, i@m85), chipc(2, i@m85), chipc(3, i@m85)
											gmode 2
											gsel selcur
										} else {
											pos 0, 960
											gcopy 1, chipi(0, p@m85), chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
											gfini chipi(2, p@m85), chipi(3, p@m85)
											gfdec2 c_col(0, i@m85), c_col(1, i@m85), c_col(2, i@m85)
											gsel selcur
										}
									}
								}
								if (mapType == 1) {
									gmode 2, chipi(2, p@m85), chipi(3, p@m85)
									pos dx@m85 + 24, dy@m85 + 24 - stackh@m85 / 2
									grotate 1, 0, 960, 0, 24, 24
								} else {
									pos dx@m85, dy@m85 - chipi(4, p@m85) - stackh@m85
									if (chipi(7, p@m85) == 0) {
										gcopy 1, 0, 960, chipi(2, p@m85), chipi(3, p@m85)
									} else {
										gcopy 1, chipi(0, p@m85) + (scrturn@m85 \ (chipi(7, p@m85) + 1) - (scrturn@m85 \ (chipi(7, p@m85) + 1) == chipi(7, p@m85)) * 2 * (chipi(7, p@m85) != 0)) * inf_tiles, chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
									}
								}
								stackh@m85 += chipi(5, p@m85)
								if (p@m85 == 531 | p@m85 == 529) {
									if (chipc(3, i@m85) == 96) {
										stackh@m85 += 44
									}
								}
							loop
						} else {
							i@m85 = wpeek(map(x@m85, y@m85, 5), 2)
							p@m85 = wpeek(map(x@m85, y@m85, 5), 0)
							gsel 1
							color 0
							boxf 0, 960, chipi(2, p@m85), chipi(3, p@m85) + 960
							if (p@m85 == 528) {
								gmode 2
								pos 0, 960
								gcopy 1, 0, 768, inf_tiles, inf_tiles
								pos 0, 1008
								gzoom 22, 20, 5 + 90 * (i@m85 > 660 & i@m85 < 825), chipc(0, i@m85) + 8, chipc(1, i@m85) + 4 + (chipc(3, i@m85) > inf_tiles) * 8, chipc(2, i@m85) - 16, chipc(3, i@m85) - 8 - (chipc(3, i@m85) > inf_tiles) * 10, 1
								pos 6, 974
								gcopy 1, 0, 1008, 22, 20
								gsel selcur
							} else {
								if (p@m85 == 531) {
									pos 8, 1058 - chipc(3, i@m85)
									gcopy 5 + 90 * (i@m85 > 660 & i@m85 < 825), chipc(0, i@m85) + 8, chipc(1, i@m85) + 2, chipc(2, i@m85) - 16, chipc(3, i@m85) - 8
									gmode 4, , , 150
									color 0, 0, 0
									pos 0, 960 + (chipc(3, i@m85) == inf_tiles) * 48
									gcopy 1, 144, 768 + (chipc(3, i@m85) > inf_tiles) * 48, inf_tiles, chipc(3, i@m85) + (chipc(3, i@m85) > inf_tiles) * 48
									gmode 2
									gsel selcur
								} else {
									if (p@m85 == 529) {
										pos 0, 1056 - chipc(3, i@m85)
										gcopy 5 + 90 * (i@m85 > 660 & i@m85 < 825), chipc(0, i@m85), chipc(1, i@m85), chipc(2, i@m85), chipc(3, i@m85)
										gmode 2
										gsel selcur
									} else {
										pos 0, 960
										gcopy 1, chipi(0, p@m85), chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
										gfini chipi(2, p@m85), chipi(3, p@m85)
										gfdec2 c_col(0, i@m85), c_col(1, i@m85), c_col(2, i@m85)
										gsel selcur
									}
								}
							}
							if (mapType == 1) {
								gmode 2, chipi(2, p@m85), chipi(3, p@m85)
								pos dx@m85 + 24, dy@m85 + 24
								grotate 1, 0, 960, 0, 24, 24
							} else {
								pos dx@m85, dy@m85 - chipi(4, p@m85)
								if (chipi(7, p@m85) == 0) {
									gcopy 1, 0, 960, chipi(2, p@m85), chipi(3, p@m85)
								} else {
									gcopy 1, chipi(0, p@m85) + (scrturn@m85 \ (chipi(7, p@m85) + 1) - (scrturn@m85 \ (chipi(7, p@m85) + 1) == chipi(7, p@m85)) * 2 * (chipi(7, p@m85) != 0)) * inf_tiles, chipi(1, p@m85), chipi(2, p@m85), chipi(3, p@m85)
								}
							}
						}
					}
				}
			}
			if (cfg_camera == 0 | cfg_camera == 1) {
				if (map(x@m85, y@m85, 1) != 0) {
					c@m85 = map(x@m85, y@m85, 1) - 1
					if (c@m85 != 0) {
						if (cbit(967, c@m85) == 1) {
							if (cfg_npcwalk == 1) {
								ani@m85 = cTurn(c@m85) \ 4 * 32
							}
							if (mapType == 1) {
								gmode 6, 32, 16, 85
								color 0, 0, 0
								pos dx@m85 + 24, dy@m85 + 27
								grotate 3, 240, 384, 0, 20, 10
								gmode 2, 32, 48
								pos dx@m85 + 24, dy@m85 + 14
								grotate 10 + c@m85, ani@m85, cDirection(c@m85) * 48, 0, 16, 24
							} else {
								if (chipm(0, ground@m85) == 3) {
									gmode 4, 32, 20, 146
									color 0, 0, 0
									pos dx@m85 + 24, dy@m85 + 36
									grotate 10 + c@m85, ani@m85, cDirection(c@m85) * 48 + 28, 0, 24 + cfg_graphicnpc * 8, 16 + cfg_graphicnpc * 4
									gmode 2, 32, 28
									pos dx@m85 + 24, dy@m85 + 16
									grotate 10 + c@m85, ani@m85, cDirection(c@m85) * 48, 0, 24 + cfg_graphicnpc * 8, 24 + cfg_graphicnpc * 4
								} else {
									gmode 6, , , 110
									color 0, 0, 0
									pos dx@m85 + 8, dy@m85 + 20
									gcopy 3, 240, 384, 32, 16
									gmode 2, 32, 48
									pos dx@m85 + 24, dy@m85 + 8
									grotate 10 + c@m85, ani@m85, cDirection(c@m85) * 48, 0, 24 + cfg_graphicnpc * 8, 40 + cfg_graphicnpc * 8
								}
							}
							gmode 2
							color 0, 0, 0
							if (cFurious(c@m85) != 0) {
								pos dx@m85 + 12, dy@m85 - 28
								gcopy 3, 32, 608, 16, 16
							}
							if (cEmotionIcon(c@m85) != 0) {
								draw_emo c@m85, dx@m85 + 4, dy@m85 - 32
							}
						} else {
							col@m85 = getcharacolor(c@m85)
							p@m85 = getcharapic(c@m85)
							if (cbit(985, c@m85)) {
								gmode 2, 48, 96, 80
								pos dx@m85, dy@m85 - 63
								gcopy 1, 96, 816, 48, 96
								chipc(4, p@m85) += 24
							}
							gsel 5
							color 0
							boxf 0, 960, chipc(2, p@m85), chipc(3, p@m85) + 960
							pos 0, 960
							if (__lll == (-1)) {
								gcopy 5, 288, 144, 48, 48
							} else {
								if (p@m85 < 33 * 25 + 900) {
									gcopy 5 + 90 * (p@m85 > 660 & p@m85 < 825), chipc(0, p@m85), chipc(1, p@m85), chipc(2, p@m85), chipc(3, p@m85)
								} else {
									gcopy 35, chipc(0, p@m85), chipc(1, p@m85), chipc(2, p@m85), chipc(3, p@m85)
								}
							}
							gfini chipc(2, p@m85), chipc(3, p@m85)
							gfdec2 c_col(0, col@m85), c_col(1, col@m85), c_col(2, col@m85)
							gsel selcur
							transmissivity = 0
							dropshadowtype = 0
							if (cId(c@m85) == 343) {
								if (userdata2(1, cCnpcId(c@m85))) {
									transmissivity = userdata2(1, cCnpcId(c@m85))
								}
								if (userdata2(2, cCnpcId(c@m85))) {
									dropshadowtype = userdata2(2, cCnpcId(c@m85))
								}
							}
							if (ocdata(101, c@m85)) {
								transmissivity = ocdata(101, c@m85)
							}
							if (ocdata(102, c@m85)) {
								dropshadowtype = ocdata(102, c@m85)
							}
							if (mapType == 1) {
								if (dropshadowtype == 0) {
									gmode 6, 32, 16, 85
									color 0, 0, 0
									pos dx@m85 + 24, dy@m85 + 32
									grotate 3, 240, 384, 0, 20, 10
								} else {
									if (dropshadowtype != (-1)) {
										gmode 6, 32, 16, 85
										color 0, 0, 0
										pos dx@m85 + 24, dy@m85 + 32
										grotate 3, 240, 384, 0, 20, 10
									}
								}
								gmode 4, chipc(2, p@m85), chipc(3, p@m85), 256 - transmissivity
								pos dx@m85 + 24, dy@m85 + 24 - chipc(4, p@m85) / 4
								grotate 5, 0, 960, 0, 24, chipc(3, p@m85) / 2
								gmode 2
								if (cEmotionIcon(c@m85) != 0) {
									draw_emo c@m85, dx@m85 + 4, dy@m85 - chipc(4, p@m85) / 4 - 16
								}
							} else {
								if (chipm(0, ground@m85) == 3) {
									gmode 4, inf_tiles, inf_tiles, 100 - limit(transmissivity * 4 / 10, 0, 100)
									color 0, 0, 0
									pos dx@m85, dy@m85 + 16 - chipc(4, p@m85) - (chipm(0, ground@m85) == 3) * (-16)
									gcopy 5, 0, 976, chipc(2, p@m85), chipc(3, p@m85) - 16
									gmode 4, inf_tiles, inf_tiles, 256 - transmissivity
									pos dx@m85, dy@m85 - chipc(4, p@m85) - (chipm(0, ground@m85) == 3) * (-16)
									gcopy 5, 0, 960, chipc(2, p@m85), chipc(3, p@m85) - 16
									gmode 2
								} else {
									if (dropshadowtype == 0) {
										gmode 6, , , 110
										color 0, 0, 0
										pos dx@m85 + 8, dy@m85 + 20
										gcopy 3, 240, 384, 32, 16
									}
									gmode 4, inf_tiles, inf_tiles, 256 - transmissivity
									pos dx@m85, dy@m85 - chipc(4, p@m85) - (chipm(0, ground@m85) == 3) * (-16)
									gcopy 5, 0, 960, chipc(2, p@m85), chipc(3, p@m85)
									gmode 2
								}
								if (cFurious(c@m85) != 0) {
									pos dx@m85 + 12, dy@m85 - chipc(4, p@m85) - 12
									gcopy 3, 32, 608, 16, 16
								}
								if (cEmotionIcon(c@m85) != 0) {
									draw_emo c@m85, dx@m85 + 4, dy@m85 - chipc(4, p@m85) - 16
								}
							}
							if (cbit(985, c@m85)) {
								pos dx@m85, dy@m85 - 26
								gcopy 1, 96, 768, 48, 48
								chipc(4, p@m85) -= 24
							}
						}
					}
				}
			}
			if (cfg_camera == 0 | cfg_camera == 2) {
				if (areaId(gCurrentMap) == 7 | areaId(gCurrentMap) == 39 | areaId(gCurrentMap) > 100) {
					if (oommap(x@m85, y@m85, 4) != 0) {
						p@m85 = oommap(x@m85, y@m85, 4)
						if (gHour > 17 | gHour < 6 | lightdata(6, p@m85)) {
							if (mapsync(x@m85, y@m85) == msync) {
								light@m85 -= (6 - limit(dist(cX(0), cY(0), x@m85, y@m85), 0, 6)) * lightdata(4, p@m85)
								pos dx@m85, dy@m85 - lightdata(3, p@m85)
								gmode 5, inf_tiles, inf_tiles, lightdata(2, p@m85) + rnd(lightdata(5, p@m85) + 1)
								gcopy 3, 192 + lightdata(0, p@m85) * 48 + rnd(lightdata(1, p@m85) + 1) * inf_tiles, 704
							}
						}
					}
				}
				if (map(x@m85, y@m85, 9) != 0) {
					p@m85 = map(x@m85, y@m85, 9)
					if (gHour > 17 | gHour < 6 | lightdata(6, p@m85)) {
						pos dx@m85, dy@m85 - lightdata(3, p@m85)
						gmode 5, inf_tiles, inf_tiles, lightdata(2, p@m85) + rnd(lightdata(5, p@m85) + 1)
						gcopy 3, 192 + lightdata(0, p@m85) * 48 + rnd(lightdata(1, p@m85) + 1) * inf_tiles, 704
					}
				}
			}
			if (cfg_camera == 0 | cfg_camera == 1) {
				if (map(x@m85, y@m85, 1) != 0) {
					c@m85 = map(x@m85, y@m85, 1) - 1
					p@m85 = ocdata(191, c@m85)
					if (mapsync(x@m85, y@m85) == msync) {
						light@m85 -= (6 - limit(dist(cX(0), cY(0), x@m85, y@m85), 0, 6)) * lightdata(4, p@m85)
						pos dx@m85, dy@m85 - lightdata(3, p@m85)
						gmode 5, inf_tiles, inf_tiles, lightdata(2, p@m85) + rnd(lightdata(5, p@m85) + 1)
						gcopy 3, 192 + lightdata(0, p@m85) * 48 + rnd(lightdata(1, p@m85) + 1) * inf_tiles, 704
					}
				}
			}
			if (wall@m85 == 0) {
				if (ground@m85 != tile_fog) {
					if (y@m85 > 0) {
						if (dy@m85 > 48) {
							ground@m85 = map(x@m85, y@m85 - 1, 0)
							if (chipm(2, ground@m85)) {
								pos dx@m85, dy@m85
								gfini inf_tiles, 24
								gfdec2 16, 16, 16
								pos dx@m85, dy@m85 + 24
								gfini inf_tiles, 12
								gfdec2 12, 12, 12
							}
						}
					}
				}
			} else {
				gmode 0
				if (y@m85 > 0) {
					p@m85 = map(x@m85, y@m85 - 1, 2)
					if (chipm(2, p@m85) != 2) {
						if (p@m85 != tile_fog) {
							if (dy@m85 > 20) {
								pos dx@m85, dy@m85 - 12
								gcopy sel@m85, ground@m85 \ 33 * inf_tiles, ground@m85 / 33 * inf_tiles, inf_tiles, 12
								pos dx@m85, dy@m85 - 20
								gfini inf_tiles, 8
								gfdec2 25, 25, 25
							}
						}
					}
				}
			}
		loop
	loop
	redraw 1
	bmpsave exedir + "mapimage.bmp"
	alCreateImage 0, mapWidth * inf_tiles, mapHeight * inf_tiles
	alCopyScreenToImage 34, 0
	alSaveFile exedir + "mapimage.png", "image/png"
	/*
	if (cfg_NC_logapply == 1) {
		s(0) = lang("[写真撮影] " + cdatan(1, 0) + " " + cdatan(0, 0) + "が写真を撮影しました。", "[Picture] " + cdatan(1, 0) + " " + cdatan(0, 0) + " take a picture.")
		s(1) = lang("撮影場所: ", "Location: ") + mdatan(0)
		NNetflag = 1
		gosub *label_NNet
	}
	*/
	buffer 34, 1, 1
	selcur = bkselcur
	gsel selcur
	return



#defcfunc getcsvfield array __mmm, str __nnn
	p@m10 = -1
	repeat length(__mmm)
		if (__mmm(cnt, 0) == __nnn) {
			p@m10 = cnt
			break
		}
	loop
	if (p@m10 != (-1)) {
		return __mmm(p@m10, 1)
	}
	if (__nnn == "tool") {
		return 0
	}
	return "notFound"



#deffunc csvstr2d array __ooo, int __ppp, str __qqq, int __rrr
	word@m11 = __qqq
	p@m11 = 0
	i@m11 = strlen(word@m11)
	repeat length(__ooo)
		__ooo(cnt, __ppp) = ""
	loop
	repeat __rrr
		getstr __ooo(cnt, __ppp), word@m11, limit(p@m11, 0, i@m11), 44
		if (strsize > i@m11) {
			break
		}
		p@m11 += strsize
	loop
	return



#deffunc stopthetimebegin int __sss
	snd 115
	gLeftTurnsOfTimestop = __sss
	return



#deffunc grayscaletheworld
	if (cfg_ST_timeStopEffect == 0) {
		return
	}
	if (gLeftTurnsOfTimestop > 0) {
		gsel 36
		gmode 0
		pos 0, 0
		gcopy selcur, 0, 0, windoww, windowh - inf_verh
		gsel selcur
		gmode 0
		pos 0, 0
		gcopy 36, 0, 0, windoww, windowh - inf_verh
	}
	return



#defcfunc getcharapic int __ttt
	if (charaffhpflag) {
		if (cchipexchangetable(cId(__ttt), cSex(__ttt))) {
			if (cImage(__ttt) == creaturepic(cId(__ttt), 1 - cSex(__ttt)) + creaturecolor(cId(__ttt)) * 1000) {
				return cchipexchangetable(cId(__ttt), cSex(__ttt)) \ 10000
			}
		}
	}
	if (cId(__ttt) == 343) {
		if (cCnpcId(__ttt) != usernpcmax) {
			if (cContinuousActionId(__ttt) != 20002 & userdata2(8, cCnpcId(__ttt)) == 0 & ocbit(8, __ttt) == 0) {
				return cImage(__ttt)
			}
		}
	}
	return cImage(__ttt) \ 1000



#defcfunc getcharacolor int __uuu
	if (charaffhpflag) {
		if (cchipexchangetable(cId(__uuu), cSex(__uuu))) {
			if (cImage(__uuu) == creaturepic(cId(__uuu), 1 - cSex(__uuu)) + creaturecolor(cId(__uuu)) * 1000) {
				if (cchipexchangetable(cId(__uuu), cSex(__uuu)) / 10000 - 1 >= 0) {
					return cchipexchangetable(cId(__uuu), cSex(__uuu)) / 10000 - 1
				}
			}
		}
	}
	if (cId(__uuu) == 343) {
		if (cCnpcId(__uuu) != usernpcmax) {
			if (cContinuousActionId(__uuu) != 20002 & userdata2(8, cCnpcId(__uuu)) == 0 & ocbit(8, __uuu) == 0) {
				return 0
			}
		}
	}
	return cImage(__uuu) / 1000



#deffunc addcrowd var __vvv, int __www
	__vvv += __www
	if (__vvv < 0) {
		__vvv = 0
	}
	return



#defcfunc twochoice int __xxx, int __yyy
	p@m13 = __xxx, __yyy
	return p@m13(rnd(2))



#deffunc advdie array __zzz, array __aaa, array __bbb, int __ccc
	__aaa(0, __ccc) = 4
	__aaa(5, __ccc) = __zzz(13) + __zzz(12) * 24 + __zzz(11) * 24 * 30 + __zzz(10) * 24 * 30 * 12 + 24 + rnd(24 / 2)
	leaveparty __bbb, __ccc
	return



#deffunc leaveparty array __ddd, int __eee
	if (__ddd(190, __eee) != 0) {
		if (__ddd(190, __eee) == __eee) {
			repeat 40 - 1, 16
				if (__ddd(190, cnt) == __eee) {
					__ddd(190, cnt) = 0
				}
			loop
		} else {
			__ddd(190, __ddd(190, __eee)) = 0
			repeat 40 - 1, 16
				if (__ddd(190, cnt) == __ddd(190, __eee)) {
					if (cnt != __eee) {
						__ddd(190, __ddd(190, __eee)) = __ddd(190, __eee)
						break
					}
				}
			loop
			__ddd(190, __eee) = 0
		}
	}
	return



// 冒険者のリーダー名を描画する
//
// @param __leaderName リーダー名
// @param __colorMode テキスト色
//            0 => 通常
//            1 => リーダー自身
//            2 => PCが雇用中
#deffunc draw_drawAdventurerLeaderName str __leaderName, int __colorMode
	font lang(cfg_font1, cfg_font2), 10
	pos dx@m85 + 22 - strlen(__leaderName) * 7 / 3, dy@m85 - chipc(4, p@m85) - 16
	if (__colorMode == 2) {
		color 31, 31, 47
		bmes __leaderName, 191, 191, 255
	} elseif (__colorMode == 1) {
		color 63, 31, 31
		bmes __leaderName, 255, 191, 191
	} else {
		color 31, 31, 31
		bmes __leaderName, 255, 255, 255
	}
	color
	return



#deffunc misakuraconvert var __hhh, int __iii
	if (cfg_talkconvert == 0) {
		return
	}
	if (strmid(__hhh, 0, 2) == "（" | strmid(__hhh, 0, 1) == "(" & (strmid(__hhh, -1, 2) == "）" | strmid(__hhh, -1, 1) == ")")) {
		return
	}
	if (__iii == 1) {
		p@m17 = 0
		repeat 20
			await
			splitpoint@m17 = instr(__hhh, p@m17, "「"), instr(__hhh, splitpoint@m17, "」"), strlen(__hhh)
			if (splitpoint@m17 == (-1)) {
				break
			}
			splitword@m17 = strmid(__hhh, splitpoint@m17, splitpoint@m17(1) + 2), strmid(__hhh, 0, splitpoint@m17), strmid(__hhh, splitpoint@m17 + splitpoint@m17(1) + 2, splitpoint@m17(2) - splitpoint@m17(1) - splitpoint@m17)
			notesel talkconvertbuff@m17
			repeat noteinfo(0)
				noteget temp@m17, cnt
				split temp@m17, "->", before@m17, after@m17
				sreplace splitword@m17, splitword@m17, before@m17, after@m17
			loop
			noteunsel
			__hhh = splitword@m17(1) + splitword@m17 + splitword@m17(2)
			p@m17 = strlen(splitword@m17(1) + splitword@m17)
		loop
	} else {
		notesel talkconvertbuff@m17
		repeat noteinfo(0)
			noteget temp@m17, cnt
			split temp@m17, "->", before@m17, after@m17
			sreplace __hhh, __hhh, before@m17, after@m17
		loop
		noteunsel
	}
	convert_word __hhh
	return



#deffunc loadtalkconvert
	sdim talkconvertbuff@m17, 1000
	exist exedir + "user\\talk\\talkconvert.txt"
	if (strsize != (-1)) {
		notesel talkconvertbuff@m17
		noteload exedir + "user\\talk\\talkconvert.txt"
		noteunsel
	}
	return
*label_1709
	allyctrl = 6
	gosub *ui_selectAlly
	if (stat != (-1)) {
		cc = stat
		snd 59
	} else {
		goto *label_1471
	}
	buff = ""
	redraw 0
	cs = 0
	cs_bk = -1
	page = 0
	pagesize = 16
	listmax = 0
	repeat length(classnamecsv)
		if (classplayable(cnt)) {
			if (classguild(cnt) != ccctrl) {
				continue
			}
			if (cdatan(3, cc) == classnamecsv(cnt, 1)) {
				continue
			}
			listn(1, listmax) = classnamecsv(cnt, 1)
			listmax++
		}
	loop
	repeat listmax
		dbidn = listn(1, cnt)
		dbmode = 2
		gosub *label_1526
		listn(0, cnt) = classname
	loop
	windowshadow = 1
*label_1710
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1711
	if (cs != cs_bk) {
		redraw 0
		s = lang("職業の選択", "Class Selection"), strhint3b
		display_window (windoww - 680) / 2 + inf_screenx, winposy(500, 1) + 20, 680, 450
		display_topic lang("選択できる職業", "Class"), wx + 28, wy + 30
		display_topic lang("職業の説明", "Detail"), wx + 188, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat pagesize
			p = page * pagesize + cnt
			if (p >= listmax) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
			if (jp) {
				s = listn(0, p)
			} else {
				s = cnven(listn(1, p))
			}
			cs_list s, wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		cs_bk = cs
		dbidn = listn(1, page * pagesize + cs)
		dbmode = 11
		gosub *label_1526
		val = 3
		gosub *label_0768
		redraw 1
	}
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if (key == key_select(cnt)) {
			p = page * pagesize + cnt
			break
		} else {
			p = -1
		}
	loop
	if (p != (-1)) {
		txt -1, lang(cdatan(0, cc) + "を" + listn(0, p) + "に転職させる？", "Change " + cdatan(0, cc) + "'s job to " + listn(0, p) + "?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval != 0) {
			snd 26
			goto *label_1710
		}
		snd 64
		txt -1, lang(cdatan(0, cc) + "は" + listn(0, p) + "に転職した！", "Successfully changed " + cdatan(0, cc) + "'s job to " + listn(0, p) + "!")
		cdatan(3, cc) = listn(1, p)
		snd 12
		cGold(0) -= calcactupgradevalue(cc)
		gosub *label_N200
		goto *label_1471
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1710
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1710
		}
	}
	if (key == key_cancel) {
		goto *label_1471
	}
	goto *label_1711
*label_1712
	if (mapType == 1) {
		if (rnd(20)) {
			return
		}
	}
	skillexp2 carmor(r1), r1, 3, 0, 5
	return
*label_1713
	initunid = 0
	repeat 50
		characreate 56, 0, -3, 0
		if (cOriginalRelationship(rc) < (-1)) {
			chara_vanquish 56
			dbid = 0
			continue
		}
		dbid = cId(rc)
		if (dbid == 343) {
			initunid = cCnpcId(rc) + 1
		}
		chara_vanquish 56
		break
	loop
	return
*label_1714
	copy_chara rc, charakind, 1
	if (stat == 0) {
		return 0
	}
	addcrowd gCrowdDensity, 1
	rc = c@m139
	memset ocdata(0, rc), 0, 250 * 4
	cdatan(0, rc) = lang("ドッペル", "Doppel ") + cdatan(0, rc)
	cQuality(rc) = fixlv
	cAiActSubFreq(rc) = limitmax(cAiActSubFreq(rc), 100)
	if (initlv != 0) {
		if (fixlv == 4) {
			cdatan(0, rc) = strbracketleft + cdatan(0, rc) + strbracketright
			initlv = initlv * 10 / 8
		}
		if (fixlv == 5) {
			cdatan(0, rc) = lang("《", "{") + cdatan(0, rc) + lang("》", "}")
			initlv = initlv * 10 / 6
		}
		lv = initlv - cLevel(rc)
		if (lv < 0) {
			lv = abs(lv)
			if (lv >= cLevel(rc)) {
				lv = cLevel(rc) - 1
			}
			cLevel(rc) -= lv
			cExperience(rc) = 0
			r1 = rc
			gosub *label_0663
			repeat 8, 10
				if (sdata(cnt, rc) != 0) {
					skillexp2 cnt, rc, (-1000) * lv
				}
			loop
		} else {
			if (lv > 0) {
				r1 = rc
				cExperience(r1) = 0
				cLevel(r1) += lv
				if (cMaxLevel(r1) < cLevel(r1)) {
					cMaxLevel(r1) = cLevel(r1)
				}
				repeat 20 - 10, 10
					sdata(cnt + 600, r1) = 1000000 * limit(sdata(cnt + 600, r1) / 1000000 + lv, 1, 2000)
				loop
				repeat length(mainskill)
					sdata(mainskill(cnt) + 600, r1) = 1000000 * limit(sdata(mainskill(cnt) + 600, r1) / 1000000 + lv, 1, 2000)
				loop
				gosub *label_0663
			}
		}
	}
	cRelationship(rc) = -3
	cOriginalRelationship(rc) = -3
	cbitmod 966, rc, 0
	cbitmod 968, rc, 0
	cbitmod 975, rc, 0
	cbitmod 976, rc, 1
	ocbitmod 7, rc, 1
	ocdata(101, rc) = 128
	ocdata(102, rc) = -1
	if (charakind == 0) {
		cAiCalm(rc) = 1
		p(99) = topattackskill(0)
		if (p(99) == 105 | p(99) == 172) {
			cAiMove(rc) = 50
			cAiDist(rc) = 3
			cequipment = 2
		} else {
			if (p(99) >= 108 & p(99) <= 111) {
				cAiMove(rc) = 50
				cAiDist(rc) = 2
				if (p(99) == 110) {
					cequipment = 4
				} else {
					cequipment = 3
				}
			} else {
				cAiMove(rc) = 80
				cAiDist(rc) = 1
				if (p(99) == 101) {
					cequipment = 7
				} else {
					cequipment = 1
				}
			}
		}
		cAiActSubFreq(rc) = 50
		cAiHeal(rc) = 0
		repeat 5
			p = rnd(5) + 400
			if (sdata(p, 0) == 0) {
				continue
			}
			cAiHeal(rc) = p
			break
		loop
		cAiActNum(rc) = 55
		csetspelllistmax = 0
		if (sdata(172, 0) > 0) {
			p(1) = sdata(172, 0) / 3
			repeat 66
				p = cnt + 400
				if (p == 409 | p == 411 | p == 413 | p == 428 | p == 429 | p == 430 | p == 435 | p == 438 | p == 441 | p == 457 | p == 458 | p == 461 | p == 463 | p == 464 | p == 503 | p == 504) {
					continue
				}
				if (ally) {
					if (p == 424 | p == 425) {
						continue
					}
				}
				if (sdata(p, 0) < p(1)) {
					continue
				}
				csetspelllist(csetspelllistmax) = p
				csetspelllistmax++
			loop
		}
		csetabilitylistmax = 0
		repeat 61
			if (cnt == 29 | cnt == 30) {
				continue
			}
			if (ally) {
				if (cnt == 42 | cnt == 41 | cnt == 39 | cnt == 40 | cnt == 43) {
					continue
				}
			}
			if (spact(cnt) == 0) {
				continue
			}
			csetabilitylist(csetabilitylistmax) = cnt + 600
			csetabilitylistmax++
		loop
		repeat 10
			act = -1
			if (csetspelllistmax != 0 & (cequipment == 2 & rnd(3) != 0 | rnd(3) == 0)) {
				act = csetspelllist(rnd(csetspelllistmax))
			} else {
				if (csetabilitylistmax != 0 & rnd(3) == 0) {
					act = csetabilitylist(rnd(csetabilitylistmax))
				} else {
					if (cequipment == 3 | cequipment == 4) {
						if (rnd(3)) {
							act = -2
						} else {
							act = -3
						}
					}
				}
			}
			cdata(215 + cnt, rc) = act
		loop
	} else {
		cequipment = refclass(rc, 4)
	}
	charakind = 0
	creaturepack = 0
	gosub *label_0730
	gosub *chara_refresh
	cHp(rc) = cMaxHp(rc)
	cSp(rc) = cMaxSp(rc)
	cMp(rc) = cMaxMp(rc)
	return 1
*label_1715
	dim nrdataref, 1, 39
	sdim naturen, 20, 2, 39
	nrdataref(0, 0) = 1
	naturen(0, 0) = "adamant", "意地っ張り"
	nrdataref(0, 1) = 2
	naturen(0, 1) = "rash", "うっかりもの"
	nrdataref(0, 2) = 3
	naturen(0, 2) = "timid", "臆病"
	nrdataref(0, 3) = 4
	naturen(0, 3) = "calm", "穏やか"
	nrdataref(0, 4) = 4
	naturen(0, 4) = "mild", "おっとり"
	nrdataref(0, 5) = 4
	naturen(0, 5) = "gentle", "大人しい"
	nrdataref(0, 6) = 2
	naturen(0, 6) = "hardy", "頑張り屋"
	nrdataref(0, 7) = 2
	naturen(0, 7) = "quirky", "気まぐれ"
	nrdataref(0, 8) = 5
	naturen(0, 8) = "lonely", "寂しがり"
	nrdataref(0, 9) = 5
	naturen(0, 9) = "careful", "慎重"
	nrdataref(0, 10) = 2
	naturen(0, 10) = "docile", "素直"
	nrdataref(0, 11) = 4
	naturen(0, 11) = "bold", "図太い"
	nrdataref(0, 12) = 2
	naturen(0, 12) = "hasty", "せっかち"
	nrdataref(0, 13) = 4
	naturen(0, 13) = "bashful", "照れ屋"
	nrdataref(0, 14) = 1
	naturen(0, 14) = "sassy", "生意気"
	nrdataref(0, 15) = 4
	naturen(0, 15) = "lax", "能天気"
	nrdataref(0, 16) = 4
	naturen(0, 16) = "relaxed", "暢気"
	nrdataref(0, 17) = 4
	naturen(0, 17) = "modest", "控え目"
	nrdataref(0, 18) = 6
	naturen(0, 18) = "serious", "真面目"
	nrdataref(0, 19) = 4
	naturen(0, 19) = "naive", "無邪気"
	nrdataref(0, 20) = 4
	naturen(0, 20) = "naughty", "不真面目"
	nrdataref(0, 21) = 1
	naturen(0, 21) = "brave", "勇敢"
	nrdataref(0, 22) = 5
	naturen(0, 22) = "jolly", "陽気"
	nrdataref(0, 23) = 4
	naturen(0, 23) = "quiet", "冷静"
	nrdataref(0, 24) = 2
	naturen(0, 24) = "impish", "悪戯好き"
	nrdataref(0, 25) = 1
	naturen(0, 25) = "heat", "熱血"
	nrdataref(0, 26) = 1
	naturen(0, 26) = "honest", "実直"
	nrdataref(0, 27) = 6
	naturen(0, 27) = "foxy", "ずる賢い"
	nrdataref(0, 28) = 2
	naturen(0, 28) = "twisted", "天邪鬼"
	nrdataref(0, 29) = 4
	naturen(0, 29) = "coquettish", "甘えんぼ"
	nrdataref(0, 30) = 7
	naturen(0, 30) = "delusional", "思い込みが激しい"
	nrdataref(0, 31) = 4
	naturen(0, 31) = "idleness", "怠惰"
	nrdataref(0, 32) = 5
	naturen(0, 32) = "courteous", "礼儀正しい"
	nrdataref(0, 33) = 8
	naturen(0, 33) = "rough", "荒々しい"
	nrdataref(0, 34) = 1
	naturen(0, 34) = "stubborn", "頑固"
	nrdataref(0, 35) = 4
	naturen(0, 35) = "insensibility", "鈍感"
	nrdataref(0, 36) = 1
	naturen(0, 36) = "noble", "気高い"
	nrdataref(0, 37) = 9
	naturen(0, 37) = "masochist", "マゾヒスト"
	nrdataref(0, 38) = 10
	naturen(0, 38) = "sadist", "サディスト"
	dim csetnature, length2(naturen)
	repeat length2(naturen)
		csetnature(cnt) = cnt
	loop
	return
*label_1716
	tc -= 1
	txt -1, lang(name(cc) + "に何を任せる？ ", "Assign " + name(tc) + " to work on what?")
	repeat length2(csetwork)
		if (areaId(gCurrentMap) != csetwork(0, cnt)) {
			continue
		}
		p = csetwork(1, cnt)
		if (sdata(p, cc) == 0) {
			continue
		}
		s = skillname(p)
		if (ocdata(104, cc) == p) {
			s += lang(" *請負中* ", " *Working* ")
		}
		promptl(0, promptmax) = s, "null", "" + cnt
		promptmax++
	loop
	val = promptx, prompty, 200, 1
	gosub *label_1353
	if (stat == 0 | rtval == (-1)) {
		return
	}
	work = csetwork(1, rtval)
	if (ocdata(104, cc) == work) {
		txt -1, lang(name(cc) + "を役目から外した。", "You remove " + name(cc) + " from " + his(cc) + " current work.")
		ocdata(104, cc) = 0
		return
	}
	txt -1, lang(name(cc) + "に" + skillname(work) + "を任せた。", "You let " + name(cc) + " work on " + skillname(work) + ".")
	if (work == sId_geneEngineering) {
		cInitialX(cc) = gPcXInWorldMap
		cInitialY(cc) = gPcYInWorldMap
		cCurrentMap(cc) = 4 // North Tyris
	} else {
		cInitialX(cc) = cX(cc)
		cInitialY(cc) = cY(cc)
		cCurrentMap(cc) = gCurrentMap
	}
	ocdata(80, cc) = (gCurrentDungeonLevel + 1) * (-1)
	ocdata(104, cc) = work
	cTimeToRestore(cc) = getgametime() + csetwork(2, rtval)
	snd 64
	return
*label_1717
	dim csetwork, 3, 12
	// 制作系
	csetwork(0, 0) = 7, 177, 1
	csetwork(0, 1) = 7, 185, 1
	csetwork(0, 2) = 7, 178, 1
	csetwork(0, 3) = 7, 179, 1
	csetwork(0, 4) = 7, 176, 1
	csetwork(0, 5) = 7, 184, 1
	// 採取系
	csetwork(0, 6) = 103, 180, 24
	csetwork(0, 7) = 5, 163, 24
	csetwork(0, 8) = 12, 160, 72
	csetwork(0, 9) = 14, 300, 24
	csetwork(0, 10) = 7, 159, 24
	csetwork(0, 11) = 39, 180, 24
	csetwork(0, 12) = 31 /* ranch */, sId_geneEngineering, 0
	return
*label_1718
	repeat 15, 1
		if (cState(cnt) != 1 & cState(cnt) != 9) {
			continue
		}
		if (ocdata(104, cnt) == 0) {
			continue
		}
		if (getgametime() <= cTimeToRestore(cnt)) {
			continue
		}
		craftitem = 0
		if (ocdata(104, cnt) == 178) {
			craftitem = 127
		} else {
			if (ocdata(104, cnt) == 179) {
				craftitem = 393
			} else {
				if (ocdata(104, cnt) == 177) {
					craftitem = 160
				} else {
					if (ocdata(104, cnt) == 176) {
						craftitem = 161
					}
				}
			}
		}
		if (craftitem) {
			inv_find craftitem, cnt
			if (stat == (-1)) {
				continue
			}
			prodtype = iFunction(stat)
			listmax = 0
			creator = cnt
			cc = creator
			gosub *label_1719
			repeat getgametime() - cTimeToRestore(creator)
				if (inv_getspace(creator) == 0) {
					break
				}
				if (rnd(15)) {
					continue
				}
				olistmax = 0
				repeat listmax
					matid = list(0, cnt), list(1, cnt)
					gosub *label_0521
					if (prodcheck(creator) == (-1)) {
						continue
					}
					olist(olistmax) = matid
					olistmax++
				loop
				if (olistmax == 0) {
					break
				}
				prodid = olist(rnd(olistmax))
				matid = prodid
				gosub *label_0521
				matexp = 0
				repeat 6
					j = matneed(cnt * 2), matneed(cnt * 2 + 1)
					if (j == (-1)) {
						break
					}
					mat(j) -= j(1)
					matexp += j(1) * matref(1, j)
				loop
				fixlv = 2
				if (rnd(600 + matval(1) * 2) < sdata(matval, creator) + 20) {
					fixlv = 4
				}
				if (rnd(300 + matval(1) * 2) < sdata(matval, creator) + 20) {
					fixlv = 3
				}
				flt calcobjlv(sdata(matval, creator)), calcfixlv(fixlv)
				itemcreate creator, prodid, -1, -1, 0
				item_stack creator, ci
				r1 = matval
				r2 = matexp
				cc = creator
				gosub *label_0679
			loop
			cTimeToRestore(creator) = getgametime() + 1
		}
	loop
	return
*label_1719
	if (prodtype != 5) {
		repeat maxitemid
			matid = cnt
			gosub *label_0521
			if (stat == (-1)) {
				continue
			}
			if (prodtype == 2) {
				if (matval != 178) {
					continue
				}
			}
			if (prodtype == 1) {
				if (matval != 176) {
					continue
				}
			}
			if (prodtype == 3) {
				if (matval != 179) {
					continue
				}
			}
			if (prodtype == 4) {
				if (matval != 177) {
					continue
				}
			}
			if (sdata(matval, cc) + 3 < matval(1)) {
				continue
			}
			listn(0, listmax) = "" + prodcheck(cc)
			list(0, listmax) = cnt, 0
			listmax++
		loop
		repeat 55, 10000
			matid = cnt
			gosub *label_0521
			if (stat == (-1)) {
				continue
			}
			if (prodtype == 2) {
				if (matval != 178) {
					continue
				}
			}
			if (prodtype == 1) {
				if (matval != 176) {
					continue
				}
			}
			if (prodtype == 3) {
				if (matval != 179) {
					continue
				}
			}
			if (prodtype == 4) {
				if (matval != 177) {
					continue
				}
			}
			if (sdata(matval, cc) + 3 < matval(1)) {
				continue
			}
			listn(0, listmax) = "" + prodcheck(cc)
			list(0, listmax) = cnt, 0
			listmax++
		loop
	} else {
			// 異世界生産なら、別のマテリアル生産メニューを用意する
			// 異世界マテリアル
			repeat 100, 100000
				matid = cnt
				gosub *label_0521_another
				if (stat == (-1)) {
					continue
				}
				listn(0, listmax) = ""
				list(0, listmax) = cnt, 0
				listmax++
			loop
			repeat usernpcmax, 1000000
				matid = cnt
				// 設定されてないならスキップ
				if (usernpcmatval(0, matid - 1000000) == 0 | usernpcmatneed(0, matid - 1000000) == (-1)) {
					continue
				}
				// 信仰が同じではないならスキップ
				if (usernpcmatfaith(matid - 1000000) != "" & godcheck(cc) != usernpcmatfaith(matid - 1000000)) {
					continue
				}
				gosub *label_0521_cnpc
				if (stat == (-1)) {
					continue
				}
				listn(0, listmax) = ""
				list(0, listmax) = cnt, 0
				listmax++
			loop
			repeat useritemmax, 2000000
				matid = cnt
				// 設定されてないならスキップ
				if (useritemmatval(0, matid - 2000000) == 0 | useritemmatneed(0, matid - 2000000) == (-1)) {
					continue
				}
				// 信仰が同じでないならスキップ
				if (useritemmatfaith(matid - 2000000) != "" & godcheck(cc) != useritemmatfaith(matid - 2000000)) {
					continue
				}
				gosub *label_0521_citem
				if (stat == (-1)) {
					continue
				}
				listn(0, listmax) = ""
				list(0, listmax) = cnt, 0
				listmax++
			loop
	}
	return



#deffunc resetfaction int __jjj, int __kkk
	if (strlen(faction(__jjj)) == 0) {
		if (__jjj != 0) {
			dbid = cId(__jjj)
			if (cId(__jjj) != 343) {
				dbmode = 16
				dbspec = 8
				gosub *label_2067
				racefaction = refstr
			} else {
				racefaction = userdatan(4, cCnpcId(__jjj))
			}
			notfound = 1
			repeat length2(csetfamily) - 1, 1
				if (instr(racefaction, 0, "/" + csetfamily(0, cnt) + "/") != (-1)) {
					sreplace racefaction, racefaction, "/" + csetfamily(0, cnt) + "/", "/family," + csetfamily(0, cnt) + "/"
					notfound = 0
				}
			loop
			if (notfound) {
				racefaction += "/family," + csetfamily(0, 0) + "/"
			}
			faction(__jjj) = racefaction
			if (findfaction(__jjj, "family", "god")) {
				addfaction __jjj, "align,lawful"
			} else {
				if (cId(__jjj) == 164 | cId(__jjj) == 246 | cId(__jjj) == 332) {
					addfaction __jjj, "align,chaotic"
				} else {
					if (__kkk == 0) {
						if (cId(__jjj) != 343) {
							characreate 56, dbid, -3, 0
							relationinit = cRelationship(56)
							chara_vanquish 56
						} else {
							relationinit = userdata(4, cCnpcId(__jjj))
						}
					} else {
						relationinit = cRelationship(__jjj)
					}
					if (relationinit != (-3)) {
						addfaction __jjj, "align,neutral"
					} else {
						addfaction __jjj, "align,chaotic"
					}
				}
			}
			if (dbid >= 288 & dbid <= 290) {
				addfaction __jjj, "guild,mage"
			} else {
				if (dbid >= 292 & dbid <= 294) {
					addfaction __jjj, "guild,thieve"
				} else {
					if (dbid == 295 | dbid == 291 | dbid == 297) {
						addfaction __jjj, "guild,fighter"
					}
				}
			}
			natureinit __jjj
			refreshfaction __jjj
			if (dbid == 182) {
				addfaction __jjj, "angel"
			}
			if (dbid == 317) {
				addfaction __jjj, "family,man"
			}
		} else {
			addfaction __jjj, "align,neutral"
			if (gdata(250 + 13) != 0) {
				addfaction __jjj, "guild,mage"
			} else {
				if (gdata(250 + 14) != 0) {
					addfaction __jjj, "guild,fighter"
				} else {
					if (gdata(250 + 15) != 0) {
						addfaction __jjj, "guild,thieve"
					}
				}
			}
		}
		if (__jjj != 0) {
			if (petcheck(__jjj)) {
				addfaction __jjj, "pet,0"
			}
		}
		if (cId(__jjj) == 249 | cId(__jjj) == 176) {
			addfaction __jjj, "guild,little sister"
			addfaction __jjj, "god,elder brother"
		} else {
			addfaction __jjj, "god," + godno2godid(cGod(__jjj))
		}
	} else {
		sreplace faction(__jjj), faction(__jjj), "/nature,proud/", "/nature,noble/"
		sreplace faction(__jjj), faction(__jjj), "/undead/", "/family,undead/"
		if (cRole(__jjj) == 14) {
			sreplace faction(__jjj), faction(__jjj), "/align,lawful/", "/align,neutral/"
		}
	}
	strrep faction(__jjj), "//", "/"
	if (__jjj > 15 & __jjj < 56) {
		rmfaction __jjj, "align"
		addfaction __jjj, "align,neutral"
	}
	return



#deffunc refreshfaction int __lll
	oomSEST_log "refreshfaction:Begin" + " unit_no:" + __lll
	if (__lll != 0) {
		rmfaction __lll, "medic"
		rmfaction __lll, "directhealby"
		rmfaction __lll, "areahealby"
		rmfaction __lll, "holy"
		rmfaction __lll, "removehexby"
		rmfaction __lll, "buffer"
		rmfaction __lll, "buffby"
		rmfaction __lll, "debuffer"
		rmfaction __lll, "debuffby"
		rmfaction __lll, "spellattacker"
		rmfaction __lll, "spellattackby"
		rmfaction __lll, "decoy"
		rmfaction __lll, "decoyby"
		p(58) = 0
		p(57) = 0
		p(53) = 0
		inv_getheader __lll
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (sdata(150, __lll) != 0 & sdata(165, __lll) != 0) {
				if (iId(cnt) == 550) {
					if (readablecheck(__lll, cnt)) {
						if (findfaction(__lll, "directhealby", str(iId(cnt) + 7 * 10000)) == 0) {
							addfaction __lll, "directhealby," + (iId(cnt) + 7 * 10000)
						}
						p(58) = 1
					}
					continue
				} else {
					if (iId(cnt) == 252 | iId(cnt) == 548) {
						if (readablecheck(__lll, cnt)) {
							if (findfaction(__lll, "areahealby", str(iId(cnt) + 7 * 10000)) == 0) {
								addfaction __lll, "areahealby," + (iId(cnt) + 7 * 10000)
							}
							p(58) = 1
						}
						continue
					}
				}
			}
			if (sdata(174, __lll) != 0) {
				if (iId(cnt) == 385) {
					if (eqfaction(__lll, "holy") == 0) {
						addfaction __lll, "removehexby," + (iId(cnt) + 9 * 10000)
						addfaction __lll, "holy"
					}
					continue
				}
				if (iId(cnt) == 703) {
					if (eqfaction(__lll, "decoy") == 0) {
						addfaction __lll, "decoyby," + (iId(cnt) + 14 * 10000)
						addfaction __lll, "decoy"
					}
					continue
				}
				p(54) = refitem(iId(cnt), 9, cnt)
				if (p(54) == 56001) {
					if (findfaction(__lll, "directhealby", str(iId(cnt) + 9 * 10000)) == 0) {
						addfaction __lll, "directhealby," + (iId(cnt) + 9 * 10000)
						p(58) = 1
					}
					continue
				}
				if (p(54) == 56002) {
					if (findfaction(__lll, "spellattackby", str(iId(cnt) + 9 * 10000)) == 0) {
						addfaction __lll, "spellattackby," + (iId(cnt) + 9 * 10000)
						p(53) = 1
					}
					continue
				}
				if (p(54) == 56004) {
					if (findfaction(__lll, "debuffby", str(iId(cnt) + 9 * 10000)) == 0) {
						addfaction __lll, "debuffby," + (iId(cnt) + 9 * 10000)
						p(57) = 1
					}
					continue
				}
				if (p(54) == 56005) {
					if (eqfaction(__lll, "buffer") == 0) {
						addfaction __lll, "buffby," + (iId(cnt) + 9 * 10000)
						addfaction __lll, "buffer"
					}
					continue
				}
			}
		loop
		if (p(57)) {
			addfaction __lll, "debuffer"
		}
		if (p(53)) {
			addfaction __lll, "spellattacker"
		}
		cdataref = 211
		gosub *label_1722
		repeat cAiActNum(__lll) \ 10
			cdataref = 215 + cnt
			gosub *label_1722
		loop
		if (cAiActSubFreq(__lll) != 0) {
			repeat cAiActNum(__lll) / 10
				cdataref = 220 + cnt
				gosub *label_1722
			loop
		}
		if (p(58)) {
			addfaction __lll, "medic"
		}
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "refreshfaction:End"
	return
*label_1722
	if (cdata(cdataref, __lll) == 405) {
		if (findfaction(__lll, "directhealby", "405") == 0) {
			addfaction __lll, "directhealby," + 405
		}
		p(58) = 1
	}
	if (cdata(cdataref, __lll) == 404) {
		if (findfaction(__lll, "areahealby", "404") == 0) {
			addfaction __lll, "areahealby," + 404
		}
		p(58) = 1
	}
	if (cdata(cdataref, __lll) == 403) {
		if (findfaction(__lll, "areahealby", "403") == 0) {
			addfaction __lll, "areahealby," + 403
		}
		p(58) = 1
	}
	return
*label_1723
	dbmax = 0
	dbsum = 0
	repeat 100
		if (fishdata(0, cnt) == 0) {
			continue
		}
		i = limit(iParam4(ci) + (rnd(5) == 0) - (rnd(5) == 0), 0, 5)
		if (fishdata(1, cnt) != i) {
			continue
		}
		p(35) = fishdata(2, cnt)
		if (p(35) <= 50) {
			if (gettrait(cc, 99)) {
				p(35) *= stat * 2
			}
		}
		dblist(0, dbmax) = cnt, p(35) + dbsum
		dbsum += p(35)
		dbmax++
	loop
	fish = 1
	if (dbsum != 0) {
		exrand_rnd dbtmp, dbsum
		repeat dbmax
			if (dblist(1, cnt) > dbtmp) {
				fish = dblist(0, cnt)
				break
			}
		loop
	}
	return



#deffunc joinguild int __mmm, str __nnn
	rmfaction __mmm, "guild"
	addfaction __mmm, "guild," + __nnn
	if (__mmm == 0) {
		gdata(250 + 13) = 0
		gdata(250 + 14) = 0
		gdata(250 + 15) = 0
		_switch_val = __nnn
		if (_switch_val == "mage" | _switch_sw) {
			_switch_sw = 0
			gdata(250 + 13) = 1
			goto *label_1725
			_switch_sw++
		}
		if (_switch_val == "fighter" | _switch_sw) {
			_switch_sw = 0
			gdata(250 + 14) = 1
			goto *label_1725
			_switch_sw++
		}
		if (_switch_val == "thieve" | _switch_sw) {
			_switch_sw = 0
			gdata(250 + 15) = 1
			goto *label_1725
		}
	}
*label_1725
	throwsstpevent "JoinGuild", __mmm, "", 0
	return



#deffunc believegod int __ooo, str __ppp
	beforefaith = godcheck(__ooo)
	rmfaction __ooo, "god"
	addfaction __ooo, "god," + __ppp
	_switch_val = __ppp
	if (_switch_val == "mani" | _switch_sw) {
		_switch_sw = 0
		cGod(__ooo) = 1
		goto *label_1727
		_switch_sw++
	}
	if (_switch_val == "lulwy" | _switch_sw) {
		_switch_sw = 0
		cGod(__ooo) = 2
		goto *label_1727
		_switch_sw++
	}
	if (_switch_val == "itzpalt" | _switch_sw) {
		_switch_sw = 0
		cGod(__ooo) = 3
		goto *label_1727
		_switch_sw++
	}
	if (_switch_val == "ehekatl" | _switch_sw) {
		_switch_sw = 0
		cGod(__ooo) = 4
		goto *label_1727
		_switch_sw++
	}
	if (_switch_val == "opatos" | _switch_sw) {
		_switch_sw = 0
		cGod(__ooo) = 5
		goto *label_1727
		_switch_sw++
	}
	if (_switch_val == "jure" | _switch_sw) {
		_switch_sw = 0
		cGod(__ooo) = 6
		goto *label_1727
		_switch_sw++
	}
	if (_switch_val == "kumiromi" | _switch_sw) {
		_switch_sw = 0
		cGod(__ooo) = 7
		goto *label_1727
	}
	cGod(__ooo) = 0
*label_1727
	// cPietyPoint(__ooo) = 0
	if (__ooo == 0) {
		throwsstpevent "BelieveGod", 0, "", 0
	}
	return
*label_1728
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = 0
	cs_bk = -1
	sdim naturevalues, 3
	getfactionvalues tc, "nature", naturevalues
	repeat stat
		s = getfactionlabel(naturen, naturevalues(cnt))
		list(0, listmax) = listmax
		listn(0, listmax) = s
		listmax++
	loop
	windowshadow = 1
*label_1729
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1730
	redraw 0
	s = lang("現在の性格", "Nature"), lang("決定 [リロール]  ", "Enter [Reroll] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("性格", "Nature"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	if (key == key_enter) {
		snd 103
		rmfaction tc, "nature"
		natureinit tc
		goto *label_1728
	}
	cursor_check
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1729
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1729
		}
	}
	if (key == key_cancel) {
		return -1
	}
	goto *label_1730


*god_consumePCPietyByMiracle
	cPrayingPoint(cc) = 0
	cPietyPoint(cc) = cPietyPoint(cc) * 55 / 100
	repeat 20
		ospact(100 + cnt) = 0
	loop
	ospact(272) = 0
	ospact(275) = 0
	autosave = 1 * (gCurrentMap != 35)
	if (cfg_noautosave > 2 & gettrait(0, 190) == 0) {
		autosave = 0
	}
	return


*label_1732
	cw2 = find_eq(cc, 10006)
	if (cw2 != (-1)) {
		if (encfindspec(cw2, 34) == 0) {
			cw2 = -1
		}
	}
	return cw2
*label_1733
	cw2 = find_eq(cc, 10006)
	if (cw2 != (-1)) {
		f = 0
		repeat 15
			if (iEnchantmentId(cw2, cnt) == 0) {
				break
			}
			if (iEnchantmentId(cw2, cnt) / 10000 == 7) {
				f = 1
				break
			}
		loop
		if (f == 0) {
			cw2 = -1
		}
	}
	return cw2
*label_1734
	if (cContinuousActionTurn(cc) > 0) {
		actionsp cc, 5 + rnd(5)
		if (stat == 0) {
			txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
			rowactend cc
			return
		}
		if (rnd(5) == 0) {
			txtef 9
			if (jp) {
				txt cc, "*シュッシュ*", "「くっ…」", "「あっ」", "「はぁはぁ！」", "「ふぅふぅ」"
			} else {
				txt cc, cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("come on!")
			}
		}
		return
	}
	if (jp) {
		txt -1, "あなたは満足した。", "あなたは爽快な気分になった。", "あなたは自己嫌悪に陥った。", "あなたは最低だ。", "あなたは冷静さを取り戻した。"
	} else {
		txt -1, "You feel satisfied.", "You feel an exhilarating rush.", "You feel disgusted with yourself.", "You feel awful.", "You regain your composure."
	}
	iParam1(cContinuousActionItem(cc)) += 1
	addbuff cc, 12, 2500, 120
	animeload 11, cc
	if (ocbit(11, cc)) {
		if (gettrait(cc, 185)) {
			modstress -150
		}
	}
	return

#include "hammer.hsp"


*label_1737
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = 0
	cs_bk = -1
	inhmax = 0
	inh_ci = craftref(4)
	getinheritance inh_ci, inhlist, inhmax
	if (stat == 0) {
		txt -1, lang("部屋が一杯で出来ない。", "Your home is full.")
		return 0
	}
	base_ci = craftref(2)
	repeat inhmax
		encno = inhlist(cnt)
		val = iEnchantmentId(inh_ci, encno)
		if (iParam1(cw) <= 40) {
			p(65) = val / 10000
			if (p(65) == 0) {
				p(65) = val
			}
			if (p(65) == 53 | p(65) == 34) {
				continue
			}
			if (encref(0, p(65)) > 2 + (iParam1(cw) > 30)) {
				continue
			}
		}
		val(1) = limitmax(inv(41 + encno * 2, inh_ci), limitmax(getencplimit(val(0)) * (iEnhancement(cw) * iEnhancement(cw) + 1), 10000000))
		p(59) = 0
		encpmax = iParam1(cw) / 10 * getencplimit(val(0))
		if (iEnhancement(cw)) {
			encpmax = int(limitf(double(encpmax) * (iEnhancement(cw) * iEnhancement(cw) + 1), 1, 2000000000))
		}
		if (val / 10000 == 9) {
			encpmax = limitmax(encpmax, 999999)
			txt -1, lang("装填弾", "Your home has no empty spot.")
		}
		repeat 15
			if (iEnchantmentId(base_ci, cnt) == 0) {
				break
			}
			if (iEnchantmentId(base_ci, cnt) == val(0)) {
				if (inv(41 + cnt * 2, base_ci) + val(1) > encpmax) {
					p(59) = 1
					val(1) = encpmax - inv(41 + cnt * 2, base_ci)
					if (val(1) <= 0) {
						p(59) = 2
					}
				}
				break
			}
		loop
		if (p(59) == 2) {
			continue
		}
		val(2) = 0, refitem(iId(inh_ci), 5, inh_ci)
		strict = 1
		gosub *label_0297
		strict = 0
		list(0, listmax) = val(0), val(1)
		listn(0, listmax) = cnven(s)
		if (p(59) == 1) {
			listn(0, listmax) += lang("(上限オーバー)", "(Over limit)")
		}
		listmax++
	loop
	if (listmax == 0) {
		list(0, listmax) = -1
		listn(0, listmax) = lang("継承効果なし", "No inherited effects.")
		listmax++
	}
	windowshadow = 1
*label_1738
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1739
	redraw 0
	s = lang("継承されるエンチャント", "Inherited enchantments"), lang("決定 [開始]  ", "Enter [Start] ") + strhint2 + strhint3b
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("継承効果", "Inherited effects"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	if (key == key_enter) {
		if (i == (-1)) {
			return 0
		}
		repeat listmax
			fusionlist(0, cnt) = list(0, cnt)
			fusionlist(1, cnt) = list(1, cnt)
		loop
		fusionlistmax = listmax
		return 1
	}
	cursor_check
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1738
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1738
		}
	}
	if (key == key_cancel) {
		return 0
	}
	goto *label_1739
*label_1740
	fread = 0
	userGodId = usergodmax
	txt -1, lang("どのファイルから神を作成する？", "Create custom god from which file?")
	redraw 1
	fileext = "txt"
	filedsc = "Custom God Text"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if (stat == 0) {
		return
	}
	txtfile = refstr
	exist txtfile
	usergoddata(1, userGodId) = strsize
	sdim txtbuff, strsize + 1
	bload txtfile, txtbuff
	if (instr(txtbuff, 0, "%Elona Custom God") == (-1)) {
		txt -1, "Invalid File. Aborting."
		return
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\god1.t", 1, 3
		zWrite usergoddata(0, userGodId), hgz, length(usergoddata) * 4
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\god1.t", 0
		zRead usergoddata(0, userGodId), hgz, length(usergoddata) * 4
		zClose hgz
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\god2.t", 1, 3
		zWrite txtbuff, hgz, usergoddata(1, userGodId)
		zClose hgz
	} else {
		zOpen hgz, exedir + "user\\god2.t", 0
		zRead txtbuff, hgz, usergoddata(1, userGodId)
		zClose hgz
	}
	if (fread == 0) {
		zOpen hgz, exedir + "user\\god3.t", 1, 3
		if (stat == 0) {
			zWrite usergodskilldata(0, userGodId), hgz, length(usergodskilldata) * 4
			zClose hgz
		}
	} else {
		zOpen hgz, exedir + "user\\god3.t", 0
		if (stat == 0) {
			zRead usergodskilldata(0, userGodId), hgz, length(usergodskilldata) * 4
			zClose hgz
		}
	}
	s = getnpctxt_nc("name.", "unknown,unknown")
	csvstr2 s, s
	cnv_filestr s
	if (instr(s, 0, "_tmp_") != (-1)) {
		dialog "The name contains an invalid word \"_tmp_\""
		return
	}
	if (peek(s) >= 65 & peek(s) <= 90 | peek(s) == 95 | (peek(s) >= 97 & peek(s) <= 122)) {
	} else {
		dialog "The first letter of the name must be alphabetic."
		return
	}
	if (strlen(s) >= 64 | strlen(s(1)) >= 64) {
		dialog "The name is too long."
		return
	}
	godnamet = s
	txt -1, lang("神より贈られるNPCは？", "Use which NPC as part fo god's gift?")
	comctrl = 0
	gosub *label_1332
	if (stat == 0) {
		return
	}
	servantt = refstr
	txt -1, lang("神より贈られる宝物は？", "Use which secret treasure as part of god's gift?")
	gosub *label_1633
	if (stat == 0) {
		return
	}
	gemt = refstr
	txt -1, lang("神より贈られるアーティファクトは？", "Use which artifact as part of god's gift?")
	gosub *label_1633
	if (stat == 0) {
		return
	}
	artifactt = refstr
	brancht = ""
	dialog lang("願いで降臨させる？", "Allow god to be summoned va wish?"), 2
	if (stat == 6) {
		txt -1, lang("降臨するNPCは？", "Use which NPC?")
		comctrl = 0
		gosub *label_1332
		if (stat == 0) {
			return
		}
		brancht = refstr
	}
	groundt = ""
	dialog lang("聖地を同梱する？", "Include sacred ground?"), 2
	if (stat == 6) {
		txt -1, lang("どのファイルを同梱する？", "Include which file?")
		redraw 1
		fileext = "eum"
		filedsc = "showroom file"
		_fdialog fileext, 16, filedsc, exedir + "user", ""
		if (stat == 0) {
			return 0
		}
		groundt = refstr
	}
	zipinit2 exedir + "user\\", godnamet + ".god"
	zipadd2 "god1.t"
	zipadd2 "god2.t"
	zipadd2 "god3.t"
	bcopy exedir + "user\\" + servantt + ".npc", exedir + "user\\servant.t"
	zipadd2 "servant.t"
	bcopy exedir + "user\\" + gemt + ".item", exedir + "user\\gem.t"
	zipadd2 "gem.t"
	bcopy exedir + "user\\" + artifactt + ".item", exedir + "user\\artifact.t"
	zipadd2 "artifact.t"
	if (brancht != "") {
		bcopy exedir + "user\\" + brancht + ".npc", exedir + "user\\branch.t"
		zipadd2 "branch.t"
	}
	if (groundt != "") {
		bcopy groundt, exedir + "user\\ground.t"
		zipadd2 "ground.t"
	}
	zipend2
	q = godnamet
	gosub *custom_loadCgods
	gosub *custom_loadCnpcs
	repeat 5480
		if (inv(34, cnt)) {
			getunid4item cnt
		}
	loop
	repeat gNumberOfExistingQuests
		if (qdata(0, cnt) == 0) {
			continue
		}
		if (qdata(3, cnt) == 1008 | qdata(3, cnt) == 1010 & qdata(12, cnt) == 343) {
			getunid4job cnt
		}
	loop
	gosub *custom_loadCitems
	repeat 5480
		if (iId(cnt) == 743) {
			getitemid cnt
		}
		checkalter cnt
	loop
	txt -1, lang("カスタムゴッドを作成した！", "Successfully created a custom god!")
	flt
	itemcreate -1, 172, cX(0), cY(0), 0
	iOwnState(ci) = 1
	iParam1(ci) = 0
	iParam2(ci) = findgodid(q)
	iParam3(ci) = creategoduid(iParam2(ci))
	repeat 5480
		if (iId(cnt) == 743) {
			getitemid cnt
		}
		checkalter cnt
	loop
	gosub *custom_cleanUpTemporaryFiles
	gosub *label_1336
	gosub *label_1635
	return



*custom_loadCgods
	// Get the list of all "*.god" files under "user" directory.
	usergodmax = 0
	getuserfiledata "god", usergodmax
	oomSEST_log "[Custom God] " + usergodmax + " cgods detected."
	if (usergodmax > custom_upperLimitOfNumCgods) {
		usergodmax = custom_upperLimitOfNumCgods
		oomSEST_log "[Custom God] The upper limit of the number of cgods is " + usergodmax + ". The rest won't be loaded."
	}

	dim usergoddata, 58, usergodmax + 1
	dim usergoddatam, 20, usergodmax + 1
	sdim usergoddatan, 40, 40, usergodmax + 1
	sdim usergodtxt, 80 * 1000, usergodmax + 1
	sdim usergoddatanm, 40, 10, usergodmax + 1
	dim usergodskilldata, 10, usergodmax + 1
	sdim usergodskilldatan, 40, 10, usergodmax + 1

	sdim untaglistgod

	ogdata(61) = 0

	tg = 0
	repeat usergodmax
		oomSEST_log "[Custom God] Load: dir=" + userfilelist(1, cnt) + ", file=" + userfilelist(0, cnt)
		cnt2 = cnt

		// Extracts inner files from the god archive.
		unzip2 userfilelist(1, cnt2), userfilelist(0, cnt2)

		/*******************************************
		* SECTION: Load the god definition itself. *
		*******************************************/
		oomSEST_log "[Custom God] Load god definition."

		// Uncompresses and loads "god1.t" on `usergoddata` (metadata).
		zOpen hgz, userfilelist(1, cnt2) + "god1.t", 0
		zRead usergoddata(0, tg), hgz, length(usergoddata) * 4
		zClose hgz

		// Uncompresses and loads "god3.t" on `usergodskilldata` (metadata).
		zOpen hgz, userfilelist(1, cnt2) + "god3.t", 0
		if (stat == 0) {
				zRead usergodskilldata(0, tg), hgz, length(usergodskilldata) * 4
				zClose hgz
		}

		// Uncompresses and loads "god2.t" on `txtbuff` (definition).
		sdim txtbuff, usergoddata(1, tg) + 1
		zOpen hgz, userfilelist(1, cnt2) + "god2.t", 0
		zRead txtbuff, hgz, usergoddata(1, tg)
		zClose hgz

		// "name."
		// {english name},{japanese name}
		// {english name} is also used as the inner ID.
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		cgodId(tg) = s
		cgodName(tg) = s(jp)

		// Duplicate check
		s = userfilelist(0, cnt)
		cgodFilename(tg) = s
		if (instr(untaglistgod, 0, "/" + cgodId(tg) + "/") != (-1)) {
			usergodmax--
			if (instr(s, 0, "_tmp_") == (-1)) {
				msgtemp += lang("同名の神は読み込まれない。", "A god of the same name has already been defined.") + "(skipped:" + cgodId(tg) + "," + s + ") "
			}
			cleanuserdir userfilelist(1, cnt2)
			continue
		}

		// Adds the god to the list of the loaded gods.
		untaglistgod += "/" + cgodId(tg) + "/"
		if (instr(s, 0, "_tmp_") != (-1)) {
			ogdata(61)++
		}

		// "shortname."
		// {english short name},{japanese short name}
		// {english short name} is also used as the inner short ID.
		s = getnpctxt_nc("shortname.", cgodId(tg) + "," + cgodName(tg))
		csvstr2 s, s
		cgodShortId(tg) = s
		cgodShortName(tg) = s(jp)

		// "filter."
		// Note: it is never used so far.
		cgodFilter(tg) = getnpctxt_nc("filter.", "")

		// "author." and "author_en."
		// Note: it is never used so far.
		// JP
		//   "author" is "太郎". "author_en" is "John".
		//     "太郎"
		//   "author" is "太郎". "author_en" is not defined.
		//     "太郎"
		//   "author" is not defined. "author_en" is "John".
		//     "John"
		//   "author" is not defined. "author_en" is not defined.
		//     "プレイヤー"
		//
		// EN
		//   "author" is "太郎". "author_en" is "John".
		//     "John"
		//   "author" is "太郎". "author_en" is not defined.
		//     "太郎"
		//   "author" is not defined. "author_en" is "John".
		//     "John"
		//   "author" is not defined. "author_en" is not defined.
		//     "a player"
		if (jp) {
			cgodAuthor(tg) = getnpctxt_nc("author_en.", "プレイヤー")
			cgodAuthor(tg) = getnpctxt_nc("author.", cgodAuthor(tg))
		} else {
			cgodAuthor(tg) = getnpctxt_nc("author.", "a player")
			cgodAuthor(tg) = getnpctxt_nc("author_en.", cgodAuthor(tg))
		}

		// "give."
		// {favor1},{favor2},...,{favor10}
		// {favorN} is an item id, category, or subcategory.
		// The default value, 204, is corpses.
		s = getnpctxt_nc("give.", "204")
		sdim godgivet, 6, 10
		csvstr2 godgivet, s
		repeat 10
			if (godgivet(cnt) == "") {
				break
			}
			cgodFavor(tg, cnt) = int(godgivet(cnt))
		loop

		// "bonus."
		// {bonus1},{bonus2},...,{bonus10}
		// {bonusN} is {xxxyyyy}, where the upper 3 digits is a skill id, and the lower 4 digits is the bonus rank.
		s = getnpctxt_nc("bonus.", "")
		sdim godbonust, 7, 10
		csvstr2 godbonust, s
		repeat 10
			if (godbonust(cnt) == "") {
				break
			}
			p = int(godbonust(cnt))
			cgodBonusAbility(tg, cnt) = p / 10000
			cgodBonusRank(tg, cnt) = p \ 10000
		loop

		// "specialpower."
		// {effect_id},{effect_power}
		s = getnpctxt_nc("specialpower.", "0,0")
		csvstr2 s, s
		sid = int(s)
		// Some bit flags cannot be dealt from user side.
		if (sid == 2016 | sid == 2023 | sid == 2024 | sid == 2027) {
			sid = 0
		}
		cgodSpecialPowerId(tg) = sid
		cgodSpecialPowerPower(tg) = s(1)

		// "foodbonus."
		// {foodbonus1},{foodbonus2},...,{foodbonus8}
		// {foodbonusN} is {xxxyy}, where the upper 3 digits is a skill id, and the lower 2 digits is the bonus rank.
		s = getnpctxt_nc("foodbonus.", "")
		sdim foodbonust, 4, 10
		csvstr2 foodbonust, s
		repeat 8
			if (foodbonust(cnt) == "") {
				break
			}
			cgodFoodBonus(tg, cnt) = int(foodbonust(cnt))
		loop

		// "specialfoodbonus."
		// {specialfoodbonus1},{specialfoodbonus2},...,{specialfoodbonus8}
		// {specialfoodbonusN} is {xxxyyyy}, where the upper 3 digits is a skill id, and the lower 4 digits is the bonus rank.
		s = getnpctxt_nc("specialfoodbonus.", "")
		sdim spfoodbonust, 6, 10
		csvstr2 spfoodbonust, s
		repeat 8
			if (spfoodbonust(cnt) == "") {
				break
			}
			cgodSpecialFoodBonus(tg, cnt) = int(spfoodbonust(cnt))
		loop

		// Miracles; a cgod can have up to 2 miracles.
		repeat 2
			// "miracleN.", where N is 0 or 1.
			s = getnpctxt_nc("miracle" + cnt + ".", "")
			if (s == "") {
				break
			}
			sdim godmiraclet, 40, 12
			csvstr2 godmiraclet, s
			cgodMiracleNameEn(tg, cnt) = godmiraclet(0)
			cgodMiracleNameJp(tg, cnt) = godmiraclet(1)
			cgodMiracleRelatedBasicAttribute(tg, cnt) = int(godmiraclet(2))
			cgodMiracleType(tg, cnt) = int(godmiraclet(3))
			cgodMiracleCost(tg, cnt) = int(godmiraclet(4))
			cgodMiracleRange(tg, cnt) = int(godmiraclet(5))
			cgodMiraclePower(tg, cnt) = godmiraclet(6)
			cgodMiracleDiceX(tg, cnt) = godmiraclet(7)
			cgodMiracleDiceY(tg, cnt) = godmiraclet(8)
			cgodMiracleDamageBonus(tg, cnt) = godmiraclet(9)
			cgodMiracleElement(tg, cnt) = godmiraclet(10)
			cgodMiracleElementPower(tg, cnt) = godmiraclet(11)
		loop

		// NC追加
		// スキル
		s = getnpctxt_nc("skill.", "")
		if (s != "") {
			sdim godskilllet, 12
			csvstr2 godskilllet, s
			cgodSkillNameEn(tg) = godskilllet(0)
			cgodSkillNameJp(tg) = godskilllet(1)
			cgodSkillRelatedBasicAttribute(tg) = int(godskilllet(2))
			cgodSkillType(tg) = int(godskilllet(3))
			cgodSkillCost(tg) = int(godskilllet(4))
			cgodSkillRange(tg) = int(godskilllet(5))
			cgodSkillPower(tg) = godskilllet(6)
			cgodSkillDiceX(tg) = godskilllet(7)
			cgodSkillDiceY(tg) = godskilllet(8)
			cgodSkillDamageBonus(tg) = godskilllet(9)
			cgodSkillElement(tg) = godskilllet(10)
			cgodSkillElementPower(tg) = godskilllet(11)
		}

		// 従属神設定
		usergoddatanm(0, tg) = getnpctxt_nc("domain.", "eyth")

		// "specialpoweralias."
		// Allow 2 form: oo style and mma style.
		s = getnpctxt_nc("specialpoweralias.", "")
		p = instr(s, 0, ",")
		if (p == -1) {
			// OO style. e.g., specialpoweralias. "うみみゃあ!!"
			cgodSpecialPowerAlias(tg) = s
		} else {
			// MMA style. e.g., specialpoweralias. "うみみゃあ!!,Mewmewmew!!"
			if (jp) {
				// First part of comma-separated values.
				cgodSpecialPowerAlias(tg) = strmid(s, 0, p)
			} else {
				// Second part of comma-separated values.
				cgodSpecialPowerAlias(tg) = strmid(s, p + 1, 999)
			}
		}
		repeat 5
			s = getnpctxt_nc("flavorfeat" + cnt + ".", ""), "", "", ""
			if ( s == "" ) {
				continue
			}
			csvstr2 s, s
			usergoddatam(cnt + 10, tg) = int(s(0))
			usergoddatam(cnt + 15, tg) = int(s(1))
			usergoddatanm(cnt + 5, tg) = lang("" + s(2), cnven("" + s(3)))
		loop
		// The dialogs of the custom god, which are separated by "%txt{dialog type}".
		p = instr(txtbuff, 0, "%txt")
		txtbuff = strmid(txtbuff, p, instr(txtbuff, 0, "%endTxt") - p + 7)
		usergodtxt(tg) = strmid(txtbuff, 0, 80 * 400 - 2)

		/*****************************
		* SECTION: Load the servant. *
		*****************************/
		oomSEST_log "[Custom God] Load servant."

		dim userdatat, 70

		// Extracts inner files from the servant archive, contained in the god archive.
		unzip2 userfilelist(1, cnt2), "servant.t"

		// Uncompresses and loads "npc1.t" on `userdatat` (metadata).
		zOpen hgz, userfilelist(1, cnt2) + "npc1.t", 0
		zRead userdatat(0), hgz, 70 * 4
		zClose hgz

		// Uncompresses and loads "npc2.t" on `txtbuff` (raw cnpc file).
		sdim txtbuff, userdatat(1) + 1
		zOpen hgz, userfilelist(1, cnt2) + "npc3.t", 0
		zRead txtbuff, hgz, userdatat(1)
		zClose hgz

		// "name."
		// {english name},{japanese name}
		// {english name} is also used as the inner ID.
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		cgodServantId(tg) = s

		// Copies "servant.t" as "{cnpc id}.npc" file to prevent the file from being removed after loading cgod.
		exist userfilelist(1, cnt2) + cgodServantId(tg) + ".npc"
		if (strsize == (-1)) {
			bcopy userfilelist(1, cnt2) + "servant.t", userfilelist(1, cnt2) + cgodServantId(tg) + ".npc"
		}

		/****************************************
		* SECTION: Load the second reward item. *
		****************************************/
		oomSEST_log "[Custom God] Load second reward item."

		dim useritemdatat, 70

		// Extracts inner files from the second reward item archive, contained in the god archive.
		unzip2 userfilelist(1, cnt2), "gem.t"

		// Uncompresses and loads "item1.t" on `useritemdatat` (metadata).
		zOpen hgz, userfilelist(1, cnt2) + "item1.t", 0
		zRead useritemdatat(0), hgz, 70 * 4
		zClose hgz

		// Uncompresses and loads "item3.t" on `txtbuff` (raw citem file).
		sdim txtbuff, useritemdatat(1) + 1
		zOpen hgz, userfilelist(1, cnt2) + "item3.t", 0
		zRead txtbuff, hgz, useritemdatat(1)
		zClose hgz

		// "name."
		// {english name},{japanese name}
		// {english name} is also used as the inner ID.
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		cgodGiftId1(tg) = s

		// Copies "gem.t" as "{citem id}.item" file to prevent the file from being removed after loading cgod.
		exist userfilelist(1, cnt2) + cgodGiftId1(tg) + ".item"
		if (strsize == (-1)) {
			bcopy userfilelist(1, cnt2) + "gem.t", userfilelist(1, cnt2) + cgodGiftId1(tg) + ".item"
		}

		/***************************************
		* SECTION: Load the final reward item. *
		***************************************/
		oomSEST_log "[Custom God] Load final reward item."

		dim useritemdatat, 70

		// Extracts inner files from the final reward item archive, contained in the god archive.
		unzip2 userfilelist(1, cnt2), "artifact.t"

		// Uncompresses and loads "item1.t" on `useritemdatat` (metadata).
		// It overwrites the previous "item1.t", i.e., the second reward item, but does not matter.
		zOpen hgz, userfilelist(1, cnt2) + "item1.t", 0
		zRead useritemdatat(0), hgz, 70 * 4
		zClose hgz

		// Uncompresses and loads "item3.t" on `txtbuff` (raw citem file).
		// It overwrites the previous "item3.t", i.e., the second reward item, but does not matter.
		sdim txtbuff, useritemdatat(1) + 1
		zOpen hgz, userfilelist(1, cnt2) + "item3.t", 0
		zRead txtbuff, hgz, useritemdatat(1)
		zClose hgz

		// "name."
		// {english name},{japanese name}
		// {english name} is also used as the inner ID.
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		cgodGiftId2(tg) = s

		// Copies "artifact.t" as "{citem id}.item" file to prevent the file from being removed after loading cgod.
		exist userfilelist(1, cnt2) + cgodGiftId2(tg) + ".item"
		if (strsize == (-1)) {
			bcopy userfilelist(1, cnt2) + "artifact.t", userfilelist(1, cnt2) + cgodGiftId2(tg) + ".item"
		}

		/*******************************************
		* SECTION: Load the god as NPC. (optional) *
		*******************************************/

		exist userfilelist(1, cnt2) + "branch.t"
		if (strsize != (-1)) {
			oomSEST_log "[Custom God] Load god npc."
			dim userdatat, 70

			// Extracts inner files from the god NPC archive, contained in the god archive.
			unzip2 userfilelist(1, cnt2), "branch.t"

			// Uncompresses and loads "npc1.t" on `userdatat` (metadata).
			// It overwrites the previous "npc1.t", i.e., the servant, but does not matter.
			zOpen hgz, userfilelist(1, cnt2) + "npc1.t", 0
			zRead userdatat(0), hgz, 70 * 4
			zClose hgz

			// Uncompresses and loads "npc3.t" on `txtbuff` (raw cnpc file).
			// It overwrites the previous "npc3.t", i.e., the servant, but does not matter.
			sdim txtbuff, userdatat(1) + 1
			zOpen hgz, userfilelist(1, cnt2) + "npc3.t", 0
			zRead txtbuff, hgz, userdatat(1)
			zClose hgz

			// "name."
			// {english name},{japanese name}
			// {english name} is also used as the inner ID.
			s = getnpctxt_nc("name.", "unknown,unknown")
			csvstr2 s, s
			cgodGodNpcId(tg) = s

			// Copies "branch.t" as "{cnpc id}.npc" file to prevent the file from being removed after loading cgod.
			exist userfilelist(1, cnt2) + cgodGodNpcId(tg) + ".npc"
			if (strsize == (-1)) {
				bcopy userfilelist(1, cnt2) + "branch.t", userfilelist(1, cnt2) + cgodGodNpcId(tg) + ".npc"
			}
		} else {
			cgodGodNpcId(tg) = ""
		}

		/****************************************************
		* SECTION: Load the god's sacred ground. (optional) *
		****************************************************/

		exist userfilelist(1, cnt2) + "ground.t"
		if (strsize != (-1)) {
			oomSEST_log "[Custom God] Load sacred ground."
			// Loads the head part of "ground.t" on `headtemp`, which contains the map name at the first line.
			sdim headtemp, 1024
			bload userfilelist(1, cnt2) + "ground.t", headtemp, 1024
			notesel headtemp
			noteget s, 0

			// Copies "ground.t" as "{map name}.eum" file to prevent the file from being removed after loading cgod.
			exist userfilelist(1, cnt2) + s + ".eum"
			if (strsize == (-1)) {
				bcopy userfilelist(1, cnt2) + "ground.t", userfilelist(1, cnt2) + s + ".eum"
			}
			noteunsel
		}

		// Clean up the temporary files(*.t) to load the cgod.
		cleanuserdir userfilelist(1, cnt2)
		tg++
		notesel buff
	loop

	// Defines null god for fallback.
	cgodId(usergodmax) = ""
	cgodName(usergodmax) = lang("残りカス", "garbage")
	cgodShortId(usergodmax) = "eyth"
	cgodShortName(usergodmax) = ""
	cgodFilter(usergodmax) = ""

	// Cleans up all temporary files used to load cgods.
	// TODO: is it really neccessary?
	gosub *custom_cleanUpTemporaryFiles
	return



#deffunc txtcgod int __qqq, int __rrr
	sstptalkn0 = sstptalkn
	sstptalkn = ""
	notesel buff
	buff = "" + usergodtxt(__qqq)
	_switch_val = __rrr
	if (_switch_val == 5) {
		sline = "%txtBelieve"
		goto *label_1743
	}
	if (_switch_val == 1) {
		sline = "%txtBetrayal"
		goto *label_1743
	}
	if (_switch_val == 4) {
		sline = "%txtGive"
		goto *label_1743
	}
	if (_switch_val == 2) {
		sline = "%txtMission"
		goto *label_1743
	}
	if (_switch_val == 3) {
		sline = "%txtResist"
		goto *label_1743
	}
	if (_switch_val == 6) {
		sline = "%txtPresent"
		goto *label_1743
	}
	if (_switch_val == 7) {
		sline = "%txtLike"
		goto *label_1743
	}
	if (_switch_val == 8) {
		sline = "%txtLove"
		goto *label_1743
	}
	if (_switch_val == 12) {
		sline = "%txtWhisper"
		goto *label_1743
	}
	if (_switch_val == 11) {
		sline = "%txtWelcome"
		goto *label_1743
	}
	if (_switch_val == 10) {
		sline = "%txtNight"
		goto *label_1743
	}
	if (_switch_val == 9) {
		sline = "%txtKilled"
		goto *label_1743
	}
	if (_switch_val == 14) {
		sline = "%txtMiracle1"
		goto *label_1743
	}
	if (_switch_val == 15) {
		sline = "%txtMiracle2"
		goto *label_1743
	}
	if (_switch_val == 16) {
		sline = "%txtAdvent"
		goto *label_1743
	}
	if (_switch_val == 17) {
		sline = "%txtServantDescription"
		goto *label_1743
	}
	// NC
	if (_switch_val == 20) {
		sline = "%txtSkill"
		goto *label_1743
	}
	if (_switch_val == 22) {
		sline = "%txtRepatriate"
		goto *label_1743
	}
	// NC(MMAadd)
	if ( _switch_val == 2401 | _switch_sw ) {
		sline = "%txtAdventOther"
		goto *label_1743
	}
	if ( _switch_val == 2402 | _switch_sw ) {
		sline = "%txtAdventDomain"
		goto *label_1743
	}
	if ( _switch_val == 2403 | _switch_sw ) {
		sline = "%txtFaithDream"
		goto *label_1743
	}
	if ( _switch_val == 2404 | _switch_sw ) {
		sline = "%txtFaithScroll"
		goto *label_1743
	}
	if ( _switch_val == 2405 | _switch_sw ) {
		sline = "%txtBlessedFaithScroll"
		goto *label_1743
	}
	if ( _switch_val == 2406 | _switch_sw ) {
		sline = "%txtCursedFaithScroll"
		goto *label_1743
	}
	if ( _switch_val == 2407 | _switch_sw ) {
		sline = "%txtDead"
		goto *label_1743
	}
	if ( _switch_val == 2408 | _switch_sw ) {
		sline = "%txtPray"
		goto *label_1743
	}
	if ( _switch_val == 2409 | _switch_sw ) {
		sline = "%txtPrayFailed"
		goto *label_1743
	}
	if ( _switch_val == 2410 | _switch_sw ) {
		sline = "%txtOffer"
		goto *label_1743
	}
	if ( _switch_val == 2411 | _switch_sw ) {
		sline = "%txtOfferShine"
		goto *label_1743
	}
	if ( _switch_val == 2412 | _switch_sw ) {
		sline = "%txtOfferThreeLeaved"
		goto *label_1743
	}
	if ( _switch_val == 2413 | _switch_sw ) {
		sline = "%txtServantDescription"
		goto *label_1743
	}
	if ( _switch_val == 2414 | _switch_sw ) {
		sline = "%txtWish"
		goto *label_1743
	}
	if ( _switch_val == 2415 | _switch_sw ) {
		sline = "%txtWished"
		goto *label_1743
	}
	if ( _switch_val == 2416 | _switch_sw ) {
		sline = "%txtWishedGodinside"
		goto *label_1743
	}
	if ( _switch_val == 2417 | _switch_sw ) {
		sline = "%txtWishedManinside"
		goto *label_1743
	}
	if ( _switch_val == 2418 | _switch_sw ) {
		sline = "%txtWishedYouth"
		goto *label_1743
	}
	if ( _switch_val == 2419 | _switch_sw ) {
		sline = "%txtWishedAka"
		goto *label_1743
	}
	if ( _switch_val == 2420 | _switch_sw ) {
		sline = "%txtWishedAkaLaugh"
		goto *label_1743
	}
	if ( _switch_val == 2421 | _switch_sw ) {
		sline = "%txtWishedAkaWaste"
		goto *label_1743
	}
	if ( _switch_val == 2422 | _switch_sw ) {
		sline = "%txtWishedSex"
		goto *label_1743
	}
	if ( _switch_val == 2423 | _switch_sw ) {
		sline = "%txtWishedAtonement"
		goto *label_1743
	}
	if ( _switch_val == 2424 | _switch_sw ) {
		sline = "%txtWishedAtonementWaste"
		goto *label_1743
	}
	if ( _switch_val == 2425 | _switch_sw ) {
		sline = "%txtWishedDeath"
		goto *label_1743
	}
	if ( _switch_val == 2426 | _switch_sw ) {
		sline = "%txtWishedSoldout"
		goto *label_1743
	}
	if ( _switch_val == 2427 | _switch_sw ) {
		sline = "%txtWishedAbsence"
		goto *label_1743
	}
	if ( _switch_val == 2428 | _switch_sw ) {
		sline = "%txtPrayHungry"
		goto *label_1743
	}
	if ( _switch_val == 2429 | _switch_sw ) {
		sline = "%txtAreaChanged" + gdata(20)
		goto *label_1743
	}
	if ( _switch_val == 2430 | _switch_sw ) {
		sline = "%txtAreaChanged"
		goto *label_1743
	}
	if ( _switch_val == 2431 | _switch_sw ) {
		sline = "%txtMapChanged"
		goto *label_1743
	}
	if ( _switch_val == 2432 | _switch_sw ) {
		sline = "%txtHour"
		goto *label_1743
	}
	if ( _switch_val == 2433 | _switch_sw ) {
		sline = "%txtWeaversFestival"
		goto *label_1743
	}
	if ( _switch_val == 2434 | _switch_sw ) {
		sline = "%txtAwake"
		goto *label_1743
	}
	// NCEND
	enemygod = ""
	faithitem = 0
	return 0
*label_1743
	hajime = -1
	if (enemygod != "") {
		talktxt = iftxtsearch(buff, 0, sline + "_" + enemygod, 0, 0, 0)
		if (talktxt != "") {
			hajime = instr(buff, 0, talktxt)
		}
	}
	if (hajime == (-1) & faithitem > 0) {
		talktxt = iftxtsearch(buff, 0, sline + "_" + faithitem, 0, 0, 0)
		if (talktxt != "") {
			hajime = instr(buff, 0, talktxt)
		}
	}
	if (hajime == (-1)) {
		talktxt = iftxtsearch(buff, 0, sline, 0, 0, 0)
		if (talktxt != "") {
			hajime = instr(buff, 0, talktxt)
		}
	}
	enemygod = ""
	faithitem = 0
	if (hajime != (-1)) {
		buff = strmid(buff, hajime, instr(buff, hajime + 1, "%"))
		notedel 0
		if (noteinfo(0) > 0) {
			noteget serifutxt, rnd(noteinfo(0))
			buff = serifutxt
			if (buff != "" & buff != "default") {
				isgodtalk = 1
				convert_word buff, 0, 0
				isgodtalk = 0
				parsesstptalk buff, sstptalk, 0
				if (cfg_NC_sstp_enabled != 0 & (cfg_NC_sstp_sakura == 1 | cfg_NC_sstp_unyu == 1)) {
					throwsstptalk sstptalkn0, sstptalk, 1
				}
				if (cfg_NC_sstp_enabled == 0 | (cfg_NC_sstp_sakura != 1 & cfg_NC_sstp_unyu != 1) | cfg_NC_sstp_suppresslog == 0) {
					tcolbk = tcol@txtfunc(0), tcol@txtfunc(1), tcol@txtfunc(2)
					tcolfixbk = tcolfix@txtfunc
					split buff, "|", splitbuff
					repeat stat
						tcol@txtfunc = tcolbk(0), tcolbk(1), tcolbk(2)
						tcolfix@txtfunc = tcolfixbk
						p = instr(splitbuff(cnt), 0, "["), instr(splitbuff(cnt), p, "]"), strlen(splitbuff(cnt))
						if (p != (-1)) {
							s = strmid(splitbuff(cnt), p + 1, p(1) - 1)
							csvstr2 s, s
							tcol@txtfunc = int(s(0)), int(s(1)), int(s(2))
							tcolfix@txtfunc = 1
							splitbuff(cnt) = strmid(splitbuff(cnt), p + p(1) + 1, p(2) - p(1) - p)
						}
						if (__rrr == 17) {
							txt -1, splitbuff(cnt)
						} else {
							if (__qqq == findcgodno("danalin") & __rrr == 16) {
								txtef 9
								txt -1, splitbuff(cnt)
							} else {
								txt -1, lang("「", "\"") + splitbuff(cnt) + lang("」", "\"")
							}
						}
					loop
				}
				noteunsel
				return 1
			}
		}
	}
	if (buff == "") {
		noteunsel
		return 1
	}
	noteunsel
	return 0
*label_1744
	if (cc == 0) {
		snd 25
	}
	item_separate ci
	s = itemname(ci)
	if (iParam1(ci) != 10000) {
		p = rnd(sdata(184, cc) + 6) + rnd(iParam1(cooktool) / 50 + 1)
		if (p > sdata(184, cc) / 5 + 7) {
			p = sdata(184, cc) / 5 + 7
		}
	} else {
		p = rnd((sdata(184, cc) / 5) + 1) + rnd(iParam1(cooktool) / 100 + 1)
		if (p > sdata(184, cc) / 10 + 7) {
			p = sdata(184, cc) / 10 + 7
		}
	}
	p = rnd(p + 1)
	if (p > 3) {
		p = rnd(p)
	}
	if (sdata(184, cc) >= 5) {
		if (p < 3) {
			if (rnd(4) == 0) {
				p = 3
			}
		}
	}
	if (sdata(184, cc) >= 10) {
		if (p < 3) {
			if (rnd(3) == 0) {
				p = 3
			}
		}
	}
	p += iParam1(cooktool) / 100
	if (p > 9) {
		p = 9
	}
	if (p < 1) {
		p = 1
	}
	make_dish ci, p
	if (cc == 0) {
		txt -1, lang(itemname(cooktool) + "で" + s + "を料理して、" + itemname(ci, 1) + "を作った。", "You cook " + s + " with " + itemname(cooktool, 1) + " and make " + itemname(ci, 1) + ".")
	}
	throwsstpevent "Cooking", 0, itemname(ci), inv(3, ci), inv(25, ci) / 1000, inv(26, ci)
	ctalk cc, 1336, cc, cc
	r1 = iParam2(ci)
	item_autostack cc, ci
	if (r1 > 2) {
		skillexp2 184, cc, 30 + r1 * 5
	}
	return
*label_1745
	animeload 8, cc
	cImage(cc) = cContinuousActionItem(cc)
	cContinuousActionItem(cc) = 0
	cun = cCnpcId(cc)
	cAiCalm(cc) = limit(userdata(7, cun), 1, 5)
	cAiMove(cc) = limit(userdata(8, cun), 0, 100)
	cAiDist(cc) = limit(userdata(9, cun), 1, 100)
	cAiActSubFreq(cc) = unaiactsubfreq(cun)
	cAiHeal(cc) = userdata(10, cun)
	repeat 5
		cdata(215 + cnt, cc) = userdata(15 + cnt, cun)
		cdata(220 + cnt, cc) = userdata(20 + cnt, cun)
	loop
	cDamageReactionInfo(cc) = 0
	cElementOfUnarmedAttack(cc) = limit(userdata(11, cun), 50 * 100000, 64 * 100000)
	memcpy cdata(450, cc), userdata(40, cun), 30 * 4
	cAiActNum(cc) = 55
	cContinuousActionId(cc) = 0
	cContinuousActionTurn(cc) = 0
	r1 = cc
	gosub *chara_refresh
	return
*label_1746
	txtnew
	txt -1, lang("あなたの神に力を借りる？", "Really ask for power from your God?")
	promptl(0, 0) = strno, "n", "0"
	promptl(0, 1) = stryes, "y", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *label_1353
	return rtval



#defcfunc medicalcheck int __sss
	if (eqfaction(__sss, "medic")) {
		p(58) = 0
		sdim medicalvalues, 8
		targetfaction = "directhealby"
		gosub *label_1748
		targetfaction = "areahealby"
		gosub *label_1748
		return p(58)
	}
	return 0
*label_1748
	if (p(58)) {
		return
	}
	getfactionvalues __sss, targetfaction, medicalvalues
	repeat stat
		p(74) = int(medicalvalues(cnt))
		if (p(74) >= 10000) {
			inv_find p(74) \ 10000, __sss
			if (stat != (-1)) {
				p(73) = stat
				if (ibit(4, p(73))) {
					if (iCount(p(73)) > 0) {
						if (p(74) / 10000 == 7) {
							if (cMp(__sss) >= cMaxMp(__sss) / 4) {
								p(58) = 1
								break
							}
						} else {
							if (p(74) / 10000 == 9) {
								p(58) = 1
								break
							}
						}
					}
				}
			}
		} else {
			if (cMp(__sss) >= cMaxMp(__sss) / 4) {
				p(58) = 1
				break
			}
		}
	loop
	return
*label_1749
	sdim medicalvalues, 8
	p(58) = 0
	if (ocdata(161, cc) >= 2) {
		goto *label_1752
	}
	goto *label_1751
*label_1750
	unwatcheson cc
	goto *label_1617
*label_1751
	getfactionvalues cc, "directhealby", medicalvalues
	if (stat != 0) {
		p(74) = int(medicalvalues(rnd(stat)))
		efid = 0
		if (p(74) >= 10000) {
			inv_find p(74) \ 10000, cc
			if (stat != (-1)) {
				ci = stat
				if (p(74) / 10000 == 9) {
					if (iCount(ci) > 0) {
						if (distance > 1) {
							goto *label_1770
						}
						goto *label_1424
					}
				}
				if (p(74) / 10000 == 7) {
					if (readablecheck(cc, ci)) {
						efid = stat
						bookmagic = ci
						item_separate ci
					}
				}
			}
		} else {
			efid = p(74)
		}
		if (efid >= 400) {
			if (distance > 1) {
				goto *label_1770
			}
			gosub *label_1773
			if (stat == 1) {
				goto *label_1617
			} else {
				if (stat == 2) {
					goto *label_1424
				}
			}
		}
	}
	if (p(58) == 0) {
		p(58) = 1
		goto *label_1752
	}
	goto *label_1750
*label_1752
	getfactionvalues cc, "areahealby", medicalvalues
	if (stat != 0) {
		p(74) = int(medicalvalues(rnd(stat)))
		efid = 0
		if (p(74) >= 10000) {
			inv_find p(74) \ 10000, cc
			if (stat != (-1)) {
				ci = stat
				if (p(74) / 10000 == 7) {
					if (readablecheck(cc, ci)) {
						efid = stat
						bookmagic = ci
						item_separate ci
					}
				}
			}
		} else {
			efid = p(74)
		}
		if (efid >= 400) {
			if (distance > 2) {
				goto *label_1770
			}
			gosub *label_1773
			if (stat == 1) {
				goto *label_1617
			} else {
				if (stat == 2) {
					goto *label_1424
				}
			}
		}
	}
	if (p(58) == 0) {
		p(58) = 1
		goto *label_1751
	}
	goto *label_1750
*label_1753
	sdim exsoundlist, 30, 10
	exsoundlist(0) = "machine"
	exsoundlist(1) = "shot"
	exsoundlist(2) = "long_sword"
	exsoundlist(3) = "short_sword"
	exsoundlist(4) = "axe"
	exsoundlist(5) = "blunt"
	exsoundlist(6) = "polearm"
	exsoundlist(7) = "stave"
	exsoundlist(8) = "scythe"
	exsoundlist(9) = "crossbow"
	return
*label_1754
	s(1) = ""
	income = 0
	repeat 15, 1
		cnt2 = cnt
		if (cState(cnt2) != 1 & cState(cnt2) != 9) {
			continue
		}
		if (ocdata(104, cnt2) != 0) {
			cc = cnt2
			gosub *label_1755
			gosub *label_1756
		}
		if (getgametime() <= cTimeToRestore(cnt2)) {
			continue
		}
		if (ocdata(104, cnt2) == 163) {
			if (itemfind(cnt2, 93) == (-1)) {
				continue
			}
			s = lang("[炭鉱]" + cdatan(0, cnt2) + "は", "[Mining]" + cdatan(0, cnt2) + " struck and ")
			olist = 14
			olistmax = 1
			i = 1
			p(48) = 7
			gosub *label_1757
		} else {
			if (ocdata(104, cnt2) == 300) {
				if (itemfind(cnt2, 636) == (-1)) {
					continue
				}
				s = lang("[スリ]" + cdatan(0, cnt2) + "は", "[Pickpocket]" + cdatan(0, cnt2) + " stole and ")
				olist = 18
				olistmax = 1
				i = 0
				p(48) = 9
				gosub *label_1757
			} else {
				if (ocdata(104, cnt2) == 160) {
					p = day_trading(cnt2)
					se_moneymod cnt2, p / 2
					income += p / 2
					if (s(1) != "") {
						s(1) += "と"
					}
					s(1) += cdatan(0, cnt2)
					cTimeToRestore(cnt2) = getgametime() + csetwork(2, 8)
				} else {
					if (ocdata(104, cnt2) == 159) {
						if (areaId(cCurrentMap(cnt2)) == 7) {
							continue
						}
						s = lang("[探索]" + cdatan(0, cnt2) + "は", "[Searching]" + cdatan(0, cnt2) + " found and ")
						olist = 13, 15, 16
						olistmax = 3
						i = 5
						p(48) = 10
						gosub *label_1757
					}
				}
			}
		}
	loop
	if (income) {
		invfile = 4
		file = "shoptmp.s2"
		ctrlFile 4
		file = "shop" + 4 + ".s2"
		tmpload "" + file
		exist exedir + "tmp\\" + file
		if (strsize != (-1)) {
			ctrlFile 3
		} else {
			inv_getheader -1
			repeat invrange, invhead
				iNumber(cnt) = 0
			loop
		}
		mode = 6
		itemcreate -1, 54, -1, -1, income
		snd 24
		txtef 5
		txt -1, lang("[蕪式]" + s(1) + "は蕪を売却した。" + income + "goldが売上として振り込まれた。", "[Investing]" + s(1) + " has sold turlips as part of day trading, depositing your share of " + income + " gold pieces to your house.")
		file = "shop" + invfile + ".s2"
		ctrlFile 4
		file = "shoptmp.s2"
		ctrlFile 3
		mode = 0
	}
	return
*label_1755
	inv_getheader cc
	sell = 0, 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		a = refitem(iId(cnt), 5, cnt)
		if (a == 77000) {
			p = iValue(cnt) * iNumber(cnt)
			sell += iNumber(cnt)
			sell(1) += p
			iNumber(cnt) = 0
			se_moneymod cc, p
		}
	loop
	if (sell != 0) {
		txtef 9
		txt -1, lang(cdatan(0, cc) + "は" + sell + "個のアイテムを売りさばき" + sell(1) + "goldを稼いだ。", cdatan(0, cc) + " sells " + sell + " items and earns " + sell(1) + " gold pieces.")
		repeat
			skillexp2 156, cc, limit(int(sqrt(sell(1))), 10, 100)
			sell(1) -= 10000
			if (sell(1) < 1) {
				break
			}
		loop
	}
	return
*label_1756
	if (sorg(156, cc) == 0) {
		correctionvalue = 0
	} else {
		correctionvalue = 50 + sdata(156, cc)
		if (correctionvalue > 300) {
			correctionvalue = 300
		}
	}
	if (cGold(cc) >= cLevel(cc) * 500 * 100 / (100 + correctionvalue)) {
		snd 61
		txtef 9
		if (mapType == 3 & cCurrentMap(cc) == 0 | areaType(cCurrentMap(cc)) == 3) {
			txt -1, lang(cdatan(0, cc) + "は訓練所に通い潜在能力を伸ばした！", cdatan(0, cc) + " visits a trainer and develops " + his(cc) + " potential!")
		} else {
			txt -1, lang(cdatan(0, cc) + "は通信教育で潜在能力を伸ばした！", cdatan(0, cc) + " takes lessons online and develops " + his(cc) + " potential!")
		}
		olistmax = 0
		inv_getheader cc
		repeat invrange, invhead
			if (iNumber(cnt) == 0) {
				continue
			}
			if (iId(cnt) == 563) {
				olist(olistmax) = iParam1(cnt)
				olistmax++
			}
		loop
		repeat 4
			f = 0
			if (olistmax) {
				p = olist(rnd(olistmax))
				if (rnd(16) == 0) {
					f = 1
				}
				if (sorg(p, cc) == 0 | sdata(600 + p, cc) \ 1000 == 400) {
					f = 0
				}
			}
			if (f != 1) {
				repeat 2000
					if (rnd(4) == 0) {
						p = rnd(18 - 10) + 10
					} else {
						p = rnd(400 - 100) + 100
					}
					if (sorg(p, cc) == 0 | sdata(600 + p, cc) \ 1000 == 400) {
						p = 0
						continue
					}
					break
				loop
			}
			if (p != 0) {
				p(40) = 15 * (100 + calctraitgrowthrate(cc, p)) / 100
				modgrowth cc, p, limit(p(40) - sorgEx(p, cc) / 5, 4, p(40))
				cGold(cc) -= cLevel(cc) * 125 * 100 / (100 + correctionvalue)
				skillexp2 156, cc, 2
			}
		loop
		if (p == 0) {
			txtef 9
			txt -1, lang(cdatan(0, cc) + "にはこれ以上伸ばせる潜在能力はないようだ", cdatan(0, cc) + " can't develop " + his(cc) + " potential anymore.")
		}
		r1 = cc
		gosub *chara_refresh
	} else {
		if (rnd(5) == 0) {
			if (mapType == 3 & cCurrentMap(cc) == 0 | areaType(cCurrentMap(cc)) == 3) {
				txtef 9
				ctalk cc, 418, cc, cc
			}
		}
	}
	return
*label_1757
	snd 24
	txtef 4
	txt -1, s
	wrokskillevel = sdata(csetwork(1, p(48)), cnt2)
	p(99) = limit(1 + rnd(wrokskillevel / 15 + 1), 1, 6) + (guildcheck(0) == "thieve") * (101 - gdata(128) / 100) / 20
	repeat p(99)
		atxspot = olist(rnd(olistmax))
		matgetmain random_material(atxspot, (wrokskillevel / 5) + 1), limit(1 + rnd(wrokskillevel / 15 + 1), 1, 12), i
	loop
	skillexp2 csetwork(1, p(48)), cnt2, p(99) * 100
	cTimeToRestore(cnt2) = getgametime() + csetwork(2, p(48))
	return
*label_1758
	olistmax = 0
	repeat 16
		if (cState(cnt) == 1) {
			olist(olistmax) = cnt
			olistmax++
		}
	loop
	charakind = olist(rnd(olistmax))
	dbid = -2
	initlv = objlv + rnd(5)
	nospartifact = 1
	return
*label_1759
	if (cdata(25, rc) != 6 & adata(16, gdata(20)) != 3 & adata(16, gdata(20)) != 9 & adata(16, gdata(20)) != 16 & adata(16, gdata(20)) != 17 & adata(16, gdata(20)) != 18 & adata(16, gdata(20)) != 19 & adata(16, gdata(20)) != 27 & adata(16, gdata(20)) != 37 & gdata(20) != 35) {
		if (gettrait(0, 104) != 0) {
			if (findfaction(rc, "family", "wild")) {
				cdata(9, rc) = 10
				cdata(69, rc) = 10
			}
		}
	}
	if (oabit(10, gCurrentMap)) {
		cRelationship(rc) = -1
		cOriginalRelationship(rc) = -1
		if (godcheck(rc) == "eyth") {
			if (fixgod != "") {
				believegod rc, fixgod
			} else {
				if (cId(rc) == 347) {
					believegod rc, "jure"
				} else {
					believegod rc, creategodid()
				}
			}
		}
		if (godcheck(rc) != "eyth") {
			if (boss) {
				modpiety sdata(181, rc) * 100, rc
			} else {
				modpiety limitmax(200, sdata(181, rc) * 100), rc
				cdatan(0, rc) = godshortname(godcheck(rc)) + lang("の狂信者", " fanatic")
			}
		}
	} else {
		if (oabit(11, gCurrentMap)) {
			if (boss) {
				if (jp) {
					if (getfactionvalue(gCurrentMap - 450 + 245, "race") != "") {
						dbidn = cdatan(2, rc)
						dbmode = 2
						gosub *label_1525
						cdatan(0, rc) = racename + "の首領『" + randomname() + "』"
					}
				}
			}
		} else {
			if (oabit(3, gCurrentMap)) {
				if (boss) {
					cRelationship(rc) = -3
					cOriginalRelationship(rc) = -3
				}
			}
		}
	}
	if (oabit(17, gCurrentMap) | oabit(18, gCurrentMap)) {
		ocdata(101, rc) = 128
		ocdata(102, rc) = -1
		cdatan(0, rc) = "《" + cdatan(0, rc) + "の幻影》"
	}
	return
*label_1760
	if (cContinuousActionTurn(cc) > 0) {
		if (rnd(5) == 0) {
			snd 57
			txtef 4
			txt -1, lang(" *ゴシゴシ* ", "*scrub*"), lang(" *ザー* ", "*splash*")
		}
		return
	}
	txt -1, lang(name(cc) + "の魅力は復活した。", name(cc) + your(cc) + " charisma is restored.")
	if (cdata(247, cc) < 0) {
		cdata(247, cc) = 0
	}
	r1 = cc
	gosub *chara_refresh
	return
*label_1761
	p(1) = sdata(180, 0)
	olistmax = 0
	repeat 15, 1
		if (cState(cnt) != 1) {
			continue
		}
		if (ocdata(104, cnt) == 180) {
			olist(olistmax) = cnt
			olistmax++
		}
	loop
	repeat olistmax
		p(1) += sdata(180, olist(cnt)) / 2
	loop
	return
*label_1762
	allyctrl = 7
	gosub *ui_selectAlly
	if (stat != (-1)) {
		rc = stat
		noupgrade = 0
		if (cId(rc) == 262) {
			noupgrade = 1
		} else {
			if (cbit(16, rc)) {
				repeat 10
					gosub *label_1767
					if (stat) {
						continue
					}
					if (cdata(215 + cnt, rc) == 454) {
						noupgrade = 1
						break
					}
				loop
			}
		}
		if (noupgrade) {
			buff = lang("それは無理" + _da(), "It's impossible.")
			goto *label_1476
		}
		goto *label_1763
	} else {
		buff = lang("冷やかし" + _ka(1), "You kidding? ")
	}
	goto *label_1476
*label_1763
	tcbk = tc
	menucycle = 0
	olistmax = 0
	gosub *label_1764
	gosub *label_1465
	if (olistmax != 1) {
		goto *label_1762
	}
	listmax = 0
	buff = lang(thousandsep(str(calcactupgradevalue(rc) * 2 / 3)) + strgold + "かかるけどいい" + _kana(1), "This will cost you " + thousandsep(str(calcactupgradevalue(rc))) + strgold + ". Is that okay?")
	if (cGold(0) >= calcactupgradevalue(rc) * 2 / 3 | ncgdata(50) > 0) {
		list(0, listmax) = 1
		listn(0, listmax) = lang("アップグレードする", "Upgrade.")
		listmax++
	}
	list(0, listmax) = 0
	listn(0, listmax) = lang("やめる", "Never mind.")
	listmax++
	chatesc = 1
	gosub *label_1487
	if (chatval == 1) {
		snd 12
		cGold(0) -= (calcactupgradevalue(rc) * 2 / 3)
		gosub *label_N200
		if (cAiHeal(rc) == olist(0, 0)) {
			cAiHeal(rc) = olist(1, 0)
		}
		repeat 10
			gosub *label_1767
			if (stat) {
				continue
			}
			if (cdata(215 + cnt, rc) == olist(0, 0)) {
				cdata(215 + cnt, rc) = olist(1, 0)
			}
		loop
		if (olist(0, 0) == (-1) & olist(1, 0) == (-2)) {
			if (cAiDist(rc) == 1) {
				cAiDist(rc) = 2
			}
		} else {
			if (olist(0, 0) == (-2) & olist(1, 0) == (-1)) {
				if (cAiDist(rc) >= 2) {
					cAiDist(rc) = 1
				}
			}
		}
		ocbitmod 0, rc, 1
		buff = lang("アップグレードは完了し" + _ta(), "Upgrade complete.")
	} else {
		buff = lang("訓練が必要なときは、声をかけて" + _kure(), "Come see me again when you need more training.")
	}
	goto *label_1476
*label_1764
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = 0
	cs_bk = -1
	actupgradecheck guildcheck(0), 211, rc
	repeat 10
		gosub *label_1767
		if (stat) {
			continue
		}
		actupgradecheck guildcheck(0), 215 + cnt, rc
	loop
	windowshadow = 1
*label_1765
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1766
	redraw 0
	s = lang("アップグレード一覧", "Upgrade list"), lang("決定 [アップグレード]  ", "Enter [Upgrade] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("行動", "Actions"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = pagesize * page + cnt
			break
		}
	loop
	if (p != (-1)) {
		olist(0, 0) = list(0, p), list(1, p)
		olistmax = 1
		screenupdate = -1
		gosub *label_0623
		tc = tcbk
		return
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1765
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1765
		}
	}
	if (key == key_cancel) {
		screenupdate = -1
		gosub *label_0623
		tc = tcbk
		return
	}
	goto *label_1766
*label_1767
	if (cnt < 5) {
		if (cAiActNum(rc) \ 10 <= cnt) {
			return 1
		}
	} else {
		if (cAiActNum(rc) / 10 <= cnt - 5) {
			return 1
		}
	}
	return 0



#defcfunc calcactupgradevalue int __ttt
	return int(powf(limit(cLevel(__ttt), 1, 1000), 2)) * 10



#deffunc actupgradecheck str __uuu, int __vvv, int __www
	actlistmax = 0
	if (__uuu == "fighter") {
		if (cdata(__vvv, __www) == (-1)) {
			p(actlistmax) = -2
			actlistmax++
		}
		if (cdata(__vvv, __www) == (-2)) {
			p(actlistmax) = -1
			actlistmax++
		}
	} else {
		if (__uuu == "mage") {
			actlistmax = 0
			if (cdata(__vvv, __www) == 414 | cdata(__vvv, __www) == 415 | cdata(__vvv, __www) == 416 | cdata(__vvv, __www) == 417 | cdata(__vvv, __www) == 418) {
				p(actlistmax) = 459
				actlistmax++
			}
			if (cdata(__vvv, __www) == 431 | cdata(__vvv, __www) == 432 | cdata(__vvv, __www) == 433 | cdata(__vvv, __www) == 434) {
				p(actlistmax) = 460
				actlistmax++
			}
			if (cdata(__vvv, __www) == 404) {
				p(actlistmax) = 403
				actlistmax++
			}
			if (cdata(__vvv, __www) == 400 | cdata(__vvv, __www) == 401) {
				p(actlistmax) = 402
				actlistmax++
			}
		} else {
			if (__uuu == "thieve") {
				if (cdata(__vvv, __www) == 601 | cdata(__vvv, __www) == (-1) | cdata(__vvv, __www) == 615 | cdata(__vvv, __www) == 618 | cdata(__vvv, __www) == 635 | cdata(__vvv, __www) == (-2) | cdata(__vvv, __www) == 602 | cdata(__vvv, __www) == (-9998)) {
					p(actlistmax) = 601
					actlistmax++
					p(actlistmax) = 615
					actlistmax++
					p(actlistmax) = 618
					actlistmax++
					p(actlistmax) = 635
					actlistmax++
					p(actlistmax) = -9998
					actlistmax++
					p(actlistmax) = 602
					actlistmax++
				}
			}
		}
	}
	if (actlistmax != 0) {
		p(50) = cdata(__vvv, __www)
		repeat actlistmax
			p(51) = p(cnt)
			if (p(50) == p(51)) {
				continue
			}
			if (actupgradelistcheck(p(50), p(51))) {
				continue
			}
			list(0, listmax) = p(50), p(51)
			listn(0, listmax) = lang(skillnameref(p(50)) + "を" + skillnameref(p(51)) + "にアップグレード", "Upgraded " + skillnameref(p(50)) + " to " + skillnameref(p(51)) + ".")
			listmax++
		loop
	}
	return
*label_1770
	ahead = 1
	goto *label_1567
*label_1771
	if (iParam2(cw) < calcexpalive(iParam1(cw))) {
		exp = rnd(exp / iParam1(cw) + 1)
		if (ibit(18, cw)) {
			if (iCurseState(cw) >= 1) {
				exp = 0
			} else {
				if (iCurseState(cw) <= (-2)) {
					exp = exp * (2 + (getrelation(cc) == (-3)))
				}
			}
		}
		iParam2(cw) += exp
		if (iParam2(cw) >= calcexpalive(iParam1(cw))) {
			txtef 2
			snd 61
			txt -1, lang(itemname(cw) + "は十分に血を味わった！", itemname(cw) + " has tasted enough blood!")
		}
	}
	return
*label_1772
	if (ogdata(27) == (-1)) {
		rc = 0
		repeat 40 - 1, 16
			if (ocdata(100, cnt) != 20000) {
				continue
			}
			if (cbit(969, cnt)) {
				continue
			}
			if (cState(cnt) != 3) {
				continue
			}
			rc = cnt
			break
		loop
		if (rc) {
			cState(rc) = 1
			cCurrentMap(rc) = gCurrentMap
			cCurrentDungeonLevel(rc) = gCurrentDungeonLevel
			cRelationship(rc) = 0
			cOriginalRelationship(rc) = 0
			cHate(rc) = 0
			cbitmod 984, rc, 0
			if (x != (-3)) {
				cxinit = x
				cyinit = y
				place_chara rc, cxinit, cyinit
			} else {
				cxinit = -1
				place_chara rc, cxinit, cyinit
			}
			cHp(rc) = cMaxHp(rc)
			cMp(rc) = cMaxMp(rc)
			r1 = rc
			gosub *chara_refresh
		}
	} else {
		randomize ogdata(27)
		exrand_randomize ogdata(27)
		rank = 0
		characreate -1, 363, x, y
		cRole(rc) = 20000
		randomize
		exrand_randomize
	}
	return
*label_1773
	if (cMp(cc) < cMaxMp(cc) / 4) {
		if (rnd(5)) {
			if (godcheck(cc) == "itzpalt") {
				if (cPietyPoint(cc) >= 200) {
					if (rnd(20) == 0) {
						efid = 624
						gosub *label_1396
						if (stat == 1) {
							return 1
						}
					}
				}
			}
			if (itemfind(cc, 391) != (-1)) {
				ci = stat
				if (iCount(ci) != 0) {
					tc = cc
					return 2
				}
			}
		}
	}
	caston = 1
	if (cMp(cc) < cMaxMp(cc) / 7) {
		if (cbit(988, cc)) {
			cMp(cc) += cLevel(cc) / 4 + 5
			return 1
		}
		if (rnd(30) == 0) {
			efid = 621
			gosub *label_1396
			if (stat == 1) {
				return 1
			}
		}
		if (rnd(20)) {
			caston = 0
		}
	}
	if (findbuff(cc, 2) != (-1) | oabit(0, gCurrentMap)) {
		if (rnd(20)) {
			caston = 0
		}
	}
	if (caston) {
		npccostmp = 1
		if (bookmagic) {
			r4 = 3
			gosub *label_0678
			r4 = 1
			gosub *label_0665
			r2 = sdataref(4, efid)
			ci = bookmagic
			if (iCurseState(ci) >= 1) {
				r2 = r2 * 100 / 120
			}
			if (iCurseState(ci) <= (-1)) {
				r2 = r2 * 150 / 100
			}
			if (rndex(sdata(165, cc) * sdata(sdataref(0, efid), cc) * 4 + 250) < rndex(r2 + 1)) {
				iCount(ci)--
				if (iCount(ci) < 0) {
					iCount(ci) = 0
				}
				if (iCount(ci) == 0) {
					removeitem ci, 1
					if (synccheck(cc, -1)) {
						txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
						ctalk cc, 1310, cc, cc
					}
				} else {
					item_autostack cc, ci
				}
			}
		}
		gosub *label_1388
		if (stat == 1) {
			return 1
		}
	}
	return 0
*label_1774
	dim isetfamily, 3, 17
	sdim csetfamily, 20, 3, 17
	isetfamily(0, 0) = 0
	csetfamily(0, 0) = "empty", "", ""
	isetfamily(0, 1) = 100
	csetfamily(0, 1) = "god", "神", "邪神"
	isetfamily(0, 2) = 80
	csetfamily(0, 2) = "dragon", "竜", "ドラゴン"
	isetfamily(0, 3) = 60
	csetfamily(0, 3) = "undead", "不死", "アンデッド"
	isetfamily(0, 4) = 30
	csetfamily(0, 4) = "amorphs", "不定形", "不定形生物"
	isetfamily(0, 5) = 20
	csetfamily(0, 5) = "plantoid", "植物", "危険な植物"
	isetfamily(0, 6) = 30
	csetfamily(0, 6) = "arcana", "魔法生物", "魔法生物"
	isetfamily(0, 7) = 0
	csetfamily(0, 7) = "wild", "野生動物", "凶暴な動物"
	isetfamily(0, 8) = 20
	csetfamily(0, 8) = "demi", "亜人", "亜人"
	isetfamily(0, 9) = 10
	csetfamily(0, 9) = "yeek", "イーク", "イーク"
	isetfamily(0, 10) = 10
	csetfamily(0, 10) = "goblin", "ゴブリン", "ゴブリン"
	isetfamily(0, 11) = 60
	csetfamily(0, 11) = "demon", "悪魔", "悪魔"
	isetfamily(0, 11) = 40
	csetfamily(0, 12) = "element", "精霊", "精霊"
	isetfamily(0, 13) = 30
	csetfamily(0, 13) = "mino", "ミノタウロス", "ミノタウロス"
	isetfamily(0, 14) = 50
	csetfamily(0, 14) = "man", "人", "賊"
	isetfamily(0, 15) = 30
	csetfamily(0, 15) = "gear", "機械", "捨てられた機械"
	isetfamily(0, 16) = 20
	csetfamily(0, 16) = "orc", "オーク", "オーク"
	return
*label_1775
	if (efid == 621 | efid == 622 | efid == 623 | efid == 624 | efid == 625 | efid == 626 | efid == 627 | efid == 629 | efid == 630 | efid == 631 | efid == 634 | efid == 637 | efid == 639 | efid == 640 | efid == 641 | efid == 642 | efid == 643 | efid == 644 | efid == 646 | efid == 647 | efid == 653 | efid == 656 | efid == 659 | efid == 782) {
		return 1
	}
	if (efid == 663 | efid == 664 | efid == 665 | efid == 666 | efid == 667 | efid == 668 | efid == 669 | efid == 670 | efid == 671 | efid == 672 | efid == 673) {
		return 1
	}
	if (efid == 761 | efid == 762 | efid == 763 | efid == 764 | efid == 765 | efid == 766 | efid == 767 | efid == 768 | efid == 769 | efid == 770 | efid == 771 | efid == 772 | efid == 773 | efid == 774 | efid == 775 | efid == 776 | efid == 777 | efid == 778) {
		return 1
	}
	return 0
*label_1776
	comctrl = 1
	gosub *label_1332
	if (stat == 0) {
		return
	}
	q = refstr
	gosub *custom_loadCnpcs
	initunid = findunid(q)
	txt -1, lang("ユニークモンスターを作成した！", "Successfully created a unique monster!")
	flt
	characreate -1, 343, cX(0), cY(0)
	repeat 5480
		if (inv(34, cnt)) {
			getunid4item cnt
		}
	loop
	repeat gNumberOfExistingQuests
		if (qdata(0, cnt) == 0) {
			continue
		}
		if (qdata(3, cnt) == 1008 | qdata(3, cnt) == 1010 & qdata(12, cnt) == 343) {
			getunid4job cnt
		}
	loop
	folder = exedir + "user\\"
	gosub *custom_cleanUpTemporaryFiles
	return



#deffunc collection_make int __xxx, int __yyy
	iSubname(__xxx) = cId(__yyy)
	if (iSubname(__xxx) == 343) {
		iColor(__xxx) = 825 + cCnpcId(__yyy)
		inv(33, __xxx) = cCnpcId(__yyy)
		inv(34, __xxx) = createserialno(userdatan(0, cCnpcId(__yyy)))
	} else {
		iColor(__xxx) = cImage(__yyy) \ 1000
	}
	return



#defcfunc petcheck int __zzz
	if (__zzz > 0 & __zzz < 245) {
		if (__zzz < 16 | cRole(__zzz) == 10001 | cRole(__zzz) == 10018 | eqfaction(__zzz, "petshop")) {
			return 1
		}
	}
	return 0
*label_1779
	sdim guildclassn, 30, 9, 1
	if (jp) {
		guildclassn(0, 0) = "覇者", "守護神", "精鋭", "凄腕", "守衛", "剣士", "修行者", "見習い", "新入り"
	} else {
		guildclassn(0, 0) = "Champion", "Guardian", "Elite", "Veteran", "Defender", "Warrior", "Apprentice", "Novice", "Rookie"
	}
	return
*label_1780
	weaponjasei = 0
	weaponjus = 0
	weaponalive = 0
	return
*label_1781
	userspelloptions = 0, 1, 0, 0, 0, 0, 0
	listmax = 0
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	page_bk = 0
	cs_bk2 = 0
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	screenupdate = -1
	gosub *label_0623
	windowshadow = 1
*label_1782
	listmax = 0
	q = lang("魔法の作成", "Create custom magic")
	if (jp) {
		s = "効果", "威力", "形状", "属性", "制約", "制約", "制約", ""
	} else {
		s = "Effect", "Power", "Type", "Element", "Limitation", "Limitation", "Limitation", ""
	}
	dx = 440
	dy = 400
	repeat 30
		if (s(cnt) == "") {
			f = cnt
			break
		}
		list(0, listmax) = cnt
		listn(0, listmax) = s(cnt)
		listmax++
	loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1783
	redraw 0
	pagesize = 0
	s = q, lang("左右キー [変更]  ", "Right,left [Change]  ") + strhint3b + lang("決定ｷｰ [最終確認]  ", "Enter [Confirm]  ")
	display_window (windoww - dx) / 2 + inf_screenx, winposy(dy) - 12, dx, dy
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	keyrange = 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		x = 0
		cs_list s, wx + 56 + x, wy + 66 + cnt * 19 - 1, 19, 0
		pos wx + 200, wy + 66 + cnt * 19 - 5
		gcopy 3, 312, 336, 24, 24
		pos wx + 370, wy + 66 + cnt * 19 - 5
		gcopy 3, 336, 336, 24, 24
		pos wx + 230, wy + 66 + cnt * 19
		color 0, 0, 0
		if (cnt == 0) {
			if (jp) {
				s = "-------------------", "破壊", "治癒", "知者の加護", "英雄", "聖なる盾", "加速", "元素保護", "リジェネレーション", "浄化", "ホーリーヴェイル", "元素の傷跡", "ナイトメア", "鈍足", "沈黙の霧", "脆弱の霧", "解呪"
			} else {
				s = "-------------------", "Destruction", "Healing", "Divine Wisdom", "Hero", "Holy Shield", "Speed", "Elemental Shiled", "Regeneration", "Holy Light", "Holy Veil", "Element Scar", "Nightmare", "Slow", "Mist of Silence", "Mist of Frailness", "Uncurse"
			}
			keyrange++
			mes s(userspelloptions(0))
		}
		if (cnt == 1) {
			keyrange++
			mes userspelloptions(1)
		}
		if (cnt == 2) {
			if (jp) {
				s = "-------------------", "アロー", "ボルト", "ボール", "メテオ", "自分", "任意の方向", "任意の対象", "範囲"
			} else {
				s = "-------------------", "Arrow", "Bolt", "Ball", "Meteor", "Self", "Adjacent target", "Choose target", "Area"
			}
			keyrange++
			mes s(userspelloptions(2))
		}
		if (cnt == 3) {
			if (jp) {
				s = "-------------------", "火炎", "冷気", "電撃", "暗黒", "幻惑", "毒", "地獄", "音", "神経", "混沌", "魔法", "媚薬"
			} else {
				s = "-------------------", "Fire", "Cold", "Lightning", "Darkness", "Mind", "Poison", "Nether", "Sound", "Nerve", "Chaos", "Magic", "Love potion"
			}
			keyrange++
			mes s(userspelloptions(3))
		}
		if (cnt == 4) {
			s = "-------------------"
			repeat length(spellconditionlistn)
				s(cnt + 1) = spellconditionlistn(cnt)
			loop
			keyrange++
			mes s(userspelloptions(4))
		}
		if (cnt == 5) {
			s = "-------------------"
			repeat length(spellconditionlistn)
				s(cnt + 1) = spellconditionlistn(cnt)
			loop
			keyrange++
			mes s(userspelloptions(5))
		}
		if (cnt == 6) {
			s = "-------------------"
			repeat length(spellconditionlistn)
				s(cnt + 1) = spellconditionlistn(cnt)
			loop
			keyrange++
			mes s(userspelloptions(6))
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if (p != (-1)) {
		s = ""
		if (userspelloptions(0) == 0) {
			goto *label_1783
		}
		if (jp) {
			s(1) = "破壊", "治癒", "知者の加護", "英雄", "聖なる盾", "加速", "元素保護", "リジェネレーション", "浄化", "ホーリーヴェイル", "元素の傷跡", "ナイトメア", "鈍足", "沈黙の霧", "脆弱の霧", "解呪"
		} else {
			s(1) = "Destruction", "Healing", "Divine Wisdom", "Hero", "Holy Shield", "Speed", "Elemental Shiled", "Regeneration", "Holy Light", "Holy Veil", "Element Scar", "Nightmare", "Slow", "Mist of Silence", "Mist of Frailness", "Uncurse"
		}
		s += lang("効果:", "Effect:") + s(userspelloptions(0)) + " "
		s += lang("威力:", "Power:") + userspelloptions(1) + " "
		if (userspelloptions(2) == 0) {
			goto *label_1783
		}
		if (jp) {
			s(1) = "アロー", "ボルト", "ボール", "メテオ", "自分", "任意の方向", "任意の対象", "範囲"
		} else {
			s(1) = "Arrow", "Bolt", "Ball", "Meteor", "Self", "Adjacent target", "Choose target", "Area"
		}
		s += lang("形状:", "Type:") + s(userspelloptions(2)) + " "
		if (userspelloptions(3) == 0) {
			if (userspelloptions(0) == 1) {
				goto *label_1783
			}
		}
		if (jp) {
			s(1) = "火炎", "冷気", "電撃", "暗黒", "幻惑", "毒", "地獄", "音", "神経", "混沌", "魔法", "媚薬", "酒"
		} else {
			s(1) = "Fire", "Cold", "Lightning", "Darkness", "Mind", "Poison", "Nether", "Sound", "Nerve", "Chaos", "Magic", "Love potion", "Alcohol"
		}
		s += lang("属性:", "Element:") + s(userspelloptions(3)) + " "
		repeat length(spellconditionlistn)
			s(cnt + 1) = spellconditionlistn(cnt)
		loop
		repeat 3, 4
			if (userspelloptions(cnt) != 0) {
				s += lang("制約:", "Limitation:") + s(userspelloptions(cnt)) + " "
			}
		loop
		mp = userspelloptions(1) * 12
		if (userspelloptions(0) == 1) {
			_switch_val = userspelloptions(2)
			if (_switch_val == 1) {
				mp = mp * sdataref(2, 414)
				goto *label_1784
			}
			if (_switch_val == 2) {
				mp = mp * sdataref(2, 422) / 2
				goto *label_1784
			}
			if (_switch_val == 3) {
				mp = mp * sdataref(2, 433) / 2
				goto *label_1784
			}
			if (_switch_val == 4) {
				mp = mp * sdataref(2, 465) * 3 / 5
				goto *label_1784
			}
*label_1784
			_switch_val = userspelloptions(3)
			if (_switch_val == 1 | _switch_val == 2 | _switch_val == 6 | _switch_val == 7 | _switch_val == 12) {
				mp = mp * 5 / 3
				goto *label_1785
			}
			if (_switch_val == 4 | _switch_val == 5 | _switch_val == 9 | _switch_val == 10) {
				mp = mp * 2
				goto *label_1785
			}
			if (_switch_val == 3 | _switch_val == 8) {
				mp = mp * 9 / 5
				goto *label_1785
			}
			if (_switch_val == 11) {
				mp = mp * 24 / 5
				goto *label_1785
			}
*label_1785
		} else {
			_switch_val = userspelloptions(0)
			if (_switch_val == 2) {
				mp = mp * sdataref(2, 405) * 9 / 10
				goto *label_1786
			}
			if (_switch_val == 3) {
				mp = mp * sdataref(2, 453)
				goto *label_1786
			}
			if (_switch_val == 4) {
				mp = mp * sdataref(2, 448)
				goto *label_1786
			}
			if (_switch_val == 5) {
				mp = mp * sdataref(2, 442)
				goto *label_1786
			}
			if (_switch_val == 6) {
				mp = mp * sdataref(2, 446)
				goto *label_1786
			}
			if (_switch_val == 7) {
				mp = mp * sdataref(2, 445)
				goto *label_1786
			}
			if (_switch_val == 8) {
				mp = mp * sdataref(2, 444)
				goto *label_1786
			}
			if (_switch_val == 9) {
				mp = mp * sdataref(2, 407)
				goto *label_1786
			}
			if (_switch_val == 10) {
				mp = mp * sdataref(2, 451)
				goto *label_1786
			}
			if (_switch_val == 11) {
				mp = mp * sdataref(2, 450) * 5 / 6
				goto *label_1786
			}
			if (_switch_val == 12) {
				mp = mp * sdataref(2, 452) * 5 / 6
				goto *label_1786
			}
			if (_switch_val == 13) {
				mp = mp * sdataref(2, 447) * 5 / 6
				goto *label_1786
			}
			if (_switch_val == 14) {
				mp = mp * sdataref(2, 443) * 5 / 6
				goto *label_1786
			}
			if (_switch_val == 15) {
				mp = mp * sdataref(2, 449) * 5 / 6
				goto *label_1786
			}
			if (_switch_val == 16) {
				mp = mp * sdataref(2, 412)
				goto *label_1786
			}
*label_1786
			_switch_val = userspelloptions(2)
			if (_switch_val == 6) {
				mp = mp * 10 / 9
				goto *label_1787
			}
			if (_switch_val == 7) {
				mp = mp * 6 / 5
				goto *label_1787
			}
			if (_switch_val == 8) {
				mp = mp * 2
				goto *label_1787
			}
		}
*label_1787
		mpnormal = mp
		repeat 3, 4
			if (userspelloptions(cnt) != 0) {
				mp = mp * (100 - calcuserspellfixcost(userspelloptions(cnt) - 1)) / 100
			}
		loop
		s += lang("消費MP:", "MP Usage:") + mp * (100 + 1 * 3) / 100 + " "
		if (userspelloptions(0) == 1) {
			_switch_val = userspelloptions(2)
			if (_switch_val == 1) {
				p(81) = 414
				goto *label_1788
			}
			if (_switch_val == 2) {
				p(81) = 422
				goto *label_1788
			}
			if (_switch_val == 3) {
				p(81) = 433
				goto *label_1788
			}
			if (_switch_val == 4) {
				p(81) = 465
				goto *label_1788
			}
*label_1788
		} else {
			_switch_val = userspelloptions(0)
			if (_switch_val == 2) {
				p(81) = 405
				goto *label_1789
			}
			if (_switch_val == 3) {
				p(81) = 453
				goto *label_1789
			}
			if (_switch_val == 4) {
				p(81) = 448
				goto *label_1789
			}
			if (_switch_val == 5) {
				p(81) = 442
				goto *label_1789
			}
			if (_switch_val == 6) {
				p(81) = 446
				goto *label_1789
			}
			if (_switch_val == 7) {
				p(81) = 445
				goto *label_1789
			}
			if (_switch_val == 8) {
				p(81) = 444
				goto *label_1789
			}
			if (_switch_val == 9) {
				p(81) = 407
				goto *label_1789
			}
			if (_switch_val == 10) {
				p(81) = 451
				goto *label_1789
			}
			if (_switch_val == 11) {
				p(81) = 450
				goto *label_1789
			}
			if (_switch_val == 12) {
				p(81) = 452
				goto *label_1789
			}
			if (_switch_val == 13) {
				p(81) = 447
				goto *label_1789
			}
			if (_switch_val == 14) {
				p(81) = 443
				goto *label_1789
			}
			if (_switch_val == 15) {
				p(81) = 449
				goto *label_1789
			}
			if (_switch_val == 16) {
				p(81) = 412
				goto *label_1789
			}
		}
*label_1789
		usp@00m = userspelloptions(1) * sdataref(4, p(81))
		repeat 3, 4
			if (userspelloptions(cnt) != 0) {
				usp@00m = usp@00m * (100 + calcuserspellfixcost(userspelloptions(cnt) - 1)) / 100
			}
		loop
		s += lang("最低詠唱Lv:", "Least required Casting Lvl:") + calcuserspellsuccess(usp@00m) + " "
		s += lang("この定義で魔法を作る？", "Create custom spell with these settings?")
		txtnew
		txt -1, s
		promptl(0, 0) = lang("作成する", "Create"), "y", "0"
		promptl(0, 1) = lang("やめておく", "Cancel"), "n", "1"
		promptmax = 2
		val = promptx, prompty, 180, 1
		gosub *label_1353
		if (rtval == 0) {
			if (mp * (100 + 1 * 3) / 100 > limitIntMax(cMaxMp(0) * 2)) {
				txt -1, lang("マナが足りない。", "You don't have enough mana.")
				return
			}
			txt -1, lang("この魔法を何と呼ぶ？ ", "What do you want to call this spell? ")
			val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
			inputlog = ""
			input_mode = 1
			gosub *label_1349
			if (inputlog == "") {
				return
			} else {
				userspelldatan(0, userspellmax) = "" + inputlog
				if (userspelloptions(0) == 1) {
					_switch_val = userspelloptions(2)
					if (_switch_val == 1) {
						p(81) = 414
						gosub *label_1804
						goto *label_1790
					}
					if (_switch_val == 2) {
						p(81) = 422
						gosub *label_1804
						goto *label_1790
					}
					if (_switch_val == 3) {
						p(81) = 433
						gosub *label_1804
						goto *label_1790
					}
					if (_switch_val == 4) {
						p(81) = 465
						gosub *label_1804
						goto *label_1790
					}
*label_1790
				} else {
					_switch_val = userspelloptions(0)
					if (_switch_val == 2) {
						p(81) = 405
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 3) {
						p(81) = 453
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 4) {
						p(81) = 448
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 5) {
						p(81) = 442
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 6) {
						p(81) = 446
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 7) {
						p(81) = 445
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 8) {
						p(81) = 444
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 9) {
						p(81) = 407
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 10) {
						p(81) = 451
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 11) {
						p(81) = 450
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 12) {
						p(81) = 452
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 13) {
						p(81) = 447
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 14) {
						p(81) = 443
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 15) {
						p(81) = 449
						gosub *label_1804
						goto *label_1791
					}
					if (_switch_val == 16) {
						p(81) = 412
						gosub *label_1804
						goto *label_1791
					}
				}
*label_1791
				userspelldata(2, userspellmax) = mpnormal
				userspelldata(5, userspellmax) = userspelloptions(1)
				userspelldata(12, userspellmax) = 1 * 1000000 + 100
				userspelldata(11, userspellmax) = 200 + calcuserspellcoststock(userspellmax) * 2
				olistmax = 6
				repeat 3, 4
					if (userspelloptions(cnt) != 0) {
						userspelldata(olistmax, userspellmax) = userspelloptions(cnt)
						olistmax++
					}
				loop
				resetuserspell userspellmax
				userspellmax++
				txt -1, lang("魔法を作成した！", "Successfully created a custom spell!")
				ogdata(253)--
			}
			return
		}
	}
	if (key == key_cancel) {
		return
	}
	if (key == key_pageup | key == key_pagedown) {
		if (key == key_pageup) {
			p = 1
		} else {
			p = -1
		}
		if (cs == 0) {
			userspelloptions(0) = limit(userspelloptions(0) + p, 0, 16)
			userspelloptions(2) = 0
			userspelloptions(3) = 0
			snd 20
			goto *label_1782
		}
		if (cs == 1) {
			userspelloptions(1) = limit(userspelloptions(1) + p, 1, 100)
			snd 20
			goto *label_1782
		}
		if (cs == 2) {
			if (userspelloptions(0) != 0) {
				if (userspelloptions(0) == 1) {
					userspelloptions(2) = limit(userspelloptions(2) + p, 0, 4)
				} else {
					if (p > 0) {
						if (userspelloptions(2) < 5) {
							userspelloptions(2) = 4
						}
					}
					userspelloptions(2) = limit(userspelloptions(2) + p, 4, 8)
					if (p < 0) {
						if (userspelloptions(2) < 5) {
							userspelloptions(2) = 0
						}
					}
				}
			} else {
				userspelloptions(2) = 0
			}
			snd 20
			goto *label_1782
		}
		if (cs == 3) {
			if (userspelloptions(0) == 1) {
				userspelloptions(3) = limit(userspelloptions(3) + p, 0, 12)
			} else {
				userspelloptions(3) = 0
			}
			snd 20
			goto *label_1782
		}
		if (cs == 4) {
			gosub *label_1803
			snd 20
			goto *label_1782
		}
		if (cs == 5) {
			gosub *label_1803
			snd 20
			goto *label_1782
		}
		if (cs == 6) {
			gosub *label_1803
			snd 20
			goto *label_1782
		}
	}
	if (key == key_southwest | key == key_southeast) {
		if (cs == 1) {
			if (key == key_southeast) {
				userspelloptions(1) += 10
			} else {
				userspelloptions(1) -= 10
			}
			if (userspelloptions(1) > 100) {
				userspelloptions(1) = 100
			} else {
				if (userspelloptions(1) < 1) {
					userspelloptions(1) = 1
				}
			}
			snd 20
			goto *label_1782
		}
	}
	if (key == key_northwest | key == key_northeast) {
		if (cs == 1) {
			if (key == key_northeast) {
				userspelloptions(1) += 100
			} else {
				userspelloptions(1) -= 100
			}
			if (userspelloptions(1) > 100) {
				userspelloptions(1) = 100
			} else {
				if (userspelloptions(1) < 1) {
					userspelloptions(1) = 1
				}
			}
			snd 20
			goto *label_1782
		}
	}
	goto *label_1783



*itemGen_setEnhancementValue
	if (mode != 6) {
		if (gCurrentMap != 30 & gCurrentMap != 35) {
			if (cm | mode == 1) {
				if (noencpfix == 0) {
					bonus_base = limitmax(limit(objlv, 0, 6000), 2000) / 16 + limitmin(limit(objlv, 0, 6000) - 2000, 0) / 32
					iEnhancement(ci) = bonus_base * 3 + rnd(1 + bonus_base)
				}
			} else {
				iEnhancement(ci) = limit(objlv, 0, 8000) / 16 + rnd(1 + limit(objlv, 0, 8000) / 16)
			}
		}
	}
	return



*label_1793
	p = length(csetgodservant)
	if (usergodmax) {
		p += usergodmax
	}
	charakind = rnd(p)
	if (charakind < length(csetgodservant)) {
		dbid = csetgodservant(charakind)
	} else {
		initunid = findunid(cgodServantId(charakind - length(csetgodservant)))
		dbid = 343
	}
	return
*label_1794
	tlocx = cX(tc)
	tlocy = cY(tc)
	if (sdataref(3, efid) / 1000 == 3) {
		range = sdataref(3, efid) \ 1000
		if (sdataref(1, efid) == 4) {
			if (range == 0) {
				if (nc_gettrait(cc, 105) > 0) {
					range = 3
				}
			}
		}
		if (sdataref(1, efid) > 1000 & sdataref(3, efid) / 1000 == 3) {
			if (range == 0) {
				if (nc_gettrait(cc, 106) > 0) {
					range = 3
				}
			}
		}
	} else {
		range = 0
	}
	repeat range * 2 + 1
		dy = tlocy - range + cnt
		if (dy < 0 | dy >= mapHeight) {
			continue
		}
		repeat range * 2 + 1
			dx = tlocx - range + cnt
			if (dx < 0 | dx >= mapWidth) {
				continue
			}
			if (dist(tlocx, tlocy, dx, dy) > range) {
				continue
			}
			if (fov_los(tlocx, tlocy, dx, dy) == 0) {
				continue
			}
			if (map(dx, dy, 1) == 0) {
				continue
			}
			tc = map(dx, dy, 1) - 1
			gosub procbody
			if (stat == 0) {
				continue
			}
		loop
	loop
	return
*label_1795
	if (range != 0) {
		if (relationbetween(cc, tc) < (-1)) {
			return 0
		}
	}
	if (synccheck(tc, -1)) {
		if (efid == 400) {
			txt -1, lang(name(tc) + "の傷はふさがった。", name(tc) + " " + is(tc) + " slightly healed.")
		} else {
			if (efid == 402) {
				txt -1, lang(name(tc) + "の身体に生命力がみなぎった。", name(tc) + " " + is(tc) + " greatly healed.")
			} else {
				if (efid == 403 | efid == 518) {
					txt -1, lang(name(tc) + "は完全に回復した。", name(tc) + " " + is(tc) + " completely healed.")
				} else {
					if (efid == sId_overCureOfJure) {
						txt -1, lang(name(tc) + "は過剰に回復した。", name(tc) + " " + is(tc) + " completely healed.")
					} else {
						txt -1, lang(name(tc) + "は回復した。", name(tc) + " " + is(tc) + " healed.")
					}
				}
			}
		}
	}
	gosub *label_1411
	if (efstatus >= 1) {
		healcon tc, 12, 5 + rnd(5)
	}
	sickifcursed efstatus, tc, 3
	if (range == 0) {
		animeid = 5
	} else {
		animeid = 11
	}
	gosub *label_0630
	return 1
*label_1796
	if (range != 0) {
		if (efbad) {
			if (cc == 0 | cRelationship(cc) >= 0) {
				if (cRelationship(tc) >= 0) {
					return 0
				}
			} else {
				if (cRelationship(tc) < 0) {
					return 0
				}
			}
		} else {
			if ((cc != 0 | eqfaction(tc, "pcchild") == 0) & cRelationship(cc) != cRelationship(tc)) {
				return 0
			}
		}
	}
	if (synccheck(tc, -1)) {
		if (bdataref(0, p) == 1) {
			animeload 11, tc, p == buffId_lulwysTrick
		} else {
			if (bdataref(0, p) == 2) {
				animeid = 6
				gosub *label_0630
			}
		}
	}
	if (efid == 625 | p == 5) {
		if (tc == 0 | (tc == 0 & cc == gMount)) {
			if (gMount != 0) {
				tc = gMount
			}
		} else {
			if (ocdata(106, tc) != 0) {
				tc = ocdata(106, tc)
			} else {
				if (ocdata(107, cc) != 0) {
					if (tc == ocdata(107, cc)) {
						tc = cc
					}
				}
			}
		}
	}
	calcbuff -1, p, efp
	addbuff tc, p, efp, dur
	if (efid == 447) {
		if (efstatus >= 1) {
			cBirthYear(tc) += rnd(3) + 1 + efp / 400
			if (efp > 200) {
				if (cBirthYear(tc) > gYear) {
					cBirthYear(tc) = gYear
				}
			} else {
				if (cBirthYear(tc) + 12 > gYear) {
					cBirthYear(tc) = gYear - 12
				}
			}
			if (synccheck(tc, -1)) {
				txtef 2
				txt -1, lang(name(tc) + "の老化は遅くなった。", name(tc) + your(tc) + " aging process slows down.")
			}
		}
	}
	if (efid == 446) {
		if (efstatus <= (-1)) {
			cBirthYear(tc) -= rnd(3) + 1 + efp / 400
			if (synccheck(tc, -1)) {
				txtef 8
				txt -1, lang(name(tc) + "の老化は速くなった。", name(tc) + your(tc) + " aging process speeds up.")
			}
		}
	}
	if (efid == 458) {
		if (tc == 0) {
			incognitobegin
		}
	}
	return
*label_1797
	if (efstatus == 0) {
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "の装備品は白い光に包まれた。", name(tc) + " " + your(tc) + " equipment are surrounded by a white aura.")
		}
	}
	inv_getheader tc
	p(1) = 0, 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iCurseState(cnt) >= 0) {
			continue
		}
		ci = cnt
		p = 0
		if (iCurseState(ci) == (-1)) {
			p = rnd(200) + 1
		}
		if (iCurseState(ci) == (-2)) {
			p = rnd(1000) + 1
		}
		if (efstatus >= 1) {
			p = p / 2 + 1
		} else {
			if (iBodyPart(ci) == 0) {
				continue
			}
		}
		if (p != 0) {
			if (efp >= p) {
				p(1)++
				if (ibit(18, ci) & iCurseState(ci) <= (-2)) {
					if (iBodyPart(ci) != 0) {
						cdata(iBodyPart(ci), tc) = cdata(iBodyPart(ci), tc) / 10000 * 10000
						iBodyPart(ci) = 0
					}
					iNumber(ci)--
					txtef 3
					txt -1, lang("" + itemname(ci) + "は白い光とともに消え去った……", "" + itemname(ci) + "disappear with a white aura.")
					snd 47
				}
				iCurseState(ci) = 0
				item_stack tc, ci, 1
			} else {
				p(2)++
			}
		}
	loop
	if (efstatus >= 1) {
		if (p(1) != 0) {
			if (synccheck(tc, -1)) {
				txt -1, lang("幾つかのアイテムが浄化された。", "The aura uncurses some " + his(tc) + " stuff.")
			}
		}
	} else {
		if (p(1) != 0) {
			if (synccheck(tc, -1)) {
				txt -1, lang("身に付けている装備の幾つかが浄化された。", "The aura uncurses some of " + his(tc) + " equipment.")
			}
		}
	}
	if (p(2) != 0) {
		if (synccheck(tc, -1)) {
			txt -1, lang("幾つかのアイテムは抵抗した。", "Several items resist the aura and remain cursed.")
		}
	}
	if (p(1) == 0 & p(2) == 0) {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		obvious = 0
	} else {
		animeload 10, tc
	}
	r1 = tc
	gosub *chara_refresh
	return
*label_1798
	p = 0
	repeat 8 + 8
		i = 8 + 8 - cnt - 1
		if (efid == 406) {
			if (p >= 1) {
				break
			}
		}
		if (bdataref(0, ocdata(192 + i * 3, tc)) != 2) {
			continue
		}
		if (ocdata(192 + i * 3, tc) == 13) {
			continue
		}
		if (ocdata(192 + i * 3, tc) == 0) {
			continue
		}
		if (rndex(efp * 2 + 1) > rndex(ocdata(192 + i * 3 + 1, tc) + 1)) {
			delbuff tc, i
			p++
			continue cnt
		}
	loop
	addbuff tc, 10, efp, 5 + efp / 30
	animeload 11, tc
	return



#defcfunc spellbookcheck int __aaa
	if (sdata(150, __aaa) == 0 | sdata(165, __aaa) == 0) {
		return 0
	}
	inv_getheader __aaa
	olistmax = 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (refitem(iId(cnt), 5, cnt) != 54000) {
			continue
		}
		olist(olistmax) = cnt
		olistmax++
	loop
	if (olistmax == 0) {
		return 0
	}
	return 1



#deffunc skillexp2 int __bbb, int __ccc, int __ddd, int __eee, int __fff
	skillexp __bbb, __ccc, __ddd, __eee, __fff
	p(86) = stat
	if (__ddd > 0) {
		if (__bbb >= 100) {
			if (__fff != 1000) {
				if (__ccc >= 1 & __ccc <= 15) {
					repeat 15, 1
						if (cState(cnt) != 1 & cState(cnt) != 7) {
							continue
						}
						if (__ccc != cnt) {
							p(85) = __ddd / (20 - sqrt(limit(sdata(14, cnt), 1, 225)))
							if (p(85) > 0) {
								skillexp __bbb, cnt, p(85), __eee, __fff
							}
						}
					loop
				}
			}
		}
	}
	return p(86)



#defcfunc readablecheck int __ggg, int __hhh
	if (sdata(150, __ggg) == 0) {
		return 0
	}
	efidbk = efid
	efpbk = efp
	dbidbk = dbid
	efid = 0
	dbmode = 13
	dbid = iId(__hhh)
	noread = 1
	gosub *label_2426
	p(52) = efid
	dbid = dbidbk
	efp = efpbk
	efid = efidbk
	if (p(52) == 0) {
		return 0
	}
	if (p(52) == 435 | p(52) == 441 | p(52) == 464 | p(52) == 411 | p(52) == 428 | p(52) == 429 | p(52) == 430 | p(52) == 438 | p(52) == 457 | p(52) == 458 | p(52) == 463) {
		return 0
	}
	if (sdata(150, __ggg) * 20 + 250 < sdataref(4, p(52))) {
		return 0
	}
	return p(52)
*label_1802
	dim spellconditionlist, 2, 30
	sdim spellconditionlistn, 20, 30
	spellconditionlist(0, 0) = 1, 1
	spellconditionlistn(0) = lang("日中", "Daytime")
	spellconditionlist(0, 1) = 1, 1
	spellconditionlistn(1) = lang("夜間", "Nighttime")
	spellconditionlist(0, 2) = 1, 2
	spellconditionlistn(2) = lang("雨", "Rain")
	spellconditionlist(0, 3) = 1, 2
	spellconditionlistn(3) = lang("雷雨", "Hard rain")
	spellconditionlist(0, 4) = 1, 2
	spellconditionlistn(4) = lang("晴れ", "Sunny")
	spellconditionlist(0, 5) = 1, 2
	spellconditionlistn(5) = lang("雪", "Snow")
	spellconditionlist(0, 6) = 1, 3
	spellconditionlistn(6) = lang("1月", "January")
	spellconditionlist(0, 7) = 1, 3
	spellconditionlistn(7) = lang("2月", "February")
	spellconditionlist(0, 8) = 1, 3
	spellconditionlistn(8) = lang("3月", "March")
	spellconditionlist(0, 9) = 1, 3
	spellconditionlistn(9) = lang("4月", "April")
	spellconditionlist(0, 10) = 1, 3
	spellconditionlistn(10) = lang("5月", "May")
	spellconditionlist(0, 11) = 1, 3
	spellconditionlistn(11) = lang("6月", "June")
	spellconditionlist(0, 12) = 1, 3
	spellconditionlistn(12) = lang("7月", "July")
	spellconditionlist(0, 13) = 1, 3
	spellconditionlistn(13) = lang("8月", "August")
	spellconditionlist(0, 14) = 1, 3
	spellconditionlistn(14) = lang("9月", "Septempber")
	spellconditionlist(0, 15) = 1, 3
	spellconditionlistn(15) = lang("10月", "October")
	spellconditionlist(0, 16) = 1, 3
	spellconditionlistn(16) = lang("11月", "November")
	spellconditionlist(0, 17) = 1, 3
	spellconditionlistn(17) = lang("12月", "December")
	spellconditionlist(0, 18) = 2, 4
	spellconditionlistn(18) = lang("ペットのマナも消費", "Also consume pets MP")
	spellconditionlist(0, 19) = 2, 5
	spellconditionlistn(19) = lang("信仰の深さも消費", "Also consume piety")
	spellconditionlist(0, 20) = 2, 6
	spellconditionlistn(20) = lang("体力も消費", "Also consume HP")
	spellconditionlist(0, 21) = 2, 7
	spellconditionlistn(21) = lang("スタミナも消費", "Also consume SP")
	spellconditionlist(0, 22) = 2, 8
	spellconditionlistn(22) = lang("ターンも消費", "Also consume turns")
	spellconditionlist(0, 23) = 2, 9
	spellconditionlistn(23) = lang("使用後、出血", "Bleed after cast")
	spellconditionlist(0, 24) = 2, 10
	spellconditionlistn(24) = lang("使用後、沈黙", "Silence after cast")
	spellconditionlist(0, 25) = 2, 11
	spellconditionlistn(25) = lang("使用後、発狂", "Unsteady after cast")
	spellconditionlist(0, 26) = 1, 12
	spellconditionlistn(26) = lang("屋内", "Indoor")
	spellconditionlist(0, 27) = 1, 12
	spellconditionlistn(27) = lang("屋外", "Outdoor")
	spellconditionlist(0, 28) = 2, 13
	spellconditionlistn(28) = lang("使用後、麻痺", "Paralyze after cast")
	spellconditionlist(0, 29) = 2, 14
	spellconditionlistn(29) = lang("使用後、朦朧", "Dim after cast")
	return
*label_1803
	userspelloptions(cs) += p
	if (userspelloptions(cs) > length(spellconditionlistn)) {
		userspelloptions(cs) = length(spellconditionlistn)
	} else {
		if (userspelloptions(cs) < 0) {
			userspelloptions(cs) = 0
		}
	}
	if (userspelloptions(cs) == 0) {
		return
	}
	f = 0
	repeat 3, 4
		if (cnt != cs) {
			if (userspelloptions(cnt) == 0) {
				continue
			}
			if (spellconditionlist(1, userspelloptions(cs) - 1) == spellconditionlist(1, userspelloptions(cnt) - 1)) {
				f = 1
				break
			}
		}
	loop
	if (f) {
		repeat length(spellconditionlistn)
			userspelloptions(cs) += p
			if (userspelloptions(cs) > length(spellconditionlistn)) {
				userspelloptions(cs) = length(spellconditionlistn)
				p = -1
			} else {
				if (userspelloptions(cs) < 0) {
					userspelloptions(cs) = 0
				}
			}
			if (userspelloptions(cs) == 0) {
				break
			}
			f = 1
			repeat 3, 4
				if (cnt != cs) {
					if (userspelloptions(cnt) == 0) {
						continue
					}
					if (spellconditionlist(1, userspelloptions(cs) - 1) == spellconditionlist(1, userspelloptions(cnt) - 1)) {
						f = 0
						break
					}
				}
			loop
			if (f) {
				break
			}
		loop
	}
	return
*label_1804
	userspelldata(0, userspellmax) = sdataref(0, p(81))
	userspelldata(1, userspellmax) = sdataref(1, p(81))
	userspelldata(3, userspellmax) = sdataref(3, p(81))
	userspelldata(4, userspellmax) = userspelloptions(1) * sdataref(4, p(81))
	repeat 3, 4
		if (userspelloptions(cnt) != 0) {
			userspelldata(4, userspellmax) = userspelldata(4, userspellmax) * (100 + calcuserspellfixcost(userspelloptions(cnt) - 1)) / 100
		}
	loop
	userspelldatan(1, userspellmax) = "0"
	userspelldatan(2, userspellmax) = "0"
	userspelldatan(3, userspellmax) = "0"
	userspelldatan(4, userspellmax) = "0"
	userspelldatan(5, userspellmax) = "0"
	if (userspelloptions(0) == 1) {
		_switch_val = userspelloptions(3)
		repeat 1
			if (_switch_val == 1) {
				userspelldatan(4, userspellmax) = "" + 50
				break
			}
			if (_switch_val == 2) {
				userspelldatan(4, userspellmax) = "" + 51
				break
			}
			if (_switch_val == 3) {
				userspelldatan(4, userspellmax) = "" + 52
				break
			}
			if (_switch_val == 4) {
				userspelldatan(4, userspellmax) = "" + 53
				break
			}
			if (_switch_val == 5) {
				userspelldatan(4, userspellmax) = "" + 54
				break
			}
			if (_switch_val == 6) {
				userspelldatan(4, userspellmax) = "" + 55
				break
			}
			if (_switch_val == 7) {
				userspelldatan(4, userspellmax) = "" + 56
				break
			}
			if (_switch_val == 8) {
				userspelldatan(4, userspellmax) = "" + 57
				break
			}
			if (_switch_val == 9) {
				userspelldatan(4, userspellmax) = "" + 58
				break
			}
			if (_switch_val == 10) {
				userspelldatan(4, userspellmax) = "" + 59
				break
			}
			if (_switch_val == 11) {
				userspelldatan(4, userspellmax) = "" + 60
				break
			}
			if (_switch_val == 12) {
				userspelldatan(4, userspellmax) = "" + 70
				userspelldata(0, userspellmax) = 17
				break
			}
		loop
	}
	if (p(81) == 414) {
		userspelldatan(1, userspellmax) = "{efp} / 125 + 2 + {attb} / 50"
		userspelldatan(2, userspellmax) = "{efp} / 60 + 9 + 1"
		userspelldatan(5, userspellmax) = "100 + {efp} / 4"
		return
	}
	if (p(81) == 422) {
		userspelldatan(1, userspellmax) = "{efp} / 50 + 1 + {attb} / 20"
		userspelldatan(2, userspellmax) = "{efp} / 25 + 4 + 1"
		userspelldatan(5, userspellmax) = "180 + {efp} / 4"
		return
	}
	if (p(81) == 433) {
		userspelldatan(1, userspellmax) = "{efp} / 80 + 1 + {attb} / 20"
		userspelldatan(2, userspellmax) = "{efp} / 12 + 2 + 1"
		userspelldatan(5, userspellmax) = "150 + {efp} / 5"
		return
	}
	if (p(81) == 465) {
		userspelldatan(5, userspellmax) = "1000"
		return
	}
	if (p(81) == 405) {
		userspelldatan(1, userspellmax) = "2 + {attb} / 22"
		userspelldatan(2, userspellmax) = "{efp} / 18 + 5 + 1"
		userspelldatan(3, userspellmax) = "{efp} / 10"
	}
	if (p(81) == 407) {
		userspelldatan(3, userspellmax) = "{attb} * 5 + {efp} * 3 / 2"
	}
	if (p(81) == 412) {
		userspelldatan(3, userspellmax) = "{attb} * {efp} * 5 / 100"
	}
	_switch_val = userspelloptions(2)
	repeat 1
		if (_switch_val == 5) {
			userspelldata(3, userspellmax) = 3000
			break
		}
		if (_switch_val == 6) {
			userspelldata(3, userspellmax) = 8000
			break
		}
		if (_switch_val == 7) {
			userspelldata(3, userspellmax) = 2006
			break
		}
		if (_switch_val == 8) {
			userspelldata(3, userspellmax) = 3002
			break
		}
	loop
	return
*label_1805
	if (gCurrentMap != 35) {
		repeat userspellmax
			userspelldata(11, cnt) = limitmax(userspelldata(11, cnt) + calcuserspellcoststock(cnt) + sdata(155, 0) * 50, 2000000000)
			nc_intb_001 = userspelldata(12, cnt) \ 1000 + 5
			if (ogdata(504) == 2) {
				if (nc_intb_001 < 51) {
					nc_intb_001 = 51
				}
				if (trophycheck(22) == 2 & nc_intb_001 < 101) {
					nc_intb_001 = 101
				}
				if (nc_intb_001 > 450 + nc_intb_gro1) {
					nc_intb_001 = 450 + nc_intb_gro1
				}
			} else {
				if (nc_intb_001 < 1) {
					nc_intb_001 = 1
				}
				if (trophycheck(22) == 2 & nc_intb_001 < 51) {
					nc_intb_001 = 51
				}
				if (nc_intb_001 > 400 + nc_intb_gro1) {
					nc_intb_001 = 400 + nc_intb_gro1
				}
			}
			userspelldata(12, cnt) = userspelldata(12, cnt) / 1000000 * 1000000 + userspelldata(12, cnt) \ 1000000 / 1000 * 1000 + nc_intb_001
		loop
		if (nc_gettrait(0, 109) > 0) {
			skillgain 0, 520, 1, 200
			skillgain 0, 521, 1, 200
			skillgain 0, 523, 1, 200
		}
		if (nc_gettrait(0, 110) > 0) {
			skillgain 0, 528, 1, 200
			skillgain 0, 531, 1, 200
			skillgain 0, 538, 1, 200
		}
	}
	return



#defcfunc calcuserspellcostmp int __iii
	cost = userspelldata(2, __iii)
	repeat 3, 6
		if (userspelldata(cnt, __iii) == 0) {
			break
		}
		cost = cost * (100 - calcuserspellfixcost(userspelldata(cnt, __iii) - 1)) / 100
	loop
	cost = cost * (100 + userspelldata(12, __iii) / 1000000 * 3) / 100 + userspelldata(12, __iii) / 1000000 / 8
	return cost



#defcfunc calcuserspellfail int __jjj, int __kkk
	fixfail = 1
	if (godcheck(0) == "danalin") {
		if (cInsanity(0) >= 100) {
			fixfail = 2
		}
	}
	i = 4
	f = carmor(__kkk)
	if (f == 169) {
		i = 17 / fixfail - sdata(169, __kkk) / 5
	}
	if (f == 170) {
		i = 12 / fixfail - sdata(170, __kkk) / 5
	}
	if (i < 4) {
		i = 4
	}
	if (gMount != 0) {
		i += 4 / fixfail
	}
	p = 90 + userspelldata(12, __jjj) / 1000000 - userspelldata(4, __jjj) * i / (5 + sdata(172, __kkk) * 4)
	if (fixfail == 1) {
		if (f == 169) {
			if (p > 80) {
				p = 80
			}
		} else {
			if (f == 170) {
				if (p > 92) {
					p = 92
				}
			} else {
				if (p > 100) {
					p = 100
				}
			}
		}
	}
	if (cEquipmentType(__kkk) & 4) {
		p -= 6 / fixfail
	}
	if (cEquipmentType(__kkk) & 1) {
		p -= 12 / fixfail
	}
	if (p > 100) {
		p = 100
	}
	if (ogdata(467) == 2) {
		p += 5
	}
	if (ogdata(512) == 2) {
		p += 5
	}
	if (trophycheck(0) == 2) {
		p += 5
	}
	return limit(p, 0, 100)



#deffunc userspellexp int __lll, int __mmm, int __nnn, int __ooo, int __ppp
	if (__nnn <= 0) {
		return
	}
	if (userspelldata(0, __lll) != 0) {
		skillexp userspelldata(0, __lll), __mmm, __nnn / (2 + __ooo)
	}
	lv@m77 = userspelldata(12, __lll) / 1000000
	growth@m77 = userspelldata(12, __lll) \ 1000
	if (growth@m77 == 0) {
		return
	}
	exp@m77 = __nnn * growth@m77 / (100 + lv@m77 * 15)
	if (findbuff(__mmm, 85) != (-1)) {
		exp@m77 = exp@m77 * (100 + limitmax(ocdata(192 + findbuff(__mmm, 85) * 3 + 1, __mmm) / 200, 500)) / 100
	}
	if (exp@m77 == 0) {
		if (rnd(lv@m77 / 10 + 1) == 0) {
			exp@m77 = 1
		} else {
			return 0
		}
	}
	if (gCurrentMap == 35) {
		exp@m77 /= 5
	}
	exp2@m77 = rndex(limit(cRequiredExperience(__mmm) * exp@m77 / 1000 / (cLevel(__mmm) + __ppp) + 1, 1, 1000000)) + rnd(2)
	cExperience(__mmm) += exp2@m77
	if (__mmm == 0) {
		gSleepExperience += exp2@m77
	}
	exp@m77 += userspelldata(12, __lll) \ 1000000 / 1000
	if (exp@m77 >= 1000) {
		lvchange@m77 = exp@m77 / 1000
		exp@m77 = exp@m77 \ 1000
		lv@m77 += lvchange@m77
		repeat lvchange@m77
			growth@m77 = int(double(growth@m77) * 0.9)
			if (ogdata(504) == 2) {
				if (growth@m77 < 51) {
					growth@m77 = 51
				}
				if (trophycheck(22) == 2 & growth@m77 < 101) {
					growth@m77 = 101
				}
			} else {
				if (growth@m77 < 1) {
					growth@m77 = 1
				}
				if (trophycheck(22) == 2 & growth@m77 < 51) {
					growth@m77 = 51
				}
			}
		loop
		userspelldata(12, __lll) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
		snd 61
		txtef 2
		msgalert = 1
		txt -1, lang(name(__mmm) + "は" + userspelldatan(0, __lll) + "の技術の向上を感じた。", name(__mmm) + your(__mmm) + " " + userspelldatan(0, __lll) + " skill increases.")
		return 1
	}
	userspelldata(12, __lll) = limit(lv@m77, 0, 2000) * 1000000 + exp@m77 * 1000 + growth@m77
	return 0



#defcfunc calcuserspellcoststock int __qqq
	p(75) = userspelldata(2, __qqq)
	repeat 3, 6
		if (userspelldata(cnt, __qqq) == 0) {
			break
		}
		p(75) = p(75) * (100 - calcuserspellfixcost(userspelldata(cnt, __qqq) - 1)) / 100
	loop
	cost@m159 = p(75) * (150 + magiccritical * 150) / (userspelldata(12, __qqq) / 1000000 * 3 / 2 + 100)
	if (cost@m159 < p(75) / 5) {
		cost@m159 = p(75) / 5
	}
	cost@m159 = rndex(cost@m159 / 2 + 1) + cost@m159 / 2
	if (cost@m159 < 1) {
		cost@m159 = 1
	}
	return cost@m159
*label_1810
	snd 26
	page_save
	page = 0
	pagesize = 15
	listmax = 0
	p = 0
	s = ""
	olistmax = 0
	if (userspelldata(1, title_pos) > 1000) {
		if (jp) {
			if (userspelldata(3, title_pos) == 3000) {
				s = "自分対象の"
			} elseif (userspelldata(3, title_pos) == 8000) {
				s = "任意の方向の"
			} elseif (userspelldata(3, title_pos) == 2006) {
				s = "任意の対象の"
			} elseif (userspelldata(3, title_pos) == 3002) {
				s = "範囲の"
			}
			s += buffname(userspelldata(1, title_pos) \ 1000)
		} else {
			s = buffname(userspelldata(1, title_pos) \ 1000)
			if (userspelldata(3, title_pos) == 3000) {
				s += " (yourself)"
			} elseif (userspelldata(3, title_pos) == 8000) {
				s += " (direction)"
			} elseif (userspelldata(3, title_pos) == 2006) {
				s += " (target)"
			} elseif (userspelldata(3, title_pos) == 3002) {
				s += " (range)"
			}
		}
	} elseif (userspelldata(1, title_pos) == 4) {
		if (userspelldata(3, title_pos) == 3000) {
			s = lang("自分対象の治癒", "Heal (yourself)")
		} elseif (userspelldata(3, title_pos) == 8000) {
			s = lang("任意の方向の治癒", "Heal (direction)")
		} elseif (userspelldata(3, title_pos) == 2006) {
			s = lang("任意の対象の治癒", "Heal (target)")
		} elseif (userspelldata(3, title_pos) == 3002) {
			s = lang("範囲の治癒", "Heal (range)")
		}
	} elseif (userspelldata(1, title_pos) == 12) {
		if (userspelldata(3, title_pos) == 3000) {
			s = lang("自分対象の全浄化", "Vanquish hex (yourself)")
		} elseif (userspelldata(3, title_pos) == 8000) {
			s = lang("任意の方向の全浄化", "Vanquish hex (direction)")
		} elseif (userspelldata(3, title_pos) == 2006) {
			s = lang("任意の対象の全浄化", "Vanquish hex (target)")
		} elseif (userspelldata(3, title_pos) == 3002) {
			s = lang("範囲の全浄化", "Vanquish hex (range)")
		}
	} elseif (userspelldata(1, title_pos) == 13) {
		if (userspelldata(3, title_pos) == 3000) {
			s = lang("自分対象のアイテム解呪", "Uncurse (yourself)")
		} elseif (userspelldata(3, title_pos) == 8000) {
			s = lang("任意の方向のアイテム解呪", "Uncurse (direction)")
		} elseif (userspelldata(3, title_pos) == 2006) {
			s = lang("任意の対象のアイテム解呪", "Uncurse (target)")
		} elseif (userspelldata(3, title_pos) == 3002) {
			s = lang("範囲のアイテム解呪", "Uncurse (range)")
		}
	} else {
		s = cnven(skillname(int(userspelldatan(4, title_pos)))) + lang("属性の", " ")
		if (userspelldata(3, title_pos) == 2006) {
			s += lang("矢", "arrow")
		} elseif (userspelldata(3, title_pos) == 3002) {
			s += lang("ボール", "ball")
		} elseif (userspelldata(3, title_pos) == 9006) {
			s += lang("ボルト", "bolt")
		} elseif (userspelldata(3, title_pos) == 10000) {
			s += lang("メテオ", "meteor")
		}
	}
	title_description(0) = lang("威力: ", "Power: ") + userspelldata(5, title_pos)
	title_description(1) = lang("効果: ", "Effect: ") + s
	title_description(2) = lang("制約:\n", "Limitation:\n")
	repeat 3
		if (userspelldata(6 + cnt, title_pos) == 0) {
			if (cnt == 0) {
				title_description(2) += lang("\tなし", "\tNo limitations")
			}
			break
		}
		title_description(2) += "\t" + spellconditionlistn(userspelldata(6 + cnt, title_pos) - 1) + "\n"
	loop
	repeat 3
		if (title_description(cnt) == "") {
			continue
		}
		list(0, p) = 0
		listn(0, p) = ""
		p++
		buf = trimdesc(title_description(cnt), 2)
		notesel buf
		repeat noteinfo(0)
			noteget q, cnt
			p(1) = 66, 0
			if (strlen(q) > p(1)) {
				repeat strlen(q) / p(1) + 1
					if (strmid(q, p(2) + p(1), 2) == "。" | strmid(q, p(2) + p(1), 2) == "、") {
						p(1) += 2
					}
					if (strmid(q, p(2), p(1)) == "") {
						break
					}
					list(0, p) = -1
					listn(0, p) = strmid(q, p(2), p(1))
					p++
					p(2) += p(1)
				loop
			} else {
				list(0, p) = 0
				listn(0, p) = q
				if (cnt == noteinfo(0) - 1) {
					list(0, p) = -1
				}
				p++
			}
		loop
	loop
	if (p == 0) {
		list(0, p) = 0
		listn(0, p) = lang("特に情報はない", "There is no information about this spell.")
		p++
	}
	listmax = p
	pagemax = (listmax - 1) / pagesize
	windowshadow = 1
	key_list = key_enter
	keyrange = 0
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1811
	redraw 0
	s = lang("魔法の情報", "Spell info")
	s(1) = lang("ｷｬﾝｾﾙ [閉じる]  決定キー [名前を変える]", "Shift,Esc [Close]  Enter [Change Name]")
	display_window (windoww - 600) / 2 + inf_screenx, winposy(408), 600, 408
	display_topic userspelldatan(0, title_pos), wx + 28, wy + 34
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 0, 0, 0
		pos wx + 68, wy + 68 + cnt * 18
		if (list(0, p) == (-1)) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		}
		if (list(0, p) == (-2)) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 2
			pos wx + ww - strlen(listn(0, p)) * 6 - 80, wy + 68 + cnt * 18
		}
		mes listn(0, p)
	loop
	redraw 1
	await cfg_wait1
	key_check
	if (key == key_enter) {
		txt -1, lang("この魔法を何と呼ぶ？ ", "What do you want to call this spell? ")
		val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
		inputlog = ""
		input_mode = 1
		gosub *label_1349
		if (inputlog == "") {
			txt -1, lang("名前を変えるのは止めた。", "You changed your mind.")
		} else {
			userspelldatan(0, title_pos) = "" + inputlog
			txt -1, lang("" + inputlog + "という名前をつけた。", "You named the spell " + inputlog + ".")
		}
	}
	if (key == key_cancel) {
		return
	}
	goto *label_1811
*label_1812
	repeat 245
		if (cId(cnt) == 343) {
			getunid cnt
		}
	loop
	return


*buff_addGodMiracleBuff
	calcbuff -1, p, cPietyPoint(r1)
	addbuff r1, p, cPietyPoint(r1), dur
	return


*label_1814
	ammo = -1
	repeat 30
		body = 100 + cnt
		if (cdata(body, cc) \ 10000 == 0) {
			continue
		}
		if (cdata(body, cc) / 10000 == 11) {
			ammo = cdata(body, cc) \ 10000 - 1
			break
		}
	loop
	return



#defcfunc aliveweaponname
	p(73) = 0
	repeat 30, 100
		if (cdata(cnt, 0) == 0) {
			continue
		}
		if (cdata(cnt, 0) / 10000 != 5 & cdata(cnt, 0) / 10000 != 10) {
			continue
		}
		i = cdata(cnt, 0) \ 10000 - 1
		if (i <= 0) {
			continue
		}
		if (ibit(10, i) == 0) {
			continue
		}
		p(73) = i
		break
	loop
	if (p(73)) {
		i = p(73)
		if (iSubname(i) >= 40000) {
			randomize iSubname(i) - 40000
			s = random_title(1)
			randomize timeGetTime()
			return s
		}
	}
	return ""
*label_1816
	page = 0
	pagesize = 19
	cs = 0
	cs_bk = -1
	ww = 380
	wh = 340
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	snd 97
	windowanime wx, wy, ww, wh, 10, 7
	gsel 4
	pos 0, 0
	exist exedir + "user\\graphic\\user_face1.bmp"
	if (strsize != (-1) & cfg_userface1) {
		picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
		ex_userface = 1
	} else {
		picload_ exedir + "graphic\\face1.bmp", 1
		ex_userface = 0
	}
	buffer 7, 1440, 1080
	color 0, 0, 0
	boxf
	repeat 128
		s = exedir + "user\\graphic\\face" + (cnt + 1) + ".bmp"
		exist s
		if (strsize != (-1)) {
			pos cnt \ 16 * 80, cnt / 16 * 112
			picload_ s, 1
		}
	loop
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_mirror.bmp", 1
	gsel 0
	windowshadow = 1
	if (cc != 0) {
		if (cId(cc) != 343) {
			if (cImage(cc) \ 1000 <= 660) {
				cCnpcId(cc) = cImage(cc)
			}
		}
	}
	listmax = 0
	olist = 0, 1, 10
	if (jp) {
		s = "決定    ", "肖像　　", "ｷｬﾗﾁｯﾌﾟ "
	}
	if (en) {
		s = "Done    ", "Portrait", "Charachip "
	}
	p = 3
	repeat p
		list(0, cnt) = cnt, olist(cnt)
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop
*label_1817
	redraw 0
	pagesize = 0
	s = lang("肖像の変更", "Appearance"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 380) / 2 + inf_screenx, winposy(340) - 12, 380, 374
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	pos wx + ww - 40, wy
	gcopy 3, 960, 96, 48, 120
	i++
	if (i \ 100 < 45) {
		f = i \ 16
	} else {
		f++
	}
	window2 wx + 234, wy + 71, 88, 120, 1, 1
	if (cs == 1) {
		if (cPortrait(cc) >= 0) {
			p = cSex(cc) * 64 + cPortrait(cc)
			pos wx + 238, wy + 75
			exist exedir + "user\\graphic\\user_npcface" + p + ".bmp"
			if (strsize != (-1)) {
				gsel 32
				pos 0, 0
				picload_ exedir + "user\\graphic\\user_npcface" + p + ".bmp", 1
				gsel 0
				pos wx + 238, wy + 75
				gzoom 80, 112, 32, 0, 0, 80, 112
			} else {
				if (ex_userface == 1) {
					gzoom 80, 112, 4, p \ 16 * 80, p / 16 * 112, 80, 112
				} else {
					gzoom 80, 112, 4, p \ 16 * 48, p / 16 * 72, 48, 72
				}
			}
		} else {
			if (cPortrait(cc) != (-1)) {
				pos wx + 238, wy + 75
				gzoom 80, 112, 7, abs(cPortrait(cc) + 2) \ 16 * 80, abs(cPortrait(cc) + 2) / 16 * 112, 80, 112
			} else {
				if (cId(cc) == 343) {
					if (userdata2(0, cCnpcId(cc))) {
						pos wx + 238, wy + 75
						gzoom 80, 112, 100, cCnpcId(cc) \ 16 * 80, cCnpcId(cc) / 16 * 112, 80, 112
					}
				}
			}
		}
	} else {
		if (cbit(967, cc) == 1) {
			pos wx + 280, wy + 130
			gmode 2, 32, 48
			grotate 10 + cc, f / 4 \ 4 * 32, f / 16 \ 4 * 48, 0, 48, 80
		} else {
			transmissivity = 0
			if (cId(cc) == 343) {
				if (userdata2(1, cCnpcId(cc))) {
					transmissivity = userdata2(1, cCnpcId(cc))
				}
			}
			if (ocdata(101, cc)) {
				transmissivity = ocdata(101, cc)
			}
			i = getcharapic(cc)
			chara_preparepic i, getcharacolor(cc)
			pos wx + 280, wy + 130
			gmode 4, chipc(2, i), chipc(3, i), 256 - transmissivity
			color 0, 0, 0
			grotate 5, 0, 960, 0, chipc(2, i), chipc(3, i)
		}
	}
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if (p >= listmax) {
			break
		}
		val = list(1, p), 0
		gosub *label_1257
		s = listn(0, p)
		if (rtval >= 0) {
			if (rtval(2) >= 0) {
				s += " " + rtval(2)
			} else {
				if (rtval(2) == (-1)) {
					s += " N/A"
				} else {
					s += " u" + (abs(rtval(2)) - 1)
				}
			}
		}
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
		if (rtval != (-2)) {
			pos wx + 30, wy + 66 + cnt * 21 - 5
			gcopy 3, 312, 336, 24, 24
			pos wx + 175, wy + 66 + cnt * 21 - 5
			gcopy 3, 336, 336, 24, 24
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	val = list(1, cs), 0
	gosub *label_1257
	p = 0
	if (rtval == (-2)) {
		if (key == key_enter) {
			return 1
		}
		if (key == key_pageup | key == key_pagedown) {
			key = ""
		}
	} else {
		if (key == key_enter) {
			key = key_pageup
		}
	}
	if (key == key_pageup) {
		snd 5
		if (rtval == 100) {
			if (cPortrait(cc) < 32 - 1) {
				cPortrait(cc)++
			}
			goto *label_1817
		}
		if (rtval == 102) {
			if (cImage(cc) \ 1000 < 692 | cImage(cc) \ 1000 >= 825) {
				if (cImage(cc) \ 1000 <= 660 | cImage(cc) \ 1000 >= 825) {
					cImage(cc) = 661
				} else {
					cImage(cc)++
				}
			}
			goto *label_1817
		}
	}
	if (key == key_pagedown) {
		snd 5
		if (rtval == 100) {
			if (cPortrait(cc) > (-129)) {
				cPortrait(cc)--
			}
			goto *label_1817
		}
		if (rtval == 102) {
			if (cImage(cc) \ 1000 > 660 & cImage(cc) \ 1000 < 825) {
				cImage(cc)--
				if (cImage(cc) \ 1000 <= 660) {
					cImage(cc) = (cId(cc) == 343) * 825 + cCnpcId(cc)
				}
			}
			goto *label_1817
		}
	}
	if (key == key_cancel) {
		return 0
	}
	if (mode == 1) {
		getkey p, 112
		if (p) {
			return -1
		}
	}
	goto *label_1817
*label_1818
	gsel 4
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 0
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = 0
	cs_bk = -1
	repeat userspellmax
		if (userspelldata(0, cnt) > 0) {
			list(0, listmax) = cnt
			listn(0, listmax) = userspelldatan(0, cnt)
			listmax++
		}
	loop
	windowshadow = 1
*label_1819
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_1820
	redraw 0
	s = lang("独自魔法一覧", "Custom spells"), lang("決定 [封印]  ", "Enter [Seal] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate 4, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("独自魔法", "Custom spell"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = pagesize * page + cnt
			break
		}
	loop
	if (p != (-1)) {
		p = list(0, p)
		return 1
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_1819
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_1819
		}
	}
	if (key == key_cancel) {
		screenupdate = -1
		gosub *label_0623
		return
	}
	goto *label_1820
*label_1821
	repeat 50
		if (userspelldata(0, cnt) == 0) {
			userspellmax = cnt
			break
		}
		resetuserspell cnt
	loop
	return 1
*label_1822
	if (getcgodno() != (-1)) {
		god_no = stat
		repeat 2
			if (cgodMiracleNameEn(god_no, cnt) != "") {
				sdataref(0, 779 + cnt) = cgodMiracleRelatedBasicAttribute(god_no, cnt), cgodMiracleType(god_no, cnt), cgodMiracleCost(god_no, cnt), cgodMiracleRange(god_no, cnt), 110
				skillname(779 + cnt) = lang(cgodMiracleNameJp(god_no, cnt), cgodMiracleNameEn(god_no, cnt))
				skilldesc(779 + cnt) = ""
				if (779 + cnt < 600) {
					skillencdesc(779 + cnt) = ""
				}
			}
		loop
		if (cgodSkillNameEn(god_no) != "") {
			sdataref(0, 810) = cgodSkillRelatedBasicAttribute(god_no), cgodSkillType(god_no), cgodSkillCost(god_no), cgodSkillRange(god_no), 110
			skillname(810) = lang(cgodSkillNameJp(god_no), cgodSkillNameEn(god_no))
		}
	}
	return 1
*label_1823
	if (getcgodno() != (-1)) {
		god_no = stat
		if (cgodSpecialPowerId(god_no) != 0) {
			if (cgodSpecialPowerId(god_no) / 1000 == 0) {
				sdataref(0, 781) = sdataref(0, cgodSpecialPowerId(god_no)), sdataref(1, cgodSpecialPowerId(god_no)), sdataref(2, cgodSpecialPowerId(god_no)), sdataref(3, cgodSpecialPowerId(god_no)), sdataref(4, cgodSpecialPowerId(god_no))
				if (cgodSpecialPowerAlias(god_no) != "") {
					skillname(781) = cgodSpecialPowerAlias(god_no)
				} else {
					skillname(781) = skillname(cgodSpecialPowerId(god_no))
				}
				skilldesc(781) = skilldesc(cgodSpecialPowerId(god_no))
				skillencdesc(781) = skillencdesc(cgodSpecialPowerId(god_no))
			}
		}
	}
	return 1
*label_1824
	if (train) {
		buff = lang("訓練は完了し" + _ta() + "潜在能力が伸びているはずなので、後は自分で鍛えて" + _kure(), "Well done. You've got more room to develop than anyone else I've ever drilled. Keep training.")
	} else {
		buff = lang("訓練が必要なときは、声をかけて" + _kure(), "Come see me again when you need more training.")
	}
	goto *label_1476
*label_1825
	p(64) = iParam2(ri) \ 8
	efsource = 5
	if (p(64) == 4) {
		txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
		repeat 2 + rnd(3)
			flt calcobjlv(iParam2(ri) * 3 / 2 + 3), calcfixlv(2)
			characreate -1, 0, cX(cc), cY(cc)
		loop
	}
	if (p(64) == 6) {
		if (rnd(250)) {
			txt -1, lang("終末の日が訪れた…ような気がしたが気のせいだった。", "Let's Ragnarok?! ...Nothing happens.")
		} else {
			evadd 18, cc
		}
	}
	if (p(64) == 5) {
		txtef 3
		txt -1, lang("けたたましい警報が鳴り響いた！", "*beeeeeep!* An alarm sounds loudly!")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		repeat 229, 16
			if (cState(cnt) != 1) {
				continue
			}
			if (cSleep(cnt) != 0) {
				continue
			}
			if (cRelationship(cnt) != (-3)) {
				continue
			}
			turn_aggro cnt, cc, 80
		loop
	}
	if (p(64) == 3) {
		if (encfind(cc, 22) != (-1) & (findbuff(cc, 62) == (-1) | have_bigench(cc, 3) == 1) | findfaction(cc, "regist", "teleport")) {
			if (synccheck(cc, -1)) {
				txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
			}
		} else {
			repeat 200
				cNextX(cc) = rnd(mapWidth - 2) + 1
				cNextY(cc) = rnd(mapHeight - 2) + 1
				cell_check cNextX(cc), cNextY(cc)
				if (cellaccess == 1) {
					if (synccheck(cc, -1)) {
						snd 72
						txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
					}
					rowactend cc
					redraw 0
					gosub *label_0623
					break
				}
			loop
			iParam2(ri) = 0
			goto *label_1367
		}
	}
	if (p(64) == 0) {
		if (synccheck(cc, -1)) {
			txt -1, lang("宝箱は発火した。", "The chest ignites.")
		}
		repeat 6
			tlocx = cX(cc) + rnd(3) - rnd(3)
			tlocy = cY(cc) - rnd(3) + rnd(3)
			if (tlocx < 0 | tlocx >= mapWidth | tlocy < 0 | tlocy >= mapHeight) {
				continue
			}
			addmef tlocx, tlocy, 5, 24, rnd(15) + 20, 50, 0
			mapitem_fire tlocx, tlocy
		loop
	}
	if (p(64) == 1) {
		if (synccheck(cc, -1)) {
			txt -1, lang("毒ガスが噴き出した。", "Poisonous gas spreads.")
		}
		dmgcon cc, 1, 100 + iParam2(ri) * 2
	}
	if (p(64) == 2) {
		if (synccheck(cc, -1)) {
			txt -1, lang("催眠ガスが噴き出した。", "Sleeping gas spreads.")
		}
		dmgcon cc, 2, 100 + iParam2(ri) * 2
	}
	if (p(64) == 7) {
		txtef 9
		txt -1, lang(" *チュドーン！* ", "*kabooom*")
		aniref = 0
		animeid = 2
		anix = cX(cc)
		aniy = cY(cc)
		gosub *label_0630
		cell_featset cX(cc), cY(cc), 0
		if (gCurrentMap == 210 & ncgdata(306)) {
			dmghp cc, 1000000 + gCurrentDungeonLevel * 10000 + (cHp(cc) / 2), -1
		} else {
			dmghp cc, 100 + rnd(200), -1
		}
	}
	efsource = 0
	iParam2(ri) = 0
	return
*label_1826
	f = 1
	if (x < 0 | y < 0 | x >= mapWidth | y >= mapHeight) {
		f = 0
	} else {
		if (chipm(7, map(x, y, 0)) & 4) {
			f = 0
		}
	}
	if (dist(tlocx, tlocy, x, y) >= p) {
		f = 0
	}
	if (f == 0) {
		if (rnd(2) == 0) {
			return 0
		} else {
			return -1
		}
	}
	if (efid == 634) {
		addmef x, y, 4, 20, rnd(4) + 2, efp, cc
	}
	if (efid == 455) {
		addmef x, y, 3, 19, rnd(10) + 5, efp, cc
	}
	if (efid == 456) {
		addmef x, y, 5, 24, rnd(10) + 5, efp, cc
		mapitem_fire x, y
	}
	if (efid == 436) {
		addmef x, y, 1, 11, -1, efp * 2
	}
	if (efid == 437) {
		addmef x, y, 2, 30, 8 + rnd(15 + efp / 25), efp
	}
	return 1



#defcfunc buffy int __rrr
	if (__rrr >= 50) {
		p(63) = (25 + (usernpcmax / 33 + 1) * 2) * 48 + (__rrr / 50 - 1) * 32
	} else {
		p(63) = 1120
	}
	return p(63)
*label_1828
	if (s(4) == "" | s(4) == "empty") {
		return
	}
	if (jp) {
		sreplace buff, buff, "モンスター", s(4)
		sreplace buff, buff, "魔物", s(4)
	} else {
		sreplace buff, buff, "creature", s(4)
	}
	return
*label_1829
	ecount = 0
	memset searchene, 0, 15 * 4
	if (eqfaction(cc, "angel")) {
		return
	}
	procbody = *label_1833
	gosub *label_1830
	return
*label_1830
	ccsync = synccheck(cc, -1)
	repeat searchfov
		y = ypoint - searchdist + cnt
		if (y < 0 | y >= mapHeight) {
			continue
		}
		repeat searchfov
			x = xpoint - searchdist + cnt
			if (x < 0 | x >= mapWidth) {
				continue
			}
			c = map(x, y, 1) - 1
			if (c < 0) {
				continue
			}
			if (synccheck(c, -1) == 0) {
				if (ccsync != 0) {
					continue
				}
			}
			if (cbit(979, c) == 0) {
				gosub procbody
			}
		loop
	loop
	return
*label_1831
	if (relationbetween(cc, c) == 10) {
		if (cHp(c) <= cMaxHp(c) / (4 - (ocdata(1, cc) == 1) * 2)) {
			searchene(ecount) = c
			ecount++
		}
	}
	return
*label_1832
	if (cHp(c) < cMaxHp(c)) {
		searchene(ecount) = c
		ecount++
	}
	return
*label_1833
	if (relationbetween(cc, c) == (-3) | factionbetween(cc, c) == (-3)) {
		if (c == 0) {
			if (cRelationship(cc) > (-3)) {
				cRelationship(cc) = -3
			}
		}
		if (gettrait(c, 59) >= 2) {
			r1 = c
			gosub *label_1846
		}
		if (gettrait(c, 132)) {
			if (rnd(10) < calctraitscore(stat)) {
				addbuff c, 5, sorgEx(18, c) * 5 + 50, 5
			}
		}
		searchene(ecount) = c
		ecount++
	}
	return
*label_1834
	if (relationbetween(cc, c) == 10) {
		if (rnd(10) == 0) {
			dbmode = 14
			dbid = iId(ci)
			gosub *label_2426
			if (efid == 625 | efid == 446) {
				if (c == 0) {
					if (gMount != 0) {
						return
					}
				}
				if (ocdata(106, c) != 0) {
					return
				}
			}
			if (findbuff(c, sdataref(1, efid) \ 1000) == (-1)) {
				searchene(ecount) = c
				ecount++
			}
		}
	}
	return
*label_1835
	if (relationbetween(cc, c) == 10) {
		repeat 8 + 8
			i = 8 + 8 - cnt - 1
			if (bdataref(0, ocdata(192 + i * 3, c)) == 2) {
				dbmode = 14
				dbid = iId(ci)
				gosub *label_2426
				lint_efp = efp * (100 + sdata(174, cc) * 10 + sdata(16, cc) / 2 + sdata(13, cc) / 2) / 100
				efp = limitmax(lint_efp, INT_MAX)
				if (ocdata(192 + i * 3 + 1, c) < efp * 2) {
					searchene(ecount) = c
					ecount++
					break
				}
			}
		loop
	}
	return
*label_1836
	ecount = 0
	memset searchene, 0, 15 * 4
	if (eqfaction(cc, "angel")) {
		procbody = *label_1832
		gosub *label_1830
	} else {
		if (medicalcheck(cc)) {
			procbody = *label_1831
			gosub *label_1830
		}
	}
	if (ecount != 0) {
		return
	}
	if (eqfaction(cc, "holy")) {
		if (getfactionvalue(cc, "removehexby") != "") {
			p(74) = int(refstr)
			if (usablecheck(p(74), cc)) {
				ci = stat
				procbody = *label_1835
				gosub *label_1830
			}
		}
	}
	if (ocdata(155, cc)) {
		if (eqfaction(cc, "buffer")) {
			if (getfactionvalue(cc, "buffby") != "") {
				p(74) = int(refstr)
				if (usablecheck(p(74), cc)) {
					ci = stat
					procbody = *label_1834
					gosub *label_1830
				}
			}
		}
	}
	return
*label_1837
	if (cHate(cc) > 0 | cRelationship(cc) == 10) {
		distance = dist(cX(tc), cY(tc), cX(cc), cY(cc))
		if (cFear(cc) != 0) {
			retreat = 1
			goto *label_1567
		} else {
			retreat = 0
		}
		if (cBlind(cc) != 0) {
			if (rnd(3)) {
				goto *label_1564
			}
		}
		if (eqfaction(cc, "angel")) {
			if (cHp(tc) < cMaxHp(tc)) {
				goto *label_1749
			}
			unwatchon cc, tc
			goto *label_1560
		}
		if (medicalcheck(cc)) {
			if (cHp(tc) <= cMaxHp(tc) / (4 - (ocdata(1, cc) == 1) * 2)) {
				goto *label_1749
			}
		}
		if (eqfaction(cc, "holy")) {
			if (getfactionvalue(cc, "removehexby") != "") {
				p(74) = int(refstr)
				if (usablecheck(p(74), cc)) {
					p(73) = stat
					if (p(74) / 10000 == 9) {
						f = 0
						repeat 8 + 8
							i = 8 + 8 - cnt - 1
							if (bdataref(0, ocdata(192 + i * 3, tc)) == 2) {
								dbmode = 14
								dbid = p(74) \ 10000
								gosub *label_2426
								lint_efp = efp * (100 + sdata(174, cc) * 10 + sdata(16, cc) / 2 + sdata(13, cc) / 2) / 100
								efp = limitmax(lint_efp, INT_MAX)
								if (ocdata(192 + i * 3 + 1, tc) / 2 < efp * 2) {
									f = 1
									break
								}
							}
						loop
						if (f) {
							if (distance > 1) {
								goto *label_1770
							}
							ci = p(73)
							goto *label_1424
						}
					}
				}
			}
		}
		if (ocdata(155, cc)) {
			if (eqfaction(cc, "buffer")) {
				if (getfactionvalue(cc, "buffby") != "") {
					p(74) = int(refstr)
					if (usablecheck(p(74), cc)) {
						p(73) = stat
						if (p(74) / 10000 == 9) {
							dbmode = 14
							dbid = p(74) \ 10000
							gosub *label_2426
							if (findbuff(tc, sdataref(1, efid) \ 1000) == (-1)) {
								if (distance > 1) {
									goto *label_1770
								}
								ci = p(73)
								goto *label_1424
							}
						}
					}
				}
			}
		}
		unwatchon cc, tc
		goto *label_1560
	}
	goto *label_1563



#deffunc usersnd str __sss
	if (cfg_sound == 0) {
		return
	}
	sound@m18 = 7
	f@m18 = 0
	if (f@m18 == 0) {
		repeat 6, 7
			CHECKPLAY cnt
			if (stat == 0) {
				sound@m18 = cnt
				soundlist(cnt - 7) = sound@m18
			}
		loop
	}
	if (cfg_sound == 1) {
		DSLOADFNAME __sss, sound@m18
	} else {
		mmload __sss, sound@m18
	}
	if (cfg_sound == 1) {
		DSPLAY sound@m18, 0
	} else {
		mmplay sound@m18
	}
	return



#defcfunc hostileactioncheck int __ttt
	if (sdataref(1, __ttt) == 4) {
		return 0
	}
	if (sdataref(1, __ttt) == 12) {
		return 0
	}
	if (sdataref(1, __ttt) == 13) {
		return 0
	}
	if (sdataref(1, __ttt) / 1000 == 1) {
		if (bdataref(0, sdataref(1, __ttt) \ 1000) == 1) {
			return 0
		}
	}
	return 1



#deffunc resetuserspell int __uuu
	sdataref(0, 550 + __uuu) = userspelldata(0, __uuu), userspelldata(1, __uuu), userspelldata(2, __uuu), userspelldata(3, __uuu), userspelldata(4, __uuu)
	skillname(550 + __uuu) = userspelldatan(0, __uuu)
	if (userspelldata(1, __uuu) == 1) {
		skilldesc(550 + __uuu) = skillname(int(jseval(userspelldatan(4, __uuu)))) + lang("のボルト", " bolt")
	} else {
		if (userspelldata(1, __uuu) == 2) {
			skilldesc(550 + __uuu) = skillname(int(jseval(userspelldatan(4, __uuu)))) + lang("の矢", " dart")
		} else {
			if (userspelldata(1, __uuu) == 3) {
				skilldesc(550 + __uuu) = skillname(int(jseval(userspelldatan(4, __uuu)))) + lang("の球", " ball")
			} else {
				if (userspelldata(1, __uuu) == 4) {
					if (userspelldata(3, __uuu) / 1000 == 3) {
						skilldesc(550 + __uuu) = lang("体力回復の球", "Heal ball")
					} else {
						skilldesc(550 + __uuu) = lang("体力回復", "Heal self")
					}
				} else {
					if (userspelldata(1, __uuu) == 11) {
						skilldesc(550 + __uuu) = lang("全域攻撃", "Massive attack")
					} else {
						if (userspelldata(1, __uuu) == 12) {
							skilldesc(550 + __uuu) = lang("全ての呪い(hex)除去", "Removes all hexes")
						} else {
							if (userspelldata(1, __uuu) == 13) {
								skilldesc(550 + __uuu) = lang("アイテム解呪", "Uncurse items")
							}
						}
					}
				}
			}
		}
	}
	return 1
*label_1841
	if (areaType(p) == 21) {
		if (incspawnrate(10)) {
			oabitmod 10, p, 1
			return 1
		}
	}
	if (cFame(0) >= 1000000 & ogdata(499) == 2) {
		if (areaDangerLevel(p) >= 200) {
			if (incspawnrate(30)) {
				nogo = 0
				repeat 500 - 450, 450
					if (oabit(18, cnt)) {
						nogo = 1
						break
					}
				loop
				if (nogo) {
					return 0
				}
				oabitmod 18, p, 1
				areaType(p) = 21
				areaAppearance(p) = 145
				areaDangerLevel(p) = 666
				areaLastFloor(p) = 765
				return 1
			}
		}
	}
	if (cFame(0) >= 1000000 & ogdata(499) == 2) {
		if (areaDangerLevel(p) >= 200) {
			if (incspawnrate(30)) {
				nogo = 0
				repeat 500 - 450, 450
					if (oabit(17, cnt) | oabit(18, cnt)) {
						nogo = 1
						break
					}
				loop
				if (nogo) {
					return 0
				}
				oabitmod 17, p, 1
				areaType(p) = 21
				areaAppearance(p) = 145
				areaDangerLevel(p) = 666
				areaLastFloor(p) = 765
				return 1
			}
		}
	}
	if (areaDangerLevel(p) > 100) {
		if (incspawnrate(30)) {
			oabitmod 5, p, 1
			return 1
		}
	}
	if (areaDangerLevel(p) > 20) {
		if (areaType(p) == 21) {
			if (incspawnrate(10)) {
				oabitmod 0, p, 1
				return 1
			} else {
				if (incspawnrate(10)) {
					oabitmod 8, p, 1
					return 1
				}
			}
		}
		if (areaType(p) == 22) {
			if (incspawnrate(30)) {
				oabitmod 6, p, 1
				return 1
			}
		}
	} else {
		if (rnd(10) == 0) {
			oabitmod 12, p, 1
			return 1
		}
	}
	if (minbosslv <= 2000) {
		if (areaLastFloor(p) >= minbosslv) {
			if (areaType(p) == 20) {
				if (incspawnrate(30)) {
					oabitmod 3, p, 1
					return 1
				}
			}
		}
	}
	if (areaDangerLevel(p) >= 2) {
		if (areaType(p) == 23) {
			if (incspawnrate(10)) {
				oabitmod 16, p, 1
				return 1
			}
		}
	}
	if (rnd(5)) {
		area_no = p
		minlevel = difficulty() / 2
		sdim factionref, 10, 3
		repeat 10
			flt areaDangerLevel(area_no), 2
			characreate 56, 0, -3, 0
			if (stat) {
				if (cRelationship(rc) != (-3) | cOriginalRelationship(rc) != (-3)) {
					continue
				}
				if (cLevel(rc) < minlevel) {
					if (cnt != 9) {
						continue
					}
				}
				getfactionvalues rc, "family", factionref
				p(61) = stat
				if (p(61) == 0) {
					continue
				}
				oabitmod 11, area_no, 1
				addfaction area_no - 450 + 245, "family," + factionref(rnd(p(61)))
				chara_vanquish 56
				break
			}
		loop
		p = area_no
		return 1
	}
	return 0



*itemGen_containerize
	if (contafurniturecheck(iId(ci)) != (-1)) {
		if (iCount(ci) < 1000) {
			iCount(ci) = 1000 - iId(ci)
		}
	}
	return



*label_1843
	dim isetcontafurniture, 3, 12
	isetcontafurniture(0, 0) = 773, 50, 8
	isetcontafurniture(0, 1) = 318, 16, 8
	isetcontafurniture(0, 2) = 151, 24, 8
	isetcontafurniture(0, 3) = 78, 16, 8
	isetcontafurniture(0, 4) = 645, 32, 9
	isetcontafurniture(0, 5) = 302, 16, 9
	isetcontafurniture(0, 6) = 150, 24, 9
	isetcontafurniture(0, 7) = 79, 24, 9
	isetcontafurniture(0, 8) = 124, 32, 10
	isetcontafurniture(0, 9) = 100, 16, 11
	isetcontafurniture(0, 10) = 296, 24, 12
	isetcontafurniture(0, 11) = 774, 32, 12
	return



#defcfunc contafurniturecheck int __vvv
	p(47) = -1
	repeat length2(isetcontafurniture)
		if (__vvv == isetcontafurniture(0, cnt)) {
			p(47) = cnt
			break
		}
	loop
	return p(47)
*label_1845
	if (synccheck(cc, -1)) {
		txt -1, lang(name(cc) + "は盾で" + name(tc) + "を殴りつけた。", name(cc) + " bash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " shield.")
	}
	dmghp tc, rnd(sdata(168, cc)) + 1, cc
	dmgcon tc, 7, 50 + int(sqrt(sdata(168, cc))) * 15
	if (cParalyzed(tc) < 1000) {
		cParalyzed(tc) += rnd(3)
	}
	return
*label_1846
	if (gdata(809) != 1) {
		if (cFurious(r1) == 0) {
			if (rnd(20) == 0) {
				if (synccheck(r1, -1)) {
					txtef 4
					txt -1, lang(name(r1) + "は怒りに体を奮わせた！", name(r1) + " " + is(r1) + " engulfed in fury!")
				}
				cFurious(r1) += rnd(30) + 15
			}
		}
	}
	return



#deffunc funcend str __www
	oomSEST_log __www + ":End"
	return
*label_1848
	repeat counterattack
		ccbk@se = cc
		tcbk@se = tc
		cc = tcbk@se
		tc = ccbk@se
		gosub *label_1442
		cc = ccbk@se
		tc = tcbk@se
	loop
	counterattack = 0
	return



#deffunc modstress int __xxx
	p(46) = 0
	if (ocdata(140, 0) < 6000) {
		if (ocdata(140, 0) / 2000 != (ocdata(140, 0) + __xxx) / 2000) {
			p(46) = 1
		}
	}
	if (ocdata(140, 0) < 0) {
		ocdata(140, 0) = 0
	}
	ocdata(140, 0) += __xxx
	if (ocdata(140, 0) > 12000) {
		ocdata(140, 0) = 12000
	}
	if (p(46)) {
		r1 = 0
		gosub *chara_refresh
	}
	return



#deffunc calcempower int __yyy
	if (gettrait(cc, 165) != 0) {
		if (ele == 50 | ele == 51 | ele == 52) {
			dice2 = dice2 * 125 / 100
		}
	}
	if (__yyy < 400) {
		return
	}
	if (__yyy >= 600) {
		return
	}
	if (ele != 50 & ele != 51 & ele != 52 & ele != 53 & ele != 54 & ele != 57) {
		return
	}
	if (gettrait(cc, ele + 38) != 0) {
		dice2 += calc3traitmulti(stat, dice2)
	}
	return



#defcfunc difficulty
	return limit(cFame(0) / 600, 1, 65535)



#defcfunc incspawnrate int __zzz
	return rnd(limitmin(__zzz - revisespawnrate, 5)) == 0



#defcfunc decspawnrate int __aaa
	return rnd(limitmax(__aaa + revisespawnrate, 30)) == 0



#defcfunc usablecheck int __bbb, int __ccc
	if (__bbb >= 10000) {
		inv_find __bbb \ 10000, __ccc
		if (stat != (-1)) {
			p(72) = stat
			if (ibit(4, p(72))) {
				if (iCount(p(72)) > 0) {
					return p(72)
				}
			} else {
				return p(72)
			}
		}
	}
	return 0



#deffunc modgrowth2 int __ddd, int __eee, int __fff
	p@m76 = __fff * (100 + calctraitgrowthrate(__ddd, __eee)) / 100
	if (__eee >= 400) {
		if (gettrait(__ddd, 80)) {
			lv@m76 = stat
			p@m76 += p@m76 * limit(calctraitscore(lv@m76) - sgrowth(__eee, __ddd) / 15, 1, calctraitscore(lv@m76))
		}
	}
	modgrowth __ddd, __eee, p@m76
	return
*label_1856
	if (tc > 15) {
		txt -1, lang("仲間にしか騎乗できない。", name(cc) + " can only ride an ally.")
		return
	}
	if (cbit(963, tc) == 1 | cbit(971, tc) == 1) {
		txt -1, lang("護衛対象には騎乗できない。", name(cc) + " can't ride a client.")
		return
	}
	if (tc == cc) {
		txt -1, lang(name(cc) + "は自分に乗ろうとした。", name(cc) + " try to ride yourself.")
		return
	}
	if (cCurrentMap(tc) != 0) {
		txt -1, lang("その仲間はこの場所に滞在中だ。", "The ally currently stays in this area.")
		return
	}
	if (tc == gMount) {
		txt -1, lang("現在" + name(tc) + "は" + name(0) + "が騎乗している。", name(tc) + " is currently being ridden by " + name(0) + ".")
		return
	}
	if (ocdata(107, tc) != 0) {
		txt -1, lang("現在" + name(tc) + "は" + name(ocdata(107, tc)) + "が騎乗している。", name(tc) + " is currently being ridden by " + name(ocdata(107, tc)) + ".")
		return
	}
	if (ocdata(106, tc) != 0) {
		txt -1, lang("現在" + name(tc) + "は" + name(ocdata(106, tc)) + "に騎乗している。", name(tc) + " " + is(tc) + " currently riding " + name(ocdata(106, tc)) + ".")
		return
	}
	txt -1, lang(name(cc) + "は" + name(tc) + "に騎乗した。", name(cc) + " ride " + name(tc) + ".")
	ride_begin tc, cc
	return
*label_1857
	repeat 15, 1
		if (cState(cnt) == 1) {
			if (ocdata(107, cnt) != 0) {
				p@m121 = cnt
				refreshspeed p@m121
			}
		}
	loop
	return
#include "god.hsp"



#deffunc natureinit int __ppp
	rndshuffle csetnature
	i@m3 = 1 + rnd(rnd(3) + 1)
	if (rnd(3)) {
		if (cId(__ppp) == 211) {
			addfaction __ppp, "nature,noble"
			i@m3--
		}
	}
	repeat i@m3
		addfaction __ppp, "nature," + naturen(0, csetnature(cnt))
	loop
	return



#defcfunc guildcheck int __qqq
	s@m3 = ""
	if (gdata(250 + 13) != 0) {
		s@m3 = "mage"
	}
	if (gdata(250 + 14) != 0) {
		s@m3 = "fighter"
	}
	if (gdata(250 + 15) != 0) {
		s@m3 = "thieve"
	}
	if (s@m3 != "") {
		if (__qqq == 0) {
			return s@m3
		}
	}
	s@m3 = getfactionvalue(__qqq, "guild")
	return s@m3



#defcfunc filtercheck int __sss, str __ttt
	if (eqfaction(__sss, __ttt)) {
		return 1
	}
	if (cId(__sss) == 343) {
		if (cCnpcId(__sss) != usernpcmax) {
			filtert@m3 = userdatan(4, cCnpcId(__sss))
		} else {
			s@m3 = ""
		}
	} else {
		filtert@m3 = refchara(cId(__sss), 8, 1)
	}
	if (instr(filtert@m3, 0, "/" + __ttt + "/") != (-1)) {
		return 1
	}
	return 0



#defcfunc gettrait int __uuu, int __vvv
	oomSEST_log "gettrait:Begin" + " unit_no:" + __uuu + " trait_id:" + __vvv
	s@m3 = getfactionvalue(__uuu, "trait" + __vvv)
	if (s@m3 != "") {
		p@m3 = int(s@m3)
	} else {
		p@m3 = 0
	}
	if (p@m3 == 0) {
		if (__uuu == 0) {
			p@m3 = trait(__vvv)
		}
	}
	funcend "gettrait"
	return p@m3



#deffunc addtrait int __www, int __xxx, int __yyy
	if (__www == 0) {
		if (vanillatraitcheck(__xxx, __yyy)) {
			trait(__xxx) += __yyy
			return 1
		}
	}
	p@m3 = gettrait(__www, __xxx)
	rmfaction __www, "trait" + __xxx + "," + p@m3
	p@m3 = p@m3 + __yyy
	if (p@m3 != 0) {
		addfaction __www, "trait" + __xxx + "," + p@m3
	}
	return 1



#deffunc settrait int __zzz, int __aaa, int __bbb
	if (__zzz == 0) {
		if (vanillatraitcheck(__aaa, __bbb)) {
			trait(__aaa) = __bbb
			return 1
		}
	}
	p@m3 = gettrait(__zzz, __aaa)
	rmfaction __zzz, "trait" + __aaa + "," + p@m3
	p@m3 = __bbb
	if (p@m3 != 0) {
		addfaction __zzz, "trait" + __aaa + "," + p@m3
	}
	return 1



#defcfunc getperseverance int __ccc
	if (__ccc == 0) {
		return 100
	}
	p@m3 = 0
	sdim naturevalues@m3, 3
	getfactionvalues __ccc, "nature", naturevalues@m3
	if (stat == 0) {
		natureinit __ccc
		getfactionvalues __ccc, "nature", naturevalues@m3
	}
	i@m3 = stat
	repeat i@m3
		s@m3 = naturevalues@m3(cnt)
		repeat length2(naturen)
			if (naturen(0, cnt) == s@m3) {
				_switch_val@m3 = nrdataref(0, cnt)
				if (_switch_val@m3 == 1 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 40
					goto *label_1892
					_switch_sw@m3++
				}
				if (_switch_val@m3 == 2 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 50
					goto *label_1892
					_switch_sw@m3++
				}
				if (_switch_val@m3 == 3 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 200
					goto *label_1892
					_switch_sw@m3++
				}
				if (_switch_val@m3 == 4 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 100
					goto *label_1892
					_switch_sw@m3++
				}
				if (_switch_val@m3 == 5 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 80
					goto *label_1892
					_switch_sw@m3++
				}
				if (_switch_val@m3 == 6 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 60
					goto *label_1892
					_switch_sw@m3++
				}
				if (_switch_val@m3 == 7 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 20
					goto *label_1892
					_switch_sw@m3++
				}
				if (_switch_val@m3 == 8 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 10
					goto *label_1892
				}
				if (_switch_val@m3 == 9 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 += 1000
					goto *label_1892
				}
				if (_switch_val@m3 == 10 | _switch_sw@m3) {
					_switch_sw@m3 = 0
					p@m3 = 10
					goto *label_1892
				}
*label_1892
				break
			}
		loop
	loop
	return p@m3 / i@m3



#defcfunc vanillatraitcheck int __ddd, int __eee
	if (__ddd >= 200) {
		if (__ddd >= 217) {
			return 0
		}
	} else {
		if (__ddd >= 150) {
			if (__ddd >= 170) {
				return 0
			}
		} else {
			if (__ddd >= 0) {
				if (__ddd >= 45) {
					return 0
				}
			}
		}
	}
	p@m3 = gettrait(0, __ddd)
	if (__ddd == 20) {
		if (p@m3 + __eee >= 3) {
			return 0
		}
	}
	if (__ddd == 43) {
		if (p@m3 + __eee >= 2) {
			return 0
		}
	}
	if (__ddd == 19) {
		if (p@m3 + __eee >= 3) {
			return 0
		}
	}
	return 1



#defcfunc calc5traitmulti int __fff, double __ggg
	if (__fff == 5) {
		return __ggg
	} else {
		if (__fff == 4) {
			return __ggg * 7 / 10
		} else {
			if (__fff == 3) {
				return __ggg * 7 / 20
			} else {
				if (__fff == 2) {
					return __ggg * 3 / 20
				} else {
					return __ggg / 20
				}
			}
		}
	}



#deffunc setweapontrait int __hhh, int __iii
	traitref = 0, 0, 5, 1, 0, 100, -1
	traitrefn2 = lang(skillname(__hhh) + "の見習い", skillname(__hhh) + " Novice"), lang(skillname(__hhh) + "の習熟", skillname(__hhh) + " Apprentice"), lang(skillname(__hhh) + "の使い手", skillname(__hhh) + " Journeyman"), lang(skillname(__hhh) + "の達人", skillname(__hhh) + " Expert"), lang(skillname(__hhh) + "の極み", skillname(__hhh) + " Master")
	if (__iii >= 0) {
		traitrefn(2) = lang("実戦で" + skillname(__hhh) + "の扱いを学ぶ", "Combat experience teaches you to ably use "  + skillname(__hhh) + "."), lang("あなたは" + skillname(__hhh) + "の扱いを知っている[" + skillname(__hhh) + "の攻撃倍率+5%]", "You know how to wield " + skillname(__hhh) + ". [" + skillname(__hhh) + " DMG +5%]"), lang("あなたは" + skillname(__hhh) + "の扱いに長けている[" + skillname(__hhh) + "の攻撃倍率+15%]", "You know your way around with " + skillname(__hhh) + ". [" + skillname(__hhh) + " DMG +15%]"), lang("あなたは" + skillname(__hhh) + "を巧みに操る[" + skillname(__hhh) + "の攻撃倍率+35%]", "You are skilled with " + skillname(__hhh) + ". [" + skillname(__hhh) + " DMG +35%]"), lang("あなたは" + skillname(__hhh) + "の達人だ[" + skillname(__hhh) + "の攻撃倍率+70%]", "You are an expert with " + skillname(__hhh) + ". [" + skillname(__hhh) + " DMG +70%]"), lang("あなたは" + skillname(__hhh) + "を極めている[" + skillname(__hhh) + "の攻撃倍率+100%]", "You have achieved mastery with " + skillname(__hhh) + ". [" + skillname(__hhh) + " DMG +100%]")
	}

	return



#defcfunc calc3traitmulti int __jjj, double __kkk
	if (__jjj == 3) {
		return __kkk / 2
	} else {
		if (__jjj == 2) {
			return __kkk * 3 / 10
		} else {
			return __kkk / 10
		}
	}



#defcfunc calctraitscore int __lll
	if (__lll == 5) {
		return 10
	} else {
		if (__lll == 4) {
			return 7
		} else {
			if (__lll == 3) {
				return 5
			} else {
				if (__lll == 2) {
					return 3
				} else {
					return 1
				}
			}
		}
	}



#defcfunc calcknucklepierce int __mmm
	if (cEquipmentType(__mmm) == 0) {
		if (gettrait(__mmm, 69)) {
			if (stat == 5) {
				return 100
			} else {
				if (stat == 4) {
					return 70
				} else {
					if (stat == 3) {
						return 35
					} else {
						if (stat == 2) {
							return 15
						} else {
							return 5
						}
					}
				}
			}
		}
	}
	return 0



#defcfunc calcweightmulti int __nnn
	if (gettrait(__nnn, 76)) {
		if (stat == 5) {
			return 100
		} else {
			if (stat == 4) {
				return 70
			} else {
				if (stat == 3) {
					return 35
				} else {
					if (stat == 2) {
						return 15
					} else {
						return 5
					}
				}
			}
		}
	}
	return 0



#defcfunc calctraitgrowthrate int __ooo, int __ppp
	if (__ppp == 187) {
		if (gettrait(__ooo, 8)) {
			return stat * 40
		}
	} else {
		if (__ppp == 159) {
			if (gettrait(__ooo, 6)) {
				return stat * 30
			}
		} else {
			if (__ppp == 173) {
				if (gettrait(__ooo, 10)) {
					return stat * 20
				}
			} else {
				if (__ppp == 172) {
					if (gettrait(__ooo, 12)) {
						return stat * 40
					}
				} else {
					if (__ppp == 156) {
						if (gettrait(__ooo, 16)) {
							return stat * 40
						}
					} else {
						if (__ppp == 181) {
							if (gettrait(__ooo, 17)) {
								return stat * 40
							}
						} else {
							if (__ppp == 152) {
								if (gettrait(__ooo, 82)) {
									return stat * 40
								}
							} else {
								if (__ppp == 160) {
									if (gettrait(__ooo, 101)) {
										return stat * 40
									}
								} else {
									if (__ppp == 182) {
										if (gettrait(__ooo, 102)) {
											return stat * 40
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	if (nc_gettrait(__ooo, 108)) {
		return 20
	}
	return 0



#defcfunc factionbetween int __qqq, int __rrr
	oomSEST_log "factionbetween:Begin"
	resetfaction __qqq
	resetfaction __rrr
	if (getfactionvalue(__qqq, "pet") != "") {
		if (__rrr == int(refstr)) {
			funcend "factionbetween"
			return 0
		} else {
			if (findfaction(__rrr, "pet", refstr)) {
				funcend "factionbetween"
				return 0
			}
		}
	}
	if (getfactionvalue(__rrr, "pet") != "") {
		if (__qqq == int(refstr)) {
			funcend "factionbetween"
			return 0
		}
	}
	if (areaId(gCurrentMap) == 3 | areaId(gCurrentMap) == 9 | areaId(gCurrentMap) == 16 | areaId(gCurrentMap) == 17 | areaId(gCurrentMap) == 18 | areaId(gCurrentMap) == 19 | areaId(gCurrentMap) == 27 | areaId(gCurrentMap) == 37 | gCurrentMap == 35) {
		return 0
	}
	if (ogdata(29)) {
		if (getrelation(__qqq) == (-3) & getrelation(__rrr) == (-3)) {
			if (getfactionvalue(__qqq, "guild") != "") {
				if (findfactionvalue(__qqq, __rrr, "guild") == 0) {
					funcend "factionbetween"
					return hatecheck(__qqq, 300)
				}
			}
		}
	}
	if (oabit(10, gCurrentMap)) {
		if (godcheck(__rrr) != godcheck(__qqq)) {
			funcend "factionbetween"
			return hatecheck(__qqq, 300)
		}
	}
	if (__rrr == 0) {
		if (gettrait(__rrr, 183) != 0) {
			if (findfaction(__qqq, "family", "wild")) {
				return hatecheck(__qqq, 300)
			}
		}
	}
	if (findfaction(__qqq, "align", "lawful")) {
		if (getrelation(__qqq) >= 0) {
			if (getrelation(__rrr) == (-3)) {
				if (godcheck(__rrr) != godcheck(__qqq)) {
					if (cId(__qqq) != 331 & cId(__qqq) != 306 & cId(__qqq) != 338 & cId(__qqq) != 339 & cId(__qqq) != 342 & cId(__qqq) != 366 & cId(__qqq) != 367) {
						funcend "factionbetween"
						hc@00m = hatecheck(__qqq, 60)
						return hc@00m
					}
				}
			}
		} else {
			if (getrelation(__qqq) >= (-2)) {
				if (getrelation(__rrr) == (-3)) {
					if (godcheck(__rrr) != godcheck(__qqq)) {
						funcend "factionbetween"
						hc@00m = hatecheck(__qqq, 10)
						return hc@00m
					}
				}
			} else {
				if (godcheck(__rrr) != godcheck(__qqq)) {
					funcend "factionbetween"
					hc@00m = hatecheck(__qqq, 60)
					return hc@00m
				}
			}
		}
	} else {
		if (findfaction(__qqq, "align", "neutral")) {
			if (getrelation(__qqq) >= 0) {
				if (getrelation(__rrr) == (-3)) {
					if (findfaction(__rrr, "align", "chaotic")) {
						funcend "factionbetween"
						hc@00m = hatecheck(__qqq, 60)
						return hc@00m
					}
				}
			} else {
				if (getrelation(__qqq) >= (-2)) {
					return 0
				} else {
					if (getrelation(__rrr) >= 0) {
						if (findfaction(__rrr, "align", "lawful") == 0) {
							funcend "factionbetween"
							hc@00m = hatecheck(__qqq, 60)
							return hc@00m
						}
					}
				}
			}
		} else {
			if (findfaction(__qqq, "align", "chaotic")) {
				if (getrelation(__qqq) >= 0) {
					if (getrelation(__rrr) == (-3)) {
						if (findfactionvalue(__qqq, __rrr, "family") == 0) {
							funcend "factionbetween"
							hc@00m = hatecheck(__qqq, 60)
							return hc@00m
						}
					}
				} else {
					if (getrelation(__qqq) >= (-2)) {
						if (findfactionvalue(__qqq, __rrr, "family") == 0) {
							funcend "factionbetween"
							hc@00m = hatecheck(__qqq, 10)
							return hc@00m
						}
					} else {
						if (findfactionvalue(__qqq, __rrr, "family") == 0) {
							funcend "factionbetween"
							hc@00m = hatecheck(__qqq, 60)
							return hc@00m
						}
					}
				}
			}
		}
	}
	funcend "factionbetween"
	return 0



#defcfunc hatecheck int __sss, int __ttt
	if (getperseverance(__sss) < rnd(1 + __ttt)) {
		return -3
	}
	return 0



#defcfunc getrelation int __uuu
	if (__uuu == 0) {
		if (gettrait(__uuu, 169)) {
			return 0
		}
		if (gettrait(__uuu, 162)) {
			return -3
		}
		return -1
	}
	return cOriginalRelationship(__uuu)



#defcfunc findfaction int __vvv, str __www, str __xxx
	if (instr(faction(__vvv), 0, "/" + __www + "," + __xxx + "/") != (-1)) {
		return 1
	} else {
		return 0
	}



#defcfunc findfactionvalue int __yyy, int __zzz, str __aaa
	found@m4 = 0
	dim values@m4, 32
	getfactionvalues __yyy, __aaa, values@m4
	repeat stat
		if (findfaction(__zzz, __aaa, values@m4(cnt))) {
			found@m4 = 1
			break
		}
	loop
	return found@m4



#defcfunc getfactionvalue int __bbb, str __ccc
	dim factions@m4, 32
	split faction(__bbb), "/", factions@m4
	factionvalue@m4 = ""
	repeat stat
		if (factions@m4(cnt) == "") {
			continue
		}
		e@m4 = factions@m4(cnt)
		if (strmid(e@m4, 0, strlen(__ccc + ",")) == __ccc + ",") {
			sdim subfaction@m4, 2
			split e@m4, ",", subfaction@m4
			factionvalue@m4 = subfaction@m4(1)
			break
		}
	loop
	return factionvalue@m4



#deffunc getfactionvalues int __ddd, str __eee, array __fff
	dim factionst@m4, 32
	split faction(__ddd), "/", factionst@m4
	lim@m4 = 0
	repeat stat
		if (strlen(factionst@m4(cnt)) == 0) {
			continue
		}
		e@m4 = factionst@m4(cnt)
		if (strmid(e@m4, 0, strlen(__eee)) == __eee) {
			sdim subfaction@m4, 2
			split e@m4, ",", subfaction@m4
			if (stat > 1) {
				__fff(lim@m4) = subfaction@m4(1)
				lim@m4++
			}
		}
	loop
	return lim@m4



#defcfunc getfactionlabel array __ggg, str __hhh
	if (en) {
		return __hhh
	}
	flabel@m4 = ""
	repeat length2(__ggg)
		if (__ggg(0, cnt) == __hhh) {
			flabel@m4 = __ggg(1, cnt)
			break
		}
	loop
	return flabel@m4



#deffunc addfaction int __iii, str __jjj
	if (eqfaction(__iii, __jjj)) {
		return
	}
	s@m4 = faction(__iii)
	if (strlen(s@m4) == 0) {
		s@m4 += "/"
	}
	faction(__iii) = s@m4 + __jjj + "/"
	return



#deffunc rmfaction int __kkk, str __lll
	sdim factionvaluest@m4, 32
	getfactionvalues __kkk, __lll, factionvaluest@m4
	repeat stat
		sreplace faction(__kkk), faction(__kkk), "/" + __lll + "," + factionvaluest@m4(cnt) + "/", "/"
	loop
	sreplace faction(__kkk), faction(__kkk), "/" + __lll + "/", "/"
	if (strlen(faction(__kkk)) == 1) {
		faction(__kkk) = ""
	}
	return 1

#deffunc rmfactionat int prm_1584, str prm_1585, str prm_1586
	sdim factionvaluest@m4, 32
	getfactionvalues prm_1584, prm_1585, factionvaluest@m4
	repeat stat
		if (strmid(factionvaluest@m4(cnt), 0, strlen(prm_1586)) == prm_1586) {
			sreplace faction(prm_1584), faction(prm_1584), prm_1585 + "," + factionvaluest@m4(cnt) + "/", ""
		}
	loop
	if (strlen(faction(prm_1584)) == 1) {
		faction(prm_1584) = ""
	}
	return 1


#defcfunc eqfaction int __mmm, str __nnn
	if (instr(faction(__mmm), 0, "/" + __nnn + "/") != (-1)) {
		return 1
	} else {
		return 0
	}



#deffunc getencproc array __ooo, int __ppp, int __qqq
	__ooo = 0
	if (iId(__ppp) == 743) {
		ci2@m5 = inv(31, __ppp)
		repeat 9
			if (useritemencprocref(0, cnt, ci2@m5)) {
				if (__qqq == useritemencprocref(0, cnt, ci2@m5)) {
					__ooo = useritemencprocref(1, cnt, ci2@m5), useritemencprocref(2, cnt, ci2@m5), useritemencprocref(3, cnt, ci2@m5), useritemencprocref(4, cnt, ci2@m5), useritemencprocref(5, cnt, ci2@m5), useritemencprocref(6, cnt, ci2@m5)
					break
				}
			}
		loop
	}
	return



#defcfunc getencplimit int __rrr
	val@m5 = __rrr / 10000
	if (val@m5 != 0) {
		if (val@m5 == 1) {
			return 50
		}
		if (val@m5 == 2) {
			return 100
		}
		if (val@m5 == 3) {
			return 200
		}
		if (val@m5 == 6) {
			return 100
		}
		if (val@m5 == 7) {
			return 100
		}
		if (val@m5 == 8) {
			return 50
		}
		if (val@m5 == 9) {
			return 1000
		}
	}
	if (__rrr == 29) {
		return 100
	}
	if (__rrr == 40) {
		return 100
	}
	return 50



#defcfunc ocbit int __sss, int __ttt
	HMMBITCHECK ocdata(240 + __sss / 32, __ttt), __sss \ 32
	return abs(stat)



#deffunc ocbitmod int __uuu, int __vvv, int __www
	if (__www == 0) {
		HMMBITOFF ocdata(240 + __uuu / 32, __vvv), __uuu \ 32
		return
	}
	HMMBITON ocdata(240 + __uuu / 32, __vvv), __uuu \ 32
	return



#defcfunc calcread int __xxx, int __yyy, int __zzz
	f@m7 = 1
	tc = cc
	if (cBlind(cc) != 0) {
		f@m7 = 0
	}
	if (cConfused(cc) != 0 | cDimmed(cc) != 0) {
		if (rnd(4) != 0) {
			f@m7 = 0
		}
	} else {
		if (__yyy == 0) {
			r1@m7 = sdata(16, cc)
		} else {
			r1@m7 = sdata(sdataref(0, __yyy), cc)
		}
		if (__zzz != 0) {
			if ((sdata(150, cc) * r1@m7 * 4 + 250) / __zzz < __xxx) {
				f@m7 = 0
			}
		} else {
			if (rndex(sdata(150, cc) * r1@m7 * 4 + 250) < rndex(__xxx + 1)) {
				if (rnd(7) == 0) {
					f@m7 = 0
				}
				if (r1@m7 * 10 < __xxx) {
					if (rnd(r1@m7 * 10 + 1) < rnd(__xxx + 1)) {
						f@m7 = 0
					}
				}
				if (r1@m7 * 20 < __xxx) {
					if (rnd(r1@m7 * 20 + 1) < rnd(__xxx + 1)) {
						f@m7 = 0
					}
				}
				if (r1@m7 * 30 < __xxx) {
					if (rnd(r1@m7 * 30 + 1) < rnd(__xxx + 1)) {
						f@m7 = 0
					}
				}
			}
		}
	}
	return f@m7



#defcfunc calcfixexp int __aaa, int __bbb
	i@m8 = 100
	if (cNutrition(__aaa) >= 5000) {
		p@m8 = (cNutrition(__aaa) - 5000) / 25
		i@m8 = i@m8 * 100 / (100 + p@m8)
	}
	if (__aaa != 0) {
		i@m8 = 1500
		if (iMaterial(__bbb) == 35) {
			if (iParam3(__bbb) < 0) {
				if (cbit(14, __aaa) == 0) {
					i@m8 = 500
				}
			}
		}
	}
	if (findbuff(__aaa, 81) != (-1)) {
		if (godcheck(__aaa) == "kumiromi") {
			i@m8 = i@m8 * (100 + limit(ocdata(192 + findbuff(__aaa, 81) * 3 + 1, __aaa) / 50, 0, 2000)) / 100
		}
	}
	return i@m8



#defcfunc creategodno
	isetgodmax@m9 = length(isetgod)
	return rnd(isetgodmax@m9 + usergodmax)



#defcfunc blessgod
	i@m9 = creategodno()
	if (i@m9 < isetgodmax@m9) {
		return isetgod(i@m9)
	} else {
		return creategoduid(i@m9 - isetgodmax@m9)
	}



#defcfunc blesscgod int __ccc
	j@m9 = 0
	repeat usergodmax
		if (godcheck(__ccc) == cgodShortId(cnt)) {
			j@m9 = creategoduid(cnt)
			break
		}
	loop
	return j@m9



#deffunc setgod int __ddd
	isetgodmax@m9 = length(isetgod)
	i@m9 = rnd(isetgodmax@m9 + usergodmax)
	if (i@m9 < isetgodmax@m9) {
		iParam1(__ddd) = isetgod(i@m9)
	} else {
		iParam1(__ddd) = 0
		iParam2(__ddd) = i@m9 - isetgodmax@m9
		iParam3(__ddd) = creategoduid(iParam2(__ddd))
	}
	return 1



#defcfunc creategodid
	i@m9 = creategodno()
	if (i@m9 < isetgodmax@m9) {
		godidt@m9 = godno2godid(isetgod(i@m9))
	} else {
		godidt@m9 = cgodShortId(i@m9 - isetgodmax@m9)
	}
	return godidt@m9



#defcfunc getitemindex int __eee
	itemid@m10 = -1
	repeat useritemmax
		s@m10 = useritemdatan(0, cnt)
		p@m10 = 0
		repeat strlen(s@m10)
			p@m10 += peek(s@m10, cnt)
		loop
		s@m10 = str(peek(s@m10, 0)) + str(p@m10) + str(peek(s@m10, strlen(s@m10) - 1))
		if (__eee == int(s@m10)) {
			itemid@m10 = cnt
			break
		}
	loop
	return itemid@m10



#defcfunc createserialno str __fff
	s@m10 = __fff
	if (strlen(s@m10) == 0) {
		return -1
	}
	p@m10 = 0
	repeat strlen(s@m10)
		p@m10 += peek(s@m10, cnt)
	loop
	s@m10 = str(peek(s@m10, 0)) + str(p@m10) + str(peek(s@m10, strlen(s@m10) - 1))
	return int(s@m10)



#deffunc modnpcmemory int __ggg, int __hhh, int __iii
	npcmemory(__ggg, cId(__hhh)) += __iii
	if (cId(__hhh) == 343) {
		if (cCnpcId(__hhh) != usernpcmax) {
			i@m10 = -1
			p@m10 = createserialno(userdatan(0, cCnpcId(__hhh)))
			repeat cnpcmemorymax
				if (cnpcmemory(0, cnt) == p@m10) {
					i@m10 = cnt
					break
				}
			loop
			if (i@m10 == (-1)) {
				if (cnpcmemorymax >= 3000) {
					return
				}
				i@m10 = cnpcmemorymax
				cnpcmemory(0, i@m10) = p@m10
				cnpcmemorymax++
			}
			cnpcmemory(__ggg + 1, i@m10) += __iii
		}
	}
	return



#defcfunc getcnpcmemory int __jjj, int __kkk
	i@m10 = -1
	p@m10 = createserialno(userdatan(0, __kkk))
	repeat cnpcmemorymax
		if (cnpcmemory(0, cnt) == p@m10) {
			i@m10 = cnt
			break
		}
	loop
	if (i@m10 == (-1)) {
		return 0
	}
	return cnpcmemory(__jjj + 1, i@m10)



#defcfunc getcnpcmemory4name int __lll, str __mmm
	i@m10 = -1
	p@m10 = createserialno(__mmm)
	repeat cnpcmemorymax
		if (cnpcmemory(0, cnt) == p@m10) {
			i@m10 = cnt
			break
		}
	loop
	if (i@m10 == (-1)) {
		return 0
	}
	return cnpcmemory(__lll + 1, i@m10)



#deffunc getunid4item int __nnn
	f@m10 = 0
	repeat usernpcmax
		if (inv(34, __nnn) == createserialno(userdatan(0, cnt))) {
			inv(33, __nnn) = cnt
			f@m10 = 1
			break
		}
	loop
	if (f@m10) {
		if (iId(__nnn) == 503 | iId(__nnn) == 504 | iId(__nnn) == 745) {
			if (iSubname(__nnn) == 343) {
				if (userdata2(8, inv(33, __nnn)) != 0) {
					iColor(__nnn) = limit(userdata2(8, inv(33, __nnn)), 0, 33 * 25)
				} else {
					iColor(__nnn) = 825 + inv(33, __nnn)
				}
			}
		}
	} else {
		inv(33, __nnn) = usernpcmax
	}
	return f@m10



#deffunc getunid4job int __ooo
	f@m10 = 0
	repeat usernpcmax
		if (qdata(15, __ooo) == createserialno(userdatan(0, cnt))) {
			qdata(13, __ooo) = cnt
			f@m10 = 1
			break
		}
	loop
	if (f@m10 == 0) {
		qdata(13, __ooo) = usernpcmax
	}
	return f@m10



#defcfunc limitmin int __ppp, int __qqq
	if (__ppp > __qqq) {
		return __ppp
	} else {
		return __qqq
	}



#defcfunc godno2godid int __rrr
	_switch_val@m12 = __rrr
	repeat 1
		if (_switch_val@m12 == 1) {
			godid@m12 = "mani"
			break
		}
		if (_switch_val@m12 == 2) {
			godid@m12 = "lulwy"
			break
		}
		if (_switch_val@m12 == 3) {
			godid@m12 = "itzpalt"
			break
		}
		if (_switch_val@m12 == 4) {
			godid@m12 = "ehekatl"
			break
		}
		if (_switch_val@m12 == 5) {
			godid@m12 = "opatos"
			break
		}
		if (_switch_val@m12 == 6) {
			godid@m12 = "jure"
			break
		}
		if (_switch_val@m12 == 7) {
			godid@m12 = "kumiromi"
			break
		}
		godid@m12 = "eyth"
	loop
	return godid@m12



#deffunc incfame int __sss, int __ttt
	cFame(__sss) += __ttt
	if (__ttt <= 0) {
		return 1
	}
	dim list@m13, 30
	listmax@m13 = 0
	repeat 30, 100
		if (cdata(cnt, __sss) == 0) {
			continue
		}
		if (cdata(cnt, __sss) / 10000 != 5 & cdata(cnt, __sss) / 10000 != 10) {
			continue
		}
		i@m13 = cdata(cnt, __sss) \ 10000 - 1
		if (i@m13 < 0) {
			continue
		}
		if (ibit(18, i@m13) & iCurseState(i@m13) >= 1) {
			list@m13(listmax@m13) = i@m13
			listmax@m13++
		}
	loop
	repeat listmax@m13
		i@m13 = list@m13(cnt)
		if (cLevel(__sss) < iParam1(i@m13) + 1) {
			continue
		}
		iParam2(i@m13) += __ttt / sqrt(iParam1(i@m13)) + rndex(__ttt / sqrt(iParam1(i@m13)) + 1)
		if (cKarma(__sss) > 0) {
			iParam2(i@m13) += cFame(__sss) / (5 * sqrt(iParam1(i@m13))) + rndex(cFame(__sss) / (5 * sqrt(iParam1(i@m13))) + 1)
		}
		if (iParam2(i@m13) >= calcexpalive(iParam1(i@m13))) {
			if (synccheck(__sss, -1)) {
				txtef 2
				snd 61
				txt -1, lang(itemname(i@m13) + "は" + name(__sss) + "を認めた！", itemname(i@m13) + " approves of " + name(__sss) + "'s deeds!")
			}
		}
	loop
	return 1



#deffunc decjusticweapon int __uuu
	dim list@m14, 30
	listmax@m14 = 0
	repeat 30, 100
		if (cdata(cnt, __uuu) == 0) {
			continue
		}
		if (cdata(cnt, __uuu) / 10000 != 5 & cdata(cnt, __uuu) / 10000 != 10) {
			continue
		}
		i@m14 = cdata(cnt, __uuu) \ 10000 - 1
		if (i@m14 < 0) {
			continue
		}
		if (ibit(18, i@m14) & iCurseState(i@m14) >= 1) {
			list@m14(listmax@m14) = i@m14
			listmax@m14++
		}
	loop
	repeat listmax@m14
		i@m14 = list@m14(cnt)
		safe_subtract iEnhancement(i@m14), 1
		repeat 15
			if (iEnchantmentId(i@m14, cnt) == 0) {
				break
			}
			encid@m14 = iEnchantmentId(i@m14, cnt)
			if (encpassivecheck(encid@m14)) {
				continue
			}
			decp@m14 = 50
			encsid@m14 = encid@m14 / 10000
			if (encsid@m14 == 9) {
				decp@m14 *= 1000
			}
			encp@m14 = inv(41 + cnt * 2, i@m14) - decp@m14
			if (encsid@m14 > 0) {
				_switch_val@m14 = encsid@m14
				if (_switch_val@m14 == 1 | _switch_sw@m14) {
					_switch_sw@m14 = 0
					_switch_sw@m14++
				}
				if (_switch_val@m14 == 2 | _switch_sw@m14) {
					_switch_sw@m14 = 0
					_switch_sw@m14++
				}
				if (_switch_val@m14 == 3 | _switch_sw@m14) {
					_switch_sw@m14 = 0
					if (encp@m14 < (-100000)) {
						encp@m14 = -100000
					}
					goto *label_1945
					_switch_sw@m14++
				}
				if (_switch_val@m14 == 7 | _switch_sw@m14) {
					_switch_sw@m14 = 0
					_switch_sw@m14++
				}
				if (_switch_val@m14 == 8 | _switch_sw@m14) {
					_switch_sw@m14 = 0
					if (encp@m14 < 25) {
						encp@m14 = 25
					}
					goto *label_1945
					_switch_sw@m14++
				}
				if (_switch_val@m14 == 9 | _switch_sw@m14) {
					_switch_sw@m14 = 0
					if (encp@m14 < 1000) {
						encp@m14 = 1000
					}
					goto *label_1945
				}
*label_1945
			} else {
				if (encp@m14 < 25) {
					encp@m14 = 25
				}
			}
			inv(41 + cnt * 2, i@m14) = encp@m14
		loop
		if (getrelation(__uuu) < 0) {
			iParam2(i@m14) = 0
		}
		txtef 3
		txt -1, lang("あなたは" + itemname(list@m14(cnt)) + "からの信頼を失った……", itemname(list@m14(cnt)) + " has lost faith in you...")
	loop
	return 1



#defcfunc eqevilweapon int __vvv
	ci@m14 = -1
	repeat 30, 100
		if (cdata(cnt, __vvv) == 0) {
			continue
		}
		if (cdata(cnt, __vvv) / 10000 != 5 & cdata(cnt, __vvv) / 10000 != 10) {
			continue
		}
		i@m14 = cdata(cnt, __vvv) \ 10000 - 1
		if (i@m14 < 0) {
			continue
		}
		if (ibit(10, i@m14) == 0) {
			continue
		}
		if (ibit(18, i@m14) == 0) {
			continue
		}
		if (iCurseState(i@m14) != (-2)) {
			continue
		}
		if (iParam1(i@m14) <= 15) {
			continue
		}
		ci@m14 = i@m14
		break
	loop
	return ci@m14



#defcfunc calcpiercefix int __www, int __xxx, int __yyy, int
	spattack@m15 = 0
	_switch_val@m15 = __www
	if (_switch_val@m15 == 110 | _switch_sw@m15) {
		_switch_sw@m15 = 0
		if (filtercheck(__yyy, "undead")) {
			spattack@m15 += -1
		}
		goto *label_1949
		_switch_sw@m15++
	}
	if (_switch_val@m15 == 111 | _switch_sw@m15) {
		_switch_sw@m15 = 0
		if (cbit(5, __yyy)) {
			spattack@m15 += 1
		}
		goto *label_1949
		_switch_sw@m15++
	}
	if (_switch_val@m15 == 104 | _switch_sw@m15) {
		_switch_sw@m15 = 0
		if (cCurrentSpeed(__yyy) < cCurrentSpeed(__xxx)) {
			spattack@m15 += 1
		}
		goto *label_1949
		_switch_sw@m15++
	}
	if (_switch_val@m15 == 102 | _switch_sw@m15) {
		_switch_sw@m15 = 0
		spattack@m15 += 1
		repeat 30, 100
			if (cdata(cnt, __yyy) \ 10000 == 0) {
				continue
			}
			rp@m15 = cdata(cnt, __yyy) \ 10000 - 1
			if (iDiceX(rp@m15) == 0) {
				spattack@m15 += -1
				break
			}
		loop
		goto *label_1949
		_switch_sw@m15++
	}
	if (_switch_val@m15 == 103 | _switch_sw@m15) {
		_switch_sw@m15 = 0
		if (carmor(__yyy) == 169 | cdatan(2, __yyy) == "shell" | filtercheck(__yyy, "shell") | cdatan(2, __yyy) == "golem" | filtercheck(__yyy, "golem") | filtercheck(__yyy, "slime")) {
			spattack@m15 += 1
		}
		if (filtercheck(__yyy, "slime")) {
			spattack@m15 += -1
		}
		goto *label_1949
		_switch_sw@m15++
	}
	if (_switch_val@m15 == 106 | _switch_sw@m15) {
		_switch_sw@m15 = 0
		if (filtercheck(__yyy, "slime")) {
			spattack@m15 += -1
		}
		goto *label_1949
		_switch_sw@m15++
	}
	if (_switch_val@m15 == 108 | _switch_sw@m15) {
		_switch_sw@m15 = 0
		repeat 30, 100
			if (cdata(cnt, __yyy) == 0) {
				continue
			}
			if (cdata(cnt, __yyy) / 10000 != 10) {
				continue
			}
			if (cdata(cnt, __yyy) \ 10000 == 0) {
				spattack@m15 += 1
				break
			}
		loop
		goto *label_1949
	}
*label_1949
	return spattack@m15 * 20



#defcfunc find_eq int __aaa, int __bbb
	inv_no@m16 = -1
	repeat 30
		body@m16 = 100 + cnt
		if (cdata(body@m16, __aaa) \ 10000 == 0) {
			continue
		}
		cw@m16 = cdata(body@m16, __aaa) \ 10000 - 1
		if (cw@m16 == (-1)) {
			continue
		}
		if (__bbb > 10000) {
			reftypeminor@m16 = refitem(iId(cw@m16), 9, cw@m16)
			if (reftypeminor@m16 == __bbb) {
				inv_no@m16 = cw@m16
				break
			}
		} else {
			if (iId(cw@m16) == __bbb) {
				inv_no@m16 = cw@m16
				break
			}
		}
	loop
	return inv_no@m16



#defcfunc get_ueq int __ccc, int __ddd
	cw@m16 = -1
	repeat 30
		body@m16 = 100 + cnt
		if (cdata(body@m16, __ccc) \ 10000 == 0) {
			continue
		}
		if (cdata(body@m16, __ccc) / 10000 == __ddd) {
			cw@m16 = cdata(body@m16, __ccc) \ 10000 - 1
			break
		}
	loop
	return cw@m16



#defcfunc eqthrowcheck int __eee
	f@m16 = 0
	repeat 30
		body@m16 = 100 + cnt
		if (cdata(body@m16, __eee) \ 10000 == 0) {
			continue
		}
		if (cdata(body@m16, __eee) / 10000 == 10) {
			continue
		}
		if (cdata(body@m16, __eee) / 10000 == 11) {
			continue
		}
		cw@m16 = cdata(body@m16, __eee) \ 10000 - 1
		if (iDiceX(cw@m16) > 0) {
			if (iequiploc(cw@m16) == 10) {
				if (iSkill(cw@m16) == 111) {
					f@m16 = 1
					break
				}
			}
		}
	loop
	return f@m16



#defcfunc givecheck int __jjj, int __kkk
	found@m19 = 0
	repeat 10
		if (cgodFavor(__kkk, cnt) == 0) {
			break
		}
		givet@m19 = cgodFavor(__kkk, cnt)
		if (givet@m19 == reftype) {
			found@m19 = 1
			break
		}
		reftypeminor@m19 = refitem(iId(__jjj), 9, __jjj)
		if (givet@m19 == reftypeminor@m19) {
			found@m19 = 1
			break
		}
		if (givet@m19 == iId(__jjj)) {
			found@m19 = 1
			break
		}
		if (cfg_offercorpse) {
			if (iId(__jjj) == 204) {
				found@m19 = 1
				break
			}
		}
	loop
	return found@m19



#defcfunc sppfind int __lll, int __mmm
	encp@m19 = -1
	if (getcgodno(__lll) != (-1)) {
		cgodno@m19 = stat
		if (cgodSpecialPowerId(cgodno@m19) / 1000 == 1) {
			if (cgodSpecialPowerId(cgodno@m19) \ 1000 == __mmm) {
				encp@m19 = convert_var(cgodSpecialPowerPower(cgodno@m19), 0, 0, cPietyPoint(__lll))
			}
		}
	}
	return encp@m19



#defcfunc findcgodno str __nnn
	cgod_no@m19 = -1
	repeat usergodmax
		if (__nnn == cgodShortId(cnt)) {
			cgod_no@m19 = cnt
			break
		}
	loop
	return cgod_no@m19



#defcfunc getcgodno int __ooo
	if (cGod(__ooo) != 0) {
		return -1
	}
	s@m19 = godcheck(__ooo)
	if (s@m19 == "eyth") {
		return -1
	}
	return findcgodno(s@m19)



#deffunc metamorphosis int __ppp
	distance@m20 = dist(cX(cEnemyId(__ppp)), cY(cEnemyId(__ppp)), cX(__ppp), cY(__ppp))
	objlv@m20 = cLevel(__ppp)
	dim dblist@m20, 50
	dbmax@m20 = 0
	if (distance@m20 > 1) {
		if (distance@m20 > 2 | rnd(2)) {
			if (objlv@m20 >= 65) {
				dbadd 220
			}
			if (objlv@m20 >= 45) {
				dbadd 49
			}
			if (objlv@m20 >= 30) {
				dbadd 48
			}
			if (objlv@m20 >= 20) {
				dbadd 47
			}
			if (objlv@m20 >= 5) {
				dbadd 24
			}
			dbadd 264
		}
		if (objlv@m20 >= 17) {
			dbadd 325
		}
		if (objlv@m20 >= 8) {
			dbadd 117
		}
		dbadd 261
	} else {
		if (objlv@m20 >= 50) {
			dbadd 216
		}
		if (objlv@m20 >= 30) {
			dbadd 198
		}
		if (objlv@m20 >= 30) {
			dbadd 188
		}
		if (objlv@m20 >= 25) {
			dbadd 258
		}
		if (objlv@m20 >= 15) {
			dbadd 78
		}
		if (objlv@m20 >= 13) {
			dbadd 92
		}
		if (objlv@m20 >= 10) {
			dbadd 43
		}
		if (objlv@m20 >= 8) {
			dbadd 312
		}
		dbadd 265
	}
	cAiActSubFreq(__ppp) = 0
	dbid@m20 = dblist@m20(rnd(dbmax@m20))
	_switch_val@m20 = dbid@m20
	if (_switch_val@m20 == 264 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 414, 415, 418
		cAiActNum(__ppp) = 3
		cbitmod 20, __ppp, 1
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 24 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 416
		cAiActNum(__ppp) = 1
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 47 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 49 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 414, 419, 422
		cAiActNum(__ppp) = 3
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 48 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 414, 419, 422, 450
		cAiActNum(__ppp) = 4
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 220 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 417, 434, 415
		cAiActNum(__ppp) = 3
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 117 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = -2, 443
		cAiActNum(__ppp) = 2
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 325 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = -2, 648
		cAiActNum(__ppp) = 2
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 261 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 443, 447, 415
		cAiActNum(__ppp) = 3
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 265 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = -1, 648, 444
		cAiActNum(__ppp) = 3
		cbitmod 30, __ppp, 1
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 43 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 601
		cAiActNum(__ppp) = 1
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 312 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 651
		cAiActNum(__ppp) = 1
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 78 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 449, 447, 450
		cAiActNum(__ppp) = 3
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 188 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = -1
		cAiActNum(__ppp) = 1
		cElementOfUnarmedAttack(__ppp) = 61 * 100000 + 150
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 216 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 601, 636
		cAiActNum(__ppp) = 2
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 198 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cAiActSubFreq(__ppp) = 50
		cAiActNum(__ppp) = 11
		cdata(215, __ppp) = -1
		cdata(220, __ppp) = -9997
		cElementOfUnarmedAttack(__ppp) = 54 * 100000 + 250
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 92 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = 618, 618, 419, 603
		cAiActNum(__ppp) = 4
		goto *label_1966
		_switch_sw@m20++
	}
	if (_switch_val@m20 == 258 | _switch_sw@m20) {
		_switch_sw@m20 = 0
		cdata(215, __ppp) = -1
		cAiActNum(__ppp) = 1
		cElementOfUnarmedAttack(__ppp) = 61 * 100000 + 150
		cDamageReactionInfo(__ppp) = 61 + 250 * 1000
		goto *label_1966
	}
*label_1966
	cAiMove(__ppp) = 0
	cContinuousActionId(__ppp) = 20002
	cContinuousActionTurn(__ppp) = 1
	return dbid@m20



#deffunc dbadd int __qqq
	dblist@m20(dbmax@m20) = __qqq
	dbmax@m20++
	return



#defcfunc equalsitem int __rrr, str __sss
	if (iId(__rrr) == 743) {
		citemid@m21 = finditemid(__sss)
		if (citemid@m21) {
			if (inv(31, __rrr) == citemid@m21 - 1) {
				return 1
			}
		}
	}
	return 0



#defcfunc reinforcecheck int __ttt, int __uuu
	if (iEnchantmentId(__uuu, __ttt) == 0) {
		return -1
	}
	encp@m22 = inv(41 + __ttt * 2, __uuu)
	repeat 8
		mtenc_id@m22 = mtenc(cnt * 2, iMaterial(__uuu))
		if (mtenc_id@m22 == 0) {
			break
		}
		if (iEnchantmentId(__uuu, __ttt) == mtenc_id@m22) {
			encp@m22 -= mtenc(1 + cnt * 2, iMaterial(__uuu))
			break
		}
	loop
	if (encp@m22 <= 0) {
		return 0
	}
	return encp@m22



#defcfunc skillnameref int __vvv, int __www
	_switch_val@m23 = __vvv
	if (_switch_val@m23 == (-1) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		s@m23 = lang("近接攻撃", "Melee Attack")
		goto *label_1974
		_switch_sw@m23++
	}
	if (_switch_val@m23 == (-2) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		s@m23 = lang("遠隔攻撃", "Ranged Attack")
		goto *label_1974
		_switch_sw@m23++
	}
	if (_switch_val@m23 == (-9995) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		s@m23 = lang("トマト投擲", "Throw Tomato")
		goto *label_1974
		_switch_sw@m23++
	}
	if (_switch_val@m23 == (-9994) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		s@m23 = lang("媚薬投擲", "Throw Love potion")
		goto *label_1974
		_switch_sw@m23++
	}
	if (_switch_val@m23 == (-9996) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		s@m23 = lang("塩投擲", "Throw Salt")
		goto *label_1974
		_switch_sw@m23++
	}
	if (_switch_val@m23 == (-9997) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		_switch_sw@m23++
	}
	if (_switch_val@m23 == (-9998) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		_switch_sw@m23++
	}
	if (_switch_val@m23 == (-9999) | _switch_sw@m23) {
		_switch_sw@m23 = 0
		s@m23 = lang("ポーション投擲", "Throw Potion")
		goto *label_1974
		_switch_sw@m23++
	}
	if (_switch_val@m23 == 183 | _switch_sw@m23) {
		_switch_sw@m23 = 0
		f@m23 = 1
		if (cId(__www) == 326) {
			f@m23 = 0
		} else {
			if (cId(__www) == 343) {
				if (userdata2(5, cCnpcId(__www)) == 1) {
					f@m23 = 0
				}
			} else {
				if (__www == 0) {
					if (cContinuousActionId(__www) != 10006) {
						f@m23 = 0
					}
				}
			}
		}
		if (f@m23) {
			s@m23 = lang("歌唱", "Singing")
			goto *label_1974
		}
	}
	s@m23 = skillname(__vvv)
*label_1974
	return s@m23



#defcfunc skilldescref int __xxx, int __yyy
	_switch_val@m23 = __xxx
	if (_switch_val@m23 == 183 | _switch_sw@m23) {
		_switch_sw@m23 = 0
		f@m23 = 1
		if (cId(__yyy) == 326) {
			f@m23 = 0
		} else {
			if (cId(__yyy) == 343) {
				if (userdata2(5, cCnpcId(__yyy)) == 1) {
					f@m23 = 0
				}
			} else {
				if (__yyy == 0) {
					f@m23 = 0
				}
			}
		}
		if (f@m23) {
			s@m23 = lang("質の高い歌唱を可能にする", "Shows how good of a singer you are.")
			goto *label_1976
		}
	}
	s@m23 = skilldesc(__xxx)
*label_1976
	return s@m23



#defcfunc encpfindspec int __zzz, int __aaa, array __bbb
	f@m24 = -1
	repeat 15
		if (iEnchantmentId(__zzz, cnt) == 0) {
			break
		}
		if (iEnchantmentId(__zzz, cnt) == __aaa) {
			__bbb(0) = cnt
			__bbb(1) = inv(41 + cnt * 2, __zzz)
			f@m24 = 1
			break
		}
	loop
	return f@m24



#defcfunc loadedammo int __ccc, int __ddd
	f@m24 = 0
	if (iCount(__ccc) != (-1)) {
		if (iEnchantmentId(__ccc, iCount(__ccc)) \ 10000 == __ddd) {
			f@m24 = 1
		}
	}
	return f@m24



#defcfunc encpassivecheck int __eee
	if (__eee == 22 | __eee == 23 | __eee == 24 | __eee == 25 | __eee == 26 | __eee == 27 | __eee == 28 | __eee == 32 | __eee == 33 | __eee == 48 | __eee == 56 | __eee == 59) {
		return 1
	}
	rp@m24 = __eee / 10000
	if (rp@m24 == 6) {
		return 1
	}
	return 0



#defcfunc calcattackskil int __fff, int __ggg
	f@m24 = double(__fff)
	if (iEnhancement(__ggg) != 0) {
		if (iEnhancement(__ggg) > 0) {
			f@m24 *= 1.0 + double(iEnhancement(__ggg)) / 2.0
		} else {
			f@m24 /= 1.0 + double(abs(iEnhancement(__ggg))) / 2.0
		}
	}
	return f@m24 / 5



#defcfunc badstatuscheck int __hhh
	f@m25 = 0
	repeat 12
		if (cdata(250 + cnt, __hhh) != 0) {
			f@m25 = 1
			break
		}
	loop
	return f@m25



#defcfunc itemsnd int __iii
	if (iId(__iii) == 743) {
		if (inv(31, __iii) > useritemmax) {
			if (jp) {
				buf += "\n\n非公式バージョンです。バグ報告はDiscordまでお願いします。"
			} else {
				buf += "\n\nIt is an unofficial version. Please report an issue to Discord."
			}
		}
		s@m26 = exedir + "sound\\" + useritemdatan(7, inv(31, __iii)) + ".wav"
		if (s@m26 != "") {
			exist s@m26
			if (strsize != (-1)) {
				usersnd s@m26
				return 1
			}
		}
	}
	p@m26 = -1
	_switch_val@m26 = iId(__iii)
	if (_switch_val@m26 == 231 | _switch_sw@m26) {
		_switch_sw@m26 = 0
		p@m26 = 122
		goto *label_1986
		_switch_sw@m26++
	}
	if (_switch_val@m26 == 674 | _switch_sw@m26) {
		_switch_sw@m26 = 0
		_switch_sw@m26++
	}
	if (_switch_val@m26 == 496 | _switch_sw@m26) {
		_switch_sw@m26 = 0
		p@m26 = 123
		goto *label_1986
	}
*label_1986
	if (p@m26 == (-1)) {
		attackskill@m26 = iSkill(__iii)
		_switch_val@m26 = attackskill@m26
		if (_switch_val@m26 == 100 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 124
			goto *label_1987
			_switch_sw@m26++
		}
		if (_switch_val@m26 == 101 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 125
			goto *label_1987
			_switch_sw@m26++
		}
		if (_switch_val@m26 == 102 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 126
			goto *label_1987
			_switch_sw@m26++
		}
		if (_switch_val@m26 == 103 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 127
			goto *label_1987
			_switch_sw@m26++
		}
		if (_switch_val@m26 == 104 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 128
			goto *label_1987
			_switch_sw@m26++
		}
		if (_switch_val@m26 == 105 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 129
			goto *label_1987
			_switch_sw@m26++
		}
		if (_switch_val@m26 == 107 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 130
			goto *label_1987
			_switch_sw@m26++
		}
		if (_switch_val@m26 == 109 | _switch_sw@m26) {
			_switch_sw@m26 = 0
			p@m26 = 131
			goto *label_1987
		}
	}
*label_1987
	if (p@m26 != (-1)) {
		if (soundfile(p@m26) != "") {
			snd p@m26
			return 1
		}
	}
	return 0



#defcfunc actupgradelistcheck int __jjj, int __kkk
	f@m28 = 0
	repeat listmax
		if (list(0, cnt) == __jjj & list(1, cnt) == __kkk) {
			f@m28 = 1
			break
		}
	loop
	return f@m28



#defcfunc day_trading int __lll
	if (inv_getfreeid(-1) == (-1) | finditemid("wuqing") == 0) {
		return 0
	}
	mode = 6
	inititemid = finditemid("wuqing")
	itemcreate -1, 743, -1, -1, 0
	ti@m29 = ci
	if (inv_getspace(__lll)) {
		rate@m29 = calcitemvalue(ti@m29, 0)
		if (rate@m29 < 1500) {
			inititemid = finditemid("wuqing")
			itemcreate __lll, 743, -1, -1, 0
			if (stat) {
				iParam2(ci) = rate@m29
				iNumber(ci) = limit(cGold(__lll) / rate@m29, 0, 5 * (100 + sdata(160, __lll) * 2) / 100 + 1)
				cGold(__lll) -= iNumber(ci) * rate@m29
				skillexp2 160, __lll, 120
			}
		}
	}
	rate@m29 = calcitemvalue(ti@m29, 1)
	inv_getheader __lll
	income@m29 = 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (iId(cnt) != 743) {
			continue
		}
		if (equalsitem(cnt, "wuqing")) {
			if (iParam2(cnt) < rate@m29) {
				income@m29 += rate@m29 * iNumber(cnt)
				iNumber(cnt) = 0
				skillexp2 160, __lll, 120
			}
		}
	loop
	iNumber(ti@m29) = 0
	mode = 0
	return income@m29



#defcfunc convert_var str __mmm, int __nnn, int __ooo, int __ppp
	s@m32 = __mmm
	repeat 5
		sreplace s@m32, s@m32, "{efp}", "" + __nnn
		sreplace s@m32, s@m32, "{attb}", "" + __ooo
		sreplace s@m32, s@m32, "{faith}", "" + __ppp
	loop
	return int(jseval(s@m32))



#defcfunc elemeteor int __qqq
	if (__qqq == 50) {
		return lang("隕石", "meteorites")
	}
	if (__qqq == 51) {
		return lang("氷塊", "ice shards")
	}
	if (__qqq == 52) {
		return lang("帯電した隕鉄", "electrified meteorites")
	}
	if (__qqq == 53) {
		return lang("暗黒物質", "dark matters")
	}
	if (__qqq == 54) {
		return lang("狂気の塊", "mass insanity")
	}
	if (__qqq == 55) {
		return lang("毒の隕石", "poisonous meteorite")
	}
	if (__qqq == 56) {
		return lang("地獄の隕石", "nether meteorite")
	}
	if (__qqq == 57) {
		return lang("轟音の隕石", "sound meteorite")
	}
	if (__qqq == 58) {
		return lang("神経の隕石", "nerve meteorite")
	}
	if (__qqq == 59) {
		return lang("混沌の隕石", "chaos meteorite")
	}
	if (__qqq == 60) {
		return lang("魔力の塊", "crystals")
	}
	if (__qqq == 70) {
		return lang("媚薬の塊", "love potion")
	}
	if (__qqq == 71) {
		return lang("酒の塊", "Liquor")
	}
	return lang("何か", "objects")



#deffunc checkalter int __rrr
	f@m34 = 0
	if (iId(__rrr) == 171 | iId(__rrr) == 172) {
		f@m34 = 1
	}
	if (iId(__rrr) == 743) {
		if (inv(31, __rrr) != useritemmax@m34) {
			if (useritemdata(14, inv(31, __rrr)) == 60002) {
				f@m34 = 1
			}
		}
	}
	if (f@m34) {
		if (iParam3(__rrr) != 0) {
			getgodid __rrr
		}
	}
	return



#defcfunc calcuserspellfixcost int __sss
	fixcost@m35 = 0
	_switch_val@m35 = spellconditionlist(1, __sss)
	if (_switch_val@m35 == 1 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 20
		goto *label_2002
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 2 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 12 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 10
		goto *label_2002
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 3 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 30
		goto *label_2002
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 4 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 6 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 9 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 50
		goto *label_2002
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 5 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 7 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 10 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 11 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 40
		goto *label_2002
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 8 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 75
		goto *label_2002
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 13 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 60
		goto *label_2002
		_switch_sw@m35++
	}
	if (_switch_val@m35 == 14 | _switch_sw@m35) {
		_switch_sw@m35 = 0
		fixcost@m35 = 45
		goto *label_2002
	}
*label_2002
	return fixcost@m35



#defcfunc topattackskill int __ttt
	id@m36 = 0
	p@m36 = 0
	repeat 111 - 100, 100
		i@m36 = sorgEx(cnt, __ttt)
		if (i@m36 == 0) {
			continue
		}
		if (i@m36 < p@m36) {
			continue
		}
		id@m36 = cnt
		p@m36 = i@m36
	loop
	if (id@m36 != 105) {
		if (p@m36 < sorgEx(172, __ttt)) {
			id@m36 = 172
		}
	}
	return id@m36



#defcfunc refattackskill int __skillId, int __cc
	p@oo2019 = sdata(__skillId, __cc)
	if (__skillId != 106) {
		if (cEquipmentType(__cc) & 2) {
			if (gettrait(__cc, 68)) {
				p@oo2019 += int(calc5traitmulti(stat, sdata(106, __cc)))
			}
		}
	}
	return p@oo2019



#deffunc lockson int __uuu, int __vvv, int
	if (__vvv < 0) {
		return 0
	}
	if (__uuu == 0) {
		if (ocdata(155, 0) != 0) {
			return 0
		}
		ocdata(150, 0) = __vvv + 1
		ocdata(155, 0) = 1
		return 1
	}
	if (ocdata(155, __uuu) == 5) {
		return 0
	}
	f@m37 = 0
	p@m37 = __vvv + 1
	repeat ocdata(155, __uuu)
		if (ocdata(150 + cnt, __uuu) == p@m37) {
			found@m37 = 1
			break
		}
	loop
	if (f@m37) {
		return 0
	}
	ocdata(150 + ocdata(155, __uuu), __uuu) = p@m37
	ocdata(155, __uuu)++
	return 1



#deffunc unlockson int __xxx
	repeat ocdata(155, __xxx)
		ocdata(150 + cnt, __xxx) = 0
	loop
	ocdata(155, __xxx) = 0
	return 1



#deffunc unlockon int __yyy, int __zzz
	if (ocdata(155, __yyy) == 0) {
		return 0
	}
	if (__yyy == 0) {
		if (ocdata(150, 0) - 1 != __zzz) {
			return 0
		}
		ocdata(150, 0) = 0
		ocdata(155, 0) = 0
		return 1
	}
	p@m37 = __zzz + 1
	f@m37 = 1
	repeat ocdata(155, __yyy)
		if (ocdata(150 + cnt, __yyy) == p@m37) {
			ocdata(150 + cnt, __yyy) = 0
			ocdata(155, __yyy)--
			f@m37 = 0
			break
		}
	loop
	if (f@m37) {
		return 0
	}
	repeat 4
		if (ocdata(150 + cnt, __yyy) == 0) {
			if (ocdata(151 + cnt, __yyy) != 0) {
				ocdata(150 + cnt, __yyy) = ocdata(151 + cnt, __yyy)
				ocdata(151 + cnt, __yyy) = 0
			}
		}
	loop
	if (ocdata(155, __yyy) == 0) {
		cHate(__yyy) = 0
	}
	return 1



#deffunc lockon int __aaa, int __bbb, int
	unlockson __aaa
	lockson __aaa, __bbb, 15
	return 1



#deffunc locksorder int __ddd
	repeat 5
		if (ocdata(150 + cnt, __ddd) == 0) {
			break
		}
		p@m37 = ocdata(150 + cnt, __ddd) - 1
		if (cState(p@m37) != 1) {
			unlockon __ddd, p@m37
		}
	loop
	if (ocdata(155, __ddd) == 0) {
		return 0
	}
	repeat ocdata(155, __ddd)
		i@m37 = cnt
		j@m37 = ocdata(155, __ddd) - 1
		repeat
			if (j@m37 == i@m37) {
				break
			}
			p@m37 = ocdata(150 + j@m37, __ddd) - 1, ocdata(150 + j@m37 - 1, __ddd) - 1
			if (dist(cX(__ddd), cY(__ddd), cX(p@m37), cY(p@m37)) < dist(cX(__ddd), cY(__ddd), cX(p@m37(1)), cY(p@m37(1)))) {
				p@m37 = ocdata(150 + j@m37, __ddd)
				ocdata(150 + j@m37, __ddd) = ocdata(150 + j@m37 - 1, __ddd)
				ocdata(150 + j@m37 - 1, __ddd) = p@m37
			}
			j@m37--
		loop
	loop
	return 1



#deffunc watcheson int __eee, int __fff
	if (__fff < 0) {
		return 0
	}
	if (__eee == 0) {
		if (ocdata(161, 0) != 0) {
			return 0
		}
		ocdata(156, 0) = __fff + 1
		ocdata(161, 0) = 1
		return 1
	}
	if (ocdata(161, __eee) == 5) {
		return 0
	}
	f@m37 = 0
	p@m37 = __fff + 1
	repeat ocdata(161, __eee)
		if (ocdata(156 + cnt, __eee) == p@m37) {
			found@m37 = 1
			break
		}
	loop
	if (f@m37) {
		return 0
	}
	ocdata(156 + ocdata(161, __eee), __eee) = p@m37
	ocdata(161, __eee)++
	return 1



#deffunc unwatcheson int __ggg
	repeat ocdata(161, __ggg)
		ocdata(156 + cnt, __ggg) = 0
	loop
	ocdata(161, __ggg) = 0
	return 1



#deffunc unwatchon int __hhh, int __iii
	if (ocdata(161, __hhh) == 0) {
		return 0
	}
	if (__hhh == 0) {
		if (ocdata(156, 0) - 1 != __iii) {
			return 0
		}
		ocdata(156, 0) = 0
		ocdata(161, 0) = 0
		return 1
	}
	p@m37 = __iii + 1
	f@m37 = 1
	repeat ocdata(161, __hhh)
		if (ocdata(156 + cnt, __hhh) == p@m37) {
			ocdata(156 + cnt, __hhh) = 0
			ocdata(161, __hhh)--
			f@m37 = 0
			break
		}
	loop
	if (f@m37) {
		return 0
	}
	repeat 4
		if (ocdata(156 + cnt, __hhh) == 0) {
			if (ocdata(157 + cnt, __hhh) != 0) {
				ocdata(156 + cnt, __hhh) = ocdata(157 + cnt, __hhh)
				ocdata(157 + cnt, __hhh) = 0
			}
		}
	loop
	if (ocdata(161, __hhh) == 0) {
		cHate(__hhh) = 0
	}
	return 1



#deffunc watchesorder int __lll
	repeat 5
		if (ocdata(156 + cnt, __lll) == 0) {
			break
		}
		p@m37 = ocdata(156 + cnt, __lll) - 1
		if (cState(p@m37) != 1) {
			unwatchon __lll, p@m37
		}
	loop
	if (ocdata(161, __lll) == 0) {
		return 0
	}
	repeat ocdata(161, __lll)
		i@m37 = cnt
		j@m37 = ocdata(161, __lll) - 1
		repeat
			if (j@m37 == i@m37) {
				break
			}
			p@m37 = ocdata(156 + j@m37, __lll) - 1, ocdata(156 + j@m37 - 1, __lll) - 1
			if (dist(cX(__lll), cY(__lll), cX(p@m37), cY(p@m37)) < dist(cX(__lll), cY(__lll), cX(p@m37(1)), cY(p@m37(1)))) {
				p@m37 = ocdata(156 + j@m37, __lll)
				ocdata(156 + j@m37, __lll) = ocdata(156 + j@m37 - 1, __lll)
				ocdata(156 + j@m37 - 1, __lll) = p@m37
			}
			j@m37--
		loop
	loop
	return 1



#deffunc sortskilltrack
	dim tmp_sort
	tmp_sort_count = 0
	repeat 20
		if (gdatac(750 + cnt) != 0) {
			tmp_sort(tmp_sort_count) = gdatac(750 + cnt)
			tmp_sort_count++
		}
	loop
	sortval tmp_sort, 0
	repeat 20
		gdatac(750 + cnt) = 0
	loop
	repeat length(tmp_sort)
		gdatac(750 + cnt) = tmp_sort(cnt)
	loop
	return



#deffunc item_autostack int __mmm, int __nnn, int __zzz
	if (__zzz == 1) {
		if (__nnn >= 5080) {
			item_stack -1, __nnn, 0
		} else {
			item_stack __mmm, __nnn, 0
		}
	} else {
		if (__nnn >= 5080) {
			item_stack -1, __nnn, __mmm == 0
		} else {
			item_stack __mmm, __nnn, __mmm == 0
		}
	}
	return



#deffunc bmes2 str __sss, int __ttt
	pos_x@m21 = ginfo(22)
	pos_y@m21 = ginfo(23)
	color oom_color(3, __ttt), oom_color(4, __ttt), oom_color(5, __ttt)
	if (cfg_fontstyle == 0) {
		repeat 3
			mes_y@m21 = cnt + pos_y@m21 - 1
			repeat 3
				pos pos_x@m21 - 1 + cnt, mes_y@m21
				mes __sss
			loop
		loop
	} else {
		pos pos_x@m21 - 1, pos_y@m21
		mes __sss
		pos pos_x@m21 + 1, pos_y@m21
		mes __sss
		pos pos_x@m21, pos_y@m21 - 1
		mes __sss
		pos pos_x@m21, pos_y@m21 + 1
		mes __sss
	}
	color oom_color(0, __ttt), oom_color(1, __ttt), oom_color(2, __ttt)
	pos pos_x@m21, pos_y@m21
	mes __sss
	return



#deffunc ccolor int __uuu
	exist exedir + "user\\ccolor.txt"
	if (strsize != (-1)) {
		notesel buff_color
		noteload exedir + "user\\ccolor.txt"
	} else {
		return 0
	}
	_switch_val = __uuu
	oom_tmpcolor = 255, 255, 255, 0, 0, 0
	if (_switch_val == 100 | _switch_sw) {
		_switch_sw = 0
		sline = "%coladdhex"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 101 | _switch_sw) {
		_switch_sw = 0
		sline = "%coladdelem" + i@m66
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 102 | _switch_sw) {
		_switch_sw = 0
		sline = "%coladdbuff"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 103 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldelhex"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 104 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldelbuff"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 105 | _switch_sw) {
		_switch_sw = 0
		sline = "%colallelemdmg"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 106 | _switch_sw) {
		_switch_sw = 0
		sline = "%colstrmiss"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 107 | _switch_sw) {
		_switch_sw = 0
		sline = "%colstrevade"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 108 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgnormal"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 109 | _switch_sw) {
		_switch_sw = 0
		sline = "%colelemdmg" + i@m66
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 110 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealdmg"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 111 | _switch_sw) {
		_switch_sw = 0
		sline = "%colalldmg"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 112 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldelelem" + i@m66
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 201 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconblind"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 202 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconconfuse"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 203 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconparalyze"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 204 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconpoison"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 205 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconsleep"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 206 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconfear"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 207 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgcondim"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 208 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconbleed"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 209 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgcondrunk"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 210 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconinsane"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 211 | _switch_sw) {
		_switch_sw = 0
		sline = "%coldmgconsick"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 301 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconblind"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 302 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconconfuse"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 303 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconparalyze"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 304 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconpoison"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 305 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconsleep"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 306 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconfear"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 307 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealcondim"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 308 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconbleed"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 309 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealcondrunk"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 310 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconinsane"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 311 | _switch_sw) {
		_switch_sw = 0
		sline = "%colhealconsick"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 401 | _switch_sw) {
		_switch_sw = 0
		sline = "%colskilltrack"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 402 | _switch_sw) {
		_switch_sw = 0
		sline = "%colmagictrack"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 403 | _switch_sw) {
		_switch_sw = 0
		sline = "%colmagictrack2"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 404 | _switch_sw) {
		_switch_sw = 0
		sline = "%colpetskilltrack"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 405 | _switch_sw) {
		_switch_sw = 0
		sline = "%colfukidashidefault"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 406 | _switch_sw) {
		_switch_sw = 0
		sline = "%colfukidashi" + cdatan(0, oom_talkchara)
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 1000 | _switch_sw) {
		_switch_sw = 0
		sline = "%ffontdefault"
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 1001 | _switch_sw) {
		_switch_sw = 0
		sline = "%ffont" + cdatan(0, oom_talkchara)
		goto *label_2022
		_switch_sw++
	}
	if (_switch_val == 1200 | _switch_sw) {
		_switch_sw = 0
		sline = "%ffontpos" + cdatan(0, oom_talkchara)
		goto *label_2022
		_switch_sw++
	}
	return 0
*label_2022
	hajime_color = instr(buff_color, 0, sline + "," + lang("JP", "EN"))
	if (hajime_color != (-1)) {
		buff_color = strmid(buff_color, hajime_color, instr(buff_color, hajime_color + 1, "%"))
		notedel 0
		if (noteinfo(0) > 0) {
			if (buff_color != "" & buff_color != "default") {
				if (__uuu < 1000) {
					split buff_color, ",", oom_tmpcolorn
					if (stat == 6) {
						repeat 6
							oom_tmpcolor(cnt) = limit(int(oom_tmpcolorn(cnt)), 0, 255)
							if (__uuu < 400) {
								mondmg(2 + cnt, mondmgcnt) = oom_tmpcolor(cnt)
							}
						loop
						return 1
					}
				} else {
					if (__uuu < 1200) {
						sdim oom_tmpfont, 10, 3
						split buff_color, ",", oom_tmpfont
						if (stat == 3) {
							font oom_tmpfont(0), int(oom_tmpfont(1)), int(oom_tmpfont(2))
							if (stat == 0) {
								return 1
							}
						}
					} else {
						split buff_color, ",", oom_tmppoppos
						if (stat == 2) {
							txtpopup(4, txtpopupcnt) = int(oom_tmppoppos(0)), int(oom_tmppoppos(1))
							return 1
						}
					}
				}
			}
		}
	}
	return 0



#deffunc setconfig
	i = 0
	p = 0
	repeat
		p(2) = instr(s, p, "\"")
		if (p(2) == (-1)) {
			break
		}
		p += p(2)
		p(1) = instr(s, p + 1, "\"")
		if (p(1) == (-1)) {
			break
		}
		rtvaln(i) = strmid(s, p + 1, p(1))
		p += strlen(rtvaln(i)) + 2
		i++
	loop
	return
*label_2023
	list(0, 0) = 0, 0
	listmax = 0
	if (auto_equip == 0) {
		list(0, listmax) = -enccategory(encselect), 0
		listmax++
		if (enccategory(encselect) == 10000 | enccategory(encselect) == 60000) {
			repeat 18, 2
				if (skillname(cnt) == "") {
					continue
				}
				list(0, listmax) = cnt, sdataref(0, cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if (enccategory(encselect) == 20000 | enccategory(encselect) == 70000) {
			repeat 11, 50
				list(0, listmax) = cnt, sdataref(0, cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if (enccategory(encselect) == 30000) {
			repeat 40, 150
				if (skillname(cnt) == "") {
					continue
				}
				list(0, listmax) = cnt, sdataref(0, cnt) + enccategory(encselect)
				listmax++
			loop
			repeat 2, 300
				if (skillname(cnt) == "") {
					continue
				}
				list(0, listmax) = cnt, sdataref(0, cnt) + enccategory(encselect)
				listmax++
			loop
			repeat 12, 100
				if (skillname(cnt) == "") {
					continue
				}
				list(0, listmax) = cnt, sdataref(0, cnt) + enccategory(encselect) + 1000
				listmax++
			loop
		}
		if (enccategory(encselect) == 80000) {
			repeat 30
				list(0, listmax) = cnt + 1, encprocref(0, cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if (enccategory(encselect) == 90000) {
			repeat 6
				list(0, listmax) = cnt + 1, sdataref(0, cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if (enccategory(encselect) == 100000) {
			repeat 43
				list(0, listmax) = encetc(cnt), sdataref(0, cnt) + enccategory(encselect)
				listmax++
			loop
		}
	} else {
		repeat 40, 150
			if (skillname(cnt) == "") {
				continue
			}
			list(0, listmax) = cnt, sdataref(0, cnt) + 30000
			listmax++
		loop
		repeat 2, 300
			if (skillname(cnt) == "") {
				continue
			}
			list(0, listmax) = cnt, sdataref(0, cnt) + 30000
			listmax++
		loop
	}
	gosub *label_1276
	page = 0
	cs = 0
	if (equipfilter != 0) {
		repeat listmax
			if (list(0, cnt) == equipfilter \ enccategory(encselect)) {
				page = cnt / 16
				cs = cnt \ 16
			}
		loop
	}
	cs_bk = -1
*label_2024
	redraw 0
	pagesize = 16
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	if (auto_equip == 0) {
		s = enccategoryn(encselect)
		if (equipfilterpower != 0) {
			s = s + " - " + equipfilterpower
		}
		if (oom_inheritance_search) {
			s += lang(" - 継承on", " - only inherited")
		}
		if (oomSEST_livingWeapon_search) {
			s += lang(" - 生き武器on", " - only alive")
		}
	} else {
		s = lang("自動装備対象エンチャント", "Auto-equip enchantments")
	}
	s(1) = strhint2 + strhint3
	if (auto_equip == 0) {
		s(1) += "\n" + oom_strhint3 + oom_strhint4 + "\n" + oom_strhint8
	}
	display_window (windoww - 400) / 2 + inf_screenx, winposy(432), 400, 432, , , 1
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70 - 30, wy + 60 + cnt * 19
			gfini 400 - 80, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		p = list(0, p)
		if (auto_equip == 0) {
			if (p == -enccategory(encselect)) {
				s = enccategoryn(encselect)
			} else {
				if (enccategory(encselect) < 80000) {
					s = skillname(p)
				} else {
					if (enccategory(encselect) == 80000) {
						s = skillname(encprocref(0, p - 1))
					} else {
						if (enccategory(encselect) == 90000) {
							s = ammoname(p - 1)
						} else {
							s = strmid(encetcn(0, p - 21), 0, 42)
						}
					}
				}
			}
		} else {
			if (p == 0) {
				s = ""
			} else {
				s = skillname(p)
			}
		}
		display_key wx + 28, wy + 60 + cnt * 19 - 2, cnt
		cs_list s, wx + 54, wy + 60 + cnt * 19 - 1, 19, 0, 0, p
	loop
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			value = pagesize * page + cnt
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		snd 26
		if (p < 0) {
			showresist = 1
			showressub = 2
			return p
		} else {
			return p + enccategory(encselect) \ 100000
		}
	}
	if (key == key_cancel) {
		snd 26
		return 0
	}
	if (auto_equip != 1) {
		if (key == key_next) {
			snd 1
			encselect++
			if (encselect > 7) {
				encselect = 0
			}
			goto *label_2023
		}
		if (key == key_prev) {
			snd 1
			encselect--
			if (encselect < 0) {
				encselect = 7
			}
			goto *label_2023
		}
		if (key == key_southeast) {
			snd 1
			equipfilterpower += 100
			if (equipfilterpower > 500) {
				equipfilterpower = 0
			}
			goto *label_2024
		}
		if (key == key_southwest) {
			snd 1
			equipfilterpower -= 100
			if (equipfilterpower < 0) {
				equipfilterpower = 500
			}
			goto *label_2024
		}
		if (key == key_mode2) {
			snd 1
			oom_inheritance_search = 1 - oom_inheritance_search
			goto *label_2024
		}
		if (key == key_msglog) {
			snd 1
			oomSEST_livingWeapon_search = 1 - oomSEST_livingWeapon_search
			goto *label_2024
		}
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_2024
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_2024
		}
	}
	goto *label_2024
	return
*label_2025
*label_2026
	gosub *label_1350
	if (map(x, y, 6) != 0) {
		oom_gdata_19 = map(x, y, 6) \ 1000
		oom_gdata_20 = map(x, y, 6) / 100000 \ 100 + map(x, y, 6) / 10000000 * 100
		gosub *label_2027
		gosub *label_0623
	} else {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *label_0623
		return
	}
	return
*label_2027
	snd 26
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	windowshadow = 1
	listmax = 0
	if (jp) {
		s = "外観　", "色　　"
	}
	if (en) {
		s = "----", "----"
	}
	p = 2
	repeat p
		list(0, cnt) = cnt
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop
*label_2028
	redraw 0
	pagesize = 0
	s = lang("外観の変更", "Parts to hide"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 360) / 2 + inf_screenx, winposy(289) - 12, 360, 289
	s = lang("項目", "Part")
	pagesize = listmax
	display_topic s, wx + 34, wy + 36
	i++
	if (i \ 100 < 45) {
		f = i \ 16
	} else {
		f++
	}
	window2 wx + 234, wy + 60, 96, 96, 1, 1
	mapchip_preparepic x, y
	pos wx + 234 + 24, wy + 60 + 24
	gmode 2, 32, 48
	gcopy 96, 0, 240, 48, 48
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if (p >= listmax) {
			break
		}
		s = listn(0, p)
		if (p == 0) {
			s += areaExAppearance(oom_gdata_20)
		} else {
			s += areaExAppearanceColor(oom_gdata_20)
		}
		pos wx + 30, wy + 66 + cnt * 21 - 5
		gcopy 3, 312, 336, 24, 24
		pos wx + 175, wy + 66 + cnt * 21 - 5
		gcopy 3, 336, 336, 24, 24
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if (key == key_pageup) {
		snd 5
		if (cs == 0) {
			if (areaExAppearance(oom_gdata_20) < 50) {
				areaExAppearance(oom_gdata_20)++
			}
		} else {
			if (areaExAppearanceColor(oom_gdata_20) < 21) {
				areaExAppearanceColor(oom_gdata_20)++
			}
		}
	}
	if (key == key_pagedown) {
		snd 5
		if (cs == 0) {
			if (areaExAppearance(oom_gdata_20) > 0) {
				areaExAppearance(oom_gdata_20)--
			}
		} else {
			if (areaExAppearanceColor(oom_gdata_20) > 0) {
				areaExAppearanceColor(oom_gdata_20)--
			}
		}
	}
	if (key == key_enter | key == key_cancel) {
		snd 20
		return 1
	}
	goto *label_2028
*label_2029
	page = 0
	pagesize = 16
	listmax = 32
	cs = prev_es_cs \ 100
	page = prev_es_cs / 100
	cs_bk = -1
	cc = 0
	mainweapon = -1
	countequip = 0
	showmoney = 0
	gsel 3
	pos 960, 96
	picload_ exedir + "graphic\\deco_inv.bmp", 1
	gsel 0
	windowshadow = 1
	returnfromidentify = 0
*label_2030
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_2031
	redraw 0
	if (invctrl == 101) {
		s = lang("装備の保存", "Save equips"), strhint3 + oom_strhint6
	}
	if (invctrl == 102) {
		s = lang("装備の読み込み", "Load equips"), strhint3 + oom_strhint5
	}
	display_window (windoww - 640) / 2 + inf_screenx, winposy(432), 640, 432
	display_topic lang("スロットの名前", "Name"), wx + 28, wy + 30
	pos wx + ww - 136, wy - 6
	gcopy 3, 960, 96, 144, 48
	pos wx + ww - 246, wy - 6
	gcopy 3, 1008, 144, 48, 72
	pos wx - 6, wy - 6
	gcopy 3, 960, 216, 48, 72
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		s = ""
		if (p < 10) {
			s += "0"
		}
		s += "" + p + ":" + varesname(p)
		display_key wx + 28, wy + 60 + cnt * 19 - 2, cnt
		cs_list s, wx + 54, wy + 60 + cnt * 19 - 1, 19
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	prev_es_cs = page * 100 + cs
	repeat keyrange
		if (key == key_select(cnt)) {
			p = pagesize * page + cnt
			break
		}
	loop
	if (p != (-1)) {
		slot_no = p
		cc = 0
		if (invctrl == 101) {
			txtef 0
			txtc = 0
			txt -1, lang("スロットに名前を付ける事ができる。", "What do you call this equipment suite? ")
			tcol@txtfunc = 255, 255, 255
			val = (windoww - 540) / 2 + inf_screenx, winposy(90), 30, 1, 0
			inputlog = varesname(slot_no)
			gosub *label_1349
			if (ime_esc == 1) {
				txtef 0
				txtc = 0
				txt -1, lang("やっぱり保存するのをやめた。", "You changed your mind.")
				tcol@txtfunc = 255, 255, 255
			} else {
				varesname(slot_no) = inputlog
				repeat 30
					varequipsave(0, cnt, slot_no) = 0
					varequipsave(1, cnt, slot_no) = 0
					varequipsave(2, cnt, slot_no) = 0
					varequipsave(3, cnt, slot_no) = 0
					if (cdata(cnt + 100, cc) == 0) {
						continue
					}
					value = cdata(cnt + 100, cc) \ 10000 - 1
					if (value < 0) {
						continue
					}
					if (iCurseState(value) < 0) {
						continue
					}
					varequipsave(0, cnt, slot_no) = iId(value)
					varequipsave(1, cnt, slot_no) = iSubname(value)
					varequipsave(2, cnt, slot_no) = iMaterial(value)
					value2 = 0
					repeat 15
						encid = iEnchantmentId(value, cnt)
						encpow = iEnchantmentPower(value, cnt)
						value2 += encid
						encid = encid / 10000
						if (encid != 0) {
							if (encid == 9) {
								value2 += encpow / 1000
							} else {
								value2 += encpow
							}
						}
					loop
					varequipsave(3, cnt, slot_no) = value2
				loop
				txtef 0
				txtc = 0
				txt -1, lang("スロット" + slot_no + "に現在の装備を保存した。", "Current equipments is saved to the equipment suite No." + slot_no + ".")
				tcol@txtfunc = 255, 255, 255
			}
		}
		if (invctrl == 102) {
			gosub *label_2033
		}
		return
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_2030
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_2030
		}
	}
	if (invctrl == 102 & key == key_mode2) {
		snd 1
		invctrl = 101
		goto *label_2030
	}
	if (invctrl == 101 & key == key_msglog) {
		snd 1
		invctrl = 102
		goto *label_2030
	}
	if (key == key_cancel) {
		cc = 0
		efcancel = 1
		return
	}
	goto *label_2031
*label_2032
	repeat 30
		body = cnt + 100
		value = cdata(body, cc)
		if (value == 0) {
			continue
		}
		value = value / 10000
		if (gettrait(cc, 206) != 0 & value == 2) {
			continue
		}
		if (gettrait(cc, 203) != 0 & value == 9) {
			continue
		}
		if (gettrait(cc, 205) != 0 & value == 3) {
			continue
		}
		if (gettrait(cc, 217) != 0 & value == 1) {
			continue
		}
		if (gettrait(cc, 217) == (-2) & value == 8) {
			continue
		}
		if (gettrait(cc, 218) != 0 & value == 5) {
			continue
		}
		ci = cdata(cnt + 100, cc) \ 10000 - 1
		if (ci >= 0) {
			if (iCurseState(ci) == (-1) | iCurseState(ci) == (-2)) {
				txtef 0
				txtc = 0
				txt -1, lang(itemname(ci) + "は外せない。", "" + itemname(ci) + " can't be taken off.")
				tcol@txtfunc = 255, 255, 255
				continue
			}
			r1 = cc
			gosub *label_1419
		}
	loop
	return
*label_2033
	repeat 30
		body = cnt + 100
		value = cdata(body, cc)
		if (value == 0) {
			continue
		}
		value = value / 10000
		if (gettrait(cc, 206) != 0 & value == 2) {
			continue
		}
		if (gettrait(cc, 203) != 0 & value == 9) {
			continue
		}
		if (gettrait(cc, 205) != 0 & value == 3) {
			continue
		}
		if (gettrait(cc, 217) != 0) {
			if (value == 1) {
				continue
			}
			if (gettrait(cc, 217) == (-2)) {
				if (value == 8) {
					continue
				}
			}
		}
		if (gettrait(cc, 218) != 0 & value == 5) {
			continue
		}
		ci = cdata(cnt + 100, cc) \ 10000 - 1
		if (ci >= 0) {
			if (iCurseState(ci) == (-1) | iCurseState(ci) == (-2)) {
				txtef 0
				txtc = 0
				txt -1, lang(itemname(ci) + "は外せない。", "" + itemname(ci) + " can't be taken off.")
				tcol@txtfunc = 255, 255, 255
				continue
			}
			r1 = cc
			gosub *label_1419
		}
		if (varequipsave(0, cnt, slot_no) > 0) {
			invid = varequipsave(0, cnt, slot_no)
			invname = varequipsave(1, cnt, slot_no)
			invmate = varequipsave(2, cnt, slot_no)
			invencsum = varequipsave(3, cnt, slot_no)
			inv_getheader 0
			repeat invrange, invhead
				if (iNumber(cnt) != 1) {
					continue
				}
				if (iId(cnt) != invid) {
					continue
				}
				if (iSubname(cnt) != invname) {
					continue
				}
				if (iMaterial(cnt) != invmate) {
					continue
				}
				if (iCurseState(cnt) < 0) {
					continue
				}
				if (funciscanequip(cnt, cdata(body, cc) / 10000, cc) == 0) {
					continue
				}
				value2 = 0
				value = cnt
				repeat 15
					encid = iEnchantmentId(value, cnt)
					encpow = iEnchantmentPower(value, cnt)
					value2 += encid
					encid = encid / 10000
					if (encid != 0) {
						if (encid == 9) {
							value2 += encpow / 1000
						} else {
							value2 += encpow
						}
					}
				loop
				if (value2 != invencsum) {
					continue
				}
				if (iBodyPart(cnt) != 0) {
					value = body
					r1 = cc
					body = iBodyPart(cnt)
					gosub *label_1419
					body = value
				}
				r1 = cc
				ci = cnt
				gosub *label_1418
				break
			loop
		}
	loop
	r1 = cc
	snd 13
	gosub *chara_refresh
	gosub *label_1268
	txtef 0
	txtc = 0
	var_string1 = lang("スロット", "No.") + slot_no
	if (varesname(slot_no) != "") {
		var_string1 += ":" + varesname(slot_no)
	}
	txt -1, lang("" + var_string1 + "の装備に変更した。", "You changed your equipments to the equipment suite " + var_string1 + ".")
	tcol@txtfunc = 255, 255, 255
	return
	list(0, 0) = 0, 0
	listmax = 1
	repeat 18, 2
		if (skillname(cnt) == "") {
			continue
		}
		list(0, listmax) = cnt, sdataref(0, cnt) + 1000
		listmax++
	loop
	repeat 150, 150
		if (skillname(cnt) == "") {
			continue
		}
		list(0, listmax) = cnt, sdataref(0, cnt) + 2000
		listmax++
	loop
	repeat 50, 100
		if (skillname(cnt) == "") {
			continue
		}
		list(0, listmax) = cnt, sdataref(0, cnt) + 3000
		listmax++
	loop
	repeat 2, 300
		if (skillname(cnt) == "") {
			continue
		}
		list(0, listmax) = cnt, sdataref(0, cnt) + 4000
		listmax++
	loop
	gosub *label_1276
	page = 0
	cs = 0
	if (var_sort_type != 0) {
		value = abs(var_sort_type) \ 10000
		repeat listmax
			if (list(0, cnt) == value) {
				page = cnt / 16
				cs = cnt \ 16
			}
		loop
	}
	cs_bk = -1
*label_2034
	redraw 0
	pagesize = 16
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	s = lang("ソート対象の選択", "Skill Selection")
	s(1) = strhint2 + strhint3
	display_window (windoww - 320) / 2 + inf_screenx, winposy(432), 320, 432
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini 540 - 320, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		p = list(0, p)
		if (p == 0) {
			s = "なし"
		} else {
			s = skillname(p)
			pos wx + 38, wy + 70 + cnt * 19
			gmode 2, inf_tiles, inf_tiles
			if (p >= 2 & p <= 3) {
				p(1) = 10
			} else {
				if (p <= 17) {
					p(1) = p - 10
				} else {
					if (p <= 19) {
						p(1) = 10
					} else {
						p(1) = sdataref(0, p) - 10
					}
				}
			}
			grotate 1, p(1) * inf_tiles, 672, 0, inf_tiles, inf_tiles
		}
		display_key wx + 58, wy + 60 + cnt * 19 - 2, cnt
		cs_list s, wx + 84, wy + 60 + cnt * 19 - 1, 19, 0, 0, p
	loop
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			value = pagesize * page + cnt
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		snd 26
		if (p == 0) {
			value = 0
		}
		if (p >= 2 & p < 20) {
			value = 1 * 10000 + p
		}
		if (p >= 100 & p < 300) {
			value = 3 * 10000 + p
		}
		if (p >= 300 & p < 400) {
			value = 4 * 10000 + p
		}
		return value
	}
	if (key == key_cancel) {
		snd 27
		return -1
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_2034
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_2034
		}
	}
	goto *label_2034



#defcfunc funciscanequip int __vvv, int __www, int __xxx
	equiploc = iequiploc(__vvv, __www)
	if (equiploc == __www) {
		return 1
	}
	if (__www == 5 & equiploc == 10) {
		if (iSkill(__vvv) == 111) {
			if (eqthrowcheck(__xxx)) {
				return 0
			} else {
				return 1
			}
		}
		if (iSkill(__vvv) == 109) {
			return 1
		}
		if (iSkill(__vvv) == 110) {
			return 1
		}
	}
	return 0



#deffunc funcsaveequipsave str __yyy
	version = 1
	value = 0
	bsave __yyy, version, 4
	value += 4
	value2 = 32
	bsave __yyy, value2, 4, value
	value += 4
	bsave __yyy, varequipsave(0, 0, 0), 4 * 30 * 32 * 4, value
	value += 4 * 30 * 32 * 4
	value2 = 30
	bsave __yyy, value2, 4, value
	value += 4
	sdim var_string1, value2, 1
	repeat 32
		memset var_string1, 0, value2, 0
		var_string1 = varesname(cnt)
		bsave __yyy, var_string1, value2, value
		value += value2
	loop
	return



#deffunc funcloadequipsave str __zzz
	dim varequipsave, 4, 30, 32
	sdim varesname, 30, 32
	exist __zzz
	if (strsize == (-1)) {
		return
	}
	value = 4
	bload __zzz, value2, 4, value
	value += 4
	value3 = value2
	if (32 < value2) {
		value3 = 32
	}
	bload __zzz, varequipsave(0, 0, 0), 4 * 30 * value3 * 4, value
	value += 4 * 30 * value2 * 4
	bload __zzz, value2, 4, value
	value += 4
	sdim var_string1, value2, 1
	sdim varesname, value2, value3
	repeat value3
		bload __zzz, varesname(cnt), value2, value
		value += value2
	loop
	return



#deffunc mapchip_preparepic int __aaa, int __bbb
	oom_gdata_19 = map(__aaa, __bbb, 6) \ 1000
	oom_gdata_20 = map(__aaa, __bbb, 6) / 100000 \ 100 + map(__aaa, __bbb, 6) / 10000000 * 100
	gsel 96
	color 0
	boxf 0, 240, 48, 248
	pos 0, 240
	if (areaExAppearance(oom_gdata_20) != 0) {
		gcopy 96, areaExAppearance(oom_gdata_20) \ 10 * 48, areaExAppearance(oom_gdata_20) / 10 * 48, 48, 48
	} else {
		gcopy 2, oom_gdata_19 \ 33 * inf_tiles, oom_gdata_19 / 33 * inf_tiles, inf_tiles, 48 + chipm(6, oom_gdata_19)
	}
	gfini 48, 48
	gfdec2 c_col(0, areaExAppearanceColor(oom_gdata_20)), c_col(1, areaExAppearanceColor(oom_gdata_20)), c_col(2, areaExAppearanceColor(oom_gdata_20))
	gsel 0
	return



#defcfunc direction2 int __ccc, int __ddd, int __eee
	if (__eee == 0) {
		dx = cX(__ddd) - cX(__ccc)
		dy = cY(__ddd) - cY(__ccc)
	} else {
		dx = areaX(__ddd) - areaX(__ccc)
		dy = areaY(__ddd) - areaY(__ccc)
	}
	deg = atan(dy, dx)
	if (deg < 0.0) {
		deg += 3.14159265 * 2
	}
	deg = deg * 180.0 / 3.14159265
	if (deg < 15.0) {
		return lang("東(右)", "east")
	} elseif (deg < 75.0) {
		return lang("南東(右下)", "southeast")
	} elseif (deg < 105.0) {
		return lang("南(下)", "south")
	} elseif (deg < 165.0) {
		return lang("南西(左下)", "southwest")
	} elseif (deg < 195.0) {
		return lang("西(左)", "west")
	} elseif (deg < 255.0) {
		return lang("北西（左上)", "northwest")
	} elseif (deg < 285.0) {
		return lang("北(上)", "north")
	} elseif (deg < 345.0) {
		return lang("北東(右上)", "northeast")
	} else {
		return lang("東(右)", "east")
	}



#defcfunc direction2_short int __a, int __b, int __charaPos
	s@tmp = direction2(__a, __b, __charaPos)
	if (jp) {
		return s@tmp
	} else {
		if (s@tmp == "north") { return "N" }
		elseif (s@tmp == "south") { return "S" }
		elseif (s@tmp == "east") { return "E" }
		elseif (s@tmp == "west") { return "W" }
		elseif (s@tmp == "northeast") { return "NE" }
		elseif (s@tmp == "northwest") { return "NW" }
		elseif (s@tmp == "southeast") { return "SE" }
		elseif (s@tmp == "southwest") { return "SW" }
		else { return "Error" }
	}



#defcfunc splittime int __fff
	oom_y = __fff / (24 * 30 * 12)
	oom_m = __fff \ (24 * 30 * 12) / (24 * 30)
	if (oom_m == 0 & oom_y > 0) {
		oom_m = 12
	}
	oom_d = __fff \ (24 * 30 * 12) \ (24 * 30) / 24
	if (oom_d == 0 & oom_m > 0) {
		oom_d = 30
	}
	oom_h = __fff \ (24 * 30 * 12) \ (24 * 30) \ 24
	return "" + oom_y + "年" + oom_m + "月" + oom_d + "日" + oom_h + "時"



#defcfunc floorstr int __ggg
	if (__ggg == 0) {
		oom_s = "2階"
	} else {
		if (__ggg == 1) {
			oom_s = ""
		} else {
			oom_s = "B" + (__ggg - 1) + "階"
		}
	}
	return oom_s



#deffunc burntoffering int __hhh, int __iii
	if (gCurrentMap == 35) {
		return
	}
	if (rnd(5 - limit(int(sqrt(iNumber(__hhh))), 1, 4))) {
		return
	}
	olist = 13, 14, 15, 16
	olistmax = 4
	atxspot = olist(rnd(olistmax))
	axtcnt = 1
	if (__iii == 0) {
		axtcnt += limitmax(rnd(rnd(int(sqrt(cPietyPoint(__iii) / 1000)) + 1) + 1), 5)
	} else {
		axtcnt += limitmax(rnd(rnd(int(sqrt(cPietyPoint(__iii) / 1000)) + 1) + 1) / 4, 2)
	}
	repeat axtcnt
		burntatx = random_material(atxspot, 5 + (cPietyPoint(__iii) / 400))
		matgetmain burntatx, 1, 0
	loop
	return



#deffunc removeallfire
	removecnt = 0
	repeat 200
		if (mef(0, 200 - cnt - 1) == 5) {
			delmef 200 - cnt - 1
			removecnt++
		}
	loop
	if (removecnt) {
		txt -1, lang("火柱は消えた。", "Walls of fire disappears.")
	}
	return



#defcfunc mediafind str __jjj, str __kkk
	mediafile = exedir + "user\\cmap\\" + __kkk
	exist mediafile
	if (strsize != (-1)) {
		return 0
	}
	mediafile = exedir + "user\\" + __jjj + __kkk
	exist mediafile
	if (strsize != (-1)) {
		return 0
	} else {
		mediafile = exedir + __jjj + __kkk
		exist mediafile
		if (strsize != (-1)) {
			return 0
		}
	}
	mediafile = ""
	return -1



#deffunc playsound str __lll, int __mmm
	if (mediafind("sound\\", __lll) != (-1)) {
		sndload mediafile, 200 + __mmm
		snd 200 + __mmm, 0, 2
	}
	return



#deffunc playbgm str __nnn
	if (mediafind("sound\\", __nnn) != (-1)) {
		musicfile(length(musicfile) - 1) = __nnn
		music = length(musicfile) - 1
		gosub *label_0122
	}
	return



#deffunc se_moneymod int __ooo, int __ppp
	if (__ooo == 0 & ncgdata(50) < 2000000000) {
		if (__ppp > 0) {
			cGold(__ooo) += __ppp
			if (cGold(__ooo) < 0) {
				ncgdata(50) = limitmax(ncgdata(50) + 1, 2000000000)
				cGold(__ooo) += 2147483647 + 2
			}
			return
		}
	}
	cGold(__ooo) = limitaddition(cGold(__ooo), __ppp)
	return



#defcfunc mapbit int __qqq, int __rrr, int __sss
	HMMBITCHECK map(__rrr, __sss, 3 + __qqq / 32), __qqq \ 32
	return abs(stat)



#deffunc mapbitmod int __ttt, int __uuu, int __vvv, int __www
	if (__www == 0) {
		HMMBITOFF map(__uuu, __vvv, 3 + __ttt / 32), __ttt \ 32
		return
	}
	HMMBITON map(__uuu, __vvv, 3 + __ttt / 32), __ttt \ 32
	return
*label_2050
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	if (areaOuterMap(gCurrentMap) == 47) {
		// フェアリゾート
		cposlist = 48
	} else {
		if (areaOuterMap(gCurrentMap) == 4) {
			// ノースティリス
			cposlist = 3, 5, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 36, 38, 42
		} else {
			// サウスティリス
			cposlist = 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60
		}
	}

	dim cpos, 2, length(cposlist)
	repeat length(cposlist)
		cpos(0, cnt) = areaX(cposlist(cnt)), areaY(cposlist(cnt))
	loop
	repeat 500 - 450, 450
		if (areaType(cnt) == 0) {
			continue
		}
		if (nefiaprefix \ 18 != 0) {
			if (oabit(nefiaprefix \ 18 - 1, cnt) == 0) {
				continue
			}
		}
		if (areaId(cnt) == 8) {
			min = 1000
			cnt2 = cnt
			repeat length(cposlist)
				tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos(0, cnt), cpos(1, cnt))
				if (min > tmpdist) {
					min = tmpdist
					cposdist = cnt
				}
			loop
			list(0, listmax) = cnt, areaDangerLevel(cnt), cposlist(cposdist)
			listmax++
		}
	loop
	gosub *label_1276
	windowshadow = 1
*label_2051
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_2052
	redraw 0
	s = lang("ネフィア一覧", "Nefia List"), strhint2 + strhint3 + oom_strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	if (nefiaprefix \ 18 != 0) {
		display_topic lang("名前", "Name") + " - " + oadatastr(nefiaprefix \ 18 - 1), wx + 28, wy + 36
	} else {
		display_topic lang("名前", "Name"), wx + 28, wy + 36
	}
	display_topic lang("危険度", "Danger lv"), wx + 320 - en * 75, wy + 36
	display_topic lang("位置情報", "Location"), wx + 420 - en * 75, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 50, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		pos wx + 52 - 16, wy + 66 + cnt * 19 - 1
		if (areaVisitedDeepestFloor(list(0, p)) == areaLastFloor(list(0, p))) {
			gcopy 3, 32, 624, 16, 16
		} else {
			if (areaVisitedDeepestFloor(list(0, p)) != 0) {
				gcopy 3, 48, 624, 16, 16
			}
		}
		s = "" + mapname(list(0, p))
		cs_list s, wx + 52, wy + 66 + cnt * 19 - 1, 19
		s = "" + list(1, p)
		pos wx + 402 - strlen(s) * 7 - en * 75, wy + 66 + cnt * 19 + 2
		mes s
		if (jp) {
			s = mapname(list(2, p)) + " " + direction2(list(2, p), list(0, p), 1)
		} else {
			s = "To the " + direction2_short(list(2, p), list(0, p), 1) + " of " + mapname(list(2, p))
		}
		pos wx + 435 - en * 75, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_2051
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_2051
		}
	}
	if (key == key_southeast | key == key_next) {
		snd 1
		nefiaprefix++
		if (nefiaprefix > 17) {
			nefiaprefix = 0
		}
		goto *label_2050
	}
	if (key == key_southwest | key == key_prev) {
		snd 1
		nefiaprefix--
		if (nefiaprefix < 0) {
			nefiaprefix = 17
		}
		goto *label_2050
	}
	if (key == key_cancel) {
		nefiaprefix = 0
		return
	}
	goto *label_2052
*label_2053
	if (existfile_minimap == 1) {
		repeat mapHeight
			sy = cnt
			repeat mapWidth
				sx = cnt
				if (map(sx, sy, 2) == map(sx, sy, 0)) {
					gosub *label_0645
				}
			loop
		loop
		sy = 84 * cY(i) / mapHeight
		if (sy < 2) {
			sy = 2
		} else {
			if (sy > 84 - 8) {
				sy = 84 - 8
			}
		}
		sx = 120 * cX(i) / mapWidth
		if (sx < 2) {
			sx = 2
		} else {
			if (sx > 120 - 8) {
				sx = 120 - 8
			}
		}
		pos inf_raderx + sx, inf_radery + sy
		gcopy 97, 24, 0, 6, 6
	}
	return
*label_2054
	page = 0
	cs = 0
	cs_bk = -1
	warplistmax = 0
	dim warplist, 3, 400
	inv_getheader -1
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		if (ibit(20, cnt) == 1) {
			p@00m = cnt
			f@00m = 0
			repeat warplistmax
				if (iX(p@00m) == iX(warplist(0, cnt))) {
					if (iY(p@00m) == iY(warplist(0, cnt))) {
						f@00m = 1
						break
					}
				}
			loop
			if (f@00m == 0) {
				warplist(0, warplistmax) = cnt
				warplistmax++
			}
		}
	loop
	if (warplistmax == 0) {
		return -1
	}
	gosub *label_2057
*label_2055
	redraw 0
	pagesize = 16
	pagemax = (warplistmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
	s = lang("テレポート先の選択", "Go where?")
	s(1) = strhint2 + "Shift,Esc " + lang("[通常のテレポート]", "[Normal teleport]") + "  "
	display_window (windoww - 440) / 2 + inf_screenx, winposy(432), 440, 400
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= warplistmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= warplistmax) {
			break
		}
		i = warplist(0, p)
		if (cs == cnt) {
			gosub *label_2056
		}
		color 255, 0, 255
		gmode 4, , , 255
		pos wx + 28 - 12, wy + 40
		gcopy 94, 0, 0, 120 * 3 + 2 + 24, 84 * 3 + 2 + 18
	loop
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			value = pagesize * page + cnt
			p = warplist(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		snd 26
		return p
	}
	if (key == key_cancel) {
		return -1
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			gosub *label_2057
			goto *label_2055
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			gosub *label_2057
			goto *label_2055
		}
	}
	goto *label_2055
*label_2056
	gsel 94
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= warplistmax) {
			break
		}
		if (warplist(0, p) != (-1)) {
			sy@00m = 84 * 3 * iY(warplist(0, p)) / mapHeight + 18
			if (sy@00m < 2) {
				sy@00m = 2
			} else {
				if (sy@00m > 84 * 3) {
					sy@00m = 84 * 3
				}
			}
			sx@00m = 120 * 3 * iX(warplist(0, p)) / mapWidth + 24
			if (sx@00m < 2) {
				sx@00m = 2
			} else {
				if (sx@00m > 120 * 3) {
					sx@00m = 120 * 3
				}
			}
			gmode 2
			display_key sx@00m - 24, sy@00m - 18, cnt
			if (existfile_minimap == 1) {
				pos 0 + sx@00m, 0 + sy@00m
				gcopy 97, 30, 0, 6, 6
				if (i != warplist(0, p)) {
					gfini 6, 6
					gfdec2 100, 100, 100
				}
			}
		}
	loop
	gsel 0
	return
*label_2057
	gsel 94
	color 255, 0, 255
	boxf
	pos 24, 18
	gzoom 120 * 3 + 2, 84 * 3 + 2, 3, 123, 508, 118, 81
	redraw 1
	repeat mapHeight
		sy@00m = cnt
		repeat mapWidth
			sx@00m = cnt
			sx@00m(1) = 120 * sx@00m * 3 / mapWidth + 24
			sy@00m(1) = 84 * sy@00m * 3 / mapHeight + 18
			pos sx@00m(1), sy@00m(1)
			raderw@00m = 120 * 3 / mapWidth + 2
			radery@00m = 84 * 3 / mapHeight + 2
			if (map(sx@00m, sy@00m, 2) == map(sx@00m, sy@00m, 0)) {
				gcopy 2, map(sx@00m, sy@00m, 0) \ 33 * inf_tiles + sx \ 16, map(sx@00m, sy@00m, 0) / 33 * inf_tiles + sy@00m \ 12, raderw@00m, radery@00m
				pos 0 + sx@00m(1), 0 + sy@00m(1)
				gfini raderw@00m, radery@00m
				if (chipm(7, map(sx@00m, sy@00m, 0)) & 4) {
					gfdec2 100, 100, 100
				}
			}
		loop
	loop
	gsel 0
	return
*label_2058
	setting@00m = 1
	default@00m = 0
	listmax = 0
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	page_bk = 0
	cs_bk2 = 0
	tmpcolor@00m = 0, 0, 0
	tmpbgcolor@00m = 255, 255, 255
	tmpfont@00m = 0, cfg_txtpopfont, 0
	i@00m = 0
	windowshadow = 1
*label_2059
	listmax = 0
	q = "個別設定"
	if (tc == 0) {
		if (default@00m == 1) {
			q = "吹き出しデフォルト設定"
		}
	}
	if (default@00m == 0) {
		s = "会話タイプ", "吹き出しオフでも表示", "位置ｘ", "位置ｙ", "文字R", "文字G", "文字B", "背景R", "背景G", "背景B", "フォント", "フォントサイズ", "フォント装飾", ""
	} else {
		s = "文字R", "文字G", "文字B", "背景R", "背景G", "背景B", "フォント", "フォントサイズ", "フォント装飾", ""
	}
	dx = 440 + inf_tiles * 3
	dy = 400
	buffer 220, 200, 100
	if (default@00m == 1) {
		if (gdatac(20) == 1) {
			split8bit gdatac(21), tmpcolor@00m
			split8bit gdatac(22), tmpbgcolor@00m
			split8bit gdatac(23), tmpfont@00m
			tmpfont@00m(1) = cfg_txtpopfont
		}
	} else {
		if (ocdata(163, tc) == 1) {
			split8bit ocdata(167, tc), tmpcolor@00m
			split8bit ocdata(168, tc), tmpbgcolor@00m
			split8bit ocdata(169, tc), tmpfont@00m
		}
	}
	font fontlist@00m(tmpfont@00m(0)), 2 + tmpfont@00m(1) - en * 2, tmpfont@00m(2)
	tmps@00m = "吹き出しTEST"
	autoinsertlf tmps@00m, tmp@00m, 48 * 5
	dim tmpsize@00m, 2
	getstrrect hdc, tmp@00m, tmpsize@00m
	tmpsize@00m(0) += 10
	tmpsize@00m(1) += 20
	width tmpsize@00m(0), tmpsize@00m(1)
	color 255, 0, 255
	boxf
	color tmpcolor@00m(0), tmpcolor@00m(1), tmpcolor@00m(2)
	bgcolor = tmpbgcolor@00m(0), tmpbgcolor@00m(1), tmpbgcolor@00m(2)
	fukidashi 0, 0, tmpsize@00m(0), tmpsize@00m(1) - 10, 5, 1, bgcolor
	pos 5, 5
	mes tmps@00m
	gsel 0
	repeat 30
		if (s(cnt) == "") {
			break
		}
		list(0, listmax) = cnt
		listn(0, listmax) = s(cnt)
		listmax++
	loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_2060
	redraw 0
	screenupdate = -1
	gosub *label_0623
	buffer 221, inf_tiles * 3, inf_tiles * 3
	x@00m = (cX(tc) - scx) * inf_tiles + inf_screenx - 48
	y@00m = (cY(tc) - scy) * inf_tiles + inf_screeny - 48 - 48
	gcopy 0, x@00m, y@00m, inf_tiles * 3, inf_tiles * 3
	gsel 0
	pagesize = 0
	s = q, lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]  " + key_mode2 + " [設定初期化]", "Right,left [Change]  Shift,Esc [Close]  " + key_mode2 + " [Reset]")
	if (tc == 0) {
		if (default@00m == 1) {
			s(1) += "  " + key_msglog + " [吹き出し個別設定]"
		} else {
			s(1) += "  " + key_msglog + " [吹き出しデフォルト設定]"
		}
	}
	display_window (windoww - dx) / 2 + inf_screenx, winposy(dy) - 12, dx, dy
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_cancel
		keyrange++
	loop
	keyrange = 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		x = 0
		cs_list s, wx + 56 + x, wy + 66 + cnt * 19 - 1, 19, 0
		pos wx + 200, wy + 66 + cnt * 19 - 5
		gcopy 3, 312, 336, 24, 24
		pos wx + 370, wy + 66 + cnt * 19 - 5
		gcopy 3, 336, 336, 24, 24
		pos wx + 230, wy + 66 + cnt * 19
		color 0, 0, 0
		if (default@00m == 0) {
			if (cnt == 0) {
				if (cSex(tc) == 0) {
					s = "私：お願いします", "俺：頼む", "僕：頼むね", "自分：頼む…", "麻呂：頼むぞよ", "拙者：頼み申す", "あっし：頼むッス"
				} else {
					s = "私：お願いしますわ", "あたし：頼むよ", "わたし：頼むわ", "自分：頼むわ…", "わらわ：頼むぞよ", "手前：お頼み申し上げます", "みゅー：おねがいにゃ"
				}
				keyrange++
				mes s(cTalkType(tc))
			}
			if (cnt == 1) {
				s = "しない", "一つ", "無制限", ""
				keyrange++
				mes s(ocdata(164, tc))
			}
			if (cnt == 2) {
				keyrange++
				mes ocdata(165, tc)
			}
			if (cnt == 3) {
				keyrange++
				mes ocdata(166, tc)
			}
			if (cnt == 4 | cnt == 5 | cnt == 6) {
				keyrange++
				mes tmpcolor@00m(cnt - 4)
			}
			if (cnt == 7 | cnt == 8 | cnt == 9) {
				keyrange++
				mes tmpbgcolor@00m(cnt - 7)
			}
			if (cnt == 10) {
				keyrange++
				mes "" + tmpfont@00m(0) + ":" + fontlist@00m(tmpfont@00m(0))
			}
			if (cnt == 11) {
				keyrange++
				mes tmpfont@00m(1)
			}
			if (cnt == 12) {
				keyrange++
				s@00m = "" + tmpfont@00m(2) + ":"
				if (tmpfont@00m(2) == 0) {
					s@00m += "N"
				}
				if (tmpfont@00m(2) & 1) {
					s@00m += "B "
				}
				if (tmpfont@00m(2) & 2) {
					s@00m += "I "
				}
				if (tmpfont@00m(2) & 4) {
					s@00m += "U "
				}
				if (tmpfont@00m(2) & 8) {
					s@00m += "S "
				}
				if (tmpfont@00m(2) & 16) {
					s@00m += "AA"
				}
				mes s@00m
			}
		} else {
			if (cnt == 0 | cnt == 1 | cnt == 2) {
				keyrange++
				mes tmpcolor@00m(cnt)
			}
			if (cnt == 3 | cnt == 4 | cnt == 5) {
				keyrange++
				mes tmpbgcolor@00m(cnt - 3)
			}
			if (cnt == 6) {
				keyrange++
				mes "" + tmpfont@00m(0) + ":" + fontlist@00m(tmpfont@00m(0))
			}
			if (cnt == 7) {
				keyrange++
				mes tmpfont@00m(1)
			}
			if (cnt == 8) {
				keyrange++
				s@00m = "" + tmpfont@00m(2) + ":"
				if (tmpfont@00m(2) == 0) {
					s@00m += "N"
				}
				if (tmpfont@00m(2) & 1) {
					s@00m += "B "
				}
				if (tmpfont@00m(2) & 2) {
					s@00m += "I "
				}
				if (tmpfont@00m(2) & 4) {
					s@00m += "U "
				}
				if (tmpfont@00m(2) & 8) {
					s@00m += "S "
				}
				if (tmpfont@00m(2) & 16) {
					s@00m += "AA"
				}
				mes s@00m
			}
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	window2 wx + 400, wy + 66 - 1, inf_tiles * 3 + 10, inf_tiles * 3 + 10, 1, 1
	pos wx + 400 + 5, wy + 66 - 1 + 5
	gmode 1
	gcopy 221, 0, 0, inf_tiles * 3, inf_tiles * 3
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	f@00m = 0
	if (key == key_southeast | key == key_next) {
		p = 10
		f@00m = 1
	}
	if (key == key_southwest | key == key_prev) {
		p = -10
		f@00m = 1
	}
	if (key == key_pageup) {
		p = 1
		f@00m = 1
	}
	if (key == key_pagedown) {
		p = -1
		f@00m = 1
	}
	if (f@00m == 1) {
		if (default@00m == 0) {
			if (cs == 0) {
				cTalkType(tc) += p
				if (cTalkType(tc) > 6) {
					cTalkType(tc) = 0
				} else {
					if (cTalkType(tc) < 0) {
						cTalkType(tc) = 6
					}
				}
				snd 20
				goto *label_2059
			}
			if (ocdata(163, tc) == 0) {
				ocdata(167, tc) = join8bit(tmpcolor@00m)
				ocdata(168, tc) = join8bit(tmpbgcolor@00m)
				ocdata(169, tc) = join8bit(tmpfont@00m)
				ocdata(163, tc) = 1
			}
			if (cs == 1) {
				ocdata(164, tc) += p
				if (ocdata(164, tc) < 0) {
					ocdata(164, tc) = 2
				}
				if (ocdata(164, tc) > 2) {
					ocdata(164, tc) = 0
				}
				snd 20
				goto *label_2059
			}
			if (cs == 2) {
				ocdata(165, tc) += p
				if (ocdata(165, tc) < (-24)) {
					ocdata(165, tc) = 24
				}
				if (ocdata(165, tc) > 24) {
					ocdata(165, tc) = -24
				}
				snd 20
				goto *label_2059
			}
			if (cs == 3) {
				ocdata(166, tc) += p
				if (ocdata(166, tc) < (-48)) {
					ocdata(166, tc) = 48
				}
				if (ocdata(166, tc) > 48) {
					ocdata(166, tc) = -48
				}
				snd 20
				goto *label_2059
			}
			if (cs == 4 | cs == 5 | cs == 6) {
				tmpcolor@00m(cs - 4) += p
				if (tmpcolor@00m(cs - 4) > 255) {
					tmpcolor@00m(cs - 4) = 0
				}
				if (tmpcolor@00m(cs - 4) < 0) {
					tmpcolor@00m(cs - 4) = 255
				}
				ocdata(167, tc) = join8bit(tmpcolor@00m)
				snd 20
				goto *label_2059
			}
			if (cs == 7 | cs == 8 | cs == 9) {
				tmpbgcolor@00m(cs - 7) += p
				if (tmpbgcolor@00m(cs - 7) > 255) {
					tmpbgcolor@00m(cs - 7) = 0
				}
				if (tmpbgcolor@00m(cs - 7) < 0) {
					tmpbgcolor@00m(cs - 7) = 255
				}
				ocdata(168, tc) = join8bit(tmpbgcolor@00m)
				snd 20
				goto *label_2059
			}
			if (cs == 10) {
				tmpfont@00m(0) += p
				if (tmpfont@00m(0) > length(fontlist@00m) - 1) {
					tmpfont@00m(0) = 0
				}
				if (tmpfont@00m(0) < 0) {
					tmpfont@00m(0) = length(fontlist@00m) - 1
				}
				ocdata(169, tc) = join8bit(tmpfont@00m)
				snd 20
				goto *label_2059
			}
			if (cs == 11) {
				tmpfont@00m(cs - 10) += p
				if (tmpfont@00m(1) > 30) {
					tmpfont@00m(1) = 8
				}
				if (tmpfont@00m(1) < 8) {
					tmpfont@00m(1) = 30
				}
				ocdata(169, tc) = join8bit(tmpfont@00m)
				snd 20
				goto *label_2059
			}
			if (cs == 12) {
				tmpfont@00m(2) += p
				if (tmpfont@00m(2) > 31) {
					tmpfont@00m(2) = 0
				}
				if (tmpfont@00m(2) < 0) {
					tmpfont@00m(2) = 31
				}
				ocdata(169, tc) = join8bit(tmpfont@00m)
				snd 20
				goto *label_2059
			}
		} else {
			if (gdatac(20) == 0) {
				gdatac(21) = join8bit(tmpcolor@00m)
				gdatac(22) = join8bit(tmpbgcolor@00m)
				gdatac(23) = join8bit(tmpfont@00m)
				gdatac(20) = 1
			}
		}
		if (cs == 0 | cs == 1 | cs == 2) {
			tmpcolor@00m(cs) += p
			if (tmpcolor@00m(cs) > 255) {
				tmpcolor@00m(cs) = 0
			}
			if (tmpcolor@00m(cs) < 0) {
				tmpcolor@00m(cs) = 255
			}
			gdatac(21) = join8bit(tmpcolor@00m)
			snd 20
			goto *label_2059
		}
		if (cs == 3 | cs == 4 | cs == 5) {
			tmpbgcolor@00m(cs - 3) += p
			if (tmpbgcolor@00m(cs - 3) > 255) {
				tmpbgcolor@00m(cs - 3) = 0
			}
			if (tmpbgcolor@00m(cs - 3) < 0) {
				tmpbgcolor@00m(cs - 3) = 255
			}
			gdatac(22) = join8bit(tmpbgcolor@00m)
			snd 20
			goto *label_2059
		}
		if (cs == 6) {
			tmpfont@00m(0) += p
			if (tmpfont@00m(0) > length(fontlist@00m) - 1) {
				tmpfont@00m(0) = 0
			}
			if (tmpfont@00m(0) < 0) {
				tmpfont@00m(0) = length(fontlist@00m) - 1
			}
			gdatac(23) = join8bit(tmpfont@00m)
			snd 20
			goto *label_2059
		}
		if (cs == 7) {
			tmpfont@00m(1) += p
			if (tmpfont@00m(1) > 30) {
				tmpfont@00m(1) = 8
			}
			if (tmpfont@00m(1) < 8) {
				tmpfont@00m(1) = 30
			}
			gdatac(23) = join8bit(tmpfont@00m)
			cfg_txtpopfont = tmpfont@00m(1)
			config_saveOmakeOption "txtpopFont.", str(cfg_txtpopfont)
			snd 20
			goto *label_2059
		}
		if (cs == 8) {
			tmpfont@00m(2) += p
			if (tmpfont@00m(2) > 31) {
				tmpfont@00m(2) = 0
			}
			if (tmpfont@00m(2) < 0) {
				tmpfont@00m(2) = 31
			}
			gdatac(23) = join8bit(tmpfont@00m)
			snd 20
			goto *label_2059
		}
	}
	if (key == key_mode2) {
		snd 20
		promptl(0, promptmax) = lang("いいえ", "No"), "a", "" + promptmax
		promptmax++
		promptl(0, promptmax) = lang("はい", "Yes"), "b", "" + promptmax
		promptmax++
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval == 1) {
			if (default@00m == 0) {
				ocdata(163, tc) = 0
				ocdata(164, tc) = 0
				ocdata(165, tc) = 0
				ocdata(166, tc) = 0
				ocdata(167, tc) = 0
				ocdata(168, tc) = 0
				ocdata(169, tc) = 0
			} else {
				gdatac(20) = 0
				gdatac(21) = 0
				gdatac(22) = 0
				gdatac(23) = 0
			}
			tmpcolor@00m = 0, 0, 0
			tmpbgcolor@00m = 255, 255, 255
			tmpfont@00m = 0, cfg_txtpopfont, 0
		}
		goto *label_2059
	}
	if (tc == 0) {
		if (key == key_msglog) {
			snd 20
			default@00m = 1 - default@00m
			tmpcolor@00m = 0, 0, 0
			tmpbgcolor@00m = 255, 255, 255
			tmpfont@00m = 0, cfg_txtpopfont, 0
			goto *label_2059
		}
	}
	if (key == key_cancel) {
		setting@00m = 0
		return
	}
	goto *label_2060
// NCAddon
// 鎧破壊の巻物
*label_2061
	if (efstatus == 0) {
		if (synccheck(tc, -1)) {
			txt -1, lang(name(tc) + "の装備品は不気味な光に包まれた。", name(tc) + " " + your(tc) + " equipment are surrounded by a Black aura.")
		}
	}
	inv_getheader tc
	p(1) = 0, 0
	repeat invrange, invhead
		if (iNumber(cnt) == 0) {
			continue
		}
		ci = cnt
		p = 0
		if (iCurseState(ci) == 0) {
			p = rnd(200) + 1
		}
		if (iCurseState(ci) == 1) {
			p = rnd(10000) + 1
		}
		if (iBodyPart(ci) == 0) {
			continue
		}
		if (p != 0) {
			if (efp >= p & iQuality(ci) != 6) {
				p(1)++
				if (iBodyPart(ci) != 0) {
					cdata(iBodyPart(ci), tc) = cdata(iBodyPart(ci), tc) / 10000 * 10000
					iBodyPart(ci) = 0
				}
				iNumber(ci)--
				txtef 3
				txt -1, lang("" + itemname(ci) + "が破壊された。", "" + itemname(ci) + "disappear with a white aura.")
				snd 47
				iCurseState(ci) = 0
				item_stack tc, ci, 1
			} else {
				p(2)++
			}
		}
	loop
	if (p(2) != 0) {
		if (synccheck(tc, -1)) {
			txt -1, lang("幾つかのアイテムは抵抗した。", "Several items resist the aura and remain cursed.")
		}
	}
	if (p(1) == 0 & p(2) == 0) {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		obvious = 0
	} else {
		animeload 14, tc
	}
	r1 = tc
	gosub *chara_refresh
	return

	*label_N001
		txtef 5
		txt -1, lang("どの魔法を望む？", "What do you wish magic for? ")
		val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
		inputlog = ""
		gosub *label_1349
		msgtemp = ""
		tcopy = 1
		if (en) {
			inputlog = getpath(inputlog, 16)
		}
		snd 24
		gosub *label_1200
		i = 0
		repeat 600
			f = 0
			if (cnt >= 400 & cnt <= 466 & cnt != 441 & cnt != 464 & cnt != 426 & cnt != 427) {
				f = 1
			}
			if (cnt >= 500 & cnt <= 549) {
				f = 1
			}
			if (f == 0) {
				continue
			}
			p = 0
			cnt2 = cnt
			s = skillname(cnt2)
			if (skillname(cnt2) == "") {
				continue
			}
			if (en) {
				s = getpath(s, 16)
			}
			if (s == inputlog) {
				p = 10000
			}
			repeat strlen(inputlog) / (1 + jp)
				if (instr(s, 0, strmid(inputlog, cnt * (1 + jp), 1 + jp)) != (-1)) {
					p += 50 + rnd(15)
				}
			loop
			if (p != 0) {
				dblist(0, i) = cnt, p
				i++
			}
		loop
		if (i != 0) {
			p = 0, 0
			repeat i
				if (dblist(1, cnt) > p(1)) {
					p = dblist(0, cnt), dblist(1, cnt)
				}
			loop
			if (skillname(p) != "") {
					txtef 5
					txt -1, lang(skillname(p) + "を習得した！", "Your " + skillname(p) + " magic improves!")
					efid = p
			} else {
				p = 400
				txtef 5
				txt -1, lang(skillname(p) + "を習得した！", "Your " + skillname(p) + " magic improves!")
				efid = p
			}
			return
		}
		p = 400
		txtef 5
		txt -1, lang(skillname(p) + "を習得した！", "Your " + skillname(p) + " magic improves!")
		efid = p
	return

	*label_N010
		if (jp) {
			titlename(0) = "無魔法制覇", "虚弱制覇", "優柔不断制覇", "一神教者制覇", "無神論者制覇"
			titlename(5) = "暴食制覇", "バッドコミュニケーション制覇", "純情制覇", "終生誓願制覇", "トリガーハッピー制覇"
			titlename(10) = "殺生忌避制覇", "文盲制覇", "動物敵対制覇", "孤独制覇", "性依存症制覇"
			titlename(15) = "アルコール依存症制覇", "ギャンブラー制覇", "清廉潔白制覇", "復活不可制覇", "一期一会制覇"
			titlename(20) = "食事不可制覇", "オワタ式制覇", "成長不可制覇", "ハードモード制覇", "Zen制覇"
			titlename2(0) = "詠唱成功率５％上昇", "主能力上昇フィートの効果が上昇", "混乱状態でも正しく歩ける", "信仰が深まりやすくなる", "信仰スキルの成長量上昇"
			titlename2(5) = "ハーブ以外の食事効果が上昇", "店主の好感度による割引強化", "気持ちいいことの消費スタミナが減少", "結婚時にいくつかのおまけを得る", "みだれうちがたまに連発する"
			titlename2(10) = "カルマ上限＋１０", "解読に失敗しても不利益を被らない", "動物に対して支配が確実に成功する", "ペット死亡時の好感度減少量を減らす", "気持ちいいことで得られる金額が上昇"
			titlename2(15) = "お酒でより長く酔っぱらう", "運勢の値に関係なく悪いカードを避ける事がある", "カルマの回復量が上昇", "復活の書を所持している自身とペットの死を回避できる", "ブラックマーケットで稀に特別なアイテムが販売される"
			titlename2(20) = "呪われた食事で吐かなくなる", "死亡時にアイテムを落とさなくなる", "潜在値の下限が５０％上昇", "プレイヤーが輝く", "====="
		} else {
			titlename (0) = "Conquer of Magic", "Conquer of Weakness", "Conquer of Indecisiveness", "Conquer of Monotheism", "Conquer of Atheism"
			titlename (5) = "Conquer of Gluttony", "Conquer of Bad Communication", "Conquer of Chaste", "Conquer of Lifelong Vow", "Conquer of Trigger Happy"
			titlename (10) = "Conquer of No Murder", "Conquer of Illiteracy", "Conquer of Animal Hostility", "Conquer of Loneliness", "Conquer of Sexual Addiction"
			titlename (15) = "Conquer of Alcoholism", "Conquer of Gambling", "Conquer of Pacifist", "Conquer of Deathless", "Conquer No Going Back"
			titlename (20) = "Conquer of No Meal", "Conquer of 1 Hit KO", "Conquer of No Growth", "Conquer of Hard Mode", "Conquer of Zen"
			titlename2 (0) = "Casting success rate increased by 5%", "Increases Attribute Feat Effects", "Walk correctly even in a confused state", "Faith becomes easier to deepen", "Faith skill growth increased"
			titlename2 (5) = "Increased dietary effects other than herbs", "Enhanced discounts due to shopkeeper's favorability", "Reduced consumption stamina of pleasant things", "Get some extras at marriage", "a chance to trigger rapid shot"
			titlename2 (10) = "Karma upper limit +10", "No disadvantage if decoding fails", "Successful control over animals", "Reduces favorability reduction when pet dies", "Earn more money with prostitution"
			titlename2 (15) = "Drunk longer with alcohol", "Sometimes avoid bad cards regardless of fortune value", "Increased karma recovery", "resurrect yourself with book of ressurection.", "Rarely special items are sold at the black market"
			titlename2 (20) = "No longer vomits when eating cursed food", "No more dropping items on death", "50% increase in potential limit", "Player shines", "====="
		}
		listmax = 0
		page = 0
		pagesize = 15
		cs = 0
		tc = 0
		cs_bk = -1
		page_load
		curmenu = 2
		ww = 700
		wh = 400
		wx = (windoww - ww) / 2 + inf_screenx
		wy = winposy(wh)
		windowanime wx, wy, ww, wh, 10, 4
		redraw 0
		gsel 3
		pos 960, 96
		picload_ exedir + "graphic\\deco_feat.bmp", 1
		gsel 0
		windowshadow = 1
		*label_N012
		listmax = 0
		repeat length(titlename)
			if (cnt < 25) {
				list(0, listmax) = cnt, cnt + 1
				listmax++
			}
		loop
		gosub *label_1276
		repeat listmax
			if (trophy(cnt) > 0) {
				s = "＊" + titlename(cnt)
			} else {
				s = titlename(cnt)
			}
			pos wx + 30, wy + 61 + cnt * 19
			x = 84
			listn(0, cnt) = s
		loop
		redraw 0
		cs_bk = -1
		pagemax = (listmax - 1) / pagesize
		if (page < 0) {
			page = pagemax
		} else {
			if (page > pagemax) {
				page = 0
			}
		}
		*label_N013
		redraw 0
		s = lang("トロフィー", "Trophy")
		s(1) = lang("マイナスフィートを取得し偽りの預言者『ゼーム』を撃破することでトロフィーを獲得できる", "Earn titles after fulfilling their conditions")
		i = 0
		display_window (windoww - 730) / 2 + inf_screenx, winposy(430, i) + i * 15, 730, 430, 55, 40
		if (jp) {
			s = "トロフィー名(＊は獲得済み)", "報酬"
		} else {
			s = "Trophy Name", "Conditions"
		}
		display_topic s, wx + 46, wy + 36
		display_topic s(1), wx + 305, wy + 36
		keyrange = 0
		repeat pagesize
			p = pagesize * page + cnt
			if (p >= listmax) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange++
			if (cnt \ 2 == 0) {
				pos wx + 57, wy + 66 + cnt * 19
				gfini 640, 18
				gfdec2 12, 14, 16
			}
			display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
		loop
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		cs_listbk
		repeat pagesize
			p = pagesize * page + cnt
			if (p >= listmax) {
				break
			}
			if (trophy(p) == 2) {
				cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, 1, p
			} else {
				cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, 4, p
			}
			pos wx + 330, wy + 66 + cnt * 19 + 2
			mes titlename2(p)
		loop
		if (keyrange != 0) {
			cs_bk = cs
		}
		redraw 1
		await cfg_wait1
		key_check
		cursor_check
		p = -1
		repeat keyrange
			if (key == key_select(cnt)) {
				p = pagesize * page + cnt
				break
			}
		loop
		if (p >= 0) {
			if (trophy(p) > 0) {
				snd 19
				if (trophy(p) == 2) {
					trophy(p) = 1
				} else {
					trophy(p) = 2
				}
				goto *label_N012
			}
		}
		if (key == key_pageup) {
			if (pagemax != 0) {
				snd 1
				page++
				goto *label_N012
			}
		}
		if (key == key_pagedown) {
			if (pagemax != 0) {
				snd 1
				page--
				goto *label_N012
			}
		}
		if (key == key_cancel) {
			buff = ""
			notesel buff
			file = exedir + "save\\trophy"
			repeat 25
				noteadd "" + trophy(cnt)
			loop
			notesave file + ".txt"
			goto *label_1341
		}
		goto *label_N013

*label_N020
	snd 26
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	repeat 245
			dup roopbuf, cState(cnt)
			if (roopbuf != 10) {
				continue
			}
	list(0, listmax) = cnt, -cLevel(cnt)
	listmax++
	loop
	gosub *label_1276
	windowshadow = 1
*label_N021
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_N022
	redraw 0
	s = lang("NPC一覧", "NPC List"), strhint2 + strhint3
	display_window (windoww - 700) / 2 + inf_screenx, winposy(448), 700, 448
	s = lang("価格", "Value")
	display_topic lang("NPCの名前", "Name"), wx + 28, wy + 36
	display_topic lang("情報", "Info"), wx + 350, wy + 36
	display_topic s, wx + 490, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 600, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		transmissivity = 0
		if (cId(list(0, p)) == 343) {
			if (userdata2(1, cCnpcId(list(0, p)))) {
				transmissivity = userdata2(1, cCnpcId(list(0, p)))
			}
		}
		if (ocdata(101, list(0, p))) {
			transmissivity = ocdata(101, list(0, p))
		}
		i = getcharapic(list(0, p)), getcharacolor(list(0, p))
		chara_preparepic i, i(1)
		pos wx + 40, wy + 74 + cnt * 19 - 8
		gmode 4, chipc(2, i), chipc(3, i), 256 - transmissivity
		color 0, 0, 0
		grotate 5, 0, 960, 0, chipc(2, i) / (1 + (chipc(3, i) > inf_tiles)), inf_tiles
		gmode 2
		i = list(0, p)
		s = cdatan(0, i)
		cutname s, 36
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		s = "Lv." + cLevel(i) + " "
		if (cSex(i) == 0) {
			s += cnven(strmale)
		} else {
			s += cnven(strfemale)
		}
		s += lang(" ", "(") + calcage(i) + "" + lang("歳", ")")
		pos wx + 372, wy + 66 + cnt * 19 + 2
		mes s
		s = thousandsep(str(calcslavevalue(i)))
		pos wx + 512, wy + 66 + cnt * 19 + 2
		mes s + lang(" gold", "gp")
		if (cs == cnt & oom_posinfo == 1) {
			gosub *label_2053
		}
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if (p != (-1)) {
		return p
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_N021
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_N021
		}
	}
	if (key == key_cancel) {
		i = 0
		gosub *label_2053
		return -1
	}
	goto *label_N022

	*label_N030
		gosub *label_1215
		meatid@se = dbid
		flt
		itemcreate -1, 619, cX(0), cY(0), 0
		iImage(ci) = 429
		iColor(ci) = 0
		iParam1(ci) = meatid@se
		iSubname(ci) = 30
		if (inputlog == cdatan(0, 0) + "のエロ本") {
			iParam1(ci) == 999
		}
		if (iParam1(ci) == 343) {
			inv(33, ci) = initunid - 1
			inv(34, ci) = createserialno(userdatan(0, inv(33, ci)))
		}
		if (iParam1(ci) == 37 & inputlog != "＠のエロ本") {
			repeat
				iParam1(ci) = rnd(368)
				if (iParam1(ci) == 212 | iParam1(ci) == 340) {
					continue
				}
				if (iParam1(ci) > 353 & iParam1(ci) < 366) {
					iParam1(ci) = 343
				}
				if (iParam1(ci) == 343) {
					if (usernpcmax == 0) {
						continue
					}
					inv(33, ci) = rnd(usernpcmax)
					inv(34, ci) = createserialno(userdatan(0, inv(33, ci)))
				}
				break
			loop
		}
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNumber(ci)) + " from nowhere.")
		goto *label_1204

*label_N950
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = 0
	cs_bk = -1
	cposlist = 3, 5, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 36, 38, 42
	cposlistst = 45, 46, areaId_serria, areaId_tormat, areaId_khios, areaId_carlia, areaId_trian, 57, 58, 59, 60
	dim cpos, 2, length(cposlist)
	repeat length(cposlist)
		cpos(0, cnt) = areaX(cposlist(cnt)), areaY(cposlist(cnt))
	loop
	dim cpos_st, 2, length(cposlistst)
	repeat length(cposlistst)
		cpos_st(0, cnt) = areaX(cposlistst(cnt)), areaY(cposlistst(cnt))
	loop
	min = 1000
	cnt2 = 7
	if (areaOuterMap(cnt2) == 44) {
		repeat length(cposlistst)
			tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos_st(0, cnt), cpos_st(1, cnt))
			if (min > tmpdist) {
				min = tmpdist
				cposdist = cnt
			}
		loop
		list(0, listmax) = 7, areaDangerLevel(7), cposlistst(cposdist)
		listmax++
	} else {
		repeat length(cposlist)
			tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos(0, cnt), cpos(1, cnt))
			if (min > tmpdist) {
				min = tmpdist
				cposdist = cnt
			}
		loop
		list(0, listmax) = 7, areaDangerLevel(7), cposlist(cposdist)
		listmax++
	}
	repeat 450 - 300, 300
		if (areaId(cnt) == 0) {
			continue
		}
		if (areaType(cnt) == 5) {
			min = 1000
			cnt2 = cnt
			if (areaOuterMap(cnt2) == 44) {
				repeat length(cposlistst)
					tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos_st(0, cnt), cpos_st(1, cnt))
					if (min > tmpdist) {
						min = tmpdist
						cposdist = cnt
					}
				loop
				list(0, listmax) = cnt, areaDangerLevel(cnt), cposlistst(cposdist)
				listmax++
			} else {
				repeat length(cposlist)
					tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos(0, cnt), cpos(1, cnt))
					if (min > tmpdist) {
						min = tmpdist
						cposdist = cnt
					}
				loop
				list(0, listmax) = cnt, areaDangerLevel(cnt), cposlist(cposdist)
				listmax++
			}
		}
	loop
	gosub *label_1276
	windowshadow = 1
*label_N951
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if (page < 0) {
		page = pagemax
	} else {
		if (page > pagemax) {
			page = 0
		}
	}
*label_N952
	redraw 0
	s = lang("自物件一覧", "Nefia List"), strhint2 + strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	display_topic lang("名前", "Name"), wx + 28, wy + 36
	display_topic lang("位置情報", "Location"), wx + 320 - en * 75, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if (cnt \ 2 == 0) {
			pos wx + 50, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 28, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if (p >= listmax) {
			break
		}
		pos wx + 72 - 16, wy + 66 + cnt * 19 + 2
		s = "" + mapname(list(0, p))
		cs_list s, wx + 56, wy + 66 + cnt * 19 - 1, 19
		if (jp) {
			s = mapname(list(2, p)) + " " + direction2(list(2, p), list(0, p), 1)
		} else {
			s = "To the " + direction2_short(list(2, p), list(0, p), 1) + " of " + mapname(list(2, p))
		}
		pos wx + 340 - en * 75, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if (keyrange != 0) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if (key == key_select(cnt)) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if (p != (-1)) {
		txt -1, lang("" + mapname(p) + "をこの場所に移動させる？", "Really move your " + mapname(p) + " here?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *label_1353
		if (rtval != 0) {
			iCount(ci) = 0
			txt -1, lang("オパートス「フハーン！」", "A voice echoes, " + cnvtalk("Muhan!"))
			return
		}
		areaX(p) = cX(0)
		areaY(p) = cY(0)
		areaOuterMap(p) = gdata(850)
		snd 58
		txtef 5
		txt -1, lang("オパートス「フハハハハハハ！まかせろ！」", "A voice echoes, " + cnvtalk("Muwahahahaha, I'll take care of it!"))
		gosub *label_0950
		cell_refresh cX(0), cY(0)
		return
	}
	if (key == key_pageup) {
		if (pagemax != 0) {
			snd 1
			page++
			goto *label_N951
		}
	}
	if (key == key_pagedown) {
		if (pagemax != 0) {
			snd 1
			page--
			goto *label_N951
		}
	}
	if (key == key_cancel) {
		iCount(ci) = 0
		txt -1, lang("オパートス「フハーン！」", "A voice echoes, " + cnvtalk("Muhan!"))
		return
	}
	goto *label_N952

#deffunc split8bit int __xxx, array __yyy
	__yyy(0) = __xxx >> 16 & 255
	__yyy(1) = __xxx >> 8 & 255
	__yyy(2) = __xxx & 255
	return



#defcfunc join8bit array __zzz
	t@00m = 0
	t@00m = __zzz(0) << 16 | t@00m
	t@00m = __zzz(1) << 8 | t@00m
	t@00m = __zzz(2) | t@00m
	return t@00m



#deffunc preparepicitemexoom
	srcwid = 1
	picno = oommap(x@m85, y@m85, 1)
	colno = oommap(x@m85, y@m85, 3)
	havedirection = 0
	if (oommap(x@m85, y@m85, 0) == 743) {
		picno = 1650 + useritemdata(39, oommap(x@m85, y@m85, 2))
		srcwid = 30
	} else {
		if (use_exticon) {
			repeat 1
				if (ichipexchangetable(oommap(x@m85, y@m85, 0))) {
					havedirection = ichipexchangetable(oommap(x@m85, y@m85, 0)) / 1000000
					if (ichipexchangetable(oommap(x@m85, y@m85, 0)) \ 1000000 >= 10000) {
						colno = ichipexchangetable(oommap(x@m85, y@m85, 0)) \ 1000000 / 10000 - 1
					}
					picno = ichipexchangetable(oommap(x@m85, y@m85, 0)) \ 10000
					if (havedirection) {
						srcwid = 33
					} else {
						srcwid = 31
					}
					break
				}
			loop
		}
	}
	gsel 1
	color 0
	boxf 0, 960, chipi(2, picno), chipi(3, picno) + 960
	pos 0, 960
	gcopy srcwid, chipi(0, picno) + oommap(x@m85, y@m85, 5) * 48, chipi(1, picno), chipi(2, picno), chipi(3, picno)
	gfini chipi(2, picno), chipi(3, picno)
	gfdec2 c_col(0, colno), c_col(1, colno), c_col(2, colno)
	gsel selcur
	return picno

#defcfunc isflower int __xxx
	if ( inv(3, __xxx) == 130 ) {
		return 1
	}
	if ( inv(3, __xxx) == 132 ) {
		return 1
	}
	if ( inv(3, __xxx) == 133 ) {
		return 1
	}
	if ( inv(3, __xxx) == 134 ) {
		return 1
	}
	if ( inv(3, __xxx) == 135 ) {
		return 1
	}
	if ( inv(3, __xxx) == 137 ) {
		return 1
	}
	if ( inv(3, __xxx) == 139 ) {
		return 1
	}
	if ( inv(3, __xxx) == 166 ) {
		return 1
	}
	if ( inv(3, __xxx) == 301 ) {
		return 1
	}
	if ( inv(3, __xxx) == 614 ) {
		return 1
	}
	if ( inv(3, __xxx) == 649 ) {
		return 1
	}
	if ( inv(3, __xxx) == 762 ) {
		return 1
	}
	if ( inv(3, __xxx) == 204 | inv(3, __xxx) == 337 | inv(3, __xxx) == 338 | inv(3, __xxx) == 339 | inv(3, __xxx) == 340 | inv(3, __xxx) == 341 | inv(3, __xxx) == 503 | inv(3, __xxx) == 504 | inv(3, __xxx) == 571 | inv(3, __xxx) == 573 | inv(3, __xxx) == 575 | inv(3, __xxx) == 574 | inv(3, __xxx) == 685 ) {
		if ( inv(23, __xxx) == 93 | inv(23, __xxx) == 94 ) {
			return 1
		}
	}
	return 0

#defcfunc calcuserspellsuccess int __fff
	repeat
		if (90 + 1 / 1000000 - __fff * 4 / (5 + cnt * 4) >= 1) {
			p@00m = cnt
			break
		}
	loop
	return p@00m



#defcfunc getContinentAreaId int aId
	if (aId == 30) {
		insideAreaId = gPreviousMap2
	} else {
		insideAreaId = aId
	}
	outerAreaId = areaOuterMap( insideAreaId )
	if (outerAreaId == insideAreaId) { return outerAreaId }
	return getContinentAreaId( outerAreaId )

#include "chara_gen.hsp"
#include "chara_db.hsp"

#include "filter_creature.hsp"

#include "item_gen.hsp"
#include "item_db.hsp"
#include "item_filter.hsp"
#include "item_ref.hsp"
#include "sest_item.hsp"
