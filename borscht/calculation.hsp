#defcfunc calcmedalvalue int calcmedalvalue_itemid
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SCROLL_GROWTH ) {
		return 5
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SCROLL_FAITH ) {
		return 8
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SCROLL_SUPERIOR_MATERIAL ) {
		return 7
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_ROD_DOMINATION ) {
		return 20
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_ARTIFACT_SEED ) {
		return 15
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_PRESIDENTS_CHAIR ) {
		return 20
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_BILL ) {
		return 5
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_POTION_CURE_CORRUPTION ) {
		return 10
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_BOTTLE_WATER ) {
		return 3
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_TAX_MASTERS_TAX_BOX ) {
		return 18
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_CAT_SISTERS_DIARY ) {
		return 85
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_GIRLS_DIARY ) {
		return 25
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_LITTLE_SISTERS_DIARY ) {
		return 12
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SHRINE_GATE ) {
		return 11
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_BOTTLE_HERMES_BLOOD ) {
		return 30
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SAGES_HELM ) {
		return 55
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_DIABLOS ) {
		return 65
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_LICENCE_THE_VOID_EXPLORER ) {
		return 72
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_GAROKS_HAMMER ) {
		return 94
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_TOILET ) {
		return 13
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_BOOK_RESURRECTION ) {
		return 24
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SCROLL_NAME ) {
		return 40
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SKELETON_KEY ) {
		return 150
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_POTION_DESCENT ) {
		return 20
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_BAG_OF_HOLDING ) {
		return 200
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SPELLBOOK_WISHING ) {
		return 2000
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_RUGYS_HAMMER ) {
		if ( iParam1(calcmedalvalue_itemid) == 0 ) {
			return 10
		}
		return 1000
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_CARNEADES_PLANK ) {
		if ( iCItemIdx(calcmedalvalue_itemid) + 1 == finditemid("artifacts fusion license") ) {
			return 500
		}
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_DRAGON_SLAYER ) {
		return 10000
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_SCHRODINGERS_CAT ) {
		return 2000000000
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_VIOLENCE_TRIGGER ) {
		return 300
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_PET_PHONE ) {
		return 100
	}
	if ( iID(calcmedalvalue_itemid) == ITEM_ID_STATUE_MANI ) {
		return 100
	}
	return 1

#defcfunc calcfeavalue int calcfeavalue_prm0
	if ( iID(calcfeavalue_prm0) == ITEM_ID_HERO_CHEESE ) {
		return 1000
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_MAGIC_FRUIT ) {
		return 1000
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_ODYNA ) {
		return 100
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_RECONSTRUCTION ) {
		return 40
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_BREAK_MANA ) {
		return 20
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_CHARGE ) {
		return 20
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_SHORTCUT ) {
		return 10
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_POORIATION ) {
		return 10
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_MATERIATION ) {
		return 30
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_CURE_OF_FATIGUE ) {
		return 30
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_HUNGER_PANGS ) {
		return 20
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_CURATIVE_INHIBITION ) {
		return 30
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_REFLASH ) {
		return 10
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SPELLBOOK_OF_PETRIFY_GAZE ) {
		return 100
	}
	if ( iID(calcfeavalue_prm0) == ITEM_ID_SMALL_MEDAL ) {
		return 150
	}
	return 300

#defcfunc calcitemvalue int calcitemvalue_itemid, int calcitemvalue_mode
	locvar_calcitemvalue_reftype = refitem(iID(calcitemvalue_itemid), DBSPEC_TYPE, calcitemvalue_itemid)
	if ( iKnown(calcitemvalue_itemid) == ITEM_KNOWN_NONE ) {
		if ( calcitemvalue_mode == 2 ) {
			locvar_calcitemvalue_value = iValue(calcitemvalue_itemid) * 4 / 10
		}
		else {
			locvar_calcitemvalue_value = (gRandSeedA + calcitemvalue_itemid * 31) \ 10 + 4 + 10
		}
	}
	else {
		if ( locvar_calcitemvalue_reftype >= 50000 ) {
			locvar_calcitemvalue_value = iValue(calcitemvalue_itemid)
		}
		else {
			if ( iKnown(calcitemvalue_itemid) == ITEM_KNOWN_NAME ) {
				locvar_calcitemvalue_value = iValue(calcitemvalue_itemid) * 2 / 10
			}
			if ( iKnown(calcitemvalue_itemid) == ITEM_KNOWN_QUALITY ) {
				locvar_calcitemvalue_value = iValue(calcitemvalue_itemid) * 5 / 10
			}
			if ( iKnown(calcitemvalue_itemid) >= ITEM_KNOWN_FULL ) {
				locvar_calcitemvalue_value = iValue(calcitemvalue_itemid)
			}
		}
	}
	if ( iKnown(calcitemvalue_itemid) >= ITEM_KNOWN_FULL ) {
		if ( iStatus(calcitemvalue_itemid) == ITEM_STATUS_BLESSED ) {
			locvar_calcitemvalue_value = int(double(locvar_calcitemvalue_value) * 120 / 100)
		}
		if ( iStatus(calcitemvalue_itemid) == ITEM_STATUS_CURSED ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_value / 2
		}
		if ( iStatus(calcitemvalue_itemid) == ITEM_STATUS_DOOMED ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_value / 5
		}
	}
	if ( locvar_calcitemvalue_reftype == 57000 | (iID(calcitemvalue_itemid) == ITEM_ID_BOTTLE_MILK & iParam2(calcitemvalue_itemid) != 0) ) {
		if ( iParam2(calcitemvalue_itemid) > 0 ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_value * iParam2(calcitemvalue_itemid) * iParam2(calcitemvalue_itemid) / 10
		}
	}
	if ( iLevel(calcitemvalue_itemid) > 0 ) {
		if ( locvar_calcitemvalue_reftype == 52000 | locvar_calcitemvalue_reftype == 10000 | locvar_calcitemvalue_reftype == 24000 ) {
			locvar_calcitemvalue_value += locvar_calcitemvalue_value * iLevel(calcitemvalue_itemid) / 2
		}
		else {
			if ( locvar_calcitemvalue_reftype < 50000 ) {
				locvar_calcitemvalue_value += locvar_calcitemvalue_value * iLevel(calcitemvalue_itemid) / 5
			}
		}
	}
	if ( iID(calcitemvalue_itemid) == ITEM_ID_TRAVELERS_FOOD ) {
		if ( calcitemvalue_mode == 0 ) {
			locvar_calcitemvalue_value += limit(cFame(CHARA_PLAYER) / 40 + locvar_calcitemvalue_value * (cFame(CHARA_PLAYER) / 80) / 100, 0, 800)
		}
	}
	if ( iWeight(calcitemvalue_itemid) < 0 ) {
		if ( mode == MODELIST_SHOP ) {
			if ( locvar_calcitemvalue_reftype == 92000 ) {
				if ( equalsitem(calcitemvalue_itemid, "wuqing") ) {
					randomize gDay  + gMonth  * 30 + gYear  * 30 * 12
					exrand_randomize gDay  + gMonth  * 30 + gYear  * 30 * 12
					locvar_calcitemvalue_value = locvar_calcitemvalue_value * (rnd(rnd(20) + 1) + 1)
					randomize
					exrand_randomize
				}
				else {
					locvar_calcitemvalue_value = locvar_calcitemvalue_value * trate(iParam1(calcitemvalue_itemid)) / 100
				}
				if ( calcitemvalue_mode == 1 ) {
					locvar_calcitemvalue_value = locvar_calcitemvalue_value * 85 / 100
				}
				return locvar_calcitemvalue_value
			}
		}
	}
	if ( ibit(ITEM_BIT_CHARGE_ITEM, calcitemvalue_itemid) == TRUE ) {
		dbid = iID(calcitemvalue_itemid)
		cibkref = calcitemvalue_itemid
		dbmode = DBMODE_REF
		gosub *db_item
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), calcitemvalue_itemid) < 0 ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_value / 10
		}
		else {
			if ( locvar_calcitemvalue_reftype == 54000 ) {
				locvar_calcitemvalue_value = locvar_calcitemvalue_value / 5 + locvar_calcitemvalue_value * inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), calcitemvalue_itemid) / (ichargelevel * 2 + 1)
			}
			else {
				locvar_calcitemvalue_value = locvar_calcitemvalue_value / 2 + locvar_calcitemvalue_value * inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), calcitemvalue_itemid) / (ichargelevel * 3 + 1)
			}
		}
	}
	if ( locvar_calcitemvalue_reftype == 72000 ) {
		if ( iParam1(calcitemvalue_itemid) == 0 ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_value / 100 + 1
		}
	}
	if ( calcitemvalue_mode == 0 ) {
		if ( locvar_calcitemvalue_reftype == 53000 ) {
			locvar_calcitemvalue_reftypeminor = refitem(iID(calcitemvalue_itemid), DBSPEC_TYPE_MINOR, calcitemvalue_itemid)
			if ( locvar_calcitemvalue_reftypeminor == 53100 ) {
				if ( gettrait(0, 100) ) {
					locvar_calcitemvalue_value -= calc3traitmulti(stat, locvar_calcitemvalue_value)
				}
			}
		}
		locvar_calcitemvalue_limitvalue = locvar_calcitemvalue_value / 2
		limitvalue2 = locvar_calcitemvalue_value * 2
		if ( trophycheck(TROPHY_LIFELONG_VOW) == 2 ) {
			correctionvalue = 100 + cImpression(tc) * 2 - 50
		}
		else {
			correctionvalue = 100 + cImpression(tc) - 50
		}
		if ( correctionvalue <= 0 ) {
			correctionvalue = 1
		}
		locvar_calcitemvalue_value = int(double(locvar_calcitemvalue_value) * 100 / (100 + sTrade(CHARA_PLAYER)) * 100 / correctionvalue)
		if ( guildcheck(0) == "mage" ) {
			if ( locvar_calcitemvalue_reftype == 54000 ) {
				locvar_calcitemvalue_value = locvar_calcitemvalue_value * 80 / 100
			}
		}
		if ( locvar_calcitemvalue_value <= locvar_calcitemvalue_limitvalue ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_limitvalue
		}
		if ( locvar_calcitemvalue_value >= limitvalue2 ) {
			locvar_calcitemvalue_value = limitvalue2
		}
	}
	if ( calcitemvalue_mode == 1 ) {
		locvar_calcitemvalue_limitvalue = sTrade(CHARA_PLAYER) * 250 + 5000
		if ( locvar_calcitemvalue_value / 3 < locvar_calcitemvalue_limitvalue ) {
			locvar_calcitemvalue_limitvalue = locvar_calcitemvalue_value / 3
		}
		if ( trophycheck(TROPHY_LIFELONG_VOW) == 2 ) {
			correctionvalue = 100 + cImpression(tc) * 2 - 50
		}
		else {
			correctionvalue = 100 + cImpression(tc) - 50
		}
		if ( correctionvalue <= 0 ) {
			correctionvalue = 1
		}
		locvar_calcitemvalue_value = int(double(locvar_calcitemvalue_value) * (100 + sTrade(CHARA_PLAYER) * 5) / 1000 * correctionvalue / 100)
		if ( locvar_calcitemvalue_reftype < 50000 ) {
			locvar_calcitemvalue_value /= 20
		}
		if ( ibit(ITEM_BIT_STOLEN, calcitemvalue_itemid) ) {
			if ( guildcheck(0) != "thieve" ) {
				locvar_calcitemvalue_value /= 10
			}
			else {
				locvar_calcitemvalue_value = locvar_calcitemvalue_value / 3 * 2
			}
		}
		if ( locvar_calcitemvalue_value >= locvar_calcitemvalue_limitvalue ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_limitvalue
		}
	}
	if ( calcitemvalue_mode == 2 ) {
		locvar_calcitemvalue_value = locvar_calcitemvalue_value / 5
		if ( locvar_calcitemvalue_reftype < 50000 ) {
			locvar_calcitemvalue_value /= 3
		}
		if ( locvar_calcitemvalue_value > 15000 ) {
			locvar_calcitemvalue_value = 15000
		}
		if ( ibit(ITEM_BIT_STOLEN, calcitemvalue_itemid) ) {
			locvar_calcitemvalue_value = 1
		}
	}
	if ( locvar_calcitemvalue_value <= 0 ) {
		locvar_calcitemvalue_value = 1
	}
	return locvar_calcitemvalue_value

#defcfunc calcinvestvalue int calcinvestvalue_arg0
	locvar_calcitemvalue_value = limit(cRoleShopLv(tc), 1, 200) * limit(cRoleShopLv(tc), 1, 200) * 15 + 200
	if ( locvar_calcitemvalue_value > 500000 ) {
		locvar_calcitemvalue_value = 500000
	}
	locvar_calcitemvalue_value = locvar_calcitemvalue_value * 100 / (100 + sInvest(CHARA_PLAYER) * 10) + 200
	return locvar_calcitemvalue_value

#defcfunc calcinvestvalue2 int calcinvestvalue2_prm0, int calcinvestvalue2_prm1
	locvar_calcinvestvalue_sum = 0
	calcinvestvaluemain calcinvestvalue2_prm0, 0, calcinvestvalue2_prm1, locvar_calcinvestvalue_sum
	return locvar_calcinvestvalue_sum

#deffunc calcinvestvaluemain int calcinvestvaluemain_prm0, int calcinvestvaluemain_prm1, int calcinvestvaluemain_prm2, var calcinvestvaluemain_prm3
	if ( calcinvestvaluemain_prm1 >= calcinvestvaluemain_prm2 ) {
		return
	}
	locvar_calcitemvalue_value = limit(calcinvestvaluemain_prm0, 1, 200) * limit(calcinvestvaluemain_prm0, 1, 200) * 15 + 200
	if ( locvar_calcitemvalue_value > 500000 ) {
		locvar_calcitemvalue_value = 500000
	}
	locvar_calcitemvalue_value = locvar_calcitemvalue_value * 100 / (100 + sInvest(CHARA_PLAYER) * 10) + 200
	calcinvestvaluemain_prm3 += locvar_calcitemvalue_value
	calcinvestvaluemain calcinvestvaluemain_prm0 + 2, calcinvestvaluemain_prm1 + 1, calcinvestvaluemain_prm2, calcinvestvaluemain_prm3
	return

#defcfunc calcguiltvalue int calcguiltvalue_arg0
	locvar_calcitemvalue_value = -cKarma(CHARA_PLAYER) / 2 * (cFame(CHARA_PLAYER) / 3)
	return locvar_calcitemvalue_value

#defcfunc calchireadv int calchireadv_arg1
	return 250 + limit(cLevel(calchireadv_arg1), 1, 1000) * limit(cLevel(calchireadv_arg1), 1, 1000) * 30

#defcfunc calchirecost int calchirecost_charid
	locvar_calcitemvalue_value = 0
	if ( cRole(calchirecost_charid) == ROLE_MAID ) {
		locvar_calcitemvalue_value = 450
	}
	if ( cRole(calchirecost_charid) == ROLE_TRAINER ) {
		locvar_calcitemvalue_value = 250
	}
	if ( cRole(calchirecost_charid) == ROLE_BARTENDER ) {
		locvar_calcitemvalue_value = 350
	}
	if ( cRole(calchirecost_charid) == ROLE_HEALER ) {
		locvar_calcitemvalue_value = 500
	}
	if ( cRole(calchirecost_charid) == ROLE_IDENTIFIER ) {
		locvar_calcitemvalue_value = 750
	}
	if ( cRole(calchirecost_charid) == ROLE_INFORMER ) {
		locvar_calcitemvalue_value = 250
	}
	if ( cRole(calchirecost_charid) == ROLE_GUARD ) {
		locvar_calcitemvalue_value = 50
	}
	if ( cRole(calchirecost_charid) >= (1000 /*!!!@[ROLE_SHOP_MIN @@@ ROLE_SHOP_WEAPON]@!!! */) & cRole(calchirecost_charid) < (2000 /*!!!@[ROLE_GUEST_BEGGAR @@@ ROLE_GUEST_MIN]@!!! */) | cRole(calchirecost_charid) == ROLE_GUEST_MERCHANT | cRole(calchirecost_charid) == ROLE_SHOP_MATERIAL | cRole(calchirecost_charid) == ROLE_SHOP_SPELLBOOK | cRole(calchirecost_charid) == ROLE_SHOP_APHRODISIAC | cRole(calchirecost_charid) == ROLE_SHOP_DOUJINSHI | cRole(calchirecost_charid) == ROLE_SHOP_UNKNOWN3104 | cRole(calchirecost_charid) == ROLE_SHOP_HERB_MERCHANT | cRole(calchirecost_charid) == ROLE_SHOP_PROSTITUTE_GUILD | cRole(calchirecost_charid) == ROLE_SHOP_BLACKSMITH_GUILD | cRole(calchirecost_charid) == ROLE_SHOP_MYSTERIOUS_PRODUCER | cRole(calchirecost_charid) == ROLE_SHOP_FAIRY | cRole(calchirecost_charid) == ROLE_SHOP_MORPHY ) {
		locvar_calcitemvalue_value = 1000
		if ( cRole(calchirecost_charid) == ROLE_SHOP_BLACKMARKET ) {
			locvar_calcitemvalue_value *= 4
		}
		if ( cRole(calchirecost_charid) == ROLE_SHOP_MOUNTAIN2 ) {
			locvar_calcitemvalue_value *= 4
		}
		if ( cRole(calchirecost_charid) == ROLE_SHOP_BOOK_RESERVE ) {
			locvar_calcitemvalue_value *= 320
		}
		if ( cRole(calchirecost_charid) == ROLE_GUEST_MERCHANT ) {
			locvar_calcitemvalue_value = 0
		}
	}
	if ( areaId(gArea ) == AREA_DUNGEON ) {
		locvar_calcitemvalue_value = 0
	}
	return locvar_calcitemvalue_value

#deffunc generatemoney int generatemoney_charid
	locvar_generatemoney_p = rnd(100) + rndex(cLevel(generatemoney_charid) * 50 + 1)
	if ( cRole(generatemoney_charid) >= (1000 /*!!!@[ROLE_SHOP_MIN @@@ ROLE_SHOP_WEAPON]@!!! */) & cRole(generatemoney_charid) < (2000 /*!!!@[ROLE_GUEST_BEGGAR @@@ ROLE_GUEST_MIN]@!!! */) | cRole(generatemoney_charid) == ROLE_GUEST_MERCHANT | cRole(generatemoney_charid) == ROLE_SHOP_MATERIAL | cRole(generatemoney_charid) == ROLE_SHOP_SPELLBOOK | cRole(generatemoney_charid) == ROLE_SHOP_APHRODISIAC | cRole(generatemoney_charid) == ROLE_SHOP_DOUJINSHI | cRole(generatemoney_charid) == ROLE_SHOP_UNKNOWN3104 | cRole(generatemoney_charid) == ROLE_SHOP_HERB_MERCHANT | cRole(generatemoney_charid) == ROLE_SHOP_PROSTITUTE_GUILD | cRole(generatemoney_charid) == ROLE_SHOP_BLACKSMITH_GUILD | cRole(generatemoney_charid) == ROLE_SHOP_MYSTERIOUS_PRODUCER | cRole(generatemoney_charid) == ROLE_SHOP_FAIRY | cRole(generatemoney_charid) == ROLE_SHOP_MORPHY & eqfaction(generatemoney_charid, "petshop") == 0 ) {
		locvar_generatemoney_p = int(limitf(double(locvar_generatemoney_p) + 2500 + double(cRoleShopLv(generatemoney_charid)) * 250, 0, 2000000000))
	}
	if ( cGold(generatemoney_charid) < locvar_generatemoney_p / 2 & eqfaction(generatemoney_charid, "petshop") == 0 ) {
		cGold(generatemoney_charid) = locvar_generatemoney_p
	}
	return

#deffunc calccosthire
	if ( areaId(gArea ) == AREA_STORAGE_HOUSE ) {
		return
	}
	locvar_calccosthire_cost = 0
	repeat 188, 57
		if ( cRole(cnt) == ROLE_NONE ) {
			continue
		}
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		locvar_calccosthire_cost += calchirecost(cnt)
	loop
	locvar_calccosthire_cost = locvar_calccosthire_cost * limit(100 - limit(cKarma(CHARA_PLAYER) / 2, 0, 50) - 7 * gettrait(0, 38) - (cKarma(CHARA_PLAYER) >= 20) * 5, 25, 200) / 100
	gCostHire = locvar_calccosthire_cost
	return

#defcfunc calccostbuilding
	locvar_calccosthire_cost = 0
	locvar_calccosthire_cost += gHomeLevel * gHomeLevel * 200
	repeat 450 - 300, 300
		if ( areaId(cnt) == AREA_MUSEUM ) {
			locvar_calccosthire_cost += 1500
		}
		if ( areaId(cnt) == AREA_RANCH ) {
			locvar_calccosthire_cost += 1000
		}
		if ( areaId(cnt) == AREA_CROP ) {
			locvar_calccosthire_cost += 750
		}
		if ( areaId(cnt) == AREA_SHOP ) {
			locvar_calccosthire_cost += 5000
		}
		if ( areaId(cnt) == AREA_STORAGE_HOUSE ) {
			locvar_calccosthire_cost += 750
		}
	loop
	locvar_calccosthire_cost = locvar_calccosthire_cost * limit(100 - limit(cKarma(CHARA_PLAYER) / 2, 0, 50) - 7 * gettrait(0, 38) - (cKarma(CHARA_PLAYER) >= 20) * 5, 25, 200) / 100
	return locvar_calccosthire_cost

#defcfunc calccosttax
	locvar_calccosthire_cost = 0
	locvar_calccosthire_cost += cGold(CHARA_PLAYER) / 1000
	if ( cKarma(CHARA_PLAYER) > 0 ) {
		locvar_calccosthire_cost -= powf(cKarma(CHARA_PLAYER), 3) / 4
	}
	locvar_calccosthire_cost += cFame(CHARA_PLAYER) * 7 / 6
	locvar_calccosthire_cost = locvar_calccosthire_cost * limit(100 - limit(cKarma(CHARA_PLAYER) / 2, 0, 50) - 7 * gettrait(0, 38) - (cKarma(CHARA_PLAYER) >= 20) * 5, 25, 200) / 100
	if ( locvar_calccosthire_cost < 1000 ) {
		locvar_calccosthire_cost = 1000
	}
	return locvar_calccosthire_cost

#defcfunc calcmealvalue
	return 140

#defcfunc calccostreload int calccostreload_arg1, int calccostreload_arg2
	locvar_calccosthire_cost = 0
	inv_getheader calccostreload_arg1
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) != FILTER_AMMO ) {
			continue
		}
		locvar_calccostreload_ci = cnt
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, locvar_calccostreload_ci) == 0 ) {
				break
			}
			locvar_calccostreload_enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, locvar_calccostreload_ci)
			locvar_calccostreload_i = locvar_calccostreload_enc / 10000
			if ( locvar_calccostreload_i != 0 ) {
				locvar_calccostreload_enc = locvar_calccostreload_enc \ 10000
				if ( locvar_calccostreload_i == 9 ) {
					locvar_calccostreload_i = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, locvar_calccostreload_ci) \ 1000, inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, locvar_calccostreload_ci) / 1000
					locvar_calccosthire_cost += (locvar_calccostreload_i(1) - locvar_calccostreload_i) * (50 + locvar_calccostreload_enc * locvar_calccostreload_enc * 10)
					if ( calccostreload_arg2 == 1 ) {
						inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, locvar_calccostreload_ci) = locvar_calccostreload_i(1) * 1000 + locvar_calccostreload_i(1)
					}
				}
			}
		loop
	loop
	return locvar_calccosthire_cost

#defcfunc calccargoupdate
	return 30000

#defcfunc calccargoupdatecost
	if ( ogTitleBigShot == 2 ) {
		return (gCargoLimit - gCargoLimitOrg) / 10000 / 4 + 1
	}
	return (gCargoLimit - gCargoLimitOrg) / 10000 / 3 + 1

#defcfunc calcidentifyvalue int calcidentifyvalue_arg1
	locvar_calcitemvalue_value = 300
	if ( calcidentifyvalue_arg1 == 2 ) {
		locvar_calcitemvalue_value = 5000
	}
	if ( calcidentifyvalue_arg1 == 1 ) {
		inv_getheader 0
		locvar_generatemoney_p = 0
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iKnown(cnt) < ITEM_KNOWN_FULL ) {
				locvar_generatemoney_p++
			}
		loop
		if ( locvar_generatemoney_p >= 2 ) {
			locvar_calcitemvalue_value = locvar_calcitemvalue_value * locvar_generatemoney_p * 70 / 100
		}
	}
	locvar_calcitemvalue_value = locvar_calcitemvalue_value * 100 / (100 + sTrade(CHARA_PLAYER) * 2)
	if ( guildcheck(0) == "fighter" ) {
		locvar_calcitemvalue_value /= 2
	}
	return locvar_calcitemvalue_value

#defcfunc calctraincost int calctraincost_arg1, int calctraincost_arg2, int calctraincost_arg3
	locvar_calcitemvalue_value = sorgex(calctraincost_arg1, calctraincost_arg2) / 5 + 2
	if ( calctraincost_arg3 ) {
		locvar_calcitemvalue_value /= 2
	}
	if ( sgrowth(calctraincost_arg1, calctraincost_arg2) == 0 ) {
		locvar_calcitemvalue_value = 3
	}
	return locvar_calcitemvalue_value

#defcfunc calclearncost int calclearncost_arg0, int calclearncost_arg1, int calclearncost_arg1
	locvar_calcitemvalue_value = 15 + 3 * gLearned
	if ( calclearncost_arg1 ) {
		locvar_calcitemvalue_value = locvar_calcitemvalue_value * 2 / 3
	}
	return locvar_calcitemvalue_value

#defcfunc calcresurrectvalue int calcresurrectvalue_arg1
	if ( cExist(calcresurrectvalue_arg1) != CHAR_STATE_ALLY_DEAD ) {
		return 100
	}
	locvar_calcitemvalue_value = limit(cLevel(calcresurrectvalue_arg1), 1, 1000) * limit(cLevel(calcresurrectvalue_arg1), 1, 1000) * 15
	return locvar_calcitemvalue_value

#defcfunc calcslavevalue int calcslavevalue_arg1
	locvar_calcitemvalue_value = sSTR(calcslavevalue_arg1) * sEND(calcslavevalue_arg1) + cLevel(calcslavevalue_arg1) * cLevel(calcslavevalue_arg1) + 1000
	if ( locvar_calcitemvalue_value > 50000 ) {
		locvar_calcitemvalue_value = 50000
	}
	if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, calcslavevalue_arg1) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, calcslavevalue_arg1) ) {
		locvar_calcitemvalue_value = 10
	}
	return locvar_calcitemvalue_value

#defcfunc calcrestorecost
	locvar_calcitemvalue_value = 500
	if ( guildcheck(0) == "fighter" ) {
		locvar_calcitemvalue_value /= 2
	}
	return locvar_calcitemvalue_value

#defcfunc calcinitgold int calcinitgold_arg1
	dropgold = 0
	if ( calcinitgold_arg1 < 0 ) {
		dropgold = rndex(gLevel  * 25 * (gArea  != AREA_SHELTER) + 10) + 1
	}
	else {
		locvar_calcinitgold_lootrich = -1
		if ( cId(calcinitgold_arg1) == CREATURE_ID_RICH_PERSON ) {
			locvar_calcinitgold_lootrich = 10
		}
		if ( cId(calcinitgold_arg1) == CREATURE_ID_NOBLE_CHILD ) {
			locvar_calcinitgold_lootrich = 4
		}
		if ( cId(calcinitgold_arg1) == CREATURE_ID_TOURIST ) {
			locvar_calcinitgold_lootrich = 2
		}
		if ( locvar_calcinitgold_lootrich != (-1) ) {
			dropgold = locvar_calcinitgold_lootrich * 500 + rnd(1000 + locvar_calcinitgold_lootrich * 1000)
		}
		else {
			dropgold = rndex(cLevel(calcinitgold_arg1) * 25 + 10) + 1
		}
	}
	if ( gettrait(0, 170) ) {
		dropgold += dropgold / 10
	}
	return dropgold

#defcfunc calcspellpower int calcspellpower_skillid, int calcspellpower_charid
	lint_efp = 0
	fix_spallpower = 0
	if ( calcspellpower_skillid == SKILL_SPACT_LULWYS_TRICK ) {
		if ( godcheck(calcspellpower_charid) == "lulwy" ) {
			lint_efp = sdata(skillUse(calcspellpower_skillid), calcspellpower_charid) * 6 + 10 + cPiety(calcspellpower_charid) / 10
			return limitmax(lint_efp, 2147483647)
		}
	}
	if ( calcspellpower_skillid >= 663 & calcspellpower_skillid <= 673 ) {
		if ( calcspellpower_charid == CHARA_PLAYER ) {
			lint_efp = limit(sdata(sdataref(6, calcspellpower_skillid), calcspellpower_charid) * 5 / (200 / sdata(skillUse(calcspellpower_skillid)) + 1), 10, 1000)
			return limitmax(lint_efp, 2147483647)
		}
		lint_efp = limit(cLevel(calcspellpower_charid) * 6 + 10 / (200 / sdata(skillUse(calcspellpower_skillid)) + 1), 10, 1000)
		return limitmax(lint_efp, 2147483647)
	}
	if ( calcspellpower_skillid >= 779 & calcspellpower_skillid <= 781 ) {
		god_no = getcgodno(calcspellpower_charid)
		lint_efp = convert_var(usergoddatan(calcspellpower_skillid - 754, god_no), 0, sdata(skillUse(calcspellpower_skillid), calcspellpower_charid), cPiety(calcspellpower_charid))
		return limitmax(lint_efp, 2147483647)
	}
	if ( calcspellpower_skillid == 810 ) {
		god_no = getcgodno(calcspellpower_charid)
		lint_efp = convert_var(usergodskilldatan(2, god_no), 0, sdata(skillUse(calcspellpower_skillid), calcspellpower_charid), cPiety(calcspellpower_charid))
		return limitmax(lint_efp, 2147483647)
	}
	if ( calcspellpower_skillid >= 761 & calcspellpower_skillid <= 778 ) {
		return cPiety(calcspellpower_charid)
	}
	if ( skillType(calcspellpower_skillid) == 4 ) {
		if ( range == 0 ) {
			if ( nc_gettrait(calcspellpower_charid, 105) > 0 ) {
				fix_spallpower = 1.5
			}
		}
	}
	if ( skillType(calcspellpower_skillid) > 1000 & skillTg(calcspellpower_skillid) / 1000 == 3 ) {
		if ( range == 0 ) {
			if ( nc_gettrait(calcspellpower_charid, 106) > 0 ) {
				fix_spallpower = 1.5
			}
		}
	}
	if ( skillType(calcspellpower_skillid) > 1000 & skillTg(calcspellpower_skillid) / 1000 == 2 ) {
		if ( range == 0 ) {
			if ( nc_gettrait(calcspellpower_charid, 107) > 0 ) {
				fix_spallpower = 2
			}
		}
	}
	if ( calcspellpower_skillid >= (600 /*!!!@[MAX_SKILL_RANGE @@@ STARTING_SKILL_SPACT]@!!! */) ) {
		if ( skillUse(calcspellpower_skillid) != SKILL_NONE ) {
			lint_efp = sdata(skillUse(calcspellpower_skillid), calcspellpower_charid) * 6 + 10
			return limitmax(lint_efp, 2147483647)
		}
		return 100
	}
	if ( calcspellpower_charid == CHARA_PLAYER ) {
		if ( calcspellpower_skillid >= 550 & calcspellpower_skillid <= 599 ) {
			lint_efp = limit(userspelldata(12, calcspellpower_skillid - 550) / 1000000 * 10 + 50, 0, 50000) * userspelldata(5, calcspellpower_skillid - 550)
			if ( fix_spallpower > 0 ) {
				lint_efp *= fix_spallpower
			}
			return limitmax(lint_efp, 2147483647)
		}
		lint_efp = sdata(calcspellpower_skillid, calcspellpower_charid) * 10 + 50
		if ( fix_spallpower > 0 ) {
			lint_efp *= fix_spallpower
		}
		return limitmax(lint_efp, 2147483647)
	}
	if ( sCasting(calcspellpower_charid) == 0 ) {
		if ( calcspellpower_charid >= MAX_CHARA_FOLLOWER & cRole(calcspellpower_charid) != ROLE_PET_SENTRY & cRole(calcspellpower_charid) != ROLE_PET_MAID & eqfaction(calcspellpower_charid, "petshop") == 0 ) {
			lint_efp = cLevel(calcspellpower_charid) * 6 + 10
			return limitmax(lint_efp, 2147483647)
		}
	}
	lint_efp = sCasting(calcspellpower_charid) * 6 + 10
	if ( fix_spallpower > 0 ) {
		lint_efp *= fix_spallpower
	}
	return limitmax(lint_efp, 2147483647)

#defcfunc calcspellfail int calcspellfail_skillid, int calcspellfail_charid
	if ( calcspellfail_charid != CHARA_PLAYER ) {
		if ( gRider == calcspellfail_charid ) {
			return 95 - limit(30 - sRiding(CHARA_PLAYER) / 2, 0, 30)
		}
		else {
			if ( ocPetBeingRiddenIdx(calcspellfail_charid) != 0 ) {
				return 95 - limit(30 - sRiding(ocPetBeingRiddenIdx(calcspellfail_charid)) / 2, 0, 30)
			}
			else {
				return 95
			}
		}
	}
	if ( calcspellfail_skillid >= 550 & calcspellfail_skillid <= 599 ) {
		return calcuserspellfail(calcspellfail_skillid - 550)
	}
	fixfail = 2
	repeat length(isethighspell)
		if ( isethighspell(cnt) + 400 == calcspellfail_skillid ) {
			fixfail = 1
			break
		}
	loop
	if ( godcheck(0) == "danalin" ) {
		if ( cSAN(CHARA_PLAYER) >= 100 ) {
			fixfail = 2
		}
	}
	locvar_calcspellfail_i = 4
	locvar_refreshspeed_f = carmor(calcspellfail_charid)
	if ( locvar_refreshspeed_f == 169 ) {
		locvar_calcspellfail_i = 17 / fixfail - sHeavyArmor(calcspellfail_charid) / 5
	}
	if ( locvar_refreshspeed_f == 170 ) {
		locvar_calcspellfail_i = 12 / fixfail - sMediumArmor(calcspellfail_charid) / 5
	}
	if ( locvar_calcspellfail_i < 4 ) {
		locvar_calcspellfail_i = 4
	}
	if ( gRider != 0 ) {
		locvar_calcspellfail_i += 4 / fixfail
	}
	if ( calcspellfail_skillid == SKILL_SPELL_WISH | calcspellfail_skillid == SKILL_SPELL_MUTATION ) {
		locvar_calcspellfail_i += sdata(calcspellfail_skillid, calcspellfail_charid) * 4 / 5
	}
	if ( calcspellfail_skillid == SKILL_SPELL_WIZARDS_HARVEST ) {
		locvar_calcspellfail_i += sdata(calcspellfail_skillid, calcspellfail_charid) / 3
	}
	locvar_calcspellfail_p = 90 + sdata(calcspellfail_skillid, calcspellfail_charid) - skillDiff(calcspellfail_skillid) * locvar_calcspellfail_i / (5 + sCasting(calcspellfail_charid) * 4)
	if ( fixfail == 1 ) {
		if ( locvar_refreshspeed_f == 169 ) {
			if ( locvar_calcspellfail_p > 80 ) {
				locvar_calcspellfail_p = 80
			}
		}
		else {
			if ( locvar_refreshspeed_f == 170 ) {
				if ( locvar_calcspellfail_p > 92 ) {
					locvar_calcspellfail_p = 92
				}
			}
			else {
				if ( locvar_calcspellfail_p > 100 ) {
					locvar_calcspellfail_p = 100
				}
			}
		}
	}
	if ( cAttackStyle(calcspellfail_charid) & 4 ) {
		locvar_calcspellfail_p -= 6 / fixfail
	}
	if ( cAttackStyle(calcspellfail_charid) & 1 ) {
		locvar_calcspellfail_p -= 12 / fixfail
	}
	if ( fixfail == 2 & locvar_calcspellfail_p > 100 ) {
		locvar_calcspellfail_p = 100
	}
	if ( ogTitleArchmage == 2 ) {
		locvar_calcspellfail_p += 5
	}
	if ( ogTitleIsis == 2 ) {
		locvar_calcspellfail_p += 5
	}
	if ( trophycheck(TROPHY_WEAKNESS) == 2 ) {
		locvar_calcspellfail_p += 5
	}
	return limit(locvar_calcspellfail_p, 0, 100)

#defcfunc calcspellcostmp int calcspellcostmp_skillid, int calcspellcostmp_charid
	if ( calcspellcostmp_skillid >= 550 & calcspellcostmp_skillid <= 599 ) {
		return calcuserspellcostmp(calcspellcostmp_skillid - 550)
	}
	if ( calcspellcostmp_charid == CHARA_PLAYER ) {
		if ( calcspellcostmp_skillid == SKILL_SPELL_ORACLE | calcspellcostmp_skillid == SKILL_SPELL_RESURRECTION | calcspellcostmp_skillid == SKILL_SPELL_DOOR_CREATION | calcspellcostmp_skillid == SKILL_SPELL_WALL_CREATION | calcspellcostmp_skillid == SKILL_SPELL_TELEPORT_OTHER | calcspellcostmp_skillid == SKILL_SPELL_TELEPORT | calcspellcostmp_skillid == SKILL_SPELL_SHORT_TELEPORT | calcspellcostmp_skillid == SKILL_SPELL_GRAVITY | calcspellcostmp_skillid == SKILL_SPELL_RETURN | calcspellcostmp_skillid == SKILL_SPELL_RESTORE_BODY | calcspellcostmp_skillid == SKILL_SPELL_RESTORE_SPIRIT | calcspellcostmp_skillid == SKILL_SPELL_WISH | calcspellcostmp_skillid == 503 | calcspellcostmp_skillid == 504 | calcspellcostmp_skillid == 505 | calcspellcostmp_skillid == 506 | calcspellcostmp_skillid == 508 | calcspellcostmp_skillid == 510 ) {
			locvar_calcspellcostmp_cost = skillCost(calcspellcostmp_skillid)
			return locvar_calcspellcostmp_cost
		}
		locvar_calcspellcostmp_cost = skillCost(calcspellcostmp_skillid) * (100 + sdata(calcspellcostmp_skillid, calcspellcostmp_charid) * 3) / 100 + sdata(calcspellcostmp_skillid, calcspellcostmp_charid) / 8
	}
	else {
		locvar_calcspellcostmp_cost = skillCost(calcspellcostmp_skillid) * (50 + limit(cLevel(calcspellcostmp_charid), 1, 2000) * 3) / 100
	}
	return locvar_calcspellcostmp_cost

#defcfunc calcspellcoststock int calcspellcoststock_skillid, int calcspellcoststock_charid
	locvar_calcspellcoststock_cost = skillCost(calcspellcoststock_skillid) * (200 + magiccritical * 200) / (sdata(calcspellcoststock_skillid, calcspellcoststock_charid) * 3 + 100)
	if ( locvar_calcspellcoststock_cost < skillCost(calcspellcoststock_skillid) / 5 ) {
		locvar_calcspellcoststock_cost = skillCost(calcspellcoststock_skillid) / 5
	}
	locvar_calcspellcoststock_cost = rnd(locvar_calcspellcoststock_cost / 2 + 1) + locvar_calcspellcoststock_cost / 2
	if ( nc_gettrait(calcspellcoststock_charid, 108) > 0 ) {
		locvar_calcspellcoststock_cost = rnd(locvar_calcspellcoststock_cost / 3 + 1) + locvar_calcspellcoststock_cost / 2
	}
	if ( locvar_calcspellcoststock_cost < 1 ) {
		locvar_calcspellcoststock_cost = 1
	}
	return locvar_calcspellcoststock_cost

#deffunc skillinit int skillinit_skillid, int skillinit_charid, int skillinit_arg3
	dup locvar_skillinit_sdatadup, sdata(skillinit_skillid + STARTING_SKILL_SPACT, skillinit_charid)
	if ( skillinit_skillid >= SKILL_WEAPON_LONGSWORD ) {
		locvar_skillinit_p = skillinit_arg3 * 5
		if ( locvar_skillinit_sdatadup / 1000000 == 0 ) {
			locvar_skillinit_p += 100
		}
		else {
			locvar_skillinit_p += 50
		}
	}
	else {
		locvar_skillinit_p = skillinit_arg3 * 20
		if ( locvar_skillinit_p > 400 ) {
			locvar_skillinit_p = 400
		}
	}
	if ( skillinit_skillid == SKILL_ATTR_SPD ) {
		locvar_skillinit_p(1) = int(limitf(double(skillinit_arg3) * (100 + cLevel(skillinit_charid) * 2), 0, 2000000000)) / 100
	}
	else {
		locvar_skillinit_p(1) = int(limitf(double(locvar_skillinit_p) * locvar_skillinit_p * cLevel(skillinit_charid), 0, 2000000000)) / 45000 + skillinit_arg3 + cLevel(skillinit_charid) / 3
	}
	if ( cLevel(skillinit_charid) > 1 ) {
		locvar_skillinit_p = int(expf(logf(0.9) * cLevel(skillinit_charid)) * locvar_skillinit_p)
	}
	if ( locvar_skillinit_p < 1 ) {
		locvar_skillinit_p = 1
	}
	if ( skillinit_skillid == SKILL_ATTR_LIFE | skillinit_skillid == SKILL_ATTR_LUC | skillinit_skillid == SKILL_ATTR_MANA ) {
		locvar_skillinit_p(1) = skillinit_arg3
		locvar_skillinit_p = 100
	}
	if ( locvar_skillinit_sdatadup / 1000000 + locvar_skillinit_p(1) > 2000 ) {
		locvar_skillinit_p(1) = 2000 - locvar_skillinit_sdatadup / 1000000
	}
	locvar_skillinit_sdatadup += limit(locvar_skillinit_p(1), 0, 2000) * 1000000 + locvar_skillinit_p
	if ( gArea  == 210 ) {
		locvar_skillinit_sdatadup = 2000 * 1000000
		nc_intb_001 = gLevel  - 49
		if ( skillinit_skillid == SKILL_ATTR_LIFE ) {
			nc_intb_002 = limitmax(int(nc_intb_001 / 10) * 100 + int(nc_intb_001 / 50) * 500, 100000)
		}
		else {
			if ( skillinit_skillid == SKILL_ATTR_SPD ) {
				nc_intb_002 = limit(int(nc_intb_001 / 50) * 1000000, 1000000, 60000000)
				if ( ncgdata(NCGDATA_ABYSS_TITLE_1) ) {
					nc_intb_002 *= 10
				}
			}
			else {
				nc_intb_002 = nc_intb_001 * 25
				if ( ncgdata(NCGDATA_ABYSS_TITLE_3) ) {
					nc_intb_002 *= 4
				}
			}
		}
		sdataex(skillinit_skillid, skillinit_charid) = nc_intb_002
		if ( boss & skillinit_skillid != SKILL_ATTR_LIFE & skillinit_skillid != SKILL_ATTR_SPD ) {
			sdataex(skillinit_skillid, skillinit_charid) *= 3
		}
	}
	return

*calcInitialSkill
	repeat 61 - 50, 50
		p = cLevel(r1) * 4 + 96
		if ( p > 300 ) {
			p = 300
		}
		if ( sdata(cnt, r1) != 0 ) {
			if ( sdata(cnt, r1) < 100 | sdata(cnt, r1) >= 500 ) {
				p = sdata(cnt, r1)
			}
			else {
				p += sdata(cnt, r1)
			}
		}
		if ( cnt == 60 & p < 500 | r1 == 0 ) {
			p = 100
		}
		sdata(cnt + STARTING_SKILL_SPACT, r1) = limit(p, 1, 2000) * 1000000
	loop
	if ( nc_intb_nightmare ) {
		if ( cRelation(r1) == RELATION_ENEMY ) {
			repeat 3
				sdata(rnd(11) + 650, r1) = 2000 * 1000000
			loop
		}
	}
	i = 4
	skillinit SKILL_WEAPON_LONGSWORD, r1, i
	skillinit SKILL_WEAPON_SHORTSWORD, r1, i
	skillinit SKILL_WEAPON_BLUNT, r1, i
	skillinit SKILL_WEAPON_AXE, r1, i
	skillinit SKILL_WEAPON_POLEARM, r1, i
	skillinit SKILL_WEAPON_STAVE, r1, i
	skillinit SKILL_WEAPON_SCYTHE, r1, i
	skillinit SKILL_WEAPON_BOW, r1, i
	skillinit SKILL_WEAPON_THROWING, r1, i
	skillinit SKILL_WEAPON_CROSSBOW, r1, i
	skillinit SKILL_NORMAL_EVASION, r1, 4
	skillinit SKILL_NORMAL_HEALING, r1, 4
	skillinit SKILL_NORMAL_MEDITATION, r1, 4
	skillinit SKILL_WEAPON_MARTIAL_ARTS, r1, 4
	skillinit SKILL_NORMAL_STEALTH, r1, 4
	skillinit SKILL_NORMAL_FAITH, r1, 4
	skillinit SKILL_NORMAL_LIGHT_ARMOR, r1, 4
	skillinit SKILL_NORMAL_MEDIUM_ARMOR, r1, 4
	skillinit SKILL_NORMAL_HEAVY_ARMOR, r1, 4
	skillinit SKILL_NORMAL_SHIELD, r1, 3
	skillinit SKILL_ATTR_LUC, r1, 50
	return

*calcReadCheck
	f = calcread(r2, r3)
	if ( f == 1 ) {
		return 1
	}
	if ( rnd(4) == 0 & trophycheck(TROPHY_SEXUAL_ADDICTION) != 2 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "はマナを吸い取られた！", name(cc) + your(cc) + " mana is absorbed.")
		}
		if ( cc == CHARA_PLAYER ) {
			dmgmp cc, cMMP(cc)
		}
		else {
			dmgmp cc, cMMP(cc) / 3
		}
		return 0
	}
	if ( rnd(4) == 0 & trophycheck(TROPHY_SEXUAL_ADDICTION) != 2 ) {
		if ( synccheck(cc, -1) ) {
			if ( cConfuse(cc) != 0 ) {
				ctalk cc, 1309, cc, cc
				txt -1, lang(name(cc) + "は余計に混乱した。", name(cc) + " " + is(cc) + " confused more.")
			}
			else {
				ctalk cc, 1308, cc, cc
				txt -1, lang("難解だ！", "It's too difficult!")
			}
		}
		dmgcon cc, CONDITION_CONFUSE, 100
		return 0
	}
	if ( rnd(4) == 0 & trophycheck(TROPHY_SEXUAL_ADDICTION) != 2 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
		}
		repeat 2 + rnd(3)
			flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
			characreate -1, CREATURE_ID_BUG, cX(cc), cY(cc)
			if ( stat != 0 ) {
				if ( cRelation(cc) <= RELATION_ENEMY ) {
					cRelation(rc) = RELATION_DISLIKE
					cOrgRelation(rc) = RELATION_DISLIKE
				}
			}
		loop
		return 0
	}
	if ( trophycheck(TROPHY_SEXUAL_ADDICTION) == 2 ) {
		if ( synccheck(cc, -1) ) {
			ctalk cc, 1308, cc, cc
			txt -1, lang("難解だ！", "It's too difficult!")
		}
		return 0
	}
	if ( synccheck(cc, -1) ) {
		txt -1, lang(name(cc) + "は奇妙な力に捻じ曲げられた！", "A dimension door opens in front of you.")
	}
	tc = cc
	efid = SKILL_SPELL_TELEPORT
	rndtelepo = 1
	gosub *label_3383
	rndtelepo = 0
	return 0

*label_1670
	if ( rndex(sDetection(cc) * 15 + 20 + sPER(cc)) > rndex(gLevel  * 8 + 60) ) {
		gosub *label_1597
		return 1
	}
	return 0

*label_1671
	if ( featIdSub == CELL_SUB_FEATURE_TRAP_QUEST_MINE ) {
		return 0
	}
	if ( petcheck(cc) ) {
		if ( rnd(refdiff + 1) < sPER(cc) + sDetection(cc) * 4 ) {
			return 1
		}
	}
	else {
		if ( rnd(4) != 0 ) {
			return 1
		}
	}
	return 0

*label_1672
	skillexp2 SKILL_NORMAL_DISARM_TRAP, cc, 50
	return

*label_1673
	if ( rndex(sDisarmTrap(cc) * 15 + 20 + sDEX(cc)) > rndex(val * 12 + 100) ) {
		gosub *label_1672
		return 1
	}
	return 0

*label_1674
	cv = 8
	if ( cX(r1) > cX(r2) - cv & cX(r1) < cX(r2) + cv ) {
		if ( cY(r1) > cY(r2) - cv & cY(r1) < cY(r2) + cv ) {
			p = dist(cX(r1), cY(r1), cX(r2), cY(r2)) * 150 + (sStealth(r1) * 100 + 150)
			if ( p / 2 + rndex(p / 2 + 1) < rndex(pcnoise * sPER(r2) + (sDetection(r2) * 100 + 150) + 1) ) {
				return 1
			}
		}
	}
	return 0

*label_1675
	if ( gettrait(0, 158) ) {
		if ( rnd(3) == 0 ) {
			return
		}
	}
	p = cHunger(r1) / 1000
	if ( cbit(CHARA_BIT_SANDBAG, r1) == FALSE | p > 2 ) {
		cHunger(r1) -= 8
	}
	if ( cHunger(r1) < (-2000000000) ) {
		cHunger(r1) = -2000000000
	}
	if ( cHunger(r1) / 1000 != p ) {
		if ( p == 1000 / 1000 ) {
			msgalert = 1
			txt -1, lang("このままだと餓死してしまう！", "You are starving!"), lang("腹が減ってほとんど死にかけている。", "You are almost dead from hunger.")
			if ( cfg_nc_starvearart == 1 & cImmuneDamage(CHARA_PLAYER) < 100 ) {
				snd 200
			}
		}
		if ( p == 2000 / 1000 ) {
			msgalert = 1
			txt -1, lang("空腹で目が回りだした…", "Your hunger makes you dizzy."), lang("すぐに何かを食べなくては…", "You have to eat something NOW.")
			hack_alertstarvation = 1
			bk_tc = tc
			if ( cfg_alertstarvation & cImmuneDamage(CHARA_PLAYER) < 100 & (areaId(gArea ) == AREA_HOME | areaId(gArea ) == AREA_DUNGEON) ) {
				alertstarvationmax = 0
				repeat 244, 1
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( cRelation(cnt) < RELATION_NEUTRAL | (cRelation(cnt) == RELATION_NEUTRAL & cId(cnt) != CREATURE_ID_MAID) ) {
						continue
					}
					if ( cRelation(cnt) == RELATION_ALLY & ocPetJobSkill(cnt) != 184 ) {
						continue
					}
					alertstarvation(alertstarvationmax) = cnt
					alertstarvationmax++
				loop
				if ( alertstarvationmax & gettrait(0, 191) == 0 ) {
					tc = alertstarvation(rnd(alertstarvationmax))
					snd SOUNDLIST_CHAT
					gosub *chat_refresh
					listmax = 0
					ctalk tc, 1019, 0, tc
					if ( stat == 0 ) {
						buff = lang(cnName(CHARA_PLAYER) + "、お腹は減ってない" + _ka(1) + _ore(3) + "がなにか作ってくる" + _yo(1), cnName(CHARA_PLAYER) + ", you looks like hungry. I'll prepare something soon.")
					}
					tc = tc * (0 == 0) + (0 != 0) * 0
					list(0, listmax) = 0
					listn(0, listmax) = stryes
					listmax++
					list(0, listmax) = 1
					listn(0, listmax) = strno
					listmax++
					gosub *label_3836
					if ( chatval == 0 ) {
						listmax = 0
						ctalk tc, 1020, 0, tc
						if ( stat == 0 ) {
							buff = lang("たんと食べるが良い" + _yo(), "Here, it's your favorite food, right? Help yourself!")
						}
						tc = tc * (0 == 0) + (0 != 0) * 0
						list(0, listmax) = 0
						listn(0, listmax) = lang("ありがとう", "Thanks, " + name(tc) + ".")
						listmax++
						chatesc = 1
						gosub *label_3836
						snd SOUNDLIST_EAT1
						cHunger(CHARA_PLAYER) = 15000
						txt -1, lang("なかなか美味しかった。", "It was tasty."), lang("悪くない。", "Not bad at all."), lang("あなたは舌鼓をうった。", "You smack your lips.")
						gosub *eat_finish
						chara_anorexia 0
					}
					if ( chatval == 1 ) {
						listmax = 0
						ctalk tc, 1021, 0, tc
						if ( stat == 0 ) {
							buff = lang("後でちゃんと食べなきゃだめ" + _da(), "You have to eat later.")
						}
						tc = tc * (0 == 0) + (0 != 0) * 0
						list(0, listmax) = 0
						listn(0, listmax) = lang("はい", "Okay.")
						listmax++
						chatesc = 1
						gosub *label_3836
					}
				}
			}
			tc = bk_tc
			rowact_check CHARA_PLAYER
			hack_alertstarvation = 0
			if ( cfg_nc_starvearart == 1 & cImmuneDamage(CHARA_PLAYER) < 100 ) {
				snd 200
			}
		}
		if ( p == 5000 / 1000 ) {
			msgalert = 1
			txt -1, lang("腹がすいてきた。", "You are getting hungry."), lang("空腹になった。", "You feel hungry."), lang("さて何を食べようか。", "Now what shall I eat?")
		}
		refreshspeed r1
	}
	return
	return

*calcCondition
	nc_atk_loopf = 0
	regen = 1
	if ( cSleep(r1) > 0 ) {
		healcon r1, CONDITION_SLEEP, 1
		if ( cSleep(r1) > 0 ) {
			cEmoIcon(r1) = 14 + 100
		}
		healhp r1, 1
		healmp r1, 1
	}
	if ( cPoison(r1) > 0 ) {
		dmghp r1, rnd(2 + sEND(r1) / 10), DAMAGE_FROM_POISON
		healcon r1, CONDITION_POISON, 1
		if ( cPoison(r1) > 0 ) {
			cEmoIcon(r1) = 8 + 100
		}
		regen = 0
	}
	if ( cMochi(r1) > 0 ) {
		if ( cMochi(r1) \ 3 == 0 ) {
			if ( synccheck(r1, -1) ) {
				ctalk r1, 1245, r1, r1
				if ( stat == 0 ) {
					txt r1, lang("「うぐぐ…！」", cnvtalk("Ughh...!"))
				}
			}
		}
		cMochi(r1)++
		if ( cMochi(r1) > 15 ) {
			dmghp r1, 500, DAMAGE_FROM_SUFFOCATION
		}
		regen = 0
	}
	if ( cdata(266, r1) > 0 ) {
		if ( rnd(100) < cdata(266, r1) ) {
			txt -1, lang(name(r1) + "は防具に染み付いた媚薬を嗅いだ。", name(r1) + " sniffed an aphrodisiac.")
			dmgcon r1, 13, 50 + cdata(266, r1) * 5
			repeat 30, 100
				if ( cdata(cnt, r1) \ EXT_EQUIP_SLOTS == 0 ) {
					continue
				}
				rp = cdata(cnt, r1) \ EXT_EQUIP_SLOTS - 1
				if ( ibit(ITEM_BIT_LOVE_BLEND, rp) ) {
					if ( rnd(20 + cdata(266, r1)) == 0 & check_bigench(rp) != 18 ) {
						if ( iStatus(r1) != ITEM_STATUS_CURSED | rnd(5) == 0 ) {
							ibitmod ITEM_BIT_LOVE_BLEND, rp, FALSE
							txt -1, lang(itemname(rp) + "に染み付いた媚薬は乾いた。", "The aphrodisiac that soaked in " + itemname(rp) + " was dry.")
							cdata(266, r1)--
						}
					}
				}
			loop
		}
	}
	if ( cdata(265, r1) > 0 ) {
		if ( mType != MAP_TYPE_WORLD & mType != MAP_TYPE_HOME ) {
			f = int(sqrt(cdata(265, r1)))
			if ( f < 200 ) {
				f = 200
			}
			if ( rnd(10000) < f ) {
				f = 0
				lovemiracle r1, 1
			}
		}
		healcon r1, 13, 1
		if ( cdata(265, r1) > 0 ) {
			cEmoIcon(r1) = 17 + 100
		}
	}
	if ( oabit(16, gArea ) | (gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_7)) ) {
		if ( r1 == 0 | petcheck(r1) ) {
			if ( cGravity(r1) < 2 ) {
				cGravity(r1) = 2
			}
		}
	}
	if ( gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_11) ) {
		if ( r1 == 0 | petcheck(r1) ) {
			dmghp r1, cMHP(r1) / 200, DAMAGE_FROM_SUFFOCATION
		}
	}
	if ( cGravity(r1) > 0 ) {
		cGravity(r1)--
		if ( cGravity(r1) == 0 ) {
			if ( synccheck(r1, -1) ) {
				txt -1, lang(name(r1) + "は重力から抜け出した。", name(r1) + " break" + _s(r1) + " away from gravity.")
			}
		}
	}
	if ( cAngry(r1) > 0 ) {
		cAngry(r1)--
		if ( cAngry(r1) == 0 ) {
			if ( synccheck(r1, -1) ) {
				txt -1, lang(name(r1) + "はやや落ち着いた。", name(r1) + " calm" + _s(r1) + " down.")
			}
		}
	}
	if ( cSick(r1) > 0 ) {
		if ( rnd(80) == 0 ) {
			p = rnd(20 - 10)
			if ( encfind(r1, 6 * 10000 + 10 + p) == (-1) & have_bigench(r1, 6) == 0 ) {
				cdata(STARTING_CDATA_ATTR + p, r1) -= sorgex(10 + p, r1) / 25 + 1
				gosub *charaRefresh
			}
		}
		if ( rnd(5) ) {
			regen = 0
		}
		if ( r1 >= 16 & cRole(r1) != ROLE_PET_SENTRY & cRole(r1) != ROLE_PET_MAID & eqfaction(r1, "petshop") == 0 ) {
			if ( cQuality(r1) >= FIX_QUALITY_MIRACLE ) {
				if ( rnd(200) == 0 ) {
					healcon r1, CONDITION_SICK
				}
			}
		}
	}
	if ( gArea  == 49 ) {
		if ( cSP(r1) < cMSP(r1) / 4 ) {
			cEmoIcon(r1) = 15 + 100
		}
	}
	if ( cBlind(r1) > 0 ) {
		healcon r1, CONDITION_BLIND, 1
		if ( cBlind(r1) > 0 ) {
			cEmoIcon(r1) = 10 + 100
		}
	}
	if ( cParalyze(r1) > 0 ) {
		regen = 0
		healcon r1, CONDITION_PARALYZE, 1
		cEmoIcon(r1) = 15 + 100
	}
	if ( cdata(268, r1) > 0 ) {
		regen = 0
		if ( r1 == 0 ) {
			if ( rnd(20) == 0 ) {
				recoverstorn r1
				gosub *charaRefresh
			}
		}
		else {
			if ( cQuality(r1) >= FIX_QUALITY_MIRACLE ) {
				if ( rnd(5) == 0 ) {
					recoverstorn r1
					gosub *charaRefresh
				}
			}
		}
	}
	if ( cConfuse(r1) > 0 ) {
		healcon r1, CONDITION_CONFUSE, 1
		if ( cConfuse(r1) > 0 ) {
			cEmoIcon(r1) = 11 + 100
		}
	}
	if ( cFear(r1) > 0 ) {
		healcon r1, CONDITION_FEAR, 1
		if ( cFear(r1) > 0 ) {
			cEmoIcon(r1) = 13 + 100
		}
	}
	if ( cDim(r1) > 0 ) {
		healcon r1, CONDITION_DIM, 1
		if ( cDim(r1) > 0 ) {
			cEmoIcon(r1) = 12 + 100
		}
	}
	if ( cDrunk(r1) > 0 ) {
		healcon r1, CONDITION_DRUNK, 1
		if ( cDrunk(r1) > 0 ) {
			cEmoIcon(r1) = 6 + 100
		}
	}
	if ( cBleed(r1) > 0 ) {
		dmghp r1, rndex(cHP(r1) * (1 + cBleed(r1) / 4) / 100 + 3) + 1, DAMAGE_FROM_BLEED
		healcon r1, CONDITION_BLEED, 1 + cbit(CHARA_BIT_CURE_BLEEDING, r1) * 3
		if ( cBleed(r1) > 0 ) {
			cEmoIcon(r1) = 9 + 100
		}
		regen = 0
		spillblood cX(r1), cY(r1)
	}
	if ( cWet(r1) > 0 ) {
		cWet(r1)--
	}
	if ( cInsane(r1) > 0 ) {
		if ( synccheck(r1, -1) ) {
			if ( rnd(3) == 0 ) {
				txtef COLOR_SKY_BLUE
				ctalk r1, 405, r1, r1
				if ( stat == 0 ) {
					ctalk r1, 1204, r1, r1
					if ( stat == 0 ) {
						txtef COLOR_SKY_BLUE
						if ( jp ) {
							r2 = rnd(5)
							if ( r2 == 0 ) {
								txt r1, name(r1) + "「キョキョキョ」", name(r1) + "「クワッ」", name(r1) + "「シャアァァ」", name(r1) + "「ばぶっふ！」", name(r1) + "「煮殺せ！」", name(r1) + "「許しなさい許しなさい！！」"
							}
							if ( r2 == 1 ) {
								txt r1, name(r1) + "「フゥハハハー！」", name(r1) + "「あ、あ、あ、あ」", name(r1) + "「ぴ…ぴ…ぴか…」", name(r1) + "「お兄ちゃん！」", name(r1) + "「うみみやぁ」"
							}
							if ( r2 == 2 ) {
								txt r1, name(r1) + "は突然踊りだした。", name(r1) + "は着ていたものを脱ぎだした。", name(r1) + "はぐるぐる回りだした。", name(r1) + "は奇声を発した。", name(r1) + "「ねうねう♪ねうねう♪」"
							}
							if ( r2 == 3 ) {
								txt r1, name(r1) + "「ウージッムシ♪ウージッムシ♪」", name(r1) + "「じゃあ殺さなきゃ。うん♪」", name(r1) + "「このナメクジがっ」", name(r1) + "「おすわり！」", name(r1) + "「フーーーーン フーーーーン･･･ フーーーンフ」"
							}
							if ( r2 == 4 ) {
								txt r1, name(r1) + "「このかたつむり野郎がっ」", name(r1) + "「うにゅみゅあ！」", name(r1) + "「ごめんなさいごめんなさい！」", name(r1) + "「もうすぐ生まれるよ♪」", name(r1) + "「フーーーーン フー…クワッ！」"
							}
						}
						else {
							r2 = rnd(2)
							if ( r2 == 0 ) {
								txt r1, name(r1) + " start" + _s(r1) + " to take " + his(r1) + " cloths off.", name(r1) + " shout" + _s(r1) + ".", name(r1) + " dance" + _s(r1) + "."
							}
							if ( r2 == 1 ) {
								txt r1, cnvtalk("Weeeeeee!"), cnvtalk("Forgive me! Forgive me!"), cnvtalk("P-P-Pika!"), cnvtalk("Shhhhhh!"), cnvtalk("So I have to kill."), cnvtalk("You snail!")
							}
						}
					}
				}
			}
		}
		if ( rnd(5) == 0 ) {
			if ( godcheck(r1) != "danalin" | cSAN(r1) < 50 ) {
				cConfuse(r1) += rnd(10)
			}
		}
		if ( rnd(5) == 0 ) {
			if ( godcheck(r1) != "danalin" | cSAN(r1) < 20 ) {
				cDim(r1) += rnd(10)
			}
		}
		if ( rnd(5) == 0 ) {
			if ( godcheck(r1) != "danalin" | cSAN(r1) < 5 ) {
				cSleep(r1) += rnd(5)
			}
		}
		if ( rnd(5) == 0 ) {
			cFear(r1) += rnd(10)
		}
		healcon r1, CONDITION_INSANE, 1
		if ( cInsane(r1) > 0 ) {
			cEmoIcon(r1) = 24 + 100
		}
	}
	if ( r1 == 0 ) {
		if ( cHunger(r1) < 2000 ) {
			if ( cHunger(r1) < 1000 ) {
				if ( cRowAct(r1) != ACTION_EAT ) {
					p = 50
					if ( gettrait(r1, 45) ) {
						p -= 20
					}
					dmghp r1, rnd(2) + cMHP(CHARA_PLAYER) / p, DAMAGE_FROM_HUNGER
					if ( gTurn \ 10 == 0 ) {
						rowact_check r1
						if ( rnd(50) == 0 ) {
							modweight r1, -1
						}
					}
				}
			}
			regen = 0
		}
		if ( gSleep >= 30 ) {
			if ( gTurn \ 100 == 0 ) {
				txt -1, lang("あなたは眠りを必要としている。", "You need to sleep.")
			}
			if ( rnd(2) ) {
				regen = 0
			}
			if ( gSleep >= 50 ) {
				regen = 0
				dmgsp r1, 1
			}
		}
	}
	else {
		if ( cQuestNpc(r1) != 0 ) {
			p = cQuestNpc(r1) - 1
			repeat 5
				p(1) = gdata(GDATA_QUEST_POOL + cnt)
				if ( qExist(p(1)) == QUEST_TYPE_DELIVER ) {
					if ( qdata((10 /*!!!@[QDATA_DEST_CLIENT @@@ QDATA_ENCOUNTER]@!!! */), p(1)) == p ) {
						if ( qQuestTarget(p) > 0 ) {
							cEmoIcon(r1) = 22 + 100
						}
						break
					}
				}
			loop
			if ( qStatus(p) != QUEST_STATE_NONE ) {
				if ( cTurn(r1) \ 2 == 1 ) {
					cEmoIcon(r1) = 23 + 100
				}
			}
		}
	}
	if ( gQuest == QUEST_TYPE_PARTY | gQuest == 1020 ) {
		if ( r1 >= 57 ) {
			if ( cImpression(r1) >= 53 ) {
				cEmoIcon(r1) = 25 + 100 + 100
			}
		}
	}
	if ( regen == 1 ) {
		if ( findbuff(r1, 70) == (-1) ) {
			if ( rnd(6 - (findbuff(r1, BUFF_REGENERATION) != (-1)) * 4) == 0 ) {
				if ( findbuff(r1, BUFF_REGENERATION) != (-1) ) {
					healhp r1, rnd(ocdata(OCDATA_STARTING_CURSE_BUFF_POWER + findbuff(r1, BUFF_REGENERATION) * 3, r1)) / 100 + 1
				}
				healhp r1, rnd(sHealing(r1) / 3 + 1) + 1
			}
		}
		if ( rnd(5) == 0 ) {
			healmp r1, rnd(sMeditation(r1) / 2 + 1) + 1
		}
	}
	if ( rnd(50) == 0 ) {
		repeat 30, 100
			if ( cdata(cnt, r1) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			nc_intb_002 = cdata(cnt, r1) \ EXT_EQUIP_SLOTS - 1
			if ( inv(37, nc_intb_002) >= 10000 ) {
				if ( sorg(inv(37, nc_intb_002) \ 10000, r1) > 0 ) {
					skillexp2 inv(37, nc_intb_002) \ 10000, r1, 100 * inv(38, nc_intb_002)
				}
			}
		loop
	}
	return
	if ( r1 < 200 ) {
		r1 = 0
	}
	else {
		r1 = -1
	}
	if ( r1 != 0 ) {
		return
	}

*label_1681
	cInvWeight(CHARA_PLAYER) = limitintmax(limitf(inv_weight(CHARA_PLAYER), 0.0, 20000000.0) * limitmin(100 - gettrait(0, 201) * 10 + gettrait(0, 205) * 20 - limitmax(have_bigench2(0, 15), 90), 0) / 100)
	cCarryLimit(CHARA_PLAYER) = limitintmax((2.0 * sSTR(CHARA_PLAYER) + 1.0 * sEND(CHARA_PLAYER) + 8.0 * sWeightLifting(CHARA_PLAYER) + 180) * 250)
	repeat 1
		if ( cInvWeight(CHARA_PLAYER) / 2 > cCarryLimit(CHARA_PLAYER) ) {
			cBurden(CHARA_PLAYER) = 4
			break
		}
		if ( cInvWeight(CHARA_PLAYER) > cCarryLimit(CHARA_PLAYER) ) {
			cBurden(CHARA_PLAYER) = 3
			break
		}
		if ( cInvWeight(CHARA_PLAYER) > cCarryLimit(CHARA_PLAYER) / 4 * 3 ) {
			cBurden(CHARA_PLAYER) = 2
			break
		}
		if ( cInvWeight(CHARA_PLAYER) > cCarryLimit(CHARA_PLAYER) / 2 ) {
			cBurden(CHARA_PLAYER) = 1
			break
		}
		cBurden(CHARA_PLAYER) = 0
	loop
	refreshspeed 0
	gosub *label_4724
	return

#defcfunc calcscore
	p = cLevel(CHARA_PLAYER) * cLevel(CHARA_PLAYER) + gDeepest * gDeepest + gKilled
	if ( gDeath > 1 ) {
		p = p / 10 + 1
	}
	if ( gWizard ) {
		p = 0
	}
	return p

#deffunc calcpartyscore
	partypoint = 0
	repeat 188, 57
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( cImpression(cnt) >= 53 ) {
			partypoint += cLevel(cnt) + 5
		}
		if ( cImpression(cnt) < 50 ) {
			partypoint -= 20
		}
	loop
	if ( partypoint > qParam2(gQuestRef) ) {
		txtef COLOR_BLUE
		txt -1, "(+" + (partypoint - qParam2(gQuestRef)) + ") "
	}
	if ( partypoint < qParam2(gQuestRef) ) {
		txtef COLOR_RED
		txt -1, "(" + (partypoint - qParam2(gQuestRef)) + ") "
	}
	qParam2(gQuestRef) = partypoint
	return

#deffunc calcpartyscore2
	p = 0
	repeat 188, 57
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( cImpression(cnt) >= 53 ) {
			if ( cQuality(cnt) >= FIX_QUALITY_MIRACLE ) {
				p += 20 + cLevel(cnt) / 2
				txt -1, lang(cnName(cnt) + "は満足した。", cnName(cnt) + " " + is(cnt) + " satisfied.")
			}
		}
	loop
	if ( p != 0 ) {
		txt -1, lang("(合計ボーナス:" + p + "%) ", "(Total Bonus:" + p + "%)")
	}
	qParam2(gQuestRef) = qParam2(gQuestRef) * (100 + p) / 100
	return

*label_1688
	if ( sorg(SKILL_NORMAL_MAGIC_DEVICE, CHARA_PLAYER) > 15 ) {
		if ( spact(SKILL_SPACT_DRAW_CHARGE - STARTING_SKILL_SPACT) == 0 ) {
			spact(SKILL_SPACT_DRAW_CHARGE - STARTING_SKILL_SPACT) = 1
			txtef COLOR_YELLOW
			txt -1, lang("あなたは「" + skillname(SKILL_SPACT_DRAW_CHARGE) + "」の能力を得た。", "You have learned new ability, " + skillname(SKILL_SPACT_DRAW_CHARGE) + ".")
		}
		if ( spact(SKILL_SPACT_FILL_CHARGE - STARTING_SKILL_SPACT) == 0 ) {
			spact(SKILL_SPACT_FILL_CHARGE - STARTING_SKILL_SPACT) = 1
			txtef COLOR_YELLOW
			txt -1, lang("あなたは「" + skillname(SKILL_SPACT_FILL_CHARGE) + "」の能力を得た。", "You have learned new ability, " + skillname(SKILL_SPACT_FILL_CHARGE) + ".")
		}
	}
	if ( sorg(SKILL_NORMAL_TACTICS, CHARA_PLAYER) > 15 ) {
		if ( spact(SKILL_SPACT_SWARM - STARTING_SKILL_SPACT) == 0 ) {
			spact(SKILL_SPACT_SWARM - STARTING_SKILL_SPACT) = 1
			txtef COLOR_YELLOW
			txt -1, lang("あなたは「" + skillname(SKILL_SPACT_SWARM) + "」の能力を得た。", "You have learned new ability, " + skillname(SKILL_SPACT_SWARM) + ".")
		}
		if ( ospact(905 - 661) == 0 ) {
			ospact(905 - 661) = 1
			txtef COLOR_YELLOW
			txt -1, lang("あなたは「" + skillname(905) + "」の能力を得た。", "You have learned new ability, " + skillname(905) + ".")
		}
	}
	if ( sorg(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) > 15 ) {
		if ( ospact(661 - 661) == 0 ) {
			ospact(661 - 661) = 1
			txtef COLOR_YELLOW
			txt -1, lang("あなたは「" + skillname(MAX_SKILL) + "」の能力を得た。", "You have learned new ability, " + skillname(MAX_SKILL) + ".")
		}
	}
	nc_setjobskill
	return

#defcfunc eqweaponlight
	if ( rnd(2) ) {
		return 10003
	}
	if ( rnd(2) ) {
		return 10009
	}
	return 10004

#defcfunc eqweaponheavy
	if ( rnd(3) == 0 ) {
		return 10001
	}
	if ( rnd(3) == 0 ) {
		return 10010
	}
	if ( rnd(3) == 0 ) {
		return 10008
	}
	return 10005

#deffunc eqrandweaponmage int eqrandweaponmage_arg1
	locvar_eqrandweaponmage_p = rnd(2)
	if ( locvar_eqrandweaponmage_p == 0 ) {
		eqweapon1 = 10003, eqrandweaponmage_arg1
	}
	if ( locvar_eqrandweaponmage_p == 1 ) {
		eqweapon1 = 10006, eqrandweaponmage_arg1
	}
	return

*label_1692
	if ( cnRace(rc) == "mutant" ) {
		r1 = rc
		repeat cLevel(r1) / 3
			gosub *calcBodyGain
		loop
	}
	memset initeq, 0, 20 * 4 * 3
	if ( mode == MODELIST_CHARA_CREATION ) {
		fixeq = 0
		probeq = 10
	}
	else {
		if ( cQuality(rc) <= FIX_QUALITY_GOOD ) {
			probeq = 3
			fixeq = 0
		}
		else {
			if ( cQuality(rc) == FIX_QUALITY_GREAT ) {
				probeq = 6
				fixeq = 1
			}
			else {
				if ( cQuality(rc) == FIX_QUALITY_MIRACLE ) {
					probeq = 8
					fixeq = 2
				}
				else {
					probeq = 10
					fixeq = 2
				}
			}
		}
	}
	if ( cequipment == 1 ) {
		generatemoney rc
		eqweapon1 = eqweaponheavy(), 2
		eqshield = 14003, 1
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqhelm = 12001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
		if ( rnd(10) < probeq ) {
			eqgirdle = 19001, 1
		}
		eqrange = 24030, 1
	}
	if ( cequipment == 2 ) {
		generatemoney rc
		eqrandweaponmage 2
		eqamulet1 = 34001, 1
		eqring1 = 32001, 2
		eqring2 = 32001, 1
		if ( rnd(10) < probeq ) {
			eqarmor = 16003, 1
		}
		if ( rnd(10) < probeq ) {
			eqcloack = 20001, 1
		}
	}
	if ( cequipment == 3 ) {
		generatemoney rc
		eqweapon1 = 10002, 1
		eqrange = 24001, 1
		eqammo = 25001, 1
		eqcloack = 20001, 1
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqglove = 22001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
	}
	if ( cequipment == 4 ) {
		generatemoney rc
		if ( rnd(2) != 0 ) {
			eqweapon1 = 24020, 2
		}
		else {
			eqweapon1 = 10002, 1
		}
		if ( rnd(4) != 0 ) {
			eqrange = 24020, 2
			eqammo = 25020, 1
		}
		else {
			eqrange = 24021, 2
			eqammo = 25030, 1
		}
		eqcloack = 20001, 1
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqglove = 22001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
	}
	if ( cequipment == 5 ) {
		generatemoney rc
		eqrandweaponmage 2
		eqamulet1 = 34001, 1
		eqring1 = 32001, 2
		eqring2 = 32001, 1
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqcloack = 20001, 1
		}
	}
	if ( cequipment == 6 ) {
		generatemoney rc
		eqweapon1 = 10004, 1
		if ( rnd(10) < probeq ) {
			eqshield = 14003, 1
		}
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqhelm = 12001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
	}
	if ( cequipment == 7 ) {
		generatemoney rc
		eqweapon1 = eqweaponlight(), 2
		eqweapon2 = eqweaponlight(), 2
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqhelm = 12001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
		if ( rnd(10) < probeq ) {
			eqgirdle = 19001, 1
		}
		eqrange = 24030, 1
		eqtwowield = 1
	}
	if ( cequipment == 8 ) {
		generatemoney rc
		eqweapon1 = 232, 3
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
		if ( rnd(10) < probeq ) {
			eqgirdle = 19001, 1
		}
		if ( rnd(10) < probeq ) {
			eqcloack = 20001, 2
		}
		eqrange = 24030, 1
		eqtwohand = 1
	}
	if ( cequipment == 11 ) {
		generatemoney rc
		eqweapon1 = eqweaponlight(), 1
		eqrange = 24001, 1
		eqammo = 25001, 1
		eqcloack = 20001, 1
		if ( rnd(10) < probeq ) {
			eqhelm = 12002, 1
		}
		if ( rnd(10) < probeq ) {
			eqglove = 22003, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18002, 1
		}
	}
	if ( cequipment == 12 ) {
		generatemoney rc
		if ( rnd(3) == 0 ) {
			if ( rnd(2) == 0 ) {
				eqweapon1 = 10007, 2
			}
			else {
				eqweapon1 = 10008, 2
			}
		}
		else {
			eqweapon1 = 10004, 1
			eqshield = 14003, 1
		}
		eqarmor = 16001, 2
		if ( rnd(10) < probeq ) {
			eqhelm = 12001, 1
		}
		if ( rnd(10) < probeq ) {
			eqglove = 22001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
	}
	if ( cequipment == 13 ) {
		generatemoney rc
		eqweapon1 = 10011, 1
		eqarmor = 16003, 1
		if ( rnd(10) < probeq ) {
			eqcloack = 20001, 1
		}
	}
	if ( cequipment == 14 ) {
		generatemoney rc
		eqweapon1 = 2, 2
		eqring1 = 32001, 2
		if ( rnd(10) < probeq ) {
			eqamulet1 = 34001, 2
		}
		if ( rnd(10) < probeq ) {
			eqring2 = 32001, 2
		}
	}
	if ( cequipment == 15 ) {
		generatemoney rc
		eqweapon1 = 10003, 1
		eqrange = 24003, 2
		eqammo = 25002, 1
		eqcloack = 20001, 1
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqglove = 22001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
	}
	if ( cequipment == 16 ) {
		generatemoney rc
		if ( rnd(3) == 0 ) {
			eqweapon1 = 10010, 3
		}
		else {
			eqweapon1 = 10009, 2
			eqweapon2 = 10009, 2
		}
		if ( rnd(10) < probeq ) {
			eqarmor = 16001, 1
		}
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
		if ( rnd(10) < probeq ) {
			eqhelm = 12001, 1
		}
	}
	if ( cequipment == 17 ) {
		eqweapon1 = 10007, 3
		if ( rnd(10) < probeq ) {
			eqboots = 18001, 1
		}
		if ( rnd(10) < probeq ) {
			eqgirdle = 19001, 1
		}
		if ( rnd(10) < probeq ) {
			eqcloack = 20001, 2
		}
		eqrange = 24030, 1
		eqtwohand = 1
	}
	if ( cQuality(rc) >= FIX_QUALITY_MIRACLE ) {
		repeat 2
			if ( rnd(2) == 0 ) {
				initeq(1, rnd(20)) = 3
			}
			if ( rnd(2) == 0 ) {
				continue cnt
			}
		loop
	}
	if ( cspecialeq ) {
		dbmode = DBMODE_INITIAL_EQUIP
		dbid = cId(rc)
		gosub *db_creature
	}
	if ( eqtwohand ) {
		eqshield = 0
	}
	if ( ocbit(7, rc) == 0 ) {
		if ( cId(rc) == CREATURE_ID_BEGGAR ) {
			if ( rnd(120) == 0 ) {
				eqamulet1 = 705
			}
		}
		if ( cId(rc) == CREATURE_ID_NOBLE ) {
			if ( rnd(100) == 0 ) {
				eqrange = 718
			}
		}
		if ( cId(rc) == CREATURE_ID_ROCK_THROWER ) {
			if ( rnd(200) == 0 ) {
				eqrange = 716
			}
		}
		if ( cId(rc) == CREATURE_ID_BLADE | cId(rc) == CREATURE_ID_BLADE_ALPHA | cId(rc) == CREATURE_ID_BLADE_OMEGA ) {
			if ( rnd(800) == 0 ) {
				eqgirdle = 728
			}
		}
		if ( cId(rc) == CREATURE_ID_SILVER_EYED_WITCH ) {
			if ( rnd(150) == 0 | cQuality(rc) == FIX_QUALITY_UNIQUE ) {
				eqweapon1 = 719
			}
		}
		if ( cId(rc) == CREATURE_ID_ASURA | cId(rc) == CREATURE_ID_MITRA | cId(rc) == CREATURE_ID_VARUNA ) {
			if ( rnd(600) == 0 ) {
				eqamulet1 = 723
			}
		}
		if ( cId(rc) == CREATURE_ID_ROGUE_ARCHER ) {
			if ( rnd(250) == 0 ) {
				eqamulet1 = 722
			}
		}
	}
	if ( cId(rc) == CREATURE_ID_BUG & cOrgRelation(rc) == RELATION_ENEMY ) {
		p(99) = topattackskill(0)
		if ( p(99) == 109 ) {
			eqrange = 24003
			eqammo = 25002
		}
		else {
			if ( p(99) == 100 ) {
				if ( rnd(2) ) {
					eqweapon1 = 10001
				}
				else {
					eqweapon1 = 10002
				}
			}
			else {
				if ( p(99) == 101 ) {
					eqweapon1 = 10003
				}
				else {
					if ( p(99) == 102 ) {
						if ( rnd(2) ) {
							eqweapon1 = 10009
						}
						else {
							eqweapon1 = 10010
						}
					}
					else {
						if ( p(99) == 103 ) {
							if ( rnd(2) ) {
								eqweapon1 = 10004
							}
							else {
								eqweapon1 = 10005
							}
						}
						else {
							if ( p(99) == 104 ) {
								if ( rnd(2) ) {
									eqweapon1 = 10007
								}
								else {
									eqweapon1 = 10008
								}
							}
							else {
								if ( p(99) == 105 ) {
									eqweapon1 = 10006
								}
								else {
									if ( p(99) == 106 ) {
										eqweapon1 = 0
										if ( boss ) {
											eqshield(1) = 5
										}
									}
									else {
										if ( p(99) == 107 ) {
											eqweapon1 = 10011
										}
										else {
											if ( p(99) == 111 ) {
												eqrange = 24030
												eqammo = 0
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		if ( boss ) {
			if ( cequipment == 3 | cequipment == 4 ) {
				if ( eqrange != 0 ) {
					eqrange(1) = 5
				}
			}
			else {
				if ( eqweapon1 != 0 ) {
					eqweapon1(1) = 5
				}
			}
		}
	}
	repeat 30, 100
		p = cdata(cnt, rc) / EXT_EQUIP_SLOTS
		if ( p == 0 ) {
			break
		}
		if ( p == 2 ) {
			if ( eqamulet1 ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqamulet1(1))
				if ( eqamulet1 >= 10000 ) {
					flttypeminor = eqamulet1
					dbid = -1
				}
				else {
					dbid = eqamulet1
					if ( dbid == 743 ) {
						inititemid = eqamulet1(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqamulet1 = 0
				continue
			}
			if ( eqamulet2 ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqamulet2(1))
				if ( eqamulet2 >= 10000 ) {
					flttypeminor = eqamulet2
					dbid = -1
				}
				else {
					dbid = eqamulet2
					if ( dbid == 743 ) {
						inititemid = eqamulet2(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqamulet2 = 0
				continue
			}
		}
		if ( p == 6 ) {
			if ( eqring1 ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqring1(1))
				if ( eqring1 >= 10000 ) {
					flttypeminor = eqring1
					dbid = -1
				}
				else {
					dbid = eqring1
					if ( dbid == 743 ) {
						inititemid = eqring1(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqring1 = 0
				continue
			}
			if ( eqring2 ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqring2(1))
				if ( eqring2 >= 10000 ) {
					flttypeminor = eqring2
					dbid = -1
				}
				else {
					dbid = eqring2
					if ( dbid == 743 ) {
						inititemid = eqring2(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqring2 = 0
				continue
			}
		}
		if ( p == 3 ) {
			if ( eqcloack ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqcloack(1))
				if ( eqcloack >= 10000 ) {
					flttypeminor = eqcloack
					dbid = -1
				}
				else {
					dbid = eqcloack
					if ( dbid == 743 ) {
						inititemid = eqcloack(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqcloack = 0
				continue
			}
			continue
		}
		if ( p == 8 ) {
			if ( eqgirdle ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqgirdle(1))
				if ( eqgirdle >= 10000 ) {
					flttypeminor = eqgirdle
					dbid = -1
				}
				else {
					dbid = eqgirdle
					if ( dbid == 743 ) {
						inititemid = eqgirdle(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqgirdle = 0
				continue
			}
			continue
		}
		if ( p == 1 ) {
			if ( eqhelm ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqhelm(1))
				if ( eqhelm >= 10000 ) {
					flttypeminor = eqhelm
					dbid = -1
				}
				else {
					dbid = eqhelm
					if ( dbid == 743 ) {
						inititemid = eqhelm(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqhelm = 0
				continue
			}
			continue
		}
		if ( p == 4 ) {
			if ( eqarmor ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqarmor(1))
				if ( eqarmor >= 10000 ) {
					flttypeminor = eqarmor
					dbid = -1
				}
				else {
					dbid = eqarmor
					if ( dbid == 743 ) {
						inititemid = eqarmor(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqarmor = 0
				continue
			}
			continue
		}
		if ( p == 7 ) {
			if ( eqglove ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqglove(1))
				if ( eqglove >= 10000 ) {
					flttypeminor = eqglove
					dbid = -1
				}
				else {
					dbid = eqglove
					if ( dbid == 743 ) {
						inititemid = eqglove(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqglove = 0
				continue
			}
			continue
		}
		if ( p == 9 ) {
			if ( eqboots ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqboots(1))
				if ( eqboots >= 10000 ) {
					flttypeminor = eqboots
					dbid = -1
				}
				else {
					dbid = eqboots
					if ( dbid == 743 ) {
						inititemid = eqboots(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqboots = 0
				continue
			}
			continue
		}
		if ( p == 5 ) {
			if ( eqmultiweapon ) {
				repeat 15
					flt calcobjlv(cLevel(rc)), calcfixlv(2 + fixeq)
					itemcreate rc, eqmultiweapon, -1, -1, 0
					if ( iWeight(ci) > 1500 ) {
						if ( cnt < 14 ) {
							iNum(ci) = 0
							continue
						}
					}
					break
				loop
				r1 = rc
				body = cnt
				gosub *label_3590
				eqweapon1 = 0
				continue
			}
			if ( eqweapon1 ) {
				if ( eqweapon1 >= 10000 ) {
					repeat 15
						flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon1(1))
						flttypeminor = eqweapon1
						dbid = -1
						itemcreate rc, dbid, -1, -1, 0
						if ( eqtwohand ) {
							if ( iWeight(ci) < 4000 ) {
								if ( cnt < 14 ) {
									iNum(ci) = 0
									continue
								}
							}
						}
						if ( eqtwowield ) {
							if ( iWeight(ci) > 1500 ) {
								if ( cnt < 14 ) {
									iNum(ci) = 0
									continue
								}
							}
						}
						break
					loop
				}
				else {
					flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon1(1))
					dbid = eqweapon1
					if ( dbid == 743 ) {
						inititemid = eqweapon1(2)
					}
					itemcreate rc, dbid, -1, -1, 0
				}
				r1 = rc
				body = cnt
				gosub *label_3590
				eqweapon1 = 0
				continue
			}
			if ( eqweapon2 ) {
				if ( eqweapon2 >= 10000 ) {
					repeat 15
						flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon2(1))
						flttypeminor = eqweapon2
						dbid = -1
						itemcreate rc, dbid, -1, -1, 0
						if ( eqtwowield ) {
							if ( iWeight(ci) > 1500 ) {
								if ( cnt < 14 ) {
									iNum(ci) = 0
									continue
								}
							}
						}
						break
					loop
				}
				else {
					flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqweapon2(1))
					dbid = eqweapon2
					if ( dbid == 743 ) {
						inititemid = eqweapon2(2)
					}
					itemcreate rc, dbid, -1, -1, 0
				}
				eqweapon2 = 0
				r1 = rc
				body = cnt
				gosub *label_3590
				continue
			}
			if ( eqshield ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqshield(1))
				if ( eqshield >= 10000 ) {
					flttypeminor = eqshield
					dbid = -1
				}
				else {
					dbid = eqshield
					if ( dbid == 743 ) {
						inititemid = eqshield(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqshield = 0
				continue
			}
			continue
		}
		if ( p == 10 ) {
			if ( eqrange ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqrange(1))
				if ( eqrange >= 10000 ) {
					flttypeminor = eqrange
					dbid = -1
				}
				else {
					dbid = eqrange
					if ( dbid == 743 ) {
						inititemid = eqrange(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqrange = 0
				continue
			}
			continue
		}
		if ( p == 11 ) {
			if ( eqammo ) {
				flt calcobjlv(cLevel(rc)), calcfixlv(fixeq + eqammo(1))
				if ( eqammo >= 10000 ) {
					flttypeminor = eqammo
					dbid = -1
				}
				else {
					dbid = eqammo
					if ( dbid == 743 ) {
						inititemid = eqammo(2)
					}
				}
				itemcreate rc, dbid, -1, -1, 0
				r1 = rc
				body = cnt
				gosub *label_3590
				eqammo = 0
				continue
			}
			continue
		}
	loop
	if ( cId(rc) == CREATURE_ID_BARD ) {
		if ( ocbit(7, rc) == 0 & rnd(150) == 0 ) {
			flt
			itemcreate rc, ITEM_ID_STRADIVARIUS, -1, -1, 0
		}
		else {
			flt calcobjlv(cLevel(rc)), calcfixlv()
			flttypeminor = FILTER_FURNITURE_INSTRUMENT
			itemcreate rc, ITEM_ID_DUMMY, -1, -1, 0
		}
	}
	if ( cId(rc) == CREATURE_ID_USER ) {
		if ( userdata2(5, cUNID(rc)) == 1 ) {
			flt calcobjlv(cLevel(rc)), calcfixlv()
			flttypeminor = FILTER_FURNITURE_INSTRUMENT
			itemcreate rc, ITEM_ID_DUMMY, -1, -1, 0
		}
	}
	if ( cId(rc) == CREATURE_ID_THE_LEOPARD_WARRIOR | cId(rc) == CREATURE_ID_SILVIA_THE_PRINCESS ) {
		repeat 6
			flt
			nostack = 1
			itemcreate rc, ITEM_ID_TOMATO, -1, -1, 0
			if ( stat != 0 ) {
				iNum(ci) += rnd(4)
				if ( rnd(2) ) {
					iParam3(ci) = -1
					iPic(ci) = xy2pic(6, 10)
				}
			}
		loop
	}
	if ( nomagicdevice == 0 ) {
		if ( cId(rc) == CREATURE_ID_USER ) {
			if ( cUNID(rc) != usernpcmax ) {
				s = userdatan(4, cUNID(rc))
			}
			else {
				s = ""
			}
		}
		else {
			s = refchara(cId(rc), DBSPEC_CHARA_FILTER, 1)
		}
		if ( instr(s, 0, "/man/") != (-1) ) {
			if ( sorg(SKILL_NORMAL_MAGIC_DEVICE, rc) != 0 ) {
				repeat rnd(3)
					flt calcobjlv(cLevel(rc)), calcfixlv()
					flttypemajor = FILTER_ITEM_ROD
					itemcreate rc, ITEM_ID_DUMMY, -1, -1, 0
				loop
			}
			if ( sorg(SKILL_NORMAL_LITERACY, rc) != 0 & sorg(SKILL_NORMAL_MEMORIZATION, rc) != 0 ) {
				repeat rnd(3)
					flt calcobjlv(cLevel(rc)), calcfixlv()
					flttypemajor = FILTER_ITEM_SPELLBOOK
					itemcreate rc, ITEM_ID_DUMMY, -1, -1, 0
				loop
			}
		}
	}
	if ( noenchant == 0 ) {
		if ( cId(rc) == CREATURE_ID_USER ) {
			if ( userdata(12, cUNID(rc)) == 2 ) {
				if ( cQuality(rc) == FIX_QUALITY_UNIQUE ) {
					repeat rnd(1 + cLevel(rc) / 10)
						if ( inv_getfreeid(rc) == (-1) ) {
							break
						}
						flt calcobjlv(cLevel(rc)), calcfixlv(FIX_QUALITY_MIRACLE)
						if ( fixlv == FIX_QUALITY_GREAT ) {
							if ( rnd(20) == 0 ) {
								fltselect = 2
							}
						}
						if ( fixlv == FIX_QUALITY_MIRACLE ) {
							if ( rnd(10) == 0 ) {
								fltselect = 2
							}
						}
						itemcreate rc, ITEM_ID_DUMMY, -1, -1, 0
					loop
					r1 = rc
					gosub *charaRefresh
				}
			}
		}
	}
	if ( cId(rc) == CREATURE_ID_USER ) {
		if ( userdatan(0, cUNID(rc)) == "putit putit" ) {
			if ( rnd(5) == 0 ) {
				flt
				itemcreate rc, ITEM_ID_PLATINUM_COIN, -1, -1, 1
			}
		}
	}
	eqtwohand = 0
	eqtwowield = 0
	eqmultiweapon = 0
	nospartifact = 0
	nomagicdevice = 0
	noenchant = 0
	noencpfix = 0
	return

*label_1703
	p = 100
	locvar_eqrandweaponmage_i = 0
	repeat 30
		getstr s, s(1), locvar_eqrandweaponmage_i, 124
		if ( strsize == 0 ) {
			break
		}
		locvar_eqrandweaponmage_i += strsize
		s = getpath(s, 16)
		if ( s == "頭" | s == "head" ) {
			cdata(p, rc) = 1 * 10000
			p++
			continue
		}
		if ( s == "首" | s == "neck" ) {
			cdata(p, rc) = 2 * 10000
			p++
			continue
		}
		if ( s == "背" | s == "back" ) {
			cdata(p, rc) = 3 * 10000
			p++
			continue
		}
		if ( s == "体" | s == "body" ) {
			cdata(p, rc) = 4 * 10000
			p++
			continue
		}
		if ( s == "手" | s == "hand" ) {
			cdata(p, rc) = 5 * 10000
			p++
			continue
		}
		if ( s == "指" | s == "ring" ) {
			cdata(p, rc) = 6 * 10000
			p++
			continue
		}
		if ( s == "腕" | s == "arm" ) {
			cdata(p, rc) = 7 * 10000
			p++
			continue
		}
		if ( s == "腰" | s == "waist" ) {
			cdata(p, rc) = 8 * 10000
			p++
			continue
		}
		if ( s == "足" | s == "leg" ) {
			cdata(p, rc) = 9 * 10000
			p++
			continue
		}
	loop
	cdata(p, rc) = 10 * 10000
	p++
	cdata(p, rc) = 11 * 10000
	p++
	return

#deffunc place_chara int place_chara_prm0, int place_chara_prm1, int place_chara_prm2
	if ( place_chara_prm0 == (-1) ) {
		return
	}
	if ( place_chara_prm0 == 56 ) {
		cExist(place_chara_prm0) = CHAR_STATE_DEAD
		return
	}
	placefail = 0
	if ( gRider == place_chara_prm0 ) {
		if ( place_chara_prm0 != 0 ) {
			cX(place_chara_prm0) = cX(CHARA_PLAYER)
			cY(place_chara_prm0) = cY(CHARA_PLAYER)
			return
		}
	}
	repeat
		if ( cnt == 99 ) {
			if ( place_chara_prm0 >= 57 ) {
				placefail = 1
				break
			}
		}
		if ( cnt > 99 ) {
			if ( mWidth == 0 ) {
				placefail = 1
				break
			}
			y = (cnt - 100) / mWidth
			x = (cnt - 100) \ mWidth
			if ( y >= mHeight ) {
				if ( place_chara_prm0 != 0 ) {
					placefail = 1
					break
				}
				else {
					x = rnd(mWidth)
					y = rnd(mHeight)
					if ( mapChara(x, y) != 0 ) {
						mapChara(x, y) = 0
					}
					if ( chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS ) {
						mapId(x, y) = tile_tunnel
					}
					if ( mapFeat(x, y) != 0 ) {
						cell_featread x, y
						if ( featId == CELL_FEATURE_DOOR_CLOSED | featId == CELL_FEATURE_HIDDEN_PATH ) {
							mapFeat(x, y) = 0
						}
					}
				}
			}
		}
		else {
			x = rnd(mWidth - 4) + 2
			y = rnd(mHeight - 4) + 2
			if ( place_chara_prm1 >= 0 ) {
				if ( cnt == 0 ) {
					x = place_chara_prm1
					y = place_chara_prm2
				}
				else {
					x = place_chara_prm1 + rnd(cnt + 1) - rnd(cnt + 1)
					y = place_chara_prm2 + rnd(cnt + 1) - rnd(cnt + 1)
				}
			}
			if ( cnt < 20 ) {
				if ( place_chara_prm1 == (-2) ) {
					p = cFov(CHARA_PLAYER) / 2
					if ( x >= cX(CHARA_PLAYER) - p & x <= cX(CHARA_PLAYER) + p ) {
						if ( y >= cY(CHARA_PLAYER) - p & y <= cY(CHARA_PLAYER) + p ) {
							continue
						}
					}
				}
			}
		}
		if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
			continue
		}
		if ( chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS ) {
			continue
		}
		if ( mapChara(x, y) != 0 ) {
			continue
		}
		if ( mapFeat(x, y) != 0 ) {
			if ( chipm(CHIPM_ATTRIB, mapFeat(x, y) \ 1000) & CHIPM_ATTRIB_CANT_PASS ) {
				continue
			}
			cell_featread x, y
			if ( featId == CELL_FEATURE_DOWNSTAIRS ) {
				if ( place_chara_prm0 != 0 ) {
					if ( place_chara_prm1 < 0 ) {
						continue
					}
				}
			}
			if ( featId == CELL_FEATURE_UPSTAIRS ) {
				if ( place_chara_prm0 != 0 ) {
					if ( place_chara_prm1 < 0 ) {
						continue
					}
				}
			}
		}
		cXorg(place_chara_prm0) = x
		cYorg(place_chara_prm0) = y
		mapChara(x, y) = place_chara_prm0 + 1
		cX(place_chara_prm0) = x
		cY(place_chara_prm0) = y
		p = 1
		break
	loop
	if ( placefail == 1 ) {
		if ( place_chara_prm0 < 16 ) {
			cExist(place_chara_prm0) = CHAR_STATE_SUSPEND
			txt -1, lang(name(place_chara_prm0) + "とはぐれた。", name(place_chara_prm0) + " loses " + his(place_chara_prm0) + " way.")
		}
		else {
			if ( ishiringservants == 0 ) {
				txt -1, lang(name(place_chara_prm0) + "は何かに潰されて息絶えた。", name(place_chara_prm0) + " is killed.")
			}
			cExist(place_chara_prm0) = CHAR_STATE_DEAD
		}
		if ( cRole(place_chara_prm0) != ROLE_NONE ) {
			cExist(place_chara_prm0) = CHAR_STATE_SPIRIT
		}
		if ( cRole(place_chara_prm0) == ROLE_ADVENTURER ) {
			advdie gdata, cdata, ocdata, place_chara_prm0
		}
		if ( place_chara_prm0 >= 57 ) {
			addcrowd gCrowd, -1
		}
	}
	return

*label_1707
	if ( rc == (-1) ) {
		repeat 188, 57
			if ( cExist(cnt) == CHAR_STATE_DEAD ) {
				rc = cnt
				break
			}
		loop
		if ( rc == (-1) ) {
			rc = MAX_CHARA_NC
			return 0
		}
	}
	del_chara rc
	cequipment = 0
	cmshade = 0
	if ( rc == CHARA_PLAYER ) {
		p = 10
	}
	else {
		p = 4
	}
	if ( dbid == (-1) ) {
		if ( fltselect == 0 & filtermax == 0 & flttypemajor == (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */) & flttypeminor == (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */) & fltnrace == "" & fltnclass == "" ) {
			if ( fixlv == FIX_QUALITY_GREAT ) {
				if ( rnd(20) == 0 ) {
					fltselect = 2
				}
			}
			if ( fixlv == FIX_QUALITY_MIRACLE ) {
				if ( rnd(10) == 0 ) {
					fltselect = 2
				}
			}
		}
		if ( gArea  != AREA_SHELTER ) {
			p(43) = difficulty()
			if ( fltselect == 0 & initlv == 0 ) {
				if ( oabit(7, gArea ) == 1 | areaId(gArea ) == AREA_LESIMAS ) {
					npcrare = 1
				}
				else {
					if ( p(43) >= 150 ) {
						p(42) = 10
					}
					else {
						if ( p(43) >= 100 ) {
							p(42) = 20
						}
						else {
							if ( p(43) >= 50 ) {
								p(42) = 40
							}
							else {
								p(42) = 80
							}
						}
					}
					if ( rnd(p(42)) == 0 ) {
						npcrare = 1
					}
				}
			}
			if ( p(43) <= 5 ) {
				nomagicdevice = 1
			}
		}
		dbmode = DBMODE_FIND
		gosub *db_creature
		if ( dbid == 0 ) {
			if ( fltselect == 2 | fixlv == FIX_QUALITY_UNIQUE ) {
				fixlv = FIX_QUALITY_MIRACLE
			}
			flt objlv + 10, fixlv
			fltselect = 0
			dbmode = DBMODE_FIND
			gosub *db_creature
		}
	}
	else {
		if ( dbid == 343 ) {
			cUNID(rc) = usernpcmax
			olistmax = 0
			repeat usernpcmax
				if ( userdata(12, cnt) != 0 ) {
					continue
				}
				if ( instr(userdatan(4, cnt), 0, "/nogenerate/") != (-1) ) {
					continue
				}
				if ( nc_shopflag ) {
					if ( instr(userdatan(4, cnt), 0, "/noshop/") != (-1) ) {
						continue
					}
				}
				olist(olistmax) = cnt
				olistmax++
			loop
			if ( olistmax > 0 ) {
				cUNID(rc) = olist(rnd(olistmax))
			}
		}
	}
	characreatehack = dbid + 1
	cm = 1
	if ( dbid == 323 ) {
		if ( rnd(5) ) {
			objlv *= 2
			if ( fixlv >= FIX_QUALITY_MIRACLE ) {
				fixlv = FIX_QUALITY_GREAT
			}
			cmshade = 1
			flt objlv, fixlv
			dbmode = DBMODE_FIND
			gosub *db_creature
		}
	}
	if ( oabit(3, gArea ) ) {
		if ( novoidlv == 0 ) {
			if ( dbid != 318 ) {
				if ( dbid != 319 ) {
					cmshade = 1
				}
			}
		}
	}
	if ( gArea  == AREA_VOID | gArea  == 210 ) {
		if ( novoidlv ) {
			novoidlv = 0
		}
		else {
			voidlv = gLevel  / 50 * 50
		}
	}
	else {
		if ( rank != 0 | npcrare != 0 ) {
			if ( dbid != 343 & dbid != 317 ) {
				if ( initlv ) {
					p(41) = initlv
				}
				else {
					dbmode = DBMODE_REF_SPEC
					dbspec = 10
					gosub *db_creature
					p(41) = stat
				}
				if ( rank == 0 ) {
					if ( npcrare ) {
						p = rnd(4) + 2
						repeat p - 1
							if ( p(41) * p < objlv ) {
								rank = p
								break
							}
							p--
						loop
					}
				}
				if ( rank ) {
					initlv = p(41) * rank
				}
			}
			npcrare = 0
		}
	}
	novoidlv = 0
	if ( dbid == 343 ) {
		gosub *label_3089
	}
	else {
		dbmode = DBMODE_SET
		gosub *db_creature
	}
	modnpcmemory 1, rc, 1
	if ( rank ) {
		if ( jp ) {
			dbmode = DBMODE_REF_SPEC
			dbspec = 2
			gosub *db_creature
			rname = refstr
			sreplace uname, cnName(rc), rname, ""
			if ( checkalpha(rname) ) {
				if ( rank == 5 ) {
					cnName(rc) = "エルダーエンセスターズオブ" + rname
				}
				else {
					if ( rank == 4 ) {
						cnName(rc) = "チャンピオンオブ" + rname
					}
					else {
						if ( rank == 3 ) {
							cnName(rc) = "デミゴッド" + rname
						}
						else {
							if ( rank == 2 ) {
								cnName(rc) = rname + "ヒーロー"
							}
						}
					}
				}
				if ( uname != "" ) {
					cnName(rc) += uname
				}
			}
			else {
				if ( rank == 5 ) {
					cnName(rc) = "大いなる" + rname + "の祖霊"
				}
				else {
					if ( rank == 4 ) {
						cnName(rc) = "世界最強の" + rname
					}
					else {
						if ( rank == 3 ) {
							cnName(rc) = "半神" + rname
						}
						else {
							if ( rank == 2 ) {
								cnName(rc) = rname + "の英雄"
							}
						}
					}
				}
				if ( uname != "" ) {
					cnName(rc) += uname
				}
			}
		}
		else {
			if ( rank == 5 ) {
				cnName(rc) = "elder ancestor of " + cnName(rc)
			}
			else {
				if ( rank == 4 ) {
					cnName(rc) = "champion of " + cnName(rc)
				}
				else {
					if ( rank == 3 ) {
						cnName(rc) += " demi-god"
					}
					else {
						if ( rank == 2 ) {
							cnName(rc) += " the hero"
						}
					}
				}
			}
		}
		if ( rank == 5 ) {
			ocChipTransparency(rc) = 128
			ocShadowType(rc) = -1
		}
		else {
			ocLight(rc) = 9
		}
		cbitmod CHARA_BIT_HAS_NAME, rc, TRUE
		ocbitmod 5, rc, 1
	}
	if ( cmshade ) {
		if ( ogTitleBattleMaster != 2 ) {
			cnName(rc) = lang("シェイド", "shade")
		}
		cPic(rc) = xy2pic(16, 8)
		ocbitmod 8, rc, 1
	}
	cQuality(rc) = fixlv
	gosub *label_1712
	rtval = rc
	return 1

*label_1711
	if ( fixlv == FIX_QUALITY_MIRACLE ) {
		cnName(rc) = strbracketleft + cnName(rc) + strbracketright
		cLevel(rc) = cLevel(rc) * 10 / 8
	}
	if ( fixlv == FIX_QUALITY_GODLY ) {
		cnName(rc) = lang("《", "{") + cnName(rc) + lang("》", "}")
		cLevel(rc) = cLevel(rc) * 10 / 6
	}
	return

*label_1712
	if ( mode != MODELIST_CHARA_CREATION ) {
		gosub *label_1711
	}
	cExist(rc) = CHAR_STATE_ALIVE
	cInterest(rc) = 100
	cImpression(rc) = 50
	cFov(rc) = 14
	if ( cId(rc) == CREATURE_ID_MAID ) {
		cPic(rc) = rnd(67 / 2) * 2 + cSex(rc) + 1
	}
	if ( cId(rc) == CREATURE_ID_HARD_GAY ) {
		if ( rnd(20) == 0 ) {
			cPic(rc) += 5 * 1000
			ocLight(rc) = 7
			cnName(rc) += lang(" (プレミアム)", " (Premium)")
		}
	}
	if ( rc == CHARA_PLAYER ) {
		cHunger(rc) = 9000
	}
	else {
		cHunger(rc) = 6000 - 1000 + rnd(4000)
	}
	cHeight(rc) = cHeight(rc) + rnd(cHeight(rc) / 5 + 1) - rnd(cHeight(rc) / 5 + 1)
	cWeight(rc) = cHeight(rc) * cHeight(rc) * (rnd(6) + 18) / 10000
	if ( userdata3(1, cUNID(rc)) > (-1) ) {
		cHeight(rc) = userdata3(1, cUNID(rc))
	}
	if ( userdata3(2, cUNID(rc)) > (-1) ) {
		cWeight(rc) = userdata3(2, cUNID(rc))
	}
	r1 = rc
	gosub *label_1592
	r1 = rc
	gosub *calcInitialSkill
	if ( cId(rc) == CREATURE_ID_USER & cUNID(rc) < usernpcmax ) {
		if ( int(userdatan2(4, cUNID(rc))) >= (-1) ) {
			cPortrait(rc) = int(userdatan2(4, cUNID(rc)))
			if ( cPortrait(rc) == (-1) ) {
				cPortrait(rc) = rnd(32)
			}
		}
	}
	if ( cPortrait(rc) == 0 ) {
		cPortrait(rc) = rnd(32)
	}
	cPersonality(rc) = rnd(4)
	cTone(rc) = rnd(7)
	gosub *label_1692
	r1 = rc
	gosub *charaRefresh
	if ( rc >= MAX_CHARA_SAVE ) {
		addcrowd gCrowd, 1
	}
	cHP(rc) = cMHP(rc)
	cMP(rc) = cMMP(rc)
	cSP(rc) = cMSP(rc)
	if ( rc == CHARA_PLAYER ) {
		gosub *define_los
		gCargoLimitOrg = 80000
		gCargoLimit = gCargoLimitOrg
	}
	if ( cbit(CHARA_BIT_LAY_HANDS, rc) ) {
		cbitmod CHARA_BIT_LAY_HAND_CHARGE, rc, TRUE
	}
	if ( gettrait(rc, 58) ) {
		ocbitmod 9, rc, 1
	}
	ocbitmod 10, rc, 1
	cm = 0
	return

*label_1713
	cQuality(rc) = FIX_QUALITY_GOOD
	cRelation(rc) = RELATION_ALLY
	cOrgRelation(rc) = RELATION_ALLY
	cbitmod CHARA_BIT_PCC, rc, TRUE
	flt
	itemcreate CHARA_PLAYER, ITEM_ID_TRAVELERS_FOOD, -1, -1, 0
	iNum(ci) = 8
	flt
	itemcreate CHARA_PLAYER, ITEM_ID_RATION, -1, -1, 0
	iNum(ci) = 4
	flt
	itemcreate CHARA_PLAYER, ITEM_ID_BOTTLE_CRIM_ALE, -1, -1, 0
	iNum(ci) = 2
	if ( sLiteracy(CHARA_PLAYER) == 0 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_POTION_CURE_MINOR_WOUND, -1, -1, 0
		iNum(ci) = 3
	}
	p(38) = 0
	repeat length(classnamecsv)
		if ( cnClass(CHARA_PLAYER) == classnamecsv(cnt, 1) ) {
			p(38) = classtool(cnt)
			break
		}
	loop
	if ( p(38) == 0 ) {
		if ( cnClass(CHARA_PLAYER) == "pianist" ) {
			flt
			itemcreate CHARA_PLAYER, ITEM_ID_GRAND_PIANO, -1, -1, 0
		}
		if ( cnClass(CHARA_PLAYER) == "farmer" ) {
			flt
			itemcreate CHARA_PLAYER, ITEM_ID_PORTABLE_COOKING_TOOL, -1, -1, 0
		}
		if ( cnClass(CHARA_PLAYER) == "wizard" | cnClass(CHARA_PLAYER) == "warmage" ) {
			flt
			itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_MINOR_TELEPORTATION, -1, -1, 0
			flt
			itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_MAGIC_ARROW, -1, -1, 0
			iNum(ci) = 3
		}
		if ( cnClass(CHARA_PLAYER) == "priest" ) {
			flt
			itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_CURE_MINOR_WOUND, -1, -1, 0
			iNum(ci) = 3
			flt
			itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_HERO, -1, -1, 0
		}
	}
	if ( p(38) == 1 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_GRAND_PIANO, -1, -1, 0
	}
	if ( p(38) == 2 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PORTABLE_COOKING_TOOL, -1, -1, 0
	}
	if ( p(38) == 3 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_MINOR_TELEPORTATION, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_MAGIC_ARROW, -1, -1, 0
		iNum(ci) = 3
	}
	if ( p(38) == 4 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_CURE_MINOR_WOUND, -1, -1, 0
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 3
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_HERO, -1, -1, 0
	}
	if ( p(38) == 5 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ROD_CURE_MINOR_WOUND, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ROD_MAGIC_MISSILE, -1, -1, 0
		iNum(ci) = 3
	}
	if ( p(38) == 6 ) {
		p(37) = finditemid("blacksmith hammer")
		if ( p(37) != 0 ) {
			flt
			inititemid = p(37)
			itemcreate CHARA_PLAYER, ITEM_ID_CARNEADES_PLANK, -1, -1, 0
			iParam1(ci) = 20
		}
	}
	if ( p(38) == 7 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_HARMONICA, -1, -1, 0
	}
	if ( p(38) == 8 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_LUTE, -1, -1, 0
	}
	if ( p(38) == 9 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_MONSTER_BALL, -1, -1, 6
		iParam2(ci) = 5
	}
	if ( p(38) == 10 ) {
		mat(1) += 5
	}
	if ( p(38) == 11 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_FISHING_POLE, -1, -1, 0
	}
	if ( p(38) == 12 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PICKAXE, -1, -1, 0
	}
	if ( p(38) == 13 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_CARPENTERS_TOOL, -1, -1, 0
	}
	if ( p(38) == 14 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PORTABLE_COOKING_TOOL, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SEWING_KIT, -1, -1, 0
	}
	if ( p(38) == 15 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ALCHEMY_TOOLS, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SEWING_KIT, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_CARPENTERS_TOOL, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_GEM_CUTTER, -1, -1, 0
	}
	if ( p(38) == 16 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ALCHEMY_TOOLS, -1, -1, 0
	}
	if ( p(38) == 17 ) {
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_DISGUISE_SET, -1, -1, 6
		iNum(ci) = 3
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 5
	}
	gosub *label_0273
	cSkillPoint(r1) = 5 + gettrait(0, 154), 5 + gettrait(0, 154)
	inv_getheader 0
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		iKnown(cnt) = ITEM_KNOWN_FULL
	loop
	r1 = 0
	gosub *charaRefresh
	return

*label_1716
	gosub *resurrect
	cxinit = cX(CHARA_PLAYER)
	cyinit = cY(CHARA_PLAYER)
	place_chara rc, cxinit, cyinit
	cType(rc) = 0
	snd SOUNDLIST_PRAY1
	txtef COLOR_YELLOW
	txt -1, cnven(cnName(rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
	return

*resurrect
	cbitmod CHARA_BIT_SUICIDE_SWITCH, rc, FALSE
	cbitmod CHARA_BIT_DEATH_COUNT, rc, FALSE
	cbitmod CHARA_BIT_PREGNANT, rc, FALSE
	cbitmod CHARA_BIT_CONTINGENCY, rc, FALSE
	cbitmod CHARA_BIT_ANOREXIA, rc, FALSE
	cHP(rc) = cMHP(rc) / 3
	cMP(rc) = cMMP(rc) / 3
	cSP(rc) = cMSP(rc) / 3
	cSAN(rc) = 0
	cExist(rc) = CHAR_STATE_ALIVE
	cType(rc) = 0
	cRelation(rc) = cOrgRelation(rc)
	cHunger(rc) = 8000
	ocPetJobSkill(rc) = 0
	ocAlienChildCreatureID(rc) = 0
	ocItemDV(rc) = 0

*label_1718
	cbitmod CHARA_BIT_CONTINGENCY, rc, FALSE
	rowactend rc
	cPoison(rc) = 0
	cSleep(rc) = 0
	cConfuse(rc) = 0
	cBlind(rc) = 0
	if ( gettrait(rc, 195) != 0 ) {
		cBlind(rc) = 1000
	}
	cParalyze(rc) = 0
	cdata(268, rc) = 0
	cMochi(rc) = 0
	cAngry(rc) = 0
	cDim(rc) = 0
	cDrunk(rc) = 0
	cBleed(rc) = 0
	cGravity(rc) = 0
	cAiItem(rc) = 0
	cAiAggro(rc) = 0
	unlockson rc
	cSick(rc) = 0
	cEmoIcon(rc) = 0
	repeat 20 - 10
		cdata(STARTING_CDATA_ATTR + cnt, rc) = 0
	loop
	if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + 0 * 3, rc) != 0 ) {
		repeat 8 + 8
			if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, rc) == 0 ) {
				break
			}
			if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, rc) == 13 ) {
				continue
			}
			delbuff rc, cnt
			continue cnt
		loop
	}
	r1 = rc
	gosub *charaRefresh
	return

*chara_respawn
	gosub *resurrect
	if ( rc == CHARA_PLAYER ) {
		gReturn  = 0
		traveldone = 0
		if ( gQuest == QUEST_TYPE_NONE ) {
			evadd EVENT_DEAD
		}
	}
	if ( cRole(rc) == ROLE_SHOPKEEPER ) {
		cRelation(rc) = RELATION_NEUTRAL
	}
	if ( cRole(rc) == ROLE_GUARD ) {
		p = rnd(5) + 1
		repeat p
			r1 = rc
			r2 = 1
			gosub *label_1588
		loop
	}
	if ( cId(rc) == CREATURE_ID_BARD ) {
		skillmod SKILL_NORMAL_PERFORMER, rc, 1000
	}
	r1 = rc
	gosub *charaRefresh
	return

*cm_init
	if ( cfg_wizard ) {
		gWizard = 1
	}
	if ( geneuse != "" ) {
		dim takeover, 10
		listmax = 0
		page = 0
		cs = 0
		cs_bk = -1
		redraw 0
		gsel BUFFER_BUF
		pos 0, 0
		picload_ exedir + "\\graphic\\void.bmp", 1
		gzoom windoww, windowh, 4, 0, 0, 800, 600
		gsel BUFFER_SCREEN
		gmode 0
		pos 0, 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		gmode 2
		gsel BUFFER_BUF
		repeat 8
			pos cnt \ 4 * 180, cnt / 4 * 300
			picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
		loop
		gsel BUFFER_SCREEN
		s = lang("どの内容を引き継ぐ？", "Carry over which content?")
		gosub *screen_drawMsg2
		windowshadow = 1
		listmax = 0
		q = lang("引継ぎ選択", "Carryover selection")
		if ( jp ) {
			s = "アイテム", "マテリアル", "金貨", "プラチナ", "BP", "プレイ時間", "ペットの冒険者化", "ロミアスの秘密の経験", "妹の日記", "アイテムの色及び未確定名", ""
		}
		else {
			s = "Items", "Materials", "Gold coins", "Platinum coins", "BP", "Play time", "Turn pets to adventurers", "Secret experience of Lomias", "Little sister's diary", "Items color", ""
		}
		dx = 440
		dy = 350
		repeat 30
			if ( s(cnt) == "" ) {
				break
			}
			list(0, listmax) = cnt
			listn(0, listmax) = s(cnt)
			listmax++
		loop
		repeat
			redraw 0
			pagesize = 0
			s = q, lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]  決定キー [決定]", "Right,left [Change]  Shift,Esc [Close] Enter [Enter]")
			display_window (windoww - dx) / 2 + inf_screenx, winposy(288, 1), dx, dy
			pagesize = listmax
			display_topic lang("項目", "Category"), wx + 34, wy + 36
			x = ww / 5 * 3
			y = wh - 80
			gmode 4, 180, 300, 50
			pos wx + ww / 3, wy + wh / 2
			grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
			gmode 2
			keyrange = 0
			repeat pagesize
				p = pagesize * page + cnt
				if ( p >= listmax ) {
					break
				}
				key_list(cnt) = key_enter
				keyrange++
			loop
			keyrange = 0
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			cs_listbk
			repeat pagesize
				p = pagesize * page + cnt
				if ( p >= listmax ) {
					break
				}
				i = list(0, p)
				s = listn(0, p)
				x = 0
				cs_list s, wx + 56 + x, wy + 66 + cnt * 19 - 1, 19, 0
				pos wx + 250, wy + 66 + cnt * 19 - 5
				gcopy BUFFER_INF, 312, 336, 24, 24
				pos wx + 370, wy + 66 + cnt * 19 - 5
				gcopy BUFFER_INF, 336, 336, 24, 24
				pos wx + 280, wy + 66 + cnt * 19
				color 0, 0, 0
				if ( cnt == 0 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(0))
				}
				if ( cnt == 1 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(1))
				}
				if ( cnt == 2 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(2))
				}
				if ( cnt == 3 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(3))
				}
				if ( cnt == 4 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(4))
				}
				if ( cnt == 5 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(5))
				}
				if ( cnt == 6 ) {
					s = lang("する", "Do"), lang("しない", "Don't")
					keyrange++
					mes s(takeover(6))
				}
				if ( cnt == 7 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(7))
				}
				if ( cnt == 8 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(8))
				}
				if ( cnt == 9 ) {
					s = lang("引き継ぐ", "Carryover"), lang("引き継がない", "Don't carryover")
					keyrange++
					mes s(takeover(9))
				}
			loop
			if ( keyrange != 0 ) {
				cs_bk = cs
			}
			redraw 1
			await cfg_wait1
			key_check
			cursor_check
			if ( key == key_pageup | key == key_pagedown ) {
				repeat
					if ( cs == cnt ) {
						takeover(cnt) = 1 - takeover(cnt)
						snd SOUNDLIST_OK1
						break
					}
				loop
			}
			if ( key == key_enter ) {
				snd SOUNDLIST_OK1
				break
			}
			if ( key == key_cancel ) {
				p = -1
				break
			}
		loop
		if ( p == (-1) ) {
			goto *game_title_selectGen
		}
		gosub *label_3070
	}
	redraw 0
	rc = CHARA_PLAYER
	mode = MODELIST_CHARA_CREATION
	cm = 1
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel BUFFER_MAP
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_cm.bmp", 1
	gsel BUFFER_SCREEN
	dirlist buff, exedir + "save\\*", 5
	notesel buff


	if ( noteinfo() >= 5 ) {
		redraw 0
		keyrange = 0
		gmode 0
		pos 0, 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		gmode 2
		s = lang("これ以上は冒険者を保存できない。", "Save slots are full. You have to delete some of your adventurers.")
		gosub *screen_drawMsg2
		redraw 1
*cm_init_WHILE1
		key_check
		cursor_check
		await cfg_wait1
		if ( key != "" ) {
			goto *cm_init_WEND1
		}
		goto *cm_init_WHILE1
*cm_init_WEND1
		goto *game_title
	}
	goto *label_1767

*cm_class
	redraw 0
	cs = 0
	cs_bk = -1
	pagesize = 16
	page = 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("職業や種族は、初期の能力だけでなく、成長の方向性に影響するんだ。", "Your class and race determine growth rate of your skills and attributes.")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	dbmode = DBMODE_FIND
	gosub *cm_race
	repeat listmax
		dbidn = listn(1, cnt)
		dbmode = DBMODE_REF
		gosub *cm_race
		listn(0, cnt) = racename
		if ( list(0, cnt) == 1 ) {
			listn(0, cnt) = "(extra)" + listn(0, cnt)
		}
	loop
	windowshadow = 1

*cm_class_WHILE1
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_1736
	redraw 0
	if ( cs != cs_bk ) {
		s = lang("種族の選択", "Race Selection"), strhint3b
		display_window (windoww - 680) / 2 + inf_screenx, winposy(500, 1) + 20, 680, 500
		cmbg++
		x = ww / 5 * 2
		y = wh - 80
		gmode 4, 180, 300, 50
		pos wx + ww / 4, wy + wh / 2
		grotate BUFFER_MAP, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		display_topic lang("選択できる種族", "Race"), wx + 28, wy + 30
		display_topic lang("種族の説明", "Detail"), wx + 188, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat pagesize
			p = page * pagesize + cnt
			if ( p >= listmax ) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
			cs_list listn(0, p), wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		cs_bk = cs
		color 0, 0, 0
		pos wx + 200, wy + 66
		del_chara 0
		dbidn = listn(1, page * pagesize + cs)
		dbmode = DBMODE_SET
		gosub *cm_race
		dbmode = DBMODE_REF_CM
		gosub *cm_race
		val = 0
		gosub *cm_refer
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = page * pagesize + cnt
			break
		}
		else {
			p = -1
		}
	loop
	if ( p != (-1) ) {
		cmrace = listn(1, p), listn(0, p)
		dbidn = cmrace
		dbmode = DBMODE_REF_CM
		gosub *cm_race
		goto *label_1739
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *cm_class_WHILE1
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *cm_class_WHILE1
		}
	}
	if ( key == key_cancel ) {
		goto *label_1767
	}
	getkey p, 112
	if ( p ) {
		gosub *com_help
		goto *cm_class
	}
	goto *label_1736

*label_1739
	snd SOUNDLIST_SPELL

*cm_sex
	redraw 0
	cs = 0
	cs_bk = -1
	pagesize = 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("男性と女性に能力の違いはない。", "What's your gender?")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	windowshadow = 1

*cm_sex_WHILE1
	redraw 0
	s = lang("性別の選択", "Gender Selection"), strhint3b
	display_window (windoww - 370) / 2 + inf_screenx, winposy(168, 1) - 20, 370, 168
	x = ww / 2
	y = wh - 60
	gmode 4, 180, 300, 30
	pos wx + ww / 2, wy + wh / 2
	grotate BUFFER_MAP, 0, 0, 0, x, y
	gmode 2
	display_topic lang("性別の候補", "Gender"), wx + 28, wy + 30
	listn(0, 0) = cnven(strmale)
	listn(0, 1) = cnven(strfemale)
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	repeat 2
		key_list(cnt) = key_select(cnt)
		keyrange = cnt + 1
		pos wx + 38, wy + 66 + cnt * 19 - 2
		gcopy BUFFER_INF, cnt * 24 + 72, 30, 24, 18
		cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_select(0) ) {
		cmsex = 0
		goto *cm_sex_WEND1
	}
	if ( key == key_select(1) ) {
		cmsex = 1
		goto *cm_sex_WEND1
	}
	if ( key == key_cancel ) {
		goto *cm_class
	}
	getkey p, 112
	if ( p ) {
		gosub *com_help
		goto *cm_sex
	}
	goto *cm_sex_WHILE1

*cm_sex_WEND1
	snd SOUNDLIST_OK1

*label_1744
	redraw 0
	cs = 0
	cs_bk = -1
	page = 0
	pagesize = 16
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("職業や種族は、初期の能力だけでなく、成長の方向性に影響するんだ。", "Your class and race determine growth rate of your skills and attributes.")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	dbmode = DBMODE_FIND
	gosub *cm_race_loop
	repeat listmax
		dbidn = listn(1, cnt)
		dbmode = DBMODE_REF
		gosub *cm_race_loop
		listn(0, cnt) = classname
	loop
	windowshadow = 1

*label_1746
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_1747
	if ( cs != cs_bk ) {
		redraw 0
		s = lang("職業の選択", "Class Selection"), strhint3b
		display_window (windoww - 680) / 2 + inf_screenx, winposy(500, 1) + 20, 680, 500
		cmbg++
		x = ww / 5 * 2
		y = wh - 80
		gmode 4, 180, 300, 50
		pos wx + ww / 4, wy + wh / 2
		grotate BUFFER_MAP, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		display_topic lang("選択できる職業", "Class"), wx + 28, wy + 30
		display_topic lang("職業の説明", "Detail"), wx + 188, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat pagesize
			p = page * pagesize + cnt
			if ( p >= listmax ) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
			if ( jp ) {
				s = listn(0, p)
			}
			else {
				s = cnven(listn(1, p))
			}
			cs_list s, wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		cs_bk = cs
		color 0, 0, 0
		pos wx + 200, wy + 66
		del_chara 0
		dbidn = listn(1, page * pagesize + cs)
		dbmode = DBMODE_SET
		gosub *cm_race_loop
		dbmode = DBMODE_REF_CM
		gosub *cm_race_loop
		val = 1
		gosub *cm_refer
		redraw 1
	}
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = page * pagesize + cnt
			break
		}
		else {
			p = -1
		}
	loop
	if ( p != (-1) ) {
		cmclass = listn(1, p)
		goto *label_1750
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_1746
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_1746
		}
	}
	if ( key == key_cancel ) {
		goto *cm_sex
	}
	getkey p, 112
	if ( p ) {
		gosub *com_help
		goto *label_1744
	}
	goto *label_1747

*label_1750
	snd SOUNDLIST_SKILL
	dim cmlock, 10
	cmlock(8) = 2

*cm_stats
	redraw 0
	cs = 0
	cs_bk = -1
	pagesize = 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("死にたくないなら、ある程度の能力は必要だね。", "You should prepare well, if you want to survive long enough in Ylva.")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	del_chara 0
	dbidn = cmrace
	dbmode = DBMODE_SET
	gosub *cm_race
	dbidn = cmclass
	dbmode = DBMODE_SET
	gosub *cm_race_loop
	cLevel(rc) = 1
	repeat 8, 10
		if ( cmlock(cnt - 10) == 0 ) {
			if ( oomsest_minimumattributeroll ) {
				sdata(cnt + STARTING_SKILL_SPACT, rc) -= sdata(cnt + STARTING_SKILL_SPACT, rc) / 2000000 * 1000000
			}
			else {
				sdata(cnt + STARTING_SKILL_SPACT, rc) -= rnd(sdata(cnt + STARTING_SKILL_SPACT, rc) / 2000000 + 1) * 1000000
			}
			cmstats(cnt - 10) = sdata(cnt + STARTING_SKILL_SPACT, rc)
		}
	loop
	oomsest_minimumattributeroll = 0
	listmax = 0
	list(0, 0) = 0
	listn(0, 0) = lang("リロール", "Reroll")
	listmax++
	list(0, 1) = 0
	listn(0, 1) = lang("決定", "Proceed")
	listmax++
	repeat 8, 10
		list(0, listmax) = cmstats(cnt - 10)
		listn(0, listmax) = skillname(cnt)
		listmax++
	loop
	windowshadow = 1

*cm_stats_WHILE1
	redraw 0
	s = lang("能力のロール", "Attb Reroll"), strhint3b + key_mode2 + lang(" [最低値ロール]", " [Min roll]")
	display_window (windoww - 360) / 2 + inf_screenx, winposy(352, 1) - 20, 360, 352
	x = 150
	y = 240
	gmode 4, 180, 300, 30
	pos wx + 85, wy + wh / 2
	grotate BUFFER_MAP, 0, 0, 0, x, y
	gmode 2
	display_topic lang("能力", "Attributes"), wx + 28, wy + 30
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	pos wx + 175, wy + 52
	mes lang("ロックされた能力は\n変化しません", "Locked items will\nnot change.")
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos wx + 180, wy + 84
	mes lang("残りロック: ", "Locks left: ") + cmlock(8)
	repeat 10
		key_list(cnt) = key_select(cnt)
		keyrange = cnt + 1
		pos wx + 38, wy + 66 + cnt * 23 - 2
		gcopy BUFFER_INF, cnt * 24 + 72, 30, 24, 18
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 23 - 1, 19
		font lang(cfg_font1, cfg_font2), 15 - en * 2, 1
		color 0, 0, 0
		if ( cnt >= 2 ) {
			pos wx + 198, wy + 76 + cnt * 23
			gmode 2, inf_tiles, inf_tiles
			grotate BUFFER_ITEM, (cnt - 2) * inf_tiles, 672, 0, inf_tiles, inf_tiles
			pos wx + 210, wy + 66 + cnt * 23
			mes "" + list(0, cnt) / 1000000
			if ( cmlock(cnt - 2) == 1 ) {
				font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
				pos wx + 240, wy + 66 + cnt * 23 + 2
				color 20, 20, 140
				mes "Locked!"
			}
		}
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = cnt
			break
		}
		else {
			p = -1
		}
	loop
	if ( p != (-1) ) {
		if ( p == 0 ) {
			snd SOUNDLIST_DICE
			goto *cm_stats
		}
		if ( p == 1 ) {
			goto *cm_feat
		}
		if ( cmlock(p - 2) != 0 ) {
			cmlock(8)++
			cmlock(p - 2) = 0
		}
		else {
			if ( cmlock(8) > 0 ) {
				cmlock(p - 2) = 1
				cmlock(8)--
			}
		}
		snd SOUNDLIST_OK1
	}
	if ( key == key_mode2 ) {
		snd SOUNDLIST_DICE
		oomsest_minimumattributeroll = 1
		goto *cm_stats
	}
	if ( key == key_cancel ) {
		goto *label_1744
	}
	getkey p, 112
	if ( p ) {
		gosub *com_help
		goto *cm_stats
	}
	goto *cm_stats_WHILE1

*cm_feat
	gTraitPoint = 3
	dim trait, 500
	dim spact, 500
	faction(0) = ""
	gosub *label_0273
	gosub *label_0276
	redraw 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("フィートとは、君の持っている有益な特徴だ。3つまで選べるよ。", "Choose your feats wisely.")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	locvar_check_adddamage_arrow_charamake = 1
	gosub *com_trait
	locvar_check_adddamage_arrow_charamake = 0
	if ( stat == (-1) ) {
		goto *cm_feat
	}
	if ( stat == 0 ) {
		goto *cm_stats
	}
	faction(56) = faction(0)

*label_1759
	nc_resettrait 56
	nc_intb_001 = 56
	nc_intb_002 = 2
	redraw 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("君の個性となる追加の能力を得ることが出来る。君の好きなものを選ぶといいよ。", "You'll gain abilities here that will make you unique.")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	locvar_check_adddamage_arrow_charamake = 1
	gosub *label_0647
	locvar_check_adddamage_arrow_charamake = 0
	if ( stat == (-1) ) {
		goto *label_1759
	}
	if ( stat == 0 ) {
		goto *cm_feat
	}
	locvar_eqrandweaponmage_selectgodid = "eyth"
	if ( gettrait(0, 175) ) {
		goto *label_1773
	}

*label_1761
	cs = 0
	page = 0
	pagesize = 16
	listmax = 0
	repeat 8
		if ( cnt == 0 & cmrace == "sister" ) {
			listn(0, listmax) = godname("elder brother")
			listn(1, listmax) = "elder brother"
		}
		else {
			listn(0, listmax) = godname(godno2godid(cnt))
			listn(1, listmax) = godno2godid(cnt)
		}
		listmax++
	loop
	repeat usergodmax
		listn(0, listmax) = usergoddatan(1, cnt)
		listn(1, listmax) = usergoddatan(2, cnt)
		listmax++
	loop
	pagemax = (listmax - 1) / pagesize

*label_1764
	cs_bk = -1
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	redraw 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("信仰は自由さ。君は誰を信じるんだい？", "Faith is freedom. Who do you believe?"), lang("左右キー [ページ切替]  Shift,Esc [戻る]", "Right,left [Change]  Shift,Esc [Back]")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	redraw 0
	s = lang("どの神を信仰する？", "Which god do you believe?")
	display_window (windoww - 400) / 2 + inf_screenx, winposy(458, 1) + 20, 400, 458
	x = ww / 3 * 2
	y = wh - 80
	gmode 4, 180, 300, 40
	pos wx + ww / 2, wy + wh / 2
	grotate BUFFER_MAP, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("信仰の候補", "God List"), wx + 28, wy + 30
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	repeat pagesize
		p = page * pagesize + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange = cnt + 1
		display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
		cs_list listn(0, p), wx + 64, wy + 66 + cnt * 19 - 1, 19
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = pagesize * page + cnt
			cs = cnt
			break
		}
	loop
	if ( p != (-1) ) {
		locvar_eqrandweaponmage_selectgodid = listn(1, p)
		goto *label_1773
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_1764
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_1764
		}
	}
	if ( key == key_cancel ) {
		goto *label_1759
	}
	goto *label_1764

*label_1767
	sdim lockedaka, 30, 17
	redraw 0
	pagemax = 0
	page = 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("やあ、待っていたよ。早速旅の支度をしようか。", "Welcome traveler, I've been looking for you.")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	windowshadow = 1
	cs = 0
	cs_bk = -1
	list(0, 0) = -1
	namefilter = ""

*label_1768
	redraw 0
	if ( cs != cs_bk | p == (-2) ) {
		s = lang("異名の選択", "Alias Selection"), strhint3b + " " + key_mode2 + " " + lang("[異名のロック]", "[Lock Alias]") + "  " + oomsest_strhint1
		display_window (windoww - 400) / 2 + inf_screenx, winposy(458, 1) + 20, 400, 458
		cmbg++
		x = ww / 3 * 2
		y = wh - 80
		gmode 4, 180, 300, 40
		pos wx + ww / 2, wy + wh / 2
		grotate BUFFER_MAP, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		display_topic lang("異名の候補", "Alias List"), wx + 28, wy + 30
		if ( namefilter != "" ) {
			pos wx + 210, wy + 38
			mes lang("フィルタ", "Filter") + ": " + namefilter
		}
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 17
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			if ( list(0, 0) == (-1) ) {
				if ( gWizard == 1 ) {
					listn(0, cnt) = "*Debug*"
				}
				else {
					if ( lockedaka(cnt) != "" ) {
						listn(0, cnt) = lockedaka(cnt)
					}
					else {
						cnt2 = cnt
						listn(0, cnt2) = ""
						repeat 1000
							nickname = random_title()
							if ( namefilter != "" ) {
								nicknamelower = getpath(nickname, 16)
								if ( instr(nicknamelower, , getpath(namefilter, 16)) < 0 ) {
									continue
								}
							}
							listn(0, cnt2) = nickname
							break
						loop
						if ( listn(0, cnt2) == "" ) {
							listn(0, cnt2) = random_title()
						}
					}
				}
			}
			if ( cnt == 0 ) {
				listn(0, cnt) = lang("リロール", "Reroll")
			}
			pos wx + 38, wy + 66 + cnt * 19 - 2
			gcopy BUFFER_INF, cnt * 24 + 72, 30, 24, 18
			cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
			if ( lockedaka(cnt) != "" ) {
				pos wx + 20, wy + 68 + cnt * 19
				mes "*"
			}
		loop
		cs_bk = cs
		list(0, 0) = 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = cnt
			break
		}
		else {
			p = -1
		}
	loop
	if ( p != (-1) ) {
		if ( key == key_select(0) ) {
			list(0, 0) = -1
			snd SOUNDLIST_DICE
			cs_bk = -1
		}
		else {
			cmaka = listn(0, p)
			repeat 17
				lockedaka(cnt) = ""
			loop
			snd SOUNDLIST_OK1
			namefilter = ""
			goto *cm_class
		}
	}
	if ( key == key_cancel ) {
		namefilter = ""
		goto *game_title
	}
	getkey p, 112
	if ( p ) {
		gosub *com_help
		goto *label_1767
	}
	if ( key == key_mode2 ) {
		if ( cs != 0 ) {
			if ( lockedaka(cs) == "" ) {
				lockedaka(cs) = listn(0, cs)
				p = -2
			}
			else {
				lockedaka(cs) = ""
				p = -2
			}
			snd SOUNDLIST_OK1
		}
	}
	if ( key == key_msglog ) {
		val = windoww / 2 - 140 + inf_screenx, winposy(60), 14, 0, 0
		inputlog = ""
		gosub *prompt_word
		namefilter = inputlog
		list(0, 0) = -1
		snd SOUNDLIST_DICE
		cs = 0
		cs_bk = -1
	}
	goto *label_1768

*label_1773
	pcc(PCC_BODY, 0) = 0

*cm_portrait
	redraw 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("君の見た目を知っておきたいな。まあ、後からいつでも変えられるけどね。", "What you look like? Don't worry, you can change them later.")
	gosub *screen_drawMsg2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos 20, windowh - 20
	color 0, 0, 0
	mes "Press F1 to show help."
	if ( geneuse != "" ) {
		pos 20, windowh - 36
		mes "Gene from " + geneuse
	}
	cbitmod CHARA_BIT_PCC, CHARA_PLAYER, TRUE
	gosub *label_2916
	if ( stat == 0 ) {
		gosub *cm_bg
		if ( gettrait(0, 175) ) {
			goto *cm_feat
		}
		else {
			goto *label_1761
		}
	}
	if ( stat == (-1) ) {
		gosub *com_help
		gosub *cm_bg
		goto *cm_portrait
	}
	gosub *cm_bg
	cmportrait = cPortrait(rc)

*cmSubTxt
	snd SOUNDLIST_CHARA

*cm_end
	redraw 0
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	s = lang("決定ｷｰを押すことで、生い立ちをリロールできる。", "Hit the enter key to reroll your personal history.")
	gosub *screen_drawMsg2
	del_chara 0
	believegod 0, locvar_eqrandweaponmage_selectgodid
	gosub *label_2470
	dbidn = cmrace
	dbmode = DBMODE_SET
	gosub *cm_race
	dbidn = cmclass
	dbmode = DBMODE_SET
	gosub *cm_race_loop
	cnName(rc) = "????"
	cnAka(rc) = cmaka
	cLevel(rc) = 1
	repeat 8, 10
		sdata(cnt + STARTING_SKILL_SPACT, rc) = cmstats(cnt - 10)
	loop
	resetfaction 0
	gosub *label_1712
	gosub *label_1713
	repeat 224
		s = getfactionvalue(56, "trait" + cnt)
		if ( s == "" ) {
			continue
		}
		settrait 0, cnt, int(s)
	loop
	repeat 200
		if ( nc_gettrait(56, cnt) ) {
			addfaction 0, "nc_trait," + cnt
			if ( cnt == 0 ) {
				if ( sPerform(CHARA_PLAYER) == 0 ) {
					skillgain CHARA_PLAYER, 183, 1
				}
			}
			if ( cnt == 1 ) {
				if ( sPerform(CHARA_PLAYER) == 0 ) {
					skillgain CHARA_PLAYER, 183, 1
				}
			}
			if ( cnt == 2 ) {
				if ( sPerform(CHARA_PLAYER) == 0 ) {
					skillgain CHARA_PLAYER, 183, 1
				}
			}
			if ( cnt == 20 ) {
				if ( sInvest(CHARA_PLAYER) == 0 ) {
					skillgain CHARA_PLAYER, 160, 1
				}
			}
		}
	loop
	cPortrait(rc) = cmportrait
	create_pcpic 0, 1
	mode = MODELIST_CHARA_CREATION
	csctrl = 1
	menucycle = 0
	gosub *label_2879
	if ( stat == 0 ) {
		nowindowanime = 1
		gosub *cm_bg
		goto *cm_end
	}
	redraw 0
	gsel BUFFER_MAP
	pos 0, 0
	gmode 0
	gcopy BUFFER_SCREEN, 0, 100, windoww, windowh - 100
	gsel BUFFER_SCREEN
	gosub *cm_bg
	s = lang("満足できたかな？", "Are you satisfied now?")
	gosub *screen_drawMsg2
	promptl(0, promptmax) = lang("はい", "Yes"), "a", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("いいえ", "No"), "b", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("最初から", "Restart"), "c", "" + promptmax
	promptmax++
	val = promptx, 240, 160, 1
	gosub *prompt_key
	snd SOUNDLIST_OK1
	if ( rtval == 1 | rtval == (-1) ) {
		goto *cmSubTxt
	}
	if ( rtval == 2 ) {
		nowindowanime = 0
		goto *cm_init
	}
	nc_setjobskill
	redraw 0
	gmode 0
	pos 0, 100
	gcopy BUFFER_MAP, 0, 0, windoww, windowh - 100
	gmode 2
	s = lang("最後の質問だ。君の名前は？", "Last question. What's your name?")
	gosub *screen_drawMsg2

*cm_name_loop
	val = (windoww - 230) / 2 + inf_screenx, winposy(120), 10, 0, 0
	inputlog = ""
	input_mode = 1
	gosub *prompt_word
	cmname = "" + inputlog
	if ( cmname == "" | cmname == " " ) {
		cmname = randomname()
	}
	playerid = "sav_" + cmname
	dirlist buff, exedir + "save\\*", 5
	notesel buff
	f = 0
	repeat noteinfo(0)
		noteget s, cnt
		if ( getpath(s, 16) == getpath(playerid, 16) ) {
			f = 1
			break
		}
	loop
	if ( f == 1 ) {
		redraw 0
		gmode 0
		pos 0, 100
		gcopy BUFFER_MAP, 0, 0, windoww, windowh - 100
		gmode 2
		msgconfirm = 1
		s = lang("あいにく、その名前の冒険者はすでに存在する。", "Sorry, but the name is already taken.")
		gosub *screen_drawMsg2
		goto *cm_name_loop
	}
	snd SOUNDLIST_SKILL
	cnName(rc) = cmname
	cGold(CHARA_PLAYER) = 400 + rnd(200)
	if ( geneuse != "" ) {
		gosub *label_3065
	}
	await 250
	mode = MODELIST_NORMAL_START
	goto *world_init

*cm_bg
	redraw 0
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel BUFFER_SCREEN
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, 64
	gmode 2
	return

*cm_refer
	if ( val == 1 ) {
		chara_preparepic ref1, cnt
		pos wx + 380, wy - chipc(CHIPC_HEIGHT, ref1) + 60
		gcopy BUFFER_CHR, 0, 960, inf_tiles, chipc(CHIPC_HEIGHT, ref1)
		chara_preparepic ref2, cnt
		pos wx + 350, wy - chipc(CHIPC_HEIGHT, ref1) + 60
		gcopy BUFFER_CHR, 0, 960, inf_tiles, chipc(CHIPC_HEIGHT, ref1)
		pos wx + 460, wy + 38
		mes lang("種族: ", "Race: ") + cmrace(1)
	}
	else {
		if ( val != 3 ) {
			gmode 4, chipc(CHIPC_WIDTH, ref1), chipc(CHIPC_HEIGHT, ref1), 40
			chara_preparepic ref1, cnt
			pos wx + 480, wy + 96
			grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, ref1) * 2, chipc(CHIPC_HEIGHT, ref1) * 2
			chara_preparepic ref2, cnt
			pos wx + 350, wy + 96
			grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, ref1) * 2, chipc(CHIPC_HEIGHT, ref1) * 2
			gmode 2
		}
	}
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	tx = wx + 230
	ty = wy + 62
	talk_conv buff, 60 + en * 2
	color 0, 0, 0
	pos tx - 20, ty
	mes buff
	if ( val == 3 ) {
		p = -1
		repeat length(classnamecsv)
			if ( dbidn == classnamecsv(cnt, 1) ) {
				p = cnt
				break
			}
		loop
		if ( p != (-1) ) {
			color 0, 0, 0
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			tx = wx + 200
			ty = wy + 166
			display_topic lang("技能", "Skill"), wx + 188, wy + 166
			ty += 34
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			r = 1
			repeat 20
				r++
				if ( r >= classspact(p, 1) + 2 ) {
					break
				}
				if ( classspact(p, r) >= 400 & classspact(p, r) < tailspact ) {
					pos cnt \ 4 * 110 + tx - 2, cnt / 4 * 32 + ty - 18
					gmode 2, inf_tiles, inf_tiles
					gcopy BUFFER_ITEM, (skillUse(classspact(p, r)) - 10) * inf_tiles, 672, inf_tiles, inf_tiles
					pos cnt \ 4 * 110 + tx + 32, cnt / 4 * 32 + ty
					mes skillname(classspact(p, r))
				}
				else {
					continue cnt
				}
			loop
		}
		return
	}
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	tx = wx + 200
	ty = wy + 166
	display_topic lang("能力ボーナス", "Attribute Bonus"), tx, ty
	ty += 34
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	if ( jp ) {
		s = "皆無", "最高", "理想的", "高い", "やや高い", "普通", "少し", "微々"
	}
	if ( en ) {
		s = "None", "Best", "Great", "Good", "Not bad", "Normal", "Little", "Slight"
	}
	repeat 3
		cnt2 = cnt
		repeat 3
			if ( cnt2 == 2 ) {
				if ( cnt == 2 ) {
					r = 18
					repeat 1
						if ( sorg(r, CHARA_PLAYER) > 120 ) {
							color 0, 0, 200
							break
						}
						if ( sorg(r, CHARA_PLAYER) > 100 ) {
							color 0, 0, 200
							break
						}
						if ( sorg(r, CHARA_PLAYER) > 80 ) {
							color 0, 0, 150
							break
						}
						if ( sorg(r, CHARA_PLAYER) > 60 ) {
							color 0, 0, 150
							break
						}
						if ( sorg(r, CHARA_PLAYER) > 40 ) {
							color 0, 0, 0
							break
						}
						if ( sorg(r, CHARA_PLAYER) > 20 ) {
							color 150, 0, 0
							break
						}
						if ( sorg(r, CHARA_PLAYER) > 0 ) {
							color 200, 0, 0
							break
						}
						color 120, 120, 120
					loop
					p(1) = cnt2 * 3 + cnt + (cnt2 == 2 & cnt == 2) * 3
					pos cnt2 * 150 + tx + 13, ty + 7
					gmode 2, inf_tiles, inf_tiles
					grotate BUFFER_ITEM, p(1) * inf_tiles, 672, 0, inf_tiles, inf_tiles
					pos cnt * 150 + tx + 32, ty
					if ( val != 1 ) {
						mes strmid(skillname(r), 0, 4 - (jp == 0)) + ": " + sorg(r, CHARA_PLAYER)
					}
					else {
						mes strmid(skillname(r), 0, 4 - (jp == 0)) + ": " + cnvfix(sorg(r, CHARA_PLAYER))
					}
					break
				}
			}
			r = cnt2 * 3 + cnt + 10
			p = 0
			repeat 1
				if ( sorg(r, CHARA_PLAYER) > 13 ) {
					p = 1
					color 0, 0, 200
					break
				}
				if ( sorg(r, CHARA_PLAYER) > 11 ) {
					p = 2
					color 0, 0, 200
					break
				}
				if ( sorg(r, CHARA_PLAYER) > 9 ) {
					p = 3
					color 0, 0, 150
					break
				}
				if ( sorg(r, CHARA_PLAYER) > 7 ) {
					p = 4
					color 0, 0, 150
					break
				}
				if ( sorg(r, CHARA_PLAYER) > 5 ) {
					p = 5
					color 0, 0, 0
					break
				}
				if ( sorg(r, CHARA_PLAYER) > 3 ) {
					p = 6
					color 150, 0, 0
					break
				}
				if ( sorg(r, CHARA_PLAYER) > 0 ) {
					p = 7
					color 200, 0, 0
					break
				}
				color 120, 120, 120
			loop
			pos cnt * 150 + tx + 13, ty + 7
			gmode 2, inf_tiles, inf_tiles
			grotate BUFFER_ITEM, (cnt2 * 3 + cnt) * inf_tiles, 672, 0, inf_tiles, inf_tiles
			pos cnt * 150 + tx + 32, ty
			mes strmid(skillname(r), 0, 4 - (jp == 0)) + ": " + s(p)
		loop
		ty += 16
	loop
	ty = wy + 260
	if ( val == 0 ) {
		display_topic lang("獲得部位", "Bodyparts"), tx, ty
		ty += 34
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		pos tx + 32, ty
		mes bodyparts2string()
		ty = wy + 322
	}
	display_topic lang("獲得技能", "Trained Skill"), tx, ty
	ty += 34
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	r = 0
	s = lang("武器の専門  ", "Proficient in ")
	repeat 150 - 100, 100
		if ( sorg(cnt, CHARA_PLAYER) != 0 ) {
			if ( r != 0 ) {
				s += ","
			}
			s += skillname(cnt)
			r++
		}
	loop
	if ( r != 0 ) {
		pos tx + 13, ty + 6
		gmode 2, inf_tiles, inf_tiles
		grotate BUFFER_ITEM, 0, 672, 0, inf_tiles, inf_tiles
		pos tx + 32, ty
		mes s
		ty += 14
	}
	repeat 600 - 150, 150
		if ( sorg(cnt, CHARA_PLAYER) != 0 ) {
			s = skillname(cnt)
			if ( jp ) {
				lenfix s, 12
			}
			else {
				lenfix s, 16
			}
			pos tx + 13, ty + 6
			gmode 2, inf_tiles, inf_tiles
			grotate BUFFER_ITEM, (skillUse(cnt) - 10) * inf_tiles, 672, 0, inf_tiles, inf_tiles
			s(1) = skilldesc(cnt)
			if ( en ) {
				if ( strlen(s(1)) > 45 ) {
					s(1) = strmid(s(1), 0, 42) + "..."
				}
			}
			pos tx + 32, ty
			mes s + s(1)
			ty += 14
		}
	loop
	return
	goto *label_1796

#defcfunc bodyparts2string
	if ( jp ) {
		locvar_eqrandweaponmage_names = "", "頭", "首", "背", "胴", "手", "指", "腕", "腰", "足"
	}
	else {
		locvar_eqrandweaponmage_names = "", "HEAD", "NECK", "BACK", "BODY", "HAND", "RING", "ARM", "WAIST", "LEG"
	}
	dim locvar_eqrandweaponmage_bodyparts, 10
	repeat 30, 100
		locvar_eqrandweaponmage_bodypart = cdata(cnt, CHARA_PLAYER) / EXT_EQUIP_SLOTS
		if ( locvar_eqrandweaponmage_bodypart == 0 | locvar_eqrandweaponmage_bodypart == 10 | locvar_eqrandweaponmage_bodypart == 11 ) {
			break
		}
		locvar_eqrandweaponmage_bodyparts(locvar_eqrandweaponmage_bodypart) += 1
	loop
	locvar_sgodname_s = ""
	repeat length(locvar_eqrandweaponmage_bodyparts)
		locvar_eqrandweaponmage_n = locvar_eqrandweaponmage_bodyparts(cnt)
		if ( locvar_eqrandweaponmage_n == 0 ) {
			continue
		}
		locvar_sgodname_s += locvar_eqrandweaponmage_names(cnt)
		if ( locvar_eqrandweaponmage_n != 1 ) {
			locvar_sgodname_s += "x" + locvar_eqrandweaponmage_n
		}
		locvar_sgodname_s += " "
	loop
	return locvar_sgodname_s

*label_1796
	goto *label_1799

#deffunc str_replace var str_replace_prm0, str str_replace_prm1, str str_replace_prm2
	repeat strlen(str_replace_prm0)
		await
		locvar_eqrandweaponmage_idx = instr(str_replace_prm0, 0, str_replace_prm1)
		if ( locvar_eqrandweaponmage_idx == (-1) ) {
			break
		}
		str_replace_prm0 = strmid(str_replace_prm0, 0, locvar_eqrandweaponmage_idx) + str_replace_prm2 + strmid(str_replace_prm0, locvar_eqrandweaponmage_idx + strlen(str_replace_prm1), strlen(str_replace_prm0) - locvar_eqrandweaponmage_idx)
	loop
	return

*label_1799
	goto *label_1802

#deffunc sjis2utf8n var sjis2utf8n_prm0, str sjis2utf8n_prm1
	locvar_eqrandweaponmage_len_uni = strlen(sjis2utf8n_prm1) * 2
	sdim locvar_eqrandweaponmage_str_uni, locvar_eqrandweaponmage_len_uni + 1
	cnvstow locvar_eqrandweaponmage_str_uni, sjis2utf8n_prm1
	func_4 65001, 0, varptr(locvar_eqrandweaponmage_str_uni), -1, 0, 0, 0, 0
	locvar_eqrandweaponmage_len_utf8 = stat
	memexpand sjis2utf8n_prm0, locvar_eqrandweaponmage_len_utf8 + 1
	func_4 65001, 0, varptr(locvar_eqrandweaponmage_str_uni), -1, varptr(sjis2utf8n_prm0), locvar_eqrandweaponmage_len_utf8, 0, 0
	return locvar_eqrandweaponmage_len_utf8

#defcfunc utf8n2sjis var utf8n2sjis_prm0
	func_3 65001, 0, varptr(utf8n2sjis_prm0), -1, 0, 0
	locvar_eqrandweaponmage_len_uni = stat
	sdim locvar_eqrandweaponmage_str_uni, locvar_eqrandweaponmage_len_uni + 1
	func_3 65001, 0, varptr(utf8n2sjis_prm0), -1, varptr(locvar_eqrandweaponmage_str_uni), locvar_eqrandweaponmage_len_uni
	return cnvwtos(locvar_eqrandweaponmage_str_uni)

*label_1802

#deffunc convertartifact int convertartifact_arg1, int convertartifact_arg2
	if ( refitem(iID(convertartifact_arg1), DBSPEC_TYPE, convertartifact_arg1) >= FILTER_ITEM_MIN ) {
		return convertartifact_arg1
	}
	if ( iQuality(convertartifact_arg1) != FIX_QUALITY_UNIQUE ) {
		return convertartifact_arg1
	}
	if ( iEquip(convertartifact_arg1) != 0 ) {
		return convertartifact_arg1
	}
	locvar_convertartifact_f = 0
	repeat 5480
		if ( convertartifact_arg2 ) {
			if ( cnt >= 5080 ) {
				break
			}
		}
		if ( cnt >= 20 * 16 + 200 & cnt < 5080 - 20 ) {
			continue
		}
		locvar_convertartifact_tc = inv_getowner(cnt)
		if ( locvar_convertartifact_tc != (-1) ) {
			if ( cExist(locvar_convertartifact_tc) == CHAR_STATE_DEAD | cRole(locvar_convertartifact_tc) == ROLE_ADVENTURER ) {
				continue
			}
		}
		if ( iNum(cnt) > 0 ) {
			if ( iID(cnt) == iID(convertartifact_arg1) ) {
				if ( cnt != convertartifact_arg1 ) {
					if ( iID(convertartifact_arg1) != ITEM_ID_CARNEADES_PLANK | iCItemIdx(cnt) == iCItemIdx(convertartifact_arg1) ) {
						locvar_convertartifact_f = 1
						break
					}
				}
			}
		}
	loop
	if ( locvar_convertartifact_f == 0 ) {
		return convertartifact_arg1
	}
	locvar_convertartifact_n = "" + itemname(convertartifact_arg1)
	repeat
		flt refitem(iID(convertartifact_arg1), DBSPEC_OBJ_LEVEL, convertartifact_arg1), FIX_QUALITY_MIRACLE
		flttypeminor = refitem(iID(convertartifact_arg1), DBSPEC_TYPE_MINOR, convertartifact_arg1)
		iNum(convertartifact_arg1) = 0
		itemcreate inv_getowner(convertartifact_arg1), ITEM_ID_DUMMY, iX(convertartifact_arg1), iY(convertartifact_arg1), 0
		if ( iQuality(ci) != FIX_QUALITY_UNIQUE ) {
			break
		}
		iNum(ci) = 0
	loop
	txt -1, lang(locvar_convertartifact_n + "は" + itemname(ci) + "に形を変えた。", locvar_convertartifact_n + " turns its shape into " + itemname(ci) + ".")
	return convertartifact_arg1

*label_1806
	fsetincome = FILTER_ITEM_POTION, FILTER_ITEM_POTION, FILTER_ITEM_POTION, FILTER_ITEM_SCROLL, FILTER_ITEM_SCROLL, FILTER_ITEM_ROD, FILTER_ITEM_SPELLBOOK, FILTER_ORE, FILTER_ITEM_FOOD, FILTER_ITEM_FOOD
	fsetchest = FILTER_WEAPON, FILTER_RANGE, FILTER_HELM, FILTER_ARMOR, FILTER_CLOAK, FILTER_GIRDLE, FILTER_BOOTS, FILTER_GLOVES, FILTER_SHIELD, FILTER_ACCESSORY_RING, FILTER_ACCESSORY_AMULET, FILTER_ITEM_SPELLBOOK, FILTER_ITEM_TOOL
	fsetwear = FILTER_WEAPON, FILTER_WEAPON, FILTER_RANGE, FILTER_RANGE, FILTER_AMMO, FILTER_HELM, FILTER_ARMOR, FILTER_CLOAK, FILTER_GIRDLE, FILTER_BOOTS, FILTER_GLOVES, FILTER_SHIELD, FILTER_ACCESSORY_RING, FILTER_ACCESSORY_AMULET
	fsetitem = FILTER_ITEM_POTION, FILTER_ITEM_POTION, FILTER_ITEM_SCROLL, FILTER_ITEM_SCROLL, FILTER_ITEM_ROD, FILTER_GOLD, FILTER_ITEM_SPELLBOOK, FILTER_JUNK, FILTER_ITEM_TOOL, FILTER_ITEM_BOOK
	fsetrewardsupply = FILTER_ITEM_POTION, FILTER_ITEM_SCROLL, FILTER_ITEM_ROD, FILTER_ITEM_SPELLBOOK, FILTER_ITEM_FOOD
	fsetrare = FILTER_FURNITURE, FILTER_CONTAINER, FILTER_ORE, FILTER_ITEM_BOOK, FILTER_ITEM_FOOD
	fsetperform = 77000, 57000, 57000, 57000, 60000, 18000, 20000, 32000, 34000, 52000, 64000, 64000
	fsetperform2 = 10000, 12000, 14000, 16000, 18000, 19000, 20000, 22000, 24000, 25000, 32000, 34000, 69000
	fsetdeliver = FILTER_FURNITURE, FILTER_ORE, FILTER_ITEM_SPELLBOOK, FILTER_JUNK
	fsetsupply = FILTER_FURNITURE, FILTER_ORE, FILTER_ITEM_ROD, FILTER_ITEM_SPELLBOOK, FILTER_JUNK
	fsetmagic = FILTER_ITEM_SCROLL, FILTER_ITEM_ROD, FILTER_ITEM_SPELLBOOK
	fsetarmor = FILTER_HELM, FILTER_ARMOR, FILTER_CLOAK, FILTER_GIRDLE, FILTER_BOOTS, FILTER_GLOVES, FILTER_SHIELD
	fsetweapon = FILTER_WEAPON, FILTER_RANGE, FILTER_AMMO
	fsetplantartifact = FILTER_ACCESSORY_RING, FILTER_ACCESSORY_AMULET
	fsetplantunknown = FILTER_ITEM_FOOD, FILTER_ITEM_FOOD, FILTER_ITEM_SPELLBOOK, FILTER_JUNK, FILTER_ORE
	fsetremain = FILTER_AMMO, FILTER_ITEM_FOOD, FILTER_ITEM_FOOD, FILTER_ORE, FILTER_ITEM_SCROLL, FILTER_ITEM_POTION, FILTER_ITEM_FOOD
	fsetbarrel = FILTER_AMMO, FILTER_ITEM_FOOD, FILTER_ITEM_SCROLL, FILTER_ITEM_POTION, FILTER_ORE, FILTER_JUNK
	fsetcollect = FILTER_JUNK, FILTER_FURNITURE, FILTER_ITEM_FOOD, FILTER_ORE
	isetforgetnefia = 287, 559, 711, 243, 430, 431, 632, 709, 732, 480
	isetabyss = 10000, 12000, 14000, 16000, 18000, 19000, 20000, 22000, 24000, 32000, 34000
	isetdeed = ITEM_ID_DEED, ITEM_ID_DEED_MUSEUM, ITEM_ID_DEED_SHOP, ITEM_ID_DEED_FARM, ITEM_ID_DEED_STORAGE_HOUSE, ITEM_ID_SHELTER, ITEM_ID_DEED_RANCH
	isetfruit = ITEM_ID_APPLE, ITEM_ID_GRAPE, ITEM_ID_TANGERINE, ITEM_ID_LEMON, ITEM_ID_STRAWBERRY, ITEM_ID_CHERRY
	isetthrowpotionminor = ITEM_ID_POTION_BLINDNESS, ITEM_ID_POTION_CONFUSION, ITEM_ID_POTION_SLOW, ITEM_ID_SLEEPING_DRUG, ITEM_ID_POISON, ITEM_ID_BOTTLE_BEER, ITEM_ID_POTION_HERO, ITEM_ID_BOTTLE_SULFURIC
	isetthrowpotionmajor = ITEM_ID_POTION_CONFUSION, ITEM_ID_POTION_SLOW, ITEM_ID_BOTTLE_WHISKY, ITEM_ID_POTION_SILENCE, ITEM_ID_POTION_CURE_MUTATION, ITEM_ID_POTION_WEAKNESS, ITEM_ID_MOLOTOV, ITEM_ID_MOLOTOV
	isetthrowpotiongreater = ITEM_ID_POTION_CONFUSION, ITEM_ID_BOTTLE_WHISKY, ITEM_ID_POTION_SILENCE, ITEM_ID_POTION_MUTATION, ITEM_ID_POTION_WEAKEN_RESISTANCE, ITEM_ID_POTION_PARALYSIS, ITEM_ID_MOLOTOV
	isethire = ITEM_ID_BOTTLE_WHISKY, ITEM_ID_POTION_CURE_CRITICAL_WOUND, ITEM_ID_POTION_HEALER_ODINA, ITEM_ID_RAW_EMERALD_ORE, ITEM_ID_POTION_CURE_MAJOR_WOUND, ITEM_ID_POTION_SACRED_HEALER_JURE, ITEM_ID_LONG_SWORD, ITEM_ID_LONG_SWORD, ITEM_ID_LONG_SWORD
	isetgiftminor = ITEM_ID_KOTATSU, ITEM_ID_DARUMA, ITEM_ID_DARUMA, ITEM_ID_MOCHI, ITEM_ID_MOCHI, ITEM_ID_BLACK_CRYSTAL, ITEM_ID_SNOW_MAN, ITEM_ID_PAINTING_LANDSCAPE, ITEM_ID_PAINTING_SUNFLOWER, ITEM_ID_TREE_FRUIT, ITEM_ID_TREASURE_BALL, ITEM_ID_DEED_HEIRSHIP, ITEM_ID_RUNE, ITEM_ID_HEART, ITEM_ID_BLOOD, ITEM_ID_UPRIGHT_PIANO, ITEM_ID_DEAD_FISH, ITEM_ID_SHIT, ITEM_ID_SMALL_MEDAL, ITEM_ID_BRAND_NEW_GRAVE
	isetgiftmajor = ITEM_ID_KAGAMI_MOCHI, ITEM_ID_KAGAMI_MOCHI, ITEM_ID_PANTY, ITEM_ID_BOTTLE_HERMES_BLOOD, ITEM_ID_SCROLL_SUPERIOR_MATERIAL, ITEM_ID_FLYING_SCROLL, ITEM_ID_SISTERS_LOVE_FUELED_LUNCH, ITEM_ID_SHELTER, ITEM_ID_SUMMONING_CRYSTAL, ITEM_ID_UNICORN_HORN
	isetgiftgrand = ITEM_ID_FIVE_HORNED_HELM, ITEM_ID_AURORA_RING, ITEM_ID_SPEED_RING, ITEM_ID_MAUSER_C96_CUSTOM, ITEM_ID_LIGHTSABRE, ITEM_ID_GOULDS_PIANO
	isethirerole = ITEM_ID_ROD_IDENTIFY, ITEM_ID_DECORATED_GLOVES, ITEM_ID_COMPOSITE_BOOTS, ITEM_ID_MAGIC_HAT, ITEM_ID_ROBE, ITEM_ID_SCROLL_IDENTIFY, 1008, 1008, 1008
	isetcrop = ITEM_ID_APPLE, ITEM_ID_GRAPE, ITEM_ID_LEMON, ITEM_ID_STRAWBERRY, ITEM_ID_CHERRY, ITEM_ID_LETTUCE, ITEM_ID_MELON
	isetgod = ITEM_ID_DUMMY, ITEM_ID_LONG_SWORD, ITEM_ID_DAGGER, ITEM_ID_HAND_AXE, ITEM_ID_CLUB, ITEM_ID_MAGIC_HAT, ITEM_ID_FAIRY_HAT, ITEM_ID_BREASTPLATE
	isetrarewear = 759, 788, 512, 556, 552, 557, 558, 664
	isetwanderingvendorsrareitems = 243, 290, 421, 430, 431, 480, 549, 621, 708, 709, 737
	dim asettown, 5, 2
	asettown(0, 0) = 5, 11, 14, 15, 12
	asettown(0, 1) = 50, 54, 53, 51, 52
	moneybox = 500, 2000, 10000, 50000, 500000, 5000000, 100000000, 2147483647
	giftvalue = 10, 20, 30, 50, 75, 100
	giftn = lang("つまらない", "cheap"), lang("普通の", "so so"), lang("ちょっとドキドキする", "exciting"), lang("高価な", "expensive"), lang("気絶しそうなほど素晴らしい", "hot and gorgeous"), lang("王様が羨むほどの", "crazy epic"), "bug"
	moneyboxn = lang("5百金貨", "500 GP"), lang("2千金貨", "2k GP"), lang("1万金貨", "10K GP"), lang("5万金貨", "50K GP"), lang("50万金貨", "500K GP"), lang("500万金貨", "5M GP"), lang("1億金貨", "500M GP"), lang("1I金貨", "1I GP")
	biten = lang("ミジンコ", "water flea"), lang("バッタ", "grasshopper"), lang("テントウ", "ladybug"), lang("トンボ", "dragonfly"), lang("セミ", "locust"), lang("ヘラクレス", "beetle")
	nc_horskilln = lang("加速", "acceleration"), lang("スタミナ節約", "stamina saving"), lang("立ち回り強化", "conducting"), lang("前半スタミナ節約", "first half stamina saving"), lang("後半スタミナ節約", "save stamina in second half"), lang("後半疾走", "half a mile"), lang("休息", "rest"), lang("敵惑わし(スタミナ)", "enemy distraction(stamina)"), lang("敵惑わし(速度)", "enemy distraction(speed)"), lang("妨害耐性", "jamming resist"), lang("晴れの日得意", "fine day"), lang("雨の日得意", "rain day"), "", "", "", "", "", "", "", "", "", lang("竜頭蛇尾", "headlong"), lang("スライド", "slide"), lang("逃げ切りの構え", "ready to flee"), lang("追い抜きの構え", "passing stance"), lang("鉄壁", "iron wall"), lang("エーテルフロー", "Ether Flow")
	notesel buff
	noteload exedir + "data\\book.txt"
	p = instr(buff, 0, "%DEFINE")
	buff = strmid(buff, p, instr(buff, p, "%END"))
	notedel 0
	sdim booktitle, noteinfo(0), 25
	p = 0
	repeat noteinfo(0)
		noteget msgtemp, cnt
		csvsort s, msgtemp, 44
		booktitle(int(s)) = lang(s(1), s(2))
		if ( int(s(3)) == 1 ) {
			isetbook(p) = int(s)
			p++
		}
	loop
	magebookn = lang("ヴォイニッチ写本", "Voynich Manuscript"), lang("ドール賛歌", "Dhol Chants"), lang("ポナペ教教典", "Ponape Scripture"), lang("グラーキ黙示録", "Revelations of Glaaki"), lang("グ＝ハーン断章", "G'harne Fragments"), lang("断罪の書", "Liber Damnatus"), lang("ドジアンの書", "Book of Dzyan"), lang("エイボンの書", "Book of Eibon"), lang("大いなる教書", "Grand Grimoire"), lang("セラエノ断章", "Celaeno Fragments"), lang("ネクロノミコン", "Necronomicon"), lang("ルルイエ異本", "The R'lyeh Text"), lang("エルトダウン・シャールズ", "Eltdown Shards"), lang("金枝篇", "The Golden Bough"), lang("終焉の書", "Apocalypse")
	isetgsrare = 557, 685, 733
	isetmvrare = 632, 502, 287, 711
	isetblacksmithrare = 556, 759, 781, 788
	isethighspell = 59, 54, 60, 35, 41, 64, 65, 3
	return

*label_1809
	if ( rc == CHARA_PLAYER ) {
		if ( gQuest != QUEST_TYPE_NONE ) {
			return
		}
		if ( trophycheck(21) != 2 ) {
			inv_getheader rc
			repeat invrange, invhead
				ci = cnt
				if ( iNum(cnt) == 0 ) {
					continue
				}
				if ( mCanSave == 0 ) {
					if ( iEquip(cnt) != 0 ) {
						continue
					}
					if ( ibit(ITEM_BIT_PRECIOUS, ci) ) {
						continue
					}
					if ( rnd(3) ) {
						continue
					}
				}
				else {
					if ( rnd(5) ) {
						continue
					}
				}
				if ( refitem(iID(ci), DBSPEC_CARGO, ci) == 1 ) {
					if ( mType != MAP_TYPE_WORLD & mType != MAP_TYPE_HOME & mType != MAP_TYPE_TOWN & mType != (4 /*!!!@[MAP_TYPE_DUNGEON_RANGE @@@ MAP_TYPE_LOCAL]@!!! */) & mType != MAP_TYPE_FIELD & mType != MAP_TYPE_VILLAGE ) {
						continue
					}
					else {
						if ( rnd(2) ) {
							continue
						}
					}
				}
				f = 0
				if ( iEquip(ci) != 0 ) {
					if ( rnd(10) ) {
						f = 1
					}
					if ( iStatus(ci) >= ITEM_STATUS_BLESSED ) {
						if ( rnd(2) ) {
							f = 1
						}
					}
					if ( iStatus(ci) <= ITEM_STATUS_CURSED ) {
						if ( rnd(2) ) {
							f = 0
						}
					}
					if ( iStatus(ci) <= ITEM_STATUS_DOOMED ) {
						if ( rnd(2) ) {
							f = 0
						}
					}
				}
				else {
					if ( iKnown(ci) >= ITEM_KNOWN_FULL ) {
						if ( rnd(4) ) {
							f = 1
						}
					}
				}
				if ( f == 0 ) {
					if ( nc_intb_nightmare == 0 ) {
						if ( iStatus(ci) >= ITEM_STATUS_BLESSED ) {
							txtef COLOR_GREEN
							txt -1, lang(itemname(ci, 1) + "にかけられた祝福が消失を防いだ。", "The blessing on" + itemname(ci, 1) + "prevented the disappearance.")
							iStatus(ci) = ITEM_STATUS_NORMAL
							f = 1
						}
					}
				}
				if ( f ) {
					continue
				}
				if ( iEquip(ci) != 0 ) {
					cdata(iEquip(ci), rc) = cdata(iEquip(ci), rc) / EXT_EQUIP_SLOTS * 10000
					iEquip(ci) = 0
				}
				f = 0
				if ( ibit(ITEM_BIT_PRECIOUS, ci) == FALSE ) {
					if ( rnd(4) == 0 ) {
						f = 1
					}
					if ( iStatus(ci) >= ITEM_STATUS_BLESSED ) {
						if ( rnd(3) == 0 ) {
							f = 0
						}
					}
					if ( iStatus(ci) <= ITEM_STATUS_CURSED ) {
						if ( rnd(3) == 0 ) {
							f = 1
						}
					}
					if ( iStatus(ci) <= ITEM_STATUS_DOOMED ) {
						if ( rnd(3) == 0 ) {
							f = 1
						}
					}
				}
				if ( f ) {
					iNum(ci) = 0
					continue
				}
				iX(ci) = cX(rc)
				iY(ci) = cY(rc)
				item_stack -1, ci
				if ( stat == 0 ) {
					ti = inv_getfreeid(-1)
					if ( ti == (-1) ) {
						break
					}
					item_copy ci, ti
					iProperty(ti) = PROP_INHERITED
				}
				iNum(ci) = 0
			loop
		}
		if ( rnd(2) == 0 ) {
			itemcreate -1, ITEM_ID_CORPSE, cX(rc), cY(rc), 0
			if ( stat != 0 ) {
				ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
			}
		}
		cell_refresh cX(rc), cY(rc)
		create_pcpic 0, 1
		return
	}
	else {
		if ( rc < MAX_CHARA_FOLLOWER ) {
			if ( cbit(CHARA_BIT_PCC, rc) == TRUE ) {
				create_pcpic rc, 1
			}
		}
		if ( cRelation(rc) == RELATION_ALLY ) {
			return
		}
	}
	if ( gArea  == AREA_NOYEL ) {
		if ( cId(rc) == CREATURE_ID_TOURIST ) {
			return
		}
		if ( cId(rc) == CREATURE_ID_PALMIAN_ELITE_SOLDIER ) {
			return
		}
	}
	if ( cbit(CHARA_BIT_HIRED, rc) ) {
		return
	}
	if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, rc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, rc) ) {
		if ( rnd(6) ) {
			return
		}
	}
	if ( cRole(rc) == ROLE_PET_SENTRY | cRole(rc) == ROLE_PET_MAID | eqfaction(rc, "petshop") ) {
		return
	}
	inv_getheader rc
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		ci = cnt
		f = 0
		if ( cRole(rc) == ROLE_USER ) {
			break
		}
		if ( iQuality(ci) > FIX_QUALITY_MIRACLE | iID(ci) == ITEM_ID_PLATINUM_COIN ) {
			f = 1
		}
		if ( rnd(30) == 0 ) {
			f = 1
		}
		if ( cQuality(rc) >= FIX_QUALITY_MIRACLE ) {
			if ( rnd(2) == 0 ) {
				f = 1
			}
		}
		if ( cRole(rc) == ROLE_ADVENTURER ) {
			if ( rnd(5) ) {
				f = 0
			}
		}
		if ( gArea  == AREA_ARENA ) {
			if ( rnd(4) ) {
				f = 0
			}
		}
		if ( iQuality(ci) == FIX_QUALITY_UNIQUE ) {
			f = 1
		}
		if ( ibit(ITEM_BIT_DROP, ci) ) {
			f = 1
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			ibitmod ITEM_BIT_DROP, ci, FALSE
		}
		if ( f == 0 ) {
			continue
		}
		if ( catitem != 0 ) {
			if ( ibit(ITEM_BIT_REMAKE, ci) == FALSE ) {
				if ( refitem(iID(ci), DBSPEC_TYPE, ci) < FILTER_ITEM_MIN ) {
					if ( iQuality(ci) >= FIX_QUALITY_GREAT ) {
						if ( rnd(3) ) {
							txtef COLOR_SKY_BLUE
							txt -1, lang(name(catitem) + "は" + itemname(ci) + "をぺろぺろと舐めた。", name(catitem) + " licks " + itemname(ci) + ".")
							ibitmod ITEM_BIT_REMAKE, ci, TRUE
							reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
							encadd ci, randomenc(randomenclv(rnd(4))), randomencp()
							animeload 8, rc
						}
					}
				}
			}
		}
		if ( iEquip(ci) != 0 ) {
			cdata(iEquip(ci), rc) = cdata(iEquip(ci), rc) / EXT_EQUIP_SLOTS * 10000
			iEquip(ci) = 0
		}
		iX(ci) = cX(rc)
		iY(ci) = cY(rc)
		itemturn ci
		item_stack -1, ci
		if ( stat == 0 ) {
			ti = inv_getfreeid(-1)
			if ( ti == (-1) ) {
				break
			}
			item_copy ci, ti
		}
		iNum(ci) = 0
	loop
	if ( cQuality(rc) >= FIX_QUALITY_MIRACLE | rnd(20) == 0 | cbit(CHARA_BIT_DROP_GOLD, rc) == TRUE | petcheck(rc) ) {
		if ( cGold(rc) > 0 ) {
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cX(rc), cY(rc), cGold(rc) / (1 + 3 * (cbit(CHARA_BIT_DROP_GOLD, rc) == FALSE))
			cGold(rc) -= cGold(rc) / (1 + 3 * (cbit(CHARA_BIT_DROP_GOLD, rc) == FALSE))
		}
	}
	if ( areaId(gArea ) == AREA_DUNGEON & cRole(rc) != ROLE_NONE ) {
		cell_refresh cX(rc), cY(rc)
		return
	}
	_switch_val = refclass(rc, DBSPEC_CLASS_EQUIP_TYPE)
	if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, rc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, rc) ) {
		goto *label_1812
	}
	if ( _switch_val == 1 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_POTION
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1812
		_switch_sw++
	}
	if ( _switch_val == 7 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_POTION
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1812
		_switch_sw++
	}
	if ( _switch_val == 3 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_POTION
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1812
		_switch_sw++
	}
	if ( _switch_val == 2 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SCROLL
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(40) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SPELLBOOK
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1812
		_switch_sw++
	}
	if ( _switch_val == 4 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_POTION
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1812
		_switch_sw++
	}
	if ( _switch_val == 5 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(50) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SPELLBOOK
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1812
	}

*label_1812
	_switch_val = refchara(cId(rc), DBSPEC_CHARA_LOOT)
	if ( _switch_val == 3 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(40) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_POTION
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(40) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SCROLL
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(40) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(40) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetweapon(rnd(length(fsetweapon)))
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_GOLD
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1813
		_switch_sw++
	}
	if ( _switch_val == 1 | _switch_sw ) {
		_switch_sw = 0
		if ( cId(rc) != CREATURE_ID_BUG ) {
			if ( rnd(20) == 0 ) {
				p = 0
				flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
				flttypemajor = FILTER_REMAINS
				flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
				itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
				remain_make ci, rc
			}
		}
		goto *label_1813
		_switch_sw++
	}
	if ( _switch_val == 2 | _switch_sw ) {
		_switch_sw = 0
		if ( cId(rc) != CREATURE_ID_BUG ) {
			if ( rnd(20) == 0 ) {
				p = 0
				flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
				flttypemajor = FILTER_REMAINS
				flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
				itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
				remain_make ci, rc
			}
		}
		goto *label_1813
		_switch_sw++
	}
	if ( _switch_val == 6 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(10) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ACCESSORY_RING
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(10) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ACCESSORY_AMULET
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SPELLBOOK
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(10) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_POTION
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(10) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SCROLL
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_CONTAINER
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(10) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_GOLD
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(10) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ORE
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1813
		_switch_sw++
	}
	if ( _switch_val == 4 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(5) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(5) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetweapon(rnd(length(fsetweapon)))
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(20) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_CONTAINER
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(4) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_GOLD
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1813
		_switch_sw++
	}
	if ( _switch_val == 5 | _switch_sw ) {
		_switch_sw = 0
		if ( rnd(5) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(5) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetweapon(rnd(length(fsetweapon)))
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(15) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SPELLBOOK
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(5) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_POTION
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(5) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ITEM_SCROLL
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(10) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_CONTAINER
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(4) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_GOLD
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		if ( rnd(4) == 0 ) {
			p = 0
			flt calcobjlv(cLevel(tc)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = FILTER_ORE
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		}
		goto *label_1813
	}

*label_1813
	if ( ocbit(7, rc) ) {
		cell_refresh cX(rc), cY(rc)
		return
	}
	if ( gettrait(0, 194) < 0 ) {
		if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, rc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, rc) ) {
			nodropbodyparts = 2
		}
	}
	if ( cId(rc) != CREATURE_ID_BUG ) {
		if ( rnd(20 - (ogTitleMadScientist == 2 | oabit(3, gArea ) == 1) * 5 - (cQuality(rc) >= FIX_QUALITY_MIRACLE) * 5) == 0 ) {
			if ( nodropbodyparts == 0 | gArea  != AREA_SHOW_HOUSE ) {
				if ( nodropbodyparts != 2 ) {
					p = 0
					flt calcobjlv(cLevel(rc)), calcfixlv(FIX_QUALITY_GOOD)
					flttypemajor = FILTER_REMAINS
					flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
					itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
					remain_make ci, rc
				}
			}
		}
	}
	if ( gArea  == AREA_SHOW_HOUSE ) {
		cell_refresh cX(rc), cY(rc)
		return
	}
	if ( gArea  != AREA_ARENA & cRole(rc) != ROLE_USER ) {
		if ( rnd(175) == 0 | cQuality(rc) == FIX_QUALITY_UNIQUE | (cQuality(rc) == FIX_QUALITY_MIRACLE & rnd(2) == 0) | (cQuality(rc) == FIX_QUALITY_GODLY & rnd(3) == 0) ) {
			if ( cId(rc) != CREATURE_ID_BUG ) {
				flt
				itemcreate -1, ITEM_ID_CARD, cX(rc), cY(rc), 0
				collection_make ci, rc
				cell_refresh iX(ci), iY(ci)
			}
		}
		if ( rnd(175) == 0 | cQuality(rc) == FIX_QUALITY_UNIQUE | (cQuality(rc) == FIX_QUALITY_MIRACLE & rnd(2) == 0) | (cQuality(rc) == FIX_QUALITY_GODLY & rnd(3) == 0) ) {
			if ( cId(rc) != CREATURE_ID_BUG ) {
				flt
				itemcreate -1, ITEM_ID_FIGURINE, cX(rc), cY(rc), 0
				collection_make ci, rc
				cell_refresh iX(ci), iY(ci)
			}
		}
	}
	if ( cRole(rc) == ROLE_SHOP_WANDER ) {
		flt
		itemcreate -1, ITEM_ID_SHOPKEEPERS_TRUNK, cX(rc), cY(rc), 0
		iParam1(ci) = cRoleFileId(rc)
		iProperty(ci) = PROP_SHOP
	}
	if ( gettrait(0, 194) < 0 ) {
		if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, rc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, rc) ) {
			nodropbodyparts = 2
		}
	}
	if ( rollanatomy == 1 | cQuality(rc) >= FIX_QUALITY_MIRACLE | cbit(CHARA_BIT_LIVESTOCK, rc) == TRUE | 0 ) {
		if ( (cId(rc) == CREATURE_ID_LITTLE_SISTER & (cRole(rc) == ROLE_ADVENTURER | ocbit(7, rc))) == 0 ) {
			if ( nodropbodyparts != 2 ) {
				flt
				itemcreate -1, ITEM_ID_CORPSE, cX(rc), cY(rc), 0
				if ( stat != 0 ) {
					remain_make ci, rc
					if ( cbit(CHARA_BIT_LIVESTOCK, rc) == TRUE ) {
						if ( sAnatomy(CHARA_PLAYER) != 0 ) {
							iNum(ci) += rnd(1 + (sAnatomy(CHARA_PLAYER) > cLevel(rc)))
						}
						if ( godcheck() == "dybony" ) {
							iNum(ci) += 1
						}
					}
				}
			}
		}
	}
	lootrich = -1
	if ( cId(rc) == CREATURE_ID_RICH_PERSON ) {
		lootrich = 8
	}
	if ( cId(rc) == CREATURE_ID_NOBLE_CHILD ) {
		lootrich = 4
	}
	if ( cId(rc) == CREATURE_ID_TOURIST ) {
		lootrich = 2
	}
	if ( lootrich != (-1) ) {
		repeat lootrich
			flt calcobjlv(cLevel(rc))
			flttypeminor = FILTER_ORE_GEM
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
		loop
		if ( rnd(3) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_WALLET, cX(rc), cY(rc), 0
		}
	}
	drop = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
	if ( cId(rc) == CREATURE_ID_VESDA_THE_FIRE_DRAGON ) {
		if ( gArea  == AREA_DRAGON_NEST | gArea  == AREA_VOID | gArea  == 210 ) {
			drop = 355, -1
		}
	}
	if ( cId(rc) == CREATURE_ID_FRISIA_THE_CAT_QUEEN | cId(rc) == CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN | cId(rc) == CREATURE_ID_AZZRSSIL_THE_IMPURE ) {
		if ( npcmemory(0, cId(rc)) == 1 ) {
			drop = 290, 421, -1
		}
		else {
			drop = 421, 421, -1
		}
	}
	if ( gArea  == AREA_PYRAMID ) {
		if ( cId(rc) == CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID ) {
			drop = 665, 55, 55, 55, 55, 621, -1
		}
	}
	repeat 10
		if ( drop(cnt) == (-1) ) {
			break
		}
		flt
		itemcreate -1, drop(cnt), cX(rc), cY(rc), 0
	loop
	if ( cId(rc) == CREATURE_ID_WILD_RABBIT ) {
		if ( rnd(200) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_RABBITS_TAIL, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_ZOMBIE ) {
		if ( cQuality(rc) != FIX_QUALITY_BAD ) {
			if ( rnd(100) == 0 ) {
				flt
				itemcreate -1, ITEM_ID_POTION_DESCENT, cX(rc), cY(rc), 0
			}
		}
	}
	if ( cId(rc) == CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE ) {
		if ( rnd(4) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_SECRET_EXP_LOMIAS, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_LESSER_MUMMY | cId(rc) == CREATURE_ID_MUMMY | cId(rc) == CREATURE_ID_GREATER_MUMMY ) {
		if ( rnd(300) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_BOOK_RESURRECTION, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_CUPID_OF_LOVE ) {
		if ( rnd(140) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_HAPPY_BED, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_HERMIT_CRAB ) {
		if ( rnd(100) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_UNKNOWN_SHELL, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) >= CREATURE_ID_ROGUE_BOSS & cId(rc) <= CREATURE_ID_ROGUE_WIZARD ) {
		if ( rnd(90) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_BLUE_CAPSULE_DRAG, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_EXECUTIONER | cId(rc) == CREATURE_ID_MESSENGER_OF_DEATH ) {
		if ( rnd(150) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_SCROLL_CONTINGENCY, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_DEFORMED_EYE | cId(rc) == CREATURE_ID_IMPURE_EYE ) {
		if ( rnd(150) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_POTION_EVOLUTION, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_GWEN_THE_INNOCENT ) {
		if ( rnd(50) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_SECRET_TREASURE, cX(rc), cY(rc), 0
			if ( stat != 0 ) {
				iParam1(ci) = 169
			}
		}
	}
	if ( cId(rc) == CREATURE_ID_FAIRY ) {
		if ( rnd(200) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_SECRET_EXP_KUMIROMI, cX(rc), cY(rc), 0
		}
		if ( eqfaction(rc, "lurgy") ) {
			flt
			itemcreate -1, ITEM_ID_RUGYS_HAMMER, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_SIN_THE_THIEF_GUILDMASTER ) {
		if ( rnd(50) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_BAG_OF_HOLDING, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_MINE_DOG ) {
		if ( rnd(3) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_MINE, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_IMP | cId(rc) == CREATURE_ID_NETHER_IMP | cId(rc) == CREATURE_ID_CHAOS_IMP ) {
		if ( rnd(600) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_SCROLL_NAME, cX(rc), cY(rc), 0
		}
	}
	if ( cId(rc) == CREATURE_ID_ROGUE_BOSS ) {
		repeat 2 + rnd(4)
			nostack = 1
			flt cLevel(rc), FIX_QUALITY_GOOD
			flttypemajor = FILTER_CARGO_TRADE
			itemcreate -1, ITEM_ID_DUMMY, cX(rc), cY(rc), 0
			if ( iValue(ci) < 800 ) {
				iNum(ci) = rnd(5) + 1
			}
		loop
	}
	if ( cId(rc) == CREATURE_ID_PLATINA_BELL ) {
		if ( gArea  == 210 ) {
			flt
			itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(rc), cY(rc), (gLevel  - 50 / 10) * 5 + 5
			flt
			itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(rc), cY(rc), (gLevel  - 50 / 10) * 5 + 5
		}
		else {
			flt
			itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(rc), cY(rc), 1 + rnd(3)
			if ( rnd(2) ) {
				flt
				itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(rc), cY(rc), 0
			}
		}
	}
	if ( cId(rc) == CREATURE_ID_GOLD_BELL ) {
		if ( gArea  == 210 ) {
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cX(rc), cY(rc), 2500 + rndex(cFame(CHARA_PLAYER) + 1000) * (gLevel  - 50 / 10 + 5)
		}
		else {
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cX(rc), cY(rc), 2500 + rndex(cFame(CHARA_PLAYER) + 1000)
		}
	}
	if ( cId(rc) == CREATURE_ID_THE_LEOPARD_WARRIOR | cId(rc) == CREATURE_ID_SILVIA_THE_PRINCESS ) {
		repeat 12
			flt
			nostack = 1
			itemcreate -1, ITEM_ID_TOMATO, cX(rc), cY(rc), 0
			if ( rnd(2) ) {
				if ( stat != 0 ) {
					iParam3(ci) = -1
					iPic(ci) = xy2pic(6, 10)
				}
			}
		loop
	}
	if ( eqfaction(rc, "overwish") ) {
		ncgTotalTowKilled++
		flt
		itemcreate -1, ITEM_ID_SCROLL_OF_SILVER_MAGIC, cX(rc), cY(rc), 0
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == rc ) {
				continue
			}
			if ( eqfaction(cnt, "overwish") ) {
				continue
			}
			nc_intb_001 = cnt
			repeat 16
				if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, nc_intb_001) == 0 ) {
					break
				}
				delbuff nc_intb_001, cnt
				continue cnt
			loop
		loop
	}
	if ( eqfaction(rc, "ncdungeon") ) {
		if ( rnd(20) == 0 ) {
			flt
			itemcreate -1, ITEM_ID_FEAPPLE, cX(rc), cY(rc), 0
		}
	}
	if ( eqfaction(rc, "st_ruinboss") ) {
		flt
		itemcreate -1, ITEM_ID_ROD_DOMINATION, cX(rc), cY(rc), 0
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 4
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(rc), cY(rc), 5
	}
	if ( eqfaction(rc, "st_ruralboss") ) {
		flt
		itemcreate -1, ITEM_ID_RABBITS_TAIL, cX(rc), cY(rc), 0
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(rc), cY(rc), 3
	}
	if ( eqfaction(rc, "st_feaboss") ) {
		flt
		itemcreate -1, ITEM_ID_ROD_WISHING, cX(rc), cY(rc), 0
		flt
		itemcreate -1, ITEM_ID_SECRET_EXP_KUMIROMI, cX(rc), cY(rc), 3
	}
	if ( eqfaction(rc, "st_caveboss") ) {
		flt
		itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(rc), cY(rc), 5
		flt
		itemcreate -1, ITEM_ID_HERO_CHEESE, cX(rc), cY(rc)
		flt
		itemcreate -1, ITEM_ID_MAGIC_FRUIT, cX(rc), cY(rc)
	}
	cell_refresh cX(rc), cY(rc)
	if ( cRole(rc) == ROLE_ADVENTURER ) {
		gosub *supplyEquip
	}
	return

*item_rot
	i = getgametime()
	repeat 245 + 1
		if ( cnt == 245 ) {
			p = -1
		}
		else {
			p = cnt
			if ( cExist(p) == CHAR_STATE_DEAD ) {
				continue
			}
		}
		inv_getheader p
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iMaterial(cnt) == ITEM_MATERIAL_RAW & refitem(iID(cnt), DBSPEC_TYPE, cnt) == FILTER_ITEM_FOOD ) {
				if ( iParam3(cnt) > 0 ) {
					if ( iParam3(cnt) <= i ) {
						if ( iProperty(cnt) <= PROP_NONE ) {
							if ( p == (-1) ) {
								if ( iID(cnt) == ITEM_ID_CORPSE ) {
									if ( chipm(CHIPM_ROLE, mapId(iX(cnt), iY(cnt))) == MAP_CHIP_ROLE_DRYROCK ) {
										if ( gWeather != WEATHER_CLEAR ) {
											continue
										}
										txt -1, lang(itemname(cnt) + "は上手い具合に干された。", itemname(cnt) + is2(iNum(cnt)) + " dried up in the sun.")
										iParam3(cnt) = getgametime() + 2160
										iPic(cnt) = xy2pic(7, 10)
										iID(cnt) = ITEM_ID_JERKY
										iParam1(cnt) = 0
										iParam2(cnt) = 5
										cell_refresh iX(cnt), iY(cnt)
										continue
									}
								}
							}
							if ( p != (-1) ) {
								if ( p < 16 | cRole(p) == ROLE_PET_SENTRY | cRole(p) == ROLE_PET_MAID | eqfaction(p, "petshop") ) {
									txt -1, lang(itemname(cnt) + "は腐った。", itemname(cnt) + " rot" + _s2(iNum(cnt)) + ".")
								}
							}
							iParam3(cnt) = -1
							iPic(cnt) = xy2pic(6, 10)
							if ( p == (-1) ) {
								cell_refresh iX(cnt), iY(cnt)
							}
							if ( p == 0 ) {
								if ( godcheck() == "kumiromi" ) {
									i = refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt)
									txt -1, lang("あなたは" + itemname(cnt) + "から種を取り出した。", "You extract plant seeds from " + itemname(cnt) + ".")
									seedratio = limit(cPiety(CHARA_PLAYER) / 500, 0, 50)
									if ( sorgex(181, 0) >= 1000 ) {
										seedratio += limit((cPiety(CHARA_PLAYER) - 100000) / 1000, 0, 50)
									}
									locvar_convertartifact_seedbonus = iNum(cnt) * seedratio / 100
									p = rndex2(iNum(cnt) - locvar_convertartifact_seedbonus + 1)
									p += locvar_convertartifact_seedbonus
									removeitem cnt, iNum(cnt)
									flt calcobjlv(difficulty())
									flttypeminor = FILTER_ITEM_SEED
									itemcreate CHARA_PLAYER, ITEM_ID_DUMMY, -1, -1, p
									p = 0
									i = getgametime()
								}
							}
						}
					}
				}
			}
		loop
	loop
	return

*curse
	if ( have_bigench(cc, 16) ) {
		if ( have_bigench2(cc, 16) > rnd(100) ) {
			txt 0, lang("" + name(cc) + "の呪いの影響は軽減された。", "" + name(cc) + "avoided the curse.")
			return
		}
	}
	if ( rnd(4) == 0 ) {
		if ( godcheck(cc) == "fuuri" ) {
			if ( rnd(2) == 0 ) {
				if ( rnd(13) == 0 ) {
					dmghp cc, cMHP(cc) * (5 + cCurse(cc) / 8) / 100, DAMAGE_FROM_CURSE
				}
				else {
					dmghp cc, cHP(cc) * (5 + cCurse(cc) / 8) / 100 / (rnd(4) + 1), DAMAGE_FROM_CURSE
				}
			}
		}
		else {
			dmghp cc, cHP(cc) * (5 + cCurse(cc) / 5) / 100, DAMAGE_FROM_CURSE
		}
		return
	}
	if ( mType != MAP_TYPE_WORLD ) {
		if ( rnd(10 - limit(cCurse(cc) / 10, 0, 9)) == 0 ) {
			if ( godcheck(cc) == "fuuri" ) {
				if ( rnd(20) == 0 ) {
					txt -1, lang("呪いの神が" + name(cc) + "をテレポートから守った。", "God of curse protects " + name(cc) + " from teleporting.")
				}
				return
			}
			else {
				efid = SKILL_SPELL_TELEPORT
				tc = cc
				rndtelepo = 1
				gosub *label_3383
				rndtelepo = 0
				return
			}
		}
	}
	if ( rnd(10) == 0 ) {
		if ( godcheck(cc) == "fuuri" ) {
			if ( rnd(10) == 0 ) {
				txt -1, lang("呪いの神が" + name(cc) + "の財布を守った。", "God of curse protects " + name(cc) + " from being stolen.")
			}
			return
		}
		else {
			if ( cGold(cc) > 0 ) {
				p = rndex(cGold(cc)) / 100 + rnd(10) + 1
				if ( p > cGold(cc) ) {
					p = cGold(cc)
				}
				cGold(cc) -= p
				if ( synccheck(cc, -1) ) {
					txtef COLOR_PURPLE
					txt -1, lang("悪意のある手が" + name(cc) + "の財布から金貨を抜き去った。", "A malicious hand filches some gold pieces from " + name(cc) + your(cc) + " wallet.")
				}
				return
			}
		}
	}
	return

*pregnant
	if ( rnd(15) == 0 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は不安げに腹を押さえた。", name(cc) + " pat" + _s(cc) + " " + his(cc) + " stomach uneasily.")
			txtef COLOR_SKY_BLUE
			ctalk cc, 972, cc, cc
			if ( stat == 0 ) {
				txtef COLOR_SKY_BLUE
				ctalk cc, 1202, cc, cc
				if ( stat == 0 ) {
					txt cc, lang("「なにかが産まれそうだよ！」", cnvtalk("I'm going to have a baby!")), lang("「腹になにかが…」", cnvtalk("Something is wrong with my stomach..."))
				}
			}
		}
	}
	if ( mType != MAP_TYPE_WORLD ) {
		if ( rnd(30) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang("何かが" + name(cc) + "の腹を破り飛び出した！", "Something splits " + name(cc) + your(cc) + " body and breaks out!")
			}
			txtef COLOR_SKY_BLUE
			ctalk cc, 971, cc, cc
			cBleed(cc) += 15
			flt
			initlv = cLevel(cc) / 2 + 1
			novoidlv = 1
			if ( rnd(20) == 0 ) {
				characreate -1, CREATURE_ID_YOUNGER_SISTER, cX(cc), cY(cc)
				if ( stat != 0 ) {
					cAge(rc) = gYear 
					if ( instr(cnName(cc), 0, lang("の子供", "child")) != (-1) ) {
						cnName(rc) = lang("妹の" + randomname(), randomname() + " the younger sister")
					}
					else {
						cnName(rc) = lang(cnName(cc) + "の子供", "child of " + cnName(cc))
					}
					cdata(CDATA_ELEMENT, rc) = SKILL_RESDMG_ACID * 100000 + 250
					if ( cc == CHARA_PLAYER | cId(cc) == CREATURE_ID_USER | cId(cc) == CREATURE_ID_BUG | cId(cc) == CREATURE_ID_PUTIT_TANK | cId(cc) == CREATURE_ID_ZILLA ) {
					}
					else {
						if ( rnd(5) == 0 ) {
							cAiCalm(rc) = cAiCalm(cc)
							cAiMoveFreq(rc) = cAiMoveFreq(cc)
							cAiDistance(rc) = cAiDistance(cc)
							cAiSub(rc) = limitmax(cAiSub(cc), 100)
							cActHeal(rc) = cActHeal(cc)
							cActIndex(rc) = cActIndex(cc)
							cdata(STARTING_CDATA_ACT_MAIN, rc) = cdata(STARTING_CDATA_ACT_MAIN, cc)
							cdata(216, rc) = cdata(216, cc)
							cdata(217, rc) = cdata(217, cc)
							cdata(218, rc) = cdata(218, cc)
							cdata(219, rc) = cdata(219, cc)
							cdata(STARTING_CDATA_ACT_SUB, rc) = cdata(STARTING_CDATA_ACT_SUB, cc)
							cdata(221, rc) = cdata(221, cc)
							cdata(222, rc) = cdata(222, cc)
							cdata(223, rc) = cdata(223, cc)
							cdata(224, rc) = cdata(224, cc)
							ocbitmod 0, rc, 1
						}
					}
				}
			}
			else {
				childid = ocAlienChildCreatureID(cc)
				if ( childid == 0 ) {
					childid = 330
				}
				if ( childid == 319 | childid == 368 ) {
					childid = 176
				}
				if ( childid == 343 ) {
					initunid = ocItemDV(cc)
				}
				if ( childid == (-1) ) {
					childid = cId(cc)
					if ( childid == 343 ) {
						initunid = cUNID(cc) + 1
					}
				}
				characreate -1, childid, cX(cc), cY(cc)
				if ( stat != 0 ) {
					cAge(rc) = gYear 
					ocbitmod 15, rc, 1
					if ( instr(cnName(cc), 0, lang("の子供", "child")) != (-1) ) {
						sreplace cnName(rc), cnName(cc), "の子供", "の子孫"
					}
					else {
						cnName(rc) = lang(cnName(cc) + "の子供", "child of " + cnName(cc))
					}
					if ( cc == CHARA_PLAYER | cId(cc) == CREATURE_ID_USER | cId(cc) == CREATURE_ID_BUG | cId(cc) == CREATURE_ID_PUTIT_TANK | cId(cc) == CREATURE_ID_ZILLA ) {
					}
					else {
						if ( rnd(5) == 0 ) {
							cAiCalm(rc) = cAiCalm(cc)
							cAiMoveFreq(rc) = cAiMoveFreq(cc)
							cAiDistance(rc) = cAiDistance(cc)
							cAiSub(rc) = limitmax(cAiSub(cc), 100)
							cActHeal(rc) = cActHeal(cc)
							cActIndex(rc) = cActIndex(cc)
							cdata(STARTING_CDATA_ACT_MAIN, rc) = cdata(STARTING_CDATA_ACT_MAIN, cc)
							cdata(216, rc) = cdata(216, cc)
							cdata(217, rc) = cdata(217, cc)
							cdata(218, rc) = cdata(218, cc)
							cdata(219, rc) = cdata(219, cc)
							cdata(STARTING_CDATA_ACT_SUB, rc) = cdata(STARTING_CDATA_ACT_SUB, cc)
							cdata(221, rc) = cdata(221, cc)
							cdata(222, rc) = cdata(222, cc)
							cdata(223, rc) = cdata(223, cc)
							cdata(224, rc) = cdata(224, cc)
							ocbitmod 0, rc, 1
						}
					}
				}
			}
		}
	}
	return

*curse_enc
	if ( getcgodno(cc) != (-1) ) {
		god_no = stat
		if ( usergoddata(32, god_no) / 1000 == 1 ) {
			rp2 = usergoddata(32, god_no) \ 1000
			if ( rp2 == 21 ) {
				if ( mType != MAP_TYPE_WORLD ) {
					if ( rnd(25) < limit(abs(convert_var(usergoddatan(27, god_no), 0, 0, cPiety(cc))) / 50, 1, 25) ) {
						efid = SKILL_SPELL_TELEPORT
						tc = cc
						rndtelepo = 1
						gosub *label_3383
						rndtelepo = 0
					}
				}
			}
			if ( rp2 == 45 ) {
				if ( rnd(4) == 0 ) {
					if ( synccheck(cc, -1) ) {
						txtef COLOR_PURPLE
						txt -1, lang("何かが" + name(cc) + "の血を吸った。", "Something sucks " + name(cc) + your(cc) + " blood.")
					}
					cBleed(cc) += abs(convert_var(usergoddatan(27, god_no), 0, 0, cPiety(cc))) / 25 + 3
				}
			}
			if ( rp2 == 46 ) {
				if ( rnd(20) == 0 ) {
					if ( synccheck(cc, -1) ) {
						txtef COLOR_PURPLE
						txt -1, lang(name(cc) + "は未熟になった。", name(cc) + " become" + _s(cc) + " inexperienced.")
					}
					cExp(cc) -= cExpToNext(cc) / (300 - limit(abs(convert_var(usergoddatan(27, god_no), 0, 0, cPiety(cc))) / 2, 0, 50)) + rnd(100)
					if ( cExp(cc) < 0 ) {
						cExp(cc) = 0
					}
				}
			}
			if ( rp2 == 47 ) {
				if ( mType != MAP_TYPE_WORLD ) {
					if ( mType != MAP_TYPE_HOME ) {
						if ( rnd(50) < limit(abs(convert_var(usergoddatan(27, god_no), 0, 0, cPiety(cc))) / 50, 1, 50) ) {
							if ( synccheck(cc, -1) ) {
								txtef COLOR_PURPLE
								txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
							}
							repeat 1 + rnd(3)
								flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
								characreate -1, CREATURE_ID_BUG, cX(cc), cY(cc)
							loop
						}
					}
				}
			}
		}
	}
	repeat 30, 100
		if ( cdata(cnt, cc) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		cibk_autoenc = cdata(cnt, cc) \ EXT_EQUIP_SLOTS - 1
		repeat 15
			ci = cibk_autoenc
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
				break
			}
			if ( findbuff(cc, 62) == (-1) | check_bigench(ci) == 3 ) {
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 21 ) {
					if ( mType != MAP_TYPE_WORLD ) {
						if ( rnd(25) < limit(abs(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci)) / 50, 1, 25) ) {
							efid = SKILL_SPELL_TELEPORT
							tc = cc
							rndtelepo = 1
							gosub *label_3383
							rndtelepo = 0
							continue
						}
					}
				}
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 45 ) {
					if ( rnd(4) == 0 ) {
						if ( synccheck(cc, -1) ) {
							txtef COLOR_PURPLE
							txt -1, lang("何かが" + name(cc) + "の血を吸った。", "Something sucks " + name(cc) + your(cc) + " blood.")
						}
						elep = abs(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci)) / 25 + 3
						cBleed(cc) += elep
						if ( ibit(ITEM_BIT_ALIVE, ci) ) {
							exp = rndex(cHP(cc) * (1 + elep / 4) / 100 + 3) + 1
							cw = ci
							gosub *label_4573
						}
						continue
					}
				}
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 46 ) {
					if ( rnd(20) == 0 ) {
						if ( synccheck(cc, -1) ) {
							txtef COLOR_PURPLE
							txt -1, lang(name(cc) + "は未熟になった。", name(cc) + " become" + _s(cc) + " inexperienced.")
						}
						cExp(cc) -= cExpToNext(cc) / (300 - limit(abs(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci)) / 2, 0, 50)) + rnd(100)
						if ( cExp(cc) < 0 ) {
							cExp(cc) = 0
						}
						continue
					}
				}
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 47 ) {
					if ( mType != MAP_TYPE_WORLD ) {
						if ( mType != MAP_TYPE_HOME ) {
							if ( rnd(50) < limit(abs(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci)) / 50, 1, 50) ) {
								if ( synccheck(cc, -1) ) {
									txtef COLOR_PURPLE
									txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
								}
								repeat 1 + rnd(3)
									flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
									characreate -1, CREATURE_ID_BUG, cX(cc), cY(cc)
								loop
								continue
							}
						}
					}
				}
			}
		loop
	loop
	return

*label_1830
	if ( cConfuse(cc) != 0 | cSleep(cc) != 0 | cParalyze(cc) != 0 | cMochi(cc) != 0 | cdata(268, cc) != 0 ) {
		return
	}
	inv_getheader cc
	repeat invrange, invhead
		if ( iNum(cnt) == 0 | iKnown(cnt) >= ITEM_KNOWN_FULL ) {
			continue
		}
		if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) >= FILTER_ITEM_MIN ) {
			continue
		}
		ci = cnt
		p = sPER(cc) + sSenseQuality(cc) * 5, 1500 + iIdtLevel(ci) * 5
		if ( p > rnd(p(1) * 5) ) {
			s = itemname(ci)
			item_identify ci, ITEM_KNOWN_FULL
			itemmemory(0, iID(ci)) = 1
			if ( cfg_hideautoidentify <= 1 ) {
				txt -1, lang(name2(cc) + "のバックパックの中の" + s + "は" + itemname(ci) + "だと判明した。", name2(cc) + " appraise" + _s(cc) + " " + s + " as " + itemname(ci) + ".")
			}
			skillexp2 SKILL_NORMAL_SENSE_QUALITY, cc, 50
		}
		if ( iKnown(ci) < ITEM_KNOWN_QUALITY ) {
			if ( p > rnd(p(1)) ) {
				if ( cfg_hideautoidentify == 0 ) {
					txt -1, lang(name2(cc) + "のバックパックの中の" + itemname(ci) + "は" + _quality(iQuality(ci)) + "だという感じがする。", name2(cc) + " sense" + _s(cc) + " the quality of " + itemname(ci) + " is " + _quality(iQuality(ci)) + ".")
				}
				item_identify ci, ITEM_KNOWN_QUALITY
				skillexp2 SKILL_NORMAL_SENSE_QUALITY, cc, 50
			}
		}
	loop
	return

*item_fix
	if ( reftype < FILTER_FURNITURE ) {
		if ( rnd(12) == 0 ) {
			iStatus(ci) = ITEM_STATUS_BLESSED
		}
		if ( rnd(13) == 0 ) {
			iStatus(ci) = ITEM_STATUS_CURSED
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) < FILTER_ITEM_MIN ) {
				if ( rnd(4) == 0 ) {
					iStatus(ci) = ITEM_STATUS_DOOMED
				}
			}
		}
	}
	if ( cm | mode == MODELIST_CHARA_CREATION | iQuality(ci) == FIX_QUALITY_UNIQUE ) {
		iStatus(ci) = ITEM_STATUS_NORMAL
	}
	if ( reftype < FILTER_ITEM_MIN | (reftype == FILTER_FURNITURE & rnd(5) == 0) ) {
		if ( iMaterial(ci) >= ITEM_MATERIAL_TYPE_METAL | reftype == FILTER_FURNITURE ) {
			gosub *item_material
		}
		else {
			gosub *apply_materialEnc
		}
	}
	if ( fixeditemenc != 0 ) {
		repeat 10
			if ( fixeditemenc(cnt * 2) == 0 ) {
				break
			}
			encadd ci, fixeditemenc(cnt * 2), fixeditemenc(cnt * 2 + 1), 0, 0, 0, 1
		loop
	}
	if ( reftype < FILTER_ITEM_POTION ) {
		gosub *item_enc
		gosub *label_4610
	}
	else {
		if ( iQuality(ci) != FIX_QUALITY_UNIQUE ) {
			iQuality(ci) = FIX_QUALITY_GOOD
		}
	}
	return

*item_init
	if ( val == 0 | val == (-1) & mode != MODELIST_QUEST_CHAT ) {
		if ( sLUC(CHARA_PLAYER) > rnd(5000) ) {
			if ( fixlv < FIX_QUALITY_GODLY ) {
				fixlv++
			}
		}
	}
	if ( val == 5480 ) {
		ci = val
	}
	else {
		ci = inv_getfreeid(val)
		if ( ci == (-1) ) {
			return 0
		}
	}
	item_delete ci
	if ( val == (-1) & mode != MODELIST_SHOP & mode != MODELIST_TXT_ADV ) {
		p = 0
		repeat 100
			if ( val(1) == (-1) ) {
				sx = rnd(mWidth - 2) + 2
				sy = rnd(mHeight - 2) + 2
				if ( mapItems(sx, sy) != 0 ) {
					continue
				}
			}
			else {
				if ( cnt == 0 ) {
					sx = val(1)
					sy = val(2)
				}
				else {
					sx = val(1) + rnd(cnt + 1) - rnd(cnt + 1)
					sy = val(2) + rnd(cnt + 1) - rnd(cnt + 1)
				}
				if ( sx < 0 | sy < 0 | sx > mWidth - 1 | sy > mHeight - 1 ) {
					continue
				}
			}
			if ( val(1) != (-1) ) {
				if ( cnt == 0 ) {
					p = 1
					iX(ci) = sx
					iY(ci) = sy
					break
				}
			}
			if ( mapFeat(sx, sy) != 0 ) {
				if ( mapFeat(sx, sy) / 1000 \ 100 == 22 | mapFeat(sx, sy) / 1000 \ 100 == 20 | mapFeat(sx, sy) / 1000 \ 100 == 21 ) {
					continue
				}
			}
			if ( (chipm(CHIPM_ATTRIB, mapId(sx, sy)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
				p = 1
				iX(ci) = sx
				iY(ci) = sy
				break
			}
		loop
		if ( p == 0 ) {
			return 0
		}
	}
	if ( dbid == (-1) ) {
		if ( fltselect == 0 ) {
			if ( mode != MODELIST_SHOP & mode != MODELIST_QUEST_CHAT ) {
				if ( fixlv == FIX_QUALITY_GREAT ) {
					if ( rnd(1000) == 0 ) {
						fltselect = 2
					}
				}
				if ( fixlv == FIX_QUALITY_MIRACLE ) {
					if ( rnd(100) == 0 ) {
						fltselect = 2
					}
				}
			}
		}
		dbmode = DBMODE_FIND
		gosub *db_item
		if ( dbid == 25 ) {
			if ( fltselect == 2 ) {
				fixlv = FIX_QUALITY_MIRACLE
			}
			objlv += 10
			fltselect = 0
			dbmode = DBMODE_FIND
			gosub *db_item
		}
	}
	else {
		if ( dbid == 743 ) {
			if ( useritemmax > 0 ) {
				iCItemIdx(ci) = rnd(useritemmax)
			}
		}
	}
	if ( dbid == 25 ) {
		if ( flttypemajor == FILTER_FURNITURE_ALTAR ) {
			dbid = 501
		}
	}
	itemcreatehack = dbid + 1
	if ( characreatehack > 0 ) {
		if ( noencpfix == 0 ) {
			encpfix = 1
		}
	}
	if ( dbid == 743 ) {
		gosub *label_4278
	}
	else {
		dbmode = DBMODE_SET
		gosub *db_item
		dbmode = DBMODE_REF
		gosub *db_item
		iCol(ci) = icolref(iID(ci))
	}
	if ( iCol(ci) == 1 ) {
		iCol(ci) = randcolor(rnd(length(randcolor)))
	}
	if ( iID(ci) == ITEM_ID_BOTTLE_DYE ) {
		iCol(ci) = rnd(21)
	}
	if ( iID(ci) == ITEM_ID_RED_BOOK ) {
		if ( iParam1(ci) == 0 ) {
			iParam1(ci) = isetbook(rnd(length(isetbook)))
		}
	}
	if ( iID(ci) == ITEM_ID_SKILLBOOK ) {
		if ( iParam1(ci) == 0 ) {
			iParam1(ci) = randskill()
		}
	}
	if ( iID(ci) == ITEM_ID_RECIPE ) {
		iSubName(ci) = rpsourcelist(rnd(length(rpsourcelist)))
		iParam1(ci) = 1
	}
	itemmemory(1, dbid)++
	iQuality(ci) = fixlv
	if ( fixlv == FIX_QUALITY_UNIQUE ) {
		if ( mode != MODELIST_SHOP ) {
			if ( nooracle == 0 ) {
				procid = (procid + 1) \ 10
				proclist(procid) = "oracle" + " ct:" + ct
				if ( dbg_outputdebuglog ) {
				}
				ii_p = inv_getowner(ci)
				if ( ii_p != (-1) ) {
					if ( cRole(ii_p) == ROLE_ADVENTURER ) {
						artifactlocation += lang(iknownnamecnv(ci) + "は" + gYear  + "年" + gMonth  + "月に" + mapname(cType(ii_p)) + "の" + cnName(ii_p) + "の手に渡った。\n", cnven(iknownnameref(iID(ci))) + " was held by " + cnName(ii_p) + " at " + mapname(cType(ii_p)) + " in " + gDay  + "/" + gMonth  + ", " + gYear  + ". ")
					}
					else {
						ii_p = -1
					}
				}
				if ( ii_p == (-1) ) {
					artifactlocation += lang(iknownnamecnv(ci) + "は" + gYear  + "年" + gMonth  + "月に" + mdatan(0) + "で生成された。\n", cnven(iknownnameref(iID(ci))) + " was created at " + mdatan(0) + " in " + gDay  + "/" + gMonth  + ", " + gYear  + ". ")
				}
			}
		}
	}
	if ( iID(ci) == ITEM_ID_BAIT ) {
		iParam1(ci) = rnd(6)
		iPic(ci) = 385 + iParam1(ci)
		iValue(ci) = iParam1(ci) * iParam1(ci) * 500 + 200
	}
	if ( iID(ci) == ITEM_ID_DEED ) {
		iParam1(ci) = rnd(5) + 1
		if ( mode != MODELIST_SHOP ) {
			iParam1(ci) = 2
		}
		iSubName(ci) = iParam1(ci)
		iValue(ci) = 5000 + 4500 * iParam1(ci) * iParam1(ci) * iParam1(ci) + iParam1(ci) * 20000
		if ( iParam1(ci) == 5 ) {
			iValue(ci) *= 2
		}
	}
	if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
		iNum(ci) = calcinitgold(val)
		if ( iQuality(ci) == FIX_QUALITY_GREAT ) {
			iNum(ci) = iNum(ci) * 2
		}
		if ( iQuality(ci) >= FIX_QUALITY_MIRACLE ) {
			iNum(ci) = iNum(ci) * 4
		}
		if ( val >= 0 ) {
			se_moneymod val, iNum(ci)
			iNum(ci) = 0
			return 1
		}
	}
	if ( iID(ci) == ITEM_ID_GIFT ) {
		iParam4(ci) = rnd(rnd(rnd(length(giftvalue)) + 1) + 1)
		iValue(ci) = iParam4(ci) * 2500 + 500
	}
	if ( iID(ci) == ITEM_ID_KITTY_BANK ) {
		iParam2(ci) = rnd(length(moneybox) - 1)
		if ( ogTitleGanesa == 2 ) {
			iParam2(ci) = rnd(length(moneybox))
		}
		if ( iParam2(ci) != 2147483647 ) {
			iValue(ci) = iParam2(ci) * iParam2(ci) * iParam2(ci) * 1000 + 1000
		}
		else {
			iValue(ci) = 2000000000
		}
	}
	if ( iID(ci) == ITEM_ID_MONSTER_BALL ) {
		iParam2(ci) = rndex2(objlv + 1) + 1
		iValue(ci) = 2000 + iParam2(ci) * iParam2(ci) + iParam2(ci) * 100
	}
	if ( iID(ci) == ITEM_ID_MATERIAL_KIT ) {
		gosub *label_0998
		gosub *apply_material
	}
	if ( iID(ci) == ITEM_ID_ANCIENT_BOOK ) {
		iParam1(ci) = rnd(rnd(limit(objlv / 2, 1, 15)) + 1)
	}
	if ( iID(ci) == ITEM_ID_SISTERS_LOVE_FUELED_LUNCH ) {
		ibitmod ITEM_BIT_HANDMADE, ci, TRUE
	}
	if ( iID(ci) == ITEM_ID_COOLER_BOX ) {
		gCountShop++
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = gCountShop
	}
	if ( iID(ci) == ITEM_ID_HEIR_TRUNK ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 3
	}
	if ( iID(ci) == ITEM_ID_SHOP_STRONGBOX ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 5
	}
	if ( iID(ci) == ITEM_ID_SALARY_CHEST ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 4
	}
	if ( iID(ci) == ITEM_ID_FREEZER ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 6
	}
	if ( iID(ci) == ITEM_ID_STORAGE ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 10
	}
	if ( iID(ci) == ITEM_ID_TRASH_CAN ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 17
		iEffect(ci) = 1503
	}
	if ( iID(ci) == ITEM_ID_BROOM ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 17
		iEffect(ci) = 1504
	}
	if ( iID(ci) == ITEM_ID_PET_PHONE ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 17
		iEffect(ci) = 1505
	}
	if ( iID(ci) == ITEM_ID_GAROKS_HAMMER ) {
		iSubName(ci) = 40000 + rnd(30000)
		p = rnd(rnd(rnd(10) + 1) + 3) + 5
		egolv = rnd(limit(rnd(30 / 10 + 3), 0, 4) + 1)
		if ( rnd(10) == 0 ) {
			encadd ci, randomenc(99, 9), randomencp(), , , , 1
		}
		repeat p
			encadd ci, randomenc(randomenclv(egolv), twochoice(-1, 9)), randomencp(), 20, , , 1
		loop
	}
	if ( equalsitem(ci, "blacksmith hammer") ) {
		iParam1(ci) = 1
	}
	if ( reftype == FILTER_CONTAINER ) {
		iParam1(ci) = gLevel  * (gArea  != AREA_SHELTER) + 5
		if ( iID(ci) == ITEM_ID_SUITCASE ) {
			iParam1(ci) = (rnd(10) + 1) * (difficulty() / 10 + 1)
		}
		if ( iID(ci) == ITEM_ID_TREASURE_BALL | iID(ci) == ITEM_ID_RARE_TREASURE_BALL ) {
			iParam1(ci) = difficulty()
		}
		iParam2(ci) = rnd(abs(gLevel ) * (gArea  != AREA_SHELTER) + 1)
		if ( iID(ci) == ITEM_ID_WALLET | iID(ci) == ITEM_ID_SUITCASE ) {
			iParam2(ci) = rnd(15)
		}
		iParam3(ci) = rnd(30000)
		if ( iID(ci) == ITEM_ID_SMALL_GAMBLE_CHEST ) {
			iParam2(ci) = rnd(rnd(100) + 1) + rnd(limit(fixrank / 4, 1, 2000)) + 1
			iValue(ci) = iParam2(ci) * 25 + 150
			initnum = rnd(8)
		}
	}
	if ( reftype == FILTER_ITEM_FOOD ) {
		if ( iParam1(ci) != 0 ) {
			if ( mode == MODELIST_SHOP ) {
				if ( rnd(2) == 0 ) {
					iParam2(ci) = 0
				}
				else {
					iParam2(ci) = 3 + rnd(3)
					iWeight(ci) = 500
				}
				if ( iParam2(ci) != 0 ) {
					if ( iParam2(ci) < 9 & rnd(16000 / limit(fixrank * lvup / 5, 1, 2000)) == 0 ) {
						iParam2(ci) = 9
					}
					else {
						if ( fixlv < 8 & rnd(8000 / limit(fixrank * lvup / 5, 1, 2000)) == 0 ) {
							iParam2(ci) = 8
						}
						else {
							if ( fixlv < 7 & rnd(4000 / limit(fixrank * lvup / 5, 1, 2000)) == 0 ) {
								iParam2(ci) = 7
							}
							else {
								if ( fixlv < FIX_QUALITY_UNIQUE & rnd(2000 / limit(fixrank * lvup / 5, 1, 1000)) == 0 ) {
									iParam2(ci) = 6
								}
								else {
									if ( fixlv < FIX_QUALITY_GODLY & rnd(1000 / limit(fixrank * lvup / 5, 1, 500)) == 0 ) {
										iParam2(ci) = 5
									}
									else {
										if ( fixlv < FIX_QUALITY_MIRACLE & rnd(500 / limit(fixrank * lvup / 5, 1, 250)) == 0 ) {
											iParam2(ci) = 4
										}
									}
								}
							}
						}
					}
				}
			}
			if ( iParam2(ci) != 0 ) {
				iPic(ci) = picfood(iParam2(ci), iParam1(ci) / 1000)
			}
			if ( iMaterial(ci) == ITEM_MATERIAL_RAW ) {
				iParam3(ci) += getgametime() + harvest * iParam3(ci)
			}
		}
	}
	gosub *item_fix
	if ( reftype == FILTER_FURNITURE ) {
		if ( rnd(3) == 0 ) {
			iSubName(ci) = rnd(rnd(12) + 1)
		}
		else {
			iSubName(ci) = 0
		}
		if ( reftypeminor == FILTER_FURNITURE_INSTRUMENT ) {
			if ( 9 <= iSubName(ci) ) {
				if ( rnd((12 - iSubName(ci)) * (12 - iSubName(ci))) == 0 ) {
					if ( encfindspec(ci, ENCHANT_REWARD_QUALITY) == (-1) ) {
						encadd ci, ENCHANT_REWARD_QUALITY, 100, 0, 1
					}
				}
			}
		}
		gosub *label_4707
	}
	if ( reftypeminor == FILTER_ORE_GEM | iID(ci) == ITEM_ID_GOLD_BAR ) {
		if ( rnd(2) == 0 ) {
			iSubName(ci) = 0
		}
		else {
			if ( objlv <= 50 ) {
				locvar_randskill_p = objlv / 25
			}
			else {
				locvar_randskill_p = int(10.0 / sqrt(1000) * sqrt(objlv))
			}
			iSubName(ci) = limit(locvar_randskill_p + rnd(1 + rnd(3)) + 1, 1, 11)
		}
	}
	if ( mode == MODELIST_SHOP ) {
		iKnown(ci) = ITEM_KNOWN_FULL
	}
	if ( reftype == FILTER_GOLD | reftype == FILTER_PLATINUM | iID(ci) == ITEM_ID_SMALL_MEDAL | iID(ci) == ITEM_ID_MUSIC_TICKET | iID(ci) == ITEM_ID_TOKEN_FRIENDSHIP | iID(ci) == ITEM_ID_BILL ) {
		iStatus(ci) = ITEM_STATUS_NORMAL
		iKnown(ci) = ITEM_KNOWN_FULL
	}
	if ( reftype == FILTER_CARGO_TRADE ) {
		iKnown(ci) = ITEM_KNOWN_FULL
		iStatus(ci) = ITEM_STATUS_NORMAL
		itemmemory(0, iID(ci)) = 1
	}
	if ( reftype == FILTER_REMAINS | reftype == FILTER_JUNK | reftype == FILTER_ORE ) {
		iStatus(ci) = ITEM_STATUS_NORMAL
	}
	if ( dbg_autoidentify ) {
		item_identify ci, dbg_autoidentify
	}
	else {
		if ( mode != MODELIST_SHOP ) {
			if ( reftype < FILTER_ITEM_MIN ) {
				if ( rnd(sSenseQuality(CHARA_PLAYER) + 1) > 5 ) {
					iKnown(ci) = ITEM_KNOWN_QUALITY
				}
			}
		}
	}
	gosub *label_1837
	itemturn ci
	if ( initnum != 0 ) {
		iNum(ci) = initnum
	}
	if ( nostack == 1 | ci == 5480 ) {
		nostack = 0
	}
	else {
		item_stack val, ci
		if ( stat == 1 ) {
			ci = ti
			return 1
		}
	}
	if ( val == (-1) ) {
		cell_refresh iX(ci), iY(ci)
	}
	return 1

*label_1837
	if ( reftype == FILTER_FURNITURE ) {
		if ( iSubName(ci) != 0 ) {
			iValue(ci) = iValue(ci) * (80 + iSubName(ci) * 20) / 100
		}
	}
	if ( reftype == FILTER_ORE ) {
		if ( iSubName(ci) != 0 ) {
			iValue(ci) = iValue(ci) * powf(iSubName(ci), 2)
		}
	}
	return

#deffunc lovemiracle int lovemiracle_arg1, int lovemiracle_prm1
	if ( rnd(2) | gArea  == 49 ) {
		return
	}
	cibk = ci
	if ( cfg_nc_aphrodisiac == 0 | f == 0 ) {
		txtef COLOR_SKY_BLUE
		ctalk lovemiracle_arg1, 994, lovemiracle_arg1, lovemiracle_arg1
		if ( stat == 0 ) {
			txtef COLOR_SKY_BLUE
			txt lovemiracle_arg1, lang("「あ…！」", cnvtalk("Uh...!"))
		}
	}
	flt
	if ( rnd(2) ) {
		itemcreate -1, ITEM_ID_EGG, cX(lovemiracle_arg1), cY(lovemiracle_arg1), 0
		if ( stat ) {
			if ( lovemiracle_arg1 == 0 ) {
				ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
			}
			else {
				iSubName(ci) = cId(lovemiracle_arg1)
				if ( iSubName(ci) == 343 ) {
					iCNpcId(ci) = cUNID(lovemiracle_arg1)
					ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(lovemiracle_arg1)))
				}
			}
			iWeight(ci) = cWeight(lovemiracle_arg1) * 10 + 250
			iValue(ci) = limit(cWeight(lovemiracle_arg1) * cWeight(lovemiracle_arg1) / 10000, 200, 40000)
			if ( cbit(CHARA_BIT_PREGNANT, lovemiracle_arg1) ) {
				if ( rnd(100) < 5 ) {
					childid = ocAlienChildCreatureID(lovemiracle_arg1)
					if ( childid == 0 ) {
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 330
					}
					if ( childid == 319 | childid == 368 ) {
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 176
					}
					if ( childid == 343 ) {
						iDV(ci) = ocItemDV(lovemiracle_arg1) - 1
					}
					if ( childid == (-1) ) {
						childid = cId(lovemiracle_arg1)
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = childid
						if ( childid == 343 ) {
							iDV(ci) = cUNID(lovemiracle_arg1) + 1
						}
					}
					else {
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = childid
					}
					iPV(ci) = limitmax(sCHR(lovemiracle_arg1) / 5 + cLevel(lovemiracle_arg1) / 5 + 1, 1000)
					iEffect(ci) = 53
					if ( cfg_nc_aphrodisiac == 0 | f == 0 ) {
						ctalk lovemiracle_arg1, 1220, lovemiracle_arg1, lovemiracle_arg1
					}
				}
			}
		}
		if ( cfg_nc_aphrodisiac == 0 | f == 0 ) {
			ctalk lovemiracle_arg1, 1215, lovemiracle_arg1, lovemiracle_arg1
		}
	}
	else {
		itemcreate -1, ITEM_ID_BOTTLE_MILK, cX(lovemiracle_arg1), cY(lovemiracle_arg1), 0
		if ( stat ) {
			if ( lovemiracle_arg1 == 0 ) {
				ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
			}
			else {
				iSubName(ci) = cId(lovemiracle_arg1)
				if ( iSubName(ci) == 343 ) {
					iCNpcId(ci) = cUNID(lovemiracle_arg1)
					ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(lovemiracle_arg1)))
				}
			}
			if ( iStatus(ci) == ITEM_STATUS_BLESSED ) {
				locvar_lovemiracle_s = godcheck(lovemiracle_arg1)
				if ( locvar_lovemiracle_s != "eyth" & locvar_lovemiracle_s != "elder brother" ) {
					iParam4(ci) = cGod(lovemiracle_arg1)
					if ( iParam4(ci) == 0 ) {
						iParam4(ci) = blesscgod(lovemiracle_arg1)
					}
					if ( iParam4(ci) != 0 ) {
						ibitmod ITEM_BIT_REMAKE, ci, TRUE
					}
				}
			}
		}
		if ( cfg_nc_aphrodisiac == 0 | f == 0 ) {
			ctalk lovemiracle_arg1, 1218, lovemiracle_arg1, lovemiracle_arg1
		}
	}
	if ( lovemiracle_prm1 == 1 ) {
		if ( cRowAct(lovemiracle_arg1) == ACTION_SEX & rnd(50) == 0 ) {
			if ( rnd(2) ) {
				ctalk lovemiracle_arg1, 1216, lovemiracle_arg1, lovemiracle_arg1
				if ( stat == 0 ) {
					txtef COLOR_SKY_BLUE
					txt lovemiracle_arg1, lang("「やぁ…！」", cnvtalk("No...!"))
				}
				flt
				itemcreate -1, ITEM_ID_BOTTLE_DIRTY_WATER, cX(lovemiracle_arg1), cY(lovemiracle_arg1), 0
				if ( stat ) {
					if ( lovemiracle_arg1 == 0 ) {
						ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
					}
					else {
						iSubName(ci) = cId(lovemiracle_arg1)
						if ( iSubName(ci) == 343 ) {
							iCNpcId(ci) = cUNID(lovemiracle_arg1)
							ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(lovemiracle_arg1)))
						}
					}
					iValue(ci) = sCHR(lovemiracle_arg1) / 10 * 10 + 100
				}
			}
			else {
				ctalk lovemiracle_arg1, 1217, lovemiracle_arg1, lovemiracle_arg1
				if ( stat == 0 ) {
					txtef COLOR_SKY_BLUE
					txt lovemiracle_arg1, lang("「やぁ…！」", cnvtalk("No...!"))
				}
				flt
				itemcreate -1, ITEM_ID_SHIT, cX(lovemiracle_arg1), cY(lovemiracle_arg1), 0
				if ( stat ) {
					if ( lovemiracle_arg1 == 0 ) {
						ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
					}
					else {
						iSubName(ci) = cId(lovemiracle_arg1)
						if ( iSubName(ci) == 343 ) {
							iCNpcId(ci) = cUNID(lovemiracle_arg1)
							ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(lovemiracle_arg1)))
						}
					}
					iValue(ci) = sCHR(lovemiracle_arg1) / 10 * 10 + 100
				}
			}
			snd SOUNDLIST_ATK_ELEC
			if ( cfg_nc_aphrodisiac < 3 & lovemiracle_prm1 == 0 | (cfg_nc_aphrodisiac < 2 & lovemiracle_prm1 == 1) ) {
				animeload 15, lovemiracle_arg1
			}
		}
	}
	ci = cibk
	if ( cfg_nc_aphrodisiac == 0 | f == 0 ) {
		snd SOUNDLIST_ATK_ELEC
		if ( cfg_nc_aphrodisiac < 3 & lovemiracle_prm1 == 0 | (cfg_nc_aphrodisiac < 2 & lovemiracle_prm1 == 1) ) {
			animeload 15, lovemiracle_arg1
		}
		f = 1
	}
	return

*label_1839
	if ( cc != CHARA_PLAYER ) {
		txt -1, lang(name(cc) + "は渋い顔をした。", name(cc) + " looks glum.")
		return
	}
	if ( cbit(CHARA_BIT_EAT_ROTTEN, cc) == TRUE ) {
		txt -1, lang("しかし、" + name(cc) + "は何ともなかった。", "But " + name(cc) + your(cc) + " stomach isn't affected.")
		return
	}
	fdmax = 0
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 10, -100
		fdmax++
	}
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 11, -100
		fdmax++
	}
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 17, -100
		fdmax++
	}
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 16, -100
		fdmax++
	}
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 12, -100
		fdmax++
	}
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 13, -100
		fdmax++
	}
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 14, -100
		fdmax++
	}
	if ( fdmax < 10 ) {
		fdlist(0, fdmax) = 15, -100
		fdmax++
	}
	nutrition = 1000
	dmgcon cc, CONDITION_PARALYZE, 100
	dmgcon cc, CONDITION_CONFUSE, 200
	return

*label_1840
	gosub *label_4525
	gosub *label_1681
	return

*eatHard
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang("まるで鉄のように硬い！" + name(cc) + "の胃は悲鳴をあげた。", "It's too hard! " + name(cc) + your(cc) + " stomach screams.")
	}
	dmgcon cc, CONDITION_DIM, 200
	return

*eatInsane
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang("気が変になりそうな味だ。", "It tastes really, really strange.")
	}
	dmgsan cc, 25
	dmgcon cc, CONDITION_INSANE, 500
	return

*eatHorse
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("馬肉だ！これは精がつきそうだ。", "A horsemeat! It's nourishing")
	}
	skillexp2 SKILL_ATTR_CON, cc, 100
	return

*eatHoly
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang(name(cc) + "は神聖なものを汚した気がした。", name(cc) + " feel" + _s(cc) + " as " + he(cc) + " " + have(cc) + " been corrupted.")
	}
	if ( rnd(5) == 0 ) {
		resistmod cc, SKILL_RES_DARKNESS, 50
	}
	return

*eatPlayer
	if ( synccheck(cc, -1) ) {
		txt -1, lang("＠を食べるなんて…", "You dare to eat @...")
	}
	return

*eatGuard
	if ( cc != CHARA_PLAYER ) {
		return
	}
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang("ガード達はあなたを憎悪した。", "Guards hate you.")
	}
	modkarma cc, -15
	return

*eatVesda
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang(name(cc) + "の体は一瞬燃え上がった。", name(cc) + your(cc) + " body burns up for a second.")
	}
	resistmod cc, SKILL_RES_FIRE, 50 * 2
	return

*eatIssizzle
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang(name(cc) + "の胃は狂気で満たされた。", "Sheer madness!")
	}
	resistmod cc, SKILL_RES_MIND, 50
	dmgsan cc, 200
	dmgcon cc, CONDITION_INSANE, 1000
	return

*eatPutit
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("肌がつるつるになりそうだ。", name(cc) + your(cc) + " skin becomes smooth.")
	}
	skillexp2 SKILL_ATTR_CHA, cc, 150
	return

*eatCupid
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang(name(cc) + "は恋をしている気分になった！", name(cc) + " feel" + _s(cc) + " love!")
	}
	skillexp2 SKILL_ATTR_CHA, cc, 400
	return

*eatPoison
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang("これは有毒だ！", "Argh! It's poisonous!")
	}
	dmgcon cc, CONDITION_POISON, 100
	return

*eatTroll
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("血が沸き立つようだ。", "A troll meat. This must be good for your body.")
	}
	skillexp2 SKILL_NORMAL_HEALING, cc, 200
	return

*eatRotten
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang("腐ってるなんて分かりきっていたのに…うげぇ", "Of course, it's rotten! Urgh...")
	}
	gosub *label_1839
	return

*eatBeetle
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("力が湧いてくるようだ。", "Mighty taste!")
	}
	skillexp2 SKILL_ATTR_STR, cc, 250
	return

*eatMandrake
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("微かな魔力の刺激を感じた。", name(cc) + " " + is(cc) + " magically stimulated.")
	}
	skillexp2 SKILL_NORMAL_MEDITATION, cc, 500
	return

*eatGhost
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang("胃の調子がおかしい…", "Something is wrong with " + name(cc) + your(cc) + " stomach...")
	}
	dmgcon cc, CONDITION_CONFUSE, 200
	return

*eatHealSan
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("この肉は心を落ち着かせる効果があるようだ。", "Eating this brings " + name(cc) + " inner peace.")
	}
	if ( godcheck(cc) != "danalin" ) {
		healsan cc, 20
	}
	return

*label_1858
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang(name(cc) + "の胃は狂気で満たされた。", "Sheer madness!")
	}
	dmgsan cc, 50
	if ( rnd(5) == 0 ) {
		resistmod cc, SKILL_RES_MIND, 50
	}
	return

*eatChaos
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang(name(cc) + "の胃は混沌で満たされた。", name(cc) + " " + is(cc) + " shaken by a chaotic power.")
	}
	dmgcon cc, CONDITION_CONFUSE, 300
	return

*eatEye
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang(name(cc) + "の神経に電流が走った。", name(cc) + your(cc) + " nerve is damaged.")
	}
	dmgcon cc, CONDITION_PARALYZE, 300
	return

*eatCat
	if ( cc != CHARA_PLAYER ) {
		return
	}
	if ( synccheck(cc, -1) ) {
		txt -1, lang("猫を食べるなんて！！", "How can you eat a cat!!")
	}
	modkarma 0, -5
	return

*eatEther
	if ( cc != CHARA_PLAYER ) {
		return
	}
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang(name(cc) + "の体内はエーテルで満たされた。", "Ether corrupts your body.")
	}
	modcorrupt 1000
	return

*eatEND
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("体力がつきそうだ。", "This food is good for your endurance.")
	}
	return

*eatMAG
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("魔力が鍛えられる。", "This food is good for your magic.")
	}
	return

*eatSTR
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("力がつきそうだ。", "This food is good for your strength.")
	}
	return

*eatWIL
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("精神が少しずぶとくなった。", "This food is good for your will power.")
	}
	return

*eatQuickling
	if ( synccheck(cc, -1) ) {
		txtef COLOR_GREEN
		txt -1, lang("ワアーォ、" + name(cc) + "は速くなった気がする！", "Wow, " + name(cc) + " speed" + _s(cc) + " up!")
	}
	skillexp2 SKILL_ATTR_SPD, cc, limit(2500 - sSPD(cc) * sSPD(cc) / 10, 20, 2500)
	return

*label_1868
	if ( cc == CHARA_PLAYER ) {
		return
	}
	if ( synccheck(cc, -1) ) {
		if ( cId(cc) == CREATURE_ID_YOUNGER_SISTER | cId(cc) == CREATURE_ID_YOUNGER_SISTER2 ) {
			return
		}
		if ( cfg_st_youngersistercorpse ) {
			if ( encfind(cc, ENCHANT_RES_MUTATION) != (-1) | cQuality(cc) >= FIX_QUALITY_UNIQUE ) {
				txt -1, lang(name(cc) + "は変異を受け付けなかった。", name(cc) + " resist the threat of mutation.")
				return
			}
			txtef COLOR_PURPLE
			txt -1, lang(name(cc) + "はあなたの血の繋がっていない妹だ。", name(cc) + " " + is(cc) + " your younger sister.")
			animeload 8, cc
			characreate MAX_CHARA_NC, CREATURE_ID_YOUNGER_SISTER, -3, 0
			repeat 1000
				nc_intb_001 = cbit(cnt, cc)
				cbitmod cnt, MAX_CHARA_NC, nc_intb_001
			loop
			cId(cc) = CREATURE_ID_YOUNGER_SISTER
			cPic(cc) = xy2pic(6, 3)
			repeat 1000
				nc_intb_001 = cbit(cnt, MAX_CHARA_NC)
				cbitmod cnt, cc, nc_intb_001
			loop
			cbitmod CHARA_BIT_SUPERIOR_RIDING, cc, TRUE
			cbitmod CHARA_BIT_INFERIOR_RIDING, cc, FALSE
			cbitmod CHARA_BIT_PCC, cc, FALSE
			cTxt(cc) = 1
			cTxt(cc) += 1
			cTxt(cc) += 1
			cTxt(cc) += 1
			cbitmod CHARA_BIT_SHUT_UP, cc, FALSE
			chara_vanquish MAX_CHARA_NC
		}
	}
	return

*eatAlien
	if ( synccheck(cc, -1) ) {
		txt -1, lang("何かが" + name(cc) + "の体内に入り込んだ。", "Something gets into " + name(cc) + your(cc) + " body.")
	}
	tc = cc
	flag_alien = 1
	gosub *alien_effect
	return

*alien_effect
	if ( findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1 ) {
		if ( encfind(tc, ENCHANT_RES_PREGNANCY) != (-1) ) {
			if ( synccheck(tc, -1) ) {
				txt -1, lang("しかしすぐに吐き出した。", "But " + he(tc) + " puke" + _s(tc) + " it out quickly.")
			}
			return
		}
	}
	if ( cbit(CHARA_BIT_PREGNANT, tc) == FALSE ) {
		txtef COLOR_YELLOW
		if ( cId(cc) == CREATURE_ID_ALIEN | flag_alien ) {
			txt -1, lang(name(tc) + "は寄生された。", name(tc) + " get" + _s(tc) + " pregnant.")
		}
		else {
			txt -1, lang(name(tc) + "は妊娠した。", name(tc) + " get" + _s(tc) + " pregnant.")
		}
		txtef COLOR_SKY_BLUE
		ctalk tc, 973, tc, tc
		animeload 8, tc
		cbitmod CHARA_BIT_PREGNANT, tc, TRUE
		if ( flag_alien ) {
			ocAlienChildCreatureID(tc) = 330
			flag_alien = 0
		}
		else {
			if ( cc != CHARA_PLAYER ) {
				ocAlienChildCreatureID(tc) = cId(cc)
				if ( cId(cc) == CREATURE_ID_USER ) {
					ocItemDV(tc) = cUNID(cc) + 1
				}
			}
			else {
				ocAlienChildCreatureID(tc) = -1
			}
		}
	}
	return

*label_1873
	if ( synccheck(cc, -1) ) {
		txtef COLOR_PURPLE
		txt -1, lang(name(cc) + "の胃はズタズタになった。", his(cc) + " stomach is shredded.")
	}
	dmghp cc, rolemax(iDice1(ci), iDice2(ci), iDmg(ci) + iLevel(ci) + (iStatus(ci) == ITEM_STATUS_BLESSED)), DAMAGE_FROM_SUICIDE
	return













































































































































