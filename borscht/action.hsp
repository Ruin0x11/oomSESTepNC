*act_throw
	if ( synccheck(cc, -1) ) {
		txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "を投げた。", name(cc) + " throw" + _s(cc) + " " + itemname(ci, 1) + ".")
	}
	skillexp2 SKILL_WEAPON_THROWING, cc, 30, 0, 4
	if ( dist(cX(cc), cY(cc), tlocx, tlocy) * 4 > rnd(sThrow(cc) + 10) + sThrow(cc) / 4 & rnd(10) != 0 ) {
		x = tlocx + rnd(2) - rnd(2)
		y = tlocy + rnd(2) - rnd(2)
		if ( x >= 0 ) {
			if ( y >= 0 ) {
				if ( x < mWidth ) {
					if ( y < mHeight ) {
						if ( (chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
							tlocx = x
							tlocy = y
						}
					}
				}
			}
		}
	}
	animeid = ANIMATION_THROW
	if ( cfg_useffhp ) {
		aniref = iPic(ci), iCol(ci), ci
	}
	else {
		aniref = iPic(ci), iCol(ci)
	}
	anix = tlocx
	aniy = tlocy
	gosub *anime
	ti = inv_getfreeid(-1)
	removeitem ci, 1
	if ( iID(ci) == ITEM_ID_MONSTER_BALL | iID(ci) == ITEM_ID_LITTLE_BALL ) {
		if ( ti != (-1) ) {
			item_copy ci, ti
			iNum(ti) = 1
			iX(ti) = tlocx
			iY(ti) = tlocy
			ci = ti
		}
	}
	if ( cc == CHARA_PLAYER ) {
		gosub *label_1681
	}
	animeid = ANIMATION_CRUSH
	x = tlocx
	y = tlocy
	gosub *anime
	if ( iID(ci) == ITEM_ID_MONSTER_BALL | iID(ci) == ITEM_ID_LITTLE_BALL ) {
		snd SOUNDLIST_THROW2
		cell_refresh iX(ci), iY(ci)
		if ( mapChara(tlocx, tlocy) != 0 ) {
			tc = mapChara(tlocx, tlocy) - 1
			txt -1, lang(name(tc) + "に見事に命中した！", "It hits " + name(tc) + "!")
			if ( iID(ci) == ITEM_ID_MONSTER_BALL ) {
				if ( gWizard == 0 ) {
					if ( gArea  == AREA_ARENA | gArea  == AREA_PET_ARENA | gArea  == 49 | gArea  == AREA_SHOW_HOUSE | gArea  == 210 ) {
						txt -1, lang("この場所では効果がない。", "This doesn't work in this area.")
						goto *label_4158
					}
					if ( tc < MAX_CHARA_SAVE | cRole(tc) != ROLE_NONE | cQuality(tc) == FIX_QUALITY_UNIQUE | cbit(CHARA_BIT_PRECIOUS, tc) == TRUE ) {
						txt -1, lang("その生物には無効だ。", "The creature can't be captured.")
						goto *label_4158
					}
					if ( eqfaction(tc, "nc_sheep") ) {
						txt -1, lang("その生物には無効だ。", "The creature can't be captured.")
						goto *label_4158
					}
					if ( ibit(ITEM_BIT_PRECIOUS, ci) == FALSE & cLevel(tc) > iParam2(ci) ) {
						txt -1, lang("その生物を捕獲するには、より高レベルのモンスターボールが必要だ。", "Power level of the ball is not enough to capture the creature.")
						goto *label_4158
					}
					if ( cHP(tc) > cMHP(tc) / 10 ) {
						txt -1, lang("捕獲するためにはもっと弱らせる必要がある。", "You need to weaken the creature to capture it.")
						goto *label_4158
					}
				}
				txtef COLOR_GREEN
				txt -1, lang(name(tc) + "をモンスターボールに捕獲した。", "You capture " + name(tc) + ".")
				animeload 8, tc
				iSubName(ci) = cId(tc)
				iParam3(ci) = cLevel(tc)
				iWeight(ci) = limit(cWeight(tc), 10000, 100000)
				iValue(ci) = 1000
				if ( iSubName(ci) == 343 ) {
					iCNpcId(ci) = cUNID(tc)
					ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(tc)))
				}
			}
			else {
				if ( cId(tc) != CREATURE_ID_LITTLE_SISTER | petcheck(tc) | cbit(CHARA_BIT_PRECIOUS, tc) ) {
					txt -1, lang("何もおきない… ", "Nothing happens...")
					goto *label_4158
				}
				if ( gArea  == AREA_ARENA | gArea  == AREA_PET_ARENA | gArea  == 49 | gArea  == AREA_SHOW_HOUSE | gArea  == 210 ) {
					txt -1, lang("この場所では効果がない。", "This doesn't work in this area.")
					goto *label_4158
				}
				rc = tc
				txtef COLOR_GREEN
				txt -1, lang(name(tc) + "をリトル捕獲玉に捕獲した。それはモンスターボールに姿を変えた。", "You capture " + name(tc) + ".")
				animeload 8, tc
				iID(ci) = ITEM_ID_MONSTER_BALL
				iEffect(ci) = EFFECT_MONSTER_BALL
				iSubName(ci) = cId(tc)
				iParam3(ci) = cLevel(tc)
				iWeight(ci) = limit(cWeight(tc), 10000, 100000)
				iValue(ci) = 1000
				ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
			}
			chara_vanquish tc
			check_quest
		}
		goto *label_4158
	}
	if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_POTION | iID(ci) == ITEM_ID_TOMATO | iID(ci) == ITEM_ID_SHIT ) {
		if ( iID(ci) != ITEM_ID_EMPTY_BOTTLE ) {
			if ( synccheck(tlocx, tlocy) ) {
				repeat 1
					if ( iID(ci) == ITEM_ID_HANDFUL_SNOW ) {
						snd SOUNDLIST_SNOW
						break
					}
					if ( iID(ci) == ITEM_ID_SHIT ) {
						break
					}
					snd SOUNDLIST_CRUSH2
				loop
			}
			if ( mapChara(tlocx, tlocy) != 0 ) {
				tc = mapChara(tlocx, tlocy) - 1
				if ( synccheck(tc, -1) ) {
					txt -1, lang(name(tc) + "に見事に命中した！", "It hits " + name(tc) + "!")
					wet tc, 25
				}
				rowact_check tc
				if ( iID(ci) == ITEM_ID_HANDFUL_SNOW ) {
					if ( synccheck(tc, -1) ) {
						if ( tc != CHARA_PLAYER ) {
							txtef COLOR_SKY_BLUE
							txt tc, lang("「いてー！」", cnvtalk("Hey!")), lang("「やったな」", cnvtalk("Now you did it.")), lang(" *クスクス* ", "*chuckle*"), lang("「キャハハ」", cnvtalk("Tee-hee-hee!")), lang("「こやつめ」", cnvtalk("You'll pay for this.")), lang("「むむっ」", "*grin*")
						}
					}
					goto *label_4158
				}
				if ( iID(ci) == ITEM_ID_TOMATO ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt -1, lang(" *ぷちゅ* ", "*crumble*")
					}
					if ( iParam3(ci) == (-1) ) {
						if ( synccheck(tc, -1) ) {
							txtef COLOR_BLUE
							txt -1, lang(name(tc) + "は怒りに体を奮わせた！", name(tc) + " " + is(tc) + " engulfed in fury!")
						}
						cAngry(tc) += rnd(10) + 5
					}
					goto *label_4158
				}
				ccoler = 0
				if ( iID(ci) == ITEM_ID_BOTTLE_DYE & (iCol(ci) == 0 | iCol(ci) == 1 | iCol(ci) == 12) ) {
					ccoler = 1
				}
				if ( iID(ci) == ITEM_ID_SHIT ) {
					f = iWeight(ci) / 500
					if ( f < 1 ) {
						f = 1
					}
					p = 250 + rnd(15)
					if ( p == 263 ) {
						p = 264
					}
					if ( findbuff(tc, 63) == (-1) ) {
						cdata(p, tc) += rnd(f) + 5
					}
					animeload 8, tc
					if ( p == 250 ) {
						s = lang("毒", "Poisoned")
					}
					if ( p == 251 ) {
						s = lang("睡眠", "Sleep")
					}
					if ( p == 252 ) {
						s = lang("麻痺", "Paralyzed")
					}
					if ( p == 253 ) {
						s = lang("盲目", "Blinded")
					}
					if ( p == 254 ) {
						s = lang("混乱", "Confused")
					}
					if ( p == 255 ) {
						s = lang("恐怖", "Fear")
					}
					if ( p == 256 ) {
						s = lang("朦朧", "Dimmed")
					}
					if ( p == 257 ) {
						s = lang("酔払い", "Drunk")
					}
					if ( p == 258 ) {
						s = lang("出血", "Bleeding")
					}
					if ( p == 259 ) {
						s = lang("濡れ", "Wet")
					}
					if ( p == 260 ) {
						s = lang("狂気", "Insane")
					}
					if ( p == 261 ) {
						s = lang("病気", "Sick")
					}
					if ( p == 262 ) {
						s = lang("重力", "Gravity")
					}
					if ( p == 264 ) {
						s = lang("怒り", "Furious")
					}
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt -1, lang(" *べちゃ* ", "*crumble*")
						if ( findbuff(tc, 63) == (-1) ) {
							txtef COLOR_BLUE
							txt -1, lang(name(tc) + "は" + s + "状態になった！", name(tc) + " is in " + s + " state!")
						}
					}
					goto *label_4158
				}
				if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
					hostileaction cc, tc
				}
				ccthrowpotion = cc
				potionthrow = 100
				cc = tc
				dbmode = DBMODE_ON_DRINK
				dbid = iID(ci)
				gosub *db_item
				cc = ccthrowpotion
				goto *label_4158
			}
			if ( iID(ci) == ITEM_ID_HANDFUL_SNOW ) {
				if ( mapItems(tlocx, tlocy) != 0 ) {
					cell_itemlist tlocx, tlocy
					f = 0
					repeat listmax
						p = list(0, cnt)
						if ( iID(p) == ITEM_ID_SNOW_MAN ) {
							if ( synccheck(tlocx, tlocy) ) {
								txt -1, lang(itemname(p, 1) + "に命中して、雪だるまは崩れた。", "It hits " + itemname(p, 1) + " and breaks it.")
							}
							iNum(p)--
							f = 1
							break
						}
					loop
					if ( f == 1 ) {
						cell_refresh tlocx, tlocy
						goto *label_4158
					}
				}
			}
			if ( iID(ci) == ITEM_ID_HANDFUL_SNOW ) {
				if ( chipm(CHIPM_ROLE, mapId(tlocx, tlocy)) == MAP_CHIP_ROLE_SNOW ) {
					goto *label_4158
				}
				if ( synccheck(tlocx, tlocy) ) {
					txt -1, lang("それは地面に落ちて溶けた。", "It falls on the ground and melts.")
				}
			}
			else {
				if ( synccheck(tlocx, tlocy) ) {
					txt -1, lang("それは地面に落ちて砕けた。", "It falls on the ground and shatters.")
				}
			}
			if ( iID(ci) == ITEM_ID_TOMATO ) {
				if ( synccheck(tlocx, tlocy) ) {
					txtef COLOR_BLUE
					txt -1, lang(" *ぷちゅ* ", "*crumble*")
				}
				goto *label_4158
			}
			if ( iID(ci) == ITEM_ID_SHIT ) {
				snd SOUNDLIST_OFFER1
				if ( synccheck(tlocx, tlocy) ) {
					txtef COLOR_BLUE
					txt -1, lang(" *べちゃ* ", "*crumble*")
				}
				goto *label_4158
			}
			lint_efp = 50 + sThrow(cc) * 10
			efp = limitmax(lint_efp, 2147483647)
			if ( iID(ci) == ITEM_ID_BOTTLE_SULFURIC ) {
				addmef tlocx, tlocy, MEF_TYPE_ACID, xy2pic(19, 0), rnd(15) + 5, efp, cc
				goto *label_4158
			}
			if ( iID(ci) == ITEM_ID_MOLOTOV ) {
				lint_efp = 100 * (iLevel(ci) + 1)
				efp = limitmax(lint_efp, 2147483647)
				dim inrange, mWidth, mHeight
				searchrangeinit tlocx, tlocy, limit(efp / 100 - 1, 0, 20)
				if ( stat ) {
					repeat mWidth
						cnt2 = cnt
						repeat mHeight
							if ( inrange(cnt2, cnt) ) {
								if ( (chipm(CHIPM_ATTRIB, mapId(cnt2, cnt)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
									if ( rnd(3) ) {
										addmef cnt2, cnt, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 25, efp / 2, cc
										mapitem_fire cnt2, cnt
									}
								}
							}
						loop
					loop
				}
				addmef tlocx, tlocy, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 25, efp, cc
				mapitem_fire tlocx, tlocy
				goto *label_4158
			}
			addmef tlocx, tlocy, MEF_TYPE_POTION, xy2pic(27, 0), -1, efp, cc, iID(ci), iStatus(ci), iCol(ci)
			goto *label_4158
		}
	}
	if ( synccheck(tlocx, tlocy) ) {
		txt -1, lang("それは地面に落ちて砕けた。", "It falls on the ground and shatters.")
		snd SOUNDLIST_CRUSH2
	}
	if ( iID(ci) == ITEM_ID_KITTY_BANK ) {
		if ( moneybox(iParam2(ci)) != 2147483647 ) {
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, tlocx, tlocy, iParam1(ci)
		}
		else {
			repeat iParam1(ci)
				itemcreate -1, ITEM_ID_GOLD_PIECE, tlocx, tlocy, 2147483647
			loop
		}
	}
	goto *label_4158

*act_pray
	item_find FILTER_FURNITURE_ALTAR, ITEM_FIND_MODE_TYPE_MINOR
	if ( stat != (-1) ) {
		ci = stat
		s = godno2godid(iParam1(ci))
		if ( iParam3(ci) != 0 ) {
			s = usergoddatan(2, iParam2(ci))
		}
		if ( s != godcheck() ) {
			prayctrl = 0
			gosub *god_select
			goto *label_4158
		}
	}
	goto *god_pray

*act_exchange
	p(66) = int((double(strf("%0.0f", (-0.5) * ((double(calcitemvalue(ti, 0) * iNum(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) > 0) - (double(calcitemvalue(ti, 0) * iNum(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) < 0)) + double(calcitemvalue(ti, 0) * iNum(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1))) - (double(calcitemvalue(ti, 0) * iNum(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) < double(strf("%0.0f", (-0.5) * ((double(calcitemvalue(ti, 0) * iNum(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) > 0) - (double(calcitemvalue(ti, 0) * iNum(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1) < 0)) + double(calcitemvalue(ti, 0) * iNum(ti) / 2 * 3) / calcitemvalue(ci, 0) * (-1))))) * (-1))
	if ( p(66) < iNum(ci) ) {
		iNum(ci) -= p(66)
		p = inv_getfreeid(CHARA_PLAYER)
		item_copy ci, p
		iNum(p) = p(66)
		item_exchange p, ti
		ci = p
	}
	else {
		item_exchange ci, ti
	}
	return

*act_get
	if ( cc != (-1) ) {
		if ( iID(ci) == ITEM_ID_GOLD_PIECE | iID(ci) == ITEM_ID_PLATINUM_COIN ) {
			snd SOUNDLIST_GETGOLD1
			ti = ci
			in = iNum(ci)
			iNum(ci) = 0
			msgkeep = 1
			ctalk cc, 10105, cc, cc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
				ctalk cc, 1105, cc, cc
				if ( stat == 0 ) {
					ctalk cc, 1104, cc, cc
				}
			}
			cell_refresh iX(ci), iY(ci)
			if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
				se_moneymod cc, in
			}
			else {
				addplat cc, in
			}
			return 1
		}
	}
	if ( cc == CHARA_PLAYER ) {
		if ( gRider != 0 ) {
			if ( cRowAct(gRider) != ACTION_NONE ) {
				if ( cItemUsing(gRider) == ci ) {
					txt -1, lang("それは" + name(gRider) + "が使用中だ。", name(gRider) + " " + is(gRider) + " using it.")
					return 1
				}
			}
		}
		if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_FOOD ) {
			if ( iProperty(ci) == PROP_QUEST ) {
				if ( cRowAct(CHARA_PLAYER) == ACTION_NONE ) {
					if ( inv_getspace(CHARA_PLAYER) == 0 ) {
						txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
						return 0
					}
					gRowAct = ACTION_HARVEST
					gosub *label_3307
					return -1
				}
			}
		}
		if ( iProperty(ci) == PROP_CONSTRUCT ) {
			if ( iStatus(ci) != ITEM_STATUS_BLESSED ) {
				txt -1, lang(itemname(ci) + "を撤去する？ （注意！中の物は完全に失われます）", "Do you want to remove " + itemname(ci) + "? ")
			}
			else {
				txt -1, lang(itemname(ci) + "を撤去する？", "Do you want to remove " + itemname(ci) + "? ")
			}
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				snd SOUNDLIST_BUILD1
				if ( iStatus(ci) != ITEM_STATUS_BLESSED ) {
					if ( iID(ci) == ITEM_ID_SHELTER ) {
						midbk = mid
						mid = "" + 30 + "_" + (100 + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci))
						tmpload "mdata_" + mid + ".s2"
						exist exedir + "tmp\\mdata_" + mid + ".s2"
						if ( strsize != (-1) ) {
							ctrlfile 11
						}
						mid = midbk
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
						iProperty(ci) = PROP_NONE
					}
				}
				else {
					iProperty(ci) = PROP_NONE
				}
			}
			else {
				return 0
			}
		}
		if ( inv_getfreeid(cc) == (-1) ) {
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return 0
		}
	}
	itemcopy = 0
	inumbk = iNum(ci) - in
	iNum(ci) = in
	if ( cc == CHARA_PLAYER ) {
		if ( gettrait(0, 215) != 0 ) {
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_ROD ) {
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) > 0 ) {
					itemcopy = 2
				}
			}
		}
		if ( gettrait(0, 216) != 0 ) {
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_POTION & (iID(ci) == ITEM_ID_BOTTLE_MILK & iParam2(ci) != 0) == 0 ) {
				if ( iID(ci) != ITEM_ID_POISON & iID(ci) != ITEM_ID_POTION_CURE_CORRUPTION & iID(ci) != ITEM_ID_POTION_OF_GREATER_CURE_CORRUPTION ) {
					if ( rnd(5) == 0 ) {
						itemcopy = 3
					}
				}
			}
		}
	}
	if ( itemcopy == 0 ) {
		item_stack cc, ci
		if ( stat == 0 ) {
			itemcopy = 1
		}
	}
	if ( itemcopy ) {
		ti = inv_getfreeid(cc)
		if ( ti == (-1) ) {
			iNum(ci) = inumbk + in
			if ( invctrl == INVCTRL_SHOP_SELL ) {
				txt -1, lang("店の倉庫が一杯のため売れない。", "Shopkeeper's inventory is full.")
			}
			else {
				txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			}
			return 0
		}
		item_copy ci, ti
		iNum(ti) = in
	}
	iNum(ci) = inumbk
	if ( itemcopy == 2 ) {
		dbmode = DBMODE_ON_ZAP
		dbid = iID(ti)
		gosub *db_item
		txt -1, lang("あなたは" + itemname(ti) + "から魔力を吸い取った。", "You absorb magic from " + itemname(ti) + ".")
		if ( efid >= SKILL_SPELL_HEAL_LIGHT & efid < MAX_SPELL ) {
			spell(efid - 400) += inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) * 5 * iNum(ti)
		}
		else {
			healmp CHARA_PLAYER, inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) * 5 * iNum(ti)
		}
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) = 0
	}
	if ( itemcopy == 3 ) {
		txt -1, lang("あなたの手から毒が滴った。", "Poison drips from your hands.")
		iID(ti) = ITEM_ID_POISON
		iPic(ti) = xy2pic(24, 10)
		iCol(ti) = _randcolor((262 + gRandSeedA) \ 6)
		iValue(ti) = 120
		iLevel(ti) = 0
		ibitmod ITEM_BIT_PRECIOUS, ti, FALSE
	}
	if ( iProperty(ti) < PROP_NONE ) {
		iProperty(ti) = PROP_NONE
	}
	if ( ibit(ITEM_BIT_DROP, ti) ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) = 0
		ibitmod ITEM_BIT_DROP, ti, FALSE
	}
	inv(39, ti) = 0
	if ( mode == MODELIST_SHOP ) {
		if ( refitem(iID(ti), DBSPEC_TYPE, ti) == FILTER_ITEM_FOOD ) {
			if ( iMaterial(ti) == ITEM_MATERIAL_RAW ) {
				if ( invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_INV_FILE_GET ) {
					if ( invctrl == INVCTRL_INV_FILE_GET & invctrl(1) == 3 ) {
						if ( iParam3(ti) > 0 ) {
							iParam3(ti) += getgametime()
						}
					}
					else {
						if ( invctrl == INVCTRL_INV_FILE_GET & invctrl(1) == 14 ) {
							if ( iParam3(ti) > 0 ) {
								if ( iParam3(ti) <= getgametime() ) {
									iParam3(ti) = -1
								}
							}
						}
						else {
							if ( iParam3(ti) != 0 ) {
								iParam3(ti) = getgametime() + refitem(iID(ti), DBSPEC_PARAM3_ORG, ti)
								if ( iParam2(ti) != 0 ) {
									iParam3(ti) += 72
								}
							}
						}
					}
				}
				if ( invctrl == INVCTRL_PUT & invctrl(1) == 3 ) {
					if ( iParam3(ti) > 0 ) {
						iParam3(ti) = iParam3(ti) - getgametime()
					}
				}
			}
		}
		if ( invctrl == INVCTRL_SHOP_BUY ) {
			msgkeep = 1
			txt -1, lang(itemname(ti, in) + "を買った。", "You buy " + itemname(ti, in) + ".")
			sellgold = limitmax(calcitemvalue(ti, 0) * in, 2000000000)
			snd SOUNDLIST_PAYGOLD1
			cGold(CHARA_PLAYER) -= sellgold
			gosub *label_0422
			se_moneymod tc, sellgold
			if ( refitem(iID(ti), DBSPEC_TYPE, ti) == FILTER_CARGO_TRADE ) {
				iParam2(ti) = calcitemvalue(ti, 0)
			}
		}
		if ( invctrl == INVCTRL_SHOP_SELL ) {
			msgkeep = 1
			sellgold = calcitemvalue(ci, 1) * in
			if ( ibit(ITEM_BIT_STOLEN, ti) == FALSE ) {
				txt -1, lang(itemname(ti, in) + "を売った。", "You sell " + itemname(ti, in) + ".")
				if ( refitem(iID(ti), DBSPEC_TYPE, ti) == FILTER_CARGO_TRADE ) {
					if ( sellgold - iParam2(ti) * in >= 500000 ) {
						newtitle TITLE_BIG_SHOT
					}
				}
			}
			else {
				ibitmod ITEM_BIT_STOLEN, ti, FALSE
				txt -1, lang("盗品の" + itemname(ti, in) + "を売却した。", "You sell " + itemname(ti, in) + ".(Stolen item sold) ")
				if ( flagThiefGuildNorma > 0 ) {
					flagThiefGuildNorma -= sellgold
					if ( flagThiefGuildNorma < 0 ) {
						flagThiefGuildNorma = 0
					}
					txt -1, lang("盗賊ギルドのノルマ達成まで、あと金貨" + flagThiefGuildNorma + "枚相当の盗品を売却する必要がある。", "You still need to sell stuff worth " + flagThiefGuildNorma + " gold pieces in order to advance ranks in the Thieves Guild.")
				}
			}
			snd SOUNDLIST_GETGOLD1
			se_moneymod 0, sellgold
			cGold(tc) -= sellgold
			if ( cGold(tc) < 0 ) {
				cGold(tc) = 0
			}
			iKnown(ti) = ITEM_KNOWN_FULL
		}
		if ( invctrl == INVCTRL_INV_FILE_GET | invctrl == INVCTRL_PUT ) {
			snd 14 + rnd(2)
			msgkeep = 1
			if ( invctrl == INVCTRL_INV_FILE_GET ) {
				ctalk 0, 10106, 0, 0
				if ( stat == 0 ) {
					txt -1, lang(name(0) + "は" + itemname(ti, in) + "を取り出した。", name(0) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
				}
			}
			else {
				ctalk 0, 10107, 0, 0
				if ( stat == 0 ) {
					txt -1, lang(itemname(ti, in) + "を保管した。", "You put " + itemname(ti, in) + " in the container.")
				}
			}
		}
		else {
			r1 = 0
			r2 = sellgold
			gosub *label_1595
		}
	}
	else {
		cell_refresh iX(ci), iY(ci)
		mapItemsMemory(iX(ci), iY(ci)) = mapItems(iX(ci), iY(ci))
		snd 14 + rnd(2)
		msgkeep = 1
		ctalk cc, 10105, cc, cc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
			ctalk cc, 1105, cc, cc
			if ( stat == 0 ) {
				ctalk cc, 1104, cc, cc
			}
		}
	}
	if ( cc == CHARA_PLAYER ) {
		if ( iID(ti) == ITEM_ID_CAMPFIRE ) {
			inv_getheader -1
			if ( mFireSound == 1 ) {
				f = 0
				repeat invrange, invhead
					if ( iNum(cnt) == 0 ) {
						continue
					}
					if ( iID(cnt) == ITEM_ID_CAMPFIRE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					mFireSound = 0
					gosub *music_play
				}
			}
		}
		convertartifact ti
		ti = stat
		if ( areaId(gArea ) == AREA_MUSEUM ) {
			if ( mode == MODELIST_MAIN ) {
				gosub *museum_update
			}
		}
		if ( gArea  == AREA_HOME ) {
			if ( mode == MODELIST_MAIN ) {
				gosub *house_update
			}
		}
		gosub *label_1681
	}
	if ( cc == (-1) ) {
		gosub *label_1681
	}
	return 1

*act_drop
	inumbk = iNum(ci) - in
	iNum(ci) = in
	iX(ci) = cX(cc)
	iY(ci) = cY(cc)
	itemturn ci
	item_stack -1, ci
	if ( stat == 0 | dropval == 0 ) {
		ti = inv_getfreeid(-1)
		if ( ti == (-1) ) {
			ctalk 0, 10109, 0, 0
			if ( stat == 0 ) {
				txt -1, lang("もう周りに物を置くスペースがない！ ", "The place is too crowded. You can't drop stuff anymore.")
			}
			gosub *screen_draw
			return 0
		}
		item_copy ci, ti
	}
	if ( dropval == 1 ) {
		if ( iProperty(ti) != PROP_SHOP ) {
			if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) = gCountShelter + 100
				gCountShelter++
			}
		}
		iProperty(ti) = PROP_CONSTRUCT
	}
	iNum(ci) = inumbk
	inv(39, ci) = 0
	cell_refresh iX(ti), iY(ti)
	if ( dropval == 0 ) {
		screenupdate = -1
		gosub *screen_draw
		if ( item_count == 0 ) {
			snd SOUNDLIST_DROP1
			ctalk 0, 10108, 0, 0
			if ( stat == 0 ) {
				txt -1, lang(itemname(ti, in) + "を地面に置いた。", "You drop " + itemname(ti, in) + ".")
			}
		}
	}
	gosub *label_1681
	if ( iID(ti) == ITEM_ID_BOTTLE_WATER ) {
		item_find FILTER_FURNITURE_ALTAR, ITEM_FIND_MODE_TYPE
		if ( stat != (-1) ) {
			p = stat
			godidt = godno2godid(iParam1(p))
			if ( godidt == "eyth" & iParam3(p) != 0 ) {
				godidt = usergoddatan(2, iParam2(p))
			}
			if ( gettrait(0, 194) == 0 ) {
				if ( godidt == godcheck() ) {
					if ( iStatus(ti) != ITEM_STATUS_BLESSED ) {
						snd SOUNDLIST_PRAY1
						iStatus(ti) = ITEM_STATUS_BLESSED
						txtef COLOR_GREEN
						txt -1, lang("水は祝福を受けた。", "The water is blessed.")
					}
				}
				else {
					snd SOUNDLIST_CURSE3
					iStatus(ti) = ITEM_STATUS_CURSED
					txtef COLOR_RED
					txt -1, lang("水は黒く輝いた。", "The water glows black.")
				}
			}
		}
	}
	if ( areaId(gArea ) == AREA_MUSEUM ) {
		if ( mode == MODELIST_MAIN ) {
			gosub *museum_update
		}
	}
	if ( gArea  == AREA_HOME ) {
		if ( mode == MODELIST_MAIN ) {
			gosub *house_update
		}
	}
	if ( iID(ti) == ITEM_ID_CAMPFIRE ) {
		mFireSound = 1
		gosub *music_play
	}
	return 1

*label_3590
	if ( ci == (-1) ) {
		return 0
	}
	if ( cdata(body, r1) \ EXT_EQUIP_SLOTS != 0 ) {
		return 0
	}
	if ( iEquip(ci) != 0 ) {
		return 0
	}
	item_separate ci
	if ( r1 == 0 ) {
		item_identify ci, ITEM_KNOWN_QUALITY
	}
	iEquip(ci) = body
	cdata(body, r1) = cdata(body, r1) / EXT_EQUIP_SLOTS * 10000 + ci + 1
	return 1

*label_3591
	p = cdata(body, r1) \ EXT_EQUIP_SLOTS
	if ( p == 0 ) {
		rtval = -2
		return
	}
	ci = p - 1
	cdata(body, r1) = cdata(body, r1) / EXT_EQUIP_SLOTS * 10000
	iEquip(ci) = 0
	item_stack r1, ci
	return

*act_unequip_part
	repeat 30, 100
		if ( cdata(cnt, r1) / EXT_EQUIP_SLOTS == body ) {
			p = cdata(cnt, r1) \ EXT_EQUIP_SLOTS
			if ( p == 0 ) {
				continue
			}
			p--
			iEquip(p) = 0
			cdata(cnt, r1) = cdata(cnt, r1) / EXT_EQUIP_SLOTS * 10000
		}
	loop
	return

*act_read
	if ( iID(ci) == ITEM_ID_RECIPE ) {
		if ( iSubName(ci) == 0 ) {
			txt -1, lang("最後に調合したアイテムを、レシピに加えることができる。(まだ未実装)", "You can add a recipe of the item you previously created.(Not implemented yet)")
			goto *label_4158
		}
	}
	efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
	dbmode = DBMODE_ON_READ
	dbid = iID(ci)
	cibkref = ci
	gosub *db_item
	if ( efid == SKILL_EFFECT_CREATE_BUILDING ) {
		goto *building_new
	}
	goto *label_4158

*act_eat
	if ( cc == CHARA_PLAYER ) {
		cargocheck
		if ( stat == 0 ) {
			gosub *screen_draw
			goto *pc_turn
		}
		if ( itemusingfind(ci) > 0 ) {
			txt -1, lang("そのアイテムは他の誰かが使用中だ。", "Someone else is using the item.")
			goto *pc_turn
		}
	}
	else {
		if ( itemusingfind(ci) != (-1) ) {
			tc = itemusingfind(ci)
			if ( tc != cc ) {
				rowactend tc
				if ( synccheck(cc, -1) ) {
					txt -1, lang(name(cc) + "は" + name(tc) + "の食べ物を横取りした。", name(cc) + " snatch" + _s(cc) + " " + name(tc) + your(tc) + " food.")
				}
			}
		}
	}
	cEmoIcon(cc) = 16 + 100
	gosub *eat
	goto *label_4158

*act_drink
	dbmode = DBMODE_ON_DRINK
	dbid = iID(ci)
	gosub *db_item
	goto *label_4158

*label_3597
	dbmode = DBMODE_ON_ZAP
	dbid = iID(ci)
	gosub *db_item
	gosub *label_3374
	if ( stat == 0 ) {
		if ( cc == CHARA_PLAYER ) {
			gosub *screen_draw
			goto *pc_turn
		}
		else {
			if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) <= 0 ) {
			}
			goto *ai_turn
		}
	}
	goto *label_4158

*act_bash
	if ( mapItemsMemory(x, y) != 0 ) {
		if ( mapitemfind(x, y, ITEM_ID_TREE_FRUIT) != (-1) ) {
			ci = mapitemfind(x, y, ITEM_ID_TREE_FRUIT)
			item_separate ci
			snd SOUNDLIST_BASH1
			txt -1, lang(itemname(ci) + "に体当たりした。", "You throw your weight against " + itemname(ci) + ".")
			if ( iProperty(ci) == PROP_SPECIAL | iParam1(ci) <= 0 ) {
				txt -1, lang("もう実はないようだ… ", "It seems there are no fruits left on the tree.")
				goto *label_4158
			}
			if ( iParam2(ci) == 505 ) {
				iParam1(ci)--
				if ( iParam1(ci) <= 0 ) {
					iPic(ci) = xy2pic(31, 17)
					cell_refresh x, y
				}
				if ( y + 1 < mHeight ) {
					if ( (chipm(CHIPM_ATTRIB, mapId(x, y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
						y++
					}
				}
				flt
				characreate -1, CREATURE_ID_YOUNGER_SISTER, x, y
				txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
				skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10
			}
			else {
				treeid = ci
				iPic(treeid) = xy2pic(31, 17)
				cell_refresh x, y
				if ( y + 1 < mHeight ) {
					if ( (chipm(CHIPM_ATTRIB, mapId(x, y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
						y++
					}
				}
				repeat iParam1(treeid)
					if ( nc_gettrait(0, 118) > 0 ) {
						if ( rnd(2) ) {
							flt
							itemcreate -1, iParam2(treeid), x, y, 0
						}
					}
					flt
					itemcreate -1, iParam2(treeid), x, y, 0
				loop
				txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(reeid)) + " down from the tree.")
				skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10 * iParam1(treeid)
				iParam1(treeid) = 0
			}
			goto *label_4158
		}
		if ( mapitemfind(x, y, ITEM_ID_BOOK_BOKONON) != (-1) ) {
			ci = mapitemfind(x, y, ITEM_ID_BOOK_BOKONON)
			item_separate ci
			snd SOUNDLIST_BASH1
			txt -1, lang(itemname(ci) + "に体当たりした。", "You throw your weight against " + itemname(ci) + ".")
			if ( iProperty(ci) == PROP_SPECIAL | iParam1(ci) <= 0 ) {
				txt -1, lang("もう実はないようだ… ", "It seems there are no fruits left on the tree.")
				goto *label_4158
			}
			if ( iParam2(ci) == 505 ) {
				iParam1(ci)--
				if ( iParam1(ci) <= 0 ) {
					iPic(ci) = xy2pic(31, 17)
					cell_refresh x, y
				}
				if ( y + 1 < mHeight ) {
					if ( (chipm(CHIPM_ATTRIB, mapId(x, y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
						y++
					}
				}
				flt
				characreate -1, CREATURE_ID_YOUNGER_SISTER, x, y
				txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
				skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10
			}
			else {
				treeid = ci
				iPic(treeid) = xy2pic(31, 17)
				cell_refresh x, y
				if ( y + 1 < mHeight ) {
					if ( (chipm(CHIPM_ATTRIB, mapId(x, y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
						y++
					}
				}
				repeat iParam1(treeid)
					if ( iParam2(treeid) != 54 ) {
						if ( nc_gettrait(0, 118) > 0 ) {
							if ( rnd(2) ) {
								flt
								itemcreate -1, iParam2(treeid), x, y, 0
							}
						}
						flt
						itemcreate -1, iParam2(treeid), x, y, 0
					}
					else {
						if ( nc_gettrait(0, 118) > 0 ) {
							if ( rnd(2) ) {
								flt
								itemcreate -1, iParam2(treeid), x, y, 1000
							}
						}
						flt
						itemcreate -1, iParam2(treeid), x, y, 1000
					}
					if ( iParam2(treeid) == 619 ) {
						iSubName(ci) = 30
						iPic(ci) = xy2pic(0, 13)
						iCol(ci) = 0
						repeat
							iParam1(ci) = rnd(368)
							if ( iParam1(ci) == 212 | iParam1(ci) == 340 ) {
								continue
							}
							if ( iParam1(ci) > 353 & iParam1(ci) < 366 ) {
								iParam1(ci) = 343
							}
							if ( iParam1(ci) == 343 ) {
								if ( usernpcmax == 0 ) {
									continue
								}
								iCNpcId(ci) = rnd(usernpcmax)
								ICNpcSerialNo(ci) = createserialno(userdatan(0, iCNpcId(ci)))
							}
							break
						loop
					}
					if ( iParam2(treeid) == 734 ) {
						iValue(ci) = rnd(sGardening(CHARA_PLAYER) / 5 + 5) + 10
					}
				loop
				txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(reeid)) + " down from the tree.")
				skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10 * iParam1(treeid)
				iParam1(treeid) = 0
			}
			goto *label_4158
		}
	}
	if ( mapChara(x, y) != 0 ) {
		tc = mapChara(x, y) - 1
		if ( cSleep(tc) == 0 ) {
			if ( cc == CHARA_PLAYER ) {
				if ( cRelation(tc) >= RELATION_NEUTRAL ) {
					gosub *com_confirmAttack
					if ( stat == 0 ) {
						goto *pc_turn
					}
				}
			}
			if ( cMochi(tc) ) {
				snd SOUNDLIST_BASH1
				txt -1, lang(name(cc) + "は" + name(tc) + "に全力で体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + " at full power.")
				dmghp tc, sSTR(cc) * 5, cc
				if ( cExist(tc) == CHAR_STATE_ALIVE ) {
					txt -1, lang(name(tc) + "はもちを吐き出した。", name(tc) + " spit" + _s(tc) + " mochi.")
					ctalk tc, 1244, cc, tc
					if ( stat == 0 ) {
						txt tc, lang("「助かったよ！」", cnvtalk("You saved me!"))
					}
					cMochi(tc) = 0
					modimp tc, 10
				}
			}
			else {
				snd SOUNDLIST_BASH1
				txt -1, lang(name(cc) + "は" + name(tc) + "に体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + ".")
				hostileaction cc, tc
			}
		}
		else {
			snd SOUNDLIST_BASH1
			txt -1, lang(name(cc) + "は" + name(tc) + "に体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + ".")
			txt -1, lang(name(tc) + "は睡眠を妨害された。", name(cc) + " disturb" + _s(cc) + " " + his(tc) + " sleep.")
			modkarma cc, -1
			cEmoIcon(tc) = 18 + 100 * 4
		}
		cSleep(tc) = 0
		goto *label_4158
	}
	if ( mapFeat(x, y) != 0 ) {
		cell_featread x, y
		if ( featId == CELL_FEATURE_POT ) {
			mapFeat(x, y) = 0
			spillfrag x, y, 2
			flt calcobjlv(gLevel  * (gArea  != AREA_SHELTER)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetbarrel(rnd(length(fsetbarrel)))
			itemcreate -1, ITEM_ID_DUMMY, x, y, 0
			if ( synccheck(cc, -1) ) {
				snd SOUNDLIST_BASH1
				txt -1, lang(name(cc) + "は壷を割った。", name(cc) + " shatter" + _s(cc) + " the pot.")
				snd SOUNDLIST_CRUSH1
				animeid = ANIMATION_CRUSH
				gosub *anime
			}
			goto *label_4158
		}
		if ( featId == CELL_FEATURE_DOOR_CLOSED ) {
			snd SOUNDLIST_BASH1
			p = featIdSub * 3 + 30
			if ( gArea  == AREA_JAIL ) {
				p *= 20
			}
			if ( rnd(p) < sSTR(cc) & rnd(2) | p * 2 < sSTR(cc) ) {
				txt -1, lang("扉に体当たりして破壊した。", "You bash up the door. The door is destroyed.")
				if ( featIdSub > sSTR(cc) ) {
					skillexp2 SKILL_ATTR_STR, cc, (featIdSub - sSTR(cc)) * 15
				}
				cell_featset x, y, 0, CELL_FEATURE_NONE, 0, 0
				goto *label_4158
			}
			else {
				txt -1, lang("扉に体当たりした。", "You bash up the door.")
				if ( gArea  == AREA_JAIL ) {
					txt -1, lang("さすがに牢獄の扉は頑丈だ。", "As might be expected, the door of the Jail is hard.")
				}
				if ( rnd(4) == 0 ) {
					tc = cc
					efid = SKILL_EFFECT_CONFUSE
					efp = 200
					gosub *label_3383
				}
				if ( rnd(3) == 0 ) {
					tc = cc
					efid = SKILL_EFFECT_PARALYZE
					efp = 200
					gosub *label_3383
				}
				if ( rnd(3) == 0 ) {
					if ( cQuality(cc) < FIX_QUALITY_MIRACLE & encfind(cc, 6 * 10000 + 10) == (-1) & have_bigench(cc, 6) == 0 ) {
						cdata(STARTING_CDATA_ATTR, cc)--
						r1 = cc
						gosub *charaRefresh
						if ( synccheck(cc, -1) ) {
							txtef COLOR_PURPLE
							txt -1, lang(name(cc) + "は筋肉を痛めた。", name(cc) + " hurt" + _s(cc) + " " + his(cc) + " muscle.")
						}
					}
				}
				if ( rnd(3) == 0 ) {
					if ( featIdSub > CELL_SUB_FEATURE_TRAP_IMPALEMENT ) {
						featIdSub--
						cell_featset x, y, featPic, featId, featIdSub, featParam1
						if ( synccheck(cc, -1) ) {
							txt -1, lang("扉は少しだけ壊れた。", "The door is cracked a bit.")
						}
					}
				}
				goto *label_4158
			}
		}
	}
	txt -1, lang(name(cc) + "は空気に体当たりした。", name(cc) + " bash" + _s(cc, 1) + " up the air.")
	snd SOUNDLIST_MISS
	goto *label_4158
	gosub *search_for_chara
	if ( cc == CHARA_PLAYER ) {
	}
	return

*search_for_chara
	listmax2 = 0
	if ( cc == CHARA_PLAYER ) {
		repeat 15
			y = cY(cc) - 15 / 2 + cnt
			if ( y < 0 | y >= mHeight ) {
				continue
			}
			repeat fovlist(1, cnt), fovlist(0, cnt)
				x = cX(cc) - 15 / 2 + cnt
				if ( x < 0 | x >= mWidth ) {
					continue
				}
				if ( mapChara(x, y) != 0 ) {
					p = mapChara(x, y) - 1
					if ( cc != p ) {
						if ( fov_los(cX(cc), cY(cc), x, y) != 0 ) {
							listmax2++
						}
					}
				}
			loop
		loop
	}
	else {
		repeat cFov(cc) - 2
			y = cY(cc) - cFov(cc) / 2 + cnt + 1
			if ( y < 0 | y >= mHeight ) {
				continue
			}
			repeat cFov(cc) - 2
				x = cX(cc) - cFov(cc) / 2 + cnt + 1
				if ( x < 0 | x >= mWidth ) {
					continue
				}
				if ( mapChara(x, y) != 0 ) {
					p = mapChara(x, y) - 1
					if ( cc != p ) {
						if ( fov_los(cX(cc), cY(cc), x, y) != 0 ) {
							listmax2++
						}
					}
				}
			loop
		loop
	}
	return

*label_3607
	f = 0
	if ( cDim(cc) != 0 ) {
		if ( cDim(cc) + 10 > rnd(60) ) {
			f = 1
		}
	}
	if ( cDrunk(cc) != 0 ) {
		if ( rnd(5) == 0 & trophycheck(TROPHY_MONOTHEISM) != 2 ) {
			txtef COLOR_SKY_BLUE
			txt -1, lang(" *ふらり* ", "*stagger*")
			f = 1
		}
	}
	if ( cdata(265, cc) != 0 ) {
		if ( rnd(25) == 0 & trophycheck(TROPHY_MONOTHEISM) != 2 ) {
			txtef COLOR_SKY_BLUE
			txt -1, lang(" *ふらり* ", "*stagger*")
			f = 1
		}
	}
	if ( cConfuse(cc) != 0 & trophycheck(TROPHY_MONOTHEISM) != 2 | f == 1 ) {
		cXnew(cc) = cX(cc) + rnd(3) - 1
		cYnew(cc) = cY(cc) + rnd(3) - 1
	}
	if ( gRider != 0 ) {
		if ( cRowAct(gRider) != ACTION_NONE ) {
			if ( cActionPeriod(gRider) > 0 ) {
				ctalk gRider, 1137, gRider, 0
				if ( stat == 0 ) {
					txt -1, lang(name(gRider) + "はあなたを睨み付けた。", name(gRider) + " stares in your face.")
				}
				cRowAct(gRider) = ACTION_NONE, 0
			}
		}
	}
	cell_check cXnew(cc), cYnew(cc)
	if ( cBurden(CHARA_PLAYER) >= 4 ) {
		msgdup++
		txt -1, lang("潰れていて動けない！ ", "You carry too much to move!")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( cellchara != (-1) & cellchara != 0 ) {
		tc = cellchara
		if ( cRelation(tc) == RELATION_NEUTRAL & key_shift & (cId(tc) == CREATURE_ID_USER & cQuality(tc) == FIX_QUALITY_UNIQUE) == 0 | cRelation(tc) >= RELATION_ALLY | (cRelation(tc) == RELATION_DISLIKE & cfg_ignoredislike != 0) | (cRelation(tc) == RELATION_NEUTRAL & (areaId(gArea ) == AREA_MUSEUM | areaId(gArea ) == AREA_SHOP)) ) {
			if ( cbit(CHARA_BIT_SANDBAG, tc) == FALSE & relationbetween(cc, tc) >= (-1) ) {
				if ( mType == MAP_TYPE_WORLD ) {
					goto *move_skip
				}
				if ( cfg_scroll ) {
					cXnew(CHARA_PLAYER) = cX(tc)
					cYnew(CHARA_PLAYER) = cY(tc)
					gosub *screen_scroll
				}
				cell_swap cc, tc
				ctalk 0, 10100, tc, 0
				if ( stat == 0 ) {
					txt -1, lang(name(tc) + "と入れ替わった。", "You displace " + name(tc) + ".")
				}
				if ( cId(tc) == CREATURE_ID_ROGUE ) {
					if ( rnd(5) == 0 ) {
						if ( cSleep(tc) == 0 & cdata(268, tc) == 0 ) {
							p = rnd(limit(cGold(cc), 0, 20) + 1)
							if ( cbit(CHARA_BIT_RES_STEAL, cc) ) {
								p = 0
							}
							if ( p != 0 ) {
								snd SOUNDLIST_GETGOLD1
								cGold(cc) -= p
								se_moneymod tc, p
								txt tc, lang("「おっと、ごめんよ」", cnvtalk("Ops, sorry.")), lang("「気をつけな」", cnvtalk("Watch it."))
							}
						}
					}
				}
				if ( cRowAct(tc) == ACTION_EAT ) {
					if ( cActionPeriod(tc) > 0 ) {
						ctalk tc, 1137, tc, 0
						if ( stat == 0 ) {
							txt -1, lang(name(tc) + "はあなたを睨み付けた。", name(tc) + " stares in your face.")
						}
						cRowAct(tc) = ACTION_NONE, 0
					}
				}
				gosub *cell_info
				gosub *procMove
				goto *label_4158
			}
		}
		if ( running ) {
			if ( cRelation(tc) >= RELATION_HATE | keybd_wait >= 40 ) {
				goto *pc_turn
			}
		}
		if ( cRelation(tc) <= RELATION_DISLIKE ) {
			lockon 0, tc, 15
			if ( cbit(CHARA_BIT_INVISIBLE, tc) == TRUE ) {
				if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == FALSE ) {
					if ( cWet(tc) == 0 ) {
						unlockson 0
					}
				}
			}
			if ( keybd_attacking == 0 ) {
				keybd_wait = 1
				keybd_attacking = 1
			}
			gosub *label_3640
			gosub *label_4714
			goto *label_4158
		}
		gosub *chat
		if ( chatteleport == 1 ) {
			chatteleport = 0
			goto *map_exit
		}
		goto *label_4158
	}
	else {
		keybd_attacking = 0
	}
	if ( mType == MAP_TYPE_WORLD ) {
		if ( dbg_freemove ) {
			x = cXnew(CHARA_PLAYER)
			y = cYnew(CHARA_PLAYER)
			if ( x >= 0 & x < mWidth & y >= 0 & y < mHeight ) {
				if ( mapChara(x, y) == 0 ) {
					cellaccess = 1
				}
			}
		}
	}

	if ( cellaccess == 1 ) {
*move_skip
		if ( mType == MAP_TYPE_WORLD ) {
			if ( xy2pic(0, 8) <= mapId(cXnew(cc), cYnew(cc)) & mapId(cXnew(cc), cYnew(cc)) < xy2pic(0, 11) ) {
				goto *pc_turn
			}
		}
		goto *act_move
	}
	if ( gLevel  == 1 | mType == MAP_TYPE_FIELD ) {
		if ( mType != MAP_TYPE_WORLD & gArea  != 53 ) {
			if ( cXnew(cc) < 0 | cXnew(cc) > mWidth - 1 | cYnew(cc) < 0 | cYnew(cc) > mHeight - 1 ) {
				txt -1, lang(mdatan(0) + "を去る？ ", "Do you want to leave " + mdatan(0) + "? ")
				if ( mType == MAP_TYPE_QUEST | ogQuestKnightsOfLittleGirls == 1 ) {
					if ( gQuestStatus != QUEST_STATE_SUCCESS ) {
						if ( qExist(gQuestRef) != 1021 ) {
							if ( qParam1(gQuestRef) >= qParam2(gQuestRef) ) {
								txt -1, lang("注意！現在のクエストは失敗に終わってしまう。", "Warning! You are going to abandon your current quest.")
							}
						}
						else {
							if ( qParam2(gQuestRef) > 0 ) {
								txt -1, lang("注意！現在のクエストは失敗に終わってしまう。", "Warning! You are going to abandon your current quest.")
							}
						}
					}
				}
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				gosub *screen_draw
				if ( rtval == 0 ) {
					gLastEdgeX = cX(CHARA_PLAYER)
					gLastEdgeY = cY(CHARA_PLAYER)
					snd SOUNDLIST_EXITMAP1
					gLevel --
					levelexitby = MAP_EXIT_NORMAL
					goto *map_exit
				}
				goto *pc_turn
			}
		}
	}
	if ( cellfeat != (-1) ) {
		if ( cellfeat == 21 ) {
			goto *act_move
		}
		keyhalt = 1
		if ( cellfeat == 23 ) {
			snd SOUNDLIST_CHAT
			goto *com_quest
		}
		if ( cellfeat == 31 ) {
			snd SOUNDLIST_CHAT
			gosub *com_vote
			goto *label_4158
		}
		if ( cellfeat == 33 ) {
			menucycle = 1
			gosub *com_politics_chart
			goto *pc_turn
		}
	}
	if ( cConfuse(CHARA_PLAYER) != 0 ) {
		msgdup++
		txt -1, lang(" *ごつん* ", "*bump*")
		gosub *screen_draw
	}
	else {
		if ( cc == CHARA_PLAYER ) {
			if ( autodig_f == 1 ) {
				if ( areaType(gArea ) != MAP_TYPE_WORLD ) {
					if ( cXnew(CHARA_PLAYER) >= 0 & cXnew(CHARA_PLAYER) < mWidth & cYnew(CHARA_PLAYER) >= 0 & cYnew(CHARA_PLAYER) < mHeight ) {
						goto *label_2807
					}
				}
			}
		}
	}
	goto *pc_turn

*act_move
	if ( cbit(CHARA_BIT_RIDE, cc) ) {
		goto *label_4158
	}
	dx = cXnew(cc)
	dy = cYnew(cc)
	if ( petcheck(cc) ) {
		if ( cc != CHARA_PLAYER ) {
			if ( dx != cX(cc) ) {
				if ( cX(cc) > dx ) {
					cDir(cc) = 1
				}
				else {
					cDir(cc) = 2
				}
			}
			if ( dy != cY(cc) ) {
				if ( cY(cc) > dy ) {
					cDir(cc) = 3
				}
				else {
					cDir(cc) = 0
				}
			}
		}
	}
	if ( mapFeat(dx, dy) != 0 ) {
		cell_featread dx, dy
		if ( featId == CELL_FEATURE_DOOR_CLOSED ) {
			goto *act_openDoor
		}
		if ( featId == CELL_FEATURE_POT ) {
			x = dx
			y = dy
			goto *act_bash
		}
	}
	if ( mapMef(cX(cc), cY(cc)) != 0 ) {
		i = mapMef(cX(cc), cY(cc)) - 1
		if ( mefExist(i) == MEF_TYPE_WEB ) {
			if ( mapeffect_isimmunetocobweb(cc) == 0 ) {
				if ( rndex(mefP(i) + 25) < rndex(sSTR(cc) + sDEX(cc) + 1) | cWeight(cc) > 100 ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang(name(cc) + "は蜘蛛の巣を振り払った。", name(cc) + " destroy" + _s(cc) + " the cobweb.")
					}
					delmef i
				}
				else {
					mefP(i) = mefP(i) * 3 / 4
					if ( synccheck(cc, -1) ) {
						txt -1, lang(name(cc) + "は蜘蛛の巣にひっかかった。", name(cc) + " " + is(cc) + " caught in a cobweb.")
					}
					goto *label_4158
				}
			}
		}
	}
	if ( mType == MAP_TYPE_WORLD ) {
		if ( cc == CHARA_PLAYER ) {
			if ( traveldone == 0 ) {
				gosub *travel
				keybd_wait = 1
				goto *label_4158
			}
			else {
				traveldone = 0
			}
		}
	}
	gosub *label_3294
	p = mapId(cX(cc), cY(cc))
	if ( chipm(CHIPM_ROLE, p) == MAP_CHIP_ROLE_WATER ) {
		addefmap cX(cc), cY(cc), 1, 3
		if ( eqfaction(cc, "aqua") == 1 | findbuff(cc, 97) != (-1) ) {
			ocbitmod 12, cc, 1
			refreshspeed cc
		}
	}
	else {
		if ( ocbit(12, cc) ) {
			ocbitmod 12, cc, 0
			refreshspeed cc
		}
	}
	gosub *cell_info
	if ( mType == MAP_TYPE_WORLD ) {
		if ( cc == CHARA_PLAYER ) {
			encounter = ENCOUNTER_NONE
			gWorldTile = mapId(cX(cc), cY(cc))
			if ( mapFeat(cX(cc), cY(cc)) == 0 ) {
				p = mapId(cX(cc), cY(cc))
				if ( rnd(30) == 0 ) {
					encounter = ENCOUNTER_ENEMY
					if ( sTravel(CHARA_PLAYER) != 0 ) {
						if ( rnd(1 + sqrt(limit(sTravel(CHARA_PLAYER), 0, 10000) / 5)) ) {
							encounter = ENCOUNTER_NONE
						}
					}
				}
				if ( gWeather == WEATHER_HARD_RAIN ) {
					if ( rnd(10) == 0 ) {
						encounter = ENCOUNTER_ENEMY
					}
				}
				if ( gWeather == WEATHER_ETHER ) {
					if ( rnd(13) == 0 ) {
						encounter = ENCOUNTER_ENEMY
					}
				}
				if ( 33 <= p & p < 66 ) {
					if ( rnd(2) == 0 ) {
						encounter = ENCOUNTER_NONE
					}
					if ( rnd(100) == 0 ) {
						encounter = ENCOUNTER_MERCHANT
					}
				}
				if ( ogTitleBlackOrganizationMember == 2 ) {
					if ( rnd(limit(300 - sLUC(CHARA_PLAYER) / 10, 100, 300)) == 0 ) {
						encounter = 6
					}
				}
				if ( ogTitleYouSoundFamiliar == 2 ) {
					if ( rnd(limit(300 - sLUC(CHARA_PLAYER) / 10, 100, 300)) == 0 ) {
						encounter = 5
					}
				}
				if ( rnd(limitmin(220 + cLevel(CHARA_PLAYER) * 10 - limit(ogCargoValue / (sTravel(CHARA_PLAYER) * 10 + gCargoLimit / 4000), 0, 220 + cLevel(CHARA_PLAYER) * 10), 1)) == 0 ) {
					encounter = ENCOUNTER_ROGUE
					if ( godcheck() == "serria" ) {
						if ( rnd(8) ) {
							encounter = ENCOUNTER_NONE
						}
					}
				}
				if ( rnd(20) == 0 ) {
					repeat 5
						rq = gdata(GDATA_QUEST_POOL + cnt)
						if ( qExist(rq) == QUEST_TYPE_ESCORT ) {
							if ( qStatus(rq) == QUEST_STATE_ONGOING ) {
								if ( qVar(rq) == 0 ) {
									if ( qdata((10 /*!!!@[QDATA_DEST_CLIENT @@@ QDATA_ENCOUNTER]@!!! */), rq) < 2 ) {
										encounter = ENCOUNTER_ASSASSIN
										encounterref = rq
										qdata((10 /*!!!@[QDATA_DEST_CLIENT @@@ QDATA_ENCOUNTER]@!!! */), rq)++
										break
									}
								}
							}
						}
					loop
				}
			}
			if ( encounter >= ENCOUNTER_ROGUE ) {
				encounterlv = cFame(CHARA_PLAYER) / 1000
				if ( encounterlv < 1 ) {
					endounterlv = 1
				}
				levelexitby = MAP_EXIT_NORMAL
				goto *map_exit
			}
			if ( encounter == ENCOUNTER_ASSASSIN ) {
				txt -1, lang("暗殺者につかまった。あなたはクライアントを守らなければならない。", "You are caught by assassins. You have to protect your client.")
				msg_halt
				gReturnArea = gArea , gLevel , cX(CHARA_PLAYER), cY(CHARA_PLAYER)
				levelexitby = MAP_EXIT_NORMAL
				goto *map_exit
			}
			if ( encounter == ENCOUNTER_MERCHANT ) {
				encounterlv = 10 + rnd(100)
				levelexitby = MAP_EXIT_NORMAL
				goto *map_exit
			}
			if ( encounter == ENCOUNTER_ENEMY ) {
				p = dist_town()
				encounterlv = p * 3 / 2 - 10
				if ( cFame(CHARA_PLAYER) <= 1000 ) {
					encounterlv /= 2
				}
				if ( xy2pic(0, 1) <= mapId(cX(cc), cY(cc)) & mapId(cX(cc), cY(cc)) < xy2pic(0, 2) ) {
					encounterlv /= 2
				}
				else {
					if ( gWeather == WEATHER_ETHER ) {
						encounterlv = encounterlv * 3 / 2 + 10
					}
				}
				if ( encounterlv < 0 ) {
					encounterlv = 1
				}
				valn = lang(" (最も近い街までの距離:" + p + " 敵勢力:", " (Distance from nearest town:" + p + " Enemy strength:")
				repeat 1
					if ( encounterlv < 5 ) {
						valn += lang("プチ級", "Putit Rank")
						break
					}
					if ( encounterlv < 10 ) {
						valn += lang("オーク級", "Orc Rank")
						break
					}
					if ( encounterlv < 20 ) {
						valn += lang("グリズリー級", "Grizzly Bear Rank")
						break
					}
					if ( encounterlv < 30 ) {
						valn += lang("ドレイク級", "Drake Rank")
						break
					}
					if ( encounterlv < 40 ) {
						valn += lang("リッチ級", "Lich Rank")
						break
					}
					valn += lang("ドラゴン級", "Dragon Rank")
				loop
				valn += ")"
				txt -1, lang("襲撃だ！", "Ambush!") + valn
				msg_halt
				levelexitby = MAP_EXIT_NORMAL
				goto *map_exit
			}
			encounter = ENCOUNTER_NONE
		}
	}
	goto *label_4158

*cell_info
	if ( cc == CHARA_PLAYER ) {
		gLastEdgeX = -1
		gLastEdgeY = -1
		x = cX(CHARA_PLAYER)
		y = cY(CHARA_PLAYER)
		if ( key_shift & gRun  == 0 & cConfuse(CHARA_PLAYER) == 0 & cDim(CHARA_PLAYER) == 0 ) {
			if ( mType != MAP_TYPE_WORLD ) {
				gRun  = 1
				cell_check cX(cc) + 1, cY(cc)
				gRunRight  = cellaccess
				cell_check cX(cc) - 1, cY(cc)
				gRunLeft  = cellaccess
				cell_check cX(cc), cY(cc) + 1
				gRunDown = cellaccess
				cell_check cX(cc), cY(cc) - 1
				gRunUp  = cellaccess
			}
		}
		if ( mapItems(x, y) != 0 ) {
			if ( cBlind(CHARA_PLAYER) == 0 ) {
				if ( cfg_autopick ) {
					if ( areaType(gArea ) != MAP_TYPE_HOME | areaId(gArea ) == AREA_RANCH | areaId(gArea ) == AREA_SHELTER ) {
						if ( key_ctrl != 1 ) {
							x = cX(CHARA_PLAYER)
							y = cY(CHARA_PLAYER)
							cnt3 = 0
							gosub *label_4287
						}
					}
				}
				if ( mapItems(x, y) != 0 ) {
					txt -1, txtitemoncell(x, y)
				}
			}
			else {
				txt -1, lang("地面に何かがあるようだ。", "You sense something under your foot.")
			}
		}
		if ( cfg_notforsale ) {
			if ( mapbit(3, x, y) == 1 ) {
				txt -1, lang("ここは非売品エリアだ。", "Here is not-for-sale area.")
			}
		}
		p = chipm(CHIPM_ROLE, mapId(x, y))
		if ( p != 0 ) {
			if ( tname(p) != "" ) {
				txt -1, lang("足元には" + tname(p) + "がある。", "You walk into " + tname(p) + ".")
			}
			if ( p == 3 ) {
				snd SOUNDLIST_WATER2
			}
			if ( p == 4 ) {
				addefmap cX(cc), cY(cc), 3, 10, dirsub, rnd(2)
				if ( keybd_wait <= cfg_walkwait * cfg_startrun | cTurn(CHARA_PLAYER) \ 2 == 0 | mType == MAP_TYPE_WORLD ) {
					snd 83 + foot \ 3
					foot += 1 + rnd(2)
				}
			}
		}
		else {
			if ( mType == MAP_TYPE_WORLD ) {
				addefmap cX(cc), cY(cc), 2, 10, dirsub
				snd 81 + foot \ 2
				foot++
			}
		}
		if ( mapFeat(x, y) != 0 ) {
			cell_featread x, y
			if ( featId == CELL_FEATURE_SMALL_MEDAL ) {
				txtef COLOR_YELLOW
				txt -1, lang(" *キラン* ", "*twinkle*")
			}
			if ( featId == CELL_FEATURE_NEFIA ) {
				txt -1, mapname(featIdSub + featParam1 * 100, 1)
				if ( areaId(featIdSub + featParam1 * 100) == AREA_RANDOM_DUNGEON ) {
					if ( cfg_extrahelp ) {
						if ( gdata(STARTING_GDATA_HELP + 6) == 0 ) {
							if ( mode == MODELIST_MAIN ) {
								if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
									gdata(STARTING_GDATA_HELP + 6) = 1
									ghelp = 6
									gosub *elona_help
								}
							}
						}
					}
				}
			}
			if ( featId == CELL_FEATURE_BUILDING ) {
				txt -1, txtbuilding(featIdSub, featParam1)
			}
			if ( featId == CELL_FEATURE_DOWNSTAIRS ) {
				txt -1, lang("降り階段がある。", "There is a stair leading downwards here.")
			}
			if ( featId == CELL_FEATURE_UPSTAIRS ) {
				txt -1, lang("昇り階段がある。", "There is a stair leading upwards here.")
			}
			if ( featId == CELL_FEATURE_SAMPLING_SPOT_DETECTION ) {
				txt -1, lang("何かが見つかりそうだ。", "You can search this location to collect some materials.")
			}
			if ( featId == CELL_FEATURE_SAMPLING_SPOT_GENE_ENGINEER ) {
				txt -1, lang("何かの残骸がある。", "You can collect materials from the remains lying here.")
			}
			if ( featId == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
				txt -1, lang("採掘場がある。", "You can collect materials from the mining spot here.")
			}
			if ( featId == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
				txt -1, lang("泉がある。", "You can collect materials from the spring here.")
			}
			if ( featId == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
				txt -1, lang("色んな植物が生えている。", "You can collect materials from plants here.")
			}
			if ( featId == CELL_FEATURE_PLANTED_SEED ) {
				if ( featIdSub == CELL_SUB_FEATURE_SEED_VEGETABLE ) {
					s = lang("野菜", "vegetable")
				}
				if ( featIdSub == CELL_SUB_FEATURE_SEED_FRUIT ) {
					s = lang("果物", "fruit")
				}
				if ( featIdSub == CELL_SUB_FEATURE_SEED_HERB ) {
					s = lang("ハーブ", "herb")
				}
				if ( featIdSub == CELL_SUB_FEATURE_SEED_STRANGE ) {
					s = lang("何か", "strange")
				}
				if ( featIdSub == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
					s = lang("アーティファクト", "artifact")
				}
				if ( featIdSub == CELL_SUB_FEATURE_SEED_GEM ) {
					s = lang("宝石", "gem")
				}
				if ( featIdSub == CELL_SUB_FEATURE_SEED_MAGIC ) {
					s = lang("魔法の木", "magic")
				}
				if ( feat == tile_plant ) {
					txt -1, lang("" + s + "の種が植えてある。", "A " + s + " seed is planted.")
				}
				if ( feat == tile_plant + 1 ) {
					txt -1, lang("" + s + "が育っている。", "A " + s + " bud is growing.")
				}
				if ( feat == tile_plant + 2 ) {
					txt -1, lang("" + s + "の実が成っている。", "A " + s + " tree has bore a lot of fruit.")
				}
				if ( feat == tile_plant + 3 ) {
					txt -1, lang("" + s + "の草は枯れてしまっている… ", "A " + s + " tree has withered...")
				}
				if ( key_ctrl == 1 & gArea  != AREA_SHOW_HOUSE ) {
					hack_autofarm = 1
					if ( feat < tile_plant + 2 & ogTitleSlaveToTurnips != 2 ) {
						txt -1, lang("芽を摘み取った。", "You nip a young plant.")
						mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0
						return
					}
					if ( feat == tile_plant + 3 & ogTitleSlaveToTurnips != 2 ) {
						txt -1, lang("枯れた草を摘み取った。", "You nip a dead plant.")
						mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0
						return
					}
					if ( inv_getspace(CHARA_PLAYER) == 0 ) {
						txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
						gosub *screen_draw
						return
					}
					if ( feat == tile_plant + 2 | ogTitleSlaveToTurnips != 2 ) {
						gosub *item_seedPick
						if ( chipm(CHIPM_ROLE, mapId(cX(CHARA_PLAYER), cY(CHARA_PLAYER))) == MAP_CHIP_ROLE_CROP ) {
							val = 1
						}
						else {
							val = 0
						}
						gosub *item_seedRegrowth
						if ( featIdSub == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
							autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
							if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
								autosave = 0
							}
						}
						gosub *label_1681
					}
					hack_autofarm = 0
					return
				}
			}
			if ( featId >= CELL_FEATURE_SAMPLING_SPOT_DETECTION & featId <= CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
				if ( cfg_extrahelp ) {
					if ( gdata(STARTING_GDATA_HELP + 5) == 0 ) {
						if ( mode == MODELIST_MAIN ) {
							if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
								gdata(STARTING_GDATA_HELP + 5) = 1
								ghelp = 5
								gosub *elona_help
							}
						}
					}
				}
			}
		}
		if ( mapItemsMemory(x, y) != 0 ) {
			if ( key_ctrl == 1 & gArea  != AREA_SHOW_HOUSE ) {
				hack_autob = 1
				if ( mapitemfind(x, y, ITEM_ID_TREE_FRUIT) != (-1) ) {
					autob = mapitemfind(x, y, ITEM_ID_TREE_FRUIT)
					snd SOUNDLIST_BASH1
					if ( iProperty(autob) == PROP_NONE & iParam1(autob) != 0 ) {
						item_separate autob
						autob_x = x
						autob_y = y
						if ( iParam2(autob) == 505 ) {
							iParam1(autob)--
							if ( iParam1(autob) <= 0 ) {
								iPic(autob) = xy2pic(31, 17)
								cell_refresh autob_x, autob_y
							}
							if ( y + 1 < mHeight ) {
								if ( (chipm(CHIPM_ATTRIB, mapId(autob_x, autob_y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
									autob_y++
								}
							}
							flt
							characreate -1, CREATURE_ID_YOUNGER_SISTER, autob_x, autob_y
							txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
							skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10
						}
						else {
							treeid = autob
							iPic(treeid) = xy2pic(31, 17)
							cell_refresh autob_x, autob_y
							if ( y + 1 < mHeight ) {
								if ( (chipm(CHIPM_ATTRIB, mapId(autob_x, autob_y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
									autob_y++
								}
							}
							repeat iParam1(treeid)
								flt
								itemcreate -1, iParam2(treeid), autob_x, autob_y, 0
							loop
							txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(treeid)) + " down from the tree.")
							skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10 * iParam1(treeid)
							iParam1(treeid) = 0
						}
						return
					}
				}
				if ( mapitemfind(x, y, ITEM_ID_BOOK_BOKONON) != (-1) ) {
					autob = mapitemfind(x, y, ITEM_ID_BOOK_BOKONON)
					snd SOUNDLIST_BASH1
					if ( iProperty(autob) == PROP_NONE & iParam1(autob) != 0 ) {
						item_separate autob
						autob_x = x
						autob_y = y
						if ( iParam2(autob) == 505 ) {
							iParam1(autob)--
							if ( iParam1(autob) <= 0 ) {
								iPic(autob) = xy2pic(31, 17)
								cell_refresh autob_x, autob_y
							}
							if ( y + 1 < mHeight ) {
								if ( (chipm(CHIPM_ATTRIB, mapId(autob_x, autob_y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
									autob_y++
								}
							}
							flt
							characreate -1, CREATURE_ID_YOUNGER_SISTER, autob_x, autob_y
							txt -1, lang("妹が降ってきた。", "A younger sister falls down from the tree.")
							skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10
						}
						else {
							treeid = autob
							iPic(treeid) = xy2pic(31, 17)
							cell_refresh autob_x, autob_y
							if ( y + 1 < mHeight ) {
								if ( (chipm(CHIPM_ATTRIB, mapId(autob_x, autob_y + 1)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
									autob_y++
								}
							}
							repeat iParam1(treeid)
								flt
								if ( iParam2(treeid) != 54 ) {
									itemcreate -1, iParam2(treeid), autob_x, autob_y, 0
								}
								else {
									itemcreate -1, iParam2(treeid), autob_x, autob_y, 1000
								}
								if ( iParam2(treeid) == 619 ) {
									iSubName(ci) = 30
									iPic(ci) = xy2pic(0, 13)
									iCol(ci) = 0
									repeat
										iParam1(ci) = rnd(368)
										if ( iParam1(ci) == 212 | iParam1(ci) == 340 ) {
											continue
										}
										if ( iParam1(ci) > 353 & iParam1(ci) < 366 ) {
											iParam1(ci) = 343
										}
										if ( iParam1(ci) == 343 ) {
											if ( usernpcmax == 0 ) {
												continue
											}
											iCNpcId(ci) = rnd(usernpcmax)
											ICNpcSerialNo(ci) = createserialno(userdatan(0, iCNpcId(ci)))
										}
										break
									loop
								}
								if ( iParam2(treeid) == 734 ) {
									iValue(ci) = rnd(sGardening(CHARA_PLAYER) / 5 + 5) + 10
								}
							loop
							txt -1, lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, iParam1(treeid)) + " fall" + _s2(iParam1(treeid)) + " down from the tree.")
							skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 10 * iParam1(treeid)
							iParam1(treeid) = 0
						}
						return
					}
				}
				hack_autob = 0
			}
		}
		if ( key_ctrl ) {
			hack_plant = 1
			if ( mapItems(x, y) == 0 & mapFeat(x, y) == 0 ) {
				oom_seedlistmax = 0
				dim oom_seedlist
				inv_getheader 0
				repeat invrange, invhead
					if ( iNum(cnt) <= 0 ) {
						continue
					}
					if ( refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) != FILTER_ITEM_SEED ) {
						continue
					}
					if ( ibit(ITEM_BIT_NO_DROP, cnt) == TRUE ) {
						continue
					}
					cnt2 = cnt
					repeat 20
						if ( ogdata(36 + cnt) \ 1000000 / 10000 != 14 ) {
							continue
						}
						if ( iID(cnt2) == ogdata(36 + cnt) \ 1000000 \ 10000 ) {
							oom_seedlist(oom_seedlistmax) = cnt2
							oom_seedlistmax++
							break
						}
					loop
				loop
				if ( oom_seedlistmax ) {
					bk_ci = ci
					ci = oom_seedlist(rnd(oom_seedlistmax))
					gosub *item_seed
					ci = bk_ci
				}
			}
			hack_plant = 0
		}
	}
	return

*label_3618
	if ( dbg_freemove ) {
		txt -1, lang("デバッグ中はその操作はできない。", "You can't perform the action while in the debug mode.")
		goto *pc_turn
	}
	item_find ITEM_ID_MOON_GATE, ITEM_FIND_MODE_DBID, ITEM_FIND_LOCATION_GROUND
	if ( stat != (-1) ) {
		if ( mType == MAP_TYPE_TOWN | mType == MAP_TYPE_VILLAGE ) {
			ci = stat
			goto *label_2574
		}
	}
	cell_featread cX(cc), cY(cc)
	movelevelbystairs = FALSE
	if ( val == 1 ) {
		if ( mapitemfind(cX(cc), cY(cc), ITEM_ID_KOTATSU) != (-1) ) {
			txt -1, lang("本当にこたつの中に入る？", "Really get into the Kotatsu?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval != 0 ) {
				gosub *screen_draw
				goto *pc_turn
			}
			txt -1, lang("まっくらだ！", "It's dark here!")
			cBlind(CHARA_PLAYER) += 2
			if ( gettrait(0, 195) != 0 ) {
				cBlind(CHARA_PLAYER) = 1000
			}
			goto *label_4158
		}
	}
	if ( gArea  == AREA_HOME | areaId(gArea ) == AREA_DUNGEON ) {
		if ( val == 1 ) {
			if ( mapitemfind(cX(cc), cY(cc), ITEM_ID_DOWNSTAIRS) != (-1) ) {
				if ( gLevel  >= areaCanSave(gArea ) ) {
					txt -1, lang("これ以上降りられない。", "You can't go down any more.")
					goto *pc_turn
				}
				else {
					movelevelbystairs = 2
				}
			}
		}
		if ( val == 2 ) {
			if ( mapitemfind(cX(cc), cY(cc), ITEM_ID_UPSTAIRS) != (-1) ) {
				if ( gLevel  <= areaMinLevel(gArea ) | (areaId(gArea ) == AREA_DUNGEON & gLevel  == 1) ) {
					txt -1, lang("これ以上昇れない。", "You can't go up any more.")
					goto *pc_turn
				}
				else {
					movelevelbystairs = TRUE
				}
			}
		}
	}
	if ( movelevelbystairs == FALSE ) {
		if ( mType != MAP_TYPE_WORLD ) {
			if ( val == 1 ) {
				if ( featId != CELL_FEATURE_DOWNSTAIRS ) {
					txt -1, lang("降りる階段は見つからない。", "There're no downstairs here.")
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					movelevelbystairs = TRUE
					f = 0
					if ( oabit(13, gArea ) ) {
						if ( areaBoss(gArea ) == (-1) ) {
							f = 1
						}
					}
					if ( gArea  == AREA_VOID & gLevel  >= gVoidBoss | f ) {
						txt -1, lang("階段は不思議なバリアで塞がれている。", "The path is blocked by a strange barrier.")
						goto *pc_turn
					}
					if ( gArea  == 210 & areaBoss(gArea ) | f ) {
						txt -1, lang("階段は不思議なバリアで塞がれている。", "The path is blocked by a strange barrier.")
						goto *pc_turn
					}
				}
			}
			if ( val == 2 ) {
				if ( gArea  == 210 ) {
					txt -1, lang("あなたは階段を昇ろうとしたが、不思議なバリアで塞がれていたので登れなかった。", "You tried to climb the stairs.")
					goto *pc_turn
				}
				if ( featId != CELL_FEATURE_UPSTAIRS ) {
					txt -1, lang("昇る階段は見つからない。", "There're no upstairs here.")
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					movelevelbystairs = 2
				}
			}
		}
	}
	if ( feat == tile_downlocked ) {
		f = 0
		if ( gLevel  == 3 ) {
			if ( flagMain >= 65 ) {
				f = 1
			}
		}
		if ( gLevel  == 17 ) {
			if ( flagMain >= 115 ) {
				f = 1
			}
		}
		if ( gLevel  == 25 ) {
			if ( flagMain >= 125 ) {
				f = 1
			}
		}
		if ( gLevel  == 44 ) {
			if ( flagMain >= 125 ) {
				f = 1
			}
		}
		if ( f == 1 ) {
			if ( gLevel  == 44 ) {
				txt -1, lang("厳重に封印された扉の前に立つと、三つの魔石が鈍い光を放った。", "The magic stones shine softly as you approach the sealed door.")
			}
			else {
				txt -1, lang("扉の鍵を開けた。", "You unlock the door")
			}
			snd SOUNDLIST_CHEST1
			cell_featset cX(cc), cY(cc), tile_downstairs, CELL_FEATURE_DOWNSTAIRS
			goto *label_4158
		}
		snd SOUNDLIST_LOCKED1
		txt -1, lang("鍵のかかった扉が行く手を塞いでいる。", "The door is locked. It seems you need a specific key to unlock the door.")
		goto *label_4158
	}
	if ( areaId(gArea ) == AREA_RANDOM_DUNGEON ) {
		if ( gLevel  == areaCanSave(gArea ) ) {
			if ( areaBoss(gArea ) != (-1) ) {
				txt -1, lang("クエストを放棄して階を移動する？", "Really give up the quest and move over?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval != 0 ) {
					gosub *screen_draw
					goto *pc_turn
				}
			}
		}
	}
	if ( movelevelbystairs ) {
		actionsp CHARA_PLAYER, 15
		if ( stat == 0 | cBurden(CHARA_PLAYER) >= 3 ) {
			if ( stat == 0 | rnd(4 + 1 - cBurden(CHARA_PLAYER)) == 0 ) {
				txt -1, lang("うわああ！" + name(0) + "は階段から足を踏み外した。", "Noooo! You lost your step and roll down!")
				dmghp cc, cMHP(cc) * (cInvWeight(CHARA_PLAYER) * 10 / cCarryLimit(CHARA_PLAYER) + 10) / 100 + 1, DAMAGE_FROM_TUMBLE
				msg_halt
			}
			if ( cExist(CHARA_PLAYER) == CHAR_STATE_DEAD ) {
				goto *main_init
			}
		}
	}
	if ( featId == CELL_FEATURE_NEFIA ) {
		if ( featIdSub + featParam1 * 100 == 35 ) {
			comctrl = 0
			gosub *com_import
			if ( stat == 1 ) {
				goto *label_3122
			}
			else {
				goto *pc_turn
			}
		}
	}
	snd SOUNDLIST_EXITMAP1
	levelexitby = MAP_EXIT_NORMAL
	if ( movelevelbystairs == 2 ) {
		if ( gArea  == 53 ) {
			if ( gLevel  == 1 ) {
				gTeleportArea = AREA_SOUTH_TYRIS
				gTeleportLevel = 1
				levelexitby = MAP_EXIT_TELEPORT
			}
		}
	}
	goto *map_exit

*label_3619
	item_find ITEM_ID_LOCKPICK, ITEM_FIND_MODE_DBID
	if ( stat == (-1) ) {
		txt -1, lang("ロックピックを所持していない。", "You don't have lockpicks.")
		return 0
	}
	ti = stat
	txt -1, lang("ロックピックを使用した。", "You use a lockpick.")
	snd SOUNDLIST_LOCKED1
	item_find ITEM_ID_SKELETON_KEY, ITEM_FIND_MODE_DBID
	if ( stat != (-1) ) {
		i = sOpenLock(CHARA_PLAYER) * 150 / 100 + 5
		txt -1, lang("スケルトンキーも使用した。", "You also use the skeleton key.")
	}
	else {
		i = sOpenLock(CHARA_PLAYER)
	}
	f = 0
	if ( i * 2 < val ) {
		txt -1, lang("この鍵を開ける技術はない。", "The lock mechanism is beyond your skill.")
		f = 1
	}
	if ( f == 0 ) {
		if ( i / 2 >= val ) {
			txt -1, lang("楽勝だ。", "Easy.")
		}
		else {
			if ( rnd(rnd(i * 2) + 1) < val ) {
				txt -1, lang("開錠に失敗した。", "You fail to unlock it.")
				f = 1
				skillexp2 SKILL_NORMAL_LOCK_PICKING, cc, val / 10 + 1
			}
		}
	}
	if ( f ) {
		if ( rnd(3) == 0 ) {
			iNum(ti)--
			cell_refresh iX(ti), iY(ti)
			txt -1, lang("ロックピックは壊れた。", "Your lockpick breaks.")
		}
		txtnew
		txt -1, lang("もう一度試みる？", "Try again?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		valhinan = val
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval == 0 ) {
			goto *label_3621
		}
		return 0
	}
	goto *label_3622

*label_3621
	val = valhinan
	goto *label_3619

*label_3622
	txt -1, lang("開錠に成功した。", "You successfully unlock it.")
	r1 = cc
	r2 = val
	gosub *label_1596
	return 1

*act_open
	if ( iID(ci) == ITEM_ID_SHOPKEEPERS_TRUNK ) {
		modkarma 0, -10
		invctrl = INVCTRL_INV_FILE_GET, 0
		invfile = iParam1(ci)
		snd SOUNDLIST_CHEST1
		gosub *shop
		screenupdate = -1
		gosub *screen_draw
		goto *label_4158
	}
	if ( iID(ci) == ITEM_ID_MASTERS_DELIVERY_CHEST ) {
		invctrl = INVCTRL_PUT, 0
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( iID(ci) == ITEM_ID_TAX_MASTERS_TAX_BOX ) {
		invctrl = INVCTRL_PUT, 2
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( iID(ci) == ITEM_ID_GIANTS_SHACKLE ) {
		snd SOUNDLIST_LOCKED1
		txt -1, lang("足枷を外した。", "You unlock the shackle.")
		if ( gArea  == AREA_NOYEL ) {
			if ( gLevel  == 1 ) {
				if ( flagFireGiant == 0 ) {
					if ( cExist(fireGiantId) == CHAR_STATE_ALIVE ) {
						tc = findchara(CREATURE_ID_MOYER_THE_CROOKED)
						if ( tc != CHARA_PLAYER ) {
							txtef COLOR_SKY_BLUE
							txt -1, lang("モイアー「馬鹿やろう！！」", "Moyer yells, " + cnvtalk("You idiot!"))
							lockon fireGiantId, tc, 16
							cAiAggro(fireGiantId) = 1000
						}
						flagFireGiant = 1
					}
				}
			}
		}
		goto *label_4158
	}
	if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) != 0 ) {
		invfile = inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)
		invcontainer(1) = iID(ci)
		if ( iID(ci) == ITEM_ID_COOLER_BOX ) {
			refweight = -1
			dup ciweight, iWeight(ci)
		}
		else {
			refweight = 0
		}
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 3 ) {
			if ( gArea  != AREA_HOME ) {
				txt -1, lang("それは家の中でのみ使用できる。", "You can only use it at your home.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 4 | inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 6 | contafurniturecheck(iID(ci)) != (-1) ) {
			if ( areaType(gArea ) != MAP_TYPE_HOME ) {
				txt -1, lang("それは自分の物件でのみ使用できる。", "You can only use it at your home.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 5 ) {
			if ( areaId(gArea ) != AREA_SHOP ) {
				txt -1, lang("それは店の中でのみ使用できる。", "You can only use it at your shop")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		file = "shoptmp.s2"
		ctrlfile 4
		file = "shop" + invfile + ".s2"
		tmpload "" + file
		exist exedir + "tmp\\" + file
		if ( strsize != (-1) ) {
			ctrlfile 3
			inv_getheader -1
			repeat invrange, invhead
				if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
					getitemid cnt
				}
				checkalter cnt
				if ( ICNpcSerialNo(cnt) ) {
					getunid4item cnt
				}
			loop
		}
		else {
			inv_getheader -1
			repeat invrange, invhead
				iNum(cnt) = 0
			loop
		}
		shoptrade = 0
		invsubroutine = 1
		invctrl = INVCTRL_INV_FILE_GET, 2
		if ( invfile == 3 ) {
			txt -1, lang("残り" + gHeirDeed + "個分のアイテムの相続権を持っている。", "You can claim " + gHeirDeed + " more heirloom" + _s2(gHeirDeed) + ".")
			invctrl(1) = 1
		}
		if ( invcontainer(1) == 794 ) {
			invcontainer = 30
			menucycle = 1
			invctrl(1) = 99
		}
		if ( invcontainer(1) == 641 ) {
			invcontainer = 8
			menucycle = 1
			invctrl(1) = 3
		}
		if ( invcontainer(1) == 579 ) {
			invcontainer = 50
			menucycle = 1
			invctrl(1) = 3
		}
		if ( invfile == 10 ) {
			invcontainer = 100
			menucycle = 1
			invctrl(1) = 13
		}
		if ( invfile == 17 ) {
			invcontainer = 0
			invctrl(1) = 13
		}
		if ( contafurniturecheck(invcontainer(1)) != (-1) ) {
			invcontainer = isetcontafurniture(1, stat)
			menucycle = 1
			invctrl(1) = isetcontafurniture(2, stat)
		}
		mode = MODELIST_SHOP
		snd SOUNDLIST_INV
		gosub *label_2974
		invcontainer = 0
		if ( refweight == (-1) ) {
			refweight = iorgweight(ITEM_ID_COOLER_BOX)
		}
		file = "shop" + invfile + ".s2"
		ctrlfile 4
		file = "shoptmp.s2"
		ctrlfile 3
		if ( refweight != 0 ) {
			ciweight = refweight
			gosub *label_1681
		}
		gosub *screen_draw
		mode = MODELIST_MAIN
		goto *label_4158
	}
	item_separate ci
	if ( iParam1(ci) != 0 ) {
		if ( iParam2(ci) != 0 ) {
			val = iParam2(ci)
			gosub *label_3619
			if ( stat == 0 ) {
				screenupdate = -1
				gosub *screen_draw
				goto *label_4158
			}
		}
	}
	if ( iParam1(ci) == 0 ) {
		txt -1, lang("中身は空っぽだ。", "It's empty!")
	}
	else {
		if ( iID(ci) == ITEM_ID_NEW_YEARS_GIFT ) {
			gosub *open_newYear
		}
		else {
			gosub *act_open_SWEND1
		}
		item_stack cc, ri
	}
	screenupdate = -1
	gosub *screen_draw
	goto *label_4158

*act_open_SWEND1
	snd SOUNDLIST_CHEST1
	txt -1, lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
	if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
		msg_halt
	}
	ri = ci
	if ( iID(ri) == ITEM_ID_MATERIAL_BOX ) {
		tc = cc
		efid = SKILL_EFFECT_CREATE_MATERIAL
		efp = 100 + iParam1(ri) * 10
		iParam1(ri) = 0
		iParam2(ri) = 0
		iParam3(ri) = 0
		gosub *label_3383
		goto *label_4158
	}
	if ( oabit(16, gArea ) ) {
		if ( iID(ri) == ITEM_ID_CHEST & iParam2(ri) != 0 ) {
			val = iParam2(ri)
			gosub *label_1673
			if ( stat == 1 ) {
				txt -1, lang(name(cc) + "は罠を解除した。", "You disarm the trap.")
			}
			else {
				txt -1, lang("罠だ！", "It's trap!")
				gosub *label_4678
				gosub *screen_draw
				goto *label_4158
			}
		}
	}
	p = 3 + rnd(5)
	if ( iID(ri) == ITEM_ID_TREASURE_BALL | iID(ri) == ITEM_ID_RARE_TREASURE_BALL | iID(ri) == ITEM_ID_SMALL_GAMBLE_CHEST ) {
		p = 1
	}
	randomize iParam3(ri)
	repeat p
		dbid = 0
		if ( cnt == 0 ) {
			p = 3
		}
		else {
			p = 2
		}
		if ( iID(ri) == ITEM_ID_BEJEWELED_CHEST ) {
			if ( cnt == 0 & rnd(3) == 0 ) {
				p = 4
			}
			else {
				p = 3
			}
			if ( rnd(60) == 0 ) {
				dbid = 559
			}
		}
		flt calcobjlv(iParam1(ri)), calcfixlv(p)
		flttypemajor = fsetchest(rnd(length(fsetchest)))
		if ( cnt > 0 ) {
			if ( rnd(3) != 0 ) {
				if ( rnd(3) != 0 ) {
					flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
					flttypemajor = FILTER_GOLD
				}
				else {
					flttypemajor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
					flttypeminor = FILTER_ORE_GEM
				}
			}
		}
		if ( iID(ri) == ITEM_ID_SAFE ) {
			if ( rnd(3) != 0 ) {
				flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
				flttypemajor = FILTER_GOLD
			}
			else {
				flttypemajor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
				flttypeminor = FILTER_ORE_GEM
			}
		}
		if ( iID(ri) == ITEM_ID_TREASURE_BALL | iID(ri) == ITEM_ID_RARE_TREASURE_BALL ) {
			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			fixlv = FIX_QUALITY_GREAT
			if ( iID(ri) == ITEM_ID_RARE_TREASURE_BALL ) {
				fixlv = FIX_QUALITY_MIRACLE
			}
			if ( rnd(30) == 0 ) {
				dbid = 559
			}
			if ( iID(ri) == ITEM_ID_RARE_TREASURE_BALL & ibit(ITEM_BIT_PRECIOUS, ri) ) {
				p = rnd(3)
				if ( p == 0 ) {
					dbid = 639
				}
				if ( p == 1 ) {
					dbid = 655
				}
				if ( p == 2 ) {
					dbid = 662
				}
			}
		}
		in = 0
		if ( iID(ri) == ITEM_ID_SMALL_GAMBLE_CHEST ) {
			dbid = 54
			randomize
			if ( rnd(75) == 0 ) {
				in = 50 * iValue(ci)
			}
			else {
				in = rnd(iValue(ci) / 10 + 1) + 1
			}
		}
		if ( iID(ri) == ITEM_ID_WALLET ) {
			dbid = 54
			in = rnd(1000) + 1
			if ( rnd(5) == 0 ) {
				in = rnd(9) + 1
			}
			if ( rnd(10) == 0 ) {
				in = rnd(5000) + 5000
			}
			if ( rnd(20) == 0 ) {
				in = rnd(20000) + 10000
			}
		}
		itemcreate -1, dbid, cX(CHARA_PLAYER), cY(CHARA_PLAYER), in
	loop
	randomize
	f = 0
	if ( iID(ri) != ITEM_ID_SMALL_GAMBLE_CHEST ) {
		if ( rnd(10) == 0 ) {
			f = 1
		}
	}
	if ( iID(ri) == ITEM_ID_BEJEWELED_CHEST | iID(ri) == ITEM_ID_CHEST ) {
		p = rnd(3)
		if ( gettrait(0, 170) ) {
			p++
		}
		repeat p
			flt calcobjlv(iParam1(ri))
			flttypeminor = FILTER_ORE_GEM
			oo_num = rnd(rnd(10) + 1) + 1
			if ( rnd(5) == 0 ) {
				oo_num *= rnd(3) + 1
			}
			itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), oo_num
		loop
		if ( godcheck() == "krula" ) {
			if ( rnd(50) >= limit(cPiety(CHARA_PLAYER) / 400, 1, 30) ) {
				itemcreate -1, ITEM_ID_TREASURE_MAP, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1
			}
		}
		if ( rnd(5) == 0 ) {
			f = 1
		}
	}
	if ( f ) {
		flt
		oo_num = 1
		if ( gettrait(0, 170) ) {
			oo_num += limit(iParam1(ri) / 50, 0, 10000 - oo_num)
		}
		oo_num += rnd(1 + rnd(1 + limit(iParam1(ri) / 10, 0, 10000 - oo_num)))
		itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), oo_num
	}
	if ( iID(ri) == ITEM_ID_TREASURE_BALL | iID(ri) == ITEM_ID_RARE_TREASURE_BALL ) {
		if ( rnd(100) == 1 ) {
			itemcreate -1, ITEM_ID_MONSTER_BALL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			iSubName(ci) = 176
		}
	}
	if ( iID(ri) == ITEM_ID_TREASURE_BALL | iID(ri) == ITEM_ID_RARE_TREASURE_BALL ) {
		if ( rnd(1000) == 1 ) {
			itemcreate -1, ITEM_ID_MONSTER_BALL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			iSubName(ci) = 210
		}
	}
	snd SOUNDLIST_DING2
	txt -1, lang(itemname(ri) + "から溢れ出た高級品が、足元に散らばった。", "Several quality goods spread out from " + itemname(ri) + ".")
	autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
	if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
		autosave = 0
	}
	iParam1(ri) = 0
	if ( iID(ri) != ITEM_ID_SMALL_GAMBLE_CHEST ) {
		iParam2(ri) = 0
	}
	iParam3(ri) = 0
	if ( iID(ri) == ITEM_ID_WALLET ) {
		modkarma 0, -4
	}
	if ( iID(ri) == ITEM_ID_SUITCASE ) {
		modkarma 0, -8
	}
	return

*open_newYear
	procid = (procid + 1) \ 10
	proclist(procid) = "new year gift" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	snd SOUNDLIST_CHEST1
	txt -1, lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
	msg_halt
	snd SOUNDLIST_DING2
	randomize
	ri = ci
	cc = CHARA_PLAYER
	iParam1(ri) = 0
	procid = (procid + 1) \ 10
	proclist(procid) = "new year gift1" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( iParam3(ri) < 100 ) {
		if ( rnd(3) == 0 ) {
			procid = (procid + 1) \ 10
			proclist(procid) = "new year gift1-1" + " ct:" + ct
			if ( dbg_outputdebuglog ) {
			}
			if ( synccheck(cc, -1) ) {
				txt -1, lang("悪意を持った何かが袋から飛び出してきた！", "Something jumps out from the pack!")
			}
			repeat 3 + rnd(3)
				flt calcobjlv(difficulty() * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
				characreate -1, CREATURE_ID_BUG, cX(cc), cY(cc)
			loop
			return
		}
		if ( rnd(3) == 0 ) {
			procid = (procid + 1) \ 10
			proclist(procid) = "new year gift1-2" + " ct:" + ct
			if ( dbg_outputdebuglog ) {
			}
			if ( synccheck(cc, -1) ) {
				txt -1, lang("罠だ！お年玉袋は発火した。", "It's trap! The gift ignites.")
			}
			repeat 6
				tlocx = cX(CHARA_PLAYER) + rnd(3) - rnd(3)
				tlocy = cY(CHARA_PLAYER) - rnd(3) + rnd(3)
				if ( tlocx < 0 | tlocx >= mWidth | tlocy < 0 | tlocy >= mHeight ) {
					continue
				}
				addmef tlocx, tlocy, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50, CHARA_PLAYER
				mapitem_fire tlocx, tlocy
			loop
			return
		}
		if ( synccheck(cc, -1) ) {
			txt -1, lang("中には呪いの手紙が入っていた。", "You find a cursed letter inside.")
		}
		efid = SKILL_EFFECT_CURSE
		efp = 1000
		tc = CHARA_PLAYER
		gosub *label_3383
		return
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "new year gift2" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( iParam3(ri) < 200 ) {
		if ( rnd(4) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txtef COLOR_YELLOW
				txt -1, lang(" *チリリリリーン* ", "*ring ring ring*")
			}
			flt
			characreate -1, 328 + rnd(2), cX(cc), cY(cc)
			if ( stat != 0 ) {
				if ( cRelation(cc) <= RELATION_ENEMY ) {
					cRelation(rc) = RELATION_DISLIKE
					cOrgRelation(rc) = RELATION_DISLIKE
				}
			}
			return
		}
		if ( rnd(5) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang("妹が入っていた！", "The pack contains your younger sister!")
			}
			flt
			characreate -1, CREATURE_ID_YOUNGER_SISTER, cX(cc), cY(cc)
			if ( stat != 0 ) {
				cGold(rc) = 5000
			}
			return
		}
		if ( synccheck(cc, -1) ) {
			txt -1, lang("何かが袋から出てきた。", "There's something inside the pack.")
		}
		flt
		itemcreate -1, isetgiftminor(rnd(length(isetgiftminor))), cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1
		return
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "new year gift3" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( rnd(3) == 0 ) {
		if ( synccheck(cc, -1) ) {
			txtef COLOR_YELLOW
			txt -1, lang(" *チリリリリーン* ", "*ring ring ring*")
		}
		repeat 2 + rnd(3)
			flt
			characreate -1, 328 + rnd(2), cX(cc), cY(cc)
			if ( stat != 0 ) {
				if ( cRelation(cc) <= RELATION_ENEMY ) {
					cRelation(rc) = RELATION_DISLIKE
					cOrgRelation(rc) = RELATION_DISLIKE
				}
			}
		loop
		return
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "new year gift4" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( rnd(50) == 0 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang("これは素晴らしい贈り物だ！", "This is truly a wonderful gift!")
		}
		flt
		itemcreate -1, isetgiftgrand(rnd(length(isetgiftgrand))), cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1
		return
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "new year gift5" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( synccheck(cc, -1) ) {
		txt -1, lang("何かが袋から出てきた。", "There's something inside the pack.")
	}
	flt
	itemcreate -1, isetgiftmajor(rnd(length(isetgiftmajor))), cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1
	procid = (procid + 1) \ 10
	proclist(procid) = "new year gift end" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return

*act_openDoor
	cell_featread dx, dy
	if ( feat == tile_doorclosed4 & featIdSub > CELL_SUB_FEATURE_TRAP_IMPALEMENT ) {
		if ( cc == CHARA_PLAYER ) {
			val = featIdSub
			gosub *label_3619
			if ( stat == 0 ) {
				screenupdate = -1
				gosub *screen_draw
				await 100
				goto *label_4158
			}
			featIdSub = CELL_SUB_FEATURE_TRAP_IMPALEMENT
		}
		else {
			goto *label_4158
		}
	}
	if ( featIdSub > CELL_SUB_FEATURE_TRAP_IMPALEMENT ) {
		f = 0
		if ( rndex(featIdSub * 20 + 150) < sOpenLock(cc) * 20 + 20 ) {
			f = 1
		}
	}
	else {
		f = 1
	}
	if ( ocAIDoors(cc) == 1 ) {
		f = 0
	}
	if ( f ) {
		if ( featIdSub > CELL_SUB_FEATURE_TRAP_IMPALEMENT ) {
			r1 = cc
			r2 = featIdSub
			gosub *label_1596
		}
		if ( feat == tile_doorclosed1 ) {
			cell_featset dx, dy, tile_dooropen1, CELL_FEATURE_DOOR_OPENED, 0, -1
		}
		else {
			if ( feat == tile_doorclosed2 ) {
				cell_featset dx, dy, tile_dooropen2, CELL_FEATURE_DOOR_OPENED, 0, -1
			}
			else {
				if ( feat == tile_doorclosed3 ) {
					cell_featset dx, dy, tile_dooropen3, CELL_FEATURE_DOOR_OPENED, 0, -1
				}
				else {
					if ( feat == tile_doorclosed4 ) {
						cell_featset dx, dy, tile_dooropen4, CELL_FEATURE_DOOR_OPENED, 0, -1
					}
					else {
						cell_featset dx, dy, tile_dooropen, CELL_FEATURE_DOOR_OPENED, 0, -1
					}
				}
			}
		}
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は扉を開けた。", name(cc) + " open" + _s(cc) + " the door.")
			if ( feat == tile_doorclosed1 ) {
				snd SOUNDLIST_DOOR1
			}
			else {
				if ( feat == tile_doorclosed2 ) {
					snd SOUNDLIST_DOOR2
				}
				else {
					if ( feat == tile_doorclosed3 ) {
						snd SOUNDLIST_CARD1
					}
					else {
						if ( feat == tile_doorclosed4 ) {
							snd SOUNDLIST_DOOR1
						}
						else {
							if ( mTileSet == MAP_TILESET_SF ) {
								snd SOUNDLIST_DOOR2
							}
							else {
								if ( mTileSet == MAP_TILESET_EASTERN ) {
									snd SOUNDLIST_CARD1
								}
								else {
									snd SOUNDLIST_DOOR1
								}
							}
						}
					}
				}
			}
		}
	}
	else {
		if ( ocAIDoors(cc) != 1 ) {
			msgdup++
			if ( synccheck(cc, -1) ) {
				snd SOUNDLIST_LOCKED1
				txt -1, lang(aln(cc) + "開錠に失敗した。", name(cc) + " fail" + _s(cc) + " to open the door.")
			}
		}
	}
	if ( cc == CHARA_PLAYER ) {
		await 100
	}
	goto *label_4158

*act_close
	txt -1, lang("何を閉める？", "Which door do you want to close? ")
	gosub *screen_draw
	val = 0
	gosub *prompt_direction
	if ( stat == 0 ) {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		goto *pc_turn
	}
	cell_featread x, y
	if ( featId != CELL_FEATURE_DOOR_OPENED ) {
		txt -1, lang("その方向に閉められるものはない。", "There's nothing to close.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( mapChara(x, y) != 0 ) {
		txt -1, lang("何かが邪魔で閉められない。", "There's something on the floor.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( feat == tile_dooropen1 ) {
		cell_featset x, y, tile_doorclosed1, CELL_FEATURE_DOOR_CLOSED, -1, -1
	}
	else {
		if ( feat == tile_dooropen2 ) {
			cell_featset x, y, tile_doorclosed2, CELL_FEATURE_DOOR_CLOSED, -1, -1
		}
		else {
			if ( feat == tile_dooropen3 ) {
				cell_featset x, y, tile_doorclosed3, CELL_FEATURE_DOOR_CLOSED, -1, -1
			}
			else {
				if ( feat == tile_dooropen4 ) {
					cell_featset x, y, tile_doorclosed4, CELL_FEATURE_DOOR_CLOSED, -1, -1
				}
				else {
					cell_featset x, y, tile_doorclosed, CELL_FEATURE_DOOR_CLOSED, -1, -1
				}
			}
		}
	}
	txt -1, lang(name(cc) + "は扉を閉めた。", name(cc) + " close the door.")
	goto *label_4158

*act_fire
	if ( cc != CHARA_PLAYER ) {
		if ( efid != MAX_SKILL ) {
			if ( godcheck(cc) == "mani" & cPiety(cc) >= 200 ) {
				if ( ocHostileTargetTotal(cc) >= 3 ) {
					if ( rnd(25) == 0 ) {
						efid = MAX_SKILL
						gosub *label_4578
						if ( stat == 1 ) {
							ctalk cc, 427, cc, tc
						}
						locvar_calcmagiccontrol_bk_cw = cw
						gosub *action
						cw = locvar_calcmagiccontrol_bk_cw
						if ( stat == 1 ) {
							gosub *label_4578
							if ( stat == 1 ) {
								ctalk cc, 428, cc, tc
							}
							return
						}
					}
				}
			}
		}
	}
	dmgdisplayflag = 1 * (cfg_dmgmonitortype < 2)
	if ( zerorangefire == 0 ) {
		dim dmgpack, 5, 245
	}
	attackrange = 1
	ele = SKILL_NONE
	ammoproc = ENCHANT_AMMO_NONE
	ammox = cX(tc)
	ammoy = cY(tc)
	attackitem = cw
	if ( ammo != (-1) ) {
		if ( cc != CHARA_PLAYER ) {
			if ( petcheck(cc) == 0 | gArea  == AREA_PET_ARENA | gArea  == 49 ) {
				if ( cTurn(cc) \ 5 == 0 ) {
					p(2) = 0
					if ( ocHostileTargetTotal(cc) >= 5 ) {
						if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) >= 5 ) {
							p(2) = 1
						}
						else {
							p(2) = 5
						}
					}
					else {
						if ( badstatuscheck(cc) == 0 ) {
							p(2) = 3
						}
						else {
							if ( cLevel(tc) > cLevel(cc) ) {
								p(2) = 2
							}
							else {
								if ( rnd(25) == 0 ) {
									p(2) = 4
								}
							}
						}
					}
					if ( loadedammo(ammo, p(2)) == 0 ) {
						repeat 2
							if ( encpfindspec(ammo, 90000 + p(2), p) != (-1) ) {
								if ( p(1) \ 1000 > 0 ) {
									txt -1, lang(aln(cc) + ammoname(p(2)) + "を装填した。", "You load " + ammoname(p(2)) + ".")
									inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) = p
									break
								}
							}
							p(2) = 0
						loop
					}
				}
			}
			else {
				if ( ocAISpecialAmmo(cc) > AI_SPECIAL_AMMO_NORMAL ) {
					if ( loadedammo(ammo, ocAISpecialAmmo(cc) - 1) == 0 ) {
						if ( encpfindspec(ammo, 90000 + ocAISpecialAmmo(cc) - 1, p) != (-1) ) {
							if ( p(1) \ 1000 > 0 ) {
								txt -1, lang(aln(cc) + ammoname(ocAISpecialAmmo(cc) - 1) + "を装填した。", "You load " + ammoname(ocAISpecialAmmo(cc) - 1) + ".")
								inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) = p
							}
						}
						else {
							ocAISpecialAmmo(cc) = AI_SPECIAL_AMMO_NORMAL
						}
					}
				}
				if ( ocAISpecialAmmo(cc) == AI_SPECIAL_AMMO_NORMAL ) {
					if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) != (-1) ) {
						txt -1, lang(aln(cc) + "通常弾を装填した。", name(cc) + " load normal ammo.")
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) = -1
					}
				}
			}
		}
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) != (-1) ) {
			if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) * 2, ammo) \ 1000 <= 0 ) {
				txt -1, lang("通常弾を装填した。", "You load normal ammo.")
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) = -1
			}
			else {
				ammoproc = inv(STARTING_INV_ITEM_ENCHANT + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) * 2, ammo) \ 10000
				if ( cc == CHARA_PLAYER ) {
					if ( cSP(CHARA_PLAYER) < 50 ) {
						if ( cSP(CHARA_PLAYER) < rnd(75) ) {
							txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
							dmgsp CHARA_PLAYER, encammoref(ENCAMMOREF_SP_COST, ammoproc) / 2 + 1
							ammoproc = ENCHANT_AMMO_NONE
							return 1
						}
					}
					dmgsp CHARA_PLAYER, rnd(encammoref(ENCAMMOREF_SP_COST, ammoproc) + 1)
				}
				if ( ammoproc == ENCHANT_AMMO_TIME_STOP ) {
					if ( counterattack ) {
						txt -1, lang("今は使えない。", "You can't use that ammo right now.")
						ammoproc = ENCHANT_AMMO_NONE
						return 1
					}
				}
				if ( efid == 766 ) {
					inv(STARTING_INV_ITEM_ENCHANT_POWER + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) * 2, ammo) -= rounds
				}
				else {
					f = 1
					if ( gettrait(cc, 77) ) {
						if ( rnd(100) < stat * 20 + 10 ) {
							f = 0
						}
					}
					if ( f ) {
						inv(STARTING_INV_ITEM_ENCHANT_POWER + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) * 2, ammo)--
					}
				}
			}
		}
	}
	if ( ocbit(11, cc) ) {
		if ( gettrait(cc, 180) ) {
			if ( ammoproc == ENCHANT_AMMO_NONE ) {
				modstress -75
			}
			else {
				modstress -1250
			}
		}
	}
	if ( cfg_dmgmonitor != 0 & cfg_dmgmonitortype == 2 & zerorangefire == 1 ) {
		dim dmgpack, 5, 245
	}
	if ( ammoproc == ENCHANT_AMMO_RAPID ) {
		ammoprocbk = 0
		repeat 3
			ele = SKILL_NONE
			extraattack = 0
			gosub *act_attack
			if ( cExist(tc) != CHAR_STATE_ALIVE ) {
				gosub *label_3023
				if ( stat == 0 ) {
					break
				}
				else {
					tc = ocHostileTarget1(cc) - 1
				}
			}
		loop
	}
	else {
		if ( ammoproc == ENCHANT_AMMO_BURST ) {
			ammoprocbk = 5
			repeat 10
				ele = SKILL_NONE
				gosub *label_3033
				if ( listmax == 0 ) {
					break
				}
				tc = list(0, rnd(listmax))
				if ( cc == CHARA_PLAYER | cRelation(cc) >= RELATION_NEUTRAL ) {
					if ( cRelation(tc) >= RELATION_NEUTRAL ) {
						if ( cnt != 0 ) {
							continue cnt + (rnd(5) == 0)
						}
					}
				}
				else {
					if ( cRelation(tc) == RELATION_ENEMY ) {
						continue cnt + (rnd(5) == 0)
					}
				}
				extraattack = 0
				gosub *act_attack
			loop
		}
		else {
			extraattack = 0
			gosub *act_attack
		}
	}
	if ( cfg_dmgmonitortype > 1 & zerorangefire == 0 | (cfg_dmgmonitortype == 2 & zerorangefire == 1) ) {
		repeat 245
			if ( dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0 ) {
				continue
			}
			if ( synccheck(cnt, -1) == 1 ) {
				if ( cfg_dmgtxttype == 1 ) {
					if ( oom_attack_f == 1 ) {
						if ( dmgpack(2, cnt) == 0 ) {
							if ( dmgpack(3, cnt) == 0 ) {
								txt -1, lang("" + cnName(cnt) + "は攻撃を避けた。", cnName(cnt) + " evade" + _s(cnt) + " attack.")
							}
							else {
								txt -1, lang("" + cnName(cnt) + "は攻撃に巻き込まれた。", cnName(cnt) + " " + is(cnt) + " attacked.")
							}
						}
						else {
							if ( dmgpack(2, cnt) == 1 ) {
								locvar_calcmagiccontrol_nattack = ""
							}
							else {
								if ( dmgpack(2, cnt) == 2 ) {
									locvar_calcmagiccontrol_nattack = lang("2回", " twice")
								}
								else {
									locvar_calcmagiccontrol_nattack = dmgpack(2, cnt) + lang("回", " times")
								}
							}
							txt -1, lang("" + name(cc) + "は" + cnName(cnt) + "を" + locvar_calcmagiccontrol_nattack + "攻撃した。", name(cc) + " attacked " + cnName(cnt) + " " + locvar_calcmagiccontrol_nattack + ".")
						}
					}
				}
			}
			if ( showdamagecheck(dmgpack(1, cnt)) ) {
				if ( dmgpack(2, cnt) != 0 | dmgpack(3, cnt) \ 1000 != 0 ) {
					mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 111
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					continue
				}
			}
			if ( cfg_dmgmonitor3 == 1 ) {
				if ( dmgpack(2, cnt) == 0 & dmgpack(3, cnt) / 1000 == 0 ) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 106
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		loop
	}
	attackvar = 0
	ammoproc = ENCHANT_AMMO_NONE
	ammoprocbk = -1
	return

*label_3640
	if ( cc != CHARA_PLAYER ) {
		if ( efid != SKILL_SPACT_SWARM ) {
			if ( cBarrier(tc) ) {
				if ( distance < 6 ) {
					if ( fov_los(cX(cc), cY(cc), cX(tc), cY(tc)) ) {
						gosub *label_3030
						if ( stat == 1 ) {
							gosub *act_fire
						}
					}
				}
				if ( cHP(cc) < cMHP(cc) / 2 ) {
					return
				}
			}
		}
	}
	dmgdisplayflag = 1 * (cfg_dmgmonitortype < 2)
	dim dmgpack, 5, 245
	attacknum = 0
	attackrange = 0
	attackskill = SKILL_WEAPON_MARTIAL_ARTS
	ammo = -1
	ele = SKILL_NONE
	if ( cAttackStyle(cc) & 1 ) {
		if ( limit(sqrt(sShield(cc)) - 3, 1, 5) + cbit(CHARA_BIT_BREAK_WALLS, cc) * 5 > rnd(100) ) {
			gosub *label_4711
			if ( gettrait(cc, 43) >= 2 ) {
				p = stat
				if ( limit(sqrt(sShield(cc)) - 3, 1, 5) + (p == 3) * 5 > rnd(100) ) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
					gosub *label_4711
				}
			}
		}
	}
	repeat 30
		body = 100 + cnt
		if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 10 ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 11 ) {
			continue
		}
		attackrange = 0
		ammo = -1
		ele = SKILL_NONE
		cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
		attackitem = cw
		if ( iDice1(cw) > 0 ) {
			attacknum++
			extraattack = 0
			if ( iequiploc(cw) == 10 ) {
				gosub *label_4654
				gosub *label_3031
				if ( stat == 1 ) {
					zerorangefire = 1
					gosub *act_fire
				}
			}
			else {
				attackskill = iSkillRef(cw)
				gosub *label_3643
			}
		}
	loop
	if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
		extraattack = 0
		gosub *label_3643
	}
	attackvar = 0
	if ( cfg_dmgmonitortype == 3 ) {
		repeat 245
			if ( dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0 ) {
				continue
			}
			if ( synccheck(cnt, -1) ) {
				if ( cfg_dmgtxttype == 1 ) {
					if ( oom_attack_f == 1 ) {
						if ( dmgpack(2, cnt) == 0 ) {
							if ( dmgpack(3, cnt) == 0 ) {
								txt -1, lang("" + cnName(cnt) + "は攻撃を避けた。", cnName(cnt) + " evade" + _s(cnt) + " attack.")
							}
							else {
								txt -1, lang("" + cnName(cnt) + "は攻撃に巻き込まれた。", cnName(cnt) + " " + is(cnt) + " attacked.")
							}
						}
						else {
							if ( dmgpack(2, cnt) == 1 ) {
								locvar_calcmagiccontrol_nattack = ""
							}
							else {
								if ( dmgpack(2, cnt) == 2 ) {
									locvar_calcmagiccontrol_nattack = lang("2回", " twice")
								}
								else {
									locvar_calcmagiccontrol_nattack = dmgpack(2, cnt) + lang("回", " times")
								}
							}
							txt -1, lang("" + name(cc) + "は" + cnName(cnt) + "を" + locvar_calcmagiccontrol_nattack + "攻撃した。", name(cc) + " attacked " + cnName(cnt) + " " + locvar_calcmagiccontrol_nattack + ".")
						}
					}
				}
			}
			if ( showdamagecheck(dmgpack(1, cnt)) ) {
				if ( dmgpack(2, cnt) != 0 | dmgpack(3, cnt) \ 1000 != 0 ) {
					mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 111
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					continue
				}
			}
			if ( cfg_dmgmonitor3 == 1 ) {
				if ( dmgpack(2, cnt) == 0 & dmgpack(3, cnt) / 1000 == 0 ) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 106
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		loop
	}
	zerorangefire = 0
	return

*label_3643
	if ( cfg_dmgmonitor != 0 & cfg_dmgmonitortype == 2 ) {
		dim dmgpack, 5, 245
	}
	gosub *act_attack
	if ( cfg_dmgmonitortype == 2 ) {
		repeat 245
			if ( dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0 ) {
				continue
			}
			if ( synccheck(cnt, -1) == 1 ) {
				if ( cfg_dmgtxttype == 1 ) {
					if ( oom_attack_f == 1 ) {
						if ( dmgpack(2, cnt) == 0 ) {
							if ( dmgpack(3, cnt) == 0 ) {
								txt -1, lang("" + cnName(cnt) + "は攻撃を避けた。", cnName(cnt) + " evade" + _s(cnt) + " attack.")
							}
							else {
								txt -1, lang("" + cnName(cnt) + "は攻撃に巻き込まれた。", cnName(cnt) + " " + is(cnt) + " attacked.")
							}
						}
						else {
							if ( dmgpack(2, cnt) == 1 ) {
								locvar_calcmagiccontrol_nattack = ""
							}
							else {
								if ( dmgpack(2, cnt) == 2 ) {
									locvar_calcmagiccontrol_nattack = lang("2回", " twice")
								}
								else {
									locvar_calcmagiccontrol_nattack = dmgpack(2, cnt) + lang("回", " times")
								}
							}
							txt -1, lang("" + name(cc) + "は" + cnName(cnt) + "を" + locvar_calcmagiccontrol_nattack + "攻撃した。", name(cc) + " attacked " + cnName(cnt) + " " + locvar_calcmagiccontrol_nattack + ".")
						}
					}
				}
			}
			if ( showdamagecheck(dmgpack(1, cnt)) ) {
				if ( dmgpack(2, cnt) != 0 | dmgpack(3, cnt) \ 1000 != 0 ) {
					mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 111
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					continue
				}
			}
			if ( cfg_dmgmonitor3 == 1 ) {
				if ( dmgpack(2, cnt) == 0 & dmgpack(3, cnt) / 1000 == 0 ) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
					ccolor 106
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		loop
	}
	return

*act_attack
	oom_attack_f = 1
	if ( cExist(cc) != CHAR_STATE_ALIVE ) {
		return
	}
	if ( cExist(tc) != CHAR_STATE_ALIVE ) {
		return
	}
	if ( cFear(cc) != 0 ) {
		oom_attack_f = 0
		msgdup++
		txt -1, lang(name(cc) + "は怖気づいた。", name(cc) + " " + is(cc) + " frightened.")
		return
	}
	if ( gettrait(cc, 188) == (-1) | (gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_12) & cc < MAX_CHARA_NC) ) {
		oom_attack_f = 0
		msgdup++
		txt -1, lang(name(cc) + "は攻撃できない。", name(cc) + " can't attack.")
		return
	}
	if ( cfg_dmgmonitortype == 1 ) {
		dim dmgpack, 5, 245
		dmgdisplayflag = 1 * (cfg_dmgmonitortype < 2)
	}
	dmgpack(0, tc)++
	if ( mapMef(cX(tc), cY(tc)) != 0 ) {
		i = mapMef(cX(tc), cY(tc)) - 1
		if ( mefExist(i) == MEF_TYPE_MIST ) {
			if ( rnd(2) == 0 ) {
				if ( cfg_dmgmonitortype < 2 & cfg_dmgmonitor3 == 1 ) {
					mondmgn(mondmgcnt) = "miss"
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, tc, cc
					ccolor 106
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
				if ( synccheck(cc, -1) ) {
					if ( cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0 ) {
						txt -1, lang(name(cc) + "は霧の中の幻影を攻撃した。", name(cc) + " attack" + _s(cc) + " an illusion in the mist.")
					}
				}
				return
			}
		}
	}
	if ( attackrange == 1 ) {
		if ( efid != (-4) ) {
			animeid = attackskill
			aniref = cw
			gosub *anime
		}
	}
	if ( attacknum > 1 | cc != CHARA_PLAYER ) {
	}
	expmodifer = 1 + cbit(CHARA_BIT_SANDBAG, tc) * 15 + cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) + cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) + (gArea  == AREA_SHOW_HOUSE) + oabit(8, gArea ) * 15
	hit = calcattackhit()
	i = 0
	if ( hit == 1 ) {
		attack_weakguard
		if ( critical ) {
			if ( cc == CHARA_PLAYER ) {
				if ( efid != (-13) & efid != (-15) ) {
					if ( cfg_dmgtxttype == 0 ) {
						ctalk cc, 1344, cc, tc
						if ( stat == 0 ) {
							txtef COLOR_RED
							txt -1, lang("会心の一撃！ ", "Critical Hit!")
						}
					}
				}
			}
		}
		dmg = calcattackdmg()
		dmgbk = dmg
		if ( synccheck(cc, -1) ) {
			if ( cc == CHARA_PLAYER | (cfg_npcattackanime == 1 & petcheck(cc)) | cfg_npcattackanime == 2 ) {
				if ( cfg_attackanime ) {
					if ( efid != (-15) ) {
						animeid = ANIMATION_NORMAL_ATTACK
					}
					else {
						animeid = 24
					}
					aniref = dmg * 100 / cMHP(tc)
					gosub *anime
				}
			}
		}
		if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( iQuality(cw) >= FIX_QUALITY_MIRACLE ) {
				if ( iQuality(cw) == FIX_QUALITY_UNIQUE ) {
					if ( iParam3(cw) > 0 & iID(cw) != ITEM_ID_CARNEADES_PLANK ) {
						s(1) = itemname(cw)
					}
					else {
						s(1) = lang("", "The ") + iknownnamecnv(cw)
					}
				}
				else {
					if ( iSubName(cw) >= 40000 ) {
						randomize iSubName(cw) - 40000
						if ( iParam3(cw) > 0 & iID(cw) != ITEM_ID_CARNEADES_PLANK ) {
							s(1) = itemname(cw)
						}
						else {
							s(1) = random_title(1)
						}
						randomize timeGetTime()
					}
					else {
						if ( iParam3(cw) > 0 & iID(cw) != ITEM_ID_CARNEADES_PLANK ) {
							s(1) = itemname(cw)
						}
						else {
							s(1) = lang("", "The ") + iknownnamecnv(cw)
						}
					}
				}
				if ( iParam3(cw) == 0 | iID(cw) == ITEM_ID_CARNEADES_PLANK ) {
					if ( iQuality(cw) == FIX_QUALITY_GODLY ) {
						s(1) = lang("《", "{") + s(1) + lang("》", "}")
					}
					else {
						s(1) = lang("『", "<") + s(1) + lang("』", ">")
					}
				}
				if ( synccheck(cc, -1) ) {
					if ( rnd(5) == 0 ) {
						if ( cfg_dmgtxttype == 0 ) {
							txtef COLOR_SKY_BLUE
							txt -1, lang(name(cc) + "は" + s(1) + "を誇らしげに構えた。", name(cc) + " wield" + _s(cc) + " " + s(1) + " proudly.")
						}
					}
				}
				i = 1
			}
		}
		if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( cdata(CDATA_ELEMENT, cc) != 0 ) {
				ele = cdata(CDATA_ELEMENT, cc) / 100000
				elep = cdata(CDATA_ELEMENT, cc) \ 100000
			}
		}
		if ( synccheck(tc, -1) ) {
			if ( cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0 ) {
				if ( extraattack ) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
				}
				if ( cfg_dmgtxttype == 1 ) {
					txt -1, lang(aln(cc) + name(tc) + "を攻撃した。", name(cc) + " " + _melee(1, cMeleeStyle(cc)) + _s(cc) + " " + name(tc) + ".")
				}
				else {
					if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を" + _melee(0, cMeleeStyle(cc)), name(cc) + " " + _melee(0, cMeleeStyle(cc)) + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + _melee(1, cMeleeStyle(cc)), name(cc) + " " + _melee(1, cMeleeStyle(cc)) + _s(cc) + " " + name(tc) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_BOW ) {
						s = lang("弓", "bow")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_CROSSBOW ) {
						s = lang("クロスボウ", "crossbow")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_FIREARM ) {
						s = lang("銃", "gun")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_LONGSWORD ) {
						s = lang("長剣", "sword")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_POLEARM ) {
						s = lang("槍", "spear")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を突き刺して", name(cc) + " stab" + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で刺された。", name(cc) + " stab" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_STAVE ) {
						s = lang("杖", "staff")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を打って", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で打たれた。", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_SHORTSWORD ) {
						s = lang("短剣", "dagger")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を突き刺して", name(cc) + " stab" + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で刺された。", name(cc) + " stab" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_BLUNT ) {
						s = lang("鈍器", "mace")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を打って", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で打たれた。", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_AXE ) {
						s = lang("斧", "axe")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_SCYTHE ) {
						s = lang("鎌", "scythe")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
						}
					}
					if ( attackskill == SKILL_WEAPON_THROWING ) {
						s = itemname(cw, 1, 1, 1)
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							dmgType = 2
							txt -1, lang(aln(cc) + name(tc) + "に" + s + "を投げ", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt -1, lang(aln(tc) + name(cc) + "に" + s + "で攻撃された。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s + ".")
						}
					}
				}
			}
		}
		dmgpack(2, tc)++
		dmghp tc, dmg + overdamage, cc, ele, elep
		if ( rtdmg > cMHP(tc) / 20 | rtdmg > sHealing(tc) | rnd(5) == 0 ) {
			if ( critical ) {
				skillexp2 SKILL_NORMAL_EYE_OF_MIND, cc, limit(limit(cPV(tc), 0, 10000) * limit(rtdmg, 1, 100000) / 250 + 60, 60, 300) / expmodifer, 2
			}
			skillexp2 attackskill, cc, limit(sEvade(tc) * 2 - sdata(attackskill, cc) + 1, 5, 150) / expmodifer, 0, 4
			if ( attackrange == 0 ) {
				skillexp2 SKILL_NORMAL_TACTICS, cc, limit(limit(cPV(tc), 0, 10000) * limit(rtdmg, 1, 100000) / 250 + 20, 20, 100) / expmodifer, 0, 4
				if ( cAttackStyle(cc) & 2 ) {
					p = 20
					if ( sEvade(tc) > sTwoHand(cc) ) {
						p = limitmax(sEvade(tc) - sTwoHand(cc) + p, 100)
					}
					skillexp2 SKILL_NORMAL_TWO_HAND, cc, p / expmodifer, 0, 4
				}
			}
			else {
				if ( attackskill == SKILL_WEAPON_THROWING | iID(cw) == ITEM_ID_SHORT_BOW ) {
					skillexp2 SKILL_NORMAL_TACTICS, cc, limit(limit(cPV(tc), 0, 10000) * limit(rtdmg, 1, 10000) / 250 + 10, 10, 50) / expmodifer, 0, 4
				}
				else {
					skillexp2 SKILL_NORMAL_MARKSMAN, cc, limit(limit(cPV(tc), 0, 10000) * limit(rtdmg, 1, 10000) / 250 + 25, 25, 125) / expmodifer, 0, 4
				}
			}
			if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
				if ( cAttackStyle(cc) & 4 ) {
					cw2 = -1
					repeat 30
						body = 100 + cnt
						if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
							continue
						}
						if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 10 ) {
							cw2 = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
							break
						}
					loop
					if ( cw != cw2 ) {
						p = 20
						if ( sEvade(tc) > sTwoWield(cc) ) {
							p = limitmax(sEvade(tc) - sTwoWield(cc) + p, 100)
						}
						skillexp2 SKILL_NORMAL_DUAL_WIELD, cc, p / expmodifer, 0, 4
					}
				}
			}
			if ( cc == CHARA_PLAYER & gRider != 0 | ocPetRidingIdx(cc) != 0 ) {
				p = 30
				if ( sEvade(tc) > sRiding(cc) ) {
					p = limitmax(sEvade(tc) - sRiding(cc) + p, 150)
				}
				skillexp2 SKILL_ACTIVE_RIDING, cc, p / expmodifer, 0, 5
			}
			if ( cExist(tc) == CHAR_STATE_ALIVE ) {
				skillexp2 carmor(tc), tc, limit(250 * rtdmg / cMHP(tc) + 1, 3, 250) / expmodifer, 0, 5
				if ( cAttackStyle(tc) & 1 ) {
					skillexp2 SKILL_NORMAL_SHIELD, tc, limit(160 * rtdmg / cMHP(tc) + 40, 40, 200) / expmodifer, 0, 4
				}
			}
			if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
				cw = attackitem
				if ( ibit(ITEM_BIT_ALIVE, cw) ) {
					if ( cbit(CHARA_BIT_SANDBAG, tc) == FALSE ) {
						exp = limit(rtdmg, 0, cMHP(tc)) / 5
						gosub *label_4573
					}
				}
			}
		}
		else {
			if ( critical ) {
				skillexp2 SKILL_NORMAL_EYE_OF_MIND, cc, 60 / expmodifer, 2
			}
		}
		critical = 0
		if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( cAttackStyle(cc) == STYLE_NONE ) {
				if ( gettrait(cc, 69) ) {
					if ( rnd(100) < calctraitscore(stat) ) {
						dmgcon tc, CONDITION_DIM, 50 + int(sqrt(sMartial(cc))) * 15
					}
				}
			}
			gosub *label_4382
			check_adddamage_punch
		}
		else {
			gosub *act_attackSub
		}
		dmg = dmgbk
		if ( cReflectDamage(tc) > 0 ) {
			if ( attackrange == 0 ) {
				if ( ogTitleAreus != 2 ) {
					dmghp cc, int(limitf(double(dmg) * cReflectDamage(tc) / 100 + 1, 1, 20000000)), tc, SKILL_RESDMG_CUT, 100
				}
				else {
					dmghp cc, int(limitf(double(dmg) * cReflectDamage(tc) / 100 + 1, 1, 2000000000)), tc, SKILL_RESDMG_CUT, 100
				}
			}
		}
		if ( cBarrier(tc) != 0 ) {
			p = cBarrier(tc) \ 1000
			ccbk = cc
			repeat 1
				if ( attackrange == 0 ) {
					if ( p == 61 ) {
						if ( synccheck(cc, -1) ) {
							txtef COLOR_PURPLE
							txt -1, lang("棘が" + name(cc) + "に刺さった。", name(cc) + " " + is(cc) + " stuck by several thorns.")
						}
						dmghp cc, limit(dmg / 10, 1, cMHP(tc) / 10), tc, p, cBarrier(tc) / 1000
						break
					}
					else {
						if ( p == 62 ) {
							if ( synccheck(cc, -1) ) {
								txtef COLOR_PURPLE
								txt -1, lang("エーテルの棘が" + name(cc) + "に刺さった。", name(cc) + " " + is(cc) + " stuck by several ether thorns.")
							}
							dmghp cc, limit(dmg / 10, 1, cMHP(tc) / 10), tc, p, cBarrier(tc) / 1000
							break
						}
						else {
							if ( p == 63 ) {
								if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
									if ( rnd(5) == 0 ) {
										item_acid cc, cw
									}
								}
							}
							else {
								if ( synccheck(cc, -1) ) {
									txtef COLOR_PURPLE
									txt -1, lang(elename(p) + "オーラが" + name(cc) + "を襲った。", name(cc) + " " + is(cc) + " stuck by several " + elename(p) + " thorns.")
								}
								dmghp cc, limit(dmg / 10, 1, cMHP(tc) / 10), tc, p, cBarrier(tc) / 1000
								break
							}
						}
					}
				}
				if ( dmg > cMHP(tc) / 10 ) {
					cc = tc
					tlocx = cX(cc)
					tlocy = cY(cc)
					if ( p == 63 ) {
						if ( synccheck(tc, -1) ) {
							txtef COLOR_PURPLE
							txt -1, lang("酸が飛び散った。", "Acids spread over the ground.")
						}
						efid = SKILL_SPELL_ACID_GROUND
						efp = cBarrier(tc) / 1000
						gosub *label_3383
						break
					}
				}
			loop
			cc = ccbk
		}
		if ( eqfaction(tc, "overwish") & rnd(10) == 0 & cHP(tc) >= 0 ) {
			txtef COLOR_PURPLE
			txt -1, lang(name(cc) + "に破滅の願いが降りかかる！", "")
			animeid = ANIMATION_GENE
			animode = cc
			gosub *anime
			addbuff cc, 62, 1, 20000, 2100000000
			txtef COLOR_BLUE
			txt -1, lang(name(cc) + "の魂が削られた！", "")
			cHP(cc) -= cMHP(cc) / 2 + rnd(100000)
			dmghp cc, 10000, tc, SKILL_RESDMG_CUT, 100
		}
		ccadd = cc
		tcadd = tc
		cc = tc
		tc = ccadd
		check_adddamage_count carmor(cc)
		cc = ccadd
		tc = tcadd
	}
	else {
		if ( synccheck(cc, -1) ) {
			if ( cc == CHARA_PLAYER | (cfg_npcattackanime == 1 & petcheck(cc)) | cfg_npcattackanime == 2 ) {
				snd SOUNDLIST_MISS
			}
		}
		if ( sdata(attackskill, cc) > sEvade(tc) | rnd(5) == 0 ) {
			p = limit(sdata(attackskill, cc) - sEvade(tc) / 2 + 1, 1, 60) / expmodifer
			skillexp2 SKILL_NORMAL_EVASION, tc, p, 0, 4
			skillexp2 SKILL_NORMAL_GREATER_EVASION, tc, p, 0, 4
		}
	}
	if ( cfg_dmgmonitortype == 1 ) {
		if ( showdamagecheck(dmgpack(1, cnt)) ) {
			repeat 245
				if ( dmgpack(3, cnt) \ 1000 == 0 ) {
					continue
				}
				mondmgn(mondmgcnt) = "" + dmgpack(1, cnt)
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, cnt, cc
				ccolor 105
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 255, 255, 255, 150, 150, 150
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			loop
		}
		if ( cfg_dmgtxttype == 1 ) {
			if ( oom_attack_f == 1 ) {
				repeat 245
					if ( synccheck(cnt, -1) == 1 ) {
						if ( dmgpack(0, cnt) == 0 & dmgpack(3, cnt) == 0 ) {
							continue
						}
						if ( dmgpack(2, cnt) == 0 ) {
							if ( dmgpack(3, cnt) == 0 ) {
								txt -1, lang("" + cnName(cnt) + "は攻撃を避けた。", cnName(cnt) + " evade" + _s(cnt) + " attack.")
							}
							else {
								txt -1, lang("" + cnName(cnt) + "は攻撃に巻き込まれた。", cnName(cnt) + " " + is(cnt) + " attacked.")
							}
						}
						else {
							txt -1, lang("" + name(cc) + "は" + cnName(cnt) + "を攻撃した。", name(cc) + " attacked " + cnName(cnt) + ".")
						}
					}
				loop
			}
		}
	}
	if ( hit == (-1) ) {
		if ( synccheck(cc, -1) ) {
			if ( cfg_dmgmonitortype < 2 & cfg_dmgmonitor3 == 1 ) {
				mondmgn(mondmgcnt) = "miss"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, tc, cc
				ccolor 106
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
			if ( cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0 ) {
				if ( extraattack ) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
				}
				if ( petcheck(tc) ) {
					txt -1, lang(aln(tc) + name(cc) + "の攻撃を避けた。", name(tc) + " evade" + _s(tc) + " " + name(cc) + ".")
				}
				else {
					txt -1, lang(aln(cc) + "攻撃をかわされた。", name(cc) + " miss" + _s(cc, 1) + " " + name(tc) + ".")
				}
			}
		}
		ccadd = cc
		tcadd = tc
		cc = tc
		tc = ccadd
		check_adddamage_count SKILL_NORMAL_GREATER_EVASION
		cc = ccadd
		tc = tcadd
	}
	if ( hit == (-2) ) {
		if ( synccheck(cc, -1) ) {
			if ( cfg_dmgmonitortype < 2 & cfg_dmgmonitor3 == 1 ) {
				mondmgn(mondmgcnt) = "evade!!"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 255, 255, 255, 0, 0, 0, tc, cc
				ccolor 107
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 255, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
			if ( cfg_dmgtxttype == 0 | cfg_dmgmonitortype == 0 ) {
				if ( extraattack ) {
					txt -1, lang("さらに", "Furthermore,")
					txtcontinue
				}
				if ( petcheck(tc) ) {
					txt -1, lang(aln(tc) + name(cc) + "の攻撃を華麗に避けた。", name(tc) + " skillfully evade" + _s(tc) + " " + name(cc) + ".")
				}
				else {
					txt -1, lang(aln(cc) + "攻撃を華麗にかわされた。", name(tc) + " skillfully evade" + _s(tc) + " " + name(cc) + ".")
				}
			}
		}
		if ( gettrait(tc, 71) ) {
			if ( rnd(10) < calctraitscore(stat) ) {
				counterattack++
			}
		}
		ccadd = cc
		tcadd = tc
		cc = tc
		tc = ccadd
		check_adddamage_count SKILL_NORMAL_GREATER_EVASION
		cc = ccadd
		tc = tcadd
	}
	if ( tc == CHARA_PLAYER ) {
		gRun  = 0
	}
	rowact_check tc
	if ( extraattack == 0 ) {
		if ( attackrange ) {
			if ( rnd(100) < cExtraShoot(cc) ) {
				ammoproc = ENCHANT_AMMO_NONE
				extraattack++
				goto *act_attack
			}
		}
		else {
			if ( rnd(100) < cExtraMelee(cc) ) {
				extraattack++
				goto *act_attack
			}
		}
	}
	else {
		if ( attackskill == SKILL_WEAPON_LONGSWORD | attackskill == SKILL_WEAPON_SHORTSWORD ) {
			if ( gettrait(cc, 75) > 1 ) {
				if ( extraattack < stat ) {
					if ( rnd(100) < cExtraMelee(cc) ) {
						extraattack++
						goto *act_attack
					}
				}
			}
		}
		if ( extraattack == 1 ) {
			if ( attackrange == 0 ) {
				if ( cc == CHARA_PLAYER ) {
					if ( ogTitleDualWieldMastery == 2 ) {
						if ( cAttackStyle(cc) & 4 ) {
							if ( rnd(200) < cExtraMelee(cc) ) {
								extraattack++
								goto *act_attack
							}
						}
					}
				}
			}
			else {
				if ( attackskill == SKILL_WEAPON_CROSSBOW | (attackskill == SKILL_WEAPON_FIREARM & godcheck(cc) == "mani") | (attackskill == SKILL_WEAPON_BOW & godcheck(cc) == "lulwy") ) {
					extraattack++
					goto *act_attack
				}
			}
		}
		if ( extraattack > 1 ) {
			if ( attackskill == SKILL_WEAPON_CROSSBOW ) {
				if ( extraattack <= limit(sCrossBow(cc) / 200 + 1, 1, 6) ) {
					extraattack++
					goto *act_attack
				}
			}
			if ( attackskill == SKILL_WEAPON_FIREARM & godcheck(cc) == "mani" | (attackskill == SKILL_WEAPON_BOW & godcheck(cc) == "lulwy") ) {
				if ( extraattack <= limit(sqrt(cPiety(cc)) / 100 + 1, 1, 4) ) {
					extraattack++
					goto *act_attack
				}
			}
		}
	}
	return

*act_attackSub
	if ( ammo == (-1) ) {
		oom_pot_enchant = attackitem
	}
	else {
		oom_pot_enchant = ammo
	}
	if ( ibit(ITEM_BIT_POISON_BLEND, oom_pot_enchant) ) {
		_switch_val = inv(36, oom_pot_enchant) \ 1000
		if ( _switch_val == 27 ) {
			dmgcon tc, CONDITION_BLIND, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
		}
		else {
			if ( _switch_val == 28 ) {
				dmgcon tc, CONDITION_CONFUSE, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
			}
			else {
				if ( _switch_val == 29 ) {
					dmgcon tc, CONDITION_PARALYZE, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
				}
				else {
					if ( _switch_val == 30 ) {
						dmgcon tc, CONDITION_SLEEP, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
					}
					else {
						if ( _switch_val == 262 ) {
							dmgcon tc, CONDITION_POISON, inv(36, oom_pot_enchant) / 1000 / 5 + sdata(attackskill, cc) * 1.5
						}
					}
				}
			}
		}
		if ( rnd(30) == 0 ) {
			ibitmod ITEM_BIT_POISON_BLEND, oom_pot_enchant, FALSE
			inv(36, oom_pot_enchant) = 0
			txt -1, lang(itemname(oom_pot_enchant) + "に塗られた毒を使い切った。", name(cc) + " exhausted poison dipped on " + itemname(oom_pot_enchant) + ".")
		}
	}
	if ( ibit(ITEM_BIT_LOVE_BLEND, oom_pot_enchant) ) {
		dmgcon tc, 13, 5 + sdata(attackskill, cc) * 1.5
		if ( rnd(20) == 0 ) {
			if ( check_bigench(oom_pot_enchant) != 18 ) {
				ibitmod ITEM_BIT_LOVE_BLEND, oom_pot_enchant, FALSE
				txt -1, lang(itemname(oom_pot_enchant) + "に塗られた媚薬を使い切った。", name(cc) + " exhausted poison dipped on love potion.")
			}
		}
	}
	if ( attackskill == SKILL_WEAPON_AXE ) {
		if ( gettrait(cc, 64) ) {
			p = stat
			if ( rnd(2) == 0 ) {
				dmgcon tc, CONDITION_BLEED, calctraitscore(p) * 50 + 100
			}
		}
	}
	if ( attackskill == SKILL_WEAPON_BLUNT ) {
		if ( gettrait(cc, 65) ) {
			if ( rnd(10) < calctraitscore(stat) ) {
				dmgcon tc, CONDITION_DIM, 50 + int(sqrt(sBlunt(cc))) * 15
			}
		}
	}
	if ( check_bigench(cw) == 4 & cExist(tc) == CHAR_STATE_ALIVE ) {
		dmgType = 1
		healdmg = ((dmgbk + overdamage) / 100 * inv(38, cw) + inv(38, cw) * 10) * (-1)
		healhp tc, healdmg
		if ( showdamagecheck(healdmg) ) {
			if ( synccheck(tc, -1) ) {
				mondmgn(mondmgcnt) = "" + healdmg
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		animeid = ANIMATION_HEAL
		gosub *anime
		txt -1, lang(name(tc) + "は過剰に回復した。", name(tc) + " " + is(tc) + " completely healed.")
	}
	if ( check_bigench(cw) == 13 ) {
		dmgcon cc, CONDITION_DRUNK, 10
	}
	if ( check_bigench(cw) == 9 & cExist(tc) == CHAR_STATE_ALIVE ) {
		if ( rnd(100) < inv(38, cw) ) {
			addbuff tc, 62, 1, 20, 2100000000
			snd SOUNDLIST_CURSE3
			animeload 14, tc
		}
	}
	if ( check_bigench(cw) == 10 & cExist(tc) == CHAR_STATE_ALIVE ) {
		if ( rnd(100) < inv(38, cw) ) {
			repeat 16
				if ( cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) == 0 ) {
					break
				}
				if ( cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) == 13 | cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) == 15 | cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) == 81 ) {
					continue
				}
				if ( cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) >= 19 & cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) < 29 ) {
					continue
				}
				if ( cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) >= 85 & cdata(192 + cnt * ARRAY_CDATA_BUFF, tc) < 95 ) {
					continue
				}
				delbuff tc, cnt
				break
			loop
			snd SOUNDLIST_CURSE3
			animeload 14, tc
		}
	}
	repeat 15
		dmgdisplayflag = 0
		if ( cfg_dmgtxttype == 1 ) {
			weaponenc = 1
			if ( cfg_dmgmonitortype == 0 ) {
				weaponenc = 0
			}
		}
		weaponenc(1) = cfg_dmgmonitor4
		cw = attackitem
		if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw) == 0 ) {
			break
		}
		enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw)
		if ( findbuff(cc, 62) == (-1) | check_bigench(cw) == 3 ) {
			if ( enc == 36 ) {
				p = rnd(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) / 50 + 1) + 1
				if ( ogTitleNurta == 2 ) {
					p *= 2
				}
				healsp cc, p
				dmgsp tc, p / 2
				continue
			}
			if ( enc == 38 ) {
				p = rnd(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) / 25 + 1) + 1
				p = p * (50 + sdata(attackskill, cc)) / 50
				if ( ogTitleNurta == 2 ) {
					p *= 2
				}
				healmp cc, p
				if ( cExist(tc) != CHAR_STATE_ALIVE ) {
					continue
				}
				dmgmp tc, p
				continue
			}
			if ( enc == 37 ) {
				if ( rnd(66) == 0 ) {
					if ( cId(cc) == CREATURE_ID_YOUNGER_SISTER | cId(cc) == CREATURE_ID_YOUNGER_SISTER2 ) {
						evadd 101, cc
					}
					else {
						evadd EVENT_RAGNAROK, cc
					}
				}
				continue
			}
			if ( enc == 40 ) {
				if ( gTimeStopTime == 0 ) {
					if ( counterattack == 0 ) {
						if ( rnd(25) == 0 ) {
							ctalk cc, 1285, cc, cc
							txtef COLOR_SKY_BLUE
							txt -1, lang(name(cc) + "は時を止めた。", name(cc) + " stop" + _s(cc) + " time.")
							if ( gArea  == 210 ) {
								stopthetimebegin limitmax(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) / 100, 4) + 2
							}
							else {
								stopthetimebegin inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) / 100 + 1 + 1
							}
						}
					}
					continue
				}
			}
			if ( enc == 57 ) {
				s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
				if ( instr(s, 0, "/dragon/") != (-1) ) {
					dmgType = 1
					if ( ogTitleAreus != 2 ) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					}
					else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
			if ( enc == 61 ) {
				s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
				if ( instr(s, 0, "/god/") != (-1) ) {
					dmgType = 1
					if ( ogTitleAreus != 2 ) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					}
					else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
			if ( enc == 62 ) {
				s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
				if ( instr(s, 0, "/man/") != (-1) ) {
					dmgType = 1
					if ( ogTitleAreus != 2 ) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					}
					else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
			if ( enc == 58 ) {
				s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
				if ( instr(s, 0, "/undead/") != (-1) ) {
					dmgType = 1
					if ( ogTitleAreus != 2 ) {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 20000000)), cc
					}
					else {
						dmghp tc, int(limitf(double(dmgbk) * p / 500 + orgdmg / 10, 0, 2000000000)), cc
					}
					subdmg = 0
				}
				continue
			}
		}
		i = enc / 10000
		if ( i != 0 ) {
			enc = enc \ 10000
			if ( findbuff(cc, 62) == (-1) | check_bigench(cw) == 3 ) {
				if ( i == 7 ) {
					if ( orgdmg <= 1 ) {
						continue
					}
					ele = enc
					if ( cExist(tc) != CHAR_STATE_ALIVE ) {
						continue
					}
					dmgType = 1
					p = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw)
					if ( check_bigench(cw) == 2 ) {
						p *= 1.0 + inv(38, cw) / 10
					}
					if ( ogTitleAreus != 2 ) {
						exrand_rnd locvar_check_adddamage_rtval, int(limitf(double(orgdmg) * (100 + p) / 1000 + 1, 1, 20000000))
					}
					else {
						exrand_rnd locvar_check_adddamage_rtval, int(limitf(double(orgdmg) * (100 + p) / 1000 + 1, 1, 2000000000))
					}
					dmghp tc, locvar_check_adddamage_rtval + 5, cc, ele, p / 2 + 100
					subdmg = 0
					ele = SKILL_NONE
					continue
				}
				if ( i == 8 ) {
					if ( cExist(tc) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( enc >= 30 ) {
						continue
					}
					tcbk = tc
					getencproc encprocref2, cw, enc + 80000
					p = encprocref(ENCPROCREF_TARGET_TYPE, enc)
					if ( encprocref2 ) {
						p = encprocref2(1)
					}
					if ( p == 3000 | p == 10000 ) {
						tc = cc
					}
					p = encprocref(ENCPROCREF_PROC_CHANCE, enc)
					if ( p < 50 ) {
						p *= 1 + sMagicDevice(cc) / 20
						if ( p > 50 ) {
							p = 50
						}
					}
					enc = encprocref(ENCPROCREF_SKILL_ID, enc)
					if ( encprocref2 ) {
						p = encprocref2(5)
						enc = encprocref2(0)
					}
					if ( enc == 658 & efid == 773 ) {
						continue
					}
					tlocx = cX(tc)
					tlocy = cY(tc)
					if ( rnd(100) < p ) {
						efid = enc
						lint_efp = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) + refattackskill(attackskill, cc) * 10
						efp = limitmax(lint_efp, 2147483647)
						if ( efid == SKILL_SPACT_SWARM | efid == MAX_SKILL ) {
							if ( nc_atk_loopf ) {
								continue
							}
							else {
								nc_atk_loopf = 1
							}
						}
						ctalk cc, 1300, tc, cc
						gosub *label_3383
						if ( enc != 658 ) {
							skillexp2 SKILL_NORMAL_MAGIC_DEVICE, cc, 2
						}
					}
					tc = tcbk
					ele = SKILL_NONE
					continue
				}
			}
			continue
		}
	loop
	check_adddamage
	gosub *label_4382
	if ( cExist(tc) == CHAR_STATE_ALIVE ) {
		if ( cSleep(tc) > 0 ) {
			if ( cQuality(tc) < FIX_QUALITY_UNIQUE ) {
				if ( nc_gettrait(cc, 101) > 0 ) {
					if ( rnd(10) == 0 ) {
						snd SOUNDLIST_ATKSWORD
						ctalk cc, 1295, tc, cc
						txtef COLOR_RED
						txt -1, lang(" *ブシュッ* ", "*Gash*")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
							dmgType = 2
							txt3rd = 1
							txt -1, lang(name(cc) + "は" + name(tc) + "に致命的な一撃を与え", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
						}
						else {
							txt -1, lang(name(cc) + "は" + name(tc) + "に致命的な一撃を与えた。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
						}
					}
				}
			}
		}
	}
	if ( ammoproc == ENCHANT_AMMO_TIME_STOP ) {
		ctalk cc, 1285, cc, cc
		txtef COLOR_SKY_BLUE
		txt -1, lang(name(cc) + "は時を止めた。", name(cc) + " stop" + _s(cc) + " time.")
		stopthetimebegin 6
	}
	if ( ammoproc == ENCHANT_AMMO_MAGIC ) {
		if ( cExist(tc) == CHAR_STATE_ALIVE ) {
			dmgType = 1
			dmghp tc, orgdmg * 2 / 3, cc, rnd(61 - 50) + 50, sdata(attackskill, cc) * 10 + 100
			subdmg = 0
		}
	}
	if ( ammoproc == ENCHANT_AMMO_EXPLOSIVE ) {
		tcbk = tc
		tlocx = cX(tc)
		tlocy = cY(tc)
		efid = SKILL_SPELL_MAGIC_STORM
		lint_efp = sdata(attackskill, cc) * 8 + 10
		efp = limitmax(lint_efp, 2147483647)
		gosub *label_3383
		tc = tcbk
	}
	weaponenc = 0, 0
	return

*act_search
	msgdup++
	txt -1, lang("周囲を注意深く調べた。", "You search the surroundings carefully.")
	if ( gArea  == AREA_SHOW_HOUSE ) {
		inv_getheader -1
		p = 9999
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iProperty(cnt) != PROP_SPECIAL ) {
				continue
			}
			if ( iID(cnt) != ITEM_ID_SUMMONING_CRYSTAL & iID(cnt) != ITEM_ID_CARNEADES_PLANK ) {
				continue
			}
			if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK & iEffect(cnt) != 1000 ) {
				continue
			}
			if ( p > dist(iX(cnt), iY(cnt), cX(CHARA_PLAYER), cY(CHARA_PLAYER)) ) {
				p = dist(iX(cnt), iY(cnt), cX(CHARA_PLAYER), cY(CHARA_PLAYER))
				ci = cnt
			}
		loop
		if ( p != 9999 ) {
			repeat
				if ( p <= 3 ) {
					txt -1, lang("辺りの空気は息苦しいほどの緊張に包まれている。", "The air around you is filled with strained silence.")
				}
				if ( p <= 9 ) {
					txt -1, lang("微かだが、あなたの心臓はトクンと脈打った。", "Your heart starts beating in your chest.")
					break
				}
				if ( p <= 16 ) {
					txt -1, lang("まだだ、まだ遠い…", "Still, still lying far ahead.")
					break
				}
				if ( iID(ci) == ITEM_ID_SUMMONING_CRYSTAL ) {
					txt -1, lang("あなたは青い水晶の存在を感じた。", "You sense a blue crystal lying somewhere in this area.")
				}
				else {
					if ( iID(ci) == ITEM_ID_CARNEADES_PLANK & iEffect(ci) == 1000 ) {
						txt -1, lang("あなたは" + useritemdatan(4, iCItemIdx(ci)) + "の存在を感じた。", "You sense a " + useritemdatan(4, iCItemIdx(ci)) + " lying somewhere in this area.")
					}
				}
				break
			loop
		}
	}
	repeat 11
		y = cY(cc) + cnt - 5
		if ( y < 0 | y >= mHeight ) {
			continue
		}
		repeat 11
			x = cX(cc) + cnt - 5
			if ( x < 0 | x >= mWidth ) {
				continue
			}
			if ( mapFeat(x, y) != 0 ) {
				cell_featread x, y
				refx = x
				refy = y
				if ( abs(cY(cc) - y) <= 1 & abs(cX(cc) - x) <= 1 ) {
					if ( featId == CELL_FEATURE_TRAP ) {
						if ( featPic == 0 ) {
							gosub *label_1670
							if ( stat == 1 ) {
								revealtrap x, y
								txt -1, lang("罠を発見した。", "You discover a trap.")
							}
						}
					}
					if ( featId == CELL_FEATURE_HIDDEN_PATH ) {
						gosub *label_1670
						if ( stat == 1 | 0 ) {
							gosub *label_3663
							txt -1, lang("隠れた通路を発見した。", "You discover a hidden path.")
						}
					}
				}
				if ( featId == CELL_FEATURE_SMALL_MEDAL ) {
					if ( gArea  != AREA_SHOW_HOUSE ) {
						if ( cX(cc) == x & cY(cc) == y ) {
							snd SOUNDLIST_DING2
							txt -1, lang("なんと小さなメダルを見つけた！", "You find a small coin!")
							mapFeat(x, y) = 0
							flt
							itemcreate -1, ITEM_ID_SMALL_MEDAL, x, y, 0
						}
						else {
							if ( dist(cX(cc), cY(cc), x, y) > 2 ) {
								txt -1, lang("この辺りには何かがありそうな予感がする…", "You sense something.")
							}
							else {
								txt -1, lang("あなたは何かが輝くのを目にした。", "You see something shines.")
							}
						}
					}
				}
			}
		loop
	loop
	if ( sDetection(CHARA_PLAYER) > 0 ) {
		rc = CHARA_PLAYER
		repeat 188, 57
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cOrgRelation(cnt) != RELATION_ENEMY ) {
				continue
			}
			if ( rc ) {
				if ( dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(cnt), cY(cnt)) < dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(rc), cY(rc)) ) {
					rc = cnt
				}
			}
			else {
				rc = cnt
			}
		loop
		if ( rc ) {
			s = direction2(0, rc)
			p = dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(rc), cY(rc))
			repeat 1
				if ( p < 6 ) {
					break
				}
				else {
					if ( p < 12 ) {
						s = lang(s + "の方から殺気を感じる…", "You sense a thirst for blood nearby from " + s + "...")
					}
					else {
						if ( p < 20 ) {
							if ( sDetection(CHARA_PLAYER) > 5 ) {
								s = lang(s + "の方から敵の気配を感じる…", "You sense the enemy's presence from " + s + "...")
							}
						}
						else {
							if ( p < 35 ) {
								if ( sDetection(CHARA_PLAYER) > 10 ) {
									s = lang(s + "の方から微かに敵の気配を感じる…", "You somewhat sense the enemy's presence from " + s + "...")
								}
							}
							else {
								if ( sDetection(CHARA_PLAYER) > 15 ) {
									s = lang("遠く" + s + "の方から微かに敵の気配を感じる…", "You somewhat sense the enemy's presence far away from " + s + "...")
								}
							}
						}
					}
				}
				txtef COLOR_SKY_BLUE
				if ( s != direction2(0, rc) ) {
					txt -1, s
				}
				break
			loop
		}
	}
	if ( ogTitleSuperTourist == 2 ) {
		rc = CHARA_PLAYER
		repeat 188, 57
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cQuality(cnt) < FIX_QUALITY_UNIQUE ) {
				continue
			}
			if ( rc ) {
				if ( dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(cnt), cY(cnt)) < dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(rc), cY(rc)) ) {
					rc = cnt
				}
			}
			else {
				rc = cnt
			}
		loop
		if ( rc ) {
			s = direction2(0, rc)
			p = dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(rc), cY(rc))
			repeat 1
				if ( p < 6 ) {
					break
				}
				else {
					if ( p < 12 ) {
						s = lang(s + "の方に珍しいモンスターの気配を感じる…", "You sense a thirst for Unique nearby from " + s + "...")
					}
					else {
						if ( p < 20 ) {
							s = lang(s + "の方から珍しいモンスターの気配を感じる…", "You sense the Unique presence from " + s + "...")
						}
						else {
							if ( p < 35 ) {
								s = lang(s + "の方から微かに珍しいモンスターの気配を感じる…", "You somewhat sense the Unique presence from " + s + "...")
							}
							else {
								s = lang("遠く" + s + "の方から微かに珍しいモンスターの気配を感じる…", "You somewhat sense the Unique presence far away from " + s + "...")
							}
						}
					}
				}
				txtef COLOR_SKY_BLUE
				if ( s != direction2(0, rc) ) {
					txt -1, s
				}
				break
			loop
		}
	}
	cell_featread cX(cc), cY(cc)
	if ( featId == CELL_FEATURE_TRAP ) {
		if ( featPic == tile_trap ) {
			if ( godcheck() == "mani" ) {
				if ( cc == CHARA_PLAYER ) {
					movx = cX(cc)
					movy = cY(cc)
					gosub *disarmTrap
				}
			}
		}
	}
	if ( featId >= CELL_FEATURE_SAMPLING_SPOT_DETECTION & featId <= CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
		rowactre = 1, cX(cc), cY(cc)
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_DETECTION ) {
			gosub *search
		}
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_GENE_ENGINEER ) {
			gosub *search
		}
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
			gosub *fishing
		}
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
			gosub *dig
		}
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
			gosub *plant
		}
	}
	goto *label_4158

#deffunc revealtrap int revealtrap_prm0, int revealtrap_prm1
	cell_featset revealtrap_prm0, revealtrap_prm1, tile_trap, -1, -1
	return

*label_3663
	mapId(refx, refy) = tile_tunnel
	cell_featset refx, refy, 0, CELL_FEATURE_NONE
	return

*act_dig
	if ( cSP(cc) < 0 ) {
		txt -1, lang("疲れ過ぎて無理だ。", "You are too exhausted to do that.")
		gosub *screen_draw
		goto *pc_turn
	}
	rowactre = 0
	digx = tlocx
	digy = tlocy
	gosub *dig
	goto *label_4158
	goto *act_dip

#deffunc dipcursed int dipcursed_item
	if ( refitem(iID(dipcursed_item), DBSPEC_TYPE, dipcursed_item) == FILTER_ITEM_FOOD ) {
		if ( iMaterial(dipcursed_item) == ITEM_MATERIAL_RAW ) {
			txt -1, lang(itemname(dipcursed_item) + "は腐ってしまった…", "" + itemname(dipcursed_item) + " rots.")
			iParam3(dipcursed_item) = -1
			iPic(dipcursed_item) = xy2pic(6, 10)
			cell_refresh iX(dipcursed_item), iY(dipcursed_item)
			return
		}
		else {
			txt -1, lang(itemname(dipcursed_item) + "に変化はない。", "" + itemname(dipcursed_item) + " remains unchanged.")
			return
		}
	}
	if ( refitem(iID(dipcursed_item), DBSPEC_TYPE, dipcursed_item) < FILTER_ITEM_MIN ) {
		safe_subtract iLevel(dipcursed_item), 1
		txt -1, lang(itemname(dipcursed_item) + "は錆びてしまった…", "" + itemname(dipcursed_item) + " rusts.")
		if ( inv_getowner(dipcursed_item) != (-1) ) {
			r1 = inv_getowner(dipcursed_item)
			gosub *charaRefresh
		}
		return
	}
	txt -1, lang("何もおきない… ", "Nothing happens...")
	return

*act_dip
	procid = (procid + 1) \ 10
	proclist(procid) = "proc_dip" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( iID(cidip) == ITEM_ID_BAIT ) {
		if ( iParam4(ci) != 0 & iParam4(ci) != iParam1(cidip) ) {
			txt -1, lang("今装着している餌は失われる。本当に装着する？", "The attached baits will be lost. Are you sure?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval != 0 ) {
				goto *pc_turn
			}
		}
		item_separate ci
		item_num cidip, -1
		snd SOUNDLIST_EQUIP1
		txt -1, lang(itemname(cidip, 1) + "を" + itemname(ci) + "に装着した。", "You bait " + itemname(ci) + " with " + itemname(cidip, 1) + ".")
		if ( iParam4(ci) == iParam1(cidip) ) {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) += rnd(10) + 15
		}
		else {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = rnd(10) + 15
			iParam4(ci) = iParam1(cidip)
		}
		goto *label_4158
	}
	snd SOUNDLIST_DRINK1
	if ( refitem(iID(cidip), DBSPEC_TYPE, cidip) == FILTER_ITEM_POTION ) {
		if ( refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_FURNITURE_WELL ) {
			item_separate ci
			item_num cidip, -1
			if ( iID(cidip) != ITEM_ID_EMPTY_BOTTLE ) {
				txt -1, lang(itemname(cidip, 1) + "を" + itemname(ci) + "に浸した。", "You dip " + itemname(ci) + " into " + itemname(cidip, 1) + ".")
				if ( iID(ci) == ITEM_ID_HOLY_WELL ) {
					txt -1, lang("井戸は汚れた。", "The holy well is polluted.")
					goto *label_4158
				}
				if ( iParam3(ci) >= 20 ) {
					txt -1, lang(itemname(ci) + "は完全に枯れている。", itemname(ci) + " is completely dry.")
					goto *label_4158
				}
				txt -1, lang(itemname(ci) + "は一瞬輝いた。", itemname(ci) + " shines for a moment.")
				if ( iID(cidip) == ITEM_ID_HANDFUL_SNOW ) {
					txt -1, lang("こんな量では… ", "Snow just melts.")
				}
				else {
					iParam1(ci) += rnd(3)
				}
				goto *label_4158
			}
			else {
				if ( iParam1(ci) < (-5) | iParam3(ci) >= 20 | (iID(ci) == ITEM_ID_HOLY_WELL & flagHolyWell <= 0) ) {
					valn = itemname(ci)
					txt -1, lang(valn + "は涸れている。", valn + " is dry.")
					txt -1, lang("あっ！空き瓶を井戸に落としてしまった…", "Oops! You drop the empty bottle into the well...")
					goto *label_4158
				}
				if ( inv_getfreeid(CHARA_PLAYER) == (-1) ) {
					item_num cidip, 1
					txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
					goto *label_4158
				}
				if ( iID(ci) == ITEM_ID_HOLY_WELL ) {
					flagHolyWell--
					flt
					itemcreate CHARA_PLAYER, ITEM_ID_BOTTLE_WATER, -1, -1, 0
					if ( stat != 0 ) {
						iStatus(ci) = ITEM_STATUS_BLESSED
					}
				}
				else {
					iParam1(ci) -= 3
					flt 20
					flttypemajor = FILTER_ITEM_POTION
					itemcreate CHARA_PLAYER, ITEM_ID_DUMMY, -1, -1, 0
				}
				txt -1, lang("空き瓶に水をすくった。", "You draw water from the well into the empty bottle.")
				txt -1, lang(itemname(ci, 1) + "を手に入れた。", "You get " + itemname(ci, 1) + ".")
				item_stack CHARA_PLAYER, ci, 1
				goto *label_4158
			}
		}
	}
	if ( iID(cidip) == ITEM_ID_POTION_BLINDNESS | iID(cidip) == ITEM_ID_POTION_CONFUSION | iID(cidip) == ITEM_ID_POTION_PARALYSIS | iID(cidip) == ITEM_ID_SLEEPING_DRUG | iID(cidip) == ITEM_ID_POISON ) {
		if ( iID(cidip) == ITEM_ID_POISON ) {
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_FOOD | (iID(ci) == ITEM_ID_BOTTLE_MILK & iParam2(ci) != 0) ) {
				item_num cidip, -1
				item_separate ci
				txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
				ctalk 0, 1251, 0, 0
				if ( stat == 0 ) {
					txt -1, lang("あなたはにやりと笑った。", "You grin.")
				}
				if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
					dipcursed ci
				}
				ibitmod ITEM_BIT_POISON_BLEND, ci, TRUE
				goto *label_4158
			}
		}
		if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_WEAPON | refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_AMMO | refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_RANGE_ROCK_THROW ) {
			item_num cidip, -1
			item_separate ci
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci) + ".")
			ctalk 0, 1250, 0, 0
			if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			ibitmod ITEM_BIT_POISON_BLEND, ci, TRUE
			potiondip = 1
			dbmode = DBMODE_ON_DRINK
			dbid = iID(cidip)
			gosub *db_item
			inv(36, ci) = efp * 1000 + dbid
			goto *label_4158
		}
	}
	if ( iID(cidip) == ITEM_ID_LOVE_POTION ) {
		if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_FOOD | (iID(ci) == ITEM_ID_BOTTLE_MILK & iParam2(ci) != 0) ) {
			if ( iStatus(cidip) != ITEM_STATUS_BLESSED ) {
				item_num cidip, -1
				item_separate ci
			}
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
			ctalk 0, 1252, 0, 0
			if ( stat == 0 ) {
				txt -1, lang("あなたはうしろめたさを感じた…", "You kind of feel guilty...")
			}
			if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			ibitmod ITEM_BIT_LOVE_BLEND, ci, TRUE
			goto *label_4158
		}
		if ( refitem(iID(ci), DBSPEC_TYPE, ci) < FILTER_ITEM_MIN ) {
			item_num cidip, -1
			item_separate ci
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci) + ".")
			ctalk 0, 1252, 0, 0
			if ( stat == 0 ) {
				txt -1, lang("あなたはうしろめたさを感じた…", "You kind of feel guilty...")
			}
			if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			ibitmod ITEM_BIT_LOVE_BLEND, ci, TRUE
			goto *label_4158
		}
	}
	if ( iID(cidip) == ITEM_ID_POTION_SPEED ) {
		if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_FOOD ) {
			item_num cidip, -1
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
			if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			else {
				if ( iParam3(ci) > getgametime() ) {
					iParam3(ci) = getgametime() + 1
					txt -1, lang(itemname(ci) + "は腐りそうだ。", itemname(ci) + " is likely to rot.")
					item_stack CHARA_PLAYER, ci, 1
				}
				else {
					txt -1, lang("何もおきない… ", "Nothing happens...")
				}
			}
			goto *label_4158
		}
	}
	if ( iID(cidip) == ITEM_ID_POTION_SLOW ) {
		if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_FOOD ) {
			item_num cidip, -1
			txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！", "You made aphrodisiac food!")
			if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			else {
				if ( iParam3(ci) > getgametime() ) {
					iParam3(ci) = 0
					txt -1, lang(itemname(ci) + "はもう腐らない。", itemname(ci) + " doesn't rot anymore.")
					item_stack CHARA_PLAYER, ci, 1
				}
				else {
					txt -1, lang("何もおきない… ", "Nothing happens...")
				}
			}
			goto *label_4158
		}
	}
	if ( iID(cidip) == ITEM_ID_BOTTLE_DYE ) {
		if ( iStatus(cidip) == ITEM_STATUS_BLESSED ) {
			in = iNum(cidip)
		}
		else {
			in = 1
			item_separate ci
		}
		item_num cidip, -1
		iCol(ci) = iCol(cidip)
		txt -1, lang("あなたは" + itemname(ci) + "を染めた。", "You dye " + itemname(ci) + ".")
		if ( inv_getowner(ci) == (-1) ) {
			cell_refresh iX(ci), iY(ci)
		}
		if ( iEquip(ci) != 0 ) {
			create_pcpic cc, 1
		}
		goto *label_4158
	}
	if ( iID(cidip) == ITEM_ID_ACIDPROOF_LIQUID ) {
		if ( iStatus(cidip) == ITEM_STATUS_BLESSED ) {
			in = iNum(cidip)
		}
		else {
			in = 1
			item_separate ci
		}
		txt -1, lang(itemname(ci) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci) + ".")
		if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
			dipcursed ci
		}
		else {
			ibitmod ITEM_BIT_ACIDPROOF, ci, TRUE
			txt -1, lang(itemname(ci) + "は酸から守られた。", itemname(ci) + " gain" + _s2(in) + " acidproof.")
		}
		item_num cidip, -1
		goto *label_4158
	}
	if ( iID(cidip) == ITEM_ID_FIREPROOF_LIQUID ) {
		if ( iStatus(cidip) == ITEM_STATUS_BLESSED ) {
			in = iNum(cidip)
		}
		else {
			in = 1
			item_separate ci
		}
		txt -1, lang(itemname(ci, in) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci, in) + ".")
		if ( iStatus(cidip) <= ITEM_STATUS_CURSED ) {
			dipcursed ci
		}
		else {
			if ( iID(ci) == ITEM_ID_FIREPROOF_BLANKET ) {
				txt -1, lang("いいアイデアだ！しかし…", "A good idea! But...")
			}
			else {
				ibitmod ITEM_BIT_FIREPROOF, ci, TRUE
				txt -1, lang(itemname(ci) + "は熱から守られた。", itemname(ci) + " gain" + _s2(in) + " fireproof.")
			}
		}
		item_num cidip, -1
		goto *label_4158
	}
	if ( iID(cidip) == ITEM_ID_BOTTLE_WATER ) {
		item_num cidip, -1
		if ( ibit(18, ci) ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *label_4158
		}
		if ( iStatus(cidip) == ITEM_STATUS_BLESSED ) {
			txtef COLOR_GREEN
			txt -1, lang(itemname(ci) + "は銀色に輝いた。", itemname(ci) + " shine" + _s2(iNum(ci)) + " silvery.")
			iStatus(ci) = ITEM_STATUS_BLESSED
			item_stack CHARA_PLAYER, ci, 1
			r1 = cc
			gosub *charaRefresh
			goto *label_4158
		}
		if ( iStatus(cidip) == ITEM_STATUS_CURSED ) {
			txtef COLOR_PURPLE
			txt -1, lang(itemname(ci) + "は黒いオーラに包まれた。", itemname(ci) + " " + is2(iNum(ci)) + " wrapped by a dark aura.")
			if ( iStatus(ci) == ITEM_STATUS_CURSED ) {
				iStatus(ci) = ITEM_STATUS_DOOMED
			}
			else {
				iStatus(ci) = ITEM_STATUS_CURSED
			}
			item_stack CHARA_PLAYER, ci, 1
			r1 = cc
			gosub *charaRefresh
			goto *label_4158
		}
		if ( iStatus(cidip) == ITEM_STATUS_DOOMED ) {
			txtef COLOR_PURPLE
			txt -1, lang(itemname(ci) + "は黒いオーラに包まれた。", itemname(ci) + " " + is2(iNum(ci)) + " wrapped by a dark aura.")
			iStatus(ci) = ITEM_STATUS_DOOMED
			item_stack CHARA_PLAYER, ci, 1
			r1 = cc
			gosub *charaRefresh
			goto *label_4158
		}
	}
	txt -1, lang("何もおきない… ", "Nothing happens...")
	goto *label_4158

*act_use
	procid = (procid + 1) \ 10
	proclist(procid) = "act_use" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	screenupdate = -1
	gosub *screen_draw
	tc = cc
	tlocx = cX(cc)
	tlocy = cY(cc)
	if ( ibit(ITEM_BIT_PERIOD, ci) == TRUE ) {
		if ( getgametime() < inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) ) {
			txt -1, lang("そのアイテムが次に使用できるのは" + cnvdate(inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci), 1) + "だ。", "This item will be usable again at " + cnvdate(inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci), 1) + ".")
			gosub *screen_draw
			goto *pc_turn
		}
		item_separate ci
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = getgametime() + iParam3(ci)
	}
	if ( ibit(ITEM_BIT_CHARGE_ITEM, ci) == TRUE ) {
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) <= 0 ) {
			txt -1, lang("それはもう使えない。", "It's out of charge.")
			gosub *screen_draw
			goto *pc_turn
		}
		item_separate ci
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
		item_autostack cc, ci
	}
	if ( refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_ITEM_SEED ) {
		goto *item_seed
	}
	if ( refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_ITEM_TOOL_BLEND ) {
		blendtool = ci
		goto *com_blend
	}
	if ( refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_FURNITURE_BED | iID(ci) == ITEM_ID_KOTATSU ) {
		if ( gSleep < 15 & gWizard == 0 ) {
			txt -1, lang("まだ眠たくない。", "You don't feel sleepy yet.")
			gosub *screen_draw
			goto *pc_turn
		}
		gRowAct = ACTION_SLEEP
		gosub *label_3307
		goto *label_4158
	}
	if ( iID(ci) == ITEM_ID_RED_TREASURE_MACHINE | iID(ci) == ITEM_ID_BLUE_TREASURE_MACHINE ) {
		goto *com_gasha
	}
	if ( iID(ci) == ITEM_ID_PACHISURO_MACHINE | iID(ci) == ITEM_ID_CASINO_TABLE | iID(ci) == ITEM_ID_SLOT_MACHINE | iID(ci) == ITEM_ID_DARTS_BOARD ) {
		atxid = 1
		gosub *com_txtadv
		goto *label_4158
	}
	if ( iEffect(ci) == EFFECT_CARPENTRY | iEffect(ci) == EFFECT_ALCHEMY | iEffect(ci) == EFFECT_JEWELER | iEffect(ci) == EFFECT_TAILOR | iEffect(ci) == 1506 ) {
		if ( iEffect(ci) == 1506 ) {
			prodtype = 5
		}
		else {
			prodtype = iEffect(ci)
		}
		snd SOUNDLIST_POP2
		invctrl = 0
		gosub *label_2391
		goto *label_4158
	}
	if ( ibit(ITEM_BIT_ALIVE, ci) ) {
		if ( iParam2(ci) < calcexpalive(iParam1(ci)) & 0 == 0 ) {
			if ( ibit(18, ci) == FALSE | iStatus(ci) < ITEM_STATUS_BLESSED ) {
				txt -1, lang("この武器はまだ血を吸い足りない。", "The weapon needs more blood.")
			}
			else {
				txt -1, lang("この武器はまだあなたを認めていない。", "This weapon does not yet deem you worthy.")
			}
		}
		else {
			txtnew
			if ( ibit(18, ci) == FALSE | iStatus(ci) < ITEM_STATUS_BLESSED ) {
				txt -1, lang(itemname(ci) + "は十分に血を吸い成長できる！", itemname(ci) + " sucked enough blood and ready to grow!")
				randomize iSubName(ci)
				exrand_randomize iSubName(ci)
				if ( iParam1(ci) >= 4 + rnd(12) ) {
					txt -1, lang("しかし、なんだか様子がおかしい…", "But you sense something weird.")
				}
			}
			else {
				txt -1, lang(itemname(ci) + "はあなたを認め秘められた力を発揮する！", itemname(ci) + " deems your heroic deeds worthy enough and further unleases its hidden power!")
			}
			txt -1, lang("それは…", "It...")
			reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
			listmax = 0
			repeat 50
				if ( listmax >= 8 ) {
					break
				}
				randomize iSubName(ci) + iParam1(ci) * 10 + cnt
				exrand_randomize iSubName(ci) + iParam1(ci) * 10 + cnt
				encadd ci, randomenc(randomenclv(4)), randomencp(0, ogTitleTubalCain == 2), 0, 0, 1
				if ( stat != 0 ) {
					if ( rtval == 34 ) {
						if ( rnd(3) ) {
							continue
						}
					}
					findenc = 0
					repeat listmax
						if ( list(0, cnt) == rtval ) {
							if ( encpassivecheck(rtval) | list(1, cnt) == rtval(1) ) {
								findenc = 1
								break
							}
						}
					loop
					if ( findenc ) {
						continue
					}
					if ( encpassivecheck(rtval) ) {
						if ( encfindspec(ci, rtval) != (-1) ) {
							continue
						}
					}
					list(0, listmax) = rtval, rtval(1)
					val = list(0, listmax), list(1, listmax), 0, 0
					gosub *item_encdetail
					promptl(0, promptmax) = s, "null", "" + promptmax
					promptmax++
					listmax++
				}
				else {
					continue
				}
			loop
			if ( ibit(18, ci) & iStatus(ci) <= ITEM_STATUS_DOOMED ) {
				repeat listmax
					list(1, cnt) = list(1, cnt) * 5 / 2
					val = list(0, cnt), list(1, cnt), 0, 0
					gosub *item_encdetail
					promptl(0, cnt) = s, "null", "" + cnt
				loop
			}
			if ( listmax > 0 ) {
				val = promptx, prompty, 500, 1
				gosub *prompt_key
				if ( rtval == (-1) ) {
					txtnew
					txt -1, lang(itemname(ci) + "は不満そうに震えた。", itemname(ci) + " vibrates as if she is displeased.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *charaRefresh
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					encadd ci, list(0, rtval), list(1, rtval), 0, 1
				}
			}
			txtnew
			iLevel(ci)++
			txtef COLOR_GREEN
			txt -1, lang(itemname(ci) + "は嬉しげに震えた。", itemname(ci) + " vibrates as if she is pleased.")
			if ( ibit(18, ci) == FALSE | iStatus(ci) < ITEM_STATUS_BLESSED ) {
				randomize iSubName(ci)
				exrand_randomize iSubName(ci)
				if ( iParam1(ci) >= 4 + rnd(12) ) {
					txt -1, lang("その力は次第に脅威になっている。", "Its power is becoming a threat.")
					encadd ci, ENCHANT_SUCK_BLOOD, 50
					if ( stat == 0 ) {
						inv(STARTING_INV_ITEM_ENCHANT + (15 - 1) * 2, ci) = 0
						txt -1, lang(itemname(ci) + "はエンチャントを消した。", itemname(ci) + " removes an enchantment.")
					}
				}
			}
			iParam2(ci) = 0
			iParam1(ci)++
			randomize
			exrand_randomize timeGetTime()
		}
		r1 = cc
		gosub *charaRefresh
		gosub *screen_draw
		goto *pc_turn
	}
	_switch_val = iEffect(ci)
	if ( _switch_val == 24 ) {
		x = cX(cc)
		y = cY(cc)
		if ( mType == MAP_TYPE_WORLD ) {
			txt -1, lang("ここでは使えない。", "You can't place it here.")
			gosub *screen_draw
			goto *pc_turn
		}
		if ( mapFeat(x, y) != 0 ) {
			txt -1, lang("ここには置けない。", "You can't place it here.")
			goto *pc_turn
		}
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		cell_featset x, y, 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_QUEST_MINE, cc
		txt -1, lang("地雷を設置した。", "You set up the mine.")
		snd SOUNDLIST_BUILD1
		goto *act_use_SWEND1
	}
	if ( _switch_val == 44 ) {
		if ( inv_getowner(ci) != (-1) ) {
			txt -1, lang("床に置かないと使えない。", "You need to put it on the ground.")
			gosub *screen_draw
			goto *pc_turn
		}
		txt -1, lang("あなたは" + itemname(ci, 1) + "に座った。", "You sit on " + itemname(ci, 1) + ".")
		promptl(0, promptmax) = lang("くつろぐ", "Relax."), "null", "" + 0
		promptmax++
		if ( iParam1(ci) != 1 ) {
			promptl(0, promptmax) = lang("マイチェアにする", "It's my chair."), "null", "" + 1
			promptmax++
		}
		if ( iParam1(ci) != 2 ) {
			promptl(0, promptmax) = lang("お客用のチェアにする", "It's for my guest."), "null", "" + 2
			promptmax++
		}
		if ( iParam1(ci) != 0 ) {
			promptl(0, promptmax) = lang("誰でも座っていい", "It's free to use."), "null", "" + 3
			promptmax++
		}
		val = promptx, prompty, 260, 1
		gosub *prompt_key
		if ( stat == 0 ) {
			goto *act_use_SWEND1
		}
		if ( rtval == 0 ) {
			txt -1, lang("あなたは存分にくつろいだ。", "You relax as much as you like.")
			goto *act_use_SWEND1
		}
		if ( rtval == 1 ) {
			txt -1, lang(itemname(ci, 1) + "はあなた専用の席になった！", itemname(ci, 1) + " is your seat now.")
			iParam1(ci) = 1
			goto *act_use_SWEND1
		}
		if ( rtval == 2 ) {
			txt -1, lang(itemname(ci, 1) + "は訪問者の席になった！", itemname(ci, 1) + " is used by your guests now.")
			iParam1(ci) = 2
			goto *act_use_SWEND1
		}
		if ( rtval == 3 ) {
			txt -1, lang(itemname(ci, 1) + "は誰でも座っていい席になった！", itemname(ci, 1) + " can be used by anyone.")
			iParam1(ci) = 0
			goto *act_use_SWEND1
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 8 ) {
		f = 0
		if ( mType == MAP_TYPE_HOME ) {
			f = 1
		}
		if ( gLevel  == 3 ) {
			if ( gRankGuild < 3000 ) {
				if ( areaId(gArea ) == AREA_LUMIEST & guildcheck(0) == "mage" | (areaId(gArea ) == AREA_DERPHY & guildcheck(0) == "thieve") | (areaId(gArea ) == AREA_PORT_KAPUL & guildcheck(0) == "fighter") ) {
					f = 1
				}
			}
		}
		if ( areaId(gArea ) == AREA_LESIMAS & flagMain >= 200 ) {
			f = 1
		}
		if ( areaId(gArea ) == AREA_BEAST_FORT | areaId(gArea ) == AREA_MACHINE_FORT | areaId(gArea ) == AREA_COLLAPSED_FORT ) {
			if ( ogTitleThePurifier == 2 ) {
				f = 1
			}
		}
		if ( areaId(gArea ) == 59 ) {
			if ( ogTitleTheWorldIsSpinning == 2 ) {
				f = 1
			}
		}
		if ( areaId(gArea ) == AREA_TEST_WORLD | areaId(gArea ) == AREA_TW_NORTH_BORDER ) {
			f = 1
		}
		if ( f == 0 ) {
			txt -1, lang("それはここでは使えない。", "You can't use it here.")
			gosub *screen_draw
			goto *pc_turn
		}
		screenupdate = -1
		gosub *screen_draw
		goto *com_home
		goto *act_use_SWEND1
	}
	if ( _switch_val == 19 ) {
		txt -1, lang("誰を対象にする？", "Make up who?")
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( mapChara(x, y) > 0 ) {
				tc = mapChara(x, y) - 1
				if ( tc < MAX_CHARA_FOLLOWER ) {
					screenupdate = -1
					gosub *screen_draw
					ccbk = cc
					cc = tc
					gosub *com_mirror
					cc = ccbk
					f = 1
				}
			}
		}
		if ( f == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		gosub *screen_draw
		goto *pc_turn
		goto *act_use_SWEND1
	}
	if ( _switch_val == 15 ) {
		efid = SKILL_NORMAL_COOKING
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 16 ) {
		efid = SKILL_NORMAL_FISHING
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 17 ) {
		efid = SKILL_NORMAL_PERFORMER
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 14 ) {
		if ( cc == CHARA_PLAYER ) {
			if ( iNum(ci) < 5 ) {
				txt -1, lang("雪が足りない…", "You need more snow.")
				gosub *screen_draw
				goto *pc_turn
			}
			removeitem ci, 5
		}
		flt
		itemcreate -1, ITEM_ID_SNOW_MAN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		if ( synccheck(cc, -1) ) {
			snd SOUNDLIST_SNOW
			txt -1, lang(name(cc) + "は雪だるまを作った！", name(cc) + " make" + _s(cc) + " a snow man!")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 13 ) {
		snd SOUNDLIST_FIRE1
		if ( gLightSource == 0 ) {
			gLightSource = 1
			txt -1, lang("松明を灯した。", "You light up the torch.")
		}
		else {
			gLightSource = 0
			txt -1, lang("松明を消した。", "You put out the fire.")
		}
		r1 = 0
		gosub *charaRefresh
		goto *act_use_SWEND1
	}
	if ( _switch_val == 9 ) {
		gosub *label_3046
		if ( stat == 1 ) {
			goto *label_4158
		}
		else {
			gosub *screen_draw
			goto *pc_turn
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 5 ) {
		txt -1, lang("何に聴診器を当てる？", "Auscultate who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		if ( stat == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			gosub *screen_draw
			goto *pc_turn
		}
		tc = mapChara(x, y) - 1
		if ( tc == CHARA_PLAYER ) {
			txt -1, lang(" *ドクン ドクン* ", "You blush.")
			gScope = 0
			goto *label_4158
		}
		if ( petcheck(tc) ) {
			if ( cExist(tc) == CHAR_STATE_ALIVE ) {
				gScope = 0
				if ( cbit(CHARA_BIT_STETHOSCOPE, tc) == TRUE ) {
					cbitmod CHARA_BIT_STETHOSCOPE, tc, FALSE
					txt -1, lang(name(tc) + "から聴診器を外した。", "You no longer watch on " + his(tc) + " health.")
					ctalk tc, 984, 0, tc
					goto *label_4158
				}
				txt -1, lang("あなたは" + name(tc) + "に聴診器を当てた。", "You start to keep an eye on " + his(tc) + " health.")
				if ( cSex(tc) == 1 ) {
					ctalk tc, 989, 0, tc
					if ( stat == 0 ) {
						txt -1, lang("" + name(tc) + "は顔を赤らめた。", name(tc) + " blush" + _s(tc, 1) + ".")
						txtef COLOR_BLUE
						txt tc, lang("「キャー」", cnvtalk("Pervert!"))
					}
				}
				else {
					txtef COLOR_BLUE
					ctalk tc, 989, 0, tc
				}
				cbitmod CHARA_BIT_STETHOSCOPE, tc, TRUE
				goto *label_4158
			}
		}
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		goto *pc_turn
		goto *act_use_SWEND1
	}
	if ( _switch_val == 23 ) {
		txt -1, lang("誰を紐で結ぶ？", "Leash who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( mapChara(x, y) > 0 ) {
				tc = mapChara(x, y) - 1
				if ( tc == CHARA_PLAYER ) {
					if ( cBlind(CHARA_PLAYER) == 0 ) {
						if ( mType != MAP_TYPE_WORLD ) {
							if ( gArea  != AREA_PET_ARENA ) {
								repeat 16
									if ( cnt == 0 ) {
										continue
									}
									if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
										continue
									}
									if ( gRider == cnt ) {
										continue
									}
									if ( ocPetBeingRiddenIdx(cnt) != 0 ) {
										continue
									}
									if ( cbit(CHARA_BIT_LEASHED, cnt) == TRUE ) {
										cAiAggro(cnt) = 0
										unlockson cnt
										tc = CHARA_PLAYER
										cc = cnt
										efid = SKILL_SPACT_SHADOW_STEP
										nc_himo = 1
										gosub *label_3383
									}
								loop
								txt -1, lang("あなたは紐を引っ張った。", "You pull the leash.")
								goto *act_use_SWEND1
							}
						}
					}
				}
				else {
					if ( cbit(CHARA_BIT_LEASHED, tc) == FALSE ) {
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
							if ( rnd(5) == 0 ) {
								txt -1, lang(name(tc) + "が激しく抵抗したため紐は切れた。", "The leash is cut as " + name(tc) + " resists.")
								iNum(ci)--
								cell_refresh iX(ci), iY(ci)
								gosub *label_1681
								goto *act_use_SWEND1
							}
						}
						cbitmod CHARA_BIT_LEASHED, tc, TRUE
						txt -1, lang("あなたは" + name(tc) + "を紐でくくりつけた。", "You leash " + name(tc) + ".")
						txtef COLOR_SKY_BLUE
						ctalk tc, 404, 0, tc
						if ( stat == 0 ) {
							txtef COLOR_SKY_BLUE
							txt -1, lang(name(tc) + "は呻き声を洩らした。「アン…♪」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("Pervert!"))
						}
					}
					else {
						cbitmod CHARA_BIT_LEASHED, tc, FALSE
						txt -1, lang("あなたは" + name(tc) + "にくくりつけた紐をほどいた。", "You unleash " + name(tc) + ".")
						txtef COLOR_SKY_BLUE
						ctalk tc, 403, 0, tc
						if ( stat == 0 ) {
							txtef COLOR_SKY_BLUE
							txt -1, lang(name(tc) + "は呻き声を洩らした。「はぁはぁ…」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("D-don't sto....N-nothing!"))
						}
					}
					animeload 8, tc
				}
				f = 1
			}
		}
		if ( f == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 45 ) {
		if ( gArea  == AREA_SHOW_HOUSE ) {
			txt -1, lang("このエリアでは使えない。", "You cant use it in this area.")
			gosub *screen_draw
			goto *pc_turn
		}
		txt -1, lang("誰を吊るす？", "Hang who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( mapChara(x, y) > 0 ) {
				tc = mapChara(x, y) - 1
				if ( cHP(tc) >= cMHP(tc) / 5 & tc != CHARA_PLAYER ) {
					if ( gWizard == 0 ) {
						txt -1, lang("もっと弱らせないと吊るせない。", "The target needs to be weakened.")
						goto *pc_turn
					}
				}
				if ( tc != CHARA_PLAYER ) {
					if ( tc < MAX_CHARA_FOLLOWER ) {
						txt -1, lang("仲間を吊るすなんてとんでもない！", "Hanging your ally is a brutal idea!")
						goto *pc_turn
					}
				}
				if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
					txt -1, lang("それは既に吊るされている。", "It's already hanged up.")
					goto *pc_turn
				}
				if ( tc == CHARA_PLAYER ) {
					txt -1, lang("どれくらいの間？", "How many turns?")
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, 10000
					inputlog = "" + 1
					gosub *prompt_word
					ncgSandbagSelfTurns = int(inputlog)
				}
				snd SOUNDLIST_BUILD1
				cbitmod CHARA_BIT_SANDBAG, tc, TRUE
				if ( tc == CHARA_PLAYER ) {
					txt -1, lang("あなたは自分自身を吊るした…", "You hang up yourself.")
				}
				else {
					txt -1, lang("あなたは" + name(tc) + "を吊るした。", "You hang up " + name(tc) + ".")
				}
				ctalk tc, 402, 0, tc
				if ( stat == 0 ) {
					txt -1, lang(name(tc) + "は呻き声を洩らした。「アン…♪」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("Pervert!"))
				}
				animeload 8, tc
				iNum(ci)--
				cell_refresh iX(ci), iY(ci)
				gosub *label_1681
				f = 1
			}
		}
		if ( f == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 6 ) {
		txt -1, lang(itemname(ci, 1) + "再生した。", "You play " + itemname(ci, 1) + ".")
		music = iParam1(ci) + 50 + 1
		mMusic = music
		gosub *music_play
		goto *act_use_SWEND1
	}
	if ( _switch_val == 10 ) {
		screenupdate = -1
		gosub *screen_draw
		goto *com_story
		goto *act_use_SWEND1
	}
	if ( _switch_val == 7 ) {
		if ( oabit(13, gArea ) ) {
			txt -1, lang("それはここでは使えない。", "You can't use it here.")
			gosub *screen_draw
			goto *pc_turn
		}
		if ( iProperty(ci) != PROP_CONSTRUCT ) {
			if ( mCanSave == 0 | gArea  == AREA_QUEST | gArea  == AREA_SHELTER ) {
				if ( gArea  == AREA_WILDERNESS ) {
					txt -1, lang("ワールドマップで建設するべきだ。", "You can only build it in the world map.")
				}
				else {
					txt -1, lang("ここには建てられない。", "You can't build it here.")
				}
				gosub *screen_draw
				goto *pc_turn
			}
			gRowAct = ACTION_CONSTRUCT
			gosub *label_3307
			goto *label_4158
		}
		if ( areaId(gArea ) == AREA_RANDOM_DUNGEON ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				if ( areaBoss(gArea ) != (-1) ) {
					txt -1, lang("クエストを放棄してシェルターに避難する？", "Really give up the quest and evacuate to the shelter?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval != 0 ) {
						gosub *screen_draw
						goto *pc_turn
					}
				}
			}
		}
		gRowAct = ACTION_OPEN_HATCH
		gosub *label_3307
		goto *act_use_SWEND1
	}
	if ( _switch_val == 11 ) {
		if ( moneybox(iParam2(ci)) > cGold(CHARA_PLAYER) & ncgGoldOverflow == 0 ) {
			txt -1, lang("金貨が足りない…", "You count your coins and sigh...")
			gosub *screen_draw
			goto *pc_turn
		}
		if ( iStatus(ci) >= ITEM_STATUS_NORMAL ) {
			if ( moneybox(iParam2(ci)) != 2147483647 ) {
				if ( iParam1(ci) >= 1000000000 ) {
					txt -1, lang("貯金箱は一杯だ。", "The money box is full.")
					gosub *screen_draw
					goto *pc_turn
				}
			}
			else {
				if ( iParam1(ci) >= 2000000000 ) {
					txt -1, lang("貯金箱は一杯だ。", "The money box is full.")
					gosub *screen_draw
					goto *pc_turn
				}
			}
			item_separate ci
			snd SOUNDLIST_PAYGOLD1
			cGold(CHARA_PLAYER) -= moneybox(iParam2(ci))
			gosub *label_0422
			if ( moneybox(iParam2(ci)) != 2147483647 ) {
				iParam1(ci) += moneybox(iParam2(ci))
			}
			else {
				iParam1(ci) += 1
			}
			iWeight(ci) += 100
		}
		else {
			cGold(CHARA_PLAYER) -= moneybox(iParam2(ci))
			gosub *label_0422
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), moneybox(iParam2(ci))
			if ( stat ) {
				txt -1, lang("あなたは金貨を落としてしまった。", "You have dropped your coins.")
			}
			else {
				txt -1, lang("あなたは金貨を落としてしまったが、すぐに拾い直した。", "You have dropped your coins. quickly picked it back up.")
			}
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 20 ) {
		efid = SKILL_SPELL_INCOGNITO
		efp = 400
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 47 ) {
		if ( gArea  != AREA_SHOW_HOUSE ) {
			txt -1, lang("それは鈍く輝いた。", "It glows dully.")
			goto *act_use_SWEND1
		}
		if ( iProperty(ci) != PROP_SPECIAL ) {
			txt -1, lang("水晶には領域の記憶が宿っていない。この場所の所有者が配置した水晶を探す必要がある。", "The crystal isn't filled with the memory of this place. You need to find ones placed by the owner of this area.")
			goto *act_use_SWEND1
		}
		allyctrl = 0
		gosub *com_userNpc
		if ( stat != 1 ) {
			goto *act_use_SWEND1
		}
		snd SOUNDLIST_ENC
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		goto *act_use_SWEND1
	}
	if ( _switch_val == 22 ) {
		snd SOUNDLIST_ENC
		if ( mType != MAP_TYPE_TOWN & mType != MAP_TYPE_VILLAGE ) {
			txt -1, lang("それは街でしか使えない。", "You can only use it in a town.")
			goto *act_use_SWEND1
		}
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		txt -1, lang("突然、あなたの目の前に異次元へのゲートが現れた。", "Suddenly, a strange gate opens.")
		comctrl = 2
		gosub *com_import
		if ( stat == 1 ) {
			goto *label_3122
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 49 ) {
		txt -1, lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd SOUNDLIST_BUILD1
		efid = 49
		efp = 100
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 50 ) {
		txt -1, lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd SOUNDLIST_BUILD1
		efid = SKILL_RES_FIRE
		efp = 100
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 21 ) {
		txt -1, lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd SOUNDLIST_BUILD1
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		fixmaterial = iMaterial(ci)
		efid = BUFF_GROW_CONSTITUTION
		efp = 500
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 25 ) {
		txt -1, lang(itemname(ci, 1) + "を使った。", "You hold " + itemname(ci, 1) + " up high.")
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		efid = SKILL_SPACT_RAIN_OF_SANITY
		efp = 500
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 26 ) {
		if ( mType == MAP_TYPE_WORLD ) {
			snd SOUNDLIST_PRAY1
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) += 8640
			txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
			pbk = 0
			cbk = 0
			gosub *label_5035
		}
		else {
			txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
			flagRenewDungeon = 1
			snd SOUNDLIST_PRAY1
			txtef COLOR_YELLOW
			txt -1, lang("オパートス「フハハハ！間もなく、この地に変動が起こるであろう！」", "A voice echoes, " + cnvtalk("Muwahahaha! I shall shake the land for you!"))
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 34 ) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		txtef COLOR_YELLOW
		txt -1, lang("ジュア「べ、別にあんたのためにするんじゃないからね。バカっ！」", "A voice echoes, " + cnvtalk("I-I'm not doing for you! Silly!"))
		efid = SKILL_SPACT_RAIN_OF_SANITY
		efp = 5000
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 43 ) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		txt -1, lang("エヘカトル「呼んだ？呼んだ？」", "A voice echoes, " + cnvtalk("Did you call me? Call me?"))
		addbuff tc, BUFF_LUCK, 77, 2500
		modgrowth2 tc, 19, 20
		goto *act_use_SWEND1
	}
	if ( _switch_val == 27 ) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		preweather = gWeather
		if ( gWeather == WEATHER_ETHER ) {
			txt -1, lang("ルルウィ「あさはかね。エーテルの風を止めてあげるとでも思ったの？」", "A rather angry voice echoes, " + cnvtalk("Listen my little slave. Did you really think I would turn a hand in this filthy wind for you?"))
			goto *act_use_SWEND1
		}
		p = gWeather
		repeat
			if ( rnd(10) == 0 ) {
				gWeather = WEATHER_CLEAR
			}
			if ( rnd(10) == 0 ) {
				gWeather = WEATHER_RAIN
			}
			if ( rnd(15) == 0 ) {
				gWeather = WEATHER_HARD_RAIN
			}
			if ( rnd(20) == 0 ) {
				gWeather = WEATHER_SNOW
			}
			if ( gWeather != p ) {
				break
			}
		loop
		txt -1, lang("ルルウィ「あらあら、定命の分際でそんなおねだりするの？ウフフ…今回は特別よ」", "An impish voice echoes, " + cnvtalk("Ah you ask too much for a mortal. Still, it is hard to refuse a call from such a pretty slave like you."))
		txt -1, lang("天候が変わった。", "The weather changes.")
		envonly = 1
		gosub *music_play
		if ( preweather != gWeather ) {
			throwsstpevent "WeatherChanged", 0, _weather(preweather), 0
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 28 ) {
		if ( mType == MAP_TYPE_WORLD ) {
			txt -1, lang("ここでは使えない。", "You can't place it here.")
			gosub *screen_draw
			goto *pc_turn
		}
		if ( cX(CHARA_PLAYER) != 33 | cY(CHARA_PLAYER) != 16 ) {
			if ( sqNuke == 1 ) {
				txt -1, lang("ここはクエストの目標位置ではない。本当にここに設置する？", "This location is not your quest goal. Really place it here?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval != 0 ) {
					gosub *screen_draw
					goto *pc_turn
				}
			}
		}
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		txt -1, lang("原子爆弾を設置した。逃げろォー！", "You set up the nuke...now run!!")
		snd SOUNDLIST_BUILD1
		addmef cX(cc), cY(cc), MEF_TYPE_NUKE, xy2pic(5, 19), 10, 100, cc
		throwsstpevent "SetNuke", 0, "", 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == 48 ) {
		if ( gArea  != AREA_SHOW_HOUSE | usermapid == 0 ) {
			txt -1, lang("それはこの場所ではみすぼらしく見える。", "It looks so dumb here.")
			goto *act_use_SWEND1
		}
		txt -1, lang("この石像を見つめていると、何かを投げつけたくなってうずうずしてきた！", "Watching this strange statue makes you want to throw something at it!")
		gosub *browser
		goto *act_use_SWEND1
	}
	if ( _switch_val == 29 ) {
		if ( iParam1(ci) != 251 ) {
			settrait 0, iParam1(ci), 1
		}
		if ( iParam1(ci) == 169 ) {
			settrait 0, 162, 0
		}
		if ( iParam1(ci) == 162 ) {
			settrait 0, 169, 0
		}
		if ( iParam1(ci) == 251 ) {
			settrait 0, 251, gettrait(0, 251) + 1
			ncgTotalSoulCount++
		}
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		txt -1, lang("あなたは新たなフィートを獲得した！", "You gain a new feat.")
		animeload 10, 0
		r1 = cc
		gosub *charaRefresh
		goto *act_use_SWEND1
	}
	if ( _switch_val == 30 ) {
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		if ( iID(ci) == ITEM_ID_CARNEADES_PLANK ) {
			if ( equalsitem(ci, "Plamja's gem stone") ) {
				removeallfire
			}
		}
		efid = iParam1(ci)
		efp = iParam2(ci)
		tc = cc
		efstatus = 0
		gosub *label_3383
		goto *act_use_SWEND1
	}
	if ( _switch_val == 41 ) {
		txt -1, lang("誰にクミロミの秘密の経験を使う？", "Who do you want to use the secret experience of Kumiromi to?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		if ( stat == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			gosub *screen_draw
			goto *pc_turn
		}
		tc = mapChara(x, y) - 1
		if ( iStatus(ci) == ITEM_STATUS_DOOMED ) {
			if ( petcheck(tc) ) {
				snd SOUNDLIST_CURSE3
				animeload 14, tc
				iNum(ci)--
				cell_refresh iX(ci), iY(ci)
				ocFeatsAcquirable(tc) = 0
				txt -1, lang("「汚れたね」", cnvtalk(cnven(he(tc)) + " got dirty.")), lang("「…これが…君の望んでいた結果？」", cnvtalk(cnven(he(tc)) + " got dirty."))
				txtef COLOR_PURPLE
				txt -1, lang(name(tc) + "は新たなフィートを取得できなくなった", name(tc) + " lost the right to obtain new feats.")
				goto *act_use_SWEND1
			}
			if ( tc == CHARA_PLAYER ) {
				snd SOUNDLIST_CURSE3
				animeload 14, tc
				iNum(ci)--
				cell_refresh iX(ci), iY(ci)
				gTraitPoint = 0
				txt -1, lang("「汚れたね」", cnvtalk("You got dirty.")), lang("「…これが…君の望んでいた結果？」", cnvtalk("...are you satisfied now?"))
				txtef COLOR_PURPLE
				txt -1, lang(name(tc) + "は新たなフィートを取得できなくなった", name(tc) + " lost the right to obtain new feats.")
				goto *act_use_SWEND1
			}
		}
		else {
			if ( petcheck(tc) ) {
				migration_normalizefieldsofjewelofloveandkumiromisexperience tc
				if ( ocdata(109, tc) > cLevel(tc) ) {
					txt -1, lang("クミロミの声がした。「ダメ…経験…足りない…」", "Kumiromi talks to you, " + cnvtalk("No..." + he(tc) + " " + is(tc) + "n't...experienced enough...for this..."))
					gosub *screen_draw
					goto *pc_turn
				}
				snd SOUNDLIST_PRAY1
				animeload 10, tc
				ocdata(109, tc) += 10
				iNum(ci)--
				cell_refresh iX(ci), iY(ci)
				ocFeatsAcquirable(tc)++
				txt -1, lang("「…よく…経験をつんだね…酬いてあげる…」", cnvtalk("..." + he(tc) + " " + have(tc) + " acquired enough...experience...I shall reward " + him(tc) + "..."))
				txtef COLOR_YELLOW
				txt -1, lang("クミロミは" + name(tc) + "を祝福した。" + name(tc) + "は新たなフィートを取得できるようになった！", "Kumiromi blesses " + him(tc) + ". " + cnven(he(tc)) + " can obtain one more feat now!")
				goto *act_use_SWEND1
			}
			if ( tc == CHARA_PLAYER ) {
				if ( gNewFeat > cLevel(CHARA_PLAYER) ) {
					txt -1, lang("クミロミの声がした。「ダメ…経験…足りない…」", "Kumiromi talks to you, " + cnvtalk("No...you aren't...experienced enough...for this..."))
					gosub *screen_draw
					goto *pc_turn
				}
				snd SOUNDLIST_PRAY1
				animeload 10, tc
				gNewFeat += 10
				iNum(ci)--
				cell_refresh iX(ci), iY(ci)
				gTraitPoint++
				txt -1, lang("「…よく…経験をつんだね…酬いてあげる…」", cnvtalk("...You have acquired enough...experience...I shall reward you..."))
				txtef COLOR_YELLOW
				txt -1, lang("クミロミは" + name(tc) + "を祝福した。" + name(tc) + "は新たなフィートを取得できるようになった！", "Kumiromi blesses you. You can obtain one more feat now!")
				goto *act_use_SWEND1
			}
		}
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		goto *act_use_SWEND1
	}
	if ( _switch_val == 42 ) {
		snd SOUNDLIST_CURSE1
		txtef COLOR_PURPLE
		txt -1, lang("何だか嫌な予感がする…", "You have a bad feeling about this...")
		goto *act_use_SWEND1
	}
	if ( _switch_val == 46 ) {
		txtnew
		txt -1, lang("本当に首を吊る？", "Really hang yourself?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval != 0 ) {
			goto *label_4158
		}
		ctalk 0, 1266, 0, 0
		dmghp CHARA_PLAYER, 99999, DAMAGE_FROM_HANGING
		goto *act_use_SWEND1
	}
	if ( _switch_val == 33 ) {
		if ( iSubName(ci) == 0 ) {
			txt -1, lang("モンスターボールは空っぽだ。", "This ball is empty.")
			goto *act_use_SWEND1
		}
		if ( get_freeally() == 0 | gettrait(0, 184) < 0 ) {
			txt -1, lang("仲間はこれ以上増やせない。", "Your party is full.")
			goto *act_use_SWEND1
		}
		txt -1, lang(itemname(ci, 1) + "を使用した。", "You activate " + itemname(ci, 1) + ".")
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		flt
		initlv = iParam3(ci)
		novoidlv = 1
		clnum = -1
		nomagicdevice = 1
		noenchant = 1
		noencpfix = 1
		if ( iSubName(ci) == 343 ) {
			if ( iCNpcId(ci) != usernpcmax ) {
				initunid = iCNpcId(ci) + 1
			}
		}
		characreate MAX_CHARA_NC, iSubName(ci), -3, 0
		clnum = 0
		rc = MAX_CHARA_NC
		gosub *cm_race_loop_WHILE1
		goto *act_use_SWEND1
	}
	if ( _switch_val == 31 ) {
		x = cX(cc)
		y = cY(cc)
		cell_featread x, y
		if ( featId != CELL_FEATURE_PLANTED_SEED ) {
			txt -1, lang("それは種を植えた場所で使わなければならない。", "You don't see any plant on the ground.")
			goto *act_use_SWEND1
		}
		if ( feat == tile_plant + 2 ) {
			txt -1, lang("この作物は既に成長しきっている。", "The plant has already grown full.")
			goto *act_use_SWEND1
		}
		if ( feat == tile_plant + 3 ) {
			feat = tile_plant + 1
			gosub *label_3706
			txt -1, lang("枯れた植物に生命が宿った。", "The plant revives.")
		}
		else {
			feat++
			txt -1, lang("植物は成長した。", "The plant grows.")
		}
		cell_featset x, y, feat, featId, featIdSub, featParam1
		animeload 8, 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == 32 ) {
		txtnew
		txt -1, lang("まずは素体となる仲間を選ぶ必要がある。", "Choose an original body.")
		rc = CHARA_PLAYER
		allyctrl = 5
		gosub *label_2611
		if ( stat == (-1) ) {
			goto *label_4158
		}
		rc = stat
		txtnew
		txt -1, lang("遺伝子を取り出す仲間を選ぶ必要がある。この仲間は合成後、永久に失われる。", "Choose a gene. Once you extract a gene, the subject will be lost forever.")
		repeat
			allyctrl = 5
			gosub *label_2611
			f = stat
			if ( f == (-1) ) {
				break
			}
			if ( cbit(CHARA_BIT_STETHOSCOPE, f) ) {
				txtnew
				txt -1, lang("遺伝子を取り出すには聴診器を外す必要がある。", he(f) + " is your precious ally! You need to unwatch " + his(f) + " health to extract " + his(f) + " gene.")
				continue
			}
			break
		loop
		if ( f == (-1) ) {
			goto *label_4158
		}
		tc = f
		gosub *screen_draw
		txtnew
		txt -1, lang("本当に" + cnName(rc) + "に" + cnName(tc) + "の遺伝子を組み込む？", "Really add " + cnName(tc) + "'s gene to " + cnName(rc) + "?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval != 0 ) {
			goto *label_4158
		}
		rtval = 0
		if ( ogTitleMincemeatAlchemist == 2 ) {
			txtnew
			txt -1, lang("どちらの遺伝子を組み込む？", "Which add gene?")
			promptl(0, 0) = lang("能力値", "Attributes"), "a", "0"
			promptl(0, 1) = lang("技能", "skill"), "b", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
		}
		txtnew
		txtef COLOR_YELLOW
		txt -1, lang("" + cnName(rc) + "は" + cnName(tc) + "の遺伝子を受けついだ！", "" + cnName(rc) + " has inherited " + cnName(tc) + "'s gene!")
		if ( eqfaction(tc, "whole") & eqfaction(rc, "whole") == 0 ) {
			txtef COLOR_PURPLE
			txt -1, lang("" + cnName(rc) + "は娼婦になった。", "" + cnName(rc) + " has changed whole.")
			addfaction rc, "whole"
			ocAISpecialAction1(rc) = 0
			cAiCalm(rc) = 5
		}
		animeid = ANIMATION_GENE
		anic = rc
		gosub *anime
		if ( rtval == 0 ) {
			gosub *gene_body
			if ( stat != (-1) ) {
				cdata(stat, rc) = rtval * 10000
				txtef COLOR_GREEN
				txt -1, lang(cnName(rc) + "は新しい" + bodyn(rtval) + "を得た！", cnName(rc) + " gains new " + bodyn(rtval) + "!")
				r1 = rc
				gosub *label_1581
			}
			gosub *gene_skill
			if ( stat != 0 ) {
				repeat 2
					if ( rtval(cnt) == (-1) ) {
						break
					}
					skillgain rc, rtval(cnt), 1
					txtef COLOR_GREEN
					txt -1, lang(cnName(rc) + "は" + skillname(rtval(cnt)) + "の技術を覚えた！", cnName(rc) + " learns " + skillname(rtval(cnt)) + " skill!")
				loop
			}
			if ( cLevel(tc) > cLevel(rc) ) {
				lv = (cLevel(tc) - cLevel(rc)) / 2 + 1
				repeat lv
					r1 = rc
					r2 = 1
					gosub *label_1588
				loop
				txtef COLOR_GREEN
				txt -1, lang(cnName(rc) + "はレベル" + cLevel(rc) + "になった！", cnName(rc) + " is now level " + cLevel(rc) + "!")
				listmax = 0
				repeat 18 - 10, 10
					list(0, listmax) = cnt, sorg(cnt, tc)
					listmax++
				loop
				gosub *sort_list
				repeat 3
					p = listmax - cnt - 1
					i = list(0, p)
					if ( list(1, p) > sorg(i, rc) ) {
						p = (list(1, p) - sorg(i, rc)) * 500
						p = limit(p * 10 / limit(lv, 2, 10), 1000, 10000)
						skillmod i, rc, p
					}
				loop
			}
		}
		else {
			rc_subact = 0
			tc_subact = 0
			rc_subact = int(cActIndex(rc) / 10)
			tc_subact = int(cActIndex(tc) / 10)
			if ( rc_subact == 5 ) {
				txt -1, lang(cnName(rc) + "はこれ以上新しい技能を覚えることが出来ない。", cnName(rc) + "cannot learn any more skills.")
			}
			else {
				if ( tc_subact == 0 ) {
					txt -1, lang(cnName(tc) + "から技能を得ることは出来なかった…", "couldn't get skills from " + cnName(tc) + " ...")
				}
				else {
					txtnew
					txtef COLOR_GREEN
					if ( cActHeal(tc) != 0 & rnd(10) == 0 ) {
						getactid = cActHeal(tc)
					}
					else {
						getactid = cdata(STARTING_CDATA_ACT_SUB + rnd(tc_subact), tc)
					}
					if ( getactid <= 0 ) {
						if ( getactid == 0 ) {
							bufstr = "何もしない"
						}
						if ( getactid == (-1) ) {
							bufstr = "近接攻撃"
						}
						if ( getactid == (-2) ) {
							bufstr = "遠隔攻撃"
						}
						if ( getactid == (-3) ) {
							bufstr = "接近待ち"
						}
						if ( getactid == (-4) ) {
							bufstr = "ランダム移動"
						}
						if ( getactid == (-9994) ) {
							bufstr = "媚薬投擲"
						}
						if ( getactid == (-9995) ) {
							bufstr = "トマト投擲"
						}
						if ( getactid == (-9996) ) {
							bufstr = "塩投擲"
						}
						if ( getactid == (-9997) ) {
							bufstr = "ポーション投擲 No.1"
						}
						if ( getactid == (-9998) ) {
							bufstr = "ポーション投擲 No.2"
						}
						if ( getactid == (-9999) ) {
							bufstr = "ポーション投擲 No.3"
						}
						txt -1, lang(cnName(rc) + "は" + bufstr + "を習得した！", cnName(rc) + " learns " + bufstr + "!")
					}
					else {
						txt -1, lang(cnName(rc) + "は" + skillname(getactid) + "を習得した！", cnName(rc) + " learns " + skillname(getactid) + "!")
					}
					cdata(STARTING_CDATA_ACT_SUB + rc_subact, rc) = getactid
					cActIndex(rc) += 10
					if ( cAiSub(rc) == 0 ) {
						cAiSub(rc) = 20
					}
				}
			}
		}
		if ( ocLight(tc) ) {
			i = getcharapic(rc)
			if ( chipc(CHIPC_HEIGHT, i) > 48 ) {
				if ( lightdata(LIGHTDATA_Y, ocLight(tc)) >= 24 & lightdata(LIGHTDATA_Y, ocLight(tc)) < 48 ) {
					ocLight(rc) = ocLight(tc)
				}
			}
			else {
				if ( lightdata(LIGHTDATA_Y, ocLight(tc)) < 24 ) {
					ocLight(rc) = ocLight(tc)
				}
			}
		}
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 1 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		skillexp2 SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER, 1200 + (cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) == FALSE & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) == FALSE) * limit(cLevel(tc) * 8 / 3, 0, 4000)
		chara_vanquish tc
		randomize
		screenupdate = -1
		gosub *screen_draw
		cc = rc
		csctrl = 4
		snd SOUNDLIST_POP2
		gosub *label_2879
		cc = CHARA_PLAYER
		goto *act_use_SWEND1
	}
	if ( _switch_val == 35 ) {
		txt -1, lang("あなたはアイアンメイデンの中に入った。", "You enter the iron maiden.")
		txtef COLOR_SKY_BLUE
		ctalk 0, 1264, 0, 0
		if ( stat == 0 ) {
			txt -1, lang("「わくわく♪」", cnvtalk("Interesting!"))
		}
		txt -1, lang("突然誰かが蓋を閉めた。", "Suddenly, someone closes the door.")
		txtef COLOR_SKY_BLUE
		txt -1, lang("「ニヤリ」", "*Grin*")
		dmghp CHARA_PLAYER, 9999, DAMAGE_FROM_MAIDEN
		goto *act_use_SWEND1
	}
	if ( _switch_val == 36 ) {
		txt -1, lang("あなたはギロチンに首をつっこんでみた。", "You set your head on the guillotine.")
		txtef COLOR_SKY_BLUE
		ctalk 0, 1265, 0, 0
		if ( stat == 0 ) {
			txt -1, lang("「わくわく♪」", cnvtalk("Interesting!"))
		}
		txt -1, lang("突然誰かがギロチンの刃を落とした。", "Suddenly, someone activates the guillotine.")
		txtef COLOR_SKY_BLUE
		txt -1, lang("「ニヤリ」", "*Grin*")
		dmghp CHARA_PLAYER, 9999, DAMAGE_FROM_GUILLOTINE
		goto *act_use_SWEND1
	}
	if ( _switch_val == 39 ) {
		if ( cc > 15 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *act_use_SWEND1
		}
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang(npcn(cc) + itemname(ci, 1) + "を鳴らした。", name(cc) + " blow" + _s(cc) + " on the " + itemname(ci, 1) + ".")
			f = 1
		}
		txtef COLOR_SKY_BLUE
		txt -1, lang(" *ピーーーー* ", "*Peeeeeeeeeep* ")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		repeat 229, 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cSleep(cnt) != 0 ) {
				continue
			}
			if ( dist(cX(cnt), cY(cnt), cX(cc), cY(cc)) > 10 ) {
				continue
			}
			if ( relationbetween(cc, cnt) >= (-1) ) {
				continue
			}
			if ( sCHR(cc) > rnd(cLevel(cnt) + cLevel(cc)) ) {
				turn_aggro cnt, cc, 80
			}
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == 38 ) {
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			tc = mapChara(tlocx, tlocy) - 1
			if ( tc == (-1) ) {
				txt -1, lang("それは無理だ。", "It's impossible.")
				goto *act_use_SWEND1
			}
			if ( cId(tc) != CREATURE_ID_ANDROID | iSubName(ci) == 0 | iSubName(ci) == 212 | iSubName(ci) == 340 ) {
				f = 1
			}
			if ( iSubName(ci) == 306 & npcmemory(0, CREATURE_ID_LULWY) < 100 ) {
				f = 1
			}
			if ( iSubName(ci) == 331 & npcmemory(0, CREATURE_ID_EHEKATL) < 100 ) {
				f = 1
			}
			if ( iSubName(ci) == 336 & npcmemory(0, CREATURE_ID_GOD_INSIDE_EHEKATL) < 100 ) {
				f = 1
			}
			if ( iSubName(ci) == 338 & npcmemory(0, CREATURE_ID_OPATOS) < 100 ) {
				f = 1
			}
			if ( iSubName(ci) == 339 & npcmemory(0, CREATURE_ID_KUMIROMI) < 100 ) {
				f = 1
			}
			if ( iSubName(ci) == 342 & npcmemory(0, CREATURE_ID_MANI) < 100 ) {
				f = 1
			}
			if ( iSubName(ci) == 366 & npcmemory(0, CREATURE_ID_JURE) < 100 ) {
				f = 1
			}
			if ( iSubName(ci) == 367 & npcmemory(0, CREATURE_ID_ITZPALT) < 100 ) {
				f = 1
			}
			if ( f ) {
				txt -1, lang("それは無理だ。", "It's impossible.")
				goto *act_use_SWEND1
			}
			aimonster = iSubName(ci)
			flt
			if ( aimonster == 343 ) {
				initunid = iCNpcId(ci) + 1
				ocdata(55, tc) = iCNpcId(ci) + 1
			}
			else {
				ocdata(55, tc) = 0
			}
			ocAISpecialAction1(tc) = 0
			ocAISpecialAction2(tc) = 0
			cibk = ci
			ocdata((54 /*!!!@[OCDATA_CARD_CREATURE_ID @@@ OCDATA_CARD_CUSTOM_CREATURE_ID]@!!! */), tc) = aimonster
			characreate MAX_CHARA_NC, aimonster, -3, 0
			cAiCalm(tc) = cAiCalm(MAX_CHARA_NC)
			cAiMoveFreq(tc) = cAiMoveFreq(MAX_CHARA_NC)
			cAiDistance(tc) = cAiDistance(MAX_CHARA_NC)
			cAiSub(tc) = cAiSub(MAX_CHARA_NC)
			cActHeal(tc) = cActHeal(MAX_CHARA_NC)
			cActIndex(tc) = cActIndex(MAX_CHARA_NC)
			repeat 10
				cdata(STARTING_CDATA_ACT_MAIN + cnt, tc) = cdata(STARTING_CDATA_ACT_MAIN + cnt, MAX_CHARA_NC)
			loop
			chara_vanquish MAX_CHARA_NC
			ci = cibk
			snd SOUNDLIST_PRAY1
			txt -1, lang("あなたは" + name(tc) + "に" + itemname(ci, 1) + "を通した。", "You pass " + itemname(ci, 1) + " through the card reader in " + name(tc) + ".")
			txtef COLOR_SKY_BLUE
			txt tc, lang(name(tc) + "「がしゃーんがしゃーん」", " *clank* *clank* ")
			f = 1
		}
		if ( f == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 51 ) {
		txt -1, lang("誰を鞭で叩く？", "Whipping who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( mapChara(x, y) > 0 ) {
				tc = mapChara(x, y) - 1
				if ( tc == CHARA_PLAYER ) {
					if ( gRider == 0 ) {
						snd SOUNDLIST_ARROW1
						txt -1, lang("あなたは自分を鞭で叩いた…", "You whipping self...")
						ctalk 0, 1108, 0, 0
						goto *act_use_SWEND1
					}
					else {
						snd SOUNDLIST_ARROW1
						txt -1, lang("あなたは鞭で" + name(gRider) + "に喝を入れた。", "You whipping " + name(tc) + ".")
						if ( synccheck(tc, -1) ) {
							txtef COLOR_BLUE
							txt -1, lang(name(gRider) + "は興奮した！", name(gRider) + " " + is(tc) + " excited!")
						}
						addbuff gRider, BUFF_SPEED, sCHR(cc) * 5 + 50, 10
						addbuff gRider, BUFF_HERO, sCHR(cc) * 5 + 100, 10
						goto *act_use_SWEND1
					}
				}
				else {
					f = 0
					snd SOUNDLIST_ARROW1
					txt -1, lang("あなたは鞭で" + name(tc) + "を叩いた。", "You whipping " + name(tc) + ".")
					sdim naturevalues, 3
					getfactionvalues tc, "nature", naturevalues
					repeat stat
						s = getfactionlabel(naturen, naturevalues(cnt))
						if ( s == "マゾヒスト" ) {
							f = 1
							break
						}
					loop
					if ( eqfaction(tc, "likewhip") | f == 1 ) {
						txtef COLOR_SKY_BLUE
						txt -1, lang(name(tc) + "は呻き声を洩らした。", name(tc) + " glares at you.")
						ctalk tc, 1109, 0, tc
						if ( stat == 0 ) {
							txtef COLOR_SKY_BLUE
							txt tc, lang("「はぁはぁ…」", cnvtalk("D-don't sto....N-nothing!"))
						}
						if ( synccheck(tc, -1) ) {
							txtef COLOR_BLUE
							txt -1, lang(name(tc) + "は興奮した！", name(tc) + " " + is(tc) + " excited!")
						}
						addbuff tc, BUFF_SPEED, sCHR(cc) * 5 + 50, 10
						addbuff tc, BUFF_HERO, sCHR(cc) * 5 + 100, 10
						addbuff tc, BUFF_CONTINGENCY, 1500, 10
						if ( implevel(cImpression(tc)) < 5 ) {
							modimp tc, 1
						}
					}
					else {
						txtef COLOR_PURPLE
						txt -1, lang(name(tc) + "は嫌な顔をした。", name(tc) + " glares at you.")
						ctalk tc, 1108, 0, tc
						modimp tc, -1
					}
					if ( petcheck(tc) ) {
						inv_getheader tc
						repeat invrange, invhead
							if ( iNum(cnt) != 0 & refitem(iID(cnt), DBSPEC_TYPE, cnt) == FILTER_ORE ) {
								ti = inv_getfreeid(CHARA_PLAYER)
								if ( ti == (-1) ) {
									txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
									break
								}
								item_copy cnt, ti
								iNum(ti) = iNum(cnt)
								iNum(cnt) = 0
								item_stack CHARA_PLAYER, ti, 1
								convertartifact ti
								txt -1, lang(name(tc) + "から" + itemname(ti) + "を取った。", "" + itemname(ti) + " falls at " + name(tc) + "'s feet.")
								break
							}
						loop
					}
				}
				f = 1
			}
		}
		if ( f == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 52 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		ti = ci
		invsubroutine = 1
		invctrl = 34, 0
		snd SOUNDLIST_INV
		gosub *label_2974
		if ( stat == 0 ) {
			goto *act_use_SWEND1
		}
		if ( iNum(ci) > 1 ) {
			txt -1, lang("" + itemname(ci, 1) + "をいくつ肥料にする？ (1〜" + iNum(ci) + ")", "How many? (1 to " + iNum(ci) + ")")
			display_msg screenmsgy, 1
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
			inputlog = "" + iNum(ci)
			gosub *prompt_word
			in = int(inputlog)
			if ( in > iNum(ci) ) {
				in = iNum(ci)
			}
			if ( in == 0 | rtval == (-1) ) {
				goto *act_use_SWEND1
			}
		}
		else {
			in = 1
		}
		animeload 8, cc
		txt -1, lang("" + in + "個の" + itemname(ci, 1) + "を肥料にした。", "Fertilized" + in + " " + itemname(ci, 1) + ".")
		repeat in
			if ( rnd(20) == 0 | iID(ci) == ITEM_ID_SHIT ) {
				if ( iParam1(ti) >= iParam3(ti) ) {
					txt -1, lang("これ以上新しい実は生らない。", "Dont New fruit grows.")
					break
				}
				else {
					txtef COLOR_GREEN
					txt -1, lang("新しい実がついた！", "A New fruit grows!")
					iParam1(ti) += 1
					iPic(ti) = xy2pic(30, 17)
				}
				animeload 8, cc
			}
		loop
		removeitem ci, in
		goto *act_use_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 53 ) {
		if ( mType == MAP_TYPE_WORLD ) {
			txt -1, lang("ここでは使えない。", "You can't use it here.")
			goto *act_use_SWEND1
		}
		txt -1, lang("あなたは卵を孵そうとした。", "You hatched an egg.")
		animeload 8, cc
		flt
		initlv = iPV(ci)
		novoidlv = 1
		childid = inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)
		if ( childid == 0 ) {
			childid = 330
		}
		if ( childid == 319 | childid == 368 ) {
			childid = 176
		}
		if ( childid == 343 ) {
			initunid = iDV(ci) + 1
		}
		if ( childid == (-1) ) {
			childid = cId(cc)
			if ( childid == 343 ) {
				initunid = iDV(ci) + 1
			}
		}
		nc_intb_100 = ci
		characreate -1, childid, cX(cc), cY(cc)
		if ( stat != 0 ) {
			ci = nc_intb_100
			cAge(rc) = gYear 
			if ( cRelation(rc) == RELATION_ALLY | cRelation(rc) == RELATION_NEUTRAL ) {
				cRelation(rc) = RELATION_DISLIKE
				cOrgRelation(rc) = RELATION_DISLIKE
			}
			if ( iStatus(ci) == ITEM_STATUS_NORMAL & rnd(2) | iStatus(ci) == ITEM_STATUS_BLESSED ) {
				cRelation(rc) = RELATION_DISLIKE
				cOrgRelation(rc) = RELATION_DISLIKE
			}
			if ( iStatus(ci) < ITEM_STATUS_NORMAL ) {
				cRelation(rc) = RELATION_ENEMY
				cOrgRelation(rc) = RELATION_ENEMY
			}
			if ( ibit(ITEM_BIT_PRECIOUS, ci) ) {
				cnName(rc) = lang(cnName(CHARA_PLAYER) + "の子供", "child of " + cnName(CHARA_PLAYER))
				if ( cRelation(rc) == RELATION_DISLIKE ) {
					addfaction rc, "pcchild"
				}
			}
			else {
				if ( iSubName(ci) == 343 ) {
					if ( cUNID(cc) != usernpcmax ) {
						cnName(rc) = lang(userdatan(1, cUNID(cc)) + "の子供", "child of " + userdatan(0, cUNID(cc), 2, 1))
					}
					else {
						cnName(rc) = lang("残りカスの子供", "child of garbage")
					}
				}
				else {
					cnName(rc) = lang(refchara(iSubName(ci), DBSPEC_CHARA_NAME_ORG, 1) + "の子供", "child of " + refchara(iSubName(ci), DBSPEC_CHARA_NAME_ORG, 1))
				}
			}
			txt -1, lang("卵から" + cnName(rc) + "が孵った。", cnName(rc) + "hatched from an egg.")
			ctalk cc, 1138, cc, rc
			iNum(ci)--
		}
		else {
			txt -1, lang("孵すスペースがない。", "You can't use it here.")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 54 ) {
		if ( iNum(ci) > 1 ) {
			txt -1, lang(itemname(ci, 1) + "をいくつ使用する？", "How many?")
			display_msg screenmsgy, 1
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
			inputlog = "" + iNum(ci)
			gosub *prompt_word
			in = int(inputlog)
			if ( in > iNum(ci) ) {
				in = iNum(ci)
			}
			if ( in == 0 | rtval == (-1) ) {
				goto *act_use_SWEND1
			}
		}
		else {
			in = 1
		}
		snd SOUNDLIST_PAYGOLD1
		iNum(ci) -= in
		cPlat(CHARA_PLAYER) = limitaddition(cPlat(CHARA_PLAYER), in)
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1000 ) {
		if ( gArea  != AREA_SHOW_HOUSE ) {
			txt -1, lang("それは鈍く輝いた。", "It glows dully.")
			goto *act_use_SWEND1
		}
		if ( iProperty(ci) != PROP_SPECIAL ) {
			txt -1, lang("このアイテムには領域の記憶が宿っていない。この場所の所有者が配置したアイテムを探す必要がある。", "The crystal isn't filled with the memory of this place. You need to find ones placed by the owner of this area.")
			goto *act_use_SWEND1
		}
		gosub *label_4353
		if ( stat != 1 ) {
			goto *act_use_SWEND1
		}
		snd SOUNDLIST_ENC
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1001 ) {
		outputmapimage iStatus(ci)
		snd SOUNDLIST_WRITE1
		txt -1, lang("周囲の風景をカメラに収めた。", "You captured the surrounding landscape with a camera.")
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1501 ) {
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *act_use_SWEND1
		}
		txtnew
		txt -1, lang(name(cc) + "は" + itemname(ci) + "を使い始めた。", " ")
		cRowAct(cc) = 25001
		cActionPeriod(cc) = 30 + rnd(11)
		cItemUsing(cc) = ci
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1502 ) {
		if ( mType == MAP_TYPE_WORLD ) {
			txt -1, lang("それはここでは使えない。", "You can't use it here.")
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			gosub *screen_draw
			goto *pc_turn
		}
		locvar_dipcursed_noseed = 1
		repeat 200
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) == FILTER_ITEM_SEED ) {
				locvar_dipcursed_noseed = 0
				break
			}
		loop
		if ( locvar_dipcursed_noseed ) {
			txt -1, lang("それは種を持っていなければ使えない。", "You don't have seeds to plant.")
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			gosub *screen_draw
			goto *pc_turn
		}
		crop_count = 0
		repeat mWidth
			cnt2 = cnt
			repeat mHeight
				if ( mapFeat(cnt2, cnt) != 0 ) {
					continue
				}
				if ( chipm(CHIPM_ROLE, mapId(cnt2, cnt)) != MAP_CHIP_ROLE_CROP ) {
					continue
				}
				crop_count++
			loop
		loop
		if ( crop_count == 0 ) {
			txt -1, lang("それは種を蒔く畑がなければ使えない。", "No crops here.")
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			gosub *screen_draw
			goto *pc_turn
		}
		if ( ogTitleHarvester == 2 & godcheck() == "kumiromi" ) {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
		}
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		txt -1, lang("あなたは" + crop_count + "個の種を植えられる。どの種を植える？", "You can plant " + crop_count + " seeds. Which seeds would you plant?")
		invsubroutine = 1
		invctrl = 31, 0
		gosub *label_2974
		if ( stat == 0 ) {
			snd SOUNDLIST_PRAY1
			txtef COLOR_YELLOW
			txt -1, lang("クミロミ「……またね」", "You hear a quiet voice, " + cnvtalk("...See you."))
			goto *act_use_SWEND1
		}
		repeat mWidth
			cnt2 = cnt
			repeat mHeight
				if ( mapFeat(cnt2, cnt) != 0 ) {
					continue
				}
				if ( chipm(CHIPM_ROLE, mapId(cnt2, cnt)) != MAP_CHIP_ROLE_CROP ) {
					continue
				}
				feat = tile_plant, 29, iMaterial(ci)
				gosub *label_3706
				cell_featset cnt2, cnt, tile_plant, CELL_FEATURE_PLANTED_SEED, iMaterial(ci), featParam1
				removeitem ci, 1
				if ( iNum(ci) == 0 ) {
					break
				}
			loop
			if ( iNum(ci) == 0 ) {
				break
			}
		loop
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		txt -1, lang("クミロミ「…これで…いいかい？」", "Someone whispers, " + cnvtalk("...Is it okay?"))
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1503 ) {
		txtnew
		txt -1, lang("ゴミ箱を空にする？", "Do you empty the trash?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval == 0 ) {
			trash_clear
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1504 ) {
		if ( areaType(gArea ) != MAP_TYPE_HOME ) {
			txt -1, lang("それは自分の物件でのみ使用できる。", "You can only use it at your home.")
			goto *act_use_SWEND1
		}
		anvil = 0
		repeat 5480
			if ( iNum(cnt) <= 0 ) {
				continue
			}
			if ( iID(cnt) == ITEM_ID_TRASH_CAN ) {
				anvil = 1
				break
			}
		loop
		if ( anvil == 0 ) {
			txt -1, lang("トラッシュカンが必要だ。", "Requires an Trashcan.")
			goto *act_use_SWEND1
		}
		txtnew
		if ( iStatus(ci) == ITEM_STATUS_BLESSED ) {
			txt -1, lang("付近のアイテムを全てゴミ箱に片付ける？", "Do you into the trash on area?")
		}
		else {
			txt -1, lang("足元のアイテムをゴミ箱に片付ける？", "Do you into the trash?")
		}
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval == 0 ) {
			inv_getheader -1
			repeat invrange, invhead
				if ( iNum(cnt) > 0 & iID(cnt) != ITEM_ID_TRASH_CAN & refitem(iID(cnt), DBSPEC_TYPE, cnt) != FILTER_CARGO_TRADE & iProperty(cnt) != PROP_CONSTRUCT ) {
					if ( iStatus(ci) == ITEM_STATUS_BLESSED ) {
						trash_push cnt
						iNum(cnt) = 0
						if ( iX(cnt) >= 0 & iX(cnt) < mWidth & iY(cnt) >= 0 & iY(cnt) < mHeight ) {
							cell_refresh iX(cnt), iY(cnt)
						}
					}
					else {
						if ( iX(cnt) == cX(CHARA_PLAYER) & iY(cnt) == cY(CHARA_PLAYER) ) {
							trash_push cnt
							iNum(cnt) = 0
						}
					}
				}
			loop
			trash_throw
			cell_refresh cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			snd SOUNDLIST_BUSH1
			if ( iStatus(ci) == ITEM_STATUS_BLESSED ) {
				txt -1, lang("付近のアイテムをすべてゴミ箱に片付けた。", "You into the trash item.")
			}
			else {
				txt -1, lang("足元のアイテムをゴミ箱に片付けた。", "You into the trash item.")
			}
			ctalk 0, 1136, 0, 0
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1505 ) {
		tcchat = tc
		allyctrl = 4
		gosub *label_2611
		if ( stat != (-1) ) {
			rc = stat
			cc = rc
			csctrl = 4
			snd SOUNDLIST_POP2
			gosub *label_2879
			cc = CHARA_PLAYER
			gosub *chat_refresh
			buff = ""
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 2000 ) {
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *act_use_SWEND1
		}
		cw = ci
		snd SOUNDLIST_INV
		gosub *label_4472
		if ( stat ) {
			extend = 0
			cRowAct(cc) = 20012
			cActionPeriod(cc) = 25 - gettrait(cc, 70) * 5 + rnd(11)
			cItemUsing(cc) = cw
		}
		else {
			obvious = 0
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == 2001 ) {
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *act_use_SWEND1
		}
		txtnew
		txt -1, lang(name(cc) + "は入浴をはじめた。", name(cc) + " start" + _s(cc) + " bathing.")
		cRowAct(cc) = 20001
		cActionPeriod(cc) = 25 + rnd(10)
		goto *act_use_SWEND1
	}
	if ( _switch_val == 2002 ) {
		txt -1, lang("誰を対象にする？", "Who do you want to use the jewel of love to?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( mapChara(x, y) > 0 ) {
				tc = mapChara(x, y) - 1
				if ( cId(tc) != iSubName(ci) | (iSubName(ci) == 343 & cUNID(tc) != iCNpcId(ci)) ) {
					txt -1, lang("これは異なるペットとの愛情の証だ。", "It is not " + his(tc) + " jewel of love.")
					goto *act_use_SWEND1
				}
				if ( petcheck(tc) == 0 ) {
					txt -1, lang(cnName(tc) + "はあなたのペットではない。", he(tc) + " is not your ally.")
					goto *act_use_SWEND1
				}
				if ( implevel(cImpression(tc)) < 8 ) {
					txt -1, lang("愛情が足りない。", his(tc) + " love with you is not enough.")
					goto *act_use_SWEND1
				}
				migration_normalizefieldsofjewelofloveandkumiromisexperience tc
				if ( ocdata(109, tc) > cLevel(tc) ) {
					txt -1, lang("経験が足りない。", he(tc) + " is not experienced enough.")
					goto *act_use_SWEND1
				}
				snd SOUNDLIST_PRAY1
				ocdata(109, tc) += 10
				iNum(ci)--
				cell_refresh iX(ci), iY(ci)
				ocFeatsAcquirable(tc)++
				txtef COLOR_YELLOW
				txt -1, lang(cnName(tc) + "は新たなフィートを取得できるようになった！", name(tc) + " can obtain one more feat now!")
				f = 1
			}
		}
		if ( f == 0 ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
		}
		goto *act_use_SWEND1
	}

*act_use_SWEND1
	gosub *label_1681
	goto *label_4158

*gene_skill
	if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) ) {
		return 0
	}
	randomize cId(tc)
	dbmax = 0
	repeat 100
		rtval = rnd(190 - 150) + 150
		if ( sdata(rtval, rc) == 0 ) {
			if ( sdata(rtval, tc) > 0 ) {
				dblist(0, dbmax) = rtval
				dbmax++
			}
		}
	loop
	if ( dbmax < 2 ) {
		locvar_dipcursed_specialskills = 110, 300, 301
		repeat length(locvar_dipcursed_specialskills)
			if ( sdata(locvar_dipcursed_specialskills(cnt), rc) == 0 ) {
				if ( sdata(locvar_dipcursed_specialskills(cnt), tc) > 0 ) {
					dblist(0, dbmax) = locvar_dipcursed_specialskills(cnt)
					dbmax++
				}
			}
		loop
	}
	rtval = dblist(0, 0), -1
	if ( dbmax >= 2 ) {
		if ( rnd(3) == 0 ) {
			repeat dbmax - 1, 1
				if ( dblist(0, cnt) != rtval ) {
					rtval(1) = dblist(0, cnt)
					break
				}
			loop
		}
	}
	randomize
	return dbmax

*gene_body
	dbmax = 0
	s(1) = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
	if ( instr(s(1), 0, "/man/") != (-1) ) {
		return -1
	}
	if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) ) {
		return -1
	}
	rtval(1) = -1
	repeat 30, 100
		if ( cdata(cnt, rc) == 0 ) {
			rtval(1) = cnt
		}
	loop
	if ( rtval(1) == (-1) ) {
		return -1
	}
	repeat 30, 100
		f = cdata(cnt, tc) / EXT_EQUIP_SLOTS
		if ( f == 11 | f == 10 | f == 4 ) {
			continue
		}
		if ( f != 0 ) {
			dblist(0, dbmax) = f
			dbmax++
		}
	loop
	if ( dbmax == 0 ) {
		return -1
	}
	randomize cId(tc)
	repeat 3
		rtval = dblist(0, rnd(dbmax))
		f = 0
		repeat 30, 100
			if ( cdata(cnt, rc) == 0 ) {
				continue
			}
			if ( cdata(cnt, rc) / EXT_EQUIP_SLOTS == rtval ) {
				f = 1
			}
		loop
		if ( f ) {
			break
		}
	loop
	if ( f == 0 ) {
		randomize
		return rtval(1)
	}
	dim dblist, 2, 800
	repeat 30, 100
		dblist(0, cdata(cnt, tc) / EXT_EQUIP_SLOTS)++
	loop
	repeat 25
		rtval = rnd(15) + 1
		f = 0
		repeat 30, 100
			if ( cdata(cnt, rc) / EXT_EQUIP_SLOTS == rtval ) {
				f++
			}
		loop
		if ( f < dblist(0, rtval) ) {
			f = -1
			break
		}
	loop
	randomize
	if ( f == (-1) ) {
		return rtval(1)
	}
	else {
		return -1
	}

*item_seed
	screenupdate = -1
	gosub *screen_draw
	if ( mType == MAP_TYPE_WORLD ) {
		txt -1, lang("この場所には埋められない。", "You can't plant it here.")
		gosub *screen_draw
		if ( hack_plant ) {
			return
		}
		else {
			goto *pc_turn
		}
	}
	if ( mapFeat(cX(cc), cY(cc)) != 0 ) {
		txt -1, lang("この場所には埋められない。", "You can't plant it here.")
		gosub *screen_draw
		if ( hack_plant ) {
			return
		}
		else {
			goto *pc_turn
		}
	}
	if ( chipm(CHIPM_ROLE, mapId(cX(CHARA_PLAYER), cY(CHARA_PLAYER))) == MAP_CHIP_ROLE_CROP ) {
		val = 1
	}
	else {
		val = 0
	}
	feat = tile_plant, 29, iMaterial(ci)
	gosub *label_3706
	if ( jp ) {
		s = ""
		if ( val ) {
			s = "畑に"
		}
		s += itemname(ci, 1) + "を埋めた。"
	}
	else {
		s = "You plant " + itemname(ci, 1)
		if ( val ) {
			s += " on the field."
		}
		else {
			s += "."
		}
	}
	txt -1, s
	snd SOUNDLIST_BUSH1
	removeitem ci, 1
	cell_featset cX(cc), cY(cc), tile_plant, CELL_FEATURE_PLANTED_SEED, iMaterial(ci), featParam1
	skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 300
	if ( hack_plant ) {
		return
	}
	else {
		goto *pc_turn
	}

*label_3705
	featParam1--
	if ( featParam1 \ 50 == 0 ) {
		if ( featParam1 >= 50 ) {
			if ( sGardening(CHARA_PLAYER) < 300 | locvar_dmghp_p < 300 ) {
				feat = tile_plant + 3
			}
			else {
				feat++
				gosub *label_3706
			}
		}
		else {
			feat++
			gosub *label_3706
		}
	}
	return

*label_3706
	featParam1 = 4 + rnd(4 + 1)
	p = 10
	if ( featIdSub == CELL_SUB_FEATURE_SEED_GEM ) {
		p = 15
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_MAGIC ) {
		p = 25
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_HERB ) {
		p = 30
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_STRANGE ) {
		p = 25
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
		p = 40
	}
	if ( val == 0 ) {
		p = p * 3 / 2
	}
	if ( feat == tile_plant ) {
		if ( gWeather < WEATHER_RAIN ) {
			p = p * 2
		}
	}
	gosub *label_4553
	if ( p(1) < rnd(p + 1) | rnd(20) == 0 ) {
		featParam1 += 50
	}
	return

*item_seedRegrowth
	p = 15
	if ( featIdSub == CELL_SUB_FEATURE_SEED_GEM ) {
		p = 25
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_MAGIC ) {
		p = 30
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_HERB ) {
		p = 40
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_STRANGE ) {
		p = 35
	}
	if ( val == 0 ) {
		p = p * 2
	}
	if ( gWeather < WEATHER_RAIN ) {
		p = p * 4 / 3
	}
	gosub *label_4553
	if ( p(1) < rnd(p + 1) | rnd(5) == 0 | featIdSub == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
		mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0
		return
	}
	feat = tile_plant
	gosub *label_3706
	cell_featset cX(cc), cY(cc), feat, featId, featIdSub, featParam1
	txtef COLOR_GREEN
	txt -1, lang("新しい芽が息吹いている！", "A new plant grows!")
	return

*item_seedPick
	skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 75
	snd SOUNDLIST_BUSH1
	flt sGardening(CHARA_PLAYER) / 2 + 15, FIX_QUALITY_GOOD
	dbid = 0
	harvestsis = 0
	if ( featIdSub == CELL_SUB_FEATURE_SEED_STRANGE ) {
		flttypemajor = fsetplantunknown(rnd(length(fsetplantunknown)))
		if ( rnd(100) == 0 ) {
			dbid = 559
		}
		if ( rnd(50) == 0 | seasonal_check(SEASON_YOUNGER_SISTERS_DAY, FALSE) ) {
			harvestsis = 1
		}
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_ARTIFACT | (featIdSub == CELL_SUB_FEATURE_SEED_STRANGE & rnd(50) == 0) ) {
		flttypemajor = fsetplantartifact(rnd(length(fsetplantartifact)))
		fixlv = FIX_QUALITY_MIRACLE
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_ARTIFACT & rnd(500) == 0 ) {
		dbid = 776
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_VEGETABLE ) {
		flttypeminor = FILTER_ITEM_FOOD_VEGETABLE
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_FRUIT ) {
		flttypeminor = FILTER_ITEM_FOOD_FRUIT
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_HERB ) {
		flttypeminor = FILTER_ITEM_FOOD_HERB
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_GEM ) {
		flttypeminor = FILTER_ORE_GEM
	}
	if ( featIdSub == CELL_SUB_FEATURE_SEED_MAGIC ) {
		flttypemajor = FILTER_ITEM_ROD
	}
	dim farmers, 15
	limfarmers = 0
	repeat 15, 1
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( ocPetJobSkill(cnt) != 180 ) {
			continue
		}
		if ( getgametime() <= cRoleRestock(cnt) ) {
			continue
		}
		farmers(limfarmers) = cnt
		limfarmers++
	loop
	repeat limfarmers
		worker = farmers(cnt)
		skillexp2 SKILL_NORMAL_GARDENING, worker, 75
		objlv += sGardening(worker) / 3
	loop
	if ( harvestsis == 1 ) {
		txt -1, lang("妹を収穫した！", "You harvest a younger sister!")
		flt
		imofarmer = 1
		characreate -1, CREATURE_ID_YOUNGER_SISTER, cX(cc), cY(cc)
	}
	else {
		harvest = 1
		if ( nc_gettrait(0, 118) > 0 ) {
			itemcreate CHARA_PLAYER, dbid, -1, -1, 2
		}
		else {
			itemcreate CHARA_PLAYER, dbid, -1, -1, 0
		}
		if ( iStatus(ci) == ITEM_STATUS_BLESSED ) {
			if ( limfarmers ) {
				reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
				if ( reftype == FILTER_ITEM_FOOD ) {
					worker = farmers(rnd(limfarmers))
					s = godcheck(worker)
					if ( s != "eyth" & s != "elder brother" ) {
						iParam4(ci) = cGod(worker)
						if ( iParam4(ci) == 0 ) {
							iParam4(ci) = blesscgod(worker)
						}
						if ( iParam4(ci) != 0 ) {
							ibitmod ITEM_BIT_REMAKE, ci, TRUE
						}
					}
				}
			}
		}
		if ( reftype == FILTER_ACCESSORY_RING | reftype == FILTER_ACCESSORY_AMULET ) {
			encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_GARDENING, 150 + randomencp()
		}
		harvest = 0
		txt -1, lang(itemname(ci, 1) + "を収穫した。", "You harvest " + itemname(ci, 1) + ".")
		item_stack CHARA_PLAYER, ci, 1
	}
	return

*label_3711
	gRowAct = ACTION_STEAL
	gosub *label_3307
	return

















































