*screen_init
	selcur = 0
	inf_clockarrowx = inf_clockx + 62
	inf_clockarrowy = inf_clocky + 48
	inf_barh = 16
	inf_msgh = 72
	inf_verh = inf_barh + inf_msgh
	inf_msgline = 4
	inf_raderx = 1
	inf_raderw = 136
	inf_screenw = windoww / inf_tiles + (windoww \ inf_tiles != 0)
	inf_screenh = (windowh - inf_verh) / inf_tiles
	if ( (windowh - inf_verh) \ inf_tiles != 0 ) {
		inf_screenh++
	}
	if ( inf_vertype == 0 ) {
		inf_ver = 0
		inf_bary = 0
		inf_msgy = inf_ver + inf_barh
		inf_screeny = inf_verh
		inf_clocky = windowh - inf_clockh
		inf_radery = 1
	}
	else {
		inf_screeny = 0
		if ( (windowh - inf_verh) \ inf_tiles != 0 ) {
			inf_screeny = 0 - inf_tiles + (windowh - inf_verh) \ inf_tiles
		}
		inf_ver = windowh - inf_verh
		inf_bary = windowh - inf_barh
		inf_msgy = inf_ver
		inf_clocky = 0
		inf_radery = windowh - 86
	}
	scposy = inf_screenh / 2 - 1
	inf_hpx = (windoww - 84) / 2 - 100
	inf_hpy = inf_ver - 12
	inf_mpx = (windoww - 84) / 2 + 40
	inf_mpy = inf_ver - 12
	inf_msgx = inf_raderw
	inf_msgspace = 15
	inf_maxmsglen = (windoww - inf_msgx - 28) / inf_mesfont * 2 - 1
	inf_maxlog = (inf_msgy - 100) / inf_msgspace + 3
	inf_very = windowh - inf_verh
	screenmsgy = inf_screeny + inf_tiles * 2
	prompty = (windowh - inf_verh - 30) / 2 - 4
	promptx = (windoww - 10) / 2 + 3
	return

*screen_txtAdv
	gmode 0
	pos 0, 0
	if ( txtadvscreenupdate == 1 ) {
		gcopy BUFFER_BUF, 0, 0, windoww, windowh - inf_verh
	}
	else {
		gcopy BUFFER_BUF, 0, 0, windoww, 100
	}
	gmode 2
	repeat 4
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 250, 250, 250
		if ( cnt == 0 ) {
			sx = 265
			sy = 8
			pos sx - 30, 5
			gcopy BUFFER_INF, 192, 360, 24, 16
			pos sx + strlen(atxinfon(0)) * 13 / 2 + 14, 5
			gcopy BUFFER_INF, 216, 360, 24, 16
		}
		else {
			sx = 220
			sy = 10 + cnt * 14
		}
		pos sx, sy
		mes atxinfon(cnt)
	loop
	txtadvscreenupdate = 1
	return

*screen_refresh
	redraw 0
	gmode 2
	gosub *screen_draw
	return

*screen_refreshFull
	redraw 0
	gmode 2
	ap = windoww / 192
	repeat ap + 1
		if ( cnt == ap ) {
			sx = windoww \ 192
		}
		else {
			sx = 192
		}
		pos cnt * 192, inf_bary
		gcopy BUFFER_INF, 0, 464 - inf_barh, sx, inf_barh
		pos cnt * 192, inf_msgy
		gcopy BUFFER_INF, 496, 528, sx, inf_msgh
	loop
	pos 0, inf_msgy
	gcopy BUFFER_INF, 120, 504, inf_msgx, inf_verh
	pos inf_raderw + 6, inf_bary
	gcopy BUFFER_INF, 208, 376, 16, 16
	repeat 10
		sx = 0
		if ( cnt == 8 ) {
			sx = 8
		}
		if ( cnt == 9 ) {
			sx = 14
		}
		pos inf_raderw + cnt * 47 + 148 + sx, inf_bary + 1
		gcopy BUFFER_INF, cnt * 16, 376, 16, 16
	loop
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	color 0, 0, 0
	pos inf_raderw + 24, inf_bary + 3 + vfix - en
	if ( strlen(mdatan(0)) > 16 - (maplevel() != "") * 4 ) {
		mes cnven(strmid(mdatan(0), 0, 16 - (maplevel() != "") * 4))
	}
	else {
		mes cnven(mdatan(0))
	}
	pos inf_raderw + 114, inf_bary + 3 + vfix - en
	mes maplevel()

*label_1462
	repeat mHeight
		sy = cnt
		repeat mWidth
			sx = cnt
			if ( mapIdMemory(sx, sy) == mapId(sx, sy) ) {
				gosub *screen_drawRader
			}
		loop
	loop

*screen_draw
	screendrawhack = 1
	gmode 2
	redraw 0
	if ( mode == MODELIST_TXT_ADV ) {
		gosub *screen_txtAdv
	}
	else {
		sxfix = 0
		syfix = 0
		gosub *label_1530
		gosub *label_1531
		gosub *los_draw
	}
	screendrawhack = 10
	gosub *screen_drawStatus
	if ( autoturn == 1 ) {
		gosub *screen_drawAutoTurn
	}
	else {
		firstautoturn = 1
		racount = 0
	}
	if ( screenupdate != (-1) ) {
		redraw 1
	}
	screenupdate = 0
	screendrawhack = 0
	return

*screen_sync
	gmode 2
	redraw 0
	gosub *los_draw
	gosub *screen_drawStatus
	redraw 1
	screenupdate = 0
	return

*screen_drawStatus
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
	pos inf_hpx, inf_hpy
	gcopy BUFFER_INF, 312, 504, 104, 15
	pos inf_mpx, inf_mpy
	gcopy BUFFER_INF, 312, 504, 104, 15
	if ( cfg_nc_praypoint ) {
		pos inf_hpx - 120, inf_hpy
		gcopy BUFFER_INF, 312, 504, 104, 15
		if ( cPray(CHARA_PLAYER) > 0 ) {
			ap = limit(int(1.0 * limitmax(cPray(CHARA_PLAYER), 1000) * 84 / 1000), 0, 1000)
			pos inf_hpx + 16 - 120, inf_hpy + 5
			gcopy BUFFER_INF, 412 - ap, 520, ap, 6
			ap = limit(int(1.0 * limit(cPray(CHARA_PLAYER) - 1000, 0, 1000) * 84 / 1000), 0, 1000)
			pos inf_hpx + 16 - 120, inf_hpy + 5
			gcopy BUFFER_INF, 532 - ap, 520, ap, 6
		}
	}
	if ( cHP(CHARA_PLAYER) > 0 ) {
		ap = limit(int(1.0 * cHP(CHARA_PLAYER) * 84 / cMHP(CHARA_PLAYER)), 0, 100)
		pos inf_hpx + 16, inf_hpy + 5
		gcopy BUFFER_INF, 412 - ap, 520, ap, 6
	}
	if ( cMP(CHARA_PLAYER) > 0 ) {
		ap = limit(int(1.0 * cMP(CHARA_PLAYER) * 84 / cMMP(CHARA_PLAYER)), 0, 100)
		pos inf_mpx + 16, inf_mpy + 5
		gcopy BUFFER_INF, 532 - ap, 520, ap, 6
	}
	if ( gRider != 0 ) {
		if ( cExist(gRider) == CHAR_STATE_ALIVE ) {
			if ( cfg_nc_praypoint ) {
				pos inf_hpx - 120, inf_hpy - 30
				gcopy BUFFER_INF, 312, 504, 104, 15
				ap = limit(int(1.0 * cHP(gRider) * 84 / cMHP(gRider)), 0, 100)
				pos inf_hpx - 120 + 16, inf_hpy - 25
				gcopy BUFFER_INF, 412 - ap, 520, ap, 6
			}
			else {
				pos inf_hpx - 120, inf_hpy
				gcopy BUFFER_INF, 312, 504, 104, 15
				ap = limit(int(1.0 * cHP(gRider) * 84 / cMHP(gRider)), 0, 100)
				pos inf_hpx - 120 + 16, inf_hpy + 5
				gcopy BUFFER_INF, 412 - ap, 520, ap, 6
			}
		}
	}
	sx = inf_hpx + 16
	sy = inf_hpy - 8
	if ( cfg_nc_praypoint ) {
		color 0, 0, 0
		pos sx + 4 - 120, sy
		bmes "" + cPray(CHARA_PLAYER) + "/2000", 255, 255, 255
	}
	color 0, 0, 0
	pos sx + 4, sy
	if ( cMHP(CHARA_PLAYER) > 100000000 & cfg_nc_stateshorten ) {
		bmes "" + cHP(CHARA_PLAYER) / 1000000 + "M(" + cMHP(CHARA_PLAYER) / 1000000 + "M)", 255, 255, 255
	}
	else {
		if ( cMHP(CHARA_PLAYER) > 1000000 & cfg_nc_stateshorten ) {
			bmes "" + cHP(CHARA_PLAYER) / 1000 + "K(" + cMHP(CHARA_PLAYER) / 1000 + "K)", 255, 255, 255
		}
		else {
			bmes "" + cHP(CHARA_PLAYER) + "(" + cMHP(CHARA_PLAYER) + ")", 255, 255, 255
		}
	}
	sx = inf_mpx + 16
	sy = inf_mpy - 8
	color 0, 0, 0
	pos sx + 4, sy
	if ( cMMP(CHARA_PLAYER) > 100000000 & cfg_nc_stateshorten ) {
		bmes "" + cMP(CHARA_PLAYER) / 1000000 + "M(" + cMMP(CHARA_PLAYER) / 1000000 + "M)", 255, 255, 255
	}
	else {
		if ( cMMP(CHARA_PLAYER) > 1000000 & cfg_nc_stateshorten ) {
			bmes "" + cMP(CHARA_PLAYER) / 1000 + "K(" + cMMP(CHARA_PLAYER) / 1000 + "K)", 255, 255, 255
		}
		else {
			bmes "" + cMP(CHARA_PLAYER) + "(" + cMMP(CHARA_PLAYER) + ")", 255, 255, 255
		}
	}
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	color 0, 0, 0
	sy = inf_bary + 2 + vfix
	repeat 10
		dup roopbuf, sdata(10 + cnt, CHARA_PLAYER)
		sx = inf_raderw + cnt * 47 + 166
		if ( cnt < 8 ) {
			if ( cdata(STARTING_CDATA_ATTR + cnt, CHARA_PLAYER) < 0 ) {
				color 200, 0, 0
			}
			else {
				color 0, 0, 0
			}
			pos sx, sy
			gcopy BUFFER_INF, 0, 440, 28, 16
			if ( roopbuf >= 10000000 & cfg_nc_stateshorten ) {
				mes "" + roopbuf / 1000000 + "M"
			}
			else {
				if ( roopbuf >= 10000 & cfg_nc_stateshorten ) {
					mes "" + roopbuf / 1000 + "K"
				}
				else {
					mes "" + roopbuf
				}
			}
		}
		else {
			if ( cnt == 8 ) {
				pos sx + 8, sy
				gcopy BUFFER_INF, 0, 440, 34, 16
				if ( gspdorg > gspd ) {
					color 200, 0, 0
				}
				else {
					if ( gspdorg < gspd ) {
						color 0, 120, 0
					}
					else {
						color 0, 0, 0
					}
				}
				if ( gspd >= 10000000 & cfg_nc_stateshorten ) {
					mes "" + gspd / 1000000 + "M"
				}
				else {
					if ( gspd >= 10000 & cfg_nc_stateshorten ) {
						mes "" + gspd / 1000 + "K"
					}
					else {
						mes "" + gspd
					}
				}
			}
			else {
				color 0, 0, 0
				pos sx + 14, sy
				gcopy BUFFER_INF, 0, 440, 64, 16
				if ( cDV(CHARA_PLAYER) >= 10000000 & cfg_nc_stateshorten ) {
					dvs = "" + cDV(CHARA_PLAYER) / 1000000 + "M"
				}
				else {
					if ( cDV(CHARA_PLAYER) >= 10000 & cfg_nc_stateshorten ) {
						dvs = "" + cDV(CHARA_PLAYER) / 1000 + "K"
					}
					else {
						dvs = cDV(CHARA_PLAYER)
					}
				}
				if ( cPV(CHARA_PLAYER) >= 10000000 & cfg_nc_stateshorten ) {
					pvs = "" + cPV(CHARA_PLAYER) / 1000000 + "M"
				}
				else {
					if ( cPV(CHARA_PLAYER) >= 10000 & cfg_nc_stateshorten ) {
						pvs = "" + cPV(CHARA_PLAYER) / 1000 + "K"
					}
					else {
						pvs = cPV(CHARA_PLAYER)
					}
				}
				mes "" + dvs + "/" + pvs
			}
		}
	loop
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	sy = inf_ver - 16
	sx = windoww - 260
	pos sx, sy
	gcopy BUFFER_INF, 0, 392, 24, 24
	lint_buff = pluginFunction(2147483647) * pluginFunction(ncgGoldOverflow) + pluginFunction(cGold(CHARA_PLAYER))
	color 0
	pos sx + 28, sy + 2
	intg = ""
	if ( ncgGoldOverflow > 0 ) {
		if ( ncgGoldOverflow > 1000000 ) {
			intg = "(" + thousandsep(str(ncgGoldOverflow / 1000000)) + "MI)"
		}
		else {
			if ( ncgGoldOverflow > 10000 ) {
				intg = "(" + thousandsep(str(ncgGoldOverflow / 1000)) + "KI)"
			}
			else {
				intg = "(" + thousandsep(str(ncgGoldOverflow)) + "I)"
			}
		}
	}
	if ( lint_buff >= 1874919424 ) {
		lint_buff = lint_buff / pluginFunction("1000000000")
		if ( lint_buff > 9999 ) {
			bmes thousandsep(str(9999)) + "G+gp" + intg, 255, 255, 255
		}
		else {
			bmes thousandsep(str(lint_buff)) + "Ggp" + intg, 255, 255, 255
		}
	}
	else {
		if ( lint_buff >= 1316134912 ) {
			lint_buff = lint_buff / pluginFunction("1000000")
			bmes thousandsep(str(lint_buff)) + "Mgp" + intg, 255, 255, 255
		}
		else {
			if ( ncgGoldOverflow > 0 ) {
				lint_buff = lint_buff / pluginFunction("1000")
				bmes thousandsep(str(lint_buff)) + "Kgp" + intg, 255, 255, 255
			}
			else {
				bmes thousandsep(str(lint_buff)) + " gp" + intg, 255, 255, 255
			}
		}
	}
	sx = windoww - 120
	pos sx, sy
	gcopy BUFFER_INF, 24, 392, 24, 24
	color 0
	pos sx + 28, sy + 2
	bmes thousandsep(str(cPlat(CHARA_PLAYER))) + " pp", 255, 255, 255
	if ( cfg_nc_itemcount != 0 ) {
		nc_intb_300 = 0
		inv_getheader 0
		repeat invrange, invhead
			if ( nc_intb_300 == 5 ) {
				break
			}
			if ( iNum(cnt) == 0 ) {
				continue
			}
			dup roopbuf, inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt)
			dup roopbuf1, iNum(cnt)
			if ( ibit(22, cnt) ) {
				nc_intb_300++
				color 0, 0, 0
				sx = windoww - 340
				pos sx + 28, inf_ver - 22 - nc_intb_300 * 14
				s = itemname(cnt, 1, 0, 1)
				s = strmid(s, 0, 16)
				bmes s, 255, 255, 255
				color 0, 0, 0
				pos sx + 140, inf_ver - 22 - nc_intb_300 * 14
				if ( cfg_nc_itemcount == 2 & roopbuf > 0 ) {
					if ( roopbuf == 1 ) {
						pos sx + 140, inf_ver - 22 - nc_intb_300 * 14
						bmes " :" + roopbuf1 + " / " + roopbuf, 255, 150, 150
					}
					else {
						pos sx + 140, inf_ver - 22 - nc_intb_300 * 14
						bmes " :" + roopbuf1 + " / " + roopbuf, 255, 255, 255
					}
				}
				else {
					bmes " :" + roopbuf1, 255, 255, 255
				}
			}
		loop
	}
	color 0, 0, 0
	pos 4, inf_ver - 16
	gcopy BUFFER_INF, 48, 392, 24, 24
	pos 32, inf_ver - 14
	nc_intb_exp = cExpToNext(CHARA_PLAYER) - cExp(CHARA_PLAYER)
	if ( nc_intb_exp > 100000000 & cfg_nc_stateshorten ) {
		bmes "Lv" + cLevel(CHARA_PLAYER) + "/" + nc_intb_exp / 1000000 + "M", 255, 255, 255
	}
	else {
		if ( nc_intb_exp > 1000000 & cfg_nc_stateshorten ) {
			bmes "Lv" + cLevel(CHARA_PLAYER) + "/" + nc_intb_exp / 1000 + "K", 255, 255, 255
		}
		else {
			bmes "Lv" + cLevel(CHARA_PLAYER) + "/" + nc_intb_exp, 255, 255, 255
		}
	}
	locvar_net_dl_posy = 30
	if ( cfg_showstamina ) {
		color 0, 0, 0
		pos 10, inf_ver - locvar_net_dl_posy
		locvar_net_dl_posy += 12
		bmes "ST:" + cSP(CHARA_PLAYER) + "/" + cMSP(CHARA_PLAYER), 255, 255, 255
	}
	if ( cfg_st_displayhammerlevel > 0 ) {
		if ( cfg_st_displayhammerlevel == 1 | cfg_st_displayhammerlevel == 2 ) {
			if ( locvar_net_dl_hammernoplus > 0 ) {
				if ( equalsitem(locvar_net_dl_hammernoplus - 1, "blacksmith hammer") == 0 | iNum(locvar_net_dl_hammernoplus - 1) == 0 ) {
					locvar_net_dl_hammernoplus = 0
				}
			}
			if ( locvar_net_dl_hammernoplus == 0 ) {
				if ( customitemfind(0, "blacksmith hammer") >= 0 ) {
					locvar_net_dl_hammernoplus = stat + 1
				}
			}
			if ( locvar_net_dl_hammernoplus > 0 ) {
				color 0, 0, 0
				pos 10, inf_ver - locvar_net_dl_posy
				locvar_net_dl_posy += 12
				bmes "HLv:" + iParam1(locvar_net_dl_hammernoplus - 1) + "/" + limitmax(int(100.0 * iParam2(locvar_net_dl_hammernoplus - 1) / calcexpalive(iParam1(locvar_net_dl_hammernoplus - 1))), 100) + "%", 255, 255, 255
			}
		}
		if ( cfg_st_displayhammerlevel >= 2 ) {
			if ( length(spsintervals) == 0 ) {
				dim spsintervals, 100
			}
			skinsum = 0
			repeat length(spsintervals)
				skinsum += spsintervals(cnt)
			loop
			if ( skinsum != 0 ) {
				color 0, 0, 0
				pos 10, inf_ver - locvar_net_dl_posy
				locvar_net_dl_posy += 12
				bmes "SPS:" + strf("%.03f", 100000.0 / double(skinsum)), 255, 255, 255
			}
		}
	}
	if ( cfg_st_displaylivingweaponlevel ) {
		if ( locvar_net_dl_livingweaponnoplus > 0 ) {
			if ( ibit(ITEM_BIT_ALIVE, locvar_net_dl_livingweaponnoplus - 1) == FALSE | iNum(locvar_net_dl_livingweaponnoplus - 1) == 0 | iEquip(locvar_net_dl_livingweaponnoplus - 1) == 0 ) {
				locvar_net_dl_livingweaponnoplus = 0
			}
		}
		if ( locvar_net_dl_livingweaponnoplus == 0 ) {
			if ( bititemfind(0, 10, 1) >= 0 ) {
				locvar_net_dl_livingweaponnoplus = stat + 1
			}
		}
		if ( locvar_net_dl_livingweaponnoplus > 0 ) {
			color 0, 0, 0
			pos 10, inf_ver - locvar_net_dl_posy
			locvar_net_dl_posy += 12
			bmes "WLv:" + iParam1(locvar_net_dl_livingweaponnoplus - 1) + "/" + limitmax(int(100.0 * iParam2(locvar_net_dl_livingweaponnoplus - 1) / calcexpalive(iParam1(locvar_net_dl_livingweaponnoplus - 1))), 100) + "%", 255, 255, 255
		}
	}
	if ( cX(CHARA_PLAYER) < 6 ) {
		if ( mode != MODELIST_TXT_ADV ) {
			if ( mType != MAP_TYPE_WORLD ) {
				if ( cRowAct(CHARA_PLAYER) == ACTION_NONE ) {
					gmode 4, , , 150
				}
			}
		}
	}
	sx = 8
	sy = inf_ver - 84
	if ( cHunger(CHARA_PLAYER) >= 12000 ) {
		color 0, 0, 0
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _hunger(12)
		sy -= 20
	}
	else {
		if ( cHunger(CHARA_PLAYER) >= 1000 ) {
			if ( cHunger(CHARA_PLAYER) <= 4000 ) {
				color 200, 0, 0
			}
			else {
				color 0, 0, 0
			}
			if ( _hunger(cHunger(CHARA_PLAYER) / 1000) != "" ) {
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _hunger(cHunger(CHARA_PLAYER) / 1000)
				sy -= 20
			}
		}
		else {
			color 250, 0, 0
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _hunger(0)
			sy -= 20
		}
	}
	if ( cSick(CHARA_PLAYER) != 0 ) {
		color 80, 120, 0
		if ( cSick(CHARA_PLAYER) >= 30 ) {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _consick(1)
			sy -= 20
		}
		else {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _consick
			sy -= 20
		}
	}
	if ( cPoison(CHARA_PLAYER) != 0 ) {
		color 0, 150, 0
		if ( cPoison(CHARA_PLAYER) >= 30 ) {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _conpoison(1)
			sy -= 20
		}
		else {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _conpoison
			sy -= 20
		}
	}
	if ( cSleep(CHARA_PLAYER) != 0 ) {
		color 0, 50, 50
		if ( cSleep(CHARA_PLAYER) >= 30 ) {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _consleep(1)
			sy -= 20
		}
		else {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _consleep
			sy -= 20
		}
	}
	if ( cBlind(CHARA_PLAYER) != 0 ) {
		color 100, 100, 0
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _conblind
		sy -= 20
	}
	if ( cParalyze(CHARA_PLAYER) != 0 ) {
		color 0, 100, 100
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _conparalyze
		sy -= 20
	}
	if ( cdata(268, CHARA_PLAYER) != 0 ) {
		color 0, 100, 100
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _storned
		sy -= 20
	}
	if ( cMochi(CHARA_PLAYER) != 0 ) {
		color 0, 100, 100
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _conmochi
		sy -= 20
	}
	if ( cConfuse(CHARA_PLAYER) != 0 ) {
		color 100, 0, 100
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _conconfuse
		sy -= 20
	}
	if ( cFear(CHARA_PLAYER) != 0 ) {
		color 100, 0, 100
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _confear
		sy -= 20
	}
	if ( cDim(CHARA_PLAYER) != 0 ) {
		color 0, 100, 100
		if ( cDim(CHARA_PLAYER) >= 60 ) {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _condim(2)
			sy -= 20
		}
		else {
			if ( cDim(CHARA_PLAYER) >= 30 ) {
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _condim(1)
				sy -= 20
			}
			else {
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _condim
				sy -= 20
			}
		}
	}
	if ( cAngry(CHARA_PLAYER) != 0 ) {
		color 150, 0, 0
		if ( cAngry(CHARA_PLAYER) >= 30 ) {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _conangry(1)
			sy -= 20
		}
		else {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _conangry
			sy -= 20
		}
	}
	if ( cBleed(CHARA_PLAYER) != 0 ) {
		color 150, 0, 0
		if ( cBleed(CHARA_PLAYER) >= 20 ) {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _conbleed(2)
			sy -= 20
		}
		else {
			if ( cBleed(CHARA_PLAYER) >= 10 ) {
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _conbleed(1)
				sy -= 20
			}
			else {
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _conbleed
				sy -= 20
			}
		}
	}
	if ( cInsane(CHARA_PLAYER) != 0 ) {
		color 150, 100, 0
		if ( cInsane(CHARA_PLAYER) >= 50 ) {
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _coninsane(2)
			sy -= 20
		}
		else {
			if ( cInsane(CHARA_PLAYER) >= 25 ) {
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _coninsane(1)
				sy -= 20
			}
			else {
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _coninsane
				sy -= 20
			}
		}
	}
	if ( cDrunk(CHARA_PLAYER) != 0 ) {
		color 100, 0, 100
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _condrunk
		sy -= 20
	}
	if ( cWet(CHARA_PLAYER) != 0 ) {
		color 0, 0, 160
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _conwet
		sy -= 20
	}
	if ( cGravity(CHARA_PLAYER) != 0 ) {
		color 0, 80, 80
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _congravity
		sy -= 20
	}
	if ( cdata(265, CHARA_PLAYER) != 0 ) {
		color 210, 140, 230
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _aphrodisiac
		sy -= 20
	}
	if ( gSleep >= 15 ) {
		if ( gSleep >= 50 ) {
			color 255, 0, 0
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _sleep(2)
			sy -= 20
		}
		else {
			if ( gSleep >= 30 ) {
				color 100, 100, 0
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _sleep(1)
				sy -= 20
			}
			else {
				color 0, 0, 0
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _sleep
				sy -= 20
			}
		}
	}
	if ( ocStress(0) >= 2000 ) {
		if ( ocStress(0) < 4000 ) {
			color 0, 0, 0
		}
		else {
			if ( ocStress(0) < 6000 ) {
				color 100, 100, 0
			}
			else {
				color 200, 0, 0
			}
		}
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _stress
		sy -= 20
	}
	if ( cSP(CHARA_PLAYER) < 50 ) {
		if ( cSP(CHARA_PLAYER) < 0 ) {
			color 120, 120, 0
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _confatigue(2)
			sy -= 20
		}
		else {
			if ( cSP(CHARA_PLAYER) < 25 ) {
				color 80, 80, 0
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _confatigue(1)
				sy -= 20
			}
			else {
				color 60, 60, 0
				pos sx, sy
				gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
				pos sx + 6, sy + 1
				mes _confatigue
				sy -= 20
			}
		}
	}
	else {
		if ( cSP(CHARA_PLAYER) > cMSP(CHARA_PLAYER) * 3 / 4 ) {
			color 0, 0, 0
			pos sx, sy
			gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
			pos sx + 6, sy + 1
			mes _confatigue(3)
			sy -= 20
		}
	}
	if ( cBurden(CHARA_PLAYER) != 0 ) {
		color 0, cBurden(CHARA_PLAYER) * 40, cBurden(CHARA_PLAYER) * 40
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes _burden(cBurden(CHARA_PLAYER))
		sy -= 20
	}
	if ( autodig_f != 0 ) {
		color 0, 0, 0
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes lang("採掘", "Autodig")
		sy -= 20
	}
	if ( gWizard ) {
		color 0
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes "" + cSP(CHARA_PLAYER) + "/" + cMSP(CHARA_PLAYER)
		sy -= 20
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes "" + gSleepExp
		sy -= 20
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes "" + cPiety(CHARA_PLAYER) + "/" + cPray(CHARA_PLAYER)
		sy -= 20
		pos sx, sy
		gcopy BUFFER_INF, 0, 416, 50 + en * 30, 15
		pos sx + 6, sy + 1
		mes "" + ocStress(0)
		sy -= 20
	}
	color 0
	pos inf_clockx, inf_clocky
	gcopy BUFFER_INF, 448, 408, inf_clockw, inf_clockh
	pos inf_clockx + 78, inf_clocky + 8
	gcopy BUFFER_INF, 448, 376, 128, 24
	gmode 4, , , 180
	sx = windoww - 40
	sy = inf_ver - 40
	repeat 8 + 8
		dup roopbuf, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, 0)
		if ( roopbuf == 0 ) {
			break
		}
		pos sx, sy
		gcopy BUFFER_CHR, roopbuf \ 50 * 32, buffy(roopbuf), 32, 32
		color 0, 0, 0
		pos sx + 3, sy + 19
		mes ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 2, 0)
		color 255, 255, 255
		pos sx + 2, sy + 18
		mes ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 2, 0)
		sy -= 32
	loop
	color 0
	pos inf_clockarrowx, inf_clockarrowy
	gmode 2, 48, 48
	grotate BUFFER_INF, 0, 288, 0.0174532925199433 * (gHour  * 30), 48, 48
	pos inf_clockw - 3, inf_clocky + 17 + vfix
	mes "" + gYear  + "/" + gMonth  + "/" + gDay 
	pos inf_clockw + 6, inf_clocky + 35
	oom_time_weather = _time(gHour  / 4) + " " + _weather(gWeather)
	if ( seasonal_check(SEASON_YOUNGER_SISTERS_DAY, FALSE) ) {
		oom_time_weather += " " + lang("*妹の日*", "*Younger Sister Day*")
	}
	if ( seasonal_check(SEASON_PARTY_DAY, FALSE) ) {
		oom_time_weather += " " + lang("*ベイベーの日*", "*Baby Day*")
	}
	if ( seasonal_check(SEASON_CHRISTMAS_EVE, FALSE) ) {
		oom_time_weather += " " + lang("*クリスマスイブ*", "*Christmas Eve*")
	}
	if ( seasonal_check(SEASON_CHRISTMAS, FALSE) ) {
		oom_time_weather += " " + lang("*クリスマス*", "*Christmas*")
	}
	if ( seasonal_check(SEASON_VALENTINES_DAY, FALSE) ) {
		oom_time_weather += " " + lang("*バレンタインデー*", "*Valentine's Day*")
	}
	if ( seasonal_check(SEASON_AFTER_VALENTINES_DAY, FALSE) ) {
		oom_time_weather += " " + lang("*アフターバレンタインデー*", "*After Valentine's Day*")
	}
	bmes oom_time_weather, 255, 255, 255
	hack_quest = 1
	if ( gTimelimit > 0 ) {
		color 0
		pos inf_clockw + 6, inf_clocky + 35 + 16
		bmes lang("クエスト[残り" + gTimelimit + "分]", "" + gTimelimit + " minutes left."), 255, 255, 255
		if ( qExist(gQuestRef) == QUEST_TYPE_PARTY ) {
			color 0
			pos inf_clockw + 6, inf_clocky + 35 + 16 + 16
			bmes "" + qParam2(gQuestRef) + "P/" + qParam1(gQuestRef) + "P", 255, 255, 255
		}
		else {
			if ( qExist(gQuestRef) == QUEST_TYPE_HARVEST ) {
				color 0
				pos inf_clockw + 6, inf_clocky + 35 + 16 + 16
				bmes "" + cnvweight(qParam2(gQuestRef)) + "/" + cnvweight(qParam1(gQuestRef)) + "s", 255, 255, 255
			}
			else {
				if ( qExist(gQuestRef) == 1020 ) {
					color 0
					pos inf_clockw + 6, inf_clocky + 35 + 16 + 16
					bmes "" + qParam2(gQuestRef) + "P/" + qParam1(gQuestRef) + "P", 255, 255, 255
				}
				else {
					if ( qExist(gQuestRef) == 1021 ) {
						color 0
						pos inf_clockw + 6, inf_clocky + 35 + 16 + 16
						bmes lang("羊の残り:", "Remain:") + qParam1(gQuestRef) + lang("匹", " Sheep"), 255, 255, 255
					}
				}
			}
		}
	}
	if ( gWizard ) {
		pos windoww - 16, 0
		mes d3getfps()
	}
	hack_quest = 0
	if ( locvar_addnews_hide_popup < 2 ) {
		hack_dmgmonitor = 1
		if ( cfg_dmgmonitor != 0 ) {
			if ( locvar_addnews_hide_popup == 0 & cBlind(CHARA_PLAYER) == 0 ) {
				mondmgtime = timeGetTime()
				font lang(cfg_font1, cfg_font2), 2 + cfg_dmgfont - en * 2, 0
				repeat length2(mondmg)
					mondmgcnt2 = (mondmgcnt + cnt) \ length2(mondmg)
					mondmgcnt3 = cnt + 1
					if ( gArea  != AREA_PET_ARENA ) {
						if ( fov_los(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(mondmg(8, mondmgcnt2)), cY(mondmg(8, mondmgcnt2))) == 0 ) {
							continue
						}
						if ( dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(mondmg(8, mondmgcnt2)), cY(mondmg(8, mondmgcnt2))) > cFov(CHARA_PLAYER) / 2 ) {
							continue
						}
					}
					if ( mondmg(0, mondmgcnt2) + cfg_dmgspeed * 150 > mondmgtime ) {
						mondmgpos = 0
						repeat length2(mondmg) - mondmgcnt3
							mondmgcnt4 = (mondmgcnt2 + cnt) \ length2(mondmg)
							if ( mondmg(0, mondmgcnt4) + cfg_dmgspeed * 300 > mondmgtime ) {
								if ( cX(mondmg(8, mondmgcnt2)) == cX(mondmg(8, mondmgcnt4)) & cY(mondmg(8, mondmgcnt2)) == cY(mondmg(8, mondmgcnt4)) ) {
									mondmgpos++
								}
							}
						loop
						if ( instr(mondmgn(mondmgcnt2), , ",") == (-1) ) {
							if ( str(int(mondmgn(mondmgcnt2))) == mondmgn(mondmgcnt2) ) {
								mondmgn(mondmgcnt2) = oomsest_insertseparater(mondmgn(mondmgcnt2))
							}
						}
						mondmgdx = (cX(mondmg(8, mondmgcnt2)) - scx) * inf_tiles + inf_screenx - strlen(mondmgn(mondmgcnt2)) * (2 + cfg_dmgfont + 1) / 2 / 2 + inf_tiles / 2
						mondmgdy = (cY(mondmg(8, mondmgcnt2)) - scy) * inf_tiles + inf_screeny - mondmgpos * (2 + cfg_dmgfont + 3) - (mondmgtime - mondmg(0, mondmgcnt2)) / (cfg_dmgspeed * 5 + 1)
						mondmgdx += locvar_cell_draw_sxfix * (scrollp >= 3 + cfg_improvescroll * 2)
						mondmgdy += locvar_cell_draw_syfix * (scrollp >= 3 + cfg_improvescroll * 2)
						if ( mondmgdy < 0 | mondmgdy + (2 + cfg_dmgfont + 3) > inf_ver | mondmgdy < 0 | mondmgdy + strlen(mondmgn(mondmgcnt2)) * (2 + cfg_dmgfont + 1) > windoww ) {
							continue
						}
						pos mondmgdx, mondmgdy
						color mondmg(5, mondmgcnt2), mondmg(6, mondmgcnt2), mondmg(7, mondmgcnt2)
						bmes mondmgn(mondmgcnt2), mondmg(2, mondmgcnt2), mondmg(3, mondmgcnt2), mondmg(4, mondmgcnt2)
						color 0, 0, 0
					}
				loop
				font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			}
		}
		hack_dmgmonitor = 0
		hack_txtpopup = 1
		if ( locvar_addnews_setting == 1 ) {
			txtpopuppos = 0
			txtpopupdx = (cX(tc) - scx) * inf_tiles + inf_screenx + inf_tiles / 2
			txtpopupdy = (cY(tc) - scy) * inf_tiles + inf_screeny
			txtpopupdx += locvar_cell_draw_sxfix * (scrollp >= 3 + cfg_improvescroll * 2) - locvar_net_dl_tmpsize(0) / 2 + ocFukidashiOffsetX(tc)
			txtpopupdy += locvar_cell_draw_syfix * (scrollp >= 3 + cfg_improvescroll * 2) - locvar_net_dl_tmpsize(1) - 48 * (chipc(CHIPC_HEIGHT, cPic(tc) \ 1000) == 96) + ocFukidashiOffsetY(tc)
			if ( txtpopupdx < 0 ) {
				txtpopupdx = 0
				if ( cX(tc) - scx < 2 ) {
					ap2 = 1
				}
				else {
					ap2 = 0
				}
			}
			if ( txtpopupdx + locvar_net_dl_tmpsize(0) > windoww ) {
				txtpopupdx = windoww - locvar_net_dl_tmpsize(0)
				if ( cX(tc) - scx < inf_screenw - 2 ) {
					ap2 = 0
				}
				else {
					ap2 = 2
				}
			}
			color 255, 0, 255
			gmode 4, , , 255
			pos txtpopupdx, txtpopupdy
			gcopy 220, 0, 0, locvar_net_dl_tmpsize(0), locvar_net_dl_tmpsize(1)
			color 0, 0, 0
		}
		else {
			if ( locvar_addnews_hide_popup == 0 & cBlind(CHARA_PLAYER) == 0 ) {
				txtpopuptime = timeGetTime()
				repeat length2(txtpopup)
					ap = 0
					ap2 = 0
					ap3 = 0
					txtpopupcnt2 = (txtpopupcnt + cnt) \ length2(txtpopup)
					txtpopupcnt3 = cnt + 1
					if ( gArea  != AREA_PET_ARENA ) {
						if ( fov_los(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(txtpopup(1, txtpopupcnt2)), cY(txtpopup(1, txtpopupcnt2))) == 0 ) {
							continue
						}
						if ( dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(txtpopup(1, txtpopupcnt2)), cY(txtpopup(1, txtpopupcnt2))) > cFov(CHARA_PLAYER) / 2 ) {
							continue
						}
					}
					oom_speed = cfg_txtpopspeed * 150
					if ( cfg_txtpopupdead == 1 ) {
						if ( cExist(txtpopup(1, txtpopupcnt2)) != CHAR_STATE_ALIVE ) {
							oom_speed /= 4
						}
					}
					if ( txtpopup(0, txtpopupcnt2) + oom_speed > txtpopuptime ) {
						txtpopuppos = 0
						repeat length2(txtpopup) - txtpopupcnt3
							txtpopupcnt4 = (txtpopupcnt2 + cnt + 1) \ length2(txtpopup)
							if ( txtpopup(0, txtpopupcnt4) + cfg_txtpopspeed * 300 > txtpopuptime ) {
								if ( cX(txtpopup(1, txtpopupcnt2)) == cX(txtpopup(1, txtpopupcnt4)) & cY(txtpopup(1, txtpopupcnt2)) == cY(txtpopup(1, txtpopupcnt4)) ) {
									txtpopuppos += txtpopup(3, txtpopupcnt4) - 15
								}
								if ( txtpopup(1, txtpopupcnt2) == txtpopup(1, txtpopupcnt4) ) {
									ap3 = 1
								}
							}
							ap = 1
						loop
						if ( cfg_txtpop == 1 | ocFukidashiDisplayWhenOff(txtpopup(1, txtpopupcnt2)) == 1 & ap3 == 1 ) {
							continue
						}
						txtpopupdx = (cX(txtpopup(1, txtpopupcnt2)) - scx) * inf_tiles + inf_screenx + inf_tiles / 2
						txtpopupdx += locvar_cell_draw_sxfix * (scrollp >= 3 + cfg_improvescroll * 2) - txtpopup(2, txtpopupcnt2) / 2
						txtpopupdx += ocFukidashiOffsetX(txtpopup(1, txtpopupcnt2))
						txtpopupdy = (cY(txtpopup(1, txtpopupcnt2)) - scy) * inf_tiles + inf_screeny - txtpopuppos
						txtpopupdy += locvar_cell_draw_syfix * (scrollp >= 3 + cfg_improvescroll * 2) - txtpopup(3, txtpopupcnt2) - txtpopup(5, txtpopupcnt2)
						txtpopupdy += ocFukidashiOffsetY(txtpopup(1, txtpopupcnt2))
						if ( txtpopupdy + txtpopup(3, txtpopupcnt2) > windowh - inf_barh - inf_msgh ) {
							continue
						}
						if ( txtpopupdy < 0 ) {
							continue
						}
						if ( txtpopupdx < 0 ) {
							txtpopupdx = 0
							if ( cX(txtpopup(1, txtpopupcnt2)) - scx < 2 ) {
								ap2 = 1
							}
							else {
								ap2 = 0
							}
						}
						if ( txtpopupdx + txtpopup(2, txtpopupcnt2) > windoww ) {
							txtpopupdx = windoww - txtpopup(2, txtpopupcnt2)
							if ( cX(txtpopup(1, txtpopupcnt2)) - scx < inf_screenw - 2 ) {
								ap2 = 0
							}
							else {
								ap2 = 2
							}
						}
						color 255, 0, 255
						gmode 4, , , cfg_txtpoptransparent - cfg_txtpoptransparent / 3 * (ap == 1)
						pos txtpopupdx, txtpopupdy
						gcopy 200 + txtpopupcnt2, txtpopup(2, txtpopupcnt2) * ap2, 0, txtpopup(2, txtpopupcnt2), txtpopup(3, txtpopupcnt2)
						color 0, 0, 0
					}
				loop
			}
		}
		hack_txtpopup = 0
		hack_strack = 1
		if ( viewinfo == 1 ) {
			ap3 = 0
			if ( cfg_strackex != 0 ) {
				if ( cfg_strackex == 1 ) {
					repeat 20
						dup roopbuf, gdatac(750 + cnt)
						ap = roopbuf \ 10000
						if ( ap == 0 ) {
							continue
						}
						ap2 = roopbuf / 10000
						if ( cExist(ap2) == CHAR_STATE_DEAD | ap2 > 15 ) {
							if ( ap2 != 0 ) {
								roopbuf = 0
							}
							continue
						}
						_strackdata = ""
						if ( ap2 != 0 ) {
							pos 16, inf_clocky + 100 + ap3 * 16
							bmes2 "" + strmid(skillname(ap), 0, 6), 4
							skilltmps = "" + sdata(600 + ap, ap2) / 1000
							pos 66, inf_clocky + 100 + ap3 * 16
							_strackdata += strf("%4d", sorgex(ap, ap2)) + "." + strmid(skilltmps, -1, 3)
							if ( cfg_strackgrow == 1 ) {
								_strackdata += "(" + strf("%3d", sgrowth(ap, ap2)) + "%)"
							}
							_strackdata += "[" + strmid(cnName(ap2), 0, 6) + "]"
							bmes2 _strackdata, 4
						}
						else {
							if ( ap >= 400 & ap < 600 ) {
								if ( ap >= 550 & ap < 600 ) {
									if ( userspelldata(0, ap - 550) < 0 ) {
										gdatac(750 + cnt) = 0
									}
									if ( cfg_strackstock == 1 ) {
										if ( userspelldata(11, ap - 550) <= 0 ) {
											gdatac(750 + cnt) = 0
											continue
										}
									}
									pos 16, inf_clocky + 100 + ap3 * 16
									bmes2 "" + strmid(skillname(ap), 0, 6), 3
									skilltmps = "" + userspelldata(12, ap - 550) \ 1000000 / 1000
									pos 66, inf_clocky + 100 + ap3 * 16
									_strackdata += strf("%4d", 1.0 * userspelldata(12, ap - 550) / 1000000) + "." + strf("%03d", strmid(skilltmps, -1, 3))
									if ( cfg_strackgrow == 1 ) {
										_strackdata += "(" + strf("%3d", userspelldata(12, ap - 550) \ 1000) + "%)"
									}
									if ( cfg_strackstock != 0 ) {
										_strackdata += "[" + userspelldata(11, ap - 550) + "]"
									}
									bmes2 _strackdata, 3
								}
								else {
									if ( cfg_strackstock == 1 ) {
										if ( spell(ap - 400) <= 0 ) {
											gdatac(750 + cnt) = 0
											continue
										}
									}
									pos 16, inf_clocky + 100 + ap3 * 16
									bmes2 "" + strmid(skillname(ap), 0, 6), 2
									skilltmps = "" + sdata(600 + ap, ap2) / 1000
									pos 66, inf_clocky + 100 + ap3 * 16
									_strackdata += strf("%4d", sorgex(ap, ap2)) + "." + strmid(skilltmps, -1, 3)
									if ( cfg_strackgrow == 1 ) {
										_strackdata += "(" + strf("%3d", sgrowth(ap, ap2)) + "%)"
									}
									if ( cfg_strackstock != 0 ) {
										_strackdata += "[" + spell(ap - 400) + "]"
									}
									bmes2 _strackdata, 2
								}
							}
							else {
								pos 16, inf_clocky + 100 + ap3 * 16
								bmes2 "" + strmid(skillname(ap), 0, 6), 1
								skilltmps = "" + sdata(600 + ap, ap2) / 1000
								pos 66, inf_clocky + 100 + ap3 * 16
								_strackdata += strf("%4d", sorgex(ap, ap2)) + "." + strmid(skilltmps, -1, 3)
								if ( cfg_strackgrow == 1 ) {
									_strackdata += "(" + strf("%3d", sgrowth(ap, ap2)) + "%)"
								}
								bmes2 _strackdata, 1
							}
						}
						ap3++
					loop
				}
				else {
					_strackdata = "", "", "", ""
					dim _strackcnt, 2
					_mesy = 0
					repeat 20
						dup roopbuf, gdatac(750 + cnt)
						ap = roopbuf \ 10000
						if ( ap == 0 ) {
							continue
						}
						ap2 = roopbuf / 10000
						if ( cExist(ap2) == CHAR_STATE_DEAD | ap2 > 15 ) {
							if ( ap2 != 0 ) {
								roopbuf = 0
							}
							continue
						}
						_strackdata = ""
						if ( ap2 != 0 ) {
							_strackdata = strmid(skillname(ap), 0, 6)
							repeat
								if ( strlen(_strackdata) < 8 ) {
									_strackdata += lang("　", "  ")
								}
								else {
									break
								}
							loop
							skilltmps = "" + sdata(600 + ap, ap2) / 1000
							_strackdata += strf("%4d", sorgex(ap, ap2)) + "." + strmid(skilltmps, -1, 3)
							if ( cfg_strackgrow == 1 ) {
								_strackdata += "(" + strf("%3d", sgrowth(ap, ap2)) + "%)"
							}
							_strackdata += "[" + strmid(cnName(ap2), 0, 6) + "]"
							_strackdata(1) += _strackdata + "\n"
						}
						else {
							if ( ap >= 400 & ap < 600 ) {
								if ( ap >= 550 & ap < 600 ) {
									if ( userspelldata(0, ap - 550) < 0 ) {
										gdatac(750 + cnt) = 0
									}
									if ( cfg_strackstock == 1 ) {
										if ( userspelldata(11, ap - 550) <= 0 ) {
											gdatac(750 + cnt) = 0
											continue
										}
									}
									_strackdata = strmid(skillname(ap), 0, 6)
									repeat
										if ( strlen(_strackdata) < 8 ) {
											_strackdata += " "
										}
										else {
											break
										}
									loop
									skilltmps = "" + userspelldata(12, ap - 550) \ 1000000 / 1000
									_strackdata += strf("%4d", 1.0 * userspelldata(12, ap - 550) / 1000000) + "." + strf("%03d", strmid(skilltmps, -1, 3))
									if ( cfg_strackgrow == 1 ) {
										_strackdata += "(" + strf("%3d", userspelldata(12, ap - 550) \ 1000) + "%)"
									}
									if ( cfg_strackstock != 0 ) {
										_strackdata += "[" + userspelldata(11, ap - 550) + "]"
									}
									_strackdata(2) += _strackdata + "\n"
								}
								else {
									if ( cfg_strackstock == 1 ) {
										if ( spell(ap - 400) <= 0 ) {
											gdatac(750 + cnt) = 0
											continue
										}
									}
									_strackdata = strmid(skillname(ap), 0, 6)
									repeat
										if ( strlen(_strackdata) < 8 ) {
											_strackdata += lang("　", "  ")
										}
										else {
											break
										}
									loop
									skilltmps = "" + sdata(600 + ap, ap2) / 1000
									_strackdata += strf("%4d", sorgex(ap, ap2)) + "." + strmid(skilltmps, -1, 3)
									if ( cfg_strackgrow == 1 ) {
										_strackdata += "(" + strf("%3d", sgrowth(ap, ap2)) + "%)"
									}
									if ( cfg_strackstock != 0 ) {
										_strackdata += "[" + spell(ap - 400) + "]"
									}
									_strackdata(2) += _strackdata + "\n"
								}
								_strackcnt(1)++
							}
							else {
								_strackdata = strmid(skillname(ap), 0, 6)
								repeat
									if ( strlen(_strackdata) < 8 ) {
										_strackdata += "　"
									}
									else {
										break
									}
								loop
								skilltmps = "" + sdata(600 + ap, ap2) / 1000
								_strackdata += strf("%4d", sorgex(ap, ap2)) + "." + strmid(skilltmps, -1, 3)
								if ( cfg_strackgrow == 1 ) {
									_strackdata += "(" + strf("%3d", sgrowth(ap, ap2)) + "%)"
								}
								_strackdata(3) += _strackdata + "\n"
								_strackcnt(0)++
							}
						}
						ap3++
					loop
					if ( _strackdata(3) != "" ) {
						pos 16, inf_clocky + 100
						bmes2 _strackdata(3), 1
						_mesy += ginfo(15) * _strackcnt(0)
					}
					if ( _strackdata(2) != "" ) {
						pos 16, inf_clocky + 100 + _mesy
						bmes2 _strackdata(2), 2
						_mesy += ginfo(15) * _strackcnt(1)
					}
					if ( _strackdata(1) != "" ) {
						pos 16, inf_clocky + 100 + _mesy
						bmes2 _strackdata(1), 4
					}
				}
			}
			else {
				repeat 3
					dup roopbuf, gdata(750 + cnt)
					ap = roopbuf \ 10000
					if ( ap == 0 ) {
						continue
					}
					ap2 = roopbuf / 10000
					if ( cExist(ap2) != CHAR_STATE_ALIVE ) {
						if ( ap2 != 0 ) {
							roopbuf = 0
						}
						continue
					}
					pos 16, inf_clocky + 155 - ap3 * 16
					color 0, 0, 0
					bmes "" + strmid(skillname(ap), 0, 6), 255, 255, 255
					skilltmps = "" + sdata(600 + ap, ap2) / 1000
					pos 66, inf_clocky + 155 - ap3 * 16
					color 0, 0, 0
					bmes "" + sorgex(ap, ap2) + "." + strmid(skilltmps, -1, 3), 255, 255, 255
					ap3++
				loop
			}
		}
		hack_strack = 0
		if ( cfg_hpgauge ) {
			cnt2 = 0
			repeat 15, 1
				dup roopbuf, cExist(cnt)
				if ( roopbuf == 1 | roopbuf == 6 & cbit(CHARA_BIT_STETHOSCOPE, cnt) ) {
					dup roopbuf2, cMHP(cnt)
					dup roopbuf3, cHP(cnt)
					s = cnName(cnt)
					pos 16 + (windoww - strlen(s) * 7 - 16) * (cfg_hpgauge == 2), inf_clocky + 200 - 180 * (cfg_hpgauge == 2) + cnt2 * 32
					color 0, 0, 0
					bmes s, 255, 35 + 220 * (roopbuf == 1), 35 + 220 * (roopbuf == 1)
					if ( roopbuf == 1 ) {
						gaugelength = limit(int(1.0 * roopbuf3 * 30 / roopbuf2), 1, 30)
						pos 16 + (windoww - 108) * (cfg_hpgauge == 2), inf_clocky + 217 - 180 * (cfg_hpgauge == 2) + cnt2 * 32
						gzoom gaugelength * 3, 9, 3, 480 - gaugelength, 517, gaugelength, 3
						if ( cfg_mma_pethpmonitor ) {
							if ( roopbuf2 > 100000000 & cfg_nc_stateshorten ) {
								s = "" + roopbuf3 / 1000000 + "/" + roopbuf2 / 1000000
							}
							else {
								if ( roopbuf2 > 1000000 & cfg_nc_stateshorten ) {
									s = "" + roopbuf3 / 1000 + "/" + roopbuf2 / 1000
								}
								else {
									s = "" + roopbuf3 + "/" + roopbuf2
								}
							}
							pos 16 + (windoww - strlen(s) * 7 - 16) * (cfg_hpgauge == 2), inf_clocky + 200 - 180 * (cfg_hpgauge == 2) + cnt2 * 32 + 16
							if ( roopbuf3 > roopbuf2 / 2 ) {
								color 0, 0, 0
								bmes s, 255, 255, 255
							}
							else {
								if ( roopbuf3 > roopbuf2 / 10 ) {
									color 192, 192, 0
									bmes s, 255, 255, 192
								}
								else {
									color 192, 0, 0
									bmes s, 255, 192, 192
								}
							}
							color 0, 0, 0
						}
					}
					cnt2++
				}
			loop
		}
	}
	return

*autoTurn_pic
	gsel BUFFER_PIC2
	pos 0, 0
	if ( cRowAct(CHARA_PLAYER) == ACTION_DIG ) {
		picload_ exedir + "\\graphic\\anime1.bmp"
	}
	if ( cRowAct(CHARA_PLAYER) == ACTION_FISH ) {
		if ( rowactre ) {
			picload_ exedir + "\\graphic\\anime2.bmp"
		}
	}
	if ( cRowAct(CHARA_PLAYER) == ACTION_PLANT ) {
		picload_ exedir + "\\graphic\\anime3.bmp"
	}
	if ( cRowAct(CHARA_PLAYER) == ACTION_SEARCH ) {
		picload_ exedir + "\\graphic\\anime4.bmp"
	}
	gsel BUFFER_SCREEN
	return

*screen_drawAutoTurn
	if ( racount == 0 ) {
		gosub *autoTurn_pic
	}
	if ( msgtemp != "" | (cRowAct(CHARA_PLAYER) == ACTION_FISH & rowactre == 0 & fishanime == 0) ) {
		gosub *los_draw
		msgtemp = ""
	}
	gosub *screen_drawStatus
	if ( cRowAct(CHARA_PLAYER) == ACTION_FISH ) {
		if ( rowactre == 0 ) {
			gosub *fishing_draw
		}
	}
	sx = windoww - 156
	sy = inf_ver - 30
	w = 148
	h = 25
	window2 sx, sy, w, h, 0, 5
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 1
	pos sx + 43, sy + 6
	color 0, 0, 0
	bmes "AUTO TURN", 235, 235, 235
	pos sx + 18, sy + 12
	gmode 2, 24, 24
	grotate BUFFER_INF, 72, 392, 0.0174532925199433 * (gMin  / 4 \ 2 * 90)
	if ( cRowAct(CHARA_PLAYER) == ACTION_SEARCH | cRowAct(CHARA_PLAYER) == ACTION_DIG | cRowAct(CHARA_PLAYER) == ACTION_PLANT | (cRowAct(CHARA_PLAYER) == ACTION_FISH & rowactre != 0) ) {
		window2 sx, sy - 104, 148, 101, 0, 5
		if ( racount \ 15 == 0 ) {
			repeat 10
				redraw 0
				gmode 0
				pos sx + 2, sy - 102
				if ( cRowAct(CHARA_PLAYER) == ACTION_DIG ) {
					if ( cnt == 2 ) {
						snd SOUNDLIST_DIG1
					}
					gcopy BUFFER_PIC2, cnt / 2 \ 5 * 144, 0, 144, 96
				}
				if ( cRowAct(CHARA_PLAYER) == ACTION_FISH ) {
					if ( racount == 0 ) {
						if ( cnt == 0 ) {
							snd SOUNDLIST_WATER
						}
					}
					gcopy BUFFER_PIC2, cnt / 3 \ 3 * 144, 0, 144, 96
				}
				if ( cRowAct(CHARA_PLAYER) == ACTION_PLANT ) {
					if ( cnt == 4 ) {
						snd SOUNDLIST_BUSH1
					}
					gcopy BUFFER_PIC2, cnt / 2 \ 3 * 144, 0, 144, 96
				}
				if ( cRowAct(CHARA_PLAYER) == ACTION_SEARCH ) {
					if ( cnt == 2 ) {
						snd SOUNDLIST_DIG2
					}
					gcopy BUFFER_PIC2, cnt / 2 \ 4 * 144, 0, 144, 96
				}
				if ( (GetKeyState(145) | cfg_animewait == 0) != 1 ) {
					await 15 + cRowAct(CHARA_PLAYER) * 5
				}
				redraw 1
			loop
		}
		else {
			gcopy BUFFER_PIC2, 0, 0, 144, 96
		}
		racount++
		redraw 1
	}
	if ( firstautoturn == 1 ) {
		redraw 1
		firstautoturn = 0
	}
	gmode 2
	return

*label_1487
	return

*screen_drawMsg2
	gmode 0
	font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
	color 245, 245, 245
	msgx = 20
	msgy = 30
	sx = 760
	sx = strlen(s) * 8 + 45
	if ( sx > 760 ) {
		sx = 760
	}
	ap = sx / 128 + 1
	repeat ap
		if ( cnt == sx / 128 ) {
			ap = sx \ 128
		}
		else {
			ap = 128
		}
		pos cnt * 128 + msgx, msgy
		gcopy BUFFER_INF, 672, 477, ap, 3
		pos cnt * 128 + msgx, msgy + 2
		gcopy BUFFER_INF, 672, 480, ap, 22
		pos cnt * 128 + msgx, msgy + 22
		gcopy BUFFER_INF, 672, 477, ap, 2
	loop
	pos msgx + 18, msgy + 4
	mes s
	gmode 2
	return

*anime
	if ( mode == MODELIST_TXT_ADV ) {
		return
	}
	if ( GetKeyState(145) | cfg_animewait == 0 ) {
		return
	}
	if ( cfg_nc_workshortening == 2 ) {
		if ( areaId(gArea ) == AREA_SHELTER ) {
			return
		}
	}
	if ( animeid != ANIMATION_RAGNA ) {
		gosub *screen_draw
	}
	redraw 0
	gmode 2, inf_tiles, inf_tiles
	anicol = 0
	anisound = 0
	if ( animeid < ANIMATION_TAIL ) {
		anicol = eleinfo(ele, 0)
		anisound = eleinfo(ele, 1)
	}
	_switch_val = animeid
	if ( _switch_val == 8 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) == 0 ) {
			goto *anime_SWEND1
		}
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(10, 0)), chipi(CHIPI_HEIGHT, xy2pic(10, 0)) + 960
		pos 0, 960
		gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(10, 0)), chipi(CHIPI_Y, xy2pic(10, 0)), chipi(CHIPI_WIDTH, xy2pic(10, 0)), chipi(CHIPI_HEIGHT, xy2pic(10, 0))
		gfini chipi(CHIPI_WIDTH, xy2pic(10, 0)), chipi(CHIPI_HEIGHT, xy2pic(10, 0))
		gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
		gsel selcur
		anidx = (cX(cc) - scx) * inf_tiles + inf_screenx
		anidy = (cY(cc) - scy) * inf_tiles + inf_screeny
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, anidx - inf_tiles / 2, anidy - inf_tiles / 2, inf_tiles * 2, inf_tiles * 2
		gmode 2
		gsel BUFFER_SCREEN
		snd SOUNDLIST_FIZZLE
		repeat 12
			redraw 0
			pos anidx - inf_tiles / 2, anidy - inf_tiles / 2
			gcopy BUFFER_BUF, 0, 0, inf_tiles * 2, inf_tiles * 2
			pos anidx + inf_tiles / 2, anidy + 16
			grotate BUFFER_ITEM, 0, 960, 5 * cnt, cnt + 40, cnt + 40
			redraw 1
			await cfg_animewait
		loop
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 6 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 5 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 7 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 11 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) == 0 ) {
			goto *anime_SWEND1
		}
		if ( animeid == ANIMATION_CURSE ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(8, 0)), chipi(CHIPI_HEIGHT, xy2pic(8, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(8, 0)), chipi(CHIPI_Y, xy2pic(8, 0)), chipi(CHIPI_WIDTH, xy2pic(8, 0)), chipi(CHIPI_HEIGHT, xy2pic(8, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(8, 0)), chipi(CHIPI_HEIGHT, xy2pic(8, 0))
			gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
			gsel selcur
			snd SOUNDLIST_CURSE1
		}
		if ( animeid == ANIMATION_HEAL | animeid == ANIMATION_HEAL_FAST ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(7, 0)), chipi(CHIPI_HEIGHT, xy2pic(7, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(7, 0)), chipi(CHIPI_Y, xy2pic(7, 0)), chipi(CHIPI_WIDTH, xy2pic(7, 0)), chipi(CHIPI_HEIGHT, xy2pic(7, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(7, 0)), chipi(CHIPI_HEIGHT, xy2pic(7, 0))
			gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
			gsel selcur
			snd SOUNDLIST_HEAL1
		}
		if ( animeid == ANIMATION_OFFER ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(9, 0)), chipi(CHIPI_HEIGHT, xy2pic(9, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(9, 0)), chipi(CHIPI_Y, xy2pic(9, 0)), chipi(CHIPI_WIDTH, xy2pic(9, 0)), chipi(CHIPI_HEIGHT, xy2pic(9, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(9, 0)), chipi(CHIPI_HEIGHT, xy2pic(9, 0))
			gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
			gsel selcur
		}
		ax = (cX(tc) - scx) * inf_tiles + inf_screenx
		ay = (cY(tc) - scy) * inf_tiles + inf_screeny
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, ax - inf_tiles / 2, ay - inf_tiles / 2, inf_tiles * 2, inf_tiles * 2
		gmode 2
		gsel BUFFER_SCREEN
		repeat 15
			ax2(cnt) = rnd(inf_tiles)
			ay2(cnt) = rnd(inf_tiles) - 8
			ap(cnt) = (rnd(4) + 1) * (-1)
			if ( animeid == ANIMATION_CURSE ) {
				ap(cnt) *= -1
			}
		loop
		repeat 10
			if ( animeid == ANIMATION_HEAL_FAST ) {
				await 5
			}
			else {
				await cfg_animewait
			}
			acnt2 = cnt * 2
			redraw 0
			pos ax - inf_tiles / 2, ay - inf_tiles / 2
			gcopy BUFFER_BUF, 0, 0, inf_tiles * 2, inf_tiles * 2
			repeat 15
				pos ax + ax2(cnt), ay + ay2(cnt) + acnt2 / ap(cnt)
				grotate BUFFER_ITEM, 0, 960, acnt2 * ap(cnt), inf_tiles - acnt2 * 2, inf_tiles - acnt2 * 2
			loop
			redraw 1
		loop
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 3 | _switch_sw ) {
		_switch_sw = 0
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(5, 0)), chipi(CHIPI_HEIGHT, xy2pic(5, 0)) + 960
		pos 0, 960
		gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(5, 0)), chipi(CHIPI_Y, xy2pic(5, 0)), chipi(CHIPI_WIDTH, xy2pic(5, 0)), chipi(CHIPI_HEIGHT, xy2pic(5, 0))
		gfini chipi(CHIPI_WIDTH, xy2pic(5, 0)), chipi(CHIPI_HEIGHT, xy2pic(5, 0))
		gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
		gsel selcur
		snd SOUNDLIST_BREATH1
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime7.bmp"
		pos 0, 0
		gfini 480, 48
		gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
		gsel BUFFER_BUF
		pos 0, 0
		gmode 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gsel BUFFER_SCREEN
		repeat 6
			cnt2 = cnt
			redraw 0
			pos 0, 0
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			repeat maxbreath
				anidx = breathlist(0, cnt)
				anidy = breathlist(1, cnt)
				if ( fov_los(cX(cc), cY(cc), anidx, anidy) == 0 ) {
					continue
				}
				if ( (anidx - scx) * inf_tiles + inf_screenx + inf_tiles / 2 < windoww ) {
					if ( (anidy - scy) * inf_tiles + inf_screeny + 16 < inf_screenh * inf_tiles + inf_screeny - inf_tiles / 2 ) {
						pos (anidx - scx) * inf_tiles + inf_screenx + inf_tiles / 2, (anidy - scy) * inf_tiles + inf_screeny + 16
						gmode 2, inf_tiles, inf_tiles
						grotate BUFFER_PIC, cnt2 * 48, 0, atan(tlocx - cX(cc), cY(cc) - tlocy), inf_tiles, inf_tiles
					}
				}
			loop
			await cfg_animewait
			redraw 1
		loop
		if ( anisound ) {
			snd anisound, FALSE, TRUE
		}
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 17 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 2 | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_BALL1
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime5.bmp"
		pos 0, 96
		gfini 480, 48
		gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
		aniw = 360
		anih = 360
		anidx = (anix - scx) * inf_tiles + inf_screenx + 24
		anidy = (aniy - scy) * inf_tiles + inf_screeny + 24
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gmode 2
		gsel BUFFER_SCREEN
		color 0, 0, 0
		repeat 10
			anip = cnt
			repeat aniref * 2 + 1
				anidy = aniy - aniref + cnt
				sy = anidy - scy
				if ( sy < 0 | sy >= inf_screenh ) {
					continue
				}
				repeat aniref * 2 + 1
					anidx = anix - aniref + cnt
					sx = anidx - scx
					if ( sx < 0 | sx >= inf_screenw ) {
						continue
					}
					anip(1) = dist(anix, aniy, anidx, anidy)
					if ( anip(1) > aniref ) {
						continue
					}
					anip(1) = 48 - (anip - 4) * (anip - 4) * 2
					if ( animeid == ANIMATION_BALL ) {
						if ( fov_los(anix, aniy, anidx, anidy) == 0 ) {
							continue
						}
					}
					if ( sx * inf_tiles + inf_screenx < windoww ) {
						if ( sy * inf_tiles + inf_screeny < inf_screenh * inf_tiles + inf_screeny - inf_tiles / 2 ) {
							pos sx * inf_tiles + inf_screenx, sy * inf_tiles + inf_screeny
							gmode 2, 48, 48
							gcopy BUFFER_PIC, anip * 48, 96, 48, 48
						}
					}
				loop
			loop
			anidx = (anix - scx) * inf_tiles + inf_screenx + 24
			anidy = (aniy - scy) * inf_tiles + inf_screeny + 24
			if ( anidx < windoww ) {
				if ( anidy < inf_screenh * inf_tiles + inf_screeny - inf_tiles / 2 ) {
					pos anidx, anidy
					gmode 4, 96, 96, 250 - cnt * cnt * 2
					grotate BUFFER_PIC, cnt * 96, 0, 0, 96, 96
				}
			}
			redraw 1
			redraw 0
			gmode 0
			pos 0, 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			await cfg_animewait
		loop
		if ( anisound ) {
			snd anisound, FALSE, TRUE
		}
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 0 | _switch_sw ) {
		_switch_sw = 0
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(3, 0)), chipi(CHIPI_HEIGHT, xy2pic(3, 0)) + 960
		pos 0, 960
		gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(3, 0)), chipi(CHIPI_Y, xy2pic(3, 0)), chipi(CHIPI_WIDTH, xy2pic(3, 0)), chipi(CHIPI_HEIGHT, xy2pic(3, 0))
		gfini chipi(CHIPI_WIDTH, xy2pic(3, 0)), chipi(CHIPI_HEIGHT, xy2pic(3, 0))
		gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
		gsel selcur
		snd SOUNDLIST_BOLT1
		anidx = cX(cc)
		anidy = cY(cc)
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime6.bmp"
		pos 0, 0
		gfini 480, 48
		gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gsel BUFFER_SCREEN
		ap(20) = -1
		repeat 20
			if ( ap(20) == (-1) ) {
				route_info anidx, anidy, cnt
				if ( stat == (-1) ) {
					ap(cnt) = -1
					continue
				}
				else {
					if ( stat == 0 ) {
						ap(cnt) = -2
						ap(20) = 4
						continue
					}
				}
				if ( dist(anidx, anidy, cX(cc), cY(cc)) > skillTg(efid) \ 1000 + 1 ) {
					ap(cnt) = -2
					ap(20) = 4
					continue
				}
				ax(cnt) = (anidx - scx) * inf_tiles + inf_screenx + inf_tiles / 2
				ay(cnt) = (anidy - scy) * inf_tiles + inf_screeny + 8
				ap(cnt) = 0
			}
			else {
				ap(20)--
				if ( ap(20) == 0 ) {
					break
				}
			}
			redraw 0
			pos 0, 0
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			cnt2 = cnt
			repeat cnt2 + 1
				if ( ap(cnt) == (-1) ) {
					continue
				}
				if ( ap(cnt) == (-2) ) {
					break
				}
				if ( ap(cnt) < 5 ) {
					if ( ax(cnt) < windoww ) {
						if ( ay(cnt) < inf_screenh * inf_tiles + inf_screeny - inf_tiles / 2 ) {
							pos ax(cnt), ay(cnt)
							gmode 2, inf_tiles, inf_tiles
							grotate BUFFER_PIC, ap(cnt) * 48, 0, atan(tlocx - cX(cc), cY(cc) - tlocy), 48, 48
						}
					}
				}
				ap(cnt)++
			loop
			await cfg_animewait + 15
			redraw 1
		loop
		if ( anisound ) {
			snd anisound, FALSE, TRUE
		}
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 15 | _switch_sw ) {
		_switch_sw = 0
		if ( cfg_useffhp ) {
			if ( synccheck(cc, -1) == 0 ) {
				goto *anime_SWEND1
			}
			if ( aniref(2) != (-1) ) {
				preparepicitemex aniref(2)
			}
			else {
				preparepicitem_func aniref, aniref(1)
			}
		}
		else {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, aniref), chipi(CHIPI_HEIGHT, aniref) + 960
			if ( aniref == 528 ) {
				gmode 2
				pos 0, 960
				gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
				pos 0, 1008
				gzoom 22, 20, 5, chipc(CHIPC_X, aniref(1)) + 8, chipc(CHIPC_Y, aniref(1)) + 4 + (chipc(CHIPC_HEIGHT, aniref(1)) > inf_tiles) * 8, chipc(CHIPC_WIDTH, aniref(1)) - 16, chipc(CHIPC_HEIGHT, aniref(1)) - 8 - (chipc(CHIPC_HEIGHT, aniref(1)) > inf_tiles) * 10, 1
				pos 6, 974
				gcopy BUFFER_ITEM, 0, 1008, 22, 20
				gsel selcur
			}
			else {
				if ( aniref == 531 ) {
					pos 8, 1058 - chipc(CHIPC_HEIGHT, aniref(1))
					gcopy BUFFER_CHR, chipc(CHIPC_X, aniref(1)) + 8, chipc(CHIPC_Y, aniref(1)) + 2, chipc(CHIPC_WIDTH, aniref(1)) - 16, chipc(CHIPC_HEIGHT, aniref(1)) - 8
					gmode 4, , , 150
					color 0, 0, 0
					pos 0, 960 + (chipc(CHIPC_HEIGHT, aniref(1)) == inf_tiles) * 48
					gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, aniref(1)) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, aniref(1)) + (chipc(CHIPC_HEIGHT, aniref(1)) > inf_tiles) * 48
					gmode 2
					gsel selcur
				}
				else {
					if ( aniref == 529 ) {
						pos 0, 1056 - chipc(CHIPC_HEIGHT, aniref(1))
						gcopy BUFFER_CHR, chipc(CHIPC_X, aniref(1)), chipc(CHIPC_Y, aniref(1)), chipc(CHIPC_WIDTH, aniref(1)), chipc(CHIPC_HEIGHT, aniref(1))
						gmode 2
						gsel selcur
					}
					else {
						pos 0, 960
						gcopy BUFFER_ITEM, chipi(CHIPI_X, aniref), chipi(CHIPI_Y, aniref), chipi(CHIPI_WIDTH, aniref), chipi(CHIPI_HEIGHT, aniref)
						gfini chipi(CHIPI_WIDTH, aniref), chipi(CHIPI_HEIGHT, aniref)
						gfdec2 c_col(0, aniref(1)), c_col(1, aniref(1)), c_col(2, aniref(1))
						gsel selcur
					}
				}
			}
		}
		ax = (cX(cc) - scx) * inf_tiles
		ay = (cY(cc) - scy) * inf_tiles
		ap = dist(cX(cc), cY(cc), anix, aniy) / 2 + 1
		repeat ap
			ax -= (cX(cc) - anix) * inf_tiles / ap
			ay -= (cY(cc) - aniy) * inf_tiles / ap
			gsel BUFFER_BUF
			gmode 0
			pos 0, 0
			gcopy BUFFER_SCREEN, ax, ay - inf_tiles / 2, inf_tiles, inf_tiles
			gmode 2
			gsel BUFFER_SCREEN
			gmode 2, inf_tiles, inf_tiles
			if ( ax + inf_tiles / 2 < windoww ) {
				if ( ay < inf_screenh * inf_tiles + inf_screeny - inf_tiles / 2 ) {
					pos ax + inf_tiles / 2, ay
					grotate BUFFER_ITEM, 0, 960, atan(anix - cX(cc), cY(cc) - aniy), inf_tiles, inf_tiles
				}
			}
			redraw 1
			redraw 0
			gmode 0
			pos ax, ay - inf_tiles / 2
			gcopy BUFFER_BUF, 0, 0, inf_tiles, inf_tiles
			gmode 2
			await cfg_animewait
		loop
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 111 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 110 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 108 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 109 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 1 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 18 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) == 0 ) {
			goto *anime_SWEND1
		}
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(6, 0)), chipi(CHIPI_HEIGHT, xy2pic(6, 0)) + 960
		pos 0, 960
		gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(6, 0)), chipi(CHIPI_Y, xy2pic(6, 0)), chipi(CHIPI_WIDTH, xy2pic(6, 0)), chipi(CHIPI_HEIGHT, xy2pic(6, 0))
		gfini chipi(CHIPI_WIDTH, xy2pic(6, 0)), chipi(CHIPI_HEIGHT, xy2pic(6, 0))
		gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
		gsel selcur
		if ( animeid == ANIMATION_SPORE ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(23, 0)), chipi(CHIPI_HEIGHT, xy2pic(23, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(23, 0)), chipi(CHIPI_Y, xy2pic(23, 0)), chipi(CHIPI_WIDTH, xy2pic(23, 0)), chipi(CHIPI_HEIGHT, xy2pic(23, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(23, 0)), chipi(CHIPI_HEIGHT, xy2pic(23, 0))
			gfdec2 c_col(0, COLOR_DEFAULT), c_col(1, COLOR_DEFAULT), c_col(2, COLOR_DEFAULT)
			gsel selcur
			snd SOUNDLIST_BOW1
		}
		if ( animeid == ANIMATION_UNUSED1 ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(1, 0)), chipi(CHIPI_HEIGHT, xy2pic(1, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(1, 0)), chipi(CHIPI_Y, xy2pic(1, 0)), chipi(CHIPI_WIDTH, xy2pic(1, 0)), chipi(CHIPI_HEIGHT, xy2pic(1, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(1, 0)), chipi(CHIPI_HEIGHT, xy2pic(1, 0))
			gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
			gsel selcur
			if ( itemsnd(aniref) == 0 ) {
				snd SOUNDLIST_BOW1
			}
		}
		if ( animeid == ANIMATION_UNUSED2 ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(1, 0)), chipi(CHIPI_HEIGHT, xy2pic(1, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(1, 0)), chipi(CHIPI_Y, xy2pic(1, 0)), chipi(CHIPI_WIDTH, xy2pic(1, 0)), chipi(CHIPI_HEIGHT, xy2pic(1, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(1, 0)), chipi(CHIPI_HEIGHT, xy2pic(1, 0))
			gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
			gsel selcur
			if ( itemsnd(aniref) == 0 ) {
				snd SOUNDLIST_BOW1
			}
		}
		if ( animeid == ANIMATION_UNUSED3 ) {
			ap = refitem(iID(aniref), DBSPEC_TYPE_MINOR, aniref)
			if ( ap == 24021 ) {
				gsel BUFFER_ITEM
				color 0
				boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(13, 0)), chipi(CHIPI_HEIGHT, xy2pic(13, 0)) + 960
				pos 0, 960
				gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(13, 0)), chipi(CHIPI_Y, xy2pic(13, 0)), chipi(CHIPI_WIDTH, xy2pic(13, 0)), chipi(CHIPI_HEIGHT, xy2pic(13, 0))
				gfini chipi(CHIPI_WIDTH, xy2pic(13, 0)), chipi(CHIPI_HEIGHT, xy2pic(13, 0))
				gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
				gsel selcur
				if ( itemsnd(aniref) == 0 ) {
					snd SOUNDLIST_LASER1
				}
			}
			if ( ap == 24020 ) {
				gsel BUFFER_ITEM
				color 0
				boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(2, 0)), chipi(CHIPI_HEIGHT, xy2pic(2, 0)) + 960
				pos 0, 960
				gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(2, 0)), chipi(CHIPI_Y, xy2pic(2, 0)), chipi(CHIPI_WIDTH, xy2pic(2, 0)), chipi(CHIPI_HEIGHT, xy2pic(2, 0))
				gfini chipi(CHIPI_WIDTH, xy2pic(2, 0)), chipi(CHIPI_HEIGHT, xy2pic(2, 0))
				gfdec2 c_col(0, anicol), c_col(1, anicol), c_col(2, anicol)
				gsel selcur
				if ( itemsnd(aniref) == 0 ) {
					snd SOUNDLIST_GUN1
				}
			}
		}
		if ( animeid == ANIMATION_UNUSED4 ) {
			if ( cfg_useffhp ) {
				preparepicitemex aniref
				snd SOUNDLIST_THROW1
			}
			else {
				gsel BUFFER_ITEM
				color 0
				boxf 0, 960, chipi(CHIPI_WIDTH, iPic(aniref) \ 1000), chipi(CHIPI_HEIGHT, iPic(aniref) \ 1000) + 960
				if ( iPic(aniref) \ 1000 == 528 ) {
					gmode 2
					pos 0, 960
					gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
					pos 0, 1008
					gzoom 22, 20, 5, chipc(CHIPC_X, iPic(aniref) / 1000) + 8, chipc(CHIPC_Y, iPic(aniref) / 1000) + 4 + (chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) > inf_tiles) * 8, chipc(CHIPC_WIDTH, iPic(aniref) / 1000) - 16, chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) - 8 - (chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) > inf_tiles) * 10, 1
					pos 6, 974
					gcopy BUFFER_ITEM, 0, 1008, 22, 20
					gsel selcur
				}
				else {
					if ( iPic(aniref) \ 1000 == 531 ) {
						pos 8, 1058 - chipc(CHIPC_HEIGHT, iPic(aniref) / 1000)
						gcopy BUFFER_CHR, chipc(CHIPC_X, iPic(aniref) / 1000) + 8, chipc(CHIPC_Y, iPic(aniref) / 1000) + 2, chipc(CHIPC_WIDTH, iPic(aniref) / 1000) - 16, chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) - 8
						gmode 4, , , 150
						color 0, 0, 0
						pos 0, 960 + (chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) == inf_tiles) * 48
						gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) + (chipc(CHIPC_HEIGHT, iPic(aniref) / 1000) > inf_tiles) * 48
						gmode 2
						gsel selcur
					}
					else {
						if ( iPic(aniref) \ 1000 == 529 ) {
							pos 0, 1056 - chipc(CHIPC_HEIGHT, iPic(aniref) / 1000)
							gcopy BUFFER_CHR, chipc(CHIPC_X, iPic(aniref) / 1000), chipc(CHIPC_Y, iPic(aniref) / 1000), chipc(CHIPC_WIDTH, iPic(aniref) / 1000), chipc(CHIPC_HEIGHT, iPic(aniref) / 1000)
							gmode 2
							gsel selcur
						}
						else {
							pos 0, 960
							gcopy BUFFER_ITEM, chipi(CHIPI_X, iPic(aniref) \ 1000), chipi(CHIPI_Y, iPic(aniref) \ 1000), chipi(CHIPI_WIDTH, iPic(aniref) \ 1000), chipi(CHIPI_HEIGHT, iPic(aniref) \ 1000)
							gfini chipi(CHIPI_WIDTH, iPic(aniref) \ 1000), chipi(CHIPI_HEIGHT, iPic(aniref) \ 1000)
							gfdec2 c_col(0, iPic(aniref) / 1000), c_col(1, iPic(aniref) / 1000), c_col(2, iPic(aniref) / 1000)
							gsel selcur
							snd SOUNDLIST_THROW1
						}
					}
				}
			}
		}
		if ( animeid == ANIMATION_ARROW ) {
			snd SOUNDLIST_ARROW1
		}
		ax = (cX(cc) - scx) * inf_tiles
		ay = (cY(cc) - scy) * inf_tiles + inf_screeny + 8
		ap = dist(cX(cc), cY(cc), cX(tc), cY(tc)) / 2 + 1
		repeat ap
			ax -= (cX(cc) - cX(tc)) * inf_tiles / ap
			ay -= (cY(cc) - cY(tc)) * inf_tiles / ap
			gsel BUFFER_BUF
			gmode 0
			pos 0, 0
			gcopy BUFFER_SCREEN, ax, ay - inf_tiles / 2, inf_tiles, inf_tiles
			gmode 2
			gsel BUFFER_SCREEN
			gmode 2, inf_tiles, inf_tiles
			pos ax + inf_tiles / 2, ay
			grotate BUFFER_ITEM, 0, 960, atan(cX(tc) - cX(cc), cY(cc) - cY(tc)), inf_tiles, inf_tiles
			redraw 1
			redraw 0
			gmode 0
			pos ax, ay - inf_tiles / 2
			gcopy BUFFER_BUF, 0, 0, inf_tiles, inf_tiles
			gmode 2
			await cfg_animewait
		loop
		if ( anisound ) {
			snd anisound, FALSE, TRUE
		}
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 9 | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ATK1
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0)) + 960
		pos 0, 960
		gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(17, 0)), chipi(CHIPI_Y, xy2pic(17, 0)), chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0))
		gfini chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0))
		gfdec2 c_col(0, COLOR_DEFAULT), c_col(1, COLOR_DEFAULT), c_col(2, COLOR_DEFAULT)
		gsel selcur
		anidx = (cX(tc) - scx) * inf_tiles + inf_screenx
		anidy = (cY(tc) - scy) * inf_tiles + inf_screeny
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, anidx - 16, anidy - 16, 64, 64
		gmode 2
		gsel BUFFER_SCREEN
		repeat 4
			redraw 0
			pos anidx - 16, anidy - 16
			gcopy BUFFER_BUF, 0, 0, 64, 64
			pos anidx + 16, anidy + 16
			grotate BUFFER_ITEM, 0, 960, 0.5 * cnt - 0.8, cnt * 8 + 18, cnt * 8 + 18
			redraw 1
			await cfg_animewait
		loop
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 12 | _switch_sw ) {
		_switch_sw = 0
		ap = 0
		if ( attackskill == SKILL_WEAPON_BOW ) {
			ap = 2
		}
		if ( attackskill == SKILL_WEAPON_CROSSBOW ) {
			ap = 2
		}
		if ( attackskill == SKILL_WEAPON_FIREARM ) {
			ap = 2
		}
		if ( attackskill == SKILL_WEAPON_THROWING ) {
			ap = 2
		}
		if ( attackskill == SKILL_WEAPON_LONGSWORD ) {
			ap = 1
		}
		if ( attackskill == SKILL_WEAPON_POLEARM ) {
			ap = 1
		}
		if ( attackskill == SKILL_WEAPON_STAVE ) {
			ap = 0
		}
		if ( attackskill == SKILL_WEAPON_SHORTSWORD ) {
			ap = 1
		}
		if ( attackskill == SKILL_WEAPON_BLUNT ) {
			ap = 0
		}
		if ( attackskill == SKILL_WEAPON_AXE ) {
			ap = 1
		}
		if ( attackskill == SKILL_WEAPON_SCYTHE ) {
			ap = 1
		}
		aniref = aniref / 4 + 1
		if ( aniref > 20 ) {
			aniref = 20
		}
		if ( cbit(CHARA_BIT_STONE_BLOOD, tc) ) {
			anix(1) = 1104
		}
		else {
			anix(1) = 720
		}
		if ( ap == 0 ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(17, 0)), chipi(CHIPI_Y, xy2pic(17, 0)), chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0))
			gfdec2 c_col(0, COLOR_DEFAULT), c_col(1, COLOR_DEFAULT), c_col(2, COLOR_DEFAULT)
			gsel selcur
		}
		repeat aniref
			sx(cnt) = rnd(24) - 12
			sy(cnt) = rnd(8)
		loop
		anidx = (cX(tc) - scx) * inf_tiles + inf_screenx
		anix = anidx + rnd(12) - rnd(12)
		anidy = (cY(tc) - scy) * inf_tiles + inf_screeny
		aniy = anidy - 16 + rnd(12) - rnd(12)
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, anidx - 24, anidy - 48, 96, 144
		if ( critical ) {
			gsel BUFFER_PIC
			picload_ exedir + "graphic\\anime28.bmp"
		}
		gmode 2
		gsel BUFFER_SCREEN
		repeat 4 + (critical != 0)
			redraw 0
			gmode 2
			cnt2 = cnt * 2
			gmode 2, inf_tiles, inf_tiles
			if ( critical ) {
				pos anidx - 24, anidy - 32
				gcopy BUFFER_PIC, cnt * 96, 0, 96, 96
			}
			repeat aniref
				pos anidx + 24 + sx(cnt) + (sx(cnt) < 4) * ((1 + (cnt \ 2 == 0)) * (-1)) * cnt2 + (sx(cnt) > (-4)) * (1 + (cnt \ 2 == 0)) * cnt2, anidy + sy(cnt) + cnt2 * cnt2 / 3
				grotate BUFFER_ITEM, anix(1), 0, 0.4 * cnt, 6, 6
			loop
			if ( ap == 0 ) {
				pos anidx + sx + 24, anidy + sy + 10
				grotate BUFFER_ITEM, 0, 960, 0.5 * cnt - 0.8, cnt * 10 + aniref, cnt * 10 + aniref
			}
			if ( ap == 1 ) {
				pos anidx, anidy
				gcopy BUFFER_INF, 1008 + cnt * 48, 432, 48, 48
			}
			if ( ap == 2 ) {
				pos anidx, anidy
				gcopy BUFFER_INF, 816 + cnt * 48, 432, 48, 48
			}
			redraw 1
			redraw 0
			gmode 0
			pos anidx - 24, anidy - 48
			gcopy BUFFER_BUF, 0, 0, 96, 144
			gmode 2
			await cfg_animewait
		loop
		if ( synccheck(cc, -1) ) {
			if ( cc == CHARA_PLAYER | (cfg_npcattackanime == 1 & petcheck(cc)) | cfg_npcattackanime == 2 ) {
				if ( critical ) {
					snd SOUNDLIST_ATK2
				}
				else {
					if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS | attackrange == 1 ) {
						snd SOUNDLIST_ATK1
					}
					else {
						if ( itemsnd(cw) == 0 ) {
							snd SOUNDLIST_ATK1
						}
					}
				}
			}
		}
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 20 | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ATK_ELEC
		if ( synccheck(anic, -1) == 0 ) {
			goto *anime_SWEND1
		}
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime13.bmp"
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gsel BUFFER_SCREEN
		anidx = (cX(anic) - scx) * inf_tiles + inf_screenx - 24
		anidy = (cY(anic) - scy) * inf_tiles + inf_screeny - 60
		repeat 10
			redraw 0
			pos 0, 0
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			cnt2 = cnt
			gmode 2
			repeat anidy / 96 + 2
				pos anidx, anidy - cnt * 96
				gcopy BUFFER_PIC, cnt2 / 2 * 96, (cnt == 0) * 96, 96, 96
			loop
			await cfg_animewait + 25
			redraw 1
		loop
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 19 | _switch_sw ) {
		_switch_sw = 0
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime12.bmp"
		gsel BUFFER_BUF
		pos 0, 0
		gmode 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gsel BUFFER_SCREEN
		am = 0
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( animode == 0 ) {
				if ( cnt == cc ) {
					continue
				}
			}
			if ( animode >= 100 ) {
				if ( cnt != animode - 100 ) {
					continue
				}
			}
			ax(am) = (cX(cnt) - scx) * inf_tiles + inf_screenx - 24
			if ( am != 0 ) {
				ax(am) += 4 - rnd(8)
			}
			ay(am) = (cY(cnt) - scy) * inf_tiles + inf_screeny + 32
			if ( ay(am) < 0 | ay(am) > inf_screenh * inf_tiles + inf_screeny ) {
				continue
			}
			if ( ax(am) < (-20) | ax(am) > windoww + 20 ) {
				continue
			}
			ap(am) = 20 + (am != 0) * rnd(5)
			am++
		loop
		repeat
			redraw 0
			pos 0, 0
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			af = 0
			repeat am
				if ( ap(cnt) <= 0 ) {
					continue
				}
				af = 1
				cnt2 = cnt
				anidy = ay(cnt) * limit(20 - ap(cnt), 0, 6) / 6 - 96
				gmode 2, 96, 96
				pos ax(cnt), anidy
				gcopy BUFFER_PIC, limit(8 - ap(cnt), 0, 8) * 96 + 96 * (ap(cnt) < 15), 0, 96, 96
				if ( ap(cnt) <= 14 ) {
					if ( ap(cnt) >= 6 ) {
						pos ax(cnt), anidy + 16
						gcopy BUFFER_PIC, (14 - ap(cnt)) / 2 * 96, 96, 96, 96
					}
				}
				anidx = limit(anidy / 55 + 1, 0, 7 - limit((11 - ap(cnt)) * 2, 0, 7))
				repeat anidx, 1
					pos ax(cnt2), anidy - cnt * 55
					gcopy BUFFER_PIC, 96 * (ap(cnt2) < 15), 0, 96, 55
					if ( cnt == anidx ) {
						pos ax(cnt2), anidy - cnt * 55 - 40
						gcopy BUFFER_PIC, 288, 0, 96, 40
					}
				loop
				if ( ap(cnt) >= 20 ) {
					ap(cnt) -= rnd(2)
				}
				else {
					ap(cnt)--
				}
			loop
			if ( cnt \ 2 == 0 ) {
				if ( cnt < 30 ) {
					if ( cnt / 3 < am ) {
						if ( animode == 0 ) {
							snd SOUNDLIST_BOLT1
						}
						if ( animode >= 100 ) {
							snd SOUNDLIST_HEAL1
						}
					}
				}
			}
			if ( af == 0 ) {
				break
			}
			await cfg_animewait + 25
			redraw 1
		loop
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 22 | _switch_sw ) {
		_switch_sw = 0
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime17.bmp"
		gsel BUFFER_BUF
		pos 0, 0
		gmode 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gsel BUFFER_SCREEN
		am = 0
		repeat 75
			ax(am) = 240 + rnd(windoww)
			ay(am) = -96
			ap(am) = rnd(8)
			am++
		loop
		repeat
			redraw 0
			if ( cnt < 4 ) {
				pos 0, 0
			}
			else {
				pos 5 - rnd(10), 5 - rnd(10)
			}
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			af = 0
			repeat am
				if ( ap(cnt) >= 16 ) {
					continue
				}
				af = 1
				anidy = ay(cnt) * limit(20 - ap(cnt), 0, 6) / 6 - 96
				gmode 2, 96, 96
				if ( ap(cnt) < 9 ) {
					ax(cnt) -= 16 + cnt \ (windoww / 30)
					ay(cnt) += 24 + cnt \ (windowh / 10)
				}
				if ( ap(cnt) >= 10 ) {
					pos ax(cnt) - 48, ay(cnt)
					gcopy BUFFER_PIC, (ap(cnt) - 10) * 192, 96, 192, 96
				}
				if ( ap(cnt) < 16 ) {
					pos ax(cnt), ay(cnt)
					gcopy BUFFER_PIC, limit(ap(cnt) - 8, 0, 8) * 96, 0, 96, 96
				}
				ap(cnt)++
			loop
			if ( cnt \ 2 == 0 ) {
				if ( cnt < 8 ) {
					if ( cnt / 3 < am ) {
						snd SOUNDLIST_ATK_FIRE
					}
				}
			}
			if ( af == 0 ) {
				break
			}
			await cfg_animewait + 40
			redraw 1
		loop
		await cfg_animewait
		redraw 0
		pos 0, 0
		gmode 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		gmode 2
		redraw 1
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 21 | _switch_sw ) {
		_switch_sw = 0
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime16.bmp"
		gsel BUFFER_BUF
		pos 0, 0
		gmode 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gsel BUFFER_SCREEN
		am = 0
		repeat 100
			ax(am) = rnd(windoww)
			ay(am) = rnd(inf_screenh * inf_tiles) - 96 - 24
			ap(am) = 0 - rnd(3)
			am++
		loop
		repeat
			redraw 0
			pos 5 - rnd(10), 5 - rnd(10)
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			af = 0
			repeat am
				if ( ap(cnt) >= 10 ) {
					continue
				}
				af = 1
				cnt2 = cnt
				anidy = ay(cnt) * limit(20 - ap(cnt), 0, 6) / 6 - 96
				gmode 2, 96, 96
				if ( ap(cnt) < 10 ) {
					pos ax(cnt), ay(cnt)
					gcopy BUFFER_PIC, ap(cnt) * 96, 96, 96, 96
					pos ax(cnt), ay(cnt) - 96
					gcopy BUFFER_PIC, ap(cnt) * 96, 0, 96, 96
				}
				if ( ap(cnt) < 0 ) {
					ap(cnt) += rnd(2)
				}
				else {
					ap(cnt)++
				}
			loop
			if ( cnt \ 2 == 0 ) {
				if ( cnt < 8 ) {
					if ( cnt / 3 < am ) {
						snd SOUNDLIST_ATK_FIRE
					}
				}
			}
			if ( af == 0 ) {
				break
			}
			await cfg_animewait + 40
			redraw 1
		loop
		await cfg_animewait
		redraw 0
		pos 0, 0
		gmode 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		gmode 2
		redraw 1
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 14 | _switch_sw ) {
		_switch_sw = 0
		sx = x
		sy = y
		_switch_sw++
	}
	if ( _switch_val == 16 | _switch_sw ) {
		_switch_sw = 0
		aniref = 4
		ax = (sx - scx) * inf_tiles + inf_screenx
		ay = (sy - scy) * inf_tiles + inf_screeny
		if ( animeid == ANIMATION_CRUSH ) {
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0)) + 960
			pos 0, 960
			gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(17, 0)), chipi(CHIPI_Y, xy2pic(17, 0)), chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0))
			gfini chipi(CHIPI_WIDTH, xy2pic(17, 0)), chipi(CHIPI_HEIGHT, xy2pic(17, 0))
			gfdec2 c_col(0, COLOR_DEFAULT), c_col(1, COLOR_DEFAULT), c_col(2, COLOR_DEFAULT)
			gsel selcur
		}
		repeat aniref
			sx(cnt) = rnd(24) - 12
			sy(cnt) = rnd(8)
		loop
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, ax - 16, ay - 16, 64, 64
		gmode 2
		gsel BUFFER_SCREEN
		repeat 5
			redraw 0
			gmode 2
			cnt2 = cnt * 2
			gmode 2, inf_tiles, inf_tiles
			repeat aniref
				pos ax + 24 + sx(cnt) + (sx(cnt) < 4) * ((1 + (cnt \ 2 == 0)) * (-1)) * cnt2 + (sx(cnt) > (-4)) * (1 + (cnt \ 2 == 0)) * cnt2, ay + sy(cnt) + cnt2 * cnt2 / 3
				grotate BUFFER_ITEM, 864, 0, 0.4 * cnt, 24, 24
			loop
			pos ax + sx + 24, ay + sy + 10
			grotate BUFFER_ITEM, 0, 960, 0.5 * cnt - 0.8, cnt * 10 + aniref * 3, cnt * 10 + aniref * 3
			redraw 1
			redraw 0
			gmode 0
			pos ax - 16, ay - 16
			gcopy BUFFER_BUF, 0, 0, 64, 64
			gmode 2
			await cfg_animewait
		loop
		goto *anime_SWEND1
	}
	if ( _switch_val == 23 | _switch_sw ) {
		_switch_sw = 0
		gsel BUFFER_PIC
		picload_ exedir + "user\\graphic\\anime29.bmp"
		gsel BUFFER_BUF
		pos 0, 0
		gmode 0
		gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
		gsel BUFFER_SCREEN
		am = 0
		repeat 50
			ax(am) = rnd(windoww)
			ay(am) = rnd(inf_screenh * inf_tiles) - 96 - 24
			ap(am) = 0
			am++
		loop
		repeat
			redraw 0
			pos 5 - rnd(10), 5 - rnd(10)
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			af = 0
			repeat am
				if ( ap(cnt) >= 8 ) {
					continue
				}
				af = 1
				cnt2 = cnt
				anidy = ay(cnt) * limit(20 - ap(cnt), 0, 6) / 6 - 120
				gmode 2, 120, 120
				if ( ap(cnt) < 8 ) {
					pos ax(cnt), ay(cnt)
					gcopy BUFFER_PIC, ap(cnt) * 120, 120, 120, 120
					pos ax(cnt), ay(cnt) - 120
					gcopy BUFFER_PIC, ap(cnt) * 120, 0, 120, 120
				}
				ap(cnt)++
			loop
			if ( cnt \ 2 == 0 ) {
				if ( cnt < 6 ) {
					if ( cnt / 3 < am ) {
						snd SOUNDLIST_ATK_FIRE
					}
				}
			}
			if ( af == 0 ) {
				break
			}
			await cfg_animewait + 40
			redraw 1
		loop
		await cfg_animewait
		redraw 0
		pos 0, 0
		gmode 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		gmode 2
		redraw 1
		goto *anime_SWEND1
		_switch_sw++
	}
	if ( _switch_val == 24 | _switch_sw ) {
		_switch_sw = 0
		aniref = aniref / 4 + 1
		if ( aniref > 20 ) {
			aniref = 20
		}
		if ( cbit(CHARA_BIT_STONE_BLOOD, tc) ) {
			anix(1) = 1104
		}
		else {
			anix(1) = 720
		}
		repeat aniref
			sx(cnt) = rnd(24) - 12
			sy(cnt) = rnd(8)
		loop
		anidx = (cX(tc) - scx) * inf_tiles + inf_screenx
		anix = anidx + rnd(12) - rnd(12)
		anidy = (cY(tc) - scy) * inf_tiles + inf_screeny
		aniy = anidy - 16 + rnd(12) - rnd(12)
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		gcopy BUFFER_SCREEN, anidx - 24, anidy - 48, 96, 144
		gsel BUFFER_PIC
		picload_ exedir + "user\\graphic\\anime30.bmp"
		gmode 2
		gsel BUFFER_SCREEN
		repeat 5
			redraw 0
			gmode 2
			cnt2 = cnt * 2
			gmode 2, inf_tiles, inf_tiles
			if ( critical ) {
				pos anidx - 24, anidy - 32
				gcopy BUFFER_PIC, cnt * 96, 0, 96, 96
			}
			repeat aniref
				pos anidx + 24 + sx(cnt) + (sx(cnt) < 4) * ((1 + (cnt \ 2 == 0)) * (-1)) * cnt2 + (sx(cnt) > (-4)) * (1 + (cnt \ 2 == 0)) * cnt2, anidy + sy(cnt) + cnt2 * cnt2 / 3
				grotate BUFFER_ITEM, anix(1), 0, 0.4 * cnt, 6, 6
			loop
			pos anidx, anidy
			gcopy BUFFER_INF, 1008 + cnt * 48, 432, 48, 48
			redraw 1
			redraw 0
			gmode 0
			pos anidx - 24, anidy - 48
			gcopy BUFFER_BUF, 0, 0, 96, 144
			gmode 2
			await cfg_animewait
		loop
		goto *anime_SWEND1
		_switch_sw++
	}

*anime_SWEND1
	gmode 2
	anicol = 0
	return

*label_1530
	if ( scposval == 0 ) {
		if ( scroll ) {
			sx = cXnew(CHARA_PLAYER) - scx, cXnew(CHARA_PLAYER)
			sy = cYnew(CHARA_PLAYER) - scy, cYnew(CHARA_PLAYER)
		}
		else {
			sx = cX(CHARA_PLAYER) - scx, cX(CHARA_PLAYER)
			sy = cY(CHARA_PLAYER) - scy, cY(CHARA_PLAYER)
		}
	}
	else {
		sx = tlocx - scx, tlocx
		sy = tlocy - scy, tlocy
	}
	if ( gArea  == AREA_PET_ARENA | gArea  == 49 ) {
		sx = cX(camera) - scx, cX(camera)
		sy = cY(camera) - scy, cY(camera)
	}
	if ( cfg_alwayscenter ) {
		scx = sx + scx - inf_screenw / 2
		scy = sy + scy - inf_screenh / 2
	}
	else {
		if ( sy < scposy ) {
			scy = sy(1) - scposy
		}
		if ( sx < 6 ) {
			scx = sx(1) - 6
		}
		if ( sx > inf_screenw - 7 ) {
			scx = sx(1) - (inf_screenw - 7)
		}
		if ( sy > inf_screenh - scposy - 1 ) {
			scy = sy(1) - (inf_screenh - scposy - 1)
		}
	}
	if ( scx + inf_screenw >= mWidth ) {
		scx = mWidth - inf_screenw
	}
	if ( scy + inf_screenh >= mHeight ) {
		scy = mHeight - inf_screenh
	}
	if ( scy < 0 ) {
		scy = 0
	}
	if ( scx < 0 ) {
		scx = 0
	}
	return

*label_1531
	memset slight, 0, (inf_screenw + 4) * (inf_screenh + 4) * 4
	msync++
	sy(2) = cY(CHARA_PLAYER) - 17 / 2, cY(CHARA_PLAYER) + 17 / 2, 17 / 2 - cY(CHARA_PLAYER)
	sx(3) = cX(CHARA_PLAYER) - 17 / 2
	if ( cfg_scroll ) {
		repw = inf_screenw + 2, scx - 1
		reph = inf_screenh + 2, scy - 1
	}
	else {
		repw = inf_screenw, scx
		reph = inf_screenh, scy
	}
	if ( oabit(15, gArea ) | oabit(18, gArea ) | (gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_9)) ) {
		olistmax = 0
		inv_find ITEM_ID_TORCH, CHARA_PLAYER
		if ( stat != (-1) ) {
			olist(olistmax) = cX(CHARA_PLAYER) * 100 + cY(CHARA_PLAYER)
			olistmax++
		}
		inv_getheader -1
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iID(cnt) == ITEM_ID_TORCH ) {
				olist(olistmax) = iX(cnt) * 100 + iY(cnt)
				olistmax++
			}
		loop
	}
	ly = 1 + (cfg_scroll == 0)
	repeat reph, reph(1)
		sy = cnt
		lx = 1 + (cfg_scroll == 0)
		if ( sy < 0 | sy >= mHeight ) {
			repeat repw, repw(1)
				slight(lx + 1, ly) += 1
				slight(lx - 1, ly) += 8
				slight(lx, ly - 1) += 2
				slight(lx, ly + 1) += 4
				slight(lx + 1, ly + 1) += 16
				slight(lx - 1, ly - 1) += 32
				slight(lx + 1, ly - 1) += 64
				slight(lx - 1, ly + 1) += 128
				lx++
			loop
			ly++
			continue
		}
		repeat repw, repw(1)
			sx = cnt
			if ( sx < 0 | sx >= mWidth ) {
				slight(lx + 1, ly) += 1
				slight(lx - 1, ly) += 8
				slight(lx, ly - 1) += 2
				slight(lx, ly + 1) += 4
				slight(lx + 1, ly + 1) += 16
				slight(lx - 1, ly - 1) += 32
				slight(lx + 1, ly - 1) += 64
				slight(lx - 1, ly + 1) += 128
				lx++
				continue
			}
			if ( gArea  == AREA_PET_ARENA | gArea  == 49 ) {
				goto *label_1535
			}
			if ( cBlind(CHARA_PLAYER) != 0 ) {
				if ( ogTitleTheBlindSword != 2 ) {
					if ( sx != cX(CHARA_PLAYER) | sy != cY(CHARA_PLAYER) ) {
						goto *los_jump2
					}
				}
				else {
					if ( sx > cX(CHARA_PLAYER) + 2 | sx < cX(CHARA_PLAYER) - 2 | sy > cY(CHARA_PLAYER) + 2 | sy < cY(CHARA_PLAYER) - 2 ) {
						goto *los_jump2
					}
				}
			}
			if ( oabit(15, gArea ) | oabit(18, gArea ) | (gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_9)) ) {
				if ( sx != cX(CHARA_PLAYER) | sy != cY(CHARA_PLAYER) ) {
					f = 1
					repeat olistmax
						if ( abs(olist(cnt) / 100 - sx) <= 3 & abs(olist(cnt) \ 100 - sy) <= 3 ) {
							f = 0
							break
						}
					loop
					if ( f ) {
						goto *los_jump2
					}
				}
			}

			if ( sy > sy(2) ) {
				if ( sy < sy(3) ) {
					sx(2) = fovlist(0, sy + sy(4)) + sx(3)
					if ( sx >= sx(2) ) {
						if ( sx < fovlist(1, sy + sy(4)) + sx(3) ) {
							if ( fov_los(cX(CHARA_PLAYER), cY(CHARA_PLAYER), sx, sy) ) {
*label_1535
								mapsync(sx, sy) = msync
								if ( mapChara(sx, sy) != 0 ) {
									cSync(mapChara(sx, sy) - 1) = msync
								}
								if ( mapIdMemory(sx, sy) != mapId(sx, sy) ) {
									mapIdMemory(sx, sy) = mapId(sx, sy)
									gosub *screen_drawRader
								}
								mapItemsMemory(sx, sy) = mapItems(sx, sy)
								lx++
								continue
							}
						}
					}
				}
			}

*los_jump2
			slight(lx, ly) += 1000
			slight(lx + 1, ly) += 1
			slight(lx - 1, ly) += 8
			slight(lx, ly - 1) += 2
			slight(lx, ly + 1) += 4
			slight(lx + 1, ly + 1) += 16
			slight(lx - 1, ly - 1) += 32
			slight(lx + 1, ly - 1) += 64
			slight(lx - 1, ly + 1) += 128
			lx++
		loop
		ly++
	loop
	return

*los_Loc
	memset slight, 0, (inf_screenw + 4) * (inf_screenh + 4) * 4
	msync++
	sy(2) = tlocinity - val / 2, tlocinity + val / 2, val / 2 - tlocinity
	sx(3) = tlocinitx - val / 2 - 2
	if ( cfg_scroll ) {
		repw = inf_screenw + 2, scx - 1
		reph = inf_screenh + 2, scy - 1
	}
	else {
		repw = inf_screenw, scx
		reph = inf_screenh, scy
	}
	ly = 1 + (cfg_scroll == 0)
	repeat reph, reph(1)
		sy = cnt
		lx = 1 + (cfg_scroll == 0)
		if ( sy < 0 | sy >= mHeight ) {
			repeat repw, repw(1)
				slight(lx + 1, ly) += 1
				slight(lx - 1, ly) += 8
				slight(lx, ly - 1) += 2
				slight(lx, ly + 1) += 4
				slight(lx + 1, ly + 1) += 16
				slight(lx - 1, ly - 1) += 32
				slight(lx + 1, ly - 1) += 64
				slight(lx - 1, ly + 1) += 128
				lx++
			loop
			ly++
			continue
		}
		repeat repw, repw(1)
			sx = cnt
			if ( sx < 0 | sx >= mWidth ) {
				slight(lx + 1, ly) += 1
				slight(lx - 1, ly) += 8
				slight(lx, ly - 1) += 2
				slight(lx, ly + 1) += 4
				slight(lx + 1, ly + 1) += 16
				slight(lx - 1, ly - 1) += 32
				slight(lx + 1, ly - 1) += 64
				slight(lx - 1, ly + 1) += 128
				lx++
				continue
			}
			if ( dist(sx, sy, tlocinitx, tlocinity) < val ) {
				mapsync(sx, sy) = msync
				if ( mapChara(sx, sy) != 0 ) {
					cSync(mapChara(sx, sy) - 1) = msync
				}
				if ( mapIdMemory(sx, sy) != mapId(sx, sy) ) {
					mapIdMemory(sx, sy) = mapId(sx, sy)
				}
				mapItemsMemory(sx, sy) = mapItems(sx, sy)
				lx++
				continue
			}
			slight(lx, ly) += 1000
			slight(lx + 1, ly) += 1
			slight(lx - 1, ly) += 8
			slight(lx, ly - 1) += 2
			slight(lx, ly + 1) += 4
			slight(lx + 1, ly + 1) += 16
			slight(lx - 1, ly - 1) += 32
			slight(lx + 1, ly - 1) += 64
			slight(lx - 1, ly + 1) += 128
			lx++
		loop
		ly++
	loop
	return

*los_draw
	screendrawhack = 2
	cell_draw
	screendrawhack = 3
	if ( gArea  == AREA_PET_ARENA | gArea  == 49 ) {
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			ap = 0
			if ( cRelation(cnt) == RELATION_ALLY ) {
				ap = 1, 1, 25
			}
			if ( cRelation(cnt) == RELATION_ENEMY ) {
				ap = 25, 1, 1
			}
			if ( cnt == 0 ) {
				ap = 0
			}
			if ( ap != 0 ) {
				sx = (cX(cnt) - scx) * inf_tiles + inf_screenx
				sy = (cY(cnt) - scy) * inf_tiles + inf_screeny
				if ( sx >= 0 ) {
					if ( sy >= 0 ) {
						if ( sx - inf_screenx < (inf_screenw - 1) * inf_tiles ) {
							if ( sy < (inf_screenh - 1) * inf_tiles ) {
								pos sx, sy * (sy > 0)
								gfini inf_tiles, inf_tiles + (sy < 0) * inf_screeny
								gfinc ap, ap(1), ap(2)
								if ( cnt == camera ) {
									gmode 4, , , 120
									color 0, 0, 0
									pos sx + 36, sy + 32
									gcopy BUFFER_INF, 240, 410, 24, 16
									gmode 2
								}
							}
						}
					}
				}
			}
		loop
	}
	screendrawhack = 4

	if ( existfile_minimap ) {
		repeat mWidth
			oom_x = cnt
			repeat mHeight
				oom_y = cnt
				if ( mapbit(0, oom_x, oom_y) == 0 ) {
					continue
				}
				if ( mapIdMemory(oom_x, oom_y) == mapId(oom_x, oom_y) ) {
					if ( mapFeat(oom_x, oom_y) != 0 ) {
						sy = 84 * oom_y / mHeight
						if ( sy < 2 ) {
							sy = 2
						}
						else {
							if ( sy > 84 - 8 ) {
								sy = 84 - 8
							}
						}
						sx = 120 * oom_x / mWidth
						if ( sx < 2 ) {
							sx = 2
						}
						else {
							if ( sx > 120 - 8 ) {
								sx = 120 - 8
							}
						}
						pos inf_raderx + sx, inf_radery + sy
						_switch_val = mapFeat(oom_x, oom_y) / 1000 \ 100
						if ( _switch_val == 10 | _switch_sw ) {
							_switch_sw = 0
							_switch_sw++
						}
						if ( _switch_val == 11 | _switch_sw ) {
							_switch_sw = 0
							gcopy 97, 0, 0, 6, 6
							goto *label_1545
							_switch_sw++
						}
						if ( _switch_val == 20 | _switch_sw ) {
							_switch_sw = 0
							_switch_sw++
						}
						if ( _switch_val == 21 | _switch_sw ) {
							_switch_sw = 0
							gcopy 97, 18, 0, 6, 6
							goto *label_1545
							_switch_sw++
						}
						if ( _switch_val == 24 | _switch_sw ) {
							_switch_sw = 0
							_switch_sw++
						}
						if ( _switch_val == 25 | _switch_sw ) {
							_switch_sw = 0
							_switch_sw++
						}
						if ( _switch_val == 26 | _switch_sw ) {
							_switch_sw = 0
							_switch_sw++
						}
						if ( _switch_val == 27 | _switch_sw ) {
							_switch_sw = 0
							_switch_sw++
						}
						if ( _switch_val == 28 | _switch_sw ) {
							_switch_sw = 0
							gcopy 97, 12, 0, 6, 6
							goto *label_1545
							_switch_sw++
						}
						if ( _switch_val == 14 | _switch_sw ) {
							_switch_sw = 0
							_switch_sw++
						}
						if ( _switch_val == 32 | _switch_sw ) {
							_switch_sw = 0
							gcopy 97, 6, 0, 6, 6
							goto *label_1545
						}
						goto *label_1545
					}
				}
*label_1545
			loop
		loop
	}
	sy = 84 * cY(CHARA_PLAYER) / mHeight
	if ( sy < 2 ) {
		sy = 2
	}
	else {
		if ( sy > 84 - 8 ) {
			sy = 84 - 8
		}
	}
	sx = 120 * cX(CHARA_PLAYER) / mWidth
	if ( sx < 2 ) {
		sx = 2
	}
	else {
		if ( sx > 120 - 8 ) {
			sx = 120 - 8
		}
	}
	if ( raderx != (-1) ) {
		pos inf_raderx + raderx, inf_radery + radery
		gcopy BUFFER_INF, 688 + raderx, 528 + radery, 6, 6
	}
	raderx = sx
	radery = sy
	pos inf_raderx + sx, inf_radery + sy
	gcopy BUFFER_INF, 15, 338, 6, 6
	losmode = 0
	screendrawhack = 5
	if ( cfg_env ) {
		if ( gWeather == WEATHER_RAIN ) {
			gosub *screen_rain
		}
		if ( gWeather == WEATHER_HARD_RAIN ) {
			gosub *screen_hardRain
		}
		if ( gWeather == WEATHER_SNOW ) {
			gosub *screen_snow
		}
		if ( gWeather == WEATHER_ETHER ) {
			gosub *screen_ether
		}
	}
	return

*screen_rain
	if ( mField != MAP_FIELD_OUTDOOR ) {
		return
	}
	repeat maxrain * (1 + (mType == MAP_TYPE_WORLD))
		s_p = rnd(100)
		color 170 - s_p, 200 - s_p, 250 - s_p
		if ( gTimeStopTime != 0 ) {
			color 150, 150, 150
		}
		line rainx(cnt) - 40, rainy(cnt) - cnt \ 3 - 1, rainx(cnt) - 39 + cnt \ 2, rainy(cnt)
		if ( gTimeStopTime != 0 ) {
			continue
		}
		if ( rainx(cnt) == 0 ) {
			rainx(cnt) = rnd(windoww) + 40
		}
		else {
			rainx(cnt) += 2
		}
		if ( rainy(cnt) == 0 ) {
			rainy(cnt) = rnd(windowh - inf_verh) - 6
		}
		else {
			rainy(cnt) += 16 + cnt \ 8
			if ( rainy(cnt) > windowh - inf_verh - 6 ) {
				rainy(cnt) = 0
				rainx(cnt) = 0
			}
		}
	loop
	weatherbk = gWeather
	return

*screen_hardRain
	if ( mField != MAP_FIELD_OUTDOOR ) {
		return
	}
	repeat maxrain * (1 + (mType == MAP_TYPE_WORLD))
		s_p = rnd(100)
		color 170 - s_p, 200 - s_p, 250 - s_p
		if ( gTimeStopTime != 0 ) {
			color 150, 150, 150
		}
		line rainx(cnt) - 40, rainy(cnt) - cnt \ 5 - 4, rainx(cnt) - 39 + cnt \ 2, rainy(cnt)
		if ( gTimeStopTime != 0 ) {
			continue
		}
		if ( rainx(cnt) == 0 ) {
			rainx(cnt) = rnd(windoww) + 40
		}
		else {
			rainx(cnt) += 1
		}
		if ( rainy(cnt) == 0 ) {
			rainy(cnt) = rnd(windowh - inf_verh) - 6
		}
		else {
			rainy(cnt) += 24 + cnt \ 8
			if ( rainy(cnt) > windowh - inf_verh - 10 ) {
				rainy(cnt) = 0
				rainx(cnt) = 0
			}
		}
	loop
	weatherbk = gWeather
	return

*screen_snow
	if ( mField != MAP_FIELD_OUTDOOR ) {
		return
	}
	color 0, 0, 0
	repeat maxrain * 2
		if ( cnt \ 30 == 0 ) {
			gmode 4, 8, 8, 100 + cnt \ 150
		}
		if ( gTimeStopTime == 0 ) {
			if ( rainy(cnt) == 0 | weatherbk != gWeather ) {
				rainy(cnt) = rnd(windowh / 2) * (-1)
				rainx(cnt) = rnd(windoww)
			}
			else {
				rainx(cnt) += rnd(3) - 1
				rainy(cnt) += rnd(2) + cnt \ 5
				if ( rainy(cnt) > windowh - inf_verh - 10 | rnd(500) == 0 ) {
					rainy(cnt) = 0
					rainx(cnt) = 0
				}
			}
		}
		pos rainx(cnt), rainy(cnt)
		gcopy BUFFER_INF, rainx(cnt) \ 2 * 8, 600 + cnt \ 6 * 8
	loop
	weatherbk = gWeather
	gmode 2
	return

*screen_ether
	if ( mField != MAP_FIELD_OUTDOOR ) {
		return
	}
	color 0, 0, 0
	repeat maxrain
		if ( cnt \ 20 == 0 ) {
			gmode 4, 8, 8, 100 + cnt \ 150
		}
		if ( rainy(cnt) <= 0 | weatherbk != gWeather ) {
			if ( gTimeStopTime != 0 ) {
				continue
			}
			rainy(cnt) = windowh - inf_verh - 8 - rnd(100)
			rainx(cnt) = rnd(windoww)
		}
		else {
			pos rainx(cnt), rainy(cnt)
			gcopy BUFFER_INF, 16 + rainx(cnt) \ 2 * 8, 600 + cnt \ 6 * 8
			if ( gTimeStopTime != 0 ) {
				continue
			}
			rainx(cnt) += rnd(3) - 1
			rainy(cnt) -= rnd(2) + cnt \ 5
		}
	loop
	weatherbk = gWeather
	gmode 2
	return

*screen_scroll
	if ( abs(cXnew(CHARA_PLAYER) - cX(CHARA_PLAYER)) > 1 ) {
		return
	}
	if ( abs(cYnew(CHARA_PLAYER) - cY(CHARA_PLAYER)) > 1 ) {
		return
	}
	scrollp = cfg_walkwait
	if ( mType == MAP_TYPE_WORLD ) {
		scrollp = 6
		keybd_wait = 1000
		if ( chipm(CHIPM_ROLE, mapId(cX(CHARA_PLAYER), cY(CHARA_PLAYER))) == MAP_CHIP_ROLE_SNOW ) {
			scrollp = 9
		}
	}
	else {
		if ( keybd_wait > cfg_startrun ) {
			scrollp = 3
			if ( cfg_runscroll == 0 ) {
				return
			}
			if ( keybd_wait >= 100000 ) {
				scrollp = 1
			}
		}
	}
	scxbk2 = scx
	scybk2 = scy
	scroll = 1
	gosub *label_1530
	scroll = 0
	scxbk = scx
	scybk = scy
	scx = scxbk2
	scy = scybk2
	scrollanime = 1
	if ( cfg_improvescroll ) {
		if ( keybd_wait < 100000 ) {
			scrollp = scrollp * 3 / 2 + 1
		}
	}
	repeat scrollp - 1, 1
		if ( cnt \ 2 == 1 ) {
			if ( gTimeStopTime == 0 ) {
				scrturn++
			}
		}
		redraw 0
		sxfix = (cXnew(CHARA_PLAYER) - cX(CHARA_PLAYER)) * cnt * inf_tiles / scrollp * (-1)
		syfix = (cYnew(CHARA_PLAYER) - cY(CHARA_PLAYER)) * cnt * inf_tiles / scrollp * (-1)
		gsel BUFFER_BUF
		pos 0, 0
		gmode 0
		gcopy BUFFER_SCREEN, 0, windowh - inf_verh, windoww, inf_tiles
		gsel BUFFER_SCREEN
		gmode 2
		gosub *los_draw
		gmode 0
		pos 0, windowh - inf_verh
		gcopy BUFFER_BUF, 0, 0, windoww, inf_tiles
		gmode 2
		gosub *screen_drawStatus
		gmode 2
		redraw 1
		await 40 / (cfg_improvescroll * 3 + 1)
	loop
	scrollanime = 0
	return

*label_1558
	gsel BUFFER_INF
	gmode 0
	repeat mHeight
		sy = cnt
		repeat mWidth
			sx = cnt
			sy(1) = 84 * sy / mHeight
			sx(1) = 120 * sx / mWidth
			pos 688 + sx(1), 528 + sy(1)
			gcopy BUFFER_MAP, mapId(sx, sy) \ 33 * inf_tiles + sx \ 16, mapId(sx, sy) / 33 * inf_tiles + sy \ 12, raderw, raderh
			pos 688 + sx(1), 528 + sy(1)
			gfini raderw, raderh
			if ( chipm(CHIPM_ATTRIB, mapId(sx, sy)) & CHIPM_ATTRIB_CANT_PASS ) {
				gfdec2 100, 100, 100
			}
		loop
	loop
	pos 688, 528
	gfini 130, 90
	gfinc 10, 10, 10
	gsel BUFFER_SCREEN
	return

*screen_drawRader
	sy(1) = 84 * sy / mHeight
	sx(1) = 120 * sx / mWidth
	pos inf_raderx + sx(1), inf_radery + sy(1)
	gcopy BUFFER_INF, 688 + sx(1), 528 + sy(1), raderw, raderh
	return

*screen_fadeIn
	gsel BUFFER_BUF
	gmode 0
	pos 0, 0
	gcopy BUFFER_SCREEN, 0, 0, windoww, windowh
	gsel BUFFER_SCREEN
	gmode 0
	repeat 50
		await 20
		redraw 0
		pos 0, 0
		gfini windoww, windowh
		gfdec2 5, 5, 5
		redraw 1
	loop
	color 500, 500, 500
	repeat 30
		gmode 4, 0, 0, 10 + cnt * 5
		await 20
		redraw 0
		pos 0, 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		redraw 1
	loop
	redraw 0
	gmode 2
	return

*screen_fadeOut
	repeat 50
		await 20
		redraw 0
		pos 0, 0
		gfini windoww, windowh
		gfdec2 5, 5, 5
		redraw 1
	loop
	redraw 0
	return

*label_1567
	repeat 30
		gmode 4, 0, 0, 10 + cnt * 5
		await 20
		redraw 0
		pos 0, 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		redraw 1
	loop
	redraw 0
	gmode 2
	return

*screen_drawEventFull
	redraw 0
	color 0, 0, 0
	boxf
	evx = 12
	evy = 14
	evscry = 40
	evtiles = 48
	evscrh = windowh / evtiles - 1
	evscrw = windoww / evtiles + 2
	gosub *screen_drawEventMap
	redraw 1
	return

*screen_drawEventMap
	repeat evscrh
		y = cnt
		dy = cnt + evy
		if ( dy >= mHeight ) {
			dy = mHeight
		}
		repeat evscrw
			x = cnt
			dx = cnt + evx
			if ( dx >= mWidth ) {
				dx = mWidth
			}
			pos x * evtiles, y * evtiles
			gmode 0, inf_tiles, inf_tiles
			ap = mapId(dx, dy)
			grotate BUFFER_MAP, ap \ 33 * inf_tiles, ap / 33 * inf_tiles, 0, evtiles, evtiles
		loop
	loop
	return

*fishing_draw
	fishdir = 0, 1, 3, 2
	fishdir = fishdir(cDir(CHARA_PLAYER))
	randomize cTurn(CHARA_PLAYER) / 3
	gmode 2
	if ( fishanime == 4 ) {
		sx = (fishx - scx) * inf_tiles + inf_screenx
		sy = (fishy - scy) * inf_tiles + inf_screeny
		if ( fishanime(1) > 15 ) {
			sx += (cX(CHARA_PLAYER) - fishx) * 8 * (fishanime(1) - 15)
			sy += (cY(CHARA_PLAYER) - fishy) * 8 * (fishanime(1) - 15) + fishanime(1)
			pos sx, sy - 44
			gcopy BUFFER_PIC2, 144 + fishanime(1) / 2 \ 2 * 48, 0, 48, 48
		}
		else {
			pos sx, sy - fishanime(1) * 3 + 14
			gcopy BUFFER_PIC2, 144 + fishanime(1) \ 2 * 48, 0, 48, limit(fishanime(1) * 5, 1, 48)
		}
		return
	}
	sx = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx + 20
	if ( fishdir == 1 ) {
		sx -= 48
	}
	if ( fishdir == 3 ) {
		sx += 48
	}
	sy = (cY(CHARA_PLAYER) - scy) * inf_tiles + inf_screeny + 20
	if ( fishdir == 0 ) {
		sy += 48
	}
	if ( fishdir == 2 ) {
		sy -= 48
	}
	ap = rnd(2)
	if ( fishanime == 1 ) {
		ap = fishanime(1)
	}
	else {
		if ( fishanime >= 2 ) {
			ap = 10
		}
	}
	pos sx, sy - 5 + ap
	gcopy BUFFER_PIC2, 116, 18, 14, 10 - ap
	sx = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx
	sy = (cY(CHARA_PLAYER) - scy) * inf_tiles + inf_screeny
	gmode 2, 48, 48
	if ( fishdir == 0 ) {
		sx2 = inf_tiles / 2 + rnd(3) - 1
		sy2 = inf_tiles / 2 + 12
		gmode 2, 48, 48
		pos sx + sx2 + 1, sy + sy2 + 40
		grotate BUFFER_PIC2, 48, 0, 0, 48, 48
	}
	if ( fishdir == 1 ) {
		sx2 = inf_tiles / 2 - 26
		sy2 = inf_tiles / 2 - 12 + rnd(3) - 3
		pos sx + sx2 - 16, sy + sy2 + 25
		grotate BUFFER_PIC2, 48, 0, 0, 48, 48
	}
	if ( fishdir == 2 ) {
		sx2 = inf_tiles / 2 + rnd(3) + 1
		sy2 = inf_tiles / 2 - 46
	}
	if ( fishdir == 3 ) {
		sx2 = inf_tiles / 2 + 26
		sy2 = inf_tiles / 2 - 12 + rnd(3) - 3
		pos sx + sx2 + 14, sy + sy2 + 25
		grotate BUFFER_PIC2, 48, 0, 0, 48, 48
	}
	if ( fishdir == 2 ) {
		gmode 2, 48, 24
		pos sx + sx2, sy + sy2
		grotate BUFFER_PIC2, 0, 24, 0.5 * fishdir * 3.14, 48, 24
	}
	else {
		gmode 2, 48, 48
		pos sx + sx2, sy + sy2
		grotate BUFFER_PIC2, 0, 0, 0.5 * fishdir * 3.14, 48, 48
	}
	randomize
	return

#defcfunc magiclv
	a = 0
	repeat 67
		if ( cnt != 26 & cnt != 27 ) {
			if ( sdata(1000 + cnt, CHARA_PLAYER) < 2000000000 ) {
				a = 1
				break
			}
		}
	loop
	if ( a == 1 ) {
		a = 0
		return 0
	}
	return 1

#defcfunc carmor int carmor_arg1
	if ( cEqWeight(carmor_arg1) >= EQUIP_WEIGHT_CLASS_HEAVY ) {
		return 169
	}
	else {
		if ( cEqWeight(carmor_arg1) >= EQUIP_WEIGHT_CLASS_MEDIUM ) {
			return 170
		}
		else {
			return 171
		}
	}

#defcfunc cnveqweight int cnveqweight_arg1
	if ( cEqWeight(cnveqweight_arg1) >= EQUIP_WEIGHT_CLASS_HEAVY ) {
		return lang("(重装備)", "(Heavy)")
	}
	else {
		if ( cEqWeight(cnveqweight_arg1) >= EQUIP_WEIGHT_CLASS_MEDIUM ) {
			return lang("(中装備)", "(Medium)")
		}
		else {
			return lang("(軽装備)", "(Light)")
		}
	}

#defcfunc getgametime
	return gHour  + gDay  * 24 + gMonth  * 24 * 30 + gYear  * 24 * 30 * 12

#defcfunc limitaddition int limitaddition_prm0, int limitaddition_prm1
	if ( limitaddition_prm0 > 2147483647 - limitaddition_prm1 ) {
		return 2147483647
	}
	else {
		return limitaddition_prm0 + limitaddition_prm1
	}

#defcfunc calcexpalive int calcexpalive_arg1
	return calcexpalive_arg1 * 100

*label_1581
	cBodySpdFix(r1) = 0
	repeat 30, 100
		if ( cdata(cnt, r1) != 0 ) {
			cBodySpdFix(r1)++
		}
	loop
	if ( cBodySpdFix(r1) > 13 ) {
		cBodySpdFix(r1) = (cBodySpdFix(r1) - 13) * 5
	}
	else {
		cBodySpdFix(r1) = 0
	}
	return
	goto *calcBodyGain

#defcfunc findemptybodypartslot int findemptybodypartslot_prm0
	locvar_calcexpalive_slot = -1
	repeat 30, 100
		if ( cdata(cnt, findemptybodypartslot_prm0) == 0 ) {
			locvar_calcexpalive_slot = cnt
			break
		}
	loop
	return locvar_calcexpalive_slot

#defcfunc selectnewbodypartatrandom
	locvar_calcexpalive_bodyparts = 1, 2, 3, 5, 6, 7, 8, 9
	return locvar_calcexpalive_bodyparts(rnd(length(locvar_calcexpalive_bodyparts)))

*calcBodyGain
	locvar_calcexpalive_newslot = findemptybodypartslot(r1)
	if ( locvar_calcexpalive_newslot == (-1) ) {
		return
	}
	locvar_calcexpalive_newbodypart = selectnewbodypartatrandom()
	cdata(locvar_calcexpalive_newslot, r1) = locvar_calcexpalive_newbodypart * 10000
	if ( cm == 0 ) {
		txt -1, lang(name(r1) + "の身体から新たな" + bodyn(locvar_calcexpalive_newbodypart) + "が生えてきた！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(locvar_calcexpalive_newbodypart) + "!")
	}
	gosub *label_1581
	return

*label_1588
	cExp(r1) -= cExpToNext(r1)
	if ( cExp(r1) < 0 ) {
		cExp(r1) = 0
	}
	cLevel(r1)++
	if ( cRole(r1) != ROLE_ADVENTURER ) {
		if ( r2 == 0 ) {
			txtef COLOR_GREEN
			if ( r1 == 0 ) {
				txt -1, lang(name(r1) + "はレベル" + cLevel(r1) + "になった！", name(r1) + " have gained a level.")
			}
			else {
				txt -1, lang(name(r1) + "は成長した。", name(r1) + " " + have(r1) + " grown up.")
			}
		}
	}
	else {
		addnews 2, r1
	}
	if ( cLevel(r1) \ 5 == 0 ) {
		if ( cLevelOrg(r1) < cLevel(r1) ) {
			if ( cLevel(r1) <= 50 ) {
				if ( r1 == 0 ) {
					gTraitPoint++
				}
				else {
					if ( petcheck(r1) ) {
						ocFeatsAcquirable(r1)++
					}
				}
			}
		}
	}
	if ( r1 == 0 ) {
		gosub *label_1688
	}
	chara_gainskillbonus r1
	if ( cnRace(r1) == "mutant" | gettrait(r1, 0) == 1 ) {
		if ( cLevel(r1) < 37 ) {
			if ( cLevel(r1) \ 3 == 0 ) {
				if ( cLevelOrg(r1) < cLevel(r1) ) {
					gosub *calcBodyGain
				}
			}
		}
	}
	if ( cLevelOrg(r1) < cLevel(r1) ) {
		cLevelOrg(r1) = cLevel(r1)
	}
	if ( r1 >= 56 & cRole(r1) != ROLE_PET_SENTRY & cRole(r1) != ROLE_PET_MAID & eqfaction(r1, "petshop") == 0 ) {
		gosub *calcPowerUp
	}
	gosub *label_1592
	gosub *charaRefresh
	if ( r1 < 16 ) {
		throwsstpevent "LevelUp", r1, "", 0
	}
	return

*calcPowerUp
	repeat 20 - 10, 10
		sdata(cnt + STARTING_SKILL_SPACT, r1) = limit(sdata(cnt + STARTING_SKILL_SPACT, r1) + 1000000 * rnd(3), 1, 2000 * 1000000)
	loop
	repeat length(mainskill)
		sdata(mainskill(cnt) + STARTING_SKILL_SPACT, r1) = limit(sdata(mainskill(cnt) + STARTING_SKILL_SPACT, r1) + 1000000 * rnd(3), 1, 2000 * 1000000)
	loop
	return

*label_1592
	cExpToNext(r1) = limit(cLevel(r1), 1, 200) * (limit(cLevel(r1), 1, 200) + 1) * (limit(cLevel(r1), 1, 200) + 2) * (limit(cLevel(r1), 1, 200) + 3) + 3000
	if ( cExpToNext(r1) > 100000000 | cExpToNext(r1) < 0 ) {
		cExpToNext(r1) = 100000000
	}
	return

*label_1593
	skillexp2 SKILL_NORMAL_MINING, CHARA_PLAYER, 100
	return

*label_1594
	skillexp2 SKILL_NORMAL_LITERACY, cc, (10 + skillDiff(efid) / 60) * r4, 10, 100
	return

*label_1595
	if ( r2 >= (sTrade(r1) + 10) * (sTrade(r1) + 10) ) {
		skillexp2 SKILL_NORMAL_NEGOTIATION, r1, limit(r2 * r2 / (sTrade(r1) * 5 + 10), 10, 1000), 10
	}
	return

*label_1596
	skillexp2 SKILL_NORMAL_LOCK_PICKING, r1, 100 + limitmax(r2 * 3 / 2, 3000)
	return

*label_1597
	skillexp2 SKILL_NORMAL_DETECTION, cc, gLevel  * 2 + 20
	return

*label_1598
	if ( r1 == 0 ) {
		if ( r2 >= 550 & r2 <= 599 ) {
			userspellexp r2 - 550, r1, skillCost(r2) / 3 + 20, 4, 5
			skillexp2 SKILL_NORMAL_CASTING, r1, skillCost(r2) / 12 + 10, 5
		}
		else {
			skillexp2 r2, r1, skillCost(r2) * 4 + 20, 4, 5
			skillexp2 SKILL_NORMAL_CASTING, r1, skillCost(r2) + 10, 5
		}
	}
	else {
		skillexp2 SKILL_NORMAL_CASTING, r1, skillCost(r2) + 10, 5
	}
	return

*label_1599
	skillexp2 SKILL_NORMAL_MAGIC_CAPACITY, r1, abs(cMP(r1)) * 200 / (cMMP(r1) + 1)
	return

*label_1600
	if ( cHP(r1) != cMHP(r1) ) {
		if ( sHealing(r1) < sEND(r1) ) {
			skillexp2 SKILL_NORMAL_HEALING, r1, 5 + sHealing(r1) / 5, 1000
		}
	}
	if ( cMP(r1) != cMMP(r1) ) {
		if ( sMeditation(r1) < sMAG(r1) ) {
			skillexp2 SKILL_NORMAL_MEDITATION, r1, 5 + sMeditation(r1) / 5, 1000
		}
	}
	return

*label_1601
	if ( mType == MAP_TYPE_WORLD ) {
		if ( rnd(20) ) {
			return
		}
	}
	skillexp2 SKILL_NORMAL_STEALTH, r1, 2, 0, 1000
	return
	if ( mType == MAP_TYPE_WORLD ) {
		if ( rnd(20) ) {
			return
		}
	}
	skillexp2 SKILL_ACTIVE_RIDING, cc, 2, 0, 1000
	return

*label_1602
	skillexp2 SKILL_NORMAL_INVESTING, CHARA_PLAYER, 600
	return

*label_1603
	skillexp2 SKILL_NORMAL_PERFORMER, cc, r1, 0, 0
	return

*label_1604
	if ( r2 == 0 ) {
		return
	}
	if ( mType == MAP_TYPE_WORLD ) {
		if ( rnd(20) ) {
			return
		}
	}
	skillexp2 SKILL_NORMAL_WEIGHT_LIFTING, r1, r2 * 4, 0, 1000
	return

*label_1605
	skillexp2 SKILL_NORMAL_MAGIC_DEVICE, cc, 40
	return

*label_1606
	skillexp2 SKILL_NORMAL_FISHING, cc, 100 + r1 * 5
	return

*label_1607
	skillexp2 SKILL_NORMAL_MEMORIZATION, cc, (10 + skillDiff(efid) / 5) * r4
	return

*label_1608
	skillexp2 r1, cc, 50 + r2
	return

#defcfunc calcattackhit int calcattackhit_arg1
	critical = 0
	if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
		tohitorg = sDEX(cc) / 5 + sSTR(cc) / 2 + sdata(attackskill, cc) + 50
		tohitfix = sDEX(cc) / 5 + sSTR(cc) / 10 + cATK(cc)
		pierce = limit(sdata(attackskill, cc) / 5, 5, 50)
		if ( cAttackStyle(cc) & 1 ) {
			tohitorg = tohitorg * 100 / 130
		}
	}
	else {
		tohitorg = sDEX(cc) / 4 + refattackskill(iSkillRef(cw), cc) / 3 + refattackskill(attackskill, cc) + 50
		tohitfix = cATK(cc) + iAtk(cw)
		if ( ammo != (-1) ) {
			tohitfix += iAtk(ammo)
		}
		calcweaponfix iID(cw), cw
		if ( attackskill == SKILL_WEAPON_CROSSBOW ) {
			pierce += limit((sdata(attackskill, cc) - 500) / 10, 5, 200)
		}
		else {
			if ( attackskill == SKILL_WEAPON_BOW ) {
				if ( gettrait(cc, 85) ) {
					tohitfix += int(sqrt(sBow(cc)) + calc3traitmulti(stat, sBow(cc)))
				}
				if ( gettrait(cc, 66) ) {
					if ( stat == 3 ) {
						repeat 5, 5
							rangemap_pow(cnt) += 50
							rangemap_hit(cnt) += 50
						loop
					}
					else {
						if ( stat == 2 ) {
							repeat 5, 5
								rangemap_pow(cnt) += 30
								rangemap_hit(cnt) += 30
							loop
						}
						else {
							repeat 5, 5
								rangemap_pow(cnt) += 10
								rangemap_hit(cnt) += 10
							loop
						}
					}
				}
			}
			else {
				if ( attackskill == SKILL_WEAPON_THROWING ) {
					if ( gettrait(cc, 87) ) {
						if ( stat == 3 ) {
							repeat 2, 2
								rangemap_pow(cnt) += 30
								rangemap_hit(cnt) += 30
							loop
						}
						else {
							if ( stat == 2 ) {
								rangemap_pow(2) += 30
								rangemap_hit(2) += 30
								rangemap_pow(3) += 10
								rangemap_hit(3) += 10
							}
							else {
								rangemap_pow(2) += 10
								rangemap_hit(2) += 10
							}
						}
					}
				}
			}
		}
	}
	if ( nc_gettrait(cc, 103) > 0 ) {
		repeat 10
			rangemap_pow(cnt) = limitmin(rangemap_pow(cnt), 100)
		loop
	}
	if ( nc_gettrait(cc, 104) > 0 ) {
		repeat 10
			rangemap_hit(cnt) = limitmin(rangemap_hit(cnt), 100)
		loop
	}
	tohit = tohitorg + tohitfix
	if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
		if ( attackrange ) {
			if ( calcattackhit_arg1 == 0 ) {
				rangedist = limit(dist(cX(cc), cY(cc), cX(tc), cY(tc)) - 1, 0, 9)
				tohit = tohit * rangemap_hit(rangedist) / 100
			}
		}
		else {
			if ( cAttackStyle(cc) & 2 ) {
				tohit += 25
				if ( iWeight(cw) >= 4000 ) {
					tohit += sTwoHand(cc)
				}
			}
			if ( cAttackStyle(cc) & 4 ) {
				if ( attacknum == 1 ) {
					if ( iWeight(cw) >= 4000 ) {
						tohit -= (iWeight(cw) - 4000 + 400) / (10 + sTwoWield(cc) / 5)
					}
				}
				else {
					if ( iWeight(cw) > 1500 + gettrait(cc, 19) * 500 ) {
						tohit -= (iWeight(cw) - 1500 + 100) / (10 + sTwoWield(cc) / 5)
					}
				}
			}
		}
	}
	if ( gRider != 0 | ocPetRidingIdx(cc) != 0 | ocPetBeingRiddenIdx(cc) != 0 ) {
		if ( cc == CHARA_PLAYER | ocPetRidingIdx(cc) != 0 ) {
			tohit = tohit * 100 / limit(150 - sRiding(cc) / 2, 115, 150)
			if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
				if ( attackrange == 0 ) {
					if ( iWeight(cw) >= 4000 ) {
						tohit -= (iWeight(cw) - 4000 + 400) / (10 + sRiding(cc) / 5)
					}
				}
			}
		}
		if ( cc == gRider | ocPetBeingRiddenIdx(cc) != 0 ) {
			tohit = tohit * 100 / limit(150 - sSTR(cc) / 2, 115, 150)
			if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
				if ( attackrange == 0 ) {
					if ( iWeight(cw) >= 4000 ) {
						tohit -= (iWeight(cw) - 4000 + 400) / (10 + sSTR(cc) / 10)
					}
				}
			}
		}
	}
	if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
		if ( attacknum > 1 ) {
			twohit = 100 - (attacknum - 1) * (10000 / (100 + sTwoWield(cc) * 10))
			if ( tohit > 0 ) {
				tohit = tohit * twohit / 100
			}
		}
	}
	if ( calcattackhit_arg1 == 1 ) {
		return tohit
	}
	evade = sPER(tc) / 3 + sEvade(tc) + cDV(tc) + 25
	if ( calcattackhit_arg1 == 2 ) {
		return evade
	}
	if ( cDim(tc) != 0 ) {
		if ( rnd(4) == 0 ) {
			critical = 1
			return 1
		}
		evade /= 2
	}
	if ( cBlind(cc) != 0 ) {
		tohit /= 2
	}
	if ( cBlind(tc) != 0 ) {
		evade /= 2
	}
	if ( cSleep(tc) != 0 | cdata(268, tc) != 0 ) {
		return 1
	}
	if ( multicritical ) {
		critical = 1
		return 1
	}
	if ( cConfuse(cc) != 0 | cDim(cc) != 0 ) {
		if ( attackrange ) {
			tohit /= 5
		}
		else {
			tohit = tohit / 3 * 2
		}
	}
	if ( sEvadePlus(tc) - sEvadePlus(cc) > 0 ) {
		if ( tohit < (sEvadePlus(tc) - sEvadePlus(cc)) * 10 ) {
			evaderef = evade * 100 / limit(tohit, 1, tohit)
			if ( evaderef > 300 ) {
				if ( rnd(sEvadePlus(tc) - sEvadePlus(cc) + 250) > 100 ) {
					return -2
				}
			}
			if ( evaderef > 200 ) {
				if ( rnd(sEvadePlus(tc) - sEvadePlus(cc) + 250) > 150 ) {
					return -2
				}
			}
			if ( evaderef > 150 ) {
				if ( rnd(sEvadePlus(tc) - sEvadePlus(cc) + 250) > 200 ) {
					return -2
				}
			}
		}
	}
	if ( rnd(5000) < sPER(cc) + 50 ) {
		critical = 1
		return 1
	}
	if ( cCritChance(cc) > rnd(200) | findbuff(cc, 87) != (-1) ) {
		critical = 1
		return 1
	}
	if ( rnd(20) == 1 ) {
		return -1
	}
	if ( rnd(20) == 0 ) {
		return 1
	}
	if ( tohit < 1 ) {
		return -1
	}
	if ( evade < 1 ) {
		return 1
	}
	if ( rndex(tohit) > rndex(evade * 3 / 2) ) {
		return 1
	}
	return -1

#defcfunc calcattackdmg int calcattackdmg_arg1
	if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
		dmgfix = sSTR(cc) / 8 + sMartial(cc) / 8 + cDMG(cc)
		dice1 = 2
		dice2 = sMartial(cc) / 8 + 5
		dmgmulti = 0.5 + double(sSTR(cc) + sdata(attackskill, cc) / 5 + ctype (cc) * 2) / 40
	}
	else {
		dmgfix = cDMG(cc) + iDmg(cw) + (iStatus(cw) == ITEM_STATUS_BLESSED)
		dice1 = iDice1(cw)
		dice2 = iDice2(cw)
		if ( ammo != (-1) ) {
			dmgfix += iDmg(ammo) + iDice1(ammo) * iDice2(ammo) / 2
			if ( iID(cw) == ITEM_ID_SHORT_BOW ) {
				p(62) = 152
			}
			else {
				p(62) = 189
			}
			dmgmulti = 0.5 + double(sPER(cc) + calcattackskil(sdata(attackskill, cc) / 4, ammo) + calcattackskil(sdata(iSkillRef(cw), cc), cw) + calcattackskil(sdata(attackskill, cc), cw) + sdata(p(62), cc) * 3 / 2) / 40
		}
		else {
			dmgmulti = 0.6 + double(sSTR(cc) + calcattackskil(refattackskill(iSkillRef(cw), cc), cw) + calcattackskil(refattackskill(attackskill, cc), cw) + ctype (cc) * 2) / 45
		}
	}
	if ( attackrange ) {
		if ( calcattackdmg_arg1 == 0 ) {
			if ( efid == 762 ) {
				dmgmulti = dmgmulti * double(cPiety(cc) * 3 / 10000)
			}
			else {
				if ( efid == 766 ) {
					dmgmulti = dmgmulti * double(rounds * double(cPiety(cc)) * 3 / 10000)
				}
			}
			dmgmulti = dmgmulti * rangemap_pow(rangedist) / 100
		}
	}
	else {
		locvar_refreshspeed_f = carmor(cc)
		if ( locvar_refreshspeed_f == 169 ) {
			dmgmulti += dmgmulti / (5 + (cc != CHARA_PLAYER) * 10)
		}
		if ( locvar_refreshspeed_f == 170 ) {
			dmgmulti += dmgmulti / (10 + (cc != CHARA_PLAYER) * 20)
		}
		if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( cAttackStyle(cc) & 2 ) {
				if ( iWeight(cw) >= 4000 ) {
					dmgmulti *= 1.5
				}
				else {
					dmgmulti *= 1.2
				}
				dmgmulti += 0.03 * sTwoHand(cc)
			}
		}
		else {
			if ( gettrait(cc, 20) ) {
				dmgmulti += calc5traitmulti(stat, dmgmulti)
			}
		}
	}
	if ( gettrait(cc, 207) ) {
		dmgfix += sqrt(cLevel(cc)) + limitmax(cLevel(cc), 10000) * 2 / 3
	}
	if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
		if ( attackskill >= SKILL_WEAPON_LONGSWORD & attackskill <= SKILL_WEAPON_THROWING ) {
			if ( gettrait(cc, attackskill - 54) ) {
				dmgmulti += calc5traitmulti(stat, dmgmulti)
			}
		}
	}
	if ( findbuff(cc, 84) != (-1) ) {
		if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( iID(cw) == ITEM_ID_LIGHTSABRE ) {
				dmgfix += ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + findbuff(cc, 84) * 3 + 1, cc) / 10000
			}
		}
	}
	if ( findbuff(cc, 96) != (-1) ) {
		if ( attackskill == SKILL_WEAPON_SHORTSWORD ) {
			dmgfix += limitmax(ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + findbuff(cc, 96) * 3 + 1, cc) / 200, 500)
		}
	}
	if ( calcattackdmg_arg1 == 1 ) {
		return damage
	}
	prot = cPV(tc) + sdata(carmor(tc), tc) + sDEX(tc) / 10
	if ( prot > 0 ) {
		prot2 = prot / 4
		protdice1 = prot2 / 10 + 1
		if ( protdice1 < 0 ) {
			protdice1 = 1
		}
		protdice2 = prot2 / protdice1 + 2
		protfix = 0
	}
	else {
		prot2 = 0
		protdice1 = 1
		protdice2 = 1
		protfix = 0
		prot = 0
	}
	if ( calcattackdmg_arg1 == 2 ) {
		return prot
	}
	if ( dmgfix < (-100) ) {
		dmgfix = -100
	}
	if ( efid == 771 ) {
		dmgmulti = dmgmulti * double(limitmin((cMHP(cc) * (cPiety(cc) / EXT_EQUIP_SLOTS) - cHP(cc)) / 30, 1))
	}
	else {
		if ( efid == 773 ) {
			dmgfix = dmgmulti * double(cPiety(cc) * 3 / 10000)
		}
	}
	if ( efid == 918 ) {
		efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
		dmgfix = role(dice1, dice2, dmgfix) * 3
	}
	if ( efid == 931 ) {
		efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
		dice1 += dice1 * 0.1 * iQuality(cw)
		dice2 += dice1 * 0.1 * iQuality(cw)
		dmgfix += dmgfix * 0.2 * iQuality(cw)
	}
	if ( efid == 932 ) {
		efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
		dice1 = dice1 / 2 + 1
		dice2 = dice2 / 2 + 1
	}
	if ( cSleep(tc) > 0 ) {
		if ( gettrait(cc, 96) ) {
			dmgmulti = dmgmulti * double(1 + calctraitscore(stat))
		}
	}
	lint_damage = pluginFunction(role(dice1, dice2, dmgfix))
	if ( critical ) {
		lint_damage = pluginFunction(rolemax(dice1, dice2, dmgfix))
		if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
			pierce += calcknucklepierce(cc)
			dmgmulti *= 1.25
		}
		else {
			if ( ammo != (-1) ) {
				dmgmulti = dmgmulti * limit(iWeight(ammo) / 100 + 100, 100, 150) / 100
			}
			else {
				dmgmulti = dmgmulti * limit(iWeight(cw) / 200 + 100, 100, 150 + calcweightmulti(cc)) / 100
			}
		}
		if ( nc_gettrait(cc, 100) > 0 ) {
			dmgmulti *= 1.5
		}
	}
	lint_damage = dmgmulti * lint_damage
	if ( lint_damage > 2000000000 ) {
		lint_damage = 2000000000
	}
	if ( cc == CHARA_PLAYER ) {
		if ( ogTitleLeer == 2 ) {
			if ( rnd(30) == 0 ) {
				prot /= 2
				txtef COLOR_YELLOW
				txt -1, lang(" *キッ* ", " *leer* ")
			}
		}
	}
	if ( oabit(8, gArea ) ) {
		return 0
	}
	if ( cVopalChance(cc) > rnd(100) ) {
		pierce += 100
		if ( synccheck(cc, -1) ) {
			ctalk cc, 1345, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_YELLOW
				txt -1, lang(" *シャキーン* ", "*vopal*")
			}
		}
	}
	if ( attackrange == 1 ) {
		if ( ammoproc == ENCHANT_AMMO_PIERCING ) {
			pierce += 60
			if ( synccheck(cc, -1) ) {
				ctalk cc, 1346, cc, tc
				if ( stat == 0 ) {
					txtef COLOR_YELLOW
					txt -1, lang(" *ズバシュッ* ", "*vopal*")
				}
			}
		}
		if ( ammoprocbk == 0 ) {
			lint_damage /= 2
		}
		if ( ammoprocbk == 5 ) {
			lint_damage /= 3
		}
		if ( ammoproc == ENCHANT_AMMO_MAGIC ) {
			lint_damage /= 10
		}
	}
	pierce += calcpiercefix(attackskill, cc, tc, cw)
	if ( gettrait(cc, 60) == 1 ) {
		s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
		if ( instr(s, 0, "/wild/") != (-1) ) {
			pierce += 20
		}
	}
	if ( gettrait(cc, 61) == 1 ) {
		s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
		if ( instr(s, 0, "/demon/") != (-1) ) {
			pierce += 20
		}
	}
	if ( gettrait(cc, 98) == 1 ) {
		s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
		if ( instr(s, 0, "/element/") != (-1) ) {
			pierce += 20
		}
	}
	if ( findbuff(cc, 84) != (-1) ) {
		if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( iID(cw) == ITEM_ID_LIGHTSABRE ) {
				pierce = 200
			}
		}
	}
	damagepierce = limitmax(lint_damage * pierce / 200, 2000000000)
	damagenormal = limitmax(lint_damage - absf(damagepierce), 2000000000)
	if ( prot > 0 ) {
		damagenormal = damagenormal * 100 / (100 + prot) - role(protdice1, protdice2, protfix)
		if ( damagenormal < 0.0 ) {
			damagenormal = 0.0
		}
	}
	lint_damage = damagenormal
	if ( damagepierce > 0 ) {
		lint_damage += damagepierce
	}
	if ( gettrait(tc, 164) != 0 ) {
		lint_damage = lint_damage * 95 / 100
	}
	if ( cResDamage(tc) != 0 ) {
		lint_damage = lint_damage * 100 / limit(100 + cResDamage(tc), 25, 1000)
	}
	if ( lint_damage < 0.0 ) {
		lint_damage = 0.0
	}
	if ( ogTitleAreus == 2 ) {
		overdamage = 0
		if ( lint_damage > 20000000 ) {
			overdamage = limit(lint_damage - 20000000, 0, 1980000000)
		}
		orgdmg = limit(lint_damage, 0, 2000000000)
	}
	else {
		orgdmg = limit(lint_damage, 0, 20000000)
	}
	return limit(lint_damage, 0, 20000000)

#deffunc cnvbonus int cnvbonus_arg1, int cnvbonus_arg2
	if ( cnvbonus_arg1 >= 50 & cnvbonus_arg1 < 61 ) {
		if ( cnvbonus_arg2 > 0 ) {
			buff += "　　" + skillname(cnvbonus_arg1) + "耐性に <green>クラス" + cnvbonus_arg2 / 50 + "<col>(" + cnvbonus_arg2 + ") のボーナス\n"
		}
		if ( cnvbonus_arg2 < 0 ) {
			buff += "　　" + skillname(cnvbonus_arg1) + "耐性に <red>クラス" + cnvbonus_arg2 / 50 + "<col>(" + cnvbonus_arg2 + ") のマイナス修正\n"
		}
	}
	else {
		if ( cnvbonus_arg2 > 0 ) {
			buff += "　　" + skillname(cnvbonus_arg1) + "に <green>+" + cnvbonus_arg2 + "<col> のボーナス\n"
		}
		if ( cnvbonus_arg2 < 0 ) {
			buff += "　　" + skillname(cnvbonus_arg1) + "に <red>" + cnvbonus_arg2 + "<col> のマイナス修正\n"
		}
	}
	return

*charaRefresh
	chararefreshhack = TRUE
	if ( r1 == 0 ) {
		gTravelSpeed = 0
		gEtherSpeed = 0
		gResEtherWind = 0
		gResWeather = 0
		gLight = 70
		gGodTalk = 0
		gGodDetect = 0
	}
	repeat 600
		sdata(cnt, r1) = sorgex(cnt, r1)
	loop
	if ( cRaceId(r1) == 0 ) {
		gosub *label_3896
	}
	if ( r1 == 0 & have_bigench(0, 6) == 0 ) {
		if ( ocStress(0) >= 2000 ) {
			if ( ocStress(0) < 4000 ) {
				p(45) = 1
			}
			else {
				if ( ocStress(0) < 6000 ) {
					p(45) = 3
				}
				else {
					p(45) = 5
				}
			}
			repeat 8, 10
				sdata(cnt, CHARA_PLAYER) -= sdata(cnt, CHARA_PLAYER) * p(45) / 10
			loop
		}
		memset cdata(STARTING_CDATA_CHARA_BIT, r1), 0, 30 * 4
	}
	else {
		if ( cId(r1) == CREATURE_ID_USER ) {
			memcpy cdata(STARTING_CDATA_CHARA_BIT, r1), userdata(40, cUNID(r1)), 30 * 4
		}
		else {
			if ( cId(r1) != CREATURE_ID_GOD_INSIDE_EHEKATL ) {
				memcpy cdata(STARTING_CDATA_CHARA_BIT, r1), cbitorg(0, cId(r1)), 30 * 4
			}
			else {
				if ( ocbit(7, r1) == 0 ) {
					memcpy cdata(STARTING_CDATA_CHARA_BIT, r1), cbitorg(0, cId(r1)), 30 * 4
				}
			}
		}
	}
	if ( gettrait(r1, 161) != 0 ) {
		repeat 30, 100
			dup roopbuf, cdata(cnt, r1)
			if ( roopbuf \ 10000 == 0 ) {
				continue
			}
			rp = roopbuf \ 10000 - 1
			if ( iWeight(rp) >= 1000 ) {
				roopbuf = roopbuf / 10000 * 10000
				iEquip(rp) = 0
			}
		loop
	}
	repeat 10
		if ( racebit(cnt, cRaceId(r1)) == 0 ) {
			break
		}
		cbitmod racebit(cnt, cRaceId(r1)), r1, TRUE
	loop
	repeat 10, 10
		cdata(STARTING_CDATA_FOOD_EXP + cnt - 10, r1) = 0
	loop
	nc_armorbonus = nc_gettrait(r1, 102)
	nc_armorcount = 0
	cDV(r1) = 0
	cPV(r1) = 0
	cATK(r1) = 0
	cDMG(r1) = 0
	cAttackStyle(r1) = STYLE_NONE
	attacknum = 0
	cVopalChance(r1) = 0
	cCritChance(r1) = 0
	cCurse(r1) = 0
	cExtraMelee(r1) = 0
	cExtraShoot(r1) = 0
	cEqWeight(r1) = 0
	cResDamage(r1) = 0
	cImmuneDamage(r1) = 0
	cReflectDamage(r1) = 0
	cdata(266, r1) = 0
	cdata(267, r1) = 0
	if ( findbuff(r1, 63) != (-1) ) {
		cImmuneDamage(r1) = 50
	}
	p(69) = 1
	nc_intb_noench = findbuff(r1, 62)
	repeat 30, 100
		dup roopbuf, cdata(cnt, r1)
		if ( roopbuf \ 10000 == 0 ) {
			continue
		}
		rp = roopbuf \ 10000 - 1
		nc_intb_bigench = check_bigench(rp)
		cEqWeight(r1) += iWeight(rp)
		if ( iSkillRef(rp) == SKILL_NORMAL_SHIELD ) {
			if ( cAttackStyle(r1) & 1 ) {
			}
			else {
				cAttackStyle(r1) += 1
			}
		}
		if ( nc_armorbonus > 0 ) {
			nc_armorcount += 1
		}
		cDV(r1) += iDV(rp)
		cPV(r1) += iPV(rp)
		if ( iDice1(rp) == 0 ) {
			cATK(r1) += iAtk(rp)
			cDMG(r1) += iDmg(rp)
			if ( gettrait(0, 194) < 0 ) {
				if ( r1 < 56 ) {
					cPV(r1) += iLevel(rp) * 1 + (iStatus(rp) == ITEM_STATUS_BLESSED) * 2
				}
				else {
					cPV(r1) += iLevel(rp) * 3 + (iStatus(rp) == ITEM_STATUS_BLESSED) * 2
				}
			}
			else {
				cPV(r1) += iLevel(rp) * 2 + (iStatus(rp) == ITEM_STATUS_BLESSED) * 2
			}
			if ( check_bigench(rp) != 1 ) {
				p(69) = 0
			}
			if ( ibit(ITEM_BIT_LOVE_BLEND, rp) ) {
				cdata(266, r1)++
			}
		}
		else {
			if ( roopbuf / 10000 == 5 ) {
				attacknum++
			}
		}
		if ( iStatus(rp) == ITEM_STATUS_CURSED ) {
			cCurse(r1) += 20
		}
		if ( iStatus(rp) == ITEM_STATUS_DOOMED ) {
			cCurse(r1) += 100
		}
		if ( iMaterial(rp) == ITEM_MATERIAL_ETHER ) {
			if ( r1 == 0 ) {
				gEtherSpeed += 5
			}
		}
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, rp) == 0 ) {
				break
			}
			rp2 = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, rp)
			dup roopbuf, inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, rp)
			if ( rp2 >= 10000 ) {
				rp3 = rp2 \ 10000
				rp2 = rp2 / 10000
				if ( nc_intb_noench == (-1) | nc_intb_bigench == 3 ) {
					if ( rp2 == 1 ) {
						sdata(rp3, r1) += roopbuf / 50 + 1
						continue
					}
					if ( rp2 == 2 ) {
						sdata(rp3, r1) += roopbuf / 2
						if ( sdata(rp3, r1) < 0 ) {
							sdata(rp3, r1) = 1
						}
						if ( gettrait(0, 194) < 0 ) {
							if ( r1 < 56 ) {
								if ( sdata(rp3, r1) > 400 ) {
									sdata(rp3, r1) = 400
								}
							}
						}
						continue
					}
					if ( rp2 == 3 ) {
						if ( sorg(rp3, r1) != 0 ) {
							sdata(rp3, r1) += roopbuf / 50 + 1
							if ( sdata(rp3, r1) < 1 ) {
								sdata(rp3, r1) = 1
							}
						}
						continue
					}
				}
			}
			else {
				if ( nc_intb_noench == (-1) | nc_intb_bigench == 3 ) {
					if ( rp2 == 56 ) {
						if ( r1 == 0 ) {
							gGodTalk = 1
							continue
						}
					}
					if ( rp2 == 59 ) {
						if ( r1 == 0 ) {
							gGodDetect = 1
							continue
						}
					}
					if ( rp2 == 29 ) {
						sSPD(r1) += roopbuf / 50 + 1
						if ( r1 == 0 ) {
							gTravelSpeed += roopbuf / 8
							continue
						}
					}
					if ( rp2 == 32 ) {
						cbitmod CHARA_BIT_FLOAT, r1, TRUE
						continue
					}
					if ( rp2 == 35 ) {
						cbitmod CHARA_BIT_SEE_INVISIBLE, r1, TRUE
						continue
					}
					if ( rp2 == 23 ) {
						cbitmod CHARA_BIT_RES_BLIND, r1, TRUE
						continue
					}
					if ( rp2 == 24 ) {
						cbitmod CHARA_BIT_RES_PARALYZE, r1, TRUE
						continue
					}
					if ( rp2 == 25 ) {
						cbitmod CHARA_BIT_RES_CONFUSE, r1, TRUE
						continue
					}
					if ( rp2 == 26 ) {
						cbitmod CHARA_BIT_RES_FEAR, r1, TRUE
						continue
					}
					if ( rp2 == 27 ) {
						cbitmod CHARA_BIT_RES_SLEEP, r1, TRUE
						continue
					}
					if ( rp2 == 28 ) {
						cbitmod CHARA_BIT_RES_POISON, r1, TRUE
						continue
					}
					if ( rp2 == 42 ) {
						cbitmod CHARA_BIT_EAT_ROTTEN, r1, TRUE
						continue
					}
					if ( rp2 == 41 ) {
						cbitmod CHARA_BIT_RES_STEAL, r1, TRUE
						continue
					}
					if ( rp2 == 55 ) {
						cbitmod CHARA_BIT_CURE_BLEEDING, r1, TRUE
						continue
					}
					if ( rp2 == 52 ) {
						cResDamage(r1) += roopbuf / 40 + 5
						continue
					}
					if ( rp2 == 53 ) {
						cImmuneDamage(r1) += roopbuf / 60 + 3
						continue
					}
					if ( rp2 == 54 ) {
						cReflectDamage(r1) += roopbuf / 5
						continue
					}
					if ( rp2 == 44 ) {
						cCritChance(r1) += roopbuf / 50
						continue
					}
					if ( rp2 == 39 ) {
						cVopalChance(r1) += roopbuf / 50
						continue
					}
					if ( rp2 == 50 ) {
						cExtraMelee(r1) += roopbuf / 15
						continue
					}
					if ( rp2 == 51 ) {
						cExtraShoot(r1) += roopbuf / 15
						continue
					}
					if ( rp2 == 21 | rp2 == 45 | rp2 == 46 | rp2 == 47 ) {
						cbitmod CHARA_BIT_RES_CURSE, r1, TRUE
						continue
					}
					if ( rp2 == 63 ) {
						cdata(267, r1) += roopbuf / 10
						continue
					}
				}
				if ( nc_intb_noench == (-1) | nc_intb_bigench == 3 ) {
					if ( r1 == 0 ) {
						if ( rp2 == 30 ) {
							gResEtherWind = 1
							continue
						}
						if ( rp2 == 31 ) {
							gResWeather = 1
							continue
						}
					}
				}
			}
		loop
	loop
	if ( nc_armorcount > 0 ) {
		cDV(r1) += 5 * nc_armorcount
		cPV(r1) += 5 * nc_armorcount
	}
	if ( gettrait(0, 194) < 0 & cImmuneDamage(r1) > 60 ) {
		cImmuneDamage(r1) = 60
	}
	if ( cImmuneDamage(r1) < 100 ) {
		if ( getfactionvalue(r1, "invalid") != "" ) {
			cImmuneDamage(r1) += getfactionvalue(r1, "invalid")
		}
	}
	if ( findbuff(r1, 68) != (-1) | cdata(268, r1) > 0 ) {
		cImmuneDamage(r1) = 0
		cResDamage(r1) = 0
	}
	if ( refreshmode == 1 ) {
		buff += "\n"
		buff += "<title1>◆ 装備による能力の修正<def>\n"
		repeat 600
			sdata(cnt, MAX_CHARA_NC) = sorgex(cnt, r1)
			if ( sdata(cnt, MAX_CHARA_NC) != sdata(cnt, r1) ) {
				rp = sdata(cnt, r1) - sdata(cnt, MAX_CHARA_NC)
				cnvbonus cnt, rp
			}
		loop
	}
	repeat 10
		if ( cdata(STARTING_CDATA_ATTR + cnt, r1) != 0 ) {
			if ( cQuality(r1) >= FIX_QUALITY_MIRACLE ) {
				if ( cdata(STARTING_CDATA_ATTR + cnt, r1) < sorg(10 + cnt, r1) / 5 ) {
					cdata(STARTING_CDATA_ATTR + cnt, r1) = sorg(10 + cnt, r1) / 5
				}
			}
			sdata(10 + cnt, r1) += cdata(STARTING_CDATA_ATTR + cnt, r1)
		}
		if ( sdata(10 + cnt, r1) < 1 ) {
			sdata(10 + cnt, r1) = 1
		}
	loop
	gosub *label_2452
	if ( r1 == 0 ) {
		cdata(CDATA_ELEMENT, r1) = 0
		if ( gettrait(r1, 193) < (-1) ) {
			sdata(SKILL_ATTR_LIFE, r1) = 1
			sdata(SKILL_ATTR_MANA, r1) = 1
			sSTR(r1) = 1
			sEND(r1) = 1
			sDEX(r1) = 1
			sPER(r1) = 1
			sLER(r1) = 1
			sWIL(r1) = 1
			sMAG(r1) = 1
			sCHR(r1) = 1
			sSPD(r1) = 1
			sLUC(r1) = 1
		}
	}
	traitmode = 1
	repeat 300
		if ( gettrait(r1, cnt) != 0 ) {
			tid = cnt
			gosub *trait_ref
		}
	loop
	if ( getfactionvalue(r1, "pet") != "" ) {
		p(55) = int(refstr)
		if ( gettrait(p(55), 67) ) {
			p(56) = stat
			sHealing(r1) = limit(sHealing(r1) + sqrt(sHealing(p(55))) + calc3traitmulti(p(56), sHealing(p(55))), sHealing(r1) > 0, 2000000000)
			sMeditation(r1) = limit(sMeditation(r1) + sqrt(sMeditation(p(55))) + calc3traitmulti(p(56), sMeditation(p(55))), sMeditation(r1) > 0, 2000000000)
		}
	}
	if ( cAttackStyle(r1) & 1 ) {
		if ( cPV(r1) > 0 ) {
			cPV(r1) = cPV(r1) * (120 + int(sqrt(sShield(r1))) * 2) / 100
		}
	}
	else {
		if ( attacknum == 1 ) {
			cAttackStyle(r1) += 2
		}
		else {
			if ( attacknum != 0 ) {
				cAttackStyle(r1) += 4
			}
		}
	}
	if ( cAttackStyle(r1) & 4 ) {
		if ( gettrait(r1, 63) ) {
			sEvade(r1) = limit(sEvade(r1) + sqrt(sTwoWield(r1)) + calc3traitmulti(stat, sTwoWield(r1)), sEvade(r1) > 0, 2000000000)
		}
	}
	lint_buff = int(limitf(double(limit(limit(sMAG(r1) * 2 + sWIL(r1) + sLER(r1) / 3, 1, 50000) * limit(cLevel(r1), 1, 30000) / 25 + sMAG(r1), 1, 1000000)) * sdata(SKILL_ATTR_MANA, r1) / 100, 1, 2000000000))
	cMMP(r1) = lint_buff
	lint_buff = int(limitf(double(limit(limit(sEND(r1) * 2 + sSTR(r1) + sWIL(r1) / 3, 1, 50000) * limit(cLevel(r1), 1, 30000) / 25 + sEND(r1), 1, 1000000)) * sdata(SKILL_ATTR_LIFE, r1) / 100 + 5, 1, 2000000000))
	cMHP(r1) = lint_buff
	lint_buff = limitmax(100 + (sWIL(r1) + sEND(r1)) / 5 + gettrait(r1, 24) * 8 + cdata(267, r1), 2000000000)
	cMSP(r1) = lint_buff
	if ( petcheck(r1) ) {
		if ( implevel(cImpression(r1)) >= 8 ) {
			if ( ogTitleFaunus == 2 ) {
				lint_buff = int(limitf(cMMP(r1) + cMMP(r1) * 0.2, 1, 2000000000))
				cMMP(r1) = lint_buff
				lint_buff = int(limitf(cMHP(r1) + cMHP(r1) * 0.2, 1, 2000000000))
				cMHP(r1) = lint_buff
			}
		}
	}
	if ( cMMP(r1) < 1 ) {
		cMMP(r1) = 1
	}
	if ( cMHP(r1) < 1 ) {
		cMHP(r1) = 1
	}
	if ( r1 == 0 ) {
		if ( eqfaction(r1, "golem") ) {
			cPV(CHARA_PLAYER) += 20
		}
	}
	if ( p(69) ) {
		if ( cDvFix(r1) == 0 ) {
			cDvFix(r1) = 100
		}
		cDV(r1) = limit(cLevel(r1), 1, 10000) / 2 + cDV(r1) * cDvFix(r1) / 100 + cDvFix(r1) - 100
		if ( cPvFix(r1) == 0 ) {
			cPvFix(r1) = 100
		}
		cPV(r1) = limit(cLevel(r1), 1, 10000) + (cPV(r1) + limit(cLevel(r1), 1, 10000) / 2 + cPvFix(r1) / 25) * cPvFix(r1) / 100
	}
	if ( r1 >= 57 ) {
		if ( cQuality(r1) == FIX_QUALITY_GREAT ) {
			cMHP(r1) = cMHP(r1) * 3 / 2
		}
		if ( cQuality(r1) >= FIX_QUALITY_MIRACLE ) {
			cMHP(r1) = cMHP(r1) * 5
		}
	}
	else {
		cMHP(r1) += 10
	}
	repeat 16
		rp = ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, r1)
		if ( rp == 0 ) {
			break
		}
		calcbuff r1, rp, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 1, r1)
	loop
	if ( r1 == 0 ) {
		if ( gettrait(r1, 193) < (-1) ) {
			sdata(SKILL_ATTR_LIFE, r1) = 1
			sdata(SKILL_ATTR_MANA, r1) = 1
			sSTR(r1) = 1
			sEND(r1) = 1
			sDEX(r1) = 1
			sPER(r1) = 1
			sLER(r1) = 1
			sWIL(r1) = 1
			sMAG(r1) = 1
			sCHR(r1) = 1
			sSPD(r1) = 1
			sLUC(r1) = 1
		}
	}
	if ( cAttackStyle(r1) & 4 ) {
		cExtraMelee(r1) += int(sqrt(sTwoWield(r1))) * 3 / 2 + 4
	}
	if ( sCritical(r1) ) {
		cCritChance(r1) += int(sqrt(sCritical(r1))) + 2
	}
	if ( cCritChance(r1) > 30 ) {
		cATK(r1) += (cCritChance(r1) - 30) * 2
		cCritChance(r1) = 30
	}
	if ( ocbit(1, r1) ) {
		cbitmod CHARA_BIT_INVISIBLE, r1, TRUE
	}
	locvar_matdelmain_f = carmor(r1)
	if ( locvar_matdelmain_f == 169 ) {
		if ( cDV(r1) > 0 ) {
			cDV(r1) = cDV(r1) / 2
		}
		else {
			cDV(r1) = cDV(r1) * 3 / 2
		}
	}
	if ( locvar_matdelmain_f == 170 ) {
		if ( cDV(r1) > 0 ) {
			cDV(r1) = cDV(r1) * 3 / 4
		}
		else {
			cDV(r1) = cDV(r1) * 4 / 3
		}
	}
	gosub *label_1681
	refreshspeed r1
	cbitmod CHARA_BIT_REFRESH, r1, FALSE
	rewriteai r1
	if ( characreatehack == 0 ) {
		refreshfaction r1
	}
	chararefreshhack = FALSE
	return




































































