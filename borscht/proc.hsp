#defcfunc efstatusfix int efstatusfix_arg1, int efstatusfix_arg2, int efstatusfix_arg3, int efstatusfix_arg4
	if ( efstatus <= (-2) ) {
		return efstatusfix_arg1
	}
	if ( efstatus == (-1) ) {
		return efstatusfix_arg2
	}
	if ( efstatus == 0 ) {
		return efstatusfix_arg3
	}
	return efstatusfix_arg4

*randomSite
	if ( mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) == 0 ) {
		return 0
	}
	if ( featId == CELL_FEATURE_NONE >= 24 & featId == CELL_FEATURE_NONE <= 28 ) {
		return 0
	}
	atxspot = ATX_FIELD1
	atxlv = limitmax(gLevel , 2000)
	if ( mType == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
		atxspot = ATX_DUNGEON1
	}
	if ( mType == MAP_TYPE_TOWER ) {
		atxspot = ATX_BUILDING1
	}
	if ( mType == MAP_TYPE_FOREST ) {
		atxspot = ATX_FOREST1
	}
	if ( mType == (23 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_FORT]@!!! */) ) {
		atxspot = ATX_BUILDING1
	}
	if ( mType == MAP_TYPE_WORLD ) {
		atxlv = difficulty() / 2 + rnd(10)
		if ( atxlv > 30 ) {
			atxlv = 30 + rnd(rnd(atxlv - 30) + 1)
		}
		if ( 4 <= gWorldTile & gWorldTile < 9 ) {
			atxspot = ATX_FOREST1
		}
		if ( 264 <= gWorldTile & gWorldTile < 363 ) {
			atxspot = ATX_FIELD1
		}
		if ( 9 <= gWorldTile & gWorldTile < 13 ) {
			atxspot = ATX_FOREST1
		}
		if ( 13 <= gWorldTile & gWorldTile < 17 ) {
			atxspot = ATX_FIELD1
		}
	}
	axtskill = 161
	cell_featread cX(CHARA_PLAYER), cY(CHARA_PLAYER)
	if ( featId == CELL_FEATURE_SAMPLING_SPOT_DETECTION ) {
		atxlv = limitmax(gLevel  + rnd(10), 2000)
		atxspot = ATX_REMAIN1
		axtskill = 159
	}
	if ( featId == CELL_FEATURE_SAMPLING_SPOT_GENE_ENGINEER ) {
		atxlv = limitmax(gLevel  + rnd(10), 2000)
		atxspot = ATX_REMAIN1
		axtskill = 159
	}
	if ( featId == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
		atxlv = limitmax(gLevel  + rnd(10), 2000)
		atxspot = ATX_MINE1
		axtskill = 163
	}
	if ( featId == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
		atxlv = limitmax(gLevel  + rnd(10), 2000)
		atxspot = ATX_WATER1
		axtskill = 185
	}
	if ( featId == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
		atxlv = limitmax(gLevel  + rnd(10), 2000)
		atxspot = ATX_BUSH1
		axtskill = 180
	}
	if ( rnd(10) == 0 ) {
		ctalk cc, 1324, cc, cc, atxspot
		if ( stat == 0 ) {
			ctalk cc, 1323, cc, cc
		}
	}
	if ( rnd(7) == 0 ) {
		repeat 1
			i = 5
			if ( atxspot == ATX_WATER1 ) {
				if ( sdata(axtskill, CHARA_PLAYER) < rnd(atxlv * 2 + 1) | rndex(10 + sorgex(axtskill, 0) / 20) == 0 ) {
					txt -1, lang("釣りに失敗した。", "Your fishing attempt fails.")
					skillexp2 SKILL_NORMAL_FISHING, CHARA_PLAYER, 5
					break
				}
				i = 2
				skillexp2 SKILL_NORMAL_FISHING, CHARA_PLAYER, 40
			}
			if ( atxspot == ATX_MINE1 ) {
				if ( sdata(axtskill, CHARA_PLAYER) < rnd(atxlv * 2 + 1) | rndex(10 + sorgex(axtskill, 0) / 20) == 0 ) {
					txt -1, lang("採掘に失敗した。", "Your mining attempt fails.")
					skillexp2 SKILL_NORMAL_MINING, CHARA_PLAYER, 5
					break
				}
				i = 1
				skillexp2 SKILL_NORMAL_MINING, CHARA_PLAYER, 40
			}
			if ( atxspot == ATX_BUSH1 ) {
				if ( sdata(axtskill, CHARA_PLAYER) < rnd(atxlv * 2 + 1) | rndex(10 + sorgex(axtskill, 0) / 20) == 0 ) {
					txt -1, lang("採取に失敗した。", "Your searching attempt fails.")
					skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 5
					break
				}
				i = 3
				skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 30
			}
			if ( atxspot == ATX_REMAIN1 ) {
				if ( sdata(axtskill, CHARA_PLAYER) < rnd(atxlv * 2 + 1) | rndex(10 + sorgex(axtskill, 0) / 20) == 0 ) {
					txt -1, lang("採取に失敗した。", "Your searching attempt fails.")
					skillexp2 SKILL_NORMAL_DETECTION, CHARA_PLAYER, 5
					break
				}
				i = 3
				skillexp2 SKILL_NORMAL_DETECTION, CHARA_PLAYER, 30
			}
			matgetmain random_material(atxspot, atxlv), limit(rnd(3) + sdata(axtskill, CHARA_PLAYER) / 15, 1, 12), i
		loop
	}
	if ( rnd(50 + gettrait(0, 159) * 20) == 0 ) {
		s = lang("もう何もない。", "You can't find anything anymore.")
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
			s = lang("泉は干上がった。", "The spring dries up.")
		}
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
			s = lang("鉱石を掘りつくした。", "There's no more ore around.")
		}
		if ( featId == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
			s = lang("もう目ぼしい植物は見当たらない。", "There's no more plant around.")
		}
		txt -1, s
		rowactend cc
		mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0
	}
	return

*disarmTrap
	cell_featset movx, movy, 0
	if ( godcheck(cc) == "mani" ) {
		txt -1, lang(name(cc) + "は罠を解体した。", "You dismantle the trap.")
		repeat rndex2(3 + cPiety(cc) / 4000) + 1
			olist = 13, 14, 15, 16
			olistmax = 4
			atxspot = olist(rnd(olistmax))
			matgetmain random_material(atxspot, 5 + cPiety(cc) / 400), rndex(10) + 1
		loop
	}
	else {
		txt -1, lang(name(cc) + "は罠を解除した。", "You disarm the trap.")
	}
	return

*label_3294
	if ( cfg_scroll ) {
		if ( cc == CHARA_PLAYER ) {
			gosub *screen_scroll
		}
	}
	mapChara(cX(cc), cY(cc)) = 0
	cX(cc) = cXnew(cc)
	cY(cc) = cYnew(cc)
	mapChara(cXnew(cc), cYnew(cc)) = cc + 1
	if ( cc == CHARA_PLAYER ) {
		if ( gRider != 0 ) {
			cX(gRider) = cX(CHARA_PLAYER)
			cY(gRider) = cY(CHARA_PLAYER)
		}
	}
	else {
		if ( ocPetRidingIdx(cc) != 0 ) {
			cX(ocPetRidingIdx(cc)) = cX(cc)
			cY(ocPetRidingIdx(cc)) = cY(cc)
		}
	}
	gosub *procMove
	return

*label_3295
	if ( cRowAct(cc) == ACTION_NONE ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は" + itemname(ci) + "の演奏をはじめた。", name(cc) + " start" + _s(cc) + " to play " + itemname(ci) + ".")
		}
		cRowAct(cc) = ACTION_PERFORM
		cActionPeriod(cc) = 61
		cItemUsing(cc) = ci
		cPerformScore(cc) = 40
		cPerformGold(cc) = 0
		if ( cc == CHARA_PLAYER ) {
			performtips = 0
			repeat 15, 1
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( synccheck(cnt, -1) == 0 ) {
					continue
				}
				if ( cRowAct(cnt) != ACTION_NONE ) {
					continue
				}
				if ( sPerform(cnt) == 0 ) {
					continue
				}
				if ( ocAISinging(cnt) != 0 ) {
					continue
				}
				cRowAct(cnt) = 10006
				cActionPeriod(cnt) = 61
				cPerformScore(cnt) = 40
				cPerformGold(cnt) = 0
				txt -1, lang(name(cnt) + "は" + name(cc) + "の演奏に合わせて歌いはじめた。", name(cnt) + " began singing in accordance with " + name(cc) + "'s performance.")
			loop
			throwsstpevent "Performance", cc, itemname(ci), sPerform(cc)
		}
		return
	}
	if ( cRowAct(cc) == 10006 | cRowAct(cc) == 20006 ) {
		if ( cc != CHARA_PLAYER ) {
			if ( cRowAct(CHARA_PLAYER) != ACTION_PERFORM & cRowAct(CHARA_PLAYER) != 10006 ) {
				cActionPeriod(cc) = 0
			}
			else {
				cActionPeriod(cc) = cActionPeriod(CHARA_PLAYER)
			}
		}
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( cRowAct(cc) == 30006 ) {
			cPerformGold(cc) = 0
			cPerformScore(cc) = 40
			if ( cActionPeriod(cc) \ 10 == 0 ) {
				if ( synccheck(cc, -1) ) {
					ctalk cc, 421, cc, cc
					if ( stat == 0 ) {
						txtef COLOR_BLUE
						txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
					}
				}
				repeat 245
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( getgametime() >= cInterestRenew(cnt) ) {
						cInterest(cnt) = 100
					}
					if ( synccheck(cc, -1) ) {
						if ( cSync(cnt) != msync ) {
							continue
						}
					}
					else {
						if ( dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3 ) {
							continue
						}
					}
					if ( cInterest(cnt) <= 0 ) {
						continue
					}
					if ( cSleep(cnt) > 0 ) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if ( mapChara(x, y) == 0 ) {
						continue
					}
					tc = cnt
					if ( tc == cc ) {
						continue
					}
					if ( cRowAct(tc) != ACTION_NONE ) {
						continue
					}
					if ( cRelation(cc) == cRelation(tc) ) {
						aniref = 0
						animeid = ANIMATION_HEAL_FAST
						anix = cX(tc)
						aniy = cY(tc)
						gosub *anime
						addbuff tc, BUFF_SPEED, sPerform(cc) * 5 + 50, 16
						addbuff tc, BUFF_HERO, sPerform(cc) * 5 + 100, 16
						addbuff tc, BUFF_DIVINE_WISDOM, sPerform(cc) * 5 + 100, 16
						skillexp2 SKILL_NORMAL_PERFORMER, cc, 50, 0, 0
						continue
					}
				loop
			}
		}
		if ( cRowAct(cc) == 30007 ) {
			cPerformGold(cc) = 0
			cPerformScore(cc) = 40
			if ( cActionPeriod(cc) \ 10 == 0 ) {
				if ( synccheck(cc, -1) ) {
					ctalk cc, 421, cc, cc
					if ( stat == 0 ) {
						txtef COLOR_BLUE
						txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
					}
				}
				repeat 245
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( getgametime() >= cInterestRenew(cnt) ) {
						cInterest(cnt) = 100
					}
					if ( synccheck(cc, -1) ) {
						if ( cSync(cnt) != msync ) {
							continue
						}
					}
					else {
						if ( dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3 ) {
							continue
						}
					}
					if ( cInterest(cnt) <= 0 ) {
						continue
					}
					if ( cSleep(cnt) > 0 ) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if ( mapChara(x, y) == 0 ) {
						continue
					}
					tc = cnt
					if ( tc == cc ) {
						continue
					}
					if ( cRowAct(tc) != ACTION_NONE ) {
						continue
					}
					if ( cRelation(cc) == cRelation(tc) ) {
						aniref = 0
						animeid = ANIMATION_HEAL_FAST
						anix = cX(tc)
						aniy = cY(tc)
						gosub *anime
						addbuff tc, BUFF_HOLY_SHIELD, sPerform(cc) * 5 + 100, 16
						addbuff tc, BUFF_REGENERATION, sPerform(cc) * 10 + 500, 16
						addbuff tc, BUFF_HOLY_VEIL, sPerform(cc) * 10 + 100, 16
						addbuff tc, BUFF_CONTINGENCY, 1500, 11
						skillexp2 SKILL_NORMAL_PERFORMER, cc, 50, 0, 0
						continue
					}
				loop
			}
		}
		if ( cRowAct(cc) == 30008 ) {
			cPerformGold(cc) = 0
			cPerformScore(cc) = 40
			if ( cActionPeriod(cc) \ 10 == 0 ) {
				if ( synccheck(cc, -1) ) {
					ctalk cc, 421, cc, cc
					if ( stat == 0 ) {
						txtef COLOR_BLUE
						txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
					}
				}
				repeat 245
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( getgametime() >= cInterestRenew(cnt) ) {
						cInterest(cnt) = 100
					}
					if ( synccheck(cc, -1) ) {
						if ( cSync(cnt) != msync ) {
							continue
						}
					}
					else {
						if ( dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3 ) {
							continue
						}
					}
					if ( cInterest(cnt) <= 0 ) {
						continue
					}
					if ( cSleep(cnt) > 0 ) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if ( mapChara(x, y) == 0 ) {
						continue
					}
					tc = cnt
					if ( tc == cc ) {
						continue
					}
					if ( cRowAct(tc) != ACTION_NONE ) {
						continue
					}
					if ( cRelation(tc) == RELATION_DISLIKE | cRelation(tc) == RELATION_HATE | cRelation(tc) == RELATION_ENEMY ) {
						aniref = 0
						animeid = ANIMATION_BALL
						anix = cX(tc)
						aniy = cY(tc)
						gosub *anime
						addbuff tc, BUFF_SLOW, sPerform(cc) * 5 + 50, 11
						addbuff tc, BUFF_MIST_OF_FRAILNESS, sPerform(cc) * 5 + 100, 11
						dmghp tc, role(sPerform(cc) / 10 + 2, sPerform(cc) / 5 + 5, sPerform(cc) * 10 / cActionPeriod(cc)), cc, SKILL_RES_SOUND
						if ( rnd(3) == 0 ) {
							unlockon tc, cc
							cAiAggro(tc) = 0
						}
						skillexp2 SKILL_NORMAL_PERFORMER, cc, 50, 0, 0
						continue
					}
				loop
			}
		}
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( cRowAct(cc) == 10006 ) {
			if ( cActionPeriod(cc) \ 10 == 0 ) {
				if ( synccheck(cc, -1) ) {
					if ( rnd(10) == 0 ) {
						ctalk cc, 421, cc, cc
						if ( stat == 0 ) {
							txtef COLOR_BLUE
							txt cc, lang("〜♪", "*Tiki*"), lang(name(cc) + "は歌っている。", "*Dan*"), lang(name(cc) + "は気持ちよさそうに歌っている。", "*Lala*"), lang("「ﾍｪｰﾗﾛﾛｫｰﾙﾉｫｰﾉﾅｰｧｵｵｫｰ」", "*Tiki*")
						}
					}
				}
			}
		}
		else {
			if ( cActionPeriod(cc) \ 10 == 0 & (cRowAct(cc) == ACTION_PERFORM | cRowAct(cc) == 20006) ) {
				if ( synccheck(cc, -1) ) {
					ctalk cc, 1224, cc, cc
					if ( stat == 0 ) {
						if ( rnd(10) == 0 ) {
							txtef COLOR_BLUE
							txt -1, lang("ﾁｬﾗﾝ♪ ", "*Tiki*"), lang("ﾎﾟﾛﾝ♪ ", "*Dan*"), lang("ﾀﾞｰﾝ♪ ", "*Lala*")
						}
						txtef COLOR_BLUE
						txt -1, lang("ｼﾞｬﾝ♪ ", "*Cha*")
					}
				}
			}
		}
		if ( cActionPeriod(cc) \ 20 == 0 & (cRowAct(cc) == ACTION_PERFORM | cRowAct(cc) == 10006 | cRowAct(cc) == 20006) ) {
			gold = 0
			make_sound cX(cc), cY(cc), 5, 1, 1, cc
			repeat 245
				if ( cRowAct(cc) != 10006 ) {
					ci = cItemUsing(cc)
				}
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( getgametime() >= cInterestRenew(cnt) ) {
					cInterest(cnt) = 100
				}
				if ( synccheck(cc, -1) ) {
					if ( cSync(cnt) != msync ) {
						continue
					}
				}
				else {
					if ( dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3 ) {
						continue
					}
				}
				if ( cInterest(cnt) <= 0 ) {
					continue
				}
				if ( cSleep(cnt) > 0 ) {
					continue
				}
				x = cX(cnt)
				y = cY(cnt)
				if ( mapChara(x, y) == 0 ) {
					continue
				}
				tc = cnt
				if ( tc == cc ) {
					continue
				}
				if ( cRowAct(tc) != ACTION_NONE ) {
					continue
				}
				if ( cRelation(tc) == RELATION_ENEMY ) {
					if ( cAiAggro(tc) == 0 ) {
						if ( synccheck(tc, -1) ) {
							txt -1, lang(name(tc) + "は激怒した。", name(tc) + " get" + _s(tc) + " angry.")
						}
					}
					cAiAggro(tc) = 30
					continue
				}
				if ( cc == CHARA_PLAYER ) {
					cInterest(tc) -= rnd(15)
					cInterestRenew(tc) = getgametime() + 12
				}
				if ( cInterest(tc) <= 0 ) {
					if ( synccheck(cc, -1) ) {
						txtef COLOR_SKY_BLUE
						ctalk tc, 978, cc, tc
						if ( stat == 0 ) {
							ctalk tc, 1225, cc, tc
							if ( stat == 0 ) {
								txtef COLOR_SKY_BLUE
								if ( jp ) {
									txt tc, "「飽きた」", "「前にも聴いたよ」", "「またこの曲か…」"
								}
								if ( en ) {
									txt tc, cnvtalk("Boring."), cnvtalk("I've heard this before."), cnvtalk("This song again?")
								}
							}
						}
					}
					cInterest(tc) = 0
					continue
				}
				performance = sPerform(cc)
				if ( petcheck(cc) ) {
					if ( sPerform(CHARA_PLAYER) < sPerform(cc) ) {
						performance = sPerform(CHARA_PLAYER)
					}
				}
				else {
					if ( performance < cLevel(tc) * 2 / 3 ) {
						if ( rnd(3) == 0 ) {
							if ( performance_check() ) {
								cPerformScore(cc) -= cLevel(tc) / 2
								if ( synccheck(cc, -1) ) {
									txtef COLOR_SKY_BLUE
									ctalk tc, 977, cc, tc
									if ( stat == 0 ) {
										ctalk tc, 1226, cc, tc
										if ( stat == 0 ) {
											txtef COLOR_SKY_BLUE
											if ( jp ) {
												txt tc, "「引っ込め！」", "「うるさい！」", "「下手っぴ！」", "「何のつもりだ！」"
											}
											if ( en ) {
												txt tc, cnvtalk("Boo boo!"), cnvtalk("Shut it!"), cnvtalk("What are you doing!"), cnvtalk("You can't play shit.")
											}
										}
									}
									ctalk tc, 976, cc, tc
									if ( stat == 0 ) {
										txt -1, lang("" + name(tc) + "は石を投げた。", name(tc) + " throw" + _s(tc) + " a rock.")
									}
								}
								dmg = rnd(cLevel(tc) + 1) + 1
								if ( cId(tc) == CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN ) {
									dmg = cLevel(tc) * 2 + rnd(100)
								}
								if ( tc == CHARA_PLAYER & ogTitleWailingChoir == 2 ) {
									dmg = cLevel(tc) * 2 + rnd(100)
								}
								dmghp cc, dmg, DAMAGE_FROM_PERFORM
								if ( cExist(cc) == CHAR_STATE_DEAD ) {
									break
								}
								continue
							}
							else {
								if ( cRowAct(cc) != 10006 ) {
									txtef COLOR_PURPLE
									txt -1, lang(name(tc) + "は嫌な顔をした。", name(tc) + " glare" + _s(tc) + " at you.")
									ctalk tc, 1282, cc, tc
								}
							}
						}
					}
					else {
						if ( gArea  == AREA_VERNIS ) {
							if ( cId(tc) == CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN ) {
								if ( tc >= MAX_CHARA_SAVE ) {
									cExp(tc) += 500000
								}
							}
						}
					}
				}
				if ( rnd(3) == 0 ) {
					if ( cRowAct(cc) == 10006 ) {
						p = cPerformScore(cc) * cPerformScore(cc) * (100 + gettrait(cc, 72) * 10) / 100 / 1000 + rnd(10)
					}
					else {
						p = cPerformScore(cc) * cPerformScore(cc) * (100 + iParam1(ci) / 5) / 100 / 1000 + rnd(10)
					}
					p = limit(cGold(tc) * limit(p, 1, 100) / 125, 0, performance * 100)
					if ( petcheck(tc) ) {
						p = rnd(limit(p, 1, 100)) + 1
					}
					if ( cRole(tc) >= (1000 /*!!!@[ROLE_SHOP_MIN @@@ ROLE_SHOP_WEAPON]@!!! */) & cRole(tc) < (2000 /*!!!@[ROLE_GUEST_BEGGAR @@@ ROLE_GUEST_MIN]@!!! */) | cRole(tc) == ROLE_GUEST_MERCHANT | cRole(tc) == ROLE_SHOP_MATERIAL | cRole(tc) == ROLE_SHOP_SPELLBOOK | cRole(tc) == ROLE_SHOP_APHRODISIAC | cRole(tc) == ROLE_SHOP_DOUJINSHI | cRole(tc) == ROLE_SHOP_UNKNOWN3104 | cRole(tc) == ROLE_SHOP_HERB_MERCHANT | cRole(tc) == ROLE_SHOP_PROSTITUTE_GUILD | cRole(tc) == ROLE_SHOP_BLACKSMITH_GUILD | cRole(tc) == ROLE_SHOP_MYSTERIOUS_PRODUCER | cRole(tc) == ROLE_SHOP_FAIRY | cRole(tc) == ROLE_SHOP_MORPHY ) {
						p /= 5
					}
					if ( gQuest == QUEST_TYPE_PARTY & ogExtravagantParty == 1 ) {
						p *= 2
					}
					if ( p > cGold(tc) ) {
						p = cGold(tc)
					}
					cGold(tc) -= p
					se_moneymod cc, p
					gold += p
				}
				if ( cLevel(tc) > performance ) {
					continue
				}
				p = rnd(cLevel(tc) + 1) + 1
				if ( rnd(performance + 1) > rnd(cLevel(tc) * 2 + 1) ) {
					if ( gQuest == QUEST_TYPE_PARTY ) {
						if ( tc >= MAX_CHARA_SAVE ) {
							cImpression(tc) += rnd(3)
							calcpartyscore
						}
					}
					if ( rnd(2) == 0 ) {
						cPerformScore(cc) += p
					}
					else {
						if ( rnd(2) == 0 ) {
							cPerformScore(cc) -= p
						}
					}
				}
				if ( cRowAct(cc) == 10006 ) {
					if ( gettrait(cc, 72) ) {
						if ( rnd(10) < calctraitscore(stat) ) {
							dmgcon tc, CONDITION_DRUNK, 500
						}
					}
					if ( petcheck(cc) ) {
						continue
					}
				}
				else {
					if ( findbuff(cc, 62) == (-1) | check_bigench(ci) == 3 ) {
						if ( encfindspec(ci, ENCHANT_DRUNK_LISTENER) != (-1) ) {
							if ( rnd(15) == 0 ) {
								dmgcon tc, CONDITION_DRUNK, 500
							}
						}
					}
					if ( iID(ci) == ITEM_ID_KILL_KILL_PIANO ) {
						if ( rnd(15) == 0 ) {
							if ( tc >= MAX_CHARA_SAVE ) {
								if ( cQuality(tc) != FIX_QUALITY_UNIQUE ) {
									dmghp tc, 9999, (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */), SKILL_RES_SOUND
								}
							}
						}
					}
				}
				if ( rnd(performance + 1) > rnd(cLevel(tc) * 5 + 1) ) {
					if ( rnd(3) == 0 ) {
						if ( synccheck(cc, -1) ) {
							txtef COLOR_SKY_BLUE
							ctalk tc, 975, cc, tc
							if ( stat == 0 ) {
								ctalk tc, 1227, cc, tc
								if ( stat == 0 ) {
									txtef COLOR_SKY_BLUE
									if ( jp ) {
										txt tc, name(tc) + "は歓声を上げた。", name(tc) + "は目を輝かせた。", "「ブラボー」", "「いいぞ！」", name(tc) + "はうっとりした。", name(tc) + "は" + name(cc) + "の" + skillnameref(183, cc) + "を褒め称えた。"
									}
									if ( en ) {
										txt tc, name(tc) + " clap" + _s(tc) + ".", name(tc) + " listen" + _s(tc) + " to " + name(cc) + your(cc) + " music joyfully.", cnvtalk("Bravo!"), cnvtalk("Nice song."), cnvtalk("Scut!"), name(tc) + " " + is(tc) + " excited!"
									}
								}
							}
						}
						cPerformScore(cc) += cLevel(tc) + 5
						if ( cc == CHARA_PLAYER ) {
							if ( petcheck(tc) == 0 ) {
								if ( rnd(performtips * 2 + 2) == 0 ) {
									x = limit(cX(cc) - 1 + rnd(3), 0, mWidth - 1)
									y = limit(cY(cc) - 1 + rnd(3), 0, mHeight - 1)
									cell_check2 x, y
									if ( cellaccess == 0 ) {
										continue
									}
									if ( fov_los(cX(tc), cY(tc), x, y) == 0 ) {
										continue
									}
									objlv = 0
									if ( cRowAct(cc) == 10006 & gettrait(cc, 72) | (findbuff(cc, 62) == (-1) & encfindspec(ci, ENCHANT_REWARD_QUALITY) != (-1)) ) {
										flt calcobjlv(cPerformScore(cc) / 8), calcfixlv(3 + (rnd(4) == 0))
									}
									if ( objlv == 0 ) {
										flt calcobjlv(cPerformScore(cc) / 10), calcfixlv(FIX_QUALITY_GREAT)
									}
									flttypemajor = fsetperform(rnd(length(fsetperform)))
									dbid = 0
									if ( gQuest == QUEST_TYPE_PARTY ) {
										if ( rnd(150) == 0 ) {
											dbid = 241
										}
										if ( rnd(150) == 0 ) {
											dbid = 622
										}
										if ( cLevel(tc) > 15 ) {
											if ( rnd(1000) == 0 ) {
												dbid = 725
											}
										}
										if ( cLevel(tc) > 10 ) {
											if ( rnd(800) == 0 ) {
												dbid = 726
											}
										}
									}
									else {
										if ( rnd(10) == 0 ) {
											dbid = 724
										}
										if ( rnd(250) == 0 ) {
											dbid = 55
										}
									}
									if ( gQuest == QUEST_TYPE_PARTY & ogExtravagantParty == 1 ) {
										flt calcobjlv(cPerformScore(cc) / 6), calcfixlv(3 + (rnd(2) == 0))
										flttypemajor = fsetperform2(rnd(length(fsetperform2)))
										if ( rnd(50) == 0 ) {
											dbid = 505
										}
										if ( rnd(50) == 0 ) {
											dbid = 622
										}
										if ( rnd(80) == 0 ) {
											dbid = 706
										}
										if ( rnd(80) == 0 ) {
											dbid = 737
										}
										if ( rnd(100) == 0 ) {
											dbid = 290
										}
										if ( rnd(100) == 0 ) {
											dbid = 626
										}
									}
									itemcreate -1, dbid, x, y, 1
									if ( stat != 0 ) {
										iNum(ci)--
										cell_refresh iX(ci), iY(ci)
										ccbk = cc
										cc = tc
										animeid = ANIMATION_THROW
										if ( cfg_useffhp ) {
											aniref = iPic(ci), iCol(ci), ci
										}
										else {
											aniref = iPic(ci), iCol(ci)
										}
										anix = iX(ci)
										aniy = iY(ci)
										gosub *anime
										cc = ccbk
										iNum(ci)++
										cell_refresh iX(ci), iY(ci)
										performtips++
									}
								}
							}
						}
					}
				}
			loop
			if ( gold != 0 ) {
				cPerformGold(cc) += gold
				if ( synccheck(cc, -1) ) {
					snd SOUNDLIST_GETGOLD1
				}
			}
		}
		return
	}
	repeat 1
		if ( cc != CHARA_PLAYER ) {
			break
		}
		if ( cRowAct(cc) == 30006 | cRowAct(cc) == 30007 | cRowAct(cc) == 30008 ) {
			txt -1, lang("歌い終わった。", "It is a finish.")
			break
		}
		if ( cPerformScore(cc) < 0 ) {
			txt -1, lang("まるで駄目だ…", "It is a waste of time.")
			break
		}
		if ( cPerformScore(cc) < 20 ) {
			txt -1, lang("不評だった…", "Almost everyone ignores you.")
			break
		}
		if ( cPerformScore(cc) < 40 ) {
			txt -1, lang("もっと練習しなくては…", "You need to practice lot more.")
			break
		}
		if ( cPerformScore(cc) == 40 ) {
			txt -1, lang(skillnameref(183, cc) + "を終えた。", name(cc) + " finish" + _s(cc, 1) + " " + his(cc) + " performance.")
			break
		}
		if ( cPerformScore(cc) < 60 ) {
			txt -1, lang("いまいちだ。", "Not good.")
			break
		}
		if ( cPerformScore(cc) < 80 ) {
			txt -1, lang("手ごたえがあった。", "People seem to like your performance.")
			break
		}
		if ( cPerformScore(cc) < 100 ) {
			txt -1, lang("納得できる" + skillnameref(183, cc) + "ができた。", his(cc) + " performance is successful.")
			break
		}
		if ( cPerformScore(cc) < 120 ) {
			txt -1, lang("大盛況だ！", "Wonderful!")
			break
		}
		if ( cPerformScore(cc) < 150 ) {
			txt -1, lang("素晴らしい！", "Great performance. Everyone cheers you.")
			break
		}
		txt -1, lang("歴史に残る名演だ！", "A Legendary stage!")
		break
	loop
	if ( cPerformScore(cc) > 40 ) {
		if ( cRowAct(cc) == 10006 ) {
			cPerformScore(cc) = cPerformScore(cc) * (100 + gettrait(cc, 72) * 10) / 100
		}
		else {
			cPerformScore(cc) = cPerformScore(cc) * (100 + iParam1(ci) / 5) / 100
		}
	}
	if ( cPerformGold(cc) != 0 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は合計 " + thousandsep(str(cPerformGold(cc))) + strgold + "のおひねりを貰った。", "The audience gives " + name(cc) + " total of " + cPerformGold(cc) + " gold pieces.")
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cPerformGold(cc) > ncgGreatestPerformanceTips ) {
				ncgGreatestPerformanceTips = cPerformGold(cc)
				yarikomi = 13
				gosub *nc_charasheet_yarikomi
			}
		}
	}
	rowactend cc
	r1 = cPerformScore(cc) - performance + 50
	if ( r1 > 0 ) {
		gosub *label_1603
	}
	return

*label_3302
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_SEX
		cActionPeriod(cc) = 25 + rnd(10)
		cRowActTc(cc) = tc
		if ( cc == CHARA_PLAYER & tc == CHARA_PLAYER ) {
			cRowAct(tc) = ACTION_SEX, 50
		}
		else {
			cRowAct(tc) = ACTION_SEX, 2000000
		}
		cRowActTc(tc) = cc + 10000
		if ( synccheck(cc, -1) ) {
			ctalk cc, 1205, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は服を脱ぎ始めた。", name(cc) + " begin" + _s(cc) + " to take " + his(cc) + " clothes off.")
			}
		}
		if ( cc == CHARA_PLAYER ) {
			throwsstpevent "ClothOut", tc, "", 0
		}
		return
	}
	sexhost = 1
	tc = cRowActTc(cc)
	if ( tc >= 10000 ) {
		tc -= 10000
		sexhost = 0
	}
	if ( cExist(tc) != CHAR_STATE_ALIVE | cRowAct(tc) != ACTION_SEX ) {
		if ( synccheck(cc, -1) ) {
			ctalk cc, 980, cc, tc
			if ( stat == 0 ) {
				ctalk cc, 1207, cc, tc
				if ( stat == 0 ) {
					txt cc, lang("「そ、その" + _sex2(cSex(tc)) + "とは体だけの関係" + _da() + _ore(3) + "は何も知らないから、命だけは…！」", "\"I-I don't really know that " + _sex2(cSex(tc)) + ". Please spare my life!\"")
				}
			}
		}
		rowactend cc
		rowactend tc
		return
	}
	else {
		if ( cc != tc & cRowAct(tc) == ACTION_SEX ) {
			if ( cActionPeriod(tc) >= 1000000 & cActionPeriod(tc) <= 2000000 - 200 ) {
				goto *effect
			}
		}
	}
	if ( cc == CHARA_PLAYER ) {
		p = gettrait(cc, 74)
		if ( p == 0 | rnd(10) >= calctraitscore(p) ) {
			if ( trophycheck(TROPHY_TRIGGER_HAPPY) == 2 ) {
				actionsp CHARA_PLAYER, rnd(2)
			}
			else {
				actionsp CHARA_PLAYER, 1 + rnd(2)
			}
		}
		if ( stat == 0 ) {
			txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
			rowactend cc
			rowactend tc
			return
		}
		if ( gettrait(0, 250) > 0 & cHunger(CHARA_PLAYER) <= 12000 ) {
			cHunger(CHARA_PLAYER) += 160
		}
	}
	cEmoIcon(cc) = 17 + 100 * 3
	if ( cActionPeriod(cc) > 0 ) {
		if ( sexhost == 0 ) {
			if ( cActionPeriod(cc) \ 5 == 0 ) {
				if ( synccheck(cc, -1) ) {
					txtef COLOR_SKY_BLUE
					ctalk cc, 1164, cc, tc
					if ( stat == 0 ) {
						ctalk cc, 1163, cc, tc
						if ( stat == 0 ) {
							ctalk cc, 999, cc, tc
							if ( stat == 0 ) {
								ctalk cc, 1206, cc, tc
								if ( stat == 0 ) {
									txtef COLOR_SKY_BLUE
									if ( jp ) {
										txt cc, "「きくぅ」", "「もふもふ」", "「くやしい、でも…」", "「はぁはぁ！」", "「ウフフフ」"
									}
									if ( en ) {
										txt cc, cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("Come on!")
									}
								}
							}
						}
					}
				}
			}
			if ( cc == CHARA_PLAYER | tc == CHARA_PLAYER ) {
				if ( rnd(5) == 0 ) {
					item_find 2001, 4
					if ( stat != (-1) ) {
						snd SOUNDLIST_WATER
						txtef COLOR_BLUE
						txt -1, lang(" *チャプ* ", "*sploosh*"), lang(" *バシャ* ", "*splash*")
					}
				}
			}
		}
		return
	}

*effect
	if ( sexhost == 0 ) {
		rowactend cc
		return
	}
	repeat 2
		if ( cnt == 0 ) {
			c = cc
		}
		else {
			c = tc
		}
		cDrunk(cc) = 0
		if ( cnt == 1 ) {
			if ( rnd(3) == 0 ) {
				dmgcon c, CONDITION_INSANE, 500
			}
			if ( rnd(5) == 0 ) {
				dmgcon c, CONDITION_PARALYZE, 500
			}
			dmgcon c, CONDITION_INSANE, 300
			if ( godcheck(c) != "danalin" ) {
				healsan c, 10
			}
			skillexp2 SKILL_ATTR_CON, c, 250 + (c >= 57) * 1000
			skillexp2 SKILL_ATTR_WIL, c, 250 + (c >= 57) * 1000
		}
		if ( cc == CHARA_PLAYER & petcheck(tc) | (ogTitle1000ThTargetSlayed == 2 & (cc == CHARA_PLAYER | tc == CHARA_PLAYER | petcheck(cc) | petcheck(tc))) ) {
		}
		else {
			if ( rnd(15) == 0 ) {
				dmgcon c, CONDITION_SICK, 200
			}
		}
		skillexp2 SKILL_ATTR_CHA, c, 250 + (c >= 57) * 1000
	loop
	if ( rnd(100) < cdata(266, cc) ) {
		txt -1, lang(name(tc) + "は" + name(cc) + "の防具に染み付いた媚薬を嗅いだ。", name(tc) + " sniffed an aphrodisiac.")
		dmgcon tc, 13, 100
	}
	if ( trophycheck(TROPHY_DEATHLESS) == 2 ) {
		sexvalue = sCHR(cc) * (100 + cdata(266, cc) + rnd(50 + gettrait(cc, 74) * 75)) + 100
	}
	else {
		sexvalue = sCHR(cc) * (50 + cdata(266, cc) + rnd(50 + gettrait(cc, 74) * 50)) + 100
	}
	if ( guildcheck(0) == "prostitute" & gRankGuild == 100 & cc == CHARA_PLAYER ) {
		sexvalue *= 2
	}
	if ( cId(cc) == CREATURE_ID_YOUNGER_SISTER2 | cId(cc) == CREATURE_ID_ROGUE_BOSS & cQuality(cc) == FIX_QUALITY_UNIQUE & tc == CHARA_PLAYER ) {
		sistersex = 1
		evadd EVENT_ROGUE
	}
	else {
		if ( synccheck(cc, -1) ) {
			if ( cc == CHARA_PLAYER | tc == CHARA_PLAYER ) {
				item_find 2001, 4
				if ( stat != (-1) ) {
					p = cc, tc
					repeat 2
						txt -1, lang(name(p(cnt)) + "の魅力は復活した。", name(p(cnt)) + your(p(cnt)) + " charisma is restored.")
						if ( cdata(247, p(cnt)) < 0 ) {
							cdata(247, p(cnt)) = 0
						}
						r1 = p(cnt)
						gosub *charaRefresh
					loop
				}
			}
			if ( tc != CHARA_PLAYER ) {
				if ( sGene(tc) != 0 ) {
					repeat 2
						efcibk = ci
						efcancel = 0
						obvious = 1
						efsource = 0
						efbad = 0
						if ( limitmax(sqrt(sGene(tc)), 10) > rnd(100) ) {
							efstatus = 1
						}
						else {
							efstatus = 0
						}
						efid = 439 + cnt
						efp = 100
						gosub *effect2
					loop
					skillexp2 SKILL_NORMAL_GENE_ENGINEER, tc, 60
				}
			}
			if ( cc == CHARA_PLAYER ) {
				txtef COLOR_SKY_BLUE
				ctalk 0, 1166, 0, tc
				if ( stat == 0 ) {
					ctalk 0, 1165, 0, tc
					if ( stat == 0 ) {
						ctalk 0, 998, 0, tc
					}
				}
			}
			if ( gettrait(cc, 250) > 0 ) {
				if ( cRelation(tc) == RELATION_DISLIKE | cRelation(tc) == RELATION_HATE | cRelation(tc) == RELATION_ENEMY ) {
					dmghp tc, sCHR(cc) / 2, cc
				}
			}
			if ( cExist(tc) == CHAR_STATE_ALIVE ) {
				txtef COLOR_SKY_BLUE
				ctalk tc, 1166, cc, tc
				if ( stat == 0 ) {
					ctalk tc, 1165, cc, tc
					if ( stat == 0 ) {
						ctalk tc, 998, cc, tc
						if ( stat == 0 ) {
							ctalk tc, 1208, cc, tc
							if ( stat == 0 ) {
								txtef COLOR_SKY_BLUE
								if ( jp ) {
									txt tc, "「よかった" + _yo(3) + "！」", "「す、すごい" + _yo(3) + "！」", "「も、もうだめ" + _da(3) + "！」", "「は、激しかった" + _yo(3) + "！」", "「か、完敗" + _da(3) + "！」"
								}
								if ( en ) {
									txt tc, "\"You are awesome!", "\"Oh my god....", "\"Okay, okay, you win!", "\"Holy...!"
								}
							}
						}
					}
				}
			}
		}
		nc_intb_100 = 0
		if ( cc == CHARA_PLAYER ) {
			if ( cRole(tc) == ROLE_QUEST_RICH_NOBLE ) {
				if ( rnd(20) + 1 < limit(rnd(cLevel(tc) * 2 + 1) - sCHR(cc), 1, 15) - gettrait(cc, 74) * 2 ) {
					txtef COLOR_RED
					txt -1, lang("客が料金を渋り、怒って襲いかかってきた！", "The customer balked at the price and angrily attacked you!")
					lockon tc, 0, 3
					cAiAggro(tc) = 20
					cEmoIcon(tc) = 18 + 100 * 3
					nc_intb_100 = 1
				}
			}
		}
		if ( nc_intb_100 == 0 & tc != CHARA_PLAYER ) {
			if ( (cc == CHARA_PLAYER & petcheck(tc)) == 0 ) {
				if ( (cc == CHARA_PLAYER & cId(tc) == CREATURE_ID_USER & cQuality(tc) == FIX_QUALITY_UNIQUE) == 0 ) {
					if ( petcheck(cc) == 0 | petcheck(tc) == 0 ) {
						if ( cGold(tc) >= sexvalue ) {
							if ( cExist(tc) == CHAR_STATE_ALIVE ) {
								txtef COLOR_TALK
								if ( synccheck(cc, -1) ) {
									ctalk tc, 1209, cc, tc
									if ( stat == 0 ) {
										txt tc, lang("「さあ、小遣いを受け取って" + _kure(3) + "」", "Here, take this.\"")
									}
									ctalk cc, 1253, tc, cc
								}
							}
						}
						else {
							if ( cExist(tc) == CHAR_STATE_ALIVE ) {
								txtef COLOR_TALK
								if ( synccheck(cc, -1) ) {
									ctalk tc, 1210, cc, tc
									if ( stat == 0 ) {
										txt tc, lang("「これが" + _ore(3) + "の財布の中身の全て" + _da() + "」", "Take this money, it's all I have!\"")
									}
									if ( rnd(3) == 0 & cc != CHARA_PLAYER ) {
										ctalk cc, 1255, tc, cc
										if ( stat == 0 ) {
											txt -1, lang(name(cc) + "は激怒した。「なめてんの？」", name(cc) + " gets furious, " + cnvtalk("And you think you can just run away?"))
										}
										lockon cc, tc, 11
										cAiAggro(cc) = 20
									}
									else {
										ctalk cc, 1254, tc, cc
									}
								}
							}
							if ( cGold(tc) <= 0 ) {
								cGold(tc) = 1
							}
							sexvalue = cGold(tc)
						}
						cGold(tc) -= sexvalue
						if ( cc == CHARA_PLAYER ) {
							if ( sexvalue > ncgGreatestSexGold ) {
								ncgGreatestSexGold = sexvalue
								yarikomi = 5
								gosub *nc_charasheet_yarikomi
							}
							modimp tc, 5
							flt
							itemcreate -1, ITEM_ID_GOLD_PIECE, cX(cc), cY(cc), sexvalue
							if ( stat ) {
								txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
							}
							if ( cRole(tc) != ROLE_QUEST_RICH_NOBLE ) {
								modkarma 0, -1
							}
							ogTimesSoldOwnBody++
							gosub *label_2665
							if ( stgdata(16) > 0 ) {
								stgdata(16) -= sexvalue
								if ( stgdata(16) < 0 ) {
									stgdata(16) = 0
								}
								txtef COLOR_GREEN
								txt -1, lang("娼婦ギルドのノルマ達成まで、あと金貨" + stgdata(16) + "枚相当の稼ぎを出す必要がある。", "You need to earn " + stgdata(16) + "more gold coins for the quota.")
							}
						}
						else {
							se_moneymod cc, sexvalue
						}
					}
				}
			}
		}
		if ( gQuest == 1020 ) {
			if ( cc == CHARA_PLAYER & cRole(tc) == ROLE_QUEST_RICH_NOBLE ) {
				cImpression(tc) = 100
				cRole(tc) = ROLE_QUEST_PROSTITUTE
				qParam2(gQuestRef)++
				txtef COLOR_SKY_BLUE
				txt -1, lang("[依頼のノルマまで、残り" + limitmin(qParam1(gQuestRef) - qParam2(gQuestRef), 0) + "人]", "left " + limitmin(qParam1(gQuestRef) - qParam2(gQuestRef), 0) + " to complete the quest.")
			}
		}
		r1 = -1
		if ( ocbit(11, cc) ) {
			if ( gettrait(cc, 185) ) {
				r1 = tc
			}
		}
		if ( ocbit(11, tc) ) {
			if ( gettrait(tc, 185) ) {
				r1 = cc
			}
		}
		if ( r1 != (-1) ) {
			r2 = sCHR(r1) * 50 + 100
			if ( petcheck(r1) ) {
				r2 /= 4
			}
			else {
				cnpcrole = 0
				if ( cId(r1) == CREATURE_ID_USER ) {
					if ( userdata2(5, cUNID(r1)) ) {
						cnpcrole = userdata2(5, cUNID(r1))
					}
				}
				if ( cId(r1) == CREATURE_ID_PROSTITUTE | cId(r1) == CREATURE_ID_MINA_THE_NEWCOMER_TO_GUILD | cnpcrole == 3 | eqfaction(r1, "whole") ) {
					r2 *= 4
				}
			}
			modstress limit(r2, 0, 7500) * (-1)
		}
	}
	rowactend cc
	rowactend tc
	return

*label_3307
	if ( cc != CHARA_PLAYER ) {
		rowactend cc
		return
	}
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_GENERAL
		cItemUsing(cc) = ci
		cRowActTc(cc) = tc
		if ( gRowAct == ACTION_STEAL ) {
			txt -1, lang(itemname(ci, 1) + "に目星をつけた。", "You target " + itemname(ci, 1) + ".")
			cActionPeriod(cc) = 2 + limit(iWeight(ci) / 500, 0, 50)
		}
		if ( gRowAct == ACTION_SLEEP ) {
			if ( mType == MAP_TYPE_HOME | mType == MAP_TYPE_TOWN | mType == MAP_TYPE_VILLAGE ) {
				txt -1, lang("寝る仕度を始めた。", "You lie down.")
				cActionPeriod(cc) = 5
			}
			else {
				txt -1, lang("露営の準備を始めた。", "You start to camp.")
				cActionPeriod(cc) = 20
			}
		}
		if ( gRowAct == ACTION_CONSTRUCT ) {
			txt -1, lang(itemname(ci, 1) + "の建設を始めた。", "You start to construct " + itemname(ci, 1) + ".")
			cActionPeriod(cc) = 25
		}
		if ( gRowAct == ACTION_OPEN_HATCH ) {
			txt -1, lang(itemname(ci, 1) + "のハッチを回し始めた。", "You start to pull the hatch.")
			cActionPeriod(cc) = 10
		}
		if ( gRowAct == ACTION_HARVEST ) {
			txt -1, lang(itemname(ci, 1) + "を掘り始めた。", "You start to pick " + itemname(ci, 1) + ".")
			cActionPeriod(cc) = 10 + limit(iWeight(ci) / (1 + sSTR(CHARA_PLAYER) * 10 + sGardening(CHARA_PLAYER) * 40), 1, 100)
		}
		if ( gRowAct == ACTION_TRAIN ) {
			if ( gWeather == WEATHER_CLEAR | gWeather == WEATHER_RAIN ) {
				if ( gNextTrain > getgametime() ) {
					txt -1, lang("もう飽きた。", "You are bored.")
					rowactend cc
					return
				}
			}
			gNextTrain = getgametime() + 48
			if ( iID(ci) == ITEM_ID_SKILLBOOK ) {
				txt -1, lang(skillname(iParam1(ci)) + "の学習を始めた。", "You begin to study " + skillname(iParam1(ci)) + ".")
			}
			else {
				txt -1, lang("トレーニングを始めた。", "You start training.")
			}
			if ( gWeather != WEATHER_CLEAR & gWeather != WEATHER_RAIN ) {
				if ( gArea  == AREA_SHELTER | (mField == MAP_FIELD_INDOOR & (mType == MAP_TYPE_HOME | mType == MAP_TYPE_TOWN | mType == MAP_TYPE_VILLAGE)) ) {
					txt -1, lang("外が悪天候なので、じっくりと取り組むことにした。", "The weather's bad outside, you have plenty of time to waste.")
				}
			}
			cActionPeriod(cc) = 50
		}
		gosub *screen_draw
		return
	}
	tc = cRowActTc(cc)
	if ( cActionPeriod(cc) > 0 ) {
		if ( gRowAct == ACTION_HARVEST ) {
			if ( rnd(5) == 0 ) {
				skillexp2 SKILL_NORMAL_GARDENING, CHARA_PLAYER, 20, 4
			}
			if ( rnd(6) == 0 ) {
				if ( rnd(55) > sorg(SKILL_ATTR_STR, cc) + 25 ) {
					skillexp2 SKILL_ATTR_STR, cc, 50
				}
			}
			if ( rnd(8) == 0 ) {
				if ( rnd(55) > sorg(SKILL_ATTR_CON, cc) + 28 ) {
					skillexp2 SKILL_ATTR_CON, cc, 50
				}
			}
			if ( rnd(10) == 0 ) {
				if ( rnd(55) > sorg(SKILL_ATTR_WIL, cc) + 30 ) {
					skillexp2 SKILL_ATTR_WIL, cc, 50
				}
			}
			if ( rnd(4) == 0 ) {
				ctalk cc, 1320, cc, cc
				if ( stat == 0 ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt -1, " *ザクッ* ", " *♪* ", " *ズシュ* ", " *ジャリ* "
					}
					if ( en ) {
						txt -1, "*sing*", "*pull*", "*thud*", "*rumble*", "*gasp*"
					}
				}
			}
		}
		if ( gRowAct == ACTION_TRAIN ) {
			p = 25
			if ( gWeather != WEATHER_CLEAR & gWeather != WEATHER_RAIN ) {
				if ( gArea  == AREA_SHELTER ) {
					p = 5
				}
				if ( gArea  != AREA_SHELTER & mField == MAP_FIELD_INDOOR ) {
					if ( mType == MAP_TYPE_HOME | mType == MAP_TYPE_TOWN | mType == MAP_TYPE_VILLAGE ) {
						p = 5
						gMin  += 30
						if ( gMin  > 1440 ) {
							gHour  += 24
							gMin  = gMin  \ 1440
							gSec  = 0
							cibk = ci
							gosub *label_4143
							ci = cibk
						}
					}
				}
			}
			if ( iID(ci) == ITEM_ID_SKILLBOOK ) {
				if ( rnd(p) == 0 ) {
					skillexp2 iParam1(ci), cc, 25
				}
				if ( rnd(10) == 0 ) {
					ctalk cc, 1321, cc, cc
				}
			}
			else {
				if ( rnd(p) == 0 ) {
					skillexp2 randattb(), cc, 25
				}
				if ( rnd(10) == 0 ) {
					ctalk cc, 1322, cc, cc
				}
			}
		}
		if ( gRowAct == ACTION_STEAL ) {
			if ( iID(ci) == ITEM_ID_IRON_MAIDEN ) {
				if ( rnd(15) == 0 ) {
					rowactend cc
					txt -1, lang("突然ふたが閉まった！", "Suddenly, the iron maiden falls forward.")
					dmghp cc, 9999, DAMAGE_FROM_MAIDEN
					return
				}
			}
			if ( iID(ci) == ITEM_ID_GUILLOTINE ) {
				if ( rnd(15) == 0 ) {
					rowactend cc
					txt -1, lang("突然ギロチンが落ちてきた！", "Suddenly, the guillotine is activated.")
					dmghp cc, 9999, DAMAGE_FROM_GUILLOTINE
					return
				}
			}
			f = 0
			f2 = 0
			tg = inv_getowner(ci)
			if ( tg != (-1) ) {
				if ( cOrgRelation(tg) == RELATION_ENEMY ) {
					f2 = 1
				}
			}
			i = sPickpocket(CHARA_PLAYER) * 5 + sDEX(CHARA_PLAYER) + 25
			if ( gHour  >= 19 | gHour  < 7 ) {
				i = i * 15 / 10
			}
			if ( iQuality(ci) == FIX_QUALITY_GREAT ) {
				i = i * 8 / 10
			}
			if ( iQuality(ci) >= FIX_QUALITY_MIRACLE ) {
				i = i * 5 / 10
			}
			noise = 8
			if ( sStealth(CHARA_PLAYER) > 0 ) {
				noise += sStealth(CHARA_PLAYER) / 30
			}
			make_sound cX(CHARA_PLAYER), cY(CHARA_PLAYER), 5, noise
			repeat 229, 16
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cSleep(cnt) != 0 | cdata(268, cnt) != 0 ) {
					continue
				}
				if ( dist(cX(cnt), cY(cnt), cX(CHARA_PLAYER), cY(CHARA_PLAYER)) > 5 ) {
					continue
				}
				if ( f2 == 1 ) {
					if ( cnt != tg ) {
						continue
					}
				}
				p = rnd(i + 1) * (80 + (synccheck(cnt, -1) == 0) * 50 + dist(cX(cnt), cY(cnt), cX(CHARA_PLAYER), cY(CHARA_PLAYER)) * 20) / 100
				if ( cnt < 57 ) {
					p = p * 2 / 3
				}
				if ( rnd(sPER(cnt) + 1) > p ) {
					if ( synccheck(cnt, -1) ) {
						txt -1, lang(name(cnt) + "は窃盗を見咎めた。", name(cnt) + " notice" + _s(cnt) + " you,")
					}
					else {
						txt -1, lang(name(cnt) + "は不振な物音に気づいた。", name(cnt) + " hear" + _s(cnt) + " loud noise,")
					}
					if ( cRole(cnt) == ROLE_GUARD ) {
						ctalk cnt, 1260, cnt, cc
						if ( stat == 0 ) {
							txt cnt, lang("「貴様、何をしている！」", cnvtalk("You there, stop!")), lang("「スタァァップ！」", cnvtalk("You there, stop!"))
						}
					}
					else {
						ctalk cnt, 1259, cnt, cc
						if ( stat == 0 ) {
							txt cnt, lang("「ガード！ガード！」", cnvtalk("Guards! Guards!"))
						}
					}
					if ( ogTitleStealth == 2 & rnd(4) == 0 ) {
						ctalk cc, 1261, cc, cnt
						if ( stat == 0 ) {
							txt cnt, lang(name(0) + "「お兄ちゃ〜ん」", "\"Brother!\"")
						}
						ctalk cnt, 1262, cnt, cc
						if ( stat == 0 ) {
							txt cnt, lang("「なんだ、妹か」", "\"Huh, it's just a younger sister.\"")
						}
						txt -1, lang("あなたはうまくやりすごした。", "You skillfully evaded detection.")
					}
					else {
						cEmoIcon(cnt) = 20 + 100 * 5
						f = 1
						modimp cnt, -5
					}
				}
			loop
			if ( f ) {
				txt -1, lang("盗みを見咎められた！", "You are found stealing.")
				modkarma 0, -5
				p = inv_getowner(ci)
				if ( tg != (-1) ) {
					if ( cId(p) != CREATURE_ID_EBON_THE_FIRE_GIANT ) {
						if ( cSleep(tg) == 0 & cdata(268, tg) == 0 ) {
							cRelation(tg) = RELATION_HATE
							hostileaction CHARA_PLAYER, tg
							modimp tg, -20
						}
					}
				}
				gohostile
			}
			if ( tg != (-1) ) {
				if ( cExist(tg) != CHAR_STATE_ALIVE ) {
					if ( f != 1 ) {
						txt -1, lang("対象は死んでいる", "The target is dead.")
						f = 1
					}
				}
				if ( cRole(tg) == ROLE_USER ) {
					if ( f != 1 ) {
						txt -1, lang("それは盗めない。", "It can't be stolen.")
						f = 1
					}
				}
				if ( dist(cX(cc), cY(cc), cX(tg), cY(tg)) >= 3 ) {
					if ( f != 1 ) {
						txt -1, lang("対象が見当たらない。", "You lose the target.")
						f = 0
					}
				}
			}
			if ( iNum(ci) <= 0 ) {
				f = 1
			}
			if ( ibit(ITEM_BIT_PRECIOUS, ci) == TRUE ) {
				if ( f != 1 ) {
					txt -1, lang("それは盗めない。", "It can't be stolen.")
					f = 1
				}
			}
			if ( iWeight(ci) >= sSTR(CHARA_PLAYER) * 500 ) {
				if ( f != 1 ) {
					txt -1, lang("重すぎて手に負えない。", "It's too heavy.")
					f = 1
				}
			}
			if ( itemusingfind(ci, TRUE) != (-1) ) {
				if ( f != 1 ) {
					txt -1, lang("そのアイテムは他の誰かが使用中だ。", "Someone else is using the item.")
					f = 1
				}
			}
			if ( f ) {
				txt -1, lang("行動を中断した。", "You abort stealing.")
				rowactend cc
			}
		}
		return
	}
	if ( gRowAct == ACTION_STEAL ) {
		tg = inv_getowner(ci)
		if ( tg != (-1) ) {
			if ( cExist(tg) != CHAR_STATE_ALIVE ) {
				txt -1, lang("行動を中断した。", "You abort stealing.")
				rowactend cc
				return
			}
		}
		in = 1
		if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
			in = iNum(ci)
		}
		ti = inv_getfreeid(CHARA_PLAYER)
		if ( ti == (-1) ) {
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return
		}
		if ( iEquip(ci) != 0 ) {
			tc = inv_getowner(ci)
			if ( tc != (-1) ) {
				p = iEquip(ci)
				cdata(p, tc) = cdata(p, tc) / EXT_EQUIP_SLOTS * 10000
			}
			iEquip(ci) = 0
			r1 = tc
			gosub *charaRefresh
		}
		if ( ibit(ITEM_BIT_DROP, ci) ) {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			ibitmod ITEM_BIT_DROP, ci, FALSE
		}
		item_copy ci, ti
		iNum(ti) = in
		ibitmod ITEM_BIT_STOLEN, ti, TRUE
		iProperty(ti) = PROP_NONE
		iNum(ci) -= in
		if ( iNum(ci) <= 0 ) {
			cell_refresh iX(ci), iY(ci)
		}
		txt -1, lang(itemname(ti) + "を盗んだ。", "You successfully steal " + itemname(ti) + ".")
		if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
			snd SOUNDLIST_GETGOLD1
			iNum(ti) = 0
			se_moneymod 0, in
		}
		else {
			item_stack CHARA_PLAYER, ti, 1
			snd 14 + rnd(2)
		}
		gosub *label_1681
		skillexp2 SKILL_ACTIVE_PICKPOCKET, CHARA_PLAYER, limit(iWeight(ti) / 25, 0, 450) + 50
		r1 = 0
		gosub *label_1601
		if ( cKarma(CHARA_PLAYER) >= (-30) ) {
			if ( rnd(3) == 0 ) {
				txt -1, lang("あなたは良心の呵責を感じた。", "You feel the stings of conscience.")
				modkarma 0, -1
			}
		}
		if ( tc != (-1) ) {
			throwsstpevent "StealItem", tc, itemname(ti, 1), 1
		}
		else {
			throwsstpevent "StealItem", 0, itemname(ti, 1), 0
		}
	}
	if ( gRowAct == ACTION_SLEEP ) {
		txt -1, lang("あなたは眠り込んだ。", "You fall asleep.")
		gosub *sleep
	}
	if ( gRowAct == ACTION_CONSTRUCT ) {
		snd SOUNDLIST_BUILD1
		txt -1, lang(itemname(ci, 1) + "を作り終えた。", "You finish constructing" + itemname(ci, 1) + ".")
		in = 1
		dropval = 1
		gosub *act_drop
	}
	if ( gRowAct == ACTION_OPEN_HATCH ) {
		txt -1, lang(itemname(ci, 1) + "のハッチを回し終えた。", "You finish pulling the hatch of " + itemname(ci, 1) + ".")
		chatteleport = 1
		gReturnArea = gArea , gLevel , cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		gTeleportArea = AREA_SHELTER
		gTeleportLevel = inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)
		levelexitby = MAP_EXIT_TELEPORT
		snd SOUNDLIST_EXITMAP1
	}
	if ( gRowAct == ACTION_HARVEST ) {
		txt -1, lang(itemname(ci, 1) + "を収穫した(" + cnvweight(iWeight(ci)) + ")", "You harvest " + itemname(ci, 1) + ". (" + cnvweight(iWeight(ci)) + ")")
		gosub *act_get
	}
	if ( gRowAct == ACTION_TRAIN ) {
		if ( iID(ci) == ITEM_ID_SKILLBOOK ) {
			txt -1, lang(skillname(iParam1(ci)) + "の学習を終えた。", "You finish studying " + skillname(iParam1(ci)) + ".")
		}
		else {
			txt -1, lang("トレーニングを終えた。", "You finish training.")
		}
	}
	rowactend cc
	return

*label_3309
	redraw 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh - inf_verh
	gmode 2
	gosub *screen_drawStatus
	if ( screenupdate == 0 ) {
		redraw 1
	}
	screenupdate = 0
	return

*sleep_draw_init
	gsel BUFFER_BUF
	gmode 0
	pos 0, 0
	picload_ exedir + "\\graphic\\bg_night.bmp", 1
	pos 0, 0
	gzoom windoww, windowh - inf_verh, 4, 0, 0, 640, 480, 1
	gsel BUFFER_SCREEN
	return

*sleep
	if ( gArea  == AREA_QUEST ) {
		txt -1, lang("しかし、大事な用を思い出して飛び起きた。", "But you can't sleep right now.")
		gSleepGene = 0
		return
	}
	if ( cItemUsing(CHARA_PLAYER) != (-1) ) {
		throwsstpevent "Sleep", gSleepGene, itemname(cItemUsing(CHARA_PLAYER), 1), gSleepGene != 0
	}
	else {
		throwsstpevent "Sleep", gSleepGene, "", gSleepGene != 0
	}
	repeat 245
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( cRole(cnt) == ROLE_ADVENTURER & cbit(CHARA_BIT_HIRED, cnt) != FALSE | cRole(cnt) == ROLE_PET_SENTRY | cRole(cnt) == ROLE_PET_MAID | eqfaction(cnt, "petshop") | cRole(cnt) == ROLE_MAID | cnt < 16 ) {
			if ( synccheck(cnt, -1) ) {
				ctalk cnt, 960, cnt, cnt
			}
		}
	loop
	if ( gGodTalk ) {
		txtgod godcheck(), GOD_TEXT_SLEEP
	}
	redraw 0
	locvar_addnews_hide_popup = 1
	gosub *sleep_draw_init
	musicloop = 1
	music = MUSICLIST_MCCODA
	gosub *music_play
	msg_halt
	repeat 20
		gmode 4, , , cnt * 10
		gosub *label_3309
		await 200
	loop
	gmode 2
	cc = CHARA_PLAYER
	repeat 57
		tc = cnt
		cWet(tc) = 0
		cPoison(tc) = 0
		cSleep(tc) = 0
		cConfuse(tc) = 0
		cBlind(tc) = 0
		if ( gettrait(tc, 195) != 0 ) {
			cBlind(tc) = 1000
		}
		cParalyze(tc) = 0
		cdata(268, tc) = 0
		cDim(tc) = 0
		cDrunk(tc) = 0
		cBleed(tc) = 0
		cGravity(tc) = 0
		gSleep = 0
		cHP(tc) = cMHP(tc)
		cMP(tc) = cMMP(tc)
		cSP(tc) = cMSP(tc)
		healcon tc, CONDITION_SICK, 7 + rnd(7)
		healcon tc, 13, 0
		if ( cbit(CHARA_BIT_ANOREXIA, tc) ) {
			cVomit(tc) -= rnd(6)
		}
		else {
			cVomit(tc) -= rnd(3)
		}
		if ( cVomit(tc) < 0 ) {
			cure_anorexia tc
			cVomit(tc) = 0
		}
		if ( godcheck(tc) != "danalin" ) {
			healsan tc, 10
		}
		if ( cbit(CHARA_BIT_LAY_HANDS, tc) ) {
			cbitmod CHARA_BIT_LAY_HAND_CHARGE, tc, TRUE
		}
		if ( gettrait(tc, 58) ) {
			ocbitmod 9, tc, 1
		}
		ocbitmod 10, tc, 1
	loop
	f = 0
	repeat 16
		if ( cnt == 0 ) {
			continue
		}
		if ( cImpression(cnt) < 200 ) {
			continue
		}
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		f = 1
		break
	loop
	if ( f == 1 & gettrait(0, 178) == 0 ) {
		gosub *nc_yotogi
		if ( stat != (-1) ) {
			cc = CHARA_PLAYER
			tc = stat
			nightfall = 1
			gosub *chat
			nightfall = 0
		}
	}
	mode = MODELIST_TXT_ADV
	timeslept = 7 + rnd(5)
	repeat timeslept
		gHour ++
		gosub *label_4143
		if ( mode != MODELIST_TXT_ADV ) {
			gosub *sleep_draw_init
			mode = MODELIST_TXT_ADV
		}
		gSleep = 0
		gMin  = 0
		cc = CHARA_PLAYER
		gosub *label_3309
		await 500
	loop
	if ( gArea  != AREA_SHELTER ) {
		if ( gArea  != AREA_JAIL ) {
			gosub *label_4635
		}
	}
	if ( gSleepGene != 0 ) {
		tc = -1
		repeat 245 - 1, 1
			if ( cbit(CHARA_BIT_MAKE_GENE, cnt) == TRUE ) {
				if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
					tc = cnt
					break
				}
			}
		loop
		if ( tc != (-1) ) {
			s = lang("遺伝子", "Gene")
			file = "bg_re14"
			buff = lang("" + name(tc) + "とあなたは熱い一夜を供にした。新たな遺伝子が生成された。", "You spent a night with " + name(tc) + ". A new gene is created.")
			f = 0
			if ( ogTitleDeusExMachina == 2 ) {
				inv_getheader 0
				repeat invrange, invhead
					if ( iID(cnt) == ITEM_ID_LITTLE_BALL ) {
						iParam1(cnt) = 1
						f = 1
					}
				loop
				if ( f == 1 ) {
					buff += lang("この遺伝子は固定アーティファクトを含んでいる。", "")
				}
				f = 0
			}
			listmax = 0
			list(0, listmax) = 1
			listn(0, listmax) = lang("ふぅ", "Sweet.")
			listmax++
			cbitmod CHARA_BIT_MAKE_GENE, tc, FALSE
			gosub *label_2485
			gosub *label_3078
		}
	}
	if ( ogMakeChildPartner != 0 ) {
		tc = -1
		repeat 245 - 1, 1
			if ( cbit(CHARA_BIT_MAKE_GENE, cnt) == TRUE ) {
				if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
					tc = cnt
					break
				}
			}
		loop
		if ( tc != (-1) ) {
			s = lang("子供", "Children")
			file = "bg_re14"
			buff = lang("" + name(tc) + "とあなたは熱い一夜を供にした。子供が生まれた。", "You spent a night with " + name(tc) + ". A new child is born.")
			listmax = 0
			list(0, listmax) = 1
			listn(0, listmax) = lang("ふぅ", "Sweet.")
			listmax++
			cbitmod CHARA_BIT_MAKE_GENE, tc, FALSE
			gosub *label_2485
			flt calcobjlv(cLevel(ogMakeChildPartner)), FIX_QUALITY_BAD
			novoidlv = 1
			if ( cId(ogMakeChildPartner) == CREATURE_ID_LITTLE_SISTER | cId(ogMakeChildPartner) == CREATURE_ID_GOD_OF_WISHING ) {
				chid = 176
			}
			else {
				if ( rnd(2) ) {
					chid = cId(ogMakeChildPartner)
				}
				else {
					chid = 0
				}
			}
			if ( rnd(10) ) {
				fltnrace = cnRace(ogMakeChildPartner)
			}
			else {
				p = 75, 41, 160, 176, 6, 278, 169, 330, 91, 161, 284, 335
				chid = p(rnd(12))
			}
			if ( chid == 343 ) {
				initunid = cUNID(ogMakeChildPartner) + 1
			}
			characreate MAX_CHARA_NC, chid, -3, 0
			if ( stat != 0 ) {
				cAge(rc) = gYear 
				if ( instr(cnName(ogMakeChildPartner), 0, lang("の子供", "child")) != (-1) ) {
					sreplace cnName(rc), cnName(ogMakeChildPartner), "の子供", "の子孫"
				}
				else {
					cnName(rc) = lang(cnName(ogMakeChildPartner) + "の子供", "child of " + cnName(ogMakeChildPartner))
				}
				p = rnd(10)
				if ( p >= 0 & p < 5 ) {
					if ( cId(ogMakeChildPartner) != CREATURE_ID_USER ) {
						cPic(rc) = cPic(ogMakeChildPartner)
					}
				}
				if ( p >= 5 & p < 9 ) {
					cPic(rc) = rnd(33) * 2 + 1 + cSex(rc)
					if ( cPic(ogMakeChildPartner) > xy2pic(0, 20) ) {
						cUNID(rc) = cUNID(ogMakeChildPartner)
					}
				}
				if ( cId(ogMakeChildPartner) != CREATURE_ID_PUTIT_TANK & cId(ogMakeChildPartner) != CREATURE_ID_EHEKATL & cId(ogMakeChildPartner) != CREATURE_ID_GOD_INSIDE_EHEKATL & cId(ogMakeChildPartner) != CREATURE_ID_OPATOS & cId(ogMakeChildPartner) != CREATURE_ID_KUMIROMI & cId(ogMakeChildPartner) != CREATURE_ID_ZILLA & cId(ogMakeChildPartner) != CREATURE_ID_MANI & cId(ogMakeChildPartner) != CREATURE_ID_JURE & cId(ogMakeChildPartner) != CREATURE_ID_ITZPALT ) {
					cAiCalm(rc) = cAiCalm(ogMakeChildPartner)
					cAiMoveFreq(rc) = cAiMoveFreq(ogMakeChildPartner)
					cAiDistance(rc) = cAiDistance(ogMakeChildPartner)
					cAiSub(rc) = cAiSub(ogMakeChildPartner)
					cActHeal(rc) = cActHeal(ogMakeChildPartner)
					cActIndex(rc) = cActIndex(ogMakeChildPartner)
					repeat 10
						cdata(STARTING_CDATA_ACT_MAIN + cnt, rc) = cdata(STARTING_CDATA_ACT_MAIN + cnt, ogMakeChildPartner)
					loop
					ocbitmod 0, rc, 1
				}
				rc = MAX_CHARA_NC
				gosub *cm_race_loop_WHILE1
			}
			ogCanMakeChild++
			ogTimesMadeChildren++
			gosub *label_2665
		}
	}
	gosub *label_3309
	if ( cItemUsing(CHARA_PLAYER) != (-1) ) {
		throwsstpevent "Awake", gSleepGene, itemname(cItemUsing(CHARA_PLAYER), 1), gSleepGene != 0
	}
	else {
		throwsstpevent "Awake", gSleepGene, "", gSleepGene != 0
	}
	ogMakeChildPartner = 0
	gSleepGene = 0
	mode = MODELIST_MAIN
	wake_up
	cHunger(cc) -= 1500 / (gettrait(0, 158) + 1)
	if ( ocbit(11, cc) ) {
		modstress 750
	}
	txtef COLOR_GREEN
	txt -1, lang("" + timeslept + "時間眠った。あなたはリフレッシュした。", "You have slept for " + timeslept + " hours. You are refreshed.")
	f = 0
	if ( cItemUsing(CHARA_PLAYER) == (-1) ) {
		f = 1
	}
	else {
		ci = cItemUsing(CHARA_PLAYER)
		if ( iParam1(ci) == 0 | iNum(ci) == 0 | refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) != FILTER_FURNITURE_BED ) {
			f = 1
		}
	}
	if ( f ) {
		txt -1, lang("まあまあの目覚めだ。", "You wake up feeling so so.")
	}
	else {
		i = 0
		repeat 8, 10
			i += sorg(cnt, CHARA_PLAYER)
		loop
		i = limit(i / 6, 10, 1000)
		exp = i * i * i / 10
		if ( ncgSleepPotentialBonus > 0 ) {
			exp *= 1.0 + int(ncgSleepPotentialBonus / 2500) / 10 + 0.1
			ncgSleepPotentialBonus = 0
		}
		if ( gSleepExp >= 1000000 ) {
			gSleepExp = gSleepExp / 100 * iParam1(ci)
		}
		else {
			gSleepExp = gSleepExp * iParam1(ci) / 100
		}
		grown = 0
		repeat
			if ( gSleepExp >= exp ) {
				gSleepExp -= exp
			}
			else {
				if ( cnt != 0 ) {
					break
				}
			}
			modgrowth2 0, 10 + rnd(8), 1
			grown++
			if ( cnt > 6 ) {
				if ( rnd(5) == 0 ) {
					gSleepExp = 0
					break
				}
			}
		loop
		txtef COLOR_GREEN
		txt -1, lang("心地よい目覚めだ。潜在能力が伸びた(計" + grown + "%)", "You wake up feeling good. Your potential increases. (Total:" + grown + "%)")
	}
	msg_halt
	locvar_addnews_hide_popup = 0
	gosub *music_play
	autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
	if ( cfg_noautosave > 1 & gettrait(0, 190) == 0 ) {
		autosave = 0
	}
	repeat 245
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( cRole(cnt) == ROLE_ADVENTURER & cbit(CHARA_BIT_HIRED, cnt) != FALSE | cRole(cnt) == ROLE_PET_SENTRY | cRole(cnt) == ROLE_PET_MAID | eqfaction(cnt, "petshop") | cRole(cnt) == ROLE_MAID | cnt < 16 ) {
			if ( synccheck(cnt, -1) ) {
				ctalk cnt, 959, cnt, cnt
			}
		}
	loop
	if ( gGodTalk ) {
		txtgod godcheck(), 2434
	}
	return

*rest
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_REST
		cActionPeriod(cc) = r1
		txt -1, lang("あなたは横になった。", "You lie down to rest.")
		gosub *screen_draw
		return
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( cActionPeriod(cc) \ 2 == 0 ) {
			healsp cc, 1
		}
		if ( cActionPeriod(cc) \ 3 == 0 ) {
			healhp cc, 1
			healmp cc, 1
		}
		return
	}
	if ( gSleep >= 30 ) {
		f = 0
		if ( gSleep >= 50 ) {
			f = 1
		}
		else {
			if ( rnd(2) == 0 ) {
				f = 1
			}
		}
		if ( f == 1 ) {
			txt -1, lang("あなたはそのまま眠りにおちた…", "After a short while, you drop off to sleep.")
			cItemUsing(cc) = -1
			gosub *sleep
			rowactend cc
			return
		}
	}
	txt -1, lang("あなたは休息を終えた。", "You finished taking a rest.")
	rowactend cc
	return

*travel
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_TRAVEL
		cActionPeriod(cc) = 20
		if ( gWeather == WEATHER_RAIN ) {
			cActionPeriod(cc) = cActionPeriod(cc) * 13 / 10
		}
		if ( gWeather == WEATHER_HARD_RAIN ) {
			cActionPeriod(cc) = cActionPeriod(cc) * 16 / 10
		}
		if ( gWeather == WEATHER_SNOW | chipm(CHIPM_ROLE, mapId(cX(cc), cY(cc))) == MAP_CHIP_ROLE_SNOW ) {
			cActionPeriod(cc) = cActionPeriod(cc) * 22 / 10
		}
		if ( gWeather == WEATHER_ETHER ) {
			cActionPeriod(cc) = cActionPeriod(cc) * 5 / 10
		}
		if ( ogTitleSearchOfMother == 2 ) {
			cActionPeriod(cc) = cActionPeriod(cc) * 8 / 10
		}
		cActionPeriod(cc) = cActionPeriod(cc) * 100 / (100 + gTravelSpeed + sTravel(CHARA_PLAYER))
		return
	}
	if ( cTurn(CHARA_PLAYER) \ 20 == 0 ) {
		if ( cHunger(CHARA_PLAYER) <= 5000 & gettrait(0, 191) == 0 ) {
			inv_getheader cc
			f = 0
			repeat invrange, invhead
				if ( iNum(cnt) == 0 ) {
					continue
				}
				if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) == FILTER_CARGO_FOOD ) {
					f = 1
					ci = cnt
					break
				}
			loop
			if ( f == 1 ) {
				if ( synccheck(cc, -1) ) {
					txt -1, lang(npcn(cc) + itemname(ci, 1) + "を食べ終えた。", name(cc) + " " + have(cc) + " finished eating " + itemname(ci, 1) + ".")
				}
				gosub *insta_eat
			}
		}
	}
	if ( gWeather == WEATHER_SNOW | chipm(CHIPM_ROLE, mapId(cX(cc), cY(cc))) == MAP_CHIP_ROLE_SNOW ) {
		if ( gResWeather == 0 ) {
			if ( rnd(100) == 0 ) {
				if ( cbit(CHARA_BIT_FLOAT, CHARA_PLAYER) == FALSE | cGravity(CHARA_PLAYER) > 0 ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt -1, " *ずぶっ* ", " *ザシュ* ", " *ズボ* ", " *ズサッ* "
					}
					if ( en ) {
						txt -1, " *kisssh*", "*thudd*", "*siz*", "*clump*", "*skritch*"
					}
					cActionPeriod(cc) += 10
				}
			}
			if ( rnd(1000) == 0 ) {
				txtef COLOR_PURPLE
				if ( jp ) {
					txt -1, "積雪のせいで旅程が遅れている。", "雪道を進むのは大変な苦労だ。", "深い雪に脚をとられている。"
				}
				if ( en ) {
					txt -1, "Snow delays your travel.", "You are caught in a snowdrift.", "It's hard to walk on a snowy road."
				}
				cActionPeriod(cc) += 50
			}
		}
		if ( cHunger(CHARA_PLAYER) <= 2000 ) {
			if ( cbit(CHARA_BIT_ANOREXIA, CHARA_PLAYER) == FALSE & cImmuneDamage(CHARA_PLAYER) < 100 & gettrait(0, 191) == 0 ) {
				snd SOUNDLIST_EAT1
				txt -1, lang("空腹のあまり、あなたは積もっている雪を腹にかきこんだ。", "You are too hungry. You chow down snow.")
				cHunger(cc) += 5000
				gosub *eat_finish
				dmgcon CHARA_PLAYER, CONDITION_DIM, 1000
			}
		}
	}
	if ( gWeather == WEATHER_HARD_RAIN ) {
		if ( gResWeather == 0 ) {
			if ( rnd(100) == 0 ) {
				if ( cbit(CHARA_BIT_FLOAT, CHARA_PLAYER) == FALSE | cGravity(CHARA_PLAYER) > 0 ) {
					txtef COLOR_SKY_BLUE
					if ( jp ) {
						txt -1, " *びしゃ* ", " *ザブッ* ", " *パシャッ* ", " *ざぶ* "
					}
					if ( en ) {
						txt -1, "*drip*", "*sip*", "*drizzle*", "*splash*", "*kissh*"
					}
					cActionPeriod(cc) += 5
				}
			}
			if ( cConfuse(CHARA_PLAYER) == 0 ) {
				if ( rnd(500) == 0 ) {
					txtef COLOR_PURPLE
					if ( jp ) {
						txt -1, "雨が激しすぎてどこを歩いているかもわからない！", "あまりにも視界が悪すぎる。", "豪雨のせいで前が全く見えない。"
					}
					if ( en ) {
						txt -1, "It's raining heavily. You lose your way.", "You can't see a thing!"
					}
					cConfuse(CHARA_PLAYER) = 10
				}
			}
			else {
				if ( rnd(5) == 0 ) {
					cConfuse(CHARA_PLAYER) = 10
				}
			}
		}
		cBlind(CHARA_PLAYER) = 3
		if ( gettrait(0, 195) != 0 ) {
			cBlind(CHARA_PLAYER) = 1000
		}
	}
	if ( cActionPeriod(cc) > 0 ) {
		gMin ++
		return
	}
	traveldone = 1
	gTravelDistance += 4
	rowactend cc
	return

*label_3327
	if ( rowactre != 0 ) {
		return
	}
	ci = cItemUsing(cc)
	gosub *label_4452
	return

*get_fish
	flt
	f = 1
	if ( rnd(200) == 0 ) {
		if ( finditemid("blacksmith hammer") ) {
			inititemid = stat
			itemcreate cc, ITEM_ID_CARNEADES_PLANK, -1, -1, 0
			f = 0
		}
	}
	if ( rnd(limitmin(200 - sFishing(CHARA_PLAYER) / 10, 100)) == 0 & f ) {
		fish = 41
		if ( rnd(3) == 0 ) {
			if ( areaType(gArea ) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
				fish = 37
			}
			if ( areaId(gArea ) == AREA_CRYPT_OF_THE_DAMNED ) {
				fish = 38
			}
			if ( areaId(gArea ) == AREA_TOWER_OF_FIRE ) {
				fish = 39
			}
			if ( areaId(gArea ) == AREA_VOID | areaId(gArea ) == 210 ) {
				fish = 40
			}
			if ( oabit(14, gArea ) | (gWeather == WEATHER_ETHER & mField == MAP_FIELD_OUTDOOR) ) {
				fish = 42
			}
			if ( oabit(5, gArea ) ) {
				fish = 43
			}
			if ( gWeather == WEATHER_SNOW & mField == MAP_FIELD_OUTDOOR ) {
				fish = 45
			}
			if ( gWeather == WEATHER_HARD_RAIN & (areaId(gArea ) == 50 | areaId(gArea ) == AREA_PORT_KAPUL) ) {
				fish = 46
			}
			if ( rnd(1000) == 0 | (fish != 41 & rnd(1000) == 0) ) {
				fish = 44
			}
		}
	}
	if ( f ) {
		itemcreate cc, fishdata(FISHDATA_ID, fish), -1, -1, 0
		iSubName(ci) = fish
		iValue(ci) = fishdata(FISHDATA_VALUE, fish)
		iWeight(ci) = fishdata(FISHDATA_WEIGHT, fish)
		if ( fish >= 37 ) {
			iWeight(ci) = fishdata(FISHDATA_WEIGHT, fish) * (rndex(areaMinLevel(gArea )) + 10)
			iValue(ci) = fishdata(FISHDATA_VALUE, fish) * (iWeight(ci) / 10)
			ilight(ci) = LIGHT_TYPE_CRYSTAL
			iParam1(ci) = rndex(2000000000)
			iParam3(ci) = 0
		}
		if ( iID(ci) == ITEM_ID_FISH_JUNK & iSubName(ci) == 30 ) {
			iPic(ci) = xy2pic(0, 13)
			iCol(ci) = 0
			repeat
				iParam1(ci) = rnd(368)
				if ( iParam1(ci) == 212 | iParam1(ci) == 340 ) {
					continue
				}
				if ( iParam1(ci) > 353 & iParam1(ci) < 366 ) {
					iParam1(ci) = 343
				}
				if ( iParam1(ci) == 343 ) {
					if ( usernpcmax == 0 ) {
						continue
					}
					iCNpcId(ci) = rnd(usernpcmax)
					ICNpcSerialNo(ci) = createserialno(userdatan(0, iCNpcId(ci)))
				}
				break
			loop
		}
	}
	if ( cc == CHARA_PLAYER ) {
		txt -1, lang(itemname(ci, 1) + "を釣り上げた！", "You get " + itemname(ci, 1) + "!")
		if ( fish >= 37 ) {
			txtef COLOR_GREEN
			txt -1, lang("これは大物だ！", "This is a big one!")
			if ( synccheck(cc, -1) ) {
				snd SOUNDLIST_DING1
			}
		}
	}
	item_stack cc, ci, 1
	return

*fishing
	if ( cRowAct(cc) == ACTION_NONE ) {
		txt -1, lang("釣りを始めた。", "You start fishing.")
		snd SOUNDLIST_FISH_CAST
		if ( rowactre == 0 ) {
			cItemUsing(cc) = ci
		}
		cRowAct(cc) = ACTION_FISH
		cActionPeriod(cc) = 100
		racount = 0
		fishstat = 0
		gsel BUFFER_PIC2
		pos 0, 0
		picload_ exedir + "\\graphic\\fishing.bmp"
		gsel BUFFER_SCREEN
		return
	}
	if ( rowactre != 0 ) {
		gosub *randomSite
		return
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( rnd(5) == 0 ) {
			fishstat = 1
			gosub *label_3327
		}
		if ( fishstat == 1 ) {
			if ( rnd(5) == 0 ) {
				if ( cfg_st_fishinganimation == 1 ) {
					repeat 4 + rnd(4)
						redraw 0
						fishanime = 1, 3 + rnd(3)
						addefmap fishx, fishy, 4, 2
						if ( gTimeStopTime == 0 ) {
							scrturn++
						}
						gosub *screen_draw
						redraw 1
						await cfg_wait1 * 2
					loop
				}
				if ( rnd(3) == 0 ) {
					fishstat = 2
				}
				if ( rnd(6) == 0 ) {
					fishstat = 0
				}
				fishanime = 0
			}
		}
		if ( fishstat == 2 ) {
			fishanime = 2
			if ( cfg_st_fishinganimation == 1 ) {
				snd SOUNDLIST_WATER2
				cEmoIcon(CHARA_PLAYER) = 20 + 100 * 2
				repeat 8 + rnd(10)
					redraw 0
					if ( gTimeStopTime == 0 ) {
						scrturn++
					}
					gosub *screen_draw
					redraw 1
					await cfg_wait1 * 2
				loop
			}
			if ( rnd(10) ) {
				fishstat = 3
			}
			else {
				fishstat = 0
			}
			fishanime = 0
		}
		if ( fishstat == 3 ) {
			fishanime = 3
			if ( cfg_st_fishinganimation == 1 ) {
				repeat 28 + rnd(15)
					if ( cnt \ 7 == 0 ) {
						snd SOUNDLIST_FISH_FIGHT
					}
					redraw 0
					fishanime(1) = cnt
					if ( gTimeStopTime == 0 ) {
						scrturn++
					}
					gosub *screen_draw
					addefmap fishx, fishy, 5, 2
					redraw 1
					await cfg_wait1 * 2
				loop
			}
			if ( fishdata(FISHDATA_POWER, fish) >= rnd(sFishing(CHARA_PLAYER) + 1) ) {
				fishstat = 0
			}
			else {
				fishstat = 4
			}
			fishanime = 0
		}
		if ( fishstat == 4 ) {
			fishanime = 4
			if ( cfg_st_fishinganimation == 1 ) {
				snd SOUNDLIST_FISH_GET
				repeat 21
					redraw 0
					fishanime(1) = cnt
					if ( cnt == 1 ) {
						addefmap fishx, fishy, 1, 3
					}
					if ( gTimeStopTime == 0 ) {
						scrturn++
					}
					gosub *screen_draw
					redraw 1
					await cfg_wait1 * 2
				loop
				snd 14 + rnd(2)
			}
			fishanime = 0
			rowactend cc
			gosub *get_fish
			r1 = 0
			if ( iID(ci) == ITEM_ID_FISH ) {
				r1 = fishdata(FISHDATA_POWER, iSubName(ci))
			}
			gosub *label_1606
			cEmoIcon(CHARA_PLAYER) = 6 + 100 * 3
			ci = nc_intb_101
			if ( inv_getspace() == 0 ) {
				txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
				return
			}
			txtnew
			txt -1, lang("もう一度釣る？", "Try again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			valhinan = val
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 ) {
					txt -1, lang("釣竿には餌が付いていない。", "You need a bait to fish.")
					txt -1, lang("餌を一括装着する？", "Will you put food all at once?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval != 0 ) {
						return
					}
					ti = ci
					invsubroutine = 1
					invctrl = INVCTRL_MARK_ITEM, 0
					gosub *label_2974
					if ( stat == 0 ) {
						return
					}
					item_separate ti
					txt -1, lang(itemname(ci) + "を" + itemname(ti) + "に装着した。", "Added" + itemname(ti) + "to" + itemname(ci) + ".")
					iParam4(ti) = iParam1(ci)
					repeat
						if ( iNum(ci) == 0 ) {
							break
						}
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) += rnd(10) + 15
						removeitem ci, 1
					loop
					ci = ti
				}
				if ( cSP(CHARA_PLAYER) < 50 ) {
					if ( cSP(CHARA_PLAYER) < rnd(75) ) {
						txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						dmgsp CHARA_PLAYER, skillCost(185) / 2 + 1
						goto *effect_end
					}
				}
				dmgsp CHARA_PLAYER, rnd(skillCost(185) / 2 + 1) + skillCost(185) / 2 + 1
				item_separate ci
				nc_intb_101 = ci
				cItemUsing(cc) = ci
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
				item_autostack cc, ci
				txt -1, lang("釣りを始めた。", "You start fishing.")
				snd SOUNDLIST_FISH_CAST
				cRowAct(cc) = ACTION_FISH
				cActionPeriod(cc) = 100
				racount = 0
				fishstat = 0
				gsel BUFFER_PIC2
				pos 0, 0
				picload_ exedir + "\\graphic\\fishing.bmp"
				gsel BUFFER_SCREEN
				return
			}
		}
		if ( rnd(10) == 0 ) {
			dmgsp cc, 1
		}
		return
	}
	txt -1, lang("何も釣れなかった…", "A waste of a time...")
	rowactend cc
	ci = nc_intb_101
	txtnew
	txt -1, lang("もう一度釣る？", "Try again?")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	valhinan = val
	val = promptx, prompty, 160, 1
	gosub *prompt_key
	if ( rtval == 0 ) {
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 ) {
			txt -1, lang("釣竿には餌が付いていない。", "You need a bait to fish.")
			txt -1, lang("餌を一括装着する？", "Will you put food all at once?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval != 0 ) {
				return
			}
			ti = ci
			invsubroutine = 1
			invctrl = INVCTRL_MARK_ITEM, 0
			gosub *label_2974
			if ( stat == 0 ) {
				return
			}
			item_separate ti
			txt -1, lang(itemname(ci) + "を" + itemname(ti) + "に装着した。", "Added" + itemname(ti) + "to" + itemname(ci) + ".")
			iParam4(ti) = iParam1(ci)
			repeat
				if ( iNum(ci) == 0 ) {
					break
				}
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) += rnd(10) + 15
				removeitem ci, 1
			loop
			ci = ti
		}
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(185) / 2 + 1
				goto *effect_end
			}
		}
		dmgsp CHARA_PLAYER, rnd(skillCost(185) / 2 + 1) + skillCost(185) / 2 + 1
		item_separate ci
		nc_intb_101 = ci
		cItemUsing(cc) = ci
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
		item_autostack cc, ci
		txt -1, lang("釣りを始めた。", "You start fishing.")
		snd SOUNDLIST_FISH_CAST
		cRowAct(cc) = ACTION_FISH
		cActionPeriod(cc) = 100
		racount = 0
		fishstat = 0
		gsel BUFFER_PIC2
		pos 0, 0
		picload_ exedir + "\\graphic\\fishing.bmp"
		gsel BUFFER_SCREEN
		return
	}
	return

*plant
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_PLANT
		cActionPeriod(cc) = 40
		txt -1, lang("採取を始めた。", "You start to search the spot.")
		racount = 0
		return
	}
	if ( rowactre != 0 ) {
		gosub *randomSite
		return
	}
	rowactend cc
	return

*search
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_SEARCH
		cActionPeriod(cc) = 20
		if ( rowactre == 0 ) {
			txt -1, lang("地面を掘り始めた。", "You start to dig the ground.")
		}
		else {
			txt -1, lang("探索を始めた。", "You start to dig the spot.")
		}
		racount = 0
		return
	}
	if ( rowactre != 0 ) {
		gosub *randomSite
		return
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( cTurn(cc) \ 5 == 0 ) {
			ctalk 0, 1302, 0, 0
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang(" *ざくっ* ", "*clink*"), lang(" *カキン* ", "*smash*"), lang(" *ごつっ* ", "*thud*"), lang(" *じゃり* ", "*sing*"), lang(" *♪* ", "*sigh*")
			}
		}
		return
	}
	txt -1, lang("地面を掘り終えた。", "You finish digging.")
	if ( mType == MAP_TYPE_WORLD ) {
		inv_getheader 0
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iID(cnt) == ITEM_ID_TREASURE_MAP ) {
				if ( iParam1(cnt) != 0 ) {
					if ( iParam1(cnt) == cX(CHARA_PLAYER) ) {
						if ( iParam2(cnt) == cY(CHARA_PLAYER) ) {
							if ( iParam3(cnt) == gArea  | iParam3(cnt) == 0 ) {
								snd SOUNDLIST_CHEST1
								txtef COLOR_YELLOW
								txt -1, lang(" *ガチッ* …何かがある！", "*click* ...something is there!")
								msg_halt
								snd SOUNDLIST_DING2
								flt
								itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 2 + rnd(3)
								flt
								itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1 + rnd(3)
								flt
								itemcreate -1, ITEM_ID_GOLD_PIECE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), rnd(10000) + 2000
								if ( ogTitleMewmewmew == 2 & godcheck(cc) == "ehekatl" ) {
									if ( rnd(20) == 0 ) {
										flt
										itemcreate -1, ITEM_ID_HERO_CHEESE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
									}
									if ( rnd(20) == 0 ) {
										flt
										itemcreate -1, ITEM_ID_MAGIC_FRUIT, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
									}
									if ( rnd(20) == 0 ) {
										flt
										itemcreate -1, ITEM_ID_RABBITS_TAIL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
									}
								}
								if ( godcheck() == "krula" ) {
									nc_intb_krula = rnd(5)
									if ( nc_intb_krula == 0 ) {
										if ( rnd(50) >= limit(cPiety(CHARA_PLAYER) / 400, 1, 30) ) {
											nc_intb_krula++
										}
										else {
											snd SOUNDLIST_CURSE3
											txtef COLOR_PURPLE
											txt -1, lang("宝箱に触れた途端、あなたは不気味な感覚に襲われた。", "As soon as you touched the treasure chest, you felt an eerie sensation.")
											repeat 4
												flt calcobjlv(difficulty() + 15)
												fixlv = FIX_QUALITY_GOOD
												flttypemajor = fsetchest(rnd(length(fsetchest)))
												itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
												iStatus(ci) = ITEM_STATUS_CURSED
											loop
										}
									}
									if ( nc_intb_krula == 1 ) {
										if ( rnd(50) >= limit(cPiety(CHARA_PLAYER) / 400, 1, 30) ) {
											nc_intb_krula++
										}
										else {
											snd SOUNDLIST_CURSE3
											txtef COLOR_PURPLE
											txt -1, lang("宝箱に触れた途端、あなたはひどい頭痛におそわれた！", "As soon as you touched the treasure chest, A foul stench floods " + name(tc) + your(tc) + " nostrils!")
											repeat 4
												flt calcobjlv(difficulty() + 15)
												fixlv = FIX_QUALITY_GOOD
												flttypemajor = fsetchest(rnd(length(fsetchest)))
												itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
											loop
										}
									}
									if ( nc_intb_krula == 2 ) {
										repeat 4
											flt calcobjlv(difficulty() + 20), calcfixlv(FIX_QUALITY_GREAT)
											if ( cnt == 0 ) {
												fixlv = FIX_QUALITY_GODLY
											}
											flttypemajor = fsetchest(rnd(length(fsetchest)))
											itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
										loop
									}
									if ( nc_intb_krula == 3 ) {
										snd SOUNDLIST_PRAY1
										txtef COLOR_GREEN
										txt -1, lang("宝箱に触れた途端、クルーラの笑い声が聞こえた。「にゃははっ！」", "Mew! You could hear krula laughing.")
										repeat 4
											flt calcobjlv(difficulty() + 20)
											fixlv = FIX_QUALITY_MIRACLE
											flttypemajor = fsetchest(rnd(length(fsetchest)))
											itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
										loop
									}
									if ( nc_intb_krula == 4 ) {
										snd SOUNDLIST_PRAY1
										txtef COLOR_GREEN
										txt -1, lang("宝箱に触れた途端、クルーラの温かい眼差しを感じた。「にゃーはははっ！」", "MewMewMew! You could hear krula laughing.")
										repeat 4
											flt calcobjlv(difficulty() + 25)
											fixlv = FIX_QUALITY_GODLY
											flttypemajor = fsetchest(rnd(length(fsetchest)))
											itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
										loop
										flt
										itemcreate -1, ITEM_ID_GOLD_PIECE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), rndex(cFame(CHARA_PLAYER) / 300 * 1000) + cFame(CHARA_PLAYER) / 300 * 100
										flt
										itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), rndex(10) + 3
									}
								}
								else {
									repeat 4
										flt calcobjlv(difficulty() + 10), calcfixlv(FIX_QUALITY_GREAT)
										if ( cnt == 0 ) {
											fixlv = FIX_QUALITY_GODLY
										}
										flttypemajor = fsetchest(rnd(length(fsetchest)))
										itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
									loop
								}
								txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
								autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
								if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
									autosave = 0
								}
								iNum(cnt)--
								throwsstpevent "TreasureDigging", 0, "", 0
								break
							}
						}
					}
				}
			}
		loop
	}
	spillfrag refx, refy, 1
	rowactend cc
	return

*dig
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_DIG
		cActionPeriod(cc) = 40
		if ( ogTitleEarthSplitter == 2 & godcheck(cc) == "opatos" ) {
			cActionPeriod(cc) = 5
		}
		if ( rowactre == 0 ) {
			txt -1, lang("壁を掘りはじめた。", "You start to dig the wall.")
		}
		else {
			txt -1, lang("鉱石を掘り始めた。", "You start to dig the mining spot.")
		}
		if ( chipm(CHIPM_ROLE, mapId(refx, refy)) == MAP_CHIP_ROLE_HARD_WALL ) {
			txt -1, lang("この壁はとても固そうだ！", "These walls look pretty hard!")
		}
		countdig = 0
		racount = 0
		pickax = 0
		inv_getheader cc
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iID(cnt) == ITEM_ID_PICKAXE ) {
				pickax = 1
				break
			}
		loop
		return
	}
	if ( rowactre != 0 ) {
		gosub *randomSite
		return
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( rnd(5) == 0 ) {
			dmgsp cc, 1
		}
		countdig++
		f = 0
		if ( pickax == 1 ) {
			if ( chipm(CHIPM_ROLE, mapId(refx, refy)) == MAP_CHIP_ROLE_HARD_WALL ) {
				if ( rnd(12000) / 2 < sSTR(cc) + sMining(cc) * 10 ) {
					f = 1
				}
				p = 30 / 2 - sMining(cc) / 2
				if ( p > 0 ) {
					if ( countdig <= p ) {
						f = 0
					}
				}
			}
			else {
				if ( rnd(1500) / 2 < sSTR(cc) + sMining(cc) * 10 ) {
					f = 1
				}
				p = 20 / 2 - sMining(cc) / 2
				if ( p > 0 ) {
					if ( countdig <= p ) {
						f = 0
					}
				}
			}
		}
		else {
			if ( chipm(CHIPM_ROLE, mapId(refx, refy)) == MAP_CHIP_ROLE_HARD_WALL ) {
				if ( rnd(12000) < sSTR(cc) + sMining(cc) * 10 ) {
					f = 1
				}
				p = 30 - sMining(cc) / 2
				if ( p > 0 ) {
					if ( countdig <= p ) {
						f = 0
					}
				}
			}
			else {
				if ( rnd(1500) < sSTR(cc) + sMining(cc) * 10 ) {
					f = 1
				}
				p = 20 - sMining(cc) / 2
				if ( p > 0 ) {
					if ( countdig <= p ) {
						f = 0
					}
				}
			}
		}
		if ( f == 1 | (flagTutorial == 2 & gArea  == AREA_HOME) ) {
			rtval = 0
			if ( rnd(5) == 0 ) {
				rtval = 54
			}
			if ( rnd(8 - (areaType(gArea ) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */)) * 4) == 0 ) {
				rtval = -1
			}
			if ( mapFeat(refx, refy) != 0 ) {
				cell_featread refx, refy
				if ( featId == CELL_FEATURE_HIDDEN_PATH ) {
					gosub *label_3663
				}
			}
			mapId(refx, refy) = tile_tunnel
			spillfrag refx, refy, 2
			x = refx
			y = refy
			snd SOUNDLIST_CRUSH1
			if ( cfg_nc_workshortening == 0 | autodig_f == 0 ) {
				animeid = ANIMATION_CRUSH
				aniref = 5
				gosub *anime
			}
			txt -1, lang("壁を掘り終えた。", "You finished digging the wall.")
			if ( flagTutorial == 2 & gArea  == AREA_HOME ) {
				flt
				itemcreate -1, ITEM_ID_WORTHLESS_FAKE_GOLD_BAR, digx, digy, 0
				iStatus(ci) = ITEM_STATUS_CURSED
				txt -1, lang("何かを見つけた。", "You found something out of crushed heaps of rock.")
				flagTutorial = 3
			}
			else {
				if ( rtval != 0 & gArea  != AREA_SHELTER ) {
					if ( rtval > 0 ) {
						flt
						itemcreate -1, rtval, digx, digy, 0
					}
					else {
						if ( rtval == (-1) ) {
							if ( rnd(20) == 0 ) {
								if ( rnd(2) == 0 ) {
									flt
									itemcreate -1, ITEM_ID_BROKEN_SWORD, digx, digy, 0
								}
								else {
									flt
									itemcreate -1, ITEM_ID_ANIMAL_BONE, digx, digy, 0
								}
							}
							else {
								flt calcobjlv(gLevel ), calcfixlv(FIX_QUALITY_GREAT)
								flttypemajor = FILTER_ORE
								itemcreate -1, ITEM_ID_DUMMY, digx, digy, 0
							}
							if ( ogTitleInnovation == 2 ) {
								if ( rnd(5) == 0 ) {
									if ( rnd(20) == 0 ) {
										if ( rnd(2) == 0 ) {
											flt
											itemcreate -1, ITEM_ID_BROKEN_SWORD, digx, digy, 0
										}
										else {
											flt
											itemcreate -1, ITEM_ID_ANIMAL_BONE, digx, digy, 0
										}
									}
									else {
										flt calcobjlv(gLevel ), calcfixlv(FIX_QUALITY_GREAT)
										flttypemajor = FILTER_ORE
										itemcreate -1, ITEM_ID_DUMMY, digx, digy, 0
									}
								}
							}
						}
					}
					txt -1, lang("何かを見つけた。", "You found something out of crushed heaps of rock.")
				}
			}
			gosub *label_1593
			rowactend cc
		}
		else {
			if ( cTurn(cc) \ 5 == 0 ) {
				ctalk 0, 1302, 0, 0
				if ( stat == 0 ) {
					txtef COLOR_BLUE
					txt -1, lang(" *ざくっ* ", "*clink*"), lang(" *カキン* ", "*smash*"), lang(" *ごつっ* ", "*thud*"), lang(" *じゃり* ", "*sing*"), lang(" *♪* ", "*sigh*")
				}
			}
		}
		return
	}
	txt -1, lang("背中が痛い…掘るのを諦めた。", "Your back hurts...You give up digging.")
	rowactend cc
	return

*eat
	if ( cRowAct(cc) == ACTION_NONE ) {
		cRowAct(cc) = ACTION_EAT
		cActionPeriod(cc) = 8
		if ( cc < MAX_CHARA_FOLLOWER ) {
			if ( ogTitleDecoy == 2 ) {
				cActionPeriod(cc) = 4
			}
		}
		cItemUsing(cc) = ci
		if ( synccheck(cc, -1) ) {
			snd SOUNDLIST_EAT1
			if ( iProperty(ci) == PROP_NPC & cc < MAX_CHARA_FOLLOWER ) {
				txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "をこっそりと口に運んだ。", name(cc) + " start" + _s(cc) + " to eat " + itemname(ci, 1) + " in secret.")
			}
			else {
				txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "を口に運んだ。", name(cc) + " start" + _s(cc) + " to eat " + itemname(ci, 1) + ".")
			}
			if ( iID(ci) == ITEM_ID_CORPSE & iSubName(ci) == 344 ) {
				txt cc, lang("「いただきマンモス」", cnvtalk("Let's eatammoth."))
			}
		}
		return
	}
	if ( cActionPeriod(cc) > 0 ) {
		return
	}
	if ( synccheck(cc, -1) ) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を食べ終えた。", name(cc) + " " + have(cc) + " finished eating " + itemname(ci, 1) + ".")
	}
	gosub *insta_eat
	rowactend cc
	return

*insta_eat
	cieat = ci
	gosub *foodRotten
	ci = cieat
	if ( cc == CHARA_PLAYER ) {
		item_identify ci, ITEM_KNOWN_NAME
	}
	chara_unequip ci
	if ( stat == 1 ) {
		r1 = cc
		gosub *charaRefresh
	}
	if ( iID(ci) != ITEM_ID_INFIEA ) {
		iNum(ci)--
	}
	if ( ci >= 5080 ) {
		cell_refresh iX(ci), iY(ci)
	}
	else {
		if ( cc == CHARA_PLAYER ) {
			gosub *label_1681
		}
	}
	if ( cc == CHARA_PLAYER ) {
		gosub *eat_finish
	}
	else {
		if ( ci == cAiItem(cc) ) {
			cAiItem(cc) = 0
		}
		if ( cbit(CHARA_BIT_POISON_FLAG, cc) ) {
			if ( iMaterial(ci) == ITEM_MATERIAL_RAW ) {
				if ( iParam3(ci) < 0 ) {
					ctalk cc, 1248, cc, cc
					if ( stat == 0 ) {
						txtef COLOR_SKY_BLUE
						if ( jp ) {
							txt cc, "「うぐぐ！なんだこの飯は！」", "「うっ！」", "「……！！」", "「あれれ…」", "「…これは何の嫌がらせですか」", "「まずい！」"
						}
						if ( en ) {
							txt cc, cnvtalk("Yuck!!"), cnvtalk("....!!"), cnvtalk("W-What..."), cnvtalk("Are you teasing me?"), cnvtalk("You fool!")
						}
					}
					dmghp cc, 999, DAMAGE_FROM_BAD_FOOD
					if ( cExist(cc) != CHAR_STATE_ALIVE ) {
						if ( cRelation(cc) > RELATION_NEUTRAL ) {
							modkarma 0, -5
						}
						else {
							modkarma 0, -1
						}
					}
					modimp tc, -25
					return
				}
			}
		}
	}
	chara_anorexia cc
	if ( iID(ci) == ITEM_ID_KAGAMI_MOCHI & rnd(3) | (iID(ci) == ITEM_ID_MOCHI & rnd(10) == 0) ) {
		if ( synccheck(cc, -1) ) {
			txtef COLOR_PURPLE
			txt -1, lang(name(cc) + "はもちを喉につまらせた！", name(cc) + " choke" + _s(cc) + " on mochi!")
			ctalk cc, 1243, cc, cc
			if ( stat == 0 ) {
				txt cc, lang("「むがっ」", cnvtalk("Mm-ghmm"))
			}
		}
		cMochi(cc)++
	}
	return

*eat_finish
	txtef COLOR_GREEN
	if ( cHunger(cc) >= 12000 ) {
		txt -1, lang("もう当分食べなくてもいい。", "Phew! You are pretty bloated."), lang("こんなに食べたことはない！", "You've never eaten this much before!"), lang("信じられないぐらい満腹だ！", "Your stomach is unbelievably full!")
		return
	}
	if ( cHunger(cc) >= 10000 ) {
		txt -1, lang("あなたは満足した。", "You are satisfied!"), lang("満腹だ！", "This hearty meal has filled your stomach."), lang("あなたは食欲を満たした。", "You really ate!"), lang("あなたは幸せそうに腹をさすった。", "You pat your stomach contentedly.")
		return
	}
	if ( cHunger(cc) >= 5000 ) {
		txt -1, lang("まだ食べられるな…", "You can eat more."), lang("あなたは腹をさすった。", "You pat your stomach."), lang("少し食欲を満たした。", "You satisfied your appetite a little.")
		return
	}
	if ( cHunger(cc) >= 2000 ) {
		txt -1, lang("まだまだ食べたりない。", "You are still a bit hungry."), lang("物足りない…", "Not enough..."), lang("まだ空腹だ。", "You want to eat more."), lang("少しは腹の足しになったか…", "Your stomach is still somewhat empty.")
		return
	}
	if ( cHunger(cc) >= 1000 ) {
		txt -1, lang("全然食べたりない！", "No, it was not enough at all."), lang("腹の足しにもならない。", "You still feel very hungry."), lang("すぐにまた腹が鳴った。", "You aren't satisfied.")
		return
	}
	txt -1, lang("こんな量では意味がない！", "It didn't help you from starving!"), lang("これぐらいでは、死を少し先に延ばしただけだ。", "It prolonged your death for seconds."), lang("無意味だ…もっと栄養をとらなければ。", "Empty! Your stomach is still empty!")
	return

*lockpick
	if ( noread == 1 ) {
		noread = 0
		return
	}
	if ( cRowAct(cc) == ACTION_NONE ) {
		r4 = 1
		if ( iID(ci) == ITEM_ID_ANCIENT_BOOK ) {
			if ( iParam2(ci) != 0 ) {
				txt -1, lang("それは既に解読済みだ。", "You already have decoded the book.")
				return
			}
		}
		if ( cBlind(cc) != 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
			}
			return
		}
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 & iID(ci) == ITEM_ID_SPELLBOOK_OF_ALL ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(itemname(ci, 1) + "の魔力が足りない。", name(cc) + " dont" + _s(cc) + " to read " + itemname(ci, 1) + ".")
				return
			}
		}
		cRowAct(cc) = ACTION_READ
		if ( iID(ci) == ITEM_ID_FISH_JUNK & iSubName(ci) == 30 ) {
			cActionPeriod(cc) = 25 + rnd(10)
		}
		else {
			if ( iID(ci) == ITEM_ID_RECIPE ) {
				p = 50
			}
			else {
				if ( iID(ci) == ITEM_ID_ANCIENT_BOOK ) {
					p = 50 + iParam1(ci) * 50 + iParam1(ci) * iParam1(ci) * 20
				}
				else {
					p = skillDiff(efid)
				}
			}
			cActionPeriod(cc) = p / (2 + sLiteracy(CHARA_PLAYER)) + 1
			item_separate ci
		}
		cItemUsing(cc) = ci
		if ( synccheck(cc, -1) ) {
			txt -1, lang(npcn(cc) + itemname(ci, 1) + "を読み始めた。", name(cc) + " start" + _s(cc) + " to read " + itemname(ci, 1) + ".")
		}
		if ( findbuff(cc, 64) != (-1) ) {
			if ( iID(ci) != ITEM_ID_RECIPE & iID(ci) != ITEM_ID_ANCIENT_BOOK ) {
				txt -1, lang("今は一瞬で読める。", "Very Easy.")
				gosub *label_1594
				cActionPeriod(cc) = 0
			}
		}
		else {
			if ( gettrait(cc, 78) ) {
				if ( iID(ci) != ITEM_ID_RECIPE & iID(ci) != ITEM_ID_ANCIENT_BOOK ) {
					ancient = 0
					repeat length(isethighspell)
						if ( isethighspell(cnt) + 400 == efid ) {
							ancient = 1
							break
						}
					loop
					if ( ancient == 0 & itemmemory(2, iID(ci)) != 0 & calcread(skillDiff(efid), efid, 50) ) {
						txt -1, lang("楽勝だ。", "Easy.")
						r4 = inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) * cActionPeriod(cc)
						gosub *label_1594
						cActionPeriod(cc) = 0
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
					}
				}
			}
		}
		return
	}
	if ( iID(ci) == ITEM_ID_FISH_JUNK & iSubName(ci) == 30 ) {
		actionsp CHARA_PLAYER, 1 + rnd(2)
		if ( stat == 0 ) {
			txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
			rowactend cc
			rowactend tc
			return
		}
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( iID(ci) == ITEM_ID_FISH_JUNK & iSubName(ci) == 30 ) {
			cEmoIcon(cc) = 17 + 100 * 3
			repeat 245
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( synccheck(cc, -1) ) {
					if ( cSync(cnt) != msync ) {
						continue
					}
				}
				else {
					if ( dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3 ) {
						continue
					}
				}
				if ( cSleep(cnt) > 0 | cdata(268, cnt) > 0 ) {
					continue
				}
				x = cX(cnt)
				y = cY(cnt)
				if ( mapChara(x, y) == 0 ) {
					continue
				}
				tc = cnt
				if ( tc == cc ) {
					continue
				}
				if ( cRowAct(tc) != ACTION_NONE ) {
					continue
				}
				if ( rnd(5) == 0 ) {
					if ( synccheck(cc, -1) ) {
						txtef COLOR_SKY_BLUE
						ctalk tc, 423, cc, tc, iParam1(ci)
						if ( stat == 0 ) {
							ctalk tc, 424, cc, tc
						}
					}
				}
			loop
			if ( cActionPeriod(cc) \ 5 == 0 ) {
				if ( synccheck(cc, -1) ) {
					ctalk cc, 1305, cc, cc, iParam1(ci)
					if ( stat == 0 ) {
						ctalk cc, 1304, cc, cc
						if ( stat == 0 ) {
							txtef COLOR_SKY_BLUE
							if ( jp ) {
								txt cc, "*シュッシュ*", "「くっ…」", "「あっ」", "「はぁはぁ！」", "「ふぅふぅ」"
							}
							else {
								txt cc, cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("come on!")
							}
						}
					}
				}
			}
		}
		else {
			ci = cItemUsing(cc)
			cibkread = ci
			gosub *label_1594
			if ( cActionPeriod(cc) \ 5 == 0 ) {
				if ( synccheck(cc, -1) ) {
					ctalk cc, 1303, cc, cc
				}
			}
			if ( iID(ci) == ITEM_ID_RECIPE ) {
				return
			}
			if ( iID(ci) == ITEM_ID_ANCIENT_BOOK ) {
				r2 = 50 + iParam1(ci) * 50 + iParam1(ci) * iParam1(ci) * 20
				r3 = 0
			}
			else {
				r2 = skillDiff(efid)
				r3 = efid
			}
			if ( iStatus(ci) >= ITEM_STATUS_BLESSED ) {
				r2 = r2 * 100 / 120
			}
			if ( iStatus(ci) <= ITEM_STATUS_CURSED ) {
				r2 = r2 * 150 / 100
			}
			gosub *calcReadCheck
			ci = cibkread
			if ( stat == 0 ) {
				rowactend cc
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) < 0 ) {
					inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
				}
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 & iID(ci) != ITEM_ID_SPELLBOOK_OF_ALL ) {
					iNum(ci)--
					if ( ci >= 5080 ) {
						cell_refresh iX(ci), iY(ci)
					}
					else {
						gosub *label_1681
					}
					if ( synccheck(cc, -1) ) {
						txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
						ctalk cc, 1310, cc, cc
					}
				}
				else {
					item_autostack cc, ci
				}
			}
		}
		return
	}
	if ( synccheck(cc, -1) ) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を読み終えた。", name(cc) + " " + have(cc) + " finished reading the book.")
		if ( iQuality(ci) == FIX_QUALITY_UNIQUE & iID(ci) != ITEM_ID_SPELLBOOK_OF_ALL ) {
			allyctrl = 4
			gosub *label_2611
			if ( stat != (-1) ) {
				rc = stat
				rc_subact = int(cActIndex(rc) / 10)
				if ( rc_subact == 5 ) {
					txt -1, lang(cnName(rc) + "はこれ以上新しい技能を覚えることが出来ない。", cnName(rc) + "cannot learn any more skills.")
				}
				else {
					snd SOUNDLIST_DING2
					txtnew
					txtef COLOR_GREEN
					txt -1, lang(cnName(rc) + "は" + skillname(efid) + "を習得した！", cnName(rc) + " learns " + skillname(efid) + "!")
					cdata(STARTING_CDATA_ACT_SUB + rc_subact, rc) = efid
					cActIndex(rc) += 10
				}
			}
		}
		if ( iID(ci) == ITEM_ID_FISH_JUNK & iSubName(ci) == 30 ) {
			ctalk cc, 1307, cc, cc, iParam1(ci)
			if ( stat == 0 ) {
				ctalk cc, 1306, cc, cc
			}
			if ( jp ) {
				txt -1, "あなたは満足した。", "あなたは爽快な気分になった。", "あなたは自己嫌悪に陥った。", "あなたは最低だ。", "あなたは冷静さを取り戻した。"
			}
			else {
				txt -1, "You feel satisfied.", "You feel an exhilarating rush.", "You feel disgusted with yourself.", "You feel awful.", "You regain your composure."
			}
		}
	}
	if ( iID(ci) == ITEM_ID_FISH_JUNK & iSubName(ci) == 30 ) {
		addbuff cc, BUFF_DIVINE_WISDOM, 300 + iLevel(ci) * 15, 60
		animeload 11, cc
		if ( ocbit(11, cc) ) {
			if ( gettrait(cc, 185) ) {
				modstress -150
			}
		}
	}
	else {
		if ( iID(ci) == ITEM_ID_RECIPE ) {
			if ( iParam1(ci) == 0 ) {
				rowactend cc
				return 1
			}
			txt -1, lang(itemname(ci, 1) + "を覚えた！", "You learned the recipe!")
			recipememory(iSubName(ci))++
			item_identify ci, ITEM_KNOWN_NAME
			removeitem ci, 1
			if ( synccheck(cc, -1) ) {
				txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
				ctalk cc, 1310, cc, cc
			}
			rowactend cc
			return 1
		}
		if ( iID(ci) == ITEM_ID_ANCIENT_BOOK ) {
			item_identify ci, ITEM_KNOWN_FULL
			txt -1, lang(itemname(ci, 1) + "を解読した！", "You finished decoding " + itemname(ci, 1) + "!")
			iParam2(ci) = 1
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 1
			ibitmod ITEM_BIT_CHARGE_ITEM, ci, FALSE
			item_stack CHARA_PLAYER, ci, 1
		}
		else {
			if ( iID(ci) == ITEM_ID_SPELLBOOK_OF_ALL ) {
				gosub *label_5013
			}
			if ( findbuff(cc, 64) != (-1) ) {
				skillgain cc, efid, 1 * r4, ((rnd(100 / 2 + 1) + 100 / 2) * (90 + sMemorize(cc) + (sMemorize(cc) > 0) * 20) / limit(100 + spell(efid - 400) / 2, 50, 1000) + 1) * r4 / 2
			}
			else {
				skillgain cc, efid, 1 * r4, ((rnd(100 / 2 + 1) + 100 / 2) * (90 + sMemorize(cc) + (sMemorize(cc) > 0) * 20) / limit(100 + spell(efid - 400) / 2, 50, 1000) + 1) * r4
			}
			gosub *label_1607
			if ( itemmemory(2, iID(ci)) == 0 ) {
				itemmemory(2, iID(ci)) = 1
			}
		}
		item_identify ci, ITEM_KNOWN_NAME
		if ( iID(ci) != ITEM_ID_ANCIENT_BOOK ) {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
			if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) < 0 ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			}
			if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 & iID(ci) != ITEM_ID_SPELLBOOK_OF_ALL ) {
				removeitem ci, 1
				if ( synccheck(cc, -1) ) {
					txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
					ctalk cc, 1310, cc, cc
				}
			}
			else {
				item_autostack cc, ci
			}
		}
	}
	rowactend cc
	return 1

*read
	if ( cBlind(cc) != 0 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
		}
		return
	}
	if ( iID(ci) == ITEM_ID_LICENCE_THE_VOID_EXPLORER ) {
		snd SOUNDLIST_BOOK1
		txt -1, lang("すくつの探索を許可する、という内容の文面が形式的に書いてある。", "According to the card, you are permitted to explore the void now.")
		return 1
	}
	if ( iID(ci) == ITEM_ID_DRAGON_SLAYER ) {
		snd SOUNDLIST_BOOK1
		if ( gArea  != 210 ) {
			txt -1, lang("あなたは少し身震いした。周囲の大気がざわめきだした。", "You shuddered a little. The air around you becomes charged.")
			if ( areaId(210) != 210 ) {
				areaId(210) = 210
				areaIcon(210) = xy2pic(0, 0)
				areaType(210) = (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */)
				areaX(210) = 0
				areaY(210) = 1
				areaStartOn(210) = 1
				areaTileFile(210) = 1
				areaTileSet(210) = 0
				areaMaxLevel(210) = 10000000
				areaMinLevel(210) = 50
				areaCanSave(210) = 99999999
				areaField(210) = 1
				areaRestorePos(210) = 0
				areaIcon(210) = 0
			}
			ncgDeepestAbyssFloorThisTime = 1
			gTeleportArea = 210, 1
			gReturn  = 15 + rnd(15)
		}
		else {
			txt -1, lang("ここでは使用できない。", "Nope.")
		}
		return 1
	}
	if ( iID(ci) == ITEM_ID_SKILLBOOK ) {
		gosub *label_3046
		if ( stat == 1 ) {
			return 1
		}
		else {
			return 0
		}
	}
	if ( iID(ci) == ITEM_ID_BOOK_RACHEL ) {
		snd SOUNDLIST_BOOK1
		txt -1, lang("レイチェルという作家による、心あたたまる童話集だ。", "It's a lovely fairy tale written by Rachel.")
		return 1
	}
	tc = cc
	item_identify ci, ITEM_KNOWN_NAME
	gosub *com_book
	return 1

#deffunc calcmagiccontrol int calcmagiccontrol_arg1, int calcmagiccontrol_arg2
	if ( sMagicControl(calcmagiccontrol_arg1) != 0 ) {
		if ( cRelation(calcmagiccontrol_arg1) >= RELATION_NEUTRAL & cRelation(calcmagiccontrol_arg2) >= RELATION_NEUTRAL | (cRelation(calcmagiccontrol_arg1) == RELATION_DISLIKE & cRelation(calcmagiccontrol_arg2) == RELATION_DISLIKE) | (cRelation(calcmagiccontrol_arg1) <= RELATION_HATE & cRelation(calcmagiccontrol_arg2) <= RELATION_HATE) ) {
			if ( relationbetween(cc, tc) >= (-1) ) {
				if ( sMagicControl(calcmagiccontrol_arg1) * 5 > rnd(dmg + 1) ) {
					dmg = 0
				}
				else {
					dmg = rnd(dmg * 100 / (100 + sMagicControl(calcmagiccontrol_arg1) * 10) + 1)
				}
				if ( skillTg(efid) == 10000 ) {
					if ( nc_gettrait(calcmagiccontrol_arg1, 111) > 0 ) {
						dmg = 0
					}
				}
				if ( dmg < 1 ) {
					if ( synccheck(calcmagiccontrol_arg2, -1) & weaponenc == 0 ) {
						txt -1, lang(name(calcmagiccontrol_arg2) + "は巻き込みを免れた。", "The spell passes through " + name(calcmagiccontrol_arg2) + ".")
					}
					skillexp2 SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg1, 8, 4
					return 1
				}
				skillexp2 SKILL_NORMAL_CONTROL_MAGIC, calcmagiccontrol_arg1, 30, 2
			}
		}
	}
	if ( skillTg(efid) == 9006 ) {
		if ( cRelation(calcmagiccontrol_arg1) >= RELATION_NEUTRAL & cRelation(calcmagiccontrol_arg2) >= RELATION_NEUTRAL | (cRelation(calcmagiccontrol_arg1) == RELATION_DISLIKE & cRelation(calcmagiccontrol_arg2) == RELATION_DISLIKE) | (cRelation(calcmagiccontrol_arg1) <= RELATION_HATE & cRelation(calcmagiccontrol_arg2) <= RELATION_HATE) ) {
			if ( relationbetween(cc, tc) >= (-1) ) {
				if ( nc_gettrait(calcmagiccontrol_arg1, 111) > 0 ) {
					dmg = 0
					if ( dmg < 1 ) {
						if ( synccheck(calcmagiccontrol_arg2, -1) & weaponenc == 0 ) {
							txt -1, lang(name(calcmagiccontrol_arg2) + "は巻き込みを免れた。", "The spell passes through " + name(calcmagiccontrol_arg2) + ".")
						}
						return 1
					}
				}
			}
		}
	}
	return 0

*cast
	spellbk = efid
	ccbk = cc
	gosub *cast_proc
	if ( stat == 1 ) {
		if ( cRowAct(ccbk) != 20003 | cActionPeriod(ccbk) == 0 ) {
			if ( efid >= 550 & efid <= 599 ) {
				repeat 3, 6
					p = userspelldata(cnt, efid - 550)
					if ( p == 0 ) {
						break
					}
					p = p - 1, efp / 3
					if ( p == 19 ) {
						cPiety(ccbk) -= p(1)
					}
					else {
						if ( p == 20 ) {
							dmghp ccbk, p(1) * 2 / 3, DAMAGE_FROM_OVERCAST
						}
						else {
							if ( p == 21 ) {
								dmgsp ccbk, p(1) / 15
							}
							else {
								if ( p == 23 ) {
									cBleed(ccbk) += p(1) / 25
								}
								else {
									if ( p == 24 ) {
										calcbuff CALCBUFF_DURATION, BUFF_MIST_OF_SILENCE, p(1)
										addbuff ccbk, BUFF_MIST_OF_SILENCE, p(1), dur, 1
									}
									else {
										if ( p == 25 ) {
											cInsane(ccbk) += p(1) / 8
										}
										else {
											if ( p == 28 ) {
												cParalyze(ccbk) += p(1) / 10
											}
											else {
												if ( p == 29 ) {
													cDim(ccbk) += (rndex(p(1) / 2 + 1) + p(1) / 2) / 24
												}
											}
										}
									}
								}
							}
						}
					}
				loop
			}
			cc = ccbk
			r1 = cc
			r2 = spellbk
			gosub *label_1598
		}
		return 1
	}
	return 0

*cast_proc
	efsource = 3
	efstatus = 0
	efp = calcspellpower(efid, cc)
	if ( gettrait(cc, 219) ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "の血は熱くなった。", his(cc) + " blood starts boiling.")
		}
		efsource = 0
		return 0
	}
	if ( gettrait(cc, 171) ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は魔法を使えない。", name(cc) + " cannot use magic.")
		}
		efsource = 0
		return 0
	}
	if ( cc == CHARA_PLAYER ) {
		if ( cfg_overcastspell ) {
			if ( delaymagic == 0 ) {
				if ( calcspellcostmp(efid, cc) > cMP(cc) ) {
					txt -1, lang("マナが足りないが、それでも詠唱を試みる？", "You are going to over-cast the spell. Are you sure?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval != 0 ) {
						gosub *screen_draw
						efsource = 0
						return 0
					}
				}
				screenupdate = -1
				gosub *screen_draw
			}
		}
		if ( efid >= 550 & efid <= 599 ) {
			f = 0
			p(1) = efp / 3
			repeat 3, 6
				p = userspelldata(cnt, efid - 550)
				if ( p == 0 ) {
					break
				}
				p = p - 1
				if ( p == 0 ) {
					if ( gHour  < 10 | gHour  > 15 ) {
						f = 1
						break
					}
				}
				else {
					if ( p == 1 ) {
						if ( gHour  >= 7 & gHour  < 19 ) {
							f = 1
							break
						}
					}
					else {
						if ( p == 2 ) {
							if ( gWeather != WEATHER_RAIN ) {
								f = 1
								break
							}
						}
						else {
							if ( p == 3 ) {
								if ( gWeather != WEATHER_HARD_RAIN ) {
									f = 1
									break
								}
							}
							else {
								if ( p == 4 ) {
									if ( gWeather != WEATHER_CLEAR ) {
										f = 1
										break
									}
								}
								else {
									if ( p == 5 ) {
										if ( gWeather != WEATHER_SNOW ) {
											f = 1
											break
										}
									}
									else {
										if ( p >= 6 & p <= 17 ) {
											if ( gMonth  != p - 5 ) {
												f = 1
												break
											}
										}
										else {
											if ( p == 18 ) {
												i = 0
												repeat 15, 1
													if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
														i++
													}
												loop
												if ( i == 0 ) {
													f = 1
													break
												}
												repeat 15, 1
													if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
														if ( cMP(cnt) < p(1) / i ) {
															f = 1
															break
														}
													}
												loop
												if ( f ) {
													break
												}
												repeat 15, 1
													if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
														dmgmp cnt, p(1) / i
													}
												loop
											}
											else {
												if ( p == 19 ) {
													if ( cPiety(cc) < p(1) ) {
														f = 1
														break
													}
												}
												else {
													if ( p == 21 ) {
														if ( cSP(cc) < p(1) / 15 ) {
															f = 1
															break
														}
													}
													else {
														if ( p == 26 ) {
															if ( mField == MAP_FIELD_OUTDOOR ) {
																f = 1
																break
															}
														}
														else {
															if ( p == 27 ) {
																if ( mField != MAP_FIELD_OUTDOOR ) {
																	f = 1
																	break
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			loop
			if ( f ) {
				txt -1, lang("今は使えない。", "You cannot use that spell now.")
				efsource = 0
				return 0
			}
			if ( delaymagic ) {
				delaymagic = 0
			}
			else {
				f = 0
				repeat 3, 6
					p = userspelldata(cnt, efid - 550)
					if ( p == 0 ) {
						break
					}
					if ( p - 1 == 22 ) {
						f = 1
						break
					}
				loop
				if ( f ) {
					cRowAct(cc) = 20003
					cActionPeriod(cc) = 3 + limit(p(1) / 150, 0, 2147483644)
					cItemUsing(cc) = efid
					efsource = 0
					txt -1, lang(name(cc) + "は" + skillname(efid) + "の魔法の詠唱をはじめた。", name(cc) + " begin" + _s(cc) + " casting " + skillname(efid) + ".")
					return 1
				}
			}
		}
	}
	gosub *effect_selectTg
	if ( stat == 0 ) {
		efsource = 0
		return 0
	}
	if ( cc != CHARA_PLAYER ) {
		if ( skillType(efid) == 7 ) {
			procid = (procid + 1) \ 10
			proclist(procid) = "skSummon" + " ct:" + ct
			if ( dbg_outputdebuglog ) {
			}
			if ( cRelation(cc) == RELATION_ALLY | gArea  == AREA_PET_ARENA | gArea  == 49 ) {
				efsource = 0
				return 0
			}
			if ( gTurn \ 10 > 4 ) {
				efsource = 0
				return 0
			}
		}
	}
	if ( skillType(efid) >= 1 & skillType(efid) <= 4 ) {
		if ( gettrait(cc, 79) ) {
			if ( rnd(100) < calctraitscore(stat) ) {
				if ( cc == CHARA_PLAYER | rnd(3) == 0 ) {
					magiccritical = 1
				}
			}
		}
	}
	if ( cc == CHARA_PLAYER | (cc != CHARA_PLAYER & npccostmp == 1) ) {
		if ( cc == CHARA_PLAYER ) {
			if ( efid >= 550 & efid <= 599 ) {
				userspelldata(11, efid - 550) -= calcuserspellcoststock(efid - 550)
				if ( userspelldata(11, efid - 550) < 0 ) {
					userspelldata(11, efid - 550) = 0
				}
			}
			else {
				spell(efid - 400) -= calcspellcoststock(efid, cc)
				if ( spell(efid - 400) < 0 ) {
					spell(efid - 400) = 0
				}
			}
		}
		mp = calcspellcostmp(efid, cc)
		if ( godcheck(cc) == "ehekatl" ) {
			graceofgod = cPiety(cc) / 500
			if ( graceofgod > 40 ) {
				graceofgod = 40
			}
			mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
		}
		nc_intb_001 = 0
		nc_intb_002 = 0
		nc_intb_003 = 0
		repeat 30, 100
			dup roopbuf, cdata(cnt, cc)
			if ( roopbuf \ 10000 == 0 ) {
				continue
			}
			nc_intb_002 = roopbuf \ 10000 - 1
			if ( inv(37, nc_intb_002) == 7 ) {
				nc_intb_001 += inv(38, nc_intb_002)
				continue
			}
			if ( inv(37, nc_intb_002) == 8 ) {
				nc_intb_003 += inv(38, nc_intb_002)
				continue
			}
		loop
		if ( nc_intb_001 > 0 ) {
			mp = mp * (100 - nc_intb_001) / 100
		}
		if ( nc_intb_003 > 0 ) {
			healamo = mp / 100 * nc_intb_003
			healhp cc, healamo
			if ( showdamagecheck(healamo) ) {
				if ( synccheck(tc, -1) ) {
					mondmgn(mondmgcnt) = "" + healamo
					mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, cc, cc
					ccolor 110
					if ( stat == 0 ) {
						mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
					}
					mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
				}
			}
		}
		if ( nc_gettrait(cc, 112) == 0 | rnd(4) ) {
			dmgmp cc, mp
		}
		if ( cExist(cc) != CHAR_STATE_ALIVE ) {
			efsource = 0
			magiccritical = 0
			return 1
		}
	}
	if ( cConfuse(cc) != 0 | cDim(cc) != 0 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は混乱しながらも魔法の詠唱を試みた。", name(cc) + " try" + _s(cc) + " to cast a spell in confusion.")
			ctalk cc, 1276, cc, tc, efid
		}
		tcbk = tc
		gosub *calcReadCheck
		tc = tcbk
		if ( stat == 0 ) {
			efsource = 0
			magiccritical = 0
			return 1
		}
	}
	else {
		if ( synccheck(cc, -1) ) {
			if ( cc == CHARA_PLAYER ) {
				if ( cc == tc ) {
					ctalk cc, 965, cc, cc
				}
				else {
					ctalk cc, 968, cc, tc
				}
				if ( stat == 0 ) {
					txt -1, lang(name(cc) + "は" + skillname(efid) + "の" + _cast(cCastStyle(cc)), name(cc) + " cast " + skillname(efid) + ".")
				}
				ctalk cc, 422, cc, cc, efid
				ncgTotalMagicCast++
			}
			else {
				if ( cc == tc ) {
					ctalk cc, 965, cc, cc
				}
				else {
					ctalk cc, 968, cc, tc
				}
				if ( stat == 0 ) {
					txt -1, lang(name(cc) + "は" + _cast(cCastStyle(cc)), name(cc) + "" + _cast(cCastStyle(cc)))
				}
				ctalk cc, 422, cc, cc, efid
			}
		}
	}
	if ( findbuff(cc, BUFF_MIST_OF_SILENCE) != (-1) ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang("沈黙の霧が詠唱を阻止した。", "The mist of silence interrupts a spell.")
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if ( oabit(0, gArea ) ) {
		if ( cc == CHARA_PLAYER ) {
			txt -1, lang("「ここじゃ魔法は ごはっとだぜ！」", "\"Magic is forbidden here!\"")
		}
		if ( synccheck(cc, -1) ) {
			txt -1, lang("不思議な力が詠唱を阻止した。", "A mysterious power prevents casting.")
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if ( gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_10) ) {
		if ( cc < MAX_CHARA_NC ) {
			txt -1, lang("「ここじゃ魔法は ごはっとだぜ！」", "\"Magic is forbidden here!\"")
		}
		if ( synccheck(cc, -1) ) {
			txt -1, lang("不思議な力が詠唱を阻止した。", "A mysterious power prevents casting.")
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if ( rnd(100) >= calcspellfail(efid, cc) | findbuff(cc, 93) != (-1) ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は詠唱に失敗した。", name(cc) + " fail" + _s(cc) + " to cast a spell.")
			animeid = ANIMATION_FIZZLE
			gosub *anime
		}
		efsource = 0
		magiccritical = 0
		return 1
	}
	if ( noeffect == 1 ) {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		efsource = 0
		magiccritical = 0
		return 1
	}
	efp = calcspellpower(efid, cc)
	if ( efid < 550 | efid > 599 ) {
		if ( findbuff(cc, 62) == (-1) ) {
			p = encfind(cc, ENCHANT_ENHANCE_SPELL)
			if ( p != (-1) ) {
				lint_efp = int(1.0 * efp * (100 + p / 10) / 100)
				efp = limitmax(lint_efp, 2147483647)
			}
		}
	}
	rapidmagic = 0
	if ( cbit(CHARA_BIT_RAPID_MAGIC, cc) & skillType(efid) == 2 ) {
		if ( godcheck(cc) == "itzpalt" ) {
			rapidmagic = int(logf(1.0 + cPiety(cc))) + 2 + rnd(2) - rnd(2)
		}
		else {
			rapidmagic = 1 + (rnd(3) != 0) + (rnd(2) != 0)
		}
	}
	if ( rapidmagic ) {
		bk_efp = efp
		repeat rapidmagic
			gosub *label_3383
			if ( cExist(tc) != CHAR_STATE_ALIVE ) {
				gosub *label_3023
				if ( stat == 0 ) {
					break
				}
				else {
					tc = ocHostileTarget1(cc) - 1
				}
			}
			efp = bk_efp
		loop
		rapidmagic = 0
	}
	else {
		if ( efid == SKILL_SPELL_MUTATION ) {
			efid = SKILL_EFFECT_POTION_EVOLUTION
		}
		gosub *label_3383
	}

	if ( gArea  != 210 & efid == SKILL_SPELL_WISH & cc == CHARA_PLAYER ) {
		nc_intb_100 = 0
*label_3367
		if ( spell(441 - 400) <= 0 ) {
			msgdup++
			txt -1, lang("願いのストックがなくなったため、連続使用を中止した。", "There is no stock of Wish.")
			efsource = 0
			magiccritical = 0
			return 1
		}
		if ( 99 >= calcspellfail(SKILL_SPELL_WISH, CHARA_PLAYER) ) {
			if ( nc_intb_100 > 0 ) {
				msgdup++
				txt -1, lang("成功率が100%ではなくなったため、連続使用を中止した。", "The success rate was no longer 100%, so continuous use was discontinued.")
			}
			efsource = 0
			magiccritical = 0
			return 1
		}
		if ( nc_intb_100 == 0 ) {
			txtnew
			txt -1, lang("同じ願いをもう一度叶える？", "Wish again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptl(0, 2) = lang("指定回数", "Specified Times"), "c", "2"
			promptmax = 3
			valhinan = val
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval == 2 ) {
				txt -1, lang("何回願う？", "How many times do you wish?")
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 0, 100000
				inputlog = "" + 1
				locvar_dmghp_p = rtval
				gosub *prompt_word
				if ( rtval == (-1) ) {
					efsource = 0
					magiccritical = 0
					return 1
				}
				rtval = locvar_dmghp_p
				nc_intb_100 = int(inputlog)
			}
		}
		if ( rtval == 0 | nc_intb_100 ) {
			inputlog = nc_strb_001
			gosub *label_2748
			spell(441 - 400) -= calcspellcoststock(SKILL_SPELL_WISH, CHARA_PLAYER)
			if ( spell(441 - 400) < 0 ) {
				spell(441 - 400) = 0
			}
			mp = calcspellcostmp(SKILL_SPELL_WISH, CHARA_PLAYER)
			if ( godcheck(0) == "ehekatl" ) {
				graceofgod = cPiety(CHARA_PLAYER) / 500
				if ( graceofgod > 40 ) {
					graceofgod = 40
				}
				mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
			}
			nc_intb_001 = 0
			nc_intb_002 = 0
			nc_intb_003 = 0
			repeat 30, 100
				dup roopbuf, cdata(cnt, CHARA_PLAYER)
				if ( roopbuf \ 10000 == 0 ) {
					continue
				}
				nc_intb_002 = roopbuf \ 10000 - 1
				if ( inv(37, nc_intb_002) == 7 ) {
					nc_intb_001 += inv(38, nc_intb_002)
					continue
				}
				if ( inv(37, nc_intb_002) == 8 ) {
					nc_intb_003 += inv(38, nc_intb_002)
					continue
				}
			loop
			if ( nc_intb_001 > 0 ) {
				mp = mp * (100 - nc_intb_001) / 100
			}
			if ( nc_intb_003 > 0 ) {
				healamo = mp / 100 * nc_intb_003
				healhp CHARA_PLAYER, healamo
				if ( showdamagecheck(healamo) ) {
					if ( synccheck(tc, -1) ) {
						mondmgn(mondmgcnt) = "" + healamo
						mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, 0, 0
						ccolor 110
						if ( stat == 0 ) {
							mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
						}
						mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
					}
				}
			}
			dmgmp CHARA_PLAYER, mp
			if ( cExist(CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
				efsource = 0
				magiccritical = 0
				return 1
			}
			cc = ccbk
			r1 = cc
			r2 = spellbk
			gosub *label_1598
		}
		else {
			efsource = 0
			magiccritical = 0
			return 1
		}
		if ( nc_intb_100 ) {
			nc_intb_100 -= 1
			if ( nc_intb_100 == 0 ) {
				efsource = 0
				magiccritical = 0
				return 1
			}
		}
		goto *label_3367
	}
	efsource = 0
	magiccritical = 0
	return 1

*drinkPotion
	tc = cc
	efsource = 4
	if ( potionspill | potionthrow | potiondip ) {
		if ( potionthrow ) {
			lint_efp = efp * potionthrow / 100
			efp = limitmax(lint_efp, 2147483647)
			efstatus = iStatus(ci)
		}
		if ( potiondip ) {
			oom_bk_ci = ci
			ci = cidip
		}
	}
	else {
		efstatus = iStatus(ci)
		ccoler = 0
		if ( iID(ci) == ITEM_ID_BOTTLE_DYE & (iCol(ci) == 0 | iCol(ci) == 1 | iCol(ci) == 12) ) {
			ccoler = 1
		}
		if ( synccheck(tc, -1) ) {
			if ( iID(ci) != ITEM_ID_PUTITORO | rndcnt == 1 ) {
				snd SOUNDLIST_DRINK1
				txt -1, lang(npcn(tc) + itemname(ci, 1) + "を飲み干した。", name(tc) + " drink" + _s(tc) + " " + itemname(ci, 1) + ".")
			}
		}
	}
	if ( potionspill == 0 ) {
		if ( potionthrow ) {
			r1 = ccthrowpotion
		}
		else {
			r1 = tc
		}
		if ( gettrait(r1, 84) ) {
			efp = efp + calc3traitmulti(stat, efp)
		}
		lint_efp = efp * (iLevel(ci) + 1)
		efp = limitmax(lint_efp, 2147483647)
	}
	if ( potiondip == 1 ) {
		potiondip = 0
		ci = oom_bk_ci
		return 1
	}
	gosub *label_3383
	if ( potionspill | potionthrow ) {
		potionspill = 0
		potionthrow = 0
	}
	else {
		if ( obvious == 1 ) {
			if ( tc == CHARA_PLAYER ) {
				item_identify ci, ITEM_KNOWN_NAME
			}
		}
		iNum(ci)--
		if ( ci >= 5080 ) {
			cell_refresh iX(ci), iY(ci)
		}
		else {
			if ( tc == CHARA_PLAYER ) {
				gosub *label_1681
			}
		}
	}
	cHunger(tc) += 150
	if ( petcheck(tc) ) {
		if ( cHunger(tc) > 12000 ) {
			if ( rnd(5) == 0 ) {
				chara_vomit tc
			}
		}
	}
	return 1

*drinkWell
	if ( iParam1(ci) < (-5) | iParam3(ci) >= 20 | (iID(ci) == ITEM_ID_HOLY_WELL & flagHolyWell <= 0) ) {
		valn = itemname(ci)
		txt -1, lang(valn + "は涸れている。", valn + " is dry.")
		return 1
	}
	snd SOUNDLIST_DRINK1
	valn = itemname(ci)
	txt -1, lang(name(cc) + "は" + valn + "の水をすくって飲んだ。", name(cc) + " draw" + _s(cc) + " water from " + valn + ".")
	tc = cc
	cibk = ci
	p = rnd(100)
	repeat 1
		if ( cc != CHARA_PLAYER ) {
			if ( rnd(15) == 0 ) {
				txt -1, lang(name(cc) + "は井戸に落ちた！ ", name(cc) + " falls in the well!")
				txtef COLOR_SKY_BLUE
				ctalk cc, 1267, cc, cc
				if ( stat == 0 ) {
					txt cc, name(cc) + lang("「手を伸ばせー」", " yells, " + cnvtalk("G-Give me your hands!"))
				}
				ctalk 0, 1268, 0, cc
				if ( cbit(CHARA_BIT_FLOAT, cc) == TRUE & cGravity(cc) == 0 ) {
					txt -1, lang("しかしすぐに浮いてきた… ", "Soon " + he(cc) + " floats up to the surface.")
					ctalk cc, 1269, cc, cc
				}
				else {
					dmghp cc, 9999, DAMAGE_FROM_TRAP
				}
				break
			}
		}
		if ( iID(ci) == ITEM_ID_HOLY_WELL ) {
			if ( rnd(2) == 0 ) {
				efid = SKILL_EFFECT_POTION_POTENTIAL
				gosub *label_3383
				break
			}
		}
		if ( p > 70 ) {
			p = rnd(5)
			if ( p == 0 ) {
				efid = SKILL_EFFECT_SLEEP
				efp = 100
				gosub *label_3383
				break
			}
			if ( p == 1 ) {
				efid = SKILL_EFFECT_PARALYZE
				efp = 100
				gosub *label_3383
				break
			}
			if ( p == 2 ) {
				efid = SKILL_EFFECT_BLIND
				efp = 100
				gosub *label_3383
				break
			}
			if ( p == 3 ) {
				efid = SKILL_EFFECT_CONFUSE
				efp = 100
				gosub *label_3383
				break
			}
			if ( p == 4 ) {
				efid = SKILL_EFFECT_POISON
				efp = 100
				gosub *label_3383
				break
			}
		}
		if ( p > 55 ) {
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cX(cc), cY(cc), rndex(sDetection(cc) / 2 * 50 + 100) + 1
			txt -1, lang(name(cc) + "は水の中に金貨を見つけた。", name(cc) + " find" + _s(cc) + " some gold pieces in water.")
			break
		}
		if ( p > 45 ) {
			p = rnd(8) + 10
			if ( rnd(5) > 2 ) {
				skillmod p, cc, 1000
			}
			else {
				skillmod p, cc, -1000
			}
			break
		}
		if ( p > 40 ) {
			if ( cLevel(cc) < 5 ) {
				break
			}
			if ( synccheck(cc, -1) ) {
				txt -1, lang("" + name(cc) + "は何かいけないものを飲み込んだ。", name(cc) + " swallow" + _s(cc) + " something bad.")
			}
			tc = cc
			flag_alien = 1
			gosub *alien_effect
			break
		}
		if ( p > 35 ) {
			txt -1, lang("井戸から何かが出てきた！", "Something comes out from the well!")
			repeat 1 + rnd(3)
				flt calcobjlv(cLevel(cc) * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
				characreate -1, CREATURE_ID_BUG, cX(cc), cY(cc)
			loop
			break
		}
		if ( p > 33 ) {
			efid = SKILL_EFFECT_POTION_POTENTIAL
			gosub *label_3383
			break
		}
		if ( p > 20 ) {
			efid = SKILL_SPELL_MUTATION
			gosub *label_3383
			break
		}
		if ( p == 0 ) {
			if ( rnd(gWellWish + 1) ) {
				if ( rnd(10) ) {
					txtef COLOR_YELLOW
					txt -1, lang("ものすごい幸運が訪れた…ような気がしたが気のせいだった。", "You feel as a stroke of good fortune passed by.")
					break
				}
				else {
					txtef COLOR_YELLOW
					txt -1, lang("ものすごい幸運が訪れた…ような気がしたが妹だった。", "An incredible fortune comes knocking... or so you thought. It was a younger sister.")
					flt
					characreate -1, CREATURE_ID_YOUNGER_SISTER, cX(cc), cY(cc)
				}
			}
			gWellWish++
			efid = SKILL_SPELL_WISH
			gosub *label_3383
			break
		}
		if ( cc == CHARA_PLAYER ) {
			txt -1, lang("この水は清涼だ。", "Phew, fresh water tastes good.")
		}
	loop
	ci = cibk
	if ( cc != CHARA_PLAYER ) {
		cHunger(cc) += 4000
	}
	else {
		cHunger(cc) += 500
	}
	if ( iID(ci) == ITEM_ID_HOLY_WELL ) {
		flagHolyWell--
	}
	else {
		iParam1(ci) -= rnd(3)
		iParam3(ci) += rnd(3)
		if ( iParam3(ci) >= 20 ) {
			txt -1, lang(itemname(ci) + "は完全に干上がった。", itemname(ci) + " has completely dried up.")
			return 1
		}
	}
	if ( iParam1(ci) < (-5) ) {
		txt -1, lang(itemname(ci) + "は干上がった。", itemname(ci) + " has dried up.")
	}
	return 1

*label_3373
	tc = cc
	tlocx = cX(cc)
	tlocy = cY(cc)
	efstatus = iStatus(ci)
	efsource = 2
	if ( cBlind(cc) != 0 | findbuff(cc, 93) != (-1) ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は何も見えない。", name(cc) + " can see nothing.")
		}
		efsource = 0
		return
	}
	if ( cDim(cc) != 0 | cConfuse(cc) != 0 ) {
		if ( rnd(4) != 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "はふらふらした。", name(cc) + " stagger" + _s(cc) + ".")
			}
			efsource = 0
			return
		}
	}
	if ( synccheck(cc, -1) & iID(ci) != ITEM_ID_PUTITORO ) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を読んだ。", name(cc) + " read" + _s(cc) + " " + itemname(ci, 1) + ".")
	}
	if ( iID(ci) != ITEM_ID_TREASURE_MAP ) {
		iNum(ci)--
		if ( ci >= 5080 ) {
			cell_refresh iX(ci), iY(ci)
		}
		else {
			gosub *label_1681
		}
		skillexp2 SKILL_NORMAL_LITERACY, cc, 25, 2
	}
	if ( iID(ci) == ITEM_ID_SCROLL_SUPERIOR_MATERIAL ) {
		efp = 400
	}
	else {
		if ( iID(ci) == ITEM_ID_SCROLL_CHANGE_MATERIAL ) {
			efp = 200
		}
		else {
			if ( iID(ci) == ITEM_ID_SCROLL_INFERIOR_MATERIAL ) {
				efp = 70
			}
		}
	}
	if ( iID(ci) == ITEM_ID_SCROLL_FAITH ) {
		if ( ibit(ITEM_BIT_REMAKE, ci) ) {
			if ( tc != CHARA_PLAYER ) {
				godindext = getgodindex(iParam4(ci))
				if ( godindext != (-1) ) {
					godidt = usergoddatan(2, godindext)
				}
				else {
					godidt = godno2godid(iParam4(ci))
				}
				if ( godcheck(tc) != godidt ) {
					believegod tc, godidt
					txtef COLOR_YELLOW
					txt -1, lang(name(tc) + "は" + godname(godcheck(tc)) + "に改宗した。", name(tc) + " become a follower of " + godname(godcheck(tc)) + ".")
					ctalk tc, 1279, tc, tc
					if ( stat == 0 ) {
						ctalk tc, 1278, tc, tc
					}
					r1 = tc
					gosub *charaRefresh
				}
			}
		}
	}
	gosub *label_3383
	if ( cc == CHARA_PLAYER ) {
		if ( obvious == 1 ) {
			item_identify ci, ITEM_KNOWN_NAME
		}
	}
	return 1

*label_3374
	if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) <= 0 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(itemname(ci, 1) + "を振った。", "You zap " + itemname(ci, 1) + ".")
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		return
	}
	efstatus = iStatus(ci)
	if ( efstatus >= 1 ) {
		efstatus = 0
	}
	efsource = 1
	gosub *effect_selectTg
	if ( stat == 0 ) {
		efsource = 0
		return 0
	}
	if ( efid >= SKILL_SPELL_HEAL_LIGHT & efid < (600 /*!!!@[MAX_SKILL_RANGE @@@ STARTING_SKILL_SPACT]@!!! */) ) {
		if ( stat == 0 & skillTg(efid) / 1000 * 1000 == 2000 | noeffect == 1 ) {
			if ( synccheck(cc, -1) ) {
				redraw 0
				txt -1, lang(itemname(ci, 1) + "を振った。", "You zap " + itemname(ci, 1) + ".")
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			goto *label_3375
		}
	}
	if ( synccheck(cc, -1) ) {
		txt -1, lang(npcn(cc) + itemname(ci, 1) + "を振った。", name(cc) + " zap" + _s(cc) + " " + itemname(ci, 1) + ".")
	}
	lint_efp = efp * (100 + sMagicDevice(cc) * 10 + sMAG(cc) / 2 + sPER(cc) / 2) / 100
	efp = limitmax(lint_efp, 2147483647)
	if ( iID(ci) == ITEM_ID_ROD_IDENTIFY ) {
		efp += iLevel(ci) * 100
	}
	if ( efid >= SKILL_SPELL_HEAL_LIGHT & efid < (600 /*!!!@[MAX_SKILL_RANGE @@@ STARTING_SKILL_SPACT]@!!! */) ) {
		f = 0
		r1 = sMagicDevice(cc) * 20 + 100
		if ( iStatus(ci) >= ITEM_STATUS_BLESSED ) {
			r1 = r1 * 125 / 100
		}
		if ( iStatus(ci) <= ITEM_STATUS_CURSED ) {
			r1 = r1 * 50 / 100
		}
		else {
			if ( rnd(2) ) {
				f = 1
			}
		}
		if ( rnd(skillDiff(efid) + 1) / 2 <= r1 ) {
			f = 1
		}
	}
	else {
		f = 1
	}
	if ( rnd(30) == 0 | findbuff(cc, 93) != (-1) ) {
		f = 0
	}
	if ( ogTitleElderDemonPope == 2 ) {
		f = 1
	}
	if ( f == 1 | iID(ci) == ITEM_ID_ROD_WISHING | cc != CHARA_PLAYER ) {
		gosub *label_3383
		if ( cc == CHARA_PLAYER ) {
			if ( obvious == 1 ) {
				item_identify ci, ITEM_KNOWN_NAME
			}
		}
		gosub *label_1605
	}
	else {
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は杖をうまく使えなかった。", name(cc) + " fail to use the power of the rod.")
		}
	}

*label_3375
	efsource = 0
	if ( iNum(ci) == 0 ) {
		if ( ci >= 5080 ) {
			cell_refresh iX(ci), iY(ci)
			return 1
		}
	}
	item_separate ci
	nc_intb_200 = stat
	inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
	item_autostack cc, ci
	if ( iID(ci) == ITEM_ID_ROD_WISHING & inv_getowner(ci) == 0 & cfg_nc_wish ) {
		nc_intb_201 = 1
		nc_intb_100 = 0
		repeat
			nc_intb_201 = 0
			inv_getheader 0
			repeat invrange, invhead
				if ( iNum(cnt) == 0 ) {
					continue
				}
				if ( iID(cnt) != ITEM_ID_ROD_WISHING ) {
					continue
				}
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt) <= 0 ) {
					continue
				}
				nc_intb_201 += iNum(cnt) * inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt)
			loop
			if ( nc_intb_201 <= 0 ) {
				break
			}
			rtval = 1
			if ( nc_intb_100 == 0 & (gArea  != 210 | ncgdata(NCGDATA_ABYSS_TITLE_8) == 0) ) {
				txtnew
				txt -1, lang("同じ願いをもう一度叶える？(残り:", "Wish again?(Amount:") + nc_intb_201 + ")"
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptl(0, 2) = lang("指定回数", "Specified Times"), "c", "2"
				promptmax = 3
				valhinan = val
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval == 2 ) {
					txt -1, lang("何回願う？", "How many times do you wish?")
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 0, nc_intb_201
					inputlog = "" + 1
					locvar_dmghp_p = rtval
					gosub *prompt_word
					if ( rtval == (-1) ) {
						break
					}
					rtval = locvar_dmghp_p
					nc_intb_100 = int(inputlog)
				}
			}
			if ( rtval == 0 | nc_intb_100 ) {
				inputlog = nc_strb_001
				gosub *label_2748
				if ( iNum(nc_intb_200) == 0 | inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), nc_intb_200) <= 0 ) {
					inv_getheader 0
					repeat invrange, invhead
						if ( iNum(cnt) == 0 ) {
							continue
						}
						if ( iID(cnt) != ITEM_ID_ROD_WISHING ) {
							continue
						}
						if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt) <= 0 ) {
							continue
						}
						ci = cnt
						break
					loop
				}
				else {
					ci = nc_intb_200
				}
				efsource = 0
				if ( iNum(ci) == 0 ) {
					if ( ci >= 5080 ) {
						cell_refresh iX(ci), iY(ci)
						return 1
					}
				}
				item_separate ci
				nc_intb_200 = stat
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
				item_autostack cc, ci
			}
			else {
				break
			}
			if ( nc_intb_100 ) {
				nc_intb_100 -= 1
				if ( nc_intb_100 == 0 ) {
					break
				}
			}
		loop
	}
	return 1

*action
	if ( efid == SKILL_SPACT_DEATH_WORD ) {
		if ( cbit(CHARA_BIT_DEATH_COUNT, tc) == TRUE ) {
			if ( cRelation(cc) == RELATION_ENEMY ) {
				repeat 57
					if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
						if ( cRelation(cnt) == RELATION_ALLY ) {
							lockon cc, cnt, 12
							break
						}
					}
				loop
			}
			return 0
		}
	}
	if ( efid >= 761 & efid <= 780 ) {
		if ( cc == CHARA_PLAYER ) {
			gosub *label_4528
			if ( rtval != 1 ) {
				gosub *screen_draw
				return 0
			}
			gosub *screen_draw
			if ( cPray(cc) < 1000 ) {
				txt -1, lang(godname(godcheck(cc)) + "は" + name(cc) + "に無関心だ。", godname(godcheck(cc)) + " is indifferent to you.")
				return 0
			}
		}
	}
	gosub *effect_selectTg
	if ( stat == 0 ) {
		return 0
	}
	if ( skillTg(efid) / 1000 * 1000 != 3000 & skillTg(efid) / 1000 * 1000 != 10000 ) {
		if ( cConfuse(cc) != 0 | cBlind(cc) != 0 ) {
			if ( rnd(5) == 0 ) {
				if ( synccheck(cc, -1) ) {
					txt -1, lang(name(cc) + "は頭を振った。", name(cc) + " shake" + _s(cc) + " " + his(cc) + " head.")
				}
				return 1
			}
		}
	}
	if ( efid >= (600 /*!!!@[MAX_SKILL_RANGE @@@ STARTING_SKILL_SPACT]@!!! */) ) {
		if ( efid != 791 ) {
			if ( cc == CHARA_PLAYER ) {
				if ( skillCost(efid) > 0 ) {
					if ( cSP(CHARA_PLAYER) < 50 ) {
						if ( cSP(CHARA_PLAYER) < rnd(75) ) {
							txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
							dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
							return 1
						}
					}
					if ( efid >= 663 & efid <= 673 ) {
						if ( spell(sdataref(6, efid) - 400) <= 0 ) {
							msgdup++
							txt -1, lang(skillname(sdataref(6, efid)) + "のストックがない。", "There is no stock of " + skillname(sdataref(6, efid)) + ".")
							return 1
						}
						spell(sdataref(6, efid) - 400) -= calcspellcoststock(sdataref(6, efid), cc) * 10
						if ( spell(sdataref(6, efid) - 400) < 0 ) {
							spell(sdataref(6, efid) - 400) = 0
						}
					}
					dmgsp CHARA_PLAYER, rnd(skillCost(efid) / 2 + 1) + skillCost(efid) / 2 + 1
				}
			}
			if ( efid == 790 ) {
				if ( ocbit(10, cc) == 0 ) {
					if ( cc == CHARA_PLAYER ) {
						txt -1, lang("今は使えない。", "You can't use that right now.")
					}
					return 1
				}
			}
			skillexp2 skillUse(efid), cc, 25
		}
	}
	efp = calcspellpower(efid, cc)
	if ( noeffect == 1 ) {
		if ( efid != SKILL_ACTIVE_PICKPOCKET ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			return 1
		}
	}
	if ( efid >= 779 & efid <= 780 ) {
		if ( gGodTalk ) {
			if ( efid == 779 ) {
				p = 14
			}
			else {
				if ( efid == 780 ) {
					p = 15
				}
			}
			txtgod godcheck(), p
		}
	}
	if ( efid == 781 ) {
		if ( getcgodno(cc) != (-1) ) {
			efid = usergoddata(32, stat)
		}
	}
	if ( efid == 810 ) {
		if ( getcgodno(cc) != (-1) ) {
			txtgod godcheck(), 20
		}
	}
	gosub *label_3383
	if ( stat == 0 ) {
		return 0
	}
	if ( efid >= 779 & efid <= 780 ) {
		gosub *label_4466
	}
	return 1

*effect_selectTg
	noeffect = 0
	if ( efid > tailspact ) {
		tc = cc
		return 1
	}
	tg = skillTg(efid) / 1000 * 1000
	if ( efsource == 1 ) {
		if ( tg == 3000 ) {
			tg = 8000
		}
	}
	if ( skillType(efid) == 7 ) {
		if ( cc == CHARA_PLAYER ) {
			tc = CHARA_PLAYER
			return 1
		}
	}
	if ( tg == 8000 ) {
		if ( cc == CHARA_PLAYER ) {
			tc = CHARA_PLAYER
			txt -1, lang("どの方向？", "Which direction?")
			gosub *screen_draw
			gosub *prompt_direction
			if ( stat == 0 ) {
				return 0
			}
			if ( mapChara(tlocx, tlocy) == 0 ) {
				noeffect = 1
				obvious = 0
				return 1
			}
			tc = mapChara(tlocx, tlocy) - 1
		}
		else {
			if ( efid == SKILL_SPELL_HEALING_TOUCH | efid == 501 ) {
				tlocx = cX(cc)
				tlocy = cY(cc)
				return 1
			}
			if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) > skillTg(efid) \ 1000 + 1 ) {
				return 0
			}
			tlocx = cX(tc)
			tlocy = cY(tc)
		}
		return 1
	}
	if ( tg == 7000 | (tg == 9000 & tgloc == 1 & cc == CHARA_PLAYER) ) {
		if ( cc == CHARA_PLAYER ) {
			if ( tg == 9000 ) {
				if ( fov_los(cX(cc), cY(cc), tglocx, tglocy) == 0 ) {
					if ( stat == 0 ) {
						txt -1, lang("その場所は見えない。", "You can't see the location.")
						gosub *screen_draw
					}
					obvious = 0
					return 0
				}
				tlocx = tglocx
				tlocy = tglocy
			}
			else {
				gosub *label_2584
				if ( stat != 1 ) {
					if ( stat == 0 ) {
						txt -1, lang("その場所は見えない。", "You can't see the location.")
						gosub *screen_draw
					}
					obvious = 0
					return 0
				}
			}
		}
		else {
			if ( fov_los(cX(tc), cY(tc), cX(cc), cY(cc)) == 0 ) {
				return 0
			}
			tlocx = cX(tc)
			tlocy = cY(tc)
		}
		return 1
	}
	if ( tg == 3000 | tg == 10000 ) {
		if ( efid == MAX_SKILL ) {
			cw = -1
			repeat 30
				dup roopbuf, cdata(100 + cnt, cc)
				if ( roopbuf \ 10000 == 0 ) {
					continue
				}
				if ( roopbuf / 10000 == 10 ) {
					cw = roopbuf \ 10000 - 1
				}
			loop
			if ( cw == (-1) ) {
				return 0
			}
		}
		p(44) = 0
		if ( ocHostileTargetTotal(cc) > 0 ) {
			calcskill efid, cc, calcspellpower(efid, cc)
			if ( ele == SKILL_RES_FIRE | ele == SKILL_RES_COLD | ele == SKILL_RES_LIGHTNING | ele == SKILL_RES_DARKNESS | ele == SKILL_RES_MIND | ele == SKILL_RES_SOUND ) {
				if ( gettrait(cc, ele + 38) >= 2 ) {
					tc = ocHostileTarget1(cc) - 1
					if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) > 7 ) {
						if ( cc == CHARA_PLAYER ) {
							msgdup++
							txt -1, lang("射程距離外だ。", "It's out of range.")
							gosub *screen_draw
						}
						return 0
					}
					if ( fov_los(cX(cc), cY(cc), cX(tc), cY(tc)) == 0 ) {
						return 0
					}
					p(44) = 1
				}
			}
		}
		if ( p(44) == 0 ) {
			if ( cc != CHARA_PLAYER ) {
				if ( skillType(efid) == 3 ) {
					if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) > skillTg(efid) \ 1000 + 1 ) {
						return 0
					}
					if ( fov_los(cX(cc), cY(cc), cX(tc), cY(tc)) == 0 ) {
						return 0
					}
				}
			}
			tc = cc
		}
		tlocx = cX(tc)
		tlocy = cY(tc)
		return 1
	}
	if ( tg == 2000 | tg == 6000 | tg == 9000 ) {
		if ( cc == CHARA_PLAYER ) {
			gosub *label_3023
			if ( stat == 0 ) {
				obvious = 0
				return 0
			}
			tc = ocHostileTarget1(0) - 1
			if ( hostileactioncheck(efid) ) {
				if ( cRelation(tc) >= RELATION_NEUTRAL ) {
					gosub *com_confirmAttack
					if ( stat == 0 ) {
						obvious = 0
						return 0
					}
				}
			}
		}
		if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) > skillTg(efid) \ 1000 + 1 ) {
			if ( cc == CHARA_PLAYER ) {
				msgdup++
				txt -1, lang("射程距離外だ。", "It's out of range.")
				gosub *screen_draw
			}
			return 0
		}
		if ( fov_los(cX(cc), cY(cc), cX(tc), cY(tc)) == 0 ) {
			return 0
		}
		tlocx = cX(tc)
		tlocy = cY(tc)
		return 1
	}
	if ( tg == 5000 ) {
		if ( cc == CHARA_PLAYER ) {
			if ( efsource == 3 ) {
				txt -1, lang("どの方向に唱える？ ", "Which direction do you want to cast the spell? ")
			}
			else {
				txt -1, lang("どの方向に振る？ ", "Which direction do you want to zap the wand? ")
			}
			gosub *screen_draw
			val = 0
			gosub *prompt_direction
			if ( stat == 0 ) {
				txt -1, lang("それは無理だ。", "It's impossible.")
				obvious = 0
				return 0
			}
		}
	}
	return 1

*label_3383
	dmgdisplayflag = 2
	efcibk = ci
	efcancel = 0
	obvious = 1
	if ( efsource != 4 & efsource != 1 & efsource != 2 ) {
		efstatus = 0
	}
	if ( efsource != 3 ) {
		efsource = 0
	}
	efbad = 0





	if ( efid >= SKILL_ACTIVE_PICKPOCKET ) {
		if ( efid < tailspact ) {
			if ( efid == SKILL_SPACT_BOOST ) {
				if ( cId(cc) == CREATURE_ID_SILVER_EYED_WITCH ) {
					if ( cc != CHARA_PLAYER & petcheck(cc) == 0 ) {
						if ( cQuality(cc) == FIX_QUALITY_UNIQUE | cRole(cc) != ROLE_NONE | cbit(CHARA_BIT_BODYGUARD, cc) == TRUE | cbit(CHARA_BIT_PRECIOUS, cc) == TRUE ) {
						}
						else {
							if ( cHP(cc) < cMHP(cc) / 4 ) {
								if ( rnd(100) >= limit(cHP(cc) * 100 / (cMHP(cc) / 4), 0, 100) ) {
									goto *effect2
								}
							}
						}
					}
				}
			}
			f = 0
			if ( skillType(efid) / 1000 == 1 ) {
				f = 1
				p = skillType(efid) \ 1000
				if ( bdataref(BDATAREF_BUFF_TYPE, p) == BUFF_TYPE_HEX ) {
					efbad = 1
				}
			}
			if ( skillType(efid) == 7 ) {
				efbad = 1
			}
			if ( efbad == 0 ) {
				if ( efstatus >= 1 ) {
					lint_efp = efp * 150 / 100
					efp = limitmax(lint_efp, 2147483647)
				}
				if ( efstatus <= (-1) ) {
					efp = efp / 2
				}
			}
			else {
				if ( efstatus >= 1 ) {
					efp = efp / 2
				}
				if ( efstatus <= (-1) ) {
					lint_efp = efp * 150 / 100
					efp = limitmax(lint_efp, 2147483647)
				}
			}
			if ( f ) {
				procbody = *label_4616
				gosub *label_4612
				goto *effect_end
			}
			calcskill efid, cc, efp
			calcempower efid
			if ( rapidmagic ) {
				lint_efp = efp * 13 / 20 + 1
				efp = limitmax(lint_efp, 2147483647)
				dice1 = dice1 * 13 / 20 + 1
				dice2 = dice2 * 13 / 20 + 1
				bonus = bonus * 13 / 20 + 1
			}
			if ( cc == CHARA_PLAYER ) {
				if ( magiccritical ) {
					txtef COLOR_RED
					txt -1, lang("全力全開！ ", "Full power release!")
				}
			}
			_switch_val = skillType(efid)
			if ( _switch_val == 10 | _switch_sw ) {
				_switch_sw = 0
				animeid = ANIMATION_SPORE
				gosub *anime
				gosub *label_3640
				gosub *label_4714
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 1 | _switch_sw ) {
				_switch_sw = 0
				get_route cX(cc), cY(cc), tlocx, tlocy
				if ( stat == 0 ) {
					goto *label_3396
				}
				animeid = ANIMATION_BOLT
				gosub *anime
				dx = cX(cc)
				dy = cY(cc)
				repeat 20
					route_info dx, dy, cnt
					if ( stat == 0 ) {
						break
					}
					else {
						if ( stat == (-1) ) {
							continue
						}
					}
					if ( dist(dx, dy, cX(cc), cY(cc)) > skillTg(efid) \ 1000 + 1 ) {
						break
					}
					if ( dx == cX(cc) & dy == cY(cc) ) {
						continue
					}
					if ( ele == SKILL_RES_FIRE ) {
						mapitem_fire dx, dy
					}
					if ( ele == SKILL_RES_COLD ) {
						mapitem_cold dx, dy
					}
					if ( mapChara(dx, dy) != 0 ) {
						tc = mapChara(dx, dy) - 1
						attack_weakguard
						if ( cc != tc ) {
							if ( gRider != 0 ) {
								if ( gRider == cc ) {
									if ( tc == CHARA_PLAYER ) {
										continue
									}
								}
							}
							if ( ocPetBeingRiddenIdx(cc) != 0 ) {
								if ( tc == ocPetBeingRiddenIdx(cc) ) {
									continue
								}
							}
							if ( magiccritical ) {
								lint_damage = pluginFunction(rolemax(dice1, dice2, bonus))
							}
							else {
								lint_damage = pluginFunction(role(dice1, dice2, bonus))
							}
							if ( lint_damage > 2000000000 ) {
								lint_damage = 2000000000
							}
							calcmagiccontrol cc, tc
							if ( stat == 1 ) {
								continue
							}
							if ( synccheck(tc, -1) & weaponenc == 0 ) {
								if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
									dmgType = 2
									txt3rd = 1
									txt -1, lang("ボルトは" + name(tc) + "に命中し", "The bolt hits " + name(tc) + " and")
								}
								else {
									txt -1, lang("ボルトが" + name(tc) + "に命中した。", "The bolt hits " + name(tc) + ".")
								}
							}
							locvar_dmghp_magicflag = 1
							dmghp tc, int(lint_damage), cc, ele, elep
						}
					}
				loop
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 3 | _switch_sw ) {
				_switch_sw = 0
				chainbomb = 0
				ccbk = cc
				if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
					stxt cc, lang(name(cc) + "は爆発した。", name(cc) + " explode" + _s(cc) + ".")
				}
*chainBomb_loop
				cbitmod CHARA_BIT_SUICIDE_SWITCH, cc, FALSE
				range = skillTg(efid) \ 1000 + 1
				if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
					range = 2
				}
				if ( efid != SKILL_SPELL_HEALING_RAIN & efid != SKILL_SPACT_RAIN_OF_SANITY & efid != SKILL_SPELL_CURE_OF_JURE ) {
					if ( cc != tc ) {
						animeid = ANIMATION_ARROW
						gosub *anime
					}
					aniref = range
					animeid = ANIMATION_BALL
					anix = tlocx
					aniy = tlocy
					gosub *anime
				}
				repeat range * 2 + 1
					dy = tlocy - range + cnt
					if ( dy < 0 | dy >= mHeight ) {
						continue
					}
					repeat range * 2 + 1
						dx = tlocx - range + cnt
						if ( dx < 0 | dx >= mWidth ) {
							continue
						}
						if ( dist(tlocx, tlocy, dx, dy) > range ) {
							continue
						}
						if ( fov_los(tlocx, tlocy, dx, dy) == 0 ) {
							continue
						}
						if ( mapChara(dx, dy) == 0 ) {
							continue
						}
						tc = mapChara(dx, dy) - 1
						attack_weakguard
						if ( efid == SKILL_SPACT_RAIN_OF_SANITY ) {
							f = 0
							if ( cc == CHARA_PLAYER | cRelation(cc) >= RELATION_NEUTRAL ) {
								if ( cRelation(tc) >= RELATION_NEUTRAL ) {
									f = 1
								}
							}
							else {
								if ( cRelation(tc) <= RELATION_DISLIKE ) {
									f = 1
								}
							}
							if ( f == 1 ) {
								animeid = ANIMATION_HEAL_FAST
								gosub *anime
								txt -1, lang(name(tc) + "の狂気は消え去った。", name(tc) + " " + is(tc) + " completely sane again.")
								healsan tc, efp / 10
								healcon tc, CONDITION_INSANE, 9999
							}
							continue
						}
						if ( dx == cX(cc) & dy == cY(cc) ) {
							continue
						}
						if ( gRider != 0 ) {
							if ( gRider == cc ) {
								if ( tc == CHARA_PLAYER ) {
									continue
								}
							}
						}
						if ( ocPetBeingRiddenIdx(cc) != 0 ) {
							if ( tc == ocPetBeingRiddenIdx(cc) ) {
								continue
							}
						}
						if ( ele == SKILL_RES_FIRE ) {
							mapitem_fire dx, dy
						}
						if ( ele == SKILL_RES_COLD ) {
							mapitem_cold dx, dy
						}
						if ( cc != tc ) {
							if ( magiccritical ) {
								lint_damage = pluginFunction(rolemax(dice1, dice2, bonus))
							}
							else {
								lint_damage = pluginFunction(role(dice1, dice2, bonus))
							}
							if ( lint_damage > 2000000000 ) {
								lint_damage = 2000000000
							}
							lint_damage = lint_damage * 100 / (75 + dist(tlocx, tlocy, dx, dy) * 25)
							calcmagiccontrol cc, tc
							if ( stat == 1 ) {
								continue
							}
							if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
								if ( synccheck(tc, -1) & weaponenc == 0 ) {
									if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
										dmgType = 2
										txt3rd = 1
										txt -1, lang("爆風は" + name(tc) + "に命中し", "The explosion hits " + name(tc) + " and")
									}
									else {
										txt -1, lang("爆風が" + name(tc) + "に命中した。", "The explosion hits " + name(tc) + ".")
									}
								}
								if ( cbit(CHARA_BIT_SUICIDE, tc) ) {
									chainbomblist(chainbomb) = tc
									chainbomb++
									continue
								}
							}
							else {
								if ( synccheck(tc, -1) & weaponenc == 0 ) {
									if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
										dmgType = 2
										txt3rd = 1
										txt -1, lang("ボールは" + name(tc) + "に命中し", "The ball hits " + name(tc) + " and")
									}
									else {
										txt -1, lang("ボールが" + name(tc) + "に命中した。", "The Ball hits " + name(tc) + ".")
									}
								}
							}
							locvar_dmghp_magicflag = 1
							dmghp tc, int(lint_damage), cc, ele, elep
						}
					loop
				loop
				if ( efid == SKILL_SPACT_SUICIDE_ATTACK ) {
					cHP(cc) = -1
					dmghp cc, 9999999, DAMAGE_FROM_SUICIDE
				}
				if ( chainbomb > 0 ) {
*chainBomb_loop_WHILE1
					chainbomb--
					if ( chainbomb < 0 ) {
						goto *chainBomb_loop_WEND1
					}
					cc = chainbomblist(chainbomb)
					tlocx = cX(cc)
					tlocy = cY(cc)
					if ( cExist(cc) == CHAR_STATE_ALIVE ) {
						calcskill efid, cc, efp
						stxt cc, lang(name(cc) + "は誘爆した。", name(cc) + " explode" + _s(cc) + ".")
						goto *chainBomb_loop
					}
					goto *chainBomb_loop_WHILE1
				}
*chainBomb_loop_WEND1
				cc = ccbk
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 2 | _switch_sw ) {
				_switch_sw = 0
				attack_weakguard
				animeid = ANIMATION_ARROW
				gosub *anime
				if ( magiccritical ) {
					lint_damage = pluginFunction(rolemax(dice1, dice2, bonus))
				}
				else {
					lint_damage = pluginFunction(role(dice1, dice2, bonus))
				}
				if ( lint_damage > 2000000000 ) {
					lint_damage = 2000000000
				}
				if ( synccheck(tc, -1) & weaponenc == 0 ) {
					if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
						dmgType = 2
						txt3rd = 1
						txt -1, lang("矢は" + name(tc) + "に命中し", "The arrow hits " + name(tc) + " and")
					}
					else {
						txt -1, lang("矢が" + name(tc) + "に命中した。", "The arrow hits " + name(tc) + ".")
					}
				}
				locvar_dmghp_magicflag = 1
				dmghp tc, int(lint_damage), cc, ele, elep
				orgdmg = lint_damage
				check_adddamage_arrow
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 4 | _switch_sw ) {
				_switch_sw = 0
				procbody = *label_4615
				gosub *label_4612
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 6 | _switch_sw ) {
				_switch_sw = 0
				attack_weakguard
				ctalk cc, 427, cc, tc
				if ( cCastStyle(cc) != 0 ) {
					if ( synccheck(cc, -1) ) {
						if ( cc == CHARA_PLAYER ) {
							txt -1, lang(name(cc) + "は" + skillname(efid) + "の" + _cast(cCastStyle(cc)), name(cc) + " cast " + skillname(efid) + ".")
						}
						else {
							txt -1, lang(name(cc) + "は" + _cast(cCastStyle(cc)), name(cc) + "" + _cast(cCastStyle(cc)))
						}
					}
				}
				else {
					if ( efid == SKILL_SPACT_DRAIN_BLOOD ) {
						if ( synccheck(cc, -1) ) {
							if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
								dmgType = 2
								if ( cfg_dmgtxttype ) {
									txt -1, lang(aln(cc) + name(tc) + "の血を吸った。", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood.")
								}
								else {
									txt -1, lang(aln(cc) + name(tc) + "の血を吸い", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood and")
								}
							}
							else {
								txt -1, lang(name(cc) + "に血を吸われた。", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood.")
							}
							cHunger(cc) += 150
						}
					}
					else {
						if ( efid == SKILL_SPACT_MANIS_DISASSEMBLY ) {
							ctalk cc, 427, cc, tc
							if ( stat == 0 ) {
								txt cc, lang("「余分な機能は削除してしまえ」", cnvtalk("Delete."))
							}
							if ( eqfaction(tc, "overwish") ) {
								txt -1, lang("しかし、効果はなかった。", "But it produces no effect.")
								goto *label_3396
							}
							cHP(tc) = cMHP(tc) / 12 + 1
							goto *label_3396
						}
						else {
							if ( efid == 914 ) {
								dmgType = 2
								ctalk cc, 427, cc, tc
								if ( stat == 0 ) {
									txt -1, lang(name(cc) + "は連撃を繰り出した。", name(cc) + " launched a series of attacks.")
								}
								ele = cdata(CDATA_ELEMENT, cc) / 100000
								elep = cdata(CDATA_ELEMENT, cc) \ 100000
								animeid = ANIMATION_ATTACK
								gosub *anime
								if ( cfg_dmgtxttype ) {
									txt -1, lang(aln(cc) + name(tc) + "を" + _melee(2, cMeleeStyle(cc)) + "で" + _melee(3, cMeleeStyle(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(3, cMeleeStyle(cc)) + ".")
								}
								else {
									txt -1, lang(aln(cc) + name(tc) + "を" + _melee(2, cMeleeStyle(cc)) + "で" + _melee(0, cMeleeStyle(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeStyle(cc)) + " and")
								}
								dmgmulti = 0.5 + double(sSTR(cc) + sMartial(cc) / 5 + ctype (cc) * 2) / 40
								dice1 = 2
								dice2 = sMartial(cc) / 8 + 5
								dmgfix = sSTR(cc) / 8 + sMartial(cc) / 8 + cDMG(cc)
								lint_damage = role(dice1, dice2, bonus) * dmgmulti
								if ( lint_damage > 2000000000 ) {
									lint_damage = 2000000000
								}
								dmghp tc, int(lint_damage), cc, ele, elep
								animeid = ANIMATION_ATTACK
								gosub *anime
								if ( cExist(tc) == CHAR_STATE_ALIVE ) {
									if ( cfg_dmgtxttype ) {
										txt -1, lang("更に" + aln(cc) + name(tc) + "を" + _melee(2, cMeleeStyle(cc)) + "で" + _melee(3, cMeleeStyle(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(3, cMeleeStyle(cc)) + ".")
									}
									else {
										txt -1, lang("更に" + aln(cc) + name(tc) + "を" + _melee(2, cMeleeStyle(cc)) + "で" + _melee(0, cMeleeStyle(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeStyle(cc)) + " and")
									}
									dmgmulti = 0.5 + double(sSTR(cc) + sMartial(cc) / 5 + ctype (cc) * 2) / 40
									dice1 = 2
									dice2 = sMartial(cc) / 8 + 5
									dmgfix = sSTR(cc) / 8 + sMartial(cc) / 8 + cDMG(cc)
									lint_damage = role(dice1, dice2, bonus) * dmgmulti
									if ( lint_damage > 2000000000 ) {
										lint_damage = 2000000000
									}
									dmghp tc, int(lint_damage), cc, ele, elep
								}
								ctalk cc, 428, cc, tc
								goto *label_3396
							}
							else {
								if ( efid == 905 ) {
									dmgType = 2
									if ( cc == CHARA_PLAYER ) {
										ctalk cc, 427, cc, tc
										if ( stat == 0 ) {
											txt -1, lang(name(cc) + "の みねうち！", name(cc) + " used False Swipe!")
										}
									}
									else {
										ctalk cc, 427, cc, tc
										if ( stat == 0 ) {
											txt -1, lang("あいての " + name(cc) + "の みねうち！", "The opposing " + name(cc) + "used False Swipe!")
										}
									}
									if ( cfg_dmgtxttype == 0 ) {
										txt -1, lang(aln(cc) + name(tc) + "を峰で打ち", name(cc) + " strike" + _s(cc) + " " + name(tc) + " with back of the blade and")
									}
									animeid = ANIMATION_ATTACK
									gosub *anime
								}
								else {
									if ( synccheck(cc, -1) ) {
										if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
											dmgType = 2
											if ( cfg_dmgtxttype ) {
												txt -1, lang(aln(cc) + name(tc) + "を" + elename(ele) + _melee(2, cMeleeStyle(cc)) + "で" + _melee(3, cMeleeStyle(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(3, cMeleeStyle(cc)) + ".")
											}
											else {
												txt -1, lang(aln(cc) + name(tc) + "を" + elename(ele) + _melee(2, cMeleeStyle(cc)) + "で" + _melee(0, cMeleeStyle(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeStyle(cc)) + " and")
											}
										}
										else {
											txt -1, lang(name(tc) + "は" + name(cc) + "に" + elename(ele) + _melee(2, cMeleeStyle(cc)) + "で" + _melee(1, cMeleeStyle(cc)), name(cc) + " touch" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + elename(ele) + " " + _melee(2, cMeleeStyle(cc)) + ".")
										}
									}
								}
							}
						}
					}
				}
				dmghp tc, role(dice1, dice2, bonus), cc, ele, elep
				ctalk cc, 428, cc, tc
				if ( efid == SKILL_SPACT_TOUCH_OF_FEAR ) {
					dmgcon tc, CONDITION_FEAR, elep
				}
				if ( efid == SKILL_SPACT_TOUCH_OF_SLEEP ) {
					dmgcon tc, CONDITION_SLEEP, elep
				}
				if ( efid == SKILL_SPACT_TOUCH_OF_HUNGER ) {
					cHunger(tc) -= 8 * 100
					if ( synccheck(tc, -1) ) {
						txtef COLOR_PURPLE
						txt -1, lang(name(tc) + "はお腹が減った。", "Suddenly " + name(tc) + " feel" + _s(tc) + " hungry.")
					}
					r1 = tc
					gosub *label_1675
				}
				if ( efid == SKILL_SPACT_TOUCH_OF_WEAKNESS ) {
					p = rnd(20 - 10)
					if ( cQuality(tc) >= FIX_QUALITY_MIRACLE & rnd(4) | encfind(tc, 6 * 10000 + 10 + p) != (-1) | have_bigench(tc, 6) == 1 ) {
						p = -1
					}
					if ( p != (-1) ) {
						i = sorgex(10 + p, tc) + cdata(STARTING_CDATA_ATTR + p, tc)
						if ( i > 0 ) {
							i = i * efp / 2000 + 1
							cdata(STARTING_CDATA_ATTR + p, tc) -= i
						}
						if ( synccheck(tc, -1) ) {
							txtef COLOR_PURPLE
							txt -1, lang(name(tc) + "は弱くなった。", name(tc) + " " + is(tc) + " weakened.")
						}
						r1 = tc
						gosub *charaRefresh
					}
				}
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 7 | _switch_sw ) {
				_switch_sw = 0
				if ( cc == CHARA_PLAYER ) {
					if ( gCrowd + 100 >= 245 - 57 ) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						obvious = 0
						goto *label_3396
					}
				}
				p = 3
				efp = (efp / 25 + efp * efp / 10000 + cLevel(cc)) / 2
				if ( efp < 1 ) {
					efp = 1
				}
				if ( efid == SKILL_SPACT_SUMMON_PAWN ) {
					efp = 15 + rnd(8)
				}
				if ( efid == SKILL_SPACT_SUMMON_CATS ) {
					efp = 2 + rnd(18)
				}
				if ( efid == SKILL_SPACT_SUMMON_FIRE ) {
					efp = 15 + rnd(15)
				}
				if ( efid == SKILL_SPACT_SUMMON_YEEK ) {
					efp = 5 + rnd(12)
				}
				if ( efid == SKILL_SPACT_SUMMON_SISTER ) {
					p = 10
				}
				if ( efid == 788 | efid == 789 | efid == 792 ) {
					efp = cLevel(cc)
				}
				if ( efid == 795 ) {
					efp = sGardening(cc) + 1
					p = 1
				}
				if ( efid == 796 ) {
					efp = efp + 2
					p = 1
				}
				repeat 1 + rnd(p)
					flt calcobjlv(efp), FIX_QUALITY_GOOD
					dbid = 0
					if ( efid == SKILL_SPELL_SUMMON_WILD ) {
						fltn "wild"
					}
					if ( efid == SKILL_SPACT_SUMMON_FIRE ) {
						fltn "fire"
					}
					if ( efid == SKILL_SPACT_SUMMON_PAWN ) {
						fltn "pawn"
					}
					if ( efid == SKILL_SPACT_SUMMON_CATS ) {
						fltn "cat"
					}
					if ( efid == SKILL_SPACT_SUMMON_YEEK ) {
						fltn "yeek"
					}
					if ( efid == SKILL_SPACT_SUMMON_SISTER ) {
						dbid = 176
					}
					if ( efid == 788 ) {
						fltn "dragon"
					}
					if ( efid == 789 ) {
						fltn "dragon"
						fixlv = FIX_QUALITY_GREAT
						npcrare = 1
					}
					if ( efid == 792 ) {
						fltn "undead"
						fixlv = FIX_QUALITY_GREAT
						npcrare = 1
					}
					if ( efid == 795 ) {
						dbid = 500
						initlv = objlv
					}
					if ( efid == 796 ) {
						fltn "undead"
					}
					noencpfix = 1
					nc_skipflag = 1
					characreate -1, dbid, cX(tc), cY(tc)
					if ( stat != 0 ) {
						if ( efid == 795 | efid == 796 ) {
							if ( cc == CHARA_PLAYER ) {
								cRelation(rc) = RELATION_ALLY
								cOrgRelation(rc) = RELATION_ALLY
							}
							else {
								cRelation(rc) = cRelation(cc)
								cOrgRelation(rc) = cOrgRelation(cc)
							}
						}
						if ( efid == SKILL_SPELL_SUMMON_WILD ) {
							if ( cc == CHARA_PLAYER ) {
								if ( cQuality(rc) != FIX_QUALITY_UNIQUE ) {
									if ( gettrait(cc, 104) != 0 ) {
										if ( findfaction(rc, "family", "wild") ) {
											cRelation(rc) = RELATION_ALLY
											cOrgRelation(rc) = RELATION_ALLY
										}
									}
								}
							}
						}
						if ( efid != SKILL_SPACT_SUMMON_SISTER ) {
							if ( cId(rc) == cId(cc) ) {
								chara_vanquish rc
								continue cnt
							}
							if ( relationbetween(rc, cc) == 10 ) {
								addfaction rc, "pet," + cc
								ocAIDistance(rc) = 1
								ocAIStrategy(rc) = AI_STRATEGY_DEFEND_ME
							}
						}
						ctalk rc, 736, rc, cc
						resetfaction rc
						if ( nc_gettrait(cc, 117) > 0 ) {
							addbuff rc, BUFF_SPEED, efp / 100, 50
							addbuff rc, BUFF_HERO, efp / 100, 50
							addbuff rc, BUFF_CONTINGENCY, efp / 300, 50
						}
					}
				loop
				if ( synccheck(cc, -1) ) {
					txt -1, lang("魔法でモンスターが召喚された。", "Several monsters come out from a portal.")
				}
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 5 | _switch_sw ) {
				_switch_sw = 0
				tcprev = tc
				if ( gRider != 0 ) {
					if ( gRider == tc ) {
						goto *label_3396
					}
				}
				if ( ocPetBeingRiddenIdx(tc) != 0 ) {
					goto *label_3396
				}
				if ( efid == SKILL_SPELL_TELEPORT ) {
					tc = cc
				}
				if ( efid == SKILL_SPACT_SHADOW_STEP | efid == SKILL_SPACT_DRAW_SHADOW | efid == SKILL_SPACT_SUSPICIOUS_HAND & nc_himo == 0 ) {
					ctalk cc, 427, cc, tc
				}
				else {
					nc_himo = 0
				}
				if ( efid == SKILL_SPACT_SHADOW_STEP ) {
					telex = cX(tc)
					teley = cY(tc)
					tc = cc
				}
				if ( efid == SKILL_SPACT_DRAW_SHADOW ) {
					telex = cX(cc)
					teley = cY(cc)
				}
				if ( efid == SKILL_SPELL_TELEPORT_OTHER | efid == SKILL_SPACT_SUSPICIOUS_HAND ) {
					if ( mapChara(tlocx, tlocy) == 0 ) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						obvious = 0
						goto *label_3396
					}
					tc = mapChara(tlocx, tlocy) - 1
				}
				if ( gArea  == AREA_PET_ARENA | gArea  == 49 | mType == MAP_TYPE_WORLD | gArea  == AREA_PYRAMID | gArea  == AREA_JAIL ) {
					if ( synccheck(tc, -1) ) {
						txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
					}
					goto *label_3396
				}
				if ( efid == SKILL_SPACT_SUSPICIOUS_HAND ) {
					if ( findbuff(cc, 62) == (-1) | have_bigench(cc, 3) == 1 ) {
						if ( encfind(cc, ENCHANT_PREVENT_TELEPORT) != (-1) ) {
							if ( synccheck(tc, -1) ) {
								txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
							}
							goto *label_3396
						}
					}
					p = rndex(cGold(tc) / 10 + 1)
					if ( rnd(sPER(tc)) > rnd(sDEX(cc) * 4) | cbit(CHARA_BIT_RES_STEAL, tc) == TRUE ) {
						txt -1, lang(name(tc) + "は自分の財布を守った。", name(tc) + " guard" + _s(tc) + " " + his(tc) + " wallet from a thief.")
						p = 0
					}
					if ( p != 0 ) {
						snd SOUNDLIST_PAYGOLD1
						cGold(tc) -= p
						txt -1, lang(name(cc) + "は" + name(tc) + "から" + p + "枚の金貨を奪った。", name(cc) + " steal" + _s(cc) + " " + p + " gold pieces from " + name(tc) + ".")
						se_moneymod cc, p
					}
					tc = cc
					if ( gRider != 0 ) {
						if ( gRider == tc ) {
							goto *label_3396
						}
					}
					if ( ocPetBeingRiddenIdx(tc) != 0 ) {
						goto *label_3396
					}
				}
				if ( efid == SKILL_SPACT_SHADOW_STEP ) {
					if ( gRider != 0 ) {
						if ( gRider == tc ) {
							goto *label_3396
						}
					}
					if ( ocPetBeingRiddenIdx(tc) != 0 ) {
						goto *label_3396
					}
				}
				else {
					if ( encfind(tc, ENCHANT_PREVENT_TELEPORT) != (-1) & (findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1) | (cc != tc & findfaction(tc, "regist", "teleport")) ) {
						if ( synccheck(tc, -1) ) {
							txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
						}
						goto *label_3396
					}
				}
				tx = cX(tc)
				ty = cY(tc)
				if ( tc == CHARA_PLAYER & efid == SKILL_SPELL_TELEPORT & rndtelepo != 1 ) {
					locvar_addnews_tm = -1
					snd SOUNDLIST_INV
					gosub *label_4993
					if ( stat != (-1) ) {
						locvar_addnews_tm = stat
					}
				}
				if ( synccheck(tc, -1) ) {
					snd SOUNDLIST_TELEPORT1
				}
*effect_SWEND1
				efidprev = efid
				repeat 200
					if ( efidprev == SKILL_SPELL_SHORT_TELEPORT | efidprev == SKILL_SPACT_DIMENSIONAL_MOVE ) {
						p = -1, 1
						cXnew(tc) = rnd(mWidth - 2) + 1
						cYnew(tc) = rnd(mHeight - 2) + 1
						_dis = dist(cX(tc), cY(tc), cXnew(tc), cYnew(tc))
						if ( _dis > 7 | _dis < 4 ) {
							continue
						}
					}
					else {
						if ( efidprev == SKILL_SPACT_SHADOW_STEP ) {
							cXnew(tc) = telex + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
							cYnew(tc) = teley + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
						}
						else {
							if ( efidprev == SKILL_SPACT_DRAW_SHADOW ) {
								cXnew(tc) = telex + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
								cYnew(tc) = teley + rnd(cnt / 8 + 2) - rnd(cnt / 8 + 2)
							}
							else {
								if ( locvar_addnews_tm != (-1) ) {
									cXnew(tc) = iX(locvar_addnews_tm) + (cnt != 0 * (rnd(3) - rnd(3)))
									cYnew(tc) = iY(locvar_addnews_tm) + (cnt != 0 * (rnd(3) - rnd(3)))
								}
								else {
									cXnew(tc) = rnd(mWidth - 2) + 1
									cYnew(tc) = rnd(mHeight - 2) + 1
									if ( dist(cX(tc), cY(tc), cXnew(tc), cYnew(tc)) < 8 ) {
										continue
									}
								}
							}
						}
					}
					cell_check cXnew(tc), cYnew(tc)
					if ( cellaccess == 1 ) {
						if ( efidprev == SKILL_SPACT_SHADOW_STEP ) {
						}
						else {
							if ( efidprev == SKILL_SPACT_DRAW_SHADOW ) {
								if ( synccheck(cc, -1) ) {
									txt -1, lang(name(tc) + "は引き寄せられた。", name(tc) + " " + is(tc) + " drawn.")
								}
							}
							else {
								if ( synccheck(cc, -1) ) {
									if ( efidprev == SKILL_SPACT_SUSPICIOUS_HAND ) {
										ctalk cc, 428, cc, tc
										txt -1, lang("泥棒は笑って逃げた。", "A thief escapes laughing.")
									}
									else {
										txt -1, lang(name(tc) + "は突然消えた。", "Suddenly, " + name(tc) + " disappear" + _s(tc) + ".")
										if ( locvar_addnews_tm != (-1) ) {
											if ( rnd(10) == 0 & areaType(gArea ) != MAP_TYPE_HOME ) {
												ibitmod 20, locvar_addnews_tm, FALSE
												txt -1, lang(itemname(locvar_addnews_tm, 1) + "は転移用の目印としての機能を失った。", itemname(locvar_addnews_tm, 1) + " lost its magical power as a teleporting marker.")
											}
										}
									}
								}
							}
						}
						if ( efidprev == SKILL_SPACT_SHADOW_STEP | efidprev == SKILL_SPACT_DRAW_SHADOW ) {
							ctalk cc, 428, cc, tc
						}
						rowactend cc
						ccprev = cc
						cc = tc
						gosub *label_3294
						cc = ccprev
						if ( tc == CHARA_PLAYER ) {
							gosub *screen_draw
						}
						break
					}
				loop
				locvar_addnews_tm = -1
				tc = tcprev
				goto *label_3396
				_switch_sw++
			}
			if ( _switch_val == 8 | _switch_sw ) {
				_switch_sw = 0
				get_route cX(cc), cY(cc), tlocx, tlocy
				if ( stat == 0 ) {
					goto *label_3396
				}
				if ( ele ) {
					valn = skillname(ele) + lang("の", " breath")
				}
				else {
					valn = lang("", "breath")
				}
				if ( synccheck(cc, -1) ) {
					ctalk cc, 427, cc, tc
					txt -1, lang(name(cc) + "は" + valn + "ブレスを吐いた。", name(cc) + " bellow" + _s(cc) + " " + valn + " from " + his(cc) + " mouth.")
					ctalk cc, 428, cc, tc
				}
				dx = cX(cc)
				dy = cY(cc)
				breath_list
				animeid = ANIMATION_BREATH
				gosub *anime
				repeat maxbreath
					dx = breathlist(0, cnt)
					dy = breathlist(1, cnt)
					if ( fov_los(cX(cc), cY(cc), dx, dy) == 0 ) {
						continue
					}
					if ( dx == cX(cc) & dy == cY(cc) ) {
						continue
					}
					if ( gRider != 0 ) {
						if ( gRider == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					if ( ocPetBeingRiddenIdx(cc) != 0 ) {
						if ( tc == ocPetBeingRiddenIdx(cc) ) {
							continue
						}
					}
					if ( ele == SKILL_RES_FIRE ) {
						mapitem_fire dx, dy
					}
					if ( ele == SKILL_RES_COLD ) {
						mapitem_cold dx, dy
					}
					if ( mapChara(dx, dy) != 0 ) {
						tc = mapChara(dx, dy) - 1
						attack_weakguard
						if ( cc != tc ) {
							dmg = role(dice1, dice2, bonus)
							calcmagiccontrol cc, tc
							if ( stat == 1 ) {
								continue
							}
							if ( synccheck(tc, -1) & weaponenc == 0 ) {
								if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
									dmgType = 2
									txt3rd = 1
									if ( cfg_dmgtxttype ) {
										txt -1, lang("ブレスは" + name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
									}
									else {
										txt -1, lang("ブレスは" + name(tc) + "に命中し", "The breath hits " + name(tc) + " and")
									}
								}
								else {
									txt -1, lang("ブレスは" + name(tc) + "に命中した。", "The breath hits " + name(tc) + ".")
								}
							}
							dmghp tc, dmg, cc, ele, elep
						}
					}
				loop
				goto *label_3396
			}
			if ( _switch_val == 11 | _switch_sw ) {
				_switch_sw = 0
				txtef COLOR_BLUE
				txt -1, lang(elemeteor(ele) + "が落ちてきた！", "Innumerable " + elemeteor(ele) + " fall all over the area!")
				animeid = ANIMATION_METEOR
				gosub *anime
				repeat mHeight
					dy = cnt
					repeat mWidth
						dx = cnt
						if ( rnd(3) == 0 ) {
							mapId(dx, dy) = 12 + rnd(2)
						}
						if ( ele == SKILL_RES_FIRE ) {
							if ( rnd(40) == 0 ) {
								addmef dx, dy, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(4) + 3, 50
							}
						}
						if ( ele == 70 ) {
							if ( rnd(10) == 0 ) {
								addmef dx, dy, MEF_TYPE_POTION, xy2pic(27, 0), -1, elep / 500, cc, 620, 0, 0
							}
						}
						if ( ele == MAX_SKILL_RESIST ) {
							if ( rnd(10) == 0 ) {
								addmef dx, dy, MEF_TYPE_POTION, xy2pic(27, 0), -1, elep / 500, cc, 205, 0, 0
							}
						}
						if ( mapChara(dx, dy) != 0 ) {
							tc = mapChara(dx, dy) - 1
							attack_weakguard
							if ( ogTitleAreus != 2 ) {
								dmg = int(limitf(double(sMAG(cc)) * efp / 10, 1, 20000000))
							}
							else {
								dmg = int(limitf(double(sMAG(cc)) * efp / 10, 1, 2000000000))
							}
							locvar_dmghp_magicflag = 1
							dmghp tc, dmg, cc, ele, elep
						}
					loop
				loop
				goto *label_3396
				_switch_sw++
			}
			if ( efsource == 3 ) {
				if ( _switch_val == 12 | _switch_sw ) {
					_switch_sw = 0
					procbody = *label_4619
					gosub *label_4612
					goto *label_3396
					_switch_sw++
				}
				if ( _switch_val == 13 | _switch_sw ) {
					_switch_sw = 0
					procbody = *label_4617
					gosub *label_4612
					goto *label_3396
					_switch_sw++
				}
			}
			goto *effect2
			goto *label_3396
*label_3396
			goto *effect_end
		}
		else {
			if ( efstatus >= 1 ) {
				lint_efp = efp * 150 / 100
				efp = limitmax(lint_efp, 2147483647)
			}
			if ( efstatus <= (-1) ) {
				efp = 50
			}
		}
	}

*effect2
	_switch_val = efid
	if ( _switch_val == 636 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_PURPLE
		if ( jp ) {
			ctalk cc, 427, cc, tc
			ctalk cc, 969, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_PURPLE
				txt -1, name(tc) + "は" + name(cc) + "の腹の亀裂から蛆虫が沸き出るのを見た。", name(tc) + "は" + name(cc) + "が屍を貪る姿を目撃した。", name(tc) + "は" + name(cc) + "の恐ろしい瞳に震えた。", name(tc) + "は" + name(cc) + "の触手に絡まる臓物に吐き気を感じた。"
			}
			ctalk cc, 428, cc, tc
		}
		if ( en ) {
			txt -1, name(tc) + " see" + _s(tc) + " maggots breed in the rent stomach of " + name(cc) + ".", name(tc) + " see" + _s(tc) + " " + name(cc) + " chow" + _s(cc) + " dead bodies.", name(tc) + " shudder" + _s(tc) + " at " + name(cc) + your(cc) + " terrifying eyes.", name(tc) + " feel" + _s(tc) + " sick at entrails caught in " + name(cc) + your(cc) + " tentacles."
		}
		dmgsan tc, rnd(role(dice1, dice2, bonus) + 1)
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1136 | _switch_sw ) {
		_switch_sw = 0
		if ( mType != MAP_TYPE_WORLD ) {
			txt -1, lang("それはグローバルマップで読む必要がある。", "You need to read it while you are in the global map.")
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			if ( rnd(5) == 0 ) {
				txt -1, lang("呪われた地図は触れると崩れ落ちた。", "The cursed map crumbles as you touch.")
				iNum(ci)--
				if ( ci >= 5080 ) {
					cell_refresh iX(ci), iY(ci)
				}
				goto *effect_end
			}
		}
		if ( iParam1(ci) == 0 ) {
			item_separate ci
			repeat 1000
				dx = 4 + rnd(mWidth - 8)
				dy = 3 + rnd(mHeight - 6)
				if ( dx >= 50 & dy >= 39 & dx <= 73 & dy <= 54 ) {
					continue
				}
				x = 1, -1, 0, 0
				y = 0, 0, 1, -1
				repeat 4
					f = 1
					cnt2 = cnt
					repeat 3
						p = mapId(dx + x(cnt2) * cnt, dy + y(cnt2) * cnt)
						if ( 264 <= p & p < 363 | (chipm(CHIPM_ATTRIB, p) & CHIPM_ATTRIB_CANT_PASS) ) {
							f = 0
							break
						}
					loop
					if ( f == 1 ) {
						break
					}
				loop
				if ( f == 1 ) {
					break
				}
			loop
			iParam1(ci) = dx
			iParam2(ci) = dy
			iParam3(ci) = gArea 
		}
		if ( iParam3(ci) == gArea  | iParam3(ci) == 0 ) {
			txt -1, lang("何かの場所を記した地図のようだ…", "There's a mark on the map...")
			throwsstpevent "ReadTreasureMap", 0, "", 0
			snd SOUNDLIST_BOOK1
			gsel BUFFER_BUF
			pos 0, 0
			picload_ exedir + "graphic\\paper.bmp", 1
			gsel BUFFER_SCREEN
			redraw 0
			ww = 400
			wh = 300
			wx = (windoww - ww) / 2 + inf_screenx
			wy = winposy(wh)
			gmode 2
			pos wx, wy
			gcopy BUFFER_BUF, 0, 0, ww, wh
			gmode 1, inf_tiles, inf_tiles
			repeat 5
				y = cnt + iParam2(ci) - 2
				sy = cnt * inf_tiles + wy + 26
				repeat 7
					x = cnt + iParam1(ci) - 3
					sx = cnt * inf_tiles + wx + 46
					p = mapId(x, y)
					pos sx + 1, sy + 1
					gcopy BUFFER_MAP, p \ 33 * inf_tiles, p / 33 * inf_tiles
					if ( x == iParam1(ci) ) {
						if ( y == iParam2(ci) ) {
							pos sx, sy
							font lang(cfg_font1, cfg_font2), 40 - en * 2, 2
							color 255, 20, 20
							mes lang("○", "O")
						}
					}
				loop
			loop
			gmode 2
			pos wx, wy
			gcopy BUFFER_BUF, 400, 0, ww, wh
			redraw 1
			press
			snd SOUNDLIST_CARD1
		}
		else {
			snd SOUNDLIST_BOOK1
			txt -1, lang("この地図は別の大陸の地図だ。", "This map is a map of another continent.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1135 | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus <= (-1) ) {
			if ( tc == CHARA_PLAYER ) {
				eatstatus efstatus, tc
			}
			else {
				txt -1, lang("媚薬は呪われていた。" + name(tc) + "は" + name(0) + "を軽蔑のまなざしで見つめた。", "This love potion is cursed. " + name(tc) + " look" + _s(tc) + " at " + name(0) + " with a contemptuous glance.")
				modimp tc, -15
			}
			healcon tc, 13, efp * 5
			obvious = 0
			goto *effect_end
		}
		cEmoIcon(tc) = 17 + 100 * 3
		if ( potionspill | potionthrow ) {
			txt -1, lang(name(tc) + "は恋の予感がした。", name(tc) + " sense" + _s(tc) + " a sigh of love,")
			modimp tc, efp / 15
			dmgcon tc, CONDITION_DIM, 100
			dmgcon tc, 13, 200
			if ( rnd(10000) < limitmax(efp / 200, 100) ) {
				animeload 15, tc
				itemcreate -1, ITEM_ID_BOTTLE_SALT, cX(tc), cY(tc), 0
				if ( stat ) {
					if ( tc == CHARA_PLAYER ) {
						ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
					}
					else {
						iSubName(ci) = cId(tc)
						if ( iSubName(ci) == 343 ) {
							iCNpcId(ci) = cUNID(tc)
							ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(tc)))
						}
					}
				}
			}
			f = 0
			repeat limitmin(efp / 100, 1)
				lovemiracle tc
			loop
			f = 0
			if ( tc != CHARA_PLAYER ) {
				if ( ccthrowpotion == 0 ) {
					if ( efp > 100 ) {
						modkarma 0, limit(efp / 100 * (-1), -20, 0)
					}
				}
			}
			goto *effect_end
		}
		if ( tc == CHARA_PLAYER ) {
			txt -1, lang(name(tc) + "は興奮した！", "You are excited!")
		}
		else {
			txt -1, lang(name(tc) + "は" + name(0) + "を熱いまなざしで見つめた。", name(tc) + " give" + _s(tc) + " " + name(0) + " the eye.")
		}
		if ( rnd(10000) < limitmax(efp / 200, 100) ) {
			animeload 15, tc
			itemcreate -1, ITEM_ID_BOTTLE_SALT, cX(tc), cY(tc), 0
			if ( stat ) {
				if ( tc == CHARA_PLAYER ) {
					ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
				}
				else {
					iSubName(ci) = cId(tc)
					if ( iSubName(ci) == 343 ) {
						iCNpcId(ci) = cUNID(tc)
						ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(tc)))
					}
				}
			}
		}
		f = 0
		repeat limitmin(efp / 100, 1)
			lovemiracle tc
		loop
		f = 0
		modimp tc, efp / 4
		dmgcon tc, CONDITION_DIM, 500
		dmgcon tc, 13, efp * 2
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 654 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			ctalk cc, 427, cc, tc
			ctalk cc, 967, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は" + name(tc) + "の口の中に何かを送り込んだ！", name(cc) + " put" + _s(cc) + " something into " + name(tc) + your(tc) + " body!")
			}
			ctalk cc, 428, cc, tc
		}
		gosub *alien_effect
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 626 | _switch_sw ) {
		_switch_sw = 0
		txt -1, lang("あなたは自分の状態を調べた。", "You examine yourself.")
		animeload 10, tc
		gosub *com_knowSelf
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1101 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_ATK_ELEC
			if ( efstatus <= (-1) ) {
				ctalk tc, 950, tc, tc
				if ( stat == 0 ) {
					ctalk tc, 429, tc, tc
					if ( stat == 0 ) {
						ctalk tc, 1214, tc, tc
						if ( stat == 0 ) {
							if ( tc == CHARA_PLAYER ) {
								txt -1, lang("うわ、これは呪われている。なんだかやばい味だ…", "Geee it's cursed! The taste is very dangerous.")
							}
							else {
								txtef COLOR_SKY_BLUE
								txt tc, lang("「ぺっぺっ、まずー」", cnvtalk("Argh, the milk is cursed!"))
							}
						}
					}
				}
			}
			else {
				ctalk tc, 949, tc, tc
				if ( stat == 0 ) {
					ctalk tc, 430, tc, tc
					if ( stat == 0 ) {
						ctalk tc, 1213, tc, tc
						if ( stat == 0 ) {
							if ( tc == CHARA_PLAYER ) {
								txt -1, lang("濃厚で病み付きになりそうな味だ。", "The taste is very thick, almost addictive.")
							}
							else {
								txtef COLOR_SKY_BLUE
								txt tc, lang("「うまー」", cnvtalk("Yummy!"))
							}
						}
					}
				}
			}
		}
		if ( efstatus >= 1 ) {
			god_applyblessedfoodeffect tc, ci, calcfixexp(tc, ci)
			modheight tc, rnd(5) + 1
		}
		cHunger(tc) += 1000 * (efp / 100)
		if ( efstatus <= (-1) ) {
			modheight tc, (rnd(5) + 1) * (-1)
		}
		if ( tc == CHARA_PLAYER ) {
			gosub *eat_finish
		}
		eatstatus efstatus, tc
		animeload 15, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1102 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( efstatus <= (-1) ) {
				ctalk tc, 431, tc, tc
				if ( stat == 0 ) {
					ctalk tc, 1212, tc, tc
					if ( stat == 0 ) {
						txtef COLOR_SKY_BLUE
						txt tc, lang("「うぃっ…」", "*Hic*"), lang("「まずいぜ」", cnvtalk("Ah, bad booze.")), lang("「げー♪」", cnvtalk("Ugh...")), lang("「腐ったミルクみたいな味だ」", cnvtalk("Bah, smells like rotten milk."))
					}
				}
			}
			else {
				ctalk tc, 432, tc, tc
				if ( stat == 0 ) {
					ctalk tc, 1211, tc, tc
					if ( stat == 0 ) {
						txtef COLOR_SKY_BLUE
						txt tc, lang("「うぃっ！」", "*Hic*"), lang("「うまいぜ」", cnvtalk("Ah, good booze.")), lang("「らららー♪」", cnvtalk("La-la-la-la.")), lang("「ひっく」", cnvtalk("I'm going to heaven.")), lang("「ふぅ」", cnvtalk("Whew!")), lang("「たまらないわ」", cnvtalk("I'm revived!")), lang("「んまっ♪」", cnvtalk("Awesome."))
					}
				}
			}
		}
		if ( godcheck(0) == "dorein" ) {
			efp *= 2
		}
		if ( trophycheck(TROPHY_GOING_BACK) == 2 ) {
			dmgcon tc, CONDITION_DRUNK, efp * 2
		}
		else {
			dmgcon tc, CONDITION_DRUNK, efp
		}
		eatstatus efstatus, tc
		if ( ocbit(11, tc) ) {
			if ( gettrait(tc, 186) ) {
				modstress limit(efp, 0, 1500) * (-1)
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1116 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			if ( tc == CHARA_PLAYER ) {
				txt -1, lang("ぐわぁぁ！", "Arrrrg!")
			}
			txt -1, lang("酸が" + name(tc) + "を溶かした。", "The sulfuric acid melts " + name(tc) + ".")
		}
		if ( cbit(CHARA_BIT_PREGNANT, tc) ) {
			cbitmod CHARA_BIT_PREGNANT, tc, FALSE
			if ( ocAlienChildCreatureID(tc) == 330 ) {
				if ( synccheck(tc, -1) ) {
					txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
					txtef COLOR_SKY_BLUE
					ctalk tc, 970, tc, tc
				}
			}
			else {
				if ( synccheck(tc, -1) ) {
					txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
					txtef COLOR_SKY_BLUE
					ctalk tc, 970, tc, tc
				}
			}
			ocAlienChildCreatureID(tc) = 0
			ocItemDV(tc) = 0
		}
		if ( eqfaction(tc, "acidresist") == 0 ) {
			dmghp tc, efp * efstatusfix(500, 400, 100, 50) / 1000, DAMAGE_FROM_ACID, SKILL_RESDMG_ACID, efp
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1103 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			ctalk tc, 1337, tc, tc
			if ( stat == 0 ) {
				if ( tc == CHARA_PLAYER ) {
					txt -1, lang("*ごくっ* 綺麗な水だ。", "*quaff* The water is refreshing.")
				}
				else {
					txt -1, lang(" *ごくっ* ", "*quaff*")
				}
			}
		}
		sickifcursed efstatus, tc, 1
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1146 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang("*シュワワ*", "*quaff*")
			ctalk tc, 1339, tc, tc
			if ( stat == 0 ) {
				txt -1, lang("刺激的！", "Juicy!")
			}
			txt -1, lang(name(tc) + "のスタミナが少し回復した。", name(tc) + " restore" + _s(tc) + " some stamina.")
		}
		healsp tc, efp / 4
		sickifcursed efstatus, tc, 1
		if ( showdamagecheck(efp / 4) ) {
			if ( synccheck(tc, -1) ) {
				mondmgn(mondmgcnt) = "*" + efp / 4 + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1147 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang("*ごくり*", "*quaff*")
			ctalk tc, 1340, tc, tc
			txt -1, lang(name(tc) + "のスタミナはかなり回復した。", name(tc) + " greatly restore" + _s(tc) + " stamina.")
		}
		healsp tc, efp
		sickifcursed efstatus, tc, 1
		if ( showdamagecheck(efp) ) {
			if ( synccheck(tc(cnt), -1) ) {
				mondmgn(mondmgcnt) = "*" + efp + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc(cnt), cc
				ccolor 110
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1142 | _switch_sw ) {
		_switch_sw = 0
		if ( cnRace(tc) == "snail" ) {
			food_meltbysalt tc
		}
		else {
			if ( synccheck(tc, -1) ) {
				txtef COLOR_SKY_BLUE
				ctalk tc, 1246, tc, tc
				if ( stat == 0 ) {
					txt tc, lang("「しょっぱ〜」", cnvtalk("Salty!"))
				}
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1130 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			ctalk tc, 1338, tc, tc
			if ( stat == 0 ) {
				if ( tc == CHARA_PLAYER ) {
					txt -1, lang("*ごくっ* まずい！", "*quaff* Yucky!")
				}
				else {
					txt -1, lang(" *ごくっ* ", "*quaff*")
				}
			}
		}
		sickifcursed efstatus, tc, 1
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 300 | _switch_sw ) {
		_switch_sw = 0
		if ( gQuest == QUEST_TYPE_CONQUER | gQuest == QUEST_TYPE_HUNTEX | gQuest == 1021 ) {
			if ( gQuestStatus != QUEST_STATE_SUCCESS ) {
				txt -1, lang("そんなことをしている余裕はない！", "You have no time for it!")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(efid) / 2 + 1) + skillCost(efid) / 2 + 1
		}
		invsubroutine = 1
		invctrl = INVCTRL_PICKPOCKET, 0
		snd SOUNDLIST_INV
		gosub *label_2974
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 301 | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(efid) / 2 + 1) + skillCost(efid) / 2 + 1
		}
		if ( gRider != 0 ) {
			if ( tc == cc ) {
				cell_findspace cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1
				if ( stat == 0 ) {
					txt -1, lang("降りるスペースがない。", "There's no place to get off.")
					goto *effect_end
				}
				cell_setchara gRider, rtval, rtval(1)
				txt -1, lang(name(gRider) + "から降りた。", "You dismount from " + name(gRider) + ".")
				txtef COLOR_SKY_BLUE
				ctalk gRider, 997, cc, gRider
				if ( stat == 0 ) {
					if ( cbit(CHARA_BIT_INFERIOR_RIDING, gRider) ) {
						ctalk gRider, 1230, cc, gRider
					}
					else {
						ctalk gRider, 1231, cc, gRider
					}
					if ( stat == 0 ) {
						txtef COLOR_SKY_BLUE
						if ( jp ) {
							txt gRider, name(gRider) + "「ふぅ」", name(gRider) + "「乗り心地はよかった？」", name(gRider) + "「疲れた…」", name(gRider) + "「またいつでも乗ってね♪」"
						}
						if ( en ) {
							txt gRider, name(gRider) + " " + cnvtalk("Phew."), name(gRider) + " " + cnvtalk("How was my ride?"), name(gRider) + " " + cnvtalk("Tired...tired..."), name(gRider) + " " + cnvtalk("It was nice.")
						}
					}
				}
				ride_end
				goto *effect_end
			}
		}
		if ( tc >= MAX_CHARA_FOLLOWER | cRole(tc) == 20001 ) {
			txt -1, lang("仲間にしか騎乗できない。", "You can only ride an ally.")
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_BODYGUARD, tc) == TRUE | cbit(CHARA_BIT_GUARD_TEMP, tc) == TRUE ) {
			txt -1, lang("護衛対象には騎乗できない。", "You can't ride a client.")
			goto *effect_end
		}
		if ( tc == cc ) {
			if ( gRider == 0 ) {
				txt -1, lang(name(cc) + "は自分に乗ろうとした。", "You try to ride yourself.")
			}
			goto *effect_end
		}
		if ( cType(tc) != 0 ) {
			txt -1, lang("その仲間はこの場所に滞在中だ。", "The ally currently stays in this area.")
			goto *effect_end
		}
		if ( gRider != 0 ) {
			txt -1, lang("現在" + name(cc) + "は" + name(gRider) + "に騎乗している。", name(cc) + " " + is(cc) + " currently riding " + name(gRider) + ".")
			goto *effect_end
		}
		if ( ocPetBeingRiddenIdx(tc) != 0 ) {
			txt -1, lang("現在" + name(tc) + "は" + name(ocPetBeingRiddenIdx(tc)) + "が騎乗している。", name(ocPetBeingRiddenIdx(tc)) + " " + is(ocPetBeingRiddenIdx(tc)) + " currently riding " + name(tc) + ".")
			goto *effect_end
		}
		if ( ocPetRidingIdx(tc) != 0 ) {
			txt -1, lang("現在" + name(tc) + "は" + name(ocPetRidingIdx(tc)) + "に騎乗している。", name(tc) + " " + is(tc) + " currently riding " + name(ocPetRidingIdx(tc)) + ".")
			goto *effect_end
		}
		ride_begin tc
		txtef COLOR_SKY_BLUE
		ctalk gRider, 996, cc, gRider
		if ( stat == 0 ) {
			if ( cbit(CHARA_BIT_INFERIOR_RIDING, gRider) ) {
				ctalk gRider, 1228, cc, gRider
			}
			else {
				ctalk gRider, 1229, cc, gRider
			}
			if ( stat == 0 ) {
				txtef COLOR_SKY_BLUE
				if ( jp ) {
					txt gRider, name(gRider) + "「うぐぅ」", name(gRider) + "「ダイエットしてよ…」", name(gRider) + "「いくよ！」", name(gRider) + "「やさしくしてね♪」"
				}
				if ( en ) {
					txt gRider, name(gRider) + " " + cnvtalk("Awww."), name(gRider) + " " + cnvtalk("You should go on a diet."), name(gRider) + " " + cnvtalk("Let's roll!"), name(gRider) + " " + cnvtalk("Be gentle.")
				}
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 183 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			f = 0
			inv_getheader cc
			repeat invrange, invhead
				if ( iNum(cnt) == 0 ) {
					continue
				}
				if ( iSkillRef(cnt) == SKILL_NORMAL_PERFORMER ) {
					ci = cnt
					f = 1
					break
				}
			loop
			if ( f == 0 ) {
				return 0
			}
		}
		if ( sPerform(cc) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は演奏のやり方を知らない。", name(cc) + " " + does(cc == CHARA_PLAYER) + "n't know how to play an instrument.")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(efid) / 2 + 1) + skillCost(efid) / 2 + 1
		}
		gosub *label_3295
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 184 | _switch_sw ) {
		_switch_sw = 0
		if ( sCooking(CHARA_PLAYER) == 0 ) {
			txt -1, lang("料理の仕方を知らない。", "You don't know how to cook.")
			return 0
		}
		cooktool = ci
		invsubroutine = 1
		invctrl = INVCTRL_COOK
		snd SOUNDLIST_INV
		gosub *label_2974
		if ( stat == 0 ) {
			return 0
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
					goto *effect_end
				}
			}
			p = rnd(skillCost(efid) / 2 + 1) + skillCost(efid) / 2 + 1
			if ( gettrait(0, 86) ) {
				p -= p * calctraitscore(stat) / 10
			}
			dmgsp CHARA_PLAYER, p
		}
		if ( ogTitleBestInPalmia == 2 ) {
			gosub *label_4309
		}
		else {
			gosub *label_1840
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 185 | _switch_sw ) {
		_switch_sw = 0
		if ( sFishing(CHARA_PLAYER) == 0 ) {
			txt -1, lang("釣りの仕方を知らない。", "You don't know how to fish.")
			return 0
		}
		if ( inv_getspace() == 0 ) {
			txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
			return 0
		}
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 ) {
			txt -1, lang("釣竿には餌が付いていない。", "You need a bait to fish.")
			txt -1, lang("餌を一括装着する？", "Will you put food all at once?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval != 0 ) {
				return 0
			}
			ti = ci
			invsubroutine = 1
			invctrl = INVCTRL_MARK_ITEM, 0
			gosub *label_2974
			if ( stat == 0 ) {
				return 0
			}
			item_separate ti
			txt -1, lang(itemname(ci) + "を" + itemname(ti) + "に装着した。", "Added" + itemname(ti) + "to" + itemname(ci) + ".")
			iParam4(ti) = iParam1(ci)
			repeat
				if ( iNum(ci) == 0 ) {
					break
				}
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ti) += rnd(10) + 15
				removeitem ci, 1
			loop
			return 0
		}
		f = 0
		repeat 3
			y = cY(cc) + cnt - 1
			x = cX(cc)
			if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
				continue
			}
			if ( chipm(CHIPM_ROLE, mapId(x, y)) == MAP_CHIP_ROLE_WATER ) {
				f = 1
				break
			}
		loop
		if ( f == 0 ) {
			repeat 3
				y = cY(cc)
				x = cX(cc) + cnt - 1
				if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
					continue
				}
				if ( chipm(CHIPM_ROLE, mapId(x, y)) == MAP_CHIP_ROLE_WATER ) {
					f = 1
					break
				}
			loop
		}
		if ( f == 0 ) {
			msgdup++
			txt -1, lang("釣りをする場所が見当たらない。", "This isn't a good place to fish.")
			gosub *screen_draw
			return 0
		}
		if ( chipm(CHIPM_ROLE, mapId(cX(CHARA_PLAYER), cY(CHARA_PLAYER))) == MAP_CHIP_ROLE_WATER ) {
			txt -1, lang("水の中からは釣れない。", "You can't fish while swimming.")
			gosub *screen_draw
			return 0
		}
		if ( cX(CHARA_PLAYER) - x > 0 ) {
			cDir(CHARA_PLAYER) = 1
		}
		if ( cX(CHARA_PLAYER) - x < 0 ) {
			cDir(CHARA_PLAYER) = 2
		}
		if ( cY(CHARA_PLAYER) - y > 0 ) {
			cDir(CHARA_PLAYER) = 3
		}
		if ( cY(CHARA_PLAYER) - y < 0 ) {
			cDir(CHARA_PLAYER) = 0
		}
		gRunDir = cDir(CHARA_PLAYER)
		fishx = x
		fishy = y
		addefmap fishx, fishy, 1, 3
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(185) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(185) / 2 + 1) + skillCost(185) / 2 + 1
		}
		item_separate ci
		nc_intb_101 = ci
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
		item_autostack cc, ci
		rowactre = 0
		gosub *fishing
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 406 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 407 | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus <= (-1) ) {
			if ( synccheck(tc, -1) ) {
				if ( godcheck(tc) == "fuuri" ) {
					txt -1, lang(name(tc) + "は呪いの神の寵愛を感じた。", name(tc) + " feel" + _s(tc) + " the favor from God of curse.")
				}
				else {
					txt -1, lang(name(tc) + "は悪魔が笑う声を聞いた。", name(tc) + " hear" + _s(tc) + " devils laugh.")
				}
			}
			goto *label_3452
		}
		gosub *label_4619
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1120 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt -1, lang(name(tc) + "は黄金の輝きに包まれた！", "A golden aura wraps " + name(tc) + "!")
		gosub *label_3578
		animeid = ANIMATION_HEAL
		gosub *anime
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1117 | _switch_sw ) {
		_switch_sw = 0
		if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		snd SOUNDLIST_DING2
		txt -1, lang("たくさんの素材が降ってきた！", "Some materials fall from above!")
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 0 & gettrait(0, 190) == 0 & oom_material == 1 | cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
			oom_material = 0
		}
		repeat rnd(3) + 3 + (efstatus >= 1) * 6
			olist = 13, 14, 15, 16
			atxspot = olist(rnd(4))
			if ( efstatus >= 0 ) {
				p = random_material(atxspot, 10 + efstatus * 10)
			}
			else {
				olist = 0, 1, 10, 11, 20, 21, 30, 31
				p = olist(rnd(8))
			}
			matgetmain p, 1
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 632 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 454 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}

	if ( _switch_val == 1144 | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			goto *jump_changeCreature
		}
		if ( efid == SKILL_SPACT_EYE_OF_MUTATION ) {
			ctalk cc, 427, cc, tc
			txt -1, lang(name(cc) + "は" + name(tc) + "を気の狂いそうな眼差しで見た。", name(cc) + " cast" + _s(cc) + " an insane glance on " + name(tc) + ".")
			if ( rnd(3) ) {
				goto *effect_end
			}
		}
		if ( tc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		if ( findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1 ) {
			if ( encfind(tc, ENCHANT_RES_MUTATION) != (-1) ) {
				if ( rnd(5) ) {
					txt -1, lang("あなたは変異を受け付けなかった。", "You resist the threat of mutation.")
					goto *effect_end
				}
			}
		}
*delMutation_cursed
		f = 0
		p = 1
		if ( efid == SKILL_EFFECT_POTION_EVOLUTION ) {
			p = 2 + rnd(3)
		}
		repeat p
			repeat 100
				tid = rnd(46)
				traitmode = 0
				r1 = 0
				gosub *trait_ref
				if ( stat == 0 | traitref != 1 ) {
					continue
				}
				if ( rnd(2) ) {
					p = 1
				}
				else {
					p = -1
				}
				if ( gettrait(0, tid) >= traitref(2) ) {
					p = -1
				}
				if ( gettrait(0, tid) <= traitref(1) ) {
					p = 1
				}
				if ( efstatus <= (-1) ) {
					if ( p == 1 ) {
						continue
					}
				}
				else {
					if ( p == (-1) ) {
						if ( efstatus >= 1 ) {
							if ( rnd(3) == 0 ) {
								continue
							}
						}
						if ( efid == SKILL_EFFECT_POTION_EVOLUTION ) {
							continue
						}
					}
				}
				addtrait 0, tid, p
				txt -1, lang("あなたは変容した！ ", "You mutate.")
				if ( efid == SKILL_SPACT_EYE_OF_MUTATION ) {
					ctalk cc, 428, cc, tc
				}
				if ( p > 0 ) {
					txtef COLOR_GREEN
					txt -1, traitrefn(0)
					throwsstpevent "Mutation", 0, traitrefn(0), p
				}
				else {
					txtef COLOR_RED
					txt -1, traitrefn(1)
					throwsstpevent "Mutation", 0, traitrefn(1), p
				}
				animeload 8, 0
				f = 1
				break
			loop
		loop
		if ( f == 0 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		r1 = 0
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1121 | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			if ( synccheck(tc, -1) ) {
				txt -1, lang("これは呪われている！", "It's cursed!")
			}
			goto *delMutation_cursed
		}
		olistmax = 0
		repeat 222
			if ( gettrait(0, cnt) == 0 ) {
				continue
			}
			if ( efstatus >= 1 & gettrait(0, cnt) > 0 ) {
				continue
			}
			olist(olistmax) = cnt
			olistmax++
		loop
		f = 0
		if ( olistmax > 0 ) {
			repeat 1 + (efstatus >= 0) + rnd(2)
				repeat 100
					tid = olist(rnd(olistmax))
					if ( gettrait(0, tid) == 0 ) {
						continue
					}
					traitmode = 0
					r1 = 0
					gosub *trait_ref
					if ( stat == 0 | traitref != 1 ) {
						continue
					}
					if ( gettrait(0, tid) > 0 ) {
						p = -1
					}
					if ( gettrait(0, tid) < 0 ) {
						p = 1
					}
					settrait 0, tid, 0
					txt -1, lang("あなたは元の自分に近づいた気がした。", "You are now one step closer to yourself.")
					if ( p > 0 ) {
						txtef COLOR_GREEN
						txt -1, traitrefn(0)
						throwsstpevent "MutationCured", tc, traitrefn(0), p
					}
					else {
						txtef COLOR_RED
						txt -1, traitrefn(1)
						throwsstpevent "MutationCured", tc, traitrefn(1), p
					}
					f = 1
					break
				loop
			loop
		}
		if ( f == 0 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		r1 = 0
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 411 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = INVCTRL_IDENTIFY
		snd SOUNDLIST_INV
		gosub *label_2974
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 461 | _switch_sw ) {
		_switch_sw = 0
		if ( mType == MAP_TYPE_WORLD ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			txt -1, lang("冥界から死霊が呼び出された！", "Hoards of undead raise from the hell!")
			repeat 4 + rnd(4)
				flt calcobjlv(difficulty()), calcfixlv(FIX_QUALITY_GREAT)
				fltn "undead"
				characreate -1, CREATURE_ID_BUG, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			loop
			obvious = 0
			goto *effect_end
		}
		allyctrl = 2
		gosub *label_2694
		if ( stat == (-1) ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		if ( bonus < rnd(100) ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "の力は冥界に及ばなかった。", name(cc) + your(cc) + " prayer doesn't reach the underworld.")
			}
			goto *effect_end
		}
		rc = stat
		gosub *resurrect
		cxinit = cX(cc)
		cyinit = cY(cc)
		place_chara rc, cxinit, cyinit
		cType(rc) = 0
		txtef COLOR_YELLOW
		txt -1, cnven(cnName(rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
		ctalk rc, 1263, rc, cc
		if ( stat == 0 ) {
			txt rc, lang("「ありがとう！」", cnvtalk("Thanks!"))
		}
		animeid = ANIMATION_HOLY
		animode = 100 + rc
		gosub *anime
		snd SOUNDLIST_PRAY2
		cEmoIcon(rc) = 17 + 100 * 3
		if ( cc == CHARA_PLAYER ) {
			modimp rc, 15
			if ( rc >= MAX_CHARA_FOLLOWER & cRole(rc) != ROLE_PET_SENTRY & cRole(rc) != ROLE_PET_MAID & eqfaction(rc, "petshop") == 0 ) {
				modkarma 0, 2
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 412 | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus >= 1 ) {
			if ( synccheck(tc, -1) ) {
				txt -1, lang(name(tc) + "は聖なる光に包み込まれた。", name(tc) + " " + is(tc) + " surrounded by a holy aura.")
			}
		}
		else {
			if ( efstatus <= (-1) ) {
				if ( synccheck(tc, -1) ) {
					if ( godcheck(tc) == "fuuri" ) {
						txt -1, lang(name(tc) + "は呪いの神の寵愛を感じた。", name(tc) + " feel" + _s(tc) + " the favor from God of curse.")
					}
					else {
						txt -1, lang(name(tc) + "は悪魔が笑う声を聞いた。", name(tc) + " hear" + _s(tc) + " devils laugh.")
					}
				}
				goto *label_3452
			}
		}
		gosub *label_4617
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 413 | _switch_sw ) {
		_switch_sw = 0
		if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			artifactlocation = ""
			txt -1, lang("何かがあなたの耳元でささやいたが、あなたは聞き取ることができなかった。", "You hear a sepulchral whisper but the voice is too small to distinguish a word.")
			goto *effect_end
		}
		if ( tc == CHARA_PLAYER ) {
			if ( artifactlocation == "" ) {
				txt -1, lang("まだ特殊なアイテムは生成されていない。", "No artifacts have been generated yet.")
			}
			else {
				notesel artifactlocation
				repeat noteinfo(0)
					noteget s, 0
					txt -1, cnven(s)
					notedel 0
				loop
			}
		}
		if ( efp > 0 ) {
			healmp cc, 150 + efp / 5
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は何かに見守られている感じがした。", name(cc) + " feel as someone is watching you intently.")
				txt -1, lang(name(cc) + "のマナが回復した。", name(cc) + your(cc) + " mana is restored.")
				animeid = ANIMATION_HEAL
				gosub *anime
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1000 | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			tc = CHARA_PLAYER
			txt -1, lang("どの方向？", "Which direction?")
			gosub *screen_draw
			gosub *prompt_direction
			if ( stat == 0 ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) += 1
				return 0
			}
			if ( mapChara(tlocx, tlocy) == 0 ) {
				noeffect = 1
				obvious = 0
				return 1
			}
			tc = mapChara(tlocx, tlocy) - 1
		}
		else {
			if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) > skillTg(efid) \ 1000 + 1 ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) += 1
				return 0
			}
			tlocx = cX(tc)
			tlocy = cY(tc)
		}
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "は不気味な光に包み込まれた。", name(tc) + " " + is(tc) + " surrounded by a black aura.")
		}
		gosub *label_5011
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1104 | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		f = 0
		repeat 1 + (efstatus >= 1)
			cnt2 = cnt
			repeat 2000
				await
				p = rnd(467 - 400) + 400
				if ( p == 441 ) {
					if ( rnd(10) ) {
						continue
					}
				}
				if ( p == 409 | p == 425 | p == 437 | p == 439 | p == 440 | p == 461 | p == 465 | p == 466 ) {
				}
				else {
					if ( rnd(2) ) {
						continue
					}
				}
				if ( efstatus >= 0 ) {
					if ( skillUse(p) != SKILL_NONE ) {
						if ( cnt2 == 0 ) {
							s = lang("突然、", "Suddenly, ")
						}
						else {
							s = lang("さらに、", "Furthermore, ")
						}
						skillgain CHARA_PLAYER, p, 1, 100 * 2
						txtef COLOR_GREEN
						txt -1, lang(s + name(0) + "は" + skillname(p) + "の魔法の知識を得た。", s + "you gain knowledge of a spell, " + skillname(p) + ".")
						snd SOUNDLIST_DING2
						f = 1
						break
					}
				}
				else {
					p = p - 400
					if ( spell(p) > 0 ) {
						spell(p) = 0
						txt -1, lang("これは呪われている！", "It's cursed!")
						txtef COLOR_RED
						txt -1, lang("突然、" + name(0) + "は" + skillname(p + 400) + "の魔法の知識を失った。", "Suddenly, you lose knowledge of a spell, " + skillname(p + 400) + ".")
						snd SOUNDLIST_CURSE3
						animeload 14, 0
						f = 1
						break
					}
				}
			loop
		loop
		if ( f == 0 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1143 | _switch_sw ) {
		_switch_sw = 0
		if ( efstatus <= 0 ) {
			if ( cLevel(tc) <= 1 ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				obvious = 0
				goto *effect_end
			}
			repeat iLevel(ci) + 1
				if ( cLevel(tc) <= 1 ) {
					break
				}
				cLevel(tc)--
				cExp(tc) = 0
				r1 = tc
				gosub *label_1592
			loop
			txtef COLOR_PURPLE
			txt -1, lang(name(tc) + "のレベルが下がった…", name(tc) + " lose" + _s(tc) + " a level...")
		}
		else {
			repeat iLevel(ci) + 1
				cExp(tc) = cExpToNext(tc)
				r1 = tc
				r2 = 0
				gosub *label_1588
			loop
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_DING1
			}
		}
		if ( efstatus <= (-1) ) {
			txt -1, lang("これは呪われている！", "It's cursed!")
			repeat 50 - 10, 10
				if ( rnd(3) == 0 ) {
					if ( cnt <= 17 ) {
						if ( sdata(cnt, tc) != 0 ) {
							skillexp2 cnt, tc, -1000
						}
					}
				}
			loop
			animeload 8, tc
		}
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1150 | _switch_sw ) {
		_switch_sw = 0
		rndcnt = 0
		nc_intb_100 = iValue(ci)
		repeat
			if ( rndcnt == 3 ) {
				break
			}
			rndcnt += 1
			if ( rndcnt == 1 ) {
				rndeffect = iParam1(ci) / 10000
				rndturn = iParam1(ci) \ 10000
			}
			if ( rndcnt == 2 ) {
				rndeffect = iParam2(ci) / 10000
				rndturn = iParam2(ci) \ 10000
			}
			if ( rndcnt == 3 ) {
				rndeffect = iParam3(ci) / 10000
				rndturn = iParam3(ci) \ 10000
			}
			randomize iParam1(ci) + iParam2(ci) + iParam3(ci) + rndcnt
			lint_efp = (rnd(500) + 1) * 10 + 100 * (iLevel(ci) * (iLevel(ci) / 3 + 1) + 1)
			efp = limitmax(lint_efp, 2147483647)
			if ( rndeffect < 5 ) {
				continue
			}
			if ( rndeffect == 5 ) {
				if ( synccheck(tc, -1) ) {
					ctalk tc, 1337, tc, tc
					if ( stat == 0 ) {
						if ( tc == CHARA_PLAYER ) {
							txt -1, lang("*ごくっ* 綺麗な水だ。", "*quaff* The water is refreshing.")
						}
						else {
							txt -1, lang(" *ごくっ* ", "*quaff*")
						}
					}
					sickifcursed efstatus, tc, 1
				}
				continue
			}
			else {
				if ( rndeffect == 6 ) {
					if ( synccheck(tc, -1) ) {
						if ( efstatus <= (-1) ) {
							ctalk tc, 431, tc, tc
							if ( stat == 0 ) {
								ctalk tc, 1212, tc, tc
								if ( stat == 0 ) {
									txtef COLOR_SKY_BLUE
									txt tc, lang("「うぃっ…」", "*Hic*"), lang("「まずいぜ」", cnvtalk("Ah, bad booze.")), lang("「げー♪」", cnvtalk("Ugh...")), lang("「腐ったミルクみたいな味だ」", cnvtalk("Bah, smells like rotten milk."))
								}
							}
						}
						else {
							ctalk tc, 432, tc, tc
							if ( stat == 0 ) {
								ctalk tc, 1211, tc, tc
								if ( stat == 0 ) {
									txtef COLOR_SKY_BLUE
									txt tc, lang("「うぃっ！」", "*Hic*"), lang("「うまいぜ」", cnvtalk("Ah, good booze.")), lang("「らららー♪」", cnvtalk("La-la-la-la.")), lang("「ひっく」", cnvtalk("I'm going to heaven.")), lang("「ふぅ」", cnvtalk("Whew!")), lang("「たまらないわ」", cnvtalk("I'm revived!")), lang("「んまっ♪」", cnvtalk("Awesome."))
								}
							}
						}
					}
					if ( trophycheck(TROPHY_GOING_BACK) == 2 ) {
						dmgcon tc, CONDITION_DRUNK, efp
					}
					else {
						dmgcon tc, CONDITION_DRUNK, efp
					}
					continue
				}
				else {
					if ( rndeffect == 7 ) {
						efid = SKILL_SPELL_CURE_OF_ERIS
						gosub *drinkPotion
					}
					else {
						if ( rndeffect == 8 ) {
							if ( synccheck(tc, -1) ) {
								txt -1, lang(name(tc) + "はひどい頭痛におそわれた！", "A foul stench floods " + name(tc) + your(tc) + " nostrils!")
							}
							dmgcon tc, CONDITION_CONFUSE, efp
							continue
						}
						else {
							if ( rndeffect == 9 ) {
								if ( synccheck(tc, -1) ) {
									txt -1, lang(name(tc) + "は痺れた！", name(tc) + " get" + _s(tc) + " numbness!")
								}
								dmgcon tc, CONDITION_PARALYZE, efp
								continue
							}
							else {
								if ( rndeffect == 10 ) {
									if ( synccheck(tc, -1) ) {
										txt -1, lang(name(tc) + "は墨を浴びた！", "Ink squirts into " + name(tc) + your(tc) + " face!")
									}
									dmgcon tc, CONDITION_BLIND, efp
									continue
								}
								else {
									if ( rndeffect == 11 ) {
										if ( synccheck(tc, -1) ) {
											txt -1, lang(name(tc) + "は甘い液体を浴びた！", "Strange sweet liquid splashes onto " + name(tc) + "!")
										}
										dmgcon tc, CONDITION_SLEEP, efp
										continue
									}
									else {
										if ( rndeffect == 12 ) {
											if ( synccheck(tc, -1) ) {
												txt -1, lang(name(tc) + "は毒を浴びた！", name(tc) + " " + is(tc) + " hit by poison!")
											}
											if ( cbit(CHARA_BIT_PREGNANT, tc) ) {
												cbitmod CHARA_BIT_PREGNANT, tc, FALSE
												if ( ocAlienChildCreatureID(tc) == 330 ) {
													if ( synccheck(tc, -1) ) {
														txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
														txtef COLOR_SKY_BLUE
														ctalk tc, 970, tc, tc
													}
												}
												else {
													if ( synccheck(tc, -1) ) {
														txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
														txtef COLOR_SKY_BLUE
														ctalk tc, 970, tc, tc
													}
												}
												ocAlienChildCreatureID(tc) = 0
												ocItemDV(tc) = 0
											}
											dmgcon tc, CONDITION_POISON, efp
											continue
										}
										else {
											if ( rndeffect == 13 ) {
												if ( synccheck(tc, -1) ) {
													if ( efstatus <= (-1) ) {
														snd SOUNDLIST_CURSE3
														txt -1, lang(name(tc) + "の肉体は蝕まれた。", name(tc) + your(tc) + " body is damaged.")
													}
													else {
														txt -1, lang(name(tc) + "の肉体は復活した。", name(tc) + your(tc) + " body is restored.")
														animeload 10, tc
													}
													if ( efstatus >= 1 ) {
														txt -1, lang("さらに、" + name(tc) + "の肉体は強化された。", "In addition, " + his(tc) + " body is enchanted.")
														animeload 10, tc
													}
												}
												p = 10, 11, 12, 17, 18, -1
												repeat
													if ( p(cnt) == (-1) ) {
														break
													}
													i = p(cnt) + 240 - 10
													if ( efstatus <= (-1) ) {
														if ( cQuality(tc) <= FIX_QUALITY_GREAT ) {
															cdata(i, tc) -= rnd(sorgex(p(cnt), tc)) / 5 + rnd(5)
															continue
														}
													}
													if ( cdata(i, tc) < 0 ) {
														cdata(i, tc) = 0
													}
													if ( efstatus >= 1 ) {
														cdata(i, tc) = sorgex(p(cnt), tc) / 10 + 5
													}
												loop
												continue
											}
											else {
												if ( rndeffect == 14 ) {
													if ( synccheck(tc, -1) ) {
														if ( efstatus <= (-1) ) {
															snd SOUNDLIST_CURSE3
															txt -1, lang(name(tc) + "の精神は蝕まれた。", name(tc) + your(tc) + " spirit is damaged.")
														}
														else {
															txt -1, lang(name(tc) + "の精神は復活した。", name(tc) + your(tc) + " spirit is restored.")
															animeload 10, tc
														}
														if ( efstatus >= 1 ) {
															txt -1, lang("さらに、" + name(tc) + "の精神は強化された。", "In addition, " + his(tc) + " spirit is enchanted.")
															animeload 10, tc
														}
													}
													p = 14, 13, 16, 15, 19, -1
													repeat
														if ( p(cnt) == (-1) ) {
															break
														}
														i = p(cnt) + 240 - 10
														if ( efstatus <= (-1) ) {
															if ( cQuality(tc) <= FIX_QUALITY_GREAT ) {
																cdata(i, tc) -= rnd(sorgex(p(cnt), tc)) / 5 + rnd(5)
																continue
															}
														}
														if ( cdata(i, tc) < 0 ) {
															cdata(i, tc) = 0
														}
														if ( efstatus >= 1 ) {
															cdata(i, tc) = sorgex(p(cnt), tc) / 10 + 5
														}
													loop
													continue
												}
												else {
													if ( rndeffect == 15 ) {
														if ( efstatus >= 1 ) {
															repeat 18 - 10, 10
																modgrowth2 tc, cnt, rnd(efp / 200 + 3) + 1
															loop
															txt -1, lang(name(tc) + "の全ての能力の潜在能力が上昇した。", name(tc) + your(tc) + " potential of every attribute expands.")
															animeid = ANIMATION_HOLY
															animode = 100 + tc
															gosub *anime
															snd SOUNDLIST_DING3
														}
														else {
															i = rnd(18 - 10) + 10
															valn = skillname(i)
															if ( efstatus == 0 ) {
																txt -1, lang(name(tc) + "の" + valn + "の潜在能力が上昇した。", name(tc) + your(tc) + " potential of " + valn + " expands.")
																modgrowth2 tc, i, rnd(efp / 200 + 3) + 1
																snd SOUNDLIST_DING2
															}
															else {
																txt -1, lang(name(tc) + "の" + valn + "の潜在能力が減少した。", name(tc) + your(tc) + " potential of " + valn + " decreases.")
																modgrowth2 tc, i, (rnd(efp / 200 + 3) + 1) * (-1)
																snd SOUNDLIST_CURSE3
															}
														}
														autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
														if ( cfg_noautosave > 0 & gettrait(0, 190) == 0 & cc != CHARA_PLAYER | cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
															autosave = 0
														}
														continue
													}
													else {
														if ( rndeffect == 16 ) {
															efid = SKILL_SPELL_HOLY_SHIELD
															gosub *drinkPotion
															continue
														}
														else {
															if ( rndeffect == 17 ) {
																efid = SKILL_SPELL_REGENERATION
																gosub *drinkPotion
																continue
															}
															else {
																if ( rndeffect == 18 ) {
																	efid = SKILL_SPELL_ATTRIBUTE_SHIELD
																	gosub *drinkPotion
																	continue
																}
																else {
																	if ( rndeffect == 19 ) {
																		efid = SKILL_SPELL_SPEED
																		gosub *drinkPotion
																		continue
																	}
																	else {
																		if ( rndeffect == 20 ) {
																			efid = SKILL_SPELL_HERO
																			gosub *drinkPotion
																			continue
																		}
																		else {
																			if ( rndeffect == 21 ) {
																				efid = SKILL_SPELL_SLOW
																				gosub *drinkPotion
																				continue
																			}
																			else {
																				if ( rndeffect == 22 ) {
																					efid = SKILL_SPELL_MIST_OF_FRAILNESS
																					gosub *drinkPotion
																					continue
																				}
																				else {
																					if ( rndeffect == 23 ) {
																						efid = SKILL_SPELL_MIST_OF_SILENCE
																						gosub *drinkPotion
																						continue
																					}
																					else {
																						if ( rndeffect == 24 ) {
																							f = 0
																							repeat 10
																								p = rnd(61 - 50) + 50
																								if ( sorg(p, tc) >= 150 ) {
																									f++
																									resistmod tc, p, 50 * (-1)
																									if ( f >= efp / 100 ) {
																										break
																									}
																								}
																							loop
																							if ( f == 0 ) {
																								txt -1, lang("何も起こらなかったようだ。", "Nothing happens.")
																								obvious = 0
																							}
																							else {
																								snd SOUNDLIST_CURSE1
																							}
																							continue
																						}
																						else {
																							if ( rndeffect == 25 ) {
																								if ( synccheck(tc, -1) ) {
																									if ( tc == CHARA_PLAYER ) {
																										txt -1, lang("ぐわぁぁ！", "Arrrrg!")
																									}
																									txt -1, lang("酸が" + name(tc) + "を溶かした。", "The sulfuric acid melts " + name(tc) + ".")
																								}
																								if ( cbit(CHARA_BIT_PREGNANT, tc) ) {
																									cbitmod CHARA_BIT_PREGNANT, tc, FALSE
																									if ( ocAlienChildCreatureID(tc) == 330 ) {
																										if ( synccheck(tc, -1) ) {
																											txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
																											txtef COLOR_SKY_BLUE
																											ctalk tc, 970, tc, tc
																										}
																									}
																									else {
																										if ( synccheck(tc, -1) ) {
																											txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
																											txtef COLOR_SKY_BLUE
																											ctalk tc, 970, tc, tc
																										}
																									}
																									ocAlienChildCreatureID(tc) = 0
																									ocItemDV(tc) = 0
																								}
																								dmghp tc, efp * efstatusfix(500, 400, 100, 50) / 1000, DAMAGE_FROM_ACID, SKILL_RESDMG_ACID, efp
																								continue
																							}
																							else {
																								if ( rndeffect == 26 ) {
																									if ( synccheck(tc, -1) ) {
																										if ( tc == CHARA_PLAYER ) {
																											txt -1, lang("ぐわぁぁ！", "Arrrrg!")
																										}
																										txt -1, lang("薬が" + name(tc) + "の胃の中で爆発した。", "The sulfuric acid melts " + name(tc) + ".")
																									}
																									aniref = 0
																									animeid = ANIMATION_BALL
																									anix = cX(tc)
																									aniy = cY(tc)
																									dmghp tc, efp * 10, tc, SKILL_SPACT_DECAPITATION
																									continue
																								}
																								else {
																									if ( rndeffect == 27 ) {
																										efp = limit(efp / 100, 50, 2000)
																										if ( tc != CHARA_PLAYER ) {
																											if ( cId(tc) == CREATURE_ID_PAELS_MOM_LILY & cRelation(tc) == RELATION_ALLY & cPic(tc) != xy2pic(30, 10) ) {
																												txt -1, lang(name(tc) + "の顔が変異した！", name(tc) + "'s face mutates!")
																												animeload 8, tc
																												cPic(tc) = xy2pic(30, 10)
																												cPortrait(tc) = -1
																											}
																											if ( cId(tc) == CREATURE_ID_FAIRY & cRelation(tc) == RELATION_ALLY & cPic(tc) != xy2pic(5, 15) ) {
																												txt -1, lang(name(tc) + "の姿が変異した！", name(tc) + "'s skin mutates!")
																												animeload 8, tc
																												if ( gArea  == 59 ) {
																													cPic(tc) = xy2pic(26, 13)
																												}
																												else {
																													cPic(tc) = xy2pic(5, 15)
																												}
																												cPortrait(tc) = -1
																												goto *effect_end
																											}
																											txt -1, lang("何もおきない… ", "Nothing happens...")
																										}
																										snd SOUNDLIST_PRAY1
																										if ( efstatus >= 0 ) {
																											txtef COLOR_GREEN
																											txt -1, lang("エーテルの抗体があなたの体内に行き渡った。", "Your Ether Disease is cured greatly.")
																											modcorrupt efp * (-10)
																										}
																										else {
																											txtef COLOR_PURPLE
																											txt -1, lang("エーテルの病菌があなたの体内に行き渡った。", " The Ether Disease spreads around your body.")
																											modcorrupt 200
																										}
																										continue
																									}
																									else {
																										if ( rndeffect == 28 ) {
																											if ( efstatus <= (-1) ) {
																												if ( tc == CHARA_PLAYER ) {
																													eatstatus efstatus, tc
																												}
																												else {
																													txt -1, lang("媚薬は呪われていた。" + name(tc) + "は" + name(0) + "を軽蔑のまなざしで見つめた。", "This love potion is cursed. " + name(tc) + " look" + _s(tc) + " at " + name(0) + " with a contemptuous glance.")
																													modimp tc, -15
																												}
																												healcon tc, 13, efp * 5
																												obvious = 0
																												continue
																											}
																											cEmoIcon(tc) = 17 + 100 * 3
																											if ( potionspill | potionthrow ) {
																												if ( godcheck(0) == "dorein" ) {
																													efp *= 2
																												}
																												txt -1, lang(name(tc) + "は恋の予感がした。", name(tc) + " sense" + _s(tc) + " a sigh of love,")
																												modimp tc, efp / 15
																												dmgcon tc, CONDITION_DIM, 100
																												dmgcon tc, 13, efp
																												f = 0
																												repeat limitmin(efp / 100, 1)
																													lovemiracle tc
																												loop
																												f = 0
																												if ( tc != CHARA_PLAYER ) {
																													if ( ccthrowpotion == 0 ) {
																														if ( efp > 100 ) {
																															modkarma 0, limit(efp / 100 * (-1), -20, 0)
																														}
																													}
																												}
																												goto *effect_end
																											}
																											if ( tc == CHARA_PLAYER ) {
																												txt -1, lang(name(tc) + "は興奮した！", "You are excited!")
																											}
																											else {
																												txt -1, lang(name(tc) + "は" + name(0) + "を熱いまなざしで見つめた。", name(tc) + " give" + _s(tc) + " " + name(0) + " the eye.")
																											}
																											f = 0
																											repeat limitmin(efp / 100, 1)
																												lovemiracle tc
																											loop
																											f = 0
																											modimp tc, efp / 4
																											dmgcon tc, CONDITION_DIM, 500
																											dmgcon tc, 13, efp * 2
																											continue
																										}
																										else {
																											if ( rndeffect == 29 ) {
																												txt -1, lang(name(tc) + "の血は沸きあがるように熱くなった。", name(tc) + your(tc) + " blood burns and a new strength fills " + his(tc) + " body!")
																												skillexp2 SKILL_ATTR_SPD, tc, efstatusfix((-1) * (efp * 4), (-1) * (efp * 2), efp * 2, efp * 4)
																												if ( efstatus == 1 ) {
																													modgrowth2 tc, 18, efp / 100
																													txtef COLOR_GREEN
																													txt -1, lang("あつつ！", "It really burns!")
																												}
																												continue
																											}
																											else {
																												if ( rndeffect == 30 ) {
																													if ( efstatus <= 0 ) {
																														if ( cLevel(tc) <= 1 ) {
																															txt -1, lang("何もおきない… ", "Nothing happens...")
																															obvious = 0
																															continue
																														}
																														repeat iLevel(ci) + 1
																															if ( cLevel(tc) <= 1 ) {
																																break
																															}
																															cLevel(tc)--
																															cExp(tc) = 0
																															r1 = tc
																															gosub *label_1592
																														loop
																														txtef COLOR_PURPLE
																														txt -1, lang(name(tc) + "のレベルが下がった…", name(tc) + " lose" + _s(tc) + " a level...")
																													}
																													else {
																														cExp(tc) = cExpToNext(tc)
																														r1 = tc
																														r2 = 0
																														gosub *label_1588
																														if ( synccheck(tc, -1) ) {
																															snd SOUNDLIST_DING1
																														}
																													}
																													if ( efstatus <= (-1) ) {
																														txt -1, lang("これは呪われている！", "It's cursed!")
																														repeat 50 - 10, 10
																															if ( rnd(3) == 0 ) {
																																if ( cnt <= 17 ) {
																																	if ( sdata(cnt, tc) != 0 ) {
																																		skillexp2 cnt, tc, -1000
																																	}
																																}
																															}
																														loop
																														animeload 8, tc
																													}
																													continue
																												}
																												else {
																													if ( rndeffect == 31 ) {
																														if ( synccheck(tc, -1) ) {
																															txt -1, lang("*シュワワ*", "*quaff*")
																															ctalk tc, 1339, tc, tc
																															if ( stat == 0 ) {
																																txt -1, lang("刺激的！", "Juicy!")
																															}
																															txt -1, lang(name(tc) + "のスタミナが少し回復した。", name(tc) + " restore" + _s(tc) + " some stamina.")
																														}
																														healsp tc, efp / 4
																														sickifcursed efstatus, tc, 1
																														if ( showdamagecheck(efp / 4) ) {
																															if ( synccheck(tc, -1) ) {
																																mondmgn(mondmgcnt) = "*" + efp / 4 + "*"
																																mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
																																ccolor 110
																																if ( stat == 0 ) {
																																	mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
																																}
																																mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
																															}
																														}
																														continue
																													}
																													else {
																														if ( rndeffect == 32 ) {
																															addbuff tc, BUFF_CONTINGENCY, efp / 2, efp / 100 + 10
																															continue
																														}
																														else {
																															if ( rndeffect == 33 ) {
																																addbuff tc, 62, efp / 2, efp / 100 + 10
																																continue
																															}
																															else {
																																if ( rndeffect == 34 ) {
																																	addbuff tc, 63, efp / 2, efp / 100 + 10
																																	continue
																																}
																																else {
																																	if ( rndeffect == 35 ) {
																																		addbuff tc, BUFF_DEATH_WORD, efp / 2, 20
																																		continue
																																	}
																																	else {
																																		if ( rndeffect == 36 ) {
																																			bfcc = cc
																																			cc = tc
																																			throwsstpevent "Mewmewmew", cc, "", 0
																																			txtef COLOR_BLUE
																																			txt -1, lang("うみみゃぁ！", "Mewmewmew!")
																																			animeid = ANIMATION_HOLY
																																			animode = 0
																																			nodropbodyparts = 1
																																			gosub *anime
																																			repeat 245
																																				if ( cExist(cc) != CHAR_STATE_ALIVE ) {
																																					continue
																																				}
																																				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
																																					continue
																																				}
																																				if ( cc == cnt ) {
																																					continue
																																				}
																																				tc = cnt
																																				if ( nc_intb_100 < 25000 ) {
																																					dmghp tc, efp * 2, cc
																																				}
																																				else {
																																					dmghp tc, efp * 5, cc
																																				}
																																			loop
																																			tc = cc
																																			cc = bfcc
																																			continue
																																		}
																																		else {
																																			if ( rndeffect == 37 ) {
																																				txt cc, lang("「余分な機能は削除してしまえ」", cnvtalk("Delete."))
																																				if ( eqfaction(tc, "overwish") ) {
																																					txt -1, lang("しかし、効果はなかった。", "But it produces no effect.")
																																					continue
																																				}
																																				if ( nc_intb_100 < 25000 ) {
																																					cHP(tc) = cMHP(tc) / 2 + 1
																																				}
																																				else {
																																					cHP(tc) = cMHP(tc) / 12 + 1
																																				}
																																				continue
																																			}
																																			else {
																																				if ( rndeffect == 38 ) {
																																					animeload 10, tc
																																					snd SOUNDLIST_PRAY1
																																					locvar_calcmagiccontrol_message = ""
																																					repeat limit(4 + rnd(efp / 50 + 1), 1, 15)
																																						flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
																																						dbid = 0
																																						dbid = 54
																																						p = 400 + rndex2(limit(efp, 1, 2000000))
																																						if ( rnd(30) == 0 ) {
																																							dbid = 55
																																							p = 1
																																						}
																																						if ( rnd(80) == 0 ) {
																																							dbid = 622
																																							p = 1
																																						}
																																						if ( nc_intb_100 < 50000 ) {
																																							if ( rnd(2000) == 0 ) {
																																								dbid = 290
																																								p = 1
																																							}
																																						}
																																						nostack = 1
																																						itemcreate -1, dbid, cX(tc), cY(tc), p
																																						locvar_calcmagiccontrol_message += lang(itemname(ci) + "が降ってきた！", itemname(ci) + " fall" + _s2(iNum(ci)) + " down!")
																																						if ( cfg_animewait > 0 ) {
																																							txt -1, locvar_calcmagiccontrol_message
																																							redraw 1
																																							locvar_calcmagiccontrol_message = ""
																																						}
																																						item_stack -1, ci
																																					loop
																																					continue
																																				}
																																				else {
																																					if ( rndeffect == 39 ) {
																																						if ( nc_intb_100 < 50000 ) {
																																							txtef COLOR_YELLOW
																																							txt -1, lang("ものすごい幸運が訪れた…ような気がしたが気のせいだった。", "You feel as a stroke of good fortune passed by.")
																																							continue
																																						}
																																						gWellWish++
																																						efid = SKILL_SPELL_WISH
																																						gosub *label_3383
																																						continue
																																					}
																																					else {
																																						if ( rndeffect == 40 ) {
																																							healmp tc, efp / 2 + rnd(efp / 2 + 1)
																																							if ( synccheck(tc, -1) ) {
																																								txt -1, lang(name(tc) + "のマナが回復した。", name(tc) + your(tc) + " mana is restored.")
																																								animeid = ANIMATION_HEAL
																																								gosub *anime
																																							}
																																							continue
																																						}
																																						else {
																																							if ( rndeffect == 41 ) {
																																								txt -1, lang("瓶から何かが出てきた！", "Something comes out from the well!")
																																								repeat 1 + rnd(3)
																																									flt calcobjlv(cLevel(tc) * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
																																									characreate -1, CREATURE_ID_BUG, cX(tc), cY(tc)
																																								loop
																																								continue
																																							}
																																							else {
																																								if ( rndeffect == 42 ) {
																																									txt -1, lang("瓶から何かが大量に出てきた！", "Something many comes out from the well!")
																																									repeat 10 + rnd(3)
																																										flt calcobjlv(cLevel(tc) * 3), calcfixlv(FIX_QUALITY_GOOD)
																																										characreate -1, CREATURE_ID_BUG, cX(tc), cY(tc)
																																									loop
																																									continue
																																								}
																																								else {
																																									if ( rndeffect == 43 ) {
																																										if ( synccheck(tc, -1) ) {
																																											txt -1, lang(name(tc) + "は瓶の破片で傷ついた！", "Strange sweet liquid splashes onto " + name(tc) + "!")
																																										}
																																										dmgcon tc, CONDITION_BLEED, efp / 2
																																										continue
																																									}
																																									else {
																																										if ( rndeffect == 44 ) {
																																											if ( mType != MAP_TYPE_WORLD ) {
																																												gWeather = WEATHER_ETHER
																																												if ( gMonth  \ 3 != 0 & gLastEther != gMonth  ) {
																																													gLastEther = gMonth 
																																												}
																																												envonly = 1
																																												gosub *music_play
																																												txt -1, lang("終末の日が訪れた。", "Let's Ragnarok!")
																																												if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
																																													msg_halt
																																												}
																																												animeid = ANIMATION_RAGNA
																																												gosub *anime
																																												repeat 200
																																													repeat 2
																																														x = rnd(mWidth)
																																														y = rnd(mHeight)
																																														mapId(x, y) = xy2pic(4, 1)
																																													loop
																																													x = rnd(inf_screenw) + scx
																																													y = rnd(inf_screenh) + scy
																																													if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight | rnd(5) == 0 ) {
																																														x = rnd(mWidth)
																																														y = rnd(mHeight)
																																													}
																																													addmef x, y, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
																																													mapitem_fire x, y
																																													if ( cnt \ 4 == 0 ) {
																																														flt 100, calcfixlv(FIX_QUALITY_GREAT)
																																														if ( rnd(4) ) {
																																															fltnrace = "dragon"
																																														}
																																														else {
																																															fltnrace = "giant"
																																														}
																																														characreate -1, CREATURE_ID_BUG, x, y
																																														if ( stat != 0 ) {
																																															cbitmod CHARA_BIT_SUMMONED, rc, TRUE
																																														}
																																													}
																																													if ( cnt \ 7 == 0 ) {
																																														if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
																																															gosub *screen_draw
																																														}
																																														if ( rnd(7) ) {
																																															snd SOUNDLIST_FIRE1
																																														}
																																														else {
																																															snd SOUNDLIST_CRUSH1
																																														}
																																														if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
																																															await 25
																																														}
																																													}
																																												loop
																																											}
																																											continue
																																										}
																																										else {
																																											if ( rndeffect == 45 ) {
																																												f = 0
																																												p = 2 + rnd(3)
																																												repeat p
																																													repeat 100
																																														tid = rnd(46)
																																														traitmode = 0
																																														r1 = 0
																																														gosub *trait_ref
																																														if ( stat == 0 | traitref != 1 ) {
																																															continue
																																														}
																																														if ( rnd(2) ) {
																																															p = 1
																																														}
																																														else {
																																															p = -1
																																														}
																																														if ( gettrait(0, tid) >= traitref(2) ) {
																																															p = -1
																																														}
																																														if ( gettrait(0, tid) <= traitref(1) ) {
																																															p = 1
																																														}
																																														if ( efstatus <= (-1) ) {
																																															if ( p == 1 ) {
																																																continue
																																															}
																																														}
																																														else {
																																															if ( p == (-1) ) {
																																																if ( efstatus >= 1 ) {
																																																	if ( rnd(3) == 0 ) {
																																																		continue
																																																	}
																																																}
																																																continue
																																															}
																																														}
																																														addtrait 0, tid, p
																																														txt -1, lang("あなたは変容した！ ", "You mutate.")
																																														if ( p > 0 ) {
																																															txtef COLOR_GREEN
																																															txt -1, traitrefn(0)
																																														}
																																														else {
																																															txtef COLOR_RED
																																															txt -1, traitrefn(1)
																																														}
																																														animeload 8, 0
																																														f = 1
																																														break
																																													loop
																																												loop
																																												if ( f == 0 ) {
																																													txt -1, lang("何もおきない… ", "Nothing happens...")
																																													obvious = 0
																																												}
																																												r1 = 0
																																												continue
																																											}
																																											else {
																																												if ( rndeffect == 46 ) {
																																													efid = SKILL_SPELL_HEALING_RAIN
																																													gosub *label_3373
																																													continue
																																												}
																																												else {
																																													if ( rndeffect == 47 ) {
																																														bfcc = cc
																																														cc = tc
																																														efid = SKILL_SPELL_MAGIC_STORM
																																														gosub *label_3373
																																														tc = cc
																																														cc = bfcc
																																														continue
																																													}
																																													else {
																																														if ( rndeffect == 48 ) {
																																															bfcc = cc
																																															cc = tc
																																															efid = SKILL_SPELL_METEOR
																																															gosub *label_3373
																																															tc = cc
																																															cc = bfcc
																																															continue
																																														}
																																														else {
																																															if ( rndeffect == 49 ) {
																																																addbuff tc, BUFF_HOLY_VEIL, efp / 2, efp / 100 + 10
																																																continue
																																															}
																																															else {
																																																if ( rndeffect == 50 ) {
																																																	efid = SKILL_SPELL_FIRE_WALL
																																																	gosub *label_3373
																																																	continue
																																																}
																																															}
																																														}
																																													}
																																												}
																																											}
																																										}
																																									}
																																								}
																																							}
																																						}
																																					}
																																				}
																																			}
																																		}
																																	}
																																}
																															}
																														}
																													}
																												}
																											}
																										}
																									}
																								}
																							}
																						}
																					}
																				}
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		loop
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1151 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 0
		snd SOUNDLIST_INV
		cibk = ci
		gosub *label_2974
		if ( iQuality(ci) < FIX_QUALITY_MIRACLE | iQuality(ci) == FIX_QUALITY_UNIQUE ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			obvious = 0
			goto *effect_end
		}
		if ( iStatus(cibk) == ITEM_STATUS_BLESSED & iNum(cibk) > 0 ) {
			snd SOUNDLIST_DING2
			txt -1, lang(itemname(ci) + "は強い銀色の光に包まれた。", itemname(ci) + " " + is2(iNum(ci)) + " surrounded by a silver aura.")
			if ( iAtk(ci) < 999 ) {
				iAtk(ci)++
			}
			if ( iDmg(ci) < 999 ) {
				iDmg(ci)++
			}
			if ( iDV(ci) < 999 ) {
				iDV(ci)++
			}
			if ( iPV(ci) < 999 ) {
				iPV(ci)++
			}
			repeat iNum(cibk)
				if ( iAtk(ci) < 999 ) {
					iAtk(ci)++
				}
				if ( iDmg(ci) < 999 ) {
					iDmg(ci)++
				}
				if ( iDV(ci) < 999 ) {
					iDV(ci)++
				}
				if ( iPV(ci) < 999 ) {
					iPV(ci)++
				}
			loop
			iNum(cibk) = 0
		}
		else {
			snd SOUNDLIST_DING2
			txt -1, lang(itemname(ci) + "は銀色の光に包まれた。", itemname(ci) + " " + is2(iNum(ci)) + " surrounded by a silver aura.")
			if ( iAtk(ci) < 999 ) {
				iAtk(ci)++
			}
			if ( iDmg(ci) < 999 ) {
				iDmg(ci)++
			}
			if ( iDV(ci) < 999 ) {
				iDV(ci)++
			}
			if ( iPV(ci) < 999 ) {
				iPV(ci)++
			}
		}
		txt -1, lang(itemname(ci) + "に変化した。", itemname(ci) + " " + is2(iNum(ci)) + "changed.")
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1105 | _switch_sw ) {
		_switch_sw = 0
		if ( iID(ci) == ITEM_ID_SCROLL_GAIN_ATTRIBUTE & ibit(ITEM_BIT_PRECIOUS, ci) ) {
			if ( tc == CHARA_PLAYER ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				goto *effect_end
			}
			snd SOUNDLIST_DING2
			nc_intb_003 = 0
			repeat 26
				if ( horse_getskill(tc, cnt) > 0 & cnt != iParam1(ci) ) {
					nc_intb_003++
				}
			loop
			if ( nc_intb_003 >= 5 ) {
				txt -1, lang("あなたの馬はこれ以上新しいスキルを習得できない。", "No more new skills to learn.")
				goto *effect_end
			}
			if ( horse_getskill(tc, iParam1(ci)) >= iParam2(ci) ) {
				txt -1, lang("このスキルは既に習得している。", "This skill has already been learned.")
			}
			else {
				if ( horse_getskill(tc, iParam1(ci)) > 0 ) {
					txtef COLOR_GREEN
					txt -1, lang("" + name(tc) + "の" + nc_horskilln(iParam1(ci)) + "のレベルがアップした！", name(tc) + " gain" + _s(tc) + " a skill of " + nc_horskilln(iParam1(ci)) + "!")
					rmfaction tc, "horskill" + iParam1(ci) + "," + horse_getskill(nc_intb_002, iParam1(ci))
					addfaction tc, "horskill" + iParam1(ci) + "," + iParam2(ci)
				}
				else {
					txtef COLOR_GREEN
					txt -1, lang("" + name(tc) + "は" + nc_horskilln(iParam1(ci)) + "の技術を会得した！", name(tc) + " gain" + _s(tc) + " a skill of " + nc_horskilln(iParam1(ci)) + "!")
					addfaction tc, "horskill" + iParam1(ci) + "," + iParam2(ci)
				}
			}
			goto *effect_end
		}
		promptmax = 0
		repeat
			await
			p = rnd(400 - 100) + 100
			if ( skillUse(p) != SKILL_NONE ) {
				if ( efstatus >= 0 ) {
					if ( cnt < efstatusfix(0, 0, 100, 2000) ) {
						if ( sdata(p, tc) != 0 ) {
							continue
						}
					}
					promptl(0, promptmax) = skillname(p), "null", "" + p
					promptmax++
					if ( promptmax >= 4 ) {
						break
					}
				}
				else {
					if ( sdata(p, tc) == 0 ) {
						continue
					}
					if ( synccheck(tc, -1) ) {
						snd SOUNDLIST_CURSE1
						txt -1, lang("これは呪われている！", "It's cursed!")
					}
					skillexp2 p, tc, -1000
					break
				}
			}
		loop
		if ( efstatus >= 0 ) {
			txt -1, lang("どの技術を獲得する？", "Learn which skill?")
			val = promptx, prompty, 220, 1
			gosub *prompt_key
			if ( rtval == (-1) ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			else {
				skillgain tc, rtval, 1
				if ( synccheck(tc, -1) ) {
					snd SOUNDLIST_DING2
					txtef COLOR_GREEN
					txt -1, lang("" + name(tc) + "は" + skillname(rtval) + "の技術を獲得した！", name(tc) + " gain" + _s(tc) + " a skill of " + skillname(rtval) + "!")
				}
			}
		}
		r1 = tc
		gosub *charaRefresh
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1107 | _switch_sw ) {
		_switch_sw = 0
		if ( godcheck(tc) == "eyth" ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		if ( efstatus <= (-1) ) {
			txt -1, lang("" + godname(godcheck(tc)) + "は" + name(tc) + "の信仰に疑問を抱いた。", name(tc) + your(tc) + " god doubts " + his(tc) + " faith.")
			txtgod godcheck(), 2406
			snd SOUNDLIST_CURSE3
			animeload 14, tc
			skillexp2 SKILL_NORMAL_FAITH, tc, -1000
			goto *effect_end
		}
		txtef COLOR_GREEN
		txt -1, lang("" + name(tc) + "は" + godname(godcheck(tc)) + "の暖かい眼差しを感じた。", name(tc) + " feel" + _s(tc) + " as if " + godname(godcheck(tc)) + " is watching " + him(tc) + ".")
		txtgod godcheck(), 2404
		if ( efstatus >= 1 ) {
			txtef COLOR_GREEN
			txt -1, lang("空から三つ葉のクローバーがふってきた。", "A three-leaved falls from the sky.")
			txtgod godcheck(), 2405
		}
		animeid = ANIMATION_HOLY
		animode = 100 + tc
		gosub *anime
		snd SOUNDLIST_PRAY2
		cPray(tc) += 500
		if ( cPray(tc) > 2000 ) {
			cPray(tc) = 2000
		}
		modpiety 75, tc
		skillexp2 SKILL_NORMAL_FAITH, tc, 1000 + (efstatus >= 1) * 750, 6, 1000
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1119 | _switch_sw ) {
		_switch_sw = 0
		repeat 1 + (efstatus >= 1)
			cnt2 = cnt
			repeat
				await
				p = rnd(400 - 100) + 100
				if ( skillUse(p) != SKILL_NONE ) {
					if ( sorg(p, tc) == 0 ) {
						continue
					}
					modgrowth2 tc, p, efp * efstatusfix(-4, -2, 5, 5) / 100
					if ( cnt2 == 0 ) {
						s = lang("", "The ")
					}
					else {
						s = lang("さらに", "Furthermore, the ")
					}
					if ( efstatus >= 0 ) {
						if ( synccheck(tc, -1) ) {
							snd SOUNDLIST_DING2
							txtef COLOR_GREEN
							txt -1, lang(s + "" + name(tc) + "の" + skillname(p) + "の技術の潜在能力が上昇した。", s + "potential of " + name(tc) + your(tc) + " " + skillname(p) + " skill increases.")
						}
					}
					else {
						if ( synccheck(tc, -1) ) {
							snd SOUNDLIST_CURSE3
							txtef COLOR_RED
							txt -1, lang("" + name(tc) + "の" + skillname(p) + "の技術の潜在能力が減少した。", "The potential of " + name(tc) + your(tc) + " " + skillname(p) + " skill decreases.")
						}
					}
					break
				}
			loop
		loop
		r1 = tc
		gosub *charaRefresh
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1106 | _switch_sw ) {
		_switch_sw = 0
		i = rnd(20 - 10) + 10
		skillexp2 i, tc, efstatusfix(-2000, -2000, -1000, -250)
		animeid = ANIMATION_CURSE
		gosub *anime
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1139 | _switch_sw ) {
		_switch_sw = 0
		txt -1, lang(name(tc) + "の血は沸きあがるように熱くなった。", name(tc) + your(tc) + " blood burns and a new strength fills " + his(tc) + " body!")
		repeat iLevel(ci) + 1
			skillexp2 SKILL_ATTR_SPD, tc, efstatusfix(-4000, -1000, 8000, 12000)
			if ( efstatus == 1 ) {
				modgrowth2 tc, 18, 15
				txtef COLOR_GREEN
				txt -1, lang("あつつ！", "It really burns!")
			}
			r1 = tc
			gosub *charaRefresh
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1113 | _switch_sw ) {
		_switch_sw = 0
		procid = (procid + 1) \ 10
		proclist(procid) = "efPotential:Begin" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		if ( efstatus >= 1 ) {
			repeat 18 - 10, 10
				modgrowth2 tc, cnt, rnd(sgrowth(cnt, tc) / 20 + 3) + 1
			loop
			txt -1, lang(name(tc) + "の全ての能力の潜在能力が上昇した。", name(tc) + your(tc) + " potential of every attribute expands.")
			animeid = ANIMATION_HOLY
			animode = 100 + tc
			gosub *anime
			snd SOUNDLIST_DING3
		}
		else {
			i = rnd(18 - 10) + 10
			valn = skillname(i)
			if ( efstatus == 0 ) {
				txt -1, lang(name(tc) + "の" + valn + "の潜在能力が上昇した。", name(tc) + your(tc) + " potential of " + valn + " expands.")
				modgrowth2 tc, i, rnd(sgrowth(i, tc) / 10 + 10) + 1
				snd SOUNDLIST_DING2
			}
			else {
				txt -1, lang(name(tc) + "の" + valn + "の潜在能力が減少した。", name(tc) + your(tc) + " potential of " + valn + " decreases.")
				modgrowth2 tc, i, (rnd(sgrowth(i, tc) / 10 + 10) + 1) * (-1)
				snd SOUNDLIST_CURSE3
			}
		}
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 0 & gettrait(0, 190) == 0 & cc != CHARA_PLAYER | cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		procid = (procid + 1) \ 10
		proclist(procid) = "efPotential:End" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 653 | _switch_sw ) {
		_switch_sw = 0
		if ( tc < MAX_CHARA_SAVE ) {
			goto *effect_end
		}
		if ( cQuality(tc) >= FIX_QUALITY_MIRACLE ) {
			goto *effect_end
		}
		if ( cRole(tc) != ROLE_NONE ) {
			goto *effect_end
		}
		if ( gLevel  == areaCanSave(gArea ) ) {
			if ( ocbit(8, tc) ) {
				goto *effect_end
			}
		}
		txt -1, lang(name(tc) + "は消え去った。", name(tc) + " vanish" + _s(tc, 1) + ".")
		chara_vanquish tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 430 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 429 | _switch_sw ) {
		_switch_sw = 0
		if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		p = 1
		if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
			p = 2
		}
		repeat p
			repeat mHeight
				y = cnt
				repeat mWidth
					x = cnt
					p = dist(cX(tc), cY(tc), x, y)
					if ( efstatus <= (-1) ) {
						if ( efid == SKILL_SPELL_MAGIC_MAP ) {
							mapIdMemory(x, y) = tile_default
						}
						if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
							mapItemsMemory(x, y) = 0
							mapbitmod 0, x, y, 0
						}
						continue
					}
					if ( p < 7 | rndex(efp + 1) > rndex(p * 8 + 1) | efstatus >= 1 ) {
						if ( efid == SKILL_SPELL_MAGIC_MAP ) {
							mapIdMemory(x, y) = mapId(x, y)
						}
						if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
							if ( mapFeat(x, y) != 0 | mapItemsMemory(x, y) != 0 ) {
								mapIdMemory(x, y) = mapId(x, y)
								mapbitmod 0, x, y, 1
							}
						}
					}
				loop
			loop
		loop
		if ( efstatus <= (-1) ) {
			txt -1, lang("あれ…？あなたは軽い記憶障害を受けた。", "Hmm? You suffer minor memory defect.")
		}
		else {
			if ( efid == SKILL_SPELL_MAGIC_MAP ) {
				txt -1, lang(name(tc) + "は周囲の地形を察知した。", name(tc) + " sense" + _s(tc) + " nearby locations.")
			}
			if ( efid == SKILL_SPELL_SENSE_OBJECT ) {
				txt -1, lang(name(tc) + "は周囲の物質を感知した。", name(tc) + " sense" + _s(tc) + " nearby objects.")
			}
		}
		animeload 10, tc
		redraw 0
		gosub *label_1462
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 658 | _switch_sw ) {
		_switch_sw = 0
		attack_weakguard
		if ( cHP(tc) > cMHP(tc) / 8 ) {
			goto *effect_end
		}
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_ATKSWORD
			ctalk cc, 1295, tc, cc
			txtef COLOR_RED
			txt -1, lang(" *ブシュッ* ", "*Gash*")
			if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
				dmgType = 2
				txt3rd = 1
				txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
			}
			else {
				txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
			}
		}
		dmghp tc, cMHP(tc) + 1, cc, SKILL_SPACT_DECAPITATION
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 909 | _switch_sw ) {
		_switch_sw = 0
		attack_weakguard
		if ( tc == CHARA_PLAYER ) {
			txt -1, lang("あなたは自分の内臓を抜き取ろうと思ったがやめた…", "You try to take bodyparts from yourself.")
			goto *effect_end
		}
		if ( ocbit(7, tc) ) {
			txt -1, lang("これは幻だ。", "Phantom cannot be taken parts.")
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
			txt -1, lang("吊るしたままでは内臓を抜き取れない。", "You can't take bodyparts from a hung creature.")
			goto *effect_end
		}
		if ( cHP(tc) > cMHP(tc) / 8 ) {
			txt -1, lang("もっと弱らせないと内臓を抜き取れない。", "The target needs to be weakened.")
			goto *effect_end
		}
		txt -1, lang("どの内臓を抜き取る？", "Take out which?")
		promptl(0, promptmax) = lang("皮", "skin"), "a", "" + 337
		promptmax++
		promptl(0, promptmax) = lang("体液", "blood"), "b", "" + 338
		promptmax++
		promptl(0, promptmax) = lang("瞳", "eye"), "c", "" + 339
		promptmax++
		promptl(0, promptmax) = lang("心臓", "heart"), "d", "" + 340
		promptmax++
		promptl(0, promptmax) = lang("骨片", "bone"), "e", "" + 341
		promptmax++
		val = promptx, prompty, 140, 1
		gosub *prompt_key
		if ( rtval == (-1) ) {
			partid = rnd(5) + 337
		}
		else {
			partid = rtval
		}
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_ATKSWORD
			txtef COLOR_RED
			txt -1, lang(" *ブシュッ* ", "*Gash*")
			if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
				dmgType = 2
				txt3rd = 1
				txt -1, lang(name(cc) + "は" + name(tc) + "の" + ioriginalnameref(partid) + "を抜き取り", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + " and")
			}
			else {
				txt -1, lang(name(cc) + "は" + name(tc) + "の" + ioriginalnameref(partid) + "を抜き取った。", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + ".")
			}
		}
		nodropbodyparts = 2
		dmghp tc, cMHP(tc) + 1, cc, SKILL_SPACT_DECAPITATION
		nodropbodyparts = 0
		flt
		itemcreate -1, partid, cX(tc), cY(tc), 0
		if ( stat != 0 ) {
			remain_make ci, tc
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 440 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 439 | _switch_sw ) {
		_switch_sw = 0
		if ( efid == SKILL_SPELL_RESTORE_BODY ) {
			if ( synccheck(tc, -1) ) {
				if ( efstatus <= (-1) ) {
					snd SOUNDLIST_CURSE3
					txt -1, lang(name(tc) + "の肉体は蝕まれた。", name(tc) + your(tc) + " body is damaged.")
				}
				else {
					txt -1, lang(name(tc) + "の肉体は復活した。", name(tc) + your(tc) + " body is restored.")
					animeload 10, tc
				}
				if ( efstatus >= 1 | (efsource == 3 & rnd(5000) < efp) ) {
					txt -1, lang("さらに、" + name(tc) + "の肉体は強化された。", "In addition, " + his(tc) + " body is enchanted.")
					animeload 10, tc
				}
			}
			p = 10, 11, 12, 17, 18, -1
		}
		if ( efid == SKILL_SPELL_RESTORE_SPIRIT ) {
			if ( synccheck(tc, -1) ) {
				if ( efstatus <= (-1) ) {
					snd SOUNDLIST_CURSE3
					txt -1, lang(name(tc) + "の精神は蝕まれた。", name(tc) + your(tc) + " spirit is damaged.")
				}
				else {
					txt -1, lang(name(tc) + "の精神は復活した。", name(tc) + your(tc) + " spirit is restored.")
					animeload 10, tc
				}
				if ( efstatus >= 1 | (efsource == 3 & rnd(5000) < efp) ) {
					txt -1, lang("さらに、" + name(tc) + "の精神は強化された。", "In addition, " + his(tc) + " spirit is enchanted.")
					animeload 10, tc
				}
			}
			p = 14, 13, 16, 15, 19, -1
		}
		repeat
			if ( p(cnt) == (-1) ) {
				break
			}
			i = p(cnt) + 240 - 10
			if ( efstatus <= (-1) ) {
				if ( cQuality(tc) <= FIX_QUALITY_GREAT ) {
					cdata(i, tc) -= rnd(sorgex(p(cnt), tc)) / 5 + rnd(5)
					continue
				}
			}
			if ( cdata(i, tc) < 0 ) {
				cdata(i, tc) = 0
			}
			if ( efstatus >= 1 ) {
				cdata(i, tc) = sorgex(p(cnt), tc) / 10 + 5
			}
		loop
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 441 | _switch_sw ) {
		_switch_sw = 0
		gosub *com_wish
		screenupdate = -1
		gosub *screen_refresh
		goto *effect_end
		_switch_sw++
	}

	if ( _switch_val == 1141 | _switch_sw ) {
		_switch_sw = 0
*spUncurse_cursed
		if ( tc != CHARA_PLAYER | gArea  == 210 ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		if ( gReturn  != 0 | gTeleportArea == MAX_AREA_OLD ) {
			txt -1, lang("脱出を中止した。", "The air around you gradually loses power.")
			gReturn  = 0
		}
		else {
			gosub *label_3041
			if ( stat == 1 ) {
				txt -1, lang("依頼請負中の帰還は法律で禁止されている。それでも帰還する？", "Returning while taking a quest if forbidden. Are you sure you want to return?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval != 0 ) {
					goto *effect_end
				}
			}
			txt -1, lang("周囲の大気がざわめきだした。", "The air around you becomes charged.")
			if ( areaId(gArea ) == AREA_RANDOM_DUNGEON ) {
				if ( gLevel  == areaCanSave(gArea ) ) {
					if ( areaBoss(gArea ) != (-1) ) {
						txt -1, lang("このままダンジョンを出ると、この階のクエストは達成できない…", "The lord of the dungeon might disappear if you escape now.")
					}
				}
			}
			item_find FILTER_CARGO_TRADE, ITEM_FIND_MODE_TYPE, ITEM_FIND_LOCATION_CHARAS
			if ( stat != (-1) ) {
				txt -1, lang("このまま帰還すると、交易品は駄目になる…", "The trade article is lost if you escape now.")
			}
			gTeleportArea = gWorld, 1
			if ( efstatus <= (-1) ) {
				if ( rnd(3) == 0 ) {
					gTeleportArea = AREA_JAIL, 1
				}
				if ( ogTitleJunkie == 2 ) {
					gTeleportArea = MAX_AREA_OLD, 1
				}
			}
			gReturn  = 5 + rnd(10)
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 906 | _switch_sw ) {
		_switch_sw = 0
		goto *spUncurse_cursed
		_switch_sw++
	}
	if ( _switch_val == 428 | _switch_sw ) {
		_switch_sw = 0
		if ( cId(tc) == CREATURE_ID_STRAY_CAT & ogTitleReturningHome == 2 ) {
			obvious = 0
			if ( tc < MAX_CHARA_SAVE | cQuality(tc) >= FIX_QUALITY_MIRACLE | cRole(tc) != ROLE_NONE ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				goto *effect_end
			}
			txt tc, lang("「ありがとう！これでおうちかえれう！」", "\"Thank you! I can finally return home now!\"")
			animeload 10, tc
			txt -1, lang(name(tc) + "は次元の扉を開けた。", "A dimensional door opens in frond of " + him(tc))
			if ( efstatus <= (-1) ) {
				animeid = ANIMATION_GENE
				anic = tc
				gosub *anime
				txt -1, lang(name(tc) + "は収容所に送られた。", "The door is connected to the prison...")
			}
			else {
				txt -1, lang(name(tc) + "はおうちへ帰っていった。", name(tc) + " returned " + his(tc) + " home.")
				snd SOUNDLIST_TELEPORT1
				animeload 5, tc
			}
			chara_vanquish tc
			goto *effect_end
		}
		if ( tc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		if ( gReturn  != 0 ) {
			txt -1, lang("帰還を中止した。", "The air around you gradually loses power.")
			gReturn  = 0
		}
		else {
			gosub *com_return
			if ( efstatus <= (-1) ) {
				if ( rnd(3) == 0 ) {
					gTeleportArea = AREA_JAIL, 1
				}
				if ( ogTitleJunkie == 2 ) {
					gTeleportArea = MAX_AREA_OLD, 1
				}
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 621 | _switch_sw ) {
		_switch_sw = 0
		healmp tc, efp / 2 + rnd(efp / 2 + 1)
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "のマナが回復した。", name(tc) + your(tc) + " mana is restored.")
			animeid = ANIMATION_HEAL
			gosub *anime
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 624 | _switch_sw ) {
		_switch_sw = 0
		healmp tc, role(dice1, dice2, bonus)
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "は周囲からマナを吸い取った。", name(tc) + " absorb" + _s(tc) + " mana from the air.")
			animeid = ANIMATION_HEAL
			gosub *anime
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1108 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "は毒を浴びた！", name(tc) + " " + is(tc) + " hit by poison!")
		}
		if ( ccoler == 1 & ocLight(tc) != 0 ) {
			ocLight(tc) = 0
			txt -1, lang(name(tc) + "の輝きが消えた。", name(tc) + " " + is(tc) + " Stop shine.")
		}
		if ( cbit(CHARA_BIT_PREGNANT, tc) ) {
			cbitmod CHARA_BIT_PREGNANT, tc, FALSE
			if ( ocAlienChildCreatureID(tc) == 330 ) {
				if ( synccheck(tc, -1) ) {
					txt -1, lang(name(tc) + "の体内のエイリアンは溶けた。", name(tc) + your(tc) + " alien children melt in " + his(tc) + " stomach.")
					txtef COLOR_SKY_BLUE
					ctalk tc, 970, tc, tc
				}
			}
			else {
				if ( synccheck(tc, -1) ) {
					txt -1, lang(name(tc) + "の体内の何かは溶けた。", name(tc) + your(tc) + " something melt in " + his(tc) + " stomach.")
					txtef COLOR_SKY_BLUE
					ctalk tc, 970, tc, tc
				}
			}
			ocAlienChildCreatureID(tc) = 0
			ocItemDV(tc) = 0
		}
		dmgcon tc, CONDITION_POISON, efp
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1111 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "は墨を浴びた！", "Ink squirts into " + name(tc) + your(tc) + " face!")
		}
		dmgcon tc, CONDITION_BLIND, efp
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1109 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "はひどい頭痛におそわれた！", "A foul stench floods " + name(tc) + your(tc) + " nostrils!")
		}
		dmgcon tc, CONDITION_CONFUSE, efp
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1110 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "は痺れた！", name(tc) + " get" + _s(tc) + " numbness!")
		}
		dmgcon tc, CONDITION_PARALYZE, efp
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1112 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "は甘い液体を浴びた！", "Strange sweet liquid splashes onto " + name(tc) + "!")
		}
		dmgcon tc, CONDITION_SLEEP, efp
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 645 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}

	if ( _switch_val == 1114 | _switch_sw ) {
		_switch_sw = 0
*label_3452
		if ( efid == SKILL_SPACT_CURSE ) {
			if ( synccheck(tc, -1) ) {
				ctalk cc, 427, cc, tc
				txt -1, lang(name(cc) + "は" + name(tc) + "を指差して呪いの言葉を呟いた。", name(cc) + " point" + _s(cc) + " " + name(tc) + " and mutter" + _s(cc) + " a curse.")
				ctalk cc, 428, cc, tc
			}
		}
		p = 75 + sLUC(tc)
		if ( findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1 ) {
			if ( encfind(tc, ENCHANT_RES_CURSE) != (-1) ) {
				p += encfind(tc, ENCHANT_RES_CURSE) / 2
			}
		}
		if ( rnd(p) > efp / 2 + (efstatus <= (-1)) * 100 ) {
			goto *effect_end
		}
		if ( petcheck(tc) | tc == CHARA_PLAYER & efid == SKILL_SPACT_CURSE ) {
			if ( rnd(3) ) {
				if ( gettrait(0, 42) ) {
					txt -1, lang("あなたは祈祷を捧げ呪いのつぶやきを無効にした。", "Your prayer nullifies the curse.")
					goto *effect_end
				}
			}
			if ( rnd(2) ) {
				if ( ogTitleBornInATemple == 2 ) {
					txt 0, lang("「破ぁ！！」あなたは気合いを込めて呪いのつぶやきを吹き飛ばした。", "\"HA!!\" You yelled and nullified the curse by fight.")
					goto *effect_end
				}
			}
		}
		i = 0
		repeat 30, 100
			if ( cdata(cnt, tc) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			p(i) = cdata(cnt, tc) \ EXT_EQUIP_SLOTS - 1
			if ( iStatus(p(i)) == ITEM_STATUS_BLESSED ) {
				if ( rnd(10) ) {
					continue
				}
			}
			i++
		loop
		if ( i == 0 ) {
			inv_getheader tc
			repeat 200
				p = invhead + rnd(invrange)
				if ( iNum(p) == 0 ) {
					continue
				}
				if ( iStatus(p) == ITEM_STATUS_BLESSED ) {
					if ( rnd(10) ) {
						continue
					}
				}
				i = 1
				break
			loop
		}
		if ( i > 0 ) {
			i = p(rnd(i))
			if ( ibit(18, i) ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				obvious = 0
				goto *effect_end
			}
		}
		if ( i > 0 ) {
			valn = itemname(i, 1, 1)
			if ( iStatus(i) == ITEM_STATUS_CURSED ) {
				iStatus(i) = ITEM_STATUS_DOOMED
			}
			else {
				iStatus(i) = ITEM_STATUS_CURSED
			}
			if ( synccheck(tc, -1) ) {
				txt -1, lang(name(tc) + "の" + valn + "は黒く輝いた。", name(tc) + your(tc) + " " + valn + " glows black.")
			}
			r1 = tc
			gosub *charaRefresh
			snd SOUNDLIST_CURSE3
			animeload 14, tc
			item_stack tc, i, 1
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1118 | _switch_sw ) {
		_switch_sw = 0
		f = 0
		repeat 10
			p = rnd(61 - 50) + 50
			if ( sorg(p, tc) >= 150 ) {
				f++
				resistmod tc, p, 50 * (-1)
				if ( f >= efp / 100 ) {
					break
				}
			}
		loop
		if ( f == 0 ) {
			txt -1, lang("何も起こらなかったようだ。", "Nothing happens.")
			obvious = 0
		}
		else {
			snd SOUNDLIST_CURSE1
		}
		r1 = tc
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1138 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 1123 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 1122 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 1137 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER & petcheck(cc) ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		flt cLevel(CHARA_PLAYER) / 2 + 5, FIX_QUALITY_GREAT
		p = 0
		if ( rnd(3) == 0 ) {
			fltn "man"
		}
		if ( efid == SKILL_EFFECT_GAIN_CAT_SISTER ) {
			txt -1, lang("なんと、あなたには生き別れた血の繋がっていないぬこの妹がいた！", "How...! You suddenly get a younger cat sister!")
			p = 210
		}
		if ( efid == SKILL_EFFECT_GAIN_SISTER ) {
			if ( efstatus >= 1 ) {
				repeat 10000
					imocolor = rnd(19) + 1
					if ( lightdata(LIGHTDATA_Y, imocolor) < 24 ) {
						imocolor *= -1
						break
					}
				loop
				txt -1, lang("なんと、あなたには生き別れた血の繋がっていない光る妹がいた！", "How...! You suddenly get a shining younger sister!")
			}
			else {
				if ( efstatus <= (-1) ) {
					imocolor = rnd(18) + 2
					if ( imocolor == 12 ) {
						txt -1, lang("なんと、あなたには生き別れた血の繋がっていない透明な妹がいた！", "How...! You suddenly get a invisible younger sister!")
					}
					else {
						txt -1, lang("なんと、あなたには生き別れた血の繋がっていない変な色の妹がいた！", "How...! You suddenly get a strange colored younger sister!")
					}
				}
				else {
					txt -1, lang("なんと、あなたには生き別れた血の繋がっていない妹がいた！", "How...! You suddenly get a younger sister!")
				}
			}
			p = 176
			ogTimesReadYoungerSistersDiary++
			gosub *label_2665
		}
		if ( efid == SKILL_EFFECT_GAIN_GIRL ) {
			txt -1, lang("お嬢さんが空から降ってきた！", "A young lady falls from the sky.")
			p = 211
		}
		novoidlv = 1
		clnum = -1
		nomagicdevice = 1
		noenchant = 1
		noencpfix = 1
		nc_skipflag = 1
		characreate MAX_CHARA_NC, p, -3, 0
		clnum = 0
		if ( imocolor != 0 ) {
			if ( imocolor > 0 ) {
				if ( imocolor == 12 ) {
					ocbitmod 1, 56, 1
				}
				else {
					cPic(MAX_CHARA_NC) += imocolor * 1000
				}
			}
			else {
				ocLight(56) = -imocolor
			}
			imocolor = 0
		}
		rc = MAX_CHARA_NC
		gosub *cm_race_loop_WHILE1
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 435 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER | tc == CHARA_PLAYER | tc < MAX_CHARA_FOLLOWER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		if ( gArea  == AREA_ARENA | gArea  == AREA_PET_ARENA | gArea  == 49 | gArea  == 210 | oabit(17, gArea ) | oabit(18, gArea ) ) {
			obvious = 0
			txt -1, lang("この場所では効果がない。", "The effect doesn't work in this area.")
			goto *effect_end
		}
		f = 1
		inv_find ITEM_ID_MONSTER_HEART, cc
		if ( stat != (-1) ) {
			lint_efp = efp * 3 / 2
			efp = limitmax(lint_efp, 2147483647)
		}
		if ( rndex2(efp / 15 + 5) < cLevel(tc) ) {
			f = 0
		}
		if ( findfaction(tc, "family", "wild") & trophycheck(TROPHY_GAMBLING) == 2 ) {
			f = 1
		}
		if ( cQuality(tc) >= FIX_QUALITY_MIRACLE | cRole(tc) != ROLE_NONE | cbit(CHARA_BIT_PRECIOUS, tc) == TRUE ) {
			f = -1
		}
		if ( gWizard == 1 ) {
			f = 1
		}
		if ( eqfaction(tc, "nc_sheep") ) {
			f = -1
		}
		if ( f == 1 ) {
			rc = tc
			gosub *cm_race_loop_WHILE1
			check_quest
		}
		else {
			if ( f == 0 ) {
				txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			}
			else {
				txt -1, lang(name(tc) + "は支配できない。", name(tc) + " cannot be charmed.")
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 436 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 437 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 455 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 634 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 456 | _switch_sw ) {
		_switch_sw = 0
		if ( efid == SKILL_SPELL_WEB ) {
			p = 3, 2 + rnd(efp / 50 + 1)
			txt -1, lang("蜘蛛の巣が辺りを覆った。", "The ground is covered with thick webbing.")
		}
		if ( efid == SKILL_SPELL_MIST_OF_DARKNESS ) {
			txt -1, lang("辺りを濃い霧が覆った。", "The air is wrapped in a dense fog.")
			p = 3, 2 + rnd(efp / 50 + 1)
		}
		if ( efid == SKILL_SPELL_ACID_GROUND ) {
			txt -1, lang("酸の水溜りが発生した。", "Acid puddles are generated.")
			p = 2, 2 + rnd(efp / 50 + 1)
		}
		if ( efid == SKILL_SPELL_FIRE_WALL ) {
			txt -1, lang("火柱が発生した。", "Walls of fire come out from the ground.")
			p = 2, 2 + rnd(efp / 50 + 1)
		}
		if ( efid == SKILL_SPACT_ETHER_GROUND ) {
			txt -1, lang("エーテルの霧が発生した。", "Ether mist spreads.")
			p = 2, 1 + rnd(efp / 100 + 2)
		}
		snd SOUNDLIST_WEB
		x = tlocx
		y = tlocy
		gosub *label_4683
		repeat p(1)
			x = rnd(p) + tlocx - rnd(p)
			y = rnd(p) + tlocy - rnd(p)
			gosub *label_4683
			if ( stat == (-1) ) {
				continue cnt
			}
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1145 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 0
		snd SOUNDLIST_INV
		gosub *label_2974
		if ( iQuality(ci) < FIX_QUALITY_MIRACLE | iQuality(ci) == FIX_QUALITY_UNIQUE ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			obvious = 0
			goto *effect_end
		}
		txt -1, lang("アーティファクトの新しい銘は？", "What do you want to name this artifact?")
		val = 3
		nc_intb_001 = 1
		namedscroll = efstatus
		gosub *com_aka
		if ( stat == 0 ) {
			obvious = 0
			randomize
			goto *effect_end
		}
		p = stat
		iSubName(ci) = list(1, p) + 40000
		randomize
		txt -1, lang("それは" + listn(0, p) + "という銘になった。", "It's now called " + listn(0, p) + ".")
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 49 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 7
		snd SOUNDLIST_INV
		gosub *label_2974
		f = stat
		if ( stat == 0 ) {
			goto *effect_end
		}
		if ( iQuality(ci) >= FIX_QUALITY_MIRACLE | ibit(ITEM_BIT_ALIVE, ci) == TRUE ) {
			txt -1, lang("そのアイテムに改良の余地はない。", "This item leaves no room for improvement.")
			fixmaterial = ITEM_MATERIAL_SAND
			objfix = 0
			goto *effect_end
		}
		randomize iParam1(efcibk)
		equip = iEquip(ci)
		animeload 8, cc
		fixmaterial = iMaterial(ci)
		iQuality(ci) = FIX_QUALITY_MIRACLE
		gosub *remake_material
		randomize iParam1(efcibk)
		iSubName(ci) = iSubName(efcibk)
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, efcibk) ) {
				encadd ci, inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, efcibk), inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, efcibk)
			}
		loop
		randomize
		txt -1, lang("それは" + itemname(ci, 1) + "になった。", "It becomes " + itemname(ci, 1) + ".")
		if ( equip != 0 ) {
			cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
			iEquip(ci) = equip
		}
		r1 = cc
		gosub *charaRefresh
		fixmaterial = ITEM_MATERIAL_SAND
		objfix = 0
		ci = efcibk
		iNum(ci)--
		cell_refresh iX(ci), iY(ci)
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 50 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		efstatus = iStatus(ci)
		ruce = iNum(ci)
		nc_intb_001 = iParam1(ci)
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 0
		snd SOUNDLIST_INV
		gosub *label_2974
		f = stat
		if ( stat == 0 ) {
			goto *effect_end
		}
		if ( iQuality(ci) <= FIX_QUALITY_GREAT | iQuality(ci) == FIX_QUALITY_UNIQUE | ibit(ITEM_BIT_ALIVE, ci) == TRUE ) {
			txt -1, lang("そのアイテムに使用することは出来ない。", "This item leaves no room for improvement.")
			fixmaterial = ITEM_MATERIAL_SAND
			objfix = 0
			goto *effect_end
		}
		if ( nc_intb_001 == 0 ) {
			txt -1, lang("強化するエンチャントを選ぶ必要がある。", "You need to choose an enchantment to strengthen.")
			reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
			listmax = 0
			repeat 15
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
					break
				}
				list(0, listmax) = rtval, rtval(1)
				val = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci), inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci), 0, reftype
				getencproc encprocref2, ci, val
				gosub *item_encdetail
				if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) >= limitmax((ogSmithingTargetEnchantment + 1) * 1000, 2000000000) ) {
					s += lang("(上限)", "(limit)")
				}
				promptl(0, promptmax) = s, "null", "" + promptmax
				promptmax++
				listmax++
			loop
			if ( listmax > 0 ) {
				val = promptx, prompty, 600, 1
				gosub *prompt_key
				if ( rtval == (-1) ) {
					txtnew
					txt -1, lang("何も起きない…", "Use Stop.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *charaRefresh
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					if ( inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) >= 90000 & inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) <= 90005 ) {
						txtnew
						txt -1, lang("特殊弾には使用できない。", "Cannot be used for ammo enchant.")
						randomize
						exrand_randomize timeGetTime()
						r1 = cc
						gosub *charaRefresh
						gosub *screen_draw
						goto *pc_turn
					}
					else {
						if ( inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) >= 45 & inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) <= 47 | inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) == 21 ) {
							txtnew
							txt -1, lang("能力変化系以外のマイナスエンチャントには使用できない。", "Cannot be used for bad enchant.")
							randomize
							exrand_randomize timeGetTime()
							r1 = cc
							gosub *charaRefresh
							gosub *screen_draw
							goto *pc_turn
						}
						else {
							if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) >= limitmax((ogSmithingTargetEnchantment + 1) * 1000, 2000000000) ) {
								txtnew
								txt -1, lang("そのエンチャントは既に上限を突破している。", "Cannot be used for limit enchant.")
								randomize
								exrand_randomize timeGetTime()
								r1 = cc
								gosub *charaRefresh
								gosub *screen_draw
								goto *pc_turn
							}
						}
					}
				}
			}
			equip = iEquip(ci)
			rucemax = (limitmax((ogSmithingTargetEnchantment + 1) * 1000, 2000000000) - inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci)) / 50
			if ( rucemax < ruce ) {
				ruce = rucemax
			}
			if ( ruce < 1 ) {
				ruce = 1
			}
			in = 1
			crtval = 0
			if ( ruce > 1 ) {
				crtval = rtval
				txt -1, lang("いくつ使用する？ (1〜" + ruce + ") ", "How many? (1 to " + ruce + ")")
				display_msg screenmsgy, 2
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, ruce
				inputlog = "" + 1
				gosub *prompt_word
				in = int(inputlog)
				if ( in > ruce ) {
					in = ruce
				}
				if ( in <= 0 ) {
					in = 1
				}
				rtval = crtval
			}
			animeload 8, cc
			inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) += 50 * in
			if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) >= limitmax((ogSmithingTargetEnchantment + 1) * 1000, 2000000000) ) {
				inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) = limitmax((ogSmithingTargetEnchantment + 1) * 1000, 2000000000)
			}
			txtef COLOR_GREEN
			txt -1, lang("選択した" + itemname(ci, 1) + "のエンチャントは強化された。", "It becomes " + itemname(ci, 1) + ".")
			if ( equip != 0 ) {
				cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
				iEquip(ci) = equip
			}
			r1 = cc
			gosub *charaRefresh
			fixmaterial = ITEM_MATERIAL_SAND
			objfix = 0
			ci = efcibk
			iNum(ci) -= in
			cell_refresh iX(ci), iY(ci)
			autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
			if ( cfg_noautosave > 2 & gettrait(0, 189) == 0 ) {
				autosave = 0
			}
			goto *effect_end
		}
		if ( efstatus >= 0 ) {
			txt -1, lang("強化するエンチャントを選ぶ必要がある。", "You need to choose an enchantment to strengthen.")
			reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
			listmax = 0
			repeat 15
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
					break
				}
				list(0, listmax) = rtval, rtval(1)
				val = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci), inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci), 0, reftype
				getencproc encprocref2, ci, val
				gosub *item_encdetail
				if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) >= limitmax(ncgHammerMaxLevel * 200, 2000000000) ) {
					s += lang("(上限)", "(limit)")
				}
				promptl(0, promptmax) = s, "null", "" + promptmax
				promptmax++
				listmax++
			loop
			if ( listmax > 0 ) {
				val = promptx, prompty, 600, 1
				gosub *prompt_key
				if ( rtval == (-1) ) {
					txtnew
					txt -1, lang("何も起きない…", "Use Stop.")
					randomize
					exrand_randomize timeGetTime()
					r1 = cc
					gosub *charaRefresh
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					if ( inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) >= 90000 & inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) <= 90005 ) {
						txtnew
						txt -1, lang("特殊弾には使用できない。", "Cannot be used for ammo enchant.")
						randomize
						exrand_randomize timeGetTime()
						r1 = cc
						gosub *charaRefresh
						gosub *screen_draw
						goto *pc_turn
					}
					else {
						if ( inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) >= 45 & inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) <= 47 | inv(STARTING_INV_ITEM_ENCHANT + rtval * 2, ci) == 21 ) {
							txtnew
							txt -1, lang("能力変化系以外のマイナスエンチャントには使用できない。", "Cannot be used for bad enchant.")
							randomize
							exrand_randomize timeGetTime()
							r1 = cc
							gosub *charaRefresh
							gosub *screen_draw
							goto *pc_turn
						}
						else {
							if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) >= limitmax(ncgHammerMaxLevel * 200, 2000000000) ) {
								txtnew
								txt -1, lang("そのエンチャントは既に上限を突破している。", "Cannot be used for limit enchant.")
								randomize
								exrand_randomize timeGetTime()
								r1 = cc
								gosub *charaRefresh
								gosub *screen_draw
								goto *pc_turn
							}
						}
					}
				}
			}
		}
		else {
			animeload 8, cc
			repeat 15
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 & cnt > 0 ) {
					inv(STARTING_INV_ITEM_ENCHANT + (cnt - 1) * 2, ci) = 0
					break
				}
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
					break
				}
				if ( cnt == 14 ) {
					inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) = 0
					break
				}
			loop
			txt -1, lang(itemname(ci) + "のエンチャントを一つ消去した。", itemname(ci) + " removes an enchantment.")
			ci = efcibk
			iNum(ci) -= 1
			gosub *charaRefresh
			gosub *screen_draw
			goto *pc_turn
		}
		equip = iEquip(ci)
		rucemax = (limitmax(ncgHammerMaxLevel * 200, 2000000000) - inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci)) / ((ogSmithingTargetEnchantment + 1) * 500) + 1
		if ( rucemax < ruce ) {
			ruce = rucemax
		}
		if ( ruce < 1 ) {
			ruce = 1
		}
		in = 1
		crtval = 0
		if ( efstatus == 0 ) {
			crtval = rtval
			txt -1, lang("いくつ使用する？ (1〜" + ruce + ") ", "How many? (1 to " + ruce + ")")
			display_msg screenmsgy, 2
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, ruce
			inputlog = "" + 1
			gosub *prompt_word
			in = int(inputlog)
			if ( in > ruce ) {
				in = ruce
			}
			if ( in <= 0 ) {
				in = 1
			}
			rtval = crtval
		}
		animeload 8, cc
		inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) += (ogSmithingTargetEnchantment + 1) * 500 * in
		if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) >= limitmax(ncgHammerMaxLevel * 200, 2000000000) ) {
			inv(STARTING_INV_ITEM_ENCHANT_POWER + rtval * 2, ci) = limitmax(ncgHammerMaxLevel * 200, 2000000000)
		}
		txtef COLOR_GREEN
		txt -1, lang("選択した" + itemname(ci, 1) + "のエンチャントは強化された。", "It becomes " + itemname(ci, 1) + ".")
		if ( efstatus == 1 ) {
			repeat
				randomize 50500 + cnt
				dim ginga, 15
				ginga = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
				gingamax = 0
				cibk2 = ci
				ci = 5480
				dbid = iID(p)
				dbmode = DBMODE_SET
				gosub *db_item
				iNum(ci) = 0
				ci = cibk2
				repeat 10
					locvar_getinheritance_p = rnd(15)
					if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, p) == 0 ) {
						continue
					}
					locvar_getinheritance_f = 0
					repeat gingamax + 1
						if ( locvar_getinheritance_p == ginga(cnt) ) {
							locvar_getinheritance_f = 1
							break
						}
					loop
					if ( locvar_getinheritance_f == 0 ) {
						i = iMaterial(p)
						repeat 8
							if ( mtenc(cnt * 2, i) == 0 ) {
								break
							}
							mtencid = mtenc(cnt * 2, i)
							if ( mtencid == 0 ) {
								break
							}
							if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, p) == mtencid ) {
								if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, p) - mtenc(cnt * 2 + 1, i) <= 0 ) {
									locvar_getinheritance_f = 1
									break
								}
							}
						loop
					}
					if ( locvar_getinheritance_f == 0 ) {
						repeat length(fixeditemenc)
							if ( fixeditemenc(cnt * 2) == 0 ) {
								break
							}
							if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, p) != fixeditemenc(cnt * 2) ) {
								continue
							}
							if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, p) - fixeditemenc(cnt * 2 + 1) <= 0 ) {
								locvar_getinheritance_f = 1
								break
							}
						loop
					}
					if ( locvar_getinheritance_f == 1 ) {
						continue
					}
					if ( rnd(4) > gingamax | inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, p) < 0 ) {
						ginga(gingamax) = locvar_getinheritance_p
						gingamax++
					}
				loop
				randomize
				kf = 0
				repeat gingamax
					if ( rtval == ginga(cnt) ) {
						kf = 1
					}
					if ( rtval != ginga(cnt) & ginga(cnt) != (-1) ) {
						kf = 0
						break
					}
				loop
				if ( kf == 1 ) {
					i = 10500 + cnt
					iSubName(ci) = i + 40000
					txt -1, lang("それは" + itemname(ci, 1) + "という銘になった。", "It's now called " + itemname(ci, 1) + ".")
					break
				}
			loop
		}
		if ( equip != 0 ) {
			cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
			iEquip(ci) = equip
		}
		r1 = cc
		gosub *charaRefresh
		fixmaterial = ITEM_MATERIAL_SAND
		objfix = 0
		ci = efcibk
		iNum(ci) -= in
		cell_refresh iX(ci), iY(ci)
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 21 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}

	if ( _switch_val == 1127 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		nc_intb_099 = iID(efcibk)
		nc_intb_098 = iStatus(efcibk)
		if ( iKnown(efcibk) < ITEM_KNOWN_FULL ) {
			nc_intb_098 = -3
		}
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 0
		snd SOUNDLIST_INV
		gosub *label_2974
		f = stat
		if ( iQuality(ci) == FIX_QUALITY_GODLY | ibit(ITEM_BIT_ALIVE, ci) == TRUE ) {
			if ( efid == SKILL_EFFECT_CHANGE_MATERIAL ) {
				f = 0
			}
		}
		equip = iEquip(ci)
		if ( f == 1 ) {
			if ( iQuality(ci) == FIX_QUALITY_UNIQUE ) {
				if ( efp < 350 ) {
					txt -1, lang("アーティファクトの再生成にはパワーが足りない。", "More magic power is needed to reconstruct an artifact.")
					goto *effect_end
				}
				animeload 8, cc
				txt -1, lang(name(cc) + "の" + itemname(ci, 1) + "は再生成された。", name(cc) + your(cc) + " " + itemname(ci, 1, 1) + " is reconstructed.")
				iNum(ci)--
				cell_refresh iX(ci), iY(ci)
				flt
				if ( iID(ci) == ITEM_ID_CARNEADES_PLANK ) {
					inititemid = iCItemIdx(ci) + 1
				}
				itemcreate CHARA_PLAYER, iID(ci), -1, -1, 0
			}
			else {
*act_movePC
				animeload 8, cc
				if ( efp <= 70 ) {
					if ( rnd(3) == 0 ) {
						fixmaterial = ITEM_MATERIAL_RAW
					}
				}
				s = itemname(ci, 1, 1)
				nc_intb_101 = iPV(ci)
				nc_intb_102 = iDV(ci)
				nc_intb_103 = iDmg(ci)
				nc_intb_104 = iAtk(ci)
				nc_intb_105 = iDice1(ci)
				nc_intb_106 = iDice2(ci)
				nc_intb_107 = iMaterial(ci)
				nc_intb_108 = iValue(ci)
				objlv = 0
				objfix = efp / 100
				randomize
				gosub *remake_material
				txt -1, lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
				transformsstat
				if ( iID(efcibk) == ITEM_ID_MATERIAL_KIT | iID(efcibk) == ITEM_ID_CARNEADES_PLANK ) {
					promptl(0, 0) = lang("確認", "OK"), "y", "0"
					promptmax = 1
					valhinan = val
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					r1 = cc
					gosub *charaRefresh
					fixmaterial = ITEM_MATERIAL_SAND
					objfix = 0
					goto *effect_end
				}
				txtnew
				txt -1, lang("もう一度変化させる？", "Try again?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				valhinan = val
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval == 0 ) {
					nc_intb_100 = -1
					inv_getheader 0
					repeat invrange, invhead
						if ( iNum(cnt) == 0 ) {
							continue
						}
						if ( nc_intb_099 == iID(cnt) & nc_intb_098 == (-3) & iKnown(cnt) < ITEM_KNOWN_FULL ) {
							nc_intb_100 = cnt
							break
						}
						if ( nc_intb_099 == iID(cnt) & nc_intb_098 == iStatus(cnt) ) {
							nc_intb_100 = cnt
							break
						}
					loop
					if ( nc_intb_100 > (-1) ) {
						iNum(nc_intb_100)--
						goto *act_movePC
					}
					else {
						txt -1, lang("素材変化に必要な同種のアイテムがもうない。", "There are no more items of the same kind needed for material change.")
					}
				}
			}
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		if ( equip != 0 ) {
			cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
			iEquip(ci) = equip
		}
		r1 = cc
		gosub *charaRefresh
		fixmaterial = ITEM_MATERIAL_SAND
		objfix = 0
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1128 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		snd SOUNDLIST_DING2
		p = rnd(efp + 1) / 100 + 1
		gHeirDeed += p
		txtef COLOR_YELLOW
		txt -1, lang("あなたは遺産相続人として認められた(+" + p + ")", "You claim the right of succession. (+" + p + ")")
		txt -1, lang("今やあなたは" + gHeirDeed + "個の遺産を相続できる。", "You can now inherit " + gHeirDeed + " items.")
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1124 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 1125 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		invsubroutine = 1
		if ( efid == SKILL_EFFECT_ENCHANT_WEAPON ) {
			invctrl = INVCTRL_MATERIAL_ENCHANT, 1
		}
		else {
			invctrl = INVCTRL_MATERIAL_ENCHANT, 2
		}
		snd SOUNDLIST_INV
		gosub *label_2974
		if ( stat == 1 ) {
			if ( iLevel(ci) < efp / 100 ) {
				snd SOUNDLIST_DING2
				txt -1, lang(itemname(ci) + "は黄金の光に包まれた。", itemname(ci) + " " + is2(iNum(ci)) + " surrounded by a golden aura.")
				iLevel(ci)++
				repeat 15
					if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
						c = cnt
						break
					}
				loop
				if ( c < efp / 200 & ibit(ITEM_BIT_ALIVE, ci) == FALSE ) {
					txt -1, lang("更に、" + itemname(ci) + "に新たな力を付与することが出来る。", itemname(ci) + " deems your heroic deeds worthy enough and further unleases its hidden power!")
					txt -1, lang("それは…", "It...")
					randomize
					reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
					listmax = 0
					repeat 50
						if ( listmax >= 8 ) {
							break
						}
						encadd ci, randomenc(randomenclv(4)), randomencp(0, ogTitleTubalCain == 2), 0, 0, 1
						if ( stat != 0 ) {
							if ( ogTitleTubalCain != 2 ) {
								if ( rtval == 52 ) {
									continue
								}
								if ( rtval == 53 ) {
									continue
								}
							}
							if ( rtval == 34 ) {
								if ( rnd(3) ) {
									continue
								}
							}
							findenc = 0
							repeat listmax
								if ( list(0, cnt) == rtval ) {
									if ( encpassivecheck(rtval) | list(1, cnt) == rtval(1) ) {
										findenc = 1
										break
									}
								}
							loop
							if ( findenc ) {
								continue
							}
							if ( ogTitleTubalCain != 2 ) {
								if ( encfindspec(ci, rtval) != (-1) ) {
									continue
								}
							}
							list(0, listmax) = rtval, rtval(1)
							val = list(0, listmax), list(1, listmax), 0, 0
							gosub *item_encdetail
							promptl(0, promptmax) = s, "null", "" + promptmax
							promptmax++
							listmax++
						}
						else {
							continue
						}
					loop
					if ( listmax > 0 ) {
						val = promptx, prompty, 500, 1
						gosub *prompt_key
						if ( rtval == (-1) ) {
							randomize
							exrand_randomize timeGetTime()
							r1 = cc
							txtnew
							txt -1, lang("選択しなかった。", "No Select.")
							gosub *charaRefresh
							gosub *screen_draw
							goto *pc_turn
						}
						else {
							txtnew
							txtef COLOR_GREEN
							txt -1, lang(itemname(ci) + "にエンチャントを付与した。", itemname(ci) + " vibrates as if she is pleased.")
							encadd ci, list(0, rtval), list(1, rtval), 0, 1
						}
					}
				}
			}
			else {
				txt -1, lang(itemname(ci) + "は抵抗した。", itemname(ci) + " resist" + _s2(iNum(ci)) + ".")
			}
			r1 = cc
			gosub *charaRefresh
		}
		else {
			obvious = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 630 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 1129 | _switch_sw ) {
		_switch_sw = 0
		if ( efid != SKILL_SPACT_FILL_CHARGE ) {
			if ( cc != CHARA_PLAYER ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				obvious = 0
				goto *effect_end
			}
		}
		else {
			if ( cc == CHARA_PLAYER ) {
				if ( gAbsorbCharge < 10 ) {
					txt -1, lang("充填するには最低でも魔力の貯蓄が10必要だ。", "You need at least 10 recharge powers to recharge items.")
					goto *effect_end
				}
			}
		}
		f = 0
		if ( cc == CHARA_PLAYER ) {
			invsubroutine = 1
			invctrl = INVCTRL_MATERIAL_ENCHANT, 3
			snd SOUNDLIST_INV
			gosub *label_2974
			f = stat
		}
		else {
			inv_getheader cc
			listmax = 0
			repeat invrange, invhead
				if ( iNum(cnt) == 0 ) {
					continue
				}
				reftype = refitem(iID(cnt), DBSPEC_TYPE, cnt)
				if ( reftype != FILTER_ITEM_SPELLBOOK & reftype != FILTER_ITEM_ROD ) {
					continue
				}
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt) > 1 ) {
					continue
				}
				list(0, listmax) = cnt
				listmax++
			loop
			if ( listmax ) {
				ci = list(0, rnd(listmax))
				f = 1
			}
		}
		if ( f == 1 ) {
			dbid = iID(ci)
			cibkref = ci
			dbmode = DBMODE_REF
			gosub *db_item
			orgichargelevel = ichargelevel
			if ( ichargelevel < 1 | (iID(ci) == ITEM_ID_ROD_WISHING & ogTitleBeyondWish != 2) | iID(ci) == ITEM_ID_ROD_DOMINATION | iID(ci) == ITEM_ID_SPELLBOOK_WISHING | iID(ci) == ITEM_ID_SPELLBOOK_HARVEST | (iID(ci) == ITEM_ID_ANCIENT_BOOK & iParam2(ci) != 0) | (iQuality(ci) == FIX_QUALITY_UNIQUE & iID(ci) != ITEM_ID_SPELLBOOK_OF_ALL) ) {
				txt -1, lang("それは充填ができないようだ。", "You can't recharge this item.")
				item_autostack cc, ci
				goto *effect_end
			}
			if ( reftype == FILTER_ITEM_SPELLBOOK ) {
				if ( iID(ci) != ITEM_ID_SPELLBOOK_MAGIC_LASER & iID(ci) != ITEM_ID_SPELLBOOK_MUTATION & iID(ci) != ITEM_ID_SPELLBOOK_MAGIC_BALL & iID(ci) != ITEM_ID_SPELLBOOK_DOMINATION & iID(ci) != ITEM_ID_SPELLBOOK_WISHING & iID(ci) != ITEM_ID_SPELLBOOK_CURE_JURE ) {
					ichargelevel *= 2
				}
			}
			if ( reftype == FILTER_ITEM_ROD & iLevel(ci) > 0 ) {
				ichargelevel += ichargelevel / 2 * iLevel(ci) + 1
			}
			f = 1
			if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) > ichargelevel ) {
				f = -1
			}
			if ( iID(ci) == ITEM_ID_ROD_WISHING & inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) < iLevel(ci) ) {
				f = 1
			}
			if ( f == (-1) ) {
				txt -1, lang(itemname(ci) + "はこれ以上充填できないようだ。", itemname(ci) + " cannot be recharged anymore.")
				item_autostack cc, ci
				goto *effect_end
			}
			if ( cc == CHARA_PLAYER ) {
				if ( efid == SKILL_SPACT_FILL_CHARGE ) {
					gAbsorbCharge -= 10
					txt -1, lang("魔力の貯蓄を10消費した(残り" + gAbsorbCharge + ")", "You spend 10 recharge powers. (Total:" + gAbsorbCharge + ")")
				}
			}
			else {
				txt -1, lang(name(cc) + "は" + itemname(ci) + "にマナを込めた。", name(cc) + " spend quarter my mana.")
				dmgmp cc, cMMP(cc) / 4
			}
			if ( rnd(efp / 25 + 1) == 0 ) {
				f = 0
			}
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_SPELLBOOK ) {
				if ( rnd(4) == 0 ) {
					f = 0
				}
			}
			if ( rnd(ichargelevel * ichargelevel + 1) == 0 ) {
				f = 0
			}
			if ( f == 1 ) {
				p = 1 + rnd(orgichargelevel / 2 + 1) + iLevel(ci) / 5
				if ( p + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) > ichargelevel ) {
					p = ichargelevel - inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) + 1
				}
				if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_SPELLBOOK ) {
					p = 1
				}
				if ( iID(ci) == ITEM_ID_ROD_WISHING ) {
					p = limit(sMagicDevice(cc) / 1000, 1, iLevel(ci) - inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci))
				}
				txt -1, lang(itemname(ci) + "は充填された(+" + p + ")", itemname(ci) + " " + is2(iNum(ci)) + " recharged by +" + p + ".")
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) += p
				item_autostack cc, ci
				animeload 8, cc
			}
			else {
				if ( nc_gettrait(cc, 114) == 0 ) {
					if ( rnd(4) + iLevel(ci) == 0 & iID(ci) != ITEM_ID_SPELLBOOK_OF_ALL & iID(ci) != ITEM_ID_ROD_WISHING ) {
						txt -1, lang(itemname(ci) + "は破裂した。", itemname(ci) + " explode" + _s2(iNum(ci)) + ".")
						iNum(ci)--
						gosub *label_1681
						goto *effect_end
					}
				}
				txt -1, lang(itemname(ci) + "への充填は失敗した。", "You fail to recharge " + itemname(ci) + ".")
			}
		}
		else {
			obvious = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 629 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 5
		snd SOUNDLIST_INV
		gosub *label_2974
		if ( stat == 1 ) {
			dbid = iID(ci)
			cibkref = ci
			dbmode = DBMODE_REF
			gosub *db_item
			repeat 1
				if ( ichargelevel == 1 ) {
					p = 100
					break
				}
				if ( ichargelevel == 2 ) {
					p = 25
					break
				}
				if ( ichargelevel <= 4 ) {
					p = 5
					break
				}
				if ( ichargelevel <= 6 ) {
					p = 3
					break
				}
				p = 1
			loop
			animeload 8, cc
			p = p * inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)
			gAbsorbCharge += p
			txt -1, lang(itemname(ci) + "を破壊して" + p + "の魔力を抽出した(計" + gAbsorbCharge + ")", "You destroy " + itemname(ci) + " and extract " + p + " recharge powers. (Total:" + gAbsorbCharge + ")")
			iNum(ci) = 0
			gosub *label_1681
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 504 | _switch_sw ) {
		_switch_sw = 0
		nc_intb_001 = 0
		cell_featread cX(cc), cY(cc)
		if ( featId == CELL_FEATURE_DOWNSTAIRS ) {
			repeat mWidth
				f = cnt
				repeat mHeight
					cell_featread f, cnt
					if ( featId == CELL_FEATURE_UPSTAIRS ) {
						cXnew(cc) = f
						cYnew(cc) = cnt
						nc_intb_001 = 1
						break
					}
				loop
				if ( nc_intb_001 ) {
					break
				}
			loop
			if ( nc_intb_001 ) {
				cell_check cXnew(cc), cYnew(cc)
				if ( cellaccess == 1 ) {
					if ( synccheck(cc, -1) ) {
						snd SOUNDLIST_TELEPORT1
						txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
					}
					rowactend cc
					redraw 0
					gosub *screen_draw
					gosub *label_3294
				}
				else {
					repeat 245
						if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
							continue
						}
						if ( cc == cnt ) {
							continue
						}
						if ( cX(cnt) == cXnew(cc) ) {
							if ( cY(cnt) == cYnew(cc) ) {
								cell_swap cc, cnt
								if ( synccheck(cc, -1) ) {
									snd SOUNDLIST_TELEPORT1
									ctalk cc, 10100, cnt, cc
									if ( stat == 0 ) {
										txt -1, lang(name(cnt) + "と入れ替わった。", "You displace " + name(cnt) + ".")
									}
								}
								gosub *screen_draw
								gosub *label_3294
								break
							}
						}
					loop
				}
			}
			else {
				txt -1, lang("何もおきない…", "Nothing happens...")
			}
		}
		else {
			repeat mWidth
				f = cnt
				repeat mHeight
					cell_featread f, cnt
					if ( featId == CELL_FEATURE_DOWNSTAIRS ) {
						cXnew(cc) = f
						cYnew(cc) = cnt
						nc_intb_001 = 1
						break
					}
				loop
				if ( nc_intb_001 ) {
					break
				}
			loop
			if ( nc_intb_001 ) {
				cell_check cXnew(cc), cYnew(cc)
				if ( cellaccess == 1 ) {
					if ( synccheck(cc, -1) ) {
						snd SOUNDLIST_TELEPORT1
						txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
					}
					rowactend cc
					redraw 0
					gosub *screen_draw
					gosub *label_3294
				}
				else {
					repeat 245
						if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
							continue
						}
						if ( cc == cnt ) {
							continue
						}
						if ( cX(cnt) == cXnew(cc) ) {
							if ( cY(cnt) == cYnew(cc) ) {
								cell_swap cc, cnt
								if ( synccheck(cc, -1) ) {
									snd SOUNDLIST_TELEPORT1
									ctalk cc, 10100, cnt, cc
									if ( stat == 0 ) {
										txt -1, lang(name(cnt) + "と入れ替わった。", "You displace " + name(cnt) + ".")
									}
								}
								gosub *screen_draw
								gosub *label_3294
								break
							}
						}
					loop
				}
			}
			else {
				txt -1, lang("何もおきない…", "Nothing happens...")
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 647 | _switch_sw ) {
		_switch_sw = 0
		tc = cc
		ctalk cc, 427, cc, tc
		if ( tc == CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		animeload 8, tc
		txt -1, lang(name(tc) + "は覚醒した！", name(tc) + " has awoken!")
		flt calcobjlv(cLevel(tc) + 3), FIX_QUALITY_GOOD
		fixlv = cQuality(tc)
		initlv = cLevel(tc)
		s = "god", "demon", "amorphs"
		fltn s(rnd(3))
		characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
		cnName(MAX_CHARA_NC) = cnName(tc)
		cSex(MAX_CHARA_NC) = cSex(tc)
		if ( gQuest == QUEST_TYPE_CONQUER ) {
			qParam1(gQuestRef) = cId(MAX_CHARA_NC)
		}
		relocate_chara 56, tc, 1
		cHP(tc) = cMHP(tc)
		cMP(tc) = cMMP(tc)
		cSP(tc) = cMSP(tc)
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}

	if ( _switch_val == 628 | _switch_sw ) {
		ctalk cc, 427, cc, tc
		_switch_sw = 0
*jump_changeCreature
		if ( tc == CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		f = 1
		if ( efp / 10 + 10 < cLevel(tc) ) {
			f = 0
		}
		if ( cQuality(tc) >= FIX_QUALITY_MIRACLE | cRole(tc) != ROLE_NONE | cbit(CHARA_BIT_BODYGUARD, tc) == TRUE | cbit(CHARA_BIT_PRECIOUS, tc) == TRUE ) {
			f = -1
		}
		if ( tc < MAX_CHARA_SAVE ) {
			f = 0
		}
		if ( f == 1 ) {
			animeload 8, tc
			if ( efid == SKILL_SPACT_EYE_OF_MUTATION ) {
				ctalk cc, 427, cc, tc
			}
			txt -1, lang(name(tc) + "は変化した。", name(tc) + " change" + _s(tc) + ".")
			ctalk cc, 428, cc, tc
			flt calcobjlv(cLevel(tc) + 3), FIX_QUALITY_GOOD
			characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
			relocate_chara 56, tc, 1
			lockon tc, cc, 13
			cbitmod CHARA_BIT_QUEST_TARGET, tc, FALSE
			check_quest
		}
		else {
			if ( f == 0 ) {
				txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			}
			else {
				txt -1, lang(name(tc) + "は変化できない。", name(tc) + " cannot be changed.")
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1140 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 6
		snd SOUNDLIST_INV
		gosub *label_2974
		if ( stat == 1 ) {
			autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
			if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
				autosave = 0
			}
			animeload 8, cc
			if ( efstatus >= 0 ) {
				if ( iWeight(ci) > 0 ) {
					iWeight(ci) = limit(iWeight(ci) * (100 - efp / 10) / 100, 1, iWeight(ci))
					if ( iPV(ci) > 0 ) {
						iPV(ci) -= iPV(ci) / 10 + 1 + (efstatus < 1)
					}
					if ( iDmg(ci) > 0 ) {
						iDmg(ci) -= iDmg(ci) / 10 + 1 + (efstatus < 1)
					}
				}
				txt -1, lang("" + itemname(ci, 1) + "は羽が生えたように軽くなった。", itemname(ci, 1) + " becomes light as a feather.")
			}
			else {
				iWeight(ci) = iWeight(ci) * 150 / 100 + 1000
				if ( iPV(ci) > 0 ) {
					iPV(ci) += limit(iPV(ci) / 10, 1, 5)
				}
				if ( iDmg(ci) > 0 ) {
					iDmg(ci) += limit(iDmg(ci) / 10, 1, 5)
				}
				txt -1, lang("" + itemname(ci, 1) + "はずしりと重くなった。", itemname(ci, 1) + " becomes heavy.")
			}
			gosub *label_1681
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		r1 = cc
		gosub *charaRefresh
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1132 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 4
		snd SOUNDLIST_INV
		gosub *label_2974
		f = stat
		if ( f ) {
			if ( iQuality(ci) > FIX_QUALITY_MIRACLE | ibit(ITEM_BIT_PRECIOUS, ci) == TRUE ) {
				f = 0
			}
		}
		if ( f == 1 ) {
			autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
			if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
				autosave = 0
			}
			animeload 8, cc
			fltbk = refitem(iID(ci), DBSPEC_TYPE, ci)
			valuebk = calcitemvalue(ci, 0)
			iNum(ci) = 0
			repeat
				await
				flt calcobjlv(efp / 10) + 5, calcfixlv(FIX_QUALITY_GREAT)
				if ( cnt < 10 ) {
					flttypemajor = fltbk
				}
				itemcreate CHARA_PLAYER, ITEM_ID_DUMMY, -1, -1, 0
				if ( stat == 0 ) {
					continue
				}
				if ( iValue(ci) > valuebk * 3 / 2 + 1000 ) {
					iNum(ci) = 0
					continue
				}
				else {
					break
				}
			loop
			txt -1, lang("それは" + itemname(ci, 1) + "に変容した。", "It is metamorphosed into " + itemname(ci, 1) + ".")
			gosub *label_1681
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 457 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == 438 | _switch_sw ) {
		_switch_sw = 0
		x = tlocx
		y = tlocy
		f = 1
		if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
			f = 0
		}
		else {
			if ( chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS ) {
				if ( homemapmode == 0 ) {
					if ( efid != SKILL_SPELL_DOOR_CREATION ) {
						f = 0
					}
					else {
						if ( chipm(CHIPM_ROLE, mapId(x, y)) == MAP_CHIP_ROLE_WATER ) {
							f = 0
						}
					}
				}
			}
			if ( mapChara(x, y) != 0 | (mapFeat(x, y) != 0 & efid != SKILL_SPELL_DOOR_CREATION) ) {
				f = 0
			}
		}
		if ( f == 1 ) {
			if ( efid == SKILL_SPELL_WALL_CREATION ) {
				if ( homemapmode == 0 ) {
					txt -1, lang("床が盛り上がってきた。", "A wall appears.")
					p = tile_wall
				}
				else {
					p = tile
				}
				if ( mapId(x, y) != p ) {
					snd SOUNDLIST_OFFER1
				}
				mapId(x, y) = p
				mapIdMemory(x, y) = p
			}
			if ( efid == SKILL_SPELL_DOOR_CREATION ) {
				cell_featread x, y
				if ( featId == CELL_FEATURE_DOOR_CLOSED ) {
					if ( areaType(gArea ) == MAP_TYPE_HOME ) {
						if ( feat == tile_doorclosed1 ) {
							cell_featset x, y, tile_doorclosed2, CELL_FEATURE_DOOR_CLOSED, rnd(efp / 10 + 1)
						}
						else {
							if ( feat == tile_doorclosed2 ) {
								cell_featset x, y, tile_doorclosed3, CELL_FEATURE_DOOR_CLOSED, rnd(efp / 10 + 1)
							}
							else {
								if ( feat == tile_doorclosed3 ) {
									cell_featset x, y, tile_doorclosed4, CELL_FEATURE_DOOR_CLOSED, rnd(efp / 10 + 1)
								}
								else {
									cell_featset x, y, tile_doorclosed1, CELL_FEATURE_DOOR_CLOSED, rnd(efp / 10 + 1)
								}
							}
						}
						txt -1, lang("扉の種類が変わった。", "The kind of the door changed.")
						goto *effect_end
					}
					else {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *effect_end
					}
				}
				else {
					if ( mapFeat(x, y) != 0 ) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *effect_end
					}
				}
				snd SOUNDLIST_OFFER1
				if ( chipm(CHIPM_ROLE, mapId(x, y)) == MAP_CHIP_ROLE_HARD_WALL ) {
					txt -1, lang("この壁は魔法を受け付けないようだ。", "These walls seem to resist your magic.")
					goto *effect_end
				}
				txt -1, lang("扉が出現した。", "A door appears.")
				cell_featset x, y, tile_doorclosed1, CELL_FEATURE_DOOR_CLOSED, rnd(efp / 10 + 1)
				if ( chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS ) {
					mapId(x, y) = tile_tunnel
				}
			}
		}
		else {
			if ( homemapmode == 0 ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			obvious = 0
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 631 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_BLUE
		ctalk cc, 966, cc, tc
		if ( stat == 0 ) {
			txtef COLOR_BLUE
			txt -1, lang("スウォーム！", "Swarm!")
		}
		repeat 245
			if ( cExist(cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			if ( relationbetween(cc, tc) != (-3) ) {
				continue
			}
			dx = cX(tc)
			dy = cY(tc)
			if ( dist(cX(cc), cY(cc), dx, dy) > skillTg(631) \ 1000 + 1 + (ogTitleGodOfWar == 2 & cc == CHARA_PLAYER) + (ogTitleStrengthIsPower == 2 & cc == CHARA_PLAYER & (cAttackStyle(cc) & 2) != 0) ) {
				continue
			}
			if ( fov_los(cX(cc), cY(cc), dx, dy) == 0 ) {
				continue
			}
			animeid = ANIMATION_ATTACK
			gosub *anime
			gosub *label_3640
			gosub *label_4714
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 659 | _switch_sw ) {
		_switch_sw = 0
		if ( mType == MAP_TYPE_WORLD ) {
			goto *effect_end
		}
		if ( mapFeat(cX(cc), cY(cc)) != 0 ) {
			goto *effect_end
		}
		cell_featset cX(cc), cY(cc), 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_QUEST_MINE, cc
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は何かを投下した。", name(cc) + " drop" + _s(cc) + " something on the ground.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 466 | _switch_sw ) {
		_switch_sw = 0
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cbit(CHARA_BIT_IMMUNE_MINE, cnt) ) {
				continue
			}
			tc = cnt
			dx = cX(tc)
			dy = cY(tc)
			if ( dist(cX(cc), cY(cc), dx, dy) > 2 * 2 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txt -1, lang(name(tc) + "は重力を感じた。", name(tc) + " feel" + _s(tc) + " gravity.")
			}
			cGravity(tc) += 100 + rnd(100)
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 657 | _switch_sw ) {
		_switch_sw = 0
		throwsstpevent "Mewmewmew", cc, "", 0
		ctalk cc, 427, cc, tc
		if ( stat == 0 ) {
			txtef COLOR_BLUE
			txt -1, lang("うみみゃぁ！", "Mewmewmew!")
		}
		nodropbodyparts = 1
		if ( areaId(gArea ) != AREA_SHELTER | cfg_nc_workshortening != 2 ) {
			animeid = ANIMATION_HOLY
			animode = 0
			gosub *anime
		}
		repeat 245
			if ( cExist(cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			dmghp tc, 9999999, cc
		loop
		ctalk cc, 428, cc, tc
		nodropbodyparts = 0
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 656 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			ctalk cc, 427, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は仲間を鼓舞した。", name(cc) + " cheer" + _s(cc) + ".")
			}
		}
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			if ( cc != CHARA_PLAYER | eqfaction(tc, "pcchild") == 0 & cRelation(cc) != cRelation(tc) ) {
				continue
			}
			dx = cX(tc)
			dy = cY(tc)
			if ( dist(cX(cc), cY(cc), dx, dy) > skillTg(656) \ 1000 + 1 ) {
				continue
			}
			if ( fov_los(cX(cc), cY(cc), dx, dy) == 0 ) {
				continue
			}
			if ( synccheck(tc, -1) ) {
				txtef COLOR_BLUE
				txt -1, lang(name(tc) + "は興奮した！", name(tc) + " " + is(tc) + " excited!")
			}
			addbuff tc, BUFF_SPEED, sCHR(cc) * 5 + 50, 15
			addbuff tc, BUFF_HERO, sCHR(cc) * 5 + 100, 60
			addbuff tc, BUFF_CONTINGENCY, 1500, 30
		loop
		ctalk cc, 428, cc, tc
		workshortf = 0
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 910 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_BLUE
		ctalk cc, 966, cc, tc
		if ( stat == 0 ) {
			txtef COLOR_BLUE
			txt -1, lang("破滅の手！", "Crash Hand!")
		}
		repeat 245
			if ( cExist(cc) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			if ( relationbetween(cc, tc) != (-3) ) {
				continue
			}
			dx = cX(tc)
			dy = cY(tc)
			if ( dist(cX(cc), cY(cc), dx, dy) > skillTg(631) \ 1000 + 1 + (ogTitleGodOfWar == 2 & cc == CHARA_PLAYER) + (ogTitleStrengthIsPower == 2 & cc == CHARA_PLAYER & (cAttackStyle(cc) & 2) != 0) ) {
				continue
			}
			if ( fov_los(cX(cc), cY(cc), dx, dy) == 0 ) {
				continue
			}
			animeid = ANIMATION_ATTACK
			dmghp tc, cMHP(tc) / 2, cc, SKILL_SPACT_DECAPITATION
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 911 | _switch_sw ) {
		_switch_sw = 0
		if ( sPerform(cc) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == CHARA_PLAYER) + "n't know how to sing.")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(183) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(183) / 2 + 1) + skillCost(183) / 2 + 1
		}
		cRowAct(cc) = 30006
		cActionPeriod(cc) = 61
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_3295
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 912 | _switch_sw ) {
		_switch_sw = 0
		if ( sPerform(cc) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == CHARA_PLAYER) + "n't know how to sing.")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(183) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(183) / 2 + 1) + skillCost(183) / 2 + 1
		}
		cRowAct(cc) = 30007
		cActionPeriod(cc) = 61
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_3295
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 913 | _switch_sw ) {
		_switch_sw = 0
		if ( sPerform(cc) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == CHARA_PLAYER) + "n't know how to sing.")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(183) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(183) / 2 + 1) + skillCost(183) / 2 + 1
		}
		cRowAct(cc) = 30008
		cActionPeriod(cc) = 61
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_3295
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 915 | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(183) / 2 + 1
					goto *effect_end
				}
			}
		}
		ctalk cc, 427, cc, cc
		if ( stat == 0 ) {
			txt -1, lang("「ガード！ガード！」", "Guards!")
		}
		repeat rnd(3) + 1
			flt
			initlv = limitmin(sorg(SKILL_NORMAL_TACTICS, cc) / 3, 1)
			characreate -1, CREATURE_ID_GUARD, cX(cc), cY(cc)
			cRelation(rc) = RELATION_DISLIKE
			cOrgRelation(rc) = RELATION_DISLIKE
		loop
		if ( synccheck(cc, -1) ) {
			ctalk cc, 428, cc, cc
			if ( stat == 0 ) {
				txt -1, lang("ガードが駆けつけてきた。", "Several Guards come out from a portal.")
			}
		}
		goto *label_3396
		_switch_sw++
	}
	if ( _switch_val == 916 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		cw = find_eq(cc, 10002)
		if ( cw != (-1) ) {
			if ( iID(cw) == ITEM_ID_KATANA | iID(cw) == ITEM_ID_HIRYU_TO | iID(cw) == ITEM_ID_WAKIZASHI | iID(cw) == ITEM_ID_ZANTETSUKEN ) {
				ctalk cc, 427, cc, tc
				if ( stat == 0 ) {
					txt -1, lang(name(cc) + "は居合切りを繰り出した。", name(cc) + " perform a surgical strike.")
				}
				multicritical = 1
				attack_weakguard
				gosub *label_3640
				gosub *label_4714
				ctalk cc, 428, cc, tc
				efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
				goto *effect_end
			}
		}
		cw = 0
		msgdup++
		txt -1, lang("刀を装備していない。", "You need to equip a katana.")
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 917 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		attack_weakguard
		ctalk cc, 427, cc, tc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は強奪を仕掛けようとした。", name(cc) + " tried to rob.")
		}
		p = rndex(cGold(tc) / 5 + 1)
		if ( rnd(sPER(tc)) > rnd(sDEX(cc) * 4) | cbit(CHARA_BIT_RES_STEAL, tc) == TRUE ) {
			txt -1, lang(name(tc) + "は自分の財布を守った。", name(tc) + " guard" + _s(tc) + " " + his(tc) + " wallet from a thief.")
			p = 0
		}
		if ( p != 0 ) {
			snd SOUNDLIST_PAYGOLD1
			cGold(tc) -= p
			txt -1, lang(name(cc) + "は" + name(tc) + "から" + p + "枚の金貨を奪った。", name(cc) + " steal" + _s(cc) + " " + p + " gold pieces from " + name(tc) + ".")
			se_moneymod cc, p
		}
		gosub *label_3640
		gosub *label_4714
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 918 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, tc
		attack_weakguard
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は怒りの一撃を繰り出した。", name(cc) + " unleashed a blow of anger.")
		}
		gosub *label_3640
		gosub *label_4714
		txt -1, lang(name(cc) + "は反動を受けた！", name(cc) + " received a reaction!")
		dmghp cc, limit(cHP(cc) / 3, 0, cHP(cc)), DAMAGE_FROM_OVERCAST
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 919 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		if ( cWet(cc) > 0 ) {
			ctalk cc, 427, cc, cc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は水の流れを利用した。", name(cc) + " utilized the flow of water.")
			}
			addbuff cc, BUFF_SPEED, sFishing(cc) * 5 + 200, 20
			ctalk cc, 428, cc, cc
		}
		else {
			if ( cc == CHARA_PLAYER ) {
				txt -1, lang("水気が無いと使用できない。", name(cc) + " Cannot be used without water.")
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 920 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, cc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は影分身の術を繰り出した。", name(cc) + " performed the shadow clone technique.")
		}
		repeat 229, 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			distance = dist(cX(cnt), cY(cnt), cX(cc), cY(cc))
			if ( cRelation(cnt) == RELATION_ENEMY & distance < 6 ) {
				if ( cOrgRelation(cnt) >= RELATION_HATE ) {
					cAiAggro(cnt) = 0
					cEmoIcon(cnt) = 21 + 100 * 2
					txt -1, lang(name(cnt) + "は" + name(cc) + "を見失った。", name(cc) + " Too far away.")
				}
				else {
					if ( cOrgRelation(cnt) == RELATION_ENEMY ) {
						cRelation(cnt) = RELATION_HATE
						cAiAggro(cnt) = 0
						cEmoIcon(cnt) = 21 + 100 * 2
						txt -1, lang(name(cnt) + "は" + name(cc) + "を見失った。", name(cc) + " Too far away.")
					}
				}
			}
		loop
		addbuff cc, BUFF_SPEED, ctype (cc) * 5 + 50, 10
		ctalk cc, 428, cc, cc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 921 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		attack_weakguard
		if ( tc == CHARA_PLAYER ) {
			txt -1, lang("自分の遺伝子を奪うことは出来ない。", "You try to take bodyparts from yourself.")
			goto *effect_end
		}
		if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
			txt -1, lang("吊るしたままでは遺伝子を奪うことは出来ない。", "You can't take bodyparts from a hung creature.")
			goto *effect_end
		}
		if ( cHP(tc) > cMHP(tc) / 8 ) {
			txt -1, lang("もっと弱らせないと遺伝子を奪うことは出来ない。", "The target needs to be weakened.")
			goto *effect_end
		}
		if ( synccheck(tc, -1) ) {
			ctalk cc, 427, cc, tc
			snd SOUNDLIST_ATKSWORD
			txtef COLOR_RED
			txt -1, lang(" *ブシュッ* ", "*Gash*")
			if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
				dmgType = 2
				txt3rd = 1
				txt -1, lang(name(cc) + "は" + name(tc) + "から遺伝子を奪い", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + " and")
			}
			else {
				txt -1, lang(name(cc) + "は" + name(tc) + "の遺伝子を奪った。", name(cc) + " take" + _c(cc) + " " + name(tc) + your(tc) + " " + ioriginalnameref(partid) + ".")
			}
		}
		dmghp tc, cMHP(tc) + 1, cc, SKILL_SPACT_DECAPITATION
		addbuff cc, BUFF_DIVINE_WISDOM, sGene(cc) * 5 + 200, 20
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 922 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, cc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は魔法書を構えた。", name(cc) + " read a book intensly.")
		}
		addbuff cc, 64, 100, 3 + sLiteracy(cc) / 20
		ctalk cc, 428, cc, cc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 923 | _switch_sw ) {
		_switch_sw = 0
		gosub *label_3030
		if ( stat == (-1) ) {
			if ( cc == CHARA_PLAYER ) {
				msgdup++
				txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
			}
			goto *effect_end
		}
		if ( stat == (-2) ) {
			if ( cc == CHARA_PLAYER ) {
				msgdup++
				txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
			}
			goto *effect_end
		}
		if ( stat == (-3) ) {
			if ( cc == CHARA_PLAYER ) {
				msgdup++
				txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
			}
			goto *effect_end
		}
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, tc
		gosub *act_fire
		repeat 200
			cXnew(cc) = rnd(mWidth - 2) + 1
			cYnew(cc) = rnd(mHeight - 2) + 1
			_dis = dist(cX(cc), cY(cc), cXnew(cc), cYnew(cc))
			if ( _dis > 7 | _dis < 4 ) {
				continue
			}
			cell_check cXnew(cc), cYnew(cc)
			if ( cellaccess == 1 ) {
				if ( synccheck(cc, -1) ) {
					snd SOUNDLIST_TELEPORT1
					txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
				}
				rowactend cc
				redraw 0
				gosub *screen_draw
				break
			}
		loop
		ctalk cc, 428, cc, tc
		gosub *label_3294
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 924 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, cc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は奮起の号令を行った！", name(cc) + " issued an inspirational command!")
		}
		f = 0
		repeat 15, 1
			if ( cExist(cnt) == CHAR_STATE_ALLY_DEAD ) {
				rc = cnt
				gosub *resurrect
				cxinit = cX(cc)
				cyinit = cY(cc)
				place_chara rc, cxinit, cyinit
				cType(rc) = 0
				txtef COLOR_YELLOW
				txt -1, cnven(cnName(rc)) + lang("は復活した！", " " + have(rc) + " been resurrected!")
				ctalk rc, 1263, rc, cc
				if ( stat == 0 ) {
					txt rc, lang("「ありがとう！」", cnvtalk("Thanks!"))
				}
				f += 1
				animeid = ANIMATION_HOLY
				animode = 100 + rc
				gosub *anime
				snd SOUNDLIST_PRAY2
				cEmoIcon(rc) = 17 + 100 * 3
				if ( cc == CHARA_PLAYER ) {
					modimp rc, 10
				}
				p = 10, 11, 12, 17, 18, 14, 13, 16, 15, 19, -1
				repeat
					if ( p(cnt) == (-1) ) {
						break
					}
					i = p(cnt) + 240 - 10
					cdata(i, rc) -= sorgex(p(cnt), rc) / 4
				loop
			}
		loop
		animeload 11, cc
		addbuff cc, BUFF_HOLY_SHIELD, ctype (cc) * (2 + f * 2) + 50, 15
		addbuff cc, BUFF_HERO, ctype (cc) * (2 + f * 2) + 50, 15
		f = 0
		ctalk cc, 428, cc, cc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 925 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, cc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は敵に神罰を下そうとした。", name(cc) + " tried to punish the enemy.")
		}
		repeat 229, 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			distance = dist(cX(cnt), cY(cnt), cX(cc), cY(cc))
			if ( cRelation(cnt) == RELATION_ENEMY & distance < 6 ) {
				addbuff cnt, BUFF_PUNISHMENT, sPrayer(cc) * 5 + 100, 10 + sPrayer(cc) / 5
				snd SOUNDLIST_CURSE3
				animeload 14, cnt
			}
		loop
		ctalk cc, 428, cc, cc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 926 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, cc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は舞を踊った。", name(cc) + " danced a dance.")
		}
		f = 0
		repeat 229, 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			distance = dist(cX(cnt), cY(cnt), cX(cc), cY(cc))
			if ( cRelation(cnt) == RELATION_ENEMY & distance < 6 ) {
				f += 1
			}
		loop
		animeload 11, cc
		addbuff cc, BUFF_SPEED, sEvade(cc) * (f * 2 + 1) + 50, 15
		if ( f >= 3 ) {
			addbuff cc, BUFF_HERO, sEvade(cc) * (f * 2 + 1) + 50, 15
		}
		if ( f >= 5 ) {
			addbuff cc, BUFF_HOLY_SHIELD, sEvade(cc) * (f * 2 + 1) + 50, 15
		}
		f = 0
		ctalk cc, 428, cc, cc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 927 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, cc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は感覚を研ぎ澄ませた。", name(cc) + " sharpened your senses.")
		}
		repeat mHeight
			y = cnt
			repeat mWidth
				x = cnt
				p = dist(cX(cc), cY(cc), x, y)
				if ( p < 16 ) {
					mapIdMemory(x, y) = mapId(x, y)
					if ( mapFeat(x, y) != 0 | mapItemsMemory(x, y) != 0 ) {
						mapbitmod 0, x, y, 1
					}
				}
			loop
		loop
		txt -1, lang(name(cc) + "は周囲の地形を察知した。", name(cc) + " sense" + _s(cc) + " nearby locations.")
		animeload 10, cc
		redraw 0
		gosub *label_1462
		ctalk cc, 428, cc, cc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 928 | _switch_sw ) {
		_switch_sw = 0
		if ( tc == cc ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			goto *effect_end
		}
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, tc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は" + name(tc) + "を魅了した。", name(cc) + " seduce" + name(tc))
			cEmoIcon(tc) = 17 + 100 * 3
		}
		gosub *label_3302
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 929 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		ctalk cc, 427, cc, tc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は" + name(tc) + "をじっと見据えた。", name(cc) + " stare at" + name(tc))
		}
		if ( gArea  == AREA_ARENA | gArea  == AREA_PET_ARENA | gArea  == 49 | gArea  == 210 | oabit(17, gArea ) | oabit(18, gArea ) ) {
			obvious = 0
			txt -1, lang("この場所では効果がない。", "The effect doesn't work in this area.")
			goto *effect_end
		}
		f = 1
		if ( findfaction(tc, "family", "wild") & trophycheck(TROPHY_GAMBLING) == 2 ) {
			f = 1
		}
		if ( sTrade(cc) / 5 < cLevel(tc) ) {
			f = 0
		}
		if ( cQuality(tc) >= FIX_QUALITY_MIRACLE | cRole(tc) != ROLE_NONE | cbit(CHARA_BIT_PRECIOUS, tc) == TRUE ) {
			f = -1
		}
		if ( eqfaction(tc, "nc_sheep") ) {
			f = -1
		}
		if ( f == 1 ) {
			rc = tc
			gosub *cm_race_loop_WHILE1
			check_quest
		}
		else {
			if ( f == 0 ) {
				txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			}
			else {
				txt -1, lang(name(tc) + "は支配できない。", name(tc) + " cannot be charmed.")
			}
		}
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 930 | _switch_sw ) {
		_switch_sw = 0
		if ( cSP(CHARA_PLAYER) < 50 ) {
			if ( cSP(CHARA_PLAYER) < rnd(75) ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
				goto *effect_end
			}
		}
		f = 0
		if ( cGold(cc) > 0 ) {
			if ( cGold(cc) >= sInvest(cc) * 100 ) {
				f = sInvest(cc) * 100
			}
			else {
				f = cGold(cc)
			}
			cGold(cc) -= f
			ctalk cc, 427, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は" + name(tc) + "に金貨を投げつけた！", name(cc) + " throw gold coins at" + name(tc))
			}
			animeload 11, tc
			dmghp tc, f / 20, cc, SKILL_SPACT_DECAPITATION
			ctalk cc, 428, cc, tc
		}
		else {
			txt -1, lang("金貨が足りない。", "Not enough gold coins.")
		}
		f = 0
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 931 | _switch_sw ) {
		_switch_sw = 0
		cw = -1
		repeat 30
			body = 100 + cnt
			if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 5 ) {
				cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
				if ( ibit(ITEM_BIT_HANDMADE, cw) == TRUE ) {
					break
				}
				cw = -1
			}
		loop
		if ( cw != (-1) ) {
			txtef COLOR_BLUE
			ctalk cc, 427, cc, cc
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang("自信の一撃！", "Swarm!")
			}
			repeat 245
				if ( cExist(cc) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( cc == cnt ) {
					continue
				}
				tc = cnt
				if ( relationbetween(cc, tc) != (-3) ) {
					continue
				}
				dx = cX(tc)
				dy = cY(tc)
				if ( dist(cX(cc), cY(cc), dx, dy) > skillTg(631) \ 1000 + 1 + (ogTitleGodOfWar == 2 & cc == CHARA_PLAYER) + (ogTitleStrengthIsPower == 2 & cc == CHARA_PLAYER & (cAttackStyle(cc) & 2) != 0) ) {
					continue
				}
				if ( fov_los(cX(cc), cY(cc), dx, dy) == 0 ) {
					continue
				}
				animeid = ANIMATION_ATTACK
				gosub *anime
				gosub *label_3640
				gosub *label_4714
			loop
			ctalk cc, 428, cc, cc
		}
		else {
			cw = 0
			msgdup++
			txt -1, lang("自作武器を装備していない。", "You need to equip a self make weapon.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 932 | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
					goto *effect_end
				}
			}
		}
		ctalk cc, 427, cc, tc
		repeat 200
			cXnew(cc) = cX(tc) + rnd(cnt / 20 + 2) - rnd(cnt / 20 + 2)
			cYnew(cc) = cY(tc) + rnd(cnt / 20 + 2) - rnd(cnt / 20 + 2)
			cell_check cXnew(cc), cYnew(cc)
			if ( cellaccess == 1 ) {
				if ( synccheck(cc, -1) ) {
					snd SOUNDLIST_TELEPORT1
					txt -1, lang(name(cc) + "は接近した。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
				}
				rowactend cc
				redraw 0
				gosub *screen_draw
				break
			}
		loop
		gosub *label_3294
		_dis = dist(cX(cc), cY(cc), cX(tc), cY(tc))
		if ( _dis < 2 ) {
			gosub *label_3640
			gosub *label_4714
			efid = 932
			gosub *label_3640
			gosub *label_4714
			efid = 932
			gosub *label_3640
			gosub *label_4714
		}
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 934 | _switch_sw ) {
		_switch_sw = 0
		if ( tc == cc ) {
			txt -1, lang("それは無理だ。", "It's impossible.")
			goto *effect_end
		}
		f = -1
		repeat 30
			body = 100 + cnt
			if ( cdata(body, tc) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			if ( cdata(body, tc) / EXT_EQUIP_SLOTS == 5 ) {
				f = cdata(body, tc) \ EXT_EQUIP_SLOTS - 1
				break
			}
		loop
		if ( f == (-1) ) {
			txt -1, lang(name(cc) + "の叩きつけは空振った！", name(cc) + " battering ram strikes out!")
			goto *effect_end
		}
		attack_weakguard
		ctalk cc, 427, cc, tc
		if ( stat == 0 ) {
			txt -1, lang(name(cc) + "は武器に向かって叩きつけた！", name(cc) + " has slammed into a weapon!")
		}
		dmgmulti = 0.5 + double(sSTR(cc) + sMartial(cc) / 5 + ctype (cc) * 2) / 40
		dmghp tc, role(iDice1(f), iDice2(f), iDmg(f)) * dmgmulti, cc
		ctalk cc, 428, cc, tc
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 935 ) {
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang(npcn(cc) + "口笛で威嚇した。", name(cc) + " blow" + _s(cc) + " on the whistle.")
			f = 1
		}
		txtef COLOR_SKY_BLUE
		txt -1, lang(" *ピーーーー* ", "*Peeeeeeeeeep* ")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		repeat 229, 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cSleep(cnt) != 0 ) {
				continue
			}
			if ( dist(cX(cnt), cY(cnt), cX(cc), cY(cc)) > 10 ) {
				continue
			}
			if ( relationbetween(cc, cnt) >= (-1) ) {
				continue
			}
			if ( sCHR(cc) > rnd(cLevel(cnt) + cLevel(cc)) ) {
				turn_aggro cnt, cc, 80
			}
			if ( godcheck(cc) == "dybony" ) {
				if ( cPiety(cc) / 100 + 1 >= cLevel(cnt) ) {
					if ( findfaction(cnt, "family", "wild") ) {
						dmgcon cnt, CONDITION_FEAR, rnd(cPiety(cc) / 5 + 1) + 100
					}
				}
			}
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == 1131 | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			if ( cId(tc) == CREATURE_ID_PAELS_MOM_LILY & cRelation(tc) == RELATION_ALLY & cPic(tc) != xy2pic(30, 10) ) {
				txt -1, lang(name(tc) + "の顔が変異した！", name(tc) + "'s face mutates!")
				animeload 8, tc
				cPic(tc) = xy2pic(30, 10)
				cPortrait(tc) = -1
				goto *effect_end
			}
			if ( cId(tc) == CREATURE_ID_FAIRY & cRelation(tc) == RELATION_ALLY & cPic(tc) != xy2pic(5, 15) ) {
				txt -1, lang(name(tc) + "の姿が変異した！", name(tc) + "'s skin mutates!")
				animeload 8, tc
				if ( gArea  == 59 ) {
					cPic(tc) = xy2pic(26, 13)
				}
				else {
					cPic(tc) = xy2pic(5, 15)
				}
				cPortrait(tc) = -1
				goto *effect_end
			}
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		snd SOUNDLIST_PRAY1
		if ( efstatus >= 0 ) {
			txtef COLOR_GREEN
			txt -1, lang("エーテルの抗体があなたの体内に行き渡った。", "Your Ether Disease is cured greatly.")
			modcorrupt efp * (-10)
		}
		else {
			txtef COLOR_PURPLE
			txt -1, lang("エーテルの病菌があなたの体内に行き渡った。", " The Ether Disease spreads around your body.")
			modcorrupt 200
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1148 | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			if ( cId(tc) == CREATURE_ID_PAELS_MOM_LILY & cRelation(tc) == RELATION_ALLY ) {
				if ( cPic(tc) != xy2pic(30, 10) & efstatus != 1 ) {
					cPic(tc) = xy2pic(30, 10)
					cPortrait(tc) = -1
					animeload 8, tc
				}
				else {
					if ( cPic(tc) == xy2pic(30, 10) & efstatus >= 1 ) {
						cPic(tc) = xy2pic(29, 10)
						cPortrait(tc) = 13
						animeload 10, tc
					}
					else {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *effect_end
					}
				}
				txt -1, lang(name(tc) + "の顔が変異した！", name(tc) + "'s face mutates!")
				goto *effect_end
			}
			if ( cId(tc) == CREATURE_ID_FAIRY & cRelation(tc) == RELATION_ALLY ) {
				if ( cPic(tc) != xy2pic(26, 13) & cPic(tc) != xy2pic(5, 15) & efstatus != 1 ) {
					animeload 8, tc
					if ( gArea  == 59 ) {
						cPic(tc) = xy2pic(26, 13)
					}
					else {
						cPic(tc) = xy2pic(5, 15)
					}
					cPortrait(tc) = -1
				}
				else {
					if ( cPic(tc) == xy2pic(5, 15) & efstatus >= 1 ) {
						cPic(tc) = xy2pic(27, 11)
						cPortrait(tc) = -1
						animeload 10, tc
					}
					else {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *effect_end
					}
				}
				txt -1, lang(name(tc) + "の姿が変異した！", name(tc) + "'s skin mutates!")
				goto *effect_end
			}
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		if ( efstatus >= 0 ) {
			gosub *label_5854
		}
		else {
			txtef COLOR_PURPLE
			txt -1, lang("エーテルの病菌があなたの体内に行き渡った。", " The Ether Disease spreads around your body.")
			modcorrupt 1000
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 633 | _switch_sw ) {
		_switch_sw = 0
		if ( tc != CHARA_PLAYER ) {
			goto *effect_end
		}
		txtef COLOR_PURPLE
		ctalk cc, 427, cc, tc
		txt -1, lang(name(cc) + "に睨まれ、あなたはエーテルに侵食された。", name(cc) + " gazes at you. Your Ether Disease deteriorates.")
		ctalk cc, 428, cc, tc
		modcorrupt 100
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 638 | _switch_sw ) {
		_switch_sw = 0
		ctalk cc, 427, cc, tc
		ctalk cc, 428, cc, tc
		_switch_sw++
	}
	if ( _switch_val == 648 | _switch_sw ) {
		_switch_sw = 0
		if ( efid == SKILL_SPACT_INSULT ) {
			if ( synccheck(tc, -1) ) {
				ctalk cc, 974, cc, tc
				if ( stat == 0 ) {
					txt -1, lang(name(cc) + "は" + name(tc) + "を罵倒した。", name(cc) + " insult" + _s(cc) + " " + name(tc) + ".")
				}
				txtef COLOR_SKY_BLUE
				ctalk cc, 1000, cc, tc
				if ( stat == 0 ) {
					ctalk cc, 1203, cc, tc
					if ( stat == 0 ) {
						txtef COLOR_SKY_BLUE
						if ( jp ) {
							if ( cSex(cc) == 0 ) {
								txt cc, "「すっこんでろ雑魚め」", "「オマエ程度が戦うだと？」", "「すぐに殺してやるよ」", "「消えろザコめ」", "「このかたつむり野郎」", "「すぐにミンチにしてやるよ」"
							}
							else {
								if ( rnd(2) ) {
									txt cc, "「グシャグシャにしてやるわ」", "「地べたを這いずりなさい」", "「ウージッムシ♪ウージッムシ♪」", "「目障りよ」", "「もがけ。苦しめ！」", "「その下品な眼をくりぬくの」"
								}
								else {
									txt cc, "「このカタツムリが」", "「どうしたの？もう終わりなの？」", "「潔く、くたばりなさい」", "「生まれてきたことを後悔するのね」", "「このブタめ」", "「すぐにミンチにしてあげる」"
								}
							}
						}
						else {
							if ( rnd(2) ) {
								txt cc, cnvtalk("You suck!"), cnvtalk("You will die alone."), cnvtalk("Bow down before me."), cnvtalk("Go jump off a bridge."), cnvtalk("Bang your head against the wall!"), cnvtalk("Why do you sniff under your dog's tail?")
							}
							else {
								txt cc, cnvtalk("The world is against you because you are a unsavory decomposing virus."), cnvtalk("You are no better than a immoral guzzling bureaucrat."), cnvtalk("You are so lowly."), cnvtalk("Get off me.")
							}
						}
					}
				}
			}
		}
		dmgcon tc, CONDITION_DIM, 200
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 652 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			ctalk cc, 427, cc, tc
			txt -1, lang(name(cc) + "は" + name(tc) + "を睨み付けた。", name(cc) + " gaze" + _s(cc) + " at " + name(tc) + ".")
			ctalk cc, 428, cc, tc
		}
		dmgmp tc, rnd(20) + 1
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 1133 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "は炎に包まれた。", name(tc) + " " + is(tc) + " surrounded by flames.")
		}
		dim inrange, mWidth, mHeight
		searchrangeinit cX(tc), cY(tc), limit(efp / 100 - 1, 0, 20)
		if ( stat ) {
			repeat mWidth
				cnt2 = cnt
				repeat mHeight
					if ( inrange(cnt2, cnt) ) {
						if ( (chipm(CHIPM_ATTRIB, mapId(cnt2, cnt)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
							if ( rnd(3) ) {
								addmef cnt2, cnt, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 25, efp / 2, cc
								mapitem_fire cnt2, cnt
							}
						}
					}
				loop
			loop
		}
		addmef cX(tc), cY(tc), MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 25, efp, cc
		mapitem_fire cX(tc), cY(tc)
		return
		_switch_sw++
	}
	if ( _switch_val == 651 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			ctalk cc, 427, cc, tc
			txt -1, lang(name(cc) + "は" + name(tc) + "のバックパックを漁った。", name(cc) + " loot" + _s(cc) + " " + name(tc) + your(tc) + " backpack.")
		}
		p = -1
		inv_getheader tc
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iID(cnt) == ITEM_ID_FISH ) {
				p = cnt
				break
			}
		loop
		if ( p == (-1) ) {
			inv_getheader tc
			repeat invrange, invhead
				if ( iNum(cnt) == 0 ) {
					continue
				}
				if ( ibit(ITEM_BIT_PRECIOUS, cnt) ) {
					continue
				}
				if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) != FILTER_ITEM_FOOD & (iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0) == 0 ) {
					continue
				}
				if ( refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) == FILTER_ITEM_FOOD_HERB & iParam2(cnt) > 1 & iID(cnt) != ITEM_ID_INFIEA ) {
					continue
				}
				p = cnt
				break
			loop
		}
		if ( p == (-1) ) {
			goto *effect_end
		}
		ci = p
		if ( ibit(ITEM_BIT_LOVE_BLEND, ci) ) {
			if ( synccheck(tc, -1) ) {
				txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "の異臭に気付き手をひっこめた。", name(cc) + " notice" + _s(cc) + " unusual odor from " + itemname(ci, 1) + " and step" + _s(cc) + " back.")
			}
			goto *effect_end
		}
		rowact_item ci
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_EAT1
			txt -1, lang(name(cc) + "は" + itemname(ci, 1) + "を食べた！", name(cc) + " eat" + _s(cc) + " " + itemname(ci, 1) + "!")
			ctalk cc, 428, cc, tc
		}
		healhp cc, cMHP(cc) / 3
		gosub *insta_eat
		gosub *label_1681
		goto *effect_end
		_switch_sw++
	}


	if ( _switch_val == 464 | _switch_sw ) {
		_switch_sw = 0
		animeload 10, tc
		rtval = 0
		if ( ogTitleRagnarok == 2 ) {
			rtval = 0
			txtnew
			txt -1, lang("纏めて唱える？", "Collectively recite?")
			promptl(0, 0) = stryes, "y", "1"
			promptl(0, 1) = strno, "n", "0"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
		}
		hroop = 1
		if ( rtval == 1 ) {
			repeat
				if ( spell(efid - 400) < 0 ) {
					spell(efid - 400) = 0
					break
				}
				spell(efid - 400) -= calcspellcoststock(efid, cc)
				hroop += 1
			loop
		}
		herp = 0
		hert = 0
		herw = 0
		herg = 0
		hergs = 0
		repeat hroop
			if ( rtval == 0 | cnt == 0 ) {
				snd SOUNDLIST_PRAY1
			}
			locvar_calcmagiccontrol_message = ""
			repeat limit(4 + rnd(efp / 50 + 1), 1, 15)
				flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
				dbid = 54
				p = 400 + rndex2(limit(efp, 1, 2000000))
				if ( rnd(30) == 0 ) {
					dbid = 55
					p = 1
				}
				if ( rnd(80) == 0 ) {
					dbid = 622
					p = 1
				}
				if ( rnd(2000) == 0 ) {
					dbid = 290
					p = 1
				}
				if ( rtval == 1 ) {
					if ( dbid == 55 ) {
						herp++
					}
					if ( dbid == 622 ) {
						hert++
					}
					if ( dbid == 290 ) {
						herw++
					}
					if ( dbid == 54 ) {
						herg(0) = limitmax(herg + p, 2140000000)
						if ( herg >= 2140000000 ) {
							hergs++
							herg = 0
						}
					}
				}
				if ( hroop == 1 ) {
					nostack = 1
					itemcreate -1, dbid, cX(cc), cY(cc), p
					if ( stat ) {
						locvar_calcmagiccontrol_message += lang(itemname(ci) + "が降ってきた！", itemname(ci) + " fall" + _s2(iNum(ci)) + " down!")
					}
					if ( cfg_animewait > 0 ) {
						txt -1, locvar_calcmagiccontrol_message
						redraw 1
						locvar_calcmagiccontrol_message = ""
					}
					item_stack -1, ci
				}
				else {
					if ( cnt < 10000 & cnt \ 100 == 0 ) {
						skillexp2 efid, cc, 200
					}
				}
			loop
			if ( cfg_animewait == 0 & rtval == 0 ) {
				txt -1, locvar_calcmagiccontrol_message
				redraw 1
			}
		loop
		if ( rtval == 1 ) {
			txt -1, lang("沢山のアイテムが降ってきた！", "")
			txtnew
			txt -1, lang("金貨:" + hergs + "スタック + " + herg + "枚 ", "")
*label_3509
			if ( hergs >= 0 == 0 ) {
				goto *label_3511
			}
			flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
			nostack = 1
			itemcreate -1, ITEM_ID_GOLD_PIECE, cX(cc), cY(cc), herg
			item_stack -1, ci
			herg = 2147483647
			hergs--
			goto *label_3509
*label_3511
			if ( herp > 0 ) {
				flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
				nostack = 1
				itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(cc), cY(cc), herp
				item_stack -1, ci
			}
			if ( hert > 0 ) {
				flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
				nostack = 1
				itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(cc), cY(cc), hert
				item_stack -1, ci
			}
			if ( herw > 0 ) {
				flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
				nostack = 1
				itemcreate -1, ITEM_ID_ROD_WISHING, cX(cc), cY(cc), herw
				item_stack -1, ci
			}
			txt -1, lang("プラチナ硬貨:" + herp + "枚 " + "小さなメダル:" + hert + "枚 " + " 願いの杖:" + herw + "本 ", "")
			if ( hroop > 10000 ) {
				hroop = 10000
			}
			if ( nc_gettrait(cc, 112) == 0 | rnd(4) ) {
				dmgmp cc, mp * (hroop - 1)
			}
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 463 | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_TELEPORT1
		lint_efp = efp * 100
		txt -1, lang("あなたは四次元のポケットを召喚した。(収納可能重量:", "You summon 4 dimensional pocket.(Stowable weight:") + cnvweight(limitmax(lint_efp, 2147483647)) + ")"
		invfile = 8
		file = "shoptmp.s2"
		ctrlfile 4
		file = "shop" + invfile + ".s2"
		tmpload "" + file
		exist exedir + "tmp\\" + file
		if ( strsize != (-1) ) {
			ctrlfile 3
			inv_getheader -1
			repeat invrange, invhead
				if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
					getitemid cnt
				}
				checkalter cnt
				if ( ICNpcSerialNo(cnt) ) {
					getunid4item cnt
				}
			loop
		}
		else {
			inv_getheader -1
			repeat invrange, invhead
				iNum(cnt) = 0
			loop
		}
		shoptrade = 0
		menucycle = 1
		invsubroutine = 1
		invctrl = INVCTRL_INV_FILE_GET, 5
		invcontainer = limit(efp / 10 + 10, 10, 300)
		mode = MODELIST_SHOP
		snd SOUNDLIST_INV
		gosub *label_2974
		invcontainer = 0
		file = "shop" + invfile + ".s2"
		ctrlfile 4
		file = "shoptmp.s2"
		ctrlfile 3
		mode = MODELIST_MAIN
		goto *effect_end
	}
	if ( _switch_val == 503 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		f = 0
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 3
		snd SOUNDLIST_INV
		gosub *label_2974
		f = stat
		if ( f == 1 ) {
			dbid = iID(ci)
			cibkref = ci
			dbmode = DBMODE_REF
			gosub *db_item
			orgichargelevel = ichargelevel
			if ( ichargelevel < 1 | (iID(ci) == ITEM_ID_ROD_WISHING & ogTitleBeyondWish != 2) | iID(ci) == ITEM_ID_ROD_DOMINATION | iID(ci) == ITEM_ID_SPELLBOOK_WISHING | iID(ci) == ITEM_ID_SPELLBOOK_HARVEST | (iID(ci) == ITEM_ID_ANCIENT_BOOK & iParam2(ci) != 0) | (iQuality(ci) == FIX_QUALITY_UNIQUE & iID(ci) != ITEM_ID_SPELLBOOK_OF_ALL) ) {
				txt -1, lang("それは充填ができないようだ。", "You can't recharge this item.")
				item_autostack cc, ci
				goto *effect_end
			}
			if ( reftype == FILTER_ITEM_SPELLBOOK ) {
				if ( iID(ci) != ITEM_ID_SPELLBOOK_MAGIC_LASER & iID(ci) != ITEM_ID_SPELLBOOK_MUTATION & iID(ci) != ITEM_ID_SPELLBOOK_MAGIC_BALL & iID(ci) != ITEM_ID_SPELLBOOK_DOMINATION & iID(ci) != ITEM_ID_SPELLBOOK_WISHING & iID(ci) != ITEM_ID_SPELLBOOK_CURE_JURE ) {
					ichargelevel *= 2
				}
			}
			if ( reftype == FILTER_ITEM_ROD & iLevel(ci) > 0 ) {
				ichargelevel += ichargelevel / 2 * iLevel(ci) + 1
			}
			f = 1
			if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) > ichargelevel ) {
				f = -1
			}
			if ( iID(ci) == ITEM_ID_ROD_WISHING & inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) < iLevel(ci) ) {
				f = 1
			}
			if ( f == (-1) ) {
				txt -1, lang(itemname(ci) + "はこれ以上充填できないようだ。", itemname(ci) + " cannot be recharged anymore.")
				item_autostack cc, ci
				goto *effect_end
			}
			p = 1 + rnd(orgichargelevel / 2 + 1) + iLevel(ci) / 5
			if ( p + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) > ichargelevel ) {
				p = ichargelevel - inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) + 1
			}
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_SPELLBOOK ) {
				p = 1
			}
			if ( iID(ci) == ITEM_ID_ROD_WISHING ) {
				p = limit(sMagicDevice(cc) / 1000, 1, iLevel(ci) - inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci))
			}
			txt -1, lang(itemname(ci) + "は充填された(+" + p + ")", itemname(ci) + " " + is2(iNum(ci)) + " recharged by +" + p + ".")
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) += p
			item_autostack cc, ci
			animeload 8, cc
		}
		goto *effect_end
		_switch_sw++
	}

	if ( _switch_val == 505 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		nc_intb_100 = calcspellfail(505, CHARA_PLAYER)
		efp = 10
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 0
		snd SOUNDLIST_INV
		gosub *label_2974
		f = stat
		equip = iEquip(ci)
		if ( f == 1 ) {
			if ( iQuality(ci) == FIX_QUALITY_UNIQUE ) {
				txt -1, lang("アーティファクトの再生成にはパワーが足りない。", "More magic power is needed to reconstruct an artifact.")
				goto *effect_end
			}
			else {
*label_3514
				animeload 8, cc
				if ( rnd(3) == 0 ) {
					fixmaterial = ITEM_MATERIAL_RAW
				}
				s = itemname(ci, 1, 1)
				nc_intb_101 = iPV(ci)
				nc_intb_102 = iDV(ci)
				nc_intb_103 = iDmg(ci)
				nc_intb_104 = iAtk(ci)
				nc_intb_105 = iDice1(ci)
				nc_intb_106 = iDice2(ci)
				nc_intb_107 = iMaterial(ci)
				nc_intb_108 = iValue(ci)
				objlv = 0
				objfix = efp / 100
				randomize
				gosub *remake_material
				txt -1, lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
				if ( nc_intb_100 == 100 ) {
					transformsstat
					txtnew
					txt -1, lang("もう一度変化させる？", "Try again?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					valhinan = val
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval == 0 ) {
						if ( spell(505 - 400) == 0 ) {
							txt -1, lang("劣悪変化のストックがなくなったため、連続使用を中止した。", "There is no stock of Pooriation.")
							if ( equip != 0 ) {
								cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
								iEquip(ci) = equip
							}
							r1 = cc
							gosub *charaRefresh
							fixmaterial = ITEM_MATERIAL_SAND
							objfix = 0
							goto *effect_end
						}
						if ( 99 >= calcspellfail(505, CHARA_PLAYER) ) {
							msgdup++
							txt -1, lang("成功率が100%ではなくなったため、連続使用を中止した。", "The success rate was no longer 100%, so continuous use was discontinued.")
							if ( equip != 0 ) {
								cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
								iEquip(ci) = equip
							}
							r1 = cc
							gosub *charaRefresh
							fixmaterial = ITEM_MATERIAL_SAND
							objfix = 0
							goto *effect_end
						}
						spell(505 - 400) -= calcspellcoststock(505, CHARA_PLAYER)
						if ( spell(505 - 400) < 0 ) {
							spell(505 - 400) = 0
						}
						mp = calcspellcostmp(505, CHARA_PLAYER)
						if ( godcheck(0) == "ehekatl" ) {
							graceofgod = cPiety(CHARA_PLAYER) / 500
							if ( graceofgod > 40 ) {
								graceofgod = 40
							}
							mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
						}
						nc_intb_001 = 0
						nc_intb_002 = 0
						nc_intb_003 = 0
						repeat 30, 100
							dup roopbuf, cdata(cnt, CHARA_PLAYER)
							if ( roopbuf \ 10000 == 0 ) {
								continue
							}
							nc_intb_002 = roopbuf \ 10000 - 1
							if ( inv(37, nc_intb_002) == 7 ) {
								nc_intb_001 += inv(38, nc_intb_002)
								continue
							}
							if ( inv(37, nc_intb_002) == 8 ) {
								nc_intb_003 += inv(38, nc_intb_002)
								continue
							}
						loop
						if ( nc_intb_001 > 0 ) {
							mp = mp * (100 - nc_intb_001) / 100
						}
						if ( nc_intb_003 > 0 ) {
							healamo = mp / 100 * nc_intb_003
							healhp CHARA_PLAYER, healamo
							if ( showdamagecheck(healamo) ) {
								if ( synccheck(tc, -1) ) {
									mondmgn(mondmgcnt) = "" + healamo
									mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, 0, 0
									ccolor 110
									if ( stat == 0 ) {
										mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
									}
									mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
								}
							}
						}
						if ( nc_gettrait(cc, 112) == 0 | rnd(4) ) {
							dmgmp CHARA_PLAYER, mp
						}
						if ( cExist(CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
							efsource = 0
							magiccritical = 0
							return 1
						}
						cc = ccbk
						r1 = cc
						r2 = spellbk
						gosub *label_1598
						goto *label_3514
					}
				}
			}
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		if ( equip != 0 ) {
			cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
			iEquip(ci) = equip
		}
		r1 = cc
		gosub *charaRefresh
		fixmaterial = ITEM_MATERIAL_SAND
		objfix = 0
		goto *effect_end
		_switch_sw++
	}

	if ( _switch_val == 506 | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			goto *effect_end
		}
		nc_intb_100 = calcspellfail(506, CHARA_PLAYER)
		efp = 180
		invsubroutine = 1
		invctrl = INVCTRL_MATERIAL_ENCHANT, 0
		snd SOUNDLIST_INV
		gosub *label_2974
		f = stat
		if ( iQuality(ci) == FIX_QUALITY_GODLY | ibit(ITEM_BIT_ALIVE, ci) == TRUE ) {
			f = 0
		}
		equip = iEquip(ci)
		if ( f == 1 ) {
			if ( iQuality(ci) == FIX_QUALITY_UNIQUE ) {
				txt -1, lang("アーティファクトの再生成にはパワーが足りない。", "More magic power is needed to reconstruct an artifact.")
				goto *effect_end
			}
			else {
*label_3516
				animeload 8, cc
				if ( efp <= 70 ) {
					if ( rnd(3) == 0 ) {
						fixmaterial = ITEM_MATERIAL_RAW
					}
				}
				s = itemname(ci, 1, 1)
				nc_intb_101 = iPV(ci)
				nc_intb_102 = iDV(ci)
				nc_intb_103 = iDmg(ci)
				nc_intb_104 = iAtk(ci)
				nc_intb_105 = iDice1(ci)
				nc_intb_106 = iDice2(ci)
				nc_intb_107 = iMaterial(ci)
				nc_intb_108 = iValue(ci)
				objlv = 0
				objfix = efp / 100
				randomize
				gosub *remake_material
				txt -1, lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
				if ( nc_intb_100 == 100 ) {
					transformsstat
					txtnew
					txt -1, lang("もう一度変化させる？", "Try again?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					valhinan = val
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval == 0 ) {
						if ( spell(506 - 400) == 0 ) {
							txt -1, lang("素材変化のストックがなくなったため、連続使用を中止した。", "There is no stock of Pooriation.")
							if ( equip != 0 ) {
								cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
								iEquip(ci) = equip
							}
							r1 = cc
							gosub *charaRefresh
							fixmaterial = ITEM_MATERIAL_SAND
							objfix = 0
							goto *effect_end
						}
						if ( 99 >= calcspellfail(506, CHARA_PLAYER) ) {
							msgdup++
							txt -1, lang("成功率が100%ではなくなったため、連続使用を中止した。", "The success rate was no longer 100%, so continuous use was discontinued.")
							if ( equip != 0 ) {
								cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
								iEquip(ci) = equip
							}
							r1 = cc
							gosub *charaRefresh
							fixmaterial = ITEM_MATERIAL_SAND
							objfix = 0
							goto *effect_end
						}
						spell(506 - 400) -= calcspellcoststock(505, CHARA_PLAYER)
						if ( spell(506 - 400) < 0 ) {
							spell(506 - 400) = 0
						}
						mp = calcspellcostmp(506, CHARA_PLAYER)
						if ( godcheck(0) == "ehekatl" ) {
							graceofgod = cPiety(CHARA_PLAYER) / 500
							if ( graceofgod > 40 ) {
								graceofgod = 40
							}
							mp = rnd(mp * (140 - graceofgod) / 100 + 1) + 1
						}
						nc_intb_001 = 0
						nc_intb_002 = 0
						nc_intb_003 = 0
						repeat 30, 100
							dup roopbuf, cdata(cnt, CHARA_PLAYER)
							if ( roopbuf \ 10000 == 0 ) {
								continue
							}
							nc_intb_002 = roopbuf \ 10000 - 1
							if ( inv(37, nc_intb_002) == 7 ) {
								nc_intb_001 += inv(38, nc_intb_002)
								continue
							}
							if ( inv(37, nc_intb_002) == 8 ) {
								nc_intb_003 += inv(38, nc_intb_002)
								continue
							}
						loop
						if ( nc_intb_001 > 0 ) {
							mp = mp * (100 - nc_intb_001) / 100
						}
						if ( nc_intb_003 > 0 ) {
							healamo = mp / 100 * nc_intb_003
							healhp CHARA_PLAYER, healamo
							if ( showdamagecheck(healamo) ) {
								if ( synccheck(tc, -1) ) {
									mondmgn(mondmgcnt) = "" + healamo
									mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, 0, 0
									ccolor 110
									if ( stat == 0 ) {
										mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
									}
									mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
								}
							}
						}
						if ( nc_gettrait(cc, 112) == 0 | rnd(4) ) {
							dmgmp CHARA_PLAYER, mp
						}
						if ( cExist(CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
							efsource = 0
							magiccritical = 0
							return 1
						}
						cc = ccbk
						r1 = cc
						r2 = spellbk
						gosub *label_1598
						goto *label_3516
					}
				}
			}
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		if ( equip != 0 ) {
			cdata(equip, cc) = cdata(equip, cc) / EXT_EQUIP_SLOTS * 10000 + ci + 1
			iEquip(ci) = equip
		}
		r1 = cc
		gosub *charaRefresh
		fixmaterial = ITEM_MATERIAL_SAND
		objfix = 0
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 507 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "のスタミナが回復した。", name(tc) + " restore" + _s(tc) + " stamina.")
		}
		healdmg = role(dice1, dice2, bonus)
		healsp tc, healdmg
		if ( showdamagecheck(healdmg) ) {
			if ( synccheck(tc, -1) ) {
				mondmgn(mondmgcnt) = "*" + healdmg + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		animeid = ANIMATION_HEAL
		gosub *anime
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 508 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "の空腹が癒えた。", name(tc) + " hunger was quenched.")
		}
		if ( cHunger(CHARA_PLAYER) < 15000 ) {
			cHunger(CHARA_PLAYER) = 15000
		}
		animeid = ANIMATION_HEAL
		gosub *anime
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 510 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "の状態異常が癒えた。", name(tc) + " malfunction was quenched.")
		}
		cPoison(tc) = 0
		cSleep(tc) = 0
		cConfuse(tc) = 0
		cBlind(tc) = 0
		if ( gettrait(tc, 195) != 0 ) {
			cBlind(tc) = 1000
		}
		cParalyze(tc) = 0
		cdata(268, tc) = 0
		cMochi(tc) = 0
		cDim(tc) = 0
		cDrunk(tc) = 0
		cBleed(tc) = 0
		cGravity(tc) = 0
		if ( have_bigench(tc, 11) == 0 ) {
			cdata(265, tc) = 0
			cSick(tc) = 0
		}
		animeid = ANIMATION_HEAL
		gosub *anime
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 511 | _switch_sw ) {
		_switch_sw = 0
		charastone cc, tc, efp
		goto *effect_end
		_switch_sw++
	}

	if ( _switch_val == 661 | _switch_sw ) {
		_switch_sw = 0
		cw = -1
		repeat 30
			body = 100 + cnt
			if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 10 ) {
				cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
			}
		loop
		if ( cw != (-1) ) {
			if ( iSkillRef(cw) == SKILL_WEAPON_FIREARM | nc_atk_loopf ) {
				gosub *label_3030
				if ( stat == (-1) ) {
					if ( cc == CHARA_PLAYER ) {
						msgdup++
						txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
					}
					return 0
				}
				if ( stat == (-2) ) {
					if ( cc == CHARA_PLAYER ) {
						msgdup++
						txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
					}
					return 0
				}
				if ( stat == (-3) ) {
					if ( cc == CHARA_PLAYER ) {
						msgdup++
						txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
					}
					return 0
				}
				txtef COLOR_BLUE
				ctalk cc, 963, cc, tc
				if ( stat == 0 ) {
					txtef COLOR_BLUE
					txt -1, lang("みだれうち！", "Rapid shot!")
				}
*label_3519
				p = 8
				if ( godcheck(cc) == "mani" ) {
					p += limit(sqrt(cPiety(cc)) / 100, 1, 10)
				}
				p = rnd(p) + 1
				if ( ogTitleJohnConnor == 2 & godcheck(cc) == "mani" ) {
					p = 8 + limit(sqrt(cPiety(cc)) / 100, 1, 10) + 1
				}
				repeat p
					listmax = 0
					repeat 229, 16
						if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
							continue
						}
						if ( synccheck(cnt, -1) == 0 ) {
							continue
						}
						if ( cRelation(cnt) >= RELATION_NEUTRAL ) {
							continue
						}
						x = cX(cnt)
						y = cY(cnt)
						if ( fov_los(cX(cc), cY(cc), x, y) == 0 ) {
							continue
						}
						if ( cbit(CHARA_BIT_INVISIBLE, cnt) == TRUE ) {
							if ( cbit(CHARA_BIT_SEE_INVISIBLE, cc) == FALSE ) {
								if ( cWet(cnt) == 0 ) {
									continue
								}
							}
						}
						list(0, listmax) = cnt
						listmax++
					loop
					if ( listmax == 0 ) {
						break
					}
					tc = list(0, rnd(listmax))
					gosub *act_fire
				loop
				if ( trophycheck(TROPHY_ANIMAL_HOSTILITY) == 2 & rnd(3) == 0 ) {
					txtef COLOR_BLUE
					txt -1, lang("もう一回！", "One more shot!")
					goto *label_3519
				}
				goto *effect_end
			}
		}
		cw = 0
		if ( cc == CHARA_PLAYER ) {
			msgdup++
			txt -1, lang("銃を装備していない。", "You need to equip a gun.")
		}
		return 0
	}
	if ( _switch_val == 662 | _switch_sw ) {
		_switch_sw = 0
		attack_weakguard
		if ( cc == CHARA_PLAYER ) {
			if ( tc != CHARA_PLAYER ) {
				if ( cRelation(tc) == RELATION_ALLY | cRole(tc) == ROLE_PET_SENTRY | cRole(tc) == ROLE_PET_MAID | eqfaction(tc, "petshop") ) {
					txt -1, lang("仲間は食べたくない。", "You don't want to eat your ally.")
					goto *effect_end
				}
				if ( ocbit(7, tc) ) {
					txt -1, lang("これは幻だ。", "Phantom cannot be eaten.")
					goto *effect_end
				}
			}
			if ( cHunger(cc) > 10000 | gettrait(cc, 191) < 0 ) {
				txt -1, lang("今はとても食べられない。", "Your are too full to eat."), lang("腹がさける…", "You are too bloated to eat any more."), lang("まだ腹は減っていない。", "Your stomach can't digest any more.")
				goto *effect_end
			}
		}
		else {
			txt -1, lang(name(tc) + "は" + name(cc) + "に食らい付かれた。", name(tc) + " is eaten by " + name(cc) + ".")
		}
		if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
			if ( cc == CHARA_PLAYER ) {
				txt -1, lang("吊るしたままでは食べられない。", "Target needs to be released before devouring.")
			}
			goto *effect_end
		}
		if ( tc == cc ) {
			if ( cc == CHARA_PLAYER ) {
				txt -1, lang(name(cc) + "は自分を食べようとした。", "You try to eat yourself.")
			}
			goto *effect_end
		}
		if ( cHP(tc) > cMHP(tc) / 8 ) {
			if ( cc == CHARA_PLAYER ) {
				txt -1, lang("もっと弱らせないと食べられない。", "The target needs to be weakened.")
			}
			else {
				txt -1, lang(name(tc) + "は抵抗した。", name(tc) + " resist" + _s(tc) + ".")
			}
			goto *effect_end
		}
		if ( synccheck(tc, -1) ) {
			snd SOUNDLIST_EAT1
			ctalk cc, 1347, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang(" *んがぐっぐ* ", "*Gash*")
			}
			ctalk tc, 1349, tc, cc
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				dmgType = 2
				txt3rd = 1
				txt -1, lang(name(cc) + "は" + name(tc) + "を食べて", name(cc) + " eats " + name(tc))
			}
			else {
				txt -1, lang(name(cc) + "は" + name(tc) + "を食べた。", name(cc) + " swallows " + name(tc) + " whole.")
			}
		}
		nodropbodyparts = 2
		dmghp tc, cMHP(tc) + 1, cc, SKILL_SPACT_DECAPITATION
		nodropbodyparts = 0
		if ( gettrait(cc, 45) == 0 ) {
			dmgsan cc, 15
			dmgcon cc, CONDITION_INSANE, 150
		}
		if ( gArea  != AREA_SHOW_HOUSE ) {
			dim fdlist, 2, 10
			repeat fdmax
				fdlist(0, cnt) = 0, 0
			loop
			fdmax = 0
			if ( fdmax < 10 ) {
				fdlist(0, fdmax) = 10, 30
				fdmax++
			}
			if ( fdmax < 10 ) {
				fdlist(0, fdmax) = 11, 40
				fdmax++
			}
			if ( fdmax < 10 ) {
				fdlist(0, fdmax) = 17, 10
				fdmax++
			}
			nutrition = 3500
			if ( cId(tc) == CREATURE_ID_MAMMOTH ) {
				ctalk cc, 1247, cc, cc
				if ( stat == 0 ) {
					txt cc, lang("「いただきマンモス」", cnvtalk("Let's eatammoth."))
				}
			}
			if ( cc == CHARA_PLAYER ) {
				s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
				if ( instr(s, 0, "/man/") != (-1) ) {
					ncgTotalHumanFleshEaten++
					if ( gettrait(0, 41) ) {
						ctalk cc, 1275, cc, cc
						if ( stat == 0 ) {
							txt -1, lang("ウマイ！", "Delicious!")
						}
						txt -1, lang("これはあなたの大好きな人肉だ！", "It's your favorite human flesh!")
					}
					else {
						if ( ogTitleHannibalLecter == 2 ) {
							txt -1, lang("これは人肉だ…が、あなたは特に気にならなかった。", "This is human flesh... however, you don't particularly mind the taste.")
						}
						else {
							txt -1, lang("これは人肉だ…うぇぇ！", "Eeeek! It's human flesh!")
							dmgsan cc, 15
							dmgcon cc, CONDITION_INSANE, 150
						}
						if ( gettrait(0, 41) == 0 ) {
							if ( rnd(5) == 0 ) {
								tid = TRAIT_NORMAL_OTHER_CANNIBALISM
								traitmode = 0
								r1 = 0
								gosub *trait_ref
								txtef COLOR_GREEN
								txt -1, traitrefn(0)
								settrait 0, 41, 1
							}
						}
					}
					ogTimesAteHumanFlesh++
					gosub *label_2665
				}
				else {
					if ( gettrait(0, 41) ) {
						txt -1, lang("人肉の方が好みだが…", "You would've rather eaten human flesh.")
						nutrition = nutrition * 2 / 3
					}
				}
			}
			dbmode = DBMODE_ON_EAT
			dbid = cId(tc)
			gosub *db_creature
			repeat fdmax
				i = 2000
				if ( cHunger(cc) >= 5000 ) {
					p = (cHunger(cc) - 5000) / 25
					i = i * 100 / (100 + p)
				}
				if ( cc != CHARA_PLAYER ) {
					i = 2000
				}
				if ( i > 0 ) {
					skillexp fdlist(0, cnt), cc, fdlist(1, cnt) * i / 100
				}
			loop
			if ( cnRace(tc) == "servant" ) {
				txtef COLOR_RED
				txt -1, lang("使徒を…食ってる…", "It's eating...the Angel...?")
				repeat 245
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( synccheck(cc, -1) ) {
						if ( cSync(cnt) != msync ) {
							continue
						}
					}
					else {
						if ( dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 3 ) {
							continue
						}
					}
					if ( cnt == cc ) {
						continue
					}
					if ( rnd(3) ) {
						continue
					}
					chara_vomit cnt
				loop
			}
			if ( cId(tc) == CREATURE_ID_WHOM_DWELL_IN_THE_VANITY ) {
				evadd EVENT_RAGNAROK, cc
			}
			if ( cId(tc) == CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN ) {
				txt -1, lang("ロイターの肩は最高だ。。", "Loyter's shoulder is the best.")
				skillexp SKILL_WEAPON_THROWING, cc, 500
			}
			if ( cId(tc) == CREATURE_ID_SHENA_THE_DRAW ) {
				txt -1, lang("シーナの尻は最高だ。", "Shena's ass is the best.")
			}
			if ( cId(tc) == CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE ) {
				txt cc, lang("「…本当に食べてしまったのか？」", "\"...err..you really ate that thing? Oh well..\"")
			}
			if ( cId(tc) == CREATURE_ID_KAMIKAZE_YEEK | cId(tc) == CREATURE_ID_KAMIKAZE_SAMURAI | cId(tc) == CREATURE_ID_BOMB_ROCK | cId(tc) == CREATURE_ID_HARD_GAY ) {
				tlocx = cX(cc)
				tlocy = cY(cc)
				efid = SKILL_SPACT_SUICIDE_ATTACK
				tcbk = tc
				gosub *label_3383
				tc = tcbk
			}
			if ( cId(tc) == CREATURE_ID_MUTANT ) {
				efid = SKILL_SPELL_MUTATION
				efp = 100
				tcbk = tc
				tc = cc
				gosub *label_3383
				tc = tcbk
			}
			if ( cId(tc) == CREATURE_ID_LITTLE_SISTER ) {
				if ( cRole(tc) != ROLE_ADVENTURER ) {
					txtef COLOR_GREEN
					txt -1, lang(name(cc) + "は進化した。", name(cc) + " evolve" + _s(cc) + ".")
					skillmod SKILL_ATTR_LIFE, cc, 1000
					skillmod SKILL_ATTR_MANA, cc, 1000
					repeat 400 - 100, 100
						if ( skillUse(cnt) == SKILL_NONE | sorg(cnt, cc) == 0 ) {
							continue
						}
						modgrowth2 cc, cnt, rnd(10) + 1
					loop
				}
			}
			if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) ) {
				txtef COLOR_GREEN
				txt -1, lang(cnName(tc) + "は腹の中で分裂した！", cnName(tc) + " split" + _s(tc) + " in " + name(cc) + your(cc) + " stomach!")
				nutrition *= 10
			}
			if ( cc == CHARA_PLAYER ) {
				if ( cId(tc) == CREATURE_ID_YOUNGER_SISTER | cId(tc) == CREATURE_ID_YOUNGER_SISTER2 ) {
					repeat 15
						if ( cfg_youngersistervoice != 0 & isyoungersistervoice != 0 ) {
							if ( rnd(2) == 0 ) {
								snd 150 + (cSex(CHARA_PLAYER) == 1)
							}
							await 100
						}
						txtef COLOR_TALK
						if ( jp ) {
							txt -1, "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃんー」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃん！」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃ〜ん」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃんっ」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃん？」", "「" + _onii(cSex(CHARA_PLAYER)) + "〜ちゃん」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃん♪」"
						}
						else {
							txt -1, "\"" + _onii(cSex(CHARA_PLAYER)) + "chan-\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan!\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chaa~n\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan?\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "~chan\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan♪\""
						}
					loop
				}
				if ( cId(tc) == CREATURE_ID_GWEN_THE_INNOCENT ) {
					modkarma 0, 5
				}
				p = cActHeal(tc)
				if ( p >= 400 & p < 600 ) {
					snd SOUNDLIST_DING2
					skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sMemorize(cc) + (sMemorize(cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
					txtef COLOR_GREEN
					txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", s + "You gain knowledge of a spell, " + skillname(p) + ".")
				}
				repeat 10
					p = cdata(STARTING_CDATA_ACT_MAIN + cnt, tc)
					if ( p >= 400 & p < 600 ) {
						snd SOUNDLIST_DING2
						skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sMemorize(cc) + (sMemorize(cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
						txtef COLOR_GREEN
						txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", "You gain knowledge of a spell, " + skillname(p) + ".")
					}
				loop
				repeat length(racenamecsv)
					if ( cnRace(tc) == racenamecsv(cnt, 1) ) {
						cnt2 = cnt
						repeat racespact(cnt2, 1)
							p = racespact(cnt2, 2 + cnt)
							if ( p >= 400 & p < 600 ) {
								snd SOUNDLIST_DING2
								skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sMemorize(cc) + (sMemorize(cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
								txtef COLOR_GREEN
								txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", "You gain knowledge of a spell, " + skillname(p) + ".")
							}
						loop
						break
					}
				loop
				repeat length(classnamecsv)
					if ( cnClass(tc) == classnamecsv(cnt, 1) ) {
						cnt2 = cnt
						repeat classspact(cnt2, 1)
							p = classspact(cnt2, 2 + cnt)
							if ( p >= 400 & p < 600 ) {
								snd SOUNDLIST_DING2
								skillgain cc, p, 1, (rnd(100 / 2 + 1) + 100 / 2) * (90 + sMemorize(cc) + (sMemorize(cc) > 0) * 20) / limit(100 + spell(p - 400) / 2, 50, 1000) * 10 + 1
								txtef COLOR_GREEN
								txt -1, lang(name(cc) + "は" + skillname(p) + "の魔法の知識を得た。", s + "you gain knowledge of a spell, " + skillname(p) + ".")
							}
						loop
						break
					}
				loop
			}
			if ( nutrition >= 3000 ) {
				if ( rnd(10) == 0 | cHunger(cc) >= 12000 ) {
					modweight cc, rnd(3) + 1, cHunger(cc) >= 12000
				}
			}
			cHunger(cc) += nutrition
			if ( cc == CHARA_PLAYER ) {
				gosub *eat_finish
			}
			ctalk cc, 1348, cc, tc
			chara_anorexia cc
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 761 | _switch_sw ) {
		_switch_sw = 0
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		animeload 11, cc
		if ( synccheck(cc, -1) ) {
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "の集中力が飛躍的に上昇した！", his(cc) + " mental acuity heightenes!")
			}
		}
		p = skillType(efid) \ 1000
		calcbuff CALCBUFF_DURATION, p, cPiety(cc)
		addbuff cc, p, cPiety(cc), dur
		r1 = cc
		gosub *charaRefresh
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 762 | _switch_sw ) {
		_switch_sw = 0
		cw = -1
		repeat 30
			body = 100 + cnt
			if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 10 ) {
				cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
			}
		loop
		if ( cw != (-1) ) {
			if ( iSkillRef(cw) == SKILL_WEAPON_BOW | iSkillRef(cw) == SKILL_WEAPON_CROSSBOW ) {
				if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
					cw = 0
					msgdup++
					txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
					return 0
				}
				gosub *label_3030
				if ( stat == (-1) ) {
					msgdup++
					txt -1, lang("射撃用の道具を装備していない。", "You need to equip a ranged weapon.")
					return 0
				}
				if ( stat == (-2) ) {
					msgdup++
					txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
					return 0
				}
				if ( stat == (-3) ) {
					msgdup++
					txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
					return 0
				}
				if ( gGodTalk ) {
					txtgod godcheck(), 15
				}
				txtef COLOR_BLUE
				ctalk cc, 962, cc, tc
				if ( stat == 0 ) {
					txtef COLOR_BLUE
					txt -1, lang("アローレイン！", "Arrow Rain!")
				}
				repeat 229, 16
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( synccheck(cnt, -1) == 0 ) {
						continue
					}
					if ( cRelation(cnt) >= RELATION_NEUTRAL ) {
						continue
					}
					x = cX(cnt)
					y = cY(cnt)
					if ( fov_los(cX(cc), cY(cc), x, y) == 0 ) {
						continue
					}
					if ( cbit(CHARA_BIT_INVISIBLE, cnt) == TRUE ) {
						if ( cbit(CHARA_BIT_SEE_INVISIBLE, cc) == FALSE ) {
							if ( cWet(cnt) == 0 ) {
								continue
							}
						}
					}
					tc = cnt
					animeid = ANIMATION_ATTACK
					gosub *anime
					gosub *act_fire
				loop
				gosub *label_4466
				goto *effect_end
			}
		}
		cw = 0
		msgdup++
		txt -1, lang("弓を装備していない。", "You need to equip a bow.")
		return 0
	}
	if ( _switch_val == 763 | _switch_sw ) {
		_switch_sw = 0
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		if ( synccheck(cc, -1) ) {
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txt -1, lang("豊穣祭の始まりだ！", "The Harvest Festival has begun!")
			}
		}
		p = skillType(efid) \ 1000
		r1 = cc
		gosub *label_4653
		repeat 245 - 1, 1
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cRelation(cnt) < RELATION_NEUTRAL ) {
				continue
			}
			if ( godcheck(cnt) != "kumiromi" ) {
				continue
			}
			if ( cPiety(cnt) < 50 ) {
				continue
			}
			r1 = cnt
			gosub *label_4653
			cPiety(cnt) = cPiety(cnt) * 55 / 100
		loop
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 764 | _switch_sw ) {
		_switch_sw = 0
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		ctalk cc, 962, cc, tc
		p = skillType(efid) \ 1000
		calcbuff CALCBUFF_DURATION, p, cPiety(cc)
		repeat 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			animeload 11, cnt
			if ( synccheck(cnt, -1) ) {
				txt -1, lang(name(cnt) + "は不思議な光に包まれた！", name(cnt) + " is enveloped in a mysterious aura of light!")
			}
			addbuff cnt, p, cPiety(cc), dur
		loop
		r1 = cc
		gosub *charaRefresh
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 765 | _switch_sw ) {
		_switch_sw = 0
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		animeload 11, cc
		if ( synccheck(cc, -1) ) {
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "にオパートスが乗り移った。", his(cc) + " soul has been overtaken by embodiment of Opatos.")
			}
		}
		p = skillType(efid) \ 1000
		calcbuff CALCBUFF_DURATION, p, cPiety(cc)
		addbuff cc, p, cPiety(cc), dur
		r1 = cc
		gosub *charaRefresh
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 766 | _switch_sw ) {
		_switch_sw = 0
		gosub *label_3023
		if ( stat == 0 ) {
			return 0
		}
		tc = ocHostileTarget1(0) - 1
		if ( cRelation(tc) >= RELATION_NEUTRAL ) {
			gosub *com_confirmAttack
			if ( stat == 0 ) {
				return 0
			}
		}
		cw = -1
		repeat 30
			body = 100 + cnt
			if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 10 ) {
				cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
			}
		loop
		if ( cw != (-1) ) {
			if ( iSkillRef(cw) == SKILL_WEAPON_FIREARM ) {
				if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
					cw = 0
					msgdup++
					txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
					return 0
				}
				gosub *label_3030
				if ( stat == (-1) ) {
					msgdup++
					txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
					return 0
				}
				if ( stat == (-2) ) {
					msgdup++
					txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
					return 0
				}
				if ( stat == (-3) ) {
					msgdup++
					txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
					return 0
				}
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) == (-1) ) {
					msgdup++
					txt -1, lang("特殊弾が装填されていない。", "You need to eqiup a special ammo.")
					return 0
				}
				if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) * 2, ammo) \ 1000 < 3 ) {
					msgdup++
					txt -1, lang("残弾が足りない。", "You do not have enough special ammo.")
					return 0
				}
				if ( gGodTalk ) {
					txtgod godcheck(), 15
				}
				txtef COLOR_BLUE
				ctalk cc, 962, cc, tc
				if ( stat == 0 ) {
					txtef COLOR_BLUE
					txt -1, lang("全弾発射！", "Full Burst!")
				}
				rounds = inv(STARTING_INV_ITEM_ENCHANT_POWER + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ammo) * 2, ammo) \ 1000 / 3
				repeat 3
					gosub *act_fire
				loop
				rounds = 0
				gosub *label_4466
				goto *effect_end
			}
		}
		cw = 0
		msgdup++
		txt -1, lang("銃を装備していない。", "You need to equip a gun.")
		return 0
	}
	if ( _switch_val == 767 | _switch_sw ) {
		_switch_sw = 0
		cw = find_eq(cc, 759)
		if ( cw != (-1) ) {
			if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if ( gGodTalk ) {
				txtgod godcheck(), 14
			}
			animeload 11, cc
			if ( synccheck(cc, -1) ) {
				ctalk cc, 962, cc, tc
				if ( stat == 0 ) {
					txt -1, lang(name(cc) + "のライトセーバーは眩く輝いた！", his(cc) + " lightsabre gleams brightly with blinding light!")
				}
			}
			p = skillType(efid) \ 1000
			calcbuff CALCBUFF_DURATION, p, cPiety(cc)
			addbuff cc, p, cPiety(cc), dur
			r1 = cc
			gosub *charaRefresh
			gosub *effect_end
			gosub *label_4466
			goto *effect_end
		}
		cw = 0
		msgdup++
		txt -1, lang("ライトセーバーを装備していない。", "You need to equip a lightsabre.")
		return 0
		_switch_sw++
	}
	if ( _switch_val == 768 | _switch_sw ) {
		_switch_sw = 0
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		animeload 11, cc
		if ( synccheck(cc, -1) ) {
			txtef COLOR_GREEN
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_GREEN
				txt -1, lang(name(cc) + "はエヘカトルに見守られている感じがした。", name(cc) + " feel" + _s(cc) + " as if Ehekatl was watching " + him(cc) + " intently.")
			}
		}
		p = skillType(efid) \ 1000
		r1 = cc
		gosub *label_4653
		repeat 245 - 1, 1
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cRelation(cnt) < RELATION_NEUTRAL ) {
				continue
			}
			if ( godcheck(cnt) != "ehekatl" ) {
				continue
			}
			if ( cPiety(cnt) < 50 ) {
				continue
			}
			r1 = cnt
			gosub *label_4653
			cPiety(cnt) = cPiety(cnt) * 55 / 100
		loop
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 769 | _switch_sw ) {
		_switch_sw = 0
		gosub *label_4468
		cw = stat
		if ( cw == (-1) ) {
			cw = 0
			msgdup++
			txt -1, lang("杖を装備していない。", "You need to equip a staff.")
			return 0
		}
		if ( ibit(ITEM_BIT_NO_DROP, cw) ) {
			txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
			return 0
		}
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		txtef COLOR_BLUE
		ctalk cc, 962, cc, tc
		if ( stat == 0 ) {
			txtef COLOR_BLUE
			txt -1, lang(name(cc) + "は" + itemname(cw) + "を破壊して魔力を放出した！", name(cc) + " destroy" + _s(cc) + " " + itemname(cw) + " and expels massive magical energy contained within!")
		}
		efp = 0
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw) == 0 ) {
				break
			}
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw) == 34 ) {
				if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) > (-1) ) {
					lint_efp = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) * cPiety(cc) * 3 / 10000
					efp = limitmax(lint_efp, 2147483647)
					break
				}
			}
		loop
		range = 2 + efp / 100
		repeat range * 2 + 1
			dy = cY(cc) - range + cnt
			if ( dy < 0 | dy >= mHeight ) {
				continue
			}
			repeat range * 2 + 1
				dx = cX(cc) - range + cnt
				if ( dx < 0 | dx >= mWidth ) {
					continue
				}
				if ( mapChara(dx, dy) == 0 ) {
					continue
				}
				tc = mapChara(dx, dy) - 1
				if ( dist(cX(tc), cY(tc), dx, dy) > range ) {
					continue
				}
				if ( fov_los(cX(tc), cY(tc), dx, dy) == 0 ) {
					continue
				}
				if ( relationbetween(cc, tc) >= (-1) ) {
					animeid = ANIMATION_HEAL_FAST
					gosub *anime
					if ( synccheck(tc, -1) ) {
						txt -1, lang(name(tc) + "のマナが回復した。", name(tc) + your(tc) + " mana is restored.")
					}
					healmp tc, efp
				}
			loop
		loop
		cdata(iEquip(cw), cc) = cdata(iEquip(cw), cc) / EXT_EQUIP_SLOTS * 10000
		iEquip(cw) = 0
		iNum(cw)--
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 770 | _switch_sw ) {
		_switch_sw = 0
		cw = find_eq(cc, 10005)
		if ( cw != (-1) ) {
			if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if ( gGodTalk ) {
				txtgod godcheck(), 15
			}
			txtef COLOR_BLUE
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang("大地の一撃！", "Earth strike!")
			}
			animeid = 23
			gosub *anime
			dice1 = cPiety(cc) * 3 / 2000
			dice2 = sSTR(CHARA_PLAYER)
			repeat mHeight
				dy = cnt
				repeat mWidth
					dx = cnt
					if ( mapChara(dx, dy) != 0 ) {
						tc = mapChara(dx, dy) - 1
						attack_weakguard
						if ( tc == cc ) {
							continue
						}
						dmg = role(dice1, dice2)
						dmghp tc, dmg, cc
					}
				loop
			loop
			gosub *label_4466
			goto *effect_end
			_switch_sw++
		}
		cw = 0
		msgdup++
		txt -1, lang("大槌を装備していない。", "You need to equip a blunt.")
		return 0
	}
	if ( _switch_val == 771 | _switch_sw ) {
		_switch_sw = 0
		cw = find_eq(cc, 10007)
		if ( cw != (-1) ) {
			if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			tc = CHARA_PLAYER
			txt -1, lang("どの方向？", "Which direction?")
			gosub *prompt_direction
			tc = mapChara(tlocx, tlocy) - 1
			if ( stat == 0 | tc <= CHARA_PLAYER ) {
				txt -1, lang("それは無理だ。", "It's impossible.")
				return 0
			}
			if ( gGodTalk ) {
				txtgod godcheck(), 15
			}
			txtef COLOR_BLUE
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang("聖者の怒り！", "Saint's Wrath!")
			}
			multicritical = 1
			lockon 0, tc, 14
			if ( cbit(CHARA_BIT_INVISIBLE, tc) == TRUE ) {
				if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == FALSE ) {
					if ( cWet(tc) == 0 ) {
						unlockson 0
					}
				}
			}
			if ( keybd_attacking == 0 ) {
				keybd_wait = 1
				keybd_attacking = 1
			}
			gosub *label_3640
			gosub *label_4714
			gosub *label_4466
			goto *effect_end
			_switch_sw++
		}
		cw = 0
		msgdup++
		txt -1, lang("槍を装備していない。", "You need to equip a polearm.")
		return 0
	}
	if ( _switch_val == 772 | _switch_sw ) {
		_switch_sw = 0
		gosub *label_4469
		cw = stat
		if ( cw != (-1) ) {
			if ( ibit(ITEM_BIT_NO_DROP, cw) ) {
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				return 0
			}
			if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if ( gGodTalk ) {
				txtgod godcheck(), 15
			}
			txtef COLOR_BLUE
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang(name(cc) + "は" + itemname(cw) + "の魔力を臨界まで高めて解き放った！", name(cc) + " muster" + _s(cc) + " massive magical energy for " + itemname(cw) + " to its limits and releases!")
			}
			animeid = ANIMATION_HOLY
			animode = 100
			gosub *anime
			snd SOUNDLIST_PRAY2
			listmax = 0
			repeat 15
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw) == 0 ) {
					break
				}
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw) / 10000 == 7 ) {
					if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) > (-1) ) {
						list(0, listmax) = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw) \ 10000, (inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cw) + sMAG(cc) * 10) * (cPiety(cc) / 2000)
						listmax++
					}
				}
			loop
			repeat 245
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				x = cX(cnt)
				y = cY(cnt)
				if ( mapChara(x, y) == 0 ) {
					continue
				}
				tc = cnt
				attack_weakguard
				repeat listmax
					dmg = list(1, cnt)
					calcmagiccontrol cc, tc
					if ( stat == 1 ) {
						continue
					}
					dmghp tc, dmg, cc, list(0, cnt), 1000
				loop
			loop
			txtef COLOR_RED
			txt -1, lang(itemname(cw) + "は壊れた……", itemname(cw) + " turns to dust...")
			cdata(iEquip(cw), cc) = cdata(iEquip(cw), cc) / EXT_EQUIP_SLOTS * 10000
			iEquip(cw) = 0
			iNum(cw)--
			gosub *label_4466
			goto *effect_end
		}
		cw = 0
		msgdup++
		txt -1, lang("杖を装備していない。", "You need to equip a staff.")
		return 0
	}
	if ( _switch_val == 773 | _switch_sw ) {
		_switch_sw = 0
		cw = find_eq(cc, 10011)
		if ( cw != (-1) ) {
			if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if ( gGodTalk ) {
				txtgod godcheck(), 15
			}
			txtef COLOR_BLUE
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang("魂の収穫！", "Soul Harvest!")
			}
			multicritical = 1
			efp = limit(encfind(cc, 80025) / 200, 1, 5)
			se_range = 3
			repeat se_range * 2 + 1
				se_dy = cY(cc) - se_range + cnt
				if ( se_dy < 0 | se_dy >= mHeight ) {
					continue
				}
				repeat se_range * 2 + 1
					se_dx = cX(cc) - se_range + cnt
					if ( se_dx < 0 | se_dx >= mWidth ) {
						continue
					}
					if ( mapChara(se_dx, se_dy) == 0 ) {
						continue
					}
					tc = mapChara(se_dx, se_dy) - 1
					attack_weakguard
					if ( dist(cX(tc), cY(tc), se_dx, se_dy) > se_range ) {
						continue
					}
					if ( fov_los(cX(tc), cY(tc), se_dx, se_dy) == 0 ) {
						continue
					}
					if ( cRelation(cc) == cRelation(tc) ) {
						continue
					}
					efid = 773
					gosub *label_3640
					gosub *label_4714
					if ( cHP(tc) > cMHP(tc) * efp / 8 ) {
						continue
					}
					if ( synccheck(tc, -1) ) {
						snd SOUNDLIST_ATKSWORD
						ctalk cc, 1295, tc, cc
						txtef COLOR_RED
						txt -1, lang(" *ブシュッ* ", "*Gash*")
						if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
							dmgType = 2
							txt3rd = 1
							txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
						}
						else {
							txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
						}
					}
					dmghp tc, cMHP(tc), cc, SKILL_SPACT_DECAPITATION
					gosub *effect_end
				loop
			loop
			gosub *label_4466
			goto *effect_end
		}
		cw = 0
		msgdup++
		txt -1, lang("鎌を装備していない。", "You need to equip a scythe.")
		return 0
	}
	if ( _switch_val == 774 | _switch_sw ) {
		_switch_sw = 0
		if ( gGodTalk ) {
			txtgod godcheck(), 15
		}
		if ( synccheck(cc, -1) ) {
			txtef COLOR_GREEN
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_GREEN
				txt -1, lang("どこかでダイスを転がす音が聞こえたような気がした。", "You think you just heard a dice being rolled across a surface somewhere.")
			}
		}
		p = -1
		if ( rnd(20) ) {
			animeid = ANIMATION_HOLY
			animode = 100 + cc
			gosub *anime
			snd SOUNDLIST_PRAY2
			p = 86 + rnd(5)
		}
		else {
			snd SOUNDLIST_CURSE3
			animeload 14, cc
			p = 91 + rnd(4)
		}
		calcbuff CALCBUFF_DURATION, p, cPiety(cc)
		addbuff cc, p, cPiety(cc), dur
		r1 = cc
		gosub *charaRefresh
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 775 | _switch_sw ) {
		_switch_sw = 0
		p(98) = skillType(efid) \ 1000
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		animeload 8, cc
		if ( synccheck(cc, -1) ) {
			txtef COLOR_GREEN
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_GREEN
				txt -1, lang(name(cc) + "は分身した！", name(cc) + " split" + _s(cc) + "!")
			}
		}
		repeat 7
			flt
			fixlv = FIX_QUALITY_GODLY
			ally = 1
			characreate -1, -2, cX(cc), cY(cc)
			cRelation(rc) = RELATION_ALLY
			cOrgRelation(rc) = RELATION_ALLY
			calcbuff CALCBUFF_DURATION, p(98), cPiety(cc)
			addbuff rc, p(98), cPiety(cc), dur
		loop
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 776 | _switch_sw ) {
		_switch_sw = 0
		p(98) = skillType(efid) \ 1000
		cw = find_eq(cc, 10003)
		if ( cw != (-1) ) {
			if ( iQuality(cw) < FIX_QUALITY_GODLY ) {
				cw = 0
				msgdup++
				txt -1, lang("神器を装備していない。", "You need to equip a godly weapon.")
				return 0
			}
			if ( gGodTalk ) {
				txtgod godcheck(), 15
			}
			snd SOUNDLIST_ATK_ELEC
			animeload 15, cc
			if ( synccheck(cc, -1) ) {
				ctalk cc, 962, cc, tc
				if ( stat == 0 ) {
					txt -1, lang(name(cc) + "の剣は雷を帯びた！", his(cc) + " sword is wrapped in lightning!")
				}
			}
			calcbuff CALCBUFF_DURATION, p(98), cPiety(cc)
			addbuff cc, p(98), cPiety(cc), dur
			r1 = tc
			gosub *charaRefresh
			gosub *effect_end
			gosub *label_4466
			goto *effect_end
		}
		cw = 0
		msgdup++
		txt -1, lang("短剣を装備していない。", "You need to equip a short sword.")
		return 0
	}
	if ( _switch_val == 777 | _switch_sw ) {
		_switch_sw = 0
		ci = -1
		inv_getheader cc
		repeat invrange, invhead
			if ( iNum(cnt) <= 0 ) {
				continue
			}
			if ( iID(cnt) != ITEM_ID_ANCIENT_BOOK ) {
				continue
			}
			if ( iParam1(cnt) < 10 ) {
				continue
			}
			if ( iParam2(cnt) == 0 ) {
				continue
			}
			ci = cnt
			break
		loop
		if ( ci != (-1) ) {
			if ( gGodTalk ) {
				txtgod godcheck(), 15
			}
			txtef COLOR_BLUE
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang("荒れ狂う水が津波を巻き起こした！", "Violent waves suddenly stirs from still water engulfing those standing in a massive tsunami!")
			}
			repeat mHeight
				dy = cnt
				repeat mWidth
					dx = cnt
					if ( mapChara(dx, dy) != 0 ) {
						if ( chipm(CHIPM_ROLE, mapId(dx, dy)) == MAP_CHIP_ROLE_WATER ) {
							tc = mapChara(dx, dy) - 1
							attack_weakguard
							dmg = int(limitf(sMAG(cc) * cPiety(cc) / 2000, 1, 20000000))
							dmghp tc, dmg, cc, SKILL_RES_COLD, 1000
						}
					}
				loop
			loop
			gosub *label_4466
			goto *effect_end
		}
		ci = 0
		msgdup++
		txt -1, lang("古書物を持っていない。", "You need an ancient book.")
		return 0
	}
	if ( _switch_val == 778 | _switch_sw ) {
		_switch_sw = 0
		p(98) = skillType(efid) \ 1000
		if ( gGodTalk ) {
			txtgod godcheck(), 14
		}
		snd SOUNDLIST_CURSE3
		animeload 14, cc
		if ( synccheck(cc, -1) ) {
			ctalk cc, 962, cc, tc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "の体は深きものに近づいた……。", his(cc) + " body transfigures ever closer to that of the Deep One...")
			}
		}
		calcbuff CALCBUFF_DURATION, p(98), cPiety(cc)
		addbuff cc, p(98), cPiety(cc), dur
		r1 = cc
		gosub *charaRefresh
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 783 | _switch_sw ) {
		_switch_sw = 0
		repeat 1 + rnd(3)
			flt cLevel(cc), FIX_QUALITY_BAD
			fltnrace = cnRace(cc)
			characreate -1, CREATURE_ID_BUG, cX(cc), cY(cc)
			if ( stat != 0 ) {
				resetfaction rc
				if ( relationbetween(rc, cc) == 10 ) {
					addfaction rc, "pet," + cc
					ocAIDistance(rc) = 1
					ocAIStrategy(rc) = AI_STRATEGY_DEFEND_ME
				}
			}
		loop
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は護衛を召喚した。", "Several guards come out from a portal.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 784 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_SKY_BLUE
		txt -1, lang(name(cc) + "は大声で悲鳴をあげた。", name(cc) + " scream" + _s(cc) + " loudly.")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		if ( ocHostileTargetTotal(cc) ) {
			tc = ocHostileTarget1(cc) - 1
			repeat 245
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( dist(cX(cnt), cY(cnt), cX(cc), cY(cc)) > 10 ) {
					continue
				}
				if ( relationbetween(cc, cnt) != 10 ) {
					continue
				}
				turn_aggro cnt, tc, 80
			loop
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 786 | _switch_sw ) {
		_switch_sw = 0
		if ( cUNID(cc) == usernpcmax ) {
			return 0
		}
		repeat 1 + rnd(3)
			flt cLevel(cc), FIX_QUALITY_GOOD
			fltselect = 2
			noencpfix = 1
			nc_skipflag = 1
			characreate -1, CREATURE_ID_BUG, cX(tc), cY(tc)
			if ( stat != 0 ) {
				if ( cId(cc) == cId(rc) ) {
					f = 1
					if ( cId(cc) == CREATURE_ID_USER ) {
						if ( cUNID(rc) != cUNID(cc) ) {
							f = 0
						}
					}
					if ( f ) {
						chara_vanquish rc
						continue cnt
					}
				}
				resetfaction rc
				if ( relationbetween(rc, cc) == 10 ) {
					addfaction rc, "pet," + cc
					ocAIDistance(rc) = 1
					ocAIStrategy(rc) = AI_STRATEGY_DEFEND_ME
				}
			}
		loop
		if ( synccheck(cc, -1) ) {
			txt -1, lang("魔法でモンスターが召喚された。", "Several monsters come out from a portal.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 787 | _switch_sw ) {
		_switch_sw = 0
		p(67) = 0
		if ( getfactionvalue(cc, "pet") != "" ) {
			if ( rnd(3) == 0 ) {
				p(67) = 1
			}
		}
		else {
			p(67) = 1 + rnd(3)
		}
		repeat p(67)
			flt
			dbid = cId(cc)
			if ( dbid == 343 ) {
				initunid = cUNID(cc) + 1
			}
			noencpfix = 1
			noenchant = 1
			mode = MODELIST_CHARA_CREATION
			characreate -1, dbid, cX(tc), cY(tc)
			mode = MODELIST_MAIN
			if ( stat ) {
				if ( cId(rc) != cId(cc) | cUNID(rc) != cUNID(cc) ) {
					chara_vanquish rc
					continue
				}
				resetfaction rc
				addfaction rc, "pet," + cc
			}
		loop
		if ( synccheck(cc, -1) ) {
			txt -1, lang(name(cc) + "は仲間を喚んだ。", name(cc) + " call" + _s(cc) + " to allies for help.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 790 | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "のスタミナが完全に回復した。", name(tc) + " completely restore" + _s(tc) + " all stamina.")
		}
		healsp tc, cMSP(tc)
		if ( showdamagecheck(cMSP(tc)) ) {
			if ( synccheck(tc, -1) ) {
				mondmgn(mondmgcnt) = "*" + cMSP(tc) + "*"
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc, cc
				ccolor 110
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 0, 255, 255, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
		ocbitmod 10, tc, 0
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 791 | _switch_sw ) {
		_switch_sw = 0
		if ( sPerform(cc) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == CHARA_PLAYER) + "n't know how to sing.")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(183) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(183) / 2 + 1) + skillCost(183) / 2 + 1
		}
		cRowAct(cc) = 10006
		cActionPeriod(cc) = 61
		cPerformScore(cc) = 40
		cPerformGold(cc) = 0
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		if ( cc == CHARA_PLAYER ) {
			performtips = 0
			repeat 15, 1
				cnt2 = cnt
				if ( cExist(cnt2) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( synccheck(cnt2, -1) == 0 ) {
					continue
				}
				if ( cRowAct(cnt2) != ACTION_NONE ) {
					continue
				}
				if ( sPerform(cnt2) == 0 ) {
					continue
				}
				f = 0
				if ( cAiCalm(cnt2) == 5 ) {
					cnpcrole = 0
					if ( cId(cnt2) == CREATURE_ID_USER ) {
						if ( userdata2(5, cUNID(cnt2)) ) {
							cnpcrole = userdata2(5, cUNID(cnt2))
						}
					}
					if ( cId(cnt2) == CREATURE_ID_BARD | cnpcrole == 1 ) {
						if ( ocAISpecialAction1(cnt2) != 0 ) {
							continue
						}
						inv_getheader cnt2
						repeat invrange, invhead
							if ( iNum(cnt) == 0 ) {
								continue
							}
							if ( iSkillRef(cnt) == SKILL_NORMAL_PERFORMER ) {
								ci = cnt
								f = 1
								break
							}
						loop
					}
				}
				else {
					if ( ocAISinging(cnt2) != 0 ) {
						continue
					}
				}
				if ( f ) {
					txt -1, lang(name(cnt2) + "は" + name(cc) + "に合わせて" + itemname(ci) + "の演奏をはじめた。", name(cnt2) + " start" + _s(cnt2) + " to play " + itemname(ci) + ".")
					cRowAct(cnt2) = 20006
					cItemUsing(cnt2) = ci
				}
				else {
					txt -1, lang(name(cnt2) + "は" + name(cc) + "に合わせて歌いはじめた。", name(cnt2) + " joins the troupe with " + name(cc) + " and start" + _s(cnt2) + " singing.")
					cRowAct(cnt2) = 10006
				}
				cActionPeriod(cnt2) = 61
				cPerformScore(cnt2) = 40
				cPerformGold(cnt2) = 0
			loop
		}
		gosub *label_3295
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 791 | _switch_sw ) {
		_switch_sw = 0
		if ( sPerform(cc) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang(name(cc) + "は歌唱のやり方を知らない。", name(cc) + " " + does(cc == CHARA_PLAYER) + "n't know how to sing.")
				return 0
			}
		}
		if ( cc == CHARA_PLAYER ) {
			if ( cSP(CHARA_PLAYER) < 50 ) {
				if ( cSP(CHARA_PLAYER) < rnd(75) ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					dmgsp CHARA_PLAYER, skillCost(183) / 2 + 1
					goto *effect_end
				}
			}
			dmgsp CHARA_PLAYER, rnd(skillCost(183) / 2 + 1) + skillCost(183) / 2 + 1
		}
		cRowAct(cc) = 10006
		cActionPeriod(cc) = 61
		cPerformScore(cc) = 40
		cPerformGold(cc) = 0
		txt -1, lang(name(cc) + "は歌いはじめた。", name(cc) + " begin" + _s(cc) + " singing.")
		gosub *label_3295
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 793 | _switch_sw ) {
		_switch_sw = 0
		cc = tc
		if ( cc == CHARA_PLAYER ) {
			txt -1, lang("何もおきない… ", "Nothing happens...")
			obvious = 0
			goto *effect_end
		}
		f = 1
		if ( cItemUsing(cc) != 0 | cc == gRider | cbit(CHARA_BIT_SANDBAG, cc) | ocPetBeingRiddenIdx(cc) != 0 ) {
			f = 0
		}
		if ( f ) {
			animeload 8, cc
			metamorphosis cc
			rcref = stat
			if ( rcref != (-1) ) {
				cItemUsing(cc) = cPic(cc)
				cpicref = 0
				dbid = rcref
				dbmode = DBMODE_REF
				gosub *db_creature
				cPic(cc) = cpicref
				txt -1, lang(name(cc) + "は" + refchara(rcref, DBSPEC_CHARA_NAME_ORG, 1) + "に変化した。", name(cc) + " change" + _s(cc) + " to " + refchara(rcref, DBSPEC_CHARA_NAME_ORG, 1) + ".")
			}
		}
		else {
			txt -1, lang(name(cc) + "は変化できない。", name(cc) + " cannot be changed.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 3001 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_BLUE
		txt -1, lang("魔法で津波が召喚された！", "Using magic, a tsunami is summoned and submerges the region!")
		repeat mHeight
			dy = cnt
			repeat mWidth
				dx = cnt
				if ( rnd(3) == 0 ) {
					mapId(dx, dy) = xy2pic(0, 5)
				}
			loop
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 3002 | _switch_sw ) {
		_switch_sw = 0
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		snd SOUNDLIST_DING2
		flt cLevel(CHARA_PLAYER) / 2 + 5
		itemcreate -1, ITEM_ID_ANCIENT_BOOK, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + ".")
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 3003 | _switch_sw ) {
		_switch_sw = 0
		txt -1, lang(itemname(ci, 1) + "を始動させた。", "You activate " + itemname(ci, 1) + ".")
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		if ( gWeather == WEATHER_ETHER ) {
			txt -1, lang("セリア「……残念だけど、この風は僕の手では止められないんだ」", "A calm voice echoes, " + cnvtalk("Unfortunately, I can't stop the ethereal wind."))
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			goto *act_use_SWEND1
		}
		if ( gWeather == WEATHER_CLEAR ) {
			txt -1, lang("セリア「……今はまだ僕の出番じゃないみたいだね」", "A calm voice echoes, " + cnvtalk("well, It's not the turn yet."))
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			goto *act_use_SWEND1
		}
		preweather = gWeather
		gWeather = WEATHER_CLEAR
		txt -1, lang("セリア「大丈夫、僕が必ず旅路を導くから」", "A calm voice echoes, " + cnvtalk("Leave it to me."))
		txt -1, lang("天候が変わった。", "The weather changes.")
		throwsstpevent "WeatherChanged", 0, _weather(preweather), 0
		envonly = 1
		gosub *music_play
		goto *act_use_SWEND1
	}
	if ( _switch_val == 3004 | _switch_sw ) {
		_switch_sw = 0
		if ( iValue(ci) == 0 ) {
			txt -1, lang("宝玉の中には金貨が入っていない。いくら入れる？", "There are no gold coins inside the jewel. How much do you want?")
			promptmax = 0
			if ( cGold(CHARA_PLAYER) >= 1000 | ncgGoldOverflow > 0 ) {
				promptl(0, promptmax) = "1000GP", key_select(promptmax), "0"
				promptmax++
			}
			if ( cGold(CHARA_PLAYER) >= 10000 | ncgGoldOverflow > 0 ) {
				promptl(0, promptmax) = "10000GP", key_select(promptmax), "1"
				promptmax++
			}
			if ( cGold(CHARA_PLAYER) >= 100000 | ncgGoldOverflow > 0 ) {
				promptl(0, promptmax) = "100000GP", key_select(promptmax), "2"
				promptmax++
			}
			if ( cGold(CHARA_PLAYER) >= 1000000 | ncgGoldOverflow > 0 ) {
				promptl(0, promptmax) = "1000000GP", key_select(promptmax), "3"
				promptmax++
			}
			promptl(0, promptmax) = lang("今は入れない", "Not now."), key_select(promptmax), "4"
			promptmax++
			val = promptx, prompty, 180, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				snd SOUNDLIST_PAYGOLD1
				cGold(CHARA_PLAYER) -= 1000
				gosub *label_0422
				iValue(ci) = 1000
				txt -1, lang("1000枚の金貨を入れた。", "put in 1000GP.")
				txtef COLOR_YELLOW
				txt -1, lang("クルーラ「……にゃあ？これだけかにゃ〜？……一応やってみるけど、あんまり期待しないでほしいにゃあ」", "A calm voice echoes, " + cnvtalk("mew...That's it? I'll give it a shot, but... don't get your hopes up too high."))
				goto *effect_end
			}
			if ( rtval == 1 ) {
				snd SOUNDLIST_PAYGOLD1
				cGold(CHARA_PLAYER) -= 10000
				gosub *label_0422
				iValue(ci) = 10000
				txt -1, lang("10000枚の金貨を入れた。", "put in 10000GP.")
				txtef COLOR_YELLOW
				txt -1, lang("クルーラ「……にゃあ、そこそこかにゃあ、とりあえずやってみるにゃあ」", "A calm voice echoes, " + cnvtalk("mew...OK, let's do it."))
				goto *effect_end
			}
			if ( rtval == 2 ) {
				snd SOUNDLIST_PAYGOLD1
				cGold(CHARA_PLAYER) -= 100000
				gosub *label_0422
				iValue(ci) = 100000
				txt -1, lang("100000枚の金貨を入れた。", "put in 100000GP.")
				txtef COLOR_YELLOW
				txt -1, lang("クルーラ「にゃふぅ、いい感じの額だにゃあ、そこそこ期待してほしいにゃあ」", "A calm voice echoes, " + cnvtalk("mew...OK, you can count on it."))
				goto *effect_end
			}
			if ( rtval == 3 ) {
				snd SOUNDLIST_PAYGOLD1
				cGold(CHARA_PLAYER) -= 1000000
				gosub *label_0422
				iValue(ci) = 1000000
				txt -1, lang("1000000枚の金貨を入れた。", "put in 1000000GP.")
				txtef COLOR_YELLOW
				txt -1, lang("クルーラ「にゃははは！いいにゃあ、ふとっぱらだにゃあ！期待して待っているといいにゃあ！」", "A calm voice echoes, " + cnvtalk("mew! So many gold coins! I'll have to live up to your expectations. mewmewmew!"))
				goto *effect_end
			}
			txt -1, lang("クルーラ「……にゃあ？」", "A calm voice echoes, " + cnvtalk("mew...?"))
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			goto *effect_end
		}
		else {
			dim nc_crula_itemshaffle, 3
			nc_crula_itemshaffle = 287, 287, 287
			nc_crula_itemcount = 0
			if ( iValue(ci) == 1000 ) {
				nc_crula_itemshaffle = 635, 620, 621
				nc_crula_itemcount = 1 + rnd(2)
			}
			if ( iValue(ci) == 10000 ) {
				nc_crula_itemshaffle = 640, 621, 626
				nc_crula_itemcount = 1 + rnd(2)
			}
			if ( iValue(ci) == 100000 ) {
				if ( rnd(2) ) {
					nc_crula_itemshaffle = 621, 626, 655
				}
				else {
					nc_crula_itemshaffle = 621, 626, 662
				}
				nc_crula_itemcount = 1 + rnd(3)
			}
			if ( iValue(ci) == 1000000 ) {
				if ( rnd(2) ) {
					nc_crula_itemshaffle = 621, 626, 290
				}
				else {
					if ( rnd(2) ) {
						nc_crula_itemshaffle = 621, 655, 290
					}
					else {
						nc_crula_itemshaffle = 621, 662, 290
					}
				}
				nc_crula_itemcount = 2 + rnd(2)
			}
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			iValue(ci) = 0
			snd SOUNDLIST_PRAY1
			txtef COLOR_YELLOW
			txt -1, lang("クルーラ「にゃはは、これでどーかにゃ？」", "A calm voice echoes, " + cnvtalk("mew...How about this?"))
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
			nc_intb_001 = rnd(10)
			flt
			if ( nc_intb_001 == 0 ) {
				itemcreate -1, nc_crula_itemshaffle(2), cX(CHARA_PLAYER), cY(CHARA_PLAYER), nc_crula_itemcount
			}
			else {
				if ( nc_intb_001 <= 3 ) {
					itemcreate -1, nc_crula_itemshaffle(1), cX(CHARA_PLAYER), cY(CHARA_PLAYER), nc_crula_itemcount
				}
				else {
					itemcreate -1, nc_crula_itemshaffle(0), cX(CHARA_PLAYER), cY(CHARA_PLAYER), nc_crula_itemcount
				}
			}
			autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
			if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
				autosave = 0
			}
			txt -1, lang("宝玉の中身は再び空っぽになった。", "The jewel was empty again.")
		}
		goto *effect_end
	}
	if ( _switch_val == 785 | _switch_sw ) {
		_switch_sw = 0
		get_route cX(cc), cY(cc), tlocx, tlocy
		if ( stat == 0 ) {
			goto *effect_end
		}
		animeid = ANIMATION_BOLT
		gosub *anime
		dx = cX(cc)
		dy = cY(cc)
		repeat 20
			route_info dx, dy, cnt
			if ( stat == 0 ) {
				break
			}
			else {
				if ( stat == (-1) ) {
					continue
				}
			}
			if ( dist(dx, dy, cX(cc), cY(cc)) > skillTg(efid) \ 1000 + 1 ) {
				break
			}
			if ( dx == cX(cc) & dy == cY(cc) ) {
				continue
			}
			if ( mapChara(dx, dy) != 0 ) {
				tc = mapChara(dx, dy) - 1
				attack_weakguard
				if ( cc != tc ) {
					if ( tc >= MAX_CHARA_NC & petcheck(tc) == 0 ) {
						if ( synccheck(tc, -1) ) {
							txt -1, lang(name(tc) + "は巻き込みを免れた。", "The spell passes through " + name(tc) + ".")
						}
					}
					else {
						if ( synccheck(tc, -1) ) {
							txt -1, lang("波動砲が" + name(tc) + "に命中した。", "The wave motion gun hits " + name(tc) + ".")
						}
						dmghp tc, cMHP(tc) / 2, cc
					}
				}
			}
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 794 | _switch_sw ) {
		_switch_sw = 0
		p(98) = skillType(_switch_val) \ 1000
		animeload 11, cc
		calcbuff CALCBUFF_DURATION, p(98), 15
		addbuff cc, p(98), 15, dur
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 903 | _switch_sw ) {
		_switch_sw = 0
		se_range = 2
		repeat se_range * 2 + 1
			se_dy = cY(cc) - se_range + cnt
			if ( se_dy < 0 | se_dy >= mHeight ) {
				continue
			}
			repeat se_range * 2 + 1
				se_dx = cX(cc) - se_range + cnt
				if ( se_dx < 0 | se_dx >= mWidth ) {
					continue
				}
				if ( mapChara(se_dx, se_dy) == 0 ) {
					continue
				}
				tc = mapChara(se_dx, se_dy) - 1
				attack_weakguard
				if ( relationbetween(cc, tc) != (-3) ) {
					continue
				}
				if ( dist(cX(tc), cY(tc), se_dx, se_dy) > se_range ) {
					continue
				}
				if ( fov_los(cX(tc), cY(tc), se_dx, se_dy) == 0 ) {
					continue
				}
				if ( cRelation(cc) == cRelation(tc) ) {
					continue
				}
				efid = 903
				gosub *label_3640
				gosub *label_4714
				if ( cHP(tc) > cMHP(tc) / 2 ) {
					continue
				}
				if ( synccheck(tc, -1) ) {
					snd SOUNDLIST_ATKSWORD
					ctalk cc, 1295, tc, cc
					txtef COLOR_RED
					txt -1, lang(" *ブシュッ* ", "*Gash*")
					if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 & cfg_dmgtxttype == 0 ) {
						dmgType = 2
						txt3rd = 1
						txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎり", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head and")
					}
					else {
						txt -1, lang(name(cc) + "は" + name(tc) + "の首をちょんぎった。", name(cc) + " cut" + _s(cc) + " " + name(tc) + your(tc) + " head.")
					}
				}
				dmghp tc, cMHP(tc) + 1, cc, SKILL_SPACT_DECAPITATION
				gosub *effect_end
			loop
		loop
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 907 | _switch_sw ) {
		_switch_sw = 0
		if ( cUNID(cc) == usernpcmax ) {
			return 0
		}
		dbid = 0
		if ( cId(cc) != CREATURE_ID_USER ) {
			if ( cId(cc) == CREATURE_ID_LULWY ) {
				dbid = 263
			}
			if ( cId(cc) == CREATURE_ID_EHEKATL ) {
				dbid = 260
			}
			if ( cId(cc) == CREATURE_ID_OPATOS ) {
				dbid = 265
			}
			if ( cId(cc) == CREATURE_ID_KUMIROMI ) {
				dbid = 261
			}
			if ( cId(cc) == CREATURE_ID_MANI ) {
				dbid = 262
			}
			if ( cId(cc) == CREATURE_ID_JURE ) {
				dbid = 266
			}
			if ( cId(cc) == CREATURE_ID_ITZPALT ) {
				dbid = 264
			}
		}
		else {
			repeat usergodmax
				if ( cUNID(cc) == findunid(usergoddatan(10, cnt)) - 1 ) {
					dbid = 343
					initunid_tmp = findunid(usergoddatan(7, cnt))
					break
				}
			loop
		}
		if ( dbid == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang("何もおきない… ", "Nothing happens...")
			}
			goto *effect_end
		}
		locvar_getnpctxt_ragnarokflag = 1
		repeat 1 + rnd(5)
			flt 100, calcfixlv(FIX_QUALITY_GREAT)
			initlv = cLevel(cc) * 2 / 3
			if ( dbid == 343 ) {
				initunid = initunid_tmp
			}
			characreate -1, dbid, cX(cc), cY(cc)
			if ( stat != 0 ) {
				resetfaction rc
				addfaction rc, "pet," + cc
				ocbitmod 7, rc, 1
				ocAIStrategy(rc) = AI_STRATEGY_DEFEND_ME
				cRelation(rc) = cRelation(cc)
				cOrgRelation(rc) = cRelation(cc)
			}
		loop
		locvar_getnpctxt_ragnarokflag = 0
		if ( synccheck(cc, -1) ) {
			txt -1, lang("眷属が召喚された。", "Servants come out from a portal.")
		}
		goto *effect_end
		_switch_sw++
	}
	if ( _switch_val == 908 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_BLUE
		ctalk cc, 962, cc, tc
		if ( stat == 0 ) {
			txtef COLOR_BLUE
			txt -1, lang("荒れ狂う水が津波を巻き起こした！", "Tunami all over the area of ocean!")
		}
		repeat mHeight
			dy = cnt
			repeat mWidth
				dx = cnt
				mapId(dx, dy) = xy2pic(0, 5)
			loop
		loop
		repeat mHeight
			dy = cnt
			repeat mWidth
				dx = cnt
				if ( mapChara(dx, dy) != 0 ) {
					tc = mapChara(dx, dy) - 1
					if ( tc == cc ) {
						continue
					}
					attack_weakguard
					dice1 = sMAG(cc) / 50 * (cSAN(tc) + cSAN(cc) + 200) / 200
					dice2 = sMAG(cc) / 10
					bonus = cSAN(tc)
					dmg = rolemax(dice1, dice2, bonus)
					dmghp tc, dmg, cc, MAX_SKILL_RESDMG, 1000
					cSAN(tc) = limit(cSAN(tc) + sMAG(cc) / 10 + rnd(sMAG(cc) / 100 + 1), 0, 2000000000)
				}
			loop
		loop
		cSAN(cc) = limit(cSAN(cc) + sMAG(cc) / 10 + rnd(sMAG(cc) / 100 + 1), 0, 2000000000)
		goto *effect_end
	}
	if ( _switch_val == 933 | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( gGodTalk ) {
				txtgod godcheck(), 14
			}
		}
		txtef COLOR_BLUE
		ctalk cc, 962, cc, tc
		if ( stat == 0 ) {
			txtef COLOR_BLUE
			txt -1, lang("荒波が一帯を覆う！", "Rough waves cover the whole area!")
		}
		repeat mHeight
			dy = cnt
			repeat mWidth
				dx = cnt
				if ( mapChara(dx, dy) != 0 ) {
					tc = mapChara(dx, dy) - 1
					if ( tc == cc ) {
						continue
					}
					if ( mapId(dx, dy) == xy2pic(0, 5) ) {
						txtef COLOR_RED
						txt -1, lang("*ゴゴゴゴゴ*", "*gruuuuu*")
						if ( cQuality(tc) < FIX_QUALITY_UNIQUE ) {
							cHP(tc) = -999000
						}
						dmghp tc, 999, DAMAGE_FROM_UNSEEN
					}
				}
			loop
		loop
		repeat mHeight
			dy = cnt
			repeat mWidth
				dx = cnt
				if ( rnd(3) == 0 ) {
					mapId(dx, dy) = xy2pic(0, 5)
				}
			loop
		loop
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
	}
	if ( _switch_val == 936 | _switch_sw ) {
		_switch_sw = 0
		if ( ncgSignsOfProsperity == 1 ) {
			txt -1, lang("既に繁栄の兆候が発生している。", "Signs of prosperity are already occurring.")
			goto *effect_end
		}
		if ( cc == CHARA_PLAYER ) {
			if ( gGodTalk ) {
				txtgod godcheck(), 14
			}
		}
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		txt -1, lang("繁栄の兆候が発生した！", "Signs of prosperity on the ranch have occurred!")
		ncgSignsOfProsperity = 1
		gosub *effect_end
		gosub *label_4466
		goto *effect_end
	}

*effect_end
	ci = efcibk
	efstatus = 0
	efsource = 0
	multicritical = 0
	magiccritical = 0
	return 1

*effect_heal
	subloop = 1
	if ( gRider != 0 ) {
		if ( tc == gRider | tc == CHARA_PLAYER ) {
			subloop = 2
			if ( tc == gRider ) {
				tc(1) = CHARA_PLAYER
			}
			else {
				tc(1) = gRider
			}
		}
	}
	if ( tc != CHARA_PLAYER ) {
		if ( ocPetRidingIdx(tc) != 0 ) {
			subloop = 2
			tc(1) = ocPetRidingIdx(tc)
		}
		else {
			if ( ocPetBeingRiddenIdx(tc) != 0 ) {
				subloop = 2
				tc(1) = ocPetBeingRiddenIdx(tc)
			}
		}
	}
	repeat subloop
		if ( magiccritical ) {
			healdmg = rolemax(dice1, dice2, bonus)
		}
		else {
			healdmg = role(dice1, dice2, bonus)
		}
		if ( findbuff(tc(cnt), 70) != (-1) ) {
			healdmg /= 10
		}
		healhp tc(cnt), healdmg
		healcon tc(cnt), CONDITION_FEAR
		healcon tc(cnt), CONDITION_POISON, 50
		healcon tc(cnt), CONDITION_CONFUSE, 50
		healcon tc(cnt), CONDITION_DIM, 30
		healcon tc(cnt), CONDITION_BLEED, 20
		if ( godcheck(tc(cnt)) != "danalin" ) {
			healsan tc(cnt), 1
		}
		if ( showdamagecheck(healdmg) ) {
			if ( synccheck(tc(cnt), -1) ) {
				mondmgn(mondmgcnt) = "" + healdmg
				mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, tc(cnt), cc
				ccolor 110
				if ( stat == 0 ) {
					mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
				}
				mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
			}
		}
	loop
	return

*label_3578
	cPoison(tc) = 0
	cSleep(tc) = 0
	cConfuse(tc) = 0
	cBlind(tc) = 0
	if ( gettrait(tc, 195) != 0 ) {
		cBlind(tc) = 1000
	}
	cParalyze(tc) = 0
	cdata(268, tc) = 0
	cMochi(tc) = 0
	cDim(tc) = 0
	cDrunk(tc) = 0
	cBleed(tc) = 0
	cGravity(tc) = 0
	if ( have_bigench(tc, 11) == 0 ) {
		cdata(265, tc) = 0
	}
	gSleep = 0
	cHP(tc) = cMHP(tc)
	cMP(tc) = cMMP(tc)
	cSP(tc) = cMSP(tc)
	return
























































