#defcfunc txtitemoncell int txtitemoncell_arg1, int txtitemoncell_arg2, int txtitemoncell_prm2
	cell_itemoncell txtitemoncell_arg1, txtitemoncell_arg2
	if ( stat <= 3 ) {
		if ( mapItemsMemory(txtitemoncell_arg1, txtitemoncell_arg2) < 0 ) {
			rtvaln = ""
			locvar_txtitemoncell_p = -mapItemsMemory(txtitemoncell_arg1, txtitemoncell_arg2), 0
			locvar_txtitemoncell_i = locvar_txtitemoncell_p \ 1000 + 5080, locvar_txtitemoncell_p / 1000 \ 1000 + 5080, locvar_txtitemoncell_p / 1000000 \ 1000 + 5080
			repeat 3
				if ( locvar_txtitemoncell_i(cnt) == 999 + 5080 ) {
					continue
				}
				if ( locvar_txtitemoncell_p(1) != 0 ) {
					rtvaln += lang("と", " and ")
				}
				rtvaln += itemname(locvar_txtitemoncell_i(cnt))
				locvar_txtitemoncell_p(1)++
			loop
		}
		else {
			rtvaln = itemname(rtval(1))
		}
		nc_ctalkbuff_str = rtvaln
		if ( iProperty(rtval(1)) <= PROP_NONE ) {
			if ( txtitemoncell_prm2 == 0 ) {
				if ( scposval_nc == 0 ) {
					ctalk 0, 10101, 0, tc
				}
				if ( stat == 0 | scposval_nc ) {
					return lang(rtvaln + "が落ちている。", "You see " + rtvaln + " here.")
				}
				return ""
			}
			return lang(rtvaln + "が落ちている。", "You see " + rtvaln + " here.")
		}
		else {
			if ( iProperty(rtval(1)) == PROP_CONSTRUCT ) {
				if ( scposval_nc == 0 ) {
					ctalk 0, 10102, 0, tc
				}
				if ( stat == 0 | scposval_nc ) {
					return lang(rtvaln + "が設置されている。", "" + rtvaln + " is constructed here.")
				}
				return ""
			}
			else {
				if ( scposval_nc == 0 ) {
					ctalk 0, 10103, 0, tc
				}
				if ( stat == 0 | scposval_nc ) {
					return lang(rtvaln + "がある。", "You see " + rtvaln + " placed here.")
				}
				return ""
			}
		}
	}
	else {
		nc_ctalkbuff_int = rtval
		if ( scposval_nc == 0 ) {
			ctalk 0, 10104, 0, tc
		}
		if ( stat == 0 | scposval_nc ) {
			return lang("ここには" + rtval + "種類のアイテムがある。", "There are " + rtval + " items lying here.")
		}
		return ""
	}
	goto *label_2572

#deffunc txttargetnpc int txttargetnpc_arg1, int txttargetnpc_arg2, int txttargetnpc_arg3
	locvar_txttargetnpc_dy = 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	if ( txttargetnpc_arg3 == 0 ) {
		if ( fov_los(cX(CHARA_PLAYER), cY(CHARA_PLAYER), txttargetnpc_arg1, txttargetnpc_arg2) == 0 | dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), txttargetnpc_arg1, txttargetnpc_arg2) > cFov(CHARA_PLAYER) / 2 ) {
			pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
			locvar_txttargetnpc_dy++
			color 0, 0, 0
			bmes lang("視界範囲外", "This location is out of sight."), 255, 255, 255
			cansee = 0
			return
		}
	}
	if ( mapChara(txttargetnpc_arg1, txttargetnpc_arg2) != 0 ) {
		locvar_txttargetnpc_i = mapChara(txttargetnpc_arg1, txttargetnpc_arg2) - 1
		if ( cbit(CHARA_BIT_INVISIBLE, locvar_txttargetnpc_i) == FALSE | cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) | cWet(locvar_txttargetnpc_i) ) {
			tc = locvar_txttargetnpc_i
			if ( cfg_targetex == 1 ) {
				hack_targetex = 1
				if ( cfg_targetbuff == 1 ) {
					hack_targetex = 2
					gmode 4, , , 180
					_mesx = 100
					repeat 8 + 8 - 1
						if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, tc) != 0 ) {
							_tes = ""
							color 0, 0, 0
							pos _mesx, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
							gcopy BUFFER_CHR, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, tc) \ 50 * 32, buffy(ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, tc)), 32, 32
							pos _mesx + 2, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 + 18 - 10
							bmes "" + ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 2, tc), 255, 255, 255
							_mesx += 32
						}
						else {
							break
						}
					loop
					if ( _mesx != 100 ) {
						locvar_txttargetnpc_dy++
					}
				}
				if ( cfg_targetbullet == 1 ) {
					hack_targetex = 2
					dim locvar_txttargetnpc_cwlist, 30
					locvar_txttargetnpc_cwlistmax = 0
					ammo = -1
					repeat 30
						body = 100 + cnt
						locvar_txttargetnpc_cwlist(locvar_txttargetnpc_cwlistmax) = -1
						if ( cdata(body, tc) \ EXT_EQUIP_SLOTS == 0 ) {
							continue
						}
						if ( cdata(body, tc) / EXT_EQUIP_SLOTS == 5 ) {
							locvar_txttargetnpc_cwlist(locvar_txttargetnpc_cwlistmax) = cdata(body, tc) \ EXT_EQUIP_SLOTS - 1
							locvar_txttargetnpc_cwlistmax++
						}
						if ( cdata(body, tc) / EXT_EQUIP_SLOTS == 10 ) {
							locvar_txttargetnpc_cwlist(locvar_txttargetnpc_cwlistmax) = cdata(body, tc) \ EXT_EQUIP_SLOTS - 1
							locvar_txttargetnpc_cwlistmax++
						}
						if ( cdata(body, tc) / EXT_EQUIP_SLOTS == 11 ) {
							ammo = cdata(body, tc) \ EXT_EQUIP_SLOTS - 1
						}
					loop
					locvar_addnews_f = 0
					if ( ammo != (-1) & locvar_txttargetnpc_cwlistmax > 0 ) {
						repeat locvar_txttargetnpc_cwlistmax
							if ( locvar_txttargetnpc_cwlist(cnt) != (-1) ) {
								if ( iSkillRef(locvar_txttargetnpc_cwlist(cnt)) == iSkillRef(ammo) ) {
									locvar_addnews_f = 1
									break
								}
							}
						loop
					}
					if ( locvar_addnews_f == 1 & tc < MAX_CHARA_FOLLOWER ) {
						_mesx = 100
						if ( tc == CHARA_PLAYER ) {
							bullet_ci = ammo
							bullet_listmax = 0
							dim bullet_list
							bullet_cs = -1
							f = 0
							repeat 15
								if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, bullet_ci) == 0 ) {
									break
								}
								enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, bullet_ci)
								i = enc / 10000
								if ( i != 0 ) {
									enc = enc \ 10000
									if ( i == 9 ) {
										if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), bullet_ci) == cnt ) {
											bullet_cs = cnt
										}
										bullet_list(0, bullet_listmax) = cnt
										bullet_listmax++
										continue
									}
								}
							loop
							repeat bullet_listmax + 1
								_tes = ""
								if ( cnt == 0 ) {
								}
								else {
									p = bullet_list(0, cnt - 1)
									i = inv(STARTING_INV_ITEM_ENCHANT_POWER + p * 2, bullet_ci) \ 1000, inv(STARTING_INV_ITEM_ENCHANT_POWER + p * 2, bullet_ci) / 1000
									_tes += ammoname(inv(STARTING_INV_ITEM_ENCHANT + p * 2, bullet_ci) \ 10000) + ":" + i + "/" + i(1)
									color 0, 0, 0
									pos _mesx, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
									if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), bullet_ci) == cnt - 1 ) {
										_tes = "[" + _tes + "]"
										color 255, 0, 0
										f = 1
									}
									bmes _tes, 255, 255, 255
									_mesx += ginfo(14) + 10
								}
							loop
						}
						else {
							bullet_ammotype = 0
							repeat 15
								bullet_val(0) = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ammo) / 10000
								bullet_val(1) = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ammo) \ 10000
								bullet_val(2) = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ammo) / 1000
								bullet_val(3) = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ammo) \ 1000
								if ( bullet_val(0) == 9 ) {
									_tes = ammoname(bullet_val(1)) + ":" + bullet_val(3) + "/" + bullet_val(2)
									color 0, 0, 0
									pos _mesx, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
									if ( ocAISpecialAmmo(tc) - 1 == bullet_val(1) ) {
										if ( bullet_val(3) != 0 ) {
											bullet_ammotype = 1
											_tes = "[" + _tes + "]"
											color 255, 0, 0
											f = 1
										}
									}
									bmes _tes, 255, 255, 255
									_mesx += ginfo(14) + 10
								}
							loop
						}
						_tes = lang("通常弾", "Normal ammo")
						color 0, 0, 0
						if ( f == 0 ) {
							_tes = "[" + _tes + "]"
							color 255, 0, 0
						}
						pos _mesx, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
						bmes _tes, 255, 255, 255
						locvar_txttargetnpc_dy++
					}
				}
				if ( cfg_targetdebuff != 0 ) {
					hack_targetex = 3
					_tes = ""
					if ( jp ) {
						_tes2 = "毒", "眠り", "麻痺", "盲目", "混乱", "恐怖", "朦朧", "酔い", "出血", "濡れ", "狂気", "病気", "重力", "もち", "怒り", "催淫", "石化"
					}
					else {
						_tes2 = "Poisoned", "Sleep", "Paralyzed", "Blinded", "Confused", "Fear", "Dimmed", "Drunk", "Bleeding", "Wet", "Insane", "Sick", "Gravity", "Choked", "Fury", "Aphrodisiac", "Stoned"
					}
					_mesx = 100
					repeat 17
						if ( cnt == 16 ) {
							if ( cdata(268, tc) != 0 ) {
								_tes = _tes2(cnt)
								if ( cfg_targetdebuff == 2 ) {
									_tes += ":" + cdata(268, tc)
								}
								color 0, 0, 0
								pos _mesx, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
								bmes _tes, 255, 255, 255
								_mesx += ginfo(14) + 5
							}
							continue
						}
						if ( cdata(250 + cnt, tc) != 0 ) {
							_tes = _tes2(cnt)
							if ( cfg_targetdebuff == 2 ) {
								_tes += ":" + cdata(250 + cnt, tc)
							}
							color 0, 0, 0
							pos _mesx, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
							bmes _tes, 255, 255, 255
							_mesx += ginfo(14) + 5
						}
					loop
					if ( _tes != "" ) {
						locvar_txttargetnpc_dy++
					}
				}
				if ( cfg_targetresist == 1 ) {
					hack_targetex = 4
					_tes = ""
					_mesx = 100
					repeat 11
						locvar_colorres_i = cnt + 50
						colorres
						_tes = skillname(50 + cnt) + ":" + limit(sdata(50 + cnt, tc) / 50, -1, 10) + ""
						pos _mesx, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
						bmes _tes, 255, 255, 255
						_mesx += ginfo(14) + 5
					loop
					locvar_txttargetnpc_dy++
				}
				if ( cfg_targetlockon == 1 & existfile_target == 1 ) {
					hack_targetex = 5
					repeat ocHostileTargetTotal(tc)
						if ( ocdata(150 + cnt, tc) != 0 ) {
							_x = (cX(ocdata(150 + (ocHostileTargetTotal(tc) - cnt - 1), tc) - 1) - scx) * inf_tiles + inf_screenx
							_y = (cY(ocdata(150 + (ocHostileTargetTotal(tc) - cnt - 1), tc) - 1) - scy) * inf_tiles + inf_screeny
							if ( _y < windowh - inf_barh - inf_msgh ) {
								pos _x, _y
								color 0, 0, 0
								gmode 4, , , 128
								gcopy 99, 0, 0, 48, 48
								pos _x + 5, _y + 48 - 15
								bmes "" + (ocHostileTargetTotal(tc) - cnt), 255, 255, 255
							}
						}
					loop
					repeat ocWantCooperateTargetTotal(tc)
						if ( ocdata(156 + cnt, tc) != 0 ) {
							_x = (cX(ocdata(156 + (ocWantCooperateTargetTotal(tc) - cnt - 1), tc) - 1) - scx) * inf_tiles + inf_screenx
							_y = (cY(ocdata(156 + (ocWantCooperateTargetTotal(tc) - cnt - 1), tc) - 1) - scy) * inf_tiles + inf_screeny
							if ( _y < windowh - inf_barh - inf_msgh ) {
								pos _x, _y
								color 0, 0, 0
								gmode 4, , , 128
								gcopy 99, 48, 0, 96, 48
								pos _x + 5, _y + 48 - 15
								bmes "" + (ocWantCooperateTargetTotal(tc) - cnt), 255, 255, 255
							}
						}
					loop
					gmode 2
				}
				hack_targetex = 6
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
				_tes = ""
				if ( cfg_targetstat == 1 ) {
					_tes = "HP: " + int(1.0 * cHP(tc) / cMHP(tc) * 100) + "%  MP: " + int(1.0 * cMP(tc) / cMMP(tc) * 100) + "%"
					bmes _tes, 255, 255, 255
					locvar_txttargetnpc_dy++
				}
				else {
					if ( cfg_targetstat == 2 ) {
						_tes = "HP: " + cHP(tc) + "/" + cMHP(tc) + " (" + int(1.0 * cHP(tc) / cMHP(tc) * 100) + "%)  MP: " + cMP(tc) + "/" + cMMP(tc) + " (" + int(1.0 * cMP(tc) / cMMP(tc) * 100) + "%)"
						bmes _tes, 255, 255, 255
						locvar_txttargetnpc_dy++
					}
				}
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
				if ( tc > 15 ) {
					txttargetlevel
					s = " - " + s
				}
				else {
					s = ""
				}
				locvar_addnews_s = ""
				if ( cfg_targetclass == 1 ) {
					dbidn = cnClass(tc)
					dbmode = DBMODE_REF
					gosub *cm_race_loop
					if ( cId(tc) == CREATURE_ID_USER ) {
						if ( userdatan2(1, cUNID(tc)) != "" ) {
							classname = userdatan2(1, cUNID(tc))
						}
					}
					locvar_addnews_s += lang(" [職業 ", " [Class: ") + classname + "] "
				}
				locvar_txttargetnpc_s = ""
				if ( gWizard ) {
					locvar_txttargetnpc_s = "(" + locvar_txttargetnpc_i + ")"
				}
				bmes "" + locvar_txttargetnpc_s + name(locvar_txttargetnpc_i) + locvar_addnews_s + lang(" (距離 ", " (Distance ") + dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(locvar_txttargetnpc_i), cY(locvar_txttargetnpc_i)) + ")" + s, 255, 255, 255
				locvar_txttargetnpc_dy++
			}
			else {
				txttargetlevel
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
				locvar_txttargetnpc_dy++
				bmes s, 255, 255, 255
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
				locvar_txttargetnpc_dy++
				dbidn = cnClass(tc)
				dbmode = DBMODE_REF
				gosub *cm_race_loop
				if ( cId(tc) == CREATURE_ID_USER ) {
					if ( userdatan2(1, cUNID(tc)) != "" ) {
						classname = userdatan2(1, cUNID(tc))
					}
				}
				bmes lang("現在のターゲットは", "You are targeting ") + name(locvar_txttargetnpc_i) + lang(" (距離 ", ". (Distance ") + dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(locvar_txttargetnpc_i), cY(locvar_txttargetnpc_i)) + ")", 255, 255, 255
			}
			hack_targetex = 0
		}
	}
	if ( mapItemsMemory(txttargetnpc_arg1, txttargetnpc_arg2) != 0 ) {
		color 0, 0, 0
		pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
		locvar_txttargetnpc_dy++
		bmes txtitemoncell(txttargetnpc_arg1, txttargetnpc_arg2, 1), 255, 255, 255
	}
	if ( oommap(txttargetnpc_arg1, txttargetnpc_arg2, 0) != 0 ) {
		color 0, 0, 0
		pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
		locvar_txttargetnpc_dy++
		if ( oommap(txttargetnpc_arg1, txttargetnpc_arg2, 0) == 743 ) {
			bmes useritemdatan(1, oommap(txttargetnpc_arg1, txttargetnpc_arg2, 2)) + "のレプリカがある。", 255, 255, 255
		}
		else {
			bmes ioriginalnameref(oommap(txttargetnpc_arg1, txttargetnpc_arg2, 0)) + "のレプリカがある。", 255, 255, 255
		}
	}
	if ( cfg_notforsale ) {
		if ( mapbit(3, txttargetnpc_arg1, txttargetnpc_arg2) == 1 ) {
			color 0, 0, 0
			pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
			locvar_txttargetnpc_dy++
			bmes "ここは非売品エリアだ。", 255, 255, 255
		}
	}
	if ( mapFeat(txttargetnpc_arg1, txttargetnpc_arg2) != 0 ) {
		if ( mType == MAP_TYPE_WORLD ) {
			if ( mapFeat(txttargetnpc_arg1, txttargetnpc_arg2) / 1000 \ 100 == 15 ) {
				locvar_txttargetnpc_p = mapFeat(txttargetnpc_arg1, txttargetnpc_arg2) / 100000 \ 100 + mapFeat(txttargetnpc_arg1, txttargetnpc_arg2) / 10000000 * 100
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
				locvar_txttargetnpc_dy++
				bmes mapname(locvar_txttargetnpc_p, 1), 255, 255, 255
			}
			if ( mapFeat(txttargetnpc_arg1, txttargetnpc_arg2) / 1000 \ 100 == 34 ) {
				color 0, 0, 0
				pos 100, windowh - inf_verh - 45 - locvar_txttargetnpc_dy * 20 - 10
				locvar_txttargetnpc_dy++
				bmes txtbuilding(mapFeat(txttargetnpc_arg1, txttargetnpc_arg2) / 100000 \ 100, mapFeat(txttargetnpc_arg1, txttargetnpc_arg2) / 10000000), 255, 255, 255
			}
		}
	}
	cansee = 1
	return

*label_2572

#deffunc key_direction
	kdx = 0
	kdy = 0
	if ( key == key_north ) {
		kdy--
		return 1
	}
	if ( key == key_south ) {
		kdy++
		return 1
	}
	if ( key == key_west ) {
		kdx--
		return 1
	}
	if ( key == key_east ) {
		kdx++
		return 1
	}
	if ( key == key_northwest ) {
		kdx--
		kdy--
		return 1
	}
	if ( key == key_northeast ) {
		kdx++
		kdy--
		return 1
	}
	if ( key == key_southwest ) {
		kdx--
		kdy++
		return 1
	}
	if ( key == key_southeast ) {
		kdx++
		kdy++
		return 1
	}
	return 0

*label_2574
	if ( cfg_extrahelp ) {
		if ( gdata(STARTING_GDATA_HELP + 17) == 0 ) {
			if ( mode == MODELIST_MAIN ) {
				if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
					gdata(STARTING_GDATA_HELP + 17) = 1
					ghelp = 17
					gosub *elona_help
					screenupdate = -1
					gosub *screen_draw
					goto *pc_turn
				}
			}
		}
	}
	if ( dbg_noautosave == 0 | gettrait(0, 190) < 0 & gWizard == 0 ) {
		snd SOUNDLIST_WRITE1
		gosub *game_save
		txtef COLOR_YELLOW
		txt -1, lang(" *保存* ", "*saving*")
	}
	txt -1, lang("あなたはゲートに足を踏み入れた。ゲートはあなたの背後で消滅した。", "You stepped into the gate. The gate disappears.")
	iNum(ci)--
	cell_refresh iX(ci), iY(ci)
	if ( cfg_net == 0 ) {
		if ( jp ) {
			txt -1, lang("ネット機能をONにする必要がある。", "You have to turn on network setting.")
			gosub *screen_draw
			goto *pc_turn
		}
	}
	listmax = 0
	net_dllist ".eum", 0
	if ( listmax == 0 | stat == 0 ) {
		txt -1, lang("あれ…どこにも繋がっていない… ", "Hmmm...the gate isn't connected to anywhere.")
		gosub *screen_draw
		goto *pc_turn
	}
	buff = ""
	notesel buff
	exist exedir + "user\\showroom_log.txt"
	if ( strsize != (-1) ) {
		noteload exedir + "user\\showroom_log.txt"
	}
	repeat 500
		p = rnd(listmax)
		if ( cfg_moongatejump == 0 ) {
			break
		}
		if ( cfg_moongatejump == 1 ) {
			noteget s, 0
			if ( s != listn(0, p) ) {
				break
			}
		}
		if ( cfg_moongatejump == 2 ) {
			if ( instr(buff, 0, listn(0, p)) == (-1) ) {
				break
			}
		}
	loop
	noteunsel
	net_dl "" + list(1, p) + ".eum", "temp.eum"
	usermapid = list(1, p)
	if ( stat == 0 ) {
		txt -1, lang("ファイルの取得に失敗した。", "Failed to retrieve designated files.")
		gosub *screen_draw
		goto *pc_turn
	}
	userfile = "temp.eum"
	bload exedir + "user\\" + userfile, headtemp, 1024
	notesel headtemp
	noteget s, 5
	noteget s(1), 6
	username = "" + s
	userrelation = int(s(1))
	gosub *label_4302
	msg_halt
	goto *label_3122

*com_import
	if ( dbg_noautosave == 0 | gettrait(0, 190) < 0 & gWizard == 0 ) {
		snd SOUNDLIST_WRITE1
		gosub *game_save
		txtef COLOR_YELLOW
		txt -1, lang(" *保存* ", "*saving*")
	}
	snd SOUNDLIST_POP2
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	sdim headtemp, 1024
	p(91) = 0
	if ( comctrl == 0 | comctrl == 2 ) {
		getuserfiledata "eum", p(91)
	}
	if ( comctrl == 1 ) {
		getuserfiledata "ept", p(91)
	}
	folder = exedir + "user\\"
	repeat p(91)
		procid = (procid + 1) \ 10
		proclist(procid) = "showRoom_update:2" + " dir:" + userfilelist(1, cnt) + " file:" + userfilelist(0, cnt) + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		sreplace file, userfilelist(1, cnt) + userfilelist(0, cnt), folder, ""
		if ( file == "temp.eum" | file == "temp.ept" ) {
			continue
		}
		bload folder + file, headtemp, 1024
		notesel headtemp
		noteget s, 0
		noteget s(1), 1
		noteget s(2), 4
		list(0, listmax) = listmax, 0, int(s(2))
		listn(0, listmax) = "(" + file + ") " + s + " " + s(1), file
		listmax++
		noteunsel
	loop
	if ( cfg_net != 0 ) {
		if ( comctrl == 1 ) {
			net_dllist ".ept", 1
		}
		if ( comctrl == 2 ) {
			net_dllist ".eum", 1
		}
	}
	if ( comctrl == 0 | comctrl == 2 ) {
		exist exedir + "user\\showroom_log.txt"
		if ( strsize != (-1) ) {
			notesel buff
			noteload exedir + "user\\showroom_log.txt"
			noteunsel
			repeat listmax
				if ( instr(buff, 0, listn(0, cnt)) != (-1) ) {
					listn(0, cnt) = "*" + listn(0, cnt)
				}
			loop
		}
		txt -1, lang("どのルームを訪問する？ ", "Which room do you want to visit? ")
	}
	if ( comctrl == 1 ) {
		txt -1, lang("どのチームと対戦する？", "Which team do you want to play a match? ")
	}
	windowshadow = 1

*com_import_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_import_loop
	redraw 0
	if ( comctrl == 0 | comctrl == 2 ) {
		s = lang("ルーム一覧", "Room List")
	}
	if ( comctrl == 1 ) {
		s = lang("ペットチーム一覧", "Team List")
	}
	s(1) = lang("BackSpace [削除]  ", "BackSpace [Delete]  ") + strhint2 + strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	if ( comctrl == 0 | comctrl == 2 ) {
		s = lang("ルームの名称", "Name")
	}
	if ( comctrl == 1 ) {
		s = lang("チームの名称", "Name")
	}
	display_topic s, wx + 28, wy + 36
	display_topic "Ver", wx + 534, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		s = listn(0, p)
		cutname s, 64
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		pos wx + 570, wy + 66 + cnt * 19
		mes "" + (list(2, p) \ 1000 + 1) + ".0"
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		if ( p == (-999) ) {
			snd SOUNDLIST_FAIL1
			txt -1, lang("互換性のないバージョンのファイルです。", "Selected item is incompatible.")
			goto *com_import_loop_pgchk
		}
		folder = exedir + "user\\"
		if ( listn(1, p) == "net" ) {
			if ( comctrl == 1 ) {
				s = ".ept"
			}
			else {
				s = ".eum"
			}
			net_dl "" + list(1, p) + s, "temp" + s
			usermapid = list(1, p)
			if ( stat == 0 ) {
				txt -1, lang("ファイルの取得に失敗した。", "Failed to retrieve designated files.")
				goto *com_import_loop_pgchk
			}
			userfile = "temp" + s
		}
		else {
			userfile = listn(1, p)
		}
		bload folder + userfile, headtemp, 1024
		notesel headtemp
		noteget s, 5
		noteget s(1), 6
		if ( comctrl == 0 | comctrl == 2 ) {
			username = "" + s
			userrelation = int(s(1))
			gosub *label_4302
		}
		if ( comctrl == 1 ) {
			rtval = int(s), int(s(1))
		}
		return 1
	}
	getkey a, 8
	if ( ginfo(2) == 0 ) {
		if ( p(91) != 0 ) {
			if ( a == 1 ) {
				userfile = listn(1, cs + pagesize * page)
				exist exedir + "user\\" + userfile
				if ( strsize == (-1) ) {
					goto *com_import_loop_pgchk
				}
				txt -1, lang("本当に" + userfile + "を削除する？ ", "Do you really want to delete " + userfile + "? ")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval == 0 ) {
					delete exedir + "user\\" + userfile
					goto *com_import
				}
				goto *com_import_loop_pgchk
			}
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_import_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_import_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		gosub *screen_draw
		return 0
	}
	goto *com_import_loop

*label_2584
	if ( tlocinitx != 0 | tlocinity != 0 | homemapmode == 1 ) {
		tlocx = tlocinitx
		tlocy = tlocinity
	}
	else {
		tlocx = cX(cc)
		tlocy = cY(cc)
	}
	scposval_nc = 1
	if ( homemapmode ) {
		scposval = 0
	}
	else {
		scposval = 1
		if ( ocHostileTargetTotal(0) == 0 ) {
			gosub *label_3023
		}
		if ( ocHostileTargetTotal(0) ) {
			gosub *label_3033
			if ( listmax == 0 ) {
				txt -1, lang("視界内にターゲットは存在しない。", "You look around and find nothing.")
			}
			repeat listmax
				if ( list(0, cnt) == 0 ) {
					continue
				}
				if ( list(0, cnt) == ocHostileTarget1(0) - 1 ) {
					tlocx = cX(list(0, cnt))
					tlocy = cY(list(0, cnt))
					break
				}
			loop
		}
	}

*label_2587
	screenupdate = -1
	gosub *screen_draw
	dx = (tlocx - scx) * inf_tiles + inf_screenx
	dy = (tlocy - scy) * inf_tiles + inf_screeny
	if ( dy + inf_tiles <= windowh - inf_verh ) {
		pos dx, dy * (dy > 0)
		gfini inf_tiles - (dx + inf_tiles > windoww) * (dx + inf_tiles - windoww), inf_tiles + (dy < 0) * inf_screeny - (dy + inf_tiles > windowh - inf_verh) * (dy + inf_tiles - windowh + inf_verh)
		gfinc 50, 50, 100
	}
	if ( homemapmode == 1 ) {
		pos windoww - 80, 20
		gcopy BUFFER_MAP, tile \ 33 * inf_tiles, tile / 33 * inf_tiles, inf_tiles, inf_tiles
	}
	if ( homemapmode == 2 ) {
		f = 0
		repeat inf_screenh
			y = cnt
			repeat inf_screenw
				x = cnt
				xx = x + scx
				yy = y + scy
				if ( mapbit(3, xx, yy) == 1 ) {
					xx = x * inf_tiles + inf_screenx
					yy = y * inf_tiles + inf_screeny
					w = inf_tiles - (xx + inf_tiles > windoww) * (xx + inf_tiles - windoww)
					h = inf_tiles - (yy + inf_tiles > windowh - inf_verh) * (yy + inf_tiles - (windowh - inf_verh))
					if ( yy < 0 ) {
						h += yy
						yy = 0
					}
					pos xx, yy
					gfini w, h
					gfinc 100, 0, 0
				}
				f = 1 - f
			loop
		loop
	}
	if ( homemapmode == 0 ) {
		rc = -1
		repeat 1
			if ( mapChara(tlocx, tlocy) <= 1 ) {
				break
			}
			rc = mapChara(tlocx, tlocy) - 1
			if ( synccheck(rc, -1) == 0 ) {
				break
			}
			if ( fov_los(cX(cc), cY(cc), cX(rc), cY(rc)) == 0 ) {
				break
			}
			if ( (cbit(CHARA_BIT_INVISIBLE, rc) == FALSE | cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) | cWet(rc)) == 0 ) {
				break
			}
			get_route cX(cc), cY(cc), cX(rc), cY(rc)
			dx = (tlocx - scx) * inf_tiles + inf_screenx
			dy = (tlocy - scy) * inf_tiles + inf_screeny
			if ( maxroute != 0 ) {
				dx = cX(cc)
				dy = cY(cc)
				repeat 100
					route_info dx, dy, cnt
					if ( stat == 0 ) {
						break
					}
					else {
						if ( stat == (-1) ) {
							continue
						}
					}
					sx = (dx - scx) * inf_tiles + inf_screenx
					sy = (dy - scy) * inf_tiles + inf_screeny
					if ( sy + inf_tiles <= windowh - inf_verh ) {
						pos sx, sy * (sy > 0)
						gfini inf_tiles - (sx + inf_tiles > windoww) * (sx + inf_tiles - windoww), inf_tiles + (sy < 0) * inf_screeny - (sy + inf_tiles > windowh - inf_verh) * (sy + inf_tiles - windowh + inf_verh)
						gfinc 25, 25, 25
					}
				loop
			}
		loop
	}
	txttargetnpc tlocx, tlocy
	redraw 1
	await cfg_wait1
	key_check
	if ( homemapmode == 1 | homemapmode == 2 ) {
		if ( key == key_enter ) {
			if ( homemapmode == 1 ) {
				gosub *com_mapset
				keyrelease
			}
			else {
				repeat mHeight
					y = cnt
					repeat mWidth
						x = cnt
						if ( mapbit(3, x, y) == 1 ) {
							mapbitmod 3, x, y, 0
						}
						else {
							mapbitmod 3, x, y, 1
						}
					loop
				loop
			}
			goto *label_2595
		}
		stick a, 768
		lbtn = 0
		rbtn = 0
		if ( a == 256 ) {
			lbtn = 1
			key = key_enter
		}
		if ( a == 512 ) {
			rbtn = 1
			if ( homemapmode == 1 ) {
				tile = mapId(tlocx, tlocy)
				snd SOUNDLIST_CURSOR1
				keyrelease
			}
			else {
				key = key_enter
			}
		}
		tx = limit(mousex - inf_screenx, 0, windoww) / 48
		ty = limit(mousey - inf_screeny, 0, windowh - inf_verh) / 48
		key_direction
		if ( stat == 1 ) {
			cX(CHARA_PLAYER) += kdx
			cY(CHARA_PLAYER) += kdy
			if ( cX(CHARA_PLAYER) < 0 ) {
				cX(CHARA_PLAYER) = 0
			}
			else {
				if ( cX(CHARA_PLAYER) >= mWidth ) {
					cX(CHARA_PLAYER) = mWidth - 1
				}
			}
			if ( cY(CHARA_PLAYER) < 0 ) {
				cY(CHARA_PLAYER) = 0
			}
			else {
				if ( cY(CHARA_PLAYER) >= mHeight ) {
					cY(CHARA_PLAYER) = mHeight - 1
				}
			}
		}
		tlocx = tx + scx
		if ( tlocx < 0 ) {
			tlocx = 0
		}
		else {
			if ( tlocx >= mWidth ) {
				tlocx = mWidth - 1
			}
		}
		tlocy = ty + scy
		if ( tlocy < 0 ) {
			tlocy = 0
		}
		else {
			if ( tlocy >= mHeight ) {
				tlocy = mHeight - 1
			}
		}
	}
	else {
		key_direction
		if ( stat == 1 ) {
			x = tlocx + kdx
			y = tlocy + kdy
			if ( x >= 0 & y >= 0 & x < mWidth & y < mHeight ) {
				tlocx += kdx
				tlocy += kdy
			}
		}
	}
	if ( findlocmode == 1 ) {
		if ( rc == (-1) ) {
			i = 0
		}
		else {
			i = rc
		}
		f = 0
		p = 0
		repeat listmax
			if ( cX(list(0, cnt)) == cX(i) ) {
				if ( cY(list(0, cnt)) == cY(i) ) {
					p = cnt
					break
				}
			}
		loop
		if ( key == key_pageup ) {
			p++
			f = 1
			if ( p >= listmax ) {
				p = 0
			}
		}
		if ( key == key_pagedown ) {
			p--
			f = 1
			if ( p < 0 ) {
				p = listmax - 1
				if ( p < 0 ) {
					p = 0
				}
			}
		}
		i = list(0, p)
		if ( f ) {
			snd SOUNDLIST_CURSOR1
			tlocx = cX(list(0, p))
			tlocy = cY(list(0, p))
		}
	}
	if ( key == key_enter ) {
		if ( homemapmode == 2 ) {
			if ( lbtn ) {
				return 2
			}
			if ( rbtn ) {
				return 1
			}
			return 0
		}
		if ( findlocmode == 1 ) {
			if ( cansee == 0 | (chipm(CHIPM_ATTRIB, mapId(tlocx, tlocy)) & CHIPM_ATTRIB_CANT_PASS) ) {
				txt -1, lang("その場所は見えない。", "You can't see the location.")
				goto *label_2595
			}
			snd SOUNDLIST_OK1
			if ( rc > CHARA_PLAYER ) {
				lockon 0, rc, 8
				txt -1, lang(name(rc) + "をターゲットにした。", "You target " + name(rc) + ".")
			}
			else {
				tgloc = 1
				tglocx = tlocx
				tglocy = tlocy
				txt -1, lang("地面をターゲットにした。", "You target the ground.")
				unlockson 0
			}
		}
		else {
			if ( homemapmode == 0 ) {
				snd SOUNDLIST_CURSOR1
			}
		}
		scposval = 0
		if ( tlocinitx == 0 & tlocinity == 0 & homemapmode != 1 ) {
			scposval = 0
			scposval_nc = 0
			gosub *screen_draw
		}
		tlocinitx = 0
		tlocinity = 0
		return cansee
	}
	if ( key == key_cancel ) {
		tlocinitx = 0
		tlocinity = 0
		scposval = 0
		scposval_nc = 0
		gosub *screen_draw
		return -1
	}

*label_2595
	goto *label_2587

*com_target
	procid = (procid + 1) \ 10
	proclist(procid) = "com_target" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	page = 0
	pagesize = 16
	cs_bk = -1
	gosub *label_3033
	if ( listmax == 0 ) {
		msgdup++
		txt -1, lang("視界内にターゲットは存在しない。", "You look around and find nothing.")
		gosub *screen_draw
		goto *pc_turn
	}
	cs = 0
	repeat listmax
		if ( list(0, cnt) == ocHostileTarget1(0) - 1 ) {
			cs = cnt \ pagesize
			page = cnt / pagesize
		}
	loop

*com_target_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_target_loop
	if ( cs != cs_bk ) {
		screenupdate = -1
		gosub *screen_draw
		keyrange = 0
		font lang(cfg_font1, cfg_font2), 20 - en * 2, 1
		color 255, 255, 255
		repeat pagesize
			p = pagesize * page + cnt
			if ( p >= listmax ) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange++
			x = list(1, p) - scx
			y = list(2, p) - scy
			if ( cs == cnt ) {
				i = p
				get_route cX(cc), cY(cc), cX(list(0, p)), cY(list(0, p))
				dx = (tlocx - scx) * inf_tiles + inf_screenx
				dy = (tlocy - scy) * inf_tiles + inf_screeny
				if ( maxroute != 0 ) {
					dx = cX(cc)
					dy = cY(cc)
					repeat 100
						route_info dx, dy, cnt
						if ( stat == 0 ) {
							break
						}
						else {
							if ( stat == (-1) ) {
								continue
							}
						}
						sx = (dx - scx) * inf_tiles + inf_screenx
						sy = (dy - scy) * inf_tiles + inf_screeny
						if ( sy + inf_tiles <= windowh - inf_verh ) {
							pos sx, sy * (sy > 0)
							gfini inf_tiles - (sx + inf_tiles > windoww) * (sx + inf_tiles - windoww), inf_tiles + (sy < 0) * inf_screeny - (sy + inf_tiles > windowh - inf_verh) * (sy + inf_tiles - windowh + inf_verh)
							gfinc 25, 25, 25
						}
						await
					loop
				}
				sx = x * inf_tiles + inf_screenx
				sy = y * inf_tiles + inf_screeny
				if ( sy + inf_tiles <= windowh - inf_verh ) {
					pos sx, sy * (sy > 0)
					gfini inf_tiles, inf_tiles + (sy < 0) * inf_screeny - (sy + inf_tiles > windowh - inf_verh) * (sy + inf_tiles - windowh + inf_verh)
					gfinc 50, 50, 100
				}
			}
			display_key x * inf_tiles + inf_screenx - 12, y * inf_tiles + inf_screeny - 12, cnt
		loop
		txttargetnpc cX(list(0, i)), cY(list(0, i))
		cs_bk = cs
		gosub *screen_drawStatus
		redraw 1
	}
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_target ) {
		key = key_list(cs)
	}
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		lockon 0, p, 9
		snd SOUNDLIST_OK1
		txt -1, lang(name(p) + "をターゲットにした。", "You target " + name(p) + ".")
		scposval_nc = 0
		gosub *screen_draw
		goto *com_target_loop_WEND1
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_target_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_target_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		gosub *screen_draw
		goto *com_target_loop_WEND1
	}
	goto *com_target_loop

*com_target_loop_WEND1
	goto *pc_turn

*com_mapset
	ww = 33
	wh = 20
	wx = 0
	wy = 0
	snd SOUNDLIST_POP2

*com_mapset_WHILE1
	redraw 0
	gmode 0
	color 200, 200, 200
	p = 0
	repeat wh
		cnt2 = cnt
		repeat ww
			if ( p < listmax ) {
				pos wx + cnt * 24, wy + cnt2 * 24
				gzoom 24, 24, 2, list(0, p) \ ww * 48, list(0, p) / ww * 48, 48, 48
				if ( chipm(CHIPM_ATTRIB, list(0, p)) & CHIPM_ATTRIB_CANT_PASS ) {
					color 240, 230, 220
					boxl wx + cnt * 24, wy + cnt2 * 24, wx + cnt * 24 + 24, wy + cnt2 * 24 + 24
				}
			}
			p++
		loop
	loop
	gmode 2
	redraw 1
	await cfg_wait1
	stick a
	if ( a == 256 ) {
		p = mousex / 24 + mousey / 24 * ww
		if ( p >= listmax ) {
			snd SOUNDLIST_FAIL1
			goto *com_mapset_WHILE1_CONTINUE
		}
		tile = list(0, p)
		snd SOUNDLIST_OK1
		goto *com_mapset_WEND1
	}
	if ( a == 512 ) {
		goto *com_mapset_WEND1
	}

*com_mapset_WHILE1_CONTINUE
	goto *com_mapset_WHILE1

*com_mapset_WEND1
	screenupdate = -1
	gosub *screen_draw
	return

*label_2611
	snd SOUNDLIST_POP2
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	if ( allyctrl == 2 ) {
		list(0, listmax) = 99, -9999
		listmax++
	}
	repeat 16
		if ( cExist(cnt) == CHAR_STATE_DEAD ) {
			continue
		}
		if ( allyctrl == 1 | allyctrl == 7 ) {
			if ( cExist(cnt) == CHAR_STATE_ALLY_DEAD ) {
				continue
			}
		}
		if ( allyctrl == 3 | allyctrl == 5 | allyctrl == 6 | allyctrl == 8 | allyctrl == 98 | allyctrl == 99 | allyctrl == 100 ) {
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( areaId(gArea ) == AREA_CROP ) {
				if ( cType(cnt) != gArea  ) {
					continue
				}
			}
		}
		if ( allyctrl == 5 ) {
			if ( cnt == rc ) {
				continue
			}
		}
		if ( cType(cnt) != 0 ) {
			if ( allyctrl == 1 | allyctrl == 2 | allyctrl == 7 | allyctrl == 8 ) {
				continue
			}
		}
		if ( allyctrl != 1 & allyctrl != 7 ) {
			if ( cbit(CHARA_BIT_BODYGUARD, cnt) | cbit(CHARA_BIT_GUARD_TEMP, cnt) ) {
				continue
			}
		}
		if ( cbit(CHARA_BIT_RIDE, cnt) ) {
			continue
		}
		if ( allyctrl != 6 ) {
			if ( cnt == 0 ) {
				continue
			}
		}
		if ( cRole(cnt) == 20001 ) {
			continue
		}
		if ( allyctrl == 2 ) {
			if ( arenaop(0) == 2 ) {
				if ( filtercheck(cnt, "putit") == 0 ) {
					continue
				}
			}
			if ( arenaop(0) == 3 ) {
				if ( filtercheck(cnt, "horse") == 0 ) {
					continue
				}
			}
		}
		if ( allyctrl == 3 ) {
			if ( areaId(gArea ) == AREA_RANCH ) {
				if ( ocPetJobSkill(cnt) == 151 ) {
					continue
				}
			}
		}
		if ( allyctrl == 99 ) {
			cnt2 = cnt
			f = 0
			repeat 96, 1
				if ( gettrait(cnt2, cnt) ) {
					f = 1
					break
				}
			loop
			if ( f == 0 ) {
				continue
			}
		}
		if ( allyctrl == 100 ) {
			if ( cnt == locvar_key_direction_swap ) {
				continue
			}
		}
		list(0, listmax) = cnt, -cLevel(cnt)
		listmax++
	loop
	gosub *sort_list
	if ( allyctrl == 2 ) {
		p = 0
		dim followerin, 16
		repeat listmax
			if ( cnt == 0 ) {
				continue
			}
			i = list(0, cnt)
			if ( cExist(i) != CHAR_STATE_ALLY_DEAD ) {
				followerin(i) = 1
				p++
				if ( p == arenaop(1) ) {
					break
				}
			}
		loop
	}
	windowshadow = 1

*label_2615
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
			txtnew
		}
	}
	if ( allyctrl == 0 ) {
		txt -1, lang("誰を呼び戻す？", "Call who?")
		s(10) = lang("呼び戻す仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		x = 0
	}
	if ( allyctrl == 1 ) {
		txt -1, lang("誰を売り飛ばす？", "Sell who?")
		s(10) = lang("売り飛ばす仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("値段", "Value")
		x = 20
	}
	if ( allyctrl == 2 ) {
		i = 0
		repeat 16
			i += followerin(cnt) == 1
		loop
		if ( i < arenaop(1) ) {
			txtef COLOR_RED
		}
		else {
			txtef COLOR_BLUE
		}
		txt -1, lang("試合の規定人数: ", "Participant: ") + i + " / " + arenaop(1)
		s(10) = lang("出場する仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		x = 20
	}
	if ( allyctrl == 3 ) {
		if ( areaId(gArea ) == AREA_SHOP ) {
			txt -1, lang("誰を店長にする？", "Who takes the role of shopkeeper?")
			s(10) = lang("店長候補", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("魅力/交渉", "CHR/Negotiation")
		}
		if ( areaId(gArea ) == AREA_RANCH ) {
			txt -1, lang("誰をブリーダーにする？", "Who takes the role of breeder?")
			s(10) = lang("ブリーダー候補", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("繁殖力", "Breed Power")
		}
		if ( gArea  == AREA_HOME | areaId(gArea ) == AREA_CROP ) {
			txt -1, lang("誰を滞在させる？", "Who stays in your home?")
			s(10) = lang("滞在状態の変更", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		}
		x = 20
	}
	if ( allyctrl == 4 | allyctrl == 5 ) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		if ( allyctrl == 5 ) {
			if ( rc != CHARA_PLAYER ) {
				s(13) = lang("獲得部位/技能", "Body/Skill")
			}
		}
		x = 0
	}
	if ( allyctrl == 6 | allyctrl == 7 | allyctrl == 8 ) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name")
		if ( allyctrl == 8 ) {
			s(13) = lang("速度", "Speed")
		}
		else {
			s(13) = lang("料金", "Cost")
		}
		x = 20
	}
	if ( allyctrl == 99 | allyctrl == 98 ) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name")
		s(13) = lang("最大Lv - フィート数", "Max lvl - Available feats")
		x = 20
	}
	if ( allyctrl == 100 ) {
		txt -1, lang("対象にする仲間は？", "Who is the subject?")
		s(10) = lang("入れ替える仲間", "Ally List"), strhint2 + strhint3, lang("仲間の情報", "Name"), lang("状態", "Status")
		x = 0
	}

*com_ally
	redraw 0
	s = s(10), s(11)
	display_window (windoww - 620) / 2 + inf_screenx, winposy(400), 620, 400
	display_topic s(12), wx + 28, wy + 36
	display_topic s(13), wx + 350 + x, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 500, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		if ( list(0, p) != 99 ) {
			transmissivity = 0
			if ( cId(list(0, p)) == CREATURE_ID_USER ) {
				if ( userdata2(1, cUNID(list(0, p))) ) {
					transmissivity = userdata2(1, cUNID(list(0, p)))
				}
			}
			if ( ocChipTransparency(list(0, p)) ) {
				transmissivity = ocChipTransparency(list(0, p))
			}
			i = getcharapic(list(0, p)), getcharacolor(list(0, p))
			chara_preparepic i, i(1)
			pos wx + 40, wy + 74 + cnt * 19 - 8
			gmode 4, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i), 256 - transmissivity
			color 0, 0, 0
			grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, i) / (1 + (chipc(CHIPC_HEIGHT, i) > inf_tiles)), inf_tiles
			gmode 2
		}
		i = list(0, p)
		if ( i == 99 ) {
			cs_list lang("決定", "Proceed"), wx + 84, wy + 66 + cnt * 19 - 1, 19
			continue
		}
		if ( allyctrl == 0 | allyctrl == 2 | allyctrl == 3 | allyctrl == 4 | allyctrl == 5 | allyctrl == 100 ) {
			s = "" + cnAka(i) + " " + cnName(i)
			if ( allyctrl != 6 ) {
				if ( cType(i) != 0 ) {
					if ( ocdata(80, i) == 0 ) {
						s = s + "(" + mapname(cType(i)) + ")"
					}
					else {
						s = s + "(" + mapname(cType(i)) + floorstr(-ocdata(80, i) - 1) + ")"
					}
				}
			}
			if ( allyctrl == 2 ) {
				if ( followerin(i) == 1 ) {
					s += lang(" *出場* ", " *In* ")
				}
			}
			n = 0
			if ( allyctrl == 5 ) {
				if ( cLevel(i) > sGene(CHARA_PLAYER) + 5 ) {
					n = 3
				}
			}
			cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19, 0, n
			if ( allyctrl != 3 | gArea  == AREA_HOME | areaId(gArea ) == AREA_CROP ) {
				s = "Lv." + cLevel(i) + " "
				if ( cExist(i) == CHAR_STATE_ALLY_DEAD ) {
					s += lang("(死んでいる)", "(Dead)")
				}
				if ( cExist(i) == CHAR_STATE_ALLY_WAIT ) {
					if ( allyctrl == 0 ) {
						s += lang("(待機している)", "(Waiting)")
					}
					else {
						s += "(Hp: " + cHP(i) * 100 / cMHP(i) + "%) " + lang("待機", "Waiting")
					}
				}
				if ( cExist(i) == CHAR_STATE_ALIVE ) {
					if ( allyctrl == 0 ) {
						s += lang("(生きている)", "(Alive)")
					}
					else {
						s += "(Hp: " + cHP(i) * 100 / cMHP(i) + "%)"
					}
				}
			}
			else {
				if ( areaId(gArea ) == AREA_SHOP ) {
					s = "   " + sCHR(i) + " / " + sTrade(i)
				}
				if ( areaId(gArea ) == AREA_RANCH ) {
					locvar_key_direction_breederpower = cbreeder(i)
					if ( double(2147483647) < locvar_key_direction_breederpower ) {
						s = strf("   %.0f", locvar_key_direction_breederpower)
					}
					else {
						s = "   " + int(locvar_key_direction_breederpower)
					}
				}
			}
			if ( allyctrl == 5 ) {
				if ( rc != CHARA_PLAYER ) {
					tc = i
					gosub *gene_body
					if ( stat == (-1) ) {
						s = lang("なし", "None")
					}
					else {
						s = bodyn(rtval)
					}
					s += "/"
					gosub *gene_skill
					if ( stat == 0 ) {
						s += lang("なし", "None")
					}
					else {
						s += "" + skillname(rtval)
						if ( rtval(1) != (-1) ) {
							s += ", " + skillname(rtval(1))
						}
					}
				}
			}
			pos wx + 370, wy + 66 + cnt * 19 + 2
			mes s
		}
		if ( allyctrl == 1 | allyctrl == 6 | allyctrl == 7 | allyctrl == 8 ) {
			s = "" + cnAka(i) + " " + cnName(i)
			s += " Lv." + cLevel(i)
			n = 0
			if ( allyctrl == 6 ) {
				if ( cGold(CHARA_PLAYER) < calcactupgradevalue(i) ) {
					n = 3
				}
			}
			if ( allyctrl == 7 ) {
				if ( cGold(CHARA_PLAYER) < calcactupgradevalue(i) * 2 / 3 ) {
					n = 3
				}
			}
			cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19, 0, n
			if ( allyctrl == 8 ) {
				s = "" + cSpeed(i)
			}
			else {
				if ( allyctrl == 6 ) {
					s = thousandsep(str(calcactupgradevalue(i))) + strgold
				}
				else {
					if ( allyctrl == 7 ) {
						s = thousandsep(str(calcactupgradevalue(i) * 2 / 3)) + strgold
					}
					else {
						s = thousandsep(str(calcslavevalue(i) * 2 / 3)) + strgold
					}
				}
			}
			pos wx + 390, wy + 66 + cnt * 19 + 2
			mes s
		}
		if ( allyctrl == 99 | allyctrl == 98 ) {
			s = "" + cnAka(i) + " " + cnName(i)
			s += " Lv." + cLevel(i)
			cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19, 0, 0
			featcnt = 0
			repeat 96, 1
				if ( gettrait(i, cnt) != 0 ) {
					featcnt += stat
				}
			loop
			s = "Lv." + cLevelOrg(i) + " - " + featcnt
			pos wx + 390, wy + 66 + cnt * 19 + 2
			mes s
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		if ( allyctrl == 5 ) {
			if ( cLevel(p) > sGene(CHARA_PLAYER) + 5 ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("遺伝子学のスキルが足りない。", "You need to be a better gene engineer.")
				goto *label_2615
			}
		}
		if ( allyctrl == 2 ) {
			i = 0
			repeat 16
				if ( followerin(cnt) == 1 ) {
					i++
				}
			loop
			if ( p == 99 ) {
				if ( i == 0 ) {
					txt -1, lang("最低でも一人の参加者が必要だ。", "You need at least 1 pet to start the battle.")
					snd SOUNDLIST_FAIL1
					goto *com_ally_loop
				}
				snd SOUNDLIST_OK1
				return 1
			}
			if ( cExist(p) == CHAR_STATE_ALLY_DEAD ) {
				txt -1, lang("死んでいる。", he(p) + " " + is(p) + " dead.")
				snd SOUNDLIST_FAIL1
				goto *com_ally_loop
			}
			if ( followerin(p) == 0 ) {
				if ( i >= arenaop(1) ) {
					snd SOUNDLIST_FAIL1
					txt -1, lang("参加枠を超えている。", "Too many participants.")
					goto *com_ally_loop
				}
				else {
					followerin(p) = 1
					snd SOUNDLIST_OK1
				}
			}
			else {
				followerin(p) = 0
				snd SOUNDLIST_OK1
			}
			goto *label_2615
		}
		if ( allyctrl == 6 ) {
			if ( cGold(CHARA_PLAYER) < calcactupgradevalue(p) & ncgGoldOverflow == 0 ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("お金が足りない。", "You don't have enough money...")
				goto *label_2615
			}
		}
		return p
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_2615
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_2615
		}
	}
	if ( key == key_cancel ) {
		return -1
	}

*com_ally_loop
	goto *com_ally

*com_knowSelf
	if ( rc < CHARA_PLAYER ) {
		rc = tc
		if ( rc < CHARA_PLAYER ) {
			rc = CHARA_PLAYER
		}
	}
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	snd SOUNDLIST_POP2
	buff = ""
	notesel buff
	del_chara 56
	r1 = 56
	cPiety(r1) = cPiety(CHARA_PLAYER)
	cGod(r1) = cGod(CHARA_PLAYER)
	repeat 600
		sdata(cnt, rc) = 1
	loop
	gosub *label_2452
	if ( godcheck() != "eyth" ) {
		buff += lang("<title1>◆ " + godname(godcheck()) + "による能力の恩恵<def>\n", "<title1>* Blessing by " + godname(godcheck()) + "<def>\n")
		repeat 600
			p = sdata(cnt, rc) - 1
			cnvbonus cnt, p
		loop
	}
	r1 = 0
	refreshmode = 1
	gosub *charaRefresh
	refreshmode = 0
	buff += "\n"
	buff += lang("<title1>◆ 特徴と特殊状態による能力の恩恵<def>\n", "<title1>* Stats boosts by your traits and equipments")
	listmax = noteinfo(0)

*com_knowSelf_loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	s = lang("自己の分析", "Analyze Self"), strhint2 + strhint3b
	display_window (windoww - 400) / 2 + inf_screenx, winposy(448), 400, 448
	s = lang("分析結果", "Analysis Result")
	display_topic s, wx + 28, wy + 36
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		noteget s, p
		gmesx = wx + 40
		gmesy = wy + 66 + cnt * 19 + 2
		gmesw = 600
		gmescol = 30, 30, 30
		gmestype = 0
		pos wx + 54, wy + 66 + cnt * 19 + 2
		gmes s
	loop
	redraw 1

*com_knowSelf_pgchg
	redraw 0
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_knowSelf_loop
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_knowSelf_loop
		}
	}
	if ( key == key_cancel ) {
		return
	}
	goto *com_knowSelf_pgchg

*com_trait
	listmax = 0
	page = 0
	pagesize = 15
	cs = 0
	tc = CHARA_PLAYER
	cs_bk = -1
	curmenu = 2
	snd SOUNDLIST_FEAT
	drawmenu
	ww = 700
	wh = 400
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	windowanime wx, wy, ww, wh, 10, 4
	redraw 0
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_feat.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1

*com_trait_loop
	if ( cm == 1 ) {
		s = lang("フィートとは、君の持っている有益な特徴だ。" + gTraitPoint + "つまで選べるよ。", "Choose your feats wisely.")
		gosub *screen_drawMsg2
	}
	listmax = 0
	if ( tc == CHARA_PLAYER ) {
		if ( gTraitPoint > 0 ) {
			list(0, listmax) = -1, 0
			listmax++
		}
	}
	else {
		if ( ocFeatsAcquirable(tc) > 0 ) {
			list(0, listmax) = -1, 0
			listmax++
		}
	}
	f = 0
	repeat 300
		traitmode = 0
		tid = cnt
		r1 = tc
		gosub *trait_ref
		if ( stat == 0 ) {
			continue
		}
		if ( stat == 1 ) {
			if ( traitref == 0 ) {
				if ( traitref(1) >= 0 ) {
					if ( tc == CHARA_PLAYER & gTraitPoint > 0 | ocFeatsAcquirable(tc) > 0 ) {
						list(0, listmax) = cnt, cnt + 1
						listmax++
					}
				}
				else {
					if ( traitref(1) < 0 ) {
						if ( cm == 1 ) {
							list(0, listmax) = cnt, cnt + 1
							listmax++
						}
					}
				}
			}
		}
		if ( gettrait(tc, cnt) != 0 ) {
			list(0, listmax) = cnt, 10000 + cnt + 1
			listmax++
			f++
		}
	loop
	if ( f != 0 ) {
		list(0, listmax) = -2, 10000
		listmax++
	}
	gosub *sort_list
	repeat listmax
		i = list(0, cnt)
		if ( i < 0 ) {
			if ( i == (-1) ) {
				if ( jp ) {
					s = "◆ 取得できるフィート"
				}
				else {
					s = "[Available feats]"
				}
			}
			if ( i == (-2) ) {
				if ( jp ) {
					s = "◆ 特徴と体質"
				}
				else {
					s = "[Feats and traits]"
				}
			}
			listn(0, cnt) = s
			continue
		}
		tid = i
		traitmode = 0
		r1 = tc
		gosub *trait_ref
		featrq = stat
		s = ""
		if ( list(1, cnt) < 10000 ) {
			if ( traitref(1) >= 0 ) {
				if ( gettrait(tc, tid) < traitref(2) ) {
					s = traitrefn2(gettrait(tc, tid))
				}
				else {
					s = traitrefn2(traitref(2) - 1) + "(MAX)"
				}
			}
			else {
				if ( gettrait(tc, tid) > traitref(1) ) {
					s = traitrefn2(abs(gettrait(tc, tid)))
				}
				else {
					s = traitrefn2(abs(traitref(1) + 1)) + "(MAX)"
				}
			}
			if ( featrq == (-1) ) {
				if ( jp ) {
					s += "(条件不足)"
				}
				else {
					s += "(requirement)"
				}
			}
			pos wx + 30, wy + 61 + cnt * 19
			x = 84
		}
		else {
			pos wx + 45, wy + 61 + cnt * 19
			x = 70
			if ( traitref == 0 ) {
				if ( jp ) {
					s = "[フィート]"
				}
				else {
					s = "[Feat]"
				}
			}
			if ( traitref == 1 ) {
				if ( jp ) {
					s = "[変異]"
				}
				else {
					s = "[Mutation]"
				}
			}
			if ( traitref == 2 ) {
				if ( jp ) {
					s = "[先天]"
				}
				else {
					s = "[Race]"
				}
			}
			if ( traitref == 3 ) {
				if ( jp ) {
					s = "[ｴｰﾃﾙ病]"
				}
				else {
					s = "[Disease]"
				}
			}
			s += traitrefn(2 + abs(gettrait(tc, tid)))
		}
		listn(0, cnt) = s
	loop
	r1 = tc
	if ( cRaceId(r1) == 0 ) {
		gosub *label_3896
	}
	sdim naturevalues, 3
	getfactionvalues tc, "nature", naturevalues
	repeat stat
		s = getfactionlabel(naturen, naturevalues(cnt))
		if ( s != "" ) {
			if ( strmid(s, -1, 2) != "い" ) {
				s += "だ"
			}
			list(0, listmax) = 1, 99999
			listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは" + s, "You are " + naturevalues(cnt) + ".")
			listmax++
		}
	loop
	if ( tc == CHARA_PLAYER & ncgSleepPotentialBonus > 0 ) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは祝福を受けている[次回睡眠時、潜在能力上昇量+", "You have been blessed.[sleep potential increase +") + (ncgSleepPotentialBonus / 2500 * 10 + 10) + "%]"
		listmax++
	}
	if ( eqfaction(tc, "slime") ) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは軟体だ[格闘/鈍器耐性強化]", "Your body is highly elastic. [Martial Arts/Blunt Resist]")
		listmax++
	}
	if ( eqfaction(tc, "dragon") ) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは竜の血脈だ[シャウト使用可 竜特効弱点]", "You possess dragon's blood. [Can scream, weak against dragon slaying weapons]")
		listmax++
	}
	if ( eqfaction(tc, "golem") ) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[先天]", "[Race]") + lang("あなたは硬体だ[PV+20 鈍器耐性弱化]", "Your body is rigid. [PV+20, weak against Blunt]")
		listmax++
	}
	if ( eqfaction(tc, "champ") ) {
		list(0, listmax) = 1, 10000
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは現チャンプだ", "You are the current putit champion.")
		listmax++
	}
	if ( getcgodno(tc) != (-1) ) {
		nc_intb_001 = stat
		repeat 5
			if ( usergoddatam(cnt + 10, nc_intb_001) <= cPiety(tc) & (usergoddatam(cnt + 15, nc_intb_001) == 0 | usergoddatam(cnt + 15, nc_intb_001) >= cPiety(tc)) & usergoddatanm(cnt + 5, nc_intb_001) != "" ) {
				list(0, listmax) = 1, 99999
				listn(0, listmax) = lang("[その他]", "[ETC]") + usergoddatanm(cnt + 5, nc_intb_001)
				listmax++
			}
			else {
				break
			}
		loop
	}
	if ( cbit(CHARA_BIT_INCOGNITO, tc) == TRUE ) {
		list(0, listmax) = 1, 99999
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは変装している", "You are disguising yourself.")
		listmax++
	}
	if ( cbit(CHARA_BIT_PREGNANT, tc) == TRUE ) {
		list(0, listmax) = 1, 99999
		if ( ocAlienChildCreatureID(tc) == 330 ) {
			listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは寄生されている", "You are pregnant.")
		}
		else {
			listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは妊娠している", "You are pregnant.")
		}
		listmax++
	}
	if ( cbit(CHARA_BIT_ANOREXIA, tc) == TRUE ) {
		list(0, listmax) = 1, 99999
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは拒食症だ", "You have anorexia.")
		listmax++
	}
	if ( cBodySpdFix(tc) != 0 ) {
		list(0, listmax) = 1, 99999
		listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたは複雑な体をしている[速度-" + cBodySpdFix(tc) + "%]", "Your body is complicated. [SPD-" + cBodySpdFix(tc) + "%]")
		listmax++
	}
	if ( tc == CHARA_PLAYER ) {
		if ( gEtherSpeed != 0 ) {
			if ( gEtherSpeed > 0 ) {
				list(0, listmax) = 1, 99999
				listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたのエーテル病の進行は早い。", "Your Ether disease grows fast.")
				listmax++
			}
			else {
				list(0, listmax) = 1, 99999
				listn(0, listmax) = lang("[その他]", "[ETC]") + lang("あなたのエーテル病の進行は遅い。", "Your Ether disease grows slow.")
				listmax++
			}
		}
	}
	repeat 100
		if ( nc_getskillname(100 + cnt) == "" ) {
			continue
		}
		if ( nc_gettrait(tc, 100 + cnt) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[職業]", "[Job]") + nc_getskilldesc(100 + cnt)
			listmax++
		}
	loop
	if ( filtercheck(tc, "horse") ) {
		if ( horse_getskill(tc, 0) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中に速度を上げる術を持っている", "You have increase speed during a race.") + "[Lv:" + horse_getskill(tc, 0) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 1) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中にスタミナを節約する術を持っている", "You have save stamina during a race.") + "[Lv:" + horse_getskill(tc, 1) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 2) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中に立ち回りを強化する術を持っている", "You have getting around during a race.") + "[Lv:" + horse_getskill(tc, 2) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 3) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレースの前半にスタミナを節約する術を持っている", "You have save stamina in the first half of the race.") + "[Lv:" + horse_getskill(tc, 3) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 4) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレースの後半にスタミナを節約する術を持っている", "You have save stamina late in the race.") + "[Lv:" + horse_getskill(tc, 4) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 5) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレースの後半に全力を上手く出す術を持っている", "You have getting the best out of late in the race.") + "[Lv:" + horse_getskill(tc, 5) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 6) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたはレース中にスタミナを回復する術を持っている", "You have regain stamina during a race.") + "[Lv:" + horse_getskill(tc, 6) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 7) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは駆け引きで敵を疲れやすくさせる術を持っている", "You have a way of tiring out enemies through bargaining.") + "[Lv:" + horse_getskill(tc, 7) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 8) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは駆け引きで敵の進行を停滞させる術を持っている", "You have the art of slowing down your enemies with bargaining.") + "[Lv:" + horse_getskill(tc, 8) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 9) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは敵の妨害に惑わされない力を持っている", "You have the power not to be distracted by the interference of your enemies.") + "[Lv:" + horse_getskill(tc, 9) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 10) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは晴れの日に力を発揮する", "You are a force to be reckoned with on a sunny day.") + "[Lv:" + horse_getskill(tc, 10) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 11) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース]", "[Race]") + lang("あなたは雨の日に力を発揮する", "You are a force to be reckoned with on a rain day.") + "[Lv:" + horse_getskill(tc, 11) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 21) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("竜頭蛇尾の力でレース開始時に速度が大幅に上がる", "The power of the Headlong greatly increase speed at the start of the race.") + "[Lv:" + horse_getskill(tc, 21) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 22) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("華麗なスライドで敵の追い抜きを防ぐ", "Prevent the enemy from overtaking with a brilliant slide.") + "[Lv:" + horse_getskill(tc, 22) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 23) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("レース後半であなたがトップの時に全力を出して逃げ切る", "Late in the race, when you're in the lead, give it your all and get away.") + "[Lv:" + horse_getskill(tc, 23) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 24) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("レース後半で追い抜く意地を見せ、様々な能力が強化される", "Show the will to overtake in the second half various abilities will be enhanced.") + "[Lv:" + horse_getskill(tc, 24) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 25) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("鉄壁の構えで後ろからの追い抜きを完全に防ぐことがある", "The ironclad stance may completely prevent you from overtaking from behind.") + "[Lv:" + horse_getskill(tc, 25) + "]"
			listmax++
		}
		if ( horse_getskill(tc, 26) > 0 ) {
			list(0, listmax) = 1, 10000
			listn(0, listmax) = lang("[レース/レア]", "[Race/rare]") + lang("レース後半でエーテルの風の勢いに乗り、速度を大幅に上昇させて敵の進行を大幅に妨げる", "Rides the momentum of the ether wind, greatly increasing its speed and greatly impeding the enemy's progress.") + "[Lv:" + horse_getskill(tc, 26) + "]"
			listmax++
		}
	}
	if ( cfg_dump == 0 ) {
		if ( dump_return == 1 ) {
			dump_return = 0
			return
		}
	}
	xnotesel buff2
	buff2 = ""
	repeat 30, 100
		if ( cdata(cnt, tc) \ EXT_EQUIP_SLOTS != 0 ) {
			ci = cdata(cnt, tc) \ EXT_EQUIP_SLOTS - 1
			repeat 15
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
					break
				}
				val = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci), inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci), 1, 0
				gosub *item_encdetail
				if ( s == "" ) {
					continue
				}
				xnoteadd s
			loop
		}
	loop
	if ( findbuff(tc, 62) == (-1) | have_bigench(tc, 3) == 1 ) {
		notesel buff2
		repeat noteinfo(0)
			noteget s, cnt
			list(0, listmax) = 1, 99999
			listn(0, listmax) = lang(his(tc, 1) + "装備は", cnven(his(tc, 1)) + " equipment ") + s
			listmax++
		loop
		noteunsel
	}
	if ( tc != CHARA_PLAYER ) {
		repeat listmax
			if ( jp ) {
				cnv_str listn(0, cnt), "あなた", he(tc, 1)
			}
			if ( en ) {
				cnv_str listn(0, cnt), " your", " " + his(tc, 1)
				cnv_str listn(0, cnt), " you", " " + him(tc, 1)
			}
		loop
	}
	if ( dump_return == 1 ) {
		dump_return = 0
		return
	}
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	if ( cs != 0 ) {
		if ( tc == CHARA_PLAYER & gTraitPoint == 0 | (tc != CHARA_PLAYER & ocFeatsAcquirable(tc) == 0) ) {
			cs = locvar_key_direction_cs
		}
	}
	locvar_key_direction_cs = 0
	if ( cs < 0 ) {
		repeat listmax
			if ( list(1, cnt) >= 10000 ) {
				if ( list(0, cnt) - 10000 == cs ) {
					page = cnt / pagesize
					cs = cnt \ pagesize
					break
				}
			}
		loop
		if ( cs < 0 ) {
			cs = 0
		}
	}

*com_trait_loop_WHILE1
	redraw 0
	s = lang("特徴と体質", "Feats and Traits"), lang("決定 [フィート取得]  " + strhint2 + strhint3, "Enter [Gain Feat]  " + strhint2 + strhint3) + "z,x [" + lang("仲間", "Ally") + "]"
	if ( mode == MODELIST_CHARA_CREATION ) {
		i = 1
	}
	else {
		i = 0
	}
	display_window (windoww - 730) / 2 + inf_screenx, winposy(430, i) + i * 15, 730, 430, 55, 40
	if ( jp ) {
		s = "特徴の名称", "段階", "特徴の効果"
	}
	else {
		s = "Name", "Level", "Detail"
	}
	display_topic s, wx + 46, wy + 36
	display_topic s(2), wx + 255, wy + 36
	pos wx + 46, wy - 16
	gcopy BUFFER_INF, 288 + 11 * 48, 48, 48, 48
	pos wx + ww - 56, wy + wh - 198
	gcopy BUFFER_INF, 960, 96, 48, 192
	pos wx, wy
	gcopy BUFFER_INF, 1008, 96, 48, 144
	pos wx + ww - 108, wy
	gcopy BUFFER_INF, 960, 288, 96, 72
	pos wx, wy + wh - 70
	gcopy BUFFER_INF, 1008, 240, 96, 48
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( list(0, p) < 0 ) {
			continue
		}
		if ( cnt \ 2 == 0 ) {
			pos wx + 57, wy + 66 + cnt * 19
			gfini 640, 18
			gfdec2 12, 14, 16
		}
		if ( list(1, p) >= 10000 | list(0, p) < 0 ) {
			continue
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	if ( tc == CHARA_PLAYER ) {
		s = lang("残り " + gTraitPoint + "個のフィートを取得できる", "You can acquire " + gTraitPoint + " feats")
	}
	else {
		s = cnven(cnName(tc)) + lang(" 残り " + ocFeatsAcquirable(tc) + "個のフィートを取得できる", " You can acquire " + ocFeatsAcquirable(tc) + " feats")
	}
	display_note s, 50
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		if ( i < 0 ) {
			color 0, 0, 0
			cs_list listn(0, p), wx + 114, wy + 66 + cnt * 19 - 1, 19, 0, -1
			continue
		}
		if ( list(1, p) != 99999 ) {
			tid = i
			traitmode = 0
			r1 = tc
			gosub *trait_ref
			featrq = stat
			if ( gettrait(tc, tid) == 0 ) {
				color 0, 0, 0
			}
			else {
				if ( gettrait(tc, tid) > 0 ) {
					color 0, 0, 200
				}
				else {
					color 200, 0, 0
				}
			}
		}
		else {
			traitref = 5
			color 0, 0, 0
		}
		if ( list(1, p) < 10000 ) {
			pos wx + 30, wy + 61 + cnt * 19
			x = 84
		}
		else {
			pos wx + 45, wy + 61 + cnt * 19
			x = 70
		}
		gcopy BUFFER_INF, 384 + traitref * 24, 336, 24, 24
		cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, -1
		if ( list(1, p) < 10000 ) {
			pos wx + 270, wy + 66 + cnt * 19 + 2
			mes traitrefn(2)
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = pagesize * page + cnt
			break
		}
	loop
	if ( tc == CHARA_PLAYER & gTraitPoint > 0 | ocFeatsAcquirable(tc) > 0 | cm == 1 ) {
		if ( p > 0 ) {
			if ( list(1, p) < 10000 ) {
				tid = list(TRAIT_NORMAL_OTHER_MUTANT, p)
				traitmode = 0
				r1 = tc
				gosub *trait_ref
				if ( traitref(1) >= 0 ) {
					if ( traitref(2) <= gettrait(tc, tid) ) {
						if ( mode != MODELIST_CHARA_CREATION ) {
							txt -1, lang("これ以上取得できない。", "You already have maxed out the feat.")
						}
						goto *com_trait_loop
					}
					if ( tc == CHARA_PLAYER ) {
						gTraitPoint--
					}
					else {
						ocFeatsAcquirable(tc)--
					}
					addtrait tc, tid, 1
				}
				else {
					if ( traitref(1) >= gettrait(tc, tid) ) {
						if ( mode != MODELIST_CHARA_CREATION ) {
							txt -1, lang("これ以上取得できない。", "You already have maxed out the feat.")
						}
						goto *com_trait_loop
					}
					if ( cm == 1 ) {
						gosub *cm_bg
						s = lang("これは不利になるフィートだ。本当に取得する？", "This feat handicaps your character. Really proceed?")
						gosub *screen_drawMsg2
						promptl(0, 0) = strno, "n", "0"
						promptl(0, 1) = stryes, "y", "1"
						promptmax = 2
						val = promptx, 240, 160, 1
						gosub *prompt_key
						if ( rtval != 1 ) {
							goto *com_trait_loop
						}
					}
					if ( tc == CHARA_PLAYER ) {
						gTraitPoint++
					}
					else {
						ocFeatsAcquirable(tc)++
					}
					addtrait tc, tid, -1
				}
				locvar_key_direction_cs = (-10000) + tid
				snd SOUNDLIST_DING3
				if ( tid == 67 ) {
					repeat 15, 1
						if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
							continue
						}
						r1 = cnt
						gosub *charaRefresh
					loop
				}
				r1 = tc
				gosub *charaRefresh
				if ( mode == MODELIST_CHARA_CREATION ) {
					if ( tc == CHARA_PLAYER & gTraitPoint == 0 | (tc != CHARA_PLAYER & ocFeatsAcquirable(tc) == 0) ) {
						return 1
					}
				}
				else {
					redraw 0
					gosub *screen_drawStatus
				}
				goto *com_trait_loop
			}
		}
	}
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 3 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 3
				}
			}
			if ( p != curmenu ) {
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					csctrl = 0
					goto *label_2879
				}
				if ( curmenu == 1 ) {
					goto *label_2943
				}
				if ( curmenu == 2 ) {
					goto *com_trait
				}
				if ( curmenu == 3 ) {
					goto *com_material
				}
			}
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_trait_loop
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_trait_loop
		}
	}
	if ( key == "z" | key == "x" ) {
		p = tc
		if ( locvar_check_adddamage_arrow_charamake == 0 ) {
			repeat 16
				if ( key == "z" ) {
					p--
					if ( p < 0 ) {
						p = 16 - 1
					}
				}
				if ( key == "x" ) {
					p++
					if ( p == 16 ) {
						p = 0
					}
				}
				if ( cExist(p) != CHAR_STATE_ALIVE ) {
					continue
				}
				break
			loop
		}
		tc = p
		snd SOUNDLIST_POP1
		page = 0
		cs = 0
		goto *com_trait_loop
	}
	if ( key == key_cancel ) {
		if ( mode == MODELIST_CHARA_CREATION ) {
			return 0
		}
		gosub *screen_draw
		goto *pc_turn
	}
	if ( mode == MODELIST_CHARA_CREATION ) {
		getkey p, 112
		if ( p ) {
			gosub *com_help
			return -1
		}
	}
	goto *com_trait_loop_WHILE1

*label_2649
	if ( jp ) {
		titlename(0) = "替え玉", "寺生まれ", "にらみつける", "猫騙し", "辻斬り成敗"
		titlename(5) = "チェックメイト", "突撃隣の晩御飯", "再殺部隊", "迷宮の制覇者", "猫まっしぐら"
		titlename(10) = "破壊兵器を破壊した" + _sex(cSex(CHARA_PLAYER)), "浄化者", "ジョン・コナー", "サディストキラー", "エレメンタルマスター"
		titlename(15) = "収穫者", "地球割り", "うみみゃあ！", "リストラ", "中に誰もいませんよ"
		titlename(20) = "神々の黄昏", "まさに善人", "カビキラー", "おうちかえす", "断末魔合唱団"
		titlename(25) = "戦鬼", "13番目の" + _sex(cSex(CHARA_PLAYER)), "だいまどう", "无", "ワンマン・アーミー"
		titlename(30) = "地獄の壁", "盲剣", "マッドサイエンティスト", "マネーの虎", "トレジャーハンター"
		titlename(35) = "お父様", "ステルス" + cnName(CHARA_PLAYER), "神罰の地上代行者", "パルミア一番！", "スーパー観光客"
		titlename(40) = "老魔法王", "力こそパワー", "二天", "カブ奴隷", "素顔ライダー"
		titlename(45) = "ザ・ベイベー", _onii3(rnd(6), cSex(CHARA_PLAYER)), "母を訪ねて", "旅立ちの日に", "1000人斬り"
		titlename(50) = "しあわせ家族計画", "挽肉の錬金術師", "ハンニバル・レクター", "浮気者", "億万長者"
		titlename(55) = "なんだか聞き覚えがある", "フェリックス・ハニカー", "夜道に注意", "私が町長です", "廃人"
		titlename(60) = "黒ずくめの" + _sex(cSex(CHARA_PLAYER)), "モンスター・ハンター", "終焉を喰らう者", "トバルカイン", "アテナ"
		titlename(65) = "アレス", "クピードー", "バステト", "クマリ", "デウス・エクス・マキナ"
		titlename(70) = "ディントス", "エヌルタ", "イシス", "カーリー", "クロノス"
		titlename(75) = "ビヨンド・ウィッシュ", "ガネーシャ", "戦を極めしもの", "知を極めしもの", "最果て"
		titlename(80) = "努力の証明・筋力", "努力の証明・耐久", "努力の証明・器用", "努力の証明・感覚", "努力の証明・習得"
		titlename(85) = "努力の証明・意思", "努力の証明・魔力", "努力の証明・魅力", "努力の証明・生命力", "努力の証明・マナ"
		titlename(90) = "烏合の衆", "技術革新", "ありのままで", "魔術士は二度死ぬ", "NECROMANIA"
		titlename(95) = "世界は回る 回るよ世界", "かもめの水兵さん", "レッドキャップ", "愛はティリスを救う", "あつまれ ようせいの森"
		titlename(100) = "技術は自由のために", "いまがﾁｬｿｽ！", "[[BIG]]の力", "牧畜物語", "鉄腕RUSH"
		titlename(105) = "消波ブロック", "牧羊犬", "俺たちの戦いはこれからだ！"
		titlename2(0) = "イークの首領『ルードルボ』を撃破", "ピラミッドの主『ツェン』を撃破", "火炎竜『ヴェスダ』を撃破", "猫使い『ケシー』を撃破", "ミノタウロスの王『ウンガガ』を撃破"
		titlename2(5) = "古城の主『ワイナン』を撃破", "赤き義眼の『クルイツゥア』及び鋼鉄竜『コルゴン』を撃破", "闇の奇形『イスシズル』を撃破", "偽りの預言者『ゼーム』を撃破", "猫の女王『フリージア』を撃破"
		titlename2(10) = "ゼイレン究極破壊兵器『ウティマ』を撃破", "不浄なる者『アズラシズル』を撃破", "《機械のマニ》を撃破", "《風のルルウィ》を撃破", "《元素のイツパロトル》を撃破"
		titlename2(15) = "《収穫のクミロミ》を撃破", "《地のオパートス》を撃破", "《幸運のエヘカトル》を撃破", "《癒しのジュア》を撃破", "《エヘカトルの中の神》を撃破"
		titlename2(20) = "全ての神を撃破", "無邪気な少女『グウェン』を100回殺害", "異形の森の使者『ロミアス』を100回殺害", "迷子の子猫を100回殺害", "吟遊詩人を100回殺害"
		titlename2(25) = "戦術スキルレベル100到達", "射撃スキル100到達", "詠唱、読書、暗記スキル合計300到達", "治癒、瞑想スキル合計200到達", "武器スキル合計300到達"
		titlename2(30) = "軽装備、中装備、重装備スキル合計100到達", "回避、見切り、心眼、盾スキル合計300到達", "遺伝子学、解剖学スキル合計200到達", "交渉、投資スキル合計200到達", "採掘、鍵開け、探知、罠解体、自然鑑定スキル合計200到達"
		titlename2(35) = "裁縫、錬金術、大工、宝石細工スキル合計100到達", "隠密、窃盗スキル合計150到達", "信仰スキル100到達", "料理スキル50到達", "旅歩き、釣りスキル合計50到達"
		titlename2(40) = "魔力の限界、魔力制御、魔道具スキル合計100到達", "重量挙げ、両手持ちスキル合計200到達", "二刀流スキル100到達", "栽培スキル100到達", "乗馬スキル100到達"
		titlename2(45) = "演奏スキル150到達", "妹の日記30冊読破", "合計7321マイル踏破", "旅立たせたペット数10体到達", "金銭を受け取る側での気持ちいいこと1000回到達"
		titlename2(50) = "作った子供の数10体到達", "人体錬成成功数5回到達", "食べた人肉の数1000枚到達", "大神七柱の信仰をAFを賜る程度まで高める", "所持金1億gp到達"
		titlename2(55) = "名声10万到達", "原子爆弾『Cat's Cradle』使用数50到達", "結婚相手30人到達", "ダンジョンの住人数50人到達", "すくつ1000階到達"
		titlename2(60) = "謎の奴隷商人からペットを47回購入", "ユニークモンスター20体撃破", "『秩序のユニコーン』を撃破", "ハンマーを転生させる", "生命力、マナ、速度、運を含めた全主能力2000到達"
		titlename2(65) = "1回の攻撃で2000万ダメージを与える", "愛情の証を1000回受け取る", "妹猫のイベントを1000回クリアする", "少女騎士団を1000回護りきる", "リトルシスターを1000回救助するか殺害する"
		titlename2(70) = "ハンマーで会心の出来を1000回作成", "全ての武器・戦術・射撃スキル2000到達", "全ての魔法レベル2000到達", "アリーナで1000回勝利", "プレイ時間1000時間突破"
		titlename2(75) = "《The Over Wish》を自身の力で撃破", "所持金100Igp到達", "NPC図鑑を100%コレクトする", "アイテム図鑑を100%コレクトする", "すくつ10000階到達/最大HP20億突破"
		titlename2(80) = "願い/BPを使用せずにPCとペットの筋力を計5000鍛える", "願い/BPを使用せずにPCとペットの耐久を計5000鍛える", "願い/BPを使用せずにPCとペットの器用を計5000鍛える", "願い/BPを使用せずにPCとペットの感覚を計5000鍛える", "願い/BPを使用せずにPCとペットの習得を計5000鍛える"
		titlename2(85) = "願い/BPを使用せずにPCとペットの意思を計5000鍛える", "願い/BPを使用せずにPCとペットの魔力を計5000鍛える", "願い/BPを使用せずにPCとペットの魅力を計5000鍛える", "願い/BPを使用せずにPCとペットの生命を計5000鍛える", "願い/BPを使用せずにPCとペットのマナを計5000鍛える"
		titlename2(90) = "《飢えた猟犬》を撃破", "《古代のミュータント》を撃破", "《氷窟の主》を撃破", "洞窟の主『サーペンテ』を撃破", "犠牲の代弁者『アオクス』を撃破"
		titlename2(95) = "混沌の妖精『カオシー』を撃破", "ポートセリアからポートカプールへの船を利用する", "シークレットゾーンでアイテムを10個交換する", "サウスティリスのサブクエストをすべて達成する", "フェアリゾートの土地を購入する"
		titlename2(100) = "任意のギルドに加入し、グランドマスターに昇進", "《汐路のセリア》の信仰をAFを賜る程度まで高める", "交易品を1スタックで50万GP以上利益を出して売却", "《牧畜のダイボニー》の信仰をAFを賜る程度まで高める", "ペットを牧場で100回繁殖させる"
		titlename2(105) = "《汐路のセリア》を撃破", "《牧畜のダイボニー》を撃破", "ならく5階到達"
	}
	else {
		titlename(0) = "Decoy", "Born in a Temple", "Leer", "Nekodamashi", "Phantom Slasher"
		titlename(5) = "Checkmate", "The Daily Lunch Show Special", "Repeat Kill Squad", "Champion of the Labyrinths", "Mach Speed Cat"
		titlename(10) = "Destroyed Destructive Weapons", "The Purifier", "John Connor", "Sadist Killer", "Elemental Master"
		titlename(15) = "Harvester", "Earth Splitter", "Mewmewmew!", "You're Fired!", "Nobody's Inside"
		titlename(20) = "Ragnarok", "Do Gooder", "Mold Killer", "Returning Home", "Wailing Choir"
		titlename(25) = "God of War", "The 13th", "Archmage", "Emptiness", "One Man Army"
		titlename(30) = "Hell's Wall", "The Blind Sword", "Mad Scientist", "Dragons' Den", "Treasure Hunter"
		titlename(35) = "Father", "Stealth", "Messenger of Justice", "Best in Palmia!", "Super Tourist"
		titlename(40) = "Elder Demon Pope", "Strength is Power", "Dual Wield Mastery", "Slave to Turnips", "Unmasked Rider"
		titlename(45) = "The Baby", _onii3(rnd(6), cSex(CHARA_PLAYER)), "Search of Mother", "The day we fly on our wings", "1000th Target 'Slayed'"
		titlename(50) = "Happy Family Plan", "Mincemeat Alchemist", "Hannibal Lecter", "The Unfaithful", "Billionaire"
		titlename(55) = "You sound familiar...", "Felix Hoenikker", "Nighttime Predator", "Hello, I am Mayor", "Junkie"
		titlename(60) = "Black Organization Member", "Monster Hunter", "Devourer of Ends", "Tubal-cain", "Athana"
		titlename(65) = "Areus", "Faunus", "Bastet", "Kumari", "Deus Ex Machina"
		titlename(70) = "Dints", "Nurta", "Isis", "Carly", "Chronos"
		titlename(75) = "Beyond Wish", "Ganesa", "Battle Master", "Item Master", "The End?"
		titlename(80) = "POW Charange", "END Charange", "DEX Charange", "PER Charange", "LER Charange"
		titlename(85) = "WIL Charange", "MAG Charange", "CHR Charange", "HP Charange", "MP Charange"
		titlename(90) = "Disorderly Crowd", "Innovation", "Let It Go", "Wizard Only Live Twice", "NECROMANIA"
		titlename(95) = "The world is spinning", "Seagull Sailors", "Redcap", "Love saves the Tyris", "Fairy Crossing: New Horizons"
		titlename(100) = "Technology for freedom", "NOW'S YOUR CHANCE TO BE A", "BIG SHOT", "Pastoralism Moon", "THE TETSUWAN RUSH"
		titlename(105) = "Tetrapod", "Sheep dog", "Censored"
		titlename2(0) = "Defeat <Rodlob> the boss of yeeks", "Defeat <Tuwen> the master of the pyramid", "Defeat <Vesda> the fire dragon", "Defeat <Cacy> the cat tamer", "Defeat <Ungaga> the minotaur king"
		titlename2(5) = "Defeat <Wynan> the lord of the Ancient Castle", "Defeat <Quruiza> the red-eyed Deceiver and <Corgon> the steel dragon", "Defeat <Issizzle> the dark abomination", "Defeat <Zeome> the false prophet", "Defeat <Frisia> the cat queen"
		titlename2(10) = "Defeat <Utima> the destroyer of Xeren", "Defeat <Azzrssil> the impure", "Defeat Mani of Machine", "Defeat Lulwy of Wind", "Defeat Itzpalt of Element"
		titlename2(15) = "Defeat Kumiromi of Harvest", "Defeat Opatos of Earth", "Defeat Ehekatl of Luck", "Defeat Jure of Healing", "Defeat <God inside Ehekatl>"
		titlename2(20) = "Defeat all 8 gods", "Kill <Gwen> the innocent 100 times", "Kill <Lomias> the messenger from Vindale 100 times", "Kill stray cat 100 times", "Kill bard 100 times"
		titlename2(25) = "Reach 100 in Tactics", "Reach 100 in Marksman", "Reach 300 combined in casting, literacy, and memorization", "Reach 200 combined in healing and meditation", "Reach 300 combined in weapon skills"
		titlename2(30) = "Reach 100 combined in light, medium, and heavy armor", "Reach 300 combined in evasion, greater evasion, eye of mind, and shield", "Reach 200 combined in gene engineer and anatomy", "Reach 200 combined in negotiation and investing", "Get 200 mining/lock picking/detection/disarm trap/sense quality combined"
		titlename2(35) = "Reach 100 combined in tailoring, alchemy, carpentry, and jeweler", "Reach 150 combined in stealth and pickpocket", "Reach 100 in faith", "Reach 50 in cooking", "Reach 50 combined in traveling and fishing"
		titlename2(40) = "Reach 100 combined in magic capacity, control magic, and magic device", "Reach 200 combined in weight lifting and two hand", "Reach 100 in dual wield", "Reach 100 in gardening", "Reach 100 in riding"
		titlename2(45) = "Reach 150 in performer", "Read 30 little sister's diary", "Travel more than 7321 miles", "Let 10 pets go on journey", "Prostitute to others 1000 times"
		titlename2(50) = "Have 10 children", "Achieve 5 successful human transmutations", "Eat 1000 human flesh", "Increase favor until an artifact is rewarded for all gods.", "Achieve 100,000,000 gp"
		titlename2(55) = "Achieve 100,000 fame", "Use 50 nuclear bombs", "Achieve 30 marriage partners", "Reach 50 people living in dungeon", "Reach 1000th floor of Void"
		titlename2(60) = "Buy 47 pets from slave master.", "Defeat 20 unique monsters.", "Defeat <The Unicorn of Order>", "Reincarnate a hammer", "Reached 2000 main ability"
		titlename2(65) = "Causes 20 million damage.", "Receive a proof of love 1000 times.", "Clear a sister cat event 1000 times.", "Protect the Knights of the Girl 1000 times.", "Rescue or kill Little Sister 1000 times."
		titlename2(70) = "Create a meeting with a hammer 1000 times.", "All weapons, tactics, and shooting skills reach 2000.", "All magic skills reach 2000.", "Win 1000 times in the arena.", "Over 1000 hours of play time."
		titlename2(75) = "Defeat The Over Wish.", "Achieve 100I gp.", "All Enemy Kill.", "All Item Collect.", "Reach 10000th floor and 2000000000 MaxHP."
		titlename2(80) = "Train POW to a total of 5000.", "Train END to a total of 5000.", "Train DEX to a total of 5000.", "Train PER to a total of 5000.", "Train LER to a total of 5000."
		titlename2(85) = "Train WIL to a total of 5000.", "Train MAG to a total of 5000.", "Train CHR to a total of 5000.", "Train HP to a total of 5000.", "Train MP to a total of 5000."
		titlename2(90) = "Defeat <Hungry hound>", "Defeat <Ruins mutant>", "Defeat <Master of the ice cave>", "Defeat <Servente>", "Defeat <Aocus>"
		titlename2(95) = "Defeat <Chaosy>", "Take a boat from Serria to Kapul", "Exchange 10 items in the Secret Zone", "Complete all SouthTyris subquests", "Buy Fairy island."
		titlename2(100) = "Join any guild and be promoted to Grandmaster", "Increase favor until an artifact is rewarded for Serria", "Sell a stack of trade goods for a profit of 500,000 GP", "Increase favor until an artifact is rewarded for Dybony", "Breed a Pet 100 times at the farm"
		titlename2(105) = "Defeat Serria", "Defeat Dybony", "Reach 5th floor of Abyss"
	}
	listmax = 0
	page = 0
	pagesize = 15
	cs = 0
	tc = CHARA_PLAYER
	cs_bk = -1
	page_load
	ww = 700
	wh = 400
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	windowanime wx, wy, ww, wh, 10, 4
	redraw 0
	drawmenu 4
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_feat.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1

*label_2650
	listmax = 0
	repeat length(titlename)
		if ( cnt < 63 & curmenu == 0 ) {
			list(0, listmax) = cnt, cnt + 1
			listmax++
		}
		else {
			if ( cnt >= 63 & cnt < 90 & curmenu == 2 ) {
				list(0, listmax) = cnt, cnt + 1
				listmax++
			}
			else {
				if ( cnt >= 90 & curmenu == 1 ) {
					list(0, listmax) = cnt, cnt + 1
					listmax++
				}
			}
		}
	loop
	gosub *sort_list
	repeat listmax
		if ( ogdata(440 + list(0, cnt)) > 0 ) {
			s = titlename(list(0, cnt))
		}
		else {
			s = lang("？？？？？？", "??????")
		}
		pos wx + 30, wy + 61 + cnt * 19
		x = 84
		listn(0, cnt) = s
	loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_2653
	redraw 0
	s = lang("称号", "Titles")
	s(1) = lang("決定キー [効果オン/オフ]  ", "Enter [effect on/off]") + strhint5 + lang("条件を満たすことで称号を獲得できる", "Earn titles after fulfilling their conditions")
	i = 0
	display_window (windoww - 730) / 2 + inf_screenx, winposy(430, i) + i * 15, 730, 430, 55, 40
	if ( jp ) {
		s = "称号名", "条件"
	}
	else {
		s = "Title Name", "Conditions"
	}
	display_topic s, wx + 46, wy + 36
	display_topic s(1), wx + 255, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 57, wy + 66 + cnt * 19
			gfini 640, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, 4, list(0, p)
		pos wx + 270, wy + 66 + cnt * 19 + 2
		mes titlename2(list(0, p))
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p >= 0 ) {
		if ( ogdata(440 + p) > 0 ) {
			snd SOUNDLIST_SPEND1
			if ( ogdata(440 + p) == 2 ) {
				ogdata(440 + p) = 1
			}
			else {
				ogdata(440 + p) = 2
			}
			goto *label_2650
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_2650
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_2650
		}
	}
	if ( key == key_identify ) {
		title_pos = list(0, pagesize * page + cs)
		gosub *com_identify
		goto *label_2649
	}
	if ( key == key_cancel ) {
		gosub *screen_draw
		if ( ogTitleDecoy == 2 ) {
			spact(SKILL_SPACT_SUMMON_YEEK - STARTING_SKILL_SPACT) = 1
		}
		else {
			spact(SKILL_SPACT_SUMMON_YEEK - STARTING_SKILL_SPACT) = 0
		}
		if ( ogTitleNekodamashi == 2 ) {
			spact(SKILL_SPACT_SUMMON_CATS - STARTING_SKILL_SPACT) = 1
		}
		else {
			spact(SKILL_SPACT_SUMMON_CATS - STARTING_SKILL_SPACT) = 0
		}
		if ( ogTitleCheckmate == 2 ) {
			spact(SKILL_SPACT_SUMMON_PAWN - STARTING_SKILL_SPACT) = 1
		}
		else {
			spact(SKILL_SPACT_SUMMON_PAWN - STARTING_SKILL_SPACT) = 0
		}
		if ( ogTitleTheDailyLunchShowSpecial == 2 ) {
			spact(SKILL_SPACT_SUMMON_FIRE - STARTING_SKILL_SPACT) = 1
		}
		else {
			spact(SKILL_SPACT_SUMMON_FIRE - STARTING_SKILL_SPACT) = 0
		}
		if ( ogTitleBrotherSister == 2 ) {
			spact(SKILL_SPACT_SUMMON_SISTER - STARTING_SKILL_SPACT) = 1
		}
		else {
			spact(SKILL_SPACT_SUMMON_SISTER - STARTING_SKILL_SPACT) = 0
		}
		if ( ogTitleTreasureHunter == 2 ) {
			ospact(906 - 661) = 1
		}
		else {
			ospact(906 - 661) = 0
		}
		if ( ogTitleMincemeatAlchemist == 2 ) {
			ospact(909 - 661) = 1
		}
		else {
			ospact(909 - 661) = 0
		}
		if ( ogTitleNecromania == 2 ) {
			ospact(796 - 661) = 1
		}
		else {
			ospact(796 - 661) = 0
		}
		menucycle = 0
		goto *pc_turn
	}
	if ( key == key_next | key == key_prev ) {
		p = curmenu
		if ( key == key_next ) {
			curmenu++
			if ( curmenu > 2 ) {
				curmenu = 0
			}
		}
		if ( key == key_prev ) {
			curmenu--
			if ( curmenu < 0 ) {
				curmenu = 2
			}
		}
		if ( p != curmenu ) {
			screenupdate = -1
			goto *label_2649
		}
	}
	goto *label_2653

*com_identify
	snd SOUNDLIST_POP2
	page_save
	page = 0
	pagesize = 15
	listmax = 0
	p = 0
	s = ""
	title_description = "", "", ""
	if ( title_pos == 0 ) {
		title_description(1) = lang("\t\t称号の効果：\nイークを召喚できるようになる。\nPCとペットの食事にかかるターンが半分になる。", "\t\tTitle effect:\nAble to summon yeeks.\nHalf the turn to eat.")
		title_description(2) = lang("イークの首領『ルードルボ』殺害数：", "<Rodlob> the boss of yeeks killed: ") + npcmemory(0, CREATURE_ID_RODLOB_THE_YEEK_CHIEF)
	}
	if ( title_pos == 1 ) {
		title_description(1) = lang("\t\t称号の効果：\nたまに呪いを無効にする。", "\t\tTitle effect:\nSometimes invalidate curses.")
		title_description(2) = lang("ピラミッドの主『ツェン』殺害数：", "<Tuwen> the master of the pyramid killed: ") + npcmemory(0, CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID)
	}
	if ( title_pos == 2 ) {
		title_description(0) = "キッ"
		title_description(1) = lang("\t\t称号の効果：\n物理攻撃命中時、稀に相手の軽減率を低下させてダメージを算出する。", "\t\tTitle effect:\nWhen physical attack hits, has a rare chance to deal damage after reducing enemy protection.")
		title_description(2) = lang("火炎竜『ヴェスダ』殺害数：", "<Vesda> the fire dragon killed: ") + npcmemory(0, CREATURE_ID_VESDA_THE_FIRE_DRAGON)
	}
	if ( title_pos == 3 ) {
		title_description(1) = lang("\t\t称号の効果：\n猫を召喚できるようになる。", "\t\tTitle effect:\nAble to summon cats.")
		title_description(2) = lang("猫使い『ケシー』殺害数：", "<Cacy> the cat tamer killed: ") + npcmemory(0, CREATURE_ID_CACY_THE_CAT_TAMER)
	}
	if ( title_pos == 4 ) {
		title_description(1) = lang("\t\t称号の効果：\nミノタウロスの王『ウンガガ』が通常モンスターとして出現する。", "\t\tTitle effect:\n<Ungaga> the minotaur king will now appear as part of the normal monster roster.")
		title_description(2) = lang("ミノタウロスの王『ウンガガ』殺害数：", "<Ungaga> the minotaur king killed: ") + npcmemory(0, CREATURE_ID_UNGAGA_THE_MINOTAUR_KING)
	}
	if ( title_pos == 5 ) {
		title_description(1) = lang("\t\t称号の効果：\n駒を召喚できるようになる。", "\t\tTitle effect:\nAble to summon chess pieces.")
		title_description(2) = lang("古城の主『ワイナン』殺害数：", "<Wynan> the lord of the Ancient Castle killed: ") + npcmemory(0, CREATURE_ID_WYNAN_THE_LORD_OF_THE_ANCIENT_CASTLE)
	}
	if ( title_pos == 6 ) {
		title_description(1) = lang("\t\t称号の効果：\n炎の生き物を召喚できるようになる。", "\t\tTitle effect:\nAble to summon flame creatures.")
		title_description(2) = lang("赤き義眼の『クルイツゥア』殺害数：", "<Quruiza> the red-eyed Deceiver killed: ") + npcmemory(0, CREATURE_ID_QURUIZA_THE_RED_EYED_DECEIVER) + "\n" + lang("鋼鉄竜『コルゴン』殺害数：", "<Corgon> the steel dragon killed: ") + npcmemory(0, CREATURE_ID_CORGON_THE_STEEL_DRAGON)
	}
	if ( title_pos == 7 ) {
		title_description(1) = lang("\t\t称号の効果：\n女性アンデッドに与えるダメージが増加する。\n混沌の城の主が毎月1日に復活するようになる。", "\t\tTitle effect:\nIncreases damage dealt to female undeads.\nThe lords of Forts of Chaos on the first day of the month.")
		title_description(2) = lang("闇の奇形『イスシズル』殺害数：", "<Issizzle> the dark abomination killed: ") + npcmemory(0, CREATURE_ID_ISSIZZLE_THE_DARK_ABOMINATION)
	}
	if ( title_pos == 8 ) {
		title_description(1) = lang("\t\t称号の効果：\nレシマスの1階に帰還することができる。\n任意のペットを店番に任命することができる。", "\t\tTitle effect:\nCan return to the first floor of Lesimas.\nCan Any pet be assigned to the shop keeper.")
		title_description(2) = lang("偽りの預言者『ゼーム』殺害数：", "<Zeome> the false prophet killed: ") + npcmemory(0, CREATURE_ID_ZEOME_THE_FALSE_PROPHET)
	}
	if ( title_pos == 9 ) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと任意の街に帰還することができる。", "\t\tTitle effect:\nCan return to any towns you have visited via blessed scroll of return.")
		title_description(2) = lang("猫の女王『フリージア』殺害数：", "<Frisia> the cat queen killed: ") + npcmemory(0, CREATURE_ID_FRISIA_THE_CAT_QUEEN)
	}
	if ( title_pos == 10 ) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと任意のノースティリスの混沌の城に帰還することができる。", "\t\tTitle effect:\nCan return to any Forts of Chaos via blessed scroll of return.")
		title_description(2) = lang("ゼイレン究極破壊兵器『ウティマ』殺害数：", "<Utima> the destroyer of Xeren killed: ") + npcmemory(0, CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN)
	}
	if ( title_pos == 11 ) {
		title_description(1) = lang("\t\t称号の効果：\nノースティリスの混沌の城の模様替えが出来るようになる。", "\t\tTitle effect:\nCan recolor the castle of chaos in North Tyris.")
		title_description(2) = lang("不浄なる者『アズラシズル』殺害数：", "<Azzrssil> the impure killed: ") + npcmemory(0, CREATURE_ID_AZZRSSIL_THE_IMPURE)
	}
	if ( title_pos == 12 ) {
		title_description(1) = lang("\t\t称号の効果：\n機械のマニ信仰時、みだれうちの回数が最大値で固定される。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《機械のマニ》殺害数：", "<Mani> killed: ") + npcmemory(0, CREATURE_ID_MANI)
	}
	if ( title_pos == 13 ) {
		title_description(1) = lang("\t\t称号の効果：\n風のルルウィ信仰時、鈍足の効果で速度が低下しなくなる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《風のルルウィ》殺害数：", "<Lulwy> killed: ") + npcmemory(0, CREATURE_ID_LULWY)
	}
	if ( title_pos == 14 ) {
		title_description(1) = lang("\t\t称号の効果：\n元素のイツパロトル信仰時、\n火で消失したアイテムをマテリアルに変換できる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《元素のイツパロトル》殺害数：", "<Itzpalt> killed: ") + npcmemory(0, CREATURE_ID_ITZPALT)
	}
	if ( title_pos == 15 ) {
		title_description(1) = lang("\t\t称号の効果：\n収穫のクミロミ信仰時、★クミロミ像を無制限に使用できる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《収穫のクミロミ》殺害数：", "<Kumiromi> killed: ") + npcmemory(0, CREATURE_ID_KUMIROMI)
	}
	if ( title_pos == 16 ) {
		title_description(1) = lang("\t\t称号の効果：\n地のオパートス信仰時、採掘に必要なターン数が大幅に減少する。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《地のオパートス》殺害数：", "<Opatos> killed: ") + npcmemory(0, CREATURE_ID_OPATOS)
	}
	if ( title_pos == 17 ) {
		title_description(1) = lang("\t\t称号の効果：\n幸運のエヘカトル信仰時、\n宝の地図から稀に珍しいものが手に入るようになる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《幸運のエヘカトル》殺害数：", "<Ehekatl> killed: ") + npcmemory(0, CREATURE_ID_EHEKATL)
	}
	if ( title_pos == 18 ) {
		title_description(1) = lang("\t\t称号の効果：\n癒しのジュア信仰時、低確率で死を回避できる。", "\t\tTitle effect:\nCan recolor the castle of chaos.")
		title_description(2) = lang("《癒しのジュア》殺害数：", "<Jure> killed: ") + npcmemory(0, CREATURE_ID_JURE)
	}
	if ( title_pos == 19 ) {
		title_description(1) = lang("\t\t称号の効果：\n願いで《エヘカトルの中の神》を降臨させることができるようになる。", "\t\tTitle effect:\nCan summon <God inside Ehekatl> via wish.")
		title_description(2) = lang("《エヘカトルの中の神》殺害数：", "<God inside Ehekatl> killed: ") + npcmemory(0, CREATURE_ID_GOD_INSIDE_EHEKATL)
	}
	if ( title_pos == 20 ) {
		title_description(1) = lang("\t\t称号の効果：\nゲロバグが復活する。\n魔術師の収穫を纏めて唱えることができるようになる。", "\t\tTitle effect:\nCan capture any monsters by letting them vomit.\ncan now summon the magic harvest.")
	}
	if ( title_pos == 21 ) {
		title_description(1) = lang("\t\t称号の効果：\nカルマ上限が20上昇する。", "\t\tTitle effect:\nIncreases upper limit of karma by 20.")
		title_description(2) = lang("無邪気な少女『グウェン』殺害数：", "<Gwen> the innocent killed: ") + npcmemory(0, CREATURE_ID_GWEN_THE_INNOCENT)
	}
	if ( title_pos == 22 ) {
		title_description(1) = lang("\t\t称号の効果：\nパーティー会場に異形の森の使者『ロミアス』が存在する場合、\nパーティー開始時に告知される。", "\t\tTitle effect:\nIf <Lomias> the messenger exists in party time, \nit will be announced at its start.")
		title_description(2) = lang("異形の森の使者『ロミアス』殺害数：", "<Lomias> the messenger from Vindale killed: ") + npcmemory(0, CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE)
	}
	if ( title_pos == 23 ) {
		title_description(1) = lang("\t\t称号の効果：\n迷子の子猫に帰還の巻物を渡すことができる。\nわが家の任意の地下階層に帰還することができる。", "\t\tTitle effect:\nCan give scrolls of return to stray cats.\nCan return to any level of your home.")
		title_description(2) = lang("迷子の子猫殺害数：", "Stray cats killed: ") + npcmemory(0, CREATURE_ID_STRAY_CAT)
	}
	if ( title_pos == 24 ) {
		title_description(1) = lang("\t\t称号の効果：\n演奏者への投石ダメージが上昇する。\nPCの演奏が下手でも石を投げられなくなる。", "\t\tTitle effect:\nIncrease thrown stone damage to performers.\nNo more rocks flying into the PC performance.")
		title_description(2) = lang("吟遊詩人殺害数：", "Bards killed: ") + npcmemory(0, CREATURE_ID_BARD)
	}
	if ( title_pos == 25 ) {
		title_description(1) = lang("\t\t称号の効果：\nスウォームの効果範囲が拡大する。", "\t\tTitle effect:\nExpands effective range of Swarm.")
		title_description(2) = lang("バブル殺害数：", "Bubbles killed: ") + npcmemory(0, CREATURE_ID_BUBBLE) + "\n" + lang("ブルーバブル殺害数：", "Blue bubbles killed: ") + npcmemory(0, CREATURE_ID_BLUE_BUBBLE) + "\n" + lang("塊の怪物殺害数：", "Mass monsters killed: ") + npcmemory(0, CREATURE_ID_MASS_MONSTER) + "\n" + lang("キューブ殺害数：", "Cubes killed: ") + npcmemory(0, CREATURE_ID_CUBE)
	}
	if ( title_pos == 26 ) {
	}
	if ( title_pos == 27 ) {
		title_description(1) = lang("\t\t称号の効果：\n装備による上限を無視して詠唱成功率が5%底上げされる。", "\t\tTitle effect:\nIncreases absolute casting success rate by 5%.")
	}
	if ( title_pos == 28 ) {
		title_description(1) = lang("\t\t称号の効果：\nスタミナの自然回復量が上昇する。", "\t\tTitle effect:\nIncreases natural stamina regeneration.")
	}
	if ( title_pos == 30 ) {
		title_description(1) = lang("\t\t称号の効果：\nペットに対する敵意をPCに転嫁する。", "\t\tTitle effect:\nShifts aggro from pets to player.")
	}
	if ( title_pos == 31 ) {
		title_description(1) = lang("\t\t称号の効果：\n盲目状態でも周囲2マスの敵の居場所が把握できる。", "\t\tTitle effect:\nCan see the enemy's place even in the blind.")
	}
	if ( title_pos == 32 ) {
		title_description(1) = lang("\t\t称号の効果：\n残骸の出現率が上昇する。", "\t\tTitle effect:\nIncreases drop chance for monster parts.")
	}
	if ( title_pos == 33 ) {
		title_description(1) = lang("\t\t称号の効果：\n大口投資ができるようになる。\nさらに所持金全てを投資できるようになる。", "\t\tTitle effect:\nInvesting large amounts at a time is now possible.\nIn addition, can invest whole of your gold pieces at once.")
	}
	if ( title_pos == 34 ) {
		title_description(1) = lang("\t\t称号の効果：\n脱出できるようになる。", "\t\tTitle effect:\nCan Escape anytime.")
	}
	if ( title_pos == 35 ) {
		title_description(1) = lang("\t\t称号の効果：\nレシピでの調合時の最大作成可能個数が増加する。", "\t\tTitle effect:\nAble to blend up to more items at once.")
		title_description(2) = lang("最大作成可能個数：", "Max Count:") + (1000 + (sCarpentry(CHARA_PLAYER) + sTailor(CHARA_PLAYER) + sAlchemy(CHARA_PLAYER) + sJeweller(CHARA_PLAYER)) / 10)
	}
	if ( title_pos == 36 ) {
		title_description(1) = lang("\t\t称号の効果：\n盗みを見咎められたときにたまにうまくやりすごすことができる。", "\t\tTitle effect:\nWhile stealing, you will sometimes be able to skillfully evade detection.")
	}
	if ( title_pos == 37 ) {
		title_description(1) = lang("\t\t称号の効果：\n異教徒に与えるダメージが増加し、同教徒に与えるダメージが減少する。", "\t\tTitle effect:\nIncreases damage dealt to others following a different god while decreasing damage to those following the same god.")
	}
	if ( title_pos == 38 ) {
		title_description(1) = lang("\t\t称号の効果：\n任意の料理を作ることができるようになる。\n一括料理が可能になる。", "\t\tTitle effect:\nAble to make any dish of your choosing.\nBulk cooking becomes possible.")
	}
	if ( title_pos == 39 ) {
		title_description(1) = lang("\t\t称号の効果：\n探索コマンドでユニークモンスターがマップ上に存在する場合\nその方角が分かるようになる。", "\t\tTitle effect:\nSearch command will tell you if a unique monster exists on the map.")
	}
	if ( title_pos == 40 ) {
		title_description(1) = lang("\t\t称号の効果：\n魔道具を失敗することなく扱うことができるようになる。", "\t\tTitle effect: Able to zap rods without failure.\n")
	}
	if ( title_pos == 41 ) {
		title_description(1) = lang("\t\t称号の効果：\n両手持ちのときにスウォームの効果範囲が拡大する。", "\t\tTitle effect:\nWhen two-hand wielding, expands effective range of Swarm.")
	}
	if ( title_pos == 42 ) {
		title_description(1) = lang("\t\t称号の効果：\n二刀流状態のときに二度目の追加打撃が発生することがある。", "\t\tTitle effect:\nWhen dual wielding it is possible to make a 2nd extra attack from an extra attack.")
	}
	if ( title_pos == 43 ) {
		title_description(1) = lang("\t\t称号の効果：\n自動収穫で実っている作物のみを収穫できる。", "\t\tTitle effect:\nCan choose only fruits when auto-harvesting.")
	}
	if ( title_pos == 44 ) {
		title_description(1) = lang("\t\t称号の効果：\n異名を願った時、自由に決められるようになる。", "\t\tTitle effect:\nWhen you ask for a synonym, you will be able to decide freely.")
	}
	if ( title_pos == 45 ) {
		title_description(1) = lang("\t\t称号の効果：\n演奏依頼が出現しやすくなる。", "\t\tTitle effect:\nPart time quests tends to appear up more often.")
	}
	if ( title_pos == 46 ) {
		title_description(1) = lang("\t\t称号の効果：\n妹を召喚できるようになる。", "\t\tTitle effect:\nAble to summon younger sister.")
		title_description(2) = lang("妹の日記読破数：" + ogTimesReadYoungerSistersDiary + "冊", "Number of little sister's diary read: " + ogTimesReadYoungerSistersDiary + " diaries")
	}
	if ( title_pos == 47 ) {
		title_description(1) = lang("\t\t称号の効果：\nグローバルマップでの移動に要するターン数が減少する。", "\t\tTitle effect:\nReduces amount of turns used when moving on global map.")
		title_description(2) = lang("総歩行距離：" + ogTotalTravelDistance + "マイル", "Total distance traveled: " + ogTotalTravelDistance + " miles")
	}
	if ( title_pos == 48 ) {
		title_description(1) = lang("\t\t称号の効果：\nわが家に来客を5人まで留め置くことができる。", "\t\tTitle effect:\nUp to 5 guests can be kept at your home.")
		title_description(2) = lang("旅立たせたペットの数:", "Number of pets going on their journey: ") + ogTimesSentPets
	}
	if ( title_pos == 49 ) {
		title_description(1) = lang("\t\t称号の効果：\n気持ちいいことをしても病気にならなくなる。", "\t\tTitle effect:\nWill not get sick when prostituting.")
		title_description(2) = lang("売り手側で気持ちいいことをした回数： " + ogTimesSoldOwnBody + "回", "Number of sexes: " + ogTimesSoldOwnBody + " times")
	}
	if ( title_pos == 50 ) {
		title_description(2) = lang("作った子供の数:", "Your children: ") + ogTimesMadeChildren
	}
	if ( title_pos == 51 ) {
		title_description(1) = lang("\t\t称号の効果：\nモツ抜きできるようになる。\n遺伝子合成機で特殊行動の遺伝が可能になる。\n攻撃者の解剖学スキルに応じた確率で残骸の追加ドロップが発生する。", "\t\tTitle effect:\nAble to do Pounding Out.\nAdditional debris drops with a probability that depends on the attacker's anatomy skill.")
		title_description(2) = lang("人体錬成成功数:", "Human transmutations: ") + ogTimesDidHumanAlchemy + lang("", " times")
	}
	if ( title_pos == 52 ) {
		title_description(1) = lang("\t\t称号の効果：\n人肉を食べても発狂しなくなる。", "\t\tTitle effect:\nEating human flesh no longer causes you to go insane.")
		title_description(2) = lang("食べた人肉の数:", "Human flesh you have eaten: ") + ogTimesAteHumanFlesh
	}
	if ( title_pos == 53 ) {
		title_description(1) = lang("\t\t称号の効果：\n神の使徒を制限なく仲間にできる。", "\t\tTitle effect:\nCan keep as many god pets as you wish.")
		s(1) = lang("マニ", "Mani"), lang("ルルウィ", "Lulwy"), lang("イツパロトル", "Itzpalt"), lang("エヘカトル", "Ehekatl"), lang("オパートス", "Opatos"), lang("ジュア", "Jure"), lang("クミロミ", "Kumiromi")
		title_description(2) = lang("信仰の完了状況:\n", "Current state\n")
		repeat 7, 1
			title_description(2) += s(cnt)
			if ( ogbit(cnt) ) {
				title_description(2) += lang(":○\n", ": Done\n")
			}
			else {
				title_description(2) += lang(":×\n", ":\n")
			}
		loop
	}
	if ( title_pos == 54 ) {
		title_description(1) = lang("\t\t称号の効果：\nわが家で雇うことのできる使用人の数の上限が上昇する。", "\t\tTitle effect:\nIncreases limit of how many employees you can hire at your home.")
	}
	if ( title_pos == 55 ) {
		title_description(1) = lang("\t\t称号の効果：\nグローバルマップでたまに少女騎士団と遭遇するようになる。", "\t\tTitle effect:\nAllows you to sometimes encounter Knights of the Little Girls while traveling in global map.")
	}
	if ( title_pos == 56 ) {
		title_description(1) = lang("\t\t称号の効果：\n原子爆弾『Cat's Cradle』の効果範囲が拡大する。\n原子爆弾『Cat's Cradle』をまとめ買い出来るようになる。\n原子爆弾『Cat's Cradle』の威力が上昇する。", "\t\tTitle effect:\nIncreases effective range of nuclear bomb explosion.\nAble to buy 10 or 100 atomic bombs at one deal.\nIncreases the damage of nuclear bomb explosion.")
		title_description(2) = lang("原子爆弾『Cat's Cradle』使用数:", "Bombarded atomic bombs: ") + ogTimesUsedNuke + "\n" + lang("現在の威力:", "Current damage: ") + (1000 + ogTimesUsedNuke * 5)
	}
	if ( title_pos == 57 ) {
		title_description(2) = lang("結婚人数:", "Number of people you married: ") + ogTimesMarried
	}
	if ( title_pos == 58 ) {
		title_description(1) = lang("\t\t称号の効果：\n自分の物件に名前を付けられるようになる。", "\t\tTitle effect:\nCan name your home.")
	}
	if ( title_pos == 59 ) {
		title_description(1) = lang("\t\t称号の効果：\n全てのキャラのステータス上限が上昇する。(無効化していても発動)\nすくつの任意の階に帰還できる。\n呪われた帰還の巻物を読む事で、クリップルタウンに行くことが出来る。", "\t\tTitle effect:\nIncreases the status limit.(passive)\nCan return any level of the Void.\nYou can go to Void Town by reading cursed scroll of return.")
	}
	if ( title_pos == 60 ) {
		title_description(1) = lang("\t\t称号の効果：\nグローバルマップでたまに微笑む斬殺者と遭遇するようになる。", "\t\tTitle effect:\nAllows you to sometimes encounter the Smiling Witch while traveling in global map.")
		title_description(2) = lang("謎の奴隷商人からペットを購入した回数:", "Number of deals with the slave master: ") + ogPurchasedSlaveCount
	}
	if ( title_pos == 61 ) {
		title_description(1) = lang("\t\t称号の効果：\n『秩序のユニコーン』が出現するようになる。", "\t\tTitle effect:\nAllows <The Unicorn of Order> to randomly appear.")
		title_description(2) = lang("ユニークモンスター撃破数:", "Unique monsters killed: ") + ogUniqueMonsterKillCount
	}
	if ( title_pos == 62 ) {
		title_description(1) = lang("\t\t称号の効果：\nユニークモンスターが何度でも出現する。", "\t\tTitle effect:\nUnique monsters will appear again after defeat.")
		title_description(2) = lang("『秩序のユニコーン』撃破数:", "<The Unicorn of Order> killed: ") + getcnpcmemory4name(0, "The Unicorn of Order")
	}
	if ( title_pos == 63 ) {
		title_description(1) = lang("\t\t称号の効果：\n生きている武器へ付与されるエンチャントが強化される。\n武器強化・魔法強化の巻物で付与されるエンチャントも強化される。\n名前の巻物使用中に次のレベルアップで提示されるエンチャント及び継承できるエンチャントが分かるようになる。", "\t\tTitle effect:\nBuff the strength of enchantments added to living weapons.\nSee the Enchantments presented during the use of the name scroll.")
		title_description(2) = lang("一つのハンマーを転生させた最大数:", "Number of times to reincarnate one hammer: ") + ogSmithingTargetEnchantment
	}
	if ( title_pos == 64 ) {
		title_description(1) = lang("\t\t称号の効果：\n潜在能力の下限と上限が50%上昇する。", "\t\tTitle effect:\nPotential is raised by 50%.")
	}
	if ( title_pos == 65 ) {
		title_description(1) = lang("\t\t称号の効果：\nダメージ上限が20億まで上昇する。", "\t\tTitle effect:\nIncreases damage limit to 20 billion.")
	}
	if ( title_pos == 66 ) {
		title_description(1) = lang("\t\t称号の効果：\n好感度が*Love*のペットのHP/MPと与えるダメージが上昇する。", "\t\tTitle effect:\nIncreases pet's HP / MP and damage dealt.")
		title_description(2) = lang("愛情の証を受け取った回数:", "Number of times received a proof of love: ") + ncgLoveJewels
	}
	if ( title_pos == 67 ) {
		title_description(1) = lang("\t\t称号の効果：\n妹猫のイベントの報酬が増加する。", "\t\tIncreases rewards for sister cat events.")
		title_description(2) = lang("遊んであげた回数:", "Event clear count : ") + ncgCatSisterEventsCleared
	}
	if ( title_pos == 68 ) {
		title_description(1) = lang("\t\t称号の効果：\n少女騎士団のイベントの報酬が増加する。", "\t\tIncreases rewards for Knights Events.")
		title_description(2) = lang("護りきった回数:", "Event clear count : ") + ncgKnightsEventsCleared
	}
	if ( title_pos == 69 ) {
		title_description(1) = lang("\t\t称号の効果：\n★リトル捕獲玉を持って遺伝子を残すことで、\n固定アーティファクトの引継ぎが可能になる。", "\t\tArtifacts can be inherited. need to have a little catch ball.")
	}
	if ( title_pos == 70 ) {
		title_description(1) = lang("\t\t称号の効果：\n会心の出来の装備の質が上昇する。\nスタミナが無くなるまで連続で作成することが出来るようになる。", "\t\tIncreases the quality of the equipment in the form of a conspiracy. You will be able to create continuously until you run out of stamina.")
		title_description(2) = lang("会心の出来を作成した回数:", "count : ") + ncgMakeGoodCount
	}
	if ( title_pos == 71 ) {
		title_description(1) = lang("\t\t称号の効果：\nマナ吸収とスタミナ吸収の効果が増加する。", "\t\tIncreases the effects of mana and stamina absorption.")
	}
	if ( title_pos == 72 ) {
		title_description(1) = lang("\t\t称号の効果：\n装備による上限を無視して詠唱成功率が更に5%底上げされる。", "\t\tTitle effect:\nIncreases absolute casting success rate by 5%.")
	}
	if ( title_pos == 73 ) {
		title_description(1) = lang("\t\t称号の効果：\nアリーナに挑戦者が現れる様になる。", "\t\tTitle effect:\nA challenger will appear in the arena.")
		title_description(2) = lang("累計勝利数:", "Wincount : ") + ncgArenaWinCount
	}
	if ( title_pos == 74 ) {
		title_description(1) = lang("\t\t称号の効果：\n普通にアイテムを願った時、装備を除き得られる個数が増加する。", "\t\tTitle effect:\nWhen you wish for an item, more items will rain down on you.")
	}
	if ( title_pos == 75 ) {
		title_description(1) = lang("\t\t称号の効果：\n願いの杖の合成が可能になる。\n願いの杖に+値まで充填が出来るようになる。", "\t\tTitle effect:\nCan charged rod of wish.")
	}
	if ( title_pos == 76 ) {
		title_description(1) = lang("\t\t称号の効果：\nペットに任命できる店の種類が増加する。\n『ジェン』に2147483647gp支払って装備を購入できるようになる。\n大金を貯金できる貯金箱が出現するようになる。", "\t\tTitle effect:\nThe types of stores that can be appointed as pets increase.\nYou will be able to pay 2,147,483,647gp to <Jen> to purchase equipment.\nA money box will appear where you can save a lot of money.")
	}
	if ( title_pos == 77 ) {
		title_description(1) = lang("\t\t称号の効果：\nシェイドの中身を看破することが出来る。", "\t\tTitle effect:\nCan see through the contents of the shade.")
	}
	if ( title_pos == 78 ) {
		title_description(1) = lang("\t\t称号の効果：\n生成されるアイテムが初めから識別された状態になる。", "\t\tTitle effect:\nItem is identified from the spawning.")
	}
	if ( title_pos == 79 ) {
		title_description(1) = lang("\t\t称号の効果：\n生成されるエンチャントの質が上昇する。\nミラルから特別なガロクの槌がもらえるようになる。", "\t\tTitle effect:\nIncreases the quality of enchantments generated.")
	}
	if ( title_pos >= 80 & title_pos < 90 ) {
		title_description(1) = lang("\t\t称号の効果：\n潜在能力の最大値が5%上昇する。", "\t\tTitle effect:\nIncreases maximum potential by 5%.")
	}
	if ( title_pos == 80 ) {
		title_description(2) = lang("鍛えた筋力:", "Points trained : ") + ncgPointsTrainedStr
	}
	if ( title_pos == 81 ) {
		title_description(2) = lang("鍛えた耐久:", "Points trained : ") + ncgPointsTrainedCon
	}
	if ( title_pos == 82 ) {
		title_description(2) = lang("鍛えた器用:", "Points trained : ") + ncgPointsTrainedDex
	}
	if ( title_pos == 83 ) {
		title_description(2) = lang("鍛えた感覚:", "Points trained : ") + ncgPointsTrainedPer
	}
	if ( title_pos == 84 ) {
		title_description(2) = lang("鍛えた習得:", "Points trained : ") + ncgPointsTrainedLer
	}
	if ( title_pos == 85 ) {
		title_description(2) = lang("鍛えた意思:", "Points trained : ") + ncgPointsTrainedWil
	}
	if ( title_pos == 86 ) {
		title_description(2) = lang("鍛えた魔力:", "Points trained : ") + ncgPointsTrainedMag
	}
	if ( title_pos == 87 ) {
		title_description(2) = lang("鍛えた魅力:", "Points trained : ") + ncgPointsTrainedCha
	}
	if ( title_pos == 88 ) {
		title_description(2) = lang("鍛えた生命力:", "Points trained : ") + ncgPointsTrainedLife
	}
	if ( title_pos == 89 ) {
		title_description(2) = lang("鍛えたマナ:", "Points trained : ") + ncgPointsTrainedMana
	}
	if ( title_pos == 90 ) {
		title_description(1) = lang("\t\t称号の効果：\n奴隷の質が上昇する。", "\t\tTitle effect:\nThe quality of the slaves will increase.")
	}
	if ( title_pos == 91 ) {
		title_description(1) = lang("\t\t称号の効果：\n採掘でアイテムが追加で出現することがある。", "\t\tTitle effect:\nAdditional items may appear in mining.")
	}
	if ( title_pos == 92 ) {
		title_description(1) = lang("\t\t称号の効果：\n依頼で入手できる金貨の量が増える。", "\t\tTitle effect:\nIncrease the amount of gold pieces available for requests from residents.")
	}
	if ( title_pos == 93 ) {
		title_description(1) = lang("\t\t称号の効果：\n変異種の洞窟の任意階に帰還できる。", "\t\tTitle effect:\nYou can return to any floor of the mutant cave.")
	}
	if ( title_pos == 94 ) {
		title_description(1) = lang("\t\t称号の効果：\nアンデッド召喚を使用できる。", "\t\tTitle effect:\nCan use undead summoning.")
	}
	if ( title_pos == 95 ) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと混沌の城《妖》に帰還することができる。\n混沌の城《妖》の模様替えが出来るようになる。\n混沌の妖精『カオシー』が毎月１日に復活するようになる。", "\t\tTitle effect:\nCan return to Forts of Chaos<fairy> via blessed scroll of return.\nCan recolor the Forts of Chaos<fairy>.\nThe lords of Forts of Chaos<Fairy> on the first day of the month.")
	}
	if ( title_pos == 96 ) {
		title_description(1) = lang("\t\t称号の効果：\n祝福された帰還の巻物を使うと別大陸の街に帰還することができる。", "\t\tTitle effect:\nCan return to city on a different continent via blessed scroll of return.")
	}
	if ( title_pos == 97 ) {
		title_description(1) = lang("\t\t称号の効果：\nシークレットゾーンへ帰還することが出来る。", "\t\tTitle effect:\nCan return to secret zone.")
	}
	if ( title_pos == 98 ) {
		title_description(1) = lang("\t\t称号の効果：\nカルマ上限が10上昇する。", "\t\tTitle effect:\nIncreases upper limit of karma by 10.")
		title_description(2) = lang("依頼達成数：", "Requests completed: ") + check_stquest_amount() + " / 8"
	}
	if ( title_pos == 99 ) {
		title_description(1) = lang("\t\t称号の効果：\nフェアリゾート限定の敵NPCが別大陸にも出現するようになる。", "\t\tTitle effect:\nEnemy NPCs that are exclusive to Fairy Zort will now appear on other continents.")
	}
	if ( title_pos == 100 ) {
		title_description(1) = lang("\t\t称号の効果：\nギルド移籍時、ある程度のギルドランクが保持される。", "\t\tTitle effect:\nWhen transferring guilds, a certain amount of guild rank is retained.")
	}
	if ( title_pos == 101 ) {
		title_description(1) = lang("\t\t称号の効果：\n盗賊団との遭遇時、交渉を行うことが出来る。", "\t\tTitle effect:\nWhen encountering bandits, you can negotiate with them.")
	}
	if ( title_pos == 102 ) {
		title_description(1) = lang("\t\t称号の効果：\n荷車の改造をより安く依頼できる。", "\t\tTitle effect:\nYou can ask for cheaper modifications to your cargo wagon.")
	}
	if ( title_pos == 103 ) {
		title_description(1) = lang("\t\t称号の効果：\n牧場にて、乳と卵の出現率が上昇する。", "\t\tTitle effect:\nIncreases the rate at which milk and eggs appear on the farm.")
	}
	if ( title_pos == 104 ) {
		title_description(1) = lang("\t\t称号の効果：\nペットの繁殖力が30上昇する。", "\t\tTitle effect:\nThe Breed Power of Pet is increased by 30.")
		title_description(2) = lang("繁殖数：", "Breed: ") + ncgLivestockBred
	}
	if ( title_pos == 105 ) {
		title_description(1) = lang("\t\t称号の効果：\n汐路のセリア信仰時、大雨がすぐに収まる。", "\t\tTitle effect:\nWhen believing in Serria, The heavy rain quickly subsided.")
	}
	if ( title_pos == 106 ) {
		title_description(1) = lang("\t\t称号の効果：\n牧畜のダイボニー信仰時、ペットの繁殖力が更に強化される。", "\t\tTitle effect:\nWhen believing in Dybony, The Breed Power of pets is further enhanced.")
	}
	if ( title_pos == 107 ) {
		title_description(1) = lang("\t\t称号の効果：\n商品交換に必要な小さなメダルの枚数が半分になる。", "\t\tTitle effect:\nThe number of small medals required to exchange goods is halved.")
	}
	if ( ogdata(440 + title_pos) == 0 ) {
		list(0, p) = 0
		listn(0, p) = lang("未取得", "Unacquired")
		p++
		title_description(0) = "", ""
	}
	repeat 3
		if ( title_description(cnt) == "" ) {
			continue
		}
		list(0, p) = 0
		listn(0, p) = ""
		p++
		buf = trimdesc(title_description(cnt), 2)
		notesel buf
		repeat noteinfo(0)
			noteget q, cnt
			p(1) = 66, 0
			if ( strlen(q) > p(1) ) {
				repeat strlen(q) / p(1) + 1
					if ( strmid(q, p(2) + p(1), 2) == "。" | strmid(q, p(2) + p(1), 2) == "、" ) {
						p(1) += 2
					}
					if ( strmid(q, p(2), p(1)) == "" ) {
						break
					}
					list(0, p) = -1
					listn(0, p) = strmid(q, p(2), p(1))
					p++
					p(2) += p(1)
				loop
			}
			else {
				list(0, p) = 0
				listn(0, p) = q
				if ( cnt == noteinfo(0) - 1 ) {
					list(0, p) = -1
				}
				p++
			}
		loop
	loop
	if ( ogdata(440 + title_pos) ) {
		if ( p == 0 ) {
			list(0, p) = 0
			listn(0, p) = lang("特に情報はない", "There is no information about this title.")
			p++
		}
	}
	listmax = p
	pagemax = (listmax - 1) / pagesize
	windowshadow = 1

*com_identify_loop_pgchk
	key_list = key_enter
	keyrange = 0
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_identify_loop
	redraw 0
	if ( curmenu == 0 ) {
		s = lang("称号の情報", "Title information") + " (" + (title_pos + 1) + "/63)"
	}
	if ( curmenu == 1 ) {
		s = lang("称号の情報", "Title information") + " (" + (title_pos + 1 - 90) + "/18)"
	}
	if ( curmenu == 2 ) {
		s = lang("称号の情報", "Title information") + " (" + (title_pos + 1 - 63) + "/27)"
	}
	s(1) = lang("ｷｬﾝｾﾙ [閉じる]", "Shift,Esc [Close]")
	display_window (windoww - 600) / 2 + inf_screenx, winposy(408), 600, 408
	if ( ogdata(440 + title_pos) == 0 ) {
		display_topic lang("？？？？？？", "????????????"), wx + 28, wy + 34
	}
	else {
		display_topic titlename(title_pos), wx + 28, wy + 34
	}
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 0, 0, 0
		pos wx + 68, wy + 68 + cnt * 18
		if ( list(0, p) == (-1) ) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		}
		if ( list(0, p) == (-2) ) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 2
			pos wx + ww - strlen(listn(0, p)) * 6 - 80, wy + 68 + cnt * 18
		}
		mes listn(0, p)
	loop
	redraw 1
	await cfg_wait1
	key_check
	if ( key == key_north ) {
		snd SOUNDLIST_CURSOR1
		title_pos--
		if ( curmenu == 0 ) {
			if ( title_pos < 0 ) {
				title_pos = 62
			}
		}
		if ( curmenu == 1 ) {
			if ( title_pos < 90 ) {
				title_pos = 107
			}
		}
		if ( curmenu == 2 ) {
			if ( title_pos < 63 ) {
				title_pos = 89
			}
		}
		page_load
		cs--
		if ( cs < 0 ) {
			page--
			cs = 14
		}
		if ( page < 0 ) {
			if ( curmenu == 0 ) {
				page = 5
				cs = 3
			}
			if ( curmenu == 1 ) {
				page = 2
				cs = 3
			}
			if ( curmenu == 2 ) {
				page = 2
				cs = 12
			}
		}
		goto *com_identify
	}
	if ( key == key_south ) {
		snd SOUNDLIST_CURSOR1
		title_pos++
		if ( curmenu == 0 ) {
			if ( title_pos > 62 ) {
				title_pos = 0
			}
		}
		if ( curmenu == 1 ) {
			if ( title_pos > 107 ) {
				title_pos = 90
			}
		}
		if ( curmenu == 2 ) {
			if ( title_pos > 89 ) {
				title_pos = 63
			}
		}
		page_load
		cs++
		if ( cs >= 15 ) {
			page++
			cs = 0
		}
		if ( curmenu == 0 ) {
			if ( page >= 6 ) {
				page = 0
			}
		}
		if ( curmenu == 1 ) {
			if ( page >= 6 ) {
				page = 0
			}
		}
		if ( curmenu == 2 ) {
			if ( page >= 2 ) {
				page = 0
			}
		}
		goto *com_identify
	}
	if ( key == key_west ) {
		key = key_pagedown
	}
	if ( key == key_east ) {
		key = key_pageup
	}
	if ( cs >= keyrange ) {
		cs_bk = -1
		cs = keyrange - 1
		if ( cs < 0 ) {
			cs = 0
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_identify_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_identify_loop_pgchk
		}
	}
	if ( key == key_cancel | key == key_enter ) {
		nc_intb_gro1 = effortcnt() * 5
		nc_intb_gro2 = 100 - nc_intb_gro1
		return
	}
	goto *com_identify_loop

*label_2665
	if ( cc != CHARA_PLAYER ) {
		return
	}
	f = 0
	if ( npcmemory(0, CREATURE_ID_RODLOB_THE_YEEK_CHIEF) != 0 ) {
		if ( ogTitleDecoy == 0 ) {
			f = 1
			ogTitleDecoy = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_TUWEN_THE_MASTER_OF_THE_PYRAMID) != 0 ) {
		if ( ogTitleBornInATemple == 0 ) {
			f = 1
			ogTitleBornInATemple = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_VESDA_THE_FIRE_DRAGON) != 0 ) {
		if ( ogTitleLeer == 0 ) {
			f = 1
			ogTitleLeer = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_CACY_THE_CAT_TAMER) != 0 ) {
		if ( ogTitleNekodamashi == 0 ) {
			f = 1
			ogTitleNekodamashi = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_UNGAGA_THE_MINOTAUR_KING) != 0 ) {
		if ( ogTitlePhantomSlasher == 0 ) {
			f = 1
			ogTitlePhantomSlasher = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_WYNAN_THE_LORD_OF_THE_ANCIENT_CASTLE) != 0 ) {
		if ( ogTitleCheckmate == 0 ) {
			f = 1
			ogTitleCheckmate = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_QURUIZA_THE_RED_EYED_DECEIVER) != 0 & npcmemory(0, CREATURE_ID_CORGON_THE_STEEL_DRAGON) != 0 ) {
		if ( ogTitleTheDailyLunchShowSpecial == 0 ) {
			f = 1
			ogTitleTheDailyLunchShowSpecial = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_ISSIZZLE_THE_DARK_ABOMINATION) != 0 ) {
		if ( ogTitleRepeatKillSquad == 0 ) {
			f = 1
			ogTitleRepeatKillSquad = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_ZEOME_THE_FALSE_PROPHET) != 0 ) {
		if ( ogTitleChampionOfTheLabyrinths == 0 ) {
			f = 1
			ogTitleChampionOfTheLabyrinths = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_FRISIA_THE_CAT_QUEEN) != 0 ) {
		if ( ogTitleMachSpeedCat == 0 ) {
			f = 1
			ogTitleMachSpeedCat = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN) != 0 ) {
		if ( ogTitleDestroyedDestructiveWeapons == 0 ) {
			f = 1
			ogTitleDestroyedDestructiveWeapons = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_AZZRSSIL_THE_IMPURE) != 0 ) {
		if ( ogTitleThePurifier == 0 ) {
			f = 1
			ogTitleThePurifier = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_MANI) != 0 ) {
		if ( ogTitleJohnConnor == 0 ) {
			f = 1
			ogTitleJohnConnor = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_LULWY) != 0 ) {
		if ( ogTitleSadistKiller == 0 ) {
			f = 1
			ogTitleSadistKiller = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_ITZPALT) != 0 ) {
		if ( ogTitleElementalMaster == 0 ) {
			f = 1
			ogTitleElementalMaster = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_KUMIROMI) != 0 ) {
		if ( ogTitleHarvester == 0 ) {
			f = 1
			ogTitleHarvester = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_OPATOS) != 0 ) {
		if ( ogTitleEarthSplitter == 0 ) {
			f = 1
			ogTitleEarthSplitter = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_EHEKATL) != 0 ) {
		if ( ogTitleMewmewmew == 0 ) {
			f = 1
			ogTitleMewmewmew = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_JURE) != 0 ) {
		if ( ogTitleYoureFired == 0 ) {
			f = 1
			ogTitleYoureFired = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_GOD_INSIDE_EHEKATL) != 0 ) {
		if ( ogTitleNobodysInside == 0 ) {
			f = 1
			ogTitleNobodysInside = 1
		}
	}
	if ( ogTitleJohnConnor != 0 & ogTitleSadistKiller != 0 & ogTitleElementalMaster != 0 & ogTitleHarvester != 0 & ogTitleEarthSplitter != 0 & ogTitleMewmewmew != 0 & ogTitleYoureFired != 0 & ogTitleNobodysInside != 0 ) {
		if ( ogTitleRagnarok == 0 ) {
			f = 1
			ogTitleRagnarok = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_GWEN_THE_INNOCENT) >= 100 ) {
		if ( ogTitleDoGooder == 0 ) {
			f = 1
			ogTitleDoGooder = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE) >= 100 ) {
		if ( ogTitleMoldKiller == 0 ) {
			f = 1
			ogTitleMoldKiller = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_STRAY_CAT) >= 100 ) {
		if ( ogTitleReturningHome == 0 ) {
			f = 1
			ogTitleReturningHome = 1
		}
	}
	if ( npcmemory(0, CREATURE_ID_BARD) >= 100 ) {
		if ( ogTitleWailingChoir == 0 ) {
			f = 1
			ogTitleWailingChoir = 1
		}
	}
	if ( sorg(SKILL_NORMAL_TACTICS, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleGodOfWar == 0 ) {
			f = 1
			ogTitleGodOfWar = 1
		}
	}
	if ( sorg(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleThe13Th == 0 ) {
			f = 1
			ogTitleThe13Th = 1
		}
	}
	if ( sorg(SKILL_NORMAL_LITERACY, CHARA_PLAYER) + sorg(SKILL_NORMAL_MEMORIZATION, CHARA_PLAYER) + sorg(SKILL_NORMAL_CASTING, CHARA_PLAYER) >= 300 ) {
		if ( ogTitleArchmage == 0 ) {
			f = 1
			ogTitleArchmage = 1
		}
	}
	if ( sorg(SKILL_NORMAL_HEALING, CHARA_PLAYER) + sorg(SKILL_NORMAL_MEDITATION, CHARA_PLAYER) >= 200 ) {
		if ( ogTitleEmptiness == 0 ) {
			f = 1
			ogTitleEmptiness = 1
		}
	}
	if ( sorg(SKILL_WEAPON_LONGSWORD, CHARA_PLAYER) + sorg(SKILL_WEAPON_SHORTSWORD, CHARA_PLAYER) + sorg(SKILL_WEAPON_AXE, CHARA_PLAYER) + sorg(SKILL_WEAPON_BLUNT, CHARA_PLAYER) + sorg(SKILL_WEAPON_POLEARM, CHARA_PLAYER) + sorg(SKILL_WEAPON_STAVE, CHARA_PLAYER) + sorg(SKILL_WEAPON_MARTIAL_ARTS, CHARA_PLAYER) + sorg(SKILL_WEAPON_SCYTHE, CHARA_PLAYER) + sorg(SKILL_WEAPON_BOW, CHARA_PLAYER) + sorg(SKILL_WEAPON_CROSSBOW, CHARA_PLAYER) + sorg(SKILL_WEAPON_FIREARM, CHARA_PLAYER) + sorg(SKILL_WEAPON_THROWING, CHARA_PLAYER) >= 300 ) {
		if ( ogTitleOneManArmy == 0 ) {
			f = 1
			ogTitleOneManArmy = 1
		}
	}
	if ( sorg(SKILL_NORMAL_HEAVY_ARMOR, CHARA_PLAYER) + sorg(SKILL_NORMAL_MEDIUM_ARMOR, CHARA_PLAYER) + sorg(SKILL_NORMAL_LIGHT_ARMOR, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleHellsWall == 0 ) {
			f = 1
			ogTitleHellsWall = 1
		}
	}
	if ( sorg(SKILL_NORMAL_EVASION, CHARA_PLAYER) + sorg(SKILL_NORMAL_GREATER_EVASION, CHARA_PLAYER) + sorg(SKILL_NORMAL_EYE_OF_MIND, CHARA_PLAYER) + sorg(SKILL_NORMAL_SHIELD, CHARA_PLAYER) >= 300 ) {
		if ( ogTitleTheBlindSword == 0 ) {
			f = 1
			ogTitleTheBlindSword = 1
		}
	}
	if ( sorg(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) + sorg(SKILL_NORMAL_ANATOMY, CHARA_PLAYER) >= 200 ) {
		if ( ogTitleMadScientist == 0 ) {
			f = 1
			ogTitleMadScientist = 1
		}
	}
	if ( sorg(SKILL_NORMAL_NEGOTIATION, CHARA_PLAYER) + sorg(SKILL_NORMAL_INVESTING, CHARA_PLAYER) >= 200 ) {
		if ( ogTitleDragonsDen == 0 ) {
			f = 1
			ogTitleDragonsDen = 1
		}
	}
	if ( sorg(SKILL_NORMAL_SENSE_QUALITY, CHARA_PLAYER) + sorg(SKILL_NORMAL_MINING, CHARA_PLAYER) + sorg(SKILL_NORMAL_LOCK_PICKING, CHARA_PLAYER) + sorg(SKILL_NORMAL_DETECTION, CHARA_PLAYER) + sorg(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) >= 200 ) {
		if ( ogTitleTreasureHunter == 0 ) {
			f = 1
			ogTitleTreasureHunter = 1
		}
	}
	if ( sorg(SKILL_NORMAL_CARPENTRY, CHARA_PLAYER) + sorg(SKILL_NORMAL_TAILORING, CHARA_PLAYER) + sorg(SKILL_NORMAL_ALCHEMY, CHARA_PLAYER) + sorg(SKILL_NORMAL_JEWELER, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleFather == 0 ) {
			f = 1
			ogTitleFather = 1
		}
	}
	if ( sorg(SKILL_NORMAL_STEALTH, CHARA_PLAYER) + sorg(SKILL_ACTIVE_PICKPOCKET, CHARA_PLAYER) >= 150 ) {
		if ( ogTitleStealth == 0 ) {
			f = 1
			ogTitleStealth = 1
		}
	}
	if ( sorg(SKILL_NORMAL_FAITH, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleMessengerOfJustice == 0 ) {
			f = 1
			ogTitleMessengerOfJustice = 1
		}
	}
	if ( sorg(SKILL_NORMAL_COOKING, CHARA_PLAYER) >= 50 ) {
		if ( ogTitleBestInPalmia == 0 ) {
			f = 1
			ogTitleBestInPalmia = 1
		}
	}
	if ( sorg(SKILL_NORMAL_TRAVELING, CHARA_PLAYER) + sorg(SKILL_NORMAL_FISHING, CHARA_PLAYER) >= 50 ) {
		if ( ogTitleSuperTourist == 0 ) {
			f = 1
			ogTitleSuperTourist = 1
		}
	}
	if ( sorg(SKILL_NORMAL_MAGIC_CAPACITY, CHARA_PLAYER) + sorg(SKILL_NORMAL_MAGIC_DEVICE, CHARA_PLAYER) + sorg(SKILL_NORMAL_CONTROL_MAGIC, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleElderDemonPope == 0 ) {
			f = 1
			ogTitleElderDemonPope = 1
		}
	}
	if ( sorg(SKILL_NORMAL_TWO_HAND, CHARA_PLAYER) + sorg(SKILL_NORMAL_WEIGHT_LIFTING, CHARA_PLAYER) >= 200 ) {
		if ( ogTitleStrengthIsPower == 0 ) {
			f = 1
			ogTitleStrengthIsPower = 1
		}
	}
	if ( sorg(SKILL_NORMAL_DUAL_WIELD, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleDualWieldMastery == 0 ) {
			f = 1
			ogTitleDualWieldMastery = 1
		}
	}
	if ( sorg(SKILL_NORMAL_GARDENING, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleSlaveToTurnips == 0 ) {
			f = 1
			ogTitleSlaveToTurnips = 1
		}
	}
	if ( sorg(SKILL_ACTIVE_RIDING, CHARA_PLAYER) >= 100 ) {
		if ( ogTitleUnmaskedRider == 0 ) {
			f = 1
			ogTitleUnmaskedRider = 1
		}
	}
	if ( sorg(SKILL_NORMAL_PERFORMER, CHARA_PLAYER) >= 150 ) {
		if ( ogTitleTheBaby == 0 ) {
			f = 1
			ogTitleTheBaby = 1
		}
	}
	if ( sorg(SKILL_ATTR_LIFE, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_MANA, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_STR, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_CON, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_DEX, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_PER, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_LER, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_WIL, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_MAG, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_CHA, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_SPD, CHARA_PLAYER) >= 2000 & sorg(SKILL_ATTR_LUC, CHARA_PLAYER) >= 2000 ) {
		if ( ogTitleAthana == 0 ) {
			f = 1
			ogTitleAthana = 1
		}
	}
	if ( sorg(SKILL_WEAPON_LONGSWORD, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_SHORTSWORD, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_AXE, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_BLUNT, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_POLEARM, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_STAVE, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_MARTIAL_ARTS, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_SCYTHE, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_BOW, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_CROSSBOW, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_FIREARM, CHARA_PLAYER) >= 2000 & sorg(SKILL_WEAPON_THROWING, CHARA_PLAYER) >= 2000 & sorg(SKILL_NORMAL_TACTICS, CHARA_PLAYER) >= 2000 & sorg(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) >= 2000 ) {
		if ( ogTitleNurta == 0 ) {
			f = 1
			ogTitleNurta = 1
		}
	}
	if ( magiclv() ) {
		if ( ogTitleIsis == 0 ) {
			f = 1
			ogTitleIsis = 1
		}
	}
	if ( (gPlayTime + timeGetTime() / 1000 - time_begin) / 60 / 60 >= 1000 ) {
		if ( ogTitleChronos == 0 ) {
			f = 1
			ogTitleChronos = 1
		}
	}
	if ( ogTimesReadYoungerSistersDiary >= 30 ) {
		if ( ogTitleBrotherSister == 0 ) {
			f = 1
			ogTitleBrotherSister = 1
			txtef COLOR_YELLOW
			txt -1, lang("あなたは妹を理解してしまった。", "You may have accidentally understood more than you should about your younger sister.")
			dmgcon CHARA_PLAYER, CONDITION_INSANE, 1000
			dmgsan CHARA_PLAYER, 1000
		}
	}
	if ( ogTotalTravelDistance >= 7321 ) {
		if ( ogTitleSearchOfMother == 0 ) {
			f = 1
			ogTitleSearchOfMother = 1
		}
	}
	if ( ogTimesSentPets >= 10 ) {
		if ( ogTitleTheDayWeFlyOnOurWings == 0 ) {
			f = 1
			ogTitleTheDayWeFlyOnOurWings = 1
		}
	}
	if ( ogTimesSoldOwnBody >= 1000 ) {
		if ( ogTitle1000ThTargetSlayed == 0 ) {
			f = 1
			ogTitle1000ThTargetSlayed = 1
		}
	}
	if ( ogTimesMadeChildren >= 10 ) {
		if ( ogTitleHappyFamilyPlan == 0 ) {
			f = 1
			ogTitleHappyFamilyPlan = 1
		}
	}
	if ( ogTimesDidHumanAlchemy >= 5 ) {
		if ( ogTitleMincemeatAlchemist == 0 ) {
			f = 1
			ogTitleMincemeatAlchemist = 1
		}
	}
	if ( ogTimesAteHumanFlesh >= 1000 ) {
		if ( ogTitleHannibalLecter == 0 ) {
			f = 1
			ogTitleHannibalLecter = 1
		}
	}
	if ( peek(ogdata(432), 0) == 254 ) {
		if ( ogTitleTheUnfaithful == 0 ) {
			f = 1
			ogTitleTheUnfaithful = 1
		}
	}
	if ( cGold(CHARA_PLAYER) >= 100000000 ) {
		if ( ogTitleBillionaire == 0 ) {
			f = 1
			ogTitleBillionaire = 1
		}
	}
	if ( cFame(CHARA_PLAYER) >= 100000 ) {
		if ( ogTitleYouSoundFamiliar == 0 ) {
			f = 1
			ogTitleYouSoundFamiliar = 1
		}
	}
	if ( ogTimesUsedNuke >= 50 ) {
		if ( ogTitleFelixHoenikker == 0 ) {
			f = 1
			ogTitleFelixHoenikker = 1
		}
	}
	if ( ogTimesMarried >= 30 ) {
		if ( ogTitleNighttimePredator == 0 ) {
			f = 1
			ogTitleNighttimePredator = 1
		}
	}
	if ( ogDungeonStayersTotal >= 50 ) {
		if ( ogTitleHelloIAmMayor == 0 ) {
			f = 1
			ogTitleHelloIAmMayor = 1
		}
	}
	if ( areaDeepest(42) - areaMinLevel(42) + 1 >= 1000 ) {
		if ( ogTitleJunkie == 0 ) {
			f = 1
			ogTitleJunkie = 1
		}
	}
	if ( areaDeepest(210) - areaMinLevel(210) + 1 >= 5 ) {
		if ( ogTitleCensored == 0 ) {
			f = 1
			ogTitleCensored = 1
		}
	}
	if ( ogPurchasedSlaveCount >= 47 ) {
		if ( ogTitleBlackOrganizationMember == 0 ) {
			f = 1
			ogTitleBlackOrganizationMember = 1
		}
	}
	if ( ogTitleMonsterHunter == 0 ) {
		if ( ogUniqueMonsterKillCount >= 20 ) {
			f = 1
			ogTitleMonsterHunter = 1
		}
	}
	if ( ogTitleDevourerOfEnds == 0 ) {
		p(82) = findunid("The Unicorn of Order")
		if ( p(82) ) {
			if ( getcnpcmemory(0, p(82) - 1) != 0 ) {
				f = 1
				ogTitleDevourerOfEnds = 1
			}
		}
	}
	if ( ogTitleTubalCain == 0 ) {
		if ( ogSmithingTargetEnchantment ) {
			f = 1
			ogTitleTubalCain = 1
		}
	}
	if ( ncgGoldOverflow >= 100 ) {
		if ( ogTitleGanesa == 0 ) {
			f = 1
			ogTitleGanesa = 1
		}
	}
	if ( ogTitleTheEnd == 0 ) {
		if ( areaDeepest(42) - areaMinLevel(42) + 1 >= 10000 & cMHP(CHARA_PLAYER) >= 2000000000 ) {
			f = 1
			ogTitleTheEnd = 1
		}
	}
	repeat 10
		if ( ogdata(520 + cnt) == 0 ) {
			if ( ncgdata(210 + cnt) >= 5000 ) {
				f = 1
				ogdata(520 + cnt) = 1
			}
		}
	loop
	if ( f == 1 ) {
		snd SOUNDLIST_WRITE1
		txtef COLOR_GREEN
		txt -1, lang("新しい称号を獲得した！", "Earned a new title!")
	}
	return

*com_journal
	curmenu = 1
	listmax = 0
	page = 99
	pagesize = 40
	cs = 0
	cc = CHARA_PLAYER
	listmax = noteinfo(0)
	keyrange = 0
	key_list(0) = key_enter
	buff = newsbuff
	if ( newsbuff == "" ) {
		buff = "No news"
	}
	notesel buff
	noteadd " - News - ", 0
	noteadd "", 1
	if ( noteinfo(0) / (pagesize / 2) \ 2 == 1 ) {
		repeat pagesize / 2
			noteadd "", 2
		loop
	}
	page = noteinfo(0) / pagesize
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Quest - "
	noteadd ""
	gosub *quest_info
	repeat gClient
		if ( qStatus(cnt) == QUEST_STATE_NONE ) {
			continue
		}
		rq = cnt
		val = 2
		gosub *label_0821
	loop
	val = 0
	gosub *quest_info2
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Quest Item - "
	noteadd ""
	gosub *quest_item
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	gold = 0
	p = limit(cFame(CHARA_PLAYER) / 10, 100, 25000)
	if ( cFame(CHARA_PLAYER) >= 25000 ) {
		p += (cFame(CHARA_PLAYER) - 25000) / 100
	}
	gold += p
	noteadd " - Title & Ranking - "
	noteadd ""
	noteadd lang("名声: ", "Fame: ") + cFame(CHARA_PLAYER)
	noteadd ""
	noteadd lang("死亡回数: ", "Deaths: ") + gDeath
	noteadd ""
	repeat 10
		if ( gdata(STARTING_GDATA_RANK + cnt) < 10000 ) {
			noteadd "" + ranktitle(cnt) + " Rank." + gdata(STARTING_GDATA_RANK + cnt) / 100
			s = lang("給料: 約 " + calcincome(cnt) + " gold  ", "Pay: About " + calcincome(cnt) + " gold pieces ")
			gold += calcincome(cnt)
			if ( cnt == 3 | cnt == 4 | cnt == 5 | cnt == 8 ) {
			}
			else {
				s += lang("ノルマ: ", "\nDeadline: ") + gdata(140 + cnt) + lang("日以内", " Days left")
			}
			noteadd s
			noteadd ""
		}
	loop
	noteadd lang("EXバトル: 勝利 " + gExBattleWin + "回 最高Lv" + gExBattleMaxLv, "EX Arena Wins:" + gExBattleWin + "  Highest Level:" + cnvrank(gExBattleMaxLv))
	noteadd ""
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Income & Expense - "
	noteadd ""
	if ( jp ) {
		noteadd "◆ 給料(毎月1日と15日に支給)"
		noteadd "@BL　合計　　 : 約 " + thousandsep(str(gold)) + strgold
		noteadd ""
		noteadd "◆ 請求書内訳(毎月1日に発行)"
		noteadd "@RE　人件費  : 約 " + thousandsep(str(gCostHire)) + strgold
		noteadd "@RE　運営費  : 約 " + thousandsep(str(calccostbuilding())) + strgold
		noteadd "@RE　税金    : 約 " + thousandsep(str(calccosttax())) + strgold
		noteadd "@RE　合計　  : 約 " + thousandsep(str(gCostHire + calccostbuilding() + calccosttax())) + strgold
		noteadd ""
		noteadd "現在未払いの請求書は" + gBill + "枚"
	}
	else {
		noteadd "Salary (Paid every 1st and 15th day)"
		noteadd "@BL  Sum    : About " + gold + " GP"
		noteadd ""
		noteadd "Bills  (Issued every 1st day)"
		noteadd "@RE  Labor  : About " + gCostHire + " GP"
		noteadd "@RE  Maint. : About " + calccostbuilding() + " GP"
		noteadd "@RE  Tax    : About " + calccosttax() + " GP"
		noteadd "@RE  Sum    : About " + (gCostHire + calccostbuilding() + calccosttax()) + " GP"
		noteadd ""
		noteadd "You have " + gBill + " unpaid bills."
	}
	repeat pagesize / 2 - noteinfo(0) \ (pagesize / 2)
		noteadd ""
	loop
	noteadd " - Completed Quests - "
	noteadd ""
	val = 1
	gosub *quest_info2
	listmax = noteinfo(0)
	redraw 0
	showtitle lang("ジャーナル", "Journal"), strhint2 + strhint3, 236, 1
	drawmenu 2
	wx = (windoww - 736) / 2 + inf_screenx
	wy = winposy(448)
	snd SOUNDLIST_BOOK1
	windowanime wx, wy, 736, 448, 10, 4

*com_journal_loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "graphic\\book.bmp", 1
	gsel BUFFER_SCREEN
	pos wx, wy
	gcopy BUFFER_BUF, 0, 0, 736, 448
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		x = wx + 80 + cnt / 20 * 306
		y = wy + 45 + cnt \ 20 * 16
		noteget s, p
		if ( strmid(s, 0, 1) == "@" ) {
			s(1) = strmid(s, 1, 2)
			s = strmid(s, 3, strlen(s) - 3)
			font lang(cfg_font1, cfg_font2), 10 + en - en * 2, 1
			color 0, 0, 200
			if ( s(1) == "QL" ) {
				color 100, 100, 0
			}
			if ( s(1) == "QC" ) {
				color 0, 100, 100
			}
			if ( s(1) == "QM" ) {
				color 0, 100, 0
			}
			if ( s(1) == "RE" ) {
				color 100, 0, 0
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			}
			if ( s(1) == "BL" ) {
				color 0, 0, 100
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			}
		}
		else {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			color 0, 0, 0
		}
		pos x, y
		mes s
		if ( p \ 20 == 0 ) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			color 0, 0, 0
			pos x + 90, y + 330
			mes "- " + (p / 20 + 1) + " -"
			if ( p \ 40 == 20 ) {
				if ( page < pagemax ) {
					pos x + 200, y + 330
					mes "(more)"
				}
			}
		}
	loop

*com_journal_loop_pgchg
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 2 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 2
				}
			}
			key = ""
			if ( p != curmenu ) {
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					goto *com_log
				}
				if ( curmenu == 1 ) {
					goto *com_journal
				}
				if ( curmenu == 2 ) {
					goto *com_chatlog
				}
			}
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_CARD1
			page++
			goto *com_journal_loop
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_CARD1
			page--
			goto *com_journal_loop
		}
	}
	if ( key == key_cancel | key == key_enter ) {
		menucycle = 0
		gosub *screen_draw
		goto *pc_turn
	}
	goto *com_journal_loop_pgchg

#defcfunc findsupply int findsupply_prm0, int findsupply_prm1, local findsupply_prm2, local findsupply_prm3
	findsupply_prm2 = -1
	findsupply_prm3 = 0
	inv_getheader 0
	repeat 1 + (findsupply_prm1 == 1)
		cnt2 = cnt
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( ibit(ITEM_BIT_NO_DROP, cnt) ) {
				continue
			}
			if ( qExist(findsupply_prm0) == QUEST_TYPE_COOK ) {
				if ( refitem(iID(cnt), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
					if ( iParam1(cnt) / 1000 == qParam1(findsupply_prm0) ) {
						if ( iParam2(cnt) == 0 ) {
							if ( findsupply_prm1 == 1 ) {
								if ( cnt2 == 1 ) {
									findsupply_prm2 = cnt + 10000
									findsupply_prm3 = 1
									break
								}
							}
						}
						if ( iParam2(cnt) == qParam2(findsupply_prm0) ) {
							findsupply_prm2 = cnt
							findsupply_prm3 = 1
							break
						}
					}
				}
			}
			if ( qExist(findsupply_prm0) == QUEST_TYPE_SUPPLY | qExist(findsupply_prm0) == QUEST_TYPE_COLLECT ) {
				if ( iID(cnt) == qDestItem(findsupply_prm0) ) {
					findsupply_prm2 = cnt
					findsupply_prm3 = 1
					break
				}
			}
		loop
		if ( findsupply_prm3 ) {
			break
		}
	loop
	return findsupply_prm2

*com_quest
	if ( cfg_extrahelp ) {
		if ( gdata(STARTING_GDATA_HELP + 4) == 0 ) {
			if ( mode == MODELIST_MAIN ) {
				if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
					gdata(STARTING_GDATA_HELP + 4) = 1
					ghelp = 4
					gosub *elona_help
					screenupdate = -1
					gosub *screen_draw
				}
			}
		}
	}
	gosub *label_0238
	listmax = 0
	page = 0
	pagesize = 4
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat gClient
		if ( qMap(cnt) != gArea  ) {
			continue
		}
		if ( qExist(cnt) == QUEST_TYPE_NONE ) {
			continue
		}
		if ( qStatus(cnt) != QUEST_STATE_NONE ) {
			continue
		}
		rc = qClient(cnt)
		if ( cExist(rc) != CHAR_STATE_ALIVE ) {
			continue
		}
		list(0, listmax) = cnt, qLevel(cnt)
		listmax++
	loop
	if ( listmax == 0 ) {
		txt -1, lang("新しい依頼は掲示されていないようだ。", "It seems there are no new notices.")
		goto *label_4158
	}
	gosub *sort_list
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_board.bmp", 1
	gsel BUFFER_SCREEN
	redraw 0
	gsel BUFFER_BUF
	fillbg 3, 960, 96, 128, 128
	ww = 560
	h = 140
	wh = h * 4
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	repeat 4
		y = wy + cnt * 120
		window wx + 4, y + 4, ww, h, 0, -1
		window wx, y, ww, h
		pos wx + 20, y + 8
		gcopy BUFFER_INF, 960, 144 + 96, 48, 84
	loop
	locvar_addnews_hide_popup = 1
	gosub *screen_drawStatus
	locvar_addnews_hide_popup = 0
	gsel BUFFER_SCREEN

*com_quest_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_quest_loop
	redraw 0
	s = lang("掲載されている依頼", "Notice Board"), strhint2 + strhint3b
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, inf_ver
	gmode 2
	font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
	pos wx + ww + 20, wy
	color 0, 0, 0
	bmes "Page " + (page + 1) + "/" + (pagemax + 1), 255, 255, 255
	keyrange = 0
	repeat pagesize
		y = wy + cnt * 120 + 20
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		pos wx + 70, y
		gfini 460, 18
		gfdec2 12, 14, 16
		display_key wx + 70, y - 2, cnt
	loop
	cs_listbk
	repeat pagesize
		y = wy + cnt * 120 + 20
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		rq = list(0, p)
		tc = qClient(rq)
		val = 0
		gosub *label_0821
		p = pagesize * page + cnt
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		cnt2 = cnt
		cs_list s(3), wx + 96, y - 1, 19
		color 0, 0, 0
		s(2) = "(" + nquestdate + ")"
		pos wx + 344, y + 2
		mes s(2)
		color 0, 0, 0
		s(4) = cnName(tc)
		cutname s(4), 20
		pos wx + 392, y + 2
		mes s(4)
		talk_conv buff, 70
		p = qLevel(rq) / 5 + 1, 14
		repeat 1
			if ( qType(rq) == QUEST_SUBTYPE_SUPPLY ) {
				if ( findsupply(rq, 1) != (-1) ) {
					if ( stat < 10000 ) {
						color 0, 0, 0
					}
					else {
						color 80, 80, 80
					}
					break
				}
			}
			if ( cLevel(CHARA_PLAYER) * 2 < qLevel(rq) ) {
				color 205, 0, 0
				break
			}
			if ( cLevel(CHARA_PLAYER) * 3 / 2 < qLevel(rq) ) {
				color 140, 80, 0
				break
			}
			if ( cLevel(CHARA_PLAYER) < qLevel(rq) ) {
				color 0, 0, 205
				break
			}
			color 0, 155, 0
		loop
		if ( p < 11 ) {
			dy = 0
			if ( p > 5 ) {
				font lang(cfg_font1, cfg_font2), 10 - en * 2, 0
				dy = -3
			}
			repeat p
				pos wx + 270 + cnt \ 5 * 13, y + dy + cnt / 5 * 8 + 2
				mes lang("★", "$")
			loop
		}
		else {
			pos wx + 270, y + 2
			mes lang("★×", "$ x ") + p
		}
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 0, 0, 0
		pos wx + 20, y + 20
		mes buff
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		txtnew
		txt -1, lang("依頼主に会う？", "Do you want to meet the client?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval != 0 ) {
			goto *com_quest_loop_pgchk
		}
		tc = qClient(p)
		rq = p
		client = tc
		efid = SKILL_SPACT_SHADOW_STEP
		nc_himo = 1
		gosub *label_3383
		tc = client
		if ( cExist(CHARA_PLAYER) == CHAR_STATE_ALIVE ) {
			questteleport = 1
			gosub *chat
		}
		if ( chatteleport == 1 ) {
			chatteleport = 0
			goto *map_exit
		}
		goto *label_4158
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_quest_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_quest_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		goto *label_4158
	}
	goto *com_quest_loop

*label_2694
	snd SOUNDLIST_POP2
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat 245
		if ( allyctrl == 2 ) {
			if ( cExist(cnt) != CHAR_STATE_ALLY_DEAD & cExist(cnt) != CHAR_STATE_SPIRIT ) {
				continue
			}
		}
		else {
			if ( allyctrl == 1 ) {
				if ( allyctrl == 1 ) {
					if ( cExist(cnt) != CHAR_STATE_TEMP ) {
						continue
					}
				}
			}
			else {
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
			}
			if ( allyctrl != 3 ) {
				if ( cnt < 16 ) {
					if ( cType(cnt) != gArea  ) {
						continue
					}
				}
			}
		}
		if ( allyctrl != 3 ) {
			if ( cnt == 0 ) {
				continue
			}
		}
		if ( cbit(CHARA_BIT_GUARD_TEMP, cnt) == TRUE | cRole(cnt) == 20001 | cRole(cnt) == 20003 ) {
			continue
		}
		if ( eqfaction(cnt, "overwish") ) {
			continue
		}
		list(0, listmax) = cnt, -cLevel(cnt)
		listmax++
	loop
	gosub *sort_list
	windowshadow = 1

*label_2697
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_2698
	redraw 0
	s = lang("NPC一覧", "NPC List"), strhint2 + strhint3
	display_window (windoww - 700) / 2 + inf_screenx, winposy(448), 700, 448
	if ( allyctrl == 0 ) {
		s = lang("給料", "Wage")
	}
	else {
		s = lang("雇用費(給料)", "Init. Cost(Wage)")
	}
	display_topic lang("NPCの名前", "Name"), wx + 28, wy + 36
	display_topic lang("情報", "Info"), wx + 350, wy + 36
	if ( allyctrl != 2 & allyctrl != 3 ) {
		display_topic s, wx + 490, wy + 36
	}
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 600, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		transmissivity = 0
		if ( cId(list(0, p)) == CREATURE_ID_USER ) {
			if ( userdata2(1, cUNID(list(0, p))) ) {
				transmissivity = userdata2(1, cUNID(list(0, p)))
			}
		}
		if ( ocChipTransparency(list(0, p)) ) {
			transmissivity = ocChipTransparency(list(0, p))
		}
		i = getcharapic(list(0, p)), getcharacolor(list(0, p))
		chara_preparepic i, i(1)
		pos wx + 40, wy + 74 + cnt * 19 - 8
		gmode 4, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i), 256 - transmissivity
		color 0, 0, 0
		grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, i) / (1 + (chipc(CHIPC_HEIGHT, i) > inf_tiles)), inf_tiles
		gmode 2
		i = list(0, p)
		s = cnName(i)
		cutname s, 36
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		s = "Lv." + cLevel(i) + " "
		if ( cSex(i) == 0 ) {
			s += cnven(strmale)
		}
		else {
			s += cnven(strfemale)
		}
		s += lang(" ", "(") + calcage(i) + "" + lang("歳", ")")
		pos wx + 372, wy + 66 + cnt * 19 + 2
		mes s
		if ( allyctrl != 2 & allyctrl != 3 ) {
			if ( allyctrl == 1 ) {
				s = thousandsep(str(calchirecost(i) * 20)) + "(" + thousandsep(str(calchirecost(i))) + ")"
			}
			else {
				s = thousandsep(str(calchirecost(i)))
			}
			pos wx + 512, wy + 66 + cnt * 19 + 2
			mes s + lang(" gold", "gp")
		}
		if ( cs == cnt & oom_posinfo == 1 ) {
			gosub *label_4990
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		return p
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_2697
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_2697
		}
	}
	if ( key == key_cancel ) {
		i = 0
		gosub *label_4990
		return -1
	}
	goto *label_2698

*com_reserve
	txtnew
	ctalk 0, 10029, 0, tc
	if ( stat == 0 ) {
		txt -1, lang("何を予約する？", "Which item do you want to reserve? ")
	}
	snd SOUNDLIST_POP2
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat 800
		if ( itemmemory(2, cnt) == 0 ) {
			continue
		}
		if ( refitem(cnt, DBSPEC_TYPE_MINOR) != FILTER_ITEM_FOOD_HERB ) {
			list(0, listmax) = cnt, cnt
			listmax++
		}
	loop
	gosub *sort_list
	windowshadow = 1

*com_reserve_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_reserve_loop
	redraw 0
	s = lang("予約リスト", "Reserve List"), strhint2 + strhint3
	display_window (windoww - 540) / 2 + inf_screenx, winposy(448), 540, 448
	display_topic lang("アイテムの名前", "Name"), wx + 28, wy + 36
	display_topic lang("予約状況", "Status"), wx + 390, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 440, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(0, 13)), chipi(CHIPI_HEIGHT, xy2pic(0, 13)) + 960
		pos 0, 960
		gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(0, 13)), chipi(CHIPI_Y, xy2pic(0, 13)), chipi(CHIPI_WIDTH, xy2pic(0, 13)), chipi(CHIPI_HEIGHT, xy2pic(0, 13))
		gfini chipi(CHIPI_WIDTH, xy2pic(0, 13)), chipi(CHIPI_HEIGHT, xy2pic(0, 13))
		gfdec2 c_col(0, icolref(i)), c_col(1, icolref(i)), c_col(2, icolref(i))
		gsel selcur
		pos wx + 38, wy + 73 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate BUFFER_ITEM, 0, 960, 0, inf_tiles, inf_tiles
		s = ioriginalnameref(i)
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		pos wx + 400, wy + 66 + cnt * 19 + 2
		if ( itemmemory(2, i) == 1 ) {
			color 120, 120, 120
			mes lang("入荷なし", "-")
		}
		else {
			color 55, 55, 255
			mes lang("入荷予定", "Reserved")
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		if ( p == 289 | p == 732 | p == 798 ) {
			snd SOUNDLIST_FAIL1
			txt -1, lang("「その本は入手できないね」", cnvtalk("Ah, that book is unavailable."))
			goto *com_reserve_loop_pgchk
		}
		snd SOUNDLIST_OK1
		if ( itemmemory(2, p) == 1 ) {
			itemmemory(2, p) = 2
		}
		else {
			itemmemory(2, p) = 1
		}
		goto *com_reserve_loop_pgchk
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_reserve_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_reserve_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		return -1
	}
	goto *com_reserve_loop

*label_2711
	txtnew
	ctalk 0, 10029, 0, tc
	if ( stat == 0 ) {
		txt -1, lang("何を予約する？", "Which item do you want to reserve? ")
	}
	snd SOUNDLIST_POP2
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat 800
		if ( itemmemory(0, cnt) == 0 ) {
			continue
		}
		if ( refitem(cnt, DBSPEC_TYPE_MINOR) == FILTER_ITEM_FOOD_HERB ) {
			list(0, listmax) = cnt, cnt
			listmax++
		}
	loop
	gosub *sort_list
	windowshadow = 1

*label_2713
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_2714
	redraw 0
	s = lang("予約リスト", "Reserve List"), strhint2 + strhint3
	display_window (windoww - 540) / 2 + inf_screenx, winposy(448), 540, 448
	display_topic lang("アイテムの名前", "Name"), wx + 28, wy + 36
	display_topic lang("予約状況", "Status"), wx + 390, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 440, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(5, 5)), chipi(CHIPI_HEIGHT, xy2pic(5, 5)) + 960
		pos 0, 960
		gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(5, 5)), chipi(CHIPI_Y, xy2pic(5, 5)), chipi(CHIPI_WIDTH, xy2pic(5, 5)), chipi(CHIPI_HEIGHT, xy2pic(5, 5))
		gfini chipi(CHIPI_WIDTH, xy2pic(5, 5)), chipi(CHIPI_HEIGHT, xy2pic(5, 5))
		gfdec2 c_col(0, icolref(i)), c_col(1, icolref(i)), c_col(2, icolref(i))
		gsel selcur
		pos wx + 38, wy + 73 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate BUFFER_ITEM, 0, 960, 0, inf_tiles, inf_tiles
		s = ioriginalnameref(i)
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		pos wx + 400, wy + 66 + cnt * 19 + 2
		if ( itemmemory(2, i) == 0 ) {
			color 120, 120, 120
			mes lang("入荷なし", "-")
		}
		else {
			color 55, 55, 255
			mes lang("入荷予定", "Reserved")
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		if ( p == 797 ) {
			snd SOUNDLIST_FAIL1
			txt -1, lang("「そのハーブは入手できないね」", cnvtalk("Ah, that harb is unavailable."))
			goto *label_2713
		}
		snd SOUNDLIST_OK1
		if ( itemmemory(2, p) == 0 ) {
			itemmemory(2, p) = 3
		}
		else {
			itemmemory(2, p) = 0
		}
		goto *label_2713
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_2713
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_2713
		}
	}
	if ( key == key_cancel ) {
		return -1
	}
	goto *label_2714

*label_2719
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat 57 - 1
		if ( cExist(cnt) == CHAR_STATE_DEAD ) {
			continue
		}
		list(0, listmax) = cnt, -cFame(cnt)
		listmax++
	loop
	gosub *sort_list
	windowshadow = 1

*label_2721
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_2722
	redraw 0
	s = lang("冒険者ランク", "Adventurer Rank"), strhint2 + strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	display_topic lang("冒険者の名前とランク", "Name and Rank"), wx + 28, wy + 36
	display_topic lang("名声(Lv)", "Fame(Lv)"), wx + 320, wy + 36
	display_topic lang("現在地", "Location"), wx + 420, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		transmissivity = 0
		if ( cId(list(0, p)) == CREATURE_ID_USER ) {
			if ( userdata2(1, cUNID(list(0, p))) ) {
				transmissivity = userdata2(1, cUNID(list(0, p)))
			}
		}
		if ( ocChipTransparency(list(0, p)) ) {
			transmissivity = ocChipTransparency(list(0, p))
		}
		i = getcharapic(list(0, p)), getcharacolor(list(0, p))
		chara_preparepic i, i(1)
		pos wx + 40, wy + 74 + cnt * 19 - 8
		gmode 4, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i), 256 - transmissivity
		color 0, 0, 0
		grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, i) / (1 + (chipc(CHIPC_HEIGHT, i) > inf_tiles)), inf_tiles
		gmode 2
		pos wx + 84, wy + 66 + cnt * 19 + 2
		mes cnvrank(p + 1) + lang("位", "")
		i = list(0, p)
		s = "" + cnAka(i) + " " + cnName(i)
		cutname s, 26
		cs_list s, wx + 118, wy + 66 + cnt * 19 - 1, 19
		s = "" + cFame(i) + "(" + cLevel(i) + ")"
		pos wx + 402 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
		mes s
		s = mapname(cType(i))
		if ( s == "" ) {
			s = lang("不明", "Unknown")
		}
		if ( cExist(i) == CHAR_STATE_ADV_HOSPITAL ) {
			s = lang("病院", "Hospital")
		}
		pos wx + 435, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	i = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		if ( cExist(p) == CHAR_STATE_ADV_HOSPITAL ) {
			return
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_2721
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_2721
		}
	}
	if ( key == key_cancel ) {
		return
	}
	goto *label_2722

*wish_fix
	if ( jp ) {
		inputlog = del_str(inputlog, ",")
		inputlog = del_str(inputlog, " ")
		inputlog = del_str(inputlog, "　")
	}
	else {
		inputlog = getpath(inputlog, 16)
	}
	inputlog = del_str(inputlog, lang("アイテム", "item"))
	inputlog = del_str(inputlog, lang("スキル", "skill "))
	inputlog = del_str(inputlog, lang("スキル", "skill"))
	return

*com_aka
	sdim lockedaka, 30, 17
	redraw 0
	cs = 0
	cs_bk = -1
	list(0, 0) = -1
	windowshadow = 1
	i = 10500
	name_page = 0
	if ( val == 3 ) {
		if ( namedscroll == 1 ) {
			namedscroll = 0
			display_msg screenmsgy, 1
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 12, 0, 0
			inputlog = ""
			gosub *prompt_word
			val = 3
			name_page = int(inputlog)
			if ( rtval == (-1) | name_page == 0 ) {
				goto *com_aka_WHILE1
			}
			i = 10500 + (name_page - 1) * 17
			if ( val == 3 & ogTitleTubalCain == 2 ) {
				name_page -= 1
			}
		}
	}

*com_aka_WHILE1
	if ( val == 3 & ogTitleTubalCain == 2 ) {
		goto *com_aka_WEND1
	}
	redraw 0
	pagesize = 0
	if ( cs != cs_bk | p == (-2) ) {
		s = lang("異名の選択", "Alias Selection"), strhint3b
		if ( val == 0 ) {
			s(1) += " " + key_mode2 + " " + lang("[異名のロック]", "[Lock Alias]") + "  " + oomsest_strhint1
		}
		display_window (windoww - 400) / 2 + inf_screenx, winposy(458), 400, 458
		display_topic lang("異名の候補", "Alias List"), wx + 28, wy + 30
		if ( namefilter != "" ) {
			pos wx + 210, wy + 38
			mes lang("フィルタ", "Filter") + ": " + namefilter
		}
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 17
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			if ( val == 3 ) {
				randomize i + cnt
			}
			if ( list(0, 0) == (-1) ) {
				if ( lockedaka(cnt) != "" ) {
					listn(0, cnt) = lockedaka(cnt)
				}
				else {
					if ( val == 3 ) {
						listn(0, cnt) = random_title(val)
					}
					else {
						cnt2 = cnt
						listn(0, cnt2) = ""
						repeat 1000
							nickname = random_title()
							if ( namefilter != "" ) {
								nicknamelower = getpath(nickname, 16)
								if ( instr(nicknamelower, , getpath(namefilter, 16)) < 0 ) {
									continue
								}
							}
							listn(0, cnt2) = nickname
							break
						loop
						if ( listn(0, cnt2) == "" ) {
							listn(0, cnt2) = random_title()
						}
					}
				}
				list(1, cnt) = i + cnt
			}
			if ( cnt == 0 ) {
				listn(0, cnt) = lang("別の名前を考える", "Reroll")
			}
			if ( cnt == 16 & nc_intb_001 == 0 ) {
				if ( ogTitleUnmaskedRider == 2 ) {
					listn(0, cnt) = lang("自分で決める", "Decide by oneself")
				}
			}
			pos wx + 38, wy + 66 + cnt * 19 - 2
			gcopy BUFFER_INF, cnt * 24 + 72, 30, 24, 18
			cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
			if ( lockedaka(cnt) != "" ) {
				pos wx + 20, wy + 68 + cnt * 19
				mes "*"
			}
		loop
		i += 17
		cs_bk = cs
		list(0, 0) = 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = cnt
			break
		}
		else {
			p = -1
		}
	loop
	if ( p != (-1) ) {
		if ( key == key_select(0) ) {
			list(0, 0) = -1
			snd SOUNDLIST_DICE
			cs_bk = -1
		}
		else {
			if ( p == 16 & nc_intb_001 == 0 ) {
				if ( ogTitleUnmaskedRider == 2 ) {
					val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
					inputlog = ""
					gosub *prompt_word
					cmaka = inputlog
					repeat 17
						lockedaka(cnt) = ""
					loop
					snd SOUNDLIST_OK1
					namefilter = ""
					return 1
				}
			}
			namefilter = ""
			if ( val == 3 ) {
				return p
			}
			cmaka = listn(0, p)
			repeat 17
				lockedaka(cnt) = ""
			loop
			return 1
		}
	}
	if ( key == key_cancel ) {
		namefilter = ""
		snd SOUNDLIST_POP2
		return 0
	}
	if ( key == key_mode2 ) {
		if ( val == 0 ) {
			if ( cs != 0 ) {
				if ( lockedaka(cs) == "" ) {
					lockedaka(cs) = listn(0, cs)
					p = -2
				}
				else {
					lockedaka(cs) = ""
					p = -2
				}
				snd SOUNDLIST_OK1
			}
		}
	}
	if ( key == key_msglog ) {
		if ( val == 0 ) {
			val = windoww / 2 - 140 + inf_screenx, winposy(60), 14, 0, 0
			inputlog = ""
			gosub *prompt_word
			namefilter = inputlog
			list(0, 0) = -1
			snd SOUNDLIST_DICE
			cs = 0
			cs_bk = -1
			val = 0
		}
	}
	goto *com_aka_WHILE1

*com_aka_WEND1
	redraw 0
	pagesize = 0
	if ( cs != cs_bk | p == (-2) ) {
		s = lang("異名の選択", "Alias Selection"), strhint3b
		display_window (windoww - 750) / 2 + inf_screenx, winposy(458), 350, 458
		display_topic lang("異名の候補 Page:", "Alias List Page:") + (name_page + 1), wx + 28, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 17
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			randomize i + cnt
			if ( list(0, 0) == (-1) ) {
				listn(0, cnt) = random_title(val)
				list(1, cnt) = i + cnt
				ibk = i
			}
			if ( cnt == 0 ) {
				listn(0, cnt) = lang("別の名前を考える", "Reroll")
			}
			pos wx + 38, wy + 66 + cnt * 19 - 2
			gcopy BUFFER_INF, cnt * 24 + 72, 30, 24, 18
			cs_list listn(0, cnt), wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		s = lang("エンチャント一覧", "Enchantment List"), lang("上記のエンチャントが出現する", "The above Enchantments.")
		display_window (windoww - 50) / 2 + inf_screenx, winposy(458), 400, 458
		if ( ibit(ITEM_BIT_ALIVE, ci) ) {
			display_topic lang("レベルアップ時に現れるエンチャント", "Level up enchantments"), wx + 28, wy + 30
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
			if ( cs != 0 ) {
				nc_intb_living = 1
				reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
				listmax = 0
				repeat 50
					if ( listmax >= 8 ) {
						break
					}
					randomize 50500 + cs + name_page * 17 + iParam1(ci) * 10 + cnt
					exrand_randomize 50500 + cs + name_page * 17 + iParam1(ci) * 10 + cnt
					encadd ci, randomenc(randomenclv(4)), randomencp(0, ogTitleTubalCain == 2), 0, 0, 1
					if ( stat != 0 ) {
						if ( rtval == 34 ) {
							if ( rnd(3) ) {
								continue
							}
						}
						findenc = 0
						repeat listmax
							if ( list_bk(0, cnt) == rtval ) {
								if ( encpassivecheck(rtval) | list_bk(1, cnt) == rtval(1) ) {
									findenc = 1
									break
								}
							}
						loop
						if ( findenc ) {
							continue
						}
						if ( encpassivecheck(rtval) ) {
							if ( encfindspec(ci, rtval) != (-1) ) {
								continue
							}
						}
						list_bk(0, listmax) = rtval, rtval(1)
						if ( ibit(18, ci) & iStatus(ci) <= ITEM_STATUS_DOOMED ) {
							list_bk(1, listmax) = list_bk(1, listmax) * 5 / 2
						}
						val = list_bk(0, listmax), list_bk(1, listmax)
						gosub *item_encdetail
						color 0, 0, 100
						pos wx + 28, wy + 60
						mes s
						wy += 16
						listmax++
					}
					else {
						continue
					}
				loop
				nc_intb_living = 0
			}
		}
		wy = 260
		display_topic lang("継承されるエンチャント", "Inherited enchantments"), wx + 28, wy + 60
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		if ( cs != 0 ) {
			wy += 32
			randomize 50500 + cs + name_page * 17
			dim ginga, 15
			ginga = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
			gingamax = 0
			cibk2 = ci
			dbid = iID(ci)
			ci = 5480
			dbmode = DBMODE_SET
			gosub *db_item
			iNum(ci) = 0
			ci = cibk2
			repeat 10
				locvar_getinheritance_p = rnd(15)
				if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, ci) == 0 ) {
					continue
				}
				locvar_getinheritance_f = 0
				repeat gingamax + 1
					if ( locvar_getinheritance_p == ginga(cnt) ) {
						locvar_getinheritance_f = 1
						break
					}
				loop
				if ( locvar_getinheritance_f == 0 ) {
					i = iMaterial(ci)
					repeat 8
						if ( mtenc(cnt * 2, i) == 0 ) {
							break
						}
						mtencid = mtenc(cnt * 2, i)
						if ( mtencid == 0 ) {
							break
						}
						if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, ci) == mtencid ) {
							if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, ci) - mtenc(cnt * 2 + 1, i) <= 0 ) {
								locvar_getinheritance_f = 1
								break
							}
						}
					loop
				}
				if ( locvar_getinheritance_f == 0 ) {
					repeat length(fixeditemenc)
						if ( fixeditemenc(cnt * 2) == 0 ) {
							break
						}
						if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, ci) != fixeditemenc(cnt * 2) ) {
							continue
						}
						if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, ci) - fixeditemenc(cnt * 2 + 1) <= 0 ) {
							locvar_getinheritance_f = 1
							break
						}
					loop
				}
				if ( locvar_getinheritance_f == 1 ) {
					continue
				}
				if ( rnd(4) > gingamax | inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, ci) < 0 ) {
					ginga(gingamax) = locvar_getinheritance_p
					gingamax++
				}
			loop
			repeat gingamax
				if ( ginga(cnt) == (-1) ) {
					continue
				}
				val = inv(STARTING_INV_ITEM_ENCHANT + ginga(cnt) * 2, ci), inv(STARTING_INV_ITEM_ENCHANT_POWER + ginga(cnt) * 2, ci)
				gosub *item_encdetail
				if ( val(1) < 0 ) {
					color 100, 0, 0
				}
				else {
					color 0, 0, 100
				}
				pos wx + 28, wy + 60
				mes s
				wy += 16
			loop
		}
		val = 3
		cs_bk = cs
		list(0, 0) = 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = cnt
			break
		}
		else {
			p = -1
		}
	loop
	if ( p != (-1) ) {
		if ( key == key_select(0) ) {
			name_page++
			i = ibk
			i += 17
			list(0, 0) = -1
			snd SOUNDLIST_DICE
			cs_bk = -1
		}
		else {
			return p
		}
	}
	if ( key == key_cancel ) {
		namefilter = ""
		snd SOUNDLIST_POP2
		return 0
	}
	goto *com_aka_WEND1

*label_2745
	return

*com_wish_end
	if ( cfg_nc_logapply == 1 ) {
		if ( chatturn > 20 ) {
			chatdeny = 0
			chatturn = 0
			s = lang("[願い] " + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + "は狂喜して叫んだ。「" + inputlog + "！！」" + txtcopy, "[Wish] " + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + " goes wild with joy, \"" + inputlog + "!!\" " + cnven(txtcopy))
			gosub *nc_net
		}
	}
	return

*com_wish
	nc_intb_002 = 0
	msgtemp = ""
	if ( gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_8) ) {
		txt -1, lang("「だめよ。」", "Nope.")
		goto *com_wish_end
	}
	txtgod godcheck(), 2414
	throwsstpevent "Wish", 0, "", 0
	txtcopy = ""
	txtef COLOR_YELLOW
	txt -1, lang("何を望む？", "What do you wish for? ")
	val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
	inputlog = ""
	gosub *prompt_word
	nc_strb_001 = inputlog
	throwsstpevent "Wished", 0, inputlog, 0

*label_2748
	ogdata(71)++
	ncgTimesWished++
	if ( nc_intb_002 == 0 ) {
		txt -1, lang("「" + inputlog + "！！」", cnvtalk(inputlog + "!!"))
	}
	msgtemp = ""
	autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
	if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
		autosave = 0
	}
	tcopy = 1
	if ( inputlog == "" | inputlog == " " ) {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		return
	}
	if ( en ) {
		inputlog = getpath(inputlog, 16)
	}
	snd SOUNDLIST_DING2
	if ( instr(inputlog, 0, "ナスコちゃん") != (-1) | instr(inputlog, 0, "Nasuko Chan") != (-1) ) {
		txt -1, lang("「ナスナスゥ？」", "Nasunasu?")
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, "中の神") != (-1) | instr(inputlog, 0, "god inside") != (-1) ) {
		txtgod godcheck(), 2416
		if ( stat == 0 ) {
			txt -1, lang("中の神も大変…あ…中の神なんているわけないじゃない！…ねえ、聞かなかったことにしてね。", "There's no God inside.")
		}
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, "中の人") != (-1) | instr(inputlog, 0, "man inside") != (-1) ) {
		txtgod godcheck(), 2417
		if ( stat == 0 ) {
			txt -1, lang("中の人も大変ね。", "There's no man inside.")
		}
		goto *com_wish_end
	}
	if ( ogdata(70) == 0 ) {
		if ( get_freeally() != 0 ) {
			if ( ogdata(71) >= 777 + (ogdata(72) > 0) * 7000 ) {
				locvar_matdelmain_f = 0
				locvar_dmghp_p = 0
				repeat 55, 1
					if ( cExist(cnt) != CHAR_STATE_DEAD ) {
						if ( cId(cnt) == CREATURE_ID_GOD_OF_WISHING ) {
							locvar_matdelmain_f = 1
							break
						}
					}
				loop
				if ( locvar_matdelmain_f == 0 ) {
					if ( instr(inputlog, 0, "願いの神") != (-1) | instr(inputlog, 0, "god of wishing") != (-1) ) {
						ogdata(71) = 0
						flt
						initlv = 5
						novoidlv = 1
						characreate -1, CREATURE_ID_GOD_OF_WISHING, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
						gosub *cm_race_loop_WHILE1
						goto *com_wish_end
					}
				}
			}
		}
	}
	if ( inputlog == "エヘカトル" | inputlog == "ehekatl" ) {
		txt -1, lang("「うみみゅみゅぁ！」", cnvtalk("Meeewmew!"))
		flt
		characreate -1, CREATURE_ID_EHEKATL, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "ehekatl"
		goto *com_wish_end
	}
	if ( inputlog == "ルルウィ" | inputlog == "lulwy" ) {
		txt -1, lang("「アタシを呼びつけるとは生意気ね。」", cnvtalk("You dare to call my name?"))
		flt
		characreate -1, CREATURE_ID_LULWY, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "lulwy"
		goto *com_wish_end
	}
	if ( inputlog == "オパートス" | inputlog == "opatos" ) {
		txt -1, lang("「フワッハハハァ！呼ばれたぞ！！」", cnvtalk("Muwahahahahahaha! You called me?"))
		flt
		characreate -1, CREATURE_ID_OPATOS, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "opatos"
		goto *com_wish_end
	}
	if ( inputlog == "クミロミ" | inputlog == "kumiromi" ) {
		txt -1, lang("「呼んだのは…君…？」", cnvtalk("Was it you... who called for me?"))
		flt
		characreate -1, CREATURE_ID_KUMIROMI, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "kumiromi"
		goto *com_wish_end
	}
	if ( inputlog == "マニ" | inputlog == "mani" ) {
		txt -1, lang("「無遠慮だな、私を呼び出すなど」", cnvtalk("Very impertinent, summoning me here."))
		flt
		characreate -1, CREATURE_ID_MANI, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "mani"
		goto *com_wish_end
	}
	if ( inputlog == "ジュア" | inputlog == "jure" ) {
		txt -1, lang("「ね、ねぇ！あなたが私を呼んだの？」", cnvtalk("I-I'm not coming down there just because you called me, stupid...!"))
		flt
		characreate -1, CREATURE_ID_JURE, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		cActHeal(rc) = 907
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "jure"
		goto *com_wish_end
	}
	if ( inputlog == "イツパロトル" | inputlog == "itzpalt" ) {
		txt -1, lang("「汝の召喚に応えよう、定命の者よ」", cnvtalk("Very well. I will go down to you, mortal."))
		flt
		characreate -1, CREATURE_ID_ITZPALT, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		throwsstpevent "AdventGod", rc, inputlog, 0
		adventothergod "itzpalt"
		goto *com_wish_end
	}
	f = 0
	repeat usergodmax
		s = usergoddatan(3, cnt)
		if ( inputlog == s ) {
			if ( usergoddatan(10, cnt) != "" ) {
				txtgod usergoddatan(2, cnt), 16
				flt
				initunid = findunid(usergoddatan(10, cnt))
				characreate -1, CREATURE_ID_USER, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
				adventothergod usergoddatan(2, cnt)
				f = 1
				break
			}
		}
	loop
	if ( f ) {
		goto *com_wish_end
	}
	if ( inputlog == "若さ" | inputlog == "若返り" | inputlog == "年" | inputlog == "年齢" | inputlog == "美貌" | inputlog == "age" | inputlog == "youth" | inputlog == "beauty" ) {
		nc_strb_002 = inputlog
		txtgod godcheck(), 2418
		if ( stat == 0 ) {
			txt -1, lang("ふぅん…そんな願いでいいんだ。", "A typical wish.")
		}
		txt -1, lang("誰の年齢を変更する？", "Change whose age?")
		allyctrl = 3
		gosub *label_2694
		if ( stat != (-1) ) {
			tc = stat
			txt -1, lang("変更後の年齢は？", "What is the new age?")
			inputlog = ""
			val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
			gosub *prompt_word
			name_page = int(inputlog)
			if ( name_page < 0 ) {
				name_page = 0
			}
			cAge(tc) = gYear  - name_page
			snd SOUNDLIST_PRAY1
		}
		inputlog = nc_strb_002
		goto *com_wish_end
	}
	if ( inputlog == "通り名" | inputlog == "異名" | inputlog == "aka" | inputlog == "title" | inputlog == "name" | inputlog == "alias" ) {
		if ( gWizard & 0 ) {
			txtgod godcheck(), 2420
			if ( stat == 0 ) {
				txt -1, lang("だめよ。", "*laugh*")
			}
			goto *com_wish_end
		}
		nc_intb_001 = 0
		txtnew
		txt -1, lang("誰の異名を変更する？", "Change whose alias?")
		allyctrl = 3
		gosub *label_2694
		if ( stat != (-1) ) {
			tc = stat
			txt -1, lang("新しい異名は？", "What will the new alias be?")
			val = 0
			gosub *com_aka
			if ( stat == 1 ) {
				txtgod godcheck(), 2419
				if ( stat == 0 ) {
					txt -1, lang(cnName(tc) + "の新しい異名は「" + cmaka + "」。満足したかしら？", cnName(tc) + " will be known as <" + cmaka + ">.")
				}
				msgtemp = cnAka(tc) + cnName(tc) + "は今後" + cmaka + "と名乗ることにした。"
				cnAka(tc) = cmaka
			}
			else {
				txtgod godcheck(), 2421
				if ( stat == 0 ) {
					txt -1, lang("あら、そのままでいいの？", "What a waste of a wish!")
				}
				msgtemp = "あら、そのままでいいの？"
			}
		}
		goto *com_wish_end
	}
	if ( inputlog == "ペットフィート" | inputlog == "petfeat" ) {
		txtnew
		txt -1, lang("誰のフィートを初期化する？", "Reset whose feats?")
		allyctrl = 99
		gosub *label_2611
		if ( stat != (-1) ) {
			tc = stat
			featcnt = 0
			repeat 140, 1
				if ( cnt == 130 ) {
					continue
				}
				if ( gettrait(p, cnt) != 0 ) {
					featcnt += stat
					rmfaction p, "trait" + cnt + "," + stat
				}
			loop
			ocFeatsAcquirable(tc) += featcnt
			txt -1, lang(cnName(tc) + "のフィートを初期化した！", cnName(tc) + "'s feats are completely cleared!")
		}
		goto *com_wish_end
	}
	if ( inputlog == "フィート初期化" | inputlog == "featreset" ) {
		tc = CHARA_PLAYER
		featcnt = 0
		repeat 94, 46
			if ( cnt == 130 ) {
				continue
			}
			if ( gettrait(0, cnt) != 0 ) {
				featcnt += stat
				rmfaction 0, "trait" + cnt + "," + stat
			}
			if ( cnt == 59 ) {
				cbitmod CHARA_BIT_TEMPER, CHARA_PLAYER, FALSE
			}
		loop
		if ( gettrait(0, 19) != 0 ) {
			featcnt += stat
			rmfaction 0, "trait19," + stat
			trait(TRAIT_NORMAL_SKILL_DUAL_WIELD) = 0
		}
		if ( gettrait(0, 20) != 0 ) {
			featcnt += stat
			rmfaction 0, "trait20," + stat
			trait(TRAIT_NORMAL_SPACT_VINDALIAN_JIUJITSU) = 0
		}
		if ( gettrait(0, 43) != 0 ) {
			featcnt += stat
			rmfaction 0, "trait43," + stat
			cbitmod CHARA_BIT_BREAK_WALLS, CHARA_PLAYER, FALSE
			trait(TRAIT_NORMAL_OTHER_SHIELD_BASH) = 0
		}
		repeat 24, 1
			if ( cnt == 19 | cnt == 20 ) {
				continue
			}
			if ( trait(cnt) != 0 ) {
				featcnt += trait(cnt)
				trait(cnt) = 0
			}
		loop
		repeat 3, 38
			if ( trait(cnt) != 0 ) {
				featcnt += trait(cnt)
				trait(cnt) = 0
			}
		loop
		repeat 3, 42
			if ( cnt == 130 ) {
				continue
			}
			if ( trait(cnt) != 0 ) {
				featcnt += trait(cnt)
				trait(cnt) = 0
			}
		loop
		spact(SKILL_SPACT_DRAIN_BLOOD - STARTING_SKILL_SPACT) = 0
		spact(SKILL_SPACT_FIRE_BREATH - STARTING_SKILL_SPACT) = 0
		spact(SKILL_SPACT_DIMENSIONAL_MOVE - STARTING_SKILL_SPACT) = 0
		spact(SKILL_SPACT_TOUCH_OF_SLEEP - STARTING_SKILL_SPACT) = 0
		spact(SKILL_SPACT_TOUCH_OF_POISON - STARTING_SKILL_SPACT) = 0
		spact(SKILL_SPACT_CHEER - STARTING_SKILL_SPACT) = 0
		ospact(794 - 661) = 0
		gTraitPoint += featcnt
		txt -1, lang("あなたのフィートを初期化した！", "Your feats are completely cleared!")
		goto *com_wish_end
	}
	if ( inputlog == "すくつ初期化" | inputlog == "voidreset" ) {
		if ( areaId(gArea ) == AREA_VOID ) {
			txt -1, lang("すくつにいるときは初期化できない", "Can't reset it in the Void itself.")
		}
		else {
			txt -1, lang("すくつを初期化した", "Reset the deepest level of the Void you have entered.")
			repeat 500
				if ( areaId(cnt) == AREA_VOID ) {
					areaDeepest(cnt) = 0
					gVoidBoss = 0
					break
				}
			loop
		}
		goto *com_wish_end
	}
	if ( inputlog == "名声" | inputlog == "fame" ) {
		if ( cFame(CHARA_PLAYER) >= 1000000 ) {
			txt -1, lang("残念だけど、これ以上の名誉は存在しないわ。", "I can't give you any more fame than you already have.")
			goto *com_wish_end
		}
		gQuestFame = calcfame(CHARA_PLAYER, 10000)
		txtef COLOR_GREEN
		txt -1, lang("" + gQuestFame + "の名声値を手に入れた。", "You gain " + gQuestFame + " fame.")
		incfame 0, gQuestFame
		txt -1, lang("あら…都合のいいことを言うのね。", "What a convenient wish!")
		goto *com_wish_end
	}
	if ( inputlog == "送還" | inputlog == "repatriation" ) {
		f = 0
		repeat 245 - 57, 57
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cRole(cnt) == ROLE_PET_SENTRY | cRole(cnt) == ROLE_PET_MAID ) {
				continue
			}
			if ( areaBoss(gArea ) == cnt ) {
				continue
			}
			if ( cId(cnt) == CREATURE_ID_EHEKATL ) {
				txtgod "ehekatl", 22
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_GOD_INSIDE_EHEKATL ) {
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_LULWY ) {
				txtgod "lulwy", 22
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_OPATOS ) {
				txtgod "opatos", 22
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_KUMIROMI ) {
				txtgod "kumiromi", 22
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_MANI ) {
				txtgod "mani", 22
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_JURE ) {
				txtgod "jure", 22
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_ITZPALT ) {
				txtgod "itzpalt", 22
				txt -1, lang(name(cnt) + "は消え去った。", name(cnt) + " vanish" + _s(cnt, 1) + ".")
				chara_vanquish cnt
				f = 1
				continue
			}
			if ( cId(cnt) == CREATURE_ID_USER ) {
				if ( cUNID(cnt) != (-1) ) {
					nc_intb_110 = cnt
					repeat usergodmax
						if ( cUNID(nc_intb_110) + 1 == findunid(usergoddatan(10, cnt)) ) {
							txtgod usergoddatan(2, cnt), 22
							txt -1, lang(name(nc_intb_110) + "は消え去った。", name(nc_intb_110) + " vanish" + _s(nc_intb_110, 1) + ".")
							chara_vanquish nc_intb_110
							f = 1
							break
						}
					loop
				}
			}
		loop
		if ( f == 0 ) {
			txt -1, lang("送還出来る神がいない。", "There is no god that can repatriate us.")
		}
		else {
			txt -1, lang("神々を送還した。", "The gods have been repatriated.")
		}
		goto *com_wish_end
	}
	if ( inputlog == "贖罪" | inputlog == "redemption" | inputlog == "atonement" ) {
		if ( cKarma(CHARA_PLAYER) >= 0 ) {
			txtgod godcheck(), 2424
			if ( stat == 0 ) {
				txt -1, lang("…罪なんて犯してないじゃない。", "You aren't a sinner.")
			}
			goto *com_wish_end
		}
		modkarma 0, -cKarma(CHARA_PLAYER)
		txtgod godcheck(), 2423
		if ( stat == 0 ) {
			txt -1, lang("あら…都合のいいことを言うのね。", "What a convenient wish!")
		}
		goto *com_wish_end
	}
	if ( ogTitleJunkie == 2 & (inputlog == "本当の死" | inputlog == "truedeath" | inputlog == "realdeath") ) {
		if ( gArea  != AREA_VOID & gArea  != 210 ) {
			txt -1, lang("ここでは召喚できない。", "Nope.")
			goto *com_wish_end
		}
		playbgm "soraochi.mid"
		txt -1, lang("*本当に*それがお望みなら…", "If you wish so...")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		if ( gArea  == AREA_VOID ) {
			flt
			initlv = 99999
			novoidlv = 1
			characreate -1, CREATURE_ID_GOD_OF_WISHING, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			if ( stat != 0 ) {
				cnName(rc) = lang("《The Over Wish》", "The Over Wish")
				addfaction rc, "overwish"
				addtrait rc, 58, 4
				addbuff rc, 60, limit(cLevel(rc) * 10, 1, 100000), 10000
				addbuff rc, 61, 1, 10000
				addbuff rc, 63, 1, 10000
				cbitmod CHARA_BIT_RES_FEAR, rc, TRUE
				ocbitmod 13, rc, 1
				cRelation(rc) = RELATION_ENEMY
				cAiMoveFreq(rc) = 30
				cAiSub(rc) = 50
				cdata(STARTING_CDATA_ACT_SUB, rc) = SKILL_SPACT_MEWMEWMEW, SKILL_SPACT_MEWMEWMEW, SKILL_SPACT_MANIS_DISASSEMBLY, 903, 798
				cActIndex(rc) = 51
				lockon rc, 0, 11
				cAiAggro(rc) = 20
				mTimeScale = 1000000
				txtef COLOR_BLUE
				txt -1, lang("先制攻撃！", "First Attack!")
				txtef COLOR_BLUE
				txt -1, lang("衰弱の願い！", "A cold wind covers the area...")
				animeid = ANIMATION_HOLY
				animode = 0
				gosub *anime
				repeat 245
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( rc == cnt ) {
						continue
					}
					if ( eqfaction(cnt, "overwish") ) {
						continue
					}
					nc_intb_001 = cnt
					txt -1, lang(name(cnt) + "の強化が立ち消える！", "")
					repeat 8 + 8
						if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, nc_intb_001) == 0 ) {
							break
						}
						delbuff nc_intb_001, cnt
						continue cnt
					loop
					addbuff nc_intb_001, 62, 1, 20000, 2100000000
					txtef COLOR_BLUE
					txt -1, lang(name(cnt) + "の体力が１になった！", "")
					cHP(cnt) = 1
				loop
			}
		}
		else {
			flt
			initlv = 99999
			novoidlv = 1
			characreate -1, CREATURE_ID_GOD_OF_WISHING, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			if ( stat != 0 ) {
				cnName(rc) = lang("《The Over Wish》", "The Over Wish")
				addfaction rc, "overwish"
				addtrait rc, 58, 4
				repeat 600
					sdataex(cnt, rc) = 50000000
					if ( cnt == 2 ) {
						sdataex(cnt, rc) = 40000
					}
				loop
				cbitmod CHARA_BIT_RES_FEAR, rc, TRUE
				ocbitmod 13, rc, 1
				cRelation(rc) = RELATION_ENEMY
				cAiMoveFreq(rc) = 30
				cAiSub(rc) = 50
				cdata(STARTING_CDATA_ACT_SUB, rc) = SKILL_SPACT_MEWMEWMEW, SKILL_SPACT_MEWMEWMEW, SKILL_SPACT_MANIS_DISASSEMBLY, 903, 910
				cActIndex(rc) = 51
				lockon rc, 0, 11
				cAiAggro(rc) = 20
				txtef COLOR_BLUE
				txt -1, lang("先制攻撃！", "First Attack!")
				txtef COLOR_BLUE
				txt -1, lang("衰弱の願い！", "A cold wind covers the area...")
				animeid = ANIMATION_HOLY
				animode = 0
				gosub *anime
				repeat 245
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( rc == cnt ) {
						continue
					}
					if ( eqfaction(cnt, "overwish") ) {
						continue
					}
					nc_intb_001 = cnt
					txt -1, lang(name(cnt) + "の強化が立ち消える！", "")
					repeat 8 + 8
						if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, nc_intb_001) == 0 ) {
							break
						}
						delbuff nc_intb_001, cnt
						continue cnt
					loop
					addbuff nc_intb_001, 62, 1, 20000, 2100000000
					txtef COLOR_BLUE
					txt -1, lang(name(cnt) + "の体力が１になった！", "")
					cHP(cnt) = 1
				loop
			}
		}
		music = MUSICLIST_SCENE_MUSIC
		gosub *music_play
		goto *com_wish_end
	}
	if ( inputlog == "未来" | inputlog == "future" ) {
		gYear  += 1
		repeat 16
			if ( gettrait(cnt, 131) == 1 ) {
				cAge(cnt) += 1
				if ( cAge(cnt) > gYear  ) {
					cAge(cnt) = gYear 
				}
			}
		loop
		txt -1, lang("あなたは1年先の未来へ飛んだ。", "You flew to the future.")
		goto *com_wish_end
	}
	if ( inputlog == "過去" | inputlog == "past" ) {
		if ( gYear  >= 518 ) {
			gYear  -= 1
			repeat 16
				if ( gettrait(cnt, 131) == 1 ) {
					cAge(cnt) -= 1
				}
				if ( cAge(cnt) < gYear  ) {
					cAge(cnt) = gYear 
				}
			loop
			txt -1, lang("あなたは1年後ろの過去へ飛んだ。", "You flew to the past.")
		}
		else {
			txt -1, lang("これ以上過去には戻せない。", "There is no going back to the past.")
		}
		goto *com_wish_end
	}
	if ( inputlog == "商品入れ替え" | inputlog == "replacement" ) {
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cRole(cnt) >= (1000 /*!!!@[ROLE_SHOP_MIN @@@ ROLE_SHOP_WEAPON]@!!! */) & cRole(cnt) < (2000 /*!!!@[ROLE_GUEST_BEGGAR @@@ ROLE_GUEST_MIN]@!!! */) | cRole(cnt) == ROLE_GUEST_MERCHANT | cRole(cnt) == ROLE_SHOP_MATERIAL | cRole(cnt) == ROLE_SHOP_SPELLBOOK | cRole(cnt) == ROLE_SHOP_APHRODISIAC | cRole(cnt) == ROLE_SHOP_DOUJINSHI | cRole(cnt) == ROLE_SHOP_UNKNOWN3104 | cRole(cnt) == ROLE_SHOP_HERB_MERCHANT | cRole(cnt) == ROLE_SHOP_PROSTITUTE_GUILD | cRole(cnt) == ROLE_SHOP_BLACKSMITH_GUILD | cRole(cnt) == ROLE_SHOP_MYSTERIOUS_PRODUCER | cRole(cnt) == ROLE_SHOP_FAIRY | cRole(cnt) == ROLE_SHOP_MORPHY ) {
				cRoleRestock(cnt) = getgametime() - 1
			}
		loop
		txt -1, lang("お店に新商品が入荷した。", "New products arrived at the store.")
		goto *com_wish_end
	}
	if ( inputlog == "死" | inputlog == "death" ) {
		txtgod godcheck(), 2425
		if ( stat == 0 ) {
			txt -1, lang("それがお望みなら…", "If you wish so...")
		}
		if ( ogTitleNobodysInside == 2 ) {
			flt
			characreate -1, CREATURE_ID_GOD_INSIDE_EHEKATL, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			if ( stat != 0 ) {
				if ( gArea  == AREA_VOID & gLevel  >= 1050 ) {
					addbuff rc, 60, limit(cLevel(rc) * 10, 1, 100000), gLevel  / 10
					addbuff rc, 61, 1, gLevel  / 10
				}
				if ( gArea  == AREA_VOID & gLevel  >= 10050 ) {
					addbuff rc, 63, 1, gLevel  / 10
				}
			}
		}
		else {
			cHP(CHARA_PLAYER) = -1
			dmghp CHARA_PLAYER, 99999, DAMAGE_FROM_UNSEEN
		}
		goto *com_wish_end
	}
	if ( inputlog == "仲間" | inputlog == "friend" | inputlog == "company" | inputlog == "ally" ) {
		evadd EVENT_FIRST_ALLY
		goto *com_wish_end
	}
	if ( inputlog == "金" | inputlog == "金貨" | inputlog == "富" | inputlog == "財産" | inputlog == "money" | inputlog == "gold" | inputlog == "wealth" | inputlog == "fortune" ) {
		txtef COLOR_YELLOW
		txt -1, lang("金貨が降ってきた！", "Lots of gold pieces appear.")
		flt
		itemcreate -1, ITEM_ID_GOLD_PIECE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), int(limitf(double(difficulty() / 3 + 1) * 10000, 0, 2147483647))
		txtgod godcheck(), 2415
		goto *com_wish_end
	}
	if ( inputlog == "メダル" | inputlog == "小さなメダル" | inputlog == "ちいさなメダル" | inputlog == "coin" | inputlog == "medal" | inputlog == "small coin" | inputlog == "small medal" ) {
		txtef COLOR_YELLOW
		txt -1, lang("小さなメダルが降ってきた！", "Small coins appear.")
		flt
		itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3 + rnd(3)
		txtgod godcheck(), 2415
		goto *com_wish_end
	}
	if ( inputlog == "プラチナ" | inputlog == "プラチナ硬貨" | inputlog == "platina" | inputlog == "platinum" ) {
		txtef COLOR_YELLOW
		txt -1, lang("プラチナ硬貨が降ってきた！", "Platinum pieces appear.")
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 5
		txtgod godcheck(), 2415
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, lang("ペットスキル", "petskill")) != (-1) ) {
		goto *label_2783
	}
	if ( instr(inputlog, 0, lang("スキル", "skill")) != (-1) ) {
		goto *wish_skill
	}
	if ( instr(inputlog, 0, lang("アイテム", "item")) != (-1) ) {
		goto *label_2773
	}
	if ( instr(inputlog, 0, lang("カード", "card")) != (-1) ) {
		goto *label_2787
	}
	if ( instr(inputlog, 0, lang("剥製", "figure")) != (-1) | instr(inputlog, 0, "はく製") != (-1) ) {
		goto *label_2788
	}
	if ( instr(inputlog, 0, lang("死体", "corpse")) != (-1) ) {
		goto *label_2789
	}
	if ( instr(inputlog, 0, lang("エロ本", "pornbook")) != (-1) ) {
		goto *label_5033
	}
	if ( instr(inputlog, 0, lang("性別変更", "change sex")) != (-1) | inputlog == "性転換" | inputlog == "性" | inputlog == "異性" | inputlog == "sex" ) {
		txtnew
		txt -1, lang("誰の性別を変更する？", "Change whose sex?")
		allyctrl = 3
		gosub *label_2694
		if ( stat != (-1) ) {
			tc = stat
			cSex(tc) = 1 - cSex(tc)
			if ( tc != CHARA_PLAYER ) {
				if ( cPic(tc) == creaturepic(cId(tc), 1 - cSex(tc)) + creaturecolor(cId(tc)) * 1000 ) {
					cPic(tc) = creaturepic(cId(tc), cSex(tc)) + creaturecolor(cId(tc)) * 1000
				}
			}
			snd SOUNDLIST_PRAY1
			txt -1, lang(cnName(tc) + "は" + _sex(cSex(tc)) + "になった！", name2(tc) + " become" + _s(tc) + " " + _sex(cSex(tc)) + "!")
			txtgod godcheck(), 2422
			if ( stat == 0 ) {
				txt -1, lang("…もう後戻りはできないわよ。", "")
			}
		}
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, lang("体重", "weight")) != (-1) ) {
		nc_strb_002 = inputlog
		txtnew
		txt -1, lang("誰の体重を変更する？", "Change whose weight?")
		allyctrl = 3
		gosub *label_2694
		if ( stat != (-1) ) {
			tc = stat
			txt -1, lang("変更後の体重は？", "What is the new weight?")
			inputlog = ""
			val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
			gosub *prompt_word
			name_page = int(inputlog)
			if ( name_page < 0 ) {
				name_page = 0
			}
			cWeight(tc) = name_page
			snd SOUNDLIST_PRAY1
			txt -1, lang(cnName(tc) + "の体重が変化した！ …もう後戻りはできないわよ。", name2(tc) + "Change weight!")
		}
		inputlog = nc_strb_002
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, lang("身長", "height")) != (-1) ) {
		nc_strb_002 = inputlog
		txtnew
		txt -1, lang("誰の身長を変更する？", "Change whose height?")
		allyctrl = 3
		gosub *label_2694
		if ( stat != (-1) ) {
			tc = stat
			txt -1, lang("変更後の身長は？", "What is the new height?")
			inputlog = ""
			val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
			gosub *prompt_word
			name_page = int(inputlog)
			if ( name_page < 0 ) {
				name_page = 0
			}
			cHeight(tc) = name_page
			snd SOUNDLIST_PRAY1
			txt -1, lang(cnName(tc) + "の身長が変化した！ …もう後戻りはできないわよ。", name2(tc) + "Change height!")
		}
		inputlog = nc_strb_002
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, lang("呼び出し", "invoke")) != (-1) ) {
		f = -1
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			s = cnName(cnt)
			if ( en ) {
				s = getpath(s, 16)
			}
			if ( instr(inputlog, 0, s) != (-1) ) {
				f = 1
				cnt2 = cnt
				repeat 200
					p = 1, -1
					cXnew(cnt2) = cX(CHARA_PLAYER) + rnd(5) * p(rnd(2))
					cYnew(cnt2) = cY(CHARA_PLAYER) + rnd(5) * p(rnd(2))
					cell_check cXnew(cnt2), cYnew(cnt2)
					if ( cellaccess == 1 ) {
						txt -1, lang(cnName(cnt2) + "は" + "呼び出された。", cnName(cnt2) + " was invoked.")
						rowactend cnt2
						ccprev = 0
						cc = cnt2
						gosub *label_3294
						cc = ccprev
						gosub *screen_draw
						break
					}
				loop
				break
			}
		loop
		if ( f == (-1) ) {
			txtgod godcheck(), 2427
			if ( stat == 0 ) {
				txt -1, lang("…そんな人いないじゃない。", "...But nobody came.")
			}
		}
		goto *com_wish_end
	}
	if ( inputlog == "q" ) {
		txtef COLOR_YELLOW
		txt -1, lang("うわぁぁぁ！！", "Ahhhhh!!")
		repeat 10
			flt
			characreate -1, CREATURE_ID_AT_SIGN, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		loop
		goto *com_wish_end
	}
	if ( inputlog == lang("プレイヤー物件のダンジョン", "my dungeon") ) {
		flt
		itemcreate -1, ITEM_ID_POP_CORN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		item_identify ci, ITEM_KNOWN_FULL
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + ".")
		goto *com_wish_end
	}
	if ( inputlog == lang("タイムマシン", "time machine") ) {
		flt
		itemcreate -1, ITEM_ID_SHELTER, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 20
		item_identify ci, ITEM_KNOWN_FULL
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + ".")
		goto *com_wish_end
	}
	if ( inputlog == "妹" | inputlog == "sister" | inputlog == "younger sister" ) {
		evadd 100
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, lang("祭壇", "altar")) != (-1) ) {
		flt
		itemcreate -1, ITEM_ID_ALTAR, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		repeat length(isetgod)
			s = godname(godno2godid(isetgod(cnt)))
			if ( en ) {
				s = getpath(s, 16)
			}
			if ( instr(inputlog, 0, s) != (-1) ) {
				iParam1(ci) = isetgod(cnt)
				break
			}
		loop
		if ( iParam1(ci) == 0 ) {
			repeat usergodmax
				s = usergoddatan(1, cnt)
				if ( en ) {
					s = getpath(s, 16)
				}
				if ( instr(inputlog, 0, s) != (-1) ) {
					iParam2(ci) = cnt
					iParam3(ci) = creategoduid(iParam2(ci))
					break
				}
			loop
		}
		item_identify ci, ITEM_KNOWN_FULL
		txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + ".")
		goto *com_wish_end
	}
	if ( gWizard ) {
		if ( inputlog == "魔法作成" & gWizard == 1 ) {
			if ( userspellmax < 50 ) {
				gosub *label_4586
				gosub *screen_draw
				goto *pc_turn
			}
			else {
				txt -1, lang("もうこれ以上作れないわよ。", "Nope.")
			}
			goto *com_wish_end
		}
		if ( instr(inputlog, 0, lang("ペット召喚", "makepet")) != (-1) & gWizard == 1 ) {
			gosub *wish_monster
			flt
			characreate -1, dbid, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			gosub *cm_race_loop_WHILE1
			goto *label_2745
		}
		if ( inputlog == "完全復活" ) {
			txt -1, "復活！"
			gosub *label_3578
			goto *label_2745
		}
		if ( inputlog == "奈落の祝福" ) {
			txt -1, "いくよ！"
			addbuff CHARA_PLAYER, 66, 10000, 10000
			goto *label_2745
		}
		if ( instr(inputlog, 0, "キャラ生成") != (-1) ) {
			gosub *wish_monster
			flt
			characreate -1, dbid, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			goto *label_2745
		}
		if ( instr(inputlog, 0, "給料テスト") != (-1) ) {
			gosub *event_income
			goto *label_2745
		}
	}
	if ( inputlog == "クリスマス中止" | inputlog == "cancel christmas" ) {
		if ( ogbit(9) ) {
			txt -1, lang("今年の聖夜祭は既に中止が決まっている。", "This year's Christmas Eve festival has already been canceled.")
		}
		else {
			ogbitmod 9, 1
			txt -1, lang("今年の聖夜祭は中止になった。", "This year's Christmas Eve festival has been canceled.")
			modkarma 0, 60
		}
		goto *com_wish_end
	}
	if ( instr(inputlog, 0, lang("聖なる武器", "justice weapon")) != (-1) ) {
		goto *label_2791
	}
	if ( instr(inputlog, 0, lang("邪悪な武器", "evil weapon")) != (-1) ) {
		goto *label_2793
	}
	if ( instr(inputlog, 0, lang("生きている武器", "living weapon")) != (-1) ) {
		goto *label_2795
	}
	if ( instr(inputlog, 0, "種族") != (-1) | instr(inputlog, 0, "race") != (-1) ) {
		txtnew
		txt -1, lang("誰の種族を変更する？", "Change whose race?")
		allyctrl = 3
		gosub *label_2694
		if ( stat != (-1) ) {
			tc = stat
			newrace = -1
			s = inputlog
			sreplace s, s, "種族変更", ""
			sreplace s, s, "change race", ""
			sreplace s, s, "種族", ""
			sreplace s, s, "race", ""
			repeat length(racenamecsv)
				s(1) = getpath(racenamecsv(cnt, 0), 16)
				s(2) = getpath(racenamecsv(cnt, 1), 16)
				if ( instr(s, 0, s(1)) != (-1) | instr(s, 0, s(2)) != (-1) ) {
					if ( racenamecsv(cnt, 1) == "" ) {
						continue
					}
					if ( cnRace(tc) == racenamecsv(cnt, 1) ) {
						continue
					}
					newrace = cnt
				}
			loop
			if ( newrace == (-1) ) {
				newrace = rnd(length(racenamecsv))
			}
			cnRace(tc) = racenamecsv(newrace, 1)
			snd SOUNDLIST_PRAY1
			txt -1, lang(cnName(tc) + "は" + racenamecsv(newrace, 0) + "になった！…もう後戻りはできないわよ。", cnName(tc) + " become" + _s(tc) + " " + racenamecsv(newrace, 0) + "!")
		}
		goto *com_wish_end
	}

*label_2773
	gosub *wish_fix
	i = 0
	repeat useritemmax
		p = 0
		cnt2 = cnt
		s = lang(useritemdatan(1, cnt), useritemdatan(0, cnt))
		if ( en ) {
			s = getpath(s, 16)
		}
		if ( s == inputlog ) {
			p = 10000
		}
		if ( p != 0 ) {
			citemlist(i) = cnt2 + 1
			dblist(0, i) = 743, p
			i++
		}
	loop
	repeat length(ioriginalnameref)
		if ( cnt == 0 ) {
			continue
		}
		if ( cnt == 23 & gWizard == 0 ) {
			continue
		}
		if ( cnt == 290 & gWizard == 0 ) {
			continue
		}
		if ( cnt == 289 & gWizard == 0 ) {
			continue
		}
		if ( cnt == 361 & gWizard == 0 ) {
			continue
		}
		p = 0
		s = cnvitemname(cnt)
		if ( en ) {
			s = getpath(s, 16)
		}
		if ( s == inputlog ) {
			p = 10000
		}
		repeat strlen(inputlog)
			if ( instr(s, 0, strmid(inputlog, 0, cnt * (1 + jp))) != (-1) ) {
				p = p + 50 * (cnt + 1) + rnd(15)
			}
		loop
		if ( p != 0 ) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	if ( i != 0 ) {
		repeat
			p = 0, 0
			inititemid = 0
			repeat i
				if ( dblist(1, cnt) > p(1) ) {
					p = dblist(0, cnt), dblist(1, cnt)
					wishid = cnt
				}
			loop
			if ( p == 0 ) {
				f = 0
				break
			}
			if ( p == 743 ) {
				inititemid = citemlist(wishid)
			}
			flt difficulty() + 10, FIX_QUALITY_MIRACLE
			if ( p == 558 | p == 556 | p == 557 | p == 664 ) {
				fixlv = calcfixlv(FIX_QUALITY_GREAT)
			}
			if ( p == 630 ) {
				objfix = 2
			}
			nostack = 1
			nooracle = 1
			itemcreate -1, p, cX(cc), cY(cc), 0
			nooracle = 0
			if ( ibit(ITEM_BIT_PRECIOUS, ci) == TRUE | iQuality(ci) == FIX_QUALITY_UNIQUE ) {
				if ( gWizard == 0 ) {
					dblist(1, wishid) = 0
					iNum(ci) = 0
					itemmemory(1, iID(ci))--
					cell_refresh iX(ci), iY(ci)
					continue
				}
			}
			if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
				iNum(ci) = difficulty() * difficulty() * 50 + 20000
			}
			if ( iID(ci) == ITEM_ID_PLATINUM_COIN ) {
				iNum(ci) = 8 + rnd(5)
			}
			if ( iID(ci) == ITEM_ID_HOLY_WELL ) {
				iNum(ci) = 0
				flt
				itemcreate -1, ITEM_ID_BOTTLE_WATER, cX(cc), cY(cc), 3
				iStatus(ci) = ITEM_STATUS_BLESSED
				txtgod godcheck(), 2426
				if ( stat == 0 ) {
					txt -1, lang("あ、それ在庫切れ。", "It's sold out.")
				}
			}
			if ( iID(ci) == ITEM_ID_PUTITORO ) {
				iNum(ci) = 3
				iStatus(ci) = ITEM_STATUS_BLESSED
				rndsel = rnd(10)
				if ( rndsel < 5 ) {
					iParam1(ci) = 65000
				}
				else {
					if ( rndsel < 7 ) {
						iParam1(ci) = 465000
					}
					else {
						if ( rndsel < 9 ) {
							iParam1(ci) = 459000
						}
						else {
							iParam1(ci) = 390010
						}
					}
				}
				iValue(ci) = 100000
				txt -1, lang("今日のおススメの1本はこれよ。", "This is one of my recommendations today.")
			}
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_POTION | refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_SCROLL ) {
				iNum(ci) = 3 + rnd(2)
				if ( iValue(ci) >= 5000 ) {
					iNum(ci) = 3
				}
				if ( iValue(ci) >= 10000 ) {
					iNum(ci) = 2
				}
				if ( iValue(ci) >= 20000 ) {
					iNum(ci) = 1
				}
				if ( iID(ci) == ITEM_ID_POTION_CURE_CORRUPTION ) {
					iNum(ci) = 2 + rnd(2)
				}
				if ( iID(ci) == ITEM_ID_SCROLL_SUPERIOR_MATERIAL ) {
					iNum(ci) = 2
				}
				if ( iID(ci) == ITEM_ID_SCROLL_GAIN_ATTRIBUTE ) {
					iNum(ci) = 1
				}
				if ( iID(ci) == ITEM_ID_TREASURE_MAP ) {
					iNum(ci) = 1
				}
				if ( iID(ci) == ITEM_ID_POTION_DESCENT ) {
					iNum(ci) = 1
				}
			}
			if ( ogTitleChronos == 2 & refitem(iID(ci), DBSPEC_TYPE, ci) > FILTER_ITEM_MIN & iID(ci) != ITEM_ID_CARNEADES_PLANK ) {
				iNum(ci) += rnd(2) + 1
			}
			item_identify ci, ITEM_KNOWN_FULL
			txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + ".")
			f = 1
			break
		loop
		if ( f ) {
			goto *com_wish_end
		}
	}

*wish_skill
	gosub *wish_fix
	i = 0
	repeat 600
		f = 0
		if ( cnt >= 10 & cnt < 20 ) {
			f = 1
		}
		if ( cnt >= 100 & cnt < 400 ) {
			f = 1
		}
		if ( f == 0 ) {
			continue
		}
		p = 0
		cnt2 = cnt
		s = skillname(cnt2)
		if ( en ) {
			s = getpath(s, 16)
		}
		if ( s == inputlog ) {
			p = 10000
		}
		repeat strlen(inputlog) / (1 + jp)
			if ( instr(s, 0, strmid(inputlog, cnt * (1 + jp), 1 + jp)) != (-1) ) {
				p += 50 + rnd(15)
			}
		loop
		if ( p != 0 ) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	if ( i != 0 ) {
		p = 0, 0
		repeat i
			if ( dblist(1, cnt) > p(1) ) {
				p = dblist(0, cnt), dblist(1, cnt)
			}
		loop
		if ( skillname(p) != "" ) {
			txtef COLOR_YELLOW
			if ( sorg(p, CHARA_PLAYER) == 0 ) {
				txt -1, lang(skillname(p) + "の技術を会得した！", "You learn " + skillname(p) + "!")
				skillgain CHARA_PLAYER, p, 1
			}
			else {
				txt -1, lang(skillname(p) + "が上昇した！", "Your " + skillname(p) + " skill improves!")
				skillmod p, CHARA_PLAYER, 1000
				modgrowth2 0, p, 25
			}
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		goto *com_wish_end
	}
	txt -1, lang("何もおきない… ", "Nothing happens...")
	goto *com_wish_end

*label_2783
	gosub *wish_fix
	i = 0
	repeat 600
		f = 0
		if ( cnt >= 10 & cnt < 20 ) {
			f = 1
		}
		if ( cnt >= 100 & cnt < 400 ) {
			f = 1
		}
		if ( f == 0 ) {
			continue
		}
		p = 0
		cnt2 = cnt
		s = skillname(cnt2)
		if ( en ) {
			s = getpath(s, 16)
		}
		if ( s == inputlog ) {
			p = 10000
		}
		repeat strlen(inputlog) / (1 + jp)
			if ( instr(s, 0, strmid(inputlog, cnt * (1 + jp), 1 + jp)) != (-1) ) {
				p += 50 + rnd(15)
			}
		loop
		if ( p != 0 ) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	if ( i != 0 ) {
		p = 0, 0
		repeat i
			if ( dblist(1, cnt) > p(1) ) {
				p = dblist(0, cnt), dblist(1, cnt)
			}
		loop
		if ( skillname(p) != "" ) {
			nc_intb_001 = p
			txt -1, lang("対象にする仲間は？", "Who is target?")
			allyctrl = 4
			gosub *label_2611
			if ( stat != (-1) ) {
				tc = stat
			}
			else {
				txt -1, lang("何もおきない… ", "Nothing happens...")
				goto *com_wish_end
			}
			txtef COLOR_YELLOW
			if ( sorg(nc_intb_001, tc) == 0 ) {
				txt -1, lang(name(tc) + "は" + skillname(nc_intb_001) + "の技術を会得した！", name(tc) + " learn " + skillname(nc_intb_001) + "!")
				skillgain tc, nc_intb_001, 1
				snd SOUNDLIST_DING3
			}
			else {
				txt -1, lang(name(tc) + "は" + skillname(nc_intb_001) + "が上昇した！", name(tc) + " " + skillname(nc_intb_001) + " skill improves!")
				skillmod nc_intb_001, tc, 1000
				modgrowth2 tc, nc_intb_001, 25
				snd SOUNDLIST_DING3
			}
		}
		else {
			txt -1, lang("何もおきない… ", "Nothing happens...")
		}
		goto *com_wish_end
	}
	txt -1, lang("何もおきない… ", "Nothing happens...")
	goto *com_wish_end

*label_2787
	gosub *wish_monster
	flt
	characreate MAX_CHARA_NC, dbid, -3, 0
	flt
	itemcreate -1, ITEM_ID_CARD, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	iSubName(ci) = cId(MAX_CHARA_NC)
	iCol(ci) = getcharapic(56)
	if ( iSubName(ci) == 343 ) {
		iCNpcId(ci) = cUNID(MAX_CHARA_NC)
		ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(MAX_CHARA_NC)))
	}
	chara_vanquish MAX_CHARA_NC
	cell_refresh cX(CHARA_PLAYER), cY(CHARA_PLAYER)
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + " from nowhere.")
	goto *com_wish_end

*label_2788
	gosub *wish_monster
	flt
	characreate MAX_CHARA_NC, dbid, -3, 0
	flt
	itemcreate -1, ITEM_ID_FIGURINE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	collection_make ci, 56
	chara_vanquish MAX_CHARA_NC
	cell_refresh cX(CHARA_PLAYER), cY(CHARA_PLAYER)
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + " from nowhere.")
	goto *com_wish_end

*label_2789
	gosub *wish_monster
	if ( dbid == 319 ) {
		dbid = 176
	}
	locvar_key_direction_meatid = dbid
	flt
	itemcreate -1, ITEM_ID_CORPSE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	iSubName(ci) = locvar_key_direction_meatid
	if ( locvar_key_direction_meatid == 343 ) {
		iCNpcId(ci) = initunid - 1
		ICNpcSerialNo(ci) = createserialno(userdatan(0, iCNpcId(ci)))
	}
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + " from nowhere.")
	goto *com_wish_end

*label_2790
	weaponid = 1, 2, 3, 4, 58, 60, 210, 211, 212, 213, 224, 225, 226, 227, 228, 229, 230, 231, 232, 234, 235, 266, 482, 496, 512, 633, 713, 714, 735, 759, 781, 788
	return

*label_2791
	flt
	weaponjasei = 1
	weaponjus = 1
	fixlv = FIX_QUALITY_GODLY
	cnv_str inputlog, lang("聖なる武器", "justice weapon"), ""
	if ( rnd(2) ) {
		flttypemajor = FILTER_WEAPON
		dbid = 0
	}
	else {
		flttypemajor = FILTER_RANGE
		dbid = 0
	}
	repeat length(weaponid)
		if ( instr(inputlog, 0, ioriginalnameref(weaponid(cnt))) != (-1) ) {
			dbid = weaponid(cnt)
		}
	loop
	nostack = 1
	nooracle = 1
	itemcreate -1, dbid, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	item_identify ci, ITEM_KNOWN_FULL
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + " from nowhere.")
	goto *com_wish_end

*label_2793
	flt
	weaponjasei = 1
	weaponjus = -1
	fixlv = FIX_QUALITY_GODLY
	cnv_str inputlog, lang("邪悪な武器", "evil weapon"), ""
	if ( rnd(2) ) {
		flttypemajor = FILTER_WEAPON
		dbid = 0
	}
	else {
		flttypemajor = FILTER_RANGE
		dbid = 0
	}
	repeat length(weaponid)
		if ( instr(inputlog, 0, ioriginalnameref(weaponid(cnt))) != (-1) ) {
			dbid = weaponid(cnt)
		}
	loop
	nostack = 1
	nooracle = 1
	itemcreate -1, dbid, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	item_identify ci, ITEM_KNOWN_FULL
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + " from nowhere.")
	goto *com_wish_end

*label_2795
	flt
	weaponalive = 1
	fixlv = FIX_QUALITY_MIRACLE
	cnv_str inputlog, lang("生きている武器", "living weapon"), ""
	if ( rnd(2) ) {
		flttypemajor = FILTER_WEAPON
		dbid = 0
	}
	else {
		flttypemajor = FILTER_RANGE
		dbid = 0
	}
	repeat length(weaponid)
		if ( instr(inputlog, 0, ioriginalnameref(weaponid(cnt))) != (-1) ) {
			dbid = weaponid(cnt)
		}
	loop
	nostack = 1
	nooracle = 1
	itemcreate -1, dbid, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	item_identify ci, ITEM_KNOWN_FULL
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + " from nowhere.")
	goto *com_wish_end

*wish_monster
	i = 0
	s2 = inputlog
	fix_wish s2
	repeat 800
		p = 0
		s = refchara(cnt, DBSPEC_CHARA_NAME_ORG, 1)
		if ( en ) {
			s = getpath(s, 16)
		}
		if ( instr(s, 0, s2) != (-1) ) {
			p = 1000 - (strlen(s) - strlen(s2)) * 10
		}
		if ( p != 0 ) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	repeat usernpcmax
		p = 0
		s = userdatan(1, cnt)
		if ( en ) {
			s = getpath(s, 16)
		}
		if ( instr(s, 0, s2) != (-1) ) {
			p = 1000 - (strlen(s) - strlen(s2)) * 10
		}
		if ( p != 0 ) {
			unlist(i) = cnt
			dblist(0, i) = 343, p
			i++
		}
	loop
	p = 0, 0
	repeat i
		if ( dblist(1, cnt) > p(1) ) {
			p = dblist(0, cnt), dblist(1, cnt)
			if ( p == 343 ) {
				initunid = unlist(cnt) + 1
			}
		}
	loop
	dbid = p
	if ( dbid == 0 ) {
		dbid = 37
	}
	return

*com_shortcut
	menucycle = 0
	if ( ogdata(36 + sc) == 0 ) {
		msgdup++
		txt -1, lang("そのキーにはショートカットが割り当てられていない。", "The key is unassigned.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( ogdata(36 + sc) >= 10000 ) {
		invsc = ogdata(36 + sc) \ 1000000 \ 10000, ogdata(36 + sc) / 1000000
		invctrl = ogdata(36 + sc) \ 1000000 / 10000, 0
		invcurse = stgdata(36 + sc)
		goto *label_2974
	}
	efid = ogdata(36 + sc)
	if ( efid >= SKILL_ACTIVE_PICKPOCKET & efid < SKILL_SPELL_HEAL_LIGHT ) {
		goto *com_skill
	}
	if ( efid >= (600 /*!!!@[MAX_SKILL_RANGE @@@ STARTING_SKILL_SPACT]@!!! */) ) {
		if ( mType == MAP_TYPE_WORLD ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		if ( efid < tailspact ) {
			p = -1
			if ( efid < MAX_SKILL ) {
				if ( spact(efid - STARTING_SKILL_SPACT) != 0 ) {
					p = 1
				}
			}
			else {
				if ( ospact(efid - 661) != 0 ) {
					p = 1
				}
			}
			repeat length(racenamecsv)
				if ( cnRace(CHARA_PLAYER) == racenamecsv(cnt, 1) ) {
					cnt2 = cnt
					if ( racespact(cnt2, 1) ) {
						repeat racespact(cnt2, 1) + 2
							if ( cnt == 0 | cnt == 1 ) {
								continue
							}
							if ( racespact(cnt2, cnt) == efid ) {
								p = 1
								break
							}
						loop
					}
					break
				}
			loop
			repeat length(classnamecsv)
				if ( cnClass(CHARA_PLAYER) == classnamecsv(cnt, 1) ) {
					cnt2 = cnt
					if ( classspact(cnt2, 1) ) {
						repeat classspact(cnt2, 1) + 2
							if ( cnt == 0 | cnt == 1 ) {
								continue
							}
							if ( classspact(cnt2, cnt) == efid ) {
								p = 1
								break
							}
						loop
					}
					break
				}
			loop
			if ( p == (-1) ) {
				txt -1, lang("もうその行動はできない。", "You can't use this shortcut any more.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		if ( efid == 781 ) {
			gosub *label_4676
		}
		goto *com_skill
	}
	if ( efid >= SKILL_SPELL_HEAL_LIGHT ) {
		if ( mType == MAP_TYPE_WORLD ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		if ( efid < 550 ) {
			if ( spell(efid - 400) <= 0 ) {
				msgdup++
				txt -1, lang("その魔法はもう使えない。", "You can't use that spell anymore.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		else {
			if ( userspelldata(11, efid - 550) <= 0 | userspelldata(0, efid - 550) <= 0 ) {
				msgdup++
				txt -1, lang("その魔法はもう使えない。", "You can't use that spell anymore.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		goto *com_spellcast
	}
	goto *pc_turn

*com_dig
	txt -1, lang("どの方向を掘る？ ", "Which direction do you want to dig? ")
	val = 0
	gosub *prompt_direction
	if ( stat == 0 ) {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		goto *pc_turn
	}
	refx = x
	refy = y
	tlocx = x
	tlocy = y
	goto *label_2808

*label_2807
	x = cXnew(CHARA_PLAYER)
	y = cYnew(CHARA_PLAYER)
	refx = cXnew(CHARA_PLAYER)
	refy = cYnew(CHARA_PLAYER)
	tlocx = cXnew(CHARA_PLAYER)
	tlocy = cYnew(CHARA_PLAYER)
	if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
		msgdup++
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		goto *pc_turn
	}
	goto *label_2808

*label_2808
	if ( tlocx == cX(CHARA_PLAYER) ) {
		if ( tlocy == cY(CHARA_PLAYER) ) {
			rowactre = 0
			gosub *search
			goto *label_4158
		}
	}
	if ( (chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS) == 0 | chipm(CHIPM_ROLE, mapId(x, y)) == MAP_CHIP_ROLE_WATER | mType == MAP_TYPE_WORLD ) {
		msgdup++
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		goto *pc_turn
	}
	screenupdate = -1
	gosub *screen_draw
	goto *act_dig

*com_bash
	txt -1, lang("どの方向に体当たりする？ ", "Which direction do you want to bash? ")
	val = 0
	gosub *prompt_direction
	if ( stat == 0 ) {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		goto *pc_turn
	}
	goto *act_bash

*com_skill
	if ( cc == CHARA_PLAYER ) {
		if ( gettrait(0, 173) != 0 ) {
			if ( rnd(20) == 0 ) {
				txt -1, lang(name(cnt) + "は行動を躊躇った。", name(cnt) + " hasitate" + _s(cnt) + " " + his(cnt) + " action.")
				goto *label_4158
			}
		}
	}
	gosub *label_4578
	if ( stat == 1 ) {
		ctalk cc, 427, cc, tc
	}
	gosub *action
	if ( stat == 0 ) {
		gosub *screen_draw
		goto *pc_turn
	}
	gosub *label_4578
	if ( stat == 1 ) {
		ctalk cc, 428, cc, tc
	}
	goto *label_4158

*label_2811
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	cs = commark(0) \ 1000
	page = commark(0) / 1000
	curmenu = 1
	gosub *label_4676
	repeat 400 - 300, 300
		if ( sdata(cnt, cc) > 0 ) {
			list(0, listmax) = cnt, skillUse(cnt) * 1000 + cnt
			listmax++
		}
	loop
	repeat tailspact - 600
		if ( spact(cnt) != 0 ) {
			list(0, listmax) = cnt + 600, skillUse(cnt + 600) * 1000 + cnt
			listmax++
		}
	loop
	repeat tailspact - 661
		if ( ospact(cnt) != 0 ) {
			list(0, listmax) = cnt + 661, skillUse(cnt + 661) * 1000 + cnt
			listmax++
		}
	loop
	repeat length(racenamecsv)
		if ( cnRace(cc) == racenamecsv(cnt, 1) ) {
			cnt2 = cnt
			if ( racespact(cnt2, 1) ) {
				repeat racespact(cnt2, 1) + 2
					p = 0
					cnt3 = cnt
					if ( cnt3 == 0 | cnt3 == 1 ) {
						continue
					}
					if ( racespact(cnt2, cnt3) <= 600 ) {
						continue
					}
					if ( racespact(cnt2, cnt3) == 668 ) {
						continue
					}
					repeat listmax
						if ( racespact(cnt2, cnt3) == list(0, cnt) ) {
							p = -1
							break
						}
					loop
					if ( p == 0 ) {
						list(0, listmax) = racespact(cnt2, cnt3), skillUse(racespact(cnt2, cnt3)) * 1000 + racespact(cnt2, cnt3) - 600
						listmax++
					}
				loop
			}
			break
		}
	loop
	repeat length(classnamecsv)
		if ( cnClass(cc) == classnamecsv(cnt, 1) ) {
			cnt2 = cnt
			if ( classspact(cnt2, 1) ) {
				repeat classspact(cnt2, 1) + 2
					p = 0
					cnt3 = cnt
					if ( cnt3 == 0 | cnt3 == 1 ) {
						continue
					}
					if ( classspact(cnt2, cnt3) <= 600 ) {
						continue
					}
					if ( classspact(cnt2, cnt3) == 668 ) {
						continue
					}
					repeat listmax
						if ( classspact(cnt2, cnt3) == list(0, cnt) ) {
							p = -1
							break
						}
					loop
					if ( p == 0 ) {
						list(0, listmax) = classspact(cnt2, cnt3), skillUse(classspact(cnt2, cnt3)) * 1000 + classspact(cnt2, cnt3) - 600
						listmax++
					}
				loop
			}
			break
		}
	loop
	gosub *sort_list
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_skill.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1

*label_2821
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	drawmenu 1

*label_2822
	redraw 0
	s = lang("能力の発動", "Skill"), strhint2 + strhint3 + strhint7
	display_window (windoww - 600) / 2 + inf_screenx, winposy(438), 600, 438, 0, 60
	display_topic lang("能力の名称", "Name"), wx + 28, wy + 36
	display_topic lang("コスト", "Cost"), wx + 220, wy + 36
	display_topic lang("能力の効果", "Detail"), wx + 320, wy + 36
	pos wx + 46, wy - 16
	gcopy BUFFER_INF, 288 + 14 * 48, 48, 48, 48
	pos wx + ww - 78, wy + wh - 165
	gcopy BUFFER_INF, 960, 96, 72, 144
	pos wx + ww - 168, wy
	gcopy BUFFER_INF, 1032, 96, 102, 48
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 490, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		pos wx + 40, wy + 74 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate BUFFER_ITEM, (skillUse(list(0, p)) - 10) * inf_tiles, 672, 0, inf_tiles, inf_tiles
		s = ""
		repeat 20
			if ( ogdata(36 + cnt) == list(0, p) ) {
				s = "{" + cnt + "}"
			}
		loop
		cs_list skillname(list(0, p)) + s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		s = "" + skillCost(list(0, p)) + " Sp"
		pos wx + 288 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
		mes s
		gosub *skill_desc
		pos wx + 325, wy + 66 + cnt * 19 + 2
		mes strmid(s, 0, 34)
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	commark(0) = page * 1000 + cs
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		menucycle = 0
		screenupdate = -1
		efid = p
		gosub *screen_draw
		goto *com_skill
	}
	if ( key == "sc" ) {
		snd SOUNDLIST_OK1
		p = list(0, pagesize * page + cs)
		if ( ogdata(36 + sc) == p ) {
			ogdata(36 + sc) = 0
			stgdata(36 + sc) = 0
			stgdata(56 + sc) = 0
			ncgsdata(sc) = ""
			goto *label_2821
		}
		repeat 20
			if ( ogdata(36 + cnt) == p ) {
				ogdata(36 + cnt) = 0
				stgdata(36 + cnt) = 0
				stgdata(56 + cnt) = 0
				ncgsdata(cnt) = ""
			}
		loop
		ogdata(36 + sc) = p
		txt -1, lang("{" + sc + "}キーにショートカットを割り当てた。", "You have assigned the shortcut to {" + sc + "} key.")
		display_msg inf_screeny + inf_tiles
		goto *label_2821
	}
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 2 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 2
				}
			}
			if ( p != curmenu ) {
				cw = 0
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					snd SOUNDLIST_SPELL
					goto *com_spell
				}
				if ( curmenu == 1 ) {
					snd SOUNDLIST_SKILL
					goto *label_2811
				}
				if ( curmenu == 2 ) {
					snd SOUNDLIST_SPELL
					goto *com_spell
				}
			}
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_2821
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_2821
		}
	}
	if ( key == key_cancel ) {
		cw = 0
		gosub *screen_draw
		goto *pc_turn
	}
	goto *label_2822

*com_give
	txt -1, lang("どの方向に？ ", "Which direction? ")
	gosub *screen_draw
	val = 0
	gosub *prompt_direction
	if ( stat == 0 ) {
		txt -1, strinteractfail
		gosub *screen_draw
		goto *pc_turn
	}
	tc = mapChara(x, y)
	if ( tc == CHARA_PLAYER ) {
		txt -1, strinteractfail
		gosub *screen_draw
		goto *pc_turn
	}
	tc -= 1
	if ( tc == CHARA_PLAYER ) {
		if ( gRider != 0 ) {
			tc = gRider
		}
	}
	if ( tc != CHARA_PLAYER ) {
		if ( petcheck(tc) | gWizard ) {
			if ( cbit(CHARA_BIT_BODYGUARD, tc) == FALSE & cbit(CHARA_BIT_GUARD_TEMP, tc) == FALSE & cRole(tc) != 20001 ) {
				goto *com_allyInventory
			}
		}
		gosub *screen_draw
		invctrl = INVCTRL_GIVE
		snd SOUNDLIST_INV
		goto *label_2974
	}
	txt -1, strinteractfail
	gosub *screen_draw
	goto *pc_turn

*com_interact
	txt -1, lang("操作する対象の方向は？", "Choose the direction of the target.")
	val = 0
	gosub *prompt_direction
	if ( stat == 0 ) {
		txt -1, strinteractfail
		gosub *screen_draw
		goto *pc_turn
	}
	tc = mapChara(x, y)
	if ( tc == CHARA_PLAYER ) {
		txt -1, strinteractfail
		gosub *screen_draw
		goto *pc_turn
	}
	tc -= 1
	locvar_addnews_f = 0
	if ( cfg_interactex == 1 ) {
		if ( tc == CHARA_PLAYER ) {
			if ( gRider != 0 ) {
				promptl(0, promptmax) = name(tc), "null", "" + 0
				promptmax++
				promptl(0, promptmax) = name(gRider), "null", "" + gRider
				promptmax++
				val = promptx, prompty, 200, 1
				gosub *prompt_key
				if ( stat == 0 ) {
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					if ( gRider == rtval ) {
						locvar_addnews_f = 1
					}
					tc = rtval
				}
			}
		}
		else {
			if ( ocPetRidingIdx(tc) != 0 ) {
				promptl(0, promptmax) = name(tc), "null", "" + tc
				promptmax++
				promptl(0, promptmax) = name(ocPetRidingIdx(tc)), "null", "" + ocPetRidingIdx(tc)
				promptmax++
				val = promptx, prompty, 200, 1
				gosub *prompt_key
				if ( stat == 0 ) {
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					if ( ocPetRidingIdx(tc) == rtval ) {
						locvar_addnews_f = 1
					}
					tc = rtval
				}
			}
		}
		gosub *screen_draw
	}
	txt -1, lang(name(tc) + "に何をする？ ", "What action do you want to perform to " + him(tc) + "? ")
	p = 0
	if ( tc != CHARA_PLAYER ) {
		if ( cConfuse(CHARA_PLAYER) == 0 & locvar_addnews_f == 0 ) {
			promptl(0, promptmax) = lang("話しかける", "Talk"), "null", "" + 0
			promptmax++
			promptl(0, promptmax) = lang("攻撃する", "Attack"), "null", "" + 1
			promptmax++
		}
		if ( cbit(CHARA_BIT_BODYGUARD, tc) == FALSE ) {
			if ( cbit(CHARA_BIT_GUARD_TEMP, tc) == FALSE & cRole(tc) != 20001 ) {
				if ( petcheck(tc) | gWizard ) {
					promptl(0, promptmax) = lang("所持品", "Inventory"), "null", "" + 4
					promptmax++
					promptl(0, promptmax) = lang("装備品", "Wear"), "null", "" + 14
					promptmax++
				}
				else {
					promptl(0, promptmax) = lang("何かを渡す", "Give"), "null", "" + 2
					promptmax++
				}
				if ( cbit(CHARA_BIT_LIVESTOCK, tc) == TRUE ) {
					promptl(0, promptmax) = lang("連れ出す", "Bring Out"), "null", "" + 5
					promptmax++
				}
				if ( tc < MAX_CHARA_FOLLOWER ) {
					promptl(0, promptmax) = lang("着替えさせる", "Appearance"), "null", "" + 8
					promptmax++
					promptl(0, promptmax) = lang("作戦を決める", "Decide Strategy"), "null", "" + 11
					promptmax++
					found = 0
					repeat length2(csetwork)
						if ( areaId(gArea ) == csetwork(0, cnt) ) {
							found = 1
							break
						}
					loop
					if ( found & locvar_addnews_f == 0 ) {
						promptl(0, promptmax) = lang("仕事を任せる", "Assign Work"), "null", "" + 12
						promptmax++
					}
					promptl(0, promptmax) = lang("性格を変える", "Alter Personality"), "null", "" + 13
					promptmax++
					if ( sRiding(tc) != 0 & locvar_addnews_f == 0 ) {
						if ( ocPetRidingIdx(tc) == 0 ) {
							promptl(0, promptmax) = lang("騎乗させる", "Allow Riding"), "null", "" + 16
						}
						else {
							promptl(0, promptmax) = lang("騎乗を止めさせる", "Stop Riding"), "null", "" + 16
						}
						promptmax++
					}
					promptl(0, promptmax) = lang("行動の設定", "Actions Setting"), "null", "" + 19
					promptmax++
					if ( int(cActIndex(tc) / 10) > 0 ) {
						promptl(0, promptmax) = lang("特殊行動の確認", "Confirm actions"), "null", "" + 20
						promptmax++
					}
				}
				if ( cRole(tc) == ROLE_ADVENTURER ) {
					if ( cbit(CHARA_BIT_HIRED, tc) == FALSE ) {
						if ( ocFormerPet(tc) == 20000 ) {
							promptl(0, promptmax) = lang("着替えさせる", "Appearance"), "null", "" + 15
							promptmax++
						}
					}
				}
				if ( tc > 15 ) {
					if ( cRole(tc) == ROLE_MAID | (cRole(tc) == ROLE_CITIZEN & cId(tc) == CREATURE_ID_MAID) ) {
						promptl(0, promptmax) = lang("着替えさせる", "Appearance"), "null", "" + 15
						promptmax++
					}
				}
			}
		}
		promptl(0, promptmax) = lang("言葉を教える", "Teach Words"), "null", "" + 7
		promptmax++
		promptl(0, promptmax) = lang("口調を変える", "Change Tone"), "null", "" + 10
		promptmax++
		if ( gArea  != AREA_SHOW_HOUSE ) {
			if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
				promptl(0, promptmax) = lang("縄を解く", "Release"), "null", "" + 9
				promptmax++
			}
		}
	}
	promptl(0, promptmax) = lang("名前をつける", "Name"), "null", "" + 3
	promptmax++
	if ( tc == CHARA_PLAYER ) {
		promptl(0, promptmax) = lang("全員に命令する", "Command All"), "null", "" + 11
		promptmax++
		promptl(0, promptmax) = lang("口調を変える", "Change Tone"), "null", "" + 10
		promptmax++
		if ( gdatac(10) == 0 ) {
			promptl(0, promptmax) = lang("全員黙らせる", "Shut up."), "null", "" + 17
			promptmax++
		}
		else {
			promptl(0, promptmax) = lang("全員喋らせる", "You can speak now."), "null", "" + 17
			promptmax++
		}
		promptl(0, promptmax) = lang("ペットの順番", "Order of pets"), "null", "" + 18
		promptmax++
	}
	if ( 0 | gWizard | godcheck(0) == "mayumaka" ) {
		promptl(0, promptmax) = lang("情報", "Info"), "null", "" + 6
		promptmax++
	}
	val = promptx, prompty, 200, 1
	gosub *prompt_key
	if ( stat == 0 ) {
		gosub *screen_draw
		goto *pc_turn
	}
	p = rtval
	screenupdate = -1
	if ( p == 0 ) {
		gosub *screen_draw
		gosub *chat
		if ( chatteleport == 1 ) {
			chatteleport = 0
			goto *map_exit
		}
		else {
			goto *label_4158
		}
	}
	if ( p == 1 ) {
		gosub *screen_draw
		gosub *label_3640
		gosub *label_4714
		goto *label_4158
	}
	if ( p == 2 ) {
		gosub *screen_draw
		invctrl = INVCTRL_GIVE
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( p == 3 ) {
		gosub *screen_draw
		goto *label_2837
	}
	if ( p == 4 ) {
		goto *com_allyInventory
	}
	if ( p == 5 ) {
		rc = tc
		gosub *cm_race_loop_WHILE1
		gosub *screen_draw
		goto *label_4158
	}
	if ( p == 6 ) {
		csctrl = 4
		snd SOUNDLIST_POP2
		cc = tc
		gosub *label_2879
		cc = CHARA_PLAYER
		goto *pc_turn
	}
	if ( p == 7 ) {
		txt -1, lang("どんな言葉を教えようか。", "What sentence should " + name(tc) + " learn? ")
		val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
		inputlog = ""
		gosub *prompt_word
		cbitmod CHARA_BIT_MSG_FILE, tc, FALSE
		if ( inputlog == "" ) {
			cnMsg(tc) = ""
		}
		else {
			cnMsg(tc) = inputlog
			txtef COLOR_SKY_BLUE
			txt -1, "" + cnMsg(tc)
		}
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 8 ) {
		gsel BUFFER_BUF
		pos 0, 0
		exist exedir + "user\\graphic\\user_face1.bmp"
		if ( strsize != (-1) & cfg_userface1 ) {
			picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
			ex_userface = 1
		}
		else {
			picload_ exedir + "graphic\\face1.bmp", 1
			ex_userface = 0
		}
		gsel BUFFER_SCREEN
		ccbk = cc
		cc = tc
		gosub *label_2916
		cc = ccbk
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 9 ) {
		snd SOUNDLIST_BUILD1
		cbitmod CHARA_BIT_SANDBAG, tc, FALSE
		txt -1, lang(name(tc) + "の縄を解いた。", "You release " + name(tc) + ".")
		ctalk tc, 401, 0, tc
		flt
		itemcreate -1, ITEM_ID_SAND_BAG, cX(tc), cY(tc), 0
	}
	if ( p == 10 ) {
		gosub *com_tone
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 11 ) {
		ccbk = cc
		cc = tc
		gosub *pet_openStrategyMenu
		cc = ccbk
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 12 ) {
		f = 0
		repeat length2(csetwork)
			if ( areaId(gArea ) != csetwork(0, cnt) ) {
				continue
			}
			if ( sdata(csetwork(1, cnt), tc) == 0 ) {
				continue
			}
			f = 1
			break
		loop
		if ( f ) {
			ccbk = cc
			cc = tc
			gosub *label_4431
			cc = ccbk
			gosub *screen_draw
			goto *pc_turn
		}
		else {
			txt -1, lang(name(tc) + "に任せられる仕事はない。", "There is no work available that can be assigned to " + name(tc) + ".")
		}
	}
	if ( p == 13 ) {
		gosub *label_4459
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 14 ) {
		cc = tc
		gosub *com_wear
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 15 ) {
		gsel BUFFER_BUF
		pos 0, 0
		exist exedir + "user\\graphic\\user_face1.bmp"
		if ( strsize != (-1) & cfg_userface1 ) {
			picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
			ex_userface = 1
		}
		else {
			picload_ exedir + "graphic\\face1.bmp", 1
			ex_userface = 0
		}
		gsel BUFFER_SCREEN
		ccbk = cc
		cc = tc
		gosub *label_4658
		cc = ccbk
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 16 ) {
		if ( ocPetRidingIdx(tc) != 0 ) {
			cell_findspace cX(tc), cY(tc), 1
			if ( stat == 0 ) {
				txt -1, lang("降りるスペースがない。", "There's no place to get off.")
				gosub *screen_draw
				goto *pc_turn
			}
			cell_setchara ocPetRidingIdx(tc), rtval, rtval(1)
			txt -1, lang(name(tc) + "は" + name(ocPetRidingIdx(tc)) + "から降りた。", name(tc) + " dismount" + _s(tc) + " from " + name(ocPetRidingIdx(tc)) + ".")
			ride_end tc
			gosub *screen_draw
			goto *pc_turn
		}
		allyctrl = 8
		gosub *label_2611
		if ( stat != (-1) ) {
			ccbk = cc
			cc = tc
			tc = stat
			gosub *label_4723
			cc = ccbk
		}
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 17 ) {
		if ( gdatac(10) == 0 ) {
			repeat 15, 1
				if ( cExist(cnt) == CHAR_STATE_DEAD ) {
					continue
				}
				if ( cTxt(cnt) != 0 ) {
					if ( cbit(CHARA_BIT_SHUT_UP, cnt) == FALSE ) {
						cbitmod CHARA_BIT_SHUT_UP, cnt, TRUE
					}
				}
			loop
			gdatac(10) = 1
		}
		else {
			repeat 15, 1
				if ( cExist(cnt) == CHAR_STATE_DEAD ) {
					continue
				}
				if ( cTxt(cnt) != 0 ) {
					if ( cbit(CHARA_BIT_SHUT_UP, cnt) == TRUE ) {
						cbitmod CHARA_BIT_SHUT_UP, cnt, FALSE
					}
				}
			loop
			gdatac(10) = 0
		}
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 18 ) {
		ccbk = cc
		cc = tc
		gosub *com_name
		cc = ccbk
		gosub *screen_draw
		goto *pc_turn
	}
	if ( p == 19 ) {
		if ( cActIndex(tc) / 10 < 5 & cActHeal(tc) != 0 ) {
			repeat cActIndex(tc) / 10
				if ( cActHeal(tc) == cdata(STARTING_CDATA_ACT_SUB + cnt, tc) ) {
					break
				}
				if ( cnt == cActIndex(tc) / 10 ) {
					cdata(STARTING_CDATA_ACT_SUB + cActIndex(tc) / 10, tc) = cActHeal(tc)
					cActIndex(tc) += 10
					txt -1, lang("" + skillname(cActHeal(tc)) + "を特殊行動に移植した。", "" + skillname(cActHeal(tc)) + " ported to special action.")
				}
			loop
		}
		goto *nc_com_ai
	}
	if ( p == 20 ) {
		goto *nc_ai_changeskill
	}
	gosub *screen_draw
	goto *pc_turn

*com_name
	allyctrl = 100
	locvar_key_direction_swap = -1, -1
	gosub *label_2611
	if ( stat != (-1) ) {
		locvar_key_direction_swap(0) = stat
		gosub *label_2611
		if ( stat != (-1) ) {
			locvar_key_direction_swap(1) = stat
			cXorg(locvar_key_direction_swap(0)) = cX(locvar_key_direction_swap(1))
			cYorg(locvar_key_direction_swap(0)) = cY(locvar_key_direction_swap(1))
			cXorg(locvar_key_direction_swap(1)) = cX(locvar_key_direction_swap(0))
			cYorg(locvar_key_direction_swap(1)) = cY(locvar_key_direction_swap(0))
			hpbk = cHP(locvar_key_direction_swap(0)), cHP(locvar_key_direction_swap(1))
			txt -1, lang("" + cnName(locvar_key_direction_swap(0)) + "と" + cnName(locvar_key_direction_swap(1)) + "を入れ替えた。", "Swapped positions between " + cnName(locvar_key_direction_swap(0)) + " and " + cnName(locvar_key_direction_swap(1)) + ".")
			relocate_chara locvar_key_direction_swap(0), 56, 1
			relocate_chara locvar_key_direction_swap(1), locvar_key_direction_swap(0), 1
			relocate_chara 56, locvar_key_direction_swap(1), 1
			chara_vanquish MAX_CHARA_NC
			repeat 2
				cExist(locvar_key_direction_swap(cnt)) = CHAR_STATE_ALIVE
				cX(locvar_key_direction_swap(cnt)) = cXorg(locvar_key_direction_swap(cnt))
				cY(locvar_key_direction_swap(cnt)) = cYorg(locvar_key_direction_swap(cnt))
				cRelation(locvar_key_direction_swap(cnt)) = RELATION_ALLY
				cHP(locvar_key_direction_swap(cnt)) = hpbk(cnt)
			loop
		}
	}
	return

*label_2837
	txt -1, lang(name(tc) + "を何と呼ぶ？ ", "What do you want to call " + him(tc) + "? ")
	val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
	inputlog = ""
	input_mode = 1
	gosub *prompt_word
	if ( inputlog == "" ) {
		txt -1, lang("名前をつけるのはやめた。", "You changed your mind.")
	}
	else {
		if ( instr(inputlog, 0, "%rndName") != (-1) ) {
			strrep inputlog, "%rndName", randomname()
		}
		cnName(tc) = "" + inputlog
		cbitmod CHARA_BIT_HAS_NAME, tc, TRUE
		txt -1, lang("" + cnName(tc) + "という名前で呼ぶことにした。", "You named " + him(tc) + " " + cnName(tc) + ".")
	}
	gosub *screen_refresh
	goto *pc_turn

*com_tone
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	folder = exedir + "user\\talk\\"
	dirlist buff, folder + "*.txt"
	notesel buff
	list(0, 0) = -999
	listn(0, 0) = lang("デフォルトの口調", "Default Tone")
	listmax++
	list(0, 1) = -998
	listn(0, 1) = lang("トーク設定", "Default Tone")
	listmax++
	repeat noteinfo(0)
		noteget s, cnt
		list(0, listmax) = listmax
		listn(0, listmax) = s
		listmax++
	loop
	windowshadow = 1

*com_tone_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_tone_loop
	redraw 0
	s = lang("口調一覧", "Tone of Voice"), lang("決定 [口調の変更]  ", "Enter [Change Tone] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 432
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("題名", "Title") + "  「" + cnMsg(tc) + "」", wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 138, wy + 66 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if ( p != (-1) ) {
		snd SOUNDLIST_OK1
		if ( p == (-998) ) {
			gosub *label_5005
			return 1
		}
		txt -1, lang(name(tc) + "の口調が変わった気がする。", name(tc) + " is somewhat different.")
		if ( p == (-999) ) {
			cbitmod CHARA_BIT_MSG_FILE, tc, FALSE
			cnMsg(tc) = ""
			return 1
		}
		cbitmod CHARA_BIT_MSG_FILE, tc, TRUE
		cnMsg(tc) = listn(0, p)
		return 1
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_tone_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_tone_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		return -1
	}
	goto *com_tone_loop

*com_userNpc
	snd SOUNDLIST_CHARA
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	if ( allyctrl == 0 ) {
		repeat usernpcmax
			if ( instr(userdatan(6, cnt), 0, "_tmp_") == (-1) ) {
				continue
			}
			if ( instr(userdatan(4, cnt), 0, "/nodownload/") != (-1) ) {
				continue
			}
			list(0, listmax) = listmax
			listn(0, listmax) = lang(userdatan(1, cnt) + "(" + userdatan(0, cnt) + ")", userdatan(0, cnt)), userdatan(6, cnt)
			list(1, listmax) = userdata(2, cnt)
			listmax++
		loop
	}
	txt -1, lang("どの者を召喚したいと願うか？", "Which one do you wish to summon?")
	windowshadow = 1

*com_userNpc_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_userNpc_loop
	redraw 0
	s = lang("カスタムNPC一覧", "Custom NPC"), lang("決定 [召喚]  ", "Enter [Summon] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("名前", "Name"), wx + 28, wy + 36
	display_topic lang("Level", "Level"), wx + 348, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		pos wx + 380, wy + 66 + cnt * 19
		mes "" + list(1, p)
		cs_list s, wx + 85, wy + 66 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if ( p != (-1) ) {
		listmax = p
		snd SOUNDLIST_PRAY1
		txt -1, listn(0, listmax) + lang("は、あなたの世界に召喚された！", " has been summoned to your world!")
		file = "" + userfile
		gosub *unzip
		bcopy exedir + "user\\" + listn(1, listmax), exedir + "user\\" + listn(0, listmax) + ".npc"
		gosub *label_3093
		repeat 5480
			if ( ICNpcSerialNo(cnt) ) {
				getunid4item cnt
			}
		loop
		repeat gClient
			if ( qClient(cnt) == 0 ) {
				continue
			}
			if ( qExist(cnt) == QUEST_TYPE_CONQUER | qExist(cnt) == QUEST_TYPE_HUNTEX & qParam1(cnt) == 343 ) {
				getunid4job cnt
			}
		loop
		gosub *del_userTemp
		gosub *del_userNpc
		gosub *label_4271
		return 1
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_userNpc_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_userNpc_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		return -1
	}
	goto *com_userNpc_loop

*com_book
	snd SOUNDLIST_BOOK1
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "graphic\\book.bmp", 1
	gsel BUFFER_SCREEN
	notesel buff
	noteload exedir + "data\\book.txt"
	p = instr(buff, 0, "" + iParam1(ci) + "," + lang("JP", "EN"))
	if ( p == (-1) ) {
		return
	}
	buff = strmid(buff, p, instr(buff, p, "%END"))
	notedel 0
	listmax = 0
	page = 0
	pagesize = 40
	cs = 0
	cc = CHARA_PLAYER
	listmax = noteinfo(0)
	keyrange = 0
	key_list(0) = key_enter
	color 0, 0, 0

*com_book_loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	wx = (windoww - 720) / 2 + inf_screenx
	wy = winposy(468)
	pos wx, wy
	gcopy BUFFER_BUF, 0, 0, 736, 448
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		x = wx + 80 + cnt / 20 * 306
		y = wy + 45 + cnt \ 20 * 16
		noteget s, p
		if ( p == 0 ) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
		}
		if ( p == 1 ) {
			font lang(cfg_font1, cfg_font2), 10 + sizefix - en * 2, 0
		}
		if ( p > 2 ) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		}
		pos x, y
		mes s
		if ( p \ 20 == 0 ) {
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			pos x + 90, y + 330
			mes "- " + (p / 20 + 1) + " -"
		}
	loop

*com_book_loop_pgchg
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_CARD1
			page++
			goto *com_book_loop
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_CARD1
			page--
			goto *com_book_loop
		}
	}
	if ( key == key_cancel | key == key_enter ) {
		gosub *screen_draw
		return
	}
	goto *com_book_loop_pgchg

*com_spellcast
	if ( cc == CHARA_PLAYER ) {
		if ( gettrait(0, 173) != 0 ) {
			if ( rnd(20) == 0 ) {
				txt -1, lang(name(cnt) + "は行動を躊躇った。", name(cnt) + " hesitate" + _s(cnt) + " " + his(cnt) + " action.")
				goto *label_4158
			}
		}
	}
	tc = cc
	gosub *cast
	if ( stat == 0 ) {
		goto *pc_turn
	}
	goto *label_4158

*com_spell
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	cs = commark(1) \ 1000
	page = commark(1) / 1000
	repeat 200
		p = cnt
		ishighspell = 0
		repeat length(isethighspell)
			if ( isethighspell(cnt) == p ) {
				ishighspell = 1
				break
			}
		loop
		if ( curmenu == 0 & (ishighspell | cnt >= 100) | (curmenu == 2 & ishighspell == 0) | (curmenu == 3 & (cnt < 100 | ishighspell)) ) {
			continue
		}
		if ( spell(cnt) > 0 ) {
			list(0, listmax) = cnt + 400, skillUse(400 + cnt)
			listmax++
		}
	loop
	if ( curmenu == 2 ) {
		repeat userspellmax
			if ( userspelldata(11, cnt) > 0 & userspelldata(0, cnt) > 0 ) {
				list(0, listmax) = cnt + 550, userspelldata(0, cnt)
				listmax++
			}
		loop
	}
	gosub *sort_list
	redraw 0
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_spell.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1

*com_spell_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	drawmenu 1

*com_spell_loop
	redraw 0
	s = lang("魔法の詠唱", "Spell"), strhint2 + strhint3 + strhint7
	display_window (windoww - 720) / 2 + inf_screenx, winposy(438), 720, 438
	display_topic lang("魔法の名称", "Name"), wx + 28, wy + 36
	display_topic lang("消費MP(ｽﾄｯｸ) LV/成功", "Cost(Stock) Lv/Chance"), wx + 220, wy + 36
	display_topic lang("効果", "Effect"), wx + 400, wy + 36
	pos wx + 46, wy - 16
	if ( curmenu == 3 ) {
		gcopy BUFFER_INF, 288 + 23 * 48, 48, 48, 48
	}
	else {
		if ( curmenu == 2 ) {
			gcopy BUFFER_INF, 288 + 22 * 48, 48, 48, 48
		}
		else {
			gcopy BUFFER_INF, 288 + 13 * 48, 48, 48, 48
		}
	}
	pos wx + ww - 78, wy
	gcopy BUFFER_INF, 960, 96, 72, 144
	pos wx + ww - 180, wy
	gcopy BUFFER_INF, 1032, 96, 72, 96
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 620, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		if ( i >= 550 ) {
			p(79) = userspelldata(11, i - 550)
			p(78) = userspelldata(12, i - 550) / 1000000
		}
		else {
			p(79) = spell(i - 400)
			p(78) = sdata(i, cc)
		}
		pos wx + 40, wy + 74 + cnt * 19
		gmode 2, inf_tiles, inf_tiles
		grotate BUFFER_ITEM, (skillUse(i) - 10) * inf_tiles, 672, 0, inf_tiles, inf_tiles
		s = ""
		repeat 20
			if ( ogdata(36 + cnt) == list(0, p) ) {
				s = "{" + cnt + "}"
			}
		loop
		if ( cfg_strackex != 0 ) {
			strack = ""
			repeat 20
				if ( gdatac(750 + cnt) == 0 * 10000 + i ) {
					strack = "*"
				}
			loop
		}
		s(1) = skillname(i)
		cutname s(1), 22
		if ( cfg_strackex != 0 ) {
			cs_list strack + s(1) + s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		}
		else {
			cs_list s(1) + s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		}
		s = "" + calcspellcostmp(i, cc) + " (" + p(79) + ")"
		pos wx + 328 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
		mes s
		gosub *skill_desc
		s = strmid(s, 0, 40)
		pos wx + 340, wy + 66 + cnt * 19 + 2
		mes "" + p(78) + "/" + calcspellfail(i, cc) + "%"
		pos wx + 420, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	commark(1) = page * 1000 + cs
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		menucycle = 0
		efid = p
		goto *com_spellcast
	}
	if ( key == "sc" ) {
		snd SOUNDLIST_OK1
		p = list(0, pagesize * page + cs)
		if ( ogdata(36 + sc) == p ) {
			ogdata(36 + sc) = 0
			stgdata(36 + sc) = 0
			stgdata(56 + sc) = 0
			ncgsdata(sc) = ""
			goto *com_spell_loop_pgchk
		}
		repeat 20
			if ( ogdata(36 + cnt) == p ) {
				ogdata(36 + cnt) = 0
				stgdata(36 + cnt) = 0
				stgdata(56 + cnt) = 0
				ncgsdata(cnt) = ""
			}
		loop
		ogdata(36 + sc) = p
		txt -1, lang("{" + sc + "}キーにショートカットを割り当てた。", "You have assigned the shortcut to {" + sc + "} key.")
		display_msg inf_screeny + inf_tiles
		goto *com_spell_loop_pgchk
	}
	if ( cfg_strackex != 0 ) {
		if ( key == key_mode2 ) {
			i = list(0, pagesize * page + cs)
			if ( i != (-1) ) {
				p = 750
				repeat 20, 750
					if ( gdatac(cnt) \ 10000 == 0 ) {
						p = cnt
					}
					if ( gdatac(cnt) == cc * 10000 + i ) {
						p = cnt
						i = 0
						break
					}
				loop
				gdatac(p) = cc * 10000 + i
				sortskilltrack
				snd SOUNDLIST_OK1
			}
			display_msg inf_screeny + inf_tiles
			goto *com_spell_loop_pgchk
		}
	}
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 3 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 3
				}
			}
			if ( p != curmenu ) {
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					snd SOUNDLIST_SPELL
					goto *com_spell
				}
				if ( curmenu == 1 ) {
					snd SOUNDLIST_SKILL
					goto *label_2811
				}
				if ( curmenu == 2 ) {
					snd SOUNDLIST_SPELL
					goto *com_spell
				}
				if ( curmenu == 3 ) {
					snd SOUNDLIST_SPELL
					goto *com_spell
				}
			}
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_spell_loop_pgchk
		}
	}
	if ( key == key_identify ) {
		p = list(0, pagesize * page + cs)
		if ( p >= 550 ) {
			title_pos = p - 550
			gosub *label_4644
			goto *com_spell
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_spell_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		gosub *screen_draw
		goto *pc_turn
	}
	goto *com_spell_loop

*skill_desc
	s = ""
	if ( skillType(i) / 1000 == 1 | skillType(i) / 1000 == 4 ) {
		p = skillType(i) \ 1000
		calcbuff CALCBUFF_DESCRIPTION, p, calcspellpower(i, cc)
		s = "" + dur + lang("ﾀｰﾝ ", "t ") + buffdesc
		return
	}
	calcskill i, cc, calcspellpower(i, cc)
	p(90) = stat
	calcempower i
	if ( p(90) == 1 ) {
		if ( dice1 != 0 ) {
			s += "" + dice1 + "d" + dice2
			if ( bonus != 0 ) {
				if ( bonus > 0 ) {
					s += "+" + bonus
				}
				else {
					s += bonus
				}
			}
		}
		else {
			if ( i == 461 ) {
				s += "" + limit(bonus, 1, 100) + "%"
			}
			else {
				s += lang("ﾊﾟﾜｰ", "Power:") + bonus
			}
		}
		s += " "
	}
	s += skilldesc(i)
	if ( i == 413 ) {
		s += " " + (150 + calcspellpower(i, cc) / 5) + lang("MP回復", "HealMP")
	}
	return

*label_2879
	page = 0
	cs = 0
	curmenu = 0
	if ( csctrl == 2 | csctrl == 3 ) {
		page = 1
	}

*label_2880
	pagesize = 16
	listmax = 0
	if ( csctrl != 4 & csctrl != 5 ) {
		cc = CHARA_PLAYER
	}
	csskill = -1
	cs_buff = 0
	if ( gWizard | godcheck(0) == "mayumaka" | csctrl == 5 ) {
		if ( csctrl != 2 & csctrl != 3 ) {
			list(0, listmax) = -1, 10000
			listn(0, listmax) = lang("◆ 能力", "Attribute")
			listmax++
			repeat 4 - 2, 2
				if ( sdata(cnt, cc) != 0 ) {
					list(0, listmax) = cnt, skillUse(cnt) + 11000
					listmax++
				}
			loop
			repeat 50 - 10, 10
				if ( sdata(cnt, cc) != 0 ) {
					list(0, listmax) = cnt, skillUse(cnt) + 11000
					listmax++
				}
			loop
			list(0, listmax) = -1, 15000
			listn(0, listmax) = lang("◆ スペル", "Spell")
			listmax++
			repeat 467 - 400, 400
				if ( cnt != 426 & cnt != 427 ) {
					list(0, listmax) = cnt, skillUse(cnt) + 16000
					listmax++
				}
			loop
			repeat userspellmax, 550
				list(0, listmax) = cnt, skillUse(cnt) + 16000
				listmax++
			loop
		}
	}
	list(0, listmax) = -1, 20000
	listn(0, listmax) = lang("◆ スキルと特殊能力", "Skill")
	listmax++
	if ( csctrl == 3 ) {
		gosub *label_0286
	}
	else {
		repeat 400 - 150, 150
			f = 0
			if ( sdata(cnt, cc) != 0 ) {
				f = 1
				if ( csctrl == 2 ) {
					if ( sorg(cnt, cc) == 0 ) {
						f = 0
					}
				}
			}
			if ( f ) {
				list(0, listmax) = cnt, skillUse(cnt) + 21000
				listmax++
			}
		loop
	}
	list(0, listmax) = -1, 30000
	listn(0, listmax) = lang("◆ 武器の専門", "Weapon Proficiency")
	listmax++
	repeat 150 - 100, 100
		f = 0
		if ( csctrl != 3 ) {
			if ( sdata(cnt, cc) != 0 ) {
				f = 1
			}
		}
		else {
			if ( sdata(cnt, cc) == 0 ) {
				if ( skillUse(cnt) != SKILL_NONE ) {
					f = 1
				}
			}
		}
		if ( f ) {
			list(0, listmax) = cnt, skillUse(cnt) + 31000
			listmax++
		}
	loop
	if ( csctrl != 2 & csctrl != 3 ) {
		list(0, listmax) = -1, 40000
		listn(0, listmax) = lang("◆ 耐性と抵抗力", "Resistance")
		listmax++
		repeat 100 - 50, 50
			if ( sdata(cnt, cc) != 0 ) {
				list(0, listmax) = cnt, skillUse(cnt) + 41000
				listmax++
			}
		loop
	}
	gosub *sort_list
	gsel BUFFER_PIC
	picload_ exedir + "graphic\\ie_sheet.bmp"
	gsel BUFFER_SCREEN
	wx = (windoww - 700) / 2 + inf_screenx
	wy = winposy(400) - 10
	ww = 700
	wh = 400
	redraw 0
	s = lang("キャラクターシート", "Character Sheet")
	if ( csctrl == 2 ) {
		s = lang("能力訓練", "Skill Training")
	}
	if ( csctrl == 3 ) {
		s = lang("能力の習得", "Skill Learning")
	}
	drawmenu 0
	if ( mode != MODELIST_CHARA_CREATION ) {
		snd SOUNDLIST_CHARA
	}
	windowanime wx, wy, ww, wh, 10, 4
	gsel BUFFER_BUF
	pos 0, 0
	exist exedir + "user\\graphic\\user_face1.bmp"
	if ( strsize != (-1) & cfg_userface1 ) {
		picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
		ex_userface = 1
	}
	else {
		picload_ exedir + "graphic\\face1.bmp", 1
		ex_userface = 0
	}
	if ( cPortrait(cc) < 0 ) {
		s = exedir + "user\\graphic\\face" + abs(cPortrait(cc) + 1) + ".bmp"
		exist s
		if ( cPortrait(cc) != (-1) ) {
			if ( strsize != (-1) ) {
				pos 0, 0
				picload_ s, 1
			}
		}
	}
	gsel BUFFER_SCREEN
	if ( returnfromportrait == 0 ) {
		redraw 0
		gmode 6, , , 80
		pos wx + 4, wy + 4
		gcopy BUFFER_PIC, 0, 0, 700, 400
		gmode 2
	}
	if ( csctrl == 2 ) {
		txtnew
		txt -1, lang("どの能力を訓練する？", "Train which skill?")
	}
	returnfromportrait = 0

*label_2888
	if ( csctrl != 1 ) {
		display_msg inf_tiles + inf_screeny
	}
	pagemax = (listmax - 1) / pagesize + 1
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	if ( csctrl == 1 ) {
		pagemax = 0
	}
	cs_bk = -1
	redraw 0
	if ( csctrl == 0 | csctrl == 4 | csctrl == 5 ) {
		if ( page == 0 ) {
			s = lang("ｶｰｿﾙ [祝福と呪いの情報]  ", "Cursor [Hint]  ") + strhint6 + strhint2 + strhint3
		}
		else {
			s = lang("決定 [ボーナスの分配]  ", "Enter [Spend Bonus]  ") + strhint2 + strhint3
		}
	}
	if ( csctrl == 1 ) {
		s = lang("決定ｷｰ [リロール]  " + strhint6 + "Shift,Esc [最終確認]", "Enter Key [Reroll]  " + strhint6 + "Shift,Esc [Confirm]")
	}
	if ( csctrl == 2 ) {
		if ( page == 0 ) {
			s = strhint6 + strhint2 + strhint3
		}
		else {
			s = lang("決定 [スキルを訓練]  ", "Enter [Train Skill]  ") + strhint2 + strhint3
		}
	}
	if ( csctrl == 3 ) {
		if ( page == 0 ) {
			s = strhint6 + strhint2 + strhint3
		}
		else {
			s = lang("決定 [スキルを習得]  ", "Enter [Learn Skill]  ") + strhint2 + strhint3
		}
	}
	if ( csctrl != 1 ) {
		if ( page != 0 ) {
			s += "" + key_mode2 + " [" + lang("スキルトラック", "Track Skill") + "]"
		}
	}
	showtitle s, s, 236, 1

*label_2889
	redraw 0
	s = ""
	if ( csctrl == 0 | csctrl == 4 ) {
		if ( page != 0 ) {
			if ( cc != CHARA_PLAYER & cc <= 15 & ncgSPPPoints > 0 ) {
				s = lang("残り " + cSkillPoint(cc) + " のボーナスをスキルに分配できる(SPP:" + ncgSPPPoints + ")", "You can spend " + cSkillPoint(cc) + " bonus points.")
			}
			else {
				s = lang("残り " + cSkillPoint(cc) + " のボーナスをスキルに分配できる", "You can spend " + cSkillPoint(cc) + " bonus points.")
			}
		}
	}
	display_window2 (windoww - 700) / 2 + inf_screenx, winposy(400) - 10, 700, 400, 7
	if ( page == 0 ) {
		keyrange = 0
		key_list = key_enter
		if ( cfg_nc_charasheet == 0 ) {
			display_topic lang("能力(元の値)  - 潜在能力", "Attributes(Org) - Potential"), wx + 28, wy + 122
			display_topic lang("各種修正", "Combat Rolls"), wx + 400, wy + 253
			display_topic lang("冒険の軌跡", "Trace"), wx + 28, wy + 273
			display_topic lang("祝福と呪い", "Blessing and Hex"), wx + 400, wy + 122
			display_topic lang("その他", "Extra Info"), wx + 220, wy + 273
			if ( cPortrait(cc) >= 0 ) {
				p = cSex(cc) * 64 + cPortrait(cc)
				pos wx + 560, wy + 27
				exist exedir + "user\\graphic\\user_npcface" + p + ".bmp"
				if ( strsize != (-1) ) {
					gsel 32
					pos 0, 0
					picload_ exedir + "user\\graphic\\user_npcface" + p + ".bmp", 1
					gsel BUFFER_SCREEN
					pos wx + 560, wy + 27
					gzoom 80, 112, 32, 0, 0, 80, 112
				}
				else {
					if ( ex_userface == 1 ) {
						gzoom 80, 112, 4, p \ 16 * 80, p / 16 * 112, 80, 112
					}
					else {
						gzoom 80, 112, 4, p \ 16 * 48, p / 16 * 72, 48, 72
					}
				}
			}
			else {
				s = exedir + "user\\graphic\\face" + abs(cPortrait(cc) + 1) + ".bmp"
				exist s
				if ( cPortrait(cc) != (-1) ) {
					if ( strsize != (-1) ) {
						pos wx + 560, wy + 27
						gzoom 80, 112, 4, 0, 0, 80, 112
					}
				}
				else {
					if ( cId(cc) == CREATURE_ID_USER ) {
						if ( userdata2(0, cUNID(cc)) ) {
							pos wx + 560, wy + 27
							gzoom 80, 112, 100, cUNID(cc) \ 16 * 80, cUNID(cc) / 16 * 112, 80, 112
						}
					}
				}
			}
			window2 wx + 557, wy + 23, 87, 120, 1, 10
			if ( cbit(CHARA_BIT_PCC, cc) == TRUE ) {
				pos wx + 596 + 22, wy + 86 + 24
				gmode 2, 32, 48
				if ( cc == CHARA_PLAYER ) {
					grotate 10 + cc, 32, 0, 0, 24 + cfg_graphicpc * 8, 40 + cfg_graphicpc * 8
				}
				else {
					grotate 10 + cc, 32, 0, 0, 24 + cfg_graphicnpc * 8, 40 + cfg_graphicnpc * 8
				}
			}
			else {
				transmissivity = 0
				if ( cId(cc) == CREATURE_ID_USER ) {
					if ( userdata2(1, cUNID(cc)) ) {
						transmissivity = userdata2(1, cUNID(cc))
					}
				}
				if ( ocChipTransparency(cc) ) {
					transmissivity = ocChipTransparency(cc)
				}
				i = getcharapic(cc)
				chara_preparepic i, getcharacolor(cc)
				pos wx + 596 + 22, wy + 86 + 24
				gmode 4, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i), 256 - transmissivity
				color 0, 0, 0
				grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, i) / (1 + (chipc(CHIPC_HEIGHT, i) > inf_tiles)), inf_tiles
				gmode 2
			}
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			color 20, 10, 0
			s = lang("レベル", "Level"), lang("経験", "EXP"), lang("必要値", "Next Lv"), lang("信仰", "God"), lang("所属", "Guild")
			repeat 5
				pos wx + 355, wy + 46 + cnt * 15
				mes s(cnt)
			loop
			s = lang("名前", "Name"), lang("異名", "Aka"), lang("種族", "Race"), lang("性別", "Sex"), lang("職業", "Class"), lang("年齢", "Age"), lang("身長", "Height"), lang("体重", "Weight")
			repeat 8
				pos wx + 30 + cnt / 4 * 190, wy + 61 + cnt \ 4 * 15
				mes s(cnt)
			loop
			repeat 8
				pos wx + 37, wy + 157 + cnt * 15
				gmode 2, inf_tiles, inf_tiles
				grotate BUFFER_ITEM, cnt * inf_tiles, 672, 0, inf_tiles, inf_tiles
				pos wx + 54, wy + 151 + cnt * 15
				color 0, 0, 0
				if ( cfg_charasheet == 2 ) {
					p = sdata(10 + cnt + STARTING_SKILL_SPACT, cc) \ 1000
					if ( p >= 400 ) {
						color 0, 0, 255
					}
					else {
						if ( p < 10 ) {
							color 255, 0, 0
						}
					}
				}
				mes _stats2(cnt)
			loop
			if ( cfg_charasheet == 0 ) {
				s = lang("生命力", "Life"), lang("マナ", "Mana"), lang("狂気度", "Insanity"), lang("速度", "Speed"), "", lang("名声", "Fame"), lang("カルマ", "Karma"), "", lang("打撃修正", "Melee"), lang("射撃修正", "Shoot"), "", "", "", "", "", ""
			}
			else {
				s = lang("生命力", "Life"), lang("マナ", "Mana"), lang("速度", "Speed"), lang("運", "Luck"), lang("狂気度", "Insanity"), lang("名声", "Fame"), lang("カルマ", "Karma"), lang("信仰P", "Piety"), ""
			}
			repeat 8
				pos wx + 255, wy + 151 + cnt * 15
				color 0, 0, 0
				if ( cfg_charasheet == 2 ) {
					if ( cnt == 0 | cnt == 1 | cnt == 2 | cnt == 3 ) {
						if ( cnt == 0 ) {
							p = 2
						}
						if ( cnt == 1 ) {
							p = 3
						}
						if ( cnt == 2 ) {
							p = 18
						}
						if ( cnt == 3 ) {
							p = 19
						}
						if ( sdata(p + STARTING_SKILL_SPACT, cc) \ 1000 >= 400 ) {
							color 0, 0, 255
						}
						else {
							if ( sdata(p + STARTING_SKILL_SPACT, cc) \ 1000 < 10 ) {
								color 255, 0, 0
							}
						}
					}
				}
				mes s(cnt)
			loop
			s = lang("ターン", "Turns"), lang("経過日", "Days"), lang("殺害数", "Kills"), lang("総時間", "Time"), "", ""
			repeat 5
				pos wx + 32, wy + 301 + cnt * 15
				mes s(cnt)
			loop
			s = lang("荷車重量", "Cargo Wt"), lang("荷車限界", "Cargo Lmt"), lang("装備重量", "Equip Wt"), lang("最深到達", "Deepest Lv")
			repeat 4
				pos wx + 224, wy + 301 + cnt * 15
				mes s(cnt)
			loop
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
			s = "" + cLevel(cc), "" + cExp(cc), "" + cExpToNext(cc), godname(godcheck(cc)), guildname(cc)
			repeat 5
				pos wx + 410 + en * 5, wy + 45 + cnt * 15
				mes s(cnt)
			loop
			s = cnName(cc), cnAka(cc)
			cutname s, 22
			dbidn = cnRace(cc)
			dbmode = DBMODE_REF
			gosub *cm_race
			if ( cId(cc) == CREATURE_ID_USER ) {
				if ( userdatan2(0, cUNID(cc)) != "" ) {
					racename = userdatan2(0, cUNID(cc))
				}
			}
			cutname racename, 14
			s(2) = cnven(racename)
			dbidn = cnClass(cc)
			dbmode = DBMODE_REF
			gosub *cm_race_loop
			if ( cId(cc) == CREATURE_ID_USER ) {
				if ( userdatan2(1, cUNID(cc)) != "" ) {
					classname = userdatan2(1, cUNID(cc))
				}
			}
			cutname classname, 14
			s(4) = cnven(lang("" + classname, cnClass(cc)))
			if ( cSex(cc) == 0 ) {
				s(3) = cnven(strmale)
			}
			else {
				s(3) = cnven(strfemale)
			}
			s(5) = "" + calcage(cc) + " " + lang("歳", ""), "" + cHeight(cc) + " cm", "" + cWeight(cc) + " kg"
			repeat 8
				pos wx + 68 + cnt / 4 * 190 + en * ((cnt > 3) * 12), wy + 60 + cnt \ 4 * 15
				mes s(cnt)
			loop
			repeat 8
				cnt2 = cnt
				s = "(" + sorgex(10 + cnt, cc) + ")"
				if ( encfind(cc, 6 * 10000 + 10 + cnt) != (-1) ) {
					s += "*"
				}
				pos wx + 92, wy + 151 + cnt * 15
				if ( sdata(10 + cnt, cc) >= 10000000 & cfg_nc_stateshorten ) {
					mes "" + sdata(10 + cnt, cc) / 1000000 + "M"
				}
				else {
					if ( sdata(10 + cnt, cc) >= 10000 & cfg_nc_stateshorten ) {
						mes "" + sdata(10 + cnt, cc) / 1000 + "K"
					}
					else {
						mes "" + sdata(10 + cnt, cc)
					}
				}
				pos wx + 124, wy + 151 + cnt * 15
				mes s
				p = sdata(10 + cnt + STARTING_SKILL_SPACT, cc) \ 1000
				pos wx + 176, wy + 152 + cnt * 15
				if ( cfg_st_attributespotential == 0 ) {
					if ( p >= 450 ) {
						mes "Extra"
						continue
					}
					if ( p >= 400 ) {
						mes "Superb++"
						continue
					}
					if ( p >= 360 ) {
						mes "Superb+"
						continue
					}
					if ( p >= 200 ) {
						mes "Superb"
						continue
					}
					if ( p >= 150 ) {
						mes "Great"
						continue
					}
					if ( p >= 100 ) {
						mes "Good"
						continue
					}
					if ( p >= 50 ) {
						mes "Bad"
						continue
					}
					mes "Hopeless"
				}
				else {
					mes strf("%5d%%", p)
				}
			loop
			if ( cfg_charasheet == 0 ) {
				if ( sdata(SKILL_ATTR_LIFE, cc) >= 100000 & cfg_nc_stateshorten ) {
					s(0) = "" + sdata(SKILL_ATTR_LIFE, cc) / 1000 + "K(" + sorgex(2, cc) + ")"
				}
				else {
					s(0) = "" + sdata(SKILL_ATTR_LIFE, cc) + "(" + sorgex(2, cc) + ")"
				}
				if ( sdata(SKILL_ATTR_MANA, cc) >= 100000 & cfg_nc_stateshorten ) {
					s(1) = "" + sdata(SKILL_ATTR_MANA, cc) / 1000 + "K(" + sorgex(3, cc) + ")"
				}
				else {
					s(1) = "" + sdata(SKILL_ATTR_MANA, cc) + "(" + sorgex(3, cc) + ")"
				}
				s(2) = "" + cSAN(cc)
				if ( cSpeed(cc) >= 100000 & cfg_nc_stateshorten ) {
					s(3) = "" + cSpeed(cc) / 1000 + "K(" + sorgex(18, cc) + ")"
				}
				else {
					s(3) = "" + cSpeed(cc) + "(" + sorgex(18, cc) + ")"
				}
				s(4) = "", "" + cFame(cc), "" + cKarma(cc), "", ""
			}
			else {
				s = "" + sdata(SKILL_ATTR_LIFE, cc) + "(" + sorgex(2, cc) + ")", "" + sdata(SKILL_ATTR_MANA, cc) + "(" + sorgex(3, cc) + ")", "" + cSpeed(cc) + "(" + sorgex(18, cc) + ")", "" + sLUC(cc) + "(" + sorgex(19, cc) + ")", "" + cSAN(cc), "" + cFame(cc), "" + cKarma(cc), "", "", ""
			}
			repeat 8
				pos wx + 310, wy + 151 + cnt * 15
				mes s(cnt)
			loop
			if ( cfg_charasheet > 0 ) {
				pos wx + 310, wy + 151 + 7 * 15
				mes "" + cPiety(cc) + "/" + int(limitf(double(sPrayer(cc)) * 100, 0, 2147483647))
			}
			val = 0
			gosub *com_calcAttack
			tc = cc
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			color 20, 10, 0
			pos wx + 417, wy + 281 + p(2) * 16
			mes lang("軽減", "Prot")
			pos wx + 590 - en * 16, wy + 281 + p(2) * 16
			mes lang("回避", "Evade")
			attackskill = SKILL_WEAPON_MARTIAL_ARTS
			evade = calcattackhit(2)
			prot = calcattackdmg(2)
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			color 0, 0, 0
			pos wx + 460 + en * 8, wy + 279 + p(2) * 16
			mes "" + (100 - 10000 / (prot + 100)) + "% + " + protdice1 + "d" + protdice2
			pos wx + 625 - en * 8, wy + 279 + p(2) * 16
			if ( evade >= 10000000 & cfg_nc_stateshorten ) {
				mes "" + evade / 1000000 + "M%"
			}
			else {
				if ( evade >= 10000 & cfg_nc_stateshorten ) {
					mes "" + evade / 1000 + "K%"
				}
				else {
					mes "" + evade + "%"
				}
			}
			p(2)++
			s = "" + gTurn + "" + lang("ターン", " Turns"), "" + gDayPast + "" + lang("日", " Days"), "" + gKilled, "" + cnvplaytime(gPlayTime + timeGetTime() / 1000 - time_begin), "", ""
			repeat 5
				pos wx + 80, wy + 299 + cnt * 15
				mes s(cnt)
			loop
			if ( godcheck() == "serria" ) {
				s = "" + cnvweight(gCargoWeight), cnvweight(gCargoLimit * 3), cnvweight(cEqWeight(cc)) + " " + cnveqweight(cc), cnvrank(gDeepest) + lang("階相当", " Level")
			}
			else {
				s = "" + cnvweight(gCargoWeight), cnvweight(gCargoLimit), cnvweight(cEqWeight(cc)) + " " + cnveqweight(cc), cnvrank(gDeepest) + lang("階相当", " Level")
			}
			repeat 4
				pos wx + 287 + en * 14, wy + 299 + cnt * 15
				mes s(cnt)
			loop
			cs_buffmax = 0
			repeat 8 + 8 - 1
				x = wx + 430 + cnt / 3 * 40
				y = wy + 151 + cnt \ 3 * 32
				if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) == 0 ) {
					gmode 4, , , 120
					pos x, y
					gcopy BUFFER_INF, 320, 160, 32, 32
					gmode 2
					continue
				}
				cs_buffmax++
				pos x, y
				gcopy BUFFER_CHR, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) \ 50 * 32, buffy(ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc)), 32, 32
				if ( cs_buff == cnt ) {
					pos x, y
					gfini 32, 32
					gfinc 20, 20, 50
				}
			loop
			if ( cs_buffmax != 0 ) {
				calcbuff CALCBUFF_DESCRIPTION, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cs_buff * 3, cc), ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cs_buff * 3 + 1, cc)
				s = "" + buffname(ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cs_buff * 3, cc)) + ": " + ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cs_buff * 3 + 2, cc) + lang("(" + dur + ")ﾀｰﾝの間、", "(" + dur + ") ") + buffdesc
			}
			else {
				s = lang("今は持続効果を受けていない", "This character isn't currently blessed or hexed.")
			}
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos wx + 108, wy + 366
			mes s
			font lang(cfg_font1, cfg_font2), 11 + sizefix * 2 - en * 2, 1
			color 20, 10, 0
			pos wx + 70, wy + 369 - en * 3
			mes lang("説明:", "Hint:")
		}
		else {
			gosub *nc_charasheet
		}
	}
	else {
		display_topic lang("能力の名称", "Name"), wx + 28, wy + 36
		display_topic lang("Lv(潜在)", "Lv(Potential)"), wx + 182, wy + 36
		display_topic lang("効果", "Detail"), wx + 320, wy + 36
		keyrange = 0
		p(1) = 0
		repeat pagesize
			p = pagesize * (page - 1) + cnt
			if ( p >= listmax ) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange++
			if ( list(0, p) < 0 ) {
				p(1) = 1
				continue
			}
			p(1)++
			if ( list(0, p) < 100 ) {
				x = 52
				dx = 18
			}
			else {
				x = 70
				dx = 0
			}
			if ( p(1) \ 2 == 0 ) {
				pos wx + x, wy + 66 + cnt * 19
				gfini 595 + dx, 18
				gfdec2 12, 14, 16
			}
			if ( list(0, p) < 100 ) {
				continue
			}
			display_key wx + 58, wy + 64 + cnt * 19, cnt
		loop
	}
	if ( page > 0 ) {
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		cs_listbk
		repeat pagesize
			p = pagesize * (page - 1) + cnt
			if ( p >= listmax ) {
				break
			}
			if ( list(0, p) >= 0 ) {
				i = list(0, p)
				if ( i < 100 ) {
					x = 54
					p(1) = 10
				}
				else {
					x = 84
					p(1) = skillUse(i) - 10
				}
				pos wx + 38, wy + 75 + cnt * 19
				gmode 2, inf_tiles, inf_tiles
				grotate BUFFER_ITEM, p(1) * inf_tiles, 672, 0, inf_tiles, inf_tiles
				s = skillnameref(i, cc)
				s = strmid(s, 0, 14)
				if ( i >= 50 & i < 100 ) {
					s = lang("", "Resist ") + cnven(s) + lang("耐性", "")
				}
				if ( cfg_strackex != 0 ) {
					repeat 20
						if ( gdatac(750 + cnt) == cc * 10000 + i ) {
							s = "*" + s
						}
					loop
				}
				else {
					repeat 3
						if ( gdata(750 + cnt) == cc * 10000 + i ) {
							s = "*" + s
						}
					loop
				}
				cs_list s, wx + x, wy + 66 + cnt * 19 - 1, 19
				if ( list(0, p) >= 50 & list(0, p) < 100 ) {
					p(1) = limit(sdata(list(0, p), cc) / 50, 0, 6)
					s = _resist(p(1))
					if ( gWizard | godcheck(0) == "mayumaka" ) {
						s = "" + sdata(list(0, p), cc)
					}
				}
				else {
					if ( list(0, p) >= 550 & list(0, p) < 600 ) {
						s = str(userspelldata(12, list(0, p) - 550))
						s = strmid(s, -1, 6)
						s = str(userspelldata(12, i - 550) / 1000000) + "." + strmid(s, 0, 3)
						s += "(" + str(userspelldata(12, i - 550) \ 1000) + "%)"
					}
					else {
						s = str(sdata(list(0, p) + STARTING_SKILL_SPACT, cc))
						s = strmid(s, -1, 6)
						s = "" + sorgex(i, cc) + "." + strmid(s, 0, 3)
						if ( sorgex(i, cc) != sdata(i, cc) ) {
							p(1) = sdata(i, cc) - sorgex(i, cc)
							if ( gWizard | godcheck(0) == "mayumaka" ) {
								if ( p(1) > 0 ) {
									s += "+" + p(1)
								}
								else {
									s += p(1)
								}
							}
						}
						s += "(" + sgrowth(i, cc) + "%)"
					}
				}
				pos wx + 280 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
				mes s
				pos wx + 330, wy + 66 + cnt * 19 + 2
				if ( list(0, p) >= 550 & list(0, p) < 600 ) {
					if ( userspelldata(0, list(0, p) - 550) < 0 ) {
						s = "封印済み"
					}
					else {
						s = skilldescref(i, cc)
					}
				}
				else {
					s = skilldescref(i, cc)
				}
				mes s
				if ( csctrl == 2 | csctrl == 3 ) {
					if ( csctrl == 2 ) {
						s = "" + calctraincost(i, cc) + "p "
					}
					else {
						s = "" + calclearncost(i, cc) + "p "
					}
					pos wx + 322 - strlen(s) * 7, wy + 66 + cnt * 19 + 2
					mes s
				}
				else {
					if ( sorgex(i, cc) != sdata(i, cc) ) {
						i = sdata(i, cc) - sorgex(i, cc)
						if ( list(0, p) >= 50 ) {
							i = i / 50
						}
						else {
							i = i / 5
						}
						s = ""
						putenclv i
						pos wx + 282, wy + 66 + cnt * 19 + 2
						mes s
					}
				}
			}
			else {
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
				cs_list listn(0, p), wx + 88, wy + 66 + cnt * 19, 19
				font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			}
		loop
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if ( page == 0 ) {
		if ( key == "p" ) {
			if ( cc < MAX_CHARA_FOLLOWER ) {
				gosub *label_2916
				if ( mode != MODELIST_CHARA_CREATION ) {
					nowindowanime = 1
				}
				returnfromportrait = 1
				goto *label_2879
			}
		}
		if ( key == key_north ) {
			cs_buff--
			if ( cs_buff < 0 ) {
				cs_buff = cs_buffmax - 1
			}
			goto *label_2888
		}
		if ( key == key_south ) {
			cs_buff++
			if ( cs_buff >= cs_buffmax ) {
				cs_buff = 0
			}
			goto *label_2888
		}
	}
	else {
		if ( csctrl != 1 ) {
			if ( key == key_mode2 ) {
				repeat keyrange
					i = list(0, pagesize * (page - 1) + cs)
					break
				loop
				if ( i != (-1) ) {
					if ( cfg_strackex != 0 ) {
						p = 750
						repeat 20, 750
							if ( gdatac(cnt) \ 10000 == 0 ) {
								p = cnt
							}
							if ( gdatac(cnt) == cc * 10000 + i ) {
								p = cnt
								i = 0
								break
							}
						loop
						gdatac(p) = cc * 10000 + i
						sortskilltrack
						snd SOUNDLIST_OK1
					}
					else {
						p = 750
						repeat 3, 750
							if ( gdata(cnt) \ 10000 == 0 ) {
								p = cnt
							}
							if ( gdata(cnt) == cc * 10000 + i ) {
								p = cnt
								i = 0
								break
							}
						loop
						gdata(p) = cc * 10000 + i
						snd SOUNDLIST_OK1
					}
				}
			}
		}
	}
	if ( csctrl == 1 ) {
		if ( key == key_enter ) {
			snd SOUNDLIST_DICE
			return 0
		}
		if ( key == key_cancel ) {
			return 1
		}
		goto *label_2913
	}
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * (page - 1) + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		csskill = p
		if ( csctrl == 2 | csctrl == 3 ) {
			screenupdate = -1
			gosub *screen_draw
			tc = tcbk
			return
		}
		if ( csskill >= 400 & csskill < 467 & gWizard == 0 & godcheck(0) == "mayumaka" ) {
			goto *label_2888
		}
		if ( cSkillPoint(cc) < 1 | p < 0 | p < 100 ) {
			goto *label_2888
		}
		if ( sorg(csskill, cc) == 0 ) {
			snd SOUNDLIST_FAIL1
			goto *label_2888
		}
		getkey p, 17
		if ( p ) {
			txt -1, lang("ポイントを全て振る？", "Create the same again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 240, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				repeat
					cSkillPoint(cc)--
					skillexp2 csskill, cc, 400, 2, 1000
					p(40) = 15 * (100 + calctraitgrowthrate(cc, csskill)) / 100
					modgrowth cc, csskill, limit(p(40) - sgrowth(csskill, cc) / 15, 2, p(40))
					if ( cSkillPoint(cc) == 0 ) {
						break
					}
				loop
				snd SOUNDLIST_SPEND1
				goto *label_2888
			}
			goto *label_2888
		}
		if ( csskill != bpcounter / 10000 ) {
			bpcounter = csskill * 10000
		}
		else {
			if ( bpcounter \ 10000 < 9999 ) {
				bpcounter++
			}
		}
		nc_intb_ndf = 1
		repeat (bpcounter \ 10000 + 1) / 10 + 1
			cSkillPoint(cc)--
			snd SOUNDLIST_SPEND1
			if ( cc != CHARA_PLAYER & cc <= 15 & ncgSPPPoints > 0 ) {
				skillmod csskill, cc, 1000
				ncgSPPPoints--
			}
			else {
				skillexp2 csskill, cc, 400, 2, 1000
			}
			p(40) = 15 * (100 + calctraitgrowthrate(cc, csskill)) / 100
			modgrowth cc, csskill, limit(p(40) - sgrowth(csskill, cc) / 15, 2, p(40))
			if ( cSkillPoint(cc) == 0 ) {
				break
			}
		loop
		nc_intb_ndf = 0
		redraw 0
		gosub *screen_drawStatus
		goto *label_2888
	}
	if ( key == key_pageup ) {
		bpcounter = 0
		page++
		snd SOUNDLIST_POP1
		goto *label_2888
	}
	if ( key == key_pagedown ) {
		bpcounter = 0
		page--
		snd SOUNDLIST_POP1
		goto *label_2888
	}
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			bpcounter = 0
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 3 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 3
				}
			}
			if ( p != curmenu ) {
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					csctrl = 0
					goto *label_2879
				}
				if ( curmenu == 1 ) {
					goto *label_2943
				}
				if ( curmenu == 2 ) {
					goto *com_trait
				}
				if ( curmenu == 3 ) {
					goto *com_material
				}
			}
		}
	}
	if ( key == key_cancel ) {
		bpcounter = 0
		menucycle = 0
		if ( csctrl == 0 ) {
			gosub *screen_draw
			goto *pc_turn
		}
		else {
			screenupdate = -1
			gosub *screen_draw
			tc = tcbk
			return
		}
	}

*label_2913
	goto *label_2889

*portrait_item
	rtval = -2
	if ( page == 0 ) {
		if ( val == 0 ) {
			rtval = -2
		}
		if ( val == 1 ) {
			rtval = 100, 0, cPortrait(cc)
		}
		if ( val == 2 ) {
			rtval = 1, 0, pcc(PCC_HAIR, cc) \ 1000
			rtvaln = "hair"
		}
		if ( val == 3 ) {
			rtval = 10, 0, pcc(PCC_SUB_HAIR, cc) \ 1000
			rtvaln = "subhair"
		}
		if ( val == 4 ) {
			rtval = 1, 1, pcc(PCC_HAIR, cc) / 1000
		}
		if ( val == 5 ) {
			rtval = 15, 0, pcc(PCC_BODY, cc) \ 1000
			rtvaln = "body"
		}
		if ( val == 6 ) {
			rtval = 9, 0, pcc(PCC_CLOTH, cc) \ 1000
			rtvaln = "cloth"
		}
		if ( val == 7 ) {
			rtval = 7, 0, pcc(PCC_PANTS, cc) \ 1000
			rtvaln = "pants"
		}
		if ( val == 8 ) {
			rtval = -1
			rtvaln = ""
		}
		if ( val == 9 ) {
			if ( cc != CHARA_PLAYER ) {
				rtval = 101, 0, cbit(CHARA_BIT_PCC, cc)
			}
			else {
				rtval = 16, 0, pcc(PCC_RIDE, cc) \ 1000
				rtvaln = "ride"
			}
		}
		if ( val == 10 ) {
			if ( cPic(cc) \ 1000 >= 825 ) {
				rtval = 102, 0, 0
			}
			else {
				if ( cPic(cc) \ 1000 > 660 ) {
					rtval = 102, 0, cPic(cc) \ 660
				}
				else {
					rtval = 102, 0, 0
				}
			}
		}
		if ( val == 11 ) {
			rtval = 16, 0, pcc(PCC_RIDE, cc) \ 1000
			rtvaln = "ride"
		}
	}
	else {
		if ( val == 0 ) {
			rtval = 15, 1, pcc(PCC_BODY, cc) / 1000
		}
		if ( val == 1 ) {
			rtval = 9, 1, pcc(PCC_CLOTH, cc) / 1000
		}
		if ( val == 2 ) {
			rtval = 7, 1, pcc(PCC_PANTS, cc) / 1000
		}
		if ( val == 3 ) {
			rtval = 11, 0, pcc(PCC_ETC1, cc) \ 1000
			rtvaln = "etc"
		}
		if ( val == 4 ) {
			rtval = 12, 0, pcc(PCC_ETC2, cc) \ 1000
			rtvaln = "etc"
		}
		if ( val == 5 ) {
			rtval = 13, 0, pcc(PCC_ETC3, cc) \ 1000
			rtvaln = "etc"
		}
		if ( val == 6 ) {
			rtval = 14, 0, pcc(PCC_EYE, cc) \ 1000
			rtvaln = "eye"
		}
		if ( val == 7 ) {
			rtval = -1
			rtvaln = ""
		}
	}
	return

*label_2916
	create_pcpic cc, 0
	page = 0
	pagesize = 19
	cs = 0
	cs_bk = -1
	ww = 380
	wh = 340
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	snd SOUNDLIST_PORT
	windowanime wx, wy, ww, wh, 10, 7
	gsel BUFFER_BUF
	pos 0, 0
	exist exedir + "user\\graphic\\user_face1.bmp"
	if ( strsize != (-1) & cfg_userface1 ) {
		picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
		ex_userface = 1
	}
	else {
		picload_ exedir + "graphic\\face1.bmp", 1
		ex_userface = 0
	}
	buffer BUFFER_PIC, 1440, 1080
	color 0, 0, 0
	boxf
	repeat 128
		s = exedir + "user\\graphic\\face" + (cnt + 1) + ".bmp"
		exist s
		if ( strsize != (-1) ) {
			pos cnt \ 16 * 80, cnt / 16 * 112
			picload_ s, 1
		}
	loop
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_mirror.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1
	if ( cc != CHARA_PLAYER ) {
		if ( cId(cc) != CREATURE_ID_USER ) {
			if ( cPic(cc) \ 1000 <= 660 ) {
				cUNID(cc) = cPic(cc)
			}
		}
	}

*label_2918
	listmax = 0
	if ( page == 0 ) {
		if ( jp ) {
			s = "決定    ", "肖像　　", "髪　　　", "副髪　　", "髪の色　", "体　　　", "服　　　", "ﾊﾟﾝﾂ　　", "詳細設定"
		}
		if ( en ) {
			s = "Done    ", "Portrait", "Hair    ", "Sub Hair", "Hair CL ", "Body    ", "Cloth   ", "Pants   ", "Set Detail"
		}
		if ( cc != CHARA_PLAYER ) {
			s(9) = lang("ｶｽﾀﾑｷｬﾗ ", "Custom  ")
			s(10) = lang("ｷｬﾗﾁｯﾌﾟ ", "Chara chip  ")
			s(11) = lang("乗馬時　", "Riding  ")
		}
		else {
			s(9) = lang("乗馬時　", "Riding  ")
		}
		p = 9 + (cc != CHARA_PLAYER) * 2
		if ( cc == CHARA_PLAYER ) {
			if ( gRider != 0 ) {
				p++
			}
		}
		else {
			if ( ocPetRidingIdx(cc) != 0 ) {
				p++
			}
		}
	}
	else {
		if ( jp ) {
			s = "体の色　", "服の色　", "ﾊﾟﾝﾂの色", "ｱｸｾｻﾘ1　", "ｱｸｾｻﾘ2　", "ｱｸｾｻﾘ3　", "目　　　", "基本設定"
		}
		if ( en ) {
			s = "Body CL ", "Cloth CL", "Pants CL", "Etc1    ", "Etc2    ", "Etc3    ", "Eyes    ", "Set Basic"
		}
		p = 8
	}
	repeat p
		list(0, cnt) = cnt
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop

*label_2921
	if ( rtval(1) == 0 ) {
		dirlist oom_pccn, "graphic\\pcc_" + rtvaln + "*.bmp"
		notesel oom_pccn
		strrep oom_pccn, ".bmp", ""
		dim oom_pcc
		repeat noteinfo(0)
			noteget pcctmp, cnt
			split pcctmp, "_", pcctmp2
			oom_pcc(cnt) = int(pcctmp2(2))
		loop
		sortval oom_pcc, 0
	}
	redraw 0
	pagesize = 0
	s = lang("肖像の変更", "Appearance"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 380) / 2 + inf_screenx, winposy(340) - 12, 380, 374
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	pos wx + ww - 40, wy
	gcopy BUFFER_INF, 960, 96, 48, 120
	i++
	if ( i \ 100 < 45 ) {
		f = i \ 16
	}
	else {
		f++
	}
	window2 wx + 234, wy + 71, 88, 120, 1, 1
	if ( cs == 1 & page == 0 ) {
		if ( cPortrait(cc) >= 0 ) {
			p = cSex(cc) * 64 + cPortrait(cc)
			pos wx + 238, wy + 75
			exist exedir + "user\\graphic\\user_npcface" + p + ".bmp"
			if ( strsize != (-1) ) {
				gsel 32
				pos 0, 0
				picload_ exedir + "user\\graphic\\user_npcface" + p + ".bmp", 1
				gsel BUFFER_SCREEN
				pos wx + 238, wy + 75
				gzoom 80, 112, 32, 0, 0, 80, 112
			}
			else {
				if ( ex_userface == 1 ) {
					gzoom 80, 112, 4, p \ 16 * 80, p / 16 * 112, 80, 112
				}
				else {
					gzoom 80, 112, 4, p \ 16 * 48, p / 16 * 72, 48, 72
				}
			}
		}
		else {
			if ( cPortrait(cc) != (-1) ) {
				pos wx + 238, wy + 75
				gzoom 80, 112, 7, abs(cPortrait(cc) + 2) \ 16 * 80, abs(cPortrait(cc) + 2) / 16 * 112, 80, 112
			}
			else {
				if ( cId(cc) == CREATURE_ID_USER ) {
					if ( userdata2(0, cUNID(cc)) ) {
						pos wx + 238, wy + 75
						gzoom 80, 112, 100, cUNID(cc) \ 16 * 80, cUNID(cc) / 16 * 112, 80, 112
					}
				}
			}
		}
	}
	else {
		if ( cbit(CHARA_BIT_PCC, cc) == TRUE ) {
			pos wx + 280, wy + 130
			gmode 2, 32, 48
			grotate 10 + cc, f / 4 \ 4 * 32, f / 16 \ 4 * 48, 0, 48, 80
		}
		else {
			transmissivity = 0
			if ( cId(cc) == CREATURE_ID_USER ) {
				if ( userdata2(1, cUNID(cc)) ) {
					transmissivity = userdata2(1, cUNID(cc))
				}
			}
			if ( ocChipTransparency(cc) ) {
				transmissivity = ocChipTransparency(cc)
			}
			i = getcharapic(cc)
			chara_preparepic i, getcharacolor(cc)
			pos wx + 280, wy + 130
			gmode 4, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i), 256 - transmissivity
			color 0, 0, 0
			grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i)
		}
	}
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if ( p >= listmax ) {
			break
		}
		val = cnt, 0
		gosub *portrait_item
		s = listn(0, p)
		if ( rtval >= 0 ) {
			if ( rtval(2) >= 0 ) {
				s += " " + rtval(2)
			}
			else {
				if ( rtval(2) == (-1) ) {
					s += " N/A"
				}
				else {
					s += " u" + (abs(rtval(2)) - 1)
				}
			}
		}
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
		if ( rtval != (-2) ) {
			pos wx + 30, wy + 66 + cnt * 21 - 5
			gcopy BUFFER_INF, 312, 336, 24, 24
			pos wx + 175, wy + 66 + cnt * 21 - 5
			gcopy BUFFER_INF, 336, 336, 24, 24
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	val = cs, 0
	gosub *portrait_item
	p = 0
	if ( rtval == (-2) ) {
		if ( key == key_enter ) {
			create_pcpic cc, 1
			return 1
		}
		if ( key == key_pageup | key == key_pagedown ) {
			key = ""
		}
	}
	else {
		if ( key == key_enter ) {
			key = key_pageup
		}
	}
	if ( rtval == (-1) ) {
		if ( key == key_pageup | key == key_pagedown ) {
			snd SOUNDLIST_CURSOR1
			if ( page == 0 ) {
				page = 1
			}
			else {
				page = 0
				cs = 8
			}
			goto *label_2918
		}
	}
	if ( key == key_pageup ) {
		snd SOUNDLIST_CURSOR1
		if ( rtval == 100 ) {
			if ( cPortrait(cc) < 46 - 1 ) {
				cPortrait(cc)++
			}
			goto *label_2926
		}
		if ( rtval == 101 ) {
			cbitmod CHARA_BIT_PCC, cc, TRUE
			goto *label_2926
		}
		if ( rtval == 102 ) {
			if ( cPic(cc) \ 1000 != 824 ) {
				if ( cPic(cc) \ 1000 <= 660 | cPic(cc) \ 1000 >= 825 ) {
					cPic(cc) = xy2pic(1, 20)
				}
				else {
					cPic(cc)++
				}
			}
			goto *label_2926
		}
		if ( rtval(1) == 0 ) {
			if ( cfg_pcc == 0 ) {
				exist exedir + "\\graphic\\pcc_" + rtvaln + "_" + (pcc(rtval, cc) \ 1000 + 1) + ".bmp"
				if ( strsize != (-1) ) {
					pcc(rtval, cc)++
					p = 1
				}
			}
			else {
				if ( cfg_pcc == 1 ) {
					if ( pcc(rtval, cc) \ 1000 < 999 ) {
						pcc(rtval, cc)++
						p = 1
					}
				}
			}
		}
		else {
			if ( pcc(rtval, cc) / 1000 < 21 ) {
				pcc(rtval, cc) += 1000
				p = 1
			}
		}
	}
	if ( key == key_pagedown ) {
		snd SOUNDLIST_CURSOR1
		if ( rtval == 100 ) {
			if ( cPortrait(cc) > (-129) ) {
				cPortrait(cc)--
			}
			goto *label_2926
		}
		if ( rtval == 101 ) {
			cbitmod CHARA_BIT_PCC, cc, FALSE
			goto *label_2926
		}
		if ( rtval == 102 ) {
			if ( cPic(cc) \ 1000 > 660 & cPic(cc) \ 1000 < 825 ) {
				cPic(cc)--
				if ( cPic(cc) \ 1000 <= 660 ) {
					cPic(cc) = (cId(cc) == CREATURE_ID_USER) * 825 + cUNID(cc)
				}
			}
			goto *label_2926
		}
		if ( rtval(1) == 0 ) {
			if ( cfg_pcc == 0 ) {
				exist exedir + "\\graphic\\pcc_" + rtvaln + "_" + (pcc(rtval, cc) \ 1000 - 1) + ".bmp"
				if ( pcc(rtval, cc) \ 1000 == 1 & rtval != 15 | strsize != (-1) ) {
					pcc(rtval, cc)--
					p = 1
				}
			}
			else {
				if ( cfg_pcc == 1 ) {
					if ( pcc(rtval, cc) \ 1000 > 1 * (rtval == 15) ) {
						pcc(rtval, cc)--
						p = 1
					}
				}
			}
		}
		else {
			if ( pcc(rtval, cc) / 1000 > 0 ) {
				pcc(rtval, cc) -= 1000
				p = 1
			}
		}
	}
	if ( key == key_southeast | key == key_next ) {
		if ( rtval > 0 & rtval < 100 & rtval(1) == 0 ) {
			if ( cfg_pcc == 1 ) {
				snd SOUNDLIST_CURSOR1
				repeat 10
					if ( pcc(rtval, cc) \ 1000 < 999 ) {
						pcc(rtval, cc)++
					}
					else {
						break
					}
				loop
			}
		}
		if ( rtval == 102 ) {
			if ( cPic(cc) \ 1000 <= 660 | cPic(cc) \ 1000 >= 825 ) {
				cPic(cc) = xy2pic(1, 20)
				cPic(cc) += 9
			}
			else {
				cPic(cc) += 10
			}
			if ( cPic(cc) \ 1000 >= 825 ) {
				cPic(cc) = xy2pic(32, 24)
			}
		}
	}
	if ( key == key_southwest | key == key_prev ) {
		if ( rtval > 0 & rtval < 100 & rtval(1) == 0 ) {
			if ( cfg_pcc == 1 ) {
				snd SOUNDLIST_CURSOR1
				repeat 10
					if ( pcc(rtval, cc) \ 1000 > 1 * (rtval == 15) ) {
						pcc(rtval, cc)--
					}
					else {
						break
					}
				loop
			}
		}
		if ( rtval == 102 ) {
			if ( cPic(cc) \ 1000 > 660 & cPic(cc) \ 1000 < 825 ) {
				cPic(cc) -= 10
				if ( cPic(cc) \ 1000 <= 660 ) {
					cPic(cc) = (cId(cc) == CREATURE_ID_USER) * 825 + cUNID(cc)
				}
			}
		}
	}
	create_pcpic cc, 0
	if ( key == key_cancel ) {
		create_pcpic cc, 1
		return 0
	}
	if ( mode == MODELIST_CHARA_CREATION ) {
		getkey p, 112
		if ( p ) {
			return -1
		}
	}

*label_2926
	goto *label_2921
	repeat -1
		repeat length(oom_pcc)
			if ( pcc_count == oom_pcc(cnt) ) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + pcc_count
				p = 1
				break
			}
		loop
		if ( p == 1 | pcc_count > oom_pcc(length(oom_pcc) - 1) ) {
			if ( pcc_count > oom_pcc(length(oom_pcc) - 1) ) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + oom_pcc(length(oom_pcc) - 1)
			}
			break
		}
		pcc_count++
	loop
	return
	repeat -1
		repeat length(oom_pcc)
			if ( pcc_count == oom_pcc(cnt) ) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + pcc_count
				p = 1
				break
			}
		loop
		if ( p == 1 | pcc_count < oom_pcc(0) ) {
			if ( pcc_count < oom_pcc(0) ) {
				pcc(rtval, cc) = pcc(rtval, cc) / 1000 * 1000 + 1 * (rtval == 15)
			}
			break
		}
		pcc_count--
	loop
	return

*com_mirror
	create_pcpic cc, 1
	snd SOUNDLIST_POP2
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	windowshadow = 1
	listmax = 0
	if ( jp ) {
		s = "決定    ", "胸部鎧　", "脚部鎧　", "ベルト　", "ｸﾞﾛｰﾌﾞ　", "マント　"
	}
	if ( en ) {
		s = "Done    ", "Chest   ", "Leg     ", "Belt    ", "Glove   ", "Mantle  "
	}
	p = 6
	repeat p
		list(0, cnt) = cnt
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop

*com_mirror_loop_WHILE1
	redraw 0
	pagesize = 0
	s = lang("装備表示の変更", "Parts to hide"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 360) / 2 + inf_screenx, winposy(289) - 12, 360, 289
	s = lang("項目", "Part")
	pagesize = listmax
	display_topic s, wx + 34, wy + 36
	i++
	if ( i \ 100 < 45 ) {
		f = i \ 16
	}
	else {
		f++
	}
	window2 wx + 234, wy + 60, 88, 120, 1, 1
	pos wx + 280, wy + 120
	gmode 2, 32, 48
	grotate 10 + cc, f / 4 \ 4 * 32, f / 16 \ 4 * 48, 0, 48, 80
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if ( p >= listmax ) {
			break
		}
		s = listn(0, p)
		if ( cnt != 0 ) {
			if ( pcc(20 + cnt - 1, cc) == 0 ) {
				s += "On"
			}
			else {
				s += "Off"
			}
			pos wx + 30, wy + 66 + cnt * 21 - 5
			gcopy BUFFER_INF, 312, 336, 24, 24
			pos wx + 175, wy + 66 + cnt * 21 - 5
			gcopy BUFFER_INF, 336, 336, 24, 24
		}
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if ( cs != 0 ) {
		if ( key == key_enter ) {
			key = key_pageup
		}
		if ( key == key_pageup | key == key_pagedown ) {
			if ( pcc(20 + cs - 1, cc) == 0 ) {
				pcc(20 + cs - 1, cc) = 1
			}
			else {
				pcc(20 + cs - 1, cc) = 0
			}
			create_pcpic cc, 1
			snd SOUNDLIST_CURSOR1
		}
	}
	if ( cs == 0 & key == key_enter | key == key_cancel ) {
		snd SOUNDLIST_OK1
		create_pcpic cc, 1
		return 1
	}
	goto *com_mirror_loop_WHILE1

*com_calcAttack
	maxdmg = 0
	maxhit = 0
	p(1) = 0, 0
	attackskill = SKILL_WEAPON_MARTIAL_ARTS
	ammo = -1
	attacknum = 0
	cw = 0
	repeat 30
		body = 100 + cnt
		if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 10 ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 11 ) {
			continue
		}
		attackrange = 0
		ammo = -1
		cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
		if ( iDice1(cw) > 0 ) {
			if ( iequiploc(cw) == 10 ) {
				gosub *label_4654
				gosub *label_3031
			}
			else {
				attackskill = iSkillRef(cw)
			}
			p(1)++
			if ( cfg_nc_charasheet ) {
				s(1) = lang("利武器", "Melee")
			}
			else {
				s(1) = lang("武器", "Melee") + p(1)
			}
			attacknum++
			if ( cfg_nc_charasheet == 0 | p(1) == 1 ) {
				gosub *com_skill_calcAttack
			}
			else {
				hit = calcattackhit(1)
				dmg = calcattackdmg(1)
			}
			if ( iequiploc(cw) != 10 ) {
				maxdmg += dmgmulti * (dice1 * dice2 + dmgfix)
			}
		}
	loop
	if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
		s(1) = lang("格闘", "Unarmed")
		gosub *com_skill_calcAttack
		maxdmg += dmgmulti * (dice1 * dice2 + dmgfix)
	}
	attacknum = 0
	gosub *label_3030
	if ( stat == 1 ) {
		s(1) = lang("射撃", "Dist")
		gosub *com_skill_calcAttack
	}
	if ( cfg_nc_charasheet == 1 ) {
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
		color 20, 10, 0
		pos wx + 417, wy + 301 + (p(2) + 1) * 15
		mes lang("最大", "Max")
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 460 + en * 8, wy + 299 + (p(2) + 1) * 15
		s = "" + maxdmg + " dmg"
		mes s
	}
	return

*com_skill_calcAttack
	tc = cc
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	color 20, 10, 0
	if ( val == 0 ) {
		if ( cfg_nc_charasheet ) {
			pos wx + 590, wy + 301 + p(2) * 15
			mes lang("命中", "Hit")
			pos wx + 417, wy + 301 + p(2) * 15
			mes s(1)
		}
		else {
			pos wx + 590, wy + 281 + p(2) * 16
			mes lang("命中", "Hit")
			pos wx + 417, wy + 281 + p(2) * 16
			mes s(1)
		}
	}
	attackrange = 0
	if ( refitem(iID(cw), DBSPEC_TYPE, cw) == FILTER_RANGE ) {
		attackrange = 1
	}
	attackvar = 0
	hit = calcattackhit(1)
	dmg = calcattackdmg(1)
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	if ( dmgmulti >= 10000000 & cfg_nc_stateshorten ) {
		s(2) = "" + dmgmulti / 1000000 + "M"
	}
	else {
		if ( dmgmulti >= 10000 & cfg_nc_stateshorten ) {
			s(2) = "" + dmgmulti / 1000 + "K"
		}
		else {
			s(2) = "" + dmgmulti + "  "
		}
	}
	if ( tohit >= 10000000 & cfg_nc_stateshorten ) {
		s = "" + tohit / 1000000 + "M%"
	}
	else {
		if ( tohit >= 10000 & cfg_nc_stateshorten ) {
			s = "" + tohit / 1000 + "K%"
		}
		else {
			s = "" + tohit + "%"
		}
	}
	if ( val == 0 ) {
		if ( cfg_nc_charasheet ) {
			pos wx + 625 - en * 8, wy + 299 + p(2) * 15
			mes s
		}
		else {
			pos wx + 625 - en * 8, wy + 279 + p(2) * 16
			mes s
		}
	}
	else {
		s(3) = s
	}
	s = "" + dice1 + "d" + dice2 + cnvfix(dmgfix) + " x" + strmid(s(2), 0, 4 + (int(s(2)) >= 10) + (int(s(2)) >= 100) + (int(s(2)) >= 1000) + (int(s(2)) >= 10000)) + strmid(s(2), -1, 1)
	if ( val == 0 ) {
		if ( cfg_nc_charasheet ) {
			pos wx + 460 + en * 8, wy + 299 + p(2) * 15
			mes s
		}
		else {
			pos wx + 460 + en * 8, wy + 279 + p(2) * 16
			mes s
		}
	}
	else {
		noteadd s(1) + "   : " + fixtxt(s(3), 12) + " " + fixtxt(s, 20)
	}
	p(2)++
	return

*show_weaponStat
	attacknum = 0
	repeat 30
		body = 100 + cnt
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS != 5 ) {
			continue
		}
		if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
		if ( iDice1(cw) == 0 ) {
			continue
		}
		attacknum++
		if ( iequiploc(cw) == 10 ) {
			continue
		}
		if ( cAttackStyle(cc) & 2 ) {
			if ( iWeight(cw) >= 4000 ) {
				txt -1, lang("装備中の" + itemname(cw) + "は両手にしっくりとおさまる。", itemname(cw) + " fits well for two-hand fighting style.")
			}
			else {
				if ( gettrait(cc, 68) > 0 ) {
					if ( iWeight(cw) <= 1500 ) {
						txt -1, lang("装備中の" + itemname(cw) + "は体術と併用するのに適している。", itemname(cw) + " is too light for two-hand fighting style.")
					}
					else {
						txt -1, lang("装備中の" + itemname(cw) + "は体術と併用するには重すぎる。", itemname(cw) + " is too light for two-hand fighting style.")
					}
				}
				else {
					txt -1, lang("装備中の" + itemname(cw) + "は両手持ちにはやや軽すぎる。", itemname(cw) + " is too light for two-hand fighting style.")
				}
			}
		}
		if ( cAttackStyle(cc) & 4 ) {
			if ( attacknum == 1 ) {
				if ( iWeight(cw) >= 4000 ) {
					txt -1, lang("装備中の" + itemname(cw) + "は利手で扱うにも重すぎる。", itemname(cw) + " is too heavy for two-wield fighting style.")
				}
			}
			else {
				if ( iWeight(cw) > 1500 + gettrait(cc, 19) * 500 ) {
					txt -1, lang("装備中の" + itemname(cw) + "は片手で扱うには重すぎる。", itemname(cw) + " is too heavy for two-wield fighting style.")
				}
			}
		}
	loop
	if ( cc == CHARA_PLAYER ) {
		if ( gRider != 0 ) {
			if ( iWeight(cw) >= 4000 ) {
				txt -1, lang("装備中の" + itemname(cw) + "は乗馬中に扱うには重過ぎる。", itemname(cw) + " is too heavy to use when riding.")
			}
		}
	}
	return

*label_2943
	cc = CHARA_PLAYER

*com_wear
	procid = (procid + 1) \ 10
	proclist(procid) = "com_wear" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	page = 0
	pagesize = 14
	listmax = 0
	cs = 0
	cs_bk = -1
	page_load
	page_load2
	curmenu = 1
	mainhand = 0
	repeat 30, 100
		if ( cdata(cnt, cc) != 0 ) {
			if ( cc == CHARA_PLAYER ) {
				if ( gettrait(0, 206) != 0 ) {
					if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 2 ) {
						continue
					}
				}
				if ( gettrait(0, 203) != 0 ) {
					if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 9 ) {
						continue
					}
				}
				if ( gettrait(0, 205) != 0 ) {
					if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 3 ) {
						continue
					}
				}
				if ( gettrait(0, 217) != 0 ) {
					if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 1 ) {
						continue
					}
					if ( gettrait(0, 217) == (-2) ) {
						if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 8 ) {
							continue
						}
					}
				}
				if ( gettrait(0, 218) != 0 ) {
					if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 5 ) {
						continue
					}
				}
			}
			if ( mainhand == 0 ) {
				if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 5 ) {
					mainhand = cnt
				}
			}
			list(0, listmax) = cnt, cdata(cnt, cc) / EXT_EQUIP_SLOTS
			listmax++
		}
	loop
	gosub *sort_list
	redraw 0
	drawmenu
	ww = 690
	wh = 380
	wx = (windoww - 690) / 2 + inf_screenx
	wy = winposy(380)
	if ( nowindowanime == 0 ) {
		snd SOUNDLIST_WEAR
	}
	windowanime wx, wy, ww, wh, 10, 4
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_wear.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1

*com_wear_loop_pgchk
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_wear_loop
	redraw 0
	s = lang("装備品", "Equipment")
	s(1) = strhint5 + strhint5b + strhint3
	s(1) += "\n" + oom_strhint7 + oom_strhint5 + oom_strhint6
	if ( cc != CHARA_PLAYER ) {
		s = lang(name(cc) + "の" + s, s + " of " + name(cc))
	}
	display_window (windoww - 690) / 2 + inf_screenx, winposy(428), 690, 428, 64
	display_topic lang("部位/装備品名称", "Category/Name"), wx + 28, wy + 30
	if ( showresist == 0 ) {
		display_topic lang("重さ", "Weight"), wx + 524, wy + 30
	}
	pos wx + 46, wy - 16
	gcopy BUFFER_INF, 288 + 10 * 48, 48, 48, 48
	pos wx + ww - 106, wy
	gcopy BUFFER_INF, 960, 96, 96, 120
	pos wx, wy + wh - 164
	gcopy BUFFER_INF, 960, 216, 72, 144
	if ( showresist ) {
		if ( cfg_equipex == 1 ) {
			if ( equipfilter >= 0 & showressub == 2 ) {
				showressub = 0
			}
			pos wx + 260 + (showressub == 0) * 60, wy + 40
			if ( showressub == 0 ) {
				color 0, 0, 0
				repeat length(_resiststr0)
					pos wx + 320 + cnt * 20, wy + 40
					mes _resiststr0(cnt)
				loop
			}
			if ( showressub == 1 ) {
				color 0, 0, 0
				repeat length(_resiststr1)
					pos wx + 260 + cnt * 20, wy + 40
					mes _resiststr1(cnt)
				loop
			}
			if ( showressub == 2 ) {
				color 0, 0, 0
				mes ""
			}
			if ( showressub == 3 ) {
				color 0, 0, 0
				pos wx + 260, wy + 40
				mes lang("熱", "Fi")
				pos wx + 280, wy + 40
				mes lang("酸", "Ac")
				pos wx + 300, wy + 40
				mes lang("浮", "Fl")
				pos wx + 320, wy + 40
				mes lang("寄", "Pa")
				pos wx + 340, wy + 40
				mes lang("腐", "Ro")
				pos wx + 360, wy + 40
				mes lang("電", "Ra")
			}
		}
		else {
			pos wx + 320, wy + 40
			color 0, 0, 0
			mes lang("火 冷 雷 闇 幻 毒 獄 音 神 沌 魔", "Fi Co Li Da Mi Po Nt So Nr Ch Ma")
		}
	}
	display_note lang("装備重量: ", "Equip weight: ") + cnvweight(cEqWeight(cc)) + cnveqweight(cc) + lang(" 命中修正:", " Hit Bonus:") + cATK(cc) + lang(" ダメージ修正:", " Damage Bonus:") + cDMG(cc) + "  DV/PV:" + cDV(cc) + "/" + cPV(cc)
	color 0, 0, 0
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	gmode 2
	keyrange = 0
	f = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 100, wy + 60 + cnt * 19
			gfini 558, 18
			gfdec 12, 14, 16
		}
		q = bodyn(list(1, p))
		if ( list(0, p) == mainhand ) {
			q = lang("利手", "Hand*")
		}
		pos wx + 22, wy + 60 + cnt * 19 - 4
		gcopy BUFFER_INF, 600 + (list(1, p) - 1) * 24, 336, 24, 24
		pos wx + 46, wy + 60 + cnt * 19 + 3
		mes q
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		display_key wx + 88, wy + 60 + cnt * 19 - 2, cnt
		p(1) = cdata(list(0, p), cc)
		s = "-    ", "-"
		if ( p(1) \ 10000 != 0 ) {
			p(1) = p(1) \ 10000 - 1
			s = itemname(p(1)), cnvweight(iWeight(p(1)))
			if ( cfg_useffhp ) {
				preparepicitemex p(1)
				p(2) = stat
			}
			else {
				p(2) = iPic(p(1))
				gsel BUFFER_ITEM
				color 0
				boxf 0, 960, chipi(CHIPI_WIDTH, p(2)), chipi(CHIPI_HEIGHT, p(2)) + 960
				if ( p(2) == 528 ) {
					gmode 2
					pos 0, 960
					gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
					pos 0, 1008
					gzoom 22, 20, 5, chipc(CHIPC_X, iCol(p(1))) + 8, chipc(CHIPC_Y, iCol(p(1))) + 4 + (chipc(CHIPC_HEIGHT, iCol(p(1))) > inf_tiles) * 8, chipc(CHIPC_WIDTH, iCol(p(1))) - 16, chipc(CHIPC_HEIGHT, iCol(p(1))) - 8 - (chipc(CHIPC_HEIGHT, iCol(p(1))) > inf_tiles) * 10, 1
					pos 6, 974
					gcopy BUFFER_ITEM, 0, 1008, 22, 20
					gsel selcur
				}
				else {
					if ( p(2) == 531 ) {
						pos 8, 1058 - chipc(CHIPC_HEIGHT, iCol(p(1)))
						gcopy BUFFER_CHR, chipc(CHIPC_X, iCol(p(1))) + 8, chipc(CHIPC_Y, iCol(p(1))) + 2, chipc(CHIPC_WIDTH, iCol(p(1))) - 16, chipc(CHIPC_HEIGHT, iCol(p(1))) - 8
						gmode 4, , , 150
						color 0, 0, 0
						pos 0, 960 + (chipc(CHIPC_HEIGHT, iCol(p(1))) == inf_tiles) * 48
						gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, iCol(p(1))) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, iCol(p(1))) + (chipc(CHIPC_HEIGHT, iCol(p(1))) > inf_tiles) * 48
						gmode 2
						gsel selcur
					}
					else {
						if ( p(2) == 529 ) {
							pos 0, 1056 - chipc(CHIPC_HEIGHT, iCol(p(1)))
							gcopy BUFFER_CHR, chipc(CHIPC_X, iCol(p(1))), chipc(CHIPC_Y, iCol(p(1))), chipc(CHIPC_WIDTH, iCol(p(1))), chipc(CHIPC_HEIGHT, iCol(p(1)))
							gmode 2
							gsel selcur
						}
						else {
							pos 0, 960
							gcopy BUFFER_ITEM, chipi(CHIPI_X, p(2)), chipi(CHIPI_Y, p(2)), chipi(CHIPI_WIDTH, p(2)), chipi(CHIPI_HEIGHT, p(2))
							gfini chipi(CHIPI_WIDTH, p(2)), chipi(CHIPI_HEIGHT, p(2))
							gfdec2 c_col(0, iCol(p(1))), c_col(1, iCol(p(1))), c_col(2, iCol(p(1)))
							gsel selcur
						}
					}
				}
			}
			pos wx + 126, wy + 70 + cnt * 19
			gmode 2, inf_tiles, inf_tiles
			grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, p(2)), chipi(CHIPI_HEIGHT, p(2))
			if ( showresist ) {
				if ( cfg_equipex == 1 ) {
					equipinfo p(1), wx + 260 + (showressub == 0) * 60, wy + 60 + cnt * 19 + 2
					s = strmid(s, 0, 10 + (showressub == 0) * 12)
				}
				else {
					equipinfo p(1), wx + 320, wy + 60 + cnt * 19 + 2
					s = strmid(s, 0, 22)
				}
			}
		}
		else {
			p(1) = -1
		}
		cs_list s, wx + 140 - 26, wy + 60 + cnt * 19 - 1, 19, 30, p(1) != (-1), p(1)
		pos wx + 640 - strlen(s(1)) * 7, wy + 60 + cnt * 19 + 2
		mes s(1)
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		page_save2
		body = p
		if ( cdata(body, cc) \ EXT_EQUIP_SLOTS != 0 ) {
			gEquipChange = 1
			ci = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
			if ( iStatus(ci) == ITEM_STATUS_CURSED | iStatus(ci) == ITEM_STATUS_DOOMED ) {
				txt -1, lang(itemname(ci) + "は外せない。", "" + itemname(ci) + " can't be taken off.")
				goto *com_wear_loop_pgchk
			}
			r1 = cc
			gosub *label_3591
			r1 = cc
			gosub *charaRefresh
			snd SOUNDLIST_EQUIP1
			txtnew
			txt -1, lang(itemname(ci) + "を外した。", "You unequip " + itemname(ci) + ".")
			if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 5 ) {
				gosub *show_weaponStat
			}
			redraw 0
			gosub *screen_drawStatus
			goto *com_wear_loop_pgchk
		}
		nowindowanime = 1
		menucycle = 0
		if ( cc == CHARA_PLAYER ) {
			invctrl = INVCTRL_EQUIP, 0
		}
		else {
			invctrl = INVCTRL_EQUIP, 1
		}
		snd SOUNDLIST_INV
		goto *com_inventory
	}
	if ( key == key_identify ) {
		p = list(0, pagesize * page + cs)
		if ( cdata(p, cc) \ EXT_EQUIP_SLOTS != 0 ) {
			ci = cdata(p, cc) \ EXT_EQUIP_SLOTS - 1
			listmax_bk = listmax
			pagesize_bk = pagesize
			pagemax_bk = pagemax
			listnumber = pagesize * page + cs
			fromequip = 1
			gosub *com_inventory_loop_WEND1
			nowindowanime = 1
			returnfromidentify = 0
			screenupdate = -1
			gosub *screen_draw
			goto *com_wear
		}
	}
	if ( key == key_mode ) {
		if ( showresist == 1 ) {
			showresist = 0
		}
		else {
			showresist = 1
		}
		snd SOUNDLIST_POP1
		goto *com_wear_loop_pgchk
	}
	if ( cfg_equipex == 1 ) {
		if ( showresist == 1 ) {
			if ( key == key_msglog ) {
				showressub++
				if ( equipfilter < 0 ) {
					if ( showressub > 3 ) {
						showressub = 0
					}
				}
				else {
					if ( showressub > 3 ) {
						showressub = 0
					}
					if ( showressub > 1 ) {
						showressub = 3
					}
				}
				snd SOUNDLIST_POP1
				goto *com_wear_loop_pgchk
			}
		}
	}
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 3 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 3
				}
			}
			if ( p != curmenu ) {
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					csctrl = 0
					goto *label_2879
				}
				if ( curmenu == 1 ) {
					goto *com_wear
				}
				if ( curmenu == 2 ) {
					goto *com_trait
				}
				if ( curmenu == 3 ) {
					goto *com_material
				}
			}
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_wear_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_wear_loop_pgchk
		}
	}
	if ( showresist == 0 & cc == CHARA_PLAYER ) {
		if ( key == key_mode2 ) {
			invctrl = 101
			gosub *label_4938
			menucycle = 0
			screenupdate = -1
			gosub *screen_draw
			goto *label_2943
		}
		if ( key == key_msglog ) {
			invctrl = 102
			gosub *label_4938
			menucycle = 0
			create_pcpic cc, 1
			screenupdate = -1
			gosub *screen_draw
			goto *label_2943
		}
		if ( key == key_drink ) {
			auto_equip = 1
			gosub *label_4915
			auto_equip = 0
			value = stat
			if ( value > 0 ) {
				var_skill = value \ 10000
				cc = CHARA_PLAYER
				gosub *label_4946
				listmax = 0
				inv_getheader 0
				repeat invrange, invhead
					if ( iNum(cnt) == 0 ) {
						continue
					}
					if ( iequiploc(cnt) == 0 ) {
						continue
					}
					if ( iStatus(cnt) < ITEM_STATUS_NORMAL ) {
						continue
					}
					if ( iKnown(cnt) < ITEM_KNOWN_FULL ) {
						continue
					}
					value = cnt
					f = 0
					repeat 15
						enc_id = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, value) / 10000
						if ( enc_id != 3 ) {
							continue
						}
						enc_id = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, value) \ 10000
						enc_pow = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, value)
						if ( enc_id == var_skill & enc_pow / 50 + 1 > 0 ) {
							f = 1
							break
						}
					loop
					if ( f ) {
						list(0, listmax) = cnt
						listmax++
					}
				loop
				repeat 30
					if ( cdata(129 - cnt, cc) == 0 ) {
						continue
					}
					if ( gettrait(cc, 206) != 0 ) {
						if ( cdata(129 - cnt, cc) / EXT_EQUIP_SLOTS == 2 ) {
							continue
						}
					}
					if ( gettrait(cc, 203) != 0 ) {
						if ( cdata(129 - cnt, cc) / EXT_EQUIP_SLOTS == 9 ) {
							continue
						}
					}
					if ( gettrait(cc, 205) != 0 ) {
						if ( cdata(129 - cnt, cc) / EXT_EQUIP_SLOTS == 3 ) {
							continue
						}
					}
					if ( gettrait(cc, 217) != 0 ) {
						if ( cdata(129 - cnt, cc) / EXT_EQUIP_SLOTS == 1 ) {
							continue
						}
					}
					if ( gettrait(cc, 217) == (-2) ) {
						if ( cdata(129 - cnt, cc) / EXT_EQUIP_SLOTS == 8 ) {
							continue
						}
					}
					if ( gettrait(cc, 218) != 0 ) {
						if ( cdata(129 - cnt, cc) / EXT_EQUIP_SLOTS == 5 ) {
							continue
						}
					}
					if ( cdata(129 - cnt, cc) \ EXT_EQUIP_SLOTS != 0 ) {
						continue
					}
					body = cdata(129 - cnt, cc) / EXT_EQUIP_SLOTS
					now_inv = -1
					now_pow = 0
					repeat listmax
						p = list(0, cnt)
						if ( funciscanequip(p, body) == 0 ) {
							continue
						}
						if ( iEquip(p) != 0 ) {
							continue
						}
						value = p
						repeat 15
							enc_id = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, value) / 10000
							if ( enc_id != 3 ) {
								continue
							}
							enc_id = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, value) \ 10000
							enc_pow = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, value)
							if ( enc_id == var_skill & (now_inv == (-1) | enc_pow > now_pow) ) {
								now_inv = value
								now_pow = enc_pow
								break
							}
						loop
					loop
					if ( now_inv != (-1) ) {
						body = 129 - cnt
						r1 = cc
						ci = now_inv
						gosub *label_3590
					}
				loop
				r1 = cc
				snd SOUNDLIST_EQUIP1
				gosub *charaRefresh
				gosub *show_weaponStat
				create_pcpic cc, 1
				txtef COLOR_DEFAULT
				txt_select -1, lang("" + skillname(var_skill) + "重視の装備に変更した。", "You changed your equipments to the emphasis on skill of " + skillname(var_skill) + "."), "", "", "", "", "", "", "", ""
				locvar_randskill_tcol = 255, 255, 255
			}
			menucycle = 0
			screenupdate = -1
			gosub *screen_draw
			goto *label_2943
		}
		if ( key == "sc" ) {
			slot_no = sc
			gosub *label_4948
			menucycle = 0
			create_pcpic cc, 1
			screenupdate = -1
			gosub *screen_draw
			goto *label_2943
		}
	}
	if ( key == key_cancel ) {
		menucycle = 0
		if ( cc < MAX_CHARA_FOLLOWER ) {
			create_pcpic cc, 1
		}
		if ( equipfilter != 0 ) {
			equipfilter = 0
		}
		if ( var_is_pet_wear ) {
			invctrl = INVCTRL_ALLYGET
			return
		}
		gosub *screen_draw
		cc = CHARA_PLAYER
		goto *pc_turn
	}
	goto *com_wear_loop

*com_get
	if ( mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) != 0 ) {
		if ( gArea  != AREA_SHOW_HOUSE | 0 ) {
			cell_itemoncell cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			if ( stat == 0 ) {
				cell_featread cX(CHARA_PLAYER), cY(CHARA_PLAYER)
				if ( featId == CELL_FEATURE_PLANTED_SEED ) {
					if ( gArea  != AREA_SHOW_HOUSE ) {
						if ( feat < tile_plant + 2 ) {
							txt -1, lang("芽を摘み取った。", "You nip a young plant.")
							mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0
							goto *label_4158
						}
						if ( feat == tile_plant + 3 ) {
							txt -1, lang("枯れた草を摘み取った。", "You nip a dead plant.")
							mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0
							goto *label_4158
						}
						if ( inv_getspace(CHARA_PLAYER) == 0 ) {
							txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
							gosub *screen_draw
							goto *pc_turn
						}
						gosub *item_seedPick
						if ( chipm(CHIPM_ROLE, mapId(cX(CHARA_PLAYER), cY(CHARA_PLAYER))) == MAP_CHIP_ROLE_CROP ) {
							val = 1
						}
						else {
							val = 0
						}
						gosub *item_seedRegrowth
						if ( featIdSub == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
							autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
							if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
								autosave = 0
							}
						}
						gosub *label_1681
						goto *label_4158
					}
				}
				if ( mType == MAP_TYPE_WORLD ) {
					if ( featId == CELL_FEATURE_NEFIA ) {
						if ( featIdSub + featParam1 * 100 >= 300 & featIdSub + featParam1 * 100 < 450 ) {
							txt -1, lang("本当にこの建物を撤去する？（注意！建物と中の物は完全に失われます）", "Really remove this building?")
							promptl(0, 0) = stryes, "y", "0"
							promptl(0, 1) = strno, "n", "1"
							promptmax = 2
							val = promptx, prompty, 160, 1
							gosub *prompt_key
							if ( rtval != 0 ) {
								gosub *screen_draw
								goto *pc_turn
							}
							area = featIdSub + featParam1 * 100
							if ( areaId(area) == AREA_DUNGEON ) {
								if ( ogDungeonEventFlag != 0 ) {
									txt -1, lang("ダンジョン内イベント進行中はダンジョンを撤去できない。", "Cannot remove dungeon while dungeon even is in progress.")
									gosub *screen_draw
									goto *pc_turn
								}
								repeat 26
									ogdata(cnt) = 0
								loop
							}
							mapFeat(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0
							areaId(area) = AREA_NONE
							removeworker area
							gosub *label_2358
							ctrlfile 13
							snd SOUNDLIST_BUILD1
							txt -1, lang("建物を撤去した。", "You remove the building.")
							goto *label_4158
						}
					}
				}
			}
		}
	}
	cell_itemoncell cX(CHARA_PLAYER), cY(CHARA_PLAYER)
	if ( stat == 0 ) {
		if ( mType == MAP_TYPE_TOWN | mType == MAP_TYPE_VILLAGE ) {
			if ( chipm(CHIPM_ROLE, mapId(cX(CHARA_PLAYER), cY(CHARA_PLAYER))) == MAP_CHIP_ROLE_SNOW ) {
				snd SOUNDLIST_FOOT2A
				txt -1, lang("雪をかきあつめた。", "You rake up a handful of snow.")
				actionsp CHARA_PLAYER, 10
				if ( stat == 0 ) {
					txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
					goto *label_4158
				}
				flt
				itemcreate CHARA_PLAYER, ITEM_ID_HANDFUL_SNOW, -1, -1, 0
				if ( stat != 0 ) {
					iStatus(ci) = ITEM_STATUS_NORMAL
					iKnown(ci) = ITEM_KNOWN_FULL
					item_stack CHARA_PLAYER, ci, 1
				}
				goto *label_4158
			}
		}
		msgdup++
		txt -1, lang("あなたは空気をつかんだ。", "You grasp at the air.")
		gosub *screen_draw
		goto *pc_turn
	}
	ci = rtval(1)
	if ( rtval > 1 ) {
		invctrl = INVCTRL_GET
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( iProperty(ci) > PROP_NONE & iProperty(ci) < PROP_CONSTRUCT | iProperty(ci) == PROP_SPECIAL ) {
		snd SOUNDLIST_FAIL1
		msgdup++
		if ( iProperty(ci) == PROP_SHOP ) {
			txt -1, lang("それは持ち運べない。", "You can't carry it.")
		}
		if ( iProperty(ci) == PROP_NPC | iProperty(ci) == PROP_SPECIAL ) {
			txt -1, lang("それはあなたの物ではない。", "It's not your property."), lang("盗むなんてとんでもない。", "You can't just take it."), lang("それは拾えない。", "It's not yours.")
		}
		gosub *screen_draw
		goto *pc_turn
	}
	if ( iNum(ci) > 1 & iID(ci) != ITEM_ID_GOLD_PIECE & cfg_picknumber ) {
		display_msg screenmsgy, 2
		val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
		inputlog = "" + iNum(ci)
		gosub *prompt_word
		in = int(inputlog)
		if ( in > iNum(ci) ) {
			in = iNum(ci)
		}
		if ( in == 0 | rtval == (-1) ) {
			gosub *screen_draw
			goto *pc_turn
		}
	}
	else {
		in = iNum(ci)
	}
	gosub *act_get
	if ( stat == 1 | stat == (-1) ) {
		goto *label_4158
	}
	else {
		gosub *screen_draw
		goto *pc_turn
	}

*com_allyInventory
	if ( cActionPeriod(tc) != 0 ) {
		txt -1, lang(name(tc) + "は忙しい。", name(tc) + " " + is(tc) + " busy now.")
		gosub *screen_draw
		goto *pc_turn
	}
	menucycle = 1
	invally = 1
	invctrl = INVCTRL_GIVE
	snd SOUNDLIST_INV
	goto *label_2974

*sort_list
	if ( listmax < 1 ) {
		return
	}
	repeat
		p = 0
		repeat listmax - 1
			if ( list(1, cnt) > list(1, cnt + 1) ) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				p = 1
			}
		loop
		if ( p == 0 ) {
			repeat listmax
				list_bk(0, cnt) = list(0, cnt)
			loop
			break
		}
	loop
	return

*sort_list2
	if ( listmax < 1 ) {
		return
	}
	repeat
		p = 0
		repeat listmax - 1
			if ( list(1, cnt) < list(1, cnt + 1) ) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				p = 1
			}
		loop
		if ( p == 0 ) {
			repeat listmax
				list_bk(0, cnt) = list(0, cnt)
			loop
			break
		}
	loop
	return

*label_2970
	if ( listmax < 1 ) {
		return
	}
	repeat
		p = 0
		repeat listmax - 1
			if ( list(1, cnt) > list(1, cnt + 1) ) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				s = listn(0, cnt), listn(1, cnt)
				listn(0, cnt) = listn(0, cnt + 1), listn(1, cnt + 1)
				listn(0, cnt + 1) = s, s(1)
				p = 1
			}
		loop
		if ( p == 0 ) {
			break
		}
	loop
	return

#deffunc savecycle
	if ( menucycle == 1 ) {
		menucycle = 0
		if ( invally == 0 & invcontainer == 0 ) {
			lastctrl = invctrl
		}
	}
	return

*label_2974
	cc = CHARA_PLAYER

*com_inventory
	procid = (procid + 1) \ 10
	proclist(procid) = "com_inventory" + invctrl + "/" + invctrl(1) + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( invctrl == INVCTRL_INV_FILE_GET ) {
		if ( invctrl(1) == 1 ) {
			gosub *label_3060
		}
	}
	if ( menucycle == 1 ) {
		if ( mType == MAP_TYPE_WORLD ) {
			p = 0
			repeat 12
				if ( cycle(cnt, 1) == (-1) ) {
					break
				}
				if ( cycle(cnt, 1) == invctrl ) {
					p = 1
					break
				}
			loop
			if ( p == 0 ) {
				invctrl = cycle(0, 1)
			}
		}
	}
	invmark(11) = 0
	invmark(12) = 0
	page = 0
	pagesize = 16
	listmax = 0
	cs = invmark(invctrl) \ 1000
	page = invmark(invctrl) / 1000
	cs_bk = -1
	page_load
	mainweapon = -1
	repeat 2
		if ( cnt == 0 ) {
			p = -1
			if ( invctrl == INVCTRL_DROP | invctrl == INVCTRL_EQUIP | invctrl == INVCTRL_GIVE | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_COOK | invctrl == INVCTRL_TRADE_TARGET | invctrl == INVCTRL_TRADE_OFFER | invctrl == INVCTRL_MATERIAL_ENCHANT | invctrl == INVCTRL_PUT | invctrl == INVCTRL_ALLYGET | invctrl == 34 ) {
				continue
			}
		}
		if ( cnt == 1 ) {
			p = cc
			if ( invctrl == INVCTRL_TRADE_TARGET | invctrl == INVCTRL_ALLYGET ) {
				p = tc
			}
			if ( invctrl == INVCTRL_PICKPOCKET ) {
				p = mapChara(tlocx, tlocy) - 1
				if ( p == 0 | p == (-1) ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_GET | invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_INV_FILE_GET | invctrl == INVCTRL_METAL | invctrl == 35 ) {
				break
			}
		}
		inv_getheader p
		if ( p == (-1) ) {
			repeat invrange, invhead
				if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
					getitemid cnt
				}
				checkalter cnt
			loop
		}
		cnt2 = cnt
		if ( invctrl != INVCTRL_INFO & invctrl != INVCTRL_EAT & invctrl != INVCTRL_IDENTIFY & invctrl != INVCTRL_USE & invctrl != INVCTRL_DIP & invctrl != INVCTRL_TRADE_TARGET & invctrl != INVCTRL_MATERIAL_ENCHANT & invctrl != INVCTRL_ALLYGET & invctrl != INVCTRL_PICKPOCKET & invctrl != 30 & invctrl != 31 & invctrl != INVCTRL_MARK_ITEM ) {
			countequip = 0
		}
		else {
			countequip = 1
		}
		if ( invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_ALLYGET | invctrl == INVCTRL_PICKPOCKET ) {
			showmoney = 1
		}
		else {
			showmoney = 0
		}
		repeat invrange, invhead
			dup roopbuf, iID(cnt)
			if ( iNum(cnt) <= 0 ) {
				iNum(cnt) = 0
				continue
			}
			if ( roopbuf == 488 ) {
				iEffect(cnt) = EFFECT_TRAIN
			}
			if ( roopbuf == 504 ) {
				iEffect(cnt) = EFFECT_CARD
			}
			if ( roopbuf >= maxitemid - 2 | roopbuf < 0 ) {
				dialog "Invalid Item Id found. Item No:" + cnt + ", Id:" + roopbuf + " has been removed from your inventory."
				iNum(cnt) = 0
				iID(cnt) = ITEM_ID_DUMMY
				continue
			}
			if ( cnt2 == 0 ) {
				if ( invctrl == INVCTRL_PICKPOCKET ) {
					if ( iX(cnt) != tlocx | iY(cnt) != tlocy ) {
						continue
					}
				}
				else {
					if ( invctrl != INVCTRL_SHOP_BUY & invctrl != INVCTRL_INV_FILE_GET & invctrl != INVCTRL_METAL & invctrl != 35 ) {
						if ( iX(cnt) != cX(cc) | iY(cnt) != cY(cc) ) {
							continue
						}
					}
				}
			}
			item_checkknown cnt
			reftype = refitem(roopbuf, DBSPEC_TYPE, cnt)
			if ( iProperty(cnt) == PROP_SPECIAL ) {
				if ( ibit(ITEM_BIT_GUEST_USE, cnt) == FALSE | invctrl != INVCTRL_USE ) {
					if ( invctrl != INVCTRL_INFO ) {
						continue
					}
				}
			}
			if ( countequip == 0 ) {
				if ( iEquip(cnt) != 0 ) {
					continue
				}
			}
			if ( iEquip(cnt) != 0 ) {
				if ( mainweapon == (-1) ) {
					if ( reftype == FILTER_WEAPON ) {
						mainweapon = cnt
					}
				}
			}
			if ( cfg_hideitem == 1 ) {
				if ( invctrl == INVCTRL_DROP | invctrl == INVCTRL_EAT | invctrl == INVCTRL_GIVE | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_THROW | (invctrl == INVCTRL_PUT & invctrl(1) == 5) | (invctrl == INVCTRL_MATERIAL_ENCHANT & invctrl(1) == 5) ) {
					if ( ibit(ITEM_BIT_NO_DROP, cnt) ) {
						continue
					}
				}
			}
			if ( invctrl == INVCTRL_EAT ) {
				if ( reftype != FILTER_ITEM_FOOD & reftype != FILTER_CARGO_FOOD & roopbuf != 340 & (gettrait(0, 45) == 0 & iMaterial(cnt) != ITEM_MATERIAL_RAW | (gettrait(0, 45) == 1 & reftype >= FILTER_ITEM_MIN & reftype != FILTER_FURNITURE & roopbuf != 341 & roopbuf != 339 & roopbuf != 337)) & (iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0) == 0 ) {
					continue
				}
				if ( refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) == FILTER_ITEM_FOOD_HERB & iParam2(cnt) > 1 & iID(cnt) != ITEM_ID_INFIEA ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_EQUIP ) {
				p = cdata(body, cc) / EXT_EQUIP_SLOTS
				if ( iequiploc(cnt, p) ) {
					if ( p == 5 ) {
						if ( iSkillRef(cnt) == SKILL_WEAPON_THROWING ) {
							if ( eqthrowcheck(cc) ) {
								continue
							}
						}
					}
				}
				else {
					continue
				}
			}
			if ( invctrl == INVCTRL_READ ) {
				if ( mType == MAP_TYPE_WORLD ) {
					if ( refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) != FILTER_ITEM_DEED | gettrait(cc, 182) != 0 & roopbuf != 621 ) {
						continue
					}
				}
				else {
					if ( refitem(roopbuf, DBSPEC_CAN_READ, cnt) == FALSE & (roopbuf == 619 & iSubName(cnt) == 30) == 0 ) {
						continue
					}
					if ( gettrait(cc, 182) != 0 ) {
						continue
					}
					if ( cfg_hideitem == 1 ) {
						if ( roopbuf == 687 & iParam2(cnt) != 0 ) {
							continue
						}
					}
				}
			}
			if ( invctrl == INVCTRL_DRINK ) {
				if ( (refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) == FILTER_ITEM_FOOD_HERB & iParam2(cnt) > 1 & iID(cnt) != ITEM_ID_INFIEA) == 0 ) {
					if ( refitem(roopbuf, DBSPEC_CAN_DRINK, cnt) == FALSE & (gettrait(0, 45) == 0 | (gettrait(0, 45) == 1 & roopbuf != 338)) ) {
						continue
					}
					else {
						if ( iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0 ) {
							continue
						}
					}
				}
			}
			if ( invctrl == INVCTRL_ZAP ) {
				if ( refitem(roopbuf, DBSPEC_CAN_ZAP, cnt) == FALSE ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_SHOP_BUY ) {
				if ( roopbuf == 54 | roopbuf == 55 ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL ) {
				if ( shoptrade ) {
					if ( iWeight(cnt) >= 0 ) {
						continue
					}
					else {
						if ( reftype != FILTER_CARGO_TRADE ) {
							continue
						}
					}
				}
				else {
					if ( iWeight(cnt) < 0 ) {
						if ( reftype == FILTER_CARGO_TRADE ) {
							continue
						}
					}
				}
				if ( iValue(cnt) <= 1 ) {
					continue
				}
				if ( ibit(ITEM_BIT_PRECIOUS, cnt) == TRUE ) {
					continue
				}
				if ( iParam3(cnt) < 0 ) {
					continue
				}
				if ( iQuality(cnt) == FIX_QUALITY_UNIQUE ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_IDENTIFY ) {
				if ( iKnown(cnt) >= ITEM_KNOWN_FULL ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_USE ) {
				if ( iEffect(cnt) == EFFECT_NONE & refitem(roopbuf, DBSPEC_CAN_USE, cnt) == FALSE & ibit(ITEM_BIT_ALIVE, cnt) == FALSE ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_OPEN ) {
				if ( roopbuf == 743 ) {
					continue
				}
				if ( reftype == FILTER_FURNITURE ) {
					if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt) == 0 ) {
						continue
					}
					if ( iProperty(cnt) != PROP_NONE ) {
						continue
					}
				}
				else {
					if ( reftype != FILTER_CONTAINER ) {
						continue
					}
					if ( cfg_hideitem == 1 ) {
						if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt) == 0 ) {
							if ( iParam1(cnt) == 0 ) {
								continue
							}
						}
					}
				}
			}
			if ( invctrl == INVCTRL_COOK ) {
				if ( reftype != FILTER_ITEM_FOOD & roopbuf != 574 ) {
					continue
				}
				else {
					if ( iParam2(cnt) != 0 ) {
						continue
					}
					if ( iID(cnt) == ITEM_ID_FISH ) {
						if ( iSubName(cnt) >= 37 ) {
							continue
						}
					}
				}
				if ( roopbuf == 419 ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_DIP_SOURCE ) {
				if ( (refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) == FILTER_ITEM_FOOD_HERB & iParam2(cnt) > 1 & iID(cnt) != ITEM_ID_INFIEA) == 0 ) {
					if ( reftype != FILTER_ITEM_POTION & roopbuf != 617 ) {
						continue
					}
					else {
						if ( iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0 ) {
							continue
						}
					}
				}
			}
			if ( invctrl == INVCTRL_DIP ) {
				if ( iID(cidip) == ITEM_ID_BAIT ) {
					if ( roopbuf != 342 ) {
						continue
					}
				}
				if ( cfg_hideitem == 1 ) {
					if ( iID(cidip) == ITEM_ID_EMPTY_BOTTLE ) {
						if ( reftype != FILTER_FURNITURE_WELL ) {
							continue
						}
					}
					if ( iID(cidip) == ITEM_ID_LOVE_POTION ) {
						if ( reftype != FILTER_ITEM_FOOD & reftype != FILTER_FURNITURE_WELL & reftype > FILTER_ITEM_MIN | (iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0) != 0 ) {
							continue
						}
					}
					if ( iID(cidip) == ITEM_ID_POTION_BLINDNESS | iID(cidip) == ITEM_ID_POTION_CONFUSION | iID(cidip) == ITEM_ID_POTION_PARALYSIS | iID(cidip) == ITEM_ID_SLEEPING_DRUG ) {
						if ( reftype != FILTER_WEAPON & reftype != FILTER_AMMO & reftype != FILTER_FURNITURE_WELL & refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) != FILTER_RANGE_ROCK_THROW ) {
							continue
						}
					}
					if ( iID(cidip) == ITEM_ID_POISON ) {
						if ( reftype != FILTER_WEAPON & reftype != FILTER_AMMO & (reftype != FILTER_ITEM_FOOD & (iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0) == 0) & reftype != FILTER_FURNITURE_WELL & refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) != FILTER_RANGE_ROCK_THROW ) {
							continue
						}
					}
				}
				if ( cidip == cnt | roopbuf == 516 ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_OFFER ) {
				if ( ibit(ITEM_BIT_NO_DROP, cnt) == TRUE ) {
					continue
				}
				if ( ti != (-1) ) {
					godidt = godno2godid(iParam1(ti))
					if ( godidt == "eyth" & iParam3(ti) != 0 ) {
						godidt = usergoddatan(2, iParam2(ti))
					}
					p = getcgodno()
					if ( godidt != "" ) {
						if ( godcheck() != godidt & goddomaincheck(godidt, godcheck()) == 1 ) {
							if ( findcgodno(godidt) != (-1) ) {
								if ( givecheck(cnt, findcgodno(godidt)) == 0 ) {
									if ( p != (-1) ) {
										if ( givecheck(cnt, p) == 0 ) {
											continue
										}
									}
									else {
										if ( refitem(roopbuf, DBSPEC_OFFER, cnt) == 0 ) {
											continue
										}
									}
								}
							}
							else {
								if ( refitem(roopbuf, 22, cnt) == 0 ) {
									if ( givecheck(cnt, p) == 0 ) {
										continue
									}
								}
							}
						}
						else {
							if ( p == (-1) ) {
								if ( refitem(roopbuf, DBSPEC_OFFER, cnt) == 0 ) {
									continue
								}
							}
							else {
								if ( givecheck(cnt, p) == 0 ) {
									continue
								}
							}
						}
					}
				}
			}
			if ( invctrl == INVCTRL_TRADE_TARGET ) {
				if ( roopbuf == 54 | roopbuf == 55 ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_TRADE_OFFER ) {
				if ( calcitemvalue(cnt, 0) * iNum(cnt) < calcitemvalue(citrade, 0) * iNum(citrade) / 2 * 3 ) {
					continue
				}
				if ( ibit(ITEM_BIT_STOLEN, cnt) ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_INV_FILE_GET ) {
				if ( iProperty(cnt) == PROP_NPC ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_MATERIAL_ENCHANT ) {
				if ( invctrl(1) == 0 ) {
					if ( reftype >= FILTER_ITEM_MIN & reftype != FILTER_FURNITURE ) {
						continue
					}
				}
				if ( invctrl(1) == 1 ) {
					if ( reftype != FILTER_WEAPON & reftype != FILTER_RANGE ) {
						continue
					}
				}
				if ( invctrl(1) == 2 ) {
					if ( reftype < FILTER_HELM | reftype >= FILTER_RANGE ) {
						if ( reftype < FILTER_ACCESSORY | reftype >= FILTER_ITEM_MIN ) {
							continue
						}
					}
				}
				if ( invctrl(1) == 3 ) {
					if ( ibit(ITEM_BIT_CHARGE_ITEM, cnt) == FALSE ) {
						continue
					}
				}
				if ( invctrl(1) == 4 ) {
					if ( iEquip(cnt) != 0 ) {
						continue
					}
				}
				if ( invctrl(1) == 5 ) {
					if ( reftype != FILTER_ITEM_ROD ) {
						continue
					}
				}
				if ( invctrl(1) == 6 ) {
					if ( iWeight(cnt) <= 0 | roopbuf == 641 ) {
						continue
					}
				}
				if ( invctrl(1) == 7 ) {
					if ( iQuality(cnt) >= FIX_QUALITY_MIRACLE | reftype >= FILTER_ITEM_MIN ) {
						continue
					}
				}
			}
			if ( invctrl == INVCTRL_PUT ) {
				if ( invctrl(1) == 0 ) {
					if ( gArea  == AREA_LUMIEST ) {
						if ( roopbuf != 687 | iParam2(cnt) == 0 ) {
							continue
						}
					}
					else {
						if ( iProperty(cnt) != PROP_QUEST ) {
							continue
						}
					}
				}
				else {
					if ( iProperty(cnt) == PROP_QUEST ) {
						continue
					}
				}
				if ( invctrl(1) == 2 ) {
					if ( roopbuf != 615 ) {
						continue
					}
				}
				if ( reftype == FILTER_CONTAINER ) {
					continue
				}
				if ( invctrl(1) == 3 ) {
					if ( reftype != FILTER_ITEM_FOOD & refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) != FILTER_ITEM_POTION_ALE & roopbuf != 516 & roopbuf != 574 & roopbuf != 620 & roopbuf != 770 ) {
						continue
					}
				}
				if ( invctrl(1) == 8 ) {
					if ( reftype != FILTER_ITEM_BOOK & reftype != FILTER_ITEM_SPELLBOOK & (roopbuf != 619 | iSubName(cnt) != 30) ) {
						continue
					}
				}
				if ( invctrl(1) == 9 ) {
					if ( reftype >= FILTER_ITEM_MIN ) {
						continue
					}
				}
				if ( invctrl(1) == 10 ) {
					if ( refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) != FILTER_ITEM_FOOD_BREAD ) {
						continue
					}
				}
				if ( invctrl(1) == 11 ) {
					if ( reftype != FILTER_ITEM_POTION ) {
						continue
					}
				}
				if ( invctrl(1) == 12 ) {
					if ( refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) != FILTER_ITEM_POTION_ALE & roopbuf != 516 & roopbuf != 574 & roopbuf != 620 & roopbuf != 770 ) {
						continue
					}
				}
				if ( invctrl(1) == 13 ) {
					if ( reftype != FILTER_REMAINS ) {
						continue
					}
				}
				if ( invctrl(1) == 14 ) {
					if ( iEquip(cnt) != 0 | ibit(ITEM_BIT_PRECIOUS, cnt) == TRUE | ibit(ITEM_BIT_NO_DROP, cnt) == TRUE ) {
						continue
					}
					if ( cfg_hideitem & iWeight(cnt) < 0 ) {
						continue
					}
					if ( invcontainer(1) == cnt ) {
						continue
					}
				}
			}
			else {
				if ( iProperty(cnt) == PROP_QUEST ) {
					if ( invctrl != INVCTRL_INFO & invctrl != INVCTRL_DROP & invctrl != INVCTRL_GET & invctrl != INVCTRL_EAT ) {
						continue
					}
				}
			}
			if ( invctrl == INVCTRL_THROW ) {
				if ( reftype != FILTER_ITEM_POTION & roopbuf != 578 & roopbuf != 685 & roopbuf != 699 & roopbuf != 772 & roopbuf != 575 ) {
					continue
				}
				if ( roopbuf == 685 ) {
					if ( iSubName(cnt) != 0 ) {
						continue
					}
				}
				if ( iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0 ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_PICKPOCKET ) {
				if ( cnt2 == 0 ) {
					if ( iProperty(cnt) != PROP_NPC ) {
						continue
					}
				}
			}
			if ( invctrl == 30 ) {
				if ( smithcheck(cnt, invctrl(1)) ) {
					continue
				}
			}
			if ( invctrl == 31 ) {
				if ( refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) != FILTER_ITEM_SEED ) {
					continue
				}
			}
			if ( invctrl == INVCTRL_MARK_ITEM ) {
				if ( roopbuf != 617 ) {
					continue
				}
			}
			if ( invctrl == 33 ) {
				if ( roopbuf == 289 | roopbuf == 290 | roopbuf == 732 | roopbuf == 743 | iQuality(cnt) == FIX_QUALITY_UNIQUE | ibit(ITEM_BIT_PRECIOUS, cnt) | ibit(ITEM_BIT_NO_DROP, cnt) | iEquip(cnt) != 0 ) {
					continue
				}
			}
			if ( invctrl == 34 ) {
				if ( reftype != FILTER_ITEM_FOOD & roopbuf != 575 ) {
					continue
				}
				else {
					if ( iParam3(cnt) > 0 ) {
						continue
					}
				}
			}
			if ( equipfilter != 0 & (invctrl == INVCTRL_INFO | invctrl == INVCTRL_DROP | invctrl == INVCTRL_GET | invctrl == INVCTRL_EAT | invctrl == INVCTRL_EQUIP | invctrl == INVCTRL_GIVE | invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_METAL | invctrl == 35) ) {
				if ( iKnown(cnt) != ITEM_KNOWN_FULL ) {
					continue
				}
				if ( oomsest_livingweapon_search == 1 ) {
					if ( ibit(ITEM_BIT_ALIVE, cnt) == FALSE ) {
						continue
					}
				}
				cnt3 = cnt
				equipfilter_f = 0
				max_power = 0
				getinheritance cnt3, inhlist, inhmax
				dim oom_inheritance, 15
				repeat inhmax
					oom_inheritance(inhlist(cnt)) = 1
				loop
				repeat 15
					if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cnt3) == 0 ) {
						break
					}
					if ( oom_inheritance_search == 1 ) {
						if ( oom_inheritance(cnt) != 1 ) {
							continue
						}
					}
					if ( equipfilter < 0 ) {
						if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cnt3) / 10000 == abs(equipfilter) / 10000 | (inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cnt3) / 10000 == 0 & abs(equipfilter) / 10000 == 10) ) {
							if ( equipfilterpower == 0 ) {
								if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3) > max_power ) {
									list(0, listmax) = cnt3, inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3)
									equipfilter_f = 1
									max_power = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3)
								}
							}
							else {
								if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3) > equipfilterpower ) {
									if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3) > max_power ) {
										list(0, listmax) = cnt3, inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3)
										equipfilter_f = 1
										max_power = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3)
									}
								}
							}
						}
					}
					else {
						if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cnt3) == equipfilter - 1 * (inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cnt3) / 10000 == 8 | inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cnt3) / 10000 == 9) ) {
							if ( equipfilterpower == 0 ) {
								list(0, listmax) = cnt3, inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3)
								equipfilter_f = 1
								break
							}
							else {
								if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3) > equipfilterpower ) {
									list(0, listmax) = cnt3, inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt3)
									equipfilter_f = 1
									break
								}
							}
						}
					}
				loop
				if ( equipfilter_f == 0 ) {
					continue
				}
			}
			else {
				list(0, listmax) = cnt, reftype * 1000 + roopbuf
				if ( roopbuf == 544 ) {
					list(1, listmax) += iParam1(cnt) + 900
				}
				else {
					if ( reftype == FILTER_CONTAINER ) {
						if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt) == 0 & iParam1(cnt) == 0 ) {
							list(1, listmax) += 1000
						}
					}
				}
				if ( invctrl == INVCTRL_GET ) {
					if ( iProperty(cnt) > PROP_NONE & iProperty(cnt) < PROP_CONSTRUCT ) {
						list(1, listmax) += 99999 * 1000
					}
				}
				if ( invctrl == INVCTRL_INFO | invctrl == INVCTRL_IDENTIFY ) {
					if ( iEquip(cnt) != 0 ) {
						list(1, listmax) -= 99999 * 1000
					}
				}
				if ( cnt2 == 0 ) {
					list(1, listmax) -= 99999 * 2000
				}
				if ( invctrl == INVCTRL_METAL ) {
					if ( ogTitleCensored == 2 ) {
						list(1, listmax) = limitmin(calcmedalvalue(cnt) / 2, 1)
					}
					else {
						list(1, listmax) = calcmedalvalue(cnt)
					}
				}
				if ( invctrl == 35 ) {
					list(1, listmax) = calcfeavalue(cnt)
				}
				if ( invctrl == INVCTRL_COOK ) {
					if ( cfg_st_sortbyexpirationdate ) {
						if ( iMaterial(cnt) != ITEM_MATERIAL_RAW | iParam3(cnt) == (-1) ) {
							list(1, listmax) = 2147483647 - 1000 + roopbuf
						}
						else {
							list(1, listmax) = (iParam3(cnt) - getgametime()) * 1000 + roopbuf
						}
					}
				}
			}
			hack_equipfilter = 0
			listmax++
		loop
	loop
	f = 0
	if ( listmax == 0 ) {
		if ( invctrl == INVCTRL_TRADE_OFFER ) {
			txt -1, lang(itemname(citrade) + "に見合う物を所持していない。", "You don't have stuff that match " + itemname(citrade) + ".")
			f = 1
		}
		if ( invctrl == INVCTRL_PICKPOCKET ) {
			if ( tc != CHARA_PLAYER ) {
				txt -1, lang(name(tc) + "は盗めるものを所持していない。", name(tc) + " has nothing to steal.")
				f = 1
			}
			else {
				txt -1, lang("そこに盗めるものはない。", "There's nothing to steal.")
				f = 1
			}
		}
	}
	if ( invctrl == INVCTRL_OFFER ) {
		item_find FILTER_FURNITURE_ALTAR, ITEM_FIND_MODE_TYPE_MINOR
		if ( stat == (-1) ) {
			msgdup++
			txt -1, lang("ここには祭壇がない。", "There's no altar here.")
			f = 1
		}
		else {
			ti = stat
		}
	}
	if ( invctrl == INVCTRL_PICKPOCKET ) {
		if ( tc > CHARA_PLAYER ) {
			if ( cRelation(tc) == RELATION_ALLY | cRole(tc) == ROLE_PET_SENTRY | cRole(tc) == ROLE_PET_MAID | eqfaction(tc, "petshop") ) {
				txt -1, lang("仲間からは盗みたくない。", "You don't want to rob your ally.")
				f = 1
			}
		}
	}
	if ( invctrl == INVCTRL_PUT ) {
		if ( invctrl(1) == 0 ) {
			if ( gArea  == AREA_LUMIEST ) {
				if ( flagMageGuildNorma <= 0 ) {
					txt -1, lang("現在魔術士ギルドのノルマはない。", "You have no quota for Mages Guild.")
					f = 1
				}
			}
		}
	}
	if ( f == 1 ) {
		if ( invsubroutine == 1 ) {
			invsubroutine = 0
			return 0
		}
		gosub *screen_draw
		goto *pc_turn
	}

*label_2982
	if ( equipfilter != 0 & oom_sort == 1 ) {
		gosub *sort_list2
	}
	else {
		gosub *sort_list
	}
	if ( invctrl == INVCTRL_GET ) {
		if ( listmax == 0 & equipfilter == 0 ) {
			goto *label_4158
		}
	}
	if ( returnfromidentify == 0 ) {
		if ( invctrl == INVCTRL_DIP ) {
			valn = itemname(cidip, 1)
		}
		else {
			if ( invctrl == INVCTRL_TRADE_OFFER ) {
				valn = itemname(citrade)
			}
		}
		s = "", lang("どのアイテムを調べる？ ", "Examine what? "), lang("どのアイテムを置く？ ", "Drop what? "), lang("どのアイテムを拾う？ ", "Which item do you want to pick up? "), lang("何を装備する？", "Equip what?"), lang("何を食べよう？ ", "Eat what? "), "", lang("どれを読む？ ", "Read what? "), lang("どれを飲む？ ", "Drink what? "), lang("どれを振る？ ", "Zap what? "), lang("どれを渡す？ ", "Which item do you want to give? "), lang("どれを購入する？ ", "What do you want to buy? "), lang("どれを売却する？ ", "What do you want to sell? "), lang("どのアイテムを鑑定する？ ", "Which item do you want to identify? "), lang("どのアイテムを使用する？ ", "Use what? "), lang("どれを開ける？ ", "Open what? "), lang("何を料理する？ ", "Cook what? "), lang("何を混ぜる？ ", "Blend what? "), lang("何に混ぜる？(" + valn + "の効果を適用するアイテムを選択) ", "Which item do you want to apply the effect of " + valn + "? "), lang("何を神に捧げる？ ", "What do you want to offer to your God? "), lang("何を交換する？ ", "Which item do you want to trade? "), lang(valn + "の代わりに何を提示する？ ", "What do you offer for " + valn + "? "), lang("何を取る？ ", "Take what? "), lang("何を対象にする？ ", "Target what? "), lang("何を入れる？ ", "Put what? "), lang("何をもらう？ ", "Which item do you want to take? "), lang("何を投げる？ ", "Throw what? "), lang("何を盗む？ ", "Steal what? "), lang("何と交換する？ ", "Trade what? "), lang("何を予約する？", "Which item do you want to reserve? "), "", "", "", "", "", lang("何と交換する？ ", "Trade what? "), ""
		if ( s(invctrl) != "" ) {
			txtnew
		}
		if ( invsc == 0 ) {
			if ( tc == (-1) ) {
				ctalk 0, 10000 + invctrl, 0, 0
			}
			else {
				ctalk 0, 10000 + invctrl, 0, tc
			}
			if ( stat == 0 ) {
				s = "", lang("どのアイテムを調べる？ ", "Examine what? "), lang("どのアイテムを置く？ ", "Drop what? "), lang("どのアイテムを拾う？ ", "Which item do you want to pick up? "), lang("何を装備する？", "Equip what?"), lang("何を食べよう？ ", "Eat what? "), "", lang("どれを読む？ ", "Read what? "), lang("どれを飲む？ ", "Drink what? "), lang("どれを振る？ ", "Zap what? "), lang("どれを渡す？ ", "Which item do you want to give? "), lang("どれを購入する？ ", "What do you want to buy? "), lang("どれを売却する？ ", "What do you want to sell? "), lang("どのアイテムを鑑定する？ ", "Which item do you want to identify? "), lang("どのアイテムを使用する？ ", "Use what? "), lang("どれを開ける？ ", "Open what? "), lang("何を料理する？ ", "Cook what? "), lang("何を混ぜる？ ", "Blend what? "), lang("何に混ぜる？(" + valn + "の効果を適用するアイテムを選択) ", "Which item do you want to apply the effect of " + valn + "? "), lang("何を神に捧げる？ ", "What do you want to offer to your God? "), lang("何を交換する？ ", "Which item do you want to trade? "), lang(valn + "の代わりに何を提示する？ ", "What do you offer for " + valn + "? "), lang("何を取る？ ", "Take what? "), lang("何を対象にする？ ", "Target what? "), lang("何を入れる？ ", "Put what? "), lang("何をもらう？ ", "Which item do you want to take? "), lang("何を投げる？ ", "Throw what? "), lang("何を盗む？ ", "Steal what? "), lang("何と交換する？ ", "Trade what? "), lang("何を予約する？", "Which item do you want to reserve? "), "", "", "", "", "", lang("何と交換する？ ", "Trade what? "), ""
				txt -1, s(invctrl)
			}
		}
		if ( invctrl == INVCTRL_METAL ) {
			item_find ITEM_ID_SMALL_MEDAL, ITEM_FIND_MODE_DBID, ITEM_FIND_LOCATION_CHARAS
			if ( stat != (-1) ) {
				p = iNum(stat)
			}
			else {
				p = 0
			}
			txt -1, lang("(持っているメダル: " + p + "枚)", "(Coins: " + p + ")")
		}
		if ( invctrl == 35 ) {
			item_find ITEM_ID_FEAPPLE, ITEM_FIND_MODE_DBID, ITEM_FIND_LOCATION_CHARAS
			if ( stat != (-1) ) {
				p = iNum(stat)
			}
			else {
				p = 0
			}
			txt -1, lang("(持っているフェアリンゴ: " + p + "枚)", "(feapple: " + p + ")")
		}
		if ( invctrl == INVCTRL_PUT ) {
			if ( invctrl(1) == 0 ) {
				if ( gArea  == AREA_LUMIEST ) {
					txt -1, lang("ノルマ残り: " + flagMageGuildNorma + "GP", "" + flagMageGuildNorma + "guild points are needed to gain a rank.")
				}
			}
		}
	}
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_inv.bmp", 1
	gsel BUFFER_SCREEN
	if ( returnfromidentify == 0 ) {
		windowshadow = 1
	}
	returnfromidentify = 0

*com_inventory_loop
	if ( invsc != 0 ) {
		f = 0
		repeat listmax
			p = list(0, cnt)
			if ( iID(p) == invsc ) {
				if ( refitem(iID(p), DBSPEC_TYPE, p) != FILTER_ITEM_FOOD | stgdata(56 + sc) == iParam2(p) ) {
					if ( iStatus(p) == invcurse & iKnown(p) == ITEM_KNOWN_FULL | (stgdata(36 + sc) == (-3) & iKnown(p) < ITEM_KNOWN_FULL) | cfg_st_shortcut == 0 ) {
						if ( iID(p) == ITEM_ID_CARNEADES_PLANK ) {
							if ( iCItemIdx(p) != invsc(1) ) {
								continue
							}
						}
						ci = p
						f = 1
						if ( ibit(ITEM_BIT_CHARGE_ITEM, ci) ) {
							if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) <= 0 ) {
								continue
							}
						}
						break
					}
				}
			}
		loop
		cc = CHARA_PLAYER
		if ( f == 0 ) {
			inv_find_ex invsc, 0, invcurse
			if ( stat == (-1) ) {
				txt -1, lang("そのアイテムは存在しない。", "The item doesn't exist.")
			}
			else {
				txt -1, lang("使用できるアイテムがない。", "You can't do that while you're in a global area.")
			}
			invsc = 0, 0
			invcurse = 0
			gosub *screen_draw
			goto *pc_turn
		}
		invsc = 0, 0
		if ( mType == MAP_TYPE_WORLD ) {
			if ( invctrl == INVCTRL_ZAP | invctrl == INVCTRL_OPEN | invctrl == INVCTRL_THROW ) {
				txtnew
				txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		goto *inv_skipSc
	}
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	if ( menucycle == 1 ) {
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		y = 34
		x = windoww - 650 + 156
		window2 x, y, 475, 22, 5, 5
		pos x - 28, y - 8
		gcopy BUFFER_INF, 64, 288, 50, 32
		if ( dropcontinue ) {
			i = 4
		}
		else {
			if ( invally == 1 ) {
				i = 2
			}
			else {
				if ( invcontainer ) {
					i = 3
				}
				else {
					if ( mType == MAP_TYPE_WORLD ) {
						i = 1
					}
					else {
						i = 0
					}
				}
			}
		}
		repeat 12
			if ( cycle(cnt, i) == (-1) ) {
				break
			}
			p = cycle(cnt, i)
			pos x + cnt * 44 + 20, y - 24
			gcopy BUFFER_INF, 288 + invicon(p) * 48, 48, 48, 48
			if ( invctrl == p ) {
				gmode 5, , , 70
				pos x + cnt * 44 + 20, y - 24
				gcopy BUFFER_INF, 288 + invicon(p) * 48, 48, 48, 48
				gmode 2
			}
			pos x + cnt * 44 + 46 - strlen(invtitle(p)) * 3, y + 7
			color 0, 0, 0
			if ( invctrl == p ) {
				bmes invtitle(p), 255, 255, 255
			}
			else {
				bmes invtitle(p), 165, 165, 165
			}
			if ( invkey(p) != "" ) {
				pos x + cnt * 44 + 46, y + 18
				color 0, 0, 0
				bmes "(" + invkey(p) + ")", 235, 235, 235
			}
		loop
		color 0, 0, 0
		pos x + 325, y + 32
		bmes "" + key_prev + "," + key_next + ",Tab " + lang("[メニュー切替]", "[Change]"), 255, 255, 255
	}

*com_inventory_loop_WHILE1
	redraw 0
	s = lang(invtitle(invctrl) + "アイテムの選択", invtitle(invctrl))
	s(1) = strhint2 + strhint5 + strhint5b
	if ( equipfilter != 0 & (invctrl == INVCTRL_INFO | invctrl == INVCTRL_DROP | invctrl == INVCTRL_GET | invctrl == INVCTRL_EAT | invctrl == INVCTRL_EQUIP | invctrl == INVCTRL_GIVE | invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_METAL | invctrl == 35) ) {
		s(1) += strhint3b
	}
	else {
		s(1) += strhint3
	}
	if ( invctrl == INVCTRL_EAT | invctrl == INVCTRL_READ | invctrl == INVCTRL_DRINK | invctrl == INVCTRL_ZAP | invctrl == INVCTRL_USE | invctrl == INVCTRL_OPEN | invctrl == INVCTRL_THROW ) {
		s(1) += strhint7
	}
	if ( invctrl == INVCTRL_INFO ) {
		s(1) += "" + key_mode2 + " " + lang("[保持指定]", "[Tag No-Drop]")
	}
	if ( invctrl == INVCTRL_DROP ) {
		if ( dropcontinue == 0 ) {
			s(1) += "" + key_mode2 + " " + lang("[連続で置く]", "[Multi Drop]")
		}
	}
	if ( invctrl == INVCTRL_GIVE ) {
		if ( cImpression(tc) >= 100 ) {
			s(1) += oomsest_strhint7
		}
	}
	if ( equipfilter == 0 ) {
		if ( invctrl == INVCTRL_INFO | invctrl == INVCTRL_DROP | invctrl == INVCTRL_GET | invctrl == INVCTRL_EAT | invctrl == INVCTRL_EQUIP | invctrl == INVCTRL_GIVE | invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_METAL | invctrl == 35 ) {
			s(1) += "\n" + oom_strhint1
		}
	}
	else {
		if ( invctrl == INVCTRL_INFO | invctrl == INVCTRL_DROP | invctrl == INVCTRL_GET | invctrl == INVCTRL_EAT | invctrl == INVCTRL_EQUIP | invctrl == INVCTRL_GIVE | invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL ) {
			s(1) += "\n" + oom_strhint1 + oom_strhint2
		}
	}
	if ( invctrl == INVCTRL_DROP ) {
		if ( dropcontinue == 0 ) {
			s(1) += " " + oomsest_strhint2
		}
	}
	if ( invctrl == INVCTRL_GET ) {
		s(1) += " " + oomsest_strhint3
	}
	if ( cfg_nc_itemcount != 0 ) {
		if ( invctrl == INVCTRL_INFO ) {
			s(1) += "" + oom_strhint9
		}
	}
	if ( invctrl == INVCTRL_ALLYGET ) {
		s(1) += " " + key_wear + " " + lang("[装備選択]", "[Equip]")
	}
	display_window (windoww - 640) / 2 + inf_screenx, winposy(432), 640, 432
	if ( invicon(invctrl) != (-1) ) {
		pos wx + 46, wy - 14
		gcopy BUFFER_INF, 288 + invicon(invctrl) * 48, 48, 48, 48
	}
	s = lang("重さ", "Weight")
	if ( invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL ) {
		s = lang("値段", "Price")
	}
	if ( invctrl == INVCTRL_METAL ) {
		s = lang("メダル", "Medal")
	}
	if ( invctrl == 35 ) {
		s = lang("F.リンゴ", "Feapple")
	}
	display_topic s, wx + 526, wy + 30
	s = lang("アイテムの名称", "Name")
	if ( equipfilter != 0 ) {
		s = lang("フィルタ : ", "Filter: ")
		if ( equipfilter < 0 ) {
			s += enccategoryn(encselect)
		}
		else {
			if ( enccategory(encselect) < 80000 ) {
				s += skillname(equipfilter \ enccategory(encselect))
			}
			else {
				if ( enccategory(encselect) == 80000 ) {
					s += skillname(encprocref(ENCPROCREF_SKILL_ID, equipfilter \ enccategory(encselect) - 1))
				}
				else {
					if ( enccategory(encselect) == 90000 ) {
						s += ammoname(equipfilter \ enccategory(encselect) - 1)
					}
					else {
						s += encetcn(0, equipfilter \ enccategory(encselect) - 21)
					}
				}
			}
		}
		if ( equipfilterpower != 0 ) {
			s = s + " - " + equipfilterpower
		}
		if ( oom_inheritance_search ) {
			s += lang(" - 継承on", " - only inherited")
		}
		if ( oomsest_livingweapon_search ) {
			s += lang(" - 生き武器on", " - only alive")
		}
		if ( oom_sort == 1 ) {
			s = s + lang(" : 降順", ": descending")
		}
		else {
			s = s + lang(" : 昇順", ": ascending")
		}
	}
	display_topic s, wx + 28, wy + 30
	if ( showresist ) {
		if ( equipfilter == 0 ) {
			if ( cfg_equipex == 1 ) {
				if ( equipfilter >= 0 & showressub == 2 ) {
					showressub = 0
				}
				pos wx + 200 + (showressub == 0) * 100, wy + 40
				if ( showressub == 0 ) {
					color 0, 0, 0
					repeat length(_resiststr0)
						pos wx + 300 + cnt * 20, wy + 40
						mes _resiststr0(cnt)
					loop
				}
				if ( showressub == 1 ) {
					color 0, 0, 0
					repeat length(_resiststr1)
						pos wx + 200 + cnt * 20, wy + 40
						mes _resiststr1(cnt)
					loop
				}
				if ( showressub == 2 ) {
					color 0, 0, 0
					mes ""
				}
				if ( showressub == 3 ) {
					color 0, 0, 0
					pos wx + 200, wy + 40
					mes lang("熱", "Fi")
					pos wx + 220, wy + 40
					mes lang("酸", "Ac")
					pos wx + 240, wy + 40
					mes lang("浮", "Fl")
					pos wx + 260, wy + 40
					mes lang("寄", "Pa")
					pos wx + 280, wy + 40
					mes lang("腐", "Ro")
					pos wx + 300, wy + 40
					mes lang("電", "Ra")
				}
			}
			else {
				pos wx + 300, wy + 40
				color 0, 0, 0
				mes lang("火 冷 雷 闇 幻 毒 獄 音 神 沌 魔", "Fi Co Li Da Mi Po Nt So Nr Ch Ma")
			}
		}
	}
	pos wx + ww - 136, wy - 6
	gcopy BUFFER_INF, 960, 96, 144, 48
	if ( showresist == 0 ) {
		pos wx + ww - 186, wy - 6
		gcopy BUFFER_INF, 960, 144, 48, 72
	}
	pos wx + ww - 246, wy - 6
	gcopy BUFFER_INF, 1008, 144, 48, 72
	pos wx - 6, wy - 6
	gcopy BUFFER_INF, 960, 216, 48, 72
	s = "" + listmax + " items"
	s += lang("  (重さ合計 ", "  (Weight ") + cnvweight(cInvWeight(CHARA_PLAYER)) + "/" + cnvweight(cCarryLimit(CHARA_PLAYER)) + lang("  荷車 ", "  Cargo ") + cnvweight(gCargoWeight) + ")"
	if ( invctrl == INVCTRL_ALLYGET ) {
		s = ""
	}
	display_note s
	if ( invctrl == INVCTRL_ALLYGET ) {
		x = (windoww - 640) / 2 + inf_screenx + 455
		y = winposy(432) - 32
		w = 200
		h = 102
		window x + 4, y + 4, w, h - h \ 8, 0, -1
		window x, y, w, h - h \ 8, 0, 0
		font lang(cfg_font1, cfg_font2), 12 + en - en * 2, 0
		pos x + 16, y + 17
		mes "DV:" + cDV(tc) + " PV:" + cPV(tc)
		pos x + 16, y + 35
		mes lang("装備重量:", "EquipWt:") + cnvweight(cEqWeight(tc)) + "" + cnveqweight(tc)
		x = wx + 40
		y = wy + wh - 65 - wh \ 8
		pos x, y
		mes lang("装備箇所:", "Equip:")
		x += 60
		repeat 30, 100
			if ( cdata(cnt, tc) == 0 ) {
				continue
			}
			p = cdata(cnt, tc)
			if ( p \ 10000 != 0 ) {
				color 50, 50, 200
			}
			else {
				color 100, 100, 100
			}
			pos x, y
			mes "" + bodyn(p / 10000)
			x += (strlen(bodyn(p / 10000)) + 1) * 6
		loop
	}
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		p = list(0, p)
		s = itemname(p, iNum(p)), cnvweight(iWeight(p) * iNum(p))
		if ( invctrl == INVCTRL_SHOP_BUY ) {
			s += " " + cnvweight(iWeight(p))
			s(1) = thousandsep(str(calcitemvalue(p, 0))) + " gp"
		}
		if ( invctrl == INVCTRL_SHOP_SELL ) {
			s += " " + cnvweight(iWeight(p))
			s(1) = thousandsep(str(calcitemvalue(p, 1))) + " gp"
		}
		if ( invctrl == INVCTRL_METAL ) {
			if ( ogTitleCensored == 2 ) {
				s(1) = "" + limitmin(calcmedalvalue(p) / 2, 1) + lang(" 枚", " Coins")
			}
			else {
				s(1) = "" + calcmedalvalue(p) + lang(" 枚", " Coins")
			}
		}
		if ( invctrl == 35 ) {
			s(1) = "" + calcfeavalue(p) + lang(" 枚", " Coins")
		}
		if ( refitem(iID(p), DBSPEC_TYPE, p) == FILTER_ITEM_FOOD ) {
			if ( iKnown(p) == ITEM_KNOWN_FULL ) {
				if ( iMaterial(p) == ITEM_MATERIAL_RAW ) {
					if ( iParam3(p) > 0 ) {
						if ( iParam3(p) - getgametime() >= 0 ) {
							s += lang("(" + (iParam3(p) - getgametime()) + "時間)", "(Expire in: " + (iParam3(p) - getgametime()) + "h.)")
						}
					}
				}
			}
		}
		if ( invctrl != INVCTRL_GET & invctrl != INVCTRL_SHOP_BUY & invctrl != INVCTRL_INV_FILE_GET & invctrl != INVCTRL_PICKPOCKET & invctrl != INVCTRL_METAL & invctrl != 35 ) {
			if ( p >= 5080 ) {
				s += lang("(足元)", " (Ground)")
			}
		}
		if ( iID(p) == ITEM_ID_PUTITORO ) {
			s += "(ID:" + (iParam1(p) + iParam2(p) + iParam3(p)) + ")"
		}
		repeat 20
			if ( ogdata(36 + cnt) == iID(p) + invctrl * 10000 + iCItemIdx(p) * 10000 * 100 ) {
				if ( refitem(iID(p), DBSPEC_TYPE, p) != FILTER_ITEM_FOOD | stgdata(56 + cnt) == iParam2(p) ) {
					if ( stgdata(36 + cnt) == iStatus(p) & iKnown(p) == ITEM_KNOWN_FULL | (stgdata(36 + cnt) == (-3) & iKnown(p) < ITEM_KNOWN_FULL) | cfg_st_shortcut == 0 ) {
						s += "{" + cnt + "}"
					}
				}
			}
		loop
		display_key wx + 58, wy + 60 + cnt * 19 - 2, cnt
		if ( cfg_useffhp ) {
			preparepicitemex p
			p(1) = stat
		}
		else {
			p(1) = iPic(p) \ 1000
			gsel BUFFER_ITEM
			color 0
			boxf 0, 960, chipi(CHIPI_WIDTH, p(1)), chipi(CHIPI_HEIGHT, p(1)) + 960
			if ( p(1) == 528 ) {
				gmode 2
				pos 0, 960
				gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
				pos 0, 1008
				gzoom 22, 20, 5 + 90 * (iCol(p) > 660 & iCol(p) < 825), chipc(CHIPC_X, iCol(p)) + 8, chipc(CHIPC_Y, iCol(p)) + 4 + (chipc(CHIPC_HEIGHT, iCol(p)) > inf_tiles) * 8, chipc(CHIPC_WIDTH, iCol(p)) - 16, chipc(CHIPC_HEIGHT, iCol(p)) - 8 - (chipc(CHIPC_HEIGHT, iCol(p)) > inf_tiles) * 10, 1
				pos 6, 974
				gcopy BUFFER_ITEM, 0, 1008, 22, 20
				gsel selcur
			}
			else {
				if ( p(1) == 531 ) {
					pos 8, 1058 - chipc(CHIPC_HEIGHT, iCol(p))
					gcopy 5 + 90 * (iCol(p) > 660 & iCol(p) < 825), chipc(CHIPC_X, iCol(p)) + 8, chipc(CHIPC_Y, iCol(p)) + 2, chipc(CHIPC_WIDTH, iCol(p)) - 16, chipc(CHIPC_HEIGHT, iCol(p)) - 8
					gmode 4, , , 150
					color 0, 0, 0
					pos 0, 960 + (chipc(CHIPC_HEIGHT, iCol(p)) == inf_tiles) * 48
					gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, iCol(p)) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, iCol(p)) + (chipc(CHIPC_HEIGHT, iCol(p)) > inf_tiles) * 48
					gmode 2
					gsel selcur
				}
				else {
					if ( p(1) == 529 ) {
						pos 0, 1056 - chipc(CHIPC_HEIGHT, iCol(p))
						gcopy 5 + 90 * (iCol(p) > 660 & iCol(p) < 825), chipc(CHIPC_X, iCol(p)), chipc(CHIPC_Y, iCol(p)), chipc(CHIPC_WIDTH, iCol(p)), chipc(CHIPC_HEIGHT, iCol(p))
						gmode 2
						gsel selcur
					}
					else {
						pos 0, 960
						gcopy BUFFER_ITEM, chipi(CHIPI_X, p(1)), chipi(CHIPI_Y, p(1)), chipi(CHIPI_WIDTH, p(1)), chipi(CHIPI_HEIGHT, p(1))
						gfini chipi(CHIPI_WIDTH, p(1)), chipi(CHIPI_HEIGHT, p(1))
						gfdec2 c_col(0, iCol(p)), c_col(1, iCol(p)), c_col(2, iCol(p))
						gsel selcur
					}
				}
			}
		}
		pos wx + 37, wy + 69 + cnt * 19
		gmode 2, chipi(CHIPI_WIDTH, p(1)), chipi(CHIPI_HEIGHT, p(1))
		grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, p(1)) * inf_tiles / chipi(CHIPI_HEIGHT, p(1)), inf_tiles
		if ( iEquip(p) != 0 ) {
			pos wx + 46, wy + 72 + cnt * 18 - 3
			gcopy BUFFER_INF, 12, 348, 12, 12
			if ( p == mainweapon ) {
				s += lang("(利腕)", " (Main hand)")
			}
		}
		if ( showresist ) {
			if ( cfg_equipex == 1 ) {
				if ( equipfilter > 0 ) {
					if ( showressub == 2 ) {
						showressub = 0
					}
				}
				if ( refitem(iID(p), DBSPEC_TYPE, p) >= FILTER_WEAPON & refitem(iID(p), DBSPEC_TYPE, p) <= FILTER_ACCESSORY_AMULET | iID(p) == ITEM_ID_GAROKS_HAMMER ) {
					equipinfo p, wx + 200 + (showressub == 0) * 100, wy + 60 + cnt * 19 + 2
					s = strmid(s, 0, 10 + (showressub == 0) * 14)
				}
			}
			else {
				equipinfo p, wx + 300, wy + 60 + cnt * 19 + 2
				s = strmid(s, 0, 24)
			}
		}
		cs_list s, wx + 84, wy + 60 + cnt * 19 - 1, 19, 0, 1, p
		pos wx + 600 - strlen(s(1)) * 7, wy + 60 + cnt * 19 + 2
		mes s(1)
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	if ( showmoney ) {
		if ( showresist == 0 ) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			gmode 2
			pos wx + 320, wy + 32
			gcopy BUFFER_INF, 0, 392, 24, 24
			color 0, 0, 0
			pos wx + 348, wy + 37 - en * 2
			mes thousandsep(str(cGold(tc))) + " gp"
		}
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	invmark(invctrl) = page * 1000 + cs
	repeat keyrange
		if ( invctrl == 30 & key == "sc" ) {
			if ( sc \ 10 ) {
				key = key_select(sc - 1)
			}
		}
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( mode == MODELIST_TXT_ADV ) {
		if ( listmax == 0 ) {
			p = -1
			key = key_cancel
		}
	}

	if ( p != (-1) ) {
		ci = p
		if ( invctrl == INVCTRL_SHOP_SELL | (invctrl == INVCTRL_PUT & invctrl(1) != 0) ) {
			cc = -1
		}
		else {
			if ( invctrl != INVCTRL_EQUIP | invctrl(1) != 1 ) {
				cc = CHARA_PLAYER
			}
		}
*inv_skipSc
		cargocheck
		if ( stat == 0 ) {
			goto *com_inventory_loop_WHILE1_CONTINUE
		}
		if ( cc == CHARA_PLAYER ) {
			if ( invctrl == INVCTRL_USE | invctrl == INVCTRL_ZAP | invctrl == INVCTRL_THROW | invctrl == INVCTRL_DRINK | invctrl == INVCTRL_READ ) {
				if ( gettrait(0, 173) != 0 ) {
					if ( rnd(20) == 0 ) {
						txt -1, lang(name(cnt) + "は行動を躊躇った。", name(cnt) + " cancel" + _s(cnt) + " " + his(cnt) + " action.")
						goto *label_4158
					}
				}
			}
		}
		if ( invctrl == INVCTRL_INFO ) {
			listmax_bk = listmax
			pagesize_bk = pagesize
			pagemax_bk = pagemax
			listnumber = pagesize * page + cs
			gosub *com_inventory_loop_WEND1
			goto *label_2974
		}
		if ( invctrl == INVCTRL_DROP ) {
			if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *com_inventory_loop
			}
			if ( areaId(gArea ) == AREA_SHELTER ) {
				if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_CARGO_TRADE ) {
					txt -1, lang("シェルター内では荷物を置くことが出来ない。", "You can't drop this item in shelter.")
					snd SOUNDLIST_FAIL1
					goto *com_inventory_loop
				}
			}
			if ( inv_getspace(-1) == 0 ) {
				ctalk 0, 10109, 0, 0
				if ( stat == 0 ) {
					txt -1, lang("これ以上は置けない。", "You can't drop items any more.")
				}
				snd SOUNDLIST_FAIL1
				goto *com_inventory_loop
			}
			if ( mMaxInv != 0 ) {
				if ( inv_sum(-1) > mMaxInv ) {
					if ( refitem(iID(ci), DBSPEC_TYPE, ci) != FILTER_FURNITURE ) {
						ctalk 0, 10109, 0, 0
						if ( stat == 0 ) {
							txt -1, lang("これ以上は置けない。", "You can't drop items any more.")
						}
						snd SOUNDLIST_FAIL1
						goto *com_inventory_loop
					}
				}
			}
			if ( iNum(ci) > 1 ) {
				txt -1, lang(itemname(ci, 1) + "をいくつ落とす？ (1〜" + iNum(ci) + ") ", "How many? (1 to " + iNum(ci) + ")")
				display_msg screenmsgy, 1
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
				inputlog = "" + iNum(ci)
				gosub *prompt_word
				in = int(inputlog)
				if ( in > iNum(ci) ) {
					in = iNum(ci)
				}
				if ( in == 0 | rtval == (-1) ) {
					goto *com_inventory_loop
				}
			}
			else {
				in = 1
			}
			if ( cfg_useffhp ) {
				hack_furniture = 1
				if ( length(ichipexchangetable) == maxitemid ) {
					if ( ichipexchangetable(iID(ci)) / 1000000 ) {
						txt -1, lang("どの向きに置く？", "Which direction?")
						snd SOUNDLIST_POP2
						redraw 0
						gsel BUFFER_BUF
						x = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx - 48 * 3
						y = (cY(CHARA_PLAYER) - scy) * inf_tiles + inf_screeny - 48 * 3
						gmode 0
						pos 0, 0
						gcopy BUFFER_SCREEN, x, y, 48 * 7, 48 * 7
						gsel BUFFER_SCREEN
						t = 0
						x = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx + 24
						y = (cY(CHARA_PLAYER) - scy) * inf_tiles + inf_screeny + 24
						repeat
							t++
							color 0, 0, 0
							if ( key_alt == 0 ) {
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x, y - 48
								grotate BUFFER_INF, 212, 432, 0, 28, 28
								inv(39, ci) = 3
								preparepicitemex ci
								furnituretmp = stat
								pos x, y - 48 - 48
								gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
								grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x, y + 48
								grotate BUFFER_INF, 212, 432, 1.0 * 3.14, 28, 28
								inv(39, ci) = 0
								preparepicitemex ci
								furnituretmp = stat
								pos x, y + 48 + 48
								gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
								grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x + 48, y
								grotate BUFFER_INF, 212, 432, 0.5 * 3.14, 28, 28
								inv(39, ci) = 2
								preparepicitemex ci
								furnituretmp = stat
								pos x + 48 + 48, y
								gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
								grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
								gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
								pos x - 48, y
								grotate BUFFER_INF, 212, 432, 1.5 * 3.14, 28, 28
								inv(39, ci) = 1
								preparepicitemex ci
								furnituretmp = stat
								pos x - 48 - 48, y
								gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
								grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							}
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x - 48, y - 48
							grotate BUFFER_INF, 212, 432, 1.75 * 3.14, 28, 28
							inv(39, ci) = 5
							preparepicitemex ci
							furnituretmp = stat
							pos x - 48 - 48, y - 48 - 48
							gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x + 48, y + 48
							grotate BUFFER_INF, 212, 432, 0.75 * 3.14, 28, 28
							inv(39, ci) = 6
							preparepicitemex ci
							furnituretmp = stat
							pos x + 48 + 48, y + 48 + 48
							gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x + 48, y - 48
							grotate BUFFER_INF, 212, 432, 0.25 * 3.14, 28, 28
							inv(39, ci) = 7
							preparepicitemex ci
							furnituretmp = stat
							pos x + 48 + 48, y - 48 - 48
							gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
							pos x - 48, y + 48
							grotate BUFFER_INF, 212, 432, 1.25 * 3.14, 28, 28
							inv(39, ci) = 4
							preparepicitemex ci
							furnituretmp = stat
							pos x - 48 - 48, y + 48 + 48
							gmode 2, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, furnituretmp), chipi(CHIPI_HEIGHT, furnituretmp)
							inv(39, ci) = -1
							redraw 1
							redraw 0
							gmode 0
							pos x - 48 * 3 - 24, y - 48 * 3 - 24
							gcopy BUFFER_BUF, 0, 0, 48 * 7, 48 * 7
							gmode 2
							await 30
							key_check 1
							if ( key == key_alter ) {
								continue
							}
							if ( key == key_wait | key == key_enter ) {
								inv(39, ci) = 0
								break
							}
							if ( key == key_south ) {
								if ( key_alt ) {
									continue
								}
								inv(39, ci) = 0
								break
							}
							if ( key == key_west ) {
								if ( key_alt ) {
									continue
								}
								inv(39, ci) = 1
								break
							}
							if ( key == key_east ) {
								if ( key_alt ) {
									continue
								}
								inv(39, ci) = 2
								break
							}
							if ( key == key_north ) {
								if ( key_alt ) {
									continue
								}
								inv(39, ci) = 3
								break
							}
							if ( key == key_southwest ) {
								inv(39, ci) = 4
								break
							}
							if ( key == key_northwest ) {
								inv(39, ci) = 5
								break
							}
							if ( key == key_southeast ) {
								inv(39, ci) = 6
								break
							}
							if ( key == key_northeast ) {
								inv(39, ci) = 7
								break
							}
							if ( key != "" ) {
								break
							}
						loop
						if ( inv(39, ci) == (-1) ) {
							inv(39, ci) = 0
							goto *com_inventory_loop
						}
						await 80
					}
				}
				hack_furniture = 0
			}
			savecycle
			dropval = 0
			gosub *act_drop
			if ( dropcontinue ) {
				menucycle = 1
				dropcontinue++
				goto *label_2974
			}
			goto *label_4158
		}
		if ( invctrl == INVCTRL_GET | invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_INV_FILE_GET | (invctrl == INVCTRL_PUT & (invctrl(1) == 3 | invctrl(1) == 5 | invctrl(1) == 8 | invctrl(1) == 9 | invctrl(1) == 10 | invctrl(1) == 11 | invctrl(1) == 12 | invctrl(1) == 13 | invctrl(1) == 14 | invctrl(1) == 99)) ) {
			if ( invctrl != INVCTRL_GET & invctrl != INVCTRL_INV_FILE_GET ) {
				if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
					snd SOUNDLIST_FAIL1
					txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
					if ( invctrl == INVCTRL_SHOP_SELL ) {
						cc = CHARA_PLAYER
					}
					goto *com_inventory_loop
				}
			}
			if ( invctrl == INVCTRL_PUT ) {
				if ( invctrl(1) == 3 | invctrl(1) == 5 | invctrl(1) == 8 | invctrl(1) == 9 | invctrl(1) == 10 | invctrl(1) == 11 | invctrl(1) == 12 | invctrl(1) == 13 | invctrl(1) == 14 | invctrl(1) == 99 ) {
					if ( inv_sum(-1) >= invcontainer ) {
						snd SOUNDLIST_FAIL1
						txt -1, lang("これ以上入らない。", "The container is full.")
						goto *com_inventory_loop
					}
				}
				if ( invctrl(1) == 5 ) {
					lint_efp = efp * 100
					if ( iWeight(ci) >= limitmax(lint_efp, 2147483647) ) {
						snd SOUNDLIST_FAIL1
						txt -1, lang("重さが" + cnvweight(limitmax(lint_efp, 2147483647)) + "以上の物は入らない。", "The container can only hold items weight less than " + cnvweight(limitmax(lint_efp, 2147483647)) + ".")
						goto *com_inventory_loop
					}
					if ( iWeight(ci) <= 0 ) {
						snd SOUNDLIST_FAIL1
						txt -1, lang("荷物は入らない。", "The container cannot hold cargos")
						goto *com_inventory_loop
					}
				}
				if ( invctrl(1) == 5 ) {
					actionsp CHARA_PLAYER, 10
					if ( stat == 0 ) {
						txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						goto *com_inventory_end
					}
				}
				if ( invctrl(1) == 14 | invctrl(1) == 99 ) {
					if ( iWeight(ci) < 0 ) {
						snd SOUNDLIST_FAIL1
						msgdup++
						txt -1, lang("荷物は入らない。", "The container cannot hold cargos")
						goto *com_inventory_loop
					}
				}
			}
			if ( invctrl == INVCTRL_INV_FILE_GET ) {
				if ( invctrl(1) == 1 ) {
					if ( gHeirDeed < 1 ) {
						txt -1, lang("遺産の相続権を持っていない。", "You don't have a claim.")
						goto *com_inventory_loop
					}
				}
				if ( invctrl(1) == 5 ) {
					actionsp CHARA_PLAYER, 10
					if ( stat == 0 ) {
						txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
						goto *com_inventory_end
					}
				}
			}
			if ( iProperty(ci) > PROP_NONE & iProperty(ci) < PROP_CONSTRUCT ) {
				snd SOUNDLIST_FAIL1
				msgdup++
				if ( iProperty(ci) == PROP_SHOP ) {
					txt -1, lang("それは持ち運べない。", "You can't carry it.")
				}
				if ( iProperty(ci) == PROP_NPC ) {
					txt -1, lang("それはあなたの物ではない。", "It's not your property."), lang("盗むなんてとんでもない。", "You can't just take it."), lang("それは拾えない。", "It's not yours.")
				}
				gosub *screen_draw
				goto *pc_turn
			}
			page_save
			if ( mode == MODELIST_SHOP & iNum(ci) > 1 & invctrl != INVCTRL_INV_FILE_GET ) {
				cancount = 0
				if ( invctrl == INVCTRL_SHOP_BUY ) {
					cancount = limit(cGold(CHARA_PLAYER) / calcitemvalue(ci, 0), 1, iNum(ci))
					txt -1, lang(itemname(ci, 1) + "をいくつ買う？ (1〜" + cancount + ") ", "How many? (1 to " + iNum(ci) + ")")
				}
				if ( invctrl == INVCTRL_SHOP_SELL ) {
					txt -1, lang(itemname(ci, 1) + "をいくつ売る？ (1〜" + iNum(ci) + ") ", "How many? (1 to " + iNum(ci) + ")")
				}
				display_msg screenmsgy, 2
				if ( cancount == 0 ) {
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
					inputlog = "" + iNum(ci)
				}
				else {
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, cancount
					inputlog = "" + cancount
				}
				gosub *prompt_word
				in = int(inputlog)
				if ( in > iNum(ci) ) {
					in = iNum(ci)
				}
				if ( in > cancount & cancount > 0 ) {
					in = cancount
				}
				cancount = 0
				if ( in == 0 | rtval == (-1) ) {
					screenupdate = -1
					gosub *screen_draw
					stick p
					cc = CHARA_PLAYER
					goto *com_inventory_loop
				}
			}
			else {
				if ( iNum(ci) > 1 & iID(ci) != ITEM_ID_GOLD_PIECE & cfg_picknumber ) {
					display_msg screenmsgy, 2
					val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
					inputlog = "" + iNum(ci)
					gosub *prompt_word
					in = int(inputlog)
					if ( in > iNum(ci) ) {
						in = iNum(ci)
					}
					if ( in == 0 | rtval == (-1) ) {
						screenupdate = -1
						gosub *screen_draw
						stick p
						goto *com_inventory_loop
					}
				}
				else {
					in = iNum(ci)
				}
			}
			if ( mode == MODELIST_SHOP & invctrl != INVCTRL_INV_FILE_GET & invctrl != INVCTRL_PUT ) {
				if ( cfg_shopselectskip == 0 ) {
					if ( invctrl == INVCTRL_SHOP_BUY ) {
						txt -1, lang(itemname(ci, in) + "を " + in * calcitemvalue(ci, 0) + " gp で買う？", "Do you really want to buy " + itemname(ci, in) + " for " + in * calcitemvalue(ci, 0) + " gold pieces?")
					}
					if ( invctrl == INVCTRL_SHOP_SELL ) {
						txt -1, lang(itemname(ci, in) + "を " + in * calcitemvalue(ci, 1) + " gp で売る？", "Do you really want to sell " + itemname(ci, in) + " for " + in * calcitemvalue(ci, 1) + " gold pieces?")
					}
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval != 0 ) {
						screenupdate = -1
						gosub *screen_draw
						goto *label_2974
					}
				}
				if ( invctrl == INVCTRL_SHOP_BUY ) {
					if ( calcitemvalue(ci, 0) * in > cGold(CHARA_PLAYER) & ncgGoldOverflow == 0 ) {
						screenupdate = -1
						gosub *screen_draw
						txt -1, lang("あなたは財布を開いてがっかりした…", "You check your wallet and shake your head."), lang("もっと稼がないと買えない！", "You need to earn more money!")
						msgkeep = 1
						goto *label_2974
					}
				}
				if ( invctrl == INVCTRL_SHOP_SELL ) {
					if ( cRole(tc) != ROLE_SHOP_TRADE ) {
						if ( calcitemvalue(ci, 1) * in > cGold(tc) ) {
							screenupdate = -1
							gosub *screen_draw
							txt -1, lang(name(tc) + "は財布を開いてがっかりした…", name(tc) + " checks " + his(tc) + " wallet and shake " + his(tc) + " head.")
							msgkeep = 1
							goto *label_2974
						}
					}
				}
			}
			gosub *act_get
			if ( stat == 0 ) {
				goto *label_2974
			}
			if ( stat == (-1) ) {
				goto *label_4158
			}
			if ( invctrl == INVCTRL_INV_FILE_GET ) {
				if ( invctrl(1) == 1 ) {
					gHeirDeed--
					if ( invctrl(1) == 1 ) {
						txt -1, lang("残り" + gHeirDeed + "個分のアイテムの相続権を持っている。", "You can claim " + gHeirDeed + " more heirloom" + _s2(gHeirDeed) + ".")
					}
				}
				if ( invctrl(1) == 4 ) {
					gSisterReward++
					invsubroutine = 0
					return 1
				}
			}
			screenupdate = -1
			gosub *screen_draw
			goto *label_2974
		}
		if ( invctrl == INVCTRL_EAT ) {
			if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *com_inventory_loop
			}
			screenupdate = -1
			gosub *screen_draw
			savecycle
			if ( cHunger(CHARA_PLAYER) > 10000 | gettrait(0, 191) < 0 ) {
				txt -1, lang("今はとても食べられない。", "Your are too full to eat."), lang("腹がさける…", "You are too bloated to eat any more."), lang("まだ腹は減っていない。", "Your stomach can't digest any more.")
				gosub *screen_draw
				goto *pc_turn
			}
			goto *act_eat
		}
		if ( invctrl == INVCTRL_EQUIP ) {
			if ( gettrait(cc, 161) != 0 ) {
				if ( iWeight(ci) >= 1000 ) {
					txt -1, lang("それは重すぎて装備できない。", "It's too heavy to equip.")
					goto *com_inventory_loop
				}
			}
			r1 = cc
			gosub *label_3590
			r1 = cc
			gosub *charaRefresh
			screenupdate = -1
			gosub *screen_draw
			snd SOUNDLIST_EQUIP1
			txtnew
			txt -1, lang(itemname(ci) + "を装備した。", "You equip " + itemname(ci) + ".")
			gEquipChange = 1
			if ( iStatus(ci) == ITEM_STATUS_CURSED ) {
				if ( godcheck(cc) == "fuuri" ) {
					txt -1, lang(name(cc) + "は呪いの神の寵愛を感じた。", "You feel the favor from God of curse.")
				}
				else {
					txt -1, lang(name(cc) + "は急に寒気がしてふるえた。", "You suddenly feel a chill and shudder.")
				}
			}
			if ( iStatus(ci) == ITEM_STATUS_DOOMED ) {
				if ( godcheck(cc) == "fuuri" ) {
					txt -1, lang(name(cc) + "は呪いの神に見守られている感じがした。", "You feel as God of curse is watching you intently.")
				}
				else {
					txt -1, lang(name(cc) + "は破滅への道を歩み始めた。", "You are now one step closer to doom.")
				}
			}
			if ( iStatus(ci) == ITEM_STATUS_BLESSED ) {
				txt -1, lang(name(cc) + "は何かに見守られている感じがした。", "You feel as someone is watching you intently.")
			}
			if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 5 ) {
				gosub *show_weaponStat
			}
			if ( cc == CHARA_PLAYER ) {
				menucycle = 1
			}
			goto *com_wear
		}
		if ( invctrl == INVCTRL_READ ) {
			screenupdate = -1
			gosub *screen_draw
			savecycle
			goto *act_read
		}
		if ( invctrl == INVCTRL_DRINK ) {
			screenupdate = -1
			gosub *screen_draw
			savecycle
			goto *act_drink
		}
		if ( invctrl == INVCTRL_ZAP ) {
			screenupdate = -1
			gosub *screen_draw
			savecycle
			goto *label_3597
		}
		if ( invctrl == INVCTRL_GIVE ) {
			if ( invally == 1 & iNum(ci) > 1 & cfg_transfernumber ) {
				display_msg screenmsgy, 2
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
				inputlog = "1"
				gosub *prompt_word
				in = int(inputlog)
				if ( in > iNum(ci) ) {
					in = iNum(ci)
				}
				if ( in == 0 | rtval == (-1) ) {
					screenupdate = -1
					gosub *screen_draw
					goto *com_inventory_loop
				}
			}
			else {
				in = 1
			}
			if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *com_inventory_loop
			}
			ti = inv_getfreeid(tc)
			if ( cSleep(tc) ) {
				txt -1, lang(name(tc) + "は眠っている。", name(tc) + " " + is(tc) + " sleeping.")
				snd SOUNDLIST_FAIL1
				goto *com_inventory_loop
			}
			if ( cdata(268, tc) ) {
				txt -1, lang(name(tc) + "は石になっている。", name(tc) + " " + is(tc) + " stoned.")
				snd SOUNDLIST_FAIL1
				goto *com_inventory_loop
			}
			if ( ti == (-1) ) {
				txt -1, lang(name(tc) + "はこれ以上持てない。", his(tc) + " inventory is full.")
				snd SOUNDLIST_FAIL1
				goto *com_inventory_loop
			}
			reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
			if ( iID(ci) == ITEM_ID_GIFT ) {
				ctalk 0, 983, 0, tc
				txt -1, lang("あなたは" + name(tc) + "に" + itemname(ci, in) + "をプレゼントした。", "You give " + name(tc) + " " + itemname(ci, in) + ".")
				if ( seasonal_check(SEASON_CHRISTMAS_EVE, FALSE) | seasonal_check(SEASON_CHRISTMAS, FALSE) & ogbit(9) == 0 ) {
					ctalk 0, 1277, 0, tc
				}
				iNum(ci) -= in
				gosub *label_1681
				if ( seasonal_check(SEASON_CHRISTMAS_EVE, FALSE) | seasonal_check(SEASON_CHRISTMAS, FALSE) & ogbit(9) == 0 ) {
					ctalk tc, 1327, 0, tc
					if ( stat == 0 ) {
						ctalk tc, 983, 0, tc
						if ( stat == 0 ) {
							txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」", " " + cnvtalk("Thank you!"))
						}
					}
				}
				else {
					ctalk tc, 983, 0, tc
					if ( stat == 0 ) {
						txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」", " " + cnvtalk("Thank you!"))
					}
				}
				modimp tc, giftvalue(iParam4(ci)) * in
				cEmoIcon(tc) = 17 + 100 * 3
				if ( seasonal_check(SEASON_CHRISTMAS_EVE, FALSE) | seasonal_check(SEASON_CHRISTMAS, FALSE) & ogbit(9) == 0 ) {
					isetgiftchristmas3 = 290, 287, 480, 556, 557, 558, 559, 626, 632, 637, 702
					isetgiftchristmas2 = 421, 422, 423, 424, 425, 426, 430
					isetgiftchristmas1 = 770, 640, 574, 553, 549
					if ( cImpression(tc) >= 100 ) {
						flt
						if ( cImpression(tc) >= 300 ) {
							itemcreate -1, isetgiftchristmas3(rnd(length(isetgiftchristmas3))), cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3
						}
						else {
							if ( cImpression(tc) >= 200 ) {
								itemcreate -1, isetgiftchristmas2(rnd(length(isetgiftchristmas2))), cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3
							}
							else {
								itemcreate -1, isetgiftchristmas1(rnd(length(isetgiftchristmas1))), cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3
							}
						}
						ctalk tc, 1277, tc, 0
						if ( stat == 0 ) {
							txt tc, lang("「メリー・クリスマス！」", " " + cnvtalk("Merry Christmas!"))
						}
						txt -1, lang("プレゼントのお返しをもらった。", "You've got a gift in return.")
					}
				}
				menucycle = 0
				invally = 0
				gosub *screen_draw
				goto *pc_turn
			}
			if ( isflower(ci) ) {
				if ( seasonal_check(SEASON_VALENTINES_DAY, FALSE) | seasonal_check(SEASON_AFTER_VALENTINES_DAY, FALSE) ) {
					ctalk 0, 983, 0, tc
					txt -1, lang("あなたは" + name(tc) + "に" + itemname(ci, in) + "をプレゼントした。", "You give " + name(tc) + " " + itemname(ci, in) + ".")
					if ( seasonal_check(SEASON_VALENTINES_DAY, FALSE) ) {
						ctalk 0, 1325, 0, tc
					}
					else {
						ctalk 0, 1326, 0, tc
					}
					iNum(ci) -= in
					gosub *label_1681
					if ( seasonal_check(SEASON_VALENTINES_DAY, FALSE) ) {
						ctalk tc, 1328, 0, tc
						if ( stat == 0 ) {
							ctalk tc, 983, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」", " " + cnvtalk("Thank you!"))
							}
						}
						modimp tc, giftvalue(iParam4(ci)) * in
						cEmoIcon(tc) = 17 + 100 * 3
					}
					else {
						ctalk tc, 1329, 0, tc
						if ( stat == 0 ) {
							ctalk tc, 983, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「え、これを" + _ore(3) + "にくれるの" + _ka(1) + "" + _thanks(2) + "」", " " + cnvtalk("Thank you!"))
							}
						}
					}
					if ( cImpression(tc) >= 100 ) {
						isetgiftvalentinesday3 = 7, 8, 9
						isetgiftvalentinesday2 = 5, 6, 7
						isetgiftvalentinesday1 = 2, 3, 4
						flt
						itemcreate -1, ITEM_ID_API_NUT, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1
						if ( cImpression(tc) >= 300 ) {
							iParam2(ci) = isetgiftvalentinesday3(rnd(length(isetgiftvalentinesday3)))
						}
						else {
							if ( cImpression(tc) >= 200 ) {
								iParam2(ci) = isetgiftvalentinesday2(rnd(length(isetgiftvalentinesday2)))
							}
							else {
								iParam2(ci) = isetgiftvalentinesday1(rnd(length(isetgiftvalentinesday1)))
							}
						}
						if ( seasonal_check(SEASON_VALENTINES_DAY, FALSE) ) {
							ctalk tc, 1325, tc, 0
						}
						else {
							ctalk tc, 1326, tc, 0
						}
						txt -1, lang("プレゼントのお返しをもらった。", "You've got a gift in return.")
					}
					menucycle = 0
					invally = 0
					gosub *screen_draw
					goto *pc_turn
				}
			}
			f = 0
			p = sSTR(tc) * 500 + sEND(tc) * 500 + sWeightLifting(tc) * 2500 + 25000
			if ( cId(tc) == CREATURE_ID_GOLDEN_KNIGHT ) {
				p *= 5
			}
			if ( inv_weight(tc) + double(iWeight(ci)) * in > p ) {
				f = 1
			}
			cnpcrole = 0
			if ( cId(tc) == CREATURE_ID_USER ) {
				if ( userdata2(5, cUNID(tc)) ) {
					cnpcrole = userdata2(5, cUNID(tc))
				}
			}
			if ( cId(tc) != CREATURE_ID_GOLDEN_KNIGHT & cId(tc) != CREATURE_ID_BARD & cnpcrole != 1 ) {
				if ( reftype == FILTER_FURNITURE ) {
					if ( iID(ci) != ITEM_ID_PICKAXE ) {
						f = 2
					}
				}
				if ( reftype == FILTER_JUNK ) {
					f = 3
				}
			}
			if ( iWeight(ci) < 0 ) {
				f = 4
			}
			if ( f ) {
				s = "", lang("重すぎ", "Too heavy!"), lang("無理", "No way."), lang("いらん", "I don't want it."), lang("イヤ！", "Never!")
				snd SOUNDLIST_FAIL1
				ctalk tc, 1231 + f, 0, tc
				if ( stat == 0 ) {
					txt tc, lang(name(tc) + "「" + s(f) + "」", cnvtalk(s(f)))
				}
				goto *com_inventory_loop
			}
			f = 0
			if ( cRelation(tc) == RELATION_ALLY ) {
				f = 1
			}
			else {
				itemfilter = ifiltercnv(ci)
				if ( iKnown(ci) < ITEM_KNOWN_QUALITY ) {
					snd SOUNDLIST_FAIL1
					ctalk tc, 1236, 0, tc
					if ( stat == 0 ) {
						txt tc, lang("「そんな得体の知れないものはいらない" + _yo() + "」", cnvtalk("I don't want it. It's too creepy."))
					}
					goto *com_inventory_loop
				}
				if ( iStatus(ci) <= ITEM_STATUS_CURSED ) {
					if ( cId(tc) == CREATURE_ID_STRAY_CAT & iID(ci) == ITEM_ID_SCROLL_RETURN & ogTitleReturningHome == 2 ) {
					}
					else {
						snd SOUNDLIST_FAIL1
						ctalk tc, 1237, 0, tc
						if ( stat == 0 ) {
							txt tc, lang("「それ、呪われてい" + _ru() + "」", cnvtalk("It's cursed!"))
						}
						goto *com_inventory_loop
					}
				}
				if ( reftype == FILTER_ITEM_SCROLL ) {
					f = 1
					if ( instr(itemfilter, 0, "/neg/") != (-1) ) {
						f = 0
					}
					if ( iID(ci) == ITEM_ID_SCROLL_TELEPORTATION | iID(ci) == ITEM_ID_SCROLL_MINOR_TELEPORTATION | iID(ci) == ITEM_ID_DEED | iID(ci) == ITEM_ID_DEED_MUSEUM | iID(ci) == ITEM_ID_DEED_SHOP | iID(ci) == ITEM_ID_DEED_FARM | iID(ci) == ITEM_ID_DEED_STORAGE_HOUSE | iID(ci) == ITEM_ID_DEED_RANCH | iID(ci) == ITEM_ID_TREASURE_MAP | iID(ci) == ITEM_ID_DEED_DUNGEON ) {
						f = 0
					}
				}
				if ( reftype == FILTER_ITEM_FOOD ) {
					if ( iMaterial(ci) != ITEM_MATERIAL_RAW | iParam3(ci) >= 0 ) {
						if ( cHunger(tc) <= 10000 ) {
							f = 1
							cHunger(tc) = 2000
						}
						else {
							ctalk tc, 1135, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「お腹いっぱいだからいらない" + _yo() + "」", cnvtalk("I'm Fulled."))
							}
							goto *com_inventory_loop
						}
					}
					else {
						ctalk tc, 1238, 0, tc
						if ( stat == 0 ) {
							txt tc, lang("「それ、腐ってい" + _ru() + "」", cnvtalk("It's rotted!"))
						}
						goto *com_inventory_loop
					}
				}
				if ( reftype == FILTER_ITEM_POTION ) {
					f = 1
					if ( refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_ITEM_POTION_ALE ) {
						if ( cDrunk(tc) ) {
							snd SOUNDLIST_FAIL1
							ctalk tc, 1239, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「もう飲めない" + _yo() + "」", cnvtalk("Enough for me."))
							}
							goto *com_inventory_loop
						}
					}
					if ( instr(itemfilter, 0, "/neg/") != (-1) ) {
						f = 0
					}
					if ( instr(itemfilter, 0, "/nogive/") != (-1) ) {
						f = 0
					}
					if ( cbit(CHARA_BIT_PREGNANT, tc) ) {
						if ( iID(ci) == ITEM_ID_POISON | iID(ci) == ITEM_ID_BOTTLE_DYE | iID(ci) == ITEM_ID_BOTTLE_SULFURIC ) {
							f = 1
							ctalk tc, 1240, 0, tc
							if ( stat == 0 ) {
								txt tc, lang("「おろす…」", cnvtalk("Abortion..."))
							}
						}
					}
				}
				if ( iID(ci) == ITEM_ID_ENGAGEMENT_RING | iID(ci) == ITEM_ID_ENGAGEMENT_AMULET ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						f = 2
					}
				}
			}
			if ( f ) {
				snd SOUNDLIST_EQUIP1
				txt -1, lang(itemname(ci, in) + "を渡した。", "You hand " + itemname(ci, in) + " to " + name(tc) + ".")
				ctalk 0, 1290, tc, 0
				if ( stat == 0 ) {
					ctalk 0, 1289, tc, 0
				}
				ctalk tc, 1292, 0, tc
				if ( stat == 0 ) {
					ctalk tc, 1291, 0, tc
				}
				if ( iID(ci) == ITEM_ID_ENGAGEMENT_RING | iID(ci) == ITEM_ID_ENGAGEMENT_AMULET ) {
					txtef COLOR_GREEN
					ctalk tc, 1256, cc, tc
					if ( stat == 0 ) {
						txt -1, lang(name(tc) + "は顔を赤らめた。", name(tc) + " blushes.")
					}
					txtef COLOR_GREEN
					ctalk tc, 982, 0, tc
					if ( ibit(ITEM_BIT_PRECIOUS, ci) == FALSE ) {
						modimp tc, 15 * in
					}
					cEmoIcon(tc) = 17 + 100 * 3
				}
				if ( iID(ci) == ITEM_ID_LOVE_POTION ) {
					if ( cbit(CHARA_BIT_MARRIED, tc) & implevel(cImpression(tc)) >= 8 ) {
						ctalk tc, 1139, cc, tc
						if ( stat == 0 ) {
							txt -1, lang(name(tc) + "は顔を赤らめた。", name(tc) + " blushes.")
						}
					}
					else {
						txtef COLOR_PURPLE
						txt -1, lang(name(tc) + "は激怒して" + itemname(ci, in) + "を叩き割った。", name(tc) + " throws it on the ground angrily.")
						snd SOUNDLIST_CRUSH2
						txtef COLOR_SKY_BLUE
						ctalk tc, 406, 0, tc
						if ( stat == 0 ) {
							ctalk tc, 1219, 0, tc
							if ( stat == 0 ) {
								txtef COLOR_SKY_BLUE
								txt tc, lang(name(tc) + "「サイテー！！」", cnvtalk("You scum!")), lang(name(tc) + "「このヘンタイ！」", cnvtalk("What are you trying to do!")), lang(name(tc) + "「ガード！ガード！ガード！」", cnvtalk("Guard! Guard! Guard!"))
							}
						}
						modimp tc, (-20) * in
						cEmoIcon(tc) = 18 + 100 * 3
						iNum(ci) -= in
						goto *label_2974
					}
				}
				if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_SPELLBOOK ) {
					if ( readablecheck(tc, ci) == 0 ) {
						txtef COLOR_BLUE
						txt tc, lang(name(tc) + "「読めないよ？」", cnvtalk("I can't read this."))
					}
				}
				iNum(ci) -= in
				if ( f <= 1 ) {
					item_copy ci, ti
					iNum(ti) = in
					item_stack tc, ti, 1
				}
				ci = ti
				rc = tc
				gosub *label_3936
				if ( iequiploc(ci) != 0 ) {
					gosub *label_3941
				}
				if ( tc < MAX_CHARA_FOLLOWER ) {
					create_pcpic tc, 1
				}
				r1 = tc
				gosub *charaRefresh
				gosub *label_1681
				if ( invally == 1 ) {
					goto *label_2974
				}
				gosub *screen_draw
				goto *label_4158
			}
			snd SOUNDLIST_FAIL1
			txt -1, lang(name(tc) + "は" + itemname(ci, in) + "を受け取らない。", name(tc) + " refuse" + _s(tc) + " to take " + itemname(ci, in) + ".")
			goto *com_inventory_loop
		}
		if ( invctrl == INVCTRL_IDENTIFY ) {
			screenupdate = -1
			gosub *screen_draw
			item_identify ci, -1, efp
			if ( idtresult == 0 ) {
				txt -1, lang("新しい知識は得られなかった。より上位の鑑定で調べる必要がある。", "You need higher identification to gain new knowledge.")
			}
			else {
				if ( idtresult < 3 ) {
					txt -1, lang("それは" + itemname(ci, iNum(ci)) + "だと判明したが、完全には鑑定できなかった。", "The item is half-identified as " + itemname(ci, 1) + ".")
				}
				else {
					txt -1, lang("それは" + itemname(ci, iNum(ci)) + "だと完全に判明した。", "The item is fully identified as " + itemname(ci, 1) + ".")
				}
			}
			item_stack CHARA_PLAYER, ci, 1
			invsubroutine = 0
			if ( idtresult == 3 ) {
				efp -= limitmin(iIdtLevel(ci), 250)
				if ( efp > 0 ) {
					reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
					inv_getheader 0
					p = 0, 0
					repeat invrange, invhead
						if ( efp <= 0 ) {
							break
						}
						if ( iNum(cnt) == 0 | iKnown(cnt) >= ITEM_KNOWN_FULL ) {
							continue
						}
						p(1)++
						item_identify cnt, -1, efp
						efp -= limitmin(iIdtLevel(cnt), 250)
						if ( idtresult != 0 ) {
							p++
							item_stack CHARA_PLAYER, cnt, 1
						}
					loop
					if ( p != 0 & p(1) != 0 ) {
						txt -1, lang("さらに、" + p(1) + "個の未判明のアイテムのうち、" + p + "個のアイテムが判明した。", "" + p + " out of " + p(1) + " unknown items are identified.")
					}
				}
			}
			return 1
		}
		if ( invctrl == INVCTRL_USE ) {
			savecycle
			goto *act_use
		}
		if ( invctrl == INVCTRL_COOK ) {
			screenupdate = -1
			gosub *screen_draw
			invsubroutine = 0
			return 1
		}
		if ( invctrl == INVCTRL_OPEN ) {
			screenupdate = -1
			gosub *screen_draw
			savecycle
			goto *act_open
		}
		if ( invctrl == INVCTRL_DIP_SOURCE ) {
			cidip = ci
			savecycle
			invctrl = INVCTRL_DIP
			txtnew
			snd SOUNDLIST_POP2
			goto *label_2974
		}
		if ( invctrl == INVCTRL_DIP ) {
			screenupdate = -1
			gosub *screen_draw
			goto *act_dip
		}
		if ( invctrl == INVCTRL_OFFER ) {
			if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *com_inventory_loop
			}
			screenupdate = -1
			gosub *screen_draw
			savecycle
			goto *god_offer
		}
		if ( invctrl == INVCTRL_TRADE_TARGET ) {
			citrade = ci
			invctrl = INVCTRL_TRADE_OFFER
			snd SOUNDLIST_POP2
			goto *label_2974
		}
		if ( invctrl == INVCTRL_TRADE_OFFER ) {
			if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
				goto *com_inventory_loop
			}
			if ( cRowAct(tc) != ACTION_NONE ) {
				cRowAct(tc) = ACTION_NONE, 0
				cItemUsing(tc) = 0
			}
			snd SOUNDLIST_EQUIP1
			if ( ibit(ITEM_BIT_DROP, citrade) ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), citrade) = 0
				ibitmod ITEM_BIT_DROP, citrade, FALSE
			}
			if ( iEquip(citrade) != 0 ) {
				p = iEquip(citrade)
				cdata(p, tc) = cdata(p, tc) / EXT_EQUIP_SLOTS * 10000
				iEquip(citrade) = 0
			}
			ti = citrade
			gosub *act_exchange
			txt -1, lang(itemname(citrade) + "を" + itemname(ci) + "と交換した。", "You receive " + itemname(citrade) + " in exchange for " + itemname(ci) + ".")
			convertartifact ci
			rc = tc
			ci = citrade
			if ( cAiItem(rc) == ci ) {
				cAiItem(rc) = 0
			}
			gosub *label_3941
			if ( tc >= MAX_CHARA_FOLLOWER & cRole(tc) != ROLE_PET_SENTRY & cRole(tc) != ROLE_PET_MAID & eqfaction(tc, "petshop") == 0 ) {
				gosub *supplyEquip
			}
			gosub *chara_adjustInv
			r1 = tc
			gosub *charaRefresh
			gosub *label_1681
			invsubroutine = 0
			return 1
		}
		if ( invctrl == INVCTRL_MATERIAL_ENCHANT ) {
			if ( invctrl(1) == 4 | invctrl(1) == 5 ) {
				if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
					snd SOUNDLIST_FAIL1
					txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
					goto *com_inventory_loop
				}
			}
			item_separate ci
			invsubroutine = 0
			return 1
		}
		if ( invctrl == INVCTRL_PUT ) {
			if ( invctrl(1) == 0 ) {
				snd SOUNDLIST_INV
				if ( gArea  == AREA_LUMIEST ) {
					if ( iNum(ci) > 1 ) {
						txt -1, lang(itemname(ci, 1) + "をいくつ納入する？ (1〜" + iNum(ci) + ") ", "How many? (1 to " + iNum(ci) + ")")
						display_msg screenmsgy, 1
						val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
						inputlog = "" + iNum(ci)
						gosub *prompt_word
						in = int(inputlog)
						if ( in > iNum(ci) ) {
							in = iNum(ci)
						}
						if ( in == 0 | rtval == (-1) ) {
							goto *com_inventory_loop
						}
					}
					else {
						in = 1
					}
					flagMageGuildNorma -= (iParam1(ci) + 1) * in
					if ( flagMageGuildNorma <= 0 ) {
						flagMageGuildNorma = 0
					}
					txtef COLOR_GREEN
					txt -1, lang(itemname(ci, 1) + "を" + in + "冊納入した", "You deliver " + itemname(ci) + ". ") + "(" + (iParam1(ci) + 1) * in + " Guild Point)"
					if ( flagMageGuildNorma == 0 ) {
						snd SOUNDLIST_COMPLETE1
						txtef COLOR_GREEN
						txt -1, lang("ノルマを達成した！", "You fulfill the quota!")
					}
					iNum(ci) -= in
				}
				else {
					qParam2(gQuestRef) += iWeight(ci) * iNum(ci)
					txtef COLOR_GREEN
					txt -1, lang(itemname(ci) + "を納入した。", "You deliver " + itemname(ci) + ".") + " +" + cnvweight(iWeight(ci) * iNum(ci)) + lang("  納入済み", " Delivered ") + "(" + cnvweight(qParam2(gQuestRef)) + ") " + lang("納入ノルマ", "Quota ") + "(" + cnvweight(qParam1(gQuestRef)) + ")"
					iNum(ci) = 0
				}
				gosub *label_1681
				goto *label_2974
			}
			if ( invctrl(1) == 2 ) {
				if ( cGold(CHARA_PLAYER) < iSubName(ci) & ncgGoldOverflow == 0 ) {
					snd SOUNDLIST_FAIL1
					txt -1, lang("金が足りない…", "You don't have enough money.")
					goto *com_inventory_loop
				}
				if ( gBill <= 0 ) {
					snd SOUNDLIST_FAIL1
					txt -1, lang("まだ納税する必要はない。", "You don't have to pay your tax yet.")
					goto *label_2974
				}
				costvalue = iSubName(ci)
				cGold(CHARA_PLAYER) -= iSubName(ci)
				gosub *label_0422
				snd SOUNDLIST_PAYGOLD1
				txtef COLOR_GREEN
				txt -1, lang(itemname(ci) + "を支払った。", "You pay " + itemname(ci) + ".")
				repeat 245
					if ( cExist(cnt) == CHAR_STATE_ALIVE & (cRole(cnt) == ROLE_PET_SENTRY | cRole(cnt) == ROLE_PET_MAID | eqfaction(cnt, "petshop") | cnt < 16) ) {
						if ( synccheck(cnt, -1) ) {
							ctalk cnt, 1335, cnt, cnt
						}
					}
				loop
				throwsstpevent "PayTax", 0, "", costvalue
				iNum(ci)--
				gBill--
				gosub *label_1681
				screenupdate = -1
				gosub *screen_draw
				goto *label_2974
			}
		}
		if ( invctrl == INVCTRL_ALLYGET ) {
			if ( invally == 1 & iNum(ci) > 1 & cfg_transfernumber ) {
				display_msg screenmsgy, 2
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, iNum(ci)
				inputlog = "1"
				gosub *prompt_word
				in = int(inputlog)
				if ( in > iNum(ci) ) {
					in = iNum(ci)
				}
				if ( in == 0 | rtval == (-1) ) {
					screenupdate = -1
					gosub *screen_draw
					goto *com_inventory_loop
				}
			}
			else {
				in = 1
			}
			ti = inv_getfreeid(CHARA_PLAYER)
			if ( ti == (-1) ) {
				txt -1, lang("バックパックが一杯だ。", "Your inventory is full.")
				goto *com_inventory_loop
			}
			f = 0
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ORE & iID(ci) != ITEM_ID_SMALL_MEDAL & implevel(cImpression(tc)) < 7 ) {
				f = 2
			}
			if ( f != 0 ) {
				s = "", lang("やだ", "No!"), lang("あげないよ", "It's mine."), lang("だめ", "Get off!"), lang("イヤ！", "Never.")
				snd SOUNDLIST_FAIL1
				ctalk tc, 1274, cc, tc
				if ( stat == 0 ) {
					txtef COLOR_BLUE
					txt tc, lang(name(tc) + "「" + s(f) + "」", cnvtalk(s(f)))
				}
				goto *com_inventory_loop
			}
			if ( iEquip(ci) != 0 ) {
				if ( iStatus(ci) == ITEM_STATUS_CURSED | iStatus(ci) == ITEM_STATUS_DOOMED ) {
					txt -1, lang(itemname(ci) + "は呪われていて外せない。", "" + itemname(ci) + " is cursed and can't be taken off.")
					goto *label_2974
				}
				p = iEquip(ci)
				cdata(p, tc) = cdata(p, tc) / EXT_EQUIP_SLOTS * 10000
				iEquip(ci) = 0
			}
			if ( iID(ci) == ITEM_ID_ENGAGEMENT_RING | iID(ci) == ITEM_ID_ENGAGEMENT_AMULET ) {
				if ( cbit(CHARA_BIT_MARRIED, tc) & iID(ci) == ITEM_ID_ENGAGEMENT_RING & ibit(ITEM_BIT_PRECIOUS, ci) == TRUE ) {
					txt -1, lang(name(tc) + "から思い出の" + itemname(ci, in) + "を大事に受け取った。", name(tc) + " take " + itemname(ci, in) + " with good care.")
					item_copy ci, ti
					iNum(ti) = in
					item_stack CHARA_PLAYER, ti, 1
					convertartifact ti
				}
				else {
					if ( implevel(cImpression(tc)) >= 8 & cbit(CHARA_BIT_MARRIED, tc) ) {
						txt -1, lang(name(tc) + "は思い出の" + itemname(ci, in) + "を大事にしまい込んだ。", name(tc) + " puts away " + itemname(ci, in) + " with good care.")
						ctalk tc, 1028, 0, tc
					}
					else {
						txtef COLOR_PURPLE
						ctalk tc, 1257, cc, tc
						if ( stat == 0 ) {
							txt -1, lang(name(tc) + "は激怒して" + itemname(ci, in) + "を飲み込んだ。", name(tc) + " swallows " + itemname(ci, in) + " angrily.")
						}
						txtef COLOR_PURPLE
						ctalk tc, 981, 0, tc
						snd SOUNDLIST_OFFER1
						modimp tc, (-20) * in
						cEmoIcon(tc) = 18 + 100 * 3
					}
				}
				iNum(ci) -= in
				goto *label_2974
			}
			snd SOUNDLIST_EQUIP1
			if ( ibit(ITEM_BIT_DROP, ci) ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
				ibitmod ITEM_BIT_DROP, ci, FALSE
			}
			if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
				in = iNum(ci)
			}
			txt -1, lang(itemname(ci, in) + "を受け取った。", "You take " + itemname(ci, in) + ".")
			ctalk tc, 1290, 0, tc
			if ( stat == 0 ) {
				ctalk tc, 1289, 0, tc
			}
			ctalk 0, 1292, tc, 0
			if ( stat == 0 ) {
				ctalk 0, 1291, tc, 0
			}
			if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
				se_moneymod 0, in
				iNum(ci) = 0
			}
			else {
				item_copy ci, ti
				iNum(ci) -= in
				iNum(ti) = in
				item_stack CHARA_PLAYER, ti, 1
				convertartifact ti
			}
			rc = tc
			gosub *label_3941
			if ( tc < MAX_CHARA_FOLLOWER ) {
				create_pcpic tc, 1
			}
			r1 = tc
			gosub *charaRefresh
			gosub *label_1681
			goto *label_2974
		}
		if ( invctrl == INVCTRL_THROW ) {
			savecycle
			gosub *label_2584
			if ( stat != 1 ) {
				if ( stat == 0 ) {
					txt -1, lang("その場所は見えない。", "You can't see the location.")
					gosub *screen_draw
				}
				goto *pc_turn
			}
			if ( chipm(CHIPM_ATTRIB, mapId(tlocx, tlocy)) & CHIPM_ATTRIB_CANT_PASS ) {
				txt -1, lang("そこには投げられない。", "The location is blocked.")
				gosub *screen_draw
				goto *pc_turn
			}
			goto *act_throw
		}
		if ( invctrl == INVCTRL_PICKPOCKET ) {
			gosub *label_3711
			invsubroutine = 0
			return 1
		}
		if ( invctrl == INVCTRL_METAL ) {
			txtnew
			ti = inv_getfreeid(CHARA_PLAYER)
			if ( ti == (-1) ) {
				txt -1, lang("これ以上持てない。", "Your inventory is full.")
				snd SOUNDLIST_FAIL1
				goto *label_2974
			}
			item_find ITEM_ID_SMALL_MEDAL, ITEM_FIND_MODE_DBID, ITEM_FIND_LOCATION_CHARAS
			if ( stat != (-1) ) {
				i = stat
				p = iNum(i)
			}
			else {
				p = 0
			}
			if ( ogTitleCensored == 2 ) {
				value_item = limitmin(calcmedalvalue(ci) / 2, 1)
			}
			else {
				value_item = calcmedalvalue(ci)
			}
			max_item_num = p / value_item
			if ( max_item_num < 1 ) {
				txt -1, lang("メダルの数が足りない…", "You don't have enough coins.")
				snd SOUNDLIST_FAIL1
				goto *label_2974
			}
			txt -1, lang(itemname(ci, 1) + "をいくつ交換する？ (1〜" + max_item_num + ") ", "How many? (1 to " + max_item_num + ")")
			display_msg screenmsgy, 2
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, max_item_num
			inputlog = "" + 1
			gosub *prompt_word
			in = int(inputlog)
			if ( in > max_item_num ) {
				in = max_item_num
			}
			if ( in == 0 | rtval == (-1) ) {
				screenupdate = -1
				gosub *screen_draw
				cc = CHARA_PLAYER
				goto *com_inventory_loop
			}
			if ( p < value_item * in ) {
				txt -1, lang("メダルの数が足りない…", "You don't have enough coins.")
				snd SOUNDLIST_FAIL1
				goto *label_2974
			}
			iNum(i) -= value_item * in
			snd SOUNDLIST_PAYGOLD1
			item_copy ci, ti
			iNum(ti) = in
			txt -1, lang("" + itemname(ti) + "を受け取った！", "You receive " + itemname(ti) + "!")
			item_stack CHARA_PLAYER, ti, 1
			convertartifact ti, 1
			itemmemory(0, iID(ti)) = 1
			if ( areaId(gArea ) == 61 ) {
				ncgSecretZoneItemsObtained += in
				if ( ncgSecretZoneItemsObtained >= 10 ) {
					newtitle TITLE_REDCAP
				}
			}
			goto *label_2974
		}
		if ( invctrl == 35 ) {
			txtnew
			ti = inv_getfreeid(CHARA_PLAYER)
			if ( ti == (-1) ) {
				txt -1, lang("これ以上持てない。", "Your inventory is full.")
				snd SOUNDLIST_FAIL1
				goto *label_2974
			}
			item_find ITEM_ID_FEAPPLE, ITEM_FIND_MODE_DBID, ITEM_FIND_LOCATION_CHARAS
			if ( stat != (-1) ) {
				i = stat
				p = iNum(i)
			}
			else {
				p = 0
			}
			value_item = calcfeavalue(ci)
			max_item_num = p / value_item
			if ( max_item_num < 1 ) {
				txt -1, lang("フェアリンゴの数が足りない…", "You don't have enough coins.")
				snd SOUNDLIST_FAIL1
				goto *label_2974
			}
			txt -1, lang(itemname(ci, 1) + "をいくつ交換する？ (1〜" + max_item_num + ") ", "How many? (1 to " + max_item_num + ")")
			display_msg screenmsgy, 2
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, max_item_num
			inputlog = "" + 1
			gosub *prompt_word
			in = int(inputlog)
			if ( in > max_item_num ) {
				in = max_item_num
			}
			if ( in == 0 | rtval == (-1) ) {
				screenupdate = -1
				gosub *screen_draw
				cc = CHARA_PLAYER
				goto *com_inventory_loop
			}
			if ( p < calcfeavalue(ci) * in ) {
				txt -1, lang("フェアリンゴの数が足りない…", "You don't have enough coins.")
				snd SOUNDLIST_FAIL1
				goto *label_2974
			}
			iNum(i) -= calcfeavalue(ci) * in
			snd SOUNDLIST_PAYGOLD1
			item_copy ci, ti
			iNum(ti) = in
			txt -1, lang("" + itemname(ti) + "を受け取った！", "You receive " + itemname(ti) + "!")
			item_stack CHARA_PLAYER, ti, 1
			convertartifact ti, 1
			itemmemory(0, iID(ti)) = 1
			goto *label_2974
		}
		if ( invctrl == 30 ) {
			item_separate ci
			invsubroutine = 0
			return 1
		}
		if ( invctrl == 31 ) {
			invsubroutine = 0
			return 1
		}
		if ( invctrl == INVCTRL_MARK_ITEM ) {
			invsubroutine = 0
			return 1
		}
		if ( invctrl == 33 ) {
			invsubroutine = 0
			return 1
		}
		if ( invctrl == 34 ) {
			invsubroutine = 0
			return 1
		}
	}
	if ( invctrl == INVCTRL_INFO | invctrl == INVCTRL_DROP | invctrl == INVCTRL_GET | invctrl == INVCTRL_EAT | invctrl == INVCTRL_EQUIP | invctrl == INVCTRL_GIVE | invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_METAL | invctrl == 35 ) {
		if ( key == key_drink ) {
			hack_equipfilter = 1
			gosub *label_4915
			equipfilter = stat
			oom_sort = 1
			screenupdate = -1
			gosub *screen_draw
			goto *com_inventory
		}
	}
	if ( key == key_wear ) {
		if ( invctrl == INVCTRL_ALLYGET ) {
			var_is_pet_wear = 1
			menucycle = 0
			cc = tc
			gosub *com_wear
			var_is_pet_wear = 0
			menucycle = 1
			goto *com_inventory
		}
	}
	if ( key == key_identify ) {
		if ( listmax != 0 ) {
			ci = list(0, pagesize * page + cs)
			listmax_bk = listmax
			pagesize_bk = pagesize
			pagemax_bk = pagemax
			listnumber = pagesize * page + cs
			gosub *com_inventory_loop_WEND1
			goto *com_inventory
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_inventory_loop
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_inventory_loop
		}
	}
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			if ( dropcontinue ) {
				i = 4
			}
			else {
				if ( invally == 1 ) {
					i = 2
				}
				else {
					if ( invcontainer ) {
						i = 3
					}
					else {
						if ( mType == MAP_TYPE_WORLD ) {
							i = 1
						}
						else {
							i = 0
						}
					}
				}
			}
			p = -1
			repeat 12
				if ( invctrl == cycle(cnt, i) ) {
					p = cnt
					break
				}
			loop
			if ( p != (-1) ) {
				if ( key == key_next ) {
					p++
					if ( cycle(p, i) == (-1) ) {
						p = 0
					}
				}
				if ( key == key_prev ) {
					p--
					if ( p < 0 ) {
						p = cyclemax(i)
					}
				}
				if ( invctrl != cycle(p, i) ) {
					if ( cycle(p, i) == 1 | cycle(p, i) == 2 | cycle(p, i) == 3 | cycle(p, i) == 5 | cycle(p, i) == 6 | cycle(p, i) == 10 ) {
					}
					else {
						equipfilter = 0
					}
					invctrl = cycle(p, i)
					snd SOUNDLIST_INV
					screenupdate = -1
					gosub *screen_draw
					goto *label_2974
				}
			}
		}
	}
	if ( key == key_read & cfg_nc_itemcount != 0 ) {
		if ( invctrl == INVCTRL_INFO ) {
			ci = list(0, pagesize * page + cs)
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) > FILTER_ITEM_MIN ) {
				if ( ibit(22, ci) == FALSE ) {
					p = 0
					inv_getheader 0
					repeat invrange, invhead
						if ( p == 5 ) {
							break
						}
						if ( iNum(cnt) == 0 ) {
							continue
						}
						if ( ibit(22, cnt) ) {
							p++
						}
					loop
					if ( p == 5 ) {
						txt -1, lang("これ以上数を覚えられない。", "You cant memory " + itemname(ci) + " as count.")
					}
					else {
						ibitmod 22, ci, TRUE
						txt -1, lang(itemname(ci) + "の数を覚えることにした。", "You memory " + itemname(ci) + " as count.")
					}
				}
				else {
					ibitmod 22, ci, FALSE
					txt -1, lang(itemname(ci) + "の数を覚えるのをやめた。", "You stop memory " + itemname(ci) + " as count.")
				}
			}
			else {
				txt -1, lang(itemname(ci) + "の数を覚えても意味がない。", "Cant memory " + itemname(ci) + " as count.")
			}
		}
	}
	if ( key == key_mode3 ) {
		if ( invctrl == INVCTRL_DROP & dropcontinue == 0 ) {
			txt -1, lang("本当に全てのアイテムを置く？", "Really put all the items?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				item_count = 0
				inv_getheader 0
				repeat invrange, invhead
					if ( inv_getspace(-1) == 0 | (mMaxInv != 0 & inv_sum(-1) > mMaxInv) ) {
						break
					}
					ci = cnt
					if ( ibit(ITEM_BIT_NO_DROP, ci) | (areaId(gArea ) == AREA_SHELTER & refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_CARGO_TRADE) | iNum(ci) == 0 ) {
						continue
					}
					if ( iEquip(ci) != 0 ) {
						continue
					}
					item_count++
					in = iNum(ci)
					dropval = 0
					gosub *act_drop
				loop
				nc_intb_001 = item_count
				item_count = 0
				snd SOUNDLIST_DROP1
				txtef COLOR_DEFAULT
				txt -1, lang("" + nc_intb_001 + "個のアイテムを置いた。", "put" + nc_intb_001 + "items on the floor.")
				goto *pc_turn
			}
		}
		if ( invctrl == INVCTRL_GET ) {
			txt -1, lang("本当に全てのアイテムを拾う？", "Really pickup all the items?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				item_count = 0
				inv_getheader -1
				repeat invrange, invhead
					if ( inv_getspace(CHARA_PLAYER) == 0 ) {
						break
					}
					ci = cnt
					if ( iX(ci) != cX(CHARA_PLAYER) | iY(ci) != cY(CHARA_PLAYER) ) {
						continue
					}
					if ( iProperty(ci) != PROP_NONE | iNum(ci) == 0 ) {
						continue
					}
					item_count++
					in = iNum(ci)
					gosub *act_get
				loop
				nc_intb_001 = item_count
				item_count = 0
				snd SOUNDLIST_DROP1
				txtef COLOR_DEFAULT
				txt -1, lang("" + nc_intb_001 + "個のアイテムを拾った。", "pickup" + nc_intb_001 + "items.")
				goto *pc_turn
			}
		}
		if ( invctrl == INVCTRL_GIVE ) {
			if ( cImpression(tc) >= 100 ) {
				if ( cGold(CHARA_PLAYER) == 0 & ncgGoldOverflow == 0 ) {
					txt -1, lang("あなたは財布を開いてがっかりした…", "You check your wallet and shake your head.")
				}
				else {
					if ( cGold(tc) == 2147483647 ) {
						txt -1, lang(name(tc) + "はこれ以上金貨を持てない。", name(tc) + " can't have any more gp.")
					}
					else {
						nc_intb_001 = cGold(CHARA_PLAYER)
						if ( ncgGoldOverflow > 0 ) {
							nc_intb_001 = 2147483647
						}
						if ( nc_intb_001 > 2147483647 - cGold(tc) ) {
							nc_intb_001 = 2147483647 - cGold(tc)
						}
						txt -1, lang("いくら渡す？", "How much do I give?")
						val = (windoww - 240) / 2 + inf_screenx, winposy(60), 10, 0, nc_intb_001
						inputlog = "0"
						gosub *prompt_word
						in = int(inputlog)
						if ( in > 0 ) {
							costvalue = in
							snd SOUNDLIST_PAYGOLD1
							cGold(tc) += in
							cGold(CHARA_PLAYER) -= in
							gosub *label_0422
							ctalk 0, 1156, 0, tc
							ctalk tc, 1157, tc, 0
							txt -1, lang("" + in + "gpを" + name(tc) + "に渡した。", "Gave " + in + "gp to " + name(tc))
						}
					}
				}
			}
		}
	}
	if ( key == key_mode2 ) {
		if ( invctrl == INVCTRL_INFO ) {
			ci = list(0, pagesize * page + cs)
			if ( ibit(ITEM_BIT_NO_DROP, ci) == FALSE ) {
				ibitmod ITEM_BIT_NO_DROP, ci, TRUE
				txt -1, lang(itemname(ci) + "を大事なものに指定した。", "You set " + itemname(ci) + " as no-drop.")
			}
			else {
				ibitmod 22, ci, FALSE
				ibitmod ITEM_BIT_NO_DROP, ci, FALSE
				txt -1, lang(itemname(ci) + "はもう大事なものではない。", itemname(ci) + " is no longer set as no-drop.")
			}
		}
		if ( invctrl == INVCTRL_DROP ) {
			if ( dropcontinue == 0 ) {
				txt -1, lang("続けてアイテムを置くことができる。", "You can continuously drop items.")
				dropcontinue = 1
				snd SOUNDLIST_INV
				screenupdate = -1
				gosub *screen_draw
				goto *label_2974
			}
		}
	}
	if ( key == key_mode ) {
		if ( showresist == 1 ) {
			showresist = 0
		}
		else {
			showresist = 1
		}
		snd SOUNDLIST_POP1
		goto *com_inventory_loop
	}
	if ( equipfilter != 0 & key == key_search ) {
		oom_sort = 1 - oom_sort
		screenupdate = -1
		gosub *screen_draw
		goto *label_2982
	}
	if ( cfg_equipex == 1 ) {
		if ( key == key_msglog ) {
			if ( showresist == 1 ) {
				showressub++
				if ( equipfilter < 0 ) {
					if ( showressub > 3 ) {
						showressub = 0
					}
				}
				else {
					if ( showressub > 3 ) {
						showressub = 0
					}
					if ( showressub > 1 ) {
						showressub = 3
					}
				}
				snd SOUNDLIST_POP1
			}
			goto *com_inventory_loop
		}
	}

	if ( key == key_cancel ) {
		if ( equipfilter != 0 ) {
			hack_equipfilter = 1
			equipfilter = 0
			screenupdate = -1
			gosub *screen_draw
			goto *com_inventory
		}
*com_inventory_end
		savecycle
		if ( invctrl == INVCTRL_INV_FILE_GET ) {
			if ( invctrl(1) == 0 ) {
				if ( listmax > 0 ) {
					txt -1, lang("まだアイテムが残っているがいい？", "Really leave these items?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval != 0 ) {
						goto *com_inventory_loop
					}
				}
			}
		}
		if ( invctrl != INVCTRL_EQUIP | invctrl(1) != 1 ) {
			cc = CHARA_PLAYER
		}
		efcancel = 1
		if ( invsubroutine == 1 ) {
			invsubroutine = 0
			return 0
		}
		if ( invctrl == INVCTRL_EQUIP ) {
			screenupdate = -1
			gosub *screen_draw
			if ( cc == CHARA_PLAYER ) {
				menucycle = 1
			}
			goto *com_wear
		}
		if ( invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_INV_FILE_GET | invctrl == INVCTRL_METAL | invctrl == 35 ) {
			goto *label_3853
		}
		if ( invally == 1 ) {
			invally = 0
		}
		if ( dropcontinue ) {
			dropcontinue = 0
			goto *label_4158
		}
		screenupdate = 0
		gosub *screen_draw
		goto *pc_turn
	}
	if ( invctrl == INVCTRL_EAT | invctrl == INVCTRL_READ | invctrl == INVCTRL_DRINK | invctrl == INVCTRL_ZAP | invctrl == INVCTRL_USE | invctrl == INVCTRL_OPEN | invctrl == INVCTRL_THROW ) {
		if ( key == "sc" ) {
			p = list(0, pagesize * page + cs)
			if ( iWeight(p) < 0 ) {
				snd SOUNDLIST_FAIL1
				txt -1, lang("荷車の荷物は登録できない。", "You can't make a shortcut for cargo stuff.")
				goto *label_2974
			}
			snd SOUNDLIST_OK1
			p = iID(list(0, pagesize * page + cs)) + invctrl * 10000 + iCItemIdx(list(0, pagesize * page + cs)) * 10000 * 100
			p1 = iStatus(list(0, pagesize * page + cs))
			p2 = 0
			if ( iKnown(list(0, pagesize * page + cs)) < ITEM_KNOWN_FULL ) {
				p1 = -3
			}
			if ( refitem(iID(list(0, pagesize * page + cs)), DBSPEC_TYPE, list(0, pagesize * page + cs)) == FILTER_ITEM_FOOD ) {
				p2 = iParam2(list(0, pagesize * page + cs))
			}
			if ( ogdata(36 + sc) == p & (stgdata(36 + sc) == p1 & stgdata(56 + sc) == p2 | cfg_st_shortcut == 0) ) {
				ogdata(36 + sc) = 0
				stgdata(36 + sc) = 0
				stgdata(56 + sc) = 0
				goto *com_inventory_loop
			}
			repeat 20
				if ( ogdata(36 + cnt) == p & (stgdata(36 + cnt) == p1 & stgdata(56 + cnt) == p2 | cfg_st_shortcut == 0) ) {
					ogdata(36 + cnt) = 0
					stgdata(36 + cnt) = 0
					stgdata(56 + cnt) = 0
					ncgsdata(cnt) = ""
				}
			loop
			ogdata(36 + sc) = p
			stgdata(36 + sc) = p1
			stgdata(56 + sc) = p2
			ncgsdata(sc) = ""
			repeat 20
				if ( gdata(STARTING_GDATA_SHORTCUT + cnt) == p ) {
					gdata(STARTING_GDATA_SHORTCUT + cnt) = 0
				}
			loop
			gdata(STARTING_GDATA_SHORTCUT + sc) = p
			txt -1, lang("{" + sc + "}キーにショートカットを割り当てた。", "You have assigned the shortcut to {" + sc + "} key.")
			goto *com_inventory_loop
		}
	}

*com_inventory_loop_WHILE1_CONTINUE
	goto *com_inventory_loop_WHILE1
	goto *com_inventory_loop_WEND1

#defcfunc trimdesc str trimdesc_arg1, int trimdesc_arg2
	locvar_trimdesc_q = trimdesc_arg1
	repeat
		await
		locvar_trimdesc_p = instr(locvar_trimdesc_q, 0, "\t")
		if ( locvar_trimdesc_p != (-1) ) {
			locvar_trimdesc_q = strmid(locvar_trimdesc_q, 0, locvar_trimdesc_p) + strmid(locvar_trimdesc_q, locvar_trimdesc_p + 1, 99999)
			continue
		}
		if ( trimdesc_arg2 == 1 ) {
			locvar_trimdesc_p = instr(locvar_trimdesc_q, 0, "\n")
			if ( locvar_trimdesc_p != (-1) ) {
				locvar_trimdesc_q = strmid(locvar_trimdesc_q, 0, locvar_trimdesc_p) + strmid(locvar_trimdesc_q, locvar_trimdesc_p + 1, 99999)
				continue
			}
			locvar_trimdesc_p = instr(locvar_trimdesc_q, 0, "#")
			if ( locvar_trimdesc_p != (-1) ) {
				locvar_trimdesc_q = strmid(locvar_trimdesc_q, 0, locvar_trimdesc_p)
			}
			if ( jp ) {
				if ( strmid(locvar_trimdesc_q, strlen(locvar_trimdesc_q) - 3, 2) == "。" ) {
					locvar_trimdesc_q = strmid(locvar_trimdesc_q, 0, strlen(locvar_trimdesc_q) - 3)
				}
			}
			else {
				locvar_trimdesc_p = instr(locvar_trimdesc_q, 0, ",")
				if ( locvar_trimdesc_p != (-1) ) {
					locvar_trimdesc_q = strmid(locvar_trimdesc_q, 0, locvar_trimdesc_p) + "." + strmid(locvar_trimdesc_q, locvar_trimdesc_p + 1, 99999)
					continue
				}
			}
		}
		if ( trimdesc_arg2 == 2 ) {
			locvar_trimdesc_p = instr(locvar_trimdesc_q, 0, "#")
			if ( locvar_trimdesc_p != (-1) ) {
				locvar_trimdesc_q = strmid(locvar_trimdesc_q, 0, locvar_trimdesc_p) + strmid(locvar_trimdesc_q, locvar_trimdesc_p + 1, 99999)
				continue
			}
		}
		break
	loop
	return locvar_trimdesc_q

*com_inventory_loop_WEND1
	procid = (procid + 1) \ 10
	proclist(procid) = "com_identify" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( ci < 0 ) {
		dialog "暫定エラー回避処置です。お手数ですが、どの持ち物メニュー(例えば飲む、振る、食べるなど）から調査(xキー)を押したか報告お願いします。"
		return
	}
	page_save
	page = 0
	pagesize = 15
	listmax = 0
	p = 0
	s = ""
	repeat 4
		description(cnt) = ""
	loop
	reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
	getinheritance ci, inhlist, inhmax
	dbid = iID(ci)
	cibkref = ci
	dbmode = DBMODE_REF
	gosub *db_item
	dbmode = DBMODE_DESC
	gosub *db_item
	if ( iID(ci) == ITEM_ID_SISTERS_LOVE_FUELED_LUNCH ) {
		if ( iSubName(ci) != 0 & iSubName(ci) != 249 & iSubName(ci) != 176 ) {
			description(0) = ""
		}
	}
	if ( iID(ci) != ITEM_ID_CARNEADES_PLANK ) {
		if ( refitem(iID(ci), DBSPEC_TYPE, ci) < FILTER_ITEM_MIN & iParam3(ci) > 0 ) {
			list(0, p) = 7
			listn(0, p) = lang("元の名前:" + itemname(ci, 0, 0, 1), "Original:" + itemname(ci, 0, 0, 1))
			p++
		}
	}
	if ( iKnown(ci) >= ITEM_KNOWN_FULL ) {
		buf = trimdesc(description(3), 1)
		if ( buf != "" ) {
			list(0, p) = 7
			listn(0, p) = buf
			p++
		}
	}
	if ( iID(ci) == ITEM_ID_CARNEADES_PLANK ) {
		if ( useritemdatan(5, iCItemIdx(ci)) != "<ANONYMOUS>" ) {
			list(0, p) = 7
			listn(0, p) = lang("それは" + useritemdatan(5, iCItemIdx(ci)) + "により作成された", "It is created by " + useritemdatan(5, iCItemIdx(ci)) + ".")
			p++
		}
	}
	if ( gWizard ) {
		list(0, p) = 7
		listn(0, p) = lang("それは" + weight2str(iWeight(ci)) + "ある", "It weighs " + weight2str(iWeight(ci)))
		if ( iWeight(ci) < 0 ) {
			listn(0, p) += lang("(荷車)", "(Cargo goods)")
		}
		listn(0, p) += lang("", ".")
		p++
	}
	if ( iWeight(ci) == 1 ) {
		list(0, p) = 7
		listn(0, p) = lang("それは羽のように軽い", "It is light as a feather.")
		p++
	}
	if ( godcheck() == "krula" ) {
		list(0, p) = 7
		listn(0, p) = lang("それは金貨" + iValue(ci) + "枚分の価値を持っている", "It is worth a " + iValue(ci) + " gold coins.")
		p++
	}

	if ( iKnown(ci) >= ITEM_KNOWN_QUALITY ) {
		if ( iMaterial(ci) != ITEM_MATERIAL_SAND ) {
			list(0, p) = 7
			if ( ibit(21, ci) & (iID(ci) != ITEM_ID_ENGAGEMENT_RING | ibit(ITEM_BIT_PRECIOUS, ci) == FALSE) ) {
				if ( iParam2(ci) == 343 ) {
					if ( iCNpcId(ci) != usernpcmax ) {
						listn(0, p) = lang("それは" + userdatan(1, iCNpcId(ci)) + "の" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					}
					else {
						listn(0, p) = lang("それは残りカスの" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					}
				}
				else {
					if ( iParam2(ci) == 999 ) {
						listn(0, p) = lang("それは" + cnName(CHARA_PLAYER) + "の" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					}
					else {
						listn(0, p) = lang("それは" + refchara(iParam2(ci), DBSPEC_CHARA_NAME_ORG, 1) + "の" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
					}
				}
			}
			else {
				listn(0, p) = lang("それは" + mtname(0, iMaterial(ci)) + "で作られている", "It is made of " + mtname(0, iMaterial(ci)) + ".")
			}
			p++
		}
		if ( iID(ci) == ITEM_ID_OBJET_HEART ) {
			list(0, p) = 7
			if ( iParam1(ci) ) {
				listn(0, p) = lang("それは" + iParam1(ci) + "回使われた", "It was used " + iParam1(ci) + " by you.")
			}
			else {
				listn(0, p) = lang("それはまだ使われていない", "It has not been used yet.")
			}
			p++
		}
		if ( iID(ci) == ITEM_ID_FISH_JUNK & iSubName(ci) == 30 ) {
			list(0, p) = 7
			if ( iParam2(ci) != 0 ) {
				if ( iParam1(ci) == 343 ) {
					if ( iCNpcId(ci) != usernpcmax ) {
						listn(0, p) = lang("それは" + userdatan(1, iCNpcId(ci)) + "と", ".")
					}
					else {
						listn(0, p) = lang("それは残りカスと", ".")
					}
				}
				else {
					if ( iParam1(ci) == 999 ) {
						listn(0, p) = lang("それは" + cnName(CHARA_PLAYER) + "と", ".")
					}
					else {
						listn(0, p) = lang("それは" + refchara(iParam1(ci), DBSPEC_CHARA_NAME_ORG, 1) + "と", ".")
					}
				}
				if ( iParam2(ci) == 343 ) {
					if ( iParam3(ci) != usernpcmax ) {
						listn(0, p) += lang(userdatan(1, iParam3(ci)) + "の薄い本だ", ".")
					}
					else {
						listn(0, p) += lang("残りカスのあられもない姿が記録された本だ", ".")
					}
				}
				else {
					if ( iParam2(ci) == 999 ) {
						listn(0, p) += lang(cnName(CHARA_PLAYER) + "の薄い本だ", ".")
					}
					else {
						listn(0, p) += lang(refchara(iParam2(ci), DBSPEC_CHARA_NAME_ORG, 1) + "の薄い本だ", ".")
					}
				}
			}
			else {
				if ( iParam1(ci) == 343 ) {
					if ( iCNpcId(ci) != usernpcmax ) {
						listn(0, p) = lang("それは" + userdatan(1, iCNpcId(ci)) + "のあられもない姿が記録された本だ", ".")
					}
					else {
						listn(0, p) = lang("それは残りカスのあられもない姿が記録された本だ", ".")
					}
				}
				else {
					if ( iParam1(ci) == 999 ) {
						listn(0, p) = lang("それは" + cnName(CHARA_PLAYER) + "のあられもない姿が記録された本だ", ".")
					}
					else {
						listn(0, p) = lang("それは" + refchara(iParam1(ci), DBSPEC_CHARA_NAME_ORG, 1) + "のあられもない姿が記録された本だ", ".")
					}
				}
			}
			p++
		}
		if ( iMaterial(ci) == ITEM_MATERIAL_ETHER ) {
			list(0, p) = 7
			listn(0, p) = lang("それは装備している間、エーテルの病の進行を早める", "It speeds up the ether disease while equipping.")
			p++
		}
		if ( ibit(ITEM_BIT_ACIDPROOF, ci) ) {
			list(0, p) = 7
			listn(0, p) = lang("それは酸では傷つかない", "It is acidproof.")
			p++
		}
		if ( ibit(ITEM_BIT_FIREPROOF, ci) ) {
			list(0, p) = 7
			listn(0, p) = lang("それは炎では燃えない", "It is fireproof.")
			p++
		}
		if ( ibit(ITEM_BIT_PRECIOUS, ci) ) {
			list(0, p) = 7
			listn(0, p) = lang("それは貴重な品だ", "It is precious.")
			p++
		}
		if ( ibit(ITEM_BIT_REMAKE, ci) ) {
			list(0, p) = 7
			godindext = getgodindex(iParam4(ci))
			if ( godindext != (-1) ) {
				listn(0, p) = lang("それは" + cnven(usergoddatan(3, godindext)) + "の祝福を受けている", "It is blessed by " + cnven(usergoddatan(3, godindext)) + ".")
			}
			else {
				if ( iParam4(ci) == 1 ) {
					listn(0, p) = lang("それはマニの祝福を受けている", "It is blessed by Mani.")
				}
				else {
					if ( iParam4(ci) == 2 ) {
						listn(0, p) = lang("それはルルウィの祝福を受けている", "It is blessed by Lulwy.")
					}
					else {
						if ( iParam4(ci) == 3 ) {
							listn(0, p) = lang("それはイツパロトルの祝福を受けている", "It is blessed by Itzpalt.")
						}
						else {
							if ( iParam4(ci) == 5 ) {
								listn(0, p) = lang("それはオパートスの祝福を受けている", "It is blessed by Opatos.")
							}
							else {
								if ( iParam4(ci) == 6 ) {
									listn(0, p) = lang("それはジュアの祝福を受けている", "It is blessed by Jure.")
								}
								else {
									if ( iParam4(ci) == 7 ) {
										listn(0, p) = lang("それはクミロミの祝福を受けている", "It is blessed by Kumiromi.")
									}
									else {
										listn(0, p) = lang("それはエヘカトルの祝福を受けている", "It is blessed by Ehekatl.")
									}
								}
							}
						}
					}
				}
			}
			p++
		}
		if ( ibit(ITEM_BIT_STOLEN, ci) ) {
			list(0, p) = 7
			listn(0, p) = lang("それは盗品だ", "It is a stolen item.")
			p++
		}
		if ( ibit(ITEM_BIT_ALIVE, ci) ) {
			list(0, p) = 7
			listn(0, p) = lang("それは生きている", "It is alive.") + " [Lv:" + iParam1(ci) + " Exp:" + limit(iParam2(ci) * 100 / calcexpalive(iParam1(ci)), 0, 100) + "%]"
			p++
		}
		if ( reftype == FILTER_WEAPON | reftype == FILTER_AMMO | refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_RANGE_ROCK_THROW ) {
			if ( ibit(ITEM_BIT_POISON_BLEND, ci) ) {
				list(0, p) = 7
				listn(0, p) = lang("それは" + ioriginalnameref(inv(36, ci) \ 1000) + "が塗られている", "It is put " + ioriginalnameref(inv(36, ci) \ 1000) + " on.")
				if ( gWizard ) {
					listn(0, p) += " (" + (inv(36, ci) / 1000 / 5 + sdata(iSkillRef(ci), cc) * 1.5) + "）"
				}
				p++
			}
		}
		if ( ibit(ITEM_BIT_GUEST_USE, ci) ) {
			list(0, p) = 7
			listn(0, p) = lang("それはショウルームでのみ使用できる。", "It can be only used in a show room.")
			p++
		}
		if ( ibit(ITEM_BIT_HANDMADE, ci) ) {
			list(0, p) = 7
			if ( iID(ci) == ITEM_ID_SISTERS_LOVE_FUELED_LUNCH ) {
				listn(0, p) = lang("それは心温まる手作り品だ", "It is a hand-made item.")
			}
			else {
				if ( gArea  != AREA_SHOW_HOUSE ) {
					namae = cnName(CHARA_PLAYER)
				}
				else {
					namae = lang("誰か", "someone")
				}
				listn(0, p) = lang("それは" + namae + "により作成された", "It is created by " + namae + ".")
				if ( iQuality(ci) == FIX_QUALITY_MIRACLE ) {
					listn(0, p) = lang("それは" + namae + "の良品だ", "It is created by " + namae + ".")
				}
				if ( iQuality(ci) == FIX_QUALITY_GODLY ) {
					listn(0, p) = lang("それは" + namae + "の秀品だ", "It is created by " + namae + ".")
				}
				if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_FURNITURE ) {
					listn(0, p) = lang("それは" + namae + "が加工を行った", "It is created by " + namae + ".")
				}
				if ( iID(ci) == ITEM_ID_ENGAGEMENT_RING & ibit(ITEM_BIT_PRECIOUS, ci) == TRUE ) {
					listn(0, p) = lang("それは貴重な思い出の品だ", "It is a SP item.")
				}
			}
			p++
		}
		if ( ibit(20, ci) ) {
			list(0, p) = 7
			listn(0, p) = lang("それは転移先の目印として機能する。", "It can be only used in a show room.")
			p++
		}
		if ( equalsitem(ci, "blacksmith hammer") ) {
			list(0, p) = 7
			listn(0, p) = "[Lv:" + iParam1(ci) + " Exp:" + fixtxt("" + double(iParam2(ci) * 100) / double(calcexpalive(iParam1(ci))), 6) + "%]"
			p++
		}
		if ( iID(ci) == ITEM_ID_FISH ) {
			if ( iSubName(ci) >= 37 ) {
				if ( iKnown(ci) == ITEM_KNOWN_FULL ) {
					if ( iParam2(ci) == 0 ) {
						list(0, p) = 7
						listn(0, p) = "Point: " + iValue(ci)
						p++
					}
				}
			}
		}
		calcweaponfix iID(ci), ci
		if ( iDice1(ci) != 0 ) {
			list(0, p) = 5
			listn(0, p) = lang("それは武器として扱うことができる", "It can be wielded as a weapon.") + " (" + iDice1(ci) + "d" + iDice2(ci) + lang(" 貫通 ", " Pierce ") + pierce + "%)"
			p++
			_switch_val = iSkillRef(ci)
			if ( _switch_val == 110 | _switch_sw ) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは不死の存在に対して威力が通りにくい", "It is ineffective against undeads.")
				p++
				goto *label_3012
				_switch_sw++
			}
			if ( _switch_val == 111 | _switch_sw ) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは浮遊している存在に対して威力をよく通す", "It is effective againast flying units.")
				p++
				goto *label_3012
				_switch_sw++
			}
			if ( _switch_val == 104 | _switch_sw ) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは使用者より遅い存在に対して威力をよく通す", "It is effective against units slower than the user.")
				p++
				goto *label_3012
				_switch_sw++
			}
			if ( _switch_val == 102 | _switch_sw ) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは防具を装備していない存在に対して威力をよく通す", "It is effective against units not wearing armor.")
				p++
				goto *label_3012
				_switch_sw++
			}
			if ( _switch_val == 103 | _switch_sw ) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは重装備の存在に対して威力をよく通す", "It is effective against units wearing heavy armor.")
				p++
				list(0, p) = 5
				listn(0, p) = lang("それはやどかりに対して威力をよく通す", "It is effective against hermit crabs.")
				p++
				list(0, p) = 5
				listn(0, p) = lang("それはゴーレムに対して威力をよく通す", "It is effective against golems.")
				p++
				list(0, p) = 5
				listn(0, p) = lang("それはスライムに対して威力が通りにくい", "It is ineffective against slimes.")
				p++
				goto *label_3012
				_switch_sw++
			}
			if ( _switch_val == 108 | _switch_sw ) {
				_switch_sw = 0
				list(0, p) = 5
				listn(0, p) = lang("それは遠隔武器を装備していない存在に対して威力をよく通す", "It is effective against units without a ranged weapon equippped.")
				p++
				goto *label_3012
			}
*label_3012
			if ( reftype == FILTER_WEAPON ) {
				if ( iWeight(ci) <= 1500 ) {
					list(0, p) = 5
					listn(0, p) = lang("それは片手でも扱いやすい", "It is a light weapon.")
					p++
				}
				if ( iWeight(ci) >= 4000 ) {
					list(0, p) = 5
					listn(0, p) = lang("それは両手持ちに適している", "It is a heavy weapon.")
					p++
				}
			}
		}
		if ( iAtk(ci) != 0 | iDmg(ci) != 0 ) {
			list(0, p) = 5
			listn(0, p) = lang("それは攻撃修正に" + iAtk(ci) + "を加え、ダメージを" + iDmg(ci) + "増加させる", "It modifies hit bonus by " + iAtk(ci) + " and damage bonus by " + iDmg(ci) + ".")
			p++
		}
		if ( iPV(ci) != 0 | iDV(ci) != 0 & iID(ci) != ITEM_ID_EGG ) {
			list(0, p) = 6
			listn(0, p) = lang("それはDVを" + iDV(ci) + "上昇させ、PVを" + iPV(ci) + "上昇させる", "It modifies DV by " + iDV(ci) + " and PV by " + iPV(ci) + ".")
			p++
		}
	}
	if ( iKnown(ci) < ITEM_KNOWN_QUALITY ) {
		list(0, p) = 0
		listn(0, p) = lang("このアイテムに関する知識を得るには、鑑定する必要がある。", "You have to identify the item to gain knowledge.")
		p++
	}
	if ( iKnown(ci) >= ITEM_KNOWN_FULL ) {
		if ( check_bigench(ci) != 0 ) {
			list(0, p) = 4
			bigbuf = check_bigench(ci)
			if ( bigbuf == 1 ) {
				listn(0, p) = lang("それは運動を阻害しない", "It does not inhibit movement.")
			}
			if ( bigbuf == 2 ) {
				listn(0, p) = lang("それは属性追加ダメージを強化する", "It enhances attribute extra damage.") + "(×" + strf("%.1f", (0.0 + inv(38, ci)) / 10 + 1.0) + ")"
			}
			if ( bigbuf == 3 ) {
				listn(0, p) = lang("それはエンチャント封印に耐性をもつ", "It reduces effects of enchantment sealing.")
			}
			if ( bigbuf == 4 ) {
				listn(0, p) = lang("それは攻撃対象を過剰回復させる", "It over-recovers the target.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 5 ) {
				listn(0, p) = lang("それは信仰の恩恵を増幅させる", "It amplifies the benefits of religion.") + "(×" + (inv(38, ci) + 1) + ")"
			}
			if ( bigbuf == 6 ) {
				listn(0, p) = lang("それは全ての能力値を維持する", "It maintains all stats.")
			}
			if ( bigbuf == 7 ) {
				listn(0, p) = lang("それはマナの消費を軽減する", "It reduces mana consumption.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 8 ) {
				listn(0, p) = lang("それは消費したマナを生命力に還元する", "It returns mana consumed to hp.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 9 ) {
				listn(0, p) = lang("それは稀に攻撃対象のエンチャントを封印する", "It seals up the target enchantment.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 10 ) {
				listn(0, p) = lang("それは稀に攻撃対象のバフを除去する", "It removes target buffs.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 11 ) {
				listn(0, p) = lang("それは病気の治りを遅くする", "It slows the healing of the disease.")
			}
			if ( bigbuf == 12 ) {
				listn(0, p) = lang("それは金貨を栄養に変換する", "It converts gold coins into nutrition.")
			}
			if ( bigbuf == 13 ) {
				listn(0, p) = lang("それは使用者を酔わせる", "It intoxicates the user.")
			}
			if ( bigbuf == 14 ) {
				listn(0, p) = lang("それはエーテル病の進行を遅くする", "It slows the ether curse.")
			}
			if ( bigbuf == 15 ) {
				listn(0, p) = lang("それは荷物の重量を軽くする", "It reduces the weight of luggage.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 16 ) {
				listn(0, p) = lang("それは呪いの影響を軽減する", "It reduces the effect of the curse.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 17 ) {
				listn(0, p) = lang("それは稀に倒れた味方を蘇らせる", "It revives a rarely fallen ally.") + "(" + inv(38, ci) + "%)"
			}
			if ( bigbuf == 18 ) {
				listn(0, p) = lang("それは媚薬が乾かない", "That aphrodisiac does not dry.")
			}
			if ( bigbuf >= 10000 ) {
				listn(0, p) = lang("それは" + skillname(bigbuf \ 10000) + "を少しずつ成長させる", "It grows " + skillname(bigbuf \ 10000) + " little by little") + "(×" + inv(38, ci) + ")"
			}
			p++
		}
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
				break
			}
			val = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci), inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci), 0, reftype
			getencproc encprocref2, ci, val
			gosub *item_encdetail
			listn(0, p) = lang("それは", "It ") + s
			list(0, p) = rtval, rtval(1)
			if ( inhmax > 0 ) {
				cnt2 = cnt
				repeat inhmax
					if ( cnt2 == inhlist(cnt) ) {
						list(0, p) += 10000
						break
					}
				loop
			}
			p++
		loop
		if ( ibit(ITEM_BIT_ULTIMATE, ci) ) {
			list(0, p) = 4
			listn(0, p) = lang("相手は死ぬ", "The enemy dies.")
			p++
		}
		if ( gWizard & iID(ci) == ITEM_ID_PUTITORO ) {
			list(0, p) = 4
			listn(0, p) = lang("効果１：" + iParam1(ci), "")
			p++
			list(0, p) = 4
			listn(0, p) = lang("効果２：" + iParam2(ci), "")
			p++
			list(0, p) = 4
			listn(0, p) = lang("効果３：" + iParam3(ci), "")
			p++
		}
		if ( 1 ) {
			repeat 3
				if ( description(cnt) == "" ) {
					continue
				}
				list(0, p) = 0
				listn(0, p) = ""
				p++
				buf = trimdesc(description(cnt), 2)
				notesel buf
				repeat noteinfo(0)
					noteget q, cnt
					p(1) = 66, 0
					if ( strlen(q) > p(1) ) {
						repeat strlen(q) / p(1) + 1
							if ( strlen(q) > p(2) + p(1) ) {
								if ( mbsbtype(q, p(2) + p(1)) == 2 ) {
									p(1) -= 1
								}
							}
							if ( strmid(q, p(2) + p(1), 2) == "。" | strmid(q, p(2) + p(1), 2) == "、" ) {
								p(1) += 2
							}
							if ( strmid(q, p(2), p(1)) == "" ) {
								break
							}
							list(0, p) = -1
							listn(0, p) = strmid(q, p(2), p(1))
							p++
							p(2) += p(1)
							p(1) = 66
						loop
					}
					else {
						list(0, p) = 0
						listn(0, p) = q
						if ( cnt == noteinfo(0) - 1 ) {
							list(0, p) = -2
						}
						p++
					}
				loop
			loop
		}
	}
	if ( p == 0 ) {
		list(0, p) = 0
		listn(0, p) = lang("特に情報はない", "There is no information about this object.")
		p++
	}
	listmax = p
	pagemax = (listmax - 1) / pagesize
	if ( dump_return == 1 ) {
		dump_return = 0
		return
	}
	snd SOUNDLIST_POP2
	windowshadow = 1

*label_3018
	key_list = key_enter
	keyrange = 0
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_3019
	redraw 0
	if ( inv_getowner(ci) != 56 ) {
		s = lang("アイテムの知識", "Known Information ") + "\t(" + (listnumber + 1) + "/" + listmax_bk + ")", strhint4 + strhint3 + oomsest_strhint6
	}
	else {
		s = lang("アイテムの知識", "Known Information "), strhint4 + strhint3
	}
	display_window (windoww - 600) / 2 + inf_screenx, winposy(408), 600, 408
	display_topic itemname(ci), wx + 28, wy + 34
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 68, wy + 68 + cnt * 18
		if ( list(0, p) \ 10000 == 1 ) {
			color 0, 100, 0
		}
		if ( list(0, p) \ 10000 == 2 ) {
			color 0, 0, 100
		}
		if ( list(0, p) \ 10000 == 3 ) {
			color 80, 100, 0
		}
		if ( list(0, p) \ 10000 == 4 ) {
			color 80, 50, 0
		}
		if ( list(0, p) \ 10000 == 9 ) {
			color 180, 0, 0
		}
		if ( list(0, p) \ 10000 == 8 ) {
			color 0, 100, 100
		}
		if ( list(0, p) == (-1) ) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		}
		if ( list(0, p) == (-2) ) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 2
			pos wx + ww - strlen(listn(0, p)) * 6 - 80, wy + 68 + cnt * 18
		}
		mes listn(0, p)
		if ( list(0, p) > 0 ) {
			pos wx + 40, wy + 61 + cnt * 18
			gcopy BUFFER_INF, 72 + list(0, p) \ 10000 * 24, 336, 24, 24
		}
		if ( list(0, p) > 10000 ) {
			pos wx + 15, wy + 63 + cnt * 18
			gcopy BUFFER_INF, 384, 360, 24, 24
		}
	loop
	redraw 1
	await cfg_wait1
	key_check
	if ( inv_getowner(ci) != 56 ) {
		if ( key == key_north ) {
			snd SOUNDLIST_CURSOR1
			page_load
			cs--
			if ( cs < 0 ) {
				page--
				cs = pagesize_bk - 1
			}
			listnumber--
			if ( listnumber < 0 ) {
				listnumber = listmax_bk - 1
				page = pagemax_bk
				if ( fromequip == 1 ) {
					cs = listmax_bk \ 14 - 1
					if ( cs < 0 ) {
						cs = 13
					}
				}
				else {
					cs = listmax_bk \ 16 - 1
					if ( cs < 0 ) {
						cs = 15
					}
				}
			}
			if ( fromequip == 1 ) {
				repeat
					if ( cdata(list_bk(0, listnumber), cc) \ EXT_EQUIP_SLOTS != 0 ) {
						ci = cdata(list_bk(0, listnumber), cc) \ EXT_EQUIP_SLOTS - 1
						break
					}
					else {
						cs--
						if ( cs < 0 ) {
							page--
							cs = pagesize_bk - 1
						}
						listnumber--
						if ( listnumber < 0 ) {
							listnumber = listmax_bk - 1
							page = pagemax_bk
							cs = listmax_bk \ 14 - 1
							if ( cs < 0 ) {
								cs = 13
							}
						}
					}
				loop
			}
			else {
				ci = list_bk(0, listnumber)
			}
			goto *com_inventory_loop_WEND1
		}
		if ( key == key_south ) {
			snd SOUNDLIST_CURSOR1
			page_load
			cs++
			if ( cs >= pagesize_bk ) {
				page++
				cs = 0
			}
			listnumber++
			if ( listnumber >= listmax_bk ) {
				listnumber = 0
				page = 0
				cs = 0
			}
			if ( fromequip == 1 ) {
				repeat
					if ( cdata(list_bk(0, listnumber), cc) \ EXT_EQUIP_SLOTS != 0 ) {
						ci = cdata(list_bk(0, listnumber), cc) \ EXT_EQUIP_SLOTS - 1
						break
					}
					else {
						cs++
						if ( cs >= pagesize_bk ) {
							page++
							cs = 0
						}
						listnumber++
						if ( listnumber >= listmax_bk ) {
							listnumber = 0
							page = 0
							cs = 0
						}
					}
				loop
			}
			else {
				ci = list_bk(0, listnumber)
			}
			goto *com_inventory_loop_WEND1
		}
	}
	if ( key == key_west ) {
		key = key_pagedown
	}
	if ( key == key_east ) {
		key = key_pageup
	}
	if ( cs >= keyrange ) {
		cs_bk = -1
		cs = keyrange - 1
		if ( cs < 0 ) {
			cs = 0
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_3018
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_3018
		}
	}
	if ( inv_getowner(ci) != 56 ) {
		if ( key == key_mode3 ) {
			gosub *net_chat
		}
	}
	if ( key == key_cancel | key == key_enter ) {
		returnfromidentify = 1
		fromequip = 0
		return
	}
	goto *label_3019

*label_3023
	repeat ocHostileTargetTotal(cc)
		if ( cExist(ocHostileTarget1(cc) - 1) != CHAR_STATE_ALIVE ) {
			unlockon cc, ocHostileTarget1(cc) - 1
			continue
		}
		else {
			if ( synccheck(ocHostileTarget1(cc) - 1, -1) == 0 ) {
				unlockon cc, ocHostileTarget1(cc) - 1
				continue
			}
		}
		break
	loop
	if ( ocHostileTargetTotal(cc) == 0 ) {
		gosub *label_3033
		if ( listmax != 0 ) {
			f = 0
			if ( cc == CHARA_PLAYER ) {
				p = -3, -1, 0
				p(49) = 3
			}
			else {
				if ( cRelation(cc) >= RELATION_NEUTRAL ) {
					p = -3
					p(49) = 1
				}
				else {
					p = 10, 0
					p(49) = 2
				}
			}
			repeat p(49)
				cnt2 = cnt
				repeat listmax
					if ( cRelation(list(0, cnt)) <= p(cnt2) ) {
						lockson cc, list(0, cnt), 2
						f = 1
						break
					}
				loop
				if ( f == 1 ) {
					break
				}
			loop
		}
	}
	if ( ocHostileTargetTotal(cc) == 0 | cBlind(cc) != 0 ) {
		if ( cc == CHARA_PLAYER ) {
			txt -1, lang("ターゲットが見当たらない。", "You find no target.")
			gosub *screen_draw
		}
		return 0
	}
	return 1

*com_confirmAttack
	txttargetlevel
	txt -1, s
	txt -1, lang("本当に" + name(tc) + "を攻撃する？ ", "Really attack " + name(tc) + "? ")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *prompt_key
	if ( rtval == 0 ) {
		gosub *screen_draw
		return 1
	}
	else {
		gosub *screen_draw
		return 0
	}

*com_fire
	cc = CHARA_PLAYER
	gosub *label_3023
	if ( stat == 0 ) {
		goto *pc_turn
	}
	tc = ocHostileTarget1(0) - 1
	if ( cRelation(tc) >= RELATION_NEUTRAL ) {
		gosub *com_confirmAttack
		if ( stat == 0 ) {
			goto *pc_turn
		}
	}
	gosub *label_3030
	if ( stat == (-1) ) {
		msgdup++
		txt -1, lang("射撃用の道具を装備していない。", "You need to equip a firing weapon.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( stat == (-2) ) {
		msgdup++
		txt -1, lang("矢/弾丸を装備する必要がある。", "You need to equip ammos or arrows.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( stat == (-3) ) {
		msgdup++
		txt -1, lang("矢/弾丸の種類が適していない。", "You're equipped with wrong type of ammos.")
		gosub *screen_draw
		goto *pc_turn
	}
	gosub *act_fire
	goto *label_4158

*label_3030
	cw = -1
	ammo = -1
	attacknum = 0
	repeat 30
		body = 100 + cnt
		if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 10 ) {
			cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 11 ) {
			ammo = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
		}
	loop

*label_3031
	if ( cw == (-1) ) {
		cw = 0
		return -1
	}
	if ( ammo == (-1) ) {
		if ( iSkillRef(cw) != SKILL_WEAPON_THROWING ) {
			cw = 0
			return -2
		}
	}
	if ( ammo != (-1) ) {
		if ( iSkillRef(cw) != SKILL_WEAPON_THROWING ) {
			if ( iSkillRef(cw) != iSkillRef(ammo) ) {
				return -3
			}
		}
		else {
			ammo = -1
		}
	}
	attackskill = iSkillRef(cw)
	return 1

*label_3033
	listmax = 0
	repeat 2
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( synccheck(cnt, -1) == 0 ) {
				continue
			}
			x = cX(cnt)
			y = cY(cnt)
			if ( x == cX(cc) & y == cY(cc) ) {
				continue
			}
			if ( fov_los(cX(cc), cY(cc), x, y) == 0 ) {
				continue
			}
			if ( cbit(CHARA_BIT_INVISIBLE, cnt) == TRUE ) {
				if ( cbit(CHARA_BIT_SEE_INVISIBLE, cc) == FALSE ) {
					if ( cWet(cnt) == 0 ) {
						continue
					}
				}
			}
			list(0, listmax) = cnt, x, y
			listmax++
			if ( listmax >= 500 - 1 ) {
				break
			}
		loop
		if ( listmax != 0 ) {
			break
		}
	loop
	repeat
		if ( listmax < 2 ) {
			break
		}
		i = 1
		repeat listmax - 1
			p = dist(cX(cc), cY(cc), list(1, cnt), list(2, cnt))
			p(1) = dist(cX(cc), cY(cc), list(1, cnt + 1), list(2, cnt + 1))
			if ( p(1) < p ) {
				p = list(0, cnt), list(1, cnt), list(2, cnt)
				list(0, cnt) = list(0, cnt + 1), list(1, cnt + 1), list(2, cnt + 1)
				list(0, cnt + 1) = p, p(1), p(2)
				i = 0
				break
			}
		loop
		if ( i == 1 ) {
			break
		}
	loop
	return

*com_rest
	r1 = 50
	gosub *rest
	goto *label_4158

*com_rowActCancel
	txt -1, lang(actlistn(cRowAct(cc)) + "を中断したほうがいいだろうか？ ", "Do you want to cancel " + actlistn(cRowAct(cc)) + "? ")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *prompt_key
	return

*com_save
	txtnew
	if ( gArea  == AREA_SHOW_HOUSE ) {
		txtef COLOR_RED
		txt -1, lang("ユーザーマップの中ではセーブできない。それでも終了する？", "You can't save the game in a user made map. Exit anyway?")
	}
	else {
		txt -1, lang("これまでの冒険を記録して終了する？", "Do you want to save the game and exit?")
	}
	promptl(0, promptmax) = lang("はい", "Exit"), "a", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("いいえ", "Cancel"), "b", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ゲーム設定", "Game Setting"), "c", "" + promptmax
	promptmax++
	val = promptx, prompty, 190, 1
	gosub *prompt_key
	if ( rtval == 0 ) {
		if ( gArea  != AREA_SHOW_HOUSE ) {
			snd SOUNDLIST_WRITE1
			if ( nc_intb_nightmare ) {
				ncgSavedCleanly = 1
			}
			gosub *game_save
			txt -1, lang("無事に記録された。", "Your game has been saved successfully.")
			txt -1, lang(name(cc) + "は静かに目を閉じた… (キーを押すと自動終了します)", "You close your eyes and peacefully fade away. (Hit any key to exit)")
			throwsstpevent "GameQuit", 0, "", 0
			msg_halt
			gosub *screen_draw
		}
		await 300
		goto *exit_game
	}
	if ( rtval == 2 ) {
		snd SOUNDLIST_OK1
		goto *com_config
	}
	gosub *screen_draw
	goto *pc_turn

*label_3041
	f = 0
	repeat 5
		p = gdata(GDATA_QUEST_POOL + cnt)
		if ( qStatus(p) == QUEST_STATE_ONGOING ) {
			if ( qExist(p) == QUEST_TYPE_ESCORT | qExist(p) == QUEST_TYPE_DELIVER ) {
				f = 1
				break
			}
		}
	loop
	if ( ogQuestKnightsOfLittleGirls == 1 & gQuestStatus != QUEST_STATE_SUCCESS ) {
		f = 1
	}
	return f

*com_return
	gosub *label_3041
	if ( stat == 1 ) {
		txt -1, lang("依頼請負中の帰還は法律で禁止されている。それでも帰還する？", "Returning while taking a quest if forbidden. Are you sure you want to return?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval != 0 ) {
			gosub *screen_draw
			return
		}
	}
	p = 0
	i = 7
	if ( ogTitleReturningHome == 2 ) {
		list(0, p) = i, -2
		promptl(0, promptmax) = lang("わが家 任意地下階", "Home specified Lv"), "null", "" + promptmax
		promptmax++
		p++
	}
	list(0, p) = i, 1
	promptl(0, promptmax) = mapname(i), "null", "" + promptmax
	promptmax++
	p++
	repeat 500
		i = 500 - (cnt + 1)
		if ( areaId(i) == AREA_NONE ) {
			continue
		}
		if ( ogTitleSeagullSailors == 2 ) {
			if ( efstatus >= 1 ) {
				if ( areaId(i) == AREA_VERNIS | areaId(i) == AREA_PORT_KAPUL | areaId(i) == AREA_YOWYN | areaId(i) == AREA_DERPHY | areaId(i) == AREA_PALMIA | areaId(i) == AREA_NOYEL | areaId(i) == AREA_LUMIEST | areaId(i) == AREA_NT_SOUTH_BORDER | areaId(i) == AREA_SMOKE_AND_PIPE | areaId(i) == 50 | areaId(i) == 51 | areaId(i) == 52 | areaId(i) == 53 | areaId(i) == 54 ) {
					if ( areaParent(i) != gWorld ) {
						f = 1
					}
				}
			}
		}
		if ( areaParent(i) != gWorld & f == 0 ) {
			continue
		}
		if ( areaId(i) == AREA_HOME ) {
			continue
		}
		if ( areaDeepest(i) == 0 ) {
			continue
		}
		f = 0
		if ( areaId(i) == AREA_LESIMAS | areaId(i) == AREA_LARNA | areaId(i) == AREA_SISTER_MANSION | areaId(i) == AREA_VOID | areaId(i) == AREA_DUNGEON | areaId(i) == AREA_ST_NORTH_BORDER | areaId(i) == AREA_TW_NORTH_BORDER ) {
			f = 1
		}
		if ( ogTitleWizardOnlyLiveTwice == 2 ) {
			if ( areaId(i) == 60 ) {
				f = 1
			}
		}
		if ( ogTitleRedcap == 2 ) {
			if ( areaId(i) == 61 ) {
				f = 1
			}
		}
		if ( efstatus >= 1 ) {
			if ( ogTitleMachSpeedCat == 2 | efstatus == 2 ) {
				if ( areaId(i) == AREA_VERNIS | areaId(i) == AREA_PORT_KAPUL | areaId(i) == AREA_YOWYN | areaId(i) == AREA_DERPHY | areaId(i) == AREA_PALMIA | areaId(i) == AREA_NOYEL | areaId(i) == AREA_LUMIEST | areaId(i) == AREA_NT_SOUTH_BORDER | areaId(i) == AREA_SMOKE_AND_PIPE | areaId(i) == 50 | areaId(i) == 51 | areaId(i) == 52 | areaId(i) == 53 | areaId(i) == 54 ) {
					f = 1
				}
			}
			if ( ogTitleDestroyedDestructiveWeapons == 2 ) {
				if ( areaId(i) == AREA_BEAST_FORT | areaId(i) == AREA_MACHINE_FORT | areaId(i) == AREA_COLLAPSED_FORT ) {
					f = 1
				}
			}
			if ( ogTitleTheWorldIsSpinning == 2 ) {
				if ( areaId(i) == 59 ) {
					f = 1
				}
			}
		}
		if ( gWizard | 0 ) {
			if ( areaType(i) == MAP_TYPE_TOWN | areaType(i) == MAP_TYPE_VILLAGE ) {
				f = 1
			}
		}
		if ( f == 1 ) {
			if ( ogTitleChampionOfTheLabyrinths == 2 ) {
				if ( areaId(i) == AREA_LESIMAS ) {
					list(0, p) = i, 1
					promptl(0, promptmax) = lang("レシマス 1階", "Lesimas 1st Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
			if ( ogTitleWizardOnlyLiveTwice == 2 ) {
				if ( areaId(i) == 60 ) {
					list(0, p) = i, -1
					promptl(0, promptmax) = lang("変異種の洞窟 任意階", "Mutant Cave specified Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
			if ( ogTitleJunkie == 2 ) {
				if ( areaId(i) == AREA_VOID ) {
					list(0, p) = i, -1
					promptl(0, promptmax) = lang("すくつ 任意階", "The Void specified Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
			if ( areaId(i) == AREA_DUNGEON ) {
				list(0, p) = i, 1
				promptl(0, promptmax) = lang("ダンジョン", "Dungeon"), "null", "" + promptmax
				promptmax++
				p++
			}
			else {
				if ( areaType(i) == MAP_TYPE_TOWN | areaType(i) == MAP_TYPE_VILLAGE | areaType(i) == MAP_TYPE_FIELD ) {
					list(0, p) = i, 1
					promptl(0, promptmax) = mapname(i), "null", "" + promptmax
					promptmax++
					p++
				}
				else {
					list(0, p) = i, areaDeepest(i)
					promptl(0, promptmax) = mapname(i) + " " + cnvrank(areaDeepest(i) - areaMinLevel(i) + 1) + lang("階", " Lv"), "null", "" + promptmax
					promptmax++
					p++
				}
			}
		}
	loop
	listmax = p
	if ( listmax == 0 ) {
		txt -1, lang("この大陸には帰還できる場所が無い。", "You don't know any location you can return to")
		return
	}
	txt -1, lang("どの場所に帰還する？", "Where do you want to go?")
	display_msg inf_screeny + inf_tiles
	val = promptx, prompty, 240 + listmax / 16 * 240, 1
	gosub *label_3157
	gosub *screen_draw
	if ( rtval >= 0 ) {
		if ( list(1, rtval) == (-1) ) {
			txt -1, lang("どの階に帰還する？", "Where Lv do you want to go?")
			if ( gWizard ) {
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, 100000
			}
			else {
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, areaDeepest(list(0, rtval)) - areaMinLevel(list(0, rtval)) + 1
			}
			inputlog = "1"
			locvar_dmghp_p = rtval
			gosub *prompt_word
			if ( rtval == (-1) ) {
				goto *com_return
			}
			rtval = locvar_dmghp_p
			list(1, rtval) = int(inputlog) + areaMinLevel(list(0, rtval)) - 1
		}
		if ( list(1, rtval) == (-2) ) {
			txt -1, lang("地下何階に帰還する？", "Where Lv do you want to go?")
			f = 10
			if ( ncgHomeBasementFloors == 1 ) {
				f = 20
			}
			if ( ncgHomeBasementFloors == 2 ) {
				f = 30
			}
			if ( ncgHomeBasementFloors == 3 ) {
				f = 40
			}
			val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 0, f - 1
			inputlog = "0"
			locvar_dmghp_p = rtval
			gosub *prompt_word
			if ( rtval == (-1) ) {
				goto *com_return
			}
			rtval = locvar_dmghp_p
			list(1, rtval) = int(inputlog) + 1
		}
		txt -1, lang("周囲の大気がざわめきだした。", "The air around you becomes charged.")
		if ( areaId(gArea ) == AREA_RANDOM_DUNGEON ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				if ( areaBoss(gArea ) != (-1) ) {
					txt -1, lang("このままダンジョンを出ると、この階のクエストは達成できない…", "The lord of the dungeon might disappear if you escape now.")
				}
			}
		}
		item_find FILTER_CARGO_TRADE, ITEM_FIND_MODE_TYPE, ITEM_FIND_LOCATION_CHARAS
		if ( stat != (-1) ) {
			txt -1, lang("このまま帰還すると、交易品は駄目になる…", "The trade article is lost if you escape now.")
		}
		gTeleportArea = list(0, rtval), list(1, rtval)
		gReturn  = 15 + rnd(15)
	}
	gosub *screen_draw
	return

*com_gasha
	screenupdate = -1
	gosub *screen_draw
	if ( iID(ci) == ITEM_ID_RED_TREASURE_MACHINE ) {
		tmat = 51
	}
	if ( iID(ci) == ITEM_ID_BLUE_TREASURE_MACHINE ) {
		tmat = 52
	}
	if ( cfg_treasuremachine ) {
		rtval = 0
	}
	else {
		txt -1, lang("" + matname(tmat) + "を使ってガシャガシャする？", "Pay " + matname(tmat) + " to gasha-gasha?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
	}
	if ( rtval == 0 ) {
		if ( mat(tmat) > 0 ) {
			snd SOUNDLIST_GASHA
			matdelmain tmat
			if ( iID(ci) == ITEM_ID_RED_TREASURE_MACHINE ) {
				p = 415
			}
			else {
				p = 416
			}
			flt
			itemcreate -1, p, cX(cc), cY(cc), 0
			if ( stat != 0 ) {
				iParam2(ci) = 0
				if ( iID(ci) == ITEM_ID_RARE_TREASURE_BALL ) {
					if ( rnd(1000) == 0 ) {
						ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
					}
				}
			}
			txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		}
		else {
			txt -1, lang("" + matname(tmat) + "を持っていない…", "You don't have " + matname(tmat) + ".")
		}
	}
	goto *label_4158

*label_3046
	if ( iID(ci) == ITEM_ID_SKILLBOOK ) {
		if ( sorg(iParam1(ci), CHARA_PLAYER) == 0 ) {
			txt -1, lang("この本の内容には興味がない。それでも読む？ ", "You are not interested in this book. Do you want to read it anyway? ")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval != 0 ) {
				return 0
			}
		}
	}
	gRowAct = ACTION_TRAIN
	gosub *label_3307
	return 1

*com_dump
	if ( gArea  == AREA_SHOW_HOUSE | gArea  == AREA_ARENA | gArea  == AREA_PET_ARENA | gArea  == 49 ) {
		redraw 0
		snd SOUNDLIST_FAIL1
		txt -1, lang("このマップでは利用できない。", "Can't do it in this area.")
		return
	}
	gosub *dump_config
	redraw 0
	if ( gdatan(GDATAN_TEAM1) == "" ) {
		gdatan(GDATAN_TEAM1) = random_title(2)
		txt -1, lang("チームネームが決まっていないので、自動的に" + gdatan(GDATAN_TEAM1) + "という名前が付けられた。", "Your initial team name is " + gdatan(GDATAN_TEAM1) + ". You can change it any time.")
	}
	txtnew
	txt -1, lang("[カスタム機能]何をする？", "[Customize Menu] What do you want to do?")
	promptl(0, promptmax) = lang("ショウルームを記録", "Save current area"), "a", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ペットチームを記録", "Save your pet team"), "b", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("チームネーム変更", "Change your team name"), "c", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("カスタムNPCを作成", "Create custom NPC"), "d", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ｶｽﾀﾑｱｲﾃﾑを作成", "Create custom item"), "e", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("カスタムゴッドを作成", "Create custom god"), "f", "" + promptmax
	promptmax++
	promptl(0, promptmax) = lang("ﾕﾆｰｸﾓﾝｽﾀｰを作成", "Create unique monster"), "g", "" + 8
	promptmax++
	val = promptx, prompty, 240, 1
	gosub *prompt_key
	gosub *screen_draw
	gosub *dump_config
	if ( rtval == 0 ) {
		if ( mType == MAP_TYPE_WORLD | gArea  == AREA_SHOW_HOUSE ) {
			redraw 0
			snd SOUNDLIST_FAIL1
			txt -1, lang("このマップは保存できない。", "You can't save this area.")
			return
		}
		txt -1, lang("どのファイル名で保存する？", "Enter file name.")
		redraw 1
		fileext = "eum"
		filedsc = "Elona User Map"
		_fdialog fileext, 17, filedsc, exedir + "user", "default.eum"
		if ( stat == 0 ) {
			return
		}
		userfile = refstr
		gosub *label_3108
		txtef COLOR_GREEN
		txt -1, lang("現在地の情報を" + userfile + "に保存した。", "Current area is saved to " + userfile + ".")
		return
	}
	if ( rtval == 1 ) {
		txt -1, lang("どのメンバー構成を記録する？", "Which members do you want to save?")
		dim followerexist, 16
		repeat 16
			followerexist(cnt) = cExist(cnt)
		loop
		arenaop = 1, 6
		allyctrl = 2
		gosub *label_2611
		if ( stat == (-1) ) {
			return
		}
		lv = 0
		n = 0
		repeat 245
			list(0, cnt) = 0
			if ( cnt < 16 ) {
				if ( followerin(cnt) == 1 ) {
					list(0, cnt) = 1
					lv += cLevel(cnt)
					n++
				}
			}
		loop
		if ( listmax == 0 ) {
			return
		}
		else {
			lv = lv / n
		}
		txt -1, lang("どのファイル名で保存する？", "Enter file name.")
		redraw 1
		fileext = "ept"
		filedsc = "Elona Pet Team"
		_fdialog fileext, 17, filedsc, exedir + "user", "default.ept"
		if ( stat == 0 ) {
			return
		}
		userfile = refstr
		gosub *label_3110
		txtef COLOR_GREEN
		txt -1, lang("ペットチームを" + userfile + "に保存した。", "Your team is saved to " + userfile + ".")
		return
	}
	if ( rtval == 2 ) {
		val = 2
		gosub *com_aka
		if ( stat == 0 ) {
			return
		}
		gdatan(GDATAN_TEAM1) = cmaka
		txt -1, lang("あなたはチーム名を" + gdatan(GDATAN_TEAM1) + "に決めた。", "Your team name is " + gdatan(GDATAN_TEAM1) + " now.")
		return
		return
	}
	if ( rtval == 3 ) {
		gosub *label_3104
		return
	}
	if ( rtval == 4 ) {
		gosub *label_4255
		return
	}
	if ( rtval == 5 ) {
		gosub *label_4509
		return
	}
	if ( rtval == 6 ) {
		if ( gArea  == AREA_SHOW_HOUSE ) {
			txt -1, lang("この場所からはできない。", "You can't do it in this area.")
			return
		}
		if ( cLevel(CHARA_PLAYER) < 10 ) {
			txt -1, lang("それはレベルが10以上でないとできない。", "You need to be at least level 10 to upload.")
			return
		}
		if ( gNextUpload > getgametime() ) {
			snd SOUNDLIST_FAIL1
			txt -1, lang("まだ次のアップロードはできない(" + cnvdate(gNextUpload, 1) + "まで)", "You can't do this till " + cnvdate(gNextUpload, 1) + ".")
			return
		}
		gosub *uploader
		return
	}
	if ( rtval == 7 ) {
		exec exedir + "user\\export.txt", 16
	}
	if ( rtval == 8 ) {
		gosub *label_4579
		return
	}
	return

*dump_chara
	procid = (procid + 1) \ 10
	proclist(procid) = "Dump:Init" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	buff = ""
	notesel buff
	noteadd "Elona Version " + "1.22" + " キャラクター情報 " + gYear  + "年" + gMonth  + "月" + gDay  + "日 " + gHour  + "時" + gMin  + "分  " + mdatan(0)
	repeat 16
		if ( cExist(cnt) == CHAR_STATE_DEAD ) {
			continue
		}
		cc = cnt
		dbidn = cnRace(cc)
		dbmode = DBMODE_REF
		gosub *cm_race
		dbidn = cnClass(cc)
		dbmode = DBMODE_REF
		gosub *cm_race_loop
		if ( cId(cc) == CREATURE_ID_USER ) {
			if ( userdatan2(0, cUNID(cc)) != "" ) {
				racename = userdatan2(0, cUNID(cc))
			}
			if ( userdatan2(1, cUNID(cc)) != "" ) {
				classname = userdatan2(1, cUNID(cc))
			}
		}
		procid = (procid + 1) \ 10
		proclist(procid) = "Dump:1" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		noteadd ""
		if ( cfg_dump == 0 ) {
			if ( cc > CHARA_PLAYER ) {
				noteadd cnName(cc) + " " + racename + "の" + classname + " " + _sex(cSex(cc)) + " " + calcage(cc) + "歳" + "  " + cHeight(cc) + "cm" + " " + cWeight(cc) + "kg"
				s = "レベル " + cLevel(cc) + " "
				if ( cbit(CHARA_BIT_MARRIED, cc) == TRUE ) {
					s += "婚約済み "
				}
				noteadd s
				noteadd ""
				continue
			}
		}
		noteadd "  " + fixtxt("" + cnAka(cc) + cnName(cc), 34) + _sex(cSex(cc)) + " " + calcage(cc) + "歳" + "  " + cHeight(cc) + "cm" + " " + cWeight(cc) + "kg"
		noteadd ""
		if ( cbit(CHARA_BIT_MARRIED, cc) == TRUE ) {
			noteadd "婚約済み"
		}
		noteadd ""
		noteadd fixtxt("種族       : " + racename, 30) + fixtxt("信仰      : " + godname(godcheck(cc)), 32)
		noteadd fixtxt("職業       : " + classname, 30) + fixtxt("所属      : " + guildname(), 32)
		if ( cc == CHARA_PLAYER ) {
			noteadd fixtxt("レベル     : " + cLevel(cc), 30) + fixtxt("経過日数  : " + gDayPast, 32)
			noteadd fixtxt("残りBP     : " + cSkillPoint(cc), 30) + fixtxt("経過ターン: " + gTurn, 32)
			noteadd fixtxt("金貨       : " + cGold(cc), 30) + fixtxt("殺害数    : " + gKilled, 32)
			noteadd fixtxt("プラチナ   : " + cPlat(CHARA_PLAYER), 30) + fixtxt("最深到達  : " + gDeepest + "階相当", 32)
			noteadd fixtxt("プレイ時間 : " + cnvplaytime(gPlayTime + timeGetTime() / 1000 - time_begin), 30)
		}
		else {
			noteadd fixtxt("レベル     : " + cLevel(cc), 30)
			noteadd fixtxt("残りBP     : " + cSkillPoint(cc), 30)
			noteadd fixtxt("金貨       : " + cGold(cc), 30)
		}
		noteadd ""
		procid = (procid + 1) \ 10
		proclist(procid) = "Dump:2" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		s(1) = "生命力    : " + sdata(SKILL_ATTR_LIFE, cc) + "(" + sorgex(2, cc) + ")"
		s(2) = "マナ      : " + sdata(SKILL_ATTR_MANA, cc) + "(" + sorgex(3, cc) + ")"
		s(3) = "狂気度    : " + cSAN(cc)
		s(4) = "速度      : " + cSpeed(cc)
		s(5) = "名声度    : " + cFame(cc)
		s(6) = "カルマ    : " + cKarma(cc)
		s(7) = "DV        : " + cDV(cc)
		s(8) = "PV        : " + cPV(cc)
		s(9) = ""
		procid = (procid + 1) \ 10
		proclist(procid) = "Dump:3" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		repeat 8
			s = ""
			p = sdata(10 + cnt + STARTING_SKILL_SPACT, cc) \ 1000
			if ( p >= 450 ) {
				s += "Extra"
			}
			else {
				if ( p >= 400 ) {
					s += "Superb++"
				}
				else {
					if ( p >= 360 ) {
						s += "Superb+"
					}
					else {
						if ( p >= 200 ) {
							s += "Superb"
						}
						else {
							if ( p >= 150 ) {
								s += "Great"
							}
							else {
								if ( p >= 100 ) {
									s += "Good"
								}
								else {
									if ( p >= 50 ) {
										s += "Bad"
									}
									else {
										s += "Hopeless"
									}
								}
							}
						}
					}
				}
			}
			s = fixtxt(s, 15)
			s = fixtxt(_stats2(cnt) + "    : " + sdata(10 + cnt, cc) + "(" + sorgex(10 + cnt, cc) + ")", 24) + s
			noteadd s + s(1 + cnt)
		loop
		noteadd ""
		procid = (procid + 1) \ 10
		proclist(procid) = "Dump:4" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		val = 1
		gosub *com_calcAttack
		tc = cc
		attackskill = SKILL_WEAPON_MARTIAL_ARTS
		evade = calcattackhit(2)
		prot = calcattackdmg(2)
		noteadd "回避    : " + evade + "%"
		noteadd "軽減    : " + (100 - 10000 / (prot + 100)) + "% + " + protdice1 + "d" + protdice2
		noteadd ""
		noteadd "---------------------- 装備品 合計重量" + cnvweight(cEqWeight(cc)) + " " + cnveqweight(cc)
		noteadd ""
		procid = (procid + 1) \ 10
		proclist(procid) = "Dump:5" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		listmax = 0
		repeat 30, 100
			if ( cdata(cnt, cc) != 0 ) {
				if ( cc == CHARA_PLAYER ) {
					if ( gettrait(0, 206) != 0 ) {
						if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 2 ) {
							continue
						}
					}
					if ( gettrait(0, 203) != 0 ) {
						if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 9 ) {
							continue
						}
					}
					if ( gettrait(0, 205) != 0 ) {
						if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 3 ) {
							continue
						}
					}
					if ( gettrait(0, 217) != 0 ) {
						if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 1 ) {
							continue
						}
						if ( gettrait(0, 217) == (-2) ) {
							if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 8 ) {
								continue
							}
						}
					}
					if ( gettrait(0, 218) != 0 ) {
						if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == 5 ) {
							continue
						}
					}
				}
				p(1) = cdata(cnt, cc)
				q2 = "装備なし", ""
				if ( p(1) \ 10000 != 0 ) {
					p(1) = p(1) \ 10000 - 1
					q2 = itemname(p(1)), cnvweight(iWeight(p(1)))
					ci = p(1)
					dump_return = 1
					gosub *com_inventory_loop_WEND1
					notesel buff
				}
				else {
					listmax = 0
				}
				s = bodyn(cdata(cnt, cc) / EXT_EQUIP_SLOTS)
				if ( strmid(s, 0, 2) == "　" ) {
					s = strmid(s, 2, 2)
				}
				noteadd s + ":"
				noteadd q2 + " " + q2(1)
				repeat listmax
					noteadd listn(0, cnt)
				loop
				noteadd ""
			}
		loop
		procid = (procid + 1) \ 10
		proclist(procid) = "Dump:6" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		noteadd "---------------------- 特徴"
		noteadd ""
		dump_return = 1
		tc = cc
		gosub *com_trait_loop
		repeat listmax
			if ( list(0, cnt) < 0 ) {
				continue
			}
			if ( list(1, cnt) < 10000 ) {
				continue
			}
			noteadd listn(0, cnt)
		loop
		noteadd ""
		if ( cc == CHARA_PLAYER ) {
			noteadd "---------------------- 仲間"
		}
	loop
	procid = (procid + 1) \ 10
	proclist(procid) = "Dump:8" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	noteadd "---------------------- 称号"
	noteadd ""
	repeat 9
		if ( gdata(STARTING_GDATA_RANK + cnt) < 10000 ) {
			noteadd "" + ranktitle(cnt) + " Rank." + gdata(STARTING_GDATA_RANK + cnt) / 100
			s = "給料: 約 " + calcincome(cnt) + " gold  " + "ノルマ: "
			gold += calcincome(cnt)
			if ( cnt == 3 | cnt == 4 | cnt == 5 | cnt == 8 ) {
				s += "なし"
			}
			else {
				s += "" + gdata(140 + cnt) + "日以内"
			}
			noteadd s
			noteadd ""
		}
	loop
	procid = (procid + 1) \ 10
	proclist(procid) = "Dump:9" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	s = exedir + "\\save\\" + playerid + ".txt"
	notesave s
	exec s, 16
	cc = CHARA_PLAYER
	tc = CHARA_PLAYER
	sdim buff, 10000
	return

*com_ammo
	gosub *label_4654
	if ( ammo == (-1) ) {
		txt -1, lang("矢弾を装備していない。", "You need to equip an ammo.")
		goto *pc_turn
	}
	ci = ammo
	listmax = 0
	cs = -1
	repeat 15
		if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
			break
		}
		enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci)
		i = enc / 10000
		if ( i != 0 ) {
			enc = enc \ 10000
			if ( i == 9 ) {
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == cnt ) {
					cs = cnt
				}
				list(0, listmax) = cnt
				listmax++
				continue
			}
		}
	loop
	if ( listmax == 0 ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = -1
		txt -1, lang(itemname(ci) + "は切り替えに対応していない。", itemname(ci) + " isn't capable of changing ammos.")
		goto *pc_turn
	}
	snd SOUNDLIST_AMMO
	cs++
	if ( cs >= listmax ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = -1
	}
	else {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = list(0, cs)
	}
	txt -1, lang("現在の装填弾:", "Current Ammo Type:")
	repeat listmax + 1
		if ( cnt == 0 ) {
			s = lang("通常弾", "Normal"), lang("無限", "Unlimited")
		}
		else {
			p = list(0, cnt - 1)
			i = inv(STARTING_INV_ITEM_ENCHANT_POWER + p * 2, ci) \ 1000, inv(STARTING_INV_ITEM_ENCHANT_POWER + p * 2, ci) / 1000
			s = ammoname(inv(STARTING_INV_ITEM_ENCHANT + p * 2, ci) \ 10000), "" + i + "/" + i(1)
		}
		s = s + ":" + s(1)
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == cnt - 1 ) {
			s = "[" + s + "]"
			txtef COLOR_BLUE
		}
		else {
			s = " " + s + " "
		}
		txt -1, " " + s
	loop
	goto *pc_turn

*label_3060
	inv_getheader -1
	repeat invrange, invhead
		dup roopbuf, iID(cnt)
		if ( roopbuf == 504 | roopbuf == 503 | roopbuf == 745 ) {
			iNum(cnt) = 0
		}
	loop
	return

*label_3062
	procid = (procid + 1) \ 10
	proclist(procid) = "fixOnMapEnter" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	repeat 245
		if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
			if ( cX(cnt) < 0 | cX(cnt) >= mWidth | cY(cnt) < 0 | cY(cnt) >= mHeight ) {
				cX(cnt) = 0
				cY(cnt) = 0
			}
		}
	loop
	if ( mType != MAP_TYPE_HOME ) {
		if ( mMaxInv != 0 ) {
			mMaxInv = 0
		}
	}
	if ( gArea  == AREA_HOME ) {
		areaMinLevel(gArea ) = 0
		areaCanSave(gArea ) = 10
		if ( ncgHomeBasementFloors == 1 ) {
			areaCanSave(gArea ) = 20
		}
		if ( ncgHomeBasementFloors == 2 ) {
			areaCanSave(gArea ) = 30
		}
		if ( ncgHomeBasementFloors == 3 ) {
			areaCanSave(gArea ) = 40
		}
		areaIcon(gArea ) = 1
		mRestorePos = 1
		evadd EVENT_WELCOME
		welcome_f = 0
		if ( cfg_welcomemessage == 1 ) {
			if ( gAreaPrev == gArea  ) {
				welcome_f = 1
			}
		}
		calccosthire
	}
	if ( areaId(gArea ) == AREA_MUSEUM | areaId(gArea ) == AREA_SHOP | areaId(gArea ) == AREA_CROP | areaId(gArea ) == AREA_STORAGE_HOUSE ) {
		mRestorePos = cfg_npcposition
	}
	return

*label_3064
	gMapVersion++
	dim qdata, 20, 500
	sdim qname, 40, 500
	gClient = 0
	gosub *label_2367
	return

*label_3065
	file = "shop" + 3 + ".s2"
	ctrlfile 4
	p = 0
	i = 0
	repeat 600
		if ( cnt >= 10 & cnt < 20 ) {
			p += sorg(cnt, MAX_CHARA_NC)
		}
		if ( cnt >= 100 & cnt < 400 ) {
			i += sorg(cnt, MAX_CHARA_NC)
		}
	loop
	p = (p - 250) / 7
	if ( p < 5 ) {
		p = 5
	}
	else {
		if ( p > 50 ) {
			p = 50
		}
	}
	i = (i - 250) / 8
	if ( i < 5 ) {
		i = 5
	}
	else {
		if ( i > 40 ) {
			i = 40
		}
	}
	if ( takeover(2) == 0 ) {
		se_moneymod 0, limit(cGold(MAX_CHARA_NC) / 100, 1000, 100000)
	}
	if ( takeover(3) == 0 ) {
		cPlat(CHARA_PLAYER) += p
	}
	if ( takeover(4) == 0 ) {
		cSkillPoint(CHARA_PLAYER) += i
	}
	if ( takeover(1) == 0 ) {
		if ( mat(399) == 0 ) {
			nc_intb_001 = mat(1)
			nc_intb_002 = mat(40)
			nc_intb_003 = mat(41)
			repeat 400
				mat(cnt) = 0
			loop
			mat(50) = nc_intb_001
			mat(51) = nc_intb_002
			mat(52) = nc_intb_003
			mat(399) = 1
		}
		else {
			repeat 400
				mat(cnt) = mat(cnt) / 3
			loop
		}
	}
	else {
		repeat 400
			mat(cnt) = 0
		loop
	}
	del_chara 56
	return

*label_3070
	ctrlfile 15
	dim spell, 200
	dim spact, 500
	repeat 1200
		sdata(cnt, MAX_CHARA_NC) = sdata(cnt, CHARA_PLAYER)
		sdata(cnt, CHARA_PLAYER) = 0
	loop
	repeat 600
		sdataex(cnt, 56) = sdataex(cnt, 0)
		sdataex(cnt, 0) = 0
	loop
	repeat 500
		cdata(cnt, MAX_CHARA_NC) = cdata(cnt, CHARA_PLAYER)
		cdata(cnt, CHARA_PLAYER) = 0
	loop
	inv_getheader -1
	repeat invrange, invhead
		iNum(cnt) = 0
	loop
	f = 0
	inv_getheader 0
	repeat invrange, invhead
		dup roopbuf, iID(cnt)
		if ( iNum(cnt) == 0 ) {
			continue
		}
		if ( roopbuf == 699 & iParam1(cnt) == 1 ) {
			f = 1
			iParam1(cnt) = 0
			continue
		}
		if ( roopbuf != 743 ) {
			if ( refitem(roopbuf, DBSPEC_TYPE, cnt) < FILTER_ITEM_MIN & iParam3(cnt) > 0 ) {
				iParam3(cnt) = 0
			}
		}
	loop
	inv_getheader 0
	repeat invrange, invhead
		dup roopbuf, iID(cnt)
		if ( iNum(cnt) == 0 ) {
			continue
		}
		if ( roopbuf == 505 ) {
			if ( takeover(8) == 0 ) {
				ogbitmod 8, 1
			}
		}
		if ( roopbuf == 717 ) {
			if ( takeover(7) == 0 ) {
				lomiaseaster = 1
			}
		}
		if ( roopbuf == 511 | refitem(roopbuf, DBSPEC_TYPE_MINOR, cnt) == FILTER_ITEM_DEED ) {
			continue
		}
		if ( roopbuf == 578 ) {
			continue
		}
		if ( iQuality(cnt) == FIX_QUALITY_UNIQUE & f == 0 ) {
			continue
		}
		if ( ibit(ITEM_BIT_PRECIOUS, cnt) & f == 0 ) {
			continue
		}
		if ( refitem(roopbuf, DBSPEC_TYPE, cnt) == FILTER_AMMO ) {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), cnt) = -1
		}
		if ( takeover(0) ) {
			continue
		}
		if ( ibit(ITEM_BIT_HANDMADE, cnt) ) {
			if ( roopbuf != 667 ) {
				ibitmod ITEM_BIT_HANDMADE, cnt, FALSE
			}
		}
		iEquip(cnt) = 0
		item_copy cnt, inv_getfreeid(-1)
	loop
	repeat 245
		if ( takeover(6) == 0 ) {
			if ( cnt >= 1 & cnt < 16 ) {
				if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
					continue
				}
			}
		}
		if ( cnt == 56 ) {
			continue
		}
		del_chara cnt
	loop
	if ( takeover(5) == 0 ) {
		gPlayTime = genetemp(GDATA_PLAY_TIME)
	}
	if ( takeover(9) == 0 ) {
		gRandSeedA = genetemp(GDATA_RAND_SEED_A)
	}
	return

*label_3078
	ctrlfile 14
	return

#deffunc zipadd str zipadd_arg1
	p = 12
	exist folder + zipadd_arg1
	len = strsize + p * 2
	lenhead = lensum
	lensum += len
	sdim ziptmp1, p
	ziptmp1 += zipadd_arg1
	sdim ziptmp2, p
	ziptmp2 += str(len)
	memexpand filebuff, lensum
	memcpy filebuff, ziptmp1, p, lenhead
	memcpy filebuff, ziptmp2, p, lenhead + p
	sdim filetemp, len - p * 2
	bload folder + zipadd_arg1, filetemp, , 0
	memcpy filebuff, filetemp, len - p * 2, lenhead + p * 2
	return

*unzip
	p = 12
	folder = exedir + "user\\"
	bload folder + file, headtemp, 1024
	gosub *dump_config_import
	exist folder + file
	zipsize = strsize
	sdim filebuff, zipsize
	bload folder + file, filebuff, zipsize
	lenhead = 1024
	repeat 10000
		sdim ziptmp1, p
		sdim ziptmp2, p
		memcpy ziptmp1, filebuff, p, 0, lenhead
		memcpy ziptmp2, filebuff, p, 0, lenhead + p
		len = int(ziptmp2)
		sdim filetemp, len - p * 2
		memcpy filetemp, filebuff, len - p * 2, 0, lenhead + p * 2
		bsave folder + ziptmp1, filetemp
		lenhead += len
		if ( lenhead >= zipsize ) {
			break
		}
	loop
	return

#deffunc zipinit2 str zipinit2_arg1, str zipinit2_arg2
	locvar_zipinit2_lensum = 0
	locvar_zipinit2_zipfolder = zipinit2_arg1
	locvar_zipinit2_zipfinalfile = zipinit2_arg2
	sdim locvar_zipinit2_filebuff
	return

#deffunc zipadd2 str zipadd2_arg1
	locvar_zipadd2_p = 50, 40, 10
	exist locvar_zipinit2_zipfolder + zipadd2_arg1
	locvar_zipadd2_len = strsize + locvar_zipadd2_p
	locvar_zipadd2_lenhead = locvar_zipinit2_lensum
	locvar_zipinit2_lensum += locvar_zipadd2_len
	sdim locvar_zipadd2_ziptmp1, locvar_zipadd2_p(1)
	locvar_zipadd2_ziptmp1 += zipadd2_arg1
	sdim locvar_zipadd2_ziptmp2, locvar_zipadd2_p(2)
	locvar_zipadd2_ziptmp2 += str(locvar_zipadd2_len)
	memexpand locvar_zipinit2_filebuff, locvar_zipinit2_lensum
	memcpy locvar_zipinit2_filebuff, locvar_zipadd2_ziptmp1, locvar_zipadd2_p(1), locvar_zipadd2_lenhead
	memcpy locvar_zipinit2_filebuff, locvar_zipadd2_ziptmp2, locvar_zipadd2_p(2), locvar_zipadd2_lenhead + locvar_zipadd2_p(1)
	sdim locvar_zipadd2_filetemp, locvar_zipadd2_len - locvar_zipadd2_p
	bload locvar_zipinit2_zipfolder + zipadd2_arg1, locvar_zipadd2_filetemp, , 0
	memcpy locvar_zipinit2_filebuff, locvar_zipadd2_filetemp, locvar_zipadd2_len - locvar_zipadd2_p, locvar_zipadd2_lenhead + locvar_zipadd2_p
	return

#deffunc zipend2
	bsave locvar_zipinit2_zipfolder + locvar_zipinit2_zipfinalfile, locvar_zipinit2_filebuff
	return

#deffunc unzip2 str unzip2_arg1, str unzip2_arg2
	locvar_zipadd2_p = 50, 40, 10
	exist unzip2_arg1 + unzip2_arg2
	locvar_unzip2_zipsize = strsize
	sdim locvar_zipinit2_filebuff, locvar_unzip2_zipsize
	bload unzip2_arg1 + unzip2_arg2, locvar_zipinit2_filebuff, locvar_unzip2_zipsize
	locvar_zipadd2_lenhead = 0
	repeat 10000
		sdim locvar_zipadd2_ziptmp1, locvar_zipadd2_p(1)
		sdim locvar_zipadd2_ziptmp2, locvar_zipadd2_p(2)
		memcpy locvar_zipadd2_ziptmp1, locvar_zipinit2_filebuff, locvar_zipadd2_p(1), 0, locvar_zipadd2_lenhead
		memcpy locvar_zipadd2_ziptmp2, locvar_zipinit2_filebuff, locvar_zipadd2_p(2), 0, locvar_zipadd2_lenhead + locvar_zipadd2_p(1)
		locvar_zipadd2_len = int(locvar_zipadd2_ziptmp2)
		if ( locvar_zipadd2_len == 0 ) {
			break
		}
		sdim locvar_zipadd2_filetemp, locvar_zipadd2_len - locvar_zipadd2_p
		memcpy locvar_zipadd2_filetemp, locvar_zipinit2_filebuff, locvar_zipadd2_len - locvar_zipadd2_p, 0, locvar_zipadd2_lenhead + locvar_zipadd2_p
		bsave unzip2_arg1 + locvar_zipadd2_ziptmp1, locvar_zipadd2_filetemp
		locvar_zipadd2_lenhead += locvar_zipadd2_len
		if ( locvar_zipadd2_lenhead >= locvar_unzip2_zipsize ) {
			break
		}
	loop
	return

#defcfunc getnpctxt_nc str getnpctxt_nc_prm0, str getnpctxt_nc_prm1
	nc_strb_001 = getnpctxt("nc_" + getnpctxt_nc_prm0, getnpctxt_nc_prm1)
	if ( getnpctxt_nc_prm1 == nc_strb_001 ) {
		nc_strb_001 = getnpctxt(getnpctxt_nc_prm0, getnpctxt_nc_prm1)
	}
	return nc_strb_001

#defcfunc getnpctxt str getnpctxt_arg1, str getnpctxt_arg2
	locvar_getnpctxt_p = instr(txtbuff, 0, getnpctxt_arg1)
	if ( locvar_getnpctxt_p == (-1) ) {
		return getnpctxt_arg2
	}
	locvar_getnpctxt_p += instr(txtbuff, locvar_getnpctxt_p, "\"")
	if ( locvar_getnpctxt_p == (-1) ) {
		return getnpctxt_arg2
	}
	return strmid(txtbuff, locvar_getnpctxt_p + 1, limit(instr(txtbuff, locvar_getnpctxt_p + 1, "\""), 0, 2000))

*label_3089
	if ( initunid ) {
		cUNID(rc) = initunid - 1
		initunid = 0
	}
	cun = cUNID(rc)
	cId(rc) = CREATURE_ID_USER
	if ( initlv != 0 ) {
		cLevel(rc) = initlv
	}
	else {
		cLevel(rc) = limitmin(userdata(2, cun), 1)
	}
	if ( voidlv != 0 ) {
		cLevel(rc) = voidlv * (100 + cLevel(rc) * 2) / 100
		if ( cLevel(rc) > 999999 ) {
			cLevel(rc) = 999999
		}
	}
	cPortrait(rc) = -1
	creaturepack = FILTER_NOTHING
	cAiSub(rc) = unaiactsubfreq(cun)
	cActIndex(rc) = 0
	repeat 5
		if ( userdata(15 + cnt, cun) != 0 ) {
			cdata(STARTING_CDATA_ACT_MAIN + cnt, rc) = userdata(15 + cnt, cun)
			cActIndex(rc)++
		}
		if ( userdata(20 + cnt, cun) != 0 ) {
			cdata(STARTING_CDATA_ACT_SUB + cnt, rc) = userdata(20 + cnt, cun)
			cActIndex(rc) += 10
		}
	loop
	if ( userdatan(5, cun) != "" ) {
		sdim unres, 6, 32
		csvstr2 unres, userdatan(5, cun)
		repeat
			if ( cnt > 15 | unres(cnt) == "" ) {
				break
			}
			sdata(int(unres(cnt * 2)), rc) += int(unres(cnt * 2 + 1)) * 50
		loop
	}
	cTxt(rc) = 1
	cnName(rc) = userdatan(1, cun)
	if ( userdata2(6, cun) ) {
		cnName(rc) = lang(cnName(rc) + "の" + randomname(), randomname() + " the " + cnName(rc))
	}
	cnUNTAG(rc) = userdatan(0, cun)
	cRelation(rc) = limit(userdata(4, cun), -3, 10)
	cAiCalm(rc) = limit(userdata(7, cun), 1, 5)
	cAiMoveFreq(rc) = limit(userdata(8, cun), 0, 100)
	cAiDistance(rc) = limit(userdata(9, cun), 1, 100)
	if ( userdata(11, cun) ) {
		cdata(CDATA_ELEMENT, rc) = limit(userdata(11, cun), SKILL_RES_FIRE * 100000, MAX_SKILL_RESDMG * 100000)
	}
	if ( userdata2(7, cun) ) {
		cBarrier(rc) = limit(userdata2(7, cun), 50 + 1 * 1000, 63 + 9999 * 1000)
	}
	cActHeal(rc) = userdata(10, cun)
	dbidn = userdatan(2, cun)
	dbmode = DBMODE_SET
	gosub *cm_race
	dbidn = userdatan(3, cun)
	dbmode = DBMODE_SET
	gosub *cm_race_loop
	cSex(rc) = userdata(3, cun)
	if ( userdata(3, cun) != 0 ) {
		if ( userdata(3, cun) != 1 ) {
			cSex(rc) = rnd(2)
		}
	}
	if ( userdata3(0, cun) > (-1) ) {
		cAge(rc) = gYear  - userdata3(0, cun)
	}
	if ( userdata3(3, cun) > (-1) ) {
		cTone(rc) = userdata3(3, cun)
	}
	if ( userdata(5, cun) ) {
		fixlv = limit(userdata(5, cun), 0, 6)
	}
	if ( locvar_getnpctxt_ragnarokflag ) {
		fixlv = FIX_QUALITY_UNIQUE
	}
	if ( userdatan2(2, cun) != "" ) {
		cspecialeq = 1
	}
	else {
		cspecialeq = 0
	}
	cOrgRelation(rc) = cRelation(rc)
	setunid rc, cun
	return

*label_3093
	usernpcmax = 0
	getuserfiledata "npc", usernpcmax
	getuserfiledata "oonpc", usernpcmax
	procid = (procid + 1) \ 10
	proclist(procid) = "[Custom Npc] " + usernpcmax + " cnpcs detected." + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( usernpcmax > 3000 ) {
		usernpcmax = 3000
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] The upper limit of the number of cnpcs is " + usernpcmax + ". The rest won't be loaded." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
	}
	dim userdata, 70, usernpcmax + 1
	dim userdata2, 11, usernpcmax + 1
	dim userdata3, 5, usernpcmax + 1
	dim usernpcmatval, 5, usernpcmaxbuffer
	dim usernpcmatneed, 12, usernpcmaxbuffer
	dim userspact, usernpcmax + 1, 22
	dim unaiactsubfreq, usernpcmax + 1
	sdim userdatan, 40, 10, usernpcmax + 1
	sdim userdatan2, 40, 10, usernpcmax + 1
	sdim usertxt, 80 * 1000, usernpcmax + 1
	sdim userracefield, 2000
	sdim userrace, 2000
	sdim userclassfield, 2000
	sdim userclass, 2000
	sdim usernpcmatfaith, 40, usernpcmaxbuffer
	sdim untaglist
	unCount = 0
	buffer BUFFER_CHR, 33 * 48, (25 + (usernpcmax / 33 + 1) * 2) * 48 + 32
	pos 0, 0
	picload_ exedir + "\\graphic\\character.bmp", 1
	buffer 100, 16 * 80, (usernpcmax / 16 + 1) * 112
	gmode 0
	tg = 0
	repeat usernpcmax
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Load: dir=" + userfilelist(1, cnt) + ", file=" + userfilelist(0, cnt) + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		cnt2 = tg
		unzip2 userfilelist(1, cnt), userfilelist(0, cnt)
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Load npc definition." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		zOpen hgz, userfilelist(1, cnt) + "npc1.t", 0
		zRead userdata(0, tg), hgz, 70 * 4
		zClose hgz
		dim bmpbuff, userdata(0, tg)
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Load character chip." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		zOpen hgz, userfilelist(1, cnt) + "npc2.t", 0
		zRead bmpbuff, hgz, userdata(0, tg)
		zClose hgz
		sdim txtbuff, userdata(1, tg) + 1
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Load npc definition (2)." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		zOpen hgz, userfilelist(1, cnt) + "npc3.t", 0
		zRead txtbuff, hgz, userdata(1, tg)
		zClose hgz
		if ( userdata(2, tg) != 0 ) {
			dim facebuff, userdata(2, tg)
			userdata2(0, tg) = 1
		}
		if ( userdata2(0, tg) == 1 ) {
			procid = (procid + 1) \ 10
			proclist(procid) = "[Custom Npc] Load portrait." + " ct:" + ct
			if ( dbg_outputdebuglog ) {
			}
			zOpen hgz, userfilelist(1, cnt) + "npc4.t", 0
			zRead facebuff, hgz, userdata(2, tg)
			zClose hgz
		}
		cleanuserdir userfilelist(1, cnt)
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Load npc definition (3)." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		userdatan(0, tg) = s
		userdatan(1, tg) = s(jp)
		s = userfilelist(0, cnt)
		userdatan(6, tg) = s
		if ( instr(untaglist, 0, "/" + userdatan(0, tg) + "/") != (-1) ) {
			usernpcmax--
			if ( instr(s, 0, "_tmp_") == (-1) ) {
				msgtemp += lang("同名NPCは読み込まれない。", "A npc of the same name has already been defined.") + "(skipped:" + userdatan(0, tg) + "," + s + ") "
			}
			continue
		}
		untaglist += "/" + userdatan(0, tg) + "/"
		if ( instr(s, 0, "_tmp_") != (-1) ) {
			unCount++
		}
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Set basic information." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		userdatan(2, tg) = getnpctxt_nc("race.", "slime")
		userdatan(3, tg) = getnpctxt_nc("class.", "tourist")
		userdatan(4, tg) = getnpctxt_nc("filter.", "")
		userdatan(5, tg) = getnpctxt_nc("resist.", "")
		s = getnpctxt_nc("meleeElem.", "0,0")
		csvstr2 s, s
		userdata(11, tg) = int(s) * 100000 + int(s(1))
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Set big flags." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		s = getnpctxt_nc("bitOn.", "0,0")
		csvstr2 s, s
		repeat
			p = int(s(cnt))
			if ( cnt > 20 | p == 0 ) {
				break
			}
			HMMBITON userdata(40 + p / 32, cnt2), p \ 32
		loop
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Set actions." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		s = getnpctxt_nc("aiAct.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			userdata(15 + cnt, cnt2) = int(s(cnt))
		loop
		s = getnpctxt_nc("aiActSub.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			userdata(20 + cnt, cnt2) = int(s(cnt))
		loop
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Npc] Set additional information." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		userdata(12, tg) = int(getnpctxt_nc("spawnType.", "0"))
		userdata(2, tg) = int(getnpctxt_nc("level.", "1"))
		userdata(3, tg) = int(getnpctxt_nc("sex.", "-1"))
		userdata(4, tg) = int(getnpctxt_nc("relation.", "-1"))
		userdata(5, tg) = int(getnpctxt_nc("fixLv.", "0"))
		userdata(6, tg) = int(getnpctxt_nc("rare.", "0"))
		userdata(7, tg) = int(getnpctxt_nc("aiCalm.", "1"))
		userdata(8, tg) = int(getnpctxt_nc("aiMove.", "50"))
		userdata(9, tg) = int(getnpctxt_nc("aiDist.", "1"))
		userdata(10, tg) = int(getnpctxt_nc("aiHeal.", "0"))
		unaiactsubfreq(tg) = int(getnpctxt_nc("aiActSubFreq.", "0"))
		userdata2(1, tg) = limit(int(getnpctxt_nc("transmissivity.", "0")), 0, 256)
		userdata2(2, tg) = int(getnpctxt_nc("dropShadowType.", "0"))
		userdata2(3, tg) = int(getnpctxt_nc("cSetPos.", "16"))
		userdata2(4, tg) = int(getnpctxt_nc("noFoodOrDrink.", "0"))
		userdata2(5, tg) = int(getnpctxt_nc("cnpcRole.", "0"))
		userdata2(6, tg) = int(getnpctxt_nc("randomName.", "0"))
		s = getnpctxt_nc("counterElem.", "0,0")
		csvstr2 s, s
		userdata2(7, tg) = int(s) + int(s(1)) * 1000
		userdata2(8, tg) = int(getnpctxt_nc("chipref.", "0"))
		userdata2(9, tg) = int(getnpctxt_nc("colref.", "0"))
		userdata2(10, tg) = int(getnpctxt_nc("isGodServant.", "0"))
		userdatan2(0, tg) = getnpctxt_nc("raceAlias.", "")
		if ( en ) {
			userdatan2(0, tg) = getnpctxt_nc("raceAlias_en.", userdatan2(0, tg))
		}
		userdatan2(1, tg) = getnpctxt_nc("classAlias.", "")
		if ( en ) {
			userdatan2(0, tg) = getnpctxt_nc("classAlias_en.", userdatan2(1, tg))
		}
		userdatan2(3, tg) = getnpctxt_nc("fixFaith.", "")
		userdatan2(4, tg) = getnpctxt_nc("fixPortrait.", "-2")
		s = getnpctxt_nc("userRace.", "")
		s = strtrim(s, 3, 13)
		s = strtrim(s, 3, 10)
		if ( s != "" ) {
			if ( instr(userrace, 0, s) == (-1) ) {
				userrace += s + "\n"
				s = getnpctxt_nc("raceField.", "name,id,id2,playable,sex,pic,pic2,dv,pv,hp,mp,str,end,dex,per,ler,wil,mag,chr,spd,meleeStyle,castStyle,resist,ageRnd,age,blood,breeder,height,skill,trait,figure,description,desc-e")
				s = strtrim(s, 3, 13)
				s = strtrim(s, 3, 10)
				userracefield += s + "\n"
			}
		}
		s = getnpctxt_nc("userClass.", "")
		s = strtrim(s, 3, 13)
		s = strtrim(s, 3, 10)
		if ( s != "" ) {
			if ( instr(userclass, 0, s) == (-1) ) {
				userclass += s + "\n"
				s = getnpctxt_nc("classField.", "name,id,playable,str,end,dex,per,ler,wil,mag,chr,spd,equip,skill,description,desc-e")
				s = strtrim(s, 3, 13)
				s = strtrim(s, 3, 10)
				userclassfield += s + "\n"
			}
		}
		userdatan2(2, tg) = getnpctxt_nc("initEquip.", "")
		userdata3(0, tg) = int(getnpctxt_nc("genAge.", "-1"))
		userdata3(1, tg) = int(getnpctxt_nc("genHeight.", "-1"))
		userdata3(2, tg) = int(getnpctxt_nc("genWeight.", "-1"))
		userdata3(3, tg) = int(getnpctxt_nc("tone.", "-1"))
		userdata3(4, tg) = int(getnpctxt_nc("matpet.", "0"))
		s = getnpctxt_nc("matval.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			usernpcmatval(cnt, tg) = int(s(cnt))
		loop
		s = getnpctxt_nc("matneed.", "-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1")
		csvstr2 s, s
		repeat 12
			usernpcmatneed(cnt, tg) = int(s(cnt))
			if ( cnt \ 2 == 1 & usernpcmatneed(cnt, tg) <= 0 ) {
				usernpcmatneed(cnt - 1, tg) = -1
				usernpcmatneed(cnt, tg) = -1
			}
		loop
		usernpcmatfaith(tg) = getnpctxt_nc("matfaith.", "")
		sdim s, 160, 40
		s = getnpctxt_nc("userSpact.", "")
		split s, "|", s
		repeat 22
			if ( s(cnt) == "" ) {
				break
			}
			userspact(tg, cnt) = int(s(cnt))
		loop
		p = instr(txtbuff, 0, "%txt")
		txtbuff = strmid(txtbuff, p, instr(txtbuff, 0, "%endTxt") - p + 7)
		usertxt(tg) = strmid(txtbuff, 0, 80 * 400 - 2)
		procid = (procid + 1) \ 10
		proclist(procid) = "userNpc_update:2.1" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		gsel BUFFER_PIC2
		file = exedir + "user\\graphic\\cchara_" + userdatan(0, tg) + ".bmp"
		exist file
		if ( strsize != (-1) ) {
			picload_ file
		}
		else {
			memfile bmpbuff
			picload_ "MEM:temp.bmp"
		}
		if ( ginfo(13) > 50 ) {
			chipc(CHIPC_X, 33 * 25 + tg) = tg \ 33 * inf_tiles, 25 * inf_tiles + tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles * 2, inf_tiles + userdata2(3, tg) - 8
		}
		else {
			chipc(CHIPC_X, 33 * 25 + tg) = tg \ 33 * inf_tiles, 25 * inf_tiles + tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles, userdata2(3, tg)
		}
		gsel BUFFER_CHR
		pos tg \ 33 * 48, 25 * 48 + tg / 33 * 96
		gcopy BUFFER_PIC2, 0, 0, 48, 96
		if ( userdata2(0, tg) == 1 ) {
			gsel 100
			pos tg \ 16 * 80, tg / 16 * 112
			memfile facebuff
			picload_ "MEM:", 1
		}
		tg++
	loop
	procid = (procid + 1) \ 10
	proclist(procid) = "userNpc_update:3" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	gosub *del_userNpc
	procid = (procid + 1) \ 10
	proclist(procid) = "userNpc_update:Replace bmp" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	gsel BUFFER_CHR
	folder = exedir + "user\\graphic\\"
	dirlist buff, folder + "chara_*.bmp"
	notesel buff
	repeat stat
		noteget file, cnt
		p = int(strmid(file, 6, instr(file, 6, ".")))
		if ( p > 824 ) {
			continue
		}
		if ( p <= 660 ) {
			gsel BUFFER_CHR
			pos p \ 33 * inf_tiles, p / 33 * inf_tiles
			picload_ folder + file, 1
		}
		else {
			gsel BUFFER_PIC2
			picload_ folder + file
			if ( ginfo(13) > 50 ) {
				chipc(CHIPC_X, p) = (p - 660) \ 33 * inf_tiles, (p - 660) / 33 * inf_tiles * 2, inf_tiles, inf_tiles * 2, inf_tiles + 8
			}
			else {
				chipc(CHIPC_X, p) = (p - 660) \ 33 * inf_tiles, (p - 660) / 33 * inf_tiles * 2, inf_tiles, inf_tiles, 16
			}
			gsel 95
			pos (p - 660) \ 33 * 48, (p - 660) / 33 * 96
			gcopy BUFFER_PIC2, 0, 0, 48, 96
		}
	loop
	gsel BUFFER_CHR
	dirlist buff, folder + "buffIcon_*.bmp"
	notesel buff
	repeat stat
		noteget file, cnt
		p = int(strmid(file, 9, instr(file, 9, ".")))
		pos p \ 50 * 32, buffy(p)
		picload_ folder + file, 1
	loop
	gsel BUFFER_SCREEN
	if ( charaffhpflag ) {
		buffer 35, 33 * 48, 25 * 48
		folder = exedir + "user\\graphic\\"
		dirlist buff, folder + "charaEX_*.bmp"
		notesel buff
		repeat stat
			noteget file, cnt
			p = int(strmid(file, 8, instr(file, 8, ".")))
			pos p \ 33 * inf_tiles, p / 33 * inf_tiles
			picload_ folder + file, 1
		loop
		gsel BUFFER_SCREEN
	}
	gosub *label_4346
	gosub *label_4341
	gosub *label_4651
	return

*label_3104
	comctrl = 0
	gosub *user_npc
	if ( stat == 0 ) {
		return
	}
	q = refstr
	gosub *label_3093
	initunid = findunid(q)
	txt -1, lang("カスタムNPCを作成した！", "A custom NPC has been successfully generated!")
	flt
	characreate -1, CREATURE_ID_USER, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
	repeat 5480
		if ( ICNpcSerialNo(cnt) ) {
			getunid4item cnt
		}
	loop
	repeat gClient
		if ( qClient(cnt) == 0 ) {
			continue
		}
		if ( qExist(cnt) == QUEST_TYPE_CONQUER | qExist(cnt) == QUEST_TYPE_HUNTEX & qParam1(cnt) == 343 ) {
			getunid4job cnt
		}
	loop
	cRelation(rc) = RELATION_ENEMY
	txt -1, lang(name(rc) + "は興奮して襲い掛かってきた。", name(rc) + " is excited and attacks you.")
	folder = exedir + "user\\"
	gosub *del_userTemp
	return

*user_npc
	fread = 0
	facefile = ""
	cun = usernpcmax
	txt -1, lang("どのファイルからNPCを作成する？", "Use which file to create NPC?")
	redraw 1
	fileext = "txt"
	filedsc = "Custom Npc Text"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if ( stat == 0 ) {
		return 0
	}
	txtfile = refstr
	exist txtfile
	userdata(1, cun) = strsize
	sdim txtbuff, strsize + 1
	bload txtfile, txtbuff
	if ( comctrl == 1 ) {
		s = "%Elona Custom Unique Npc"
	}
	else {
		s = "%Elona Custom Npc"
	}
	if ( instr(txtbuff, 0, s) == (-1) ) {
		txt -1, "Invalid File. Aborting."
		return 0
	}
	txt -1, lang("どの画像を埋め込む？", "Embed which picture?")
	redraw 1
	fileext = "bmp"
	filedsc = "Bit Map File"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if ( stat == 0 ) {
		return 0
	}
	bmpfile = refstr
	exist bmpfile
	if ( strsize > 30000 ) {
		txt -1, "The file size must be lower than 30KB. Aborting."
		return 0
	}
	userdata(0, cun) = strsize
	dim bmpbuff, strsize
	bload bmpfile, bmpbuff
	userdata(2, cun) = 0
	dialog lang("ポートレートを埋め込む？", "Embed portrait?"), 2
	if ( stat == 6 ) {
		txt -1, lang("どの画像を埋め込む？(jpg推奨)", "Embed which picture?(.jpg recommended)")
		redraw 1
		dialog "bmp|jpg", 16, "BMP File|JPG File"
		if ( stat != 0 ) {
			facefile = refstr
			exist facefile
			if ( strsize > 30000 ) {
				txt -1, "The file size must be lower than 30KB. Aborting."
				return 0
			}
			userdata(2, cun) = strsize
			dim facebuff, strsize
			bload facefile, facebuff
		}
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\npc1.t", 1, 3
		zWrite userdata(0, cun), hgz, 70 * 4
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\npc1.t", 0
		zRead userdata(0, cun), hgz, 70 * 4
		zClose hgz
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\npc2.t", 1, 3
		zWrite bmpbuff, hgz, userdata(0, cun)
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\npc2.t", 0
		zRead bmpbuff, hgz, userdata(0, cun)
		zClose hgz
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\npc3.t", 1, 3
		zWrite txtbuff, hgz, userdata(1, cun)
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\npc3.t", 0
		zRead txtbuff, hgz, userdata(1, cun)
		zClose hgz
	}
	if ( facefile != "" ) {
		if ( fread == 0 ) {
			zOpen hgz, exedir + "user\\npc4.t", 1, 3
			zWrite facebuff, hgz, userdata(2, cun)
			zClose hgz
		}
		else {
			zOpen hgz, exedir + "user\\npc4.t", 0
			zRead facebuff, hgz, userdata(2, cun)
			zClose hgz
		}
	}
	s = getnpctxt_nc("name.", "unknown,unknown")
	csvstr2 s, s
	locvar_getnpctxt_cnpc = s
	cnv_filestr s
	if ( instr(s, 0, "_tmp_") != (-1) ) {
		dialog "The name contains an invalid word \"_tmp_\""
		return 0
	}
	if ( peek(s) >= 65 & peek(s) <= 90 | peek(s) == 95 | (peek(s) >= 97 & peek(s) <= 122) ) {
	}
	else {
		dialog "The first letter of the name must be alphabetic."
		return 0
	}
	if ( strlen(s) >= 64 | strlen(s(1)) >= 64 ) {
		dialog "The name is too long."
		return 0
	}
	s(1) = s + ".npc"
	zipinit2 exedir + "user\\", s(1)
	zipadd2 "npc1.t"
	zipadd2 "npc2.t"
	zipadd2 "npc3.t"
	if ( facefile != "" ) {
		zipadd2 "npc4.t"
	}
	zipend2
	mref _refstr, 65
	_refstr = locvar_getnpctxt_cnpc
	return 1

*label_3108
	sdim headtemp, 1024
	id = 0
	lensum = 1024
	sdim filebuff, lensum
	if ( usertitle != "" ) {
		headtemp = "【" + usertitle + "】\n"
	}
	else {
		headtemp = "【" + mdatan(0) + "】\n"
	}
	headtemp += "" + cnAka(CHARA_PLAYER) + cnName(CHARA_PLAYER) + "\n"
	headtemp += "\n"
	headtemp += "\n"
	headtemp += "" + 100001 + "\n"
	headtemp += "" + usermsg + "\n"
	headtemp += "" + userrelation + "\n"
	memcpy filebuff, headtemp, 1024, 0
	ctrlfile 20
	repeat 245
		list(0, cnt) = 0
		if ( cnt != 0 ) {
			if ( cRole(cnt) != ROLE_ADVENTURER ) {
				if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
					if ( cbit(CHARA_BIT_RIDE, cnt) == FALSE ) {
						list(0, cnt) = 1
					}
				}
			}
		}
	loop
	ctrlfile 22
	gosub *label_4280
	bsave userfile, filebuff
	gosub *del_userTemp
	return

*label_3110
	sdim headtemp, 1024
	id = 0
	lensum = 1024
	sdim filebuff, lensum
	headtemp = "【" + gdatan(GDATAN_TEAM1) + "】(" + n + "体)  Lv" + lv + "\n"
	headtemp += "" + cnAka(CHARA_PLAYER) + cnName(CHARA_PLAYER) + "\n"
	headtemp += "\n"
	headtemp += "\n"
	headtemp += "" + 100001 + "\n"
	headtemp += "" + n + "\n"
	headtemp += "" + lv + "\n"
	memcpy filebuff, headtemp, 1024, 0
	ctrlfile 22
	bsave userfile, filebuff
	gosub *del_userTemp
	return

*del_userNpc
	procid = (procid + 1) \ 10
	proclist(procid) = "del_userNpc" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	dirlist buff, exedir + "user\\_tmp_*.npc"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	dirlist buff, exedir + "user\\!tmp*.npc"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	return

*del_userTemp
	procid = (procid + 1) \ 10
	proclist(procid) = "del_userTemp" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	dirlist buff, exedir + "user\\*.t"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	return

*label_3116
	filemod = ""
	sdim loadedbuff, 20000
	memset loadedbuff, 0, 20000
	bufflast = 0
	loadedbuffmax = 20000
	ctrlfile 10
	folder = exedir + "save\\" + playerid + "\\"
	exist folder + "filelist.txt"
	if ( strsize != (-1) ) {
		delete folder + "filelist.txt"
	}
	loadpickitembuff nowautopickfile
	ctrlfile 7
	gosub *label_4672
	gosub *label_4674
	migration_updatesave
	gosub *db_setItem
	repeat 1320
		if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
			getitemid cnt
		}
		checkalter cnt
	loop
	repeat 16
		if ( cbit(CHARA_BIT_PCC, cnt) == TRUE | cnt == 0 ) {
			create_pcpic cnt, 1
		}
	loop
	if ( gWizard == 1 ) {
		cnAka(CHARA_PLAYER) = "*Debug*"
	}
	refreshspeed 0
	gosub *label_4724
	time_begin = timeGetTime() / 1000
	loadtalkconvert
	throwsstpevent "GameLoad", 0, "", 0
	return

*game_save
	if ( gArea  == AREA_SHOW_HOUSE ) {
		txtef COLOR_RED
		txt -1, lang("ユーザーマップの中ではセーブできない。", "The game is not saved in a user map.")
		gosub *screen_draw
		return
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "game_save" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	ctrlfile 2
	file = "inv_" + mid + ".s2"
	ctrlfile 4
	file = exedir + "save\\" + playerid
	dirlist save_buff, file, 5
	notesel save_buff
	save_f = 0
	repeat noteinfo(0)
		noteget save_s, cnt
		if ( save_s == playerid ) {
			save_f = 1
			break
		}
	loop
	if ( save_f == 0 ) {
		mkdir file
	}
	else {
	}
	file += "\\"
	notesel filemod
	repeat noteinfo(0)
		noteget save_s, cnt
		if ( strmid(save_s, 0, 1) == "*" ) {
			save_p = 0
		}
		else {
			save_p = 1
		}
		save_s = strmid(save_s, 1, strlen(save_s))
		if ( save_p == 0 ) {
			bcopy save_s, file + getpath(save_s, 8)
		}
		else {
			exist file + getpath(save_s, 8)
			if ( strsize != (-1) ) {
				delete file + getpath(save_s, 8)
			}
		}
	loop
	ctrlfile 8
	filemod = ""
	return

*label_3122
	snd SOUNDLIST_EXITMAP1
	gReturnArea = gArea , gLevel , cX(CHARA_PLAYER), cY(CHARA_PLAYER)
	gTeleportArea = AREA_SHOW_HOUSE
	gTeleportLevel = 1
	levelexitby = MAP_EXIT_TELEPORT
	goto *map_exit

*game_title
	buffer 300, windoww, windowh
	mode = MODELIST_TITLE
	cm = 0
	lomiaseaster = 0
	music = MUSICLIST_MCOPENING
	gosub *music_play
	cs = 0
	cs_bk = -1
	keyrange = 7
	key_list = "a", "b", "c", "d", "e", "f", "g"
	pagesize = 0
	redraw 0
	gsel BUFFER_MAP
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel 300
	gmode 0
	pos 0, 0
	picload_ exedir + "\\graphic\\title.bmp", 1
	gzoom windoww, windowh, 300, 0, 0, 800, 600
	gmode 2
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	color 255, 255, 255
	pos 20, 20
	mes "Elona version " + "1.22" + "  Developed by Noa"
	pos 20, 38
	mes "Mod version omake20150620 / omake_overhaul20160417 / omake_overhaul_modifyEx20170306fix"
	pos 20, 56
	mes "                                                   / omake_overhaul_modifyEx_Sukutu_Edition 20180517 fix2"
	pos 20, 74
	mes "                                                   / southtyris 20190921T / NasukoCustom " + releaseday
	pos 20, 92
	if ( jp ) {
		mes "Contributor MSL / View the credits for more"
	}
	else {
		mes "Contributor f1r3fly, Sunstrike, Schmidt, Elvenspirit / View the credits for more"
		mes "Omake/oo translator: Doorknob"
		mes "Cutscenes translator: AnnaBannana"
	}
	if ( jp ) {
		s = "冒険の道標", strhint1
	}
	else {
		s = "Starting Menu", strhint1
	}
	windowshadow = 1
	display_window 80, winposy(308, 1), 320, 370
	cmbg = 4
	x = ww / 5 * 4
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + 160, wy + wh / 2
	grotate BUFFER_MAP, cmbg / 2 * 180, cmbg \ 2 * 300, 0, x, y
	gmode 2
	if ( jp ) {
		s = "Restore an adventurer", "冒険を再開する", "Generate an adventurer", "新しい冒険者を作成する", "Incarnate an adventurer", "冒険者の引継ぎ", "Trophy", "トロフィー", "View the homepage", "ホームページを開く", "Configure", "設定の変更", "Exit", "終了"
	}
	if ( en ) {
		s = "Restore an Adventurer", "Generate an Adventurer", "Incarnate an Adventurer", "Trophy", "View the Homepage", "Options", "Exit"
	}
	if ( water_debug == 0 ) {
		water_getimage
		water_debug = 1
	}
	gsel BUFFER_SCREEN
	gmode 0
	pos 0, 0
	gcopy 300, 0, 0, windoww, windowh
	gmode 2

*game_title_WHILE1
	if ( cfg_autonumlock ) {
		GetKeyboardState keybd_st
		if ( peek(keybd_st, 144) == 1 ) {
			keybd_event 144
			keybd_event 144, 0, 2
		}
	}
	redraw 0
	if ( cfg_titleeffect ) {
		tx += (rnd(10) + 2) * p(1)
		ty += (rnd(10) + 2) * p(2)
		if ( rnd(10) == 0 ) {
			tx = rnd(800)
			ty = rnd(600)
			p(1) = rnd(9) - 4, rnd(9) - 4
		}
		f = 0
		if ( tx > 40 & tx < 500 & ty > 100 & ty < 450 ) {
			f = 1
		}
		if ( f == 0 ) {
			if ( rnd(10) == 0 ) {
				f = 2
			}
		}
		if ( f == 0 ) {
			water_setripple tx, ty, rnd(300), rnd(4)
		}
		water_calc
	}
	else {
		water_refresh
	}
	water_draw
	cs_listbk
	repeat 7
		x = wx + 40
		y = cnt * 35 + wy + 50
		display_customkey key_list(cnt), x, y
		if ( jp ) {
			font lang(cfg_font1, cfg_font2), 11 - en * 2, 0
			pos x + 40, y - 4
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			cs_list s(cnt * 2 + 1), x + 40, y + 8, 19
		}
		else {
			font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
			cs_list s(cnt), x + 40, y + 1, 19
		}
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == "b" ) {
		snd SOUNDLIST_OK1
		geneuse = ""
		goto *cm_init
	}
	if ( key == "a" ) {
		snd SOUNDLIST_OK1
		goto *game_title_selectID
	}
	if ( key == "c" ) {
		snd SOUNDLIST_OK1
		goto *game_title_selectGen
	}
	if ( key == "d" ) {
		snd SOUNDLIST_OK1
		title_pos = list(0, pagesize * page + cs)
		goto *label_5017
	}
	if ( key == "e" ) {
		snd SOUNDLIST_OK1
		exec homepage, 16
	}
	if ( key == "f" ) {
		snd SOUNDLIST_OK1
		goto *com_config
	}
	if ( key == "g" ) {
		snd SOUNDLIST_OK1
		await 400
		goto *exit_game
	}
	goto *game_title_WHILE1

*game_title_selectID
	cs = 0
	cs_bk = -1
	redraw 0
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel BUFFER_SCREEN
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	if ( jp ) {
		s = "どの冒険を再開するんだい？"
	}
	else {
		s = "Which save game do you want to continue?"
	}
	gosub *screen_drawMsg2
	file = exedir + "save\\*"
	dirlist buff, file, 5
	notesel buff
	keyrange = 0
	repeat noteinfo(0)
		noteget s, cnt
		file = exedir + "save\\" + s + "\\header.txt"
		exist file
		if ( strsize == (-1) ) {
			notedel cnt
			if ( cnt < noteinfo(0) ) {
				continue cnt
			}
			else {
				break
			}
		}
		bload file, playerheader
		list(0, cnt) = cnt
		listn(0, cnt) = s, "" + playerheader
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	windowshadow = 1

*game_title_selectID_WHILE1
	redraw 0
	if ( jp ) {
		s = "冒険者の選択", "BackSpace [削除]  " + strhint3b
	}
	else {
		s = "Game Selection", "BackSpace [Delete]  " + strhint3b
	}
	display_window (windoww - 440) / 2 + inf_screenx, winposy(288, 1), 440, 288
	cs_listbk
	repeat noteinfo(0)
		x = wx + 20
		y = cnt * 40 + wy + 50
		display_key x + 20, y - 2, cnt
		font lang(cfg_font1, cfg_font2), 11 - en * 2, 0
		pos x + 48, y - 4
		mes listn(0, cnt)
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		cs_list listn(1, cnt), x + 48, y + 8, 19
	loop
	cs_bk = cs
	if ( noteinfo(0) == 0 ) {
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 140, wy + 120
		mes "No save files found"
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		playerid = listn(0, p)
		snd SOUNDLIST_OK1
		await 200
		mode = MODELIST_CONTINUE
		music = MUSICLIST_NONE
		goto *world_init
	}
	getkey a, 8
	if ( ginfo(2) == 0 ) {
		if ( noteinfo(0) != 0 ) {
			if ( a == 1 ) {
				p = list(0, cs)
				playerid = listn(0, p)
				if ( jp ) {
					s = "本当に" + playerid + "を削除していいのかい？"
				}
				else {
					s = "Do you really want to delete " + playerid + " ?"
				}
				gosub *screen_drawMsg2
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 200, 1
				gosub *prompt_key
				if ( rtval != 0 ) {
					goto *game_title_selectID
				}
				if ( jp ) {
					s = "本当の本当に" + playerid + "を削除していいのかい？"
				}
				else {
					s = "Are you sure you really want to delete " + playerid + " ?"
				}
				gosub *screen_drawMsg2
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 200, 1
				gosub *prompt_key
				if ( rtval == 0 ) {
					snd SOUNDLIST_OK1
					ctrlfile 9
				}
				goto *game_title_selectID
			}
		}
	}
	if ( key == key_cancel ) {
		goto *game_title
	}
	goto *game_title_selectID_WHILE1

*game_title_selectGen
	cs = 0
	cs_bk = -1
	redraw 0
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gsel BUFFER_SCREEN
	gmode 0
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gmode 2
	if ( jp ) {
		s = "どの遺伝子を引き継ぐ？"
	}
	else {
		s = "Which gene do you want to incarnate?"
	}
	gosub *screen_drawMsg2
	file = exedir + "save\\*"
	dirlist buff, file, 5
	notesel buff
	keyrange = 0
	listmax = 0
	repeat noteinfo(0)
		noteget s, cnt
		file = exedir + "save\\" + s + "\\gene_header.txt"
		exist file
		await
		if ( strsize == (-1) ) {
			continue
		}
		bload file, playerheader
		list(0, listmax) = listmax
		listn(0, listmax) = s, "" + playerheader
		key_list(listmax) = key_select(listmax)
		keyrange++
		listmax++
	loop
	windowshadow = 1

*game_title_selectGen_WHILE1
	redraw 0
	if ( jp ) {
		s = "遺伝子の選択", strhint3b
	}
	else {
		s = "Gene Selection", strhint3b
	}
	display_window (windoww - 440) / 2 + inf_screenx, winposy(288, 1), 440, 288
	cs_listbk
	repeat listmax
		x = wx + 20
		y = cnt * 40 + wy + 50
		display_key x + 20, y - 2, cnt
		font lang(cfg_font1, cfg_font2), 11 - en * 2, 0
		pos x + 48, y - 4
		mes listn(0, cnt)
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		cs_list listn(1, cnt), x + 48, y + 8, 19
	loop
	cs_bk = cs
	if ( listmax == 0 ) {
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		pos wx + 140, wy + 120
		mes "No gene files found"
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		snd SOUNDLIST_OK1
		geneuse = listn(0, p)
		playerid = listn(0, p)
		goto *cm_init
	}
	if ( key == key_cancel ) {
		goto *game_title
	}
	goto *game_title_selectGen_WHILE1

*define_los
	dim fovlist, 2, 17
	dim fovmap, 17, 17
	if ( cFov(CHARA_PLAYER) < 1 ) {
		cFov(CHARA_PLAYER) = 1
	}
	if ( cFov(CHARA_PLAYER) >= 15 ) {
		cFov(CHARA_PLAYER) = 15 - 1
	}
	repeat 17
		y = cnt
		repeat 17
			x = cnt
			if ( dist(x, y, 17 / 2, 17 / 2) <= 15 / 2 ) {
				fovmap(x, y) = 1
			}
		loop
	loop
	repeat 17
		y = cnt
		p(1) = 0
		repeat 17
			x = cnt
			p = fovmap(x, y)
			if ( p != 0 & p(1) == 0 ) {
				fovlist(0, y) = x
				p(1) = 1
			}
			if ( p == 0 & p(1) == 1 ) {
				fovlist(1, y) = x
				break
			}
		loop
	loop
	return

*esc_check
	if ( wparam == 27 ) {
		if ( ginfo(2) == 0 ) {
			ime_esc = 1
		}
	}
	return

*prompt_word
	snd SOUNDLIST_POP2
	x = val
	y = val(1)
	dx = val(2) * 16 + 60
	font lang(cfg_font1, cfg_font2), 16 - en * 2, 0
	inputfail = 0
	sdim inputlog2
	title "Elona" + " ver " + "1.22" + " / oomSESTep NasukoCustom" + releaseday
	if ( val(4) != 0 ) {
		val(5) = val(4)
		val(4) = int(inputlog)
		if ( strlen(str(val(5))) >= 3 ) {
			dx += strlen(str(val(5))) * 8
		}
		redraw 0
		pos x + 24, y + 4
		gfini dx - 42, 35
		gfdec 60, 60, 60
		repeat
			redraw 0
			window2 x + 20, y, dx - 40, 36, 0, 2
			pos x + dx / 2 - 56, y - 32
			gcopy BUFFER_INF, 128, 288, 128, 32
			pos x + 28, y + 4
			gcopy BUFFER_INF, 312, 336, 24, 24
			pos x + dx - 51, y + 4
			gcopy BUFFER_INF, 336, 336, 24, 24
			inputlog2 = "" + int(inputlog) + "(" + val(5) + ")"
			pos x + dx - 70 - strlen(inputlog2) * 8 + 8, y + 11
			color 255, 255, 255
			mes inputlog2
			redraw 1
			await cfg_wait1
			key_check
			if ( key == key_enter ) {
				f = 1
				break
			}
			if ( key == key_cancel ) {
				if ( val(3) == 1 ) {
					f = -1
					break
				}
			}
			if ( key == key_west ) {
				snd SOUNDLIST_CURSOR1
				val(4)--
				if ( val(4) < 1 ) {
					val(4) = val(5)
				}
			}
			if ( key == key_northwest ) {
				snd SOUNDLIST_CURSOR1
				if ( val(4) == 1 ) {
					val(4) = val(5)
				}
				else {
					val(4) -= 100
				}
				if ( val(4) < 1 ) {
					val(4) = 1
				}
			}
			if ( key == key_southwest ) {
				snd SOUNDLIST_CURSOR1
				if ( val(4) == 1 ) {
					val(4) = val(5)
				}
				else {
					val(4) -= 10
				}
				if ( val(4) < 1 ) {
					val(4) = 1
				}
			}
			if ( key == key_east ) {
				snd SOUNDLIST_CURSOR1
				val(4)++
				if ( val(4) > val(5) ) {
					val(4) = 1
				}
				if ( val(4) < 0 ) {
					val(4) = 0
				}
			}
			if ( key == key_northeast ) {
				snd SOUNDLIST_CURSOR1
				if ( val(4) == val(5) ) {
					val(4) = 1
				}
				else {
					val(4) += 100
				}
				if ( val(4) > val(5) ) {
					val(4) = val(5)
				}
			}
			if ( key == key_southeast ) {
				snd SOUNDLIST_CURSOR1
				if ( val(4) == val(5) ) {
					val(4) = 1
				}
				else {
					val(4) += 10
				}
				if ( val(4) > val(5) ) {
					val(4) = val(5)
				}
			}
			if ( key == key_south ) {
				snd SOUNDLIST_CURSOR1
				val(4) = 1
			}
			if ( key == key_north ) {
				snd SOUNDLIST_CURSOR1
				val(4) = val(5)
			}
			inputlog = "" + val(4)
		loop
		if ( f == (-1) ) {
			inputlog = ""
			rtval = -1
		}
		keywait = 1
		key = ""
		rtval = 0
		return
	}
	redraw 0
	objmode 2, 0
	if ( cfg_msg_box == 0 ) {
		pos x + 4, y + 4
		mesbox inputlog, dx - 8, 26, 1, val(2) * (1 + en)
	}
	else {
		pos x, y
		mesbox inputlog, 600, 0, 5, val(2) * (1 + en)
		pos x + 4, y + 4
		gfini dx - 1, 35
		gfdec 60, 60, 60
		aplsel "Elona" + " ver " + "1.22"
		if ( stat == 1 ) {
			dialog "Failed to get WINDOW ID", 1
			clrobj 1
			cfg_msg_box = 0
			goto *prompt_word
		}
		aplobj "", 1
		if ( stat == 1 ) {
			dialog "Failed to get OBJECT ID", 1
			clrobj 1
			cfg_msg_box = 0
			goto *prompt_word
		}
	}
	notesel inputlog
	p(1) = 2
	ime_esc = 0
	onkey 1
	repeat
		if ( ginfo(2) == 0 ) {
			objsel 1
		}
		else {
			objprm 1, ""
			inputlog = ""
			await 100
			continue cnt
		}
		if ( nc_macromode != 0 ) {
			if ( strmid(nc_key_log(nc_key_row), 0, strlen("Paste,")) == "Paste," ) {
				split nc_key_log(nc_key_row), ",", nc_key_buff
				inputlog = nc_key_buff(1) + "\n"
				nc_key_row++
			}
			else {
				txt -1, lang("(マクロ)入力中にPaste以外の命令が実行されました(行:", "(Macro)A command other than Paste was executed while typing.(row:") + nc_key_row + ") "
				nc_macromode = 0
				nc_key_row = 0
				txt -1, lang("マクロを停止した。", "Stopped macro.")
				return
			}
		}
		redraw 0
		await 40
		window2 x, y, dx, 36, 0, 2
		pos x + dx / 2 - 60, y - 32
		gcopy BUFFER_INF, 128, 288, 128, 32
		if ( cfg_msg_box == 1 ) {
			pos x + 8, y + 4
			if ( imeget() != 0 ) {
				gcopy BUFFER_INF, 48, 336, 24, 24
			}
			else {
				gcopy BUFFER_INF, 24, 336, 24, 24
			}
			apledit p(2), 2, 0
			if ( p(2) > val(2) * (1 + en) - 2 ) {
				pos x + 8, y + 4
				gcopy BUFFER_INF, 72, 336, 24, 24
			}
			if ( cnt \ 20 < 10 ) {
				p(1) = p(1) * 2
			}
			else {
				p(1) = p(1) / 2
			}
			apledit p(2), 0
			p(4) = 0
			repeat p(2)
				p(3) = peek(inputlog, p(4))
				if ( p(3) >= 129 & p(3) <= 159 | (p(3) >= 224 & p(3) <= 252) ) {
					p(4) += 2
				}
				else {
					p(4) += 1
				}
			loop
			gmode 4, , , p(1) / 2 + 50
			pos x + 34 + p(4) * 8, y + 5
			color 0, 0, 0
			gcopy BUFFER_INF, 0, 336, 12, 24
			gmode 2
			color 255, 255, 255
			pos x + 36, y + 9
			noteget s, 0
			mes s
		}
		if ( instr(inputlog, 0, "\n") != (-1) ) {
			rtval = 0
			break
		}
		if ( instr(inputlog, 0, "\t") != (-1) ) {
			objprm 1, ""
			inputlog = ""
			if ( val(3) == 1 ) {
				ime_esc = 1
			}
		}
		redraw 1
		if ( val(3) == 1 ) {
			if ( ime_esc == 1 ) {
				inputlog = ""
				keywait = 1
				key = ""
				break
			}
		}
	loop
	gmode 2
	clrobj 1
	if ( inputfail ) {
		cfg_msg_box = 0
		goto *prompt_word
	}
	if ( input_mode == 1 ) {
		cnv_filestr inputlog
	}
	input_mode = 0
	if ( en ) {
		cnv_str inputlog, "\"", "'"
	}
	rm_crlf inputlog
	onkey 0
	return

*prompt_direction
	snd SOUNDLIST_POP2
	redraw 0
	gsel BUFFER_BUF
	x = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx - 48
	y = (cY(CHARA_PLAYER) - scy) * inf_tiles + inf_screeny - 48
	gmode 0
	pos 0, 0
	gcopy BUFFER_SCREEN, x, y, 48 * 3, 48 * 3
	gsel BUFFER_SCREEN
	t = 0

*prompt_direction_WHILE1
	t++
	gmode 4, 28, 28, 200 - t / 2 \ 20 * (t / 2 \ 20)
	color 0, 0, 0
	x = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx + 24
	y = (cY(CHARA_PLAYER) - scy) * inf_tiles + inf_screeny + 24
	if ( key_alt == 0 ) {
		pos x, y - 48
		grotate BUFFER_INF, 212, 432, 0, 28, 28
		pos x, y + 48
		grotate BUFFER_INF, 212, 432, 1.0 * 3.14, 28, 28
		pos x + 48, y
		grotate BUFFER_INF, 212, 432, 0.5 * 3.14, 28, 28
		pos x - 48, y
		grotate BUFFER_INF, 212, 432, 1.5 * 3.14, 28, 28
	}
	pos x - 48, y - 48
	grotate BUFFER_INF, 212, 432, 1.75 * 3.14, 28, 28
	pos x + 48, y + 48
	grotate BUFFER_INF, 212, 432, 0.75 * 3.14, 28, 28
	pos x + 48, y - 48
	grotate BUFFER_INF, 212, 432, 0.25 * 3.14, 28, 28
	pos x - 48, y + 48
	grotate BUFFER_INF, 212, 432, 1.25 * 3.14, 28, 28
	redraw 1
	redraw 0
	gmode 0
	pos x - 48 - 24, y - 48 - 24
	gcopy BUFFER_BUF, 0, 0, 48 * 3, 48 * 3
	gmode 2
	await 30
	key_check 1
	x = cX(CHARA_PLAYER)
	y = cY(CHARA_PLAYER)
	if ( key == key_alter ) {
		goto *prompt_direction_WHILE1_CONTINUE
	}
	if ( key == key_wait | key == key_enter ) {
		tlocx = x
		tlocy = y
		keyhalt = 1
		return 1
	}
	if ( key == key_north ) {
		if ( key_alt ) {
			goto *prompt_direction_WHILE1_CONTINUE
		}
		else {
			y -= 1
		}
	}
	if ( key == key_south ) {
		if ( key_alt ) {
			goto *prompt_direction_WHILE1_CONTINUE
		}
		else {
			y += 1
		}
	}
	if ( key == key_west ) {
		if ( key_alt ) {
			goto *prompt_direction_WHILE1_CONTINUE
		}
		else {
			x -= 1
		}
	}
	if ( key == key_east ) {
		if ( key_alt ) {
			goto *prompt_direction_WHILE1_CONTINUE
		}
		else {
			x += 1
		}
	}
	if ( key == key_northwest ) {
		x -= 1
		y -= 1
	}
	if ( key == key_northeast ) {
		x += 1
		y -= 1
	}
	if ( key == key_southwest ) {
		x -= 1
		y += 1
	}
	if ( key == key_southeast ) {
		x += 1
		y += 1
	}
	if ( key != "" ) {
		if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
			x = cX(CHARA_PLAYER)
			y = cY(CHARA_PLAYER)
			keyhalt = 1
			return 0
		}
		if ( x == cX(CHARA_PLAYER) & y == cY(CHARA_PLAYER) ) {
			return 0
		}
		tlocx = x
		tlocy = y
		keyhalt = 1
		return 1
	}

*prompt_direction_WHILE1_CONTINUE
	goto *prompt_direction_WHILE1

*prompt_key
	snd SOUNDLIST_POP2
	csprev = cs
	cs = 0
	cs_bk = -1
	redraw 0
	gsel BUFFER_INF
	gmode 0
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
	repeat promptmax
		if ( promptl(1, cnt) == "null" ) {
			promptl(1, cnt) = key_select(cnt)
		}
		pos cnt * 24 + 624, 30
		gcopy BUFFER_INF, 0, 30, 24, 18
		pos cnt * 24 + 629, 31
		color 50, 60, 80
		bmes promptl(1, cnt), 250, 240, 230
	loop
	gsel BUFFER_SCREEN
	sx = val - val(2) / 2
	sy = val(1) - promptmax * 10
	pos sx + 12, sy + 12
	gfini val(2) - 17, promptmax * 20 + 43 - 18
	gfdec 60, 60, 60
	keyhalt = 1
	if ( val(3) == 2 ) {
		dx = 200, 10
		dy = sy + 140
		val(5) = val(4)
		val(4) = 1
		val = 1
		if ( strlen(str(val(5))) >= 3 ) {
			dx += strlen(str(val(5))) * 8
		}
		pos dx(1) + sx + 24, dy + 4
		gfini dx - 42, 35
		gfdec 60, 60, 60
	}
	if ( cfg_putgrass == 1 ) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗ"
		loop
	}
	if ( cfg_putgrass == 2 ) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "、", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "。", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "！", "ｗｗｗ！"
			sreplace promptl(0, cnt), promptl(0, cnt), "？", "ｗｗｗ？"
		loop
	}

*prompt_key_WHILE1
	redraw 0
	gmode 2
	if ( val(3) == 2 ) {
		window2 dx(1) + sx + 20, dy, dx - 40, 36, 0, 2
		pos dx(1) + sx + dx / 2 - 56, dy - 32
		gcopy BUFFER_INF, 128, 288, 128, 32
		pos dx(1) + sx + 28, dy + 4
		gcopy BUFFER_INF, 312, 336, 24, 24
		pos dx(1) + sx + dx - 51, dy + 4
		gcopy BUFFER_INF, 336, 336, 24, 24
		inputlog2 = "" + int(inputlog) + "(" + val(5) + ")"
		pos dx(1) + sx + dx - 70 - strlen(inputlog2) * 8 + 8, dy + 11
		color 255, 255, 255
		mes inputlog2
		inputlog = "" + val(4)
	}
	window2 sx + 8, sy + 8, val(2) - 16, promptmax * 20 + 42 - 16, 0, 0
	pos sx - 16, sy
	gcopy BUFFER_INF, 64, 288, 50, 32
	color 255, 255, 255
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	keyrange = 0
	cs_listbk
	repeat promptmax
		pos sx + 30, cnt * 20 + sy + 22
		gcopy BUFFER_INF, cnt * 24 + 624, 30, 24, 24
		cs_list promptl(0, cnt), sx + 56, cnt * 20 + sy + 21, 19
		key_list(cnt) = promptl(1, cnt)
		keyrange++
	loop
	cs_bk = cs
	if ( rpmode ) {
		window_recipe2
		color 255, 255, 255
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	rtval = -1
	repeat promptmax
		if ( invctrl == 30 & key == "sc" ) {
			if ( sc \ 10 ) {
				key = key_select(sc - 1)
			}
		}
		if ( key == promptl(1, cnt) ) {
			rtval = int(promptl(2, cnt))
			break
		}
	loop
	if ( val(3) == 2 ) {
		val = int(inputlog)
		if ( key == key_west | key == key_pagedown ) {
			snd SOUNDLIST_CURSOR1
			val(4)--
			if ( val(4) < 1 ) {
				val(4) = val(5)
			}
		}
		if ( key == key_east | key == key_pageup ) {
			snd SOUNDLIST_CURSOR1
			val(4)++
			if ( val(4) > val(5) ) {
				val(4) = 1
			}
		}
	}
	if ( rtval != (-1) ) {
		promptmax = 0
		cs = csprev
		return 1
	}
	if ( val(3) != 0 ) {
		if ( key == key_cancel ) {
			promptmax = 0
			cs = csprev
			return 0
		}
	}
	goto *prompt_key_WHILE1

*label_3157
	snd SOUNDLIST_POP2
	csprev = cs
	cs = 0
	cs_bk = -1
	redraw 0
	gsel BUFFER_INF
	gmode 0
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
	repeat promptmax
		if ( promptl(1, cnt) == "null" ) {
			promptl(1, cnt) = key_select(cnt)
		}
		pos cnt * 24 + 624, 30
		gcopy BUFFER_INF, 0, 30, 24, 18
		pos cnt * 24 + 629, 31
		color 50, 60, 80
		bmes promptl(1, cnt), 250, 240, 230
	loop
	gsel BUFFER_SCREEN
	sx = val - val(2) / 2
	sy = val(1) - limitmax(16, promptmax) * 10
	pos sx + 12, sy + 12
	gfini val(2) - 17, limitmax(16, promptmax) * 20 + 43 - 18
	gfdec 60, 60, 60
	keyhalt = 1
	if ( cfg_putgrass == 1 ) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗ"
		loop
	}
	if ( cfg_putgrass == 2 ) {
		repeat promptmax
			sreplace promptl(0, cnt), promptl(0, cnt), "…", "ｗｗｗｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "、", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "。", "ｗｗｗ"
			sreplace promptl(0, cnt), promptl(0, cnt), "！", "ｗｗｗ！"
			sreplace promptl(0, cnt), promptl(0, cnt), "？", "ｗｗｗ？"
		loop
	}

*label_3161
	redraw 0
	gmode 2
	window2 sx + 8, sy + 8, val(2) - 16, limitmax(promptmax, 16) * 20 + 42 - 16, 0, 0
	pos sx - 16, sy
	gcopy BUFFER_INF, 64, 288, 50, 32
	color 255, 255, 255
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	keyrange = 0
	cs_listbk
	repeat promptmax
		pos sx + 30 + cnt / 16 * 240, sy + 22 + cnt \ 16 * 20
		gcopy BUFFER_INF, cnt * 24 + 624, 30, 24, 24
		cs_list promptl(0, cnt), sx + 56 + cnt / 16 * 240, sy + 21 + cnt \ 16 * 20, 19
		key_list(cnt) = promptl(1, cnt)
		keyrange++
	loop
	cs_bk = cs
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	rtval = -1
	repeat promptmax
		if ( key == promptl(1, cnt) ) {
			rtval = int(promptl(2, cnt))
			break
		}
	loop
	if ( rtval != (-1) ) {
		promptmax = 0
		cs = csprev
		return 1
	}
	if ( val(3) != 0 ) {
		if ( key == key_pageup ) {
			if ( keyrange >= 16 ) {
				if ( cs < 16 ) {
					cs += 16
					if ( cs >= keyrange ) {
						cs = keyrange - 1
					}
				}
				else {
					cs -= 16
					if ( cs < 0 ) {
						cs += 16
						if ( cs >= keyrange ) {
							cs = keyrange - 1
						}
					}
				}
				goto *label_3161
			}
		}
		if ( key == key_pagedown ) {
			if ( keyrange >= 16 ) {
				if ( cs < 16 ) {
					cs += 16
					if ( cs >= keyrange ) {
						cs = keyrange - 1
					}
				}
				else {
					cs -= 16
					if ( cs < 0 ) {
						cs += 16
						if ( cs >= keyrange ) {
							cs = keyrange - 1
						}
					}
				}
				goto *label_3161
			}
		}
		if ( key == key_cancel ) {
			promptmax = 0
			cs = csprev
			return 0
		}
	}
	goto *label_3161

*game_debug
	notesel dbm
	buff = ""
	if ( dbm == "" ) {
		noteadd "Elona" + " v" + "1.22" + " Debug Console    Type \"?\" for help. Hit ESC to exit."
		noteadd ""
	}
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	objmode 2
	pos 0, 24
	mesbox dbm, 800, 576, 0
	pos 0, 0
	mesbox buff, 800, 24, 1
	objsel 2

*game_debug_WHILE1
	await 20
	stick a
	if ( a == 128 ) {
		goto *game_debug_WEND1
	}
	if ( a == 32 ) {
		gosub *dbg_GetInfo
	}
	goto *game_debug_WHILE1

*game_debug_WEND1
	clrobj 1
	clrobj 2
	if ( dbg_exitshowroom == 1 ) {
		dbg_exitshowroom = 0
		levelexitby = MAP_EXIT_NORMAL
		goto *map_exit
	}
	goto *pc_turn

*dbg_GetInfo
	if ( instr(buff, 0, "?") != (-1) ) {
		noteadd "\t1\t\tShows charainfo."
		noteadd "\t2\t\tShows pc equipment."
		noteadd "\t3\t\tShows pc inventory."
		noteadd "\t4\t\tBegin/end var-comparison."
		noteadd "\t5\t\tShows core game data."
		noteadd "\tdel\t\tDeletes current log."
		noteadd "\tquest\t\tLists all the quests."
		noteadd "\tclient\t\tLists all the clients."
		noteadd "\texitroom\tLeaves current show-room."
		noteadd "\twizard\t\tEnables wizard mode."
		noteadd ""
		noteadd "\tThe commands below can be used in the Wizard mode."
		noteadd "\tgain_spell\tPC gains all spells."
		noteadd "\tgain_spact\tPC gains all special actions."
		noteadd "\tgain_exp\tPC gains a billion of exp."
		noteadd "\tgain_fame\tPC gains fame."
		noteadd "\tallinv\t\tDisplays all the items in the map."
		noteadd ""
		noteadd "\tThe commands below should be only used to deal with certain problems."
		noteadd "\t108fix\t\tTurns all the NPCs in the map hostile."
		noteadd "\tadvreset\tRemoves all items from adventureres."
		noteadd "\tfixcorrupt1\tTries to fix corrputed save files."
		noteadd "\tfreemove\tEnables freemove."
		noteadd "\tresetmap\tResets towns and some areas."
		noteadd "\tfixmap\t\tFixes possible bugs for current map."
		noteadd "\tmapinfo\t\tShows map info."
		noteadd ""
		noteadd "\too commands"
		noteadd "\tunique\t\tShows generation counter of the new unique monsters"
		noteadd "\tfixrelation1\tUNAVAILABLE IN CURRENT VERSION."
		noteadd "\tshowfaction\tShows characters' factions in the current area."
		noteadd "\tcontainerize\tUpdates old containers."
		noteadd ""
		noteadd "\toom commands"
		noteadd "\tfixai [Character No.]\tUNAVAILABLE IN CURRENT VERSION."
		noteadd "\tresetchipm\tResets building appearance in global map."
		noteadd ""
		noteadd "\toomSE commands"
		noteadd "\tusernpc\tShows all installed CNPCs."
		noteadd "\tuseritem\tShows all installed CItems."
		noteadd "\tusergod\tShows all installed CGods."
		noteadd "\tuserrace\tShows all installed CRaces."
		noteadd "\tuserclass\tShows all installed CClasses."
		noteadd "\tyoungerladyreset\tReset younger lady flag."
		noteadd "\tpetaireset\tReset pet's AI"
		noteadd "\tinheritance [Item No.]\tOutput inheritance marks added to the specified item."
		noteadd "\tfixammoenc\tUNAVAILABLE IN CURRENT VERSION."
		noteadd "\tfixhammer\tUpdates the hammer title to fit the current hammer level."
		noteadd ""
		noteadd "\toomSEST commands"
		noteadd "\twish_count\tShows wishing count, the number of wishing from wells."
		noteadd "\tupdateoomseskills\tMigrates oomSE skills."
		noteadd "\tupdateST\tUpdate SouthTyris."
		noteadd "\tcheckTitle\tCheck Title."
		noteadd "\telapse_day[wizard only]\t1 day will elapse."
		noteadd "\telapse_week[wizard only]\t1 week will elapse."
		noteadd "\telapse_month[wizard only]\t1 month will elapse."
		noteadd "\telapse_year[wizard only]\t1 year will elapse."
		noteadd "\tgameclear[wizard only]\tCompletes the the main scenario."
		noteadd "\tgamereset[wizard only]\tReset all flags about the main scenario."
		goto *console_write
	}
	if ( int(buff) == 1 ) {
		repeat 245
			noteadd "" + cnt + ":" + cnName(cnt) + "\n\tExist:" + cExist(cnt) + "\tRespawn:" + splittime(cRespawn(cnt)) + "\tRole:" + cRole(cnt)
			noteadd "\tReader:" + cnName(ocAdvParty(cnt)) + "\n\tLocation:" + mapname(cType(cnt)) + "\n\tJob:" + ocPetJobSkill(cnt)
		loop
		goto *console_write
	}
	if ( int(buff) == 2 ) {
		repeat 30
			p = 100 + cnt
			if ( cdata(p, CHARA_PLAYER) != 0 ) {
				p(1) = cdata(p, CHARA_PLAYER)
				s = "" + p + "\t" + p(1) + "\t"
				if ( p(1) \ 10000 > 0 ) {
					s += itemname(p(1) \ 10000 - 1)
				}
				noteadd s
			}
		loop
		goto *console_write
	}
	if ( int(buff) == 3 ) {
		inv_getheader 0
		repeat invrange, invhead
			noteadd "" + cnt + "\t" + itemname(cnt) + "\t"
		loop
		goto *console_write
	}
	if ( int(buff) == 4 ) {
		if ( dbg_compare == 0 ) {
			sdim cdatan2, 40, 10, 245
			dim cdata2, 500, 245
			dim sdata2, 600 * 2, 245
			dim inv2, 70, 5480
		}
		noteadd "cdata"
		repeat 245
			cnt2 = cnt
			repeat 500
				s = ""
				if ( cnt == 6 | cnt == 10 ) {
					s = "*"
				}
				if ( dbg_compare == 0 ) {
					cdata2(cnt, cnt2) = cdata(cnt, cnt2)
				}
				if ( dbg_compare == 1 ) {
					if ( cdata2(cnt, cnt2) != cdata(cnt, cnt2) ) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + cdata2(cnt, cnt2) + "\t->" + cdata(cnt, cnt2)
					}
				}
			loop
		loop
		noteadd "cdatan"
		repeat 245
			cnt2 = cnt
			repeat 10
				s = ""
				if ( dbg_compare == 0 ) {
					cdatan2(cnt, cnt2) = cdatan(cnt, cnt2)
				}
				if ( dbg_compare == 1 ) {
					if ( cdatan2(cnt, cnt2) != cdatan(cnt, cnt2) ) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + cdatan2(cnt, cnt2) + "\t->" + cdatan(cnt, cnt2)
					}
				}
			loop
		loop
		noteadd "skill"
		repeat 245
			cnt2 = cnt
			repeat 600 * 2
				s = ""
				if ( dbg_compare == 0 ) {
					sdata2(cnt, cnt2) = sdata(cnt, cnt2)
				}
				if ( dbg_compare == 1 ) {
					if ( sdata2(cnt, cnt2) != sdata(cnt, cnt2) ) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + sdata2(cnt, cnt2) + "\t->" + sdata(cnt, cnt2)
					}
				}
			loop
		loop
		noteadd "inv"
		repeat 5480
			cnt2 = cnt
			repeat 70
				s = ""
				if ( dbg_compare == 0 ) {
					inv2(cnt, cnt2) = inv(cnt, cnt2)
				}
				if ( dbg_compare == 1 ) {
					if ( inv2(cnt, cnt2) != inv(cnt, cnt2) ) {
						noteadd s + "" + cnt2 + "\t" + cnt + "\t" + inv2(cnt, cnt2) + "\t->" + inv(cnt, cnt2)
					}
				}
			loop
		loop
		if ( dbg_compare == 0 ) {
			dbg_compare = 1
			noteadd "Var_comparison begins."
		}
		else {
			dbg_compare = 0
		}
		goto *console_write
	}
	if ( int(buff) == 5 ) {
		repeat 1000
			noteadd "" + cnt + "\t" + gdata(cnt)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "del") != (-1) | buff == "\n" ) {
		dbm = ""
		goto *console_write
	}
	if ( instr(buff, 0, "freemove") != (-1) ) {
		dbg_freemove = 1
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "resetmap") != (-1) ) {
		gosub *label_3064
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "exitroom") != (-1) ) {
		if ( gArea  == AREA_SHOW_HOUSE ) {
			dbg_exitshowroom = 1
			noteadd "Done."
		}
		else {
			noteadd "Wrong map."
		}
		goto *console_write
	}
	if ( instr(buff, 0, "removequest") != (-1) ) {
		repeat gClient
			if ( qStatus(cnt) != QUEST_STATE_NONE ) {
				if ( qDeadline(cnt) == (-1) ) {
					qStatus(cnt) = QUEST_STATE_NONE
				}
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixmap") != (-1) ) {
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cX(cnt) < 0 | cX(cnt) >= mWidth | cY(cnt) < 0 | cY(cnt) >= mHeight ) {
				cX(cnt) = 0
				cY(cnt) = 0
			}
		loop
		repeat 400, 5080
			if ( iNum(cnt) <= 0 ) {
				continue
			}
			if ( iX(cnt) < 0 | iX(cnt) >= mWidth | iY(cnt) < 0 | iY(cnt) >= mHeight ) {
				iX(cnt) = 0
				iY(cnt) = 0
			}
		loop
		cell_refresh 0, 0
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "advreset") != (-1) ) {
		repeat 40 - 1, 16
			rc = cnt
			inv_getheader rc
			repeat invrange, invhead
				cnt2 = cnt
				repeat 70
					inv(cnt, cnt2) = 0
				loop
			loop
			repeat 30, 100
				cdata(cnt, rc) = 0
			loop
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "resetbuff") != (-1) ) {
		repeat 16
			cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, CHARA_PLAYER) = BUFF_NONE
			ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, 0) = 0
			cdata(281 + cnt * ARRAY_CDATA_BUFF, CHARA_PLAYER) = 0
			ocdata(OCDATA_STARTING_CURSE_BUFF_POWER + cnt * 3, 0) = 0
			cdata(282 + cnt * ARRAY_CDATA_BUFF, CHARA_PLAYER) = 0
			ocdata(OCDATA_STARTING_CURSE_BUFF_TURNS + cnt * 3, 0) = 0
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixcorrupt1") != (-1) ) {
		repeat 57
			rc = cnt
			inv_getheader rc
			repeat invrange, invhead
				cnt2 = cnt
				if ( iID(cnt) >= ITEM_ID_VIOLENCE_TRIGGER | iID(cnt) <= ITEM_ID_DUMMY | iNum(cnt) <= 0 ) {
					repeat 70
						inv(cnt, cnt2) = 0
					loop
				}
				if ( iEquip(cnt) != 0 ) {
					iEquip(cnt) = 0
				}
			loop
			repeat 30, 100
				cdata(cnt, rc) = cdata(cnt, rc) / EXT_EQUIP_SLOTS * 10000
			loop
			if ( cnt >= 16 & cRole(cnt) != ROLE_PET_SENTRY & cRole(cnt) != ROLE_PET_MAID & eqfaction(cnt, "petshop") == 0 ) {
				cExist(cnt) = CHAR_STATE_ADV_DEAD
				gosub *label_3917
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixcorrupt2") != (-1) ) {
		repeat 245
			cnt2 = cnt
			repeat length(racenamecsv)
				if ( cnRace(cnt2) == racenamecsv(cnt, 1) ) {
					cMeleeStyle(cnt2) = racevaluecsv(cnt, 18)
					cCastStyle(cnt2) = racevaluecsv(cnt, 19)
				}
			loop
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixpcc") != (-1) ) {
		repeat length(racenamecsv)
			if ( cnRace(CHARA_PLAYER) == racenamecsv(cnt, 1) ) {
				cPic(CHARA_PLAYER) = racevaluecsv(cnt, 3)
				if ( cSex(CHARA_PLAYER) == 1 ) {
					if ( racevaluecsv(cnt, 4) ) {
						cPic(CHARA_PLAYER) = racevaluecsv(cnt, 4)
					}
				}
				break
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixpet1") != (-1) ) {
		repeat 244, 1
			if ( petcheck(cnt) ) {
				if ( findfaction(cnt, "pet", "0") == 0 ) {
					addfaction cnt, "pet,0"
				}
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixpet2") != (-1) ) {
		repeat 244, 1
			if ( petcheck(cnt) ) {
				cRelation(cnt) = RELATION_ALLY
				cOrgRelation(cnt) = RELATION_ALLY
				cAiAggro(cnt) = 0
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixpet3") != (-1) ) {
		repeat 244, 1
			if ( petcheck(cnt) ) {
				cRelation(cnt) = RELATION_ALLY
				cOrgRelation(cnt) = RELATION_ALLY
				cAiAggro(cnt) = 0
				rmfaction cnt, "pet"
				addfaction cnt, "pet,0"
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixfeat1") != (-1) ) {
		repeat 245
			if ( gettrait(cnt, 8) ) {
				p = stat
				if ( p <= 3 ) {
					continue
				}
				settrait cnt, 8, 3
				if ( cnt == 0 ) {
					gTraitPoint += p - 3
				}
				else {
					ocFeatsAcquirable(cnt) += p - 3
				}
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "client") != (-1) ) {
		dim mapclient, 1000
		repeat 500
			if ( qClient(cnt) == 0 ) {
				i = cnt
				continue
			}
			noteadd "id:" + cnt + " name:" + qname(cnt) + " map:" + mapname(qMap(cnt))
			mapclient(qMap(cnt))++
		loop
		repeat 1000
			if ( mapclient(cnt) != 0 ) {
				noteadd "" + mapname(cnt) + ":" + mapclient(cnt), 1
			}
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "mapchara") != (-1) ) {
		repeat 189, 56
			noteadd "id:" + cnt + " name:" + cnName(cnt)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "108fix") != (-1) ) {
		repeat 245
			if ( cnt < 57 ) {
				continue
			}
			if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
				cRelation(cnt) = RELATION_ENEMY
				cOrgRelation(cnt) = RELATION_ENEMY
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "test") != (-1) ) {
		repeat 500
			noteadd "" + cnt + ":" + mapname(cnt) + "/" + areaId(cnt)
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "mapinfo") != (-1) ) {
		noteadd "gArea\t\t:" + gArea 
		noteadd "gLevel\t\t:" + gLevel 
		noteadd "file\t\t:" + "mdata_" + mid + ".s2"
		noteadd "pc x/y\t\t:" + cX(CHARA_PLAYER) + "/" + cY(CHARA_PLAYER)
		noteadd "map max w/h\t:" + mWidth + "/" + mHeight
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "showfaction") != (-1) ) {
		repeat 245
			noteadd "" + cnt + "\t" + cnName(cnt) + "(" + getrelation(cnt) + ")\n\t" + faction(cnt)
		loop
		repeat 50, 245
			noteadd "" + cnt + "\t\t" + faction(cnt)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "quest") != (-1) ) {
		noteadd "gQuest:" + gQuest + " gQuestRef:" + gQuestRef + " gQuestStatus:" + gQuestStatus + " rq:" + rq
		repeat 5
			p = gdata(GDATA_QUEST_POOL + cnt)
			noteadd "quest" + cnt + " " + p + " exist" + qExist(p) + " status" + qStatus(p) + " var" + qVar(p) + " encount" + qdata((10 /*!!!@[QDATA_DEST_CLIENT @@@ QDATA_ENCOUNTER]@!!! */), p)
		loop
		repeat gClient
			noteadd "" + cnt + " " + qClient(cnt) + "/" + qMap(cnt)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "achievement") != (-1) & gWizard == 1 ) {
		repeat 10
			if ( ogdata(520 + cnt) == 0 ) {
				ogdata(520 + cnt) = 1
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "gamereset") != (-1) & gWizard == 1 ) {
		flagMain = 0
		flagMsFool = 0
		flagMsSage = 0
		flagMsKing = 0
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "updateST") != (-1) ) {
		initializesouthtyristowns
		if ( gArea  == 51 ) {
			if ( gLevel  == 1 ) {
				f = 0
				repeat 188, 57
					if ( cId(cnt) == CREATURE_ID_MINA_THE_NEWCOMER_TO_GUILD ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					f = get_freechara()
					if ( f != (-1) ) {
						flt
						characreate -1, CREATURE_ID_MINA_THE_NEWCOMER_TO_GUILD, 26, 2
						cRole(rc) = ROLE_UNIQUE_MINA
					}
				}
				noteadd "Added NPC."
			}
		}
		if ( gArea  == 50 ) {
			if ( gLevel  == 1 ) {
				f = 0
				repeat 188, 57
					if ( cId(cnt) == CREATURE_ID_TAIF_THE_CAPTAIN_SHINING ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					f = get_freechara()
					if ( f != (-1) ) {
						flt
						characreate -1, CREATURE_ID_TAIF_THE_CAPTAIN_SHINING, 30, 6
						cRole(rc) = ROLE_UNIQUE_TAIF
					}
				}
				f = 0
				repeat 188, 57
					if ( cId(cnt) == CREATURE_ID_JUST_WAITING_FEN ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					f = get_freechara()
					if ( f != (-1) ) {
						flt
						characreate -1, CREATURE_ID_JUST_WAITING_FEN, 3, 33
						cRole(rc) = ROLE_UNIQUE_FEN
					}
				}
				noteadd "Added NPC."
			}
		}
		if ( gArea  == 53 ) {
			if ( gLevel  == 1 ) {
				f = 0
				repeat 188, 57
					if ( cId(cnt) == CREATURE_ID_NINEDA_THE_DEPENDENT ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					f = get_freechara()
					if ( f != (-1) ) {
						flt
						characreate -1, CREATURE_ID_NINEDA_THE_DEPENDENT, 30, 23
						cRole(rc) = ROLE_UNIQUE_NINEDA
					}
				}
				noteadd "Added NPC."
			}
		}
		if ( gArea  == 52 ) {
			if ( gLevel  == 1 ) {
				f = 0
				repeat 188, 57
					if ( cId(cnt) == CREATURE_ID_JEN_THE_THIEF ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					f = get_freechara()
					if ( f != (-1) ) {
						flt
						characreate -1, CREATURE_ID_JEN_THE_THIEF, 23, 13
						cRole(rc) = ROLE_UNIQUE_JEN
					}
				}
				noteadd "Added NPC."
			}
		}
		if ( gArea  == 54 ) {
			if ( gLevel  == 1 ) {
				f = 0
				repeat 188, 57
					if ( cId(cnt) == CREATURE_ID_NITO_THE_CHEMIST ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					f = get_freechara()
					if ( f != (-1) ) {
						flt
						characreate -1, CREATURE_ID_NITO_THE_CHEMIST, 15, 15
						cRole(rc) = ROLE_UNIQUE_NITO
					}
				}
				noteadd "Added NPC."
			}
		}
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "checkTitle") != (-1) ) {
		if ( gArea  == 58 ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				f = 0
				repeat 188, 57
					if ( eqfaction(cnt, "st_ruralboss") & cExist(cnt) == CHAR_STATE_ALIVE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					newtitle TITLE_DISORDERLY_CROWD
				}
				noteadd "Added Title."
			}
		}
		if ( gArea  == 57 ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				f = 0
				repeat 188, 57
					if ( eqfaction(cnt, "st_ruinboss") & cExist(cnt) == CHAR_STATE_ALIVE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					newtitle TITLE_INNOVATION
				}
				noteadd "Added Title."
			}
		}
		if ( gArea  == 62 ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				f = 0
				repeat 188, 57
					if ( eqfaction(cnt, "nc_subquest_ice") & cExist(cnt) == CHAR_STATE_ALIVE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					newtitle TITLE_LET_IT_GO
				}
				noteadd "Added Title."
			}
		}
		if ( gArea  == 60 ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				f = 0
				repeat 188, 57
					if ( eqfaction(cnt, "st_caveboss") & cExist(cnt) == CHAR_STATE_ALIVE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					newtitle TITLE_WIZARD_ONLY_LIVE_TWICE
				}
				noteadd "Added Title."
			}
		}
		if ( gArea  == 63 ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				f = 0
				repeat 188, 57
					if ( eqfaction(cnt, "nc_isekiboss") & cExist(cnt) == CHAR_STATE_ALIVE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					newtitle TITLE_NECROMANIA
				}
				noteadd "Added Title."
			}
		}
		if ( gArea  == 59 ) {
			if ( gLevel  == areaCanSave(gArea ) ) {
				f = 0
				repeat 188, 57
					if ( eqfaction(cnt, "st_feaboss") & cExist(cnt) == CHAR_STATE_ALIVE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					newtitle TITLE_THE_WORLD_IS_SPINNING
				}
				noteadd "Added Title."
			}
		}
		if ( ncgBoughtFairyResort == 1 ) {
			newtitle TITLE_FAIRY_CROSSING_NEW_HORIZONS
			noteadd "Added Title."
		}
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fix_armor") != (-1) ) {
		repeat 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			nc_intb_001 = cnt
			repeat 30
				body = 100 + cnt
				if ( cdata(body, nc_intb_001) \ EXT_EQUIP_SLOTS == 0 ) {
					continue
				}
				nc_intb_002 = cdata(body, nc_intb_001) \ EXT_EQUIP_SLOTS - 1
				if ( iStatus(nc_intb_002) < ITEM_STATUS_NORMAL ) {
					continue
				}
				r1 = nc_intb_001
				gosub *label_3591
			loop
			inv_getheader cnt
			repeat invrange, invhead
				if ( iStatus(cnt) < ITEM_STATUS_NORMAL ) {
					continue
				}
				iEquip(cnt) = 0
			loop
			r1 = nc_intb_001
			gosub *charaRefresh
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fix_trait") != (-1) ) {
		repeat 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( gettrait(cnt, 96) != 0 ) {
				featcnt = stat
				rmfaction cnt, "trait96," + featcnt
				addfaction cnt, "trait130," + featcnt
			}
			if ( gettrait(cnt, 97) != 0 ) {
				featcnt = stat
				rmfaction cnt, "trait97," + featcnt
				addfaction cnt, "trait131," + featcnt
			}
			if ( gettrait(cnt, 98) != 0 ) {
				featcnt = stat
				rmfaction cnt, "trait98," + featcnt
				addfaction cnt, "trait132," + featcnt
			}
			if ( cnt == 0 ) {
				if ( gettrait(cnt, 100) != 0 ) {
					featcnt = stat
					rmfaction cnt, "trait100," + featcnt
					addfaction cnt, "trait250," + featcnt
				}
				if ( gettrait(cnt, 101) != 0 ) {
					featcnt = stat
					rmfaction cnt, "trait101," + featcnt
					addfaction cnt, "trait251," + featcnt
				}
				if ( gettrait(cnt, 102) != 0 ) {
					featcnt = stat
					rmfaction cnt, "trait102," + featcnt
					addfaction cnt, "trait252," + featcnt
				}
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fix_ai") != (-1) ) {
		repeat 188, 57
			if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
				if ( cAiSub(cnt) == 101 ) {
					cAiSub(cnt) = 100
				}
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fix_magicbookshop") != (-1) ) {
		repeat 800
			if ( itemmemory(2, cnt) == 2 ) {
				itemmemory(2, cnt) = 1
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fix_haizin") != (-1) ) {
		repeat 188, 57
			memset sdataex(0, cnt), 0, 600 * 4
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fix_eter") != (-1) ) {
		if ( gCorrupt == 0 ) {
			repeat 40
				gdata(700 + cnt) = 0
			loop
			noteadd "Done."
		}
		goto *console_write
	}
	if ( instr(buff, 0, "eter") != (-1) ) {
		repeat 40
			noteadd str(700 + cnt) + ":" + gdata(700 + cnt)
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "wish_count") != (-1) ) {
		noteadd "Wish count: " + gWellWish
		noteadd "Probability that you lost chance to wish in next well:\n" + 90 * gWellWish / (gWellWish + 1) + "%"
		goto *console_write
	}
	if ( instr(buff, 0, "updateoomseskills") != (-1) ) {
		repeat 245
			locvar_getnpctxt_cnt2 = cnt
			cActHeal(cnt) = migration_oomse2oomsestid(cActHeal(cnt))
			repeat 10, 215
				cdata(cnt, locvar_getnpctxt_cnt2) = migration_oomse2oomsestid(cdata(cnt, locvar_getnpctxt_cnt2))
			loop
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "gameclear") != (-1) & gWizard == 1 ) {
		flagMain = 200
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "haizin") != (-1) & gWizard == 1 ) {
		ogTitleJunkie = 1
		goto *console_write
	}
	if ( instr(buff, 0, "bigench") != (-1) & gWizard == 1 ) {
		inv(37, 0) = 10002
		inv(38, 0) = 5
		goto *console_write
	}
	if ( instr(buff, 0, "meisei") != (-1) & gWizard == 1 ) {
		cFame(CHARA_PLAYER) = 1000000
		goto *console_write
	}
	if ( instr(buff, 0, "allheal") != (-1) & gWizard == 1 ) {
		repeat 16
			if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, 0) == 0 ) {
				continue
			}
			delbuff CHARA_PLAYER, cnt
			continue cnt
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "Gamebreak") != (-1) & gWizard == 1 ) {
		repeat 2
			sdata(2 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(3 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(10 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(11 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(12 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(13 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(14 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(15 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(16 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(17 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(18 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdata(19 + STARTING_SKILL_SPACT, cnt) = 2000 * 1000000
			sdataex(2, cnt) = 97999
			sdataex(3, cnt) = 97999
			sdataex(10, cnt) = 97999
			sdataex(11, cnt) = 97999
			sdataex(12, cnt) = 97999
			sdataex(13, cnt) = 97999
			sdataex(14, cnt) = 97999
			sdataex(15, cnt) = 97999
			sdataex(16, cnt) = 97999
			sdataex(17, cnt) = 97999
			sdataex(18, cnt) = 97999
			sdataex(19, cnt) = 97999
		loop
		noteadd "99999に"
		goto *console_write
	}
	if ( instr(buff, 0, "elapse_day") != (-1) & gWizard == 1 ) {
		gDay ++
		datetime_normalizegamedate
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "elapse_week") != (-1) & gWizard == 1 ) {
		gDay  += 7
		datetime_normalizegamedate
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "elapse_month") != (-1) & gWizard == 1 ) {
		gMonth ++
		datetime_normalizegamedate
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "elapse_year") != (-1) & gWizard == 1 ) {
		gYear ++
		repeat 16
			if ( gettrait(cnt, 97) == 1 ) {
				cAge(cnt)++
				if ( cAge(cnt) > gYear  ) {
					cAge(cnt) = gYear 
				}
			}
		loop
		datetime_normalizegamedate
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "crash") != (-1) ) {
		f = rnd(0)
		noteadd "Wizard mode activated."
		goto *console_write
	}
	if ( instr(buff, 0, "wizard") != (-1) ) {
		gWizard = 1
		cnAka(CHARA_PLAYER) = "*Debug*"
		noteadd "Wizard mode activated."
		goto *console_write
	}
	if ( instr(buff, 0, "natural") != (-1) ) {
		gWizard = 0
		cnAka(CHARA_PLAYER) = "*Debug*"
		noteadd "Wizard mode inactivated."
		goto *console_write
	}
	if ( instr(buff, 0, "resetstquest") != (-1) & gWizard ) {
		ncgQuestNewcomersProblems = 0
		ncgQuestSpiritOfDistraction = 0
		noteadd "Reset."
		goto *console_write
	}
	if ( instr(buff, 0, "magicall") != (-1) & gWizard ) {
		repeat 67
			sdata(1000 + cnt, CHARA_PLAYER) = 2000000000
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "outputinv") != (-1) ) {
		delstr buff, "outputinv"
		p = int(buff)
		noteadd itemname(p)
		repeat 70
			noteadd "inv(" + cnt + ", " + p + ") = " + inv(cnt, p)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "outputfileloaded") != (-1) ) {
		sreplace buff, loadedbuff, "/", "\n"
		notesel buff
		notesave exedir + "loadedBuff.txt"
		noteunsel
		noteadd "Done."
		exec exedir + "loadedBuff.txt", 16
		goto *console_write
	}
	if ( instr(buff, 0, "unique") != (-1) ) {
		noteadd lang("オークの隊長『ゴダ』\t\t", "<Goda> the captain of orc\t") + npcmemory(1, CREATURE_ID_GODA_THE_CAPTAIN_OF_ORC)
		noteadd lang("マッドサイエンティスト\t\t", "<Mad scientist>\t\t\t") + npcmemory(1, CREATURE_ID_MAD_SCIENTIST)
		noteadd lang("堕天使『イスカ』\t\t", "<Isca> the fallen angel\t\t") + npcmemory(1, CREATURE_ID_ISCA_THE_FALLEN_ANGEL)
		noteadd lang("『ダンジョンクリーナー』\t", "<Dungeon cleaner>\t\t") + npcmemory(1, CREATURE_ID_DUNGEON_CLEANER)
		repeat usernpcmax
			if ( userdata(12, cnt) == 2 ) {
				se_length = strlen(userdatan(1, cnt))
				s = "\t"
				if ( se_length < 8 * 1 ) {
					s += "\t"
				}
				if ( se_length < 8 * 2 ) {
					s += "\t"
				}
				if ( se_length < 8 * 3 ) {
					s += "\t"
				}
				if ( se_length < 8 * 4 ) {
					s += "\t"
				}
				noteadd userdatan(1, cnt) + s + str(getcnpcmemory(1, cnt))
			}
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "usernpc") != (-1) ) {
		repeat usernpcmax
			se_length = strlen(userdatan(1, cnt))
			s = "\t"
			if ( se_length < 8 * 1 ) {
				s += "\t"
			}
			if ( se_length < 8 * 2 ) {
				s += "\t"
			}
			if ( se_length < 8 * 3 ) {
				s += "\t"
			}
			if ( se_length < 8 * 4 ) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + userdatan(1, cnt) + s + userdatan(0, cnt)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "useritem") != (-1) ) {
		repeat useritemmax
			se_length = strlen(useritemdatan(1, cnt))
			s = "\t"
			if ( se_length < 8 * 1 ) {
				s += "\t"
			}
			if ( se_length < 8 * 2 ) {
				s += "\t"
			}
			if ( se_length < 8 * 3 ) {
				s += "\t"
			}
			if ( se_length < 8 * 4 ) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + useritemdatan(1, cnt) + s + useritemdatan(0, cnt)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "usergod") != (-1) ) {
		repeat usergodmax
			se_length = strlen(usergoddatan(1, cnt))
			s = "\t"
			if ( se_length < 8 * 1 ) {
				s += "\t"
			}
			if ( se_length < 8 * 2 ) {
				s += "\t"
			}
			if ( se_length < 8 * 3 ) {
				s += "\t"
			}
			if ( se_length < 8 * 4 ) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + usergoddatan(1, cnt) + s + usergoddatan(0, cnt)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "userrace") != (-1) ) {
		repeat length(racenamecsv)
			se_length = strlen(racenamecsv(cnt, 0))
			s = "\t"
			if ( se_length < 8 * 1 ) {
				s += "\t"
			}
			if ( se_length < 8 * 2 ) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + racenamecsv(cnt, 0) + s + racenamecsv(cnt, 1)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "userclass") != (-1) ) {
		repeat length(classnamecsv)
			se_length = strlen(classnamecsv(cnt, 0))
			s = "\t"
			if ( se_length < 8 * 1 ) {
				s += "\t"
			}
			if ( se_length < 8 * 2 ) {
				s += "\t"
			}
			noteadd "" + cnt + "\t" + classnamecsv(cnt, 0) + s + classnamecsv(cnt, 1)
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "youngerladyreset") != (-1) ) {
		repeat 1
			if ( ogYoungLadySeed != (-1) ) {
				break
			}
			locvar_matdelmain_f = 1
			repeat 40 - 1, 16
				if ( cRole(cnt) == 20000 | ocFormerPet(cnt) == 20000 ) {
					locvar_matdelmain_f = 0
					break
				}
			loop
			if ( locvar_matdelmain_f ) {
				ogYoungLadySeed = 0
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "petaireset") != (-1) ) {
		repeat 15, 1
			cnt2 = cnt
			if ( cExist(cnt) == CHAR_STATE_DEAD ) {
				continue
			}
			if ( cId(cnt) == CREATURE_ID_USER ) {
				initunid = cUNID(cnt) + 1
			}
			characreate MAX_CHARA_NC, cId(cnt), -3, 0
			cBarrier(cnt) = cBarrier(MAX_CHARA_NC)
			cAiCalm(cnt) = cAiCalm(MAX_CHARA_NC)
			cAiMoveFreq(cnt) = cAiMoveFreq(MAX_CHARA_NC)
			cAiDistance(cnt) = cAiDistance(MAX_CHARA_NC)
			cAiSub(cnt) = cAiSub(MAX_CHARA_NC)
			cActHeal(cnt) = cActHeal(MAX_CHARA_NC)
			cActIndex(cnt) = cActIndex(MAX_CHARA_NC)
			repeat 10, 215
				cdata(cnt, cnt2) = cdata(cnt, MAX_CHARA_NC)
			loop
			cdata(CDATA_ELEMENT, cnt) = cdata(CDATA_ELEMENT, MAX_CHARA_NC)
			chara_vanquish MAX_CHARA_NC
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixhammer") != (-1) ) {
		repeat 200
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( equalsitem(cnt, "blacksmith hammer") ) {
				if ( ogSmithingTargetEnchantment < iLevel(cnt) ) {
					ogSmithingTargetEnchantment = iLevel(cnt)
				}
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "inheritance") != (-1) ) {
		delstr buff, "inheritance"
		p = int(buff)
		noteadd itemname(p)
		noteadd "Page\tId\tName"
		repeat 1700
			randomize 10500 + cnt
			s = "" + (cnt / 17 + 1) + "\t" + (10500 + cnt) + "\t" + random_title(3)
			if ( cnt \ 17 == 0 ) {
				s += lang("(選択不可)", "(Unavailable)")
			}
			randomize 50500 + cnt
			dim ginga, 15
			ginga = -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
			gingamax = 0
			cibk2 = ci
			ci = 5480
			dbid = iID(p)
			dbmode = DBMODE_SET
			gosub *db_item
			iNum(ci) = 0
			ci = cibk2
			repeat 10
				locvar_getinheritance_p = rnd(15)
				if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, p) == 0 ) {
					continue
				}
				locvar_getinheritance_f = 0
				repeat gingamax + 1
					if ( locvar_getinheritance_p == ginga(cnt) ) {
						locvar_getinheritance_f = 1
						break
					}
				loop
				if ( locvar_getinheritance_f == 0 ) {
					i = iMaterial(p)
					repeat 8
						if ( mtenc(cnt * 2, i) == 0 ) {
							break
						}
						mtencid = mtenc(cnt * 2, i)
						if ( mtencid == 0 ) {
							break
						}
						if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, p) == mtencid ) {
							if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, p) - mtenc(cnt * 2 + 1, i) <= 0 ) {
								locvar_getinheritance_f = 1
								break
							}
						}
					loop
				}
				if ( locvar_getinheritance_f == 0 ) {
					repeat length(fixeditemenc)
						if ( fixeditemenc(cnt * 2) == 0 ) {
							break
						}
						if ( inv(STARTING_INV_ITEM_ENCHANT + locvar_getinheritance_p * 2, p) != fixeditemenc(cnt * 2) ) {
							continue
						}
						if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, p) - fixeditemenc(cnt * 2 + 1) <= 0 ) {
							locvar_getinheritance_f = 1
							break
						}
					loop
				}
				if ( locvar_getinheritance_f == 1 ) {
					continue
				}
				if ( rnd(4) > gingamax | inv(STARTING_INV_ITEM_ENCHANT_POWER + locvar_getinheritance_p * 2, p) < 0 ) {
					ginga(gingamax) = locvar_getinheritance_p
					gingamax++
				}
			loop
			randomize
			repeat gingamax
				s += "\t" + (ginga(cnt) + 1)
			loop
			noteadd s
		loop
		goto *console_write
	}
	if ( instr(buff, 0, "enchantmentlist") != (-1) & gWizard ) {
		delstr buff, "enchantmentlist"
		ci = int(buff)
		buff = ""
		nc_intb_living = 1
		notesel buff_list
		noteadd "Page\t\tId\t\tName"
		repeat 1000000
			title str(cnt) + "/1000000"
			randomize 10500 + cnt
			s3 = random_title(3)
			if ( cnt \ 17 == 0 ) {
				s3 += lang("(選択不可)", "(Unavailable)")
			}
			s2 = "" + (cnt / 17 + 1) + "\t\t" + (10500 + cnt) + "\t\t" + s3
			repeat 50 - strlen(s3)
				s2 += " "
			loop
			cnt2 = cnt
			repeat 50
				randomize 50500 + cnt2 + cnt + 10
				exrand_randomize 50500 + cnt2 + cnt + 10
				encadd ci, randomenc(randomenclv(4)), randomencp(0, 0), 0, 0, 1
				if ( stat != 0 ) {
					if ( rtval == 34 ) {
						if ( rnd(3) ) {
							continue
						}
					}
					if ( encpassivecheck(rtval) ) {
						if ( encfindspec(ci, rtval) != (-1) ) {
							continue
						}
					}
					list_bk(0, listmax) = rtval, rtval(1)
					val = list_bk(0, listmax), list_bk(1, listmax)
					gosub *item_encdetail
					noteadd s2 + cnven(s)
					break
				}
				else {
					continue
				}
			loop
		loop
		notesave "list.txt"
		nc_intb_living = 0
		goto *console_write
	}
	if ( instr(buff, 0, "searchnameEX") != (-1) ) {
		f = 0
		delstr buff, "searchnameEX"
		noteadd "検索結果:" + buff
		repeat 2000000000
			randomize 10500 + cnt
			if ( cnt \ 17 == 0 ) {
				continue
			}
			if ( instr(buff, 0, random_title(3)) != (-1) ) {
				noteadd "" + (cnt / 17 + 1) + "Pに存在します"
				f = 1
				break
			}
		loop
		if ( f == 0 ) {
			noteadd "見つかりませんでした"
		}
		goto *console_write
	}
	if ( instr(buff, 0, "searchnameP") != (-1) ) {
		f = 0
		delstr buff, "searchnameP"
		noteadd "検索結果:" + buff
		repeat 100000000
			randomize 10500 + cnt
			if ( cnt \ 17 == 0 ) {
				continue
			}
			if ( instr(buff, 0, random_title(3)) != (-1) ) {
				noteadd "" + (cnt / 17 + 1) + "Pに存在します"
				f = 1
				break
			}
		loop
		if ( f == 0 ) {
			noteadd "見つかりませんでした"
		}
		goto *console_write
	}
	if ( instr(buff, 0, "searchname") != (-1) ) {
		f = 0
		delstr buff, "searchname"
		noteadd "検索結果:" + buff
		repeat 1000000
			randomize 10500 + cnt
			if ( cnt \ 17 == 0 ) {
				continue
			}
			if ( instr(buff, 0, random_title(3)) != (-1) ) {
				noteadd "" + (cnt / 17 + 1) + "Pに存在します"
				f = 1
				break
			}
		loop
		if ( f == 0 ) {
			noteadd "見つかりませんでした"
		}
		goto *console_write
	}
	if ( instr(buff, 0, "fixammoenc") != (-1) ) {
		repeat 200
			cnt2 = cnt
			repeat 15
				if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cnt2) / 10000 != 9 ) {
					continue
				}
				if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt2) > 999999 ) {
					inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, cnt2) = 999999
				}
			loop
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "cell_refreshAll") != (-1) ) {
		repeat mHeight
			cnt2 = cnt
			repeat mWidth
				cell_refresh cnt, cnt2
			loop
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "resetfaction") != (-1) ) {
		rmfaction 0, "nature"
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixadventurer1") != (-1) ) {
		repeat 55 - 16, 16
			rmfaction cnt, "pet"
			rmfaction cnt, "align"
			addfaction cnt, "align,neutral"
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "containerize") != (-1) ) {
		repeat 5480
			ci = cnt
			gosub *label_4707
			if ( iID(ci) == ITEM_ID_STORAGE ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 10
			}
			if ( iID(ci) == ITEM_ID_TRASH_CAN ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 17
				iEffect(ci) = 1503
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixbyakko") != (-1) ) {
		repeat 244, 1
			if ( cId(cnt) == CREATURE_ID_USER ) {
				if ( userdatan(0, cnt) == "byakko" ) {
					cAiSub(cnt) = 0
					cdata(STARTING_CDATA_ACT_SUB, cnt) = SKILL_NONE, SKILL_NONE, SKILL_NONE, SKILL_NONE, SKILL_NONE
					cActIndex(cnt) = 5
					cbitmod CHARA_BIT_INCOGNITO, cnt, FALSE
				}
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixfaction2") != (-1) ) {
		repeat 244, 1
			if ( cExist(cnt) != CHAR_STATE_DEAD ) {
				r1 = cnt
				resetfaction r1
				refreshfaction r1
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixrelation1") != (-1) ) {
		cRelation(CHARA_PLAYER) = RELATION_ALLY
		cOrgRelation(CHARA_PLAYER) = RELATION_ALLY
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixguild1") != (-1) ) {
		if ( areaId(gArea ) == AREA_LUMIEST | areaId(gArea ) == AREA_DERPHY | areaId(gArea ) == AREA_PORT_KAPUL ) {
			if ( gLevel  == 3 ) {
				if ( mType == MAP_TYPE_HOME ) {
					mType = MAP_TYPE_VILLAGE
				}
			}
		}
		noteadd "Done."
		goto *console_write
	}
	if ( gWizard | 0 ) {
		if ( instr(buff, 0, "gain_spell") != (-1) ) {
			repeat 549 - 400, 400
				skillgain CHARA_PLAYER, cnt, cLevel(r1), 100 * 100
			loop
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "gain_spact") != (-1) ) {
			repeat 661 - 600
				if ( skillUse(cnt + 600) != SKILL_NONE ) {
					spact(cnt) = 1
				}
			loop
			repeat tailspact - 661
				if ( skillUse(cnt + 661) != SKILL_NONE ) {
					ospact(cnt) = 1
				}
			loop
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "allinv") != (-1) ) {
			repeat 5480
				if ( cnt < 5080 ) {
					if ( cnt >= 200 ) {
						if ( (cnt - 200) \ 20 == 0 ) {
							noteadd "-------------------" + cnName((cnt - 200) / 20 + 1)
						}
					}
				}
				if ( cnt == 5080 ) {
					noteadd "---------------MAP INV"
				}
				noteadd "" + cnt + "\t" + iNum(cnt) + "\t" + itemname(cnt) + " it:" + iTurn(cnt)
			loop
			goto *console_write
		}
		if ( instr(buff, 0, "mapinv") != (-1) ) {
			repeat 5480 - 5080
				if ( cnt == 5080 ) {
					noteadd "---------------MAP INV"
				}
				if ( iNum(cnt) != 0 ) {
					noteadd "" + cnt + "\t" + iNum(cnt) + "\t" + itemname(cnt) + " it:" + iTurn(cnt)
				}
			loop
			goto *console_write
		}
		if ( instr(buff, 0, "gain_exp") != (-1) ) {
			cExp(CHARA_PLAYER) += 1000000000
			r1 = 0
			r2 = 0
			gosub *label_1588
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "gain_fame") != (-1) ) {
			incfame 0, 10000
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "gain_money") != (-1) ) {
			se_moneymod 0, 100000000
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "gain_faith") != (-1) ) {
			modpiety 10000, 0
			modpiety 1, 0
			cPray(CHARA_PLAYER) = 2000
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "gain_userspell") != (-1) ) {
			repeat userspellmax
				userspelldata(11, cnt) += limitmax(calcuserspellcoststock(cnt) * 200, 2147483647)
			loop
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "settarget") != (-1) ) {
			word = buff
			p = 0
			i = strlen(word)
			s = "", ""
			repeat 40
				s(cnt) = ""
				getstr s(cnt), word, limit(p, 0, i), 32
				if ( strsize > i ) {
					break
				}
				p += strsize
			loop
			cc = int(s(1))
			lockon cc, int(s(2)), 10
			cAiAggro(cc) = 80
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "join_guild") != (-1) ) {
			word = buff
			p = 0
			i = strlen(word)
			s = "", ""
			repeat 40
				s(cnt) = ""
				getstr s(cnt), word, limit(p, 0, i), 32
				if ( strsize > i ) {
					break
				}
				p += strsize
			loop
			joinguild 0, s(1)
			ogdata(250) = 0, 0, 0, 0, 0
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "update_nefia") != (-1) ) {
			gWorldRenew = TRUE
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "gain_guildmasterpoint") != (-1) ) {
			ogdata(253) += 5
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "mod_rank") != (-1) ) {
			modrank 8, 5000, 8
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "gain_featpoint") != (-1) ) {
			gTraitPoint += 50
			repeat 244, 1
				if ( petcheck(cnt) ) {
					ocFeatsAcquirable(cnt) += 50
				}
			loop
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "set_trait") != (-1) ) {
			word = buff
			p = 0
			i = strlen(word)
			s = "", "0", "0", "0"
			repeat 40
				s(cnt) = ""
				getstr s(cnt), word, limit(p, 0, i), 32
				if ( strsize > i ) {
					break
				}
				p += strsize
			loop
			r1 = int(s(1))
			tid = int(s(TRAIT_NORMAL_STAT_LIFE))
			p = int(s(3))
			settrait r1, tid, p
			noteadd "Done."
			goto *console_write
		}
		if ( instr(buff, 0, "tgm") != (-1) ) {
			if ( dbg_godmode ) {
				dbg_godmode = 0
				dbg_freesp = 0
				noteadd "god mode off."
			}
			else {
				dbg_godmode = 1
				dbg_freesp = 1
				noteadd "god mode on."
			}
			goto *console_write
		}
		if ( instr(buff, 0, "tai") != (-1) ) {
			if ( dbg_autoidentify ) {
				dbg_autoidentify = 0
				noteadd "auto identify off."
			}
			else {
				dbg_autoidentify = 10
				noteadd "auto identify on."
			}
			goto *console_write
		}
		if ( instr(buff, 0, "gain_imp") != (-1) ) {
			repeat 244, 1
				if ( petcheck(cnt) ) {
					cImpression(cnt) += 300
				}
			loop
			noteadd "Done."
			goto *console_write
		}
	}
	if ( instr(buff, 0, "resetchipm") != (-1) ) {
		repeat 500
			adata(31, cnt) = 0
			adata(32, cnt) = 0
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "resetcai") != (-1) ) {
		repeat 16
			nc_aicnt = cnt
			repeat 10
				nc_aicnt2 = cnt
				repeat aipage * 15
					nc_ai(nc_aicnt, nc_aicnt2, cnt) = 0
				loop
			loop
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixaisp") != (-1) ) {
		delstr buff, "fixaisp"
		repeat 229, 16
			if ( cAiSub(cnt) == 101 ) {
				cAiSub(int(buff)) = 25
			}
		loop
		noteadd "Done."
		goto *console_write
	}
	if ( instr(buff, 0, "fixai") != (-1) ) {
		delstr buff, "fixai"
		if ( cId(int(buff)) != CREATURE_ID_USER ) {
			characreate MAX_CHARA_NC, cId(int(buff)), -3, 0
			cAiCalm(int(buff)) = cAiCalm(MAX_CHARA_NC)
			ocAiCalm(int(buff)) = cAiCalm(MAX_CHARA_NC)
			chara_vanquish MAX_CHARA_NC
		}
		noteadd "Done."
		goto *console_write
	}
	noteadd "Unknown command. Type \"?\" for help. Hit ESC to exit."
	goto *console_write
	goto *dbg_GetInfo

*console_write
	noteadd ""
	objprm 1, dbm
	objprm 2, ""
	return

*mutexobj
	mutexstring = "Elona_" + dirinfo(1)
	CreateMutexA 0, 0, strtrim(mutexstring, 3, 92)
	mutex_handle = stat
	func_2
	if ( stat == 183 ) {
		dialog lang("二重起動のため終了します。", "The program is already running."), 1
		end
	}
	return











































































































































































































