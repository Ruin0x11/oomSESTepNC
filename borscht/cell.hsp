#deffunc cell_show int cell_show_x, int cell_show_y, int cell_show_see
	locvar_cell_show_dx = (cell_show_x - scx) * inf_tiles
	if ( scx != scxbk ) {
		locvar_cell_show_dx += sxfix
	}
	locvar_cell_show_dy = (cell_show_y - scy) * inf_tiles
	if ( scy != scybk ) {
		locvar_cell_show_dy += syfix
	}
	if ( locvar_cell_show_dx <= -inf_tiles | locvar_cell_show_dx >= windoww ) {
		return
	}
	if ( locvar_cell_show_dy <= -inf_tiles | locvar_cell_show_dy >= windowh - inf_verh ) {
		return
	}
	locvar_cell_show_ground = mapIdMemory(cell_show_x, cell_show_y)
	locvar_cell_show_sel = 2
	gmode 0, inf_tiles, inf_tiles
	pos locvar_cell_show_dx, locvar_cell_show_dy
	locvar_cell_show_wall = 0
	if ( mTileFile == 1 ) {
		if ( chipm(CHIPM_WALL, locvar_cell_show_ground) == 2 ) {
			if ( cell_show_y < mHeight - 1 ) {
				if ( chipm(CHIPM_WALL, mapIdMemory(cell_show_x, cell_show_y + 1)) == 2 ) {
				}
				else {
					if ( mapIdMemory(cell_show_x, cell_show_y + 1) != tile_fog ) {
						locvar_cell_show_ground += 33
					}
				}
			}
		}
		if ( chipm(CHIPM_WALL, locvar_cell_show_ground) ) {
			locvar_cell_show_wall = 1
		}
	}
	if ( chipm(CHIPM_ANIM, locvar_cell_show_ground) != 0 ) {
		gcopy locvar_cell_show_sel, locvar_cell_show_ground \ 33 * inf_tiles, locvar_cell_show_ground / 33 * inf_tiles
	}
	else {
		gcopy locvar_cell_show_sel, locvar_cell_show_ground \ 33 * inf_tiles, locvar_cell_show_ground / 33 * inf_tiles
	}
	gmode 2, inf_tiles, inf_tiles
	if ( cell_show_see ) {
		if ( mapFragment(cell_show_x, cell_show_y) != 0 ) {
			locvar_cell_show_p = mapFragment(cell_show_x, cell_show_y) \ 10, mapFragment(cell_show_x, cell_show_y) / 10
			if ( locvar_cell_show_p(1) ) {
				gcopy BUFFER_CHR, locvar_cell_show_p(1) * inf_tiles + 288, 1152
			}
			if ( locvar_cell_show_p ) {
				if ( locvar_cell_show_p > 6 ) {
					locvar_cell_show_p = 6
				}
				gcopy BUFFER_CHR, locvar_cell_show_p * inf_tiles, 1152
			}
		}
	}
	if ( mapFeat(cell_show_x, cell_show_y) != 0 ) {
		if ( mapIdMemory(cell_show_x, cell_show_y) == mapId(cell_show_x, cell_show_y) ) {
			locvar_cell_show_p = mapFeat(cell_show_x, cell_show_y) \ 1000
			if ( locvar_cell_show_p != 999 & locvar_cell_show_p != 0 ) {
				pos locvar_cell_show_dx, locvar_cell_show_dy
				gcopy BUFFER_MAP, locvar_cell_show_p \ 33 * inf_tiles, locvar_cell_show_p / 33 * inf_tiles
			}
			if ( mType == MAP_TYPE_WORLD ) {
				locvar_cell_show_p = mapFeat(cell_show_x, cell_show_y) / 100000 \ 100 + mapFeat(cell_show_x, cell_show_y) / 10000000 * 100
				if ( areaId(locvar_cell_show_p) == AREA_RANDOM_DUNGEON ) {
					if ( areaDeepest(locvar_cell_show_p) == areaCanSave(locvar_cell_show_p) ) {
						pos locvar_cell_show_dx + 16, locvar_cell_show_dy - 16
						gcopy BUFFER_INF, 32, 624, 16, 16
					}
					else {
						if ( areaDeepest(locvar_cell_show_p) != 0 ) {
							pos locvar_cell_show_dx + 16, locvar_cell_show_dy - 16
							gcopy BUFFER_INF, 48, 624, 16, 16
						}
					}
				}
			}
		}
	}
	if ( cell_show_see ) {
		if ( mapMef(cell_show_x, cell_show_y) != 0 ) {
			locvar_cell_show_p = mapMef(cell_show_x, cell_show_y) - 1
			pos locvar_cell_show_dx, locvar_cell_show_dy
			if ( mefPic(locvar_cell_show_p) > 10000 ) {
				gsel BUFFER_ITEM
				color 0
				boxf 0, 960, chipi(CHIPI_WIDTH, mefPic(locvar_cell_show_p) \ 10000), chipi(CHIPI_HEIGHT, mefPic(locvar_cell_show_p) \ 10000) + 960
				if ( mefPic(locvar_cell_show_p) \ 10000 == 528 ) {
					gmode 2
					pos 0, 960
					gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
					pos 0, 1008
					gzoom 22, 20, 5, chipc(CHIPC_X, mefPic(locvar_cell_show_p) / 10000) + 8, chipc(CHIPC_Y, mefPic(locvar_cell_show_p) / 10000) + 4 + (chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) > inf_tiles) * 8, chipc(CHIPC_WIDTH, mefPic(locvar_cell_show_p) / 10000) - 16, chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) - 8 - (chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) > inf_tiles) * 10, 1
					pos 6, 974
					gcopy BUFFER_ITEM, 0, 1008, 22, 20
					gsel selcur
				}
				else {
					if ( mefPic(locvar_cell_show_p) \ 10000 == 531 ) {
						pos 8, 1058 - chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000)
						gcopy BUFFER_CHR, chipc(CHIPC_X, mefPic(locvar_cell_show_p) / 10000) + 8, chipc(CHIPC_Y, mefPic(locvar_cell_show_p) / 10000) + 2, chipc(CHIPC_WIDTH, mefPic(locvar_cell_show_p) / 10000) - 16, chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) - 8
						gmode 4, , , 150
						color 0, 0, 0
						pos 0, 960 + (chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) == inf_tiles) * 48
						gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) + (chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000) > inf_tiles) * 48
						gmode 2
						gsel selcur
					}
					else {
						if ( mefPic(locvar_cell_show_p) \ 10000 == 529 ) {
							pos 0, 1056 - chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000)
							gcopy BUFFER_CHR, chipc(CHIPC_X, mefPic(locvar_cell_show_p) / 10000), chipc(CHIPC_Y, mefPic(locvar_cell_show_p) / 10000), chipc(CHIPC_WIDTH, mefPic(locvar_cell_show_p) / 10000), chipc(CHIPC_HEIGHT, mefPic(locvar_cell_show_p) / 10000)
							gmode 2
							gsel selcur
						}
						else {
							pos 0, 960
							gcopy BUFFER_ITEM, chipi(CHIPI_X, mefPic(locvar_cell_show_p) \ 10000), chipi(CHIPI_Y, mefPic(locvar_cell_show_p) \ 10000), chipi(CHIPI_WIDTH, mefPic(locvar_cell_show_p) \ 10000), chipi(CHIPI_HEIGHT, mefPic(locvar_cell_show_p) \ 10000)
							gfini chipi(CHIPI_WIDTH, mefPic(locvar_cell_show_p) \ 10000), chipi(CHIPI_HEIGHT, mefPic(locvar_cell_show_p) \ 10000)
							gfdec2 c_col(0, mefPic(locvar_cell_show_p) / 10000), c_col(1, mefPic(locvar_cell_show_p) / 10000), c_col(2, mefPic(locvar_cell_show_p) / 10000)
							gsel selcur
						}
					}
				}
				gcopy BUFFER_ITEM, 0, 960, inf_tiles, inf_tiles
			}
			else {
				gcopy BUFFER_ITEM, mefPic(locvar_cell_show_p) \ 33 * inf_tiles, mefPic(locvar_cell_show_p) / 33 * inf_tiles
			}
		}
	}
	if ( mapItemsMemory(cell_show_x, cell_show_y) != 0 ) {
		locvar_cell_show_p = wpeek(mapItemsMemory(cell_show_x, cell_show_y), 0)
		locvar_cell_show_i = wpeek(mapItemsMemory(cell_show_x, cell_show_y), 2)
		gsel BUFFER_ITEM
		color 0
		boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_show_p), chipi(CHIPI_HEIGHT, locvar_cell_show_p) + 960
		if ( locvar_cell_show_p == 528 ) {
			gmode 2
			pos 0, 960
			gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
			pos 0, 1008
			gzoom 22, 20, 5, chipc(CHIPC_X, locvar_cell_show_i) + 8, chipc(CHIPC_Y, locvar_cell_show_i) + 4 + (chipc(CHIPC_HEIGHT, locvar_cell_show_i) > inf_tiles) * 8, chipc(CHIPC_WIDTH, locvar_cell_show_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_show_i) - 8 - (chipc(CHIPC_HEIGHT, locvar_cell_show_i) > inf_tiles) * 10, 1
			pos 6, 974
			gcopy BUFFER_ITEM, 0, 1008, 22, 20
			gsel selcur
		}
		else {
			if ( locvar_cell_show_p == 531 ) {
				pos 8, 1058 - chipc(CHIPC_HEIGHT, locvar_cell_show_i)
				gcopy BUFFER_CHR, chipc(CHIPC_X, locvar_cell_show_i) + 8, chipc(CHIPC_Y, locvar_cell_show_i) + 2, chipc(CHIPC_WIDTH, locvar_cell_show_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_show_i) - 8
				gmode 4, , , 150
				color 0, 0, 0
				pos 0, 960 + (chipc(CHIPC_HEIGHT, locvar_cell_show_i) == inf_tiles) * 48
				gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, locvar_cell_show_i) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, locvar_cell_show_i) + (chipc(CHIPC_HEIGHT, locvar_cell_show_i) > inf_tiles) * 48
				gmode 2
				gsel selcur
			}
			else {
				if ( locvar_cell_show_p == 529 ) {
					pos 0, 1056 - chipc(CHIPC_HEIGHT, locvar_cell_show_i)
					gcopy BUFFER_CHR, chipc(CHIPC_X, locvar_cell_show_i), chipc(CHIPC_Y, locvar_cell_show_i), chipc(CHIPC_WIDTH, locvar_cell_show_i), chipc(CHIPC_HEIGHT, locvar_cell_show_i)
					gmode 2
					gsel selcur
				}
				else {
					pos 0, 960
					gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_show_p), chipi(CHIPI_Y, locvar_cell_show_p), chipi(CHIPI_WIDTH, locvar_cell_show_p), chipi(CHIPI_HEIGHT, locvar_cell_show_p)
					gfini chipi(CHIPI_WIDTH, locvar_cell_show_p), chipi(CHIPI_HEIGHT, locvar_cell_show_p)
					gfdec2 c_col(0, locvar_cell_show_i), c_col(1, locvar_cell_show_i), c_col(2, locvar_cell_show_i)
					gsel selcur
				}
			}
		}
		if ( mType == MAP_TYPE_WORLD ) {
			gmode 2, chipi(CHIPI_WIDTH, locvar_cell_show_p), chipi(CHIPI_HEIGHT, locvar_cell_show_p)
			pos locvar_cell_show_dx + 24, locvar_cell_show_dy + 24
			grotate BUFFER_ITEM, 0, 960, 0, 24, 24
		}
		else {
			pos locvar_cell_show_dx, locvar_cell_show_dy - chipi(CHIPI_F, locvar_cell_show_p)
			if ( chipi(CHIPI_ANIM, locvar_cell_show_p) == 0 ) {
				gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_show_p), chipi(CHIPI_HEIGHT, locvar_cell_show_p)
			}
			else {
				gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_show_p) + scrturn \ chipi(CHIPI_ANIM, locvar_cell_show_p) * inf_tiles, chipi(CHIPI_Y, locvar_cell_show_p), chipi(CHIPI_WIDTH, locvar_cell_show_p), chipi(CHIPI_HEIGHT, locvar_cell_show_p)
			}
		}
	}
	if ( mapChara(cell_show_x, cell_show_y) != 0 ) {
		locvar_cell_show_c = mapChara(cell_show_x, cell_show_y) - 1
		if ( synccheck(locvar_cell_show_c, -1) ) {
			if ( cbit(CHARA_BIT_INVISIBLE, locvar_cell_show_c) == TRUE ) {
				if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == FALSE ) {
					if ( cWet(locvar_cell_show_c) == 0 ) {
						locvar_cell_show_c = 0
					}
				}
			}
			if ( locvar_cell_show_c != 0 ) {
				locvar_cell_show_col = getcharacolor(locvar_cell_show_c)
				locvar_cell_show_p = getcharapic(locvar_cell_show_c)
				gsel BUFFER_CHR
				color 0
				boxf 0, 960, chipc(CHIPC_WIDTH, locvar_cell_show_p), chipc(CHIPC_HEIGHT, locvar_cell_show_p) + 960
				pos 0, 960
				gcopy BUFFER_CHR, chipc(CHIPC_X, locvar_cell_show_p), chipc(CHIPC_Y, locvar_cell_show_p), chipc(CHIPC_WIDTH, locvar_cell_show_p), chipc(CHIPC_HEIGHT, locvar_cell_show_p)
				gfini chipc(CHIPC_WIDTH, locvar_cell_show_p), chipc(CHIPC_HEIGHT, locvar_cell_show_p)
				if ( cdata(268, locvar_cell_show_c) <= 0 ) {
					gfdec2 c_col(0, locvar_cell_show_col), c_col(1, locvar_cell_show_col), c_col(2, locvar_cell_show_col)
				}
				else {
					gfdec2 c_col(0, COLOR_BLACK), c_col(1, COLOR_BLACK), c_col(2, COLOR_BLACK)
				}
				gsel selcur
				if ( mType == MAP_TYPE_WORLD ) {
					gmode 4, 32, 16, 85
					color 0, 0, 0
					pos locvar_cell_show_dx + 24, locvar_cell_show_dy + 24
					grotate BUFFER_INF, 240, 384, 0, 20, 10
					gmode 2, chipc(CHIPC_WIDTH, locvar_cell_show_p), chipc(CHIPC_HEIGHT, locvar_cell_show_p)
					pos locvar_cell_show_dx + 24, locvar_cell_show_dy + 24 - chipc(CHIPC_F, locvar_cell_show_p) / 2
					grotate BUFFER_CHR, 0, 960, 0, 24, chipc(CHIPC_HEIGHT, locvar_cell_show_p) / 2
				}
				else {
					if ( chipm(CHIPM_ROLE, locvar_cell_show_ground) == MAP_CHIP_ROLE_WATER ) {
						gmode 4, inf_tiles, inf_tiles, 100
						color 0, 0, 0
						pos locvar_cell_show_dx, locvar_cell_show_dy + 16 - chipc(CHIPC_F, locvar_cell_show_p) - (chipm(CHIPM_ROLE, locvar_cell_show_ground) == MAP_CHIP_ROLE_WATER) * (-16)
						gcopy BUFFER_CHR, 0, 976, chipc(CHIPC_WIDTH, locvar_cell_show_p), chipc(CHIPC_HEIGHT, locvar_cell_show_p) - 16
						gmode 2, inf_tiles, inf_tiles
						pos locvar_cell_show_dx, locvar_cell_show_dy - chipc(CHIPC_F, locvar_cell_show_p) - (chipm(CHIPM_ROLE, locvar_cell_show_ground) == MAP_CHIP_ROLE_WATER) * (-16)
						gcopy BUFFER_CHR, 0, 960, chipc(CHIPC_WIDTH, locvar_cell_show_p), chipc(CHIPC_HEIGHT, locvar_cell_show_p) - 16
					}
					else {
						gmode 4, , , 110
						color 0, 0, 0
						pos locvar_cell_show_dx + 8, locvar_cell_show_dy + 20
						gcopy BUFFER_INF, 240, 384, 32, 16
						gmode 2, inf_tiles, inf_tiles
						pos locvar_cell_show_dx, locvar_cell_show_dy - chipc(CHIPC_F, locvar_cell_show_p) - (chipm(CHIPM_ROLE, locvar_cell_show_ground) == MAP_CHIP_ROLE_WATER) * (-16)
						gcopy BUFFER_CHR, 0, 960, chipc(CHIPC_WIDTH, locvar_cell_show_p), chipc(CHIPC_HEIGHT, locvar_cell_show_p)
					}
				}
				if ( cAngry(locvar_cell_show_c) != 0 ) {
					pos locvar_cell_show_dx + 12, locvar_cell_show_dy - chipc(CHIPC_F, locvar_cell_show_p) - 12
					gcopy BUFFER_INF, 32, 608, 16, 16
				}
				if ( cEmoIcon(locvar_cell_show_c) != 0 ) {
					draw_emo locvar_cell_show_c, locvar_cell_show_dx + 4, locvar_cell_show_dy - chipc(CHIPC_F, locvar_cell_show_p) - 16
				}
			}
		}
	}
	locvar_cell_show_sel = 2
	if ( locvar_cell_show_wall == 0 ) {
		if ( locvar_cell_show_ground != tile_fog ) {
			if ( cell_show_y > 0 ) {
				if ( locvar_cell_show_dy > 48 ) {
					locvar_cell_show_ground = mapId(cell_show_x, cell_show_y - 1)
					if ( chipm(CHIPM_WALL, locvar_cell_show_ground) ) {
						pos locvar_cell_show_dx + (locvar_cell_show_dx < 0) * (-locvar_cell_show_dx), locvar_cell_show_dy
						gfini inf_tiles - (locvar_cell_show_dx > windoww - inf_tiles) * (locvar_cell_show_dx + inf_tiles - windoww) + (locvar_cell_show_dx < 0) * locvar_cell_show_dx, 24
						gfdec2 35, 35, 35
						pos locvar_cell_show_dx + (locvar_cell_show_dx < 0) * (-locvar_cell_show_dx), locvar_cell_show_dy + 24
						gfini inf_tiles - (locvar_cell_show_dx > windoww - inf_tiles) * (locvar_cell_show_dx + inf_tiles - windoww) + (locvar_cell_show_dx < 0) * locvar_cell_show_dx, 12
						gfdec2 25, 25, 25
					}
				}
			}
		}
	}
	else {
		gmode 0
		if ( cell_show_y > 0 ) {
			locvar_cell_show_p = mapIdMemory(cell_show_x, cell_show_y - 1)
			if ( chipm(CHIPM_WALL, locvar_cell_show_p) == 2 ) {
			}
			else {
				if ( locvar_cell_show_p != tile_fog ) {
					if ( locvar_cell_show_dy > 20 ) {
						pos locvar_cell_show_dx, locvar_cell_show_dy - 12
						gcopy locvar_cell_show_sel, locvar_cell_show_ground \ 33 * inf_tiles, locvar_cell_show_ground / 33 * inf_tiles, inf_tiles - (locvar_cell_show_dx > windoww - inf_tiles) * (locvar_cell_show_dx + inf_tiles - windoww), 12
						pos locvar_cell_show_dx + (locvar_cell_show_dx < 0) * (-locvar_cell_show_dx), locvar_cell_show_dy - 20
						gfini inf_tiles - (locvar_cell_show_dx > windoww - inf_tiles) * (locvar_cell_show_dx + inf_tiles - windoww) + (locvar_cell_show_dx < 0) * locvar_cell_show_dx, 8
						gfdec2 25, 25, 25
					}
				}
			}
		}
	}
	gmode 2
	return

#deffunc cell_draw
	locvar_cell_draw_syfix = (scy != scybk) * syfix
	locvar_cell_draw_sxfix = (scx != scxbk) * sxfix
	locvar_cell_draw_scrturn = scrturn / 5
	if ( locvar_cell_draw_scrturn != locvar_cell_draw_scrturnbk ) {
		locvar_cell_draw_scrturnbk = locvar_cell_draw_scrturn
		locvar_cell_draw_scrturnnew = 1
	}
	else {
		locvar_cell_draw_scrturnnew = 0
	}
	locvar_cell_draw_light = gLight
	randomize locvar_cell_draw_scrturn
	if ( gLightSource == 1 ) {
		if ( mType >= (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) & mType <= (23 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_FORT]@!!! */) ) {
			locvar_cell_draw_light -= 50
		}
	}
	if ( gHour  > 17 | gHour  < 6 ) {
		locvar_cell_draw_flick = rnd(10)
	}
	else {
		locvar_cell_draw_flick = -15
	}
	repw(2) = repw(1)
	reph(2) = cY(CHARA_PLAYER) + (syfix < 0)
	reph(3) = reph(2) + 1
	if ( cY(CHARA_PLAYER) == mHeight - 2 ) {
		if ( syfix < 0 ) {
			reph(3)--
		}
	}
	if ( cY(CHARA_PLAYER) == mHeight - 1 ) {
		if ( syfix > 0 ) {
			reph(3)--
		}
	}
	locvar_cell_draw_dy = (reph(1) - scy) * inf_tiles + inf_screeny + locvar_cell_draw_syfix
	locvar_cell_draw_ly = 1
	repeat reph, reph(1)
		locvar_cell_draw_y = cnt
		locvar_cell_draw_dx = (repw(1) + repw - 1 - scx) * inf_tiles + inf_screenx + locvar_cell_draw_sxfix
		locvar_cell_draw_lx = 1
		if ( locvar_cell_draw_dy <= -inf_tiles | locvar_cell_draw_dy >= windowh - inf_verh ) {
			locvar_cell_draw_dy += inf_tiles
			locvar_cell_draw_lx++
			continue
		}
		if ( locvar_cell_draw_y < 0 | locvar_cell_draw_y >= mHeight ) {
			repeat inf_screenw, scx
				locvar_cell_draw_sx = cnt
				gmode 0, inf_tiles, inf_tiles
				locvar_cell_draw_p = tile_fog
				pos locvar_cell_draw_dx, locvar_cell_draw_dy
				gcopy BUFFER_MAP, locvar_cell_draw_p \ 33 * inf_tiles, locvar_cell_draw_p / 33 * inf_tiles
				locvar_cell_draw_dx -= inf_tiles
				locvar_cell_draw_lx++
			loop
			locvar_cell_draw_dy += inf_tiles
			locvar_cell_draw_ly++
			continue
		}
		color 0, 0, 0
		repeat repw
			locvar_cell_draw_x = repw(1) + repw - 1 - cnt
			if ( reph(3) == locvar_cell_draw_y ) {
				if ( locvar_cell_draw_x == repw(2) ) {
					locvar_cell_draw_px = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx - 48
					if ( scxbk == scx ) {
						locvar_cell_draw_px -= sxfix
					}
					locvar_cell_draw_py = (cY(CHARA_PLAYER) + 1 - scy) * inf_tiles + inf_screeny
					if ( scybk == scy ) {
						locvar_cell_draw_py -= syfix
					}
					if ( cExist(CHARA_PLAYER) == CHAR_STATE_ALIVE ) {
						color 0, 0, 0
						gmode 5, inf_tiles, inf_tiles, 50 + locvar_cell_draw_flick
						pos locvar_cell_draw_px, locvar_cell_draw_py
						gcopy BUFFER_INF, 800, 208, 144, 48
					}
				}
			}
			if ( reph(2) == locvar_cell_draw_y ) {
				if ( locvar_cell_draw_x == repw(2) ) {
					if ( cExist(CHARA_PLAYER) == CHAR_STATE_ALIVE ) {
						locvar_cell_draw_ground = mapId(cX(CHARA_PLAYER), cY(CHARA_PLAYER))
						locvar_cell_draw_px = (cX(CHARA_PLAYER) - scx) * inf_tiles + inf_screenx
						if ( scxbk == scx ) {
							locvar_cell_draw_px -= sxfix
						}
						locvar_cell_draw_py = (cY(CHARA_PLAYER) - scy) * inf_tiles + inf_screeny
						if ( scybk == scy ) {
							locvar_cell_draw_py -= syfix
						}
						color 0, 0, 0
						gmode 5, inf_tiles, inf_tiles, 50 + locvar_cell_draw_flick
						pos locvar_cell_draw_px - 48, locvar_cell_draw_py - 48
						gcopy BUFFER_INF, 800, 112, 144, 96
						if ( locvar_cell_draw_py < windowh - inf_verh - 24 ) {
							if ( cRowAct(CHARA_PLAYER) == ACTION_FISH ) {
								locvar_cell_draw_ani = 0
							}
							else {
								if ( cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) ) {
									cDir(CHARA_PLAYER) = 0
									locvar_cell_draw_ani = 0
								}
								else {
									locvar_cell_draw_ani = cTurn(CHARA_PLAYER) \ 4 * 32
								}
							}
							if ( mType == MAP_TYPE_WORLD ) {
								gmode 6, 32, 16, 85
								color 0, 0, 0
								pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 27
								grotate BUFFER_INF, 240, 384, 0, 20, 10
								gmode 2, 32, 48
								pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 14
								grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48, 0, 16, 24
							}
							else {
								if ( cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) ) {
									gmode 2, 48, 96, 80
									pos locvar_cell_draw_px + 26 - 11, locvar_cell_draw_py - 32 + 11
									func_1 1, 96, 816, -80, 48, 96
									pos locvar_cell_draw_px, locvar_cell_draw_py - 63
									gcopy BUFFER_ITEM, 96, 816, 48, 96
									locvar_cell_draw_py -= 24
								}
								if ( chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER & cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) == FALSE ) {
									gmode 4, 32, 20, 146
									color 0, 0, 0
									pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 36
									grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48 + 28, 0, 24 + cfg_graphicpc * 8, 16 + cfg_graphicpc * 4
									gmode 2, 32, 28
									pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 16
									grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48, 0, 24 + cfg_graphicpc * 8, 24 + cfg_graphicpc * 4
								}
								else {
									gmode 6, , , 110
									color 0, 0, 0
									pos locvar_cell_draw_px + 8, locvar_cell_draw_py + 20 + cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) * 24
									gcopy BUFFER_INF, 240, 384, 32, 16
									if ( fishanime == 3 ) {
										if ( fishanime(1) \ 8 < 4 ) {
											locvar_cell_draw_py -= fishanime(1) \ 4 * (fishanime(1) \ 4)
										}
										else {
											locvar_cell_draw_py += fishanime(1) \ 4 * (fishanime(1) \ 4) - 9
										}
									}
									gmode 2, 32, 48
									pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 8
									grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48, 0, 24 + cfg_graphicpc * 8, 40 + cfg_graphicpc * 8
								}
								if ( cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) ) {
									pos locvar_cell_draw_px, locvar_cell_draw_py
									gcopy BUFFER_ITEM, 96, 768, 48, 48
									locvar_cell_draw_py += 24
								}
							}
							gmode 2
							color 0, 0, 0
						}
						if ( cAngry(CHARA_PLAYER) != 0 ) {
							pos locvar_cell_draw_px, locvar_cell_draw_py - 24 - 24 * cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER)
							gcopy BUFFER_INF, 32, 608, 16, 16
						}
						if ( cEmoIcon(CHARA_PLAYER) != 0 ) {
							draw_emo 0, locvar_cell_draw_px + 4, locvar_cell_draw_py - 32 - 24 * cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER)
						}
					}
				}
			}
			if ( locvar_cell_draw_dx <= -inf_tiles | locvar_cell_draw_dx >= windoww ) {
				locvar_cell_draw_dx -= inf_tiles
				locvar_cell_draw_lx++
				continue
			}
			if ( locvar_cell_draw_x < 0 | locvar_cell_draw_x >= mWidth ) {
				gmode 0, inf_tiles, inf_tiles
				locvar_cell_draw_p = tile_fog
				pos locvar_cell_draw_dx, locvar_cell_draw_dy
				gcopy BUFFER_MAP, locvar_cell_draw_p \ 33 * inf_tiles, locvar_cell_draw_p / 33 * inf_tiles
				locvar_cell_draw_dx -= inf_tiles
				continue
			}
			locvar_cell_draw_ground = mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y)
			locvar_cell_draw_sel = 2
			gmode 0, inf_tiles, inf_tiles
			pos locvar_cell_draw_dx, locvar_cell_draw_dy
			locvar_cell_draw_wall = 0
			if ( chipm(CHIPM_WALL, locvar_cell_draw_ground) == 2 ) {
				if ( locvar_cell_draw_y < mHeight - 1 ) {
					if ( chipm(CHIPM_WALL, mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y + 1)) == 2 ) {
					}
					else {
						if ( mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y + 1) != tile_fog ) {
							locvar_cell_draw_ground += 33
						}
					}
				}
			}
			if ( chipm(CHIPM_WALL, locvar_cell_draw_ground) ) {
				locvar_cell_draw_wall = 1
			}
			if ( chipm(CHIPM_ANIM, locvar_cell_draw_ground) != 0 ) {
				gcopy locvar_cell_draw_sel, (locvar_cell_draw_ground \ 33 + (locvar_cell_draw_scrturn \ (chipm(CHIPM_ANIM, locvar_cell_draw_ground) + 1) - (locvar_cell_draw_scrturn \ (chipm(CHIPM_ANIM, locvar_cell_draw_ground) + 1) == chipm(CHIPM_ANIM, locvar_cell_draw_ground)) * 2 * (chipm(CHIPM_ANIM, locvar_cell_draw_ground) != 0))) * inf_tiles, locvar_cell_draw_ground / 33 * inf_tiles
			}
			else {
				gcopy locvar_cell_draw_sel, locvar_cell_draw_ground \ 33 * inf_tiles, locvar_cell_draw_ground / 33 * inf_tiles
			}
			gmode 2, inf_tiles, inf_tiles
			if ( mapFragment(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
					locvar_cell_draw_p = mapFragment(locvar_cell_draw_x, locvar_cell_draw_y) \ 10, mapFragment(locvar_cell_draw_x, locvar_cell_draw_y) / 10
					if ( locvar_cell_draw_p(1) ) {
						gcopy BUFFER_CHR, locvar_cell_draw_p(1) * inf_tiles + 288, 1152
					}
					if ( locvar_cell_draw_p ) {
						if ( locvar_cell_draw_p > 6 ) {
							locvar_cell_draw_p = 6
						}
						gcopy BUFFER_CHR, locvar_cell_draw_p * inf_tiles, 1152
					}
				}
			}
			if ( efmap(1, locvar_cell_draw_x, locvar_cell_draw_y) > 0 ) {
				if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
					locvar_cell_draw_p = efmap(0, locvar_cell_draw_x, locvar_cell_draw_y)
					if ( locvar_cell_draw_scrturnnew == 1 ) {
						efmap(1, locvar_cell_draw_x, locvar_cell_draw_y)--
					}
					if ( mefsubref(MEFSUBREF_TYPE, locvar_cell_draw_p) == 1 ) {
						gmode 4, 32, 32, efmap(1, locvar_cell_draw_x, locvar_cell_draw_y) * 12 + 30
						pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
						grotate BUFFER_INF, mefsubref(MEFSUBREF_X, locvar_cell_draw_p) + efmap(3, locvar_cell_draw_x, locvar_cell_draw_y) * 32, mefsubref(MEFSUBREF_Y, locvar_cell_draw_p), 0.785 * efmap(2, locvar_cell_draw_x, locvar_cell_draw_y), 32, 32
					}
					else {
						gmode 4, 32, 32, 150
						pos locvar_cell_draw_dx + 8, locvar_cell_draw_dy + 8
						gcopy BUFFER_INF, mefsubref(MEFSUBREF_X, locvar_cell_draw_p) + efmap(1, locvar_cell_draw_x, locvar_cell_draw_y) * 32, mefsubref(MEFSUBREF_Y, locvar_cell_draw_p)
					}
					gmode 2, inf_tiles, inf_tiles
				}
			}
			if ( mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				if ( mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y) == mapId(locvar_cell_draw_x, locvar_cell_draw_y) ) {
					locvar_cell_draw_p = mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) \ 1000
					if ( locvar_cell_draw_p != 999 & locvar_cell_draw_p != 0 ) {
						if ( mType == MAP_TYPE_WORLD ) {
							mapchip_preparepic locvar_cell_draw_x, locvar_cell_draw_y
							pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipm(CHIPM_F, locvar_cell_draw_p)
							gcopy 96, 0, 240, 48, 48
						}
						else {
							pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipm(CHIPM_F, locvar_cell_draw_p)
							gcopy BUFFER_MAP, locvar_cell_draw_p \ 33 * inf_tiles, locvar_cell_draw_p / 33 * inf_tiles, inf_tiles, 48 + chipm(CHIPM_H, locvar_cell_draw_p)
						}
					}
					if ( mType == MAP_TYPE_WORLD ) {
						locvar_cell_draw_p = mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) / 100000 \ 100 + mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) / 10000000 * 100
						if ( areaId(locvar_cell_draw_p) == AREA_RANDOM_DUNGEON ) {
							if ( areaDeepest(locvar_cell_draw_p) == areaCanSave(locvar_cell_draw_p) ) {
								pos locvar_cell_draw_dx + 16, locvar_cell_draw_dy - 16
								gcopy BUFFER_INF, 32, 624, 16, 16
							}
							else {
								if ( areaDeepest(locvar_cell_draw_p) != 0 ) {
									pos locvar_cell_draw_dx + 16, locvar_cell_draw_dy - 16
									gcopy BUFFER_INF, 48, 624, 16, 16
								}
							}
						}
					}
				}
			}
			if ( mapMef(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
					locvar_cell_draw_p2 = mapMef(locvar_cell_draw_x, locvar_cell_draw_y) - 1
					locvar_cell_draw_p = mefPic(locvar_cell_draw_p2) \ 10000, mefPic(locvar_cell_draw_p2) / 10000
					pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
					if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) ) {
						locvar_cell_draw_p += (locvar_cell_draw_scrturn + locvar_cell_draw_p2) \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - ((locvar_cell_draw_scrturn + locvar_cell_draw_p2) \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)
					}
					if ( mefPic(locvar_cell_draw_p2) > 10000 ) {
						gsel BUFFER_ITEM
						color 0
						boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
						if ( locvar_cell_draw_p == 528 ) {
							gmode 2
							pos 0, 960
							gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
							pos 0, 1008
							gzoom 22, 20, 5, chipc(CHIPC_X, locvar_cell_draw_p(1)) + 8, chipc(CHIPC_Y, locvar_cell_draw_p(1)) + 4 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 8, chipc(CHIPC_WIDTH, locvar_cell_draw_p(1)) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) - 8 - (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 10, 1
							pos 6, 974
							gcopy BUFFER_ITEM, 0, 1008, 22, 20
							gsel selcur
						}
						else {
							if ( locvar_cell_draw_p == 531 ) {
								pos 8, 1058 - chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1))
								gcopy BUFFER_CHR, chipc(CHIPC_X, locvar_cell_draw_p(1)) + 8, chipc(CHIPC_Y, locvar_cell_draw_p(1)) + 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p(1)) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) - 8
								gmode 4, , , 150
								color 0, 0, 0
								pos 0, 960 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) == inf_tiles) * 48
								gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 48
								gmode 2
								gsel selcur
							}
							else {
								if ( locvar_cell_draw_p == 529 ) {
									pos 0, 1056 - chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1))
									gcopy BUFFER_CHR, chipc(CHIPC_X, locvar_cell_draw_p(1)), chipc(CHIPC_Y, locvar_cell_draw_p(1)), chipc(CHIPC_WIDTH, locvar_cell_draw_p(1)), chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1))
									gmode 2
									gsel selcur
								}
								else {
									pos 0, 960
									gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									gfdec2 c_col(0, locvar_cell_draw_p(1)), c_col(1, locvar_cell_draw_p(1)), c_col(2, locvar_cell_draw_p(1))
									gsel selcur
								}
							}
						}
						gcopy BUFFER_ITEM, 0, 960, inf_tiles, inf_tiles
					}
					else {
						gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), inf_tiles, inf_tiles
					}
				}
			}
			if ( areaId(gArea ) == AREA_HOME | areaId(gArea ) == AREA_DUNGEON | areaId(gArea ) > 100 ) {
				if ( oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0) != 0 ) {
					if ( cfg_useffhp == 1 ) {
						preparepicitemexoom
						locvar_cell_draw_p = stat
						if ( cfg_objectshadow ) {
							if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
								gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 80
								if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
									pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22
									if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
										func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
								}
								else {
									pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46
									func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
								gmode 2
							}
						}
						pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
						if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
							gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
						}
						else {
							gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
						}
					}
					else {
						locvar_cell_draw_p = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 1)
						locvar_cell_draw_i = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 3)
						gsel BUFFER_ITEM
						color 0
						boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
						pos 0, 960
						gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
						gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
						gfdec2 c_col(0, locvar_cell_draw_i), c_col(1, locvar_cell_draw_i), c_col(2, locvar_cell_draw_i)
						gsel selcur
						if ( cfg_objectshadow ) {
							if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
								gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 80
								if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
									pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22
									if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
										func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
								}
								else {
									pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46
									func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
								gmode 2
							}
						}
						pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
						if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
							gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
						}
						else {
							gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
						}
					}
				}
			}


			if ( cfg_useffhp ) {
				if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
					if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) < 0 ) {
						if ( mode == MODELIST_SHOP | mode == MODELIST_TXT_ADV ) {
							locvar_cell_draw_i = 0
							locvar_cell_draw_p = 363
							preparepicitem_func locvar_cell_draw_p, locvar_cell_draw_i
							goto *skipitemDraw
						}
						else {
							locvar_cell_draw_p = -mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y)
							locvar_cell_draw_flooritem = locvar_cell_draw_p \ 1000 + 5080, locvar_cell_draw_p / 1000 \ 1000 + 5080, locvar_cell_draw_p / 1000000 \ 1000 + 5080
							locvar_cell_draw_stackh = 0
							repeat 3
								locvar_cell_draw_cnt2 = 2 - cnt
								if ( locvar_cell_draw_flooritem(locvar_cell_draw_cnt2) == 999 + 5080 ) {
									continue
								}
								preparepicitemex locvar_cell_draw_flooritem(locvar_cell_draw_cnt2)
								locvar_cell_draw_p = stat
								if ( mType == MAP_TYPE_WORLD ) {
									gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24 - locvar_cell_draw_stackh / 2
									grotate BUFFER_ITEM, 0, 960, 0, 24, 24
								}
								else {
									if ( cfg_objectshadow ) {
										if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
											gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 70
											if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
												pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22 - locvar_cell_draw_stackh
												if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
													func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
												}
											}
											else {
												pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46 - locvar_cell_draw_stackh
												func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
											}
											gmode 2
										}
									}
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) - locvar_cell_draw_stackh
									if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
										gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
									else {
										gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
								}
								locvar_cell_draw_stackh += chipi(CHIPI_S, locvar_cell_draw_p)
								if ( locvar_cell_draw_p == 531 | locvar_cell_draw_p == 529 ) {
									if ( chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == 96 ) {
										locvar_cell_draw_stackh += 44
									}
								}
							loop
						}
					}
					else {
						if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) == 363 | mode == MODELIST_SHOP | mode == MODELIST_TXT_ADV ) {
							locvar_cell_draw_p = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 0)
							locvar_cell_draw_i = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 2)
							preparepicitem_func locvar_cell_draw_p, locvar_cell_draw_i
						}
						else {
							if ( mapinv(locvar_cell_draw_x, locvar_cell_draw_y) != (-1) & mapinv(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
								preparepicitemex mapinv(locvar_cell_draw_x, locvar_cell_draw_y) - 1
								locvar_cell_draw_p = stat
							}
							else {
								locvar_cell_draw_p = -1
							}
						}
*skipitemDraw
						if ( locvar_cell_draw_p != (-1) ) {
							if ( mType == MAP_TYPE_WORLD ) {
								gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
								grotate BUFFER_ITEM, 0, 960, 0, 24, 24
							}
							else {
								if ( cfg_objectshadow ) {
									if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
										gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 80
										if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
											pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22
											if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
												func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
											}
										}
										else {
											pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46
											func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										}
										gmode 2
									}
								}
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
								if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
									gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
								else {
									gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
							}
						}
					}
				}
			}
			else {
				if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
					if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) < 0 ) {
						if ( mode == MODELIST_SHOP | mode == MODELIST_TXT_ADV ) {
							locvar_cell_draw_i = 0
							locvar_cell_draw_p = 363
							goto *label_1154
						}
						locvar_cell_draw_p = -mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y)
						locvar_cell_draw_flooritem = locvar_cell_draw_p \ 1000 + 5080, locvar_cell_draw_p / 1000 \ 1000 + 5080, locvar_cell_draw_p / 1000000 \ 1000 + 5080
						locvar_cell_draw_stackh = 0
						repeat 3
							locvar_cell_draw_cnt2 = 2 - cnt
							if ( locvar_cell_draw_flooritem(locvar_cell_draw_cnt2) == 999 + 5080 ) {
								continue
							}
							locvar_cell_draw_p = iPic(locvar_cell_draw_flooritem(locvar_cell_draw_cnt2))
							locvar_cell_draw_i = iCol(locvar_cell_draw_flooritem(locvar_cell_draw_cnt2))
							gsel BUFFER_ITEM
							color 0
							boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
							if ( locvar_cell_draw_p == 528 ) {
								gmode 2
								pos 0, 960
								gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
								pos 0, 1008
								gzoom 22, 20, 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 4 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 8, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8 - (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 10, 1
								pos 6, 974
								gcopy BUFFER_ITEM, 0, 1008, 22, 20
								gsel selcur
							}
							else {
								if ( locvar_cell_draw_p == 531 ) {
									pos 8, 1058 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
									gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 2, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8
									gmode 4, , , 150
									color 0, 0, 0
									pos 0, 960 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == inf_tiles) * 48
									gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48
									gmode 2
									gsel selcur
								}
								else {
									if ( locvar_cell_draw_p == 529 ) {
										pos 0, 1056 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
										gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i), chipc(CHIPC_Y, locvar_cell_draw_i), chipc(CHIPC_WIDTH, locvar_cell_draw_i), chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
										gmode 2
										gsel selcur
									}
									else {
										pos 0, 960
										gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										gfdec2 c_col(0, locvar_cell_draw_i), c_col(1, locvar_cell_draw_i), c_col(2, locvar_cell_draw_i)
										gsel selcur
									}
								}
							}
							if ( mType == MAP_TYPE_WORLD ) {
								gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24 - locvar_cell_draw_stackh / 2
								grotate BUFFER_ITEM, 0, 960, 0, 24, 24
							}
							else {
								if ( cfg_objectshadow ) {
									if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
										gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 70
										if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
											pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22 - locvar_cell_draw_stackh
											if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
												func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
											}
										}
										else {
											pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46 - locvar_cell_draw_stackh
											func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										}
										gmode 2
									}
								}
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) - locvar_cell_draw_stackh
								if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
									gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
								else {
									gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
							}
							locvar_cell_draw_stackh += chipi(CHIPI_S, locvar_cell_draw_p)
							if ( locvar_cell_draw_p == 531 | locvar_cell_draw_p == 529 ) {
								if ( chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == 96 ) {
									locvar_cell_draw_stackh += 44
								}
							}
						loop
					}
					else {
						locvar_cell_draw_i = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 2)
						locvar_cell_draw_p = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 0)
*label_1154
						gsel BUFFER_ITEM
						color 0
						boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
						if ( locvar_cell_draw_p == 528 ) {
							gmode 2
							pos 0, 960
							gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
							pos 0, 1008
							gzoom 22, 20, 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 4 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 8, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8 - (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 10, 1
							pos 6, 974
							gcopy BUFFER_ITEM, 0, 1008, 22, 20
							gsel selcur
						}
						else {
							if ( locvar_cell_draw_p == 531 ) {
								pos 8, 1058 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
								gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 2, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8
								gmode 4, , , 150
								color 0, 0, 0
								pos 0, 960 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == inf_tiles) * 48
								gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48
								gmode 2
								gsel selcur
							}
							else {
								if ( locvar_cell_draw_p == 529 ) {
									pos 0, 1056 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
									gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i), chipc(CHIPC_Y, locvar_cell_draw_i), chipc(CHIPC_WIDTH, locvar_cell_draw_i), chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
									gmode 2
									gsel selcur
								}
								else {
									pos 0, 960
									gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									gfdec2 c_col(0, locvar_cell_draw_i), c_col(1, locvar_cell_draw_i), c_col(2, locvar_cell_draw_i)
									gsel selcur
								}
							}
						}
						if ( mType == MAP_TYPE_WORLD ) {
							gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
							grotate BUFFER_ITEM, 0, 960, 0, 24, 24
						}
						else {
							if ( cfg_objectshadow ) {
								if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
									gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 80
									if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
										pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22
										if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
											func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										}
									}
									else {
										pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46
										func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
									gmode 2
								}
							}
							pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
							if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
								gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							}
							else {
								gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							}
						}
					}
				}
			}
			if ( mapChara(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				locvar_cell_draw_c = mapChara(locvar_cell_draw_x, locvar_cell_draw_y) - 1
				if ( synccheck(locvar_cell_draw_c, -1) ) {
					if ( cbit(CHARA_BIT_INVISIBLE, locvar_cell_draw_c) == TRUE ) {
						if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == FALSE ) {
							if ( cWet(locvar_cell_draw_c) == 0 ) {
								locvar_cell_draw_c = 0
							}
						}
					}
					if ( locvar_cell_draw_c != 0 ) {
						if ( cbit(CHARA_BIT_PCC, locvar_cell_draw_c) == TRUE ) {
							if ( cfg_npcwalk == 1 ) {
								locvar_cell_draw_ani = cTurn(locvar_cell_draw_c) \ 4 * 32
							}
							if ( mType == MAP_TYPE_WORLD ) {
								gmode 6, 32, 16, 85
								color 0, 0, 0
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 27
								grotate BUFFER_INF, 240, 384, 0, 20, 10
								gmode 2, 32, 48
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 14
								grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48, 0, 16, 24
							}
							else {
								if ( chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER ) {
									gmode 4, 32, 20, 146
									color 0, 0, 0
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 36
									grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48 + 28, 0, 24 + cfg_graphicnpc * 8, 16 + cfg_graphicnpc * 4
									gmode 2, 32, 28
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 16
									grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48, 0, 24 + cfg_graphicnpc * 8, 24 + cfg_graphicnpc * 4
								}
								else {
									gmode 6, , , 110
									color 0, 0, 0
									pos locvar_cell_draw_dx + 8, locvar_cell_draw_dy + 20
									gcopy BUFFER_INF, 240, 384, 32, 16
									gmode 2, 32, 48
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 8
									grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48, 0, 24 + cfg_graphicnpc * 8, 40 + cfg_graphicnpc * 8
								}
							}
							gmode 2
							color 0, 0, 0
							if ( cAngry(locvar_cell_draw_c) != 0 ) {
								pos locvar_cell_draw_dx + 12, locvar_cell_draw_dy - 28
								gcopy BUFFER_INF, 32, 608, 16, 16
							}
							if ( cRole(locvar_cell_draw_c) >= (1000 /*!!!@[ROLE_SHOP_MIN @@@ ROLE_SHOP_WEAPON]@!!! */) & cRole(locvar_cell_draw_c) < (2000 /*!!!@[ROLE_GUEST_BEGGAR @@@ ROLE_GUEST_MIN]@!!! */) | cRole(locvar_cell_draw_c) == ROLE_GUEST_MERCHANT | cRole(locvar_cell_draw_c) == ROLE_SHOP_MATERIAL | cRole(locvar_cell_draw_c) == ROLE_SHOP_SPELLBOOK | cRole(locvar_cell_draw_c) == ROLE_SHOP_APHRODISIAC | cRole(locvar_cell_draw_c) == ROLE_SHOP_DOUJINSHI | cRole(locvar_cell_draw_c) == ROLE_SHOP_UNKNOWN3104 | cRole(locvar_cell_draw_c) == ROLE_SHOP_HERB_MERCHANT | cRole(locvar_cell_draw_c) == ROLE_SHOP_PROSTITUTE_GUILD | cRole(locvar_cell_draw_c) == ROLE_SHOP_BLACKSMITH_GUILD | cRole(locvar_cell_draw_c) == ROLE_SHOP_MYSTERIOUS_PRODUCER | cRole(locvar_cell_draw_c) == ROLE_SHOP_FAIRY | cRole(locvar_cell_draw_c) == ROLE_SHOP_MORPHY ) {
								if ( getgametime() <= cRoleRestock(locvar_cell_draw_c) ) {
									pos locvar_cell_draw_dx + 12, locvar_cell_draw_dy - 28 - 26 * cbit(CHARA_BIT_SANDBAG, locvar_cell_draw_c)
									gcopy BUFFER_INF, 32 + 19 * 16, 608, 16, 16
								}
							}
							if ( cEmoIcon(locvar_cell_draw_c) != 0 ) {
								draw_emo locvar_cell_draw_c, locvar_cell_draw_dx + 4, locvar_cell_draw_dy - 32
							}
						}
						else {
							locvar_cell_draw_col = getcharacolor(locvar_cell_draw_c)
							locvar_cell_draw_p = getcharapic(locvar_cell_draw_c)
							if ( cbit(CHARA_BIT_SANDBAG, locvar_cell_draw_c) ) {
								gmode 2, 48, 96, 80
								pos locvar_cell_draw_dx + 26 - 11, locvar_cell_draw_dy - 32 + 11
								func_1 1, 96, 816, -80, 48, 96
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - 63
								gcopy BUFFER_ITEM, 96, 816, 48, 96
								chipc(CHIPC_F, locvar_cell_draw_p) += 24
							}
							if ( cdata(268, locvar_cell_draw_c) <= 0 ) {
								chara_preparepic locvar_cell_draw_p, locvar_cell_draw_col
							}
							else {
								chara_preparepic locvar_cell_draw_p, 7
							}
							transmissivity = 0
							dropshadowtype = 0
							if ( cId(locvar_cell_draw_c) == CREATURE_ID_USER ) {
								if ( userdata2(1, cUNID(locvar_cell_draw_c)) ) {
									transmissivity = userdata2(1, cUNID(locvar_cell_draw_c))
								}
								if ( userdata2(2, cUNID(locvar_cell_draw_c)) ) {
									dropshadowtype = userdata2(2, cUNID(locvar_cell_draw_c))
								}
							}
							if ( ocChipTransparency(locvar_cell_draw_c) ) {
								transmissivity = ocChipTransparency(locvar_cell_draw_c)
							}
							if ( ocShadowType(locvar_cell_draw_c) ) {
								dropshadowtype = ocShadowType(locvar_cell_draw_c)
							}
							if ( mType == MAP_TYPE_WORLD ) {
								if ( dropshadowtype == 0 ) {
									gmode 6, 32, 16, 85
									color 0, 0, 0
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 32
									grotate BUFFER_INF, 240, 384, 0, 20, 10
								}
								else {
									if ( dropshadowtype != (-1) ) {
										gmode 6, 32, 16, 85
										color 0, 0, 0
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 32
										grotate BUFFER_INF, 240, 384, 0, 20, 10
									}
								}
								gmode 4, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p), 256 - transmissivity
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24 - chipc(CHIPC_F, locvar_cell_draw_p) / 4
								grotate BUFFER_CHR, 0, 960, 0, 24, chipc(CHIPC_HEIGHT, locvar_cell_draw_p) / 2
								gmode 2
								if ( cEmoIcon(locvar_cell_draw_c) != 0 ) {
									draw_emo locvar_cell_draw_c, locvar_cell_draw_dx + 4, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) / 4 - 16
								}
							}
							else {
								if ( chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER ) {
									if ( dropshadowtype ) {
										if ( dropshadowtype != (-1) ) {
											if ( cfg_objectshadow ) {
												gmode 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p), 70
												if ( chipc(CHIPC_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
													pos locvar_cell_draw_dx + chipc(CHIPC_WIDTH, locvar_cell_draw_p) / 2 + dropshadowtype / 80 + 2, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) + 22 - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
													if ( chipc(CHIPC_F, locvar_cell_draw_p) < 24 ) {
														func_1 5, 0, 960, dropshadowtype / 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
													}
												}
												else {
													pos locvar_cell_draw_dx + chipc(CHIPC_WIDTH, locvar_cell_draw_p) / 2 + dropshadowtype / 4, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) + 46 - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
													func_1 5, 0, 960, dropshadowtype * 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
												}
												gmode 2
											}
										}
									}
									gmode 4, inf_tiles, inf_tiles, 100 - limit(transmissivity * 4 / 10, 0, 100)
									color 0, 0, 0
									pos locvar_cell_draw_dx, locvar_cell_draw_dy + 16 - chipc(CHIPC_F, locvar_cell_draw_p) - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
									gcopy BUFFER_CHR, 0, 976, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p) - 16
									gmode 4, inf_tiles, inf_tiles, 256 - transmissivity
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
									gcopy BUFFER_CHR, 0, 960, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p) - 16
									gmode 2
								}
								else {
									if ( dropshadowtype == 0 ) {
										gmode 6, , , 110
										color 0, 0, 0
										pos locvar_cell_draw_dx + 8, locvar_cell_draw_dy + 20
										gcopy BUFFER_INF, 240, 384, 32, 16
									}
									else {
										if ( dropshadowtype != (-1) ) {
											if ( cfg_objectshadow ) {
												gmode 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p), 70
												if ( chipc(CHIPC_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
													pos locvar_cell_draw_dx + chipc(CHIPC_WIDTH, locvar_cell_draw_p) / 2 + dropshadowtype / 80 + 2, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) + 22
													if ( chipc(CHIPC_F, locvar_cell_draw_p) < 24 ) {
														func_1 5, 0, 960, dropshadowtype / 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
													}
												}
												else {
													pos locvar_cell_draw_dx + chipc(CHIPC_WIDTH, locvar_cell_draw_p) / 2 + dropshadowtype / 4, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) + 46
													func_1 5, 0, 960, dropshadowtype * 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
												}
												gmode 2
											}
										}
									}
									gmode 4, inf_tiles, inf_tiles, 256 - transmissivity
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
									gcopy BUFFER_CHR, 0, 960, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
									gmode 2
								}
								if ( cAngry(locvar_cell_draw_c) != 0 ) {
									pos locvar_cell_draw_dx + 12, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - 12
									gcopy BUFFER_INF, 32, 608, 16, 16
								}
								if ( cRole(locvar_cell_draw_c) >= (1000 /*!!!@[ROLE_SHOP_MIN @@@ ROLE_SHOP_WEAPON]@!!! */) & cRole(locvar_cell_draw_c) < (2000 /*!!!@[ROLE_GUEST_BEGGAR @@@ ROLE_GUEST_MIN]@!!! */) | cRole(locvar_cell_draw_c) == ROLE_GUEST_MERCHANT | cRole(locvar_cell_draw_c) == ROLE_SHOP_MATERIAL | cRole(locvar_cell_draw_c) == ROLE_SHOP_SPELLBOOK | cRole(locvar_cell_draw_c) == ROLE_SHOP_APHRODISIAC | cRole(locvar_cell_draw_c) == ROLE_SHOP_DOUJINSHI | cRole(locvar_cell_draw_c) == ROLE_SHOP_UNKNOWN3104 | cRole(locvar_cell_draw_c) == ROLE_SHOP_HERB_MERCHANT | cRole(locvar_cell_draw_c) == ROLE_SHOP_PROSTITUTE_GUILD | cRole(locvar_cell_draw_c) == ROLE_SHOP_BLACKSMITH_GUILD | cRole(locvar_cell_draw_c) == ROLE_SHOP_MYSTERIOUS_PRODUCER | cRole(locvar_cell_draw_c) == ROLE_SHOP_FAIRY | cRole(locvar_cell_draw_c) == ROLE_SHOP_MORPHY ) {
									if ( getgametime() >= cRoleRestock(locvar_cell_draw_c) ) {
										pos locvar_cell_draw_dx + 12, locvar_cell_draw_dy - 28 - 26 * cbit(CHARA_BIT_SANDBAG, locvar_cell_draw_c)
										gcopy BUFFER_INF, 32 + 19 * 16, 608, 16, 16
									}
								}
								if ( cEmoIcon(locvar_cell_draw_c) != 0 ) {
									draw_emo locvar_cell_draw_c, locvar_cell_draw_dx + 4, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - 16
								}
								if ( cRole(locvar_cell_draw_c) == ROLE_ADVENTURER ) {
									if ( ocAdvParty(locvar_cell_draw_c) == 0 ) {
										if ( cbit(CHARA_BIT_HIRED, locvar_cell_draw_c) ) {
											draw_drawadventurerleadername cnName(CHARA_PLAYER), 2
										}
										else {
											draw_drawadventurerleadername lang("p[eB", "No Party")
										}
									}
									else {
										if ( ocAdvParty(locvar_cell_draw_c) == locvar_cell_draw_c ) {
											draw_drawadventurerleadername cnName(ocAdvParty(locvar_cell_draw_c)), 1
										}
										else {
											draw_drawadventurerleadername cnName(ocAdvParty(locvar_cell_draw_c))
										}
									}
								}
							}
							if ( cbit(CHARA_BIT_SANDBAG, locvar_cell_draw_c) ) {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - 26
								gcopy BUFFER_ITEM, 96, 768, 48, 48
								chipc(CHIPC_F, locvar_cell_draw_p) -= 24
							}
						}
						if ( cbit(CHARA_BIT_STETHOSCOPE, locvar_cell_draw_c) == TRUE | gScope == locvar_cell_draw_c ) {
							locvar_cell_draw_h = cHP(locvar_cell_draw_c) * 30 / cMHP(locvar_cell_draw_c)
							if ( locvar_cell_draw_h > 30 ) {
								locvar_cell_draw_h = 30
							}
							if ( locvar_cell_draw_c < 16 ) {
								if ( mType != MAP_TYPE_WORLD ) {
									pos locvar_cell_draw_dx + 9, locvar_cell_draw_dy + 32
									gcopy BUFFER_INF, 480 - locvar_cell_draw_h, 517, locvar_cell_draw_h, 3
								}
							}
							else {
								pos locvar_cell_draw_dx + 9, locvar_cell_draw_dy + 32
								gcopy BUFFER_INF, 480 - locvar_cell_draw_h, 513, locvar_cell_draw_h, 3
							}
						}
					}
				}
			}
			if ( areaId(gArea ) == AREA_HOME | areaId(gArea ) == AREA_DUNGEON | areaId(gArea ) > 100 ) {
				if ( oommap(locvar_cell_draw_x, locvar_cell_draw_y, 4) != 0 ) {
					locvar_cell_draw_p = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 4)
					if ( gHour  > 17 | gHour  < 6 | lightdata(LIGHTDATA_TIME, locvar_cell_draw_p) ) {
						if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
							locvar_cell_draw_light -= (6 - limit(dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), locvar_cell_draw_x, locvar_cell_draw_y), 0, 6)) * lightdata(LIGHTDATA_POWER, locvar_cell_draw_p)
							pos locvar_cell_draw_dx, locvar_cell_draw_dy - lightdata(LIGHTDATA_Y, locvar_cell_draw_p)
							gmode 5, inf_tiles, inf_tiles, lightdata(LIGHTDATA_BRIGHT, locvar_cell_draw_p) + rnd(lightdata(LIGHTDATA_FLICK, locvar_cell_draw_p) + 1)
							gcopy BUFFER_INF, 192 + lightdata(LIGHTDATA_PIC, locvar_cell_draw_p) * 48 + rnd(lightdata(LIGHTDATA_ANIM, locvar_cell_draw_p) + 1) * inf_tiles, 704
						}
					}
				}
			}
			if ( mapLight(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				locvar_cell_draw_p = mapLight(locvar_cell_draw_x, locvar_cell_draw_y)
				if ( gHour  > 17 | gHour  < 6 | lightdata(LIGHTDATA_TIME, locvar_cell_draw_p) ) {
					if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
						locvar_cell_draw_light -= (6 - limit(dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), locvar_cell_draw_x, locvar_cell_draw_y), 0, 6)) * lightdata(LIGHTDATA_POWER, locvar_cell_draw_p)
						pos locvar_cell_draw_dx, locvar_cell_draw_dy - lightdata(LIGHTDATA_Y, locvar_cell_draw_p)
						gmode 5, inf_tiles, inf_tiles, lightdata(LIGHTDATA_BRIGHT, locvar_cell_draw_p) + rnd(lightdata(LIGHTDATA_FLICK, locvar_cell_draw_p) + 1)
						gcopy BUFFER_INF, 192 + lightdata(LIGHTDATA_PIC, locvar_cell_draw_p) * 48 + rnd(lightdata(LIGHTDATA_ANIM, locvar_cell_draw_p) + 1) * inf_tiles, 704
					}
				}
			}
			if ( mapChara(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				locvar_cell_draw_c = mapChara(locvar_cell_draw_x, locvar_cell_draw_y) - 1
				locvar_cell_draw_p = ocLight(locvar_cell_draw_c)
				if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
					locvar_cell_draw_light -= (6 - limit(dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), locvar_cell_draw_x, locvar_cell_draw_y), 0, 6)) * lightdata(LIGHTDATA_POWER, locvar_cell_draw_p)
					pos locvar_cell_draw_dx, locvar_cell_draw_dy - lightdata(LIGHTDATA_Y, locvar_cell_draw_p)
					gmode 5, inf_tiles, inf_tiles, lightdata(LIGHTDATA_BRIGHT, locvar_cell_draw_p) + rnd(lightdata(LIGHTDATA_FLICK, locvar_cell_draw_p) + 1)
					gcopy BUFFER_INF, 192 + lightdata(LIGHTDATA_PIC, locvar_cell_draw_p) * 48 + rnd(lightdata(LIGHTDATA_ANIM, locvar_cell_draw_p) + 1) * inf_tiles, 704
				}
			}
			if ( locvar_cell_draw_wall == 0 ) {
				if ( locvar_cell_draw_ground != tile_fog ) {
					if ( locvar_cell_draw_y > 0 ) {
						if ( locvar_cell_draw_dy > 48 ) {
							locvar_cell_draw_ground = mapId(locvar_cell_draw_x, locvar_cell_draw_y - 1)
							if ( chipm(CHIPM_WALL, locvar_cell_draw_ground) ) {
								pos locvar_cell_draw_dx + (locvar_cell_draw_dx < 0) * (-locvar_cell_draw_dx), locvar_cell_draw_dy
								gfini inf_tiles - (locvar_cell_draw_dx > windoww - inf_tiles) * (locvar_cell_draw_dx + inf_tiles - windoww) + (locvar_cell_draw_dx < 0) * locvar_cell_draw_dx, 24
								gfdec2 16, 16, 16
								pos locvar_cell_draw_dx + (locvar_cell_draw_dx < 0) * (-locvar_cell_draw_dx), locvar_cell_draw_dy + 24
								gfini inf_tiles - (locvar_cell_draw_dx > windoww - inf_tiles) * (locvar_cell_draw_dx + inf_tiles - windoww) + (locvar_cell_draw_dx < 0) * locvar_cell_draw_dx, 12
								gfdec2 12, 12, 12
							}
						}
					}
				}
			}
			else {
				gmode 0
				if ( locvar_cell_draw_y > 0 ) {
					locvar_cell_draw_p = mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y - 1)
					if ( chipm(CHIPM_WALL, locvar_cell_draw_p) == 2 ) {
					}
					else {
						if ( locvar_cell_draw_p != tile_fog ) {
							if ( locvar_cell_draw_dy > 20 ) {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - 12
								gcopy locvar_cell_draw_sel, locvar_cell_draw_ground \ 33 * inf_tiles, locvar_cell_draw_ground / 33 * inf_tiles, inf_tiles - (locvar_cell_draw_dx > windoww - inf_tiles) * (locvar_cell_draw_dx + inf_tiles - windoww), 12
								pos locvar_cell_draw_dx + (locvar_cell_draw_dx < 0) * (-locvar_cell_draw_dx), locvar_cell_draw_dy - 20
								gfini inf_tiles - (locvar_cell_draw_dx > windoww - inf_tiles) * (locvar_cell_draw_dx + inf_tiles - windoww) + (locvar_cell_draw_dx < 0) * locvar_cell_draw_dx, 8
								gfdec2 25, 25, 25
							}
						}
					}
				}
			}
			locvar_cell_draw_dx -= inf_tiles
			locvar_cell_draw_lx++
		loop
		locvar_cell_draw_dy += inf_tiles
		locvar_cell_draw_ly++
	loop
	if ( locvar_cell_draw_light < 25 ) {
		locvar_cell_draw_light = 25
	}
	if ( mType == MAP_TYPE_WORLD ) {
		repeat 12
			gmode 5, , , 7 + cnt * 2
			locvar_cell_draw_x = (cloud(CLOUD_X, cnt) - cX(CHARA_PLAYER) * 48 + sxfix) * 100 / (40 + cnt * 5) + scrturn * 100 / (50 + cnt * 20)
			locvar_cell_draw_y = (cloud(CLOUD_Y, cnt) - cY(CHARA_PLAYER) * 48 + syfix) * 100 / (40 + cnt * 5)
			locvar_cell_draw_x = locvar_cell_draw_x \ (windoww + cloud(CLOUD_WIDTH, cnt)) - cloud(CLOUD_WIDTH, cnt)
			locvar_cell_draw_y = locvar_cell_draw_y \ (inf_very + cloud(CLOUD_HEIGHT, cnt)) - cloud(CLOUD_HEIGHT, cnt)
			locvar_cell_draw_h = cloud(CLOUD_HEIGHT, cnt)
			if ( locvar_cell_draw_y + cloud(CLOUD_HEIGHT, cnt) >= inf_very ) {
				locvar_cell_draw_h = inf_very - locvar_cell_draw_y
			}
			if ( locvar_cell_draw_y < inf_very ) {
				pos locvar_cell_draw_x, locvar_cell_draw_y
				gcopy BUFFER_MAP, cloud(CLOUD_PX, cnt), cloud(CLOUD_PY, cnt), cloud(CLOUD_WIDTH, cnt), locvar_cell_draw_h
			}
		loop
	}
	if ( cfg_shadow != 0 ) {
		color 0, 0, 0
		gmode 6, inf_tiles, inf_tiles, locvar_cell_draw_light
		locvar_cell_draw_y = 2
		locvar_cell_draw_dy = inf_screeny
		repeat inf_screenh
			locvar_cell_draw_x = 2
			locvar_cell_draw_dx = inf_screenx
			repeat inf_screenw
				if ( slight(locvar_cell_draw_x, locvar_cell_draw_y) >= 1000 ) {
					pos locvar_cell_draw_dx, locvar_cell_draw_dy
					gcopy BUFFER_INF, 144, 752
				}
				locvar_cell_draw_x++
				locvar_cell_draw_dx += inf_tiles
			loop
			locvar_cell_draw_y++
			locvar_cell_draw_dy += inf_tiles
		loop
		grayscaletheworld
		gmode 2
		randomize
		return
	}
	gmode 6, inf_tiles, inf_tiles, locvar_cell_draw_light
	if ( scrollanime == 0 ) {
		locvar_cell_draw_y = 2
		locvar_cell_draw_dy = inf_screeny + locvar_cell_draw_syfix * (scrollp > 3 + cfg_improvescroll * 2)
		repeat inf_screenh
			locvar_cell_draw_x = 2
			locvar_cell_draw_dx = inf_screenx + locvar_cell_draw_sxfix * (scrollp > 3 + cfg_improvescroll * 2)
			locvar_cell_draw_cnt2 = cnt
			repeat inf_screenw
				locvar_cell_draw_p = slight(locvar_cell_draw_x, locvar_cell_draw_y)
				if ( locvar_cell_draw_p > 0 ) {
					if ( locvar_cell_draw_p < 300 ) {
						repeat 1 + (deco(2, locvar_cell_draw_p) != 0)
							if ( deco(0, locvar_cell_draw_p) < 0 | cnt ) {
								if ( cnt == 1 ) {
									deco2 = deco(2, locvar_cell_draw_p)
								}
								else {
									deco2 = deco(1, locvar_cell_draw_p)
								}
								repeat 1
									if ( deco2 == 1 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 2 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										break
									}
									if ( deco2 == 3 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										break
									}
									if ( deco2 == 4 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 5 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 6 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 7 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										break
									}
									if ( deco2 == 8 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 9 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										break
									}
									if ( deco2 == 10 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										break
									}
									if ( deco2 == 20 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656 + 48, 24, 48
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 120, 656 + 48, 24, 48
										break
									}
									if ( deco2 == 21 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 48, 656, 48, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 48, 656 + 120, 48, 24
										break
									}
									if ( deco2 == 30 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656, 48, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0, 656 + 120, 48, 24
										break
									}
									if ( deco2 == 31 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 96, 656, 48, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 96, 656 + 120, 48, 24
										break
									}
									if ( deco2 == 32 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656, 24, 48
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 120, 656, 24, 48
										break
									}
									if ( deco2 == 33 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656 + 96, 24, 48
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 120, 656 + 96, 24, 48
										break
									}
								loop
							}
							else {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy
								gcopy BUFFER_INF, 0 + deco(0, locvar_cell_draw_p) * inf_tiles, 656 + deco(1, locvar_cell_draw_p) * inf_tiles
							}
						loop
					}
					else {
						locvar_cell_draw_p2 = (locvar_cell_draw_p - 1000) \ 16
						locvar_cell_draw_i = 0
						if ( locvar_cell_draw_p2 == 15 ) {
							locvar_cell_draw_p2 = (locvar_cell_draw_p - 1000) \ 256
							if ( locvar_cell_draw_p2 == 127 ) {
								locvar_cell_draw_i = 13
							}
							if ( locvar_cell_draw_p2 == 223 ) {
								locvar_cell_draw_i = 14
							}
							if ( locvar_cell_draw_p2 == 191 ) {
								locvar_cell_draw_i = 15
							}
							if ( locvar_cell_draw_p2 == 239 ) {
								locvar_cell_draw_i = 16
							}
							if ( locvar_cell_draw_p2 == 207 | locvar_cell_draw_p2 == 63 ) {
								locvar_cell_draw_i = 17
							}
						}
						else {
							locvar_cell_draw_i = shadowmap(locvar_cell_draw_p2)
						}
						pos locvar_cell_draw_dx, locvar_cell_draw_dy
						gcopy BUFFER_INF, 144 + locvar_cell_draw_i * inf_tiles, 752
					}
				}
				locvar_cell_draw_x++
				locvar_cell_draw_dx += inf_tiles
			loop
			locvar_cell_draw_y++
			locvar_cell_draw_dy += inf_tiles
		loop
	}
	else {
		locvar_cell_draw_f = 0
		if ( scrollp > 3 + cfg_improvescroll * 2 | mType == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
			locvar_cell_draw_f = 1
		}
		locvar_cell_draw_y = 1
		locvar_cell_draw_dy = inf_screeny + locvar_cell_draw_syfix * locvar_cell_draw_f - 48
		repeat inf_screenh + 2
			if ( locvar_cell_draw_dy <= -inf_tiles | locvar_cell_draw_dy >= windowh - inf_verh ) {
				locvar_cell_draw_dy += inf_tiles
				locvar_cell_draw_y++
				continue
			}
			locvar_cell_draw_x = 1
			locvar_cell_draw_dx = inf_screenx + locvar_cell_draw_sxfix * locvar_cell_draw_f - 48
			repeat inf_screenw + 2
				locvar_cell_draw_p = slight(locvar_cell_draw_x, locvar_cell_draw_y)
				if ( locvar_cell_draw_p > 0 ) {
					if ( locvar_cell_draw_p < 300 ) {
						repeat 1 + (deco(2, locvar_cell_draw_p) != 0)
							if ( deco(0, locvar_cell_draw_p) < 0 | cnt ) {
								if ( cnt == 1 ) {
									deco2 = deco(2, locvar_cell_draw_p)
								}
								else {
									deco2 = deco(1, locvar_cell_draw_p)
								}
								repeat 1
									if ( deco2 == 1 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 2 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										break
									}
									if ( deco2 == 3 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										break
									}
									if ( deco2 == 4 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 5 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 6 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 7 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										break
									}
									if ( deco2 == 8 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										break
									}
									if ( deco2 == 9 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 168, 656 + 24, 24, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 168, 656, 24, 24
										break
									}
									if ( deco2 == 10 ) {
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 144, 656 + 24, 24, 24
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 144, 656, 24, 24
										break
									}
									if ( deco2 == 20 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656 + 48, 24, 48
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 120, 656 + 48, 24, 48
										break
									}
									if ( deco2 == 21 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 48, 656, 48, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 48, 656 + 120, 48, 24
										break
									}
									if ( deco2 == 30 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656, 48, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0, 656 + 120, 48, 24
										break
									}
									if ( deco2 == 31 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 96, 656, 48, 24
										pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
										gcopy BUFFER_INF, 0 + 96, 656 + 120, 48, 24
										break
									}
									if ( deco2 == 32 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656, 24, 48
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 120, 656, 24, 48
										break
									}
									if ( deco2 == 33 ) {
										pos locvar_cell_draw_dx, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0, 656 + 96, 24, 48
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy
										gcopy BUFFER_INF, 0 + 120, 656 + 96, 24, 48
										break
									}
								loop
							}
							else {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy
								gcopy BUFFER_INF, 0 + deco(0, locvar_cell_draw_p) * inf_tiles, 656 + deco(1, locvar_cell_draw_p) * inf_tiles
							}
						loop
					}
					else {
						locvar_cell_draw_p2 = (locvar_cell_draw_p - 1000) \ 16
						locvar_cell_draw_i = 0
						if ( locvar_cell_draw_p2 == 15 ) {
							locvar_cell_draw_p2 = (locvar_cell_draw_p - 1000) \ 256
							if ( locvar_cell_draw_p2 == 127 ) {
								locvar_cell_draw_i = 13
							}
							if ( locvar_cell_draw_p2 == 223 ) {
								locvar_cell_draw_i = 14
							}
							if ( locvar_cell_draw_p2 == 191 ) {
								locvar_cell_draw_i = 15
							}
							if ( locvar_cell_draw_p2 == 239 ) {
								locvar_cell_draw_i = 16
							}
							if ( locvar_cell_draw_p2 == 207 | locvar_cell_draw_p2 == 63 ) {
								locvar_cell_draw_i = 17
							}
						}
						else {
							locvar_cell_draw_i = shadowmap(locvar_cell_draw_p2)
						}
						pos locvar_cell_draw_dx, locvar_cell_draw_dy
						gcopy BUFFER_INF, 144 + locvar_cell_draw_i * inf_tiles, 752, 48, 48
					}
				}
				locvar_cell_draw_x++
				locvar_cell_draw_dx += inf_tiles
			loop
			locvar_cell_draw_y++
			locvar_cell_draw_dy += inf_tiles
		loop
	}
	grayscaletheworld
	gmode 2
	randomize
	return

#deffunc cell_itemlist int cell_itemlist_arg1, int cell_itemlist_arg2
	listmax = 0
	inv_getheader -1
	repeat invrange, invhead
		if ( iNum(cnt) > 0 ) {
			if ( iX(cnt) == cell_itemlist_arg1 & iY(cnt) == cell_itemlist_arg2 ) {
				list(0, listmax) = cnt
				listmax++
			}
		}
	loop
	return rtval

#deffunc cell_itemoncell int cell_itemoncell_arg1, int cell_itemoncell_arg2
	rtval = 0, 0
	inv_getheader -1
	repeat invrange, invhead
		if ( iNum(cnt) > 0 ) {
			if ( iX(cnt) == cell_itemoncell_arg1 & iY(cnt) == cell_itemoncell_arg2 ) {
				rtval++
				rtval(1) = cnt
			}
		}
	loop
	return rtval

#defcfunc fov_los int fov_los_arg1, int fov_los_arg2, int fov_los_arg3, int fov_los_arg4
	if ( fov_los_arg1 >= mWidth | fov_los_arg2 >= mHeight | fov_los_arg3 >= mWidth | fov_los_arg4 >= mHeight ) {
		return 0
	}
	locvar_fov_los_dy = fov_los_arg4 - fov_los_arg2
	locvar_fov_los_dx = fov_los_arg3 - fov_los_arg1
	locvar_fov_los_ay = abs(locvar_fov_los_dy)
	locvar_fov_los_ax = abs(locvar_fov_los_dx)
	if ( locvar_fov_los_ax < 2 & locvar_fov_los_ay < 2 ) {
		return 1
	}



	if ( locvar_fov_los_dx == 0 ) {
		if ( locvar_fov_los_dy > 0 ) {
			locvar_fov_los_ty = fov_los_arg2 + 1
*label_1173
			if ( locvar_fov_los_ty < fov_los_arg4 == 0 ) {
				goto *label_1174
			}
			if ( chipm(CHIPM_ATTRIB, mapId(fov_los_arg1, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(fov_los_arg1, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_ty++
			goto *label_1173
		}
		else {
			locvar_fov_los_ty = fov_los_arg2 - 1
*label_1175
			if ( locvar_fov_los_ty > fov_los_arg4 == 0 ) {
				goto *label_1176
			}
			if ( chipm(CHIPM_ATTRIB, mapId(fov_los_arg1, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(fov_los_arg1, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_ty--
			goto *label_1175
		}
*label_1176
		return 1
	}



	if ( locvar_fov_los_dy == 0 ) {
		if ( locvar_fov_los_dx > 0 ) {
			locvar_fov_los_tx = fov_los_arg1 + 1
*label_1177
			if ( locvar_fov_los_tx < fov_los_arg3 == 0 ) {
				goto *label_1178
			}
			if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, fov_los_arg2)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, fov_los_arg2) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_tx++
			goto *label_1177
		}
		else {
			locvar_fov_los_tx = fov_los_arg1 - 1
*label_1179
			if ( locvar_fov_los_tx > fov_los_arg3 == 0 ) {
				goto *label_1180
			}
			if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, fov_los_arg2)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, fov_los_arg2) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_tx--
			goto *label_1179
		}
*label_1180
		return 1
	}
	if ( locvar_fov_los_dx < 0 ) {
		locvar_fov_los_sx = -1
	}
	else {
		locvar_fov_los_sx = 1
	}
	if ( locvar_fov_los_dy < 0 ) {
		locvar_fov_los_sy = -1
	}
	else {
		locvar_fov_los_sy = 1
	}
	if ( locvar_fov_los_ax == 1 ) {
		if ( locvar_fov_los_ay == 2 ) {
			if ( (chipm(CHIPM_ATTRIB, mapId(fov_los_arg1, fov_los_arg2 + locvar_fov_los_sy)) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
				if ( (chipm(CHIPM_ATTRIB, mapFeat(fov_los_arg1, fov_los_arg2 + locvar_fov_los_sy) \ 1000) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
					return 1
				}
			}
		}
	}
	else {
		if ( locvar_fov_los_ay == 1 ) {
			if ( locvar_fov_los_ax == 2 ) {
				if ( (chipm(CHIPM_ATTRIB, mapId(fov_los_arg1 + locvar_fov_los_sx, fov_los_arg2)) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
					if ( (chipm(CHIPM_ATTRIB, mapFeat(fov_los_arg1 + locvar_fov_los_sx, fov_los_arg2) \ 1000) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
						return 1
					}
				}
			}
		}
	}
	locvar_fov_los_f2 = locvar_fov_los_ax * locvar_fov_los_ay
	locvar_fov_los_f1 = locvar_fov_los_f2 << 1


	if ( locvar_fov_los_ax >= locvar_fov_los_ay ) {
		locvar_fov_los_qy = locvar_fov_los_ay * locvar_fov_los_ay
		locvar_fov_los_m = locvar_fov_los_qy << 1
		locvar_fov_los_tx = fov_los_arg1 + locvar_fov_los_sx
		if ( locvar_fov_los_qy == locvar_fov_los_f2 ) {
			locvar_fov_los_ty = fov_los_arg2 + locvar_fov_los_sy
			locvar_fov_los_qy -= locvar_fov_los_f1
		}
		else {
			locvar_fov_los_ty = fov_los_arg2
		}
*label_1181
		if ( fov_los_arg3 - locvar_fov_los_tx == 0 ) {
			goto *label_1182
		}
		if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		locvar_fov_los_qy += locvar_fov_los_m
		if ( locvar_fov_los_qy < locvar_fov_los_f2 ) {
			locvar_fov_los_tx += locvar_fov_los_sx
		}
		else {
			if ( locvar_fov_los_qy > locvar_fov_los_f2 ) {
				locvar_fov_los_ty += locvar_fov_los_sy
				if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				locvar_fov_los_qy -= locvar_fov_los_f1
				locvar_fov_los_tx += locvar_fov_los_sx
			}
			else {
				locvar_fov_los_ty += locvar_fov_los_sy
				locvar_fov_los_qy -= locvar_fov_los_f1
				locvar_fov_los_tx += locvar_fov_los_sx
			}
		}
		goto *label_1181
	}
	else {
		locvar_fov_los_qx = locvar_fov_los_ax * locvar_fov_los_ax
		locvar_fov_los_m = locvar_fov_los_qx << 1
		locvar_fov_los_ty = fov_los_arg2 + locvar_fov_los_sy
		if ( locvar_fov_los_qx == locvar_fov_los_f2 ) {
			locvar_fov_los_tx = fov_los_arg1 + locvar_fov_los_sx
			locvar_fov_los_qx -= locvar_fov_los_f1
		}
		else {
			locvar_fov_los_tx = fov_los_arg1
		}
*label_1183
		if ( fov_los_arg4 - locvar_fov_los_ty == 0 ) {
			goto *label_1184
		}
		if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		locvar_fov_los_qx += locvar_fov_los_m
		if ( locvar_fov_los_qx < locvar_fov_los_f2 ) {
			locvar_fov_los_ty += locvar_fov_los_sy
		}
		else {
			if ( locvar_fov_los_qx > locvar_fov_los_f2 ) {
				locvar_fov_los_tx += locvar_fov_los_sx
				if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				locvar_fov_los_qx -= locvar_fov_los_f1
				locvar_fov_los_ty += locvar_fov_los_sy
			}
			else {
				locvar_fov_los_tx += locvar_fov_los_sx
				locvar_fov_los_qx -= locvar_fov_los_f1
				locvar_fov_los_ty += locvar_fov_los_sy
			}
		}
		goto *label_1183
	}

*label_1184
	return 1

#deffunc get_route int get_route_arg1, int get_route_arg2, int get_route_arg3, int get_route_arg4
	dim route, 2, 100
	locvar_fov_los_dy = get_route_arg4 - get_route_arg2
	locvar_fov_los_dx = get_route_arg3 - get_route_arg1
	if ( get_route_arg4 == get_route_arg2 ) {
		if ( get_route_arg3 == get_route_arg1 ) {
			route(0, 0) = 2, 0
			maxroute = 1
			return 1
		}
	}
	locvar_fov_los_ay = abs(locvar_fov_los_dy)
	locvar_fov_los_ax = abs(locvar_fov_los_dx)
	locvar_get_route_p = 0



	if ( locvar_fov_los_dx == 0 ) {
		if ( locvar_fov_los_dy > 0 ) {
			locvar_fov_los_ty = get_route_arg2 + 1
			route(0, locvar_get_route_p) = 2, 1
			locvar_get_route_p++
*get_route_WHILE1
			if ( locvar_fov_los_ty < get_route_arg4 == 0 ) {
				goto *get_route_WEND1
			}
			if ( chipm(CHIPM_ATTRIB, mapId(get_route_arg1, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(get_route_arg1, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_ty++
			route(0, locvar_get_route_p) = 2, 1
			locvar_get_route_p++
			goto *get_route_WHILE1
		}
		else {
			locvar_fov_los_ty = get_route_arg2 - 1
			route(0, locvar_get_route_p) = 2, -1
			locvar_get_route_p++
*get_route_WHILE2
			if ( locvar_fov_los_ty > get_route_arg4 == 0 ) {
				goto *get_route_WEND2
			}
			if ( chipm(CHIPM_ATTRIB, mapId(get_route_arg1, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(get_route_arg1, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_ty--
			route(0, locvar_get_route_p) = 2, -1
			locvar_get_route_p++
			goto *get_route_WHILE2
		}
*get_route_WEND2
		maxroute = locvar_get_route_p
		return 1
	}



	if ( locvar_fov_los_dy == 0 ) {
		if ( locvar_fov_los_dx > 0 ) {
			locvar_fov_los_tx = get_route_arg1 + 1
			route(0, locvar_get_route_p) = 1, 1
			locvar_get_route_p++
*get_route_WHILE3
			if ( locvar_fov_los_tx < get_route_arg3 == 0 ) {
				goto *get_route_WEND3
			}
			if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, get_route_arg2)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, get_route_arg2) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_tx++
			route(0, locvar_get_route_p) = 1, 1
			locvar_get_route_p++
			goto *get_route_WHILE3
		}
		else {
			locvar_fov_los_tx = get_route_arg1 - 1
			route(0, locvar_get_route_p) = 1, -1
			locvar_get_route_p++
*get_route_WHILE4
			if ( locvar_fov_los_tx > get_route_arg3 == 0 ) {
				goto *get_route_WEND4
			}
			if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, get_route_arg2)) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, get_route_arg2) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
				return 0
			}
			locvar_fov_los_tx--
			route(0, locvar_get_route_p) = 1, -1
			locvar_get_route_p++
			goto *get_route_WHILE4
		}
*get_route_WEND4
		maxroute = locvar_get_route_p
		return 1
	}
	if ( locvar_fov_los_dx < 0 ) {
		locvar_fov_los_sx = -1
	}
	else {
		locvar_fov_los_sx = 1
	}
	if ( locvar_fov_los_dy < 0 ) {
		locvar_fov_los_sy = -1
	}
	else {
		locvar_fov_los_sy = 1
	}
	if ( locvar_fov_los_ax == 1 ) {
		if ( locvar_fov_los_ay == 2 ) {
			if ( (chipm(CHIPM_ATTRIB, mapId(get_route_arg1, get_route_arg2 + locvar_fov_los_sy)) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
				if ( (chipm(CHIPM_ATTRIB, mapFeat(get_route_arg1, get_route_arg2 + locvar_fov_los_sy) \ 1000) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
					locvar_get_route_p = 0
					route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
					locvar_get_route_p++
					route(0, locvar_get_route_p) = 2, 0
					locvar_get_route_p++
					route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
					locvar_get_route_p++
					maxroute = locvar_get_route_p
					return 1
				}
			}
		}
	}
	else {
		if ( locvar_fov_los_ay == 1 ) {
			if ( locvar_fov_los_ax == 2 ) {
				if ( (chipm(CHIPM_ATTRIB, mapId(get_route_arg1 + locvar_fov_los_sx, get_route_arg2)) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
					if ( (chipm(CHIPM_ATTRIB, mapFeat(get_route_arg1 + locvar_fov_los_sx, get_route_arg2) \ 1000) & CHIPM_ATTRIB_CANT_SEE) == 0 ) {
						route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
						locvar_get_route_p++
						route(0, locvar_get_route_p) = 1, 0
						locvar_get_route_p++
						route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
						locvar_get_route_p++
						maxroute = locvar_get_route_p
						return 1
					}
				}
			}
		}
	}
	locvar_fov_los_f2 = locvar_fov_los_ax * locvar_fov_los_ay
	locvar_fov_los_f1 = locvar_fov_los_f2 << 1


	if ( locvar_fov_los_ax >= locvar_fov_los_ay ) {
		locvar_fov_los_qy = locvar_fov_los_ay * locvar_fov_los_ay
		locvar_fov_los_m = locvar_fov_los_qy << 1
		locvar_fov_los_tx = get_route_arg1 + locvar_fov_los_sx
		route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
		locvar_get_route_p++
		if ( locvar_fov_los_qy == locvar_fov_los_f2 ) {
			locvar_fov_los_ty = get_route_arg2 + locvar_fov_los_sy
			route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
			locvar_get_route_p++
			locvar_fov_los_qy -= locvar_fov_los_f1
		}
		else {
			locvar_fov_los_ty = get_route_arg2
		}
*get_route_WHILE5
		if ( get_route_arg3 - locvar_fov_los_tx == 0 ) {
			goto *get_route_WEND5
		}
		if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		locvar_fov_los_qy += locvar_fov_los_m
		if ( locvar_fov_los_qy < locvar_fov_los_f2 ) {
			locvar_fov_los_tx += locvar_fov_los_sx
			route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
			locvar_get_route_p++
		}
		else {
			if ( locvar_fov_los_qy > locvar_fov_los_f2 ) {
				locvar_fov_los_ty += locvar_fov_los_sy
				route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
				locvar_get_route_p++
				if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				locvar_fov_los_qy -= locvar_fov_los_f1
				locvar_fov_los_tx += locvar_fov_los_sx
				route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
				locvar_get_route_p++
			}
			else {
				locvar_fov_los_ty += locvar_fov_los_sy
				route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
				locvar_get_route_p++
				locvar_fov_los_qy -= locvar_fov_los_f1
				locvar_fov_los_tx += locvar_fov_los_sx
				route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
				locvar_get_route_p++
			}
		}
		goto *get_route_WHILE5
	}
	else {
		locvar_fov_los_qx = locvar_fov_los_ax * locvar_fov_los_ax
		locvar_fov_los_m = locvar_fov_los_qx << 1
		locvar_fov_los_ty = get_route_arg2 + locvar_fov_los_sy
		route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
		locvar_get_route_p++
		if ( locvar_fov_los_qx == locvar_fov_los_f2 ) {
			locvar_fov_los_tx = get_route_arg1 + locvar_fov_los_sx
			route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
			locvar_get_route_p++
			locvar_fov_los_qx -= locvar_fov_los_f1
		}
		else {
			locvar_fov_los_tx = get_route_arg1
		}
*get_route_WHILE6
		if ( get_route_arg4 - locvar_fov_los_ty == 0 ) {
			goto *get_route_WEND6
		}
		if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
			return 0
		}
		locvar_fov_los_qx += locvar_fov_los_m
		if ( locvar_fov_los_qx < locvar_fov_los_f2 ) {
			locvar_fov_los_ty += locvar_fov_los_sy
			route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
			locvar_get_route_p++
		}
		else {
			if ( locvar_fov_los_qx > locvar_fov_los_f2 ) {
				locvar_fov_los_tx += locvar_fov_los_sx
				route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
				locvar_get_route_p++
				if ( chipm(CHIPM_ATTRIB, mapId(locvar_fov_los_tx, locvar_fov_los_ty)) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				if ( chipm(CHIPM_ATTRIB, mapFeat(locvar_fov_los_tx, locvar_fov_los_ty) \ 1000) & CHIPM_ATTRIB_CANT_SEE ) {
					return 0
				}
				locvar_fov_los_qx -= locvar_fov_los_f1
				locvar_fov_los_ty += locvar_fov_los_sy
				route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
				locvar_get_route_p++
			}
			else {
				locvar_fov_los_tx += locvar_fov_los_sx
				route(0, locvar_get_route_p) = 1, locvar_fov_los_sx
				locvar_get_route_p++
				locvar_fov_los_qx -= locvar_fov_los_f1
				locvar_fov_los_ty += locvar_fov_los_sy
				route(0, locvar_get_route_p) = 2, locvar_fov_los_sy
				locvar_get_route_p++
			}
		}
		goto *get_route_WHILE6
	}

*get_route_WEND6
	maxroute = locvar_get_route_p
	return 1

#deffunc display_customkey str display_customkey_arg1, int display_customkey_arg2, int display_customkey_arg3, int display_customkey_arg3
	redraw 0
	gsel BUFFER_INF
	gmode 0
	font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
	pos 624, 30
	gcopy BUFFER_INF, 0, 30, 24, 18
	pos 629, 31
	color 50, 60, 80
	bmes "" + display_customkey_arg1, 250, 240, 230
	gmode 2, inf_tiles, inf_tiles
	gsel BUFFER_SCREEN
	pos display_customkey_arg2, display_customkey_arg3
	gcopy BUFFER_INF, 624, 30, 24, 18
	return

#deffunc display_key int display_key_arg1, int display_key_arg2, int display_key_arg3
	pos display_key_arg1, display_key_arg2
	gcopy BUFFER_INF, display_key_arg3 * 24 + 72, 30, 24, 18
	return

#deffunc cursor_check
	if ( key == key_north ) {
		snd SOUNDLIST_CURSOR1
		cs--
		if ( cs < 0 ) {
			cs = keyrange - 1
			if ( cs < 0 ) {
				cs = 0
			}
		}
	}
	if ( key == key_south ) {
		snd SOUNDLIST_CURSOR1
		cs++
		if ( cs >= keyrange ) {
			cs = 0
		}
	}
	if ( key == key_west ) {
		key = key_pagedown
	}
	if ( key == key_east ) {
		key = key_pageup
	}
	if ( cs >= keyrange ) {
		cs_bk = -1
		cs = keyrange - 1
		if ( cs < 0 ) {
			cs = 0
		}
	}
	if ( key == key_enter ) {
		key = key_list(cs)
	}
	return

#deffunc lenfix var lenfix_arg1, int lenfix_arg2
	locvar_lenfix_p = lenfix_arg2 - strlen(lenfix_arg1)
	if ( locvar_lenfix_p < 1 ) {
		locvar_lenfix_p = 1
	}
	repeat locvar_lenfix_p
		lenfix_arg1 += " "
	loop
	return

#deffunc showscroll int showscroll_arg1, int showscroll_arg2, int showscroll_arg3, int showscroll_arg4
	repeat 2
		if ( cnt == 0 ) {
			if ( windowshadow == 0 ) {
				continue
			}
			else {
				gmode 6, , , 80
				locvar_showscroll_x = showscroll_arg1 + 3
				locvar_showscroll_y = showscroll_arg2 + 3
				windowshadow = 0
			}
		}
		else {
			gmode 2
			locvar_showscroll_x = showscroll_arg1
			locvar_showscroll_y = showscroll_arg2
		}
		locvar_showscroll_x3 = showscroll_arg3 + locvar_showscroll_x - showscroll_arg3 \ 8 - 64
		locvar_showscroll_y3 = showscroll_arg4 + locvar_showscroll_y - showscroll_arg4 \ 8 - 64
		repeat showscroll_arg3 / 8
			if ( cnt < 8 ) {
				if ( cnt == 0 ) {
					pos locvar_showscroll_x, locvar_showscroll_y
					gcopy BUFFER_PIC, 0, 0, 64, 48
					pos locvar_showscroll_x, locvar_showscroll_y3
					gcopy BUFFER_PIC, 0, 144, 64, 48
				}
				continue
			}
			if ( cnt < showscroll_arg3 / 8 - 8 ) {
				pos cnt * 8 + locvar_showscroll_x, locvar_showscroll_y
				gcopy BUFFER_PIC, (cnt - 8) \ 18 * 8 + 64, 0, 8, 48
				pos cnt * 8 + locvar_showscroll_x, locvar_showscroll_y3
				gcopy BUFFER_PIC, (cnt - 8) \ 18 * 8 + 64, 144, 8, 48
				continue
			}
			pos locvar_showscroll_x3, locvar_showscroll_y
			gcopy BUFFER_PIC, 208, 0, 64, 48
			pos locvar_showscroll_x3, locvar_showscroll_y3
			gcopy BUFFER_PIC, 208, 144, 64, 48
			break
		loop
		repeat showscroll_arg4 / 8 - 14
			locvar_showscroll_cnt2 = cnt
			repeat showscroll_arg3 / 8
				if ( cnt == 0 ) {
					pos locvar_showscroll_x, locvar_showscroll_cnt2 * 8 + locvar_showscroll_y + 48
					gcopy BUFFER_PIC, 0, locvar_showscroll_cnt2 \ 12 * 8 + 48, 64, 8
					continue
				}
				if ( cnt < showscroll_arg3 / 8 - 15 ) {
					pos cnt * 8 + locvar_showscroll_x + 56, locvar_showscroll_cnt2 * 8 + locvar_showscroll_y + 48
					gcopy BUFFER_PIC, cnt \ 18 * 8 + 64, locvar_showscroll_cnt2 \ 12 * 8 + 48, 8, 8
					continue
				}
				pos locvar_showscroll_x3, locvar_showscroll_cnt2 * 8 + locvar_showscroll_y + 48
				gcopy BUFFER_PIC, 208, locvar_showscroll_cnt2 \ 12 * 8 + 48, 64, 8
				break
			loop
		loop
	loop
	if ( s != "" ) {
		pos locvar_showscroll_x + 40, locvar_showscroll_y + showscroll_arg4 - 67 - showscroll_arg4 \ 8
		gcopy BUFFER_INF, 96, 360, 24, 16
		color 194, 173, 161
		line locvar_showscroll_x + 60, locvar_showscroll_y + showscroll_arg4 - 68 - showscroll_arg4 \ 8, locvar_showscroll_x + showscroll_arg3 - 40, locvar_showscroll_y + showscroll_arg4 - 68 - showscroll_arg4 \ 8
		color 224, 213, 191
		line locvar_showscroll_x + 60, locvar_showscroll_y + showscroll_arg4 - 69 - showscroll_arg4 \ 8, locvar_showscroll_x + showscroll_arg3 - 40, locvar_showscroll_y + showscroll_arg4 - 69 - showscroll_arg4 \ 8
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		color 0, 0, 0
		pos locvar_showscroll_x + 68, locvar_showscroll_y + showscroll_arg4 - 63 - showscroll_arg4 \ 8
		mes s
		if ( pagesize != 0 ) {
			s = "Page." + (page + 1) + "/" + (pagemax + 1)
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
			pos locvar_showscroll_x + showscroll_arg3 - strlen(s) * 7 - 40, locvar_showscroll_y + showscroll_arg4 - 63 - showscroll_arg4 \ 8
			mes s
		}
	}
	return

#deffunc window int window_arg1, int window_arg2, int window_arg3, int window_arg4, int window_arg4, int window_arg5
	if ( window_arg5 == (-1) ) {
		gmode 6, , , 80
		color 0, 0, 0
	}
	else {
		gmode 2
	}
	locvar_window_dx = 0
	locvar_window_dy = 48
	locvar_window_x3 = window_arg3 + window_arg1 - window_arg3 \ 8 - 64
	locvar_window_y3 = window_arg4 + window_arg2 - window_arg4 \ 8 - 64
	if ( locvar_window_y3 < window_arg2 + 14 ) {
		locvar_window_y3 = window_arg2 + 14
	}
	repeat window_arg3 / 8
		if ( cnt < 8 ) {
			if ( cnt == 0 ) {
				pos window_arg1, window_arg2
				gcopy BUFFER_INF, locvar_window_dx, locvar_window_dy, 64, 48
				pos window_arg1, locvar_window_y3
				gcopy BUFFER_INF, locvar_window_dx, locvar_window_dy + 144, 64, 48
			}
			continue
		}
		if ( cnt < window_arg3 / 8 - 8 ) {
			pos cnt * 8 + window_arg1, window_arg2
			gcopy BUFFER_INF, (cnt - 8) \ 18 * 8 + locvar_window_dx + 36, locvar_window_dy, 8, 48
			pos cnt * 8 + window_arg1, locvar_window_y3
			gcopy BUFFER_INF, (cnt - 8) \ 18 * 8 + locvar_window_dx + 54, locvar_window_dy + 144, 8, 48
			continue
		}
		pos locvar_window_x3, window_arg2
		gcopy BUFFER_INF, locvar_window_dx + 208, locvar_window_dy, 56, 48
		pos locvar_window_x3, locvar_window_y3
		gcopy BUFFER_INF, locvar_window_dx + 208, locvar_window_dy + 144, 56, 48
		break
	loop
	locvar_window_p = window_arg4 / 8 - 14
	if ( locvar_window_p < 0 ) {
		locvar_window_p = 0
	}
	repeat locvar_window_p
		locvar_window_cnt2 = cnt
		repeat window_arg3 / 8
			if ( cnt == 0 ) {
				pos window_arg1, locvar_window_cnt2 * 8 + window_arg2 + 48
				gcopy BUFFER_INF, locvar_window_dx, locvar_window_cnt2 \ 12 * 8 + locvar_window_dy + 48, 64, 8
				continue
			}
			if ( cnt < window_arg3 / 8 - 15 ) {
				pos cnt * 8 + window_arg1 + 56, locvar_window_cnt2 * 8 + window_arg2 + 48
				gcopy BUFFER_INF, cnt \ 18 * 8 + locvar_window_dx + 64, locvar_window_cnt2 \ 12 * 8 + locvar_window_dy + 48, 8, 8
				continue
			}
			pos locvar_window_x3, locvar_window_cnt2 * 8 + window_arg2 + 48
			gcopy BUFFER_INF, locvar_window_dx + 208, locvar_window_cnt2 \ 12 * 8 + locvar_window_dy + 48, 56, 8
			break
		loop
	loop
	gmode 2
	return

#deffunc window2 int window2_arg1, int window2_arg2, int window2_arg3, int window2_arg4, int window2_arg5, int window2_arg6
	locvar_window2_dx = 0
	locvar_window2_dy = 240
	locvar_window2_x2 = window2_arg3
	locvar_window2_y2 = window2_arg4
	if ( locvar_window2_x2 < 32 ) {
		locvar_window2_x2 = 32
	}
	if ( locvar_window2_y2 < 24 ) {
		locvar_window2_y2 = 24
	}
	locvar_window2_x3 = window2_arg1 + locvar_window2_x2 / 16 * 16 - 16
	locvar_window2_y3 = window2_arg2 + locvar_window2_y2 / 16 * 16 - 16
	if ( window2_arg6 == 0 ) {
		pos window2_arg1 + 4, window2_arg2 + 4
		gzoom locvar_window2_x2 - 6, locvar_window2_y2 - 8, 3, 24, 72, 228, 144
	}
	if ( window2_arg6 == 1 ) {
		pos window2_arg1 + 4, window2_arg2 + 4
		gzoom locvar_window2_x2 - 6, locvar_window2_y2 - 8, 3, 24, 72, 228, 144
		pos window2_arg1 + 4, window2_arg2 + 4
		gfini locvar_window2_x2 - 4, locvar_window2_y2 - 4
		gfdec2 195, 205, 195
	}
	if ( window2_arg6 == 2 ) {
		pos window2_arg1 + 4, window2_arg2 + 4
		gzoom locvar_window2_x2 - 6, locvar_window2_y2 - 8, 3, 24, 72, 228, 144
		pos window2_arg1 + 4, window2_arg2 + 4
		gfini locvar_window2_x2 - 4, locvar_window2_y2 - 4
		gfdec2 210, 215, 205
	}
	if ( window2_arg6 == 3 ) {
		pos window2_arg1 + 4, window2_arg2 + 4
		gzoom locvar_window2_x2 - 6, locvar_window2_y2 - 8, 3, 24, 72, 228, 144
		pos window2_arg1 + 4, window2_arg2 + 4
		gfini locvar_window2_x2 - 4, locvar_window2_y2 - 4
		gfdec2 10, 13, 16
	}
	if ( window2_arg6 == 4 ) {
		pos window2_arg1 + 4, window2_arg2 + 4
		gzoom locvar_window2_x2 - 6, locvar_window2_y2 - 8, 3, 24, 72, 228, 144
		pos window2_arg1 + 4, window2_arg2 + 4
		gfini locvar_window2_x2 - 4, locvar_window2_y2 - 4
		gfdec2 195, 205, 195
	}
	if ( window2_arg6 == 6 ) {
		pos window2_arg1 + locvar_window2_x2 / 2, window2_arg2 + locvar_window2_y2 / 2
		gmode 4, 228, 144, 180
		grotate BUFFER_INF, 24, 72, 0, locvar_window2_x2 - 4, locvar_window2_y2 - 4
	}
	gmode 2, 16, 16
	repeat locvar_window2_x2 / 16 - 2
		pos cnt * 16 + window2_arg1 + 16, window2_arg2
		gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 16, locvar_window2_dy
		pos cnt * 16 + window2_arg1 + 16, window2_arg2 + locvar_window2_y2 - 16
		gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 16, locvar_window2_dy + 32
	loop
	pos locvar_window2_x3, window2_arg2
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 16, locvar_window2_dy, locvar_window2_x2 \ 16, 16
	pos locvar_window2_x3, window2_arg2 + locvar_window2_y2 - 16
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 16, locvar_window2_dy + 32, locvar_window2_x2 \ 16, 16
	locvar_window2_p = locvar_window2_y2 / 16 - 2
	if ( locvar_window2_p < 0 ) {
		locvar_window2_p = 0
	}
	repeat locvar_window2_p
		pos window2_arg1, cnt * 16 + window2_arg2 + 16
		gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx, locvar_window2_dy + 16
		pos window2_arg1 + locvar_window2_x2 - 16, cnt * 16 + window2_arg2 + 16
		gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 32, locvar_window2_dy + 16
	loop
	pos window2_arg1, locvar_window2_y3
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx, locvar_window2_dy + 16, 16, locvar_window2_y2 \ 16
	pos window2_arg1 + locvar_window2_x2 - 16, locvar_window2_y3
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 32, locvar_window2_dy + 16, 16, locvar_window2_y2 \ 16
	pos window2_arg1, window2_arg2
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx, locvar_window2_dy
	pos window2_arg1, window2_arg2 + locvar_window2_y2 - 16
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx, locvar_window2_dy + 32
	pos window2_arg1 + locvar_window2_x2 - 16, window2_arg2
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 32, locvar_window2_dy
	pos window2_arg1 + locvar_window2_x2 - 16, window2_arg2 + locvar_window2_y2 - 16
	gcopy BUFFER_INF, window2_arg5 * 48 + locvar_window2_dx + 32, locvar_window2_dy + 32
	if ( window2_arg6 == 5 ) {
		pos window2_arg1 + 2, window2_arg2 + 2
		gzoom locvar_window2_x2 - 4, locvar_window2_y2 - 5, 3, 24, 72, 228, 144
		pos window2_arg1 + 2, window2_arg2 + 2
		gfini locvar_window2_x2 - 4, locvar_window2_y2 - 4
		gfdec2 195, 205, 195
	}
	return

#deffunc display_window2 int display_window2_arg1, int display_window2_arg2, int display_window2_arg3, int display_window2_arg4, int display_window2_arg5, int display_window2_arg6
	gmode 2
	pos display_window2_arg1, display_window2_arg2
	gcopy display_window2_arg5, 0, 0, display_window2_arg3, display_window2_arg4
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	color 0, 0, 0
	if ( s != "" ) {
		pos display_window2_arg1 + display_window2_arg3 - strlen(s) * 7 - 140, display_window2_arg2 + display_window2_arg4 - 24 - display_window2_arg4 \ 8 + display_window2_arg6
		mes s
	}
	if ( pagesize != 0 ) {
		s = "Page." + (page + 1) + "/" + (pagemax + 1)
		pos display_window2_arg1 + display_window2_arg3 - strlen(s) * 7 - 40, display_window2_arg2 + display_window2_arg4 - 24 - display_window2_arg4 \ 8 + display_window2_arg6
		mes s
	}
	return

#deffunc display_window int display_window_arg1, int display_window_arg2, int display_window_arg3, int display_window_arg4, int display_window_arg5, int display_window_arg6, int display_window_prm6
	if ( windowshadow == 1 ) {
		window display_window_arg1 + 4, display_window_arg2 + 4, display_window_arg3, display_window_arg4 - display_window_arg4 \ 8 + 12, 0, -1
		windowshadow = 0
	}
	window display_window_arg1, display_window_arg2, display_window_arg3, display_window_arg4 - display_window_arg4 \ 8 + 12, 0, 0
	if ( s != "" ) {
		window2 display_window_arg1 + 34, display_window_arg2 - 4, 45 * display_window_arg3 / 100 + limit(strlen(s) * 8 - 120, 0, 200), 32, 1, 1
	}
	gmode 2
	pos display_window_arg1 + 30 + display_window_arg5, display_window_arg2 + display_window_arg4 - 47 - display_window_arg4 \ 8 - 10 * display_window_prm6
	gcopy BUFFER_INF, 96, 360, 24, 16
	color 194, 170, 146
	line display_window_arg1 + 50 + display_window_arg5, display_window_arg2 + display_window_arg4 - 48 - display_window_arg4 \ 8 - 10 * display_window_prm6, display_window_arg1 + display_window_arg3 - 40, display_window_arg2 + display_window_arg4 - 48 - display_window_arg4 \ 8 - 10 * display_window_prm6
	color 234, 220, 188
	line display_window_arg1 + 50 + display_window_arg5, display_window_arg2 + display_window_arg4 - 49 - display_window_arg4 \ 8 - 10 * display_window_prm6, display_window_arg1 + display_window_arg3 - 40, display_window_arg2 + display_window_arg4 - 49 - display_window_arg4 \ 8 - 10 * display_window_prm6
	font lang(cfg_font1, cfg_font2), 15 + en - en * 2, 0
	color 0, 0, 0
	pos display_window_arg1 + 45 * display_window_arg3 / 200 + 34 - strlen(s) * 4 + limit(strlen(s) * 8 - 120, 0, 200) / 2, display_window_arg2 + 4 + vfix
	color 20, 10, 0
	bmes s, 255, 255, 255
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	color 0, 0, 0
	pos display_window_arg1 + 58 + display_window_arg5, display_window_arg2 + display_window_arg4 - 43 - display_window_arg4 \ 8 - 10 * display_window_prm6
	mes s(1)
	if ( pagesize != 0 ) {
		s = "Page." + (page + 1) + "/" + (pagemax + 1)
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
		pos display_window_arg1 + display_window_arg3 - strlen(s) * 7 - 40 - display_window_arg6, display_window_arg2 + display_window_arg4 - 65 - display_window_arg4 \ 8 - 10 * display_window_prm6
		mes s
	}
	wx = display_window_arg1
	wy = display_window_arg2
	ww = display_window_arg3
	wh = display_window_arg4
	return

#deffunc display_note str display_note_arg1, int display_note_arg2
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	pos wx + ww - strlen(display_note_arg1) * 7 - 140 - display_note_arg2, wy + wh - 65 - wh \ 8
	mes display_note_arg1
	return

#deffunc display_topic str display_topic_arg1, int display_topic_arg2, int display_topic_arg3, int display_topic_arg3
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 1
	color 0, 0, 0
	pos display_topic_arg2, display_topic_arg3 + 7
	gcopy BUFFER_INF, 120, 360, 24, 16
	pos display_topic_arg2 + 26, display_topic_arg3 + 8
	mes display_topic_arg1
	color 0, 0, 0
	line display_topic_arg2 + 22, display_topic_arg3 + 21, display_topic_arg2 + strlen(display_topic_arg1) * 7 + 36, display_topic_arg3 + 21
	return

#deffunc display_msg int display_msg_arg1, int display_msg_arg2
	msgkeep = display_msg_arg2
	msgclear = 1
	msgy = display_msg_arg1
	redraw 0
	gosub *label_1487
	return

#defcfunc id_crlf var id_crlf_arg1
	locvar_id_crlf_char = "\n"
	if ( instr(id_crlf_arg1, 0, locvar_id_crlf_char) >= 0 ) {
		return 0
	}
	locvar_id_crlf_char = " "
	poke locvar_id_crlf_char, 0, 13
	if ( instr(id_crlf_arg1, 0, locvar_id_crlf_char) >= 0 ) {
		return 1
	}
	poke locvar_id_crlf_char, 0, 10
	if ( instr(id_crlf_arg1, 0, locvar_id_crlf_char) >= 0 ) {
		return 2
	}
	return 100

#deffunc rm_crlf var rm_crlf_arg1
	locvar_rm_crlf_crlfs = 0, 13, 10
	repeat 3
		locvar_rm_crlf_crlftype = cnt
		locvar_rm_crlf_i = 0
		locvar_rm_crlf_tmpbuf = ""
		locvar_rm_crlf_len = strlen(rm_crlf_arg1)
		repeat
			if ( locvar_rm_crlf_i >= locvar_rm_crlf_len ) {
				break
			}
			getstr locvar_rm_crlf_tmpstr, rm_crlf_arg1, locvar_rm_crlf_i, locvar_rm_crlf_crlfs(locvar_rm_crlf_crlftype)
			locvar_rm_crlf_i += strsize
			locvar_rm_crlf_tmpbuf += locvar_rm_crlf_tmpstr
		loop
		rm_crlf_arg1 = locvar_rm_crlf_tmpbuf
	loop
	return

#defcfunc role int role_arg1, int role_arg2, int role_arg3
	locvar_role_d = 0
	locvar_role_p = role_arg1, role_arg2
	if ( locvar_role_p < 1 ) {
		locvar_role_p = 1
	}
	if ( locvar_role_p(1) < 1 ) {
		locvar_role_p(1) = 1
	}
	repeat locvar_role_p
		locvar_role_d += rndex(locvar_role_p(1)) + 1
		if ( ogTitleAreus != 2 ) {
			locvar_role_d = limit(locvar_role_d, 0, 10000000)
		}
		else {
			locvar_role_d = limit(locvar_role_d, 0, 1000000000)
		}
	loop
	return locvar_role_d + role_arg3

#defcfunc rolemax int rolemax_arg1, int rolemax_arg2, int rolemax_arg3
	if ( ogTitleAreus == 2 ) {
		return limit(rolemax_arg1 * rolemax_arg2 + rolemax_arg3, 0, 1500000000)
	}
	return limit(rolemax_arg1 * rolemax_arg2 + rolemax_arg3, 0, 15000000)

#deffunc page_save2
	pagebk2 = page
	csprev2 = cs
	pagesaved2 = 1
	return

#deffunc page_load2
	if ( pagesaved2 == 1 ) {
		page = pagebk2
		cs = csprev2
		pagesaved2 = 0
	}
	return

#deffunc page_save
	pagebk = page
	csprev = cs
	pagesaved = 1
	return

#deffunc page_load
	if ( pagesaved == 1 ) {
		page = pagebk
		cs = csprev
		pagesaved = 0
	}
	return

#deffunc fileadd str fileadd_arg1, int fileadd_arg2
	if ( fileadd_arg2 == 0 ) {
		locvar_fileadd_q = "*", "#"
	}
	else {
		locvar_fileadd_q = "#", "*"
	}
	notesel filemod
	locvar_fileadd_p = instr(filemod, 0, fileadd_arg1)
	if ( locvar_fileadd_p != (-1) ) {
		if ( strmid(filemod, locvar_fileadd_p - 1, 1) == locvar_fileadd_q(1) ) {
			cnvstow locvar_fileadd_a, locvar_fileadd_q
			poke filemod, locvar_fileadd_p - 1, locvar_fileadd_a
		}
		noteunsel
		return
	}
	if ( fileadd_arg2 != 0 ) {
		noteadd locvar_fileadd_q + fileadd_arg1
		noteunsel
		return
	}
	noteadd locvar_fileadd_q + fileadd_arg1
	noteunsel
	return

#defcfunc del_str str del_str_arg1, str del_str_arg2
	locvar_del_str_s = del_str_arg1
	repeat
		if ( instr(locvar_del_str_s, 0, del_str_arg2) == (-1) ) {
			break
		}
		locvar_del_str_s = strmid(locvar_del_str_s, 0, instr(locvar_del_str_s, 0, del_str_arg2)) + strmid(locvar_del_str_s, instr(locvar_del_str_s, 0, del_str_arg2) + strlen(del_str_arg2), 100)
	loop
	return locvar_del_str_s

#deffunc cnv_str var cnv_str_arg1, str cnv_str_arg2, str cnv_str_arg3
	repeat
		locvar_cnv_str_s3 = getpath(cnv_str_arg1, 16)
		locvar_cnv_str_p = instr(locvar_cnv_str_s3, 0, cnv_str_arg2)
		if ( locvar_cnv_str_p == (-1) ) {
			break
		}
		cnv_str_arg1 = strmid(cnv_str_arg1, 0, locvar_cnv_str_p) + lang(cnv_str_arg3, cnv_str_arg3) + strmid(cnv_str_arg1, locvar_cnv_str_p + strlen(cnv_str_arg2), 300)
	loop
	return cnv_str_arg1

#deffunc fix_wish var fix_wish_arg1
	cnv_str fix_wish_arg1, "", ""
	cnv_str fix_wish_arg1, "", ""
	cnv_str fix_wish_arg1, "", ""
	cnv_str fix_wish_arg1, "", ""
	cnv_str fix_wish_arg1, "J[h", ""
	cnv_str fix_wish_arg1, "J[h", ""
	cnv_str fix_wish_arg1, "", ""
	cnv_str fix_wish_arg1, "", ""
	cnv_str fix_wish_arg1, "G{", ""
	cnv_str fix_wish_arg1, "G{", ""
	cnv_str fix_wish_arg1, "card ", ""
	cnv_str fix_wish_arg1, "figure ", ""
	cnv_str fix_wish_arg1, "corpse ", ""
	cnv_str fix_wish_arg1, "card", ""
	cnv_str fix_wish_arg1, "figure", ""
	cnv_str fix_wish_arg1, "corpse", ""
	cnv_str fix_wish_arg1, "L@", ""
	cnv_str fix_wish_arg1, "ybg@", ""
	return

#deffunc fix_input_chat var fix_input_chat_arg1
	cnv_str fix_input_chat_arg1, " ", "+"
	cnv_str fix_input_chat_arg1, "%", "per"
	cnv_str fix_input_chat_arg1, "&", "and"
	cnv_str fix_input_chat_arg1, "<", ""
	cnv_str fix_input_chat_arg1, ">", ""
	return

#deffunc fix_input_chat2 var fix_input_chat2_arg1
	cnv_str fix_input_chat2_arg1, "fucking", "nyoro~n"
	cnv_str fix_input_chat2_arg1, "fuck", "nyou talk funny"
	return

#deffunc cnv_filestr var cnv_filestr_arg1
	cnv_str cnv_filestr_arg1, "\"", "_"
	cnv_str cnv_filestr_arg1, "\\", "_"
	cnv_str cnv_filestr_arg1, "<", "_"
	cnv_str cnv_filestr_arg1, ">", "_"
	cnv_str cnv_filestr_arg1, "/", "_"
	cnv_str cnv_filestr_arg1, "?", "_"
	cnv_str cnv_filestr_arg1, "|", "_"
	cnv_str cnv_filestr_arg1, "*", "_"
	return

#deffunc imeset int imeset_arg1
	locvar_imeset_himc = ImmGetContext(hwnd)
	ImmSetOpenStatus locvar_imeset_himc, imeset_arg1
	ImmReleaseContext hwnd, locvar_imeset_himc
	return

#defcfunc imeget
	locvar_imeset_himc = ImmGetContext(hwnd)
	locvar_imeget_imesw = ImmGetOpenStatus(locvar_imeset_himc)
	ImmReleaseContext hwnd, locvar_imeset_himc
	return locvar_imeget_imesw

#deffunc _fdialog array _fdialog_arg1, int _fdialog_arg2, array _fdialog_arg3, str _fdialog_arg4, str _fdialog_arg5
	mref locvar__fdialog__stat, 64
	mref locvar__fdialog__refstr, 65
	locvar__fdialog_p1_len = length(_fdialog_arg1)
	locvar__fdialog_p3_len = length(_fdialog_arg3)
	if ( locvar__fdialog_p1_len != locvar__fdialog_p3_len | (_fdialog_arg2 != 16 & _fdialog_arg2 != 17) ) {
		locvar__fdialog__stat = 0
		return
	}
	sdim locvar__fdialog_szfilename, 260
	locvar__fdialog_szfilename = _fdialog_arg5
	sdim locvar__fdialog_szinitdir, 260
	locvar__fdialog_szinitdir = _fdialog_arg4
	locvar__fdialog_szappfilter = ""
	repeat locvar__fdialog_p1_len
		locvar__fdialog_szappfilter += _fdialog_arg3(cnt) + " (*." + _fdialog_arg1(cnt) + ")@*." + _fdialog_arg1(cnt) + "@"
	loop
	locvar__fdialog_szappfilter += "ALL files (*.*)@*.*@"
	locvar__fdialog_start = 0
	repeat
		await 0
		locvar__fdialog_mutch = instr(locvar__fdialog_szappfilter, locvar__fdialog_start, "@")
		if ( locvar__fdialog_mutch == (-1) ) {
			break
		}
		poke locvar__fdialog_szappfilter, locvar__fdialog_start + locvar__fdialog_mutch, 0
		locvar__fdialog_start += locvar__fdialog_mutch + 1
	loop
	dim locvar__fdialog_ofn, 19
	locvar__fdialog_ofn(0) = 76
	locvar__fdialog_ofn(1) = hwnd
	locvar__fdialog_ofn(2) = hinstance
	locvar__fdialog_ofn(3) = varptr(locvar__fdialog_szappfilter)
	locvar__fdialog_ofn(4) = 0
	locvar__fdialog_ofn(5) = 0
	locvar__fdialog_ofn(6) = 0
	locvar__fdialog_ofn(7) = varptr(locvar__fdialog_szfilename)
	locvar__fdialog_ofn(8) = 260
	locvar__fdialog_ofn(9) = 0
	locvar__fdialog_ofn(10) = 0
	locvar__fdialog_ofn(11) = varptr(locvar__fdialog_szinitdir)
	locvar__fdialog_ofn(12) = 0
	locvar__fdialog_ofn(13) = 4098
	if ( _fdialog_arg2 == 16 ) {
		GetOpenFileNameA varptr(locvar__fdialog_ofn)
	}
	if ( _fdialog_arg2 == 17 ) {
		GetSaveFileNameA varptr(locvar__fdialog_ofn)
	}
	locvar__fdialog__stat = stat
	locvar__fdialog__refstr = locvar__fdialog_szfilename
	return

#deffunc gmes str gmes_arg1
	locvar_gmes_m = ""
	locvar_gmes_msg = "" + gmes_arg1 + "$end"
	locvar_gmes_i = 0
	locvar_gmes_xorg = gmesx
	locvar_gmes_size = 14
	locvar_gmes_col = gmescol, gmescol(1), gmescol(2), 180, 160, 140
	locvar_gmes_lim = gmesx + gmesw
	font lang(cfg_font1, cfg_font2), locvar_gmes_size - en * 2, 0
	repeat
		locvar_gmes_p = peek(locvar_gmes_msg, locvar_gmes_i)
		locvar_gmes_brwait = 0
		if ( locvar_gmes_p >= 129 & locvar_gmes_p <= 159 | locvar_gmes_p >= 224 & locvar_gmes_p <= 252 ) {
			locvar_gmes_p = 2
		}
		else {
			locvar_gmes_p = 1
		}
		locvar_gmes_m = strmid(locvar_gmes_msg, locvar_gmes_i, locvar_gmes_p)
		locvar_gmes_i += locvar_gmes_p
		if ( locvar_gmes_m == "$" ) {
			locvar_gmes_s = strmid(locvar_gmes_msg, locvar_gmes_i, 3)
			locvar_gmes_p += 3
			if ( locvar_gmes_s == "end" ) {
				break
			}
			continue
		}
		else {
			if ( locvar_gmes_m != "B" & locvar_gmes_m != "A" & locvar_gmes_m != "v" & locvar_gmes_m != "x" & locvar_gmes_m != "I" & locvar_gmes_m != "H" & locvar_gmes_m != "c" ) {
			}
			else {
				locvar_gmes_brwait = 1
			}
		}
		if ( locvar_gmes_m == "<" ) {
			locvar_gmes_s = strmid(locvar_gmes_msg, locvar_gmes_i, instr(locvar_gmes_msg, locvar_gmes_i, ">"))
			locvar_gmes_i += instr(locvar_gmes_msg, locvar_gmes_i, ">") + 1
			if ( locvar_gmes_s == "emp1" ) {
				font lang(cfg_font1, cfg_font2), locvar_gmes_size - en * 2, 4
				locvar_gmes_col = 50, 50, 255
			}
			if ( locvar_gmes_s == "emp2" ) {
				font lang(cfg_font1, cfg_font2), locvar_gmes_size - en * 2, 1
				locvar_gmes_col = 40, 130, 40
			}
			if ( locvar_gmes_s == "title1" ) {
				locvar_gmes_size = 12
				font lang(cfg_font1, cfg_font2), locvar_gmes_size - en * 2, 1
				locvar_gmes_col = 100, 50, 50
			}
			if ( locvar_gmes_s == "def" ) {
				locvar_gmes_size = 14
				font lang(cfg_font1, cfg_font2), locvar_gmes_size - en * 2, 0
				locvar_gmes_col = gmescol, gmescol(1), gmescol(2)
			}
			if ( locvar_gmes_s == "p" ) {
				gmesy += 24
				gmesx = locvar_gmes_xorg
			}
			if ( locvar_gmes_s == "br" ) {
				gmesy += 16
				gmesx = locvar_gmes_xorg
			}
			if ( locvar_gmes_s == "b" ) {
				font lang(cfg_font1, cfg_font2), locvar_gmes_size - en * 2, 1
			}
			if ( locvar_gmes_s == "green" ) {
				locvar_gmes_col = 20, 120, 20
			}
			if ( locvar_gmes_s == "red" ) {
				locvar_gmes_col = 120, 20, 20
			}
			if ( locvar_gmes_s == "col" ) {
				locvar_gmes_col = gmescol, gmescol(1), gmescol(2), 180, 160, 140
			}
			continue
		}
		if ( locvar_gmes_m == "^" ) {
			locvar_gmes_m = strmid(locvar_gmes_msg, locvar_gmes_i, 1)
			locvar_gmes_i++
		}
		if ( locvar_gmes_brwait == 0 ) {
			if ( gmesx >= locvar_gmes_lim ) {
				gmesx = locvar_gmes_xorg
				gmesy += locvar_gmes_size + 2
			}
		}
		if ( gmestype == 1 ) {
			color locvar_gmes_col(3), locvar_gmes_col(4), locvar_gmes_col(5)
			pos gmesx + 1, gmesy + 1
			mes locvar_gmes_m
		}
		color locvar_gmes_col(0), locvar_gmes_col(1), locvar_gmes_col(2)
		pos gmesx, gmesy
		mes locvar_gmes_m
		gmesx += locvar_gmes_size / 2 * locvar_gmes_p
	loop
	gmesx = locvar_gmes_xorg
	gmesy += locvar_gmes_size + 4
	return

#deffunc boxl int boxl_arg1, int boxl_arg2, int boxl_arg3, int boxl_arg4
	pos boxl_arg1, boxl_arg4
	line boxl_arg1, boxl_arg2
	line boxl_arg3, boxl_arg2
	line boxl_arg3, boxl_arg4
	line boxl_arg1, boxl_arg4
	return

#defcfunc fixtxt str fixtxt_arg1, int fixtxt_arg2
	locvar_fixtxt_m = "" + fixtxt_arg1
	if ( strlen(fixtxt_arg1) < fixtxt_arg2 ) {
		repeat
			if ( strlen(locvar_fixtxt_m) >= fixtxt_arg2 ) {
				break
			}
			locvar_fixtxt_m += " "
		loop
	}
	else {
		locvar_fixtxt_m = "" + strmid(locvar_fixtxt_m, 0, fixtxt_arg2)
	}
	return "" + locvar_fixtxt_m

#deffunc windowanime int windowanime_arg1, int windowanime_arg2, int windowanime_arg3, int windowanime_arg4, int windowanime_arg5, int windowanime_arg6
	if ( nowindowanime ) {
		nowindowanime = 0
		return
	}
	if ( cfg_windowanime == 0 ) {
		return
	}
	gsel windowanime_arg6
	gmode 0
	pos 0, 0
	gcopy BUFFER_SCREEN, windowanime_arg1, windowanime_arg2, windowanime_arg3, windowanime_arg4
	gsel BUFFER_SCREEN
	gmode 0
	locvar_windowanime_x2 = windowanime_arg3 / 2
	locvar_windowanime_y2 = windowanime_arg4 / 2
	locvar_windowanime_cenx = windowanime_arg1 + locvar_windowanime_x2
	locvar_windowanime_ceny = windowanime_arg2 + locvar_windowanime_y2
	redraw 0
	repeat windowanime_arg5 - 1, 1
		color 30, 30, 30
		boxl locvar_windowanime_cenx - locvar_windowanime_x2 / windowanime_arg5 * cnt, locvar_windowanime_ceny - locvar_windowanime_y2 / windowanime_arg5 * cnt, locvar_windowanime_cenx + locvar_windowanime_x2 / windowanime_arg5 * cnt, locvar_windowanime_ceny + locvar_windowanime_y2 / windowanime_arg5 * cnt
		color 240, 240, 240
		boxl locvar_windowanime_cenx - locvar_windowanime_x2 / windowanime_arg5 * cnt - 1, locvar_windowanime_ceny - locvar_windowanime_y2 / windowanime_arg5 * cnt - 1, locvar_windowanime_cenx + locvar_windowanime_x2 / windowanime_arg5 * cnt - 1, locvar_windowanime_ceny + locvar_windowanime_y2 / windowanime_arg5 * cnt - 1
		redraw 0
		redraw 1
		if ( cnt != windowanime_arg5 - 1 ) {
			await 15
		}
		redraw 0
		pos windowanime_arg1, windowanime_arg2
		gcopy windowanime_arg6, 0, 0, windowanime_arg3, windowanime_arg4
	loop
	gmode 2
	return

#deffunc windowanimecorner int windowanimecorner_arg1, int windowanimecorner_arg2, int windowanimecorner_arg3, int windowanimecorner_arg4, int windowanimecorner_arg5, int windowanimecorner_arg6
	if ( cfg_windowanime == 0 ) {
		return
	}
	gsel windowanimecorner_arg6
	gmode 0
	pos 0, 0
	gcopy BUFFER_SCREEN, windowanimecorner_arg1, windowanimecorner_arg2, windowanimecorner_arg3, windowanimecorner_arg4
	gsel BUFFER_SCREEN
	gmode 0
	locvar_windowanime_x2 = windowanimecorner_arg3 - windowanimecorner_arg1
	locvar_windowanime_y2 = windowanimecorner_arg4 - windowanimecorner_arg2
	redraw 0
	repeat windowanimecorner_arg5, 1
		color 30, 30, 30
		boxl windowanimecorner_arg1 + windowanimecorner_arg3, windowanimecorner_arg2 + windowanimecorner_arg4, windowanimecorner_arg1 + windowanimecorner_arg3 - (windowanimecorner_arg3 - windowanimecorner_arg1) / windowanimecorner_arg5 * cnt, windowanimecorner_arg2 + windowanimecorner_arg4 - (windowanimecorner_arg4 - windowanimecorner_arg2) / windowanimecorner_arg5 * cnt
		color 240, 240, 240
		boxl windowanimecorner_arg1 + windowanimecorner_arg3 - 1, windowanimecorner_arg2 + windowanimecorner_arg4 - 1, windowanimecorner_arg1 + windowanimecorner_arg3 - (windowanimecorner_arg3 - windowanimecorner_arg1) / windowanimecorner_arg5 * cnt - 1, windowanimecorner_arg2 + windowanimecorner_arg4 - (windowanimecorner_arg4 - windowanimecorner_arg2) / windowanimecorner_arg5 * cnt - 1
		redraw 1
		if ( cnt != windowanimecorner_arg5 ) {
			await 15
		}
		redraw 0
		pos windowanimecorner_arg1, windowanimecorner_arg2
		gcopy windowanimecorner_arg6, 0, 0, windowanimecorner_arg3, windowanimecorner_arg4
	loop
	gmode 2
	return

#deffunc showtitle str showtitle_arg0, str showtitle_arg1, int showtitle_arg2, int showtitle_arg3
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	if ( mode != MODELIST_CHARA_CREATION ) {
		locvar_showtitle_x = showtitle_arg2 - 10
		locvar_showtitle_y = 0
	}
	else {
		locvar_showtitle_x = 240
		locvar_showtitle_y = windowh - 16
	}
	repeat (windoww - locvar_showtitle_x - 8) / 192 + 1
		pos locvar_showtitle_x + 8 + cnt * 192, locvar_showtitle_y
		gcopy BUFFER_INF, 496, 599 - 18, 192, 18
	loop
	gmode 2
	pos locvar_showtitle_x, locvar_showtitle_y + (mode != MODELIST_CHARA_CREATION)
	gcopy BUFFER_INF, 96, 360, 24, 16
	color 0, 0, 0
	pos locvar_showtitle_x + 32, locvar_showtitle_y + 1 + jp
	bmes showtitle_arg1, 250, 250, 250
	return

#deffunc drawmenu int drawmenu_arg1
	locvar_drawmenu_y = 34
	if ( drawmenu_arg1 == 0 ) {
		locvar_drawmenu_x = windoww - 260, 240
		p = 9, 10, 11, 12
		s = lang("", "Chara"), lang("", "Wear"), lang("", "Feat"), lang("", "Material"), ""
	}
	if ( drawmenu_arg1 == 1 ) {
		locvar_drawmenu_x = windoww - 260, 240
		p = 13, 14, 22, 23
		s = lang("@", "Spell"), lang("Z\", "Skill"), lang("@", "Greater Spell"), lang("E@", "Another Spell"), ""
	}
	if ( drawmenu_arg1 == 2 ) {
		locvar_drawmenu_x = windoww - 210, 190
		p = 15, 3, 16
		s = lang("O", "Log"), lang("", "Journal"), lang("`bg", "Chat"), ""
	}
	if ( drawmenu_arg1 == 3 ) {
		locvar_drawmenu_x = windoww - 210, 190
		p = 19, 20, 21
		s = lang("`[g", "Chart"), lang("X", "City"), lang("@", "Law"), ""
	}
	if ( drawmenu_arg1 == 4 ) {
		locvar_drawmenu_x = windoww - 210, 190
		p = 24, 25, 26
		s = lang("N.T", "N.T"), lang("S.T", "S.T"), lang("", "Void"), ""
	}
	if ( menucycle == 0 ) {
		return
	}
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	window2 locvar_drawmenu_x, locvar_drawmenu_y, locvar_drawmenu_x(1), 22, 5, 5
	pos locvar_drawmenu_x - 28, locvar_drawmenu_y - 8
	gcopy BUFFER_INF, 64, 288, 50, 32
	repeat 8
		if ( s(cnt) == "" ) {
			break
		}
		pos locvar_drawmenu_x + cnt * 50 + 20, locvar_drawmenu_y - 24
		gcopy BUFFER_INF, 288 + p(cnt) * 48, 48, 48, 48
		if ( curmenu == cnt ) {
			gmode 5, , , 70
			pos locvar_drawmenu_x + cnt * 50 + 20, locvar_drawmenu_y - 24
			gcopy BUFFER_INF, 288 + p(cnt) * 48, 48, 48, 48
			gmode 2
		}
		pos locvar_drawmenu_x + cnt * 50 + 46 - strlen(s(cnt)) * 3, locvar_drawmenu_y + 7
		color 0, 0, 0
		if ( curmenu == cnt ) {
			bmes s(cnt), 255, 255, 255
		}
		else {
			bmes s(cnt), 165, 165, 165
		}
	loop
	color 0, 0, 0
	pos locvar_drawmenu_x + locvar_drawmenu_x(1) - 150, locvar_drawmenu_y + 28
	bmes "" + key_prev + "," + key_next + ",Tab " + lang("[j[]", "[Change]"), 255, 255, 255
	return

#deffunc fillbg int fillbg_arg1, int fillbg_arg2, int fillbg_arg3, int fillbg_arg4, int fillbg_arg5
	gmode 0
	repeat inf_ver / fillbg_arg5 + 1
		locvar_fillbg_cnt2 = cnt
		repeat windoww / fillbg_arg4 + 1
			pos windoww - (cnt + 1) * fillbg_arg4, inf_ver - (locvar_fillbg_cnt2 + 1) * fillbg_arg5
			gcopy fillbg_arg1, fillbg_arg2, fillbg_arg3, fillbg_arg4, fillbg_arg5
		loop
	loop
	gmode 2
	return

#defcfunc direction int direction_arg1, int direction_arg2, int direction_arg3, int direction_arg4
	if ( abs(direction_arg1 - direction_arg3) > abs(direction_arg2 - direction_arg4) ) {
		if ( direction_arg1 > direction_arg3 ) {
			return 1
		}
		else {
			return 2
		}
	}
	else {
		if ( direction_arg2 > direction_arg4 ) {
			return 3
		}
		else {
			return 0
		}
	}


































































