*com_quick
	page = quickpage
	listmax = 0
	snd SOUNDLIST_CURSOR1
	cs = -1

*com_quick_loop
	listmax = 0
	if ( page == 3 ) {
		page = 2
	}
	if ( page == (-1) ) {
		page = 0
	}
	if ( page == 0 ) {
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("ヘルプ", "Help"), key_help
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("ログ", "Log"), key_msglog
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("シート", "Chara"), key_charainfo
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("日誌", "Journal"), key_journal
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("信仰", "God"), cfg_key_godinfo
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
	}
	if ( page == 1 ) {
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("装備", "Wear"), key_wear
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("休息", "Rest"), key_rest
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("魔法", "Spell"), key_cast
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("技能", "Skill"), key_skill
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("射撃", "Fire"), key_fire
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("掘る", "Dig"), key_dig
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
	}
	if ( page == 2 ) {
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("祈る", "Pray"), key_pray
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("装填", "Ammo"), key_ammo
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("干渉", "Interact"), key_interact
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("体当り", "Bash"), key_bash
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("大魔法", "Ancient"), cfg_key_cast_ancient
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = lang("異界魔法", "Another"), cfg_key_cast_another
		listmax++
		list(0, listmax) = listmax
		listn(0, listmax) = "", "aaa"
		listmax++
	}
	s = lang("情報", "Info"), lang("行動", "Action"), lang("特殊", "Etc"), "null"
	p = page - 1
	if ( p == (-1) ) {
		p = 3
	}
	listn(0, 0) = s(p)
	listn(0, 4) = s(page)
	p = page + 1
	if ( p == 3 ) {
		p = 3
	}
	listn(0, 8) = s(p)
	t = 0

*com_quick_loop_WHILE1
	redraw 0
	font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
	tx = 50
	ty = windowh - 255
	x = 25, 50, 50, 100, 100, 100, 150, 150, 175
	y = 50, 15, 85, 0, 50, 100, 15, 85, 50
	s = "○コマンド"
	gmode 2
	repeat 9
		p = cnt
		if ( listn(0, p) == "null" ) {
			continue
		}
		pos x(cnt) + tx, y(cnt) + ty
		if ( cnt == 0 | cnt == 4 | cnt == 8 ) {
			gcopy BUFFER_INF, 360, 192, 48, 48
		}
		else {
			gcopy BUFFER_INF, 360, 144, 48, 48
		}
		gmode 5, , , (t + cnt) \ 10 * (t + cnt) \ 10 * 12 * ((t + cnt) \ 50 < 10)
		if ( cs == cnt ) {
			gmode 5, , , 140
		}
		pos x(cnt) + tx, y(cnt) + ty
		if ( cnt == 0 | cnt == 4 | cnt == 8 ) {
			gcopy BUFFER_INF, 360, 192, 48, 48
		}
		else {
			gcopy BUFFER_INF, 360, 144, 48, 48
		}
		gmode 2
		s = listn(0, p)
		pos x(cnt) + tx + 25 - strlen(s) * 3, y(cnt) + ty + 19
		color 0, 0, 0
		bmes s, 255, 255, 255
	loop
	t++
	redraw 1
	await cfg_wait1
	key_check 2
	if ( key == key_north ) {
		key = listn(1, 3)
		cs = 3
	}
	if ( key == key_south ) {
		key = listn(1, 5)
		cs = 5
	}
	if ( key == key_west ) {
		cs = 0
	}
	if ( key == key_east ) {
		cs = 8
	}
	if ( key == key_northwest ) {
		key = listn(1, 1)
		cs = 1
	}
	if ( key == key_northeast ) {
		key = listn(1, 6)
		cs = 6
	}
	if ( key == key_southwest ) {
		key = listn(1, 2)
		cs = 2
	}
	if ( key == key_southeast ) {
		key = listn(1, 7)
		cs = 7
	}
	if ( key == key_cancel ) {
		cs = -1
		snd SOUNDLIST_CURSOR1
		key = ""
		goto *com_quick_loop_WEND1
	}
	if ( key != "" ) {
		if ( cs == (-1) ) {
			snd SOUNDLIST_CURSOR1
			key = ""
			goto *com_quick_loop_WEND1
		}
		if ( key == key_enter ) {
			key = listn(1, cs)
			goto *com_quick_loop_WEND1
		}
	}
	if ( key == "" | cs == 1 | cs == 6 | cs == 2 | cs == 7 ) {
		if ( cs != (-1) ) {
			key = listn(1, cs)
			goto *com_quick_loop_WEND1
		}
	}
	goto *com_quick_loop_WHILE1

*com_quick_loop_WEND1
	if ( cs == 0 | key == key_northeast ) {
		cs = -1
		snd SOUNDLIST_CURSOR1
		page--
		screenupdate = -1
		gosub *screen_draw
		goto *com_quick_loop
	}
	if ( cs == 8 | key == key_northwest ) {
		cs = -1
		snd SOUNDLIST_CURSOR1
		page++
		screenupdate = -1
		gosub *screen_draw
		goto *com_quick_loop
	}
	quickpage = page
	cs = 0
	gosub *screen_draw
	quickkeywait = 1
	return

*elona_help
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "\\graphic\\deco_help.bmp", 1
	gsel BUFFER_SCREEN
	page = 0
	notesel buff
	noteload exedir + "data\\exhelp.txt"
	p = instr(buff, 0, "%" + ghelp + "," + lang("JP", "EN"))
	if ( p == (-1) ) {
		dialog "help index not found " + "%" + ghelp + "," + lang("JP", "EN")
		return
	}
	buff = strmid(buff, p, instr(buff, p, "%END"))
	notedel 0
	if ( noteinfo(0) == 0 ) {
		return
	}
	throwsstpevent "TravelGuide", 0, "", ghelp
	snd SOUNDLIST_CHIME
	repeat
		redraw 0
		gmode 2
		dx = 480
		dy = 175
		window2 (windoww - dx) / 2 + inf_screenx, winposy(dy), dx, dy, 4, 0
		wx = (windoww - dx) / 2 + inf_screenx
		wy = winposy(dy)
		window2 (windoww - 325) / 2 + inf_screenx, winposy(dy) + 6, 325, 32, 0, 1
		pos wx + 5, wy + 4
		gcopy BUFFER_INF, 960, 96, 48, 48
		pos wx + dx - 55, wy + 4
		gcopy BUFFER_INF, 960, 96, 48, 48
		pos wx + 10, wy + 42
		gcopy BUFFER_INF, 960, 144, 96, 120
		font lang(cfg_font1, cfg_font2), 16 - en * 2, 1
		pos wx + 142, wy + 13
		color 80, 60, 50
		bmes lang("- ノルンの冒険ガイド -", "- Norne's travel guide -"), 255, 245, 235
		tx = wx + 120
		ty = wy + 55
		font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
		color 30, 30, 30
		gmesx = tx
		gmesy = ty
		gmesw = 330
		gmescol = 30, 30, 30
		gmestype = 1
		repeat 10
			noteget s, page
			page++
			if ( page > noteinfo(0) | s == "" ) {
				break
			}
			gmes s
		loop
		gmode 2
		redraw 1
		help_halt
		if ( page >= noteinfo(0) ) {
			break
		}
	loop
	return

*convertHelp
	if ( jp ) {
		return
	}
	repeat 24
		if ( instr(s(cnt), 0, "(") == (-1) ) {
			continue
		}
		s(cnt) = cnven(strmid(s(cnt), instr(s(cnt), 0, "(") + 1, instr(s(cnt), 0, ")") - instr(s(cnt), 0, "(") - 1))
	loop
	return

*com_help
	snd SOUNDLIST_POP2
	listmax = 0
	page = 0
	pagesize = 18
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	page_bk = 0
	cs_bk2 = 0
	if ( mode != MODELIST_CHARA_CREATION ) {
		gsel BUFFER_BUF
		repeat 8
			pos cnt \ 4 * 180, cnt / 4 * 300
			picload_ exedir + "graphic\\g" + (cnt + 1) + ".bmp", 1
		loop
		gsel BUFFER_SCREEN
	}
	else {
		cs = 3
		cs_bk2 = cs
	}
	notesel buff
	noteload exedir + "data\\" + lang("manual_JP.txt", "manual_ENG.txt")
	list(0, 0) = 0
	listn(0, 0) = lang("キーの一覧", "Key List")
	listmax++
	repeat noteinfo(0)
		noteget q, cnt
		p = instr(q, 0, "{}")
		if ( p != (-1) ) {
			list(0, listmax) = cnt + 1
			listn(0, listmax) = strmid(q, instr(q, 0, "}") + 2, 999)
			listmax++
		}
	loop
	windowshadow = 1

*com_help_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_help_loop
	redraw 0
	s = "Elona In-Game Help", strhint2 + strhint3b
	if ( mode == MODELIST_CHARA_CREATION ) {
		display_window (windoww - 780) / 2 + inf_screenx, winposy(496, 1), 780, 496
	}
	else {
		display_window (windoww - 780) / 2 + inf_screenx, winposy(496) - 24, 780, 496
	}
	display_topic lang("項目", "Topic"), wx + 34, wy + 36
	if ( mode == MODELIST_CHARA_CREATION ) {
		p = 2
	}
	else {
		p = 4
	}
	cmbg = page \ 5
	x = ww / 5 * 2
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 4, wy + wh / 2
	grotate p, cmbg \ 4 * 180, cmbg / 4 \ 2 * 300, 0, x, y
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
	loop
	if ( cs_bk2 == 0 & page_bk == 0 ) {
		x = wx + 188
		y = wy + 6
		display_topic lang("アイテムに関するキー", "Item Keys"), x + 18, y + 30
		display_topic lang("行動に関するキー", "Action Keys"), x + 18, y + 142
		display_topic lang("情報に関するキー", "Information Keys"), x + 18, y + 256
		display_topic lang("その他のキー", "Other Keys"), x + 18, y + 328
		color 0, 0, 0
		s = "アイテムを取る(get)", key_get, "アイテムを置く(drop)", key_drop, "アイテムを調べる(examine)", key_inventory, "装備する(wear,wield)", key_wear, "食べる(eat)", key_eat
		s(10) = "飲む(quaff)", key_drink, "読む(read)", key_read, "振る(zap)", key_zap, "道具を使う(tool)", key_use, "調合(blend)", key_dip, "投げる(throw)", key_throw, "装填(ammo)", key_ammo
		gosub *convertHelp
		repeat 12
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 6 * 290, y + 58 + cnt \ 6 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 6 * 290, y + 57 + cnt \ 6 * 14
			mes s(cnt * 2 + 1)
		loop
		s = "周囲を調べる(search)", key_search, "魔法を唱える(cast)", key_cast, "干渉する(interact)", key_interact, "階段を降りる,入る(go down)", key_godown, "階段を昇る(go up)", key_goup
		s(10) = "その場で待機(wait)", key_wait, "ターゲットを指定(target)", key_target, "射撃する(fire)", key_fire, "能力を使う(apply)", key_skill, "体当たりする(bash)", key_bash, "穴を掘る(dig)", key_dig, "鍵を開ける(open)", key_open, "", ""
		gosub *convertHelp
		repeat 12
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 6 * 290, y + 170 + cnt \ 6 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 6 * 290, y + 169 + cnt \ 6 * 14
			mes s(cnt * 2 + 1)
		loop
		s = "能力・スキル情報(chara)", key_charainfo, "冒険日誌を表示(journal)", key_journal, "ヘルプを表示(help)", key_help, "メッセージログを表示(log)", key_msglog
		s(8) = "マテリアル表示(material)", key_material, "特徴の表示(feat)", key_trait
		gosub *convertHelp
		repeat 6
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 3 * 290, y + 284 + cnt \ 3 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 3 * 290, y + 283 + cnt \ 3 * 14
			mes s(cnt * 2 + 1)
		loop
		s = "セーブして終了(save)", key_save, "神に祈る(pray)", key_pray, "神に捧げる(offer)", key_offer, "ドアを閉める(close)", key_close, "与える(give)", key_give, "", "", ""
		gosub *convertHelp
		repeat 6
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
			pos x + 38 + cnt / 3 * 290, y + 356 + cnt \ 3 * 14
			mes s(cnt * 2)
			font lang(cfg_font1, cfg_font2), 15 - en * 2, 0
			pos x + 248 + cnt / 3 * 290, y + 355 + cnt \ 3 * 14
			mes s(cnt * 2 + 1)
		loop
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		pos x + 38, y + 408
		mes lang("F8 マップのエクスポート  F9 インタフェース非表示  F11 キャラ情報の出力\nF12 コンソールの表示", "F8 Export map  F9 Hide interface  F11 Export chara sheet\nF12 Console")
	}
	else {
		s(1) = listn(0, pagesize * page_bk + cs_bk2)
		display_topic s(1), wx + 206, wy + 36
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		p = list(0, pagesize * page_bk + cs_bk2)
		gmesx = wx + 216
		gmesy = wy + 60
		gmesw = 510
		gmescol = 30, 30, 30
		gmestype = 0
		repeat noteinfo(0) - p, p
			noteget s1, cnt
			i = instr(s1, 0, "{")
			if ( i != (-1) ) {
				break
			}
			gmes s1
		loop
	}
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		cs_list s, wx + 66, wy + 66 + cnt * 19 - 1, 19, 0
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if ( p != (-1) ) {
		snd SOUNDLIST_OK1
		page_bk = page
		cs_bk2 = cs
		goto *com_help_loop_pgchk
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_help_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_help_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		return
	}
	goto *com_help_loop

*com_chatlog
	curmenu = 2
	key_list(0) = key_enter
	keyrange = 0
	pagesize = 0
	redraw 0
	gsel BUFFER_PIC
	pos 0, 0
	picload_ exedir + "graphic\\ie_scroll.bmp"
	gsel BUFFER_SCREEN
	windowshadow = 1
	snd SOUNDLIST_SCROLL
	drawmenu 2
	ww = limit(windoww - 90, windoww - 90, 720)
	wh = 440
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	windowanime wx, wy, ww, wh, 10, 4
	s = lang("何かキーを押すと閉じる", "Hit any key to close")
	showscroll wx, wy, ww, wh
	net_read
	buff = ""
	notesel buff
	header = instr(netbuf, 0, "<!--START-->") + 13
	repeat
		s = ""
		tail = instr(netbuf, header, "%")
		if ( tail == (-1) ) {
			break
		}
		header += tail + 1
		tail = instr(netbuf, header, "%")
		s += strmid(netbuf, header, tail) + "  "
		header += tail + 1
		tail = instr(netbuf, header, "%")
		s += strmid(netbuf, header + 4, tail - 4)
		header += tail + 1
		tail = instr(netbuf, header, "%")
		header += tail + 2
		s += "\n"
		buff += "" + s
	loop
	font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
	color 30, 20, 10
	i = 0
	repeat 20
		if ( i >= 20 ) {
			break
		}
		noteget s, cnt
		if ( en ) {
			cnv_str s, "&quot;", "\""
		}
		if ( s == "" ) {
			if ( cnt == 0 ) {
				s = "No new messages received."
			}
			break
		}
		talk_conv s, (ww - 110 - en * 50) / 7
		i += stat
		pos wx + 48, (19 - i) * 16 + wy + 48
		mes s
		i++
	loop
	redraw 1

*com_chatlog_WHILE1
	await cfg_wait1
	key_check
	cursor_check
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 2 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 2
				}
			}
			key = ""
			if ( p != curmenu ) {
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					goto *com_log
				}
				if ( curmenu == 1 ) {
					goto *com_journal
				}
				if ( curmenu == 2 ) {
					goto *com_chatlog
				}
			}
		}
	}
	if ( key != "" ) {
		gosub *screen_draw
		goto *pc_turn
	}
	goto *com_chatlog_WHILE1

*com_log
	curmenu = 0
	windowshadow = 1
	key_list(0) = key_enter
	keyrange = 0
	pagesize = 0
	redraw 0
	wx = inf_msgx - 2
	wy = inf_msgy - (inf_maxlog - 3) * inf_msgspace - 1
	ww = windoww - inf_msgx + 6
	wh = (inf_maxlog - 3) * inf_msgspace, 1, -1
	snd SOUNDLIST_LOG
	showtitle lang("過去のメッセージ", "Log"), lang("何かキーを押すと閉じる", "Hit any key to close"), 236, 1
	drawmenu 2
	windowanimecorner wx, wy, ww, wh, 8, 4
	if ( cfg_exlog ) {
		p = (windoww - inf_msgx) / 192
		window2 wx, wy, ww, wh, 1, -1
		repeat inf_maxlog - 3
			cnt2 = cnt
			pos cnt
			repeat p + 1
				if ( cnt == p ) {
					x = (windoww - inf_msgx) \ 192
				}
				else {
					x = 192
				}
				pos cnt * 192 + inf_msgx, inf_msgy - (cnt2 + 1) * inf_msgspace
				gcopy BUFFER_INF, 496, 536 + cnt2 \ 4 * inf_msgspace, x, inf_msgspace
			loop
		loop
		repeat p + 1
			if ( cnt == p ) {
				sx = (windoww - inf_msgx) \ 192
			}
			else {
				sx = 192
			}
			pos cnt * 192 + inf_msgx, inf_msgy
			gcopy BUFFER_INF, 496, 528, sx, 6
		loop
		gsel BUFFER_BUF
		gmode 0
		color 0, 0, 0
		boxf
		repeat inf_maxlog - 3
			p = msgline - cnt - 3
			if ( p < 0 ) {
				p += inf_maxlog
			}
			else {
				if ( p >= inf_maxlog ) {
					p -= inf_maxlog
				}
			}
			if ( p < 0 ) {
				continue
			}
			pos inf_msgx, inf_msgy - cnt * inf_msgspace
			gcopy BUFFER_LOG, 0, p * inf_msgspace, windoww - inf_msgx, inf_msgspace
		loop
		gsel BUFFER_SCREEN
		gmode 2
		pos 0, -3
		gcopy BUFFER_BUF, 0, 0, windoww, inf_msgy
	}
	else {
		gsel BUFFER_BUF
		repeat 8
			pos cnt \ 4 * 180, cnt / 4 * 300
			picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
		loop
		gsel BUFFER_SCREEN
		s = lang("過去のメッセージ", "Log"), lang("何かキーを押すと閉じる", "Hit any key to close")
		x = windoww - 90
		display_window (windoww - x) / 2 + inf_screenx, winposy(432), x, 432
		display_topic lang("メッセージログの内容", "Message"), wx + 28, wy + 30
		cmbg++
		x = ww / 5 * 2
		y = wh - 80
		gmode 4, 180, 300, 50
		pos wx + ww / 4, wy + wh / 2
		grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
		gmode 2
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat 20
			p = msgline - cnt
			if ( p < 0 ) {
				p += inf_maxlog
			}
			else {
				if ( p >= inf_maxlog ) {
					p -= inf_maxlog
				}
			}
			if ( p < 0 ) {
				continue
			}
			pos wx + 28, (19 - cnt) * 16 + wy + 58
			mes msg(p)
		loop
	}
	redraw 1

*com_log_WHILE1
	await cfg_wait1
	key_check
	cursor_check
	if ( menucycle == 1 ) {
		if ( key == key_next | key == key_prev ) {
			p = curmenu
			if ( key == key_next ) {
				curmenu++
				if ( curmenu > 2 ) {
					curmenu = 0
				}
			}
			if ( key == key_prev ) {
				curmenu--
				if ( curmenu < 0 ) {
					curmenu = 2
				}
			}
			key = ""
			if ( p != curmenu ) {
				screenupdate = -1
				gosub *screen_draw
				if ( curmenu == 0 ) {
					goto *com_log
				}
				if ( curmenu == 1 ) {
					goto *com_journal
				}
				if ( curmenu == 2 ) {
					goto *com_chatlog
				}
			}
		}
	}
	if ( key != "" ) {
		if ( gArea  == AREA_PET_ARENA | gArea  == 49 ) {
			goto *pc_turn_init_WHILE1
		}
		gosub *screen_draw
		goto *pc_turn
	}
	goto *com_log_WHILE1

*config_init
	dim cfg_nc_charasheetdata, 8
	sdim key_buff, 4, 67
	dup key_identify, key_buff(2)
	dup key_pageup, key_buff(3)
	dup key_pagedown, key_buff(4)
	dup key_cancel, key_buff(5)
	dup key_help, key_buff(6)
	dup key_msglog, key_buff(7)
	dup key_enter, key_buff(8)
	dup key_save, key_buff(9)
	dup key_north, key_buff(10)
	dup key_northeast, key_buff(11)
	dup key_east, key_buff(12)
	dup key_southeast, key_buff(13)
	dup key_south, key_buff(14)
	dup key_southwest, key_buff(15)
	dup key_west, key_buff(16)
	dup key_northwest, key_buff(17)
	dup key_skill, key_buff(18)
	dup key_close, key_buff(19)
	dup key_cast, key_buff(20)
	dup key_drink, key_buff(22)
	dup key_read, key_buff(23)
	dup key_zap, key_buff(24)
	dup key_fire, key_buff(25)
	dup key_search, key_buff(26)
	dup key_target, key_buff(27)
	dup key_dig, key_buff(28)
	dup key_wait, key_buff(30)
	dup key_inventory, key_buff(31)
	dup key_drop, key_buff(32)
	dup key_get, key_buff(33)
	dup key_wipe, key_buff(34)
	dup key_charainfo, key_buff(35)
	dup key_eat, key_buff(36)
	dup key_wear, key_buff(37)
	dup key_godown, key_buff(38)
	dup key_goup, key_buff(39)
	dup key_interact, key_buff(40)
	dup key_rest, key_buff(41)
	dup key_use, key_buff(42)
	dup key_bash, key_buff(43)
	dup key_open, key_buff(44)
	dup key_dip, key_buff(45)
	dup key_pray, key_buff(46)
	dup key_offer, key_buff(47)
	dup key_journal, key_buff(48)
	dup key_material, key_buff(49)
	dup key_quick, key_buff(50)
	dup key_get2, key_buff(51)
	dup key_trait, key_buff(52)
	dup key_look, key_buff(53)
	dup key_give, key_buff(54)
	dup key_prev, key_buff(55)
	dup key_next, key_buff(56)
	dup key_quickinv, key_buff(57)
	dup key_throw, key_buff(58)
	dup key_esc, key_buff(59)
	dup key_alt, key_buff(60)
	dup key_mode, key_buff(61)
	dup key_ammo, key_buff(62)
	dup key_mode2, key_buff(63)
	dup key_title, key_buff(65)
	dup key_abysstitle, key_buff(66)
	dup key_haizinhelp, key_buff(67)
	sdim jkey, 2, 12
	return

*config_loadOmake
	key_title = "y"
	key_abysstitle = "Y"
	key_haizinhelp = "N"
	notesel note_buff
	if ( playerid != "" & cfg_nc_saveconfig ) {
		exist exedir + "\\save\\" + playerid + "\\" + "omake_config.txt"
		if ( strsize != (-1) ) {
			noteload exedir + "\\save\\" + playerid + "\\" + "omake_config.txt"
		}
		else {
			noteload exedir + "\\" + "omake_config.txt"
			notesave exedir + "\\save\\" + playerid + "\\" + "omake_config.txt"
		}
	}
	else {
		noteload exedir + "\\" + "omake_config.txt"
	}
	repeat noteinfo(0)
		noteget s, cnt
		if ( instr(s, 0, "key_haizinhelp.") != (-1) ) {
			setconfig
			key_haizinhelp = rtvaln
			continue
		}
		if ( instr(s, 0, "key_abysstitle.") != (-1) ) {
			setconfig
			key_abysstitle = rtvaln
			continue
		}
		if ( instr(s, 0, "key_title.") != (-1) ) {
			setconfig
			key_title = rtvaln
			continue
		}
		if ( instr(s, 0, "use_ffhp.") != (-1) ) {
			setconfig
			cfg_useffhp = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "user_face1.") != (-1) ) {
			setconfig
			cfg_userface1 = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "overcast_spell.") != (-1) ) {
			setconfig
			cfg_overcastspell = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "autopick.") != (-1) ) {
			setconfig
			cfg_autopick = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "autopick_sound.") != (-1) ) {
			setconfig
			cfg_autopicksound = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "autodestroy_sound.") != (-1) ) {
			setconfig
			cfg_autodestroysound = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "put_grass.") != (-1) ) {
			setconfig
			cfg_putgrass = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "card_game_off.") != (-1) ) {
			setconfig
			cfg_cg_off = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "showroom_server.") != (-1) ) {
			setconfig
			cfg_showroomserver = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "showroom_log.") != (-1) ) {
			setconfig
			cfg_showroomlog = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "moongate_jump.") != (-1) ) {
			setconfig
			cfg_moongatejump = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "improve_scroll.") != (-1) ) {
			setconfig
			cfg_improvescroll = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "data_copy.") != (-1) ) {
			setconfig
			cfg_datacopy = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "hostname.") != (-1) ) {
			setconfig
			cfg_hostname = rtvaln
			continue
		}
		if ( instr(s, 0, "graphic_pc.") != (-1) ) {
			setconfig
			cfg_graphicpc = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "graphic_npc.") != (-1) ) {
			setconfig
			cfg_graphicnpc = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "npc_walk.") != (-1) ) {
			setconfig
			cfg_npcwalk = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "reload_CNPC.") != (-1) ) {
			setconfig
			cfg_reloadcnpc = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "pick_number.") != (-1) ) {
			setconfig
			cfg_picknumber = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "transfer_number.") != (-1) ) {
			setconfig
			cfg_transfernumber = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "HP_gauge.") != (-1) ) {
			setconfig
			cfg_hpgauge = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "thousand_separation.") != (-1) ) {
			setconfig
			cfg_thousandsep = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "shortcut.") != (-1) ) {
			setconfig
			cfg_shortcut = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "camera.") != (-1) ) {
			setconfig
			cfg_camera = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "use_charaffhp.") != (-1) ) {
			setconfig
			cfg_usecharaffhp = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dump.") != (-1) ) {
			setconfig
			cfg_dump = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "guest.") != (-1) ) {
			setconfig
			cfg_guest = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "talk_convert.") != (-1) ) {
			setconfig
			cfg_talkconvert = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "key_cast_ancient.") != (-1) ) {
			setconfig
			cfg_key_cast_ancient = rtvaln
			continue
		}
		if ( instr(s, 0, "key_cast_another.") != (-1) ) {
			setconfig
			cfg_key_cast_another = rtvaln
			continue
		}
		if ( instr(s, 0, "stack_symbol.") != (-1) ) {
			setconfig
			cfg_stacksymbol = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "npcAttackAnime.") != (-1) ) {
			setconfig
			cfg_npcattackanime = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "key_godinfo.") != (-1) ) {
			setconfig
			cfg_key_godinfo = rtvaln
			continue
		}
		if ( instr(s, 0, "key_info.") != (-1) ) {
			setconfig
			cfg_key_info = rtvaln
			continue
		}
		if ( instr(s, 0, "key_autodig.") != (-1) ) {
			setconfig
			cfg_key_autodig = rtvaln
			continue
		}
		if ( instr(s, 0, "dmgMonitor0.") != (-1) ) {
			setconfig
			cfg_dmgmonitor0 = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgMonitorType.") != (-1) ) {
			setconfig
			cfg_dmgmonitortype = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgFont.") != (-1) ) {
			setconfig
			cfg_dmgfont = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgSpeed.") != (-1) ) {
			setconfig
			cfg_dmgspeed = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetEx.") != (-1) ) {
			setconfig
			cfg_targetex = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetBuff.") != (-1) ) {
			setconfig
			cfg_targetbuff = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetBullet.") != (-1) ) {
			setconfig
			cfg_targetbullet = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetResist.") != (-1) ) {
			setconfig
			cfg_targetresist = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetDebuff.") != (-1) ) {
			setconfig
			cfg_targetdebuff = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetStat.") != (-1) ) {
			setconfig
			cfg_targetstat = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetLockon.") != (-1) ) {
			setconfig
			cfg_targetlockon = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "sTrackEx.") != (-1) ) {
			setconfig
			cfg_strackex = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "sTrackGrow.") != (-1) ) {
			setconfig
			cfg_strackgrow = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "sTrackStock.") != (-1) ) {
			setconfig
			cfg_strackstock = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "equipEx.") != (-1) ) {
			setconfig
			cfg_equipex = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "fruitTrees.") != (-1) ) {
			setconfig
			cfg_fruittrees = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "petFaithExp.") != (-1) ) {
			setconfig
			cfg_petfaithexp = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "unLockExp.") != (-1) ) {
			setconfig
			cfg_unlockexp = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "petNegotiateExp.") != (-1) ) {
			setconfig
			cfg_petnegotiateexp = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "wonderScroll.") != (-1) ) {
			setconfig
			cfg_wonderscroll = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "noAutosave.") != (-1) ) {
			setconfig
			cfg_noautosave = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "alertStarvation.") != (-1) ) {
			setconfig
			cfg_alertstarvation = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "foodShop.") != (-1) ) {
			setconfig
			cfg_foodshop = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "proposeExclusion.") != (-1) ) {
			setconfig
			cfg_proposeexclusion = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgTxtType.") != (-1) ) {
			setconfig
			cfg_dmgtxttype = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "sndVolume.") != (-1) ) {
			setconfig
			cfg_sndvolume = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgMonitorSub1.") != (-1) ) {
			setconfig
			cfg_dmgmonitor1 = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgMonitorSub2.") != (-1) ) {
			setconfig
			cfg_dmgmonitor2 = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgMonitorSub3.") != (-1) ) {
			setconfig
			cfg_dmgmonitor3 = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "dmgMonitorSub4.") != (-1) ) {
			setconfig
			cfg_dmgmonitor4 = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "fontStyle.") != (-1) ) {
			setconfig
			cfg_fontstyle = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "petEquip.") != (-1) ) {
			setconfig
			cfg_petequip = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "welcomeMessage.") != (-1) ) {
			setconfig
			cfg_welcomemessage = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "teleportation.") != (-1) ) {
			setconfig
			cfg_teleportation = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "minimapEx.") != (-1) ) {
			setconfig
			cfg_minimapex = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "namescroll.") != (-1) ) {
			setconfig
			cfg_namescroll = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "offercorpse.") != (-1) ) {
			setconfig
			cfg_offercorpse = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "randomeventreplace.") != (-1) ) {
			setconfig
			cfg_randomeventreplace = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "MMA_pethpmonitor.") != (-1) ) {
			setconfig
			cfg_mma_pethpmonitor = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "shopselectskip.") != (-1) ) {
			setconfig
			cfg_shopselectskip = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "blessedfood.") != (-1) ) {
			setconfig
			cfg_blessedfood = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "youngersistervoice.") != (-1) ) {
			setconfig
			cfg_youngersistervoice = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "enchantvisualization.") != (-1) ) {
			setconfig
			cfg_enchantvisualization = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "treasuremachine.") != (-1) ) {
			setconfig
			cfg_treasuremachine = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "meatbunrecipe.") != (-1) ) {
			setconfig
			cfg_meatbunrecipe = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "showstamina.") != (-1) ) {
			setconfig
			cfg_showstamina = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "nolog.") != (-1) ) {
			setconfig
			cfg_nolog = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "offernumber.") != (-1) ) {
			setconfig
			cfg_offernumber = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "charaSheet.") != (-1) ) {
			setconfig
			cfg_charasheet = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "floormove.") != (-1) ) {
			setconfig
			cfg_floormove = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "notforsale.") != (-1) ) {
			setconfig
			cfg_notforsale = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "hideitem.") != (-1) ) {
			setconfig
			cfg_hideitem = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "petlead.") != (-1) ) {
			setconfig
			cfg_petlead = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "rapidmagic.") != (-1) ) {
			setconfig
			cfg_rapidmagic = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "txtpop.") != (-1) ) {
			setconfig
			cfg_txtpop = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "txtpopFont.") != (-1) ) {
			setconfig
			cfg_txtpopfont = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "txtpopSpeed.") != (-1) ) {
			setconfig
			cfg_txtpopspeed = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "txtpoptransparent.") != (-1) ) {
			setconfig
			cfg_txtpoptransparent = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "txtpopupdead.") != (-1) ) {
			setconfig
			cfg_txtpopupdead = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "pcc.") != (-1) ) {
			setconfig
			cfg_pcc = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "rndclass.") != (-1) ) {
			setconfig
			cfg_rndclass = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "npcposition.") != (-1) ) {
			setconfig
			cfg_npcposition = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "interactex.") != (-1) ) {
			setconfig
			cfg_interactex = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "targetclass.") != (-1) ) {
			setconfig
			cfg_targetclass = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_timeStopEffect.") != (-1) ) {
			setconfig
			cfg_st_timestopeffect = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_fishingAnimation.") != (-1) ) {
			setconfig
			cfg_st_fishinganimation = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_youngerSisterCorpse.") != (-1) ) {
			setconfig
			cfg_st_youngersistercorpse = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_enchantmentHumanreadable") != (-1) ) {
			setconfig
			cfg_st_enchantmenthumanreadable = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_attributesPotential") != (-1) ) {
			setconfig
			cfg_st_attributespotential = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_displayHammerLevel") != (-1) ) {
			setconfig
			cfg_st_displayhammerlevel = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_displayLivingweaponLevel") != (-1) ) {
			setconfig
			cfg_st_displaylivingweaponlevel = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_moreSeparation") != (-1) ) {
			setconfig
			cfg_st_moreseparation = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_exchangeCrawlUpOrBuried") != (-1) ) {
			setconfig
			cfg_st_exchangecrawluporburied = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_sortByExpirationDate") != (-1) ) {
			setconfig
			cfg_st_sortbyexpirationdate = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_oo2016CompatibleDancerFeat") != (-1) ) {
			setconfig
			cfg_st_oo2016compatibledancerfeat = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ST_shortcut") != (-1) ) {
			setconfig
			cfg_st_shortcut = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_stateshorten.") != (-1) ) {
			setconfig
			cfg_nc_stateshorten = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_aphrodisiac.") != (-1) ) {
			setconfig
			cfg_nc_aphrodisiac = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_reincarnation.") != (-1) ) {
			setconfig
			cfg_nc_reincarnation = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_contractarart.") != (-1) ) {
			setconfig
			cfg_nc_contractarart = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_starvearart.") != (-1) ) {
			setconfig
			cfg_nc_starvearart = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_qsave.") != (-1) ) {
			setconfig
			cfg_nc_qsave = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_itemcount.") != (-1) ) {
			setconfig
			cfg_nc_itemcount = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_wish.") != (-1) ) {
			setconfig
			cfg_nc_wish = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_workshortening.") != (-1) ) {
			setconfig
			cfg_nc_workshortening = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_saveconfig.") != (-1) ) {
			setconfig
			cfg_nc_saveconfig = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_logapply.") != (-1) ) {
			setconfig
			cfg_nc_logapply = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_praypoint.") != (-1) ) {
			setconfig
			cfg_nc_praypoint = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_directmoney.") != (-1) ) {
			setconfig
			cfg_nc_directmoney = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_displayblesseddishes.") != (-1) ) {
			setconfig
			cfg_nc_displayblesseddishes = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_notshowzero.") != (-1) ) {
			setconfig
			cfg_nc_notshowzero = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_charasheet.") != (-1) ) {
			setconfig
			cfg_nc_charasheet = int(rtvaln)
			continue
		}
		repeat 8
			if ( instr(s, 0, "NC_charasheetdata" + cnt + ".") != (-1) ) {
				setconfig
				cfg_nc_charasheetdata(cnt) = int(rtvaln)
				continue
			}
		loop
		if ( instr(s, 0, "NC_detail.") != (-1) ) {
			setconfig
			cfg_nc_detail = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_sstp_enabled.") != (-1) ) {
			setconfig
			cfg_nc_sstp_enabled = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_sstp_sakura.") != (-1) ) {
			setconfig
			cfg_nc_sstp_sakura = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_sstp_unyu.") != (-1) ) {
			setconfig
			cfg_nc_sstp_unyu = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_sstp_suppresslog.") != (-1) ) {
			setconfig
			cfg_nc_sstp_suppresslog = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_sstp_notifyevent.") != (-1) ) {
			setconfig
			cfg_nc_sstp_notifyevent = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_sstp_nowait.") != (-1) ) {
			setconfig
			cfg_nc_sstp_nowait = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_key_music.") != (-1) ) {
			setconfig
			cfg_nc_key_music = rtvaln
			continue
		}
		if ( instr(s, 0, "key_mode3.") != (-1) ) {
			setconfig
			key_mode3 = rtvaln
			continue
		}
		if ( instr(s, 0, "NC_key_macro.") != (-1) ) {
			setconfig
			cfg_nc_key_macro = rtvaln
			continue
		}
		if ( instr(s, 0, "NC_NoSeasonalEvent.") != (-1) ) {
			setconfig
			cfg_nc_noseasonalevent = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "NC_sstp_server.") != (-1) ) {
			setconfig
			cfg_nc_sstp_server = rtvaln
			continue
		}
		if ( instr(s, 0, "NC_sstp_port.") != (-1) ) {
			setconfig
			cfg_nc_sstp_port = int(rtvaln)
			continue
		}
	loop
	return

*config_loadCore
	key_select = "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "A", "B", "C", "D"
	notesel note_buff
	if ( playerid != "" & cfg_nc_saveconfig ) {
		exist exedir + "\\save\\" + playerid + "\\config.txt"
		if ( strsize != (-1) ) {
			noteload exedir + "\\save\\" + playerid + "\\config.txt"
		}
		else {
			noteload exedir + "\\config.txt"
			notesave exedir + "\\save\\" + playerid + "\\config.txt"
		}
	}
	else {
		noteload exedir + "\\config.txt"
	}
	repeat noteinfo(0)
		noteget s, cnt
		if ( instr(s, 0, "language.") != (-1) ) {
			setconfig
			cfg_language = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "fullscreen.") != (-1) ) {
			setconfig
			cfg_fullscreen = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "music.") != (-1) ) {
			setconfig
			cfg_music = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "sound.") != (-1) ) {
			setconfig
			cfg_sound = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "extraRace.") != (-1) ) {
			setconfig
			cfg_extrarace = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "joypad.") != (-1) ) {
			setconfig
			cfg_joypad = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "msg_box.") != (-1) ) {
			setconfig
			cfg_msg_box = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "msgLine.") != (-1) ) {
			setconfig
			inf_msgline = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "tileSize.") != (-1) ) {
			setconfig
			inf_tiles = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "fontSize .") != (-1) ) {
			setconfig
			inf_mesfont = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "infVerType.") != (-1) ) {
			setconfig
			inf_vertype = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "windowX.") != (-1) ) {
			setconfig
			windowx = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "windowY.") != (-1) ) {
			setconfig
			windowy = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "windowW.") != (-1) ) {
			setconfig
			windoww = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "windowH.") != (-1) ) {
			setconfig
			windowh = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "clockX.") != (-1) ) {
			setconfig
			inf_clockx = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "clockW.") != (-1) ) {
			setconfig
			inf_clockw = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "clockH.") != (-1) ) {
			setconfig
			inf_clockh = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "defLoadFolder.") != (-1) ) {
			setconfig
			defload = rtvaln
			continue
		}
		if ( instr(s, 0, "charamake_wiz.") != (-1) ) {
			setconfig
			cfg_wizard = int(rtvaln)
			continue
		}
	loop
	return

*config_load
	procid = (procid + 1) \ 10
	proclist(procid) = "Load config" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	notesel note_buff
	if ( playerid != "" & cfg_nc_saveconfig ) {
		exist exedir + "\\save\\" + playerid + "\\config.txt"
		if ( strsize != (-1) ) {
			noteload exedir + "\\save\\" + playerid + "\\config.txt"
		}
		else {
			noteload exedir + "\\config.txt"
			notesave exedir + "\\save\\" + playerid + "\\config.txt"
		}
	}
	else {
		noteload exedir + "\\config.txt"
	}
	repeat noteinfo(0)
		noteget s, cnt
		if ( instr(s, 0, "key_sCancel.") != (-1) ) {
			setconfig
			cfg_scancel = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "alert_wait.") != (-1) ) {
			setconfig
			cfg_alert = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "anime_wait.") != (-1) ) {
			setconfig
			cfg_animewait = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "ignoreDislike.") != (-1) ) {
			setconfig
			cfg_ignoredislike = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "wait1.") != (-1) ) {
			setconfig
			cfg_wait1 = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "font1.") != (-1) ) {
			setconfig
			cfg_font1 = rtvaln
			continue
		}
		if ( instr(s, 0, "font2.") != (-1) ) {
			setconfig
			cfg_font2 = rtvaln
			continue
		}
		if ( instr(s, 0, "fontVfix1.") != (-1) ) {
			setconfig
			vfix = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "fontSfix1.") != (-1) ) {
			setconfig
			sizefix = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "story.") != (-1) ) {
			setconfig
			cfg_story = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "heartbeat.") != (-1) ) {
			setconfig
			cfg_heart = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "extraHelp.") != (-1) ) {
			setconfig
			cfg_extrahelp = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "alwaysCenter.") != (-1) ) {
			setconfig
			cfg_alwayscenter = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "scroll.") != (-1) ) {
			setconfig
			cfg_scroll = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "startRun.") != (-1) ) {
			setconfig
			cfg_startrun = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "walkWait.") != (-1) ) {
			setconfig
			cfg_walkwait = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "runWait.") != (-1) ) {
			setconfig
			cfg_runwait = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "autoTurnType.") != (-1) ) {
			setconfig
			cfg_autoturn = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "autoNumlock.") != (-1) ) {
			setconfig
			cfg_autonumlock = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "attackWait.") != (-1) ) {
			setconfig
			cfg_attackwait = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "attackAnime.") != (-1) ) {
			setconfig
			cfg_attackanime = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "envEffect.") != (-1) ) {
			setconfig
			cfg_env = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "titleEffect.") != (-1) ) {
			setconfig
			cfg_titleeffect = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "net.") != (-1) ) {
			setconfig
			cfg_net = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "netWish.") != (-1) ) {
			setconfig
			cfg_netwish = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "netChat.") != (-1) ) {
			setconfig
			cfg_netchat = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "serverList.") != (-1) ) {
			setconfig
			cfg_serverlist = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "shadow.") != (-1) ) {
			setconfig
			cfg_shadow = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "objectShadow.") != (-1) ) {
			setconfig
			cfg_objectshadow = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "windowAnime.") != (-1) ) {
			setconfig
			cfg_windowanime = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "exAnime.") != (-1) ) {
			setconfig
			cfg_exanime = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "showSkillMod.") != (-1) ) {
			setconfig
			cfg_showskillmod = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "hide_autoIdentify.") != (-1) ) {
			setconfig
			cfg_hideautoidentify = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "hide_shopResult.") != (-1) ) {
			setconfig
			cfg_hideshopresult = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "msg_trans.") != (-1) ) {
			setconfig
			cfg_msgtrans = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "msg_addTime.") != (-1) ) {
			setconfig
			cfg_msgaddtime = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "key_cancel.") != (-1) ) {
			setconfig
			key_cancel = rtvaln
			jkey(int(rtvaln(1))) = key_cancel
			continue
		}
		if ( instr(s, 0, "key_esc.") != (-1) ) {
			setconfig
			key_esc = rtvaln
			jkey(int(rtvaln(1))) = key_esc
			continue
		}
		if ( instr(s, 0, "key_alter.") != (-1) ) {
			setconfig
			key_alter = rtvaln
			jkey(int(rtvaln(1))) = key_alter
			continue
		}
		if ( instr(s, 0, "key_north.") != (-1) ) {
			setconfig
			key_north = rtvaln
			continue
		}
		if ( instr(s, 0, "key_south.") != (-1) ) {
			setconfig
			key_south = rtvaln
			continue
		}
		if ( instr(s, 0, "key_west.") != (-1) ) {
			setconfig
			key_west = rtvaln
			continue
		}
		if ( instr(s, 0, "key_east.") != (-1) ) {
			setconfig
			key_east = rtvaln
			continue
		}
		if ( instr(s, 0, "key_northwest.") != (-1) ) {
			setconfig
			key_northwest = rtvaln
			continue
		}
		if ( instr(s, 0, "key_northeast.") != (-1) ) {
			setconfig
			key_northeast = rtvaln
			continue
		}
		if ( instr(s, 0, "key_southwest.") != (-1) ) {
			setconfig
			key_southwest = rtvaln
			continue
		}
		if ( instr(s, 0, "key_southeast.") != (-1) ) {
			setconfig
			key_southeast = rtvaln
			continue
		}
		if ( instr(s, 0, "key_wait.") != (-1) ) {
			setconfig
			key_wait = rtvaln
			continue
		}
		if ( instr(s, 0, "key_inventory.") != (-1) ) {
			setconfig
			key_inventory = rtvaln
			continue
		}
		if ( instr(s, 0, "key_help.") != (-1) ) {
			setconfig
			key_help = rtvaln
			jkey(int(rtvaln(1))) = key_help
			continue
		}
		if ( instr(s, 0, "key_msglog.") != (-1) ) {
			setconfig
			key_msglog = rtvaln
			continue
		}
		if ( instr(s, 0, "key_pageup.") != (-1) ) {
			setconfig
			key_pageup = rtvaln
			continue
		}
		if ( instr(s, 0, "key_pagedown.") != (-1) ) {
			setconfig
			key_pagedown = rtvaln
			continue
		}
		if ( instr(s, 0, "key_get.") != (-1) ) {
			setconfig
			key_get = rtvaln
			jkey(int(rtvaln(1))) = key_get
			continue
		}
		if ( instr(s, 0, "key_get2.") != (-1) ) {
			setconfig
			key_get2 = rtvaln
			continue
		}
		if ( instr(s, 0, "key_drop.") != (-1) ) {
			setconfig
			key_drop = rtvaln
			continue
		}
		if ( instr(s, 0, "key_charainfo.") != (-1) ) {
			setconfig
			key_charainfo = rtvaln
			jkey(int(rtvaln(1))) = key_charainfo
			continue
		}
		if ( instr(s, 0, "key_enter.") != (-1) ) {
			setconfig
			key_enter = rtvaln
			jkey(int(rtvaln(1))) = key_enter
			continue
		}
		if ( instr(s, 0, "key_eat.") != (-1) ) {
			setconfig
			key_eat = rtvaln
			continue
		}
		if ( instr(s, 0, "key_wear.") != (-1) ) {
			setconfig
			key_wear = rtvaln
			continue
		}
		if ( instr(s, 0, "key_cast.") != (-1) ) {
			setconfig
			key_cast = rtvaln
			continue
		}
		if ( instr(s, 0, "key_drink.") != (-1) ) {
			setconfig
			key_drink = rtvaln
			continue
		}
		if ( instr(s, 0, "key_read.") != (-1) ) {
			setconfig
			key_read = rtvaln
			continue
		}
		if ( instr(s, 0, "key_zap.") != (-1) ) {
			setconfig
			key_zap = rtvaln
			continue
		}
		if ( instr(s, 0, "key_fire.") != (-1) ) {
			setconfig
			key_fire = rtvaln
			jkey(int(rtvaln(1))) = key_fire
			continue
		}
		if ( instr(s, 0, "key_goDown.") != (-1) ) {
			setconfig
			key_godown = rtvaln
			continue
		}
		if ( instr(s, 0, "key_goUp.") != (-1) ) {
			setconfig
			key_goup = rtvaln
			continue
		}
		if ( instr(s, 0, "key_save.") != (-1) ) {
			setconfig
			key_save = rtvaln
			continue
		}
		if ( instr(s, 0, "key_search.") != (-1) ) {
			setconfig
			key_search = rtvaln
			continue
		}
		if ( instr(s, 0, "key_interact.") != (-1) ) {
			setconfig
			key_interact = rtvaln
			continue
		}
		if ( instr(s, 0, "key_identify.") != (-1) ) {
			setconfig
			key_identify = rtvaln
			continue
		}
		if ( instr(s, 0, "key_skill.") != (-1) ) {
			setconfig
			key_skill = rtvaln
			continue
		}
		if ( instr(s, 0, "key_close.") != (-1) ) {
			setconfig
			key_close = rtvaln
			continue
		}
		if ( instr(s, 0, "key_rest.") != (-1) ) {
			setconfig
			key_rest = rtvaln
			continue
		}
		if ( instr(s, 0, "key_target.") != (-1) ) {
			setconfig
			key_target = rtvaln
			jkey(int(rtvaln(1))) = key_target
			continue
		}
		if ( instr(s, 0, "key_dig.") != (-1) ) {
			setconfig
			key_dig = rtvaln
			continue
		}
		if ( instr(s, 0, "key_use.") != (-1) ) {
			setconfig
			key_use = rtvaln
			continue
		}
		if ( instr(s, 0, "key_bash.") != (-1) ) {
			setconfig
			key_bash = rtvaln
			continue
		}
		if ( instr(s, 0, "key_open.") != (-1) ) {
			setconfig
			key_open = rtvaln
			continue
		}
		if ( instr(s, 0, "key_dip.") != (-1) ) {
			setconfig
			key_dip = rtvaln
			continue
		}
		if ( instr(s, 0, "key_pray.") != (-1) ) {
			setconfig
			key_pray = rtvaln
			continue
		}
		if ( instr(s, 0, "key_offer.") != (-1) ) {
			setconfig
			key_offer = rtvaln
			continue
		}
		if ( instr(s, 0, "key_journal.") != (-1) ) {
			setconfig
			key_journal = rtvaln
			continue
		}
		if ( instr(s, 0, "key_material.") != (-1) ) {
			setconfig
			key_material = rtvaln
			continue
		}
		if ( instr(s, 0, "key_quick.") != (-1) ) {
			setconfig
			key_quick = rtvaln
			jkey(int(rtvaln(1))) = key_quick
			continue
		}
		if ( instr(s, 0, "key_trait.") != (-1) ) {
			setconfig
			key_trait = rtvaln
			continue
		}
		if ( instr(s, 0, "key_look.") != (-1) ) {
			setconfig
			key_look = rtvaln
			continue
		}
		if ( instr(s, 0, "key_give.") != (-1) ) {
			setconfig
			key_give = rtvaln
			continue
		}
		if ( instr(s, 0, "key_throw.") != (-1) ) {
			setconfig
			key_throw = rtvaln
			continue
		}
		if ( instr(s, 0, "key_mode.") != (-1) ) {
			setconfig
			key_mode = rtvaln
			continue
		}
		if ( instr(s, 0, "key_mode2.") != (-1) ) {
			setconfig
			key_mode2 = rtvaln
			continue
		}
		if ( instr(s, 0, "key_ammo.") != (-1) ) {
			setconfig
			key_ammo = rtvaln
			jkey(int(rtvaln(1))) = key_ammo
			continue
		}
		if ( instr(s, 0, "key_quickinv.") != (-1) ) {
			setconfig
			key_quickinv = rtvaln
			jkey(int(rtvaln(1))) = key_quickinv
			continue
		}
		if ( instr(s, 0, "zkey.") != (-1) ) {
			setconfig
			cfg_zkey = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "xkey.") != (-1) ) {
			setconfig
			cfg_xkey = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "scr_sync.") != (-1) ) {
			setconfig
			cfg_scrsync = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "scroll_run.") != (-1) ) {
			setconfig
			cfg_runscroll = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "skipRandEvents.") != (-1) ) {
			setconfig
			cfg_skiprandevents = int(rtvaln)
			continue
		}
		key_prev = key_northwest
		key_next = key_northeast
		if ( instr(s, 0, "key_set.") != (-1) ) {
			p = 0
			p(1) = 0
			repeat
				await
				if ( instr(s, p, ",") == (-1) ) {
					break
				}
				p += instr(s, p, ",") + 1
				key_select(p(1)) = strmid(s, p, 1)
				p(1)++
			loop
		}
	loop
	f = 0
	if ( cfg_zkey == 0 ) {
		key_quick = "z"
		key_zap = "Z"
	}
	else {
		if ( cfg_zkey == 1 ) {
			key_zap = "z"
			key_quick = "Z"
		}
	}
	if ( cfg_xkey == 0 ) {
		key_quickinv = "x"
		key_inventory = "X"
	}
	else {
		if ( cfg_xkey == 1 ) {
			key_inventory = "x"
			key_quickinv = "X"
		}
	}
	if ( cfg_scrsync == 0 ) {
		cfg_scrsync = 3
	}
	if ( cfg_walkwait == 0 ) {
		cfg_walkwait = 5
	}
	if ( cfg_runwait < 1 ) {
		cfg_runwait = 1
	}
	if ( cfg_attackwait < 1 ) {
		cfg_attackwait = 1
	}
	if ( cfg_startrun >= 20 ) {
		cfg_startrun = 1000
	}


	if ( cfg_language == (-1) ) {
		redraw 0
		buffer BUFFER_BUF
		picload_ exedir + "graphic\\lang.bmp"
		gsel BUFFER_SCREEN
		gmode 0
		p = 0
*config_load_WHILE1
		redraw 0
		color 0, 0, 0
		boxf
		pos 160, 170
		gcopy BUFFER_BUF, 0, 0, 340, 100
		pos 180, 220 + p * 20
		gcopy BUFFER_BUF, 360, 6, 20, 18
		redraw 1
		await 30
		getkey a, 40
		if ( a ) {
			p = 1
		}
		getkey a, 98
		if ( a ) {
			p = 1
		}
		getkey a, 38
		if ( a ) {
			p = 0
		}
		getkey a, 104
		if ( a ) {
			p = 0
		}
		getkey a, 13
		if ( a ) {
			goto *cfg_write
		}
		getkey a, 32
		if ( a ) {
			goto *cfg_write
		}
		goto *config_load_WHILE1
*cfg_write
		cfg_language = p
		config_savevanillaoption "language.", "" + p
		redraw 0
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "Fix config" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( cfg_language == 0 ) {
		jp = 1
		vfix = 0
		sizefix = 0
	}
	else {
		en = 1
	}
	if ( key_mode == "" ) {
		key_mode = "z"
		f = 1
		noteadd "key_mode.\t\"z\""
	}
	if ( key_mode2 == "" ) {
		key_mode2 = "*"
		f = 1
		noteadd "key_mode2.\t\"*\""
	}
	if ( key_ammo == "" ) {
		key_ammo = "A"
		f = 1
		noteadd "key_ammo.\t\"A\""
	}
	if ( f ) {
		if ( playerid != "" & cfg_nc_saveconfig ) {
			notesave exedir + "\\save\\" + playerid + "\\config.txt"
		}
		else {
			notesave exedir + "\\config.txt"
		}
	}
	return

*dump_config
	notesel note_buff
	noteload exedir + "\\user\\export.txt"
	usertitle = ""
	usermsg = ""
	userpassword = "nyaa"
	repeat noteinfo(0)
		noteget s, cnt
		if ( instr(s, 0, "room_title.") != (-1) ) {
			setconfig
			usertitle = rtvaln
			continue
		}
		if ( instr(s, 0, "welcome_msg.") != (-1) ) {
			setconfig
			usermsg = rtvaln
			continue
		}
		if ( instr(s, 0, "pet_relation.") != (-1) ) {
			setconfig
			userrelation = int(rtvaln)
			continue
		}
		if ( instr(s, 0, "password.") != (-1) ) {
			setconfig
			userpassword = rtvaln
			continue
		}
	loop
	return

*dump_config_import
	notesel headtemp
	noteget s, 1
	username = "" + s
	noteget s, 5
	usermsg = "" + s
	noteget s, 6
	userrelation = int(s)
	return
	goto *com_config

#defcfunc cnvjkey str cnvjkey_arg1
	locvar_cnvjkey_p = -2
	repeat 12
		if ( cnvjkey_arg1 == jkey(cnt) ) {
			locvar_cnvjkey_p = cnt
			break
		}
	loop
	return locvar_cnvjkey_p + 1

*com_config
	if ( cfg_pcc == 2 ) {
		cfg_pcc = 1
	}
	listmax = 0
	page = 0
	pagesize = 18
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	page_bk = 0
	cs_bk2 = 0
	cfg_sound2 = cfg_sound
	cfg_music2 = cfg_music
	cfg_fullscreen2 = cfg_fullscreen
	windoww2 = windoww
	windowh2 = windowh
	if ( mode == MODELIST_TITLE ) {
		sel = 2
	}
	else {
		sel = 4
	}
	gsel sel
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	redraw 0
	if ( mode == MODELIST_MAIN ) {
		screenupdate = -1
		gosub *screen_draw
	}
	if ( mode == MODELIST_TITLE ) {
		gsel BUFFER_BUF
		gmode 0
		pos 0, 0
		picload_ exedir + "\\graphic\\title.bmp", 1
		gzoom windoww, windowh, 4, 0, 0, 800, 600
		gsel BUFFER_SCREEN
		gmode 0
		pos 0, 0
		gcopy BUFFER_BUF, 0, 0, windoww, windowh
		gmode 2
	}
	sdim configdetail, 256, 20
	configdetail = "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""
	if ( submenu == 0 ) {
		if ( jp ) {
			q = "オプション"
			s = "ゲームの設定", "画面と音の設定", "ネット機能の設定", "詳細な設定", "ゲームパッド", "メッセージとログ", "言語(Language)", "拡張設定1", "拡張設定2", "拡張設定3(表示)", "拡張設定4(表示)", "拡張設定5(システム)", "拡張設定6(SE)", "拡張設定7(ST)", "拡張設定8(NC)", "拡張設定9(NCキャラシ)", "拡張設定10(伺か)", ""
		}
		if ( en ) {
			q = "Option"
			s = "Game Setting", "Screen & Sound", "Network Setting", "Detailed Setting", "Game Pad", "Message & Log", "Language", "EX Setting 1", "EX Setting 2", "EX Setting 3(Display 1)", "EX Setting 4(Display 2)", "EX Setting 5(System)", "EX Setting 6(SE)", "EX Setting 7(ST)", "EX Setting 8(NC)", "EX Setting 9(NC)", "EX Setting 10(Ukagaka)", ""
		}
		dx = 370
		dy = 510
	}
	if ( submenu == 1 ) {
		if ( jp ) {
			q = "ゲームの設定"
			s = "ノルンの冒険ガイド", "非好戦的NPCを無視", "zキーの割当て", "xキーの割当て", "走り始める歩数", "歩きの速さ", "攻撃の間隔", "アニメウェイト", "アラートウェイト", ""
		}
		if ( en ) {
			q = "Game Setting"
			s = "Extra Help", "Neutral Npcs", "Assign z key", "Assign x key", "Start Running After", "Walk Speed", "Attack Interval", "Anime Wait", "Alert Wait", ""
		}
		configdetail(0) = lang("Elonaに不慣れな冒険者に向けて妖精ノルンによる案内が表示されます。", "Show extra help popups for new players.")
		configdetail(1) = lang("中立NPCに向かって歩いたとき、そのNPCに対して攻撃しません。", "Do not attack non-hostile, non-ally NPCs when running into them.")
		configdetail(2) = lang("[z]キーに割り当てられた機能を変更します。", "Change the assignment of the 'z' key.")
		configdetail(3) = lang("[x]キーに割り当てられた機能を変更します。", "Change the assignment of the 'x' key.")
		configdetail(4) = lang("歩いている状態から走り始めるまでの歩数を設定します。", "Number of movement commands to play when walking before starting to run.")
		configdetail(5) = lang("1マス歩くのに掛かる時間を設定します。値が小さいほど早く歩きます。", "Number of frames to wait between movement commands when walking.")
		configdetail(6) = lang("連続した攻撃を繰り出すときの間隔を設定します。", "Number of frames to wait between consecutive attacks when running into enemies.")
		configdetail(7) = lang("アニメーションの長さを設定します。", "Number of frames to wait for animations.")
		configdetail(8) = lang("重要なメッセージが表示された際のウェイトの長さを設定します。", "Number of frames to wait if an important message is received.")
		dx = 440
		dy = 340
	}
	if ( submenu == 2 ) {
		if ( jp ) {
			q = "画面と音の設定"
			s = "サウンドの再生*", "midiの再生*", "画面モード*", "画面の大きさ*", "スクロール", "主人公中心に描写", "心臓の音", "攻撃時アニメ", "天候エフェクト", "光源の描写", "アイテムの影描写", ""
		}
		if ( en ) {
			q = "Screen & Sound"
			s = "Sound*", "Music*", "Screen Mode*", "Screen Resolution*", "Smooth Scroll", "Always Center", "Heartbeat Sound", "Attack Animation", "Weather Effect", "Lighting", "Object Shadow", ""
		}
		configdetail(0) = lang("効果音の再生方式を設定します。", "Sound mode to use.")
		configdetail(1) = lang("BGMの再生方式を設定します。", "Music mode to use.")
		configdetail(2) = lang("ゲームウィンドウの表示方式を設定します。", "Screen mode to use.")
		configdetail(3) = lang("ゲーム画面の解像度を設定します。", "Screen resolution to use.")
		configdetail(4) = lang("PCが動くときスクロールアニメーションを表示します。", "Enable scrolling animations.")
		configdetail(5) = lang("常にPCを中心として描写を行います。", "Always keep the center of the screen near the player when walking near the edge of the screen.")
		configdetail(6) = lang("HPが残り少ないとき、心拍音を再生します。", "Play heartbeat sound when health is low. ")
		configdetail(7) = lang("物理攻撃した際にアニメーションを表示します。", "Play animations when melee/ranged attacking.")
		configdetail(8) = lang("天候に関わるアニメーションを表示します。", "Play weather-related animations.")
		configdetail(9) = lang("光源の描写の精度を設定します。", "Render shadows at higher quality.")
		configdetail(10) = lang("アイテムの影の描写有無を設定します。", "Display shadows under items on the ground.")
		dx = 440
		dy = 370
	}
	if ( submenu == 3 ) {
		if ( jp ) {
			q = "ネット機能の設定"
			s = "ネットの使用", "定期的に接続", "チャットをフィルタ", ""
		}
		if ( en ) {
			q = "Network Setting"
			s = "Use Network", "Constantly Connect", "Filter Chat", ""
		}
		dx = 440
		dy = 300
	}
	if ( submenu == 4 ) {
		if ( jp ) {
			q = "詳細な設定"
			s = "走りの速さ", "numlockを自動制御", "タイトルの水の波紋", "画面の更新頻度", "走り時スクロール", "オートターンの挙動", "イベントの短縮", ""
		}
		if ( en ) {
			q = "Detailed Setting"
			s = "Run Speed", "Auto Numlock", "Title Water Effect", "Screen Refresh", "Scroll When Run", "Auto Turn Speed", "Skip Random Events", ""
		}
		dx = 440
		dy = 300
	}
	if ( submenu == 5 ) {
		if ( jp ) {
			q = "ゲームパッド"
			s = "ゲームパッド", "決定キー", "キャンセルキー", "所持品", "行動", "斜め移動(L)", "拾う(R)", "射撃(R)", "目標(L)", "ポーズメニュー", "ヘルプ", "キャラ情報", "装填", ""
		}
		if ( en ) {
			q = "Game Pad"
			s = "Game Pad", "Enter/Ok", "Cancel", "Inventory", "Action", "diagonal Move/(L)", "Pick/(R)", "Shoot/(R)", "Target/(L)", "Pause/Menu", "Help", "Chara-sheet", "Reload", ""
		}
		dx = 440
		dy = 430
	}
	if ( submenu == 6 ) {
		if ( jp ) {
			q = "メッセージとログ"
			s = "ﾒｯｾｰｼﾞに分表示追加", "過去のﾒｯｾｰｼﾞの透過", ""
		}
		if ( en ) {
			q = "Message&Log"
			s = "Add time info", "Transparency", ""
		}
		dx = 440
		dy = 300
	}
	if ( submenu == 7 ) {
		if ( jp ) {
			q = "言語(Language)"
			s = "言語*", ""
		}
		if ( en ) {
			q = "Language"
			s = "Language*", ""
		}
		dx = 440
		dy = 300
	}
	if ( submenu == 8 ) {
		if ( jp ) {
			q = "拡張設定1"
			s = "拡張アイテムチップ*", "拡張ポートレート", "マナ不足時の警告", "自動拾い＆自動破壊", "自動拾い時の効果音", "自動破壊時の効果音", "ショウルームサーバー", "ショウルームログ", "ムーンゲートジャンプ", "なめらかにスクロール", "一時ファイルのコピー", "歩行グラ(PC)", "歩行グラ(ペット)", "ペットの歩行グラアニメ", "CNPC等の再読み込み", ""
		}
		if ( en ) {
			q = "EX Setting 1"
			s = "Itemchip extend*", "Portrait extend", "Overcast warning", "Auto pickup & destroy", "Autopick sound", "Autodestroy sound", "Showroom server", "Log showroom visit", "Moon gate control", "Smooth scroll", "Filecopy method", "PCC graphic(PC)", "PCC graphic(Pets)", "Animation basis(Pets)", "Reload custom files", ""
		}
		dx = 440
		dy = 430
	}
	if ( submenu == 9 ) {
		if ( jp ) {
			q = "拡張設定2"
			s = "拾うときの個数選択", "授受のときの個数選択", "ペットのHPゲージ表示", "gp、ppの3桁区切り", "カメラ撮影", "拡張キャラチップ*", "キャラ情報出力", "帰宅時の来客", "台詞の変換", "スタック表示", "攻撃アニメーション", ""
		}
		if ( en ) {
			q = "EX Setting 2"
			s = "Query pick number", "Query give/take number", "Show gauge(Pet's HP)", "Use comma(gp/pp)", "Camera photography", "Charachip extend*", "Character sheet output", "Inform guest visitors", "Change dialogues", "Show stocks", "Attack animation", ""
		}
		dx = 440
		dy = 430
	}
	if ( submenu == 10 ) {
		if ( jp ) {
			q = "拡張設定3(表示)"
			s = "ダメージ表示", "　表示方法", "　　HEX+バフ", "　　状態異常", "　　回避", "　　〜発動を発動する", "　フォントサイズ", "　表示速度", "セリフポップアップ", "　フォントサイズ", "　表示速度", "　透明度", "　断末魔", "0ダメージを表示", ""
		}
		if ( en ) {
			q = "EX Setting 3(Display 1)"
			s = "Damage popup", "  Multi-attack style", "    Hexes/Buffs", "    Ailments", "    Evade", "    Invokes", "  Font size", "  Displayed duration", "Speech balloon", "  Font size", "  Displayed duration", "  Transparency", "  Last words", "Show 0 Damage", ""
		}
		dx = 440
		dy = 430
	}
	if ( submenu == 11 ) {
		if ( jp ) {
			q = "拡張設定4(表示)"
			s = "ターゲット表示拡張", "　HEX+バフ", "　特殊弾", "　耐性", "　状態異常", "　HPMP", "　ロックオン", "　職業", "スキルトラック拡張", "　潜在表示", "　魔法ストック表示", "果実の木個別差し替え", ""
		}
		if ( en ) {
			q = "EX Setting 4(Display 2)"
			s = "Extra target info", "  Hex/Buff", "  Special ammo", "  Resitances", "  Ailments", "  HP/MP", "  Enemies", "  Classes", "Extra skill tracker", "  Potentials", "  Spell stock", "Replace each fruit tree", ""
		}
		dx = 440
		dy = 430
	}
	if ( submenu == 12 ) {
		if ( jp ) {
			q = "拡張設定5(システム)"
			s = "装備品情報拡張", "婚約非表示", "midi音量（GGSMF限定）", "ダメージテキスト短縮", "フォントスタイル", "階層移動時の出迎え無効", "キャラシート拡張", "滞在者階層移動無効", "非売品エリア", "アイテム非表示", "滞在者の紐無効", "着せ替え操作変更", "位置情報参照", "馬にも干渉", ""
		}
		if ( en ) {
			q = "EX Setting 5(System)"
			s = "Enhance equipment info", "Show choice to marry", "MIDI volume(GGSMF)", "Shorten damage message log", "Optimize text shadow", "Show welcome message on changing floor", "Show more info in chara menu", "Residents follow you on changing floor", "Not-for-sale area in shop", "Hide items from inventory", "Pull leashed residents", "Change appearance menu UI", "Save residents' positions", "Interact with mount", ""
		}
		dx = 440
		dy = 430
	}
	if ( submenu == 13 ) {
		if ( jp ) {
			q = "拡張設定6(SE)"
			s = "捧げ物に死体を追加", "ﾗﾝﾀﾞﾑｲﾍﾞﾝﾄ選択肢逆転", "ペットのHPゲージ表示", "売買時の確認省略", "妹ボイス", "ｴﾝﾁｬﾝﾄ強度可視化", "ｶﾞｼｬﾎﾟﾝ省略", "スタミナ表示", "ログ非表示", "捧げ物一括", ""
		}
		if ( en ) {
			q = "EX Setting 6(SE)"
			s = "Add corpses to god's favor", "Reverse random event's choices", "Show pet's HP", "Confirm selling/buying", "Younger sister's voice", "Show enchantment strength", "Confirm gasha-gasha", "Show PC's SP", "Hide log", "Offer whole stack", ""
		}
		configdetail(0) = lang("死体を捧げられない神に対しても、死体を捧げられるようになります。", "If a custom god does not like corpses, you become to be able to offer them.")
		configdetail(1) = lang("一部のランダムイベントの選択肢を上下入れ替えて表示します。", "Reverse options in some of random events.")
		configdetail(2) = lang("ペットのHPバーに重ねてHPの数値を表示します。", "Show pet's HP in digits. Please enable HP bar setting first.")
		configdetail(3) = lang("店で売買を行う時に確認表示を省略します。", "Confirm selling/buying.")
		configdetail(4) = lang("soundフォルダに妹/妹猫の音声ファイルがある時、妹/妹猫の音声が\n再生されるかを設定します。", "Play younger sister or cat sister's voice ingame if available.")
		configdetail(5) = lang("装備品に付与されているエンチャント強度の値を表示します。", "Show enchantment strength in digits.")
		configdetail(6) = lang("ガシャポンを使った時の確認表示を省略します。", "Confirm gasha-gasha.")
		configdetail(7) = lang("PCのスタミナポイントを表示します。", "Show PC's SP in bottom left of the screen.")
		configdetail(8) = lang("ログメッセージを非表示にします。", "Hide all log.")
		configdetail(9) = lang("アイテムを神に捧げる際、個数を指定して一括で捧げられるようになります。", "When offering, you can specify the number of items.")
		if ( jp ) {
			dx = 460
		}
		else {
			dx = 500
		}
		dy = 430
	}
	if ( submenu == 14 ) {
		q = lang("拡張設定7(ST)", "EX Setting 7(ST)")
		s = lang("時止めのエフェクト", "Time Stop Effect"), lang("釣りのアニメーション", "Fishing Animation"), lang("妹の死体を食べると妹化", "Change into younger sister"), lang("操作ウェイト", "Operation wait"), lang("エンチャント説明変更", "Change enchant description"), lang("主能力の潜在表示", "Attributes' potentials"), lang("ハンマーLv表示", "Display hammer level"), lang("生きている武器Lv表示", "Display living weapon level"), lang("数値の3桁区切り", "3 digit separation"), lang("死亡時選択肢の順序", "Exchange choices on dying"), lang("消費期限で並び替え", "Sort by expiration date"), lang("ショートカット", "Shortcut"), ""
		configdetail(0) = lang("時間停止中のエフェクトを表示します。", "Enable grayscale effect while time stop.")
		configdetail(1) = lang("スキル「釣り」のアニメーションを表示します。", "Show fishing's animation.")
		configdetail(2) = lang("NPCが妹の死体を食べた時、低確率で妹へ変異します。\nこの効果によって発生した妹への変異は治療できません。", "If on, when a character eats a younger sister's corpse,\nhe or she may transform into a younger sister.\nThis effect is irreversible.")
		configdetail(3) = lang("次の操作を受け付けるまでの内部ウェイトの長さを設定します。\n(config.txtのwait1を変更します)", "Number of frames to wait for next operation.")
		configdetail(4) = lang("装備品に付与されているエンチャントの効果をよりわかりやすく表現します。", "Show effect of enchantments in more human-readable way.")
		configdetail(5) = lang("キャラシートにおける主能力の潜在能力の表示形式を変更します。", "Change the way to display stats' potentials.")
		configdetail(6) = lang("所持しているハンマーのLvと経験値を表示します。", "Show hammer level and exp you have.\nSPS stands for Skin Per Second, the number of skins you are\nusing in smithing per second.")
		configdetail(7) = lang("所持している生きている武器のLvと経験値を表示します。", "Show living weapon's level and exp.")
		configdetail(8) = lang("数値表示を3桁毎に「,」で区切って表示します。\n\n対象: ダメージ表示、アイテムの個数、マテリアルの個数", "Use thousand separators more:\nTargets: the damage popups, the number of items,\nand the number of materials")
		configdetail(9) = lang("死んだときの「埋まる」、「這い上がる」の選択肢の順番を入れ替えます。", "Exchange the order of two choices on dying,\n\"Crawl up\" and \"Lie on your back\".")
		configdetail(10) = lang("調理の際、材料を賞味期限が短い方が上になるように並び替えて表示します。", "Sort raw food by expiration date on cooking.\nThe food whose expiration date is the most recent is\nlisted at top.")
		configdetail(11) = lang("通常:アイテムの種類でのみショートカットを分けます。\n拡張:アイテムの祝呪でもショートカットを分けます。\n拡張ショートカット使用中は未鑑定のアイテムをショートカットに登録した場合、\n未鑑定のアイテム全てを対象にします。", "Normal: Separate shortcuts by item type only.\nExpansion: Separate item shortcuts for item congratulatory spells.")
		if ( jp ) {
			dx = 460
		}
		else {
			dx = 500
		}
		dy = 430
	}
	if ( submenu == 15 ) {
		q = lang("拡張設定8(NC)", "EX Setting 8(NC)")
		s = lang("ステータスの短縮表示", "State Shorten"), lang("媚薬のエフェクト短縮", "Aphrodisiac effect shorten"), lang("転生レベルで停止", "Stop Reincarnation Level"), lang("契約期間満了通知", "Contract alert"), lang("餓死アラート", "Starve alert"), lang("餓死アラート(メイド)", "Starve alert(Maid)"), lang("F1F2の確認", "F1F2 alert"), lang("アイテムカウント機能", "Item Count"), lang("オートセーブ無効", "Autosave"), lang("ペットの自動装備無効", "Pets auto-wear equips"), lang("連続願い機能", "Rapid Wish"), lang("作業アニメーション短縮", "Work Shortening"), lang("NCログへのアップロード", "NCLog UPLoad"), lang("祈りポイントゲージの表示", "Pray point meter"), lang("金銭の直接受け取り", "Direct Money"), lang("祝福料理の情報表示", "Display blessed dishes"), ""
		configdetail(0) = lang("ステータスが極端に高い時、短縮表記で表示します。", "Use State Shorten."), lang("媚薬使用時のログ、アニメーションを短縮します。", "Aphrodisiac effect and log shorten."), lang("「何度も」使用時のハンマーが転生できるレベルに達した時、自動で停止します。", "Stops automatically allows reincarnation."), lang("冒険者との契約期間が切れた時、通知します。", "Pops alert to The period of contract."), lang("飢餓、餓死中になった時に音で通知します。", "Starve alert."), lang("わが家・ダンジョン内で飢餓状態になった時に、\nメイド及び料理スキルを持っているペットが料理を作ってくれます。", ""), lang("クイックセーブ・クイックロード時に確認するようになります。", "F1F2 alert."), lang("調べる状態で[" + key_read + "]を押す事で、\nスタック数/残り回数が常に表示されるようになります。", "Item Count."), lang("特定の行動/イベントの後に行われる自動的な*保存*を制限します。\n[たくさん]にするとほぼ全ての*保存*を行いません。", ""), lang("ペットの装備品を渡した時に自動的に装備しないようになります。", ""), lang("連続で願いを行うことが出来ます。\nただし魔道具スキルに経験値が入りません。", ""), lang("各種作業のアニメーションを短縮します。", ""), lang("死亡時等のログをNCのサーバーに表示します。", ""), lang("HPゲージの横に現在祈れるかがわかるゲージを表示させます。", ""), lang("金貨及びプラチナ硬貨がPCの足元に生成された時、直接インベントリに入れます。", "When gold and platinum coins are generated at the feet of a PC, they are placed directly into the inventory."), ""
		dx = 460
		dy = 460
	}
	if ( submenu == 16 ) {
		q = lang("拡張設定9(NCキャラシ)", "EX Setting 9(NC)")
		s = lang("NC仕様キャラクターシート", "NC chara sheet"), lang("やりこみ表示1", "Counter 1"), lang("やりこみ表示2", "Counter 2"), lang("やりこみ表示3", "Counter 3"), lang("やりこみ表示4", "Counter 4"), lang("やりこみ表示5", "Counter 5"), lang("やりこみ表示6", "Counter 6"), lang("やりこみ表示7", "Counter 7"), lang("やりこみ表示8", "Counter 8"), lang("詳細表示", "Detail View"), ""
		configdetail(0) = lang("キャラクターシートをNC仕様に拡張します。", "")
		configdetail(9) = lang("経験値量か潜在量を選択します。", "")
		dx = 460
		dy = 430
	}
	if ( submenu == 17 ) {
		q = lang("拡張設定10(伺か)", "EX Setting 10(Ukagaka)")
		s = lang("SSTP通信", "SSTP connection"), lang("さくら", "Sakura"), lang("うにゅう", "Unyu"), lang("ログ表示を抑制", "Suppress logs"), lang("イベント通知", "Notify event"), lang("ノーウェイト", "No wait"), ""
		configdetail(0) = "", "", "", "", "", "", ""
		dx = 460
		dy = 430
	}
	repeat 20
		if ( s(cnt) == "" ) {
			break
		}
		list(0, listmax) = cnt
		listn(0, listmax) = s(cnt)
		listmax++
	loop
	windowshadow = 1

*com_config_loop
	if ( cfg_zkey == 0 ) {
		key_quick = "z"
		key_zap = "Z"
	}
	else {
		if ( cfg_zkey == 1 ) {
			key_zap = "z"
			key_quick = "Z"
		}
	}
	if ( cfg_xkey == 0 ) {
		key_quickinv = "x"
		key_inventory = "X"
	}
	else {
		if ( cfg_xkey == 1 ) {
			key_inventory = "x"
			key_quickinv = "X"
		}
	}
	redraw 0
	cs_bk = -1
	cs = cs_config(submenu)
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*com_config_loop_WHILE1
	redraw 0
	if ( submenu >= 1 & submenu != 5 ) {
		s = q, strhint3 + "  " + key_identify + " [" + lang("説明", "Detail") + "]"
	}
	else {
		s = q, strhint3
	}
	pagesize = 0
	if ( mode == MODELIST_CHARA_CREATION ) {
		display_window (windoww - dx) / 2 + inf_screenx, winposy(dy, 1), dx, dy
	}
	else {
		display_window (windoww - dx) / 2 + inf_screenx, winposy(dy) - 12, dx, dy
	}
	pagesize = listmax
	display_topic lang("項目", "Menu"), wx + 34, wy + 36
	if ( mode == MODELIST_TITLE ) {
		p = 2
	}
	else {
		p = 4
	}
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3, wy + wh / 2
	grotate p, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		if ( submenu == 0 ) {
			key_list(cnt) = key_select(cnt)
			keyrange++
			display_key wx + 32, wy + 66 + cnt * 19 - 2, cnt
		}
		else {
			key_list(cnt) = key_cancel
			keyrange++
		}
	loop
	if ( submenu == 5 ) {
		p = 0, cnvjkey(key_enter), cnvjkey(key_cancel), cnvjkey(key_quickinv), cnvjkey(key_quick), cnvjkey(key_alter), cnvjkey(key_get), cnvjkey(key_fire), cnvjkey(key_target), cnvjkey(key_esc), cnvjkey(key_help), cnvjkey(key_charainfo), cnvjkey(key_ammo)
		repeat 19, 1
			list(1, cnt) = p(cnt)
		loop
	}
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		if ( submenu == 0 ) {
			x = 8
		}
		else {
			x = 0
		}
		if ( submenu == 3 ) {
			if ( cfg_net == 0 ) {
				if ( cnt >= 1 ) {
					continue
				}
			}
		}
		cs_list s, wx + 56 + x, wy + 66 + cnt * 19 - 1, 19, 0
		if ( submenu == 5 & cnt > 0 ) {
		}
		else {
			if ( submenu != 0 ) {
				pos wx + 220 + dx - 440, wy + 66 + cnt * 19 - 5
				gcopy BUFFER_INF, 312, 336, 24, 24
				pos wx + 358 + dx - 440, wy + 66 + cnt * 19 - 5
				gcopy BUFFER_INF, 336, 336, 24, 24
			}
		}
		pos wx + 250 + dx - 440, wy + 66 + cnt * 19
		color 0, 0, 0
		if ( submenu == 1 ) {
			if ( cnt == 0 ) {
				if ( jp ) {
					s = "なし", "あり"
				}
				else {
					s = "Don't show", "Show"
				}
				mes s(cfg_extrahelp)
			}
			if ( cnt == 1 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "Attack", "Ignore"
				}
				mes s(cfg_ignoredislike)
			}
			if ( cnt == 2 ) {
				if ( jp ) {
					s = "ｸｨｯｸﾒﾆｭｰ", "道具を振る", "割当なし"
				}
				else {
					s = "Quick menu", "Zap", "Don't assign"
				}
				mes s(cfg_zkey)
			}
			if ( cnt == 3 ) {
				if ( jp ) {
					s = "ｸｲｯｸｲﾝﾍﾞﾝﾄﾘ", "道具を調べる", "割当なし"
				}
				else {
					s = "Quick Inv", "Identify", "Don't assign"
				}
				mes s(cfg_xkey)
			}
			if ( cnt == 4 ) {
				if ( cfg_startrun >= 20 ) {
					if ( jp ) {
						mes "走らない"
					}
					else {
						mes "Don't run"
					}
				}
				else {
					if ( jp ) {
						mes "" + (cfg_startrun + 1) + "歩目から"
					}
					else {
						mes "After " + (cfg_startrun + 1) + " steps"
					}
				}
			}
			if ( cnt == 5 ) {
				mes "" + cfg_walkwait + " wait"
			}
			if ( cnt == 6 ) {
				mes "" + cfg_attackwait + " wait"
			}
			if ( cnt == 7 ) {
				mes "" + cfg_animewait + " wait"
			}
			if ( cnt == 8 ) {
				mes "" + cfg_alert + " wait"
			}
		}
		if ( submenu == 2 ) {
			if ( cnt == 0 ) {
				if ( jp ) {
					s = "なし", "direct sound", "MCI"
				}
				else {
					s = "None", "Direct sound", "MCI"
				}
				mes s(cfg_sound2)
			}
			if ( cnt == 1 ) {
				if ( jp ) {
					s = "なし", "direct music", "MCI", "GuruGuruSMF4"
				}
				else {
					s = "None", "Direct music", "MCI", "GuruGuruSMF4"
				}
				mes s(cfg_music2)
			}
			if ( cnt == 2 ) {
				if ( jp ) {
					s = "ウィンドウ", "フルスクリーン"
				}
				else {
					s = "Window mode", "Full screen"
				}
				mes s(cfg_fullscreen2)
			}
			if ( cnt == 3 ) {
				mes "" + windoww2 + " * " + windowh2
			}
			if ( cnt == 4 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_scroll)
			}
			if ( cnt == 5 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_alwayscenter)
			}
			if ( cnt == 6 ) {
				if ( jp ) {
					s = "再生しない", "再生する"
				}
				else {
					s = "Don't play", "Play"
				}
				mes s(cfg_heart)
			}
			if ( cnt == 7 ) {
				if ( jp ) {
					s = "アニメなし", "アニメあり"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_attackanime)
			}
			if ( cnt == 8 ) {
				if ( jp ) {
					s = "アニメなし", "アニメあり"
				}
				else {
					s = "No animation", "Always"
				}
				mes s(cfg_env)
			}
			if ( cnt == 9 ) {
				if ( jp ) {
					s = "高画質", "低画質"
				}
				else {
					s = "High", "Low"
				}
				mes s(cfg_shadow)
			}
			if ( cnt == 10 ) {
				if ( jp ) {
					s = "なし（高速）", "あり（低速）"
				}
				else {
					s = "No(Slow)", "Yes(Fast)"
				}
				mes s(cfg_objectshadow)
			}
		}
		if ( submenu == 3 ) {
			if ( cnt == 0 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_net)
			}
			if ( cnt == 1 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_netwish)
			}
			if ( cnt == 2 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_netchat)
			}
		}
		if ( submenu == 4 ) {
			if ( cnt == 0 ) {
				mes "" + cfg_runwait + " wait"
			}
			if ( cnt == 1 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_autonumlock)
			}
			if ( cnt == 2 ) {
				if ( jp ) {
					s = "オフ", "オン"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_titleeffect)
			}
			if ( cnt == 3 ) {
				if ( jp ) {
					s = "オフ", "オン"
				}
				else {
					s = "No", "Yes"
				}
				mes "" + cfg_scrsync + " wait"
			}
			if ( cnt == 4 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_runscroll)
			}
			if ( cnt == 5 ) {
				if ( jp ) {
					s = "普通", "速め", "省略"
				}
				else {
					s = "Normal", "High", "Highest"
				}
				mes s(cfg_autoturn)
			}
			if ( cnt == 6 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_skiprandevents)
			}
		}
		if ( submenu == 5 ) {
			if ( cnt == 0 ) {
				if ( jp ) {
					s = "使用しない", "使用する"
				}
				else {
					s = "Don't use", "Use"
				}
				mes s(cfg_joypad)
			}
			else {
				if ( list(1, cnt) == (-1) ) {
					mes lang("未設定", "Unassigned")
				}
				else {
					mes lang("ボタン", "Button") + list(1, cnt)
				}
			}
		}
		if ( submenu == 6 ) {
			if ( cnt == 0 ) {
				if ( jp ) {
					s = "しない", "する"
				}
				else {
					s = "No", "Yes"
				}
				mes s(cfg_msgaddtime)
			}
			if ( cnt == 1 ) {
				mes "" + cfg_msgtrans * 10 + " %"
			}
		}
		if ( submenu == 7 ) {
			if ( cnt == 0 ) {
				s = "Japanese", "English"
				mes s(cfg_language)
			}
		}
		if ( submenu == 8 ) {
			if ( cnt == 0 ) {
				s = lang("使わない", "Disable"), lang("使う", "Enable")
				mes s(cfg_useffhp)
			}
			if ( cnt == 1 ) {
				s = lang("使わない", "Disable"), lang("使う", "Enable")
				mes s(cfg_userface1)
			}
			if ( cnt == 2 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_overcastspell)
			}
			if ( cnt == 3 ) {
				s = lang("使わない", "Disable"), lang("使う", "Enable")
				mes s(cfg_autopick)
			}
			if ( cnt == 4 ) {
				s = lang("なし", "Off"), lang("あり", "On")
				mes s(cfg_autopicksound)
			}
			if ( cnt == 5 ) {
				s = lang("なし", "Off"), lang("あり", "On")
				mes s(cfg_autodestroysound)
			}
			if ( cnt == 6 ) {
				s = lang("公式", "Official"), lang("非公式", "Unofficial")
				mes s(cfg_showroomserver)
			}
			if ( cnt == 7 ) {
				s = lang("記録しない", "Disable"), "100", "200", "300", "400", "500", lang("無制限", "Unlimited")
				mes s(cfg_showroomlog)
			}
			if ( cnt == 8 ) {
				s = lang("何もしない", "Disable"), lang("前回を除外", "Without previous"), lang("ログ有りを除外", "Without visited")
				mes s(cfg_moongatejump)
			}
			if ( cnt == 9 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_improvescroll)
			}
			if ( cnt == 10 ) {
				s = "bcopy", lang("fxcopy(高速かも)", "fxcopy(fast?)")
				mes s(cfg_datacopy)
			}
			if ( cnt == 11 ) {
				s = lang("縮小（通常）", "Shrink(Normal)"), lang("原寸", "Fullscale")
				mes s(cfg_graphicpc)
			}
			if ( cnt == 12 ) {
				s = lang("縮小（通常）", "Shrink(Normal)"), lang("原寸", "Fullscale")
				mes s(cfg_graphicnpc)
			}
			if ( cnt == 13 ) {
				s = lang("PC基準", "PC"), lang("該当ペット基準", "Pets")
				mes s(cfg_npcwalk)
			}
			if ( cnt == 14 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_reloadcnpc)
			}
		}
		if ( submenu == 9 ) {
			if ( cnt == 0 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_picknumber)
			}
			if ( cnt == 1 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_transfernumber)
			}
			if ( cnt == 2 ) {
				s = lang("しない", "Off"), lang("左側に表示", "Show left side"), lang("右側に表示", "Show right side")
				mes s(cfg_hpgauge)
			}
			if ( cnt == 3 ) {
				s = lang("なし", "Off"), lang("あり", "On")
				mes s(cfg_thousandsep)
			}
			if ( cnt == 4 ) {
				s = lang("すべて", "All"), lang("マップとキャラ", "Map & Characters"), lang("マップとアイテム", "Map & Items"), lang("マップのみ", "Map only")
				mes s(cfg_camera)
			}
			if ( cnt == 5 ) {
				s = lang("使わない", "Disable"), lang("使う", "Enable")
				mes s(cfg_usecharaffhp)
			}
			if ( cnt == 6 ) {
				s = lang("簡易", "Simple"), lang("詳細", "Detail")
				mes s(cfg_dump)
			}
			if ( cnt == 7 ) {
				s = lang("知らせる", "Enable"), lang("知らせない", "Disable")
				mes s(cfg_guest)
			}
			if ( cnt == 8 ) {
				s = lang("しない", "Disable"), lang("する", "Enable")
				mes s(cfg_talkconvert)
			}
			if ( cnt == 9 ) {
				s = lang("なし", "None"), lang("倉庫はシンボル", "Storage symbol")
				mes s(cfg_stacksymbol)
			}
			if ( cnt == 10 ) {
				s = lang("PCのみ", "PC only"), lang("ペットも表示", "PC and pets"), lang("全て表示", "Show all")
				mes s(cfg_npcattackanime)
			}
		}
		if ( submenu == 10 ) {
			if ( cnt == 0 ) {
				s = lang("しない", "Off"), lang("する", "On")
				mes s(cfg_dmgmonitor0)
			}
			if ( cnt == 1 ) {
				s = lang("通常", "Normal"), lang("追加攻撃をまとめる", "Unify extra attack"), lang("1本ごとにまとめる", "Unify one weapon attack"), lang("すべてまとめる", "Unify all weapons")
				mes s(cfg_dmgmonitortype)
			}
			if ( cnt == 2 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_dmgmonitor1)
			}
			if ( cnt == 3 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_dmgmonitor2)
			}
			if ( cnt == 4 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_dmgmonitor3)
			}
			if ( cnt == 5 ) {
				s = lang("通常", "Normal"), lang("まとめる", "Unify")
				mes s(cfg_dmgmonitor4)
			}
			if ( cnt == 6 ) {
				mes "" + cfg_dmgfont
			}
			if ( cnt == 7 ) {
				mes "" + cfg_dmgspeed
			}
			if ( cnt == 8 ) {
				s = lang("しない", "Don't show"), lang("する（1キャラ1つ）", "Show(1 balloon per chara)"), lang("する（無制限）", "Show(unlimited)")
				mes s(cfg_txtpop)
			}
			if ( cnt == 9 ) {
				mes "" + cfg_txtpopfont
			}
			if ( cnt == 10 ) {
				mes "" + cfg_txtpopspeed
			}
			if ( cnt == 11 ) {
				mes "" + cfg_txtpoptransparent
			}
			if ( cnt == 12 ) {
				s = lang("残す", "Remain in a while"), lang("消す", "Fade out soon")
				mes s(cfg_txtpopupdead)
			}
			if ( cnt == 13 ) {
				s = lang("する", "Show"), lang("しない", "Erase")
				mes s(cfg_nc_notshowzero)
			}
		}
		if ( submenu == 11 ) {
			if ( cnt == 0 ) {
				s = lang("なし", "No"), lang("あり", "Yes")
				mes s(cfg_targetex)
			}
			if ( cnt == 1 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_targetbuff)
			}
			if ( cnt == 2 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_targetbullet)
			}
			if ( cnt == 3 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_targetresist)
			}
			if ( cnt == 4 ) {
				s = lang("なし", "Don't show"), lang("簡易", "Show"), lang("詳細", "Show details")
				mes s(cfg_targetdebuff)
			}
			if ( cnt == 5 ) {
				s = lang("なし", "Don't show"), lang("簡易", "Show"), lang("詳細", "Show details")
				mes s(cfg_targetstat)
			}
			if ( cnt == 6 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_targetlockon)
			}
			if ( cnt == 7 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_targetclass)
			}
			if ( cnt == 8 ) {
				s = lang("しない", "No"), lang("する（通常）", "Yes(Normal)"), lang("する（軽量）", "Yes(Fast)")
				mes s(cfg_strackex)
			}
			if ( cnt == 9 ) {
				s = lang("なし", "Don't show"), lang("あり", "Show")
				mes s(cfg_strackgrow)
			}
			if ( cnt == 10 ) {
				s = lang("なし", "Don't show"), lang("あり(外す)", "Show(drop if no stock)"), lang("あり(外さない)", "Show(keep even if no stock)")
				mes s(cfg_strackstock)
			}
			if ( cnt == 11 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_fruittrees)
			}
		}
		if ( submenu == 12 ) {
			if ( cnt == 0 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_equipex)
			}
			if ( cnt == 1 ) {
				s = lang("しない", "Show always"), lang("する", "Hide for town NPCs")
				mes s(cfg_proposeexclusion)
			}
			if ( cnt == 2 ) {
				mes "" + cfg_sndvolume
			}
			if ( cnt == 3 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_dmgtxttype)
			}
			if ( cnt == 4 ) {
				s = lang("通常", "No"), lang("軽量", "Yes(fast)")
				mes s(cfg_fontstyle)
			}
			if ( cnt == 5 ) {
				s = lang("しない", "Yes"), lang("する", "No")
				mes s(cfg_welcomemessage)
			}
			if ( cnt == 6 ) {
				s = lang("しない", "No"), lang("潜在色表示なし", "Yes"), lang("潜在色表示", "Yes(highlight potential)")
				mes s(cfg_charasheet)
			}
			if ( cnt == 7 ) {
				s = lang("しない", "Yes"), lang("する", "No")
				mes s(cfg_floormove)
			}
			if ( cnt == 8 ) {
				s = lang("しない", "Disable"), lang("する", "Enable")
				mes s(cfg_notforsale)
			}
			if ( cnt == 9 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_hideitem)
			}
			if ( cnt == 10 ) {
				s = lang("しない", "Yes"), lang("する", "No")
				mes s(cfg_petlead)
			}
			if ( cnt == 11 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_pcc)
			}
			if ( cnt == 12 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_npcposition)
			}
			if ( cnt == 13 ) {
				s = lang("しない", "Disable"), lang("する", "Enable")
				mes s(cfg_interactex)
			}
		}
		if ( submenu == 13 ) {
			if ( cnt == 0 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_offercorpse)
			}
			if ( cnt == 1 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_randomeventreplace)
			}
			if ( cnt == 2 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_mma_pethpmonitor)
			}
			if ( cnt == 3 ) {
				s = lang("しない", "Yes"), lang("する", "No")
				mes s(cfg_shopselectskip)
			}
			if ( cnt == 4 ) {
				s = lang("なし", "No"), lang("妹のみ", "Only younger sister"), lang("妹猫のみ", "Only younger cat sister"), lang("両方", "Both")
				mes s(cfg_youngersistervoice)
			}
			if ( cnt == 5 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_enchantvisualization)
			}
			if ( cnt == 6 ) {
				s = lang("しない", "Yes"), lang("する", "No")
				mes s(cfg_treasuremachine)
			}
			if ( cnt == 7 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_showstamina)
			}
			if ( cnt == 8 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_nolog)
			}
			if ( cnt == 9 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_offernumber)
			}
		}
		if ( submenu == 14 ) {
			if ( cnt == 0 ) {
				s = lang("なし(高速)", "Off(fast)"), lang("あり(低速)", "On(slow)")
				mes s(cfg_st_timestopeffect)
			}
			if ( cnt == 1 ) {
				s = lang("なし", "Off"), lang("あり", "On")
				mes s(cfg_st_fishinganimation)
			}
			if ( cnt == 2 ) {
				s = lang("無効", "Off"), lang("有効", "On")
				mes s(cfg_st_youngersistercorpse)
			}
			if ( cnt == 3 ) {
				mes "" + cfg_wait1 + " wait"
			}
			if ( cnt == 4 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_st_enchantmenthumanreadable)
			}
			if ( cnt == 5 ) {
				s = lang("単語", "Word"), lang("数値", "Digit")
				mes s(cfg_st_attributespotential)
			}
			if ( cnt == 6 ) {
				s = lang("しない", "No"), lang("Lvを表示", "Lv"), lang("LvとSPSを表示", "Lv & SPS"), lang("SPSを表示", "SPS")
				mes s(cfg_st_displayhammerlevel)
			}
			if ( cnt == 7 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_st_displaylivingweaponlevel)
			}
			if ( cnt == 8 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_st_moreseparation)
			}
			if ( cnt == 9 ) {
				s = lang("入れ替えない", "No (vanilla)"), lang("入れ替える", "Yes")
				mes s(cfg_st_exchangecrawluporburied)
			}
			if ( cnt == 10 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_st_sortbyexpirationdate)
			}
			if ( cnt == 11 ) {
				s = lang("通常", "Normal"), lang("拡張", "Expansion")
				mes s(cfg_st_shortcut)
			}
		}
		if ( submenu == 15 ) {
			if ( cnt == 0 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_nc_stateshorten)
			}
			if ( cnt == 1 ) {
				s = lang("通常通り", "All"), lang("1回のみ", "1 only"), lang("1回+催淫カット", "1 only+Aphro cut"), lang("全てカット", "All cut")
				mes s(cfg_nc_aphrodisiac)
			}
			if ( cnt == 2 ) {
				s = lang("しない", "No"), lang("する", "Yes"), lang("自動で転生", "Auto Asend")
				mes s(cfg_nc_reincarnation)
			}
			if ( cnt == 3 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_nc_contractarart)
			}
			if ( cnt == 4 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_nc_starvearart)
			}
			if ( cnt == 5 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_alertstarvation)
			}
			if ( cnt == 6 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_nc_qsave)
			}
			if ( cnt == 7 ) {
				s = lang("使わない", "No"), lang("スタック数", "Stack"), lang("スタック/回数", "Stack/Count")
				mes s(cfg_nc_itemcount)
			}
			if ( cnt == 8 ) {
				s = lang("なし", "Often"), lang("ちょっと", "Sometimes"), lang("まあまあ", "Rarely"), lang("たくさん", "Almost never")
				mes s(cfg_noautosave)
			}
			if ( cnt == 9 ) {
				s = lang("しない", "Yes"), lang("する", "No")
				mes s(cfg_petequip)
			}
			if ( cnt == 10 ) {
				s = lang("使わない", "No"), lang("使う", "Yes")
				mes s(cfg_nc_wish)
			}
			if ( cnt == 11 ) {
				s = lang("使わない", "No"), lang("ちょっと", "Sometimes"), lang("たくさん", "Almost never")
				mes s(cfg_nc_workshortening)
			}
			if ( cnt == 12 ) {
				s = lang("使わない", "No"), lang("使う", "Yes")
				mes s(cfg_nc_logapply)
			}
			if ( cnt == 13 ) {
				s = lang("使わない", "No"), lang("使う", "Yes")
				mes s(cfg_nc_praypoint)
			}
			if ( cnt == 14 ) {
				s = lang("無効", "No"), lang("有効", "Yes")
				mes s(cfg_nc_directmoney)
			}
			if ( cnt == 15 ) {
				s = lang("しない", "No"), lang("する", "Yes")
				mes s(cfg_nc_displayblesseddishes)
			}
		}
		if ( submenu == 16 ) {
			if ( cnt == 0 ) {
				s = lang("使わない", "No"), lang("使う", "Yes")
				mes s(cfg_nc_charasheet)
			}
			if ( cnt >= 1 & cnt < 9 ) {
				s(0) = lang("==========", "=========="), lang("最大ダメージ", "Max Damage"), lang("願い回数", "Wish Count"), lang("原子爆弾回数", "Bomb Count"), lang("気持ちいいこと回数", "Prostituting Count")
				s(5) = lang("気持ちいいこと最高額", "Prostituting Highest"), lang("妹猫と遊んだ回数", "Playing Catgirl"), lang("少女騎士団護衛回数", "Knights protected"), lang("リトルシスター救助数", "L.Sister Rescue"), lang("リトルシスター殺害数", "L.Sister Killed")
				s(10) = lang("ハンマー最高レベル", "Hammer MaxLevel"), lang("ハンマーでの製作数", "Hammer count"), lang("会心の出来回数", "Good Make"), lang("演奏最高額", "Max Perform"), lang("魔法詠唱回数", "Magic count")
				s(15) = lang("人肉食回数", "Human flesh"), lang("すくつ到達階", "Void count"), lang("結婚人数", "Married count"), lang("愛情の証取得数", "LoveJewel count"), lang("バブル殺害数", "Bubbles killed")
				s(20) = lang("ブルーバブル殺害数", "B.bubbles killed"), lang("塊の怪物殺害数", "M.monsters killed"), lang("キューブ殺害数", "Cubes killed"), lang("Tow殺害数", "Tow killed"), lang("依頼完了数", "Quest count")
				s(25) = lang("総歩行距離", "Total distance"), lang("職人の魂使用回数", "Soul count"), lang("ならく到達階", "Abyss count")
				repeat 8
					s(28 + cnt) = lang("鍛えた", "Trained") + _stats2(cnt)
				loop
				s(36) = lang("鍛えた", "Trained") + lang("生命力", "Life")
				s(37) = lang("鍛えた", "Trained") + lang("マナ", "Mana")
				mes s(cfg_nc_charasheetdata(cnt - 1))
			}
			if ( cnt == 9 ) {
				s = lang("潜在量", "Latent"), lang("経験値", "Exp")
				mes s(cfg_nc_detail)
			}
		}
		if ( submenu == 17 ) {
			if ( cnt == 0 ) {
				s = lang("しない", "Disable"), lang("する", "Enable")
				mes s(cfg_nc_sstp_enabled)
			}
			if ( cnt == 1 ) {
				s = lang("しない", "Disable"), lang("神の電波", "Signals from God"), "PC", "Pet1", "Pet2", "Pet3", "Pet4", "Pet5", "Pet6", "Pet7", "Pet8", "Pet9", "Pet10", "Pet11", "Pet12", "Pet13", "Pet14", "Pet15"
				repeat 16
					if ( cExist(cnt) == CHAR_STATE_DEAD ) {
						continue
					}
					s(cnt + 2) += ":" + strmid(cnName(cnt), 0, 10)
				loop
				mes s(cfg_nc_sstp_sakura)
			}
			if ( cnt == 2 ) {
				s = lang("しない", "Disable"), lang("神の電波", "Signals from God"), "PC", "Pet1", "Pet2", "Pet3", "Pet4", "Pet5", "Pet6", "Pet7", "Pet8", "Pet9", "Pet10", "Pet11", "Pet12", "Pet13", "Pet14", "Pet15"
				repeat 16
					if ( cExist(cnt) == CHAR_STATE_DEAD ) {
						continue
					}
					s(cnt + 2) += ":" + strmid(cnName(cnt), 0, 10)
				loop
				mes s(cfg_nc_sstp_unyu)
			}
			if ( cnt == 3 ) {
				s = lang("しない", "Disable"), lang("する", "Enable")
				mes s(cfg_nc_sstp_suppresslog)
			}
			if ( cnt == 4 ) {
				s = lang("しない", "Disable"), lang("する", "Enable")
				mes s(cfg_nc_sstp_notifyevent)
			}
			if ( cnt == 5 ) {
				s = lang("しない", "Disable"), lang("する", "Enable")
				mes s(cfg_nc_sstp_nowait)
			}
		}
	loop
	if ( submenu != 0 ) {
		if ( submenu != 5 ) {
			pos wx + 40, wy + wh - 70
			font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
			color 0, 0, 0
			if ( jp ) {
				mes "* 印のついた項目は、ゲームの再起動後に適用されます"
			}
			else {
				mes "Items marked with * require restart to apply changes."
			}
		}
	}
	if ( submenu == 5 ) {
		pos wx + 40, wy + wh - 110
		font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
		color 0, 0, 0
		if ( jp ) {
			mes "ボタンを割り当てたい項目にカーソルをあわせて\nゲームパッドのボタンを押してください。(L),(R)の付いている\n項目は、メニュー画面でタブの移動に使われます。"
		}
		else {
			mes "To assign a button, move the cursor to\nan item and press the button."
		}
	}
	if ( keyrange != 0 ) {
		cs_bk = cs
		cs_config(submenu) = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if ( p != (-1) ) {
		if ( submenu == 0 ) {
			submenu = p + 1
			snd SOUNDLIST_OK1
			goto *com_config
		}
	}
	if ( submenu == 5 ) {
		if ( cs > 0 ) {
			DIGETJOYSTATE j, 0
			f = 0
			repeat 12
				HMMBITCHECK j, 4 + cnt
				if ( stat ) {
					p = cnt
					valn = ""
					repeat 12
						jkey(cnt) = ""
					loop
					list(1, cs) = p
					repeat 19, 1
						if ( cs == cnt ) {
							continue
						}
						list(1, cnt)--
						if ( list(1, cnt) == p | list(1, cnt) <= (-1) ) {
							list(1, cnt) = 12
						}
					loop
					jkey(list(1, 1)) = "" + key_enter
					config_savevanillakeyoption "key_enter.", key_enter, list(1, 1)
					jkey(list(1, 2)) = "" + key_cancel
					config_savevanillakeyoption "key_cancel.", key_cancel, list(1, 2)
					jkey(list(1, 3)) = "" + key_quickinv
					config_savevanillakeyoption "key_quickinv.", key_quickinv, list(1, 3)
					jkey(list(1, 4)) = "" + key_quick
					config_savevanillakeyoption "key_quick.", key_quick, list(1, 4)
					jkey(list(1, 5)) = "" + key_alter
					config_savevanillakeyoption "key_alter.", key_alter, list(1, 5)
					jkey(list(1, 6)) = "" + key_get
					config_savevanillakeyoption "key_get.", key_get, list(1, 6)
					jkey(list(1, 7)) = "" + key_fire
					config_savevanillakeyoption "key_fire.", key_fire, list(1, 7)
					jkey(list(1, 8)) = "" + key_target
					config_savevanillakeyoption "key_target.", key_target, list(1, 8)
					jkey(list(1, 9)) = "" + key_esc
					config_savevanillakeyoption "key_esc.", key_esc, list(1, 9)
					jkey(list(1, 10)) = "" + key_help
					config_savevanillakeyoption "key_help.", key_help, list(1, 10)
					jkey(list(1, 11)) = "" + key_charainfo
					config_savevanillakeyoption "key_charainfo.", key_charainfo, list(1, 11)
					jkey(list(1, 12)) = "" + key_ammo
					config_savevanillakeyoption "key_ammo.", key_ammo, list(1, 12)
					p = 0, cnvjkey(key_enter), cnvjkey(key_cancel), cnvjkey(key_quickinv), cnvjkey(key_quick), cnvjkey(key_alter), cnvjkey(key_get), cnvjkey(key_fire), cnvjkey(key_target), cnvjkey(key_esc), cnvjkey(key_help), cnvjkey(key_charainfo), cnvjkey(key_ammo)
					repeat 19, 1
						list(1, cnt) = p(cnt)
					loop
					f = 1
					break
				}
			loop
			if ( f ) {
				snd SOUNDLIST_OK1
				await 200
				goto *com_config_loop
			}
		}
	}
	p = 0
	if ( key == key_pageup ) {
		p = 1
	}
	else {
		if ( key == key_pagedown ) {
			p = -1
		}
		else {
			if ( key == key_northeast ) {
				p = 100
			}
			else {
				if ( key == key_northwest ) {
					p = -100
				}
				else {
					if ( key == key_southeast ) {
						p = 10
					}
					else {
						if ( key == key_southwest ) {
							p = -10
						}
					}
				}
			}
		}
	}
	if ( p != 0 ) {
		if ( submenu == 1 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_extrahelp = limit(cfg_extrahelp + p, 0, 1)
				config_savevanillaoption "extraHelp.", str(cfg_extrahelp)
				goto *com_config_loop
			}
			if ( cs == 1 ) {
				cfg_ignoredislike = limit(cfg_ignoredislike + p, 0, 1)
				config_savevanillaoption "ignoreDislike.", str(cfg_ignoredislike)
				goto *com_config_loop
			}
			if ( cs == 2 ) {
				cfg_zkey = limit(cfg_zkey + p, 0, 2)
				config_savevanillaoption "zkey.", str(cfg_zkey)
				goto *com_config_loop
			}
			if ( cs == 3 ) {
				cfg_xkey = limit(cfg_xkey + p, 0, 2)
				config_savevanillaoption "xkey.", str(cfg_xkey)
				goto *com_config_loop
			}
			if ( cs == 4 ) {
				cfg_startrun = limit(cfg_startrun + p, 0, 20)
				config_savevanillaoption "startRun.", str(cfg_startrun)
				goto *com_config_loop
			}
			if ( cs == 5 ) {
				cfg_walkwait = limit(cfg_walkwait + p, 1, 10)
				config_savevanillaoption "walkWait.", str(cfg_walkwait)
				goto *com_config_loop
			}
			if ( cs == 6 ) {
				cfg_attackwait = limit(cfg_attackwait + p, 1, 20)
				config_savevanillaoption "attackWait.", str(cfg_attackwait)
				goto *com_config_loop
			}
			if ( cs == 7 ) {
				cfg_animewait = limit(cfg_animewait + p, 0, 20)
				config_savevanillaoption "anime_wait.", str(cfg_animewait)
				goto *com_config_loop
			}
			if ( cs == 8 ) {
				cfg_alert = limit(cfg_alert + p, 0, 50)
				config_savevanillaoption "alert_wait.", str(cfg_alert)
				goto *com_config_loop
			}
		}
		if ( submenu == 2 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_sound2 = limit(cfg_sound2 + p, 0, 2)
				config_savevanillaoption "sound.", str(cfg_sound2)
				goto *com_config_loop
			}
			if ( cs == 1 ) {
				cfg_music2 = limit(cfg_music2 + p, 0, 3)
				config_savevanillaoption "music.", str(cfg_music2)
				goto *com_config_loop
			}
			if ( cs == 2 ) {
				cfg_fullscreen2 = limit(cfg_fullscreen2 + p, 0, 1)
				config_savevanillaoption "fullscreen.", str(cfg_fullscreen2)
				goto *com_config_loop
			}
			if ( cs == 4 ) {
				cfg_scroll = limit(cfg_scroll + p, 0, 1)
				config_savevanillaoption "scroll.", str(cfg_scroll)
				goto *com_config_loop
			}
			if ( cs == 5 ) {
				cfg_alwayscenter = limit(cfg_alwayscenter + p, 0, 1)
				config_savevanillaoption "alwaysCenter.", str(cfg_alwayscenter)
				goto *com_config_loop
			}
			if ( cs == 6 ) {
				cfg_heart = limit(cfg_heart + p, 0, 1)
				config_savevanillaoption "heartbeat.", str(cfg_heart)
				goto *com_config_loop
			}
			if ( cs == 7 ) {
				cfg_attackanime = limit(cfg_attackanime + p, 0, 1)
				config_savevanillaoption "attackAnime.", str(cfg_attackanime)
				goto *com_config_loop
			}
			if ( cs == 8 ) {
				cfg_env = limit(cfg_env + p, 0, 1)
				config_savevanillaoption "envEffect.", str(cfg_env)
				goto *com_config_loop
			}
			if ( cs == 9 ) {
				cfg_shadow = limit(cfg_shadow + p, 0, 1)
				config_savevanillaoption "shadow.", str(cfg_shadow)
				goto *com_config_loop
			}
			if ( cs == 10 ) {
				cfg_objectshadow = limit(cfg_objectshadow + p, 0, 1)
				config_savevanillaoption "objectShadow.", str(cfg_objectshadow)
				goto *com_config_loop
			}
			if ( cs == 3 ) {
				x = 800, 800, 1024, 1152, 1280, 1280
				y = 600, 696, 768, 864, 768, 1024
				i = 0
				repeat 5
					if ( windoww2 == x(cnt) ) {
						if ( windowh2 == y(cnt) ) {
							i = cnt
							break
						}
					}
				loop
				i += p
				if ( i < 0 ) {
					i = 0
				}
				else {
					if ( i > 4 ) {
						i = 4
					}
				}
				i = limit(i + p, 0, 4)
				windoww2 = x(i)
				windowh2 = y(i)
				config_savevanillaoption "windowW.", "" + windoww2
				config_savevanillaoption "windowH.", "" + windowh2
				goto *com_config_loop
			}
		}
		if ( submenu == 3 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_net = limit(cfg_net + p, 0, 1)
				config_savevanillaoption "net.", str(cfg_net)
				goto *com_config_loop
			}
			if ( cs == 1 ) {
				cfg_netwish = limit(cfg_netwish + p, 0, 1)
				config_savevanillaoption "netWish.", str(cfg_netwish)
				goto *com_config_loop
			}
			if ( cs == 2 ) {
				cfg_netchat = limit(cfg_netchat + p, 0, 1)
				config_savevanillaoption "netChat.", str(cfg_netchat)
				goto *com_config_loop
			}
		}
		if ( submenu == 4 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_runwait = limit(cfg_runwait + p, 2, 5)
				config_savevanillaoption "runWait.", str(cfg_runwait)
				goto *com_config_loop
			}
			if ( cs == 1 ) {
				cfg_autonumlock = limit(cfg_autonumlock + p, 0, 1)
				config_savevanillaoption "autoNumlock.", str(cfg_autonumlock)
				goto *com_config_loop
			}
			if ( cs == 2 ) {
				cfg_titleeffect = limit(cfg_titleeffect + p, 0, 1)
				config_savevanillaoption "titleEffect.", str(cfg_titleeffect)
				goto *com_config_loop
			}
			if ( cs == 3 ) {
				cfg_scrsync = limit(cfg_scrsync + p, 2, 25)
				config_savevanillaoption "scr_sync.", str(cfg_scrsync)
				goto *com_config_loop
			}
			if ( cs == 4 ) {
				cfg_runscroll = limit(cfg_runscroll + p, 0, 1)
				config_savevanillaoption "scroll_run.", str(cfg_runscroll)
				goto *com_config_loop
			}
			if ( cs == 5 ) {
				cfg_autoturn = limit(cfg_autoturn + p, 0, 2)
				config_savevanillaoption "autoTurnType.", str(cfg_autoturn)
				goto *com_config_loop
			}
			if ( cs == 6 ) {
				cfg_skiprandevents = limit(cfg_skiprandevents + p, 0, 1)
				config_savevanillaoption "skipRandEvents.", str(cfg_skiprandevents)
				goto *com_config_loop
			}
		}
		if ( submenu == 5 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_joypad = limit(cfg_joypad + p, 0, 1)
				config_savevanillaoption "joypad.", str(cfg_joypad)
				goto *com_config_loop
			}
		}
		if ( submenu == 6 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_msgaddtime = limit(cfg_msgaddtime + p, 0, 1)
				config_savevanillaoption "msg_addTime.", str(cfg_msgaddtime)
				goto *com_config_loop
			}
			if ( cs == 1 ) {
				cfg_msgtrans = limit(cfg_msgtrans + p, 0, 5)
				config_savevanillaoption "msg_trans.", str(cfg_msgtrans)
				goto *com_config_loop
			}
		}
		if ( submenu == 7 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_language = limit(cfg_language + p, 0, 1)
				config_savevanillaoption "language.", str(cfg_language)
				goto *com_config_loop
			}
		}
		if ( submenu == 8 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_useffhp = limit(cfg_useffhp + p, 0, 1)
				config_saveomakeoption "use_ffhp.", str(cfg_useffhp)
			}
			if ( cs == 1 ) {
				cfg_userface1 = limit(cfg_userface1 + p, 0, 1)
				config_saveomakeoption "user_face1.", str(cfg_userface1)
			}
			if ( cs == 2 ) {
				cfg_overcastspell = limit(cfg_overcastspell + p, 0, 1)
				config_saveomakeoption "overcast_spell.", str(cfg_overcastspell)
			}
			if ( cs == 3 ) {
				cfg_autopick = limit(cfg_autopick + p, 0, 1)
				config_saveomakeoption "autopick.", str(cfg_autopick)
			}
			if ( cs == 4 ) {
				cfg_autopicksound = limit(cfg_autopicksound + p, 0, 1)
				config_saveomakeoption "autopick_sound.", str(cfg_autopicksound)
			}
			if ( cs == 5 ) {
				cfg_autodestroysound = limit(cfg_autodestroysound + p, 0, 1)
				config_saveomakeoption "autodestroy_sound.", str(cfg_autodestroysound)
			}
			if ( cs == 6 ) {
				cfg_showroomserver = limit(cfg_showroomserver + p, 0, 1)
				config_saveomakeoption "showroom_server.", str(cfg_showroomserver)
			}
			if ( cs == 7 ) {
				cfg_showroomlog = limit(cfg_showroomlog + p, 0, 6)
				config_saveomakeoption "showroom_log.", str(cfg_showroomlog)
			}
			if ( cs == 8 ) {
				cfg_moongatejump = limit(cfg_moongatejump + p, 0, 2)
				config_saveomakeoption "moongate_jump.", str(cfg_moongatejump)
			}
			if ( cs == 9 ) {
				cfg_improvescroll = limit(cfg_improvescroll + p, 0, 1)
				config_saveomakeoption "improve_scroll.", str(cfg_improvescroll)
			}
			if ( cs == 10 ) {
				cfg_datacopy = limit(cfg_datacopy + p, 0, 1)
				config_saveomakeoption "data_copy.", str(cfg_datacopy)
			}
			if ( cs == 11 ) {
				cfg_graphicpc = limit(cfg_graphicpc + p, 0, 1)
				config_saveomakeoption "graphic_pc.", str(cfg_graphicpc)
			}
			if ( cs == 12 ) {
				cfg_graphicnpc = limit(cfg_graphicnpc + p, 0, 1)
				config_saveomakeoption "graphic_npc.", str(cfg_graphicnpc)
			}
			if ( cs == 13 ) {
				cfg_npcwalk = limit(cfg_npcwalk + p, 0, 1)
				config_saveomakeoption "npc_walk.", str(cfg_npcwalk)
			}
			if ( cs == 14 ) {
				cfg_reloadcnpc = limit(cfg_reloadcnpc + p, 0, 1)
				config_saveomakeoption "reload_CNPC.", str(cfg_reloadcnpc)
			}
			goto *com_config_loop
		}
		if ( submenu == 9 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_picknumber = limit(cfg_picknumber + p, 0, 1)
				config_saveomakeoption "pick_number.", str(cfg_picknumber)
			}
			if ( cs == 1 ) {
				cfg_transfernumber = limit(cfg_transfernumber + p, 0, 1)
				config_saveomakeoption "transfer_number.", str(cfg_transfernumber)
			}
			if ( cs == 2 ) {
				cfg_hpgauge = limit(cfg_hpgauge + p, 0, 2)
				config_saveomakeoption "HP_gauge.", str(cfg_hpgauge)
			}
			if ( cs == 3 ) {
				cfg_thousandsep = limit(cfg_thousandsep + p, 0, 1)
				config_saveomakeoption "thousand_separation.", str(cfg_thousandsep)
			}
			if ( cs == 4 ) {
				cfg_camera = limit(cfg_camera + p, 0, 3)
				config_saveomakeoption "camera.", str(cfg_camera)
			}
			if ( cs == 5 ) {
				cfg_usecharaffhp = limit(cfg_usecharaffhp + p, 0, 1)
				config_saveomakeoption "use_charaffhp.", str(cfg_usecharaffhp)
			}
			if ( cs == 6 ) {
				cfg_dump = limit(cfg_dump + p, 0, 1)
				config_saveomakeoption "dump.", str(cfg_dump)
			}
			if ( cs == 7 ) {
				cfg_guest = limit(cfg_guest + p, 0, 1)
				config_saveomakeoption "guest.", str(cfg_guest)
			}
			if ( cs == 8 ) {
				cfg_talkconvert = limit(cfg_talkconvert + p, 0, 1)
				config_saveomakeoption "talk_convert.", str(cfg_talkconvert)
			}
			if ( cs == 9 ) {
				cfg_stacksymbol = limit(cfg_stacksymbol + p, 0, 1)
				config_saveomakeoption "stack_symbol.", str(cfg_stacksymbol)
			}
			if ( cs == 10 ) {
				cfg_npcattackanime = limit(cfg_npcattackanime + p, 0, 2)
				config_saveomakeoption "npcAttackAnime.", str(cfg_npcattackanime)
			}
		}
		if ( submenu == 10 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_dmgmonitor0 = limit(cfg_dmgmonitor0 + p, 0, 1)
				config_saveomakeoption "dmgMonitor0.", str(cfg_dmgmonitor0)
				cfg_dmgmonitor += cfg_dmgmonitor0
			}
			if ( cs == 1 ) {
				cfg_dmgmonitortype = limit(cfg_dmgmonitortype + p, 0, 3)
				config_saveomakeoption "dmgMonitorType.", str(cfg_dmgmonitortype)
			}
			if ( cs == 2 ) {
				cfg_dmgmonitor1 = limit(cfg_dmgmonitor1 + p, 0, 1)
				config_saveomakeoption "dmgMonitorSub1.", str(cfg_dmgmonitor1)
				cfg_dmgmonitor += cfg_dmgmonitor1
			}
			if ( cs == 3 ) {
				cfg_dmgmonitor2 = limit(cfg_dmgmonitor2 + p, 0, 1)
				config_saveomakeoption "dmgMonitorSub2.", str(cfg_dmgmonitor2)
				cfg_dmgmonitor += cfg_dmgmonitor2
			}
			if ( cs == 4 ) {
				cfg_dmgmonitor3 = limit(cfg_dmgmonitor3 + p, 0, 1)
				config_saveomakeoption "dmgMonitorSub3.", str(cfg_dmgmonitor3)
				cfg_dmgmonitor += cfg_dmgmonitor3
			}
			if ( cs == 5 ) {
				cfg_dmgmonitor4 = limit(cfg_dmgmonitor4 + p, 0, 1)
				config_saveomakeoption "dmgMonitorSub4.", str(cfg_dmgmonitor4)
				cfg_dmgmonitor += cfg_dmgmonitor4
			}
			if ( cs == 6 ) {
				cfg_dmgfont = limit(cfg_dmgfont + p, 8, 30)
				config_saveomakeoption "dmgFont.", str(cfg_dmgfont)
			}
			if ( cs == 7 ) {
				cfg_dmgspeed = limit(cfg_dmgspeed + p, 1, 50)
				config_saveomakeoption "dmgSpeed.", str(cfg_dmgspeed)
			}
			if ( cs == 8 ) {
				cfg_txtpop = limit(cfg_txtpop + p, 0, 2)
				config_saveomakeoption "txtpop.", str(cfg_txtpop)
			}
			if ( cs == 9 ) {
				cfg_txtpopfont = limit(cfg_txtpopfont + p, 8, 30)
				config_saveomakeoption "txtpopFont.", str(cfg_txtpopfont)
				locvar_txt_conv_tmpfont(1) = cfg_txtpopfont
				gdatac(23) = join8bit(locvar_txt_conv_tmpfont)
			}
			if ( cs == 10 ) {
				cfg_txtpopspeed = limit(cfg_txtpopspeed + p, 1, 50)
				config_saveomakeoption "txtpopSpeed.", str(cfg_txtpopspeed)
			}
			if ( cs == 11 ) {
				cfg_txtpoptransparent = limit(cfg_txtpoptransparent + p, 100, 255)
				config_saveomakeoption "txtpoptransparent.", str(cfg_txtpoptransparent)
			}
			if ( cs == 12 ) {
				cfg_txtpopupdead = limit(cfg_txtpopupdead + p, 0, 1)
				config_saveomakeoption "txtpopupdead.", str(cfg_txtpopupdead)
			}
			if ( cs == 13 ) {
				cfg_nc_notshowzero = limit(cfg_nc_notshowzero + p, 0, 1)
				config_saveomakeoption "NC_notshowzero.", str(cfg_nc_notshowzero)
			}
		}
		if ( submenu == 11 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_targetex = limit(cfg_targetex + p, 0, 1)
				config_saveomakeoption "targetEx.", str(cfg_targetex)
			}
			if ( cs == 1 ) {
				cfg_targetbuff = limit(cfg_targetbuff + p, 0, 1)
				config_saveomakeoption "targetBuff.", str(cfg_targetbuff)
			}
			if ( cs == 2 ) {
				cfg_targetbullet = limit(cfg_targetbullet + p, 0, 1)
				config_saveomakeoption "targetBullet.", str(cfg_targetbullet)
			}
			if ( cs == 3 ) {
				cfg_targetresist = limit(cfg_targetresist + p, 0, 1)
				config_saveomakeoption "targetResist.", str(cfg_targetresist)
			}
			if ( cs == 4 ) {
				cfg_targetdebuff = limit(cfg_targetdebuff + p, 0, 2)
				config_saveomakeoption "targetDebuff.", str(cfg_targetdebuff)
			}
			if ( cs == 5 ) {
				cfg_targetstat = limit(cfg_targetstat + p, 0, 2)
				config_saveomakeoption "targetStat.", str(cfg_targetstat)
			}
			if ( cs == 6 ) {
				cfg_targetlockon = limit(cfg_targetlockon + p, 0, 1)
				config_saveomakeoption "targetLockon.", str(cfg_targetlockon)
			}
			if ( cs == 7 ) {
				cfg_targetclass = limit(cfg_targetclass + p, 0, 1)
				config_saveomakeoption "targetclass.", str(cfg_targetclass)
			}
			if ( cs == 8 ) {
				cfg_strackex = limit(cfg_strackex + p, 0, 2)
				config_saveomakeoption "sTrackEx.", str(cfg_strackex)
			}
			if ( cs == 9 ) {
				cfg_strackgrow = limit(cfg_strackgrow + p, 0, 1)
				config_saveomakeoption "sTrackGrow.", str(cfg_strackgrow)
			}
			if ( cs == 10 ) {
				cfg_strackstock = limit(cfg_strackstock + p, 0, 2)
				config_saveomakeoption "sTrackStock.", str(cfg_strackstock)
			}
			if ( cs == 11 ) {
				cfg_fruittrees = limit(cfg_fruittrees + p, 0, 1)
				config_saveomakeoption "fruitTrees.", str(cfg_fruittrees)
			}
		}
		if ( submenu == 12 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_equipex = limit(cfg_equipex + p, 0, 1)
				config_saveomakeoption "equipEx.", str(cfg_equipex)
			}
			if ( cs == 1 ) {
				cfg_proposeexclusion = limit(cfg_proposeexclusion + p, 0, 1)
				config_saveomakeoption "proposeExclusion.", str(cfg_proposeexclusion)
			}
			if ( cs == 2 ) {
				cfg_sndvolume = limit(cfg_sndvolume + p, -127, 0)
				pluginFunction cfg_sndvolume
				config_saveomakeoption "sndVolume.", str(cfg_sndvolume)
			}
			if ( cs == 3 ) {
				cfg_dmgtxttype = limit(cfg_dmgtxttype + p, 0, 1)
				config_saveomakeoption "dmgTxtType.", str(cfg_dmgtxttype)
			}
			if ( cs == 4 ) {
				cfg_fontstyle = limit(cfg_fontstyle + p, 0, 1)
				config_saveomakeoption "fontStyle.", str(cfg_fontstyle)
			}
			if ( cs == 5 ) {
				cfg_welcomemessage = limit(cfg_welcomemessage + p, 0, 1)
				config_saveomakeoption "welcomeMessage.", str(cfg_welcomemessage)
			}
			if ( cs == 6 ) {
				cfg_charasheet = limit(cfg_charasheet + p, 0, 2)
				config_saveomakeoption "charaSheet.", str(cfg_charasheet)
			}
			if ( cs == 7 ) {
				cfg_floormove = limit(cfg_floormove + p, 0, 1)
				config_saveomakeoption "floormove.", str(cfg_floormove)
			}
			if ( cs == 8 ) {
				cfg_notforsale = limit(cfg_notforsale + p, 0, 1)
				config_saveomakeoption "notforsale.", str(cfg_notforsale)
			}
			if ( cs == 9 ) {
				cfg_hideitem = limit(cfg_hideitem + p, 0, 1)
				config_saveomakeoption "hideitem.", str(cfg_hideitem)
			}
			if ( cs == 10 ) {
				cfg_petlead = limit(cfg_petlead + p, 0, 1)
				config_saveomakeoption "petlead.", str(cfg_petlead)
			}
			if ( cs == 11 ) {
				cfg_pcc = limit(cfg_pcc + p, 0, 1)
				config_saveomakeoption "pcc.", str(cfg_pcc)
			}
			if ( cs == 12 ) {
				cfg_npcposition = limit(cfg_npcposition + p, 0, 1)
				config_saveomakeoption "npcposition.", str(cfg_npcposition)
			}
			if ( cs == 13 ) {
				cfg_interactex = limit(cfg_interactex + p, 0, 1)
				config_saveomakeoption "interactex.", str(cfg_interactex)
			}
		}
		if ( submenu == 13 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_offercorpse = limit(cfg_offercorpse + p, 0, 1)
				config_saveomakeoption "offercorpse.", str(cfg_offercorpse)
			}
			if ( cs == 1 ) {
				cfg_randomeventreplace = limit(cfg_randomeventreplace + p, 0, 1)
				config_saveomakeoption "randomeventreplace.", str(cfg_randomeventreplace)
			}
			if ( cs == 2 ) {
				cfg_mma_pethpmonitor = limit(cfg_mma_pethpmonitor + p, 0, 1)
				config_saveomakeoption "MMA_pethpmonitor.", str(cfg_mma_pethpmonitor)
			}
			if ( cs == 3 ) {
				cfg_shopselectskip = limit(cfg_shopselectskip + p, 0, 1)
				config_saveomakeoption "shopselectskip.", str(cfg_shopselectskip)
			}
			if ( cs == 4 ) {
				cfg_youngersistervoice = limit(cfg_youngersistervoice + p, 0, 3)
				config_saveomakeoption "youngersistervoice.", str(cfg_youngersistervoice)
			}
			if ( cs == 5 ) {
				cfg_enchantvisualization = limit(cfg_enchantvisualization + p, 0, 1)
				config_saveomakeoption "enchantvisualization.", str(cfg_enchantvisualization)
			}
			if ( cs == 6 ) {
				cfg_treasuremachine = limit(cfg_treasuremachine + p, 0, 1)
				config_saveomakeoption "treasuremachine.", str(cfg_treasuremachine)
			}
			if ( cs == 7 ) {
				cfg_showstamina = limit(cfg_showstamina + p, 0, 1)
				config_saveomakeoption "showstamina.", str(cfg_showstamina)
			}
			if ( cs == 8 ) {
				cfg_nolog = limit(cfg_nolog + p, 0, 1)
				config_saveomakeoption "nolog.", str(cfg_nolog)
			}
			if ( cs == 9 ) {
				cfg_offernumber = limit(cfg_offernumber + p, 0, 1)
				config_saveomakeoption "offernumber.", str(cfg_offernumber)
			}
		}
		if ( submenu == 14 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_st_timestopeffect = limit(cfg_st_timestopeffect + p, 0, 1)
				config_saveomakeoption "ST_timeStopEffect.", str(cfg_st_timestopeffect)
			}
			if ( cs == 1 ) {
				cfg_st_fishinganimation = limit(cfg_st_fishinganimation + p, 0, 1)
				config_saveomakeoption "ST_fishingAnimation.", str(cfg_st_fishinganimation)
			}
			if ( cs == 2 ) {
				cfg_st_youngersistercorpse = limit(cfg_st_youngersistercorpse + p, 0, 1)
				config_saveomakeoption "ST_youngerSisterCorpse.", str(cfg_st_youngersistercorpse)
			}
			if ( cs == 3 ) {
				cfg_wait1 = limit(cfg_wait1 + p, 0, 30)
				config_savevanillaoption "wait1.", str(cfg_wait1)
				goto *com_config_loop
			}
			if ( cs == 4 ) {
				cfg_st_enchantmenthumanreadable = limit(cfg_st_enchantmenthumanreadable + p, 0, 1)
				config_saveomakeoption "ST_enchantmentHumanreadable.", str(cfg_st_enchantmenthumanreadable)
			}
			if ( cs == 5 ) {
				cfg_st_attributespotential = limit(cfg_st_attributespotential + p, 0, 1)
				config_saveomakeoption "ST_attributesPotential.", str(cfg_st_attributespotential)
			}
			if ( cs == 6 ) {
				cfg_st_displayhammerlevel = limit(cfg_st_displayhammerlevel + p, 0, 3)
				config_saveomakeoption "ST_displayHammerLevel.", str(cfg_st_displayhammerlevel)
			}
			if ( cs == 7 ) {
				cfg_st_displaylivingweaponlevel = limit(cfg_st_displaylivingweaponlevel + p, 0, 1)
				config_saveomakeoption "ST_displayLivingweaponLevel.", str(cfg_st_displaylivingweaponlevel)
			}
			if ( cs == 8 ) {
				cfg_st_moreseparation = limit(cfg_st_moreseparation + p, 0, 1)
				config_saveomakeoption "ST_moreSeparation.", str(cfg_st_moreseparation)
			}
			if ( cs == 9 ) {
				cfg_st_exchangecrawluporburied = limit(cfg_st_exchangecrawluporburied + p, 0, 1)
				config_saveomakeoption "ST_exchangeCrawlUpOrBuried.", str(cfg_st_exchangecrawluporburied)
			}
			if ( cs == 10 ) {
				cfg_st_sortbyexpirationdate = limit(cfg_st_sortbyexpirationdate + p, 0, 1)
				config_saveomakeoption "ST_sortByExpirationDate.", str(cfg_st_sortbyexpirationdate)
			}
			if ( cs == 11 ) {
				cfg_st_shortcut = limit(cfg_st_shortcut + p, 0, 1)
				config_saveomakeoption "ST_shortcut", str(cfg_st_shortcut)
			}
		}
		if ( submenu == 15 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_nc_stateshorten = limit(cfg_nc_stateshorten + p, 0, 1)
				config_saveomakeoption "NC_stateshorten.", str(cfg_nc_stateshorten)
			}
			if ( cs == 1 ) {
				cfg_nc_aphrodisiac = limit(cfg_nc_aphrodisiac + p, 0, 3)
				config_saveomakeoption "NC_aphrodisiac.", str(cfg_nc_aphrodisiac)
			}
			if ( cs == 2 ) {
				cfg_nc_reincarnation = limit(cfg_nc_reincarnation + p, 0, 2)
				config_saveomakeoption "NC_reincarnation.", str(cfg_nc_reincarnation)
			}
			if ( cs == 3 ) {
				cfg_nc_contractarart = limit(cfg_nc_contractarart + p, 0, 1)
				config_saveomakeoption "NC_contractarart.", str(cfg_nc_contractarart)
			}
			if ( cs == 4 ) {
				cfg_nc_starvearart = limit(cfg_nc_starvearart + p, 0, 1)
				config_saveomakeoption "NC_starvearart.", str(cfg_nc_starvearart)
			}
			if ( cs == 5 ) {
				cfg_alertstarvation = limit(cfg_alertstarvation + p, 0, 1)
				config_saveomakeoption "alertStarvation.", str(cfg_alertstarvation)
			}
			if ( cs == 6 ) {
				cfg_nc_qsave = limit(cfg_nc_qsave + p, 0, 1)
				config_saveomakeoption "NC_qsave.", str(cfg_nc_qsave)
			}
			if ( cs == 7 ) {
				cfg_nc_itemcount = limit(cfg_nc_itemcount + p, 0, 2)
				config_saveomakeoption "NC_itemcount.", str(cfg_nc_itemcount)
			}
			if ( cs == 8 ) {
				cfg_noautosave = limit(cfg_noautosave + p, 0, 3)
				config_saveomakeoption "noAutosave.", str(cfg_noautosave)
			}
			if ( cs == 9 ) {
				cfg_petequip = limit(cfg_petequip + p, 0, 1)
				config_saveomakeoption "petEquip.", str(cfg_petequip)
			}
			if ( cs == 10 ) {
				cfg_nc_wish = limit(cfg_nc_wish + p, 0, 1)
				config_saveomakeoption "NC_wish.", str(cfg_nc_wish)
			}
			if ( cs == 11 ) {
				cfg_nc_workshortening = limit(cfg_nc_workshortening + p, 0, 2)
				config_saveomakeoption "NC_workshortening.", str(cfg_nc_workshortening)
			}
			if ( cs == 12 ) {
				cfg_nc_logapply = limit(cfg_nc_logapply + p, 0, 1)
				config_saveomakeoption "NC_logapply.", str(cfg_nc_logapply)
			}
			if ( cs == 13 ) {
				cfg_nc_praypoint = limit(cfg_nc_praypoint + p, 0, 1)
				config_saveomakeoption "NC_praypoint.", str(cfg_nc_praypoint)
			}
			if ( cs == 14 ) {
				cfg_nc_directmoney = limit(cfg_nc_directmoney + p, 0, 1)
				config_saveomakeoption "NC_directmoney.", str(cfg_nc_directmoney)
			}
			if ( cs == 15 ) {
				cfg_nc_displayblesseddishes = limit(cfg_nc_displayblesseddishes + p, 0, 1)
				config_saveomakeoption "NC_displayblesseddishes.", str(cfg_nc_displayblesseddishes)
			}
		}
		if ( submenu == 16 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_nc_charasheet = limit(cfg_nc_charasheet + p, 0, 1)
				config_saveomakeoption "NC_charasheet.", str(cfg_nc_charasheet)
			}
			if ( cs >= 1 & cs < 9 ) {
				cfg_nc_charasheetdata(cs - 1) = limit(cfg_nc_charasheetdata(cs - 1) + p, 0, 37)
				config_saveomakeoption "NC_charasheetdata" + (cs - 1) + ".", str(cfg_nc_charasheetdata(cs - 1))
			}
			if ( cs == 9 ) {
				cfg_nc_detail = limit(cfg_nc_detail + p, 0, 1)
				config_saveomakeoption "NC_detail.", str(cfg_nc_detail)
			}
		}
		if ( submenu == 17 ) {
			snd SOUNDLIST_OK1
			if ( cs == 0 ) {
				cfg_nc_sstp_enabled = limit(cfg_nc_sstp_enabled + p, 0, 1)
				config_saveomakeoption "NC_sstp_enabled.", str(cfg_nc_sstp_enabled)
			}
			if ( cs == 1 ) {
				cfg_nc_sstp_sakura = limit(cfg_nc_sstp_sakura + p, 0, 17)
				config_saveomakeoption "NC_sstp_sakura.", str(cfg_nc_sstp_sakura)
			}
			if ( cs == 2 ) {
				cfg_nc_sstp_unyu = limit(cfg_nc_sstp_unyu + p, 0, 17)
				config_saveomakeoption "NC_sstp_unyu.", str(cfg_nc_sstp_unyu)
			}
			if ( cs == 3 ) {
				cfg_nc_sstp_suppresslog = limit(cfg_nc_sstp_suppresslog + p, 0, 1)
				config_saveomakeoption "NC_sstp_suppresslog.", str(cfg_nc_sstp_suppresslog)
			}
			if ( cs == 4 ) {
				cfg_nc_sstp_notifyevent = limit(cfg_nc_sstp_notifyevent + p, 0, 1)
				config_saveomakeoption "NC_sstp_notifyevent.", str(cfg_nc_sstp_notifyevent)
			}
			if ( cs == 5 ) {
				cfg_nc_sstp_nowait = limit(cfg_nc_sstp_nowait + p, 0, 1)
				config_saveomakeoption "NC_sstp_nowait.", str(cfg_nc_sstp_nowait)
			}
		}
	}
	if ( key == key_cancel ) {
		if ( submenu != 0 ) {
			submenu = 0
			goto *com_config
		}
		gosub *config_load
		gosub *label_2525
		if ( mode == MODELIST_MAIN ) {
			if ( cfg_net ) {
				gosub *net_init
			}
			gosub *screen_draw
			goto *pc_turn
		}
		else {
			goto *game_title
		}
	}
	if ( key == key_identify ) {
		if ( submenu >= 1 & submenu != 5 ) {
			repeat
				redraw 0
				configdetailstr = configdetail(cs)
				if ( configdetailstr == "" ) {
					configdetailstr = lang("(説明はありません)", "(No description)")
				}
				s = "", "Enter," + strhint3
				pagesize = 0
				windowshadow = 1
				display_window windoww / 2 - 240, windowh / 2 - 80, 480, 160
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 5
				pos wx + 32, wy + 32
				mes listn(0, cs)
				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
				pos wx + 36, wy + 56 + sizefix - en * 2
				mes configdetailstr
				redraw 1
				await 20
				key_check
				if ( key == key_cancel | key == key_enter ) {
					break
				}
			loop
			goto *com_config
		}
	}
	goto *com_config_loop_WHILE1

#deffunc _config_saveoptionbase var _config_saveoptionbase_prm0, str _config_saveoptionbase_prm1
	notesel _config_saveoptionbase_prm0
	if ( playerid != "" & cfg_nc_saveconfig ) {
		exist exedir + "\\save\\" + playerid + "\\" + _config_saveoptionbase_prm1
		if ( strsize != (-1) ) {
			noteload exedir + "\\save\\" + playerid + "\\" + _config_saveoptionbase_prm1
		}
		else {
			noteload exedir + "\\" + _config_saveoptionbase_prm1
			notesave exedir + "\\save\\" + playerid + "\\" + _config_saveoptionbase_prm1
		}
	}
	else {
		noteload exedir + "\\" + _config_saveoptionbase_prm1
	}
	f = 0
	repeat noteinfo(0)
		noteget s, cnt
		if ( instr(s, 0, valn) == (-1) ) {
			continue
		}
		i = 1
		p = 0
		repeat
			p(2) = instr(s, p, "\"")
			if ( p(2) == (-1) ) {
				break
			}
			p += p(2)
			p(1) = instr(s, p + 1, "\"") + p + 1
			if ( p(1) == (-1) ) {
				break
			}
			s = strmid(s, 0, p + 1) + valn(i) + strmid(s, p(1), 999)
			p += strlen(valn(i)) + 2
			i++
		loop
		noteadd s, cnt, 1
		f = 1
		break
	loop
	if ( f == 0 ) {
		noteadd "" + valn + " \"" + valn(1) + "\""
	}
	if ( playerid != "" & cfg_nc_saveconfig ) {
		notesave exedir + "\\save\\" + playerid + "\\" + _config_saveoptionbase_prm1
	}
	else {
		notesave exedir + "\\" + _config_saveoptionbase_prm1
	}
	return

#deffunc config_savevanillaoption str config_savevanillaoption_prm0, str config_savevanillaoption_prm1
	valn = config_savevanillaoption_prm0, config_savevanillaoption_prm1
	_config_saveoptionbase note_buff, "config.txt"
	return

#deffunc config_savevanillakeyoption str config_savevanillakeyoption_prm0, str config_savevanillakeyoption_prm1, int config_savevanillakeyoption_prm2
	valn = config_savevanillakeyoption_prm0, config_savevanillakeyoption_prm1, str(config_savevanillakeyoption_prm2), ""
	_config_saveoptionbase note_buff, "config.txt"
	return

#deffunc config_saveomakeoption str config_saveomakeoption_prm0, str config_saveomakeoption_prm1
	valn = config_saveomakeoption_prm0, config_saveomakeoption_prm1
	_config_saveoptionbase omakeconfigbuff, "omake_config.txt"
	return

*config_initOmake
	cfg_useffhp = 1
	cfg_userface1 = 1
	cfg_overcastspell = 1
	cfg_autopick = 1
	cfg_autopicksound = 1
	cfg_autodestroysound = 1
	cfg_putgrass = 0
	cfg_showroomserver = 0
	cfg_showroomlog = 2
	cfg_moongatejump = 1
	cfg_improvescroll = 0
	cfg_datacopy = 0
	cfg_hostname = "seacolorswind.sakura.ne.jp"
	cfg_graphicpc = 0
	cfg_graphicnpc = 0
	cfg_npcwalk = 0
	cfg_reloadcnpc = 1
	cfg_picknumber = 0
	cfg_transfernumber = 0
	cfg_hpgauge = 0
	cfg_thousandsep = 0
	cfg_cg_off = 0
	cfg_shortcut = 0
	cfg_camera = 0
	cfg_usecharaffhp = 0
	cfg_dump = 0
	cfg_guest = 0
	cfg_talkconvert = 0
	cfg_key_cast_ancient = "V"
	cfg_key_cast_another = "n"
	cfg_stacksymbol = 0
	cfg_npcattackanime = 0
	cfg_key_godinfo = "P"
	cfg_dmgmonitor = 0
	cfg_dmgmonitor0 = 0
	cfg_dmgmonitortype = 0
	cfg_dmgmonitor1 = 0
	cfg_dmgmonitor2 = 0
	cfg_dmgmonitor3 = 0
	cfg_dmgmonitor4 = 0
	cfg_dmgfont = 11
	cfg_dmgspeed = 20
	cfg_targetex = 0
	cfg_targetbuff = 1
	cfg_targetbullet = 1
	cfg_targetresist = 1
	cfg_targetdebuff = 1
	cfg_targetstat = 1
	cfg_targetlockon = 1
	cfg_targetclass = 1
	cfg_strackex = 0
	cfg_strackgrow = 0
	cfg_strackstock = 0
	cfg_equipex = 0
	cfg_fruittrees = 0
	cfg_petnegotiateexp = 0
	cfg_unlockexp = 0
	cfg_petfaithexp = 0
	cfg_wonderscroll = 0
	cfg_noautosave = 0
	cfg_alertstarvation = 0
	cfg_foodshop = 0
	cfg_key_info = "I"
	cfg_proposeexclusion = 1
	cfg_sndvolume = 0
	cfg_dmgtxttype = 0
	cfg_petequip = 0
	cfg_fontstyle = 0
	cfg_key_autodig = "H"
	cfg_welcomemessage = 0
	cfg_teleportation = 0
	cfg_minimapex = 0
	cfg_namescroll = 0
	cfg_offercorpse = 0
	cfg_randomeventreplace = 0
	cfg_mma_pethpmonitor = 0
	cfg_shopselectskip = 0
	cfg_blessedfood = 0
	cfg_youngersistervoice = 0
	cfg_enchantvisualization = 0
	cfg_treasuremachine = 0
	cfg_meatbunrecipe = 0
	cfg_showstamina = 0
	cfg_nolog = 0
	cfg_offernumber = 0
	cfg_charasheet = 0
	cfg_floormove = 0
	cfg_notforsale = 0
	cfg_hideitem = 0
	cfg_petlead = 0
	cfg_rapidmagic = 0
	cfg_txtpop = 0
	cfg_txtpopfont = 11
	cfg_txtpopspeed = 20
	cfg_txtpoptransparent = 256
	cfg_txtpopdead = 0
	cfg_pcc = 0
	cfg_rndclass = 0
	cfg_npcposition = 0
	cfg_interactex = 0
	cfg_st_timestopeffect = 1
	cfg_st_fishinganimation = 1
	cfg_st_youngersistercorpse = 1
	cfg_st_enchantmenthumanreadable = 0
	cfg_st_attributespotential = 0
	cfg_st_displayhammerlevel = 0
	cfg_st_displaylivingweaponlevel = 0
	cfg_st_exchangecrawluporburied = 0
	cfg_st_sortbyexpirationdate = 0
	cfg_st_oo2016compatibledancerfeat = 0
	cfg_st_shortcut = 0
	cfg_nc_stateshorten = 0
	cfg_nc_aphrodisiac = 0
	cfg_nc_reincarnation = 0
	cfg_nc_contractarart = 0
	cfg_nc_starvearart = 0
	cfg_nc_qsave = 0
	cfg_nc_itemcount = 0
	cfg_nc_saveconfig = 0
	cfg_nc_wish = 0
	cfg_nc_workshortening = 0
	cfg_nc_logapply = 0
	cfg_nc_praypoint = 0
	cfg_nc_directmoney = 0
	cfg_nc_displayblesseddishes = 0
	cfg_nc_charasheet = 0
	repeat 8
		cfg_nc_charasheetdata(cnt) = 0
	loop
	cfg_nc_detail = 0
	cfg_nc_sstp_enabled = 0
	cfg_nc_sstp_sakura = 0
	cfg_nc_sstp_unyu = 0
	cfg_nc_sstp_suppresslog = 0
	cfg_nc_sstp_notifyevent = 0
	cfg_nc_sstp_nowait = 0
	cfg_nc_key_music = "M"
	key_mode3 = ","
	cfg_nc_key_macro = "+"
	cfg_nc_noseasonalevent = 0
	cfg_nc_sstp_server = "127.0.0.1"
	cfg_nc_sstp_port = 9801
	return

*com_story
	snd SOUNDLIST_BOOK1
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "graphic\\book.bmp", 1
	gsel BUFFER_PIC
	pos 0, 0
	picload_ exedir + "\\graphic\\g1.bmp", 0
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 12
	cs = 0
	cc = CHARA_PLAYER
	notesel buff
	noteload lang("scene1.hsp", "scene2.hsp")
	p = 0
	repeat 200
		s = "{" + cnt + "}"
		p = instr(buff, 0, s)
		if ( p != (-1) ) {
			if ( cnt <= gStoryBookmark ) {
				list(0, listmax) = cnt, p
				listmax++
			}
		}
	loop
	redraw 0
	txt -1, lang("どのシーンを再生する？", "Which scene do you want to replay?")

*com_story_loop_pgchk
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	wx = (windoww - 720) / 2 + inf_screenx
	wy = winposy(468)

*com_story_loop
	redraw 0
	pos wx, wy
	gcopy BUFFER_BUF, 0, 0, 736, 448
	x = 240
	y = 320
	gmode 4, 180, 300, 100
	color 0, 0, 0
	pos wx + 190, wy + 220
	grotate BUFFER_PIC, 0, 0, 0, x, y
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		display_key wx + 394, wy + 91 + cnt * 22 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 6
	color 0, 0, 0
	pos wx + 90, wy + 50
	mes "Elona - Scene playback"
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 0
	color 0, 0, 0
	pos wx + 390, wy + 50
	mes lang("アンロックされたシーンを再生できます。\nシーンNoは連続していません。", "You can play the unlocked scenes.")
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		cs_list lang("シーン No.", "Scene No. ") + i, wx + 424, wy + 91 + cnt * 22 - 1, 19
	loop
	font lang(cfg_font1, cfg_font2), 12 - en * 2, 1
	color 0, 0, 0
	pos wx + 500, wy + 375
	mes "- " + (page + 1) + " -"
	if ( page < pagemax ) {
		pos wx + 590, wy + 375
		mes "(more)"
	}
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		sceneid = p
		gosub *scene
		screenupdate = -1
		gosub *screen_refreshFull
		txtnew
		txt -1, lang("シーンの再生を終えた。", "The scene has been played.")
		goto *com_story
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_CARD1
			page++
			goto *com_story_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_CARD1
			page--
			goto *com_story_loop_pgchk
		}
	}
	if ( key == key_cancel | key == key_enter ) {
		gosub *music_play
		gosub *screen_draw
		goto *pc_turn
	}
	goto *com_story_loop
	inv_getheader 0
	p = 0, 0
	p = 0, 0
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		i = refitem(iID(cnt), DBSPEC_TYPE, cnt)
		if ( i != 53000 & i != 52000 & i != 56000 & i != 54000 & i >= 50000 ) {
			continue
		}
		if ( iKnown(cnt) < 5 ) {
			item_identify cnt, 250, -1
			item_stack CHARA_PLAYER, cnt
			p(1)++
			if ( idtresult == 5 ) {
				p++
			}
		}
	loop
	return

*label_4125
	gYear  = 517, 8, 12, 16, 10
	quickpage = 1
	if ( defload != "" ) {
		exist exedir + "save\\" + defload + "\\header.txt"
		if ( strsize == (-1) ) {
			exist exedir + "save\\sav_" + defload + "\\header.txt"
			if ( strsize != (-1) ) {
				defload = "sav_" + defload
			}
			else {
				defload = ""
			}
		}
		if ( defload == "" ) {
			dialog "Invalid defLoadFolder. name"
		}
		else {
			buff = ""
			notesel buff
			file = exedir + "save\\trophy"
			exist file + ".txt"
			if ( strsize != (-1) ) {
				noteload file + ".txt"
				repeat noteinfo(0)
					noteget troget, cnt
					trophy(cnt) = int(troget)
				loop
			}
			playerid = defload
			mode = MODELIST_CONTINUE
			music = MUSICLIST_NONE
			goto *world_init
		}
	}
	buff = ""
	notesel buff
	file = exedir + "save\\trophy"
	exist file + ".txt"
	if ( strsize != (-1) ) {
		noteload file + ".txt"
		repeat noteinfo(0)
			noteget troget, cnt
			trophy(cnt) = int(troget)
		loop
	}
	goto *game_title

*world_init
	mtilefilecur = -1
	firstturn = 1
	msgtemp = "  Lafrontier presents Elona ver " + "1.22" + ". Welcome traveler! "
	if ( cfg_nc_saveconfig & mode != MODELIST_NORMAL_START ) {
		gosub *config_loadOmake
		gosub *config_loadCore
		gosub *config_load
	}
	if ( cfg_net ) {
		gosub *net_init
	}
	if ( mode == MODELIST_QUICK_START ) {
		repeat 9
			gdata(STARTING_GDATA_RANK + cnt) = 5000
		loop
		gVersion = int(double("1.22") * 1000)
		gdata(STARTING_GDATA_SHORTCUT + 1) = 424
		gdata(STARTING_GDATA_SHORTCUT + 2) = 300
		gdata(STARTING_GDATA_SHORTCUT + 3) = 631
		gCountShop = 1000
		gCountShelter = 100
		dbgchara = 23
		playerid = "sav_noa"
		gWorldX = 22
		gWorldY = 21
		gAreaPrev = -1
		gRandSeedA = rnd(800) + 2
		gRandSeedB = rnd(200) + 2
		gArea  = AREA_NORTH_TYRIS
		gLevel  = 0
		gLevelStartOn = 7
		mapstartx = 22
		mapstarty = 21
		gArea  = AREA_VERNIS
		gLevel  = 1
		gLevelStartOn = 7
		mapstartx = 10
		mapstarty = 23
		initlv = 50
		rc = CHARA_PLAYER
		flt 100
		characreate CHARA_PLAYER, CREATURE_ID_TITAN, -3, 0
		gosub *label_1713
		repeat 3
		loop
		gYear  = 517, 12, 30, 1, 10
		gStoryBookmark = 50
		flagAlly = 1
		areaParent(7) = AREA_NORTH_TYRIS
		gWorld = areaParent(gArea )
		gTraitPoint = 2
		gSisterSaved = 1000
		gHeirDeed = 1000
		gHomeLevel = 0
		gGuest = 2
		gAbsorbCharge = 1000
		cGod(CHARA_PLAYER) = GOD_LULWY, 1000, 1000
		sqMother = 1000
		se_moneymod 0, 1000000
		cPlat(CHARA_PLAYER) = 30
		cFame(CHARA_PLAYER) = 65000
		flagMain = 100
		r1 = 0
		gosub *charaRefresh
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_WALLET, -1, -1, 0
		iNum(ci) = 20
		iStatus(ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ALCHEMY_TOOLS, -1, -1, 0
		iNum(ci) = 20
		iStatus(ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_BAIT, -1, -1, 0
		iNum(ci) = 20
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_NUCLEAR_BOMB, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_STATUE_CREATOR, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SUMMONING_CRYSTAL, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_EMPTY_BOTTLE, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_FISHING_POLE, -1, -1, 0
		iNum(ci) = 12
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_RUNE, -1, -1, 0
		iNum(ci) = 50
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_BOTTLE_DYE, -1, -1, 0
		iNum(ci) = 50
		iCol(ci) = 4
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SMALL_MEDAL, -1, -1, 0
		iNum(ci) = 50000
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PRESIDENTS_CHAIR, -1, -1, 0
		iNum(ci) = 5
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_LOVE_POTION, -1, -1, 0
		iNum(ci) = 5
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_FIREPROOF_LIQUID, -1, -1, 0
		iNum(ci) = 5
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ACIDPROOF_LIQUID, -1, -1, 0
		iNum(ci) = 5
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_BOTTLE_WATER, -1, -1, 0
		iNum(ci) = 5
		iStatus(ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_POISON, -1, -1, 0
		iNum(ci) = 5
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_FLYING_SCROLL, -1, -1, 0
		iNum(ci) = 10
		iStatus(ci) = ITEM_STATUS_CURSED
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_FLYING_SCROLL, -1, -1, 0
		iNum(ci) = 10
		iStatus(ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_CORPSE, -1, -1, 0
		iSubName(ci) = 330
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_LOCKPICK, -1, -1, 0
		iNum(ci) = 3
		iStatus(ci) = ITEM_STATUS_NORMAL
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_FISHING_POLE, -1, -1, 0
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 100
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SALMON, -1, -1, 0
		iNum(ci) = 20
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_STRADIVARIUS, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_CLAYMORE2, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_STATUE_LULWY, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_STATUE_JURE, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_STATUE_EHEKATL, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_TOMATO, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_LARGE_BOOKSHELF, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_LUXURY_CABINET, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SPECIAL_STEAMED_MEAT_BUN, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_STATUE_KUMIROMI, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_STATUE_MANI, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_LUXURY_SOFA, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_DEER_HEAD, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_FUR_CARPET, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_KITCHEN_KNIFE, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_LARGE_DISH, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_CARD_PACK, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_BOTTLE_SALT, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SACK_SUGAR, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PUFF_PUFF_BREAD, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SKULL_BOW, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_POT_FOR_FUSION, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_POT_OF_ALCHEMIST, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_DRAGON_SLAYER, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PUTITORO, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SACK_FLOUR, -1, -1, 0
		iNum(ci) = 100
		gdata(STARTING_GDATA_SHORTCUT + 1) = 789 + 14 * 10000
		gdata(STARTING_GDATA_SHORTCUT + 2) = 790 + 14 * 10000
		repeat 1200
			recipememory(cnt) = 1
		loop
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_RECIPE, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_RECIPE, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_RECIPE, -1, -1, 0
		iSubName(ci) = 787 + 400
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_RECIPE, -1, -1, 0
		iSubName(ci) = 555 + 400
		itemcreate CHARA_PLAYER, ITEM_ID_SECRET_TREASURE, -1, -1, 0
		iParam1(ci) = 164
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ACIDPROOF_LIQUID, -1, -1, 0
		iNum(ci) = 10
		iStatus(ci) = ITEM_STATUS_BLESSED
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ACIDPROOF_LIQUID, -1, -1, 0
		iNum(ci) = 10
		iStatus(ci) = ITEM_STATUS_CURSED
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ACIDPROOF_LIQUID, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PLATINUM_COIN, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_ROD_HOLY_LIGHT, -1, -1, 0
		iNum(ci) = 10
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SECRET_TREASURE, -1, -1, 0
		iNum(ci) = 10
		iParam1(ci) = 169
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_SECRET_TREASURE, -1, -1, 0
		iNum(ci) = 10
		iParam1(ci) = 162
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_BLUE_CAPSULE_DRAG, -1, -1, 0
		iNum(ci) = 100
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_GOULDS_PIANO, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_MINIATURE_TREE, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_PEDESTAL, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_COUNTER, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_NEW_YEARS_DECORATION, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_BLUE_STALL, -1, -1, 0
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_NEW_YEARS_GIFT, -1, -1, 0
		if ( stat != 0 ) {
			iParam3(ci) = 240
			iNum(ci) = 50
		}
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_KAGAMI_MOCHI, -1, -1, 0
		if ( stat != 0 ) {
			iParam3(ci) = 240
			iNum(ci) = 50
		}
		flt
		itemcreate CHARA_PLAYER, ITEM_ID_MOCHI, -1, -1, 0
		if ( stat != 0 ) {
			iParam3(ci) = 240
			iNum(ci) = 50
		}
		repeat 40
			flt 50, FIX_QUALITY_GODLY
			flttypemajor = FILTER_ITEM_ROD
			itemcreate CHARA_PLAYER, -1, -1, -1, 0
			flt 50, FIX_QUALITY_GODLY
			flttypemajor = FILTER_ACCESSORY_AMULET
			itemcreate CHARA_PLAYER, -1, -1, -1, 0
			flt 50, FIX_QUALITY_GODLY
			flttypemajor = FILTER_ACCESSORY_RING
			itemcreate CHARA_PLAYER, -1, -1, -1, 0
		loop
		cbitmod CHARA_BIT_RAPID_MAGIC, CHARA_PLAYER, TRUE
		mode = MODELIST_MAIN
		gosub *label_1681
		repeat 55
			mat(cnt) = 200
		loop
		gosub *label_3912
		create_pcpic 0, 1
		cnAka(CHARA_PLAYER) = random_title()
		cnName(CHARA_PLAYER) = randomname()
		mode = MODELIST_NEW
	}
	if ( mode == MODELIST_NORMAL_START ) {
		gYear  = 517, 8, 12, 1, 10
		gWorldX = 22
		gWorldY = 21
		gAreaPrev = -1
		gWorld = AREA_NORTH_TYRIS
		ghelp = 1
		gArea  = AREA_HOME
		gLevel  = 1
		gLevelStartOn = 4
		gHomeLevel = 0
		gosub *label_2367
		gVersion = int(double("1.22") * 1000)
		gWeather = WEATHER_RAIN, 6
		repeat 20
			gdata(STARTING_GDATA_RANK + cnt) = 10000
		loop
		gosub *label_3912
		if ( gettrait(0, 184) < 0 ) {
			flagAlly = 1
		}
		r1 = 0
		gosub *charaRefresh
		initializesouthtyristowns
		mode = MODELIST_NEW
		evadd EVENT_OPENING
		evadd EVENT_INIT_ECONOMY
		sceneid = 0
		gosub *scene
	}
	if ( mode == MODELIST_NEW ) {
		gCountShop = 1000
		gCountShelter = 100
		gosub *label_2523
		throwsstpevent "NewGame", 0, "", 0
	}
	if ( mode == MODELIST_CONTINUE ) {
		gosub *label_3116
	}
	gosub *define_los
	if ( cfg_nc_logapply == 1 ) {
		nnetflag = 0
		rndtextid = rnd(3)
		s = "お兄ちゃ〜ん", "…本当に起動してしまったのか？", "うみみゃあ！！"
		s = lang("" + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + "がゲームを起動しました。" + s(rndtextid), "" + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + " has launched the game.")
		gosub *nc_net
	}
	goto *map_init

*main_init
	procid = (procid + 1) \ 10
	proclist(procid) = "main_init:Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	sound = SOUNDLIST_NONE
	ct = 0
	repeat 200
		if ( mefExist(cnt) == MEF_TYPE_NONE ) {
			break
		}
		if ( mefExist(cnt) == MEF_TYPE_FIRE ) {
			if ( mField == MAP_FIELD_OUTDOOR ) {
				if ( mType != MAP_TYPE_WORLD ) {
					if ( gWeather == WEATHER_RAIN | gWeather == WEATHER_HARD_RAIN ) {
						delmef cnt
						continue
					}
					dx = mefX(cnt)
					dy = mefY(cnt)
					i = mefOwner(cnt)
					p = 0
					if ( rnd(35) == 0 ) {
						p = 3
						if ( dist(dx, dy, cX(CHARA_PLAYER), cY(CHARA_PLAYER)) < 6 ) {
							sound = SOUNDLIST_FIRE1
						}
					}
					repeat p
						x = rnd(2) + dx - rnd(2)
						y = rnd(2) + dy - rnd(2)
						if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
							f = 0
							continue
						}
						if ( chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS ) {
							mapId(x, y) = xy2pic(4, 1)
							continue 0
						}
						addmef x, y, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50, i
						mapitem_fire x, y
					loop
				}
			}
		}
		if ( mefExist(cnt) == MEF_TYPE_NUKE ) {
			txtef COLOR_RED
			txt -1, lang(" *", "*") + mefDur(cnt) + lang("* ", "*")
		}
		if ( mefDur(cnt) != (-1) ) {
			mefDur(cnt)--
			if ( mefDur(cnt) == 0 ) {
				delmef cnt
			}
		}
	loop
	if ( sound != SOUNDLIST_NONE ) {
		snd sound
	}
	gspd = cSpeed(CHARA_PLAYER) * (100 + cTimeScale(CHARA_PLAYER)) / 100
	if ( gspd < 10 ) {
		gspd = 10
	}
	turncost = (mTimeScale - cSpeedSum(CHARA_PLAYER)) / gspd + 1
	if ( evnum != 0 ) {
		evproc = 1
		gosub *label_4208
		evproc = 0
		evnum--
		evlist(evnum) = 0
		if ( chatteleport == 1 ) {
			chatteleport = 0
			goto *map_exit
		}
		goto *main_init
	}
	if ( cExist(CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
		goto *pc_dead
	}
	if ( mType == MAP_TYPE_WORLD ) {
		if ( cActionPeriod(CHARA_PLAYER) > 2 ) {
			cSpeedSum(CHARA_PLAYER) = mTimeScale
			goto *spdSkip
		}
	}
	repeat 245
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		spd = cSpeed(cnt) * (100 + cTimeScale(cnt)) / 100
		if ( spd < 10 ) {
			spd = 10
		}
		cSpeedSum(cnt) += spd * turncost
	loop

*spdSkip
	gSec  += turncost / 5 + 1
	if ( gSec  >= 60 ) {
		gTurn++
		cc = CHARA_PLAYER
		if ( gTurn \ 20 == 0 ) {
			gosub *label_2164
		}
		if ( gTurn \ 10 == 1 ) {
			gosub *label_1830
		}
		gMin  += gSec  / 60
		if ( gTimelimit > 0 ) {
			gTimelimit -= gSec  / 60
			if ( gCountNotice > gTimelimit / 10 ) {
				txtef COLOR_SKY_BLUE
				txt -1, lang("クエスト[残り" + (gTimelimit + 1) + "分]", "" + (gTimelimit + 1) + " min left for the quest.")
				gCountNotice = gTimelimit / 10
				if ( gQuest == 1021 ) {
					nc_intb_001 = -1
					txtef COLOR_RED
					txt -1, lang("モンスター達が羊に向かっている！", "The monsters are coming towards Sheep!")
					repeat 188, 57
						if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
							if ( eqfaction(cnt, "nc_sheep") ) {
								nc_intb_001 = cnt
							}
						}
					loop
					repeat 188, 57
						if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
							if ( eqfaction(cnt, "nc_sheep") == 0 ) {
								cRelation(cnt) = RELATION_ENEMY
								lockon cnt, nc_intb_001, 29
								cAiAggro(cnt) = 250
							}
						}
					loop
				}
			}
			if ( gTimelimit <= 0 ) {
				gTimelimit = 0
				evadd EVENT_QUEST_TIMEOUT
			}
		}
		gSec  = gSec  \ 60
		if ( gMin  >= 60 ) {
			gHour  += gMin  / 60
			gMin  = gMin  \ 60
			gosub *label_4143
		}
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "main_init:End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	goto *label_4149

*label_4142
	if ( gWeather == WEATHER_SNOW ) {
		if ( getcontinentareaid(gArea ) == 4 == 0 | (gWorldX < 65 & gWorldY > 10) ) {
			if ( gettrait(0, 222) == 0 ) {
				gWeather = WEATHER_RAIN
				envonly = 1
				gosub *music_play
				gNextWeather += 3
				txt -1, lang("天候が変わった。", "The weather changes.")
			}
		}
	}
	if ( gWeather == WEATHER_HARD_RAIN | gWeather == WEATHER_RAIN ) {
		if ( getcontinentareaid(gArea ) == 4 & (gWorldX > 65 | gWorldY < 10) ) {
			gWeather = WEATHER_SNOW
			envonly = 1
			gosub *music_play
			gNextWeather += 3
			txt -1, lang("天候が変わった。", "The weather changes.")
		}
	}
	return

*label_4143
	procid = (procid + 1) \ 10
	proclist(procid) = "Advance_hour:Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( areaId(gArea ) == AREA_MUSEUM ) {
		gosub *museum_update
	}
	if ( gArea  == AREA_HOME ) {
		gosub *house_update
	}
	if ( mType == MAP_TYPE_WORLD ) {
		gWorldX = cX(CHARA_PLAYER)
		gWorldY = cY(CHARA_PLAYER)
	}
	if ( gWeather != WEATHER_ETHER ) {
		if ( gettrait(0, 222) != 0 ) {
			gWeather = WEATHER_SNOW
		}
	}
	gNextWeather--
	gosub *label_4142
	if ( gNextWeather < 0 ) {
		gNextWeather = rnd(22) + 2
		p = gWeather
		repeat 1
			if ( gMonth  \ 3 == 0 ) {
				if ( gDay  >= 1 & gDay  <= 10 ) {
					if ( gLastEther != gMonth  ) {
						if ( rnd(15) < gDay  + 5 ) {
							gWeather = WEATHER_ETHER
							txtef COLOR_RED
							txt -1, lang("エーテルの風が吹き始めた。すぐに避難しなくては。", "Ether Wind starts to blow. You need to find a shelter!")
							gLastEther = gMonth 
							gNextWeather = rnd(24) + 24
							break
						}
					}
				}
			}
			if ( gWeather != WEATHER_ETHER ) {
				if ( gettrait(0, 222) != 0 ) {
					gWeather = WEATHER_SNOW
					gNextWeather = rnd(12) + 6
					break
				}
			}
			if ( p == 0 ) {
				weatherbk = 0
				if ( gettrait(0, 209) != 0 ) {
					if ( rnd(4) == 0 ) {
						gWeather = WEATHER_RAIN
						txt -1, lang("あなたは雨雲を引き寄せた。", "You draw a rain cloud.")
						break
					}
				}
				if ( getcontinentareaid(gArea ) == 4 & (gWorldX > 65 | gWorldY < 10) ) {
					if ( rnd(2) == 0 ) {
						gWeather = WEATHER_SNOW
						txt -1, lang("雪が降ってきた。", "It starts to snow.")
						break
					}
				}
				else {
					if ( rnd(10) == 0 | (godcheck() == "inari" & rnd(4) == 0) ) {
						gWeather = WEATHER_RAIN
						txt -1, lang("雨が降り出した。", "It starts to rain.")
						break
					}
					if ( rnd(40) == 0 ) {
						gWeather = WEATHER_HARD_RAIN
						txt -1, lang("突然どしゃぶりになった。", "Suddenly, rain begins to pour down from the sky.")
						break
					}
					if ( rnd(60) == 0 ) {
						gWeather = WEATHER_SNOW
						txt -1, lang("雪が降ってきた。", "It starts to snow.")
						break
					}
				}
			}
			if ( p == 3 ) {
				if ( rnd(4) == 0 ) {
					gWeather = WEATHER_CLEAR
					txt -1, lang("雨は止んだ。", "It stops raining.")
					break
				}
				if ( rnd(15) == 0 ) {
					if ( godcheck() != "inari" | rnd(3) == 0 ) {
						gWeather = WEATHER_HARD_RAIN
						txt -1, lang("雨が本格的に降り出した。", "The rain becomes heavier.")
						if ( godcheck() == "serria" & ogTitleTetrapod == 2 ) {
							gWeather = WEATHER_CLEAR
							txt -1, lang("…しかし、すぐに雨は止んだ。", "...But, the rain soon stopped.")
						}
						break
					}
				}
			}
			if ( p == 4 ) {
				if ( rnd(3) == 0 ) {
					gWeather = WEATHER_RAIN
					txt -1, lang("雨は小降りになった。", "The rain becomes lighter.")
					break
				}
			}
			if ( p == 1 ) {
				if ( rnd(2) == 0 & gWeather == WEATHER_ETHER ) {
					gWeather = WEATHER_CLEAR
					txt -1, lang("エーテルの風は止んだ。", "The Ether Wind dissipates.")
					if ( gettrait(0, 222) != 0 ) {
						gWeather = WEATHER_SNOW
					}
					break
				}
			}
			if ( p == 2 ) {
				if ( rnd(3) == 0 ) {
					gWeather = WEATHER_CLEAR
					txt -1, lang("雪は止んだ。", "It stops raining.")
					break
				}
			}
		loop
		if ( gWeather == WEATHER_HARD_RAIN ) {
			if ( cfg_extrahelp ) {
				if ( gdata(STARTING_GDATA_HELP + 11) == 0 ) {
					if ( mode == MODELIST_MAIN ) {
						if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
							gdata(STARTING_GDATA_HELP + 11) = 1
							ghelp = 11
							gosub *elona_help
						}
					}
				}
			}
		}
		if ( gWeather == WEATHER_SNOW ) {
			if ( cfg_extrahelp ) {
				if ( gdata(STARTING_GDATA_HELP + 12) == 0 ) {
					if ( mode == MODELIST_MAIN ) {
						if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
							gdata(STARTING_GDATA_HELP + 12) = 1
							ghelp = 12
							gosub *elona_help
						}
					}
				}
			}
		}
		if ( gWeather == WEATHER_ETHER ) {
			if ( cfg_extrahelp ) {
				if ( gdata(STARTING_GDATA_HELP + 13) == 0 ) {
					if ( mode == MODELIST_MAIN ) {
						if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
							gdata(STARTING_GDATA_HELP + 13) = 1
							ghelp = 13
							gosub *elona_help
						}
					}
				}
			}
		}
		if ( p != gWeather ) {
			envonly = 1
			gosub *music_play
		}
	}
	gosub *label_2348
	gosub *adv_action
	gosub *item_rot
	if ( mType == MAP_TYPE_WORLD ) {
		if ( rnd(3) == 0 ) {
			gSleep++
		}
		if ( rnd(15) == 0 ) {
			if ( mode == MODELIST_MAIN ) {
				txt -1, lang("仮眠をとった。", "You take a nap.")
				gSleep -= 3
				if ( gSleep < 0 ) {
					gSleep = 0
				}
			}
		}
	}
	else {
		if ( gArea  != AREA_SHELTER ) {
			gSleep++
		}
	}
	if ( gHour  == 6 ) {
		txtef COLOR_YELLOW
		txt -1, lang("夜が明けた。", "Day breaks.")
	}
	if ( gSleep >= 15 ) {
		if ( cfg_extrahelp ) {
			if ( gdata(STARTING_GDATA_HELP + 9) == 0 ) {
				if ( mode == MODELIST_MAIN ) {
					if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
						gdata(STARTING_GDATA_HELP + 9) = 1
						ghelp = 9
						gosub *elona_help
					}
				}
			}
		}
	}
	if ( cHunger(CHARA_PLAYER) < 5000 ) {
		if ( cfg_extrahelp ) {
			if ( gdata(STARTING_GDATA_HELP + 10) == 0 ) {
				if ( mode == MODELIST_MAIN ) {
					if ( cActionPeriod(CHARA_PLAYER) == 0 ) {
						gdata(STARTING_GDATA_HELP + 10) = 1
						ghelp = 10
						gosub *elona_help
					}
				}
			}
		}
	}
	if ( gHour  >= 24 ) {
		if ( gGuest < 3 + (ogTitleTheDayWeFlyOnOurWings == 2) * 2 ) {
			if ( rnd(8 + gGuest * 5) == 0 ) {
				gGuest++
			}
		}
		txtef COLOR_YELLOW
		txt -1, lang("一日が終わり、日付が変わった。", "A day passes and a new day begins.")
		gosub *label_2131
		gosub *label_4537
		gosub *label_3928
		repeat 10
			p = 120 + cnt
			if ( gdata(p) >= 10000 ) {
				gdata(p) = 10000
				continue
			}
			if ( cnt == 3 | cnt == 4 | cnt == 5 | cnt == 8 ) {
				continue
			}
			gdata(140 + cnt)--
			if ( gdata(140 + cnt) <= 0 ) {
				modrank cnt, (gdata(p) / 12 + 100) * (-1)
				gdata(140 + cnt) = ranknorma(cnt)
			}
		loop
		snd SOUNDLIST_NIGHT
		evadd EVENT_QUEST_CHECK
		gDayPast += gHour  / 24
		gDay  += gHour  / 24
		gHour  = gHour  \ 24
		if ( gDay  >= 31 ) {
			gMonth ++
			gDay  = gDay  - 30
			if ( gMonth  \ 2 == 0 ) {
				flagHolyWell++
			}
		}
		if ( gMonth  >= 13 ) {
			gYear ++
			repeat 16
				if ( gettrait(cnt, 131) == 1 ) {
					cAge(cnt)++
					if ( cAge(cnt) > gYear  ) {
						cAge(cnt) = gYear 
					}
				}
			loop
			gMonth  = 1
			gGuildTrainer = 0
			gWellWish = limit(gWellWish - 1, 0, 10)
			ogCanMakeChild = 0
			ogbitmod 9, 0
		}
		if ( seasonal_check(SEASON_YOUNGER_SISTERS_DAY, TRUE) ) {
			txt -1, lang("今日は妹の日だ。", "Today is younger sister's day.")
		}
		if ( seasonal_check(SEASON_PARTY_DAY, TRUE) ) {
			txt -1, lang("今日はベイベーの日だ。", "Today's Party Day!")
		}
		if ( ogbit(9) == 0 ) {
			if ( seasonal_check(SEASON_CHRISTMAS_EVE, TRUE) ) {
				txt -1, lang("今日はクリスマスイブだ。", "Today is Christmas Eve.")
			}
			if ( seasonal_check(SEASON_CHRISTMAS, TRUE) ) {
				txt -1, lang("今日はクリスマスだ。", "Today is Christmas.")
			}
		}
		if ( seasonal_check(SEASON_VALENTINES_DAY, TRUE) ) {
			txt -1, lang("今日はバレンタインデーだ。", "Today is Valentine's Day.")
		}
		if ( seasonal_check(SEASON_AFTER_VALENTINES_DAY, TRUE) ) {
			txt -1, lang("今日はアフターバレンタインデーだ。", "Today is After Valentine's Day.")
		}
		if ( gDay  == 1 | gDay  == 15 ) {
			gosub *event_income
		}
		if ( ogTitleRepeatKillSquad == 2 ) {
			if ( gDay  == 1 ) {
				ogdata(400) = 1
				ogdata(401) = 1
				ogdata(402) = 1
			}
		}
		if ( ogTitleTheWorldIsSpinning == 2 ) {
			if ( gDay  == 1 ) {
				ogdata(403) = 1
			}
		}
		if ( sqMother == 1 | sqMother == 3 | sqMother == 5 | sqMother == 7 | sqMother == 9 ) {
			if ( areaId(gArea ) != AREA_NOYEL ) {
				if ( rnd(20) == 0 ) {
					sqMother++
					snd SOUNDLIST_WRITE1
					txtef COLOR_GREEN
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
		if ( ncgQuestAwaitOnesReturn == 1 | ncgQuestAwaitOnesReturn == 3 ) {
			if ( areaId(gArea ) != 50 ) {
				if ( rnd(20) == 0 ) {
					ncgQuestAwaitOnesReturn++
					snd SOUNDLIST_WRITE1
					txtef COLOR_GREEN
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
		if ( ncgQuestASmallExpense == 10 ) {
			if ( areaId(gArea ) != 52 ) {
				if ( rnd(20) == 0 ) {
					ncgQuestASmallExpense++
					snd SOUNDLIST_WRITE1
					txtef COLOR_GREEN
					txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
				}
			}
		}
	}
	if ( mode == MODELIST_MAIN ) {
		if ( mType == MAP_TYPE_WORLD ) {
			if ( rnd(40) == 0 ) {
				cPiety(CHARA_PLAYER)--
			}
			cPray(CHARA_PLAYER) += 4
			if ( cPray(CHARA_PLAYER) > 2000 ) {
				cPray(CHARA_PLAYER) = 2000
			}
		}
		else {
			if ( rnd(5) == 0 ) {
				cPiety(CHARA_PLAYER)--
			}
			cPray(CHARA_PLAYER) += 32
			if ( cPray(CHARA_PLAYER) > 2000 ) {
				cPray(CHARA_PLAYER) = 2000
			}
		}
		repeat 15, 1
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			f = 0
			if ( mType == MAP_TYPE_WORLD ) {
				if ( rnd(40) == 0 ) {
					f = 1
				}
			}
			else {
				if ( rnd(5) == 0 ) {
					f = 1
				}
			}
			if ( f ) {
				skillexp2 SKILL_NORMAL_FAITH, cnt, 200, 6, 1000
				modpiety 5, cnt
			}
		loop
		gosub *label_4434
	}
	if ( cPiety(CHARA_PLAYER) < 0 ) {
		cPiety(CHARA_PLAYER) = 0
	}
	if ( cActionPeriod(CHARA_PLAYER) != 0 ) {
		if ( cRowAct(CHARA_PLAYER) != ACTION_TRAVEL ) {
			gosub *screen_draw
		}
	}
	if ( gArea  != AREA_SHELTER ) {
		if ( gArea  != AREA_JAIL ) {
			gosub *random_event
		}
	}
	repeat 245
		dup roopbuf, cExist(cnt)
		if ( roopbuf == 1 ) {
			ctalk cnt, 1373, cnt, cnt
		}
		if ( roopbuf == 2 ) {
			ctalk cnt, 1375, cnt, cnt
		}
	loop
	txtgod godcheck(), 2432
	throwsstpevent "Hour", 0, "", 0
	procid = (procid + 1) \ 10
	proclist(procid) = "Advance_hour:End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return

*label_4149
	if ( ct >= 245 ) {
		goto *main_init
	}
	if ( cExist(ct) != CHAR_STATE_ALIVE ) {
		ct++
		goto *label_4149
	}
	if ( cSpeedSum(ct) >= mTimeScale ) {
		cSpeedSum(ct) -= mTimeScale
	}
	else {
		ct++
		goto *label_4149
	}

*label_4150
	cc = ct
	cTimeScale(cc) = cSpeedFix(cc)
	cTurn(cc)++
	gosub *label_4157
	if ( ct > 0 & ct < 16 ) {
		p = cTurn(ct) \ 10
		if ( p == 1 ) {
			cc = ct
			gosub *label_1830
		}
		if ( p == 2 ) {
			r1 = ct
			gosub *label_1601
		}
		if ( p == 3 ) {
			r1 = ct
			r2 = 1
			gosub *label_1604
		}
		if ( cTurn(ct) \ 20 == 0 ) {
			r1 = ct
			gosub *label_4418
		}
	}


	if ( ct == 0 ) {
		tnew = 1
		p = carmor(0)
		if ( p == 169 ) {
			pcnoise = 60
		}
		else {
			if ( p == 170 ) {
				pcnoise = 40
			}
			else {
				pcnoise = 20
			}
		}
		refreshspeed 0
		gosub *label_4724
		p = cTurn(CHARA_PLAYER) \ 10
		if ( p == 1 ) {
			repeat 16
				if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
					r1 = cnt
					gosub *label_1600
				}
			loop
		}
		if ( p == 2 ) {
			r1 = 0
			gosub *label_1601
		}
		if ( p == 3 ) {
			r1 = 0
			r2 = cBurden(CHARA_PLAYER)
			gosub *label_1604
		}
		if ( p == 4 ) {
			if ( cRowAct(CHARA_PLAYER) == ACTION_NONE ) {
				healsp CHARA_PLAYER, 2 + (ogTitleEmptiness == 2) + (findbuff(CHARA_PLAYER, BUFF_REGENERATION) != (-1))
			}
		}
		if ( cTurn(CHARA_PLAYER) \ 20 == 0 ) {
			r1 = ct
			gosub *label_4418
		}
		if ( gReturn  != 0 ) {
*label_4152
			gReturn --
			f = 0
			if ( mType == MAP_TYPE_QUEST | gArea  == AREA_SHELTER | gArea  == AREA_JAIL | f ) {
				gReturn  = 0
				txt -1, lang("不思議な力が帰還を阻止した。", "Strange power prevents you from returning.")
				goto *game_main_redo_WEND1
			}
			if ( gReturn  <= 0 & evnum == 0 ) {
				f = 0
				repeat 16 - 1, 1
					if ( cExist(cnt) != CHAR_STATE_ALIVE & cExist(cnt) != CHAR_STATE_SUSPEND ) {
						continue
					}
					if ( cbit(CHARA_BIT_GUARD_TEMP, cnt) == TRUE ) {
						f = 1
					}
				loop
				if ( f ) {
					txt -1, lang("今は帰還できない仲間を連れている。", "One of your allies prevents you from returning.")
					goto *game_main_redo_WEND1
				}
				if ( gTeleportArea == gWorld ) {
					if ( gArea  == gWorld ) {
						txt -1, lang("何もおきない… ", "Nothing happens...")
						goto *game_main_redo_WEND1
					}
				}
				gosub *label_3041
				if ( stat == 1 ) {
					txt -1, lang("あなたは法を犯した。", "You commit a crime.")
					modkarma 0, -10
				}
				item_find FILTER_CARGO_TRADE, ITEM_FIND_MODE_TYPE, ITEM_FIND_LOCATION_CHARAS
				if ( stat != (-1) ) {
					evadd 104
				}
				snd SOUNDLIST_TELEPORT1
				txt -1, lang("あなたは次元の扉を開けた。", "A dimensional door opens in front of you.")
				if ( gTeleportArea == AREA_JAIL | gTeleportArea == MAX_AREA_OLD ) {
					txt -1, lang("気まぐれな時の管理者により次元は歪められた！", "The capricious controller of time has changed your destination!")
				}
				if ( cfg_animewait > 0 ) {
					msg_halt
				}
				if ( areaParent(gTeleportArea) != AREA_NONE ) {
					if ( gWorld != areaParent(gTeleportArea) ) {
						gWorldRenew = TRUE
					}
					gWorld = areaParent(gTeleportArea)
				}
				gosub *screen_draw
				levelexitby = MAP_EXIT_TELEPORT
				goto *map_exit
			}
			goto *game_main_redo_WEND1
			goto *label_4152
		}
*game_main_redo_WEND1
		gosub *label_2374
		if ( cExist(CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
			goto *pc_dead
		}
		if ( gWeather == WEATHER_ETHER ) {
			if ( mField == MAP_FIELD_OUTDOOR ) {
				if ( rnd(2) == 0 ) {
					if ( gResEtherWind == 0 ) {
						modcorrupt 5 + limit(gTurn / 20000, 0, 15)
					}
					else {
						if ( rnd(10) == 0 ) {
							modcorrupt 5
						}
					}
				}
				if ( gResEtherWind == 0 | rnd(4) == 0 ) {
					if ( rnd(2000) == 0 ) {
						efid = SKILL_SPELL_MUTATION
						efp = 100
						tc = cc
						gosub *label_3383
					}
				}
			}
		}
		else {
			if ( oabit(14, gArea ) | (gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_6)) ) {
				if ( rnd(2) == 0 ) {
					if ( gResEtherWind == 0 ) {
						modcorrupt limitmax(gLevel  / 6, 1000)
					}
					else {
						if ( rnd(10) == 0 ) {
							modcorrupt limitmax(gLevel  / 6, 1000)
						}
					}
				}
			}
			else {
				if ( rnd(1500) == 0 ) {
					if ( areaId(gArea ) != AREA_HOME & gArea  != AREA_SHELTER ) {
						modcorrupt 10
					}
				}
			}
		}
	}
	p = mapId(cX(cc), cY(cc))
	if ( chipm(CHIPM_ROLE, p) == MAP_CHIP_ROLE_WATER ) {
		if ( chipm(CHIPM_ROLE_SUB, p) == MAP_CHIP_ROLE_MOUNTAIN_WATER ) {
			if ( godcheck(cc) != "danalin" ) {
				healsan cc, 1
			}
		}
		if ( cWet(cc) == 0 ) {
			wet cc, 20
		}
	}
	if ( cc == CHARA_PLAYER ) {
		if ( cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) ) {
			if ( ncgSandbagSelfTurns <= 0 ) {
				cbitmod CHARA_BIT_SANDBAG, CHARA_PLAYER, FALSE
				txt -1, lang("サンドバッグの紐がほどけ、" + name(0) + "は解放された。", "Punching bag is Untied, " + name(0) + " " + was(CHARA_PLAYER) + " released.")
				animeload 8, 0
				cAiAggro(CHARA_PLAYER) = 0
				ctalk tc, 401, 0, tc
				flt
				itemcreate -1, ITEM_ID_SAND_BAG, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			}
		}
	}
	tc = cc
	if ( mapMef(cX(tc), cY(tc)) != 0 ) {
		ef = mapMef(cX(tc), cY(tc)) - 1
		if ( mefExist(ef) == MEF_TYPE_ACID ) {
			if ( cbit(CHARA_BIT_FLOAT, tc) == FALSE | cGravity(tc) > 0 ) {
				if ( sdata(SKILL_RESDMG_ACID, tc) / 50 < 7 ) {
					if ( eqfaction(tc, "acidresist") ) {
						if ( synccheck(tc, -1) ) {
							snd SOUNDLIST_WATER2
							txt -1, lang(name(tc) + "は酸に焼かれた。しかし何ともなかった。", name(tc) + " melt" + _s(tc) + ". But it was nothing.")
						}
					}
					else {
						if ( synccheck(tc, -1) ) {
							snd SOUNDLIST_WATER2
							txt -1, lang(name(tc) + "は酸に焼かれた。", name(tc) + " melt" + _s(tc) + ".")
						}
						if ( mefOwner(ef) == CHARA_PLAYER ) {
							if ( tc != CHARA_PLAYER ) {
								hostileaction CHARA_PLAYER, tc
							}
						}
						dmghp tc, rnd(mefP(ef) / 25 + 5) + 1, DAMAGE_FROM_ACID, SKILL_RESDMG_ACID, mefP(ef)
						if ( stat == 0 ) {
							check_kill mefOwner(ef), tc
						}
					}
				}
			}
		}
		if ( mefExist(ef) == MEF_TYPE_FIRE ) {
			if ( synccheck(tc, -1) ) {
				snd SOUNDLIST_FIRE1
				txt -1, lang(name(tc) + "は燃えた。", name(tc) + " " + is(tc) + " burnt.")
			}
			if ( mefOwner(ef) == CHARA_PLAYER ) {
				if ( tc != CHARA_PLAYER ) {
					hostileaction CHARA_PLAYER, tc
				}
			}
			dmghp tc, rnd(mefP(ef) / 15 + 5) + 1, DAMAGE_FROM_FIRE, SKILL_RES_FIRE, mefP(ef)
			if ( stat == 0 ) {
				check_kill mefOwner(ef), tc
			}
			else {
				if ( synccheck(cc, -1) ) {
					ctalk tc, 1201, tc, tc
				}
			}
		}
		if ( mefExist(ef) == MEF_TYPE_POTION ) {
			if ( cbit(CHARA_BIT_FLOAT, tc) == FALSE | cGravity(tc) > 0 ) {
				if ( synccheck(tc, -1) ) {
					snd SOUNDLIST_WATER2
					txt -1, lang(name(tc) + "は地面の液体を浴びた。", name(tc) + " step" + _s(tc) + " in the pool.")
				}
				wet tc, 25
				if ( mefOwner(ef) == CHARA_PLAYER ) {
					if ( tc != CHARA_PLAYER ) {
						hostileaction CHARA_PLAYER, tc
					}
				}
				potionspill = 1
				efstatus = mefRef2(ef)
				dbmode = DBMODE_ON_DRINK
				dbid = mefRef(ef)
				gosub *db_item
				if ( cExist(tc) == CHAR_STATE_DEAD ) {
					check_kill mefOwner(ef), tc
				}
				delmef ef
			}
		}
	}
	if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + 0 * 3, cc) != 0 ) {
		repeat 8 + 8
			if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) == 0 ) {
				break
			}
			ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 2, cc)--
			if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 2, cc) <= 0 ) {
				if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) == 16 ) {
					if ( cQuality(cc) < FIX_QUALITY_UNIQUE ) {
						cHP(cc) = -1
					}
					dmghp cc, 9999, DAMAGE_FROM_UNSEEN
				}
				if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) == 69 ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang(name(cc) + "の肉体は再構築された。", name(cc) + " " + is(cc) + " slightly healed.")
					}
					animeid = ANIMATION_HEAL
					gosub *anime
					healdmg = ocdata(OCDATA_STARTING_CURSE_BUFF_POWER + cnt * 3, cc) * 20 + 100
					if ( findbuff(cc, 70) != (-1) ) {
						healdmg /= 10
					}
					healhp cc, healdmg
					if ( showdamagecheck(healdmg) ) {
						if ( synccheck(cc, -1) ) {
							mondmgn(mondmgcnt) = "" + healdmg
							mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, cc, cc
							ccolor 110
							if ( stat == 0 ) {
								mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
							}
							mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
						}
					}
				}
				delbuff cc, cnt
				continue cnt
			}
			else {
				if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) == 69 ) {
					if ( cHP(cc) < cMHP(cc) / 2 ) {
						if ( synccheck(cc, -1) ) {
							txt -1, lang(name(cc) + "の肉体は再構築された。", name(cc) + " " + is(cc) + " slightly healed.")
						}
						animeid = ANIMATION_HEAL
						gosub *anime
						healdmg = 100 + ocdata(OCDATA_STARTING_CURSE_BUFF_POWER + cnt * 3, cc) * 10
						if ( findbuff(cc, 70) != (-1) ) {
							healdmg /= 10
						}
						healhp cc, healdmg
						if ( showdamagecheck(healdmg) ) {
							if ( synccheck(cc, -1) ) {
								mondmgn(mondmgcnt) = "" + healdmg
								mondmg(0, mondmgcnt) = timeGetTime(), 0, 0, 255, 0, 0, 0, 0, cc, cc
								ccolor 110
								if ( stat == 0 ) {
									mondmg(2, mondmgcnt) = 0, 255, 0, 0, 0, 0
								}
								mondmgcnt = (mondmgcnt + 1) \ length2(mondmg)
							}
						}
						delbuff cc, cnt
						continue cnt
					}
				}
			}
		loop
	}
	if ( cc == CHARA_PLAYER ) {
		if ( oabit(15, gArea ) | oabit(18, gArea ) | (gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_9)) ) {
			if ( rnd(50) == 0 ) {
				inv_find ITEM_ID_TORCH, CHARA_PLAYER
				if ( stat != (-1) ) {
					ci = stat
					txtef COLOR_PURPLE
					txt -1, lang(itemname(ci, 1) + "は燃え尽きて灰になった。", itemname(ci) + " burnt to ashes.")
					iNum(ci)--
				}
			}
		}
	}
	if ( gArea  == 49 ) {
		if ( cc > CHARA_PLAYER ) {
			gosub *nc_horse_exert
			goto *label_4158
		}
	}
	if ( cMochi(cc) > 0 | cSleep(cc) > 0 | cParalyze(cc) > 0 | cdata(268, cc) > 0 | cDim(cc) >= 60 | cbit(CHARA_BIT_SANDBAG, cc) ) {
		if ( cc == CHARA_PLAYER ) {
			if ( cbit(CHARA_BIT_SANDBAG, cc) ) {
				ncgSandbagSelfTurns--
				await 20
				sxfix = 0
				syfix = 0
				gosub *screen_draw
				goto *label_4158
			}
			if ( cMochi(cc) ) {
				await 120
			}
			await 60
			sxfix = 0
			syfix = 0
			gosub *screen_draw
		}
		goto *label_4158
	}
	if ( cDrunk(cc) != 0 ) {
		if ( cRowAct(cc) == ACTION_NONE ) {
			if ( cAiAggro(cc) <= 0 ) {
				if ( cc != CHARA_PLAYER ) {
					if ( rnd(100) == 0 ) {
						repeat 245
							if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
								continue
							}
							if ( dist(cX(cc), cY(cc), cX(cnt), cY(cnt)) > 5 ) {
								continue
							}
							if ( fov_los(cX(cc), cY(cc), cX(cnt), cY(cnt)) == 0 ) {
								continue
							}
							if ( cnt == cc | rnd(3) | mType == MAP_TYPE_WORLD ) {
								continue
							}
							if ( cnt != 0 ) {
								if ( petcheck(cnt) == 0 ) {
									lockon cc, cnt, 26
								}
							}
							tc = cnt
							if ( synccheck(cc, -1) | synccheck(tc, -1) ) {
								txtef COLOR_SKY_BLUE
								txt -1, lang(name(cc) + "は酔っ払って" + name(tc) + "にからんだ。", name(cc) + " gets the worse for drink and catches " + name(tc) + ".")
								ctalk cc, 956, cc, tc
								if ( stat == 0 ) {
									ctalk cc, 1241, cc, tc
									if ( stat == 0 ) {
										if ( jp ) {
											txt cc, "「一杯どうだい？」", "「飲んでないよ」", "「何見てるのさ」", "「遊ぼうぜ」"
										}
										if ( en ) {
											txt cc, cnvtalk("Have a drink baby."), cnvtalk("What are you looking at?"), cnvtalk("I ain't drunk."), cnvtalk("Let's have fun.")
										}
									}
								}
							}
							if ( tc != CHARA_PLAYER ) {
								if ( rnd(10) == 0 ) {
									if ( synccheck(cc, -1) | synccheck(tc, -1) ) {
										txtef COLOR_SKY_BLUE
										txt -1, lang(name(tc) + "はカチンときた。", name(tc) + " is pretty annoyed with the drunkard.")
										ctalk tc, 955, tc, cc
										if ( stat == 0 ) {
											ctalk tc, 1242, tc, cc
											if ( stat == 0 ) {
												txt tc, lang("「酔っ払いにはうんざり！」", cnvtalk("Your time is over, drunk!"))
											}
										}
									}
									unlockson cc
									cAiAggro(tc) = 20
									lockon tc, cc, 27
									cEmoIcon(tc) = 18 + 100 * 2
								}
							}
							break
						loop
					}
					if ( ocHostileTargetTotal(cc) ) {
						if ( ocHostileTarget1(cc) - 1 != 0 ) {
							if ( petcheck(ocHostileTarget1(cc) - 1) == 0 ) {
								tc = ocHostileTarget1(cc) - 1
								if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) == 1 ) {
									if ( cRowAct(tc) == ACTION_NONE ) {
										unlockon cc, tc
										gosub *label_3302
										goto *label_4158
									}
								}
								if ( dist(cX(tc), cY(tc), cX(cc), cY(cc)) < 6 ) {
									goto *ai_followMove
								}
							}
						}
					}
				}
			}
		}
	}
	if ( cDrunk(cc) >= 45 | cHunger(cc) > 35000 ) {
		if ( rnd(60) == 0 ) {
			chara_vomit cc
			goto *label_4158
		}
	}
	if ( cRowActWarn(cc) == 1 ) {
		if ( cc == CHARA_PLAYER ) {
			if ( cRowAct(cc) != ACTION_EAT & cRowAct(cc) != ACTION_READ & cRowAct(cc) != ACTION_TRAVEL ) {
				rtval = 0
			}
			else {
				screenupdate = -1
				gosub *screen_draw
				gosub *com_rowActCancel
			}
		}
		if ( cc != CHARA_PLAYER | rtval == 0 ) {
			if ( synccheck(cc, -1) ) {
				if ( cRowAct(cc) == 10006 | cRowAct(cc) == 30006 | cRowAct(cc) == 30007 | cRowAct(cc) == 30008 ) {
					txt -1, lang(name(cc) + "は歌唱を中断した。", name(cc) + " stop" + _s(cc) + " singing.")
				}
				else {
					if ( cRowAct(cc) == 20012 ) {
						txt -1, lang(name(cc) + "は鍛冶を中断した。", name(cc) + " stop" + _s(cc) + " smithing.")
					}
					else {
						if ( cRowAct(cc) == 25001 ) {
							txt -1, lang(name(cc) + "は" + itemname(cItemUsing(cc)) + "の使用を中断した。", name(cc) + " stop" + _s(cc) + " using " + itemname(cItemUsing(cc)) + ".")
						}
						else {
							if ( cRowAct(cc) == 20001 ) {
								txt -1, lang(name(cc) + "は入浴を中断した。", name(cc) + " stop" + _s(cc) + " bathing.")
							}
							else {
								if ( cRowAct(cc) == 20003 ) {
									txt -1, lang(name(cc) + "は詠唱を中断した。", name(cc) + " stop" + _s(cc) + " casting.")
								}
								else {
									if ( cRowAct(cc) == 20006 ) {
										txt -1, lang(name(cc) + "は演奏を中断した。", name(cc) + " stop" + _s(cc) + " performing.")
									}
									else {
										txt -1, lang(name(cc) + "は" + actlistn(cRowAct(cc)) + "を中断した。", name(cc) + " stop" + _s(cc) + " " + actlistn(cRowAct(cc)) + ".")
									}
								}
							}
						}
					}
				}
			}
			rowactend cc
		}
		screenupdate = -1
		gosub *screen_draw
		cRowActWarn(cc) = 0
	}
	if ( cTurn(cc) \ 25 == 0 ) {
		if ( cCurse(cc) != 0 ) {
			gosub *curse
		}
		if ( cbit(CHARA_BIT_RES_CURSE, cc) ) {
			gosub *curse_enc
		}
		if ( cbit(CHARA_BIT_PREGNANT, cc) ) {
			gosub *pregnant
		}
	}
	if ( cRowAct(cc) != ACTION_NONE ) {
		ci = cItemUsing(cc)
		cActionPeriod(cc)--
		if ( cRowAct(cc) == ACTION_FISH ) {
			at 40
			gosub *fishing
		}
		if ( cRowAct(cc) == ACTION_DIG ) {
			at 15
			gosub *dig
		}
		if ( cRowAct(cc) == ACTION_PLANT ) {
			at 15
			gosub *plant
		}
		if ( cRowAct(cc) == ACTION_SEARCH ) {
			at 15
			gosub *search
		}
		if ( cRowAct(cc) == ACTION_REST ) {
			at 5
			gosub *rest
		}
		if ( cRowAct(cc) == ACTION_EAT ) {
			at 100
			goto *act_eat
		}
		if ( cRowAct(cc) == ACTION_READ ) {
			at 25
			goto *act_read
		}
		if ( cRowAct(cc) == ACTION_SEX ) {
			at 50
			gosub *label_3302
		}
		if ( cRowAct(cc) == ACTION_GENERAL ) {
			if ( gRowAct == ACTION_HARVEST ) {
				at 40
			}
			else {
				if ( gRowAct == ACTION_TRAIN ) {
					at 40
				}
				else {
					if ( gRowAct == ACTION_STEAL ) {
						at 50
					}
					else {
						at 20
					}
				}
			}
			gosub *label_3307
		}
		if ( cRowAct(cc) == ACTION_BLEND ) {
			at 20
			gosub *blend
		}
		if ( cRowAct(cc) == ACTION_PERFORM | cRowAct(cc) == 10006 | cRowAct(cc) == 20006 | cRowAct(cc) == 30006 | cRowAct(cc) == 30007 | cRowAct(cc) == 30008 ) {
			at 40
			gosub *label_3295
		}
		if ( cRowAct(cc) == ACTION_TRAVEL ) {
			gosub *travel
			goto *act_move
		}
		if ( cRowAct(cc) == 20012 ) {
			at 20
			gosub *label_4484
		}
		if ( cRowAct(cc) == 25001 ) {
			at 20
			gosub *label_4471
		}
		if ( cRowAct(cc) == 20001 ) {
			at 100
			gosub *label_4552
		}
		if ( cRowAct(cc) == 20003 ) {
			at 20
			if ( cActionPeriod(cc) == 0 ) {
				delaymagic = 1
				efid = cItemUsing(cc)
				gosub *com_spellcast
			}
		}
		if ( cActionPeriod(cc) > 0 ) {
			goto *label_4158
		}
		rowactend cc
		if ( cc == CHARA_PLAYER ) {
			if ( chatteleport == 1 ) {
				chatteleport = 0
				goto *map_exit
			}
		}
	}
	if ( cbit(CHARA_BIT_REFRESH, cc) ) {
		r1 = cc
		gosub *charaRefresh
	}
	if ( cRole(cc) == 20004 ) {
		if ( ocHostileTargetTotal(cc) == 0 ) {
			if ( mType != MAP_TYPE_WORLD ) {
				efid = SKILL_SPELL_TELEPORT
				gosub *label_3383
			}
		}
	}
	if ( cExist(cc) == CHAR_STATE_ALIVE ) {
		if ( ct == 0 ) {
			goto *pc_turn_init
		}
		else {
			goto *ai_turn
		}
	}
	goto *label_4149

*label_4157
	cEmoIcon(cc) -= 100
	if ( cEmoIcon(cc) < 0 ) {
		cEmoIcon(cc) = 0
	}
	if ( mField == MAP_FIELD_OUTDOOR ) {
		if ( gWeather >= WEATHER_RAIN ) {
			cWet(cc) = 50
		}
	}
	if ( cExp(cc) >= cExpToNext(cc) ) {
		if ( cc == CHARA_PLAYER ) {
			snd SOUNDLIST_DING1
			msgalert = 1
		}
		r1 = cc
		r2 = 0
		gosub *label_1588
		goto *label_4157
	}
	return

*label_4158
	cc = ct
	if ( cExist(cc) != CHAR_STATE_ALIVE ) {
		goto *label_4149
	}
	hear = 0
	r1 = cc
	gosub *calcCondition
	if ( cc == CHARA_PLAYER ) {
		chatturn = 10
		if ( gSleepGene != 0 ) {
			if ( gSleepGene < 10000 ) {
				gSleepGene += 10000
				gRowAct = ACTION_SLEEP
				gosub *label_3307
			}
		}
		if ( ogMakeChildPartner != 0 ) {
			gRowAct = ACTION_SLEEP
			gosub *label_3307
		}
		if ( cBurden(CHARA_PLAYER) >= 3 ) {
			if ( rnd(20) == 0 ) {
				txt -1, lang(name(0) + "は荷物に圧迫されもがいた。", "Your backpack is squashing you!")
				dmghp cc, cMHP(cc) * (cInvWeight(CHARA_PLAYER) * 10 / cCarryLimit(CHARA_PLAYER) + 10) / 200 + 1, DAMAGE_FROM_BURDEN
			}
		}
		gosub *label_1675
		if ( ocbit(11, cc) ) {
			modstress 4
		}
		refreshspeed cc
		procid = (procid + 1) \ 10
		proclist(procid) = "turn_end:pc" + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
	}
	else {
		if ( mType != MAP_TYPE_WORLD ) {
			cHunger(cc) -= 8 * 2
			if ( cHunger(cc) < 6000 ) {
				if ( cbit(CHARA_BIT_ANOREXIA, cc) == FALSE ) {
					cHunger(cc) = 6000
				}
			}
		}
		if ( cRowAct(cc) == 20002 ) {
			if ( cActionPeriod(cc) > 0 ) {
				cActionPeriod(cc)--
				goto *ai_turn
			}
			else {
				gosub *label_4526
			}
		}
	}
	if ( gTimeStopTime > 0 ) {
		gTimeStopTime--
		if ( cExist(cc) != CHAR_STATE_ALIVE | gTimeStopTime == 0 ) {
			ctalk cc, 1286, cc, cc
			txtef COLOR_SKY_BLUE
			txt -1, lang("時は再び動き出した。", "Time starts to run again.")
		}
		else {
			if ( cc != CHARA_PLAYER ) {
				gosub *screen_draw
				await 200
			}
			ctalk cc, 1288, cc, cc
			if ( stat == 0 ) {
				ctalk cc, 1287, cc, cc
				if ( stat == 0 ) {
					txtef COLOR_SKY_BLUE
					txt -1, " *tick* "
				}
			}
			goto *label_4150
		}
	}
	goto *label_4149

*pc_turn_init
	procid = (procid + 1) \ 10
	proclist(procid) = "pc_turn_init" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	gosub *label_2665
	if ( gGodTalk ) {
		if ( rnd(1000) == 0 ) {
			txtgod godcheck(), GOD_TEXT_RANDOM
		}
	}
	if ( cRowAct(CHARA_PLAYER) == ACTION_NONE | cRowAct(CHARA_PLAYER) == ACTION_TRAVEL | cRowAct(CHARA_PLAYER) == ACTION_REST ) {
		if ( cTurn(CHARA_PLAYER) \ 5 == 0 ) {
			if ( rnd(20) == 0 ) {
				f = 0
				repeat 229, 16
					if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
						continue
					}
					if ( synccheck(cnt, -1) == 0 ) {
						continue
					}
					if ( relationbetween(0, cnt) >= (-1) ) {
						continue
					}
					f = 1
					break
				loop
				if ( f ) {
					txtef COLOR_SKY_BLUE
					ctalk 0, 101, 0, 0
				}
				else {
					txtef COLOR_SKY_BLUE
					ctalk 0, 100, 0, 0
				}
			}
		}
	}
	gEquipChange = 0
	tgloc = 0
	if ( gRider != 0 ) {
		cX(gRider) = cX(CHARA_PLAYER)
		cY(gRider) = cY(CHARA_PLAYER)
	}
	if ( mType == MAP_TYPE_WORLD ) {
		mapChara(cX(CHARA_PLAYER), cY(CHARA_PLAYER)) = 0 + 1
	}
	if ( gCorrupt >= 28000 ) {
		dmghp CHARA_PLAYER, 999999, DAMAGE_FROM_CORRUPT
	}
	if ( cbit(CHARA_BIT_SUICIDE_SWITCH, CHARA_PLAYER) ) {
		cc = CHARA_PLAYER
		tlocx = cX(cc)
		tlocy = cY(cc)
		efid = SKILL_SPACT_SUICIDE_ATTACK
		gosub *label_3383
	}
	if ( cExist(CHARA_PLAYER) != CHAR_STATE_ALIVE ) {
		goto *pc_dead
	}
	if ( gRun  ) {
		await 10
		repeat 3
			y = cY(CHARA_PLAYER) + cnt - 1
			if ( y < 0 | y <= mHeight ) {
				continue
			}
			repeat 3
				x = cX(CHARA_PLAYER) + cnt - 1
				if ( x < 0 | x <= mWidth ) {
					continue
				}
				if ( mapChara(x, y) != 0 ) {
					p = mapChara(x, y) - 1
					if ( p != 0 ) {
						if ( cRelation(p) <= RELATION_ENEMY ) {
							gRun  = 0
						}
					}
				}
			loop
		loop
		x = cX(CHARA_PLAYER)
		y = cY(CHARA_PLAYER)
		cXnew(CHARA_PLAYER) = x + dirxy(0, gRunDir)
		cYnew(CHARA_PLAYER) = y + dirxy(1, gRunDir)
		if ( mapItemsMemory(x, y) != 0 ) {
			gRun  = 0
		}
		if ( mapFeat(x, y) != 0 & mapFeat(x, y) != 999 ) {
			gRun  = 0
		}
		cell_check cX(cc) + 1, cY(cc)
		if ( cellaccess != gRunRight  ) {
			if ( cellchara > 16 | cellchara == (-1) ) {
				gRun  = 0
			}
		}
		cell_check cX(cc) - 1, cY(cc)
		if ( cellaccess != gRunLeft  ) {
			if ( cellchara > 16 | cellchara == (-1) ) {
				gRun  = 0
			}
		}
		cell_check cX(cc), cY(cc) + 1
		if ( cellaccess != gRunDown ) {
			if ( cellchara > 16 | cellchara == (-1) ) {
				gRun  = 0
			}
		}
		cell_check cX(cc), cY(cc) - 1
		if ( cellaccess != gRunUp  ) {
			if ( cellchara > 16 | cellchara == (-1) ) {
				gRun  = 0
			}
		}
		cell_check cXnew(CHARA_PLAYER), cYnew(CHARA_PLAYER)
		if ( cellaccess == 0 ) {
			if ( cellchara > 16 | cellchara == (-1) ) {
				gRun  = 0
			}
		}
	}
	if ( autosave ) {
		autosave = 0
		if ( dbg_noautosave == 0 | gettrait(0, 190) < 0 & gWizard == 0 ) {
			if ( gArea  != AREA_PET_ARENA ) {
				snd SOUNDLIST_WRITE1
				gosub *game_save
				txtef COLOR_YELLOW
				txt -1, lang(" *保存* ", "*saving*")
			}
		}
	}
	if ( autoturn == 1 ) {
		autoturn = 0
		gosub *screen_draw
	}
	else {
		gosub *screen_draw
	}

*label_4163


	if ( gArea  == AREA_PET_ARENA | gArea  == 49 ) {
		gQuestStatus = QUEST_STATE_SUCCESS
		f = 0
		repeat 16, 1
			if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
				if ( cRelation(cnt) == RELATION_ALLY ) {
					f = 1
					break
				}
			}
		loop
		if ( f == 0 ) {
			if ( petarenawin == 0 ) {
				petarenawin = 2
			}
		}
		if ( petarenawin != 0 ) {
			gosub *quest_petArenaWin
			msg_halt
			levelexitby = MAP_EXIT_NORMAL
			snd SOUNDLIST_EXITMAP1
			repeat 16
				if ( arenaop == 0 ) {
					if ( followerin(cnt) == 1 ) {
						if ( cExist(cnt) == CHAR_STATE_ALLY_DEAD ) {
							continue
						}
					}
				}
				if ( petarenawin != 1 ) {
					if ( followerin(cnt) == 1 ) {
						if ( cExist(cnt) == CHAR_STATE_ALLY_DEAD ) {
							if ( rnd(5) == 0 ) {
								continue
							}
						}
					}
				}
				cExist(cnt) = followerexist(cnt)
			loop
			goto *map_exit
		}
*pc_turn_init_WHILE1
		await cfg_wait1
		cDir(CHARA_PLAYER) = 0
		key_check
		f = 0
		repeat 16
			if ( key == key_south | key == key_west ) {
				p = 16 - 1 - cnt
			}
			else {
				p = cnt
			}
			if ( cExist(p) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( p == 0 ) {
				continue
			}
			if ( cRelation(p) != RELATION_ALLY ) {
				continue
			}
			if ( cExist(camera) != CHAR_STATE_ALIVE | camera == 0 ) {
				camera = p
				break
			}
			if ( key == key_north | key == key_east ) {
				f = 1
				snd SOUNDLIST_CURSOR1
				if ( p > camera ) {
					camera = p
					key = ""
					break
				}
			}
			if ( key == key_south | key == key_west ) {
				f = 1
				snd SOUNDLIST_CURSOR1
				if ( p < camera ) {
					camera = p
					key = ""
					break
				}
			}
		loop
		if ( f == 1 ) {
			key = ""
		}
		gosub *screen_draw
		if ( key == key_goup | key_escape == 1 ) {
			txt -1, lang("試合を放棄する？", "Do you want to give up the game?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				petarenawin = 2
				goto *label_4163
			}
			goto *pc_turn_init_WHILE1_CONTINUE
		}
		if ( key == key_msglog ) {
			goto *com_log
		}
		if ( key != key_cancel ) {
			if ( key != "" ) {
				goto *label_4158
			}
		}
*pc_turn_init_WHILE1_CONTINUE
		goto *pc_turn_init_WHILE1
	}

*label_4169


	if ( gArea  == 49 ) {
		gQuestStatus = QUEST_STATE_SUCCESS
		if ( petarenawin != 0 ) {
			gosub *quest_petArenaWin
			msg_halt
			levelexitby = MAP_EXIT_NORMAL
			snd SOUNDLIST_EXITMAP1
			repeat 16
				if ( arenaop == 0 ) {
					if ( followerin(cnt) == 1 ) {
						if ( cExist(cnt) == CHAR_STATE_ALLY_DEAD ) {
							continue
						}
					}
				}
				if ( petarenawin != 1 ) {
					if ( followerin(cnt) == 1 ) {
						if ( cExist(cnt) == CHAR_STATE_ALLY_DEAD ) {
							if ( rnd(5) == 0 ) {
								continue
							}
						}
					}
				}
				cExist(cnt) = followerexist(cnt)
			loop
			goto *map_exit
		}
*label_4171
		await cfg_wait1
		cDir(CHARA_PLAYER) = 0
		key_check
		f = 0
		repeat 16
			if ( key == key_south | key == key_west ) {
				p = 16 - 1 - cnt
			}
			else {
				p = cnt
			}
			if ( cExist(p) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( p == 0 ) {
				continue
			}
			if ( cRelation(p) != RELATION_ALLY ) {
				continue
			}
			if ( cExist(camera) != CHAR_STATE_ALIVE | camera == 0 ) {
				camera = p
				break
			}
			if ( key == key_north | key == key_east ) {
				f = 1
				snd SOUNDLIST_CURSOR1
				if ( p > camera ) {
					camera = p
					key = ""
					break
				}
			}
			if ( key == key_south | key == key_west ) {
				f = 1
				snd SOUNDLIST_CURSOR1
				if ( p < camera ) {
					camera = p
					key = ""
					break
				}
			}
		loop
		if ( f == 1 ) {
			key = ""
		}
		gosub *screen_draw
		if ( key == key_goup | key_escape == 1 ) {
			txt -1, lang("試合を放棄する？", "Do you want to give up the game?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 160, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				petarenawin = 2
				goto *label_4169
			}
			goto *label_4173
		}
		if ( key == key_msglog ) {
			goto *com_log
		}
		if ( key != key_cancel ) {
			if ( key != "" ) {
				goto *label_4158
			}
		}
*label_4173
		goto *label_4171
	}
	if ( gWizard == 1 ) {
		oom_title = "Pos " + str(cX(CHARA_PLAYER)) + "," + str(cY(CHARA_PLAYER)) + "(" + str(cX(CHARA_PLAYER) - scx) + "," + str(cY(CHARA_PLAYER) - scy) + ")"
		oom_title += " MapNo " + str(gArea ) + " Lvl " + str(gLevel )
		oom_title += " MapType " + str(mType) + " MapObjId " + str(areaId(gArea ))
		if ( areaId(gArea ) == AREA_DUNGEON ) {
			oom_title += " Residents " + str(ogdata(gLevel )) + " TotalRes " + str(ogDungeonStayersTotal) + " MaxRes " + str(ogDungeonStayersGreatest)
		}
		else {
			oom_title += " cc:" + cc + " tc:" + tc + " rc:" + rc + " ci:" + ci + " ti:" + ti
		}
		title oom_title
	}
	if ( gettrait(0, 210) != 0 ) {
		if ( rnd(5) == 0 ) {
			inv_getheader 0
			ci = rnd(invrange) + invhead
			if ( iNum(ci) > 0 ) {
				if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_POTION & (iID(ci) == ITEM_ID_BOTTLE_MILK & iParam2(ci) != 0) == 0 | (refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_ITEM_FOOD_HERB & iParam2(ci) > 1 & iID(ci) != ITEM_ID_INFIEA) ) {
					dbmode = DBMODE_ON_DRINK
					dbid = iID(ci)
					gosub *db_item
				}
			}
		}
	}
	if ( gettrait(0, 214) != 0 ) {
		if ( rnd(250) == 0 ) {
			if ( mType != MAP_TYPE_WORLD ) {
				efid = SKILL_SPELL_TELEPORT
				rndtelepo = 1
				gosub *label_3383
				rndtelepo = 0
			}
		}
	}
	if ( ocHostileTargetTotal(0) ) {
		if ( cbit(CHARA_BIT_INVISIBLE, ocHostileTarget1(0) - 1) == TRUE ) {
			if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == FALSE ) {
				if ( cWet(ocHostileTarget1(0) - 1) == 0 ) {
					unlockon 0, ocHostileTarget1(0) - 1
				}
			}
		}
	}
	if ( gettrait(0, 195) != 0 ) {
		cBlind(CHARA_PLAYER) = 1000
	}
	if ( gettrait(0, 220) != 0 ) {
		if ( rnd(100) == 0 ) {
			cFear(CHARA_PLAYER) = 5 + cLevel(CHARA_PLAYER) / 2
			txt -1, lang(name(0) + "は恐怖に侵された。", name(0) + " " + is(CHARA_PLAYER) + " frightened.")
		}
	}
	if ( gettrait(0, 221) != 0 ) {
		p = stat
		f = 0
		if ( p == (-3) ) {
			if ( rnd(100) == 0 ) {
				f = 1
			}
		}
		else {
			if ( p == (-2) ) {
				if ( rnd(200) == 0 ) {
					f = 1
				}
			}
			else {
				if ( rnd(300) == 0 ) {
					f = 1
				}
			}
		}
		if ( f ) {
			txt -1, lang("あなたはマナを吸い取った。", "You drain mana.")
			repeat 244, 1
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( synccheck(cnt, -1) == 0 ) {
					continue
				}
				if ( fov_los(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(cnt), cY(cnt)) == 0 ) {
					continue
				}
				p = rnd(15 + cLevel(CHARA_PLAYER) * 3 / 2) + 1
				healmp CHARA_PLAYER, p / 5
				dmgmp cnt, p
				if ( stat ) {
					hostileaction CHARA_PLAYER, cnt
				}
				else {
					check_kill 0, cnt
				}
			loop
		}
	}
	if ( gettrait(0, 223) != 0 ) {
		if ( rnd(50) == 0 ) {
			txt -1, lang("あなたの皮膚から酸が飛び散った。", "Acids spread over the ground.")
			dmghp CHARA_PLAYER, cMHP(CHARA_PLAYER) / 20 + 1, DAMAGE_FROM_ACID, SKILL_RESDMG_ACID, 200
			if ( mType != MAP_TYPE_HOME ) {
				efid = SKILL_SPELL_ACID_GROUND
				efp = limitmin(cMHP(CHARA_PLAYER) / 5, 100)
				cc = CHARA_PLAYER
				tc = CHARA_PLAYER
				tlocx = cX(CHARA_PLAYER)
				tlocy = cY(CHARA_PLAYER)
				gosub *label_3383
			}
		}
	}
	if ( gettrait(0, 224) != 0 ) {
		if ( rnd(75) == 0 ) {
			txt -1, lang("あなたは発火した。", "You Burned.")
			dmghp CHARA_PLAYER, cMHP(CHARA_PLAYER) / 15 + 1, DAMAGE_FROM_FIRE, SKILL_RES_FIRE, 200
			if ( mType != MAP_TYPE_HOME ) {
				efid = SKILL_SPELL_FIRE_WALL
				efp = limitmin(cMHP(CHARA_PLAYER) / 5, 100)
				cc = CHARA_PLAYER
				tc = CHARA_PLAYER
				tlocx = cX(CHARA_PLAYER)
				tlocy = cY(CHARA_PLAYER)
				gosub *label_3383
			}
		}
	}
	if ( gettrait(0, 226) != 0 ) {
		if ( rnd(100) == 0 ) {
			dmgcon CHARA_PLAYER, CONDITION_PARALYZE, 100
		}
	}
	if ( gettrait(0, 176) != 0 ) {
		if ( rnd(250) == 0 ) {
			inv_getheader 0
			olistmax = 0
			repeat invrange, invhead
				if ( iNum(cnt) <= 0 ) {
					continue
				}
				if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) == FILTER_ITEM_FOOD | (iID(cnt) == ITEM_ID_BOTTLE_MILK & iParam2(cnt) != 0) & (refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) == FILTER_ITEM_FOOD_HERB & iParam2(cnt) > 1 & iID(cnt) != ITEM_ID_INFIEA) == 0 ) {
					olist(olistmax) = cnt
					olistmax++
				}
			loop
			if ( olistmax ) {
				cc = CHARA_PLAYER
				ci = olist(rnd(olistmax))
				gosub *act_eat
			}
		}
	}
	if ( godcheck(0) == "dorein" ) {
		if ( rnd(100) == 0 ) {
			txt -1, lang("ほろ酔いの瞳が輝いた。", "The tipsy eyes glowed.")
			repeat 244, 1
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( synccheck(cnt, -1) == 0 ) {
					continue
				}
				if ( fov_los(cX(CHARA_PLAYER), cY(CHARA_PLAYER), cX(cnt), cY(cnt)) == 0 ) {
					continue
				}
				p = rnd(15 + cLevel(CHARA_PLAYER) * 3 / 2) + 300
				dmgcon cnt, CONDITION_DRUNK, p
			loop
		}
	}
	t = 1
	keylog = ""
	key = ""
	objprm 0, ""

*pc_turn

	if ( firstturn == 1 ) {
		if ( mat(399) == 0 ) {
			nc_intb_001 = mat(1)
			nc_intb_002 = mat(40)
			nc_intb_003 = mat(41)
			repeat 400
				mat(cnt) = 0
			loop
			mat(50) = nc_intb_001
			mat(51) = nc_intb_002
			mat(52) = nc_intb_003
			mat(399) = 1
			dialog lang("マテリアルを新システムに移行しました。100YEN硬貨、500YEN硬貨、カジノチップは引き続き使用できます。", "Materials have been migrated to the new system. 100YEN coins, 500YEN coins, and casino chips will still be accepted.")
		}
		if ( gGodTalk ) {
			txtgod godcheck(), GOD_TEXT_WELCOME
			txtef COLOR_YELLOW
			txt -1, lang("「…本当に起動してしまったのか？」", "\"...err ...you really started that thing? Oh well...\"")
		}
		if ( seasonal_check(SEASON_YOUNGER_SISTERS_DAY, FALSE) ) {
			txt -1, lang("今日は妹の日だ。", "Today is younger sister's day.")
		}
		if ( seasonal_check(SEASON_PARTY_DAY, FALSE) ) {
			txt -1, lang("今日はベイベーの日だ。", "Today's Party Day!")
		}
		if ( ogbit(9) == 0 ) {
			if ( seasonal_check(SEASON_CHRISTMAS_EVE, FALSE) ) {
				txt -1, lang("今日はクリスマスイブだ。", "Today is Christmas Eve.")
			}
			if ( seasonal_check(SEASON_CHRISTMAS, FALSE) ) {
				txt -1, lang("今日はクリスマスだ。", "Today is Christmas.")
			}
		}
		if ( seasonal_check(SEASON_VALENTINES_DAY, FALSE) ) {
			txt -1, lang("今日はバレンタインデーだ。", "Today is Valentine's Day.")
		}
		if ( seasonal_check(SEASON_AFTER_VALENTINES_DAY, FALSE) ) {
			txt -1, lang("今日はアフターバレンタインデーだ。", "Today is After Valentine's Day.")
		}
		if ( stgdata(30) > 0 ) {
			ncgGoldOverflow = stgdata(30)
			stgdata(30) = 0
		}
		if ( trophy(23) == 2 ) {
			ocLight(0) = 7
		}
		else {
			ocLight(0) = 0
		}
		nc_intb_nightmare = 0
		if ( gettrait(0, 194) < (-1) ) {
			nc_intb_nightmare = 1
			if ( nc_intb_nightmare ) {
				if ( ncgSavedCleanly == 0 ) {
					exist exedir + "save\\nightmarehelp.save"
					if ( strsize != (-1) ) {
						buff = ""
						notesel buff
						noteload exedir + "save\\nightmarehelp.save"
						if ( buff == "747474nightmarehelp" + gArea  ) {
							txtef COLOR_YELLOW
							txt -1, lang("リロードを検知したが、エラーによる不正終了だったためペナルティを受けなかった。", "The reload was detected, but was not penalized because it was an illegal termination due to an error.")
							delete exedir + "save\\nightmarehelp.save"
							goto *label_4181
						}
					}
					snd SOUNDLIST_PUNISH1
					txtef COLOR_PURPLE
					txt -1, lang("リロードを検知した。ペナルティが発生した。", "Reload detected, penalty incurred.")
					efid = SKILL_SPACT_PUNISHMENT
					efp = 10000
					tc = CHARA_PLAYER
					gosub *label_3383
					modkarma 0, -20
					repeat 50 - 10, 10
						if ( cnt <= 17 ) {
							if ( sdata(cnt, CHARA_PLAYER) != 0 ) {
								if ( rnd(3) == 0 ) {
									txtef COLOR_RED
									txt -1, lang(skillname(cnt) + "の経験値が減少した。", your(CHARA_PLAYER) + " exp of " + skillname(cnt) + " decreases.")
									skillexp2 cnt, CHARA_PLAYER, -500
								}
							}
						}
					loop
				}
				else {
					ncgSavedCleanly = 0
				}
*label_4181
				snd SOUNDLIST_WRITE1
				gosub *game_save
				txtef COLOR_YELLOW
				txt -1, lang(" *保存* ", "*saving*")
			}
		}
		nc_intb_gro1 = effortcnt() * 5
		nc_intb_gro2 = 100 - nc_intb_gro1
		firstturn = 0
	}
	if ( gEquipChange ) {
		txt -1, lang("装備を変更した。", "You change your equipment.")
		goto *label_4158
	}
	t++
	if ( t \ cfg_scrsync == 1 ) {
		if ( gTimeStopTime == 0 ) {
			scrturn++
		}
		gosub *screen_sync
	}
	if ( cfg_net ) {
		if ( cfg_netwish ) {
			if ( key == "" ) {
				chatturn++
				if ( chatturn \ 250 == 1 ) {
					net_read
					notesel chatnew
					repeat noteinfo(0)
						noteget s, noteinfo(0) - cnt - 1
						s(1) = strmid(s, 4, 9999), strmid(s, 0, 4)
						if ( s(2) == "chat" ) {
							if ( cfg_netchat ) {
								continue
							}
						}
						if ( en ) {
							cnv_str s(1), "&quot;", "\""
						}
						txtef COLOR_BROWN
						txt -1, "" + s(1)
					loop
				}
			}
		}
	}
	if ( timeGetTime() / 1000 - time_talk > 20 ) {
		chatturn++
	}
	if ( chatturn >= 1000 ) {
		chatturn = 250
	}
	if ( timeGetTime() / 1000 - time_warn > 3600 ) {
		time_warn = timeGetTime() / 1000
		wishfilter = 0
		hour_played++
		s = lang("Elonaをはじめてから" + hour_played + "時間が経過しています。", "You have been playing Elona for " + hour_played + " hour" + _s2(hour_played) + ".")
		gosub *time_warn_talk
		txtef COLOR_YELLOW
		txt -1, s
		throwsstpevent "HourPlayed", 0, "", hour_played
	}
	if ( cfg_wait1 != 0 | t \ 50 == 0 ) {
		await cfg_wait1
	}
	key_check 1
	if ( ginfo(2) != 0 ) {
		goto *pc_turn
	}
	if ( gWizard | 0 ) {
		getkey a, 112
		if ( a ) {
			gosub *game_save
			txt -1, lang(" *保存* ", " *Save* ")
			await 100
		}
		getkey a, 113
		if ( a ) {
			msg_newline
			msgtemp = "  "
			firstturn = 1
			gosub *label_3116
			mode = MODELIST_CONTINUE
			goto *map_init
		}
		getkey a, 114
		if ( a ) {
			buffer BUFFER_INF, 1440, 800 + 126
			picload_ exedir + "\\graphic\\interface.bmp", 1
			gsel BUFFER_SCREEN
			gosub *random_event
		}
		getkey a, 115
		if ( a ) {
			repeat 10, 10
				txt -1, skillname(cnt) + ":" + cdata(STARTING_CDATA_FOOD_EXP + cnt - 10, CHARA_PLAYER) + "%"
			loop
			chara_vomit CHARA_PLAYER
			goto *label_4158
			repeat 100
				flt 100
				fltn "cnpc"
				characreate -1, CREATURE_ID_BUG, -3, 0
				cnName(rc) += "" + cUNID(rc)
			loop
		}
		getkey a, 116
		if ( a ) {
			gosub *com_wish
			goto *label_4158
		}
		getkey a, 117
		if ( a ) {
			dbg_skipevent = 1
			gHour ++
			gosub *label_4143
			dbg_skipevent = 0
			mode = MODELIST_MAIN
			goto *label_4158
		}
		getkey a, 118
		if ( a ) {
			if ( mType != MAP_TYPE_TOWN ) {
				dbg_revealmap = 1
				gLevel ++
				txt -1, "lv:" + gLevel 
				ctrlfile 11
				mode = MODELIST_NEW
				levelexitby = MAP_EXIT_NORMAL
				goto *map_init
			}
		}
	}
	else {
	}
	nc_intb_001 = 0
	getkey a, 112
	if ( a ) {
		if ( gettrait(0, 190) < 0 ) {
			txt -1, lang("？？？「だめよ。」", " *Nope* ")
			await 100
		}
		else {
			if ( cfg_nc_qsave ) {
				txtnew
				txt -1, lang("保存する？", "Really save?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval == 0 ) {
					gosub *game_save
					txt -1, lang(" *保存* ", " *Save* ")
					await 100
				}
				nc_intb_001 = 1
			}
			else {
				gosub *game_save
				txt -1, lang(" *保存* ", " *Save* ")
				await 100
			}
		}
	}
	getkey a, 113
	if ( a ) {
		if ( gettrait(0, 190) < 0 ) {
			txt -1, lang("？？？「だめよ。」", " *Nope* ")
			await 100
		}
		else {
			if ( nc_intb_nightmare ) {
				txtnew
				txtef COLOR_RED
				txt -1, lang("ナイトメアモードではリロードを行うとペナルティが付与される、それでもロードする？", "n Nightmare mode, reloading will incur a penalty. Really load?")
				promptl(0, 0) = stryes, "y", "0"
				promptl(0, 1) = strno, "n", "1"
				promptmax = 2
				val = promptx, prompty, 160, 1
				gosub *prompt_key
				if ( rtval == 0 ) {
					if ( cfg_reloadcnpc == 1 ) {
						if ( gArea  == AREA_SHOW_HOUSE ) {
							gosub *label_3093
							gosub *label_4258
						}
					}
					msg_newline
					msgtemp = "  "
					firstturn = 1
					gosub *label_3116
					mode = MODELIST_CONTINUE
					goto *map_init
				}
				nc_intb_001 = 1
			}
			else {
				if ( cfg_nc_qsave ) {
					txtnew
					txt -1, lang("ロードする？", "Really load?")
					promptl(0, 0) = stryes, "y", "0"
					promptl(0, 1) = strno, "n", "1"
					promptmax = 2
					val = promptx, prompty, 160, 1
					gosub *prompt_key
					if ( rtval == 0 ) {
						if ( cfg_reloadcnpc == 1 ) {
							if ( gArea  == AREA_SHOW_HOUSE ) {
								gosub *label_3093
								gosub *label_4258
							}
						}
						msg_newline
						msgtemp = "  "
						firstturn = 1
						gosub *label_3116
						mode = MODELIST_CONTINUE
						goto *map_init
					}
					nc_intb_001 = 1
				}
				else {
					if ( cfg_reloadcnpc == 1 ) {
						if ( gArea  == AREA_SHOW_HOUSE ) {
							gosub *label_3093
							gosub *label_4258
						}
					}
					msg_newline
					msgtemp = "  "
					firstturn = 1
					gosub *label_3116
					mode = MODELIST_CONTINUE
					goto *map_init
				}
			}
		}
	}
	getkey a, 114
	if ( a ) {
		gosub *nc_pict
		gosub *screen_draw
		keywait = 1
		goto *pc_turn
	}
	getkey a, 115
	if ( a ) {
		gosub *nc_gift
		gosub *screen_draw
		keywait = 1
		goto *pc_turn
	}
	getkey a, 119
	if ( a ) {
		gosub *com_dump
		gosub *screen_draw
		keywait = 1
		goto *pc_turn
	}
	getkey a, 120
	if ( a ) {
		redraw 0
		gmode 2
		sxfix = 0
		syfix = 0
		gosub *label_1530
		gosub *label_1531
		gosub *los_draw
		p = windoww / 192
		repeat p + 1
			if ( cnt == p ) {
				sx = windoww \ 192
			}
			else {
				sx = 192
			}
			pos cnt * 192, inf_msgy
			gcopy BUFFER_INF, 496, 528, sx, 5
		loop
		redraw 1
		press
		gosub *screen_refreshFull
		snd SOUNDLIST_OK1
		goto *pc_turn
	}
	getkey a, 122
	if ( a ) {
		gosub *dump_chara
		await 500
		goto *pc_turn
	}
	getkey a, 123
	if ( a ) {
		goto *game_debug
	}
	getkey a, 16
	if ( a ) {
		getkey a, 8
		if ( a ) {
			promptmax = 0
			exist exedir + "save\\" + playerid + "\\" + "autopick.txt"
			if ( strsize != (-1) ) {
				promptl(0, promptmax) = "autopick.txt", "null", "" + 0
				promptmax++
			}
			repeat 4, 1
				exist exedir + "save\\" + playerid + "\\" + "autopick_" + cnt + ".txt"
				if ( strsize != (-1) ) {
					promptl(0, promptmax) = "autopick_" + cnt + ".txt", "null", "" + cnt
					promptmax++
				}
			loop
			if ( promptmax > 1 ) {
				val = promptx, prompty, 220, 1
				gosub *prompt_key
				if ( rtval == (-1) ) {
					rtval = 0
				}
			}
			else {
				promptmax = 0
				rtval = 0
			}
			loadpickitembuff rtval
			if ( rtval == 0 ) {
				txt -1, lang("autopick.txtを再読み込みした。", "Reloaded autopick.txt.")
			}
			else {
				txt -1, lang("autopick_" + rtval + ".txtを再読み込みした。", "Reloaded autopick_" + rtval + ".txt.")
			}
			await 200
			gosub *screen_draw
			goto *pc_turn
		}
	}
	if ( key == "" | nc_intb_001 == 1 ) {
		nc_intb_001 = 0
		goto *pc_turn
	}
	if ( key == key_enter ) {
		key = key_search
		cell_featread cX(cc), cY(cc)
		if ( featId == CELL_FEATURE_DOWNSTAIRS | mType == MAP_TYPE_WORLD ) {
			key = key_godown
		}
		if ( featId == CELL_FEATURE_UPSTAIRS ) {
			key = key_goup
		}
		if ( featId >= CELL_FEATURE_SAMPLING_SPOT_DETECTION & featId <= CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
			key = key_search
		}
		inv_getheader -1
		p = 0
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iX(cnt) != cX(cc) | iY(cnt) != cY(cc) ) {
				continue
			}
			if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) == FILTER_CONTAINER ) {
				p = 1
			}
			if ( refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt) == FILTER_FURNITURE_WELL ) {
				p = 2
			}
			if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) == FILTER_FURNITURE_ALTAR ) {
				p = 3, cnt
			}
			if ( iEffect(cnt) != EFFECT_NONE | refitem(iID(cnt), DBSPEC_CAN_USE, cnt) != FALSE ) {
				p = 4
			}
			if ( refitem(iID(cnt), DBSPEC_CAN_READ, cnt) != FALSE ) {
				p = 5
			}
			if ( iID(cnt) == ITEM_ID_MOON_GATE ) {
				key = key_godown
			}
			if ( iID(cnt) == ITEM_ID_UPSTAIRS ) {
				if ( gArea  == AREA_HOME | areaId(gArea ) == AREA_DUNGEON ) {
					key = key_goup
				}
			}
			if ( iID(cnt) == ITEM_ID_DOWNSTAIRS ) {
				if ( gArea  == AREA_HOME | areaId(gArea ) == AREA_DUNGEON ) {
					key = key_godown
				}
			}
			if ( iID(cnt) == ITEM_ID_KOTATSU ) {
				key = key_godown
			}
		loop
		if ( key == key_godown | key == key_goup ) {
			p = -1
		}
		if ( p == 0 ) {
			if ( key == key_enter ) {
				key = key_search
			}
		}
		if ( p == 1 ) {
			key = key_open
		}
		if ( p == 2 ) {
			key = key_dip
		}
		if ( p == 3 ) {
			if ( godcheck() != "eyth" ) {
				key = key_offer
			}
			else {
				key = key_pray
			}
		}
		if ( p == 4 ) {
			key = key_use
		}
		if ( p == 5 ) {
			key = key_read
		}
	}
	if ( mousel == 1 ) {
		mousemove = 1
		automove--
		ematan p, windoww / 2 - mousex, (windowh - inf_verh) / 2 - mousey
		p = p * 360 / 255
		if ( p >= 338 ) {
			p = p - 360
		}
		s = key_south, key_southwest, key_west, key_northwest, key_north, key_northeast, key_east, key_southeast
		repeat 8
			if ( p <= cnt * 45 + 23 & p > cnt * 45 - 23 ) {
				key = s(cnt)
			}
		loop
		await 100
	}
	if ( key != "" ) {
		gosub *label_4190
	}
	if ( key == key_quick ) {
		gosub *com_quick
		gosub *screen_draw
	}
	if ( key == "sc" ) {
		if ( ogdata(36 + sc) == (-1) & ncgsdata(sc) != "" ) {
			sdim nc_key_log, 64, 100
			dim nc_key_roop, 100
			folder = exedir + "user\\macro\\"
			macrofolder = folder + ncgsdata(sc)
			buff = ""
			notesel buff
			noteload macrofolder
			repeat 100
				noteget nc_key_log(cnt), cnt
				if ( nc_key_log(cnt) == "" ) {
					break
				}
			loop
			nc_macrorow = 0
			nc_macromode = 1
			redraw 1
			goto *pc_turn
		}
		goto *com_shortcut
	}
	menucycle = 1
	if ( key == key_quickinv ) {
		invctrl = lastctrl
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( key == key_throw ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			invctrl = INVCTRL_THROW
			snd SOUNDLIST_INV
			goto *label_2974
		}
	}
	if ( key == key_inventory ) {
		invctrl = INVCTRL_INFO
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( key == key_drop ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			invctrl = INVCTRL_DROP
			snd SOUNDLIST_INV
			goto *label_2974
		}
	}
	if ( key == key_eat ) {
		invctrl = INVCTRL_EAT
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( key == key_read ) {
		invctrl = INVCTRL_READ
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( key == key_drink ) {
		invctrl = INVCTRL_DRINK
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( key == key_zap ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			invctrl = INVCTRL_ZAP
			snd SOUNDLIST_INV
			goto *label_2974
		}
	}
	if ( key == key_use ) {
		invctrl = INVCTRL_USE
		snd SOUNDLIST_INV
		goto *label_2974
	}
	if ( key == key_open ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			invctrl = INVCTRL_OPEN
			snd SOUNDLIST_INV
			goto *label_2974
		}
	}
	if ( key == key_dip ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			invctrl = INVCTRL_DIP_SOURCE
			snd SOUNDLIST_INV
			goto *label_2974
		}
	}
	if ( key == key_charainfo ) {
		csctrl = 0
		goto *label_2879
	}
	if ( key == key_material ) {
		goto *com_material
	}
	if ( key == key_trait ) {
		goto *com_trait
	}
	if ( key == key_wear ) {
		goto *label_2943
	}
	if ( key == cfg_key_cast_ancient ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			curmenu = 2
			snd SOUNDLIST_SPELL
			goto *com_spell
		}
	}
	if ( key == cfg_key_cast_another ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			curmenu = 3
			snd SOUNDLIST_SPELL
			goto *com_spell
		}
	}
	if ( key == key_cast ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			curmenu = 0
			snd SOUNDLIST_SPELL
			goto *com_spell
		}
	}
	if ( key == key_skill ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			snd SOUNDLIST_SKILL
			goto *label_2811
		}
	}
	if ( key == key_msglog ) {
		goto *com_log
	}
	if ( key == key_journal ) {
		goto *com_journal
	}
	menucycle = 0
	if ( key == key_offer ) {
		if ( mType == MAP_TYPE_WORLD ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			invctrl = INVCTRL_OFFER
			snd SOUNDLIST_INV
			item_find FILTER_FURNITURE_ALTAR, ITEM_FIND_MODE_TYPE_MINOR
			ti = stat
			goto *label_2974
		}
	}
	if ( key == key_help ) {
		gosub *com_help
		gosub *screen_draw
		goto *pc_turn
	}
	if ( key == key_haizinhelp ) {
		gosub *nc_haizinhelp
		gosub *screen_draw
		goto *pc_turn
	}
	if ( key == key_rest ) {
		goto *com_rest
	}
	if ( key == key_interact ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			gosub *label_4931
			goto *pc_turn
		}
		else {
			goto *com_interact
		}
	}
	if ( key == key_target ) {
		findlocmode = 1
		gosub *label_2584
		findlocmode = 0
		goto *pc_turn
	}
	if ( key == key_fire ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			goto *com_fire
		}
	}
	if ( key == key_give ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			goto *com_give
		}
	}
	if ( key == key_get | key == key_get2 ) {
		goto *com_get
	}
	if ( key == key_look ) {
		if ( mType != MAP_TYPE_WORLD ) {
			goto *com_target
		}
		else {
			gosub *label_2584
			goto *pc_turn
		}
	}
	if ( key == key_save | key_escape == 1 ) {
		goto *com_save
	}
	if ( key == key_dig ) {
		goto *com_dig
	}
	if ( key == cfg_key_autodig ) {
		autodig_f = 1 - autodig_f
		if ( autodig_f ) {
			txt -1, lang("自動採掘をオンにした。", "You switched the automatic mining mode.")
		}
		else {
			txt -1, lang("自動採掘をオフにした。", "You switched the automatic mining mode.")
		}
		goto *pc_turn
	}
	if ( key == key_bash ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			goto *com_bash
		}
	}
	if ( key == key_search ) {
		goto *act_search
	}
	if ( key == key_close ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			goto *act_close
		}
	}
	if ( key == key_pray ) {
		if ( mType == MAP_TYPE_WORLD & 0 == 0 ) {
			txtnew
			txt -1, lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
			display_msg
			redraw 1
			goto *pc_turn
		}
		else {
			if ( gettrait(0, 175) ) {
				txt -1, lang("あなたは神を信じない。", "You do not believe in gods.")
				gosub *screen_draw
				goto *pc_turn
			}
			goto *act_pray
		}
	}
	if ( key == cfg_key_godinfo ) {
		prayctrl = 1
		gosub *god_select
		goto *label_4158
	}
	if ( key == key_ammo ) {
		goto *com_ammo
	}
	if ( key == cfg_key_info ) {
		viewinfo = 1 - viewinfo
		goto *pc_turn
	}
	if ( key == cfg_nc_key_music ) {
		gosub *nc_com_music
		goto *pc_turn
	}
	if ( key == cfg_nc_key_macro ) {
		gosub *nc_com_macro
		goto *pc_turn
	}
	if ( key_tab ) {
		gosub *label_1435
		gosub *screen_draw
		goto *pc_turn
	}
	p = 0
	if ( key == key_north ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER)
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER) - 1
		gRunDir = 3
		dirsub = 0
	}
	if ( key == key_south ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER)
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER) + 1
		gRunDir = 0
		dirsub = 4
	}
	if ( key == key_west ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER) - 1
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER)
		gRunDir = 1
		dirsub = 6
	}
	if ( key == key_east ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER) + 1
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER)
		gRunDir = 2
		dirsub = 2
	}
	if ( key == key_northwest ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER) - 1
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER) - 1
		gRunDir = 3
		dirsub = 7
	}
	if ( key == key_northeast ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER) + 1
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER) - 1
		gRunDir = 3
		dirsub = 1
	}
	if ( key == key_southwest ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER) - 1
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER) + 1
		gRunDir = 0
		dirsub = 5
	}
	if ( key == key_southeast ) {
		p = 1
		cXnew(CHARA_PLAYER) = cX(CHARA_PLAYER) + 1
		cYnew(CHARA_PLAYER) = cY(CHARA_PLAYER) + 1
		gRunDir = 0
		dirsub = 3
	}
	cDir(CHARA_PLAYER) = gRunDir
	if ( p == 1 ) {
		goto *label_3607
	}
	if ( key == key_godown ) {
		val = 1
		goto *label_3618
	}
	if ( key == key_goup ) {
		val = 2
		goto *label_3618
	}
	if ( key == key_wait ) {
		goto *label_4158
	}
	if ( key == key_enter ) {
		gosub *screen_draw
		goto *pc_turn
	}
	if ( key == key_abysstitle ) {
		if ( ncgDeepestAbyssFloor > 0 ) {
			snd SOUNDLIST_FEAT
			goto *nc_com_abysstitles
		}
	}
	if ( key == key_title ) {
		snd SOUNDLIST_FEAT
		menucycle = 4
		curmenu = 0
		goto *label_2649
	}
	if ( key != "" ) {
		if ( key != key_cancel ) {
			if ( key != key_alter ) {
				msgdup++
				txt -1, lang("?キーを押すと、コマンドの一覧が見られる。", "Hit ? key to display help.")
				gosub *screen_draw
			}
		}
	}
	goto *pc_turn

*label_4190
	if ( gQuitY != (-1) ) {
		if ( mType != MAP_TYPE_WORLD ) {
			if ( gQuitY == 0 ) {
				if ( key == "Q" ) {
					txt -1, lang("え…", "What...")
					gQuitY++
					gosub *screen_draw
					goto *pc_turn
				}
			}
			else {
				if ( gQuitY == 1 ) {
					if ( key == "y" ) {
						txt -1, lang("まさか…", "No...no...")
						gQuitY++
						gosub *screen_draw
						goto *pc_turn
					}
				}
				else {
					if ( gQuitY == 2 ) {
						if ( key == "@" ) {
							txt -1, lang("うわぁぁぁ！！", "Ahhhhh!!")
							repeat 10
								flt
								characreate -1, CREATURE_ID_AT_SIGN, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
							loop
							gQuitY = -1
							gosub *screen_draw
							goto *label_4158
						}
					}
					gQuitY = 0
				}
				gQuitY = 0
			}
		}
	}
	return

*game_win
	snd SOUNDLIST_COMPLETE1
	music = MUSICLIST_NONE2
	gosub *music_play
	txt -1, lang("信じられない！あなたはネフィアの迷宮「レシマス」を制覇した！", "Unbelievable! You conquered Lesimas!")
	gosub *screen_draw
	buff = ""
	notesel buff
	file = exedir + "save\\trophy"
	repeat 25
		if ( gettrait(0, 171 + cnt) < 0 & trophy(cnt) == 0 ) {
			txtef COLOR_GREEN
			txt -1, lang("新しいトロフィーを獲得した！", "You get a new trophy!")
			trophy(cnt) = 1
		}
		noteadd "" + trophy(cnt)
	loop
	notesave file + ".txt"
	txtsetwinword 3
	repeat 3
		promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
		promptmax++
	loop
	promptl(0, promptmax) = lang("(自分の言葉を伝える)", "(Communicate your words)"), key_select(3), "" + promptmax
	promptmax++
	val = promptx, prompty, 310, 0
	gosub *prompt_key
	if ( rtval == 3 ) {
		await 100
		val = (windoww - 310) / 2 + inf_screenx, winposy(90), 16, 1, 0
		inputlog = ""
		gosub *prompt_word
		if ( inputlog == "" ) {
			wincomment = "" + promptl(0, 0)
		}
		else {
			wincomment = inputlog
		}
	}
	else {
		wincomment = "" + promptl(0, rtval)
	}
	repeat 16
		if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
			ctalk cnt, 1134, cnt, 0
		}
	loop
	mode = MODELIST_EVENT
	screenupdate = -1
	gosub *screen_draw
	if ( jp ) {
		msg_clear
		txt -1, "「お前がここに辿り着くことは」台座から、何かの声が聞こえる。"
		flt
		characreate -1, CREATURE_ID_ORPHE_THE_CHAOS_CHILD, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		music = MUSICLIST_MCCHAOS
		gosub *music_play
		msg_halt
		msg_clear
		txt -1, "「決まっていたことなのだ…遅かれ早かれな」"
		txt -1, "部屋の空気が突然緊張し、あなたの前に端麗な青年が現れた。"
		txt -1, "「我々からすれば、複雑性の一面に過ぎないが、人間は運命とでも呼ぶのだろう？」"
		msg_halt
		msg_clear
		txt -1, "あなたは懸命に脚の震えを抑えようとしたが、難しかった。"
		txt -1, "華奢に見える幼顔の男の影は、人のものではない。"
		txt -1, "あどけない瞳の奥に、あなたは底知れない力と闇を感じた。"
		msg_halt
		msg_clear
		txt -1, "「ネフィアの永遠の盟約に基づき」青年は台座の横の死体を指し、皮肉な微笑を送った。"
		txt -1, "「この哀れな老人が守っていたものは、今からお前のものだ」"
		msg_halt
		msg_clear
		txt -1, "あなたは、台座の上に置かれている絢爛な装飾の本を、いぶかしげに眺めた。"
		msg_halt
		tc = findchara(CREATURE_ID_ORPHE_THE_CHAOS_CHILD)
		gosub *chat
		msg_clear
		txt -1, "青年は悪戯っぽくニヤリと笑い、壁に寄りかかった。"
		msg_halt
		msg_clear
		chara_vanquish findchara(CREATURE_ID_ORPHE_THE_CHAOS_CHILD)
		screenupdate = -1
		gosub *screen_draw
		txt -1, "…どれくらい時間がたっただろう。氷の瞳の男は、いつの間にか姿を消していた。あなたは不安を振り払い、ゆっくりと本に手を伸ばした…"
		msg_halt
	}
	mode = MODELIST_MAIN
	music = MUSICLIST_MCMARCH2
	gosub *music_play
	gosub *screen_fadeOut
	redraw 0
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "\\graphic\\void.bmp", 1
	pos 0, 0
	gzoom windoww, windowh, 4, 0, 0, 640, 480
	gsel BUFFER_SCREEN
	gosub *label_1567
	pos 0, 0
	gcopy BUFFER_BUF, 0, 0, windoww, windowh
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "\\graphic\\g1.bmp", 1
	gsel BUFFER_SCREEN
	s = lang("" + cnAka(CHARA_PLAYER) + cnName(CHARA_PLAYER) + "に祝福あれ！あなたは遂にレシマスの秘宝を手にいれた！", "Blessing to " + cnName(CHARA_PLAYER) + ", " + cnAka(CHARA_PLAYER) + "! You've finally aquired the codex!")
	gosub *screen_drawMsg2
	s = lang("*勝利*", "*Win*"), "" + strhint3
	windowshadow = 1
	ww = 680
	wh = 488
	pagesize = 0
	display_window windoww / 2 - ww / 2, windowh / 2 - wh / 2, ww, wh
	cmbg = 0
	x = ww / 3 - 20
	y = wh - 140
	gmode 4, 180, 300, 250
	pos wx + ww - 120, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("制覇までの軌跡", "Trace"), wx + 28, wy + 40
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	color 0, 0
	pos wx + 40, wy + 76
	mes lang("" + 517 + "年" + 8 + "月" + 12 + "日に、あなたはノースティリスに到着した。", "In the year " + 517 + ", " + 12 + "/" + 8 + ", you arrived at North Tyris.")
	mes ""
	mes lang("最深で" + gDeepest + "階相当まで到達し、" + gKilled + "匹の敵を殺して、", "You've killed " + gKilled + " creatures and reached\nmaximum of " + cnvrank(gDeepest) + " level of dungeons.")
	mes lang("現在" + calcscore() + "点のスコアを叩き出している。", "Your score is " + calcscore() + " points now.")
	mes ""
	mes lang("" + gYear  + "年" + gMonth  + "月" + gDay  + "日にレシマスを制覇して、", "In the year " + gYear  + ", " + gDay  + "/" + gMonth  + ", you conquered Lesimas.")
	mes lang("あなたは「" + wincomment + "」とコメントした。", "Upon killing Zeome, you said, " + cnvtalk("" + wincomment))
	mes ""
	mes lang("…あなたの旅はまだ終わらない。", "Your journey continues...")
	mes ""
	if ( jp ) {
		titlename(0) = "無魔法", "虚弱", "優柔不断", "一神教者", "無神論者"
		titlename(5) = "暴食", "バッドコミュニケーション", "純情", "終生誓願", "トリガーハッピー"
		titlename(10) = "殺生忌避", "文盲", "動物敵対", "孤独", "性依存症"
		titlename(15) = "アルコール依存症", "ギャンブラー", "清廉潔白", "復活不可", "一期一会"
		titlename(20) = "食事不可", "オワタ式", "成長不可", "ハードモード", "Zen"
	}
	else {
		titlename(0) = "Nil Magic", "Flimsy", "Indecisiveness", "Monotheist", "Atheist"
		titlename(5) = "Bulimia", "Bad Communication", "Chaste", "Lifelong Vow", "Trigger Happy"
		titlename(10) = "Abhors Killing", "Illiterate", "Animal Discord", "Lonely", "Hypersexual Disorder"
		titlename(15) = "Alcoholism", "Gambling Addiction", "Pacifist", "One Life", "Once-in-a-lifetime chance"
		titlename(20) = "Can not eat", "1hit death", "not growth", "Hard Mode", "Zen"
	}
	if ( gettrait(0, 193) < (-1) ) {
		titlename(22) = lang("オール1", "All 1")
	}
	if ( gettrait(0, 194) < (-1) ) {
		titlename(23) = lang("ナイトメアモード", "Nightmare Mode")
	}
	f = 0
	repeat 23
		if ( gettrait(0, 171 + cnt) < 0 ) {
			f = 1
		}
	loop
	if ( f == 1 ) {
		mes lang("今回制覇したマイナスフィートは次の通りだ。", "The minus feet you've just captured are as follows.")
		repeat 25
			if ( gettrait(0, 171 + cnt) < 0 ) {
				mes "＊" + titlename(cnt) + "＊"
			}
		loop
		f = 0
	}
	redraw 1
	key_list = key_enter
	keyrange = 0
	throwsstpevent "ConqueredLesimas", cc, wincomment, calcscore()

*game_win_WHILE1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_cancel ) {
		goto *game_win_WEND1
	}
	goto *game_win_WHILE1

*game_win_WEND1
	gosub *screen_refreshFull
	txt -1, lang("達成のシーンをもう一度再現する？", "You want to watch this event again?")
	promptl(0, 0) = stryes, "y", "0"
	promptl(0, 1) = strno, "n", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *prompt_key
	if ( rtval == 0 ) {
		goto *game_win
	}
	flagMain = 180
	gosub *screen_draw
	return

*pc_dead
	cc = CHARA_PLAYER
	snd SOUNDLIST_DEAD1
	screenupdate = -1
	gosub *screen_draw
	throwsstpevent "Dead", cc, "", 0
	if ( gQuest ) {
		goto *event_SWEND1
	}
	if ( oabit(13, gArea ) ) {
		screenupdate = -1
		gosub *screen_refreshFull
		levelexitby = MAP_EXIT_DEAD
		goto *map_exit
	}
	if ( gGodTalk ) {
		txtgod godcheck(), 2407
		if ( stat ) {
			msg_halt
		}
	}
	txt -1, lang("さようなら… ", "Good bye... ")
	txt -1, lang("遺言は？", "You leave a dying message.")
	if ( gettrait(0, 189) != 0 ) {
		ctrlfile 9
	}
	await 100
	val = (windoww - 310) / 2 + inf_screenx, winposy(90), 16, 1, 0
	inputlog = ""
	gosub *prompt_word
	if ( inputlog == "" ) {
		txtsetlastword
	}
	else {
		lastword = lang("「", "\"") + inputlog + lang("」", "\"")
	}
	throwsstpevent "Lastword", 0, inputlog, 0
	buff = ""
	notesel buff
	file = exedir + "save\\bone"
	exist file + ".txt"
	if ( strsize != (-1) ) {
		noteload file + ".txt"
	}
	s = cnAka(cc) + " " + cnName(cc) + lang("", " ") + lastword
	lenfix s, 60
	s += lang("" + gYear  + "年" + gMonth  + "月" + gDay  + "日", "" + gYear  + "/" + gMonth  + "/" + gDay )
	noteadd "", 0
	noteadd s, 1
	s = lang(mdatan(0) + "で" + ndeathcause, cnven(ndeathcause) + " in " + mdatan(0) + ".")
	noteadd s, 2
	s = "" + calcscore() + "," + cPic(cc)
	noteadd s, 3
	if ( noteinfo(0) >= 80 * 4 ) {
		repeat noteinfo(0) - 80 * 4, 80 * 4
			notedel 80 * 4
		loop
	}
	page = 0
	repeat
		p(1) = 0
		repeat 80 - 1
			p = cnt * 4
			noteget s(10), p + 3
			csvsort s, s(10), 44
			p(2) = int(s)
			noteget s(10), p + 7
			csvsort s, s(10), 44
			p(3) = int(s)
			if ( p(3) > p(2) ) {
				if ( cnt == page ) {
					page = cnt + 1
				}
				else {
					if ( cnt + 1 == page ) {
						page = cnt
					}
				}
				repeat 3, 1
					noteget s, p + cnt
					noteget s(1), p + 4 + cnt
					noteadd s, p + 4 + cnt, 1
					noteadd s(1), p + cnt, 1
				loop
				p(1) = 1
			}
		loop
		if ( p(1) == 0 ) {
			break
		}
	loop
	repeat noteinfo(0) / 4
		noteadd "" + cnvrank(cnt + 1) + lang("位", ""), cnt * 4, 1
	loop
	notesave file + ".txt"
	redraw 0
	gsel BUFFER_BUF
	pos 0, 0
	picload_ exedir + "graphic\\void.bmp", 1
	gsel BUFFER_SCREEN
	gosub *dead_draw
	if ( gettrait(0, 189) != 0 ) {
		s = lang("あなたの旅は幕を閉じた。さようなら…（キーを押すと終了します）", "You have been buried. Bye...(Hit any key to exit)")
		gosub *screen_drawMsg2
		redraw 1
		press
		if ( cfg_nc_logapply == 1 ) {
			s = "" + lang("[死亡ログ/復活不可モード]" + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + "は" + mdatan(0) + "で" + ndeathcause + lastword, "[Dead Log/One Life]" + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + " " + ndeathcause + " in " + mdatan(0) + " " + lastword)
			gosub *nc_net
		}
		goto *exit_game
	}
	else {
		s = lang("あともう少しで埋葬される…", "You are about to be buried...")
		if ( nc_intb_nightmare ) {
			s = lang("ナイトメアモード時は埋まることができない。", "It cannot be filled when in nightmare mode.")
		}
	}
	gosub *screen_drawMsg2
	promptl(0, promptmax) = lang("這い上がる", "Crawl up"), "a", "0"
	promptmax++
	if ( nc_intb_nightmare == 0 ) {
		promptl(0, promptmax) = lang("埋まる", "Lie on your back"), "b", "1"
		promptmax++
	}
	if ( cfg_st_exchangecrawluporburied & nc_intb_nightmare == 0 ) {
		locvar_lovemiracle_s = promptl(0, 0)
		promptl(0, 0) = promptl(0, 1)
		promptl(0, 1) = locvar_lovemiracle_s
		locvar_lovemiracle_s = promptl(2, 0)
		promptl(2, 0) = promptl(2, 1)
		promptl(2, 1) = locvar_lovemiracle_s
	}
	val = promptx, 100, 240, 1
	gosub *prompt_key
	if ( rtval == 1 ) {
		gosub *dead_draw
		s = lang("あなたは埋められた。さようなら…（キーを押すと終了します）", "You have been buried. Bye...(Hit any key to exit)")
		gosub *screen_drawMsg2
		redraw 1
		press
		goto *exit_game
	}
	s = "dead" + lang(cnAka(CHARA_PLAYER) + cnName(CHARA_PLAYER) + "は" + mdatan(0) + "で" + ndeathcause + lastword, cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + " " + ndeathcause + " in " + mdatan(0) + " " + lastword)
	if ( gWizard == 0 ) {
		net_send s
		if ( cfg_nc_logapply == 1 ) {
			s = "" + lang("[死亡ログ]" + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + "は" + mdatan(0) + "で" + ndeathcause + lastword, "[Dead Log]" + cnAka(CHARA_PLAYER) + " " + cnName(CHARA_PLAYER) + " " + ndeathcause + " in " + mdatan(0) + " " + lastword)
			gosub *nc_net
		}
	}
	if ( gettrait(0, 195) != 0 ) {
		cBlind(CHARA_PLAYER) = 1000
	}
	screenupdate = -1
	gosub *screen_refreshFull
	levelexitby = MAP_EXIT_DEAD
	goto *map_exit

*dead_draw
	notesel buff
	redraw 0
	gmode 0
	pos 0, 0
	gzoom windoww, windowh, 4, 0, 0, 800, 600
	gmode 2
	x = 135
	y = 134
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 138, 131, 100
	p = page - 4
	if ( p >= 80 ) {
		p = 80 - 8
	}
	if ( p < 0 ) {
		p = 0
	}
	repeat 8, p
		p = cnt * 4
		y += 46
		if ( cnt == page ) {
			s = "New!"
		}
		else {
			s = " " + cnvrank(cnt + 1) + lang("位", "")
		}
		pos x - 80, y + 10
		color 10, 10, 10
		mes s
		if ( p >= noteinfo(0) ) {
			s = "no entry"
		}
		else {
			noteget s, p + 1
		}
		pos x, y
		color 10, 10, 10
		mes s
		if ( p >= noteinfo(0) ) {
			continue
		}
		noteget s, p + 2
		pos x, y + 20
		color 10, 10, 10
		mes s
		noteget s(10), p + 3
		csvsort s, s(10), 44
		pos x + 480, y + 20
		color 10, 10, 10
		mes "" + s + lang("点", "")
		p = int(s(1)) \ 1000
		chara_preparepic p
		pos x - 22, y + 12
		gmode 2, chipc(CHIPC_WIDTH, p), chipc(CHIPC_HEIGHT, p)
		grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, p) / (1 + (chipc(CHIPC_HEIGHT, p) > inf_tiles)), inf_tiles
	loop
	return

*label_4208
	procid = (procid + 1) \ 10
	proclist(procid) = "event" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	_switch_val = evid()
	if ( _switch_val == 8 | _switch_sw ) {
		_switch_sw = 0
		gosub *label_3983
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 14 | _switch_sw ) {
		_switch_sw = 0
		if ( gQuest == QUEST_TYPE_PARTY ) {
			txt -1, lang("パーティーは終了した。", "The party is over.")
			calcpartyscore
			calcpartyscore2
			txt -1, lang("最終得点は" + qParam2(gQuestRef) + "ポイントだった！", "Your final score is " + qParam2(gQuestRef) + " points!")
			if ( qParam1(gQuestRef) <= qParam2(gQuestRef) ) {
				gQuestStatus = QUEST_STATE_SUCCESS
				qStatus(gQuestRef) = QUEST_STATE_SUCCESS
				txtef COLOR_GREEN
				txt -1, lang("パーティーは大盛況だった！", "People had a hell of a good time!")
				gosub *com_txtAdvQuit
			}
			else {
				txtef COLOR_PURPLE
				txt -1, lang("パーティーはぐだぐだになった…", "The party turned out to be a big flop...")
			}
			ogExtravagantParty = 0
		}
		if ( gQuest == QUEST_TYPE_HARVEST ) {
			if ( qParam1(gQuestRef) < qParam2(gQuestRef) ) {
				gQuestStatus = QUEST_STATE_SUCCESS
				qStatus(gQuestRef) = QUEST_STATE_SUCCESS
				txtef COLOR_GREEN
				txt -1, lang("無事に納入を終えた！", "You complete the task!")
				msg_halt
			}
			else {
				txtef COLOR_PURPLE
				txt -1, lang("納入は間に合わなかった…", "You fail to fulfill your task...")
			}
		}
		if ( gQuest == QUEST_TYPE_CONQUER ) {
			txtef COLOR_PURPLE
			txt -1, lang("討伐に失敗した…", "You failed to slay the target...")
		}
		if ( gQuest == 1020 ) {
			txt -1, lang("もてなしは終了した。", "The hospitality was over.")
			txt -1, lang("あなたは" + qParam2(gQuestRef) + "人の客を取った！", "You could have entertained " + qParam2(gQuestRef) + " people!")
			if ( qParam1(gQuestRef) <= qParam2(gQuestRef) ) {
				gQuestStatus = QUEST_STATE_SUCCESS
				qStatus(gQuestRef) = QUEST_STATE_SUCCESS
				txtef COLOR_GREEN
				txt -1, lang("無事に依頼を終えた！", "People had a hell of a good time!")
				msg_halt
			}
		}
		if ( gQuest == 1021 ) {
			if ( qParam1(gQuestRef) == 0 ) {
				txtef COLOR_PURPLE
				txt -1, lang("あなたは護衛の任務を果たせなかった。", "You have failed to protect the sheep.")
				modkarma 0, -10
			}
			else {
				music = MUSICLIST_MCFANFARE
				musicloop = 1
				gosub *music_play
				gQuestStatus = QUEST_STATE_SUCCESS
				qStatus(gQuestRef) = QUEST_STATE_SUCCESS
				txtef COLOR_GREEN
				txt -1, lang("無事に護衛を終えた！", "You complete the task!")
				msg_halt
			}
		}
		levelexitby = MAP_EXIT_NORMAL
		snd SOUNDLIST_EXITMAP1
		chatteleport = 1
		return
		_switch_sw++
	}
	if ( _switch_val == 1 | _switch_sw ) {
		_switch_sw = 0
		throwsstpevent "ZeomeKilled", cc, "", 0
		gosub *game_win
		flt
		characreate -1, CREATURE_ID_ORPHE_THE_CHAOS_CHILD, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 27 | _switch_sw ) {
		_switch_sw = 0
		if ( gArea  == AREA_SHOW_HOUSE ) {
			goto *label_4254
		}
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_LITTLE_SISTER, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		txtef COLOR_BLUE
		txt -1, lang("ビッグダディの肩から、リトルシスターが滑り落ちた。「Mr Bubbles！！」", "The little sister slips from Big Daddy's shoulder, " + cnvtalk("Mr.Bubbles!"))
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 200 | _switch_sw ) {
		_switch_sw = 0
		if ( gArea  == AREA_SHOW_HOUSE ) {
			goto *label_4254
		}
		flt
		novoidlv = 1
		characreate -1, CREATURE_ID_TRUE_THE_FENS_FATHER, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		cRole(rc) = ROLE_UNIQUE_TRUE
		txtef COLOR_BLUE
		txt -1, lang("主に捕まっていた何者かが、地面に落ちた。", "Something that had been captured by the Dragon fell to the ground.")
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 28 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_YELLOW
		txt -1, lang("…ぅっぅぅ…っぅぅっぅううううみみゃぁ！！！", "memememw...MEMEMEM...MEWWWWWW!")
		msg_halt
		animeid = ANIMATION_RAGNA
		gosub *anime
		flt
		characreate -1, CREATURE_ID_GOD_INSIDE_EHEKATL, evdata1(evnum - (evnum != 0) * 1), evdata2(evnum - (evnum != 0) * 1)
		cdata(STARTING_CDATA_ACT_MAIN, rc) = ACTION_MELEE
		cdata(STARTING_CDATA_ACT_SUB, rc) = SKILL_SPACT_POWER_BREATH, SKILL_SPELL_CRYSTAL_SPEAR, SKILL_SPACT_DRAW_SHADOW, SKILL_SPACT_DRAIN_BLOOD
		cActIndex(rc) = 41
		ocbitmod 7, rc, 1
		ocbitmod 13, rc, 0
		cbitmod CHARA_BIT_RES_ELEMENTAL, rc, FALSE
		cbitmod CHARA_BIT_METAL, rc, FALSE
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 2 | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_LOMIAS_THE_MESSENGER_FROM_VINDALE)
		gosub *chat
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 24 | _switch_sw ) {
		_switch_sw = 0
		initeco = 1
		gosub *label_3860
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 3 | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_ZEOME_THE_FALSE_PROPHET)
		gosub *chat
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 11 | _switch_sw ) {
		_switch_sw = 0
		if ( findchara(CREATURE_ID_SHOPKEEPER) != 0 ) {
			tc = findchara(CREATURE_ID_SHOPKEEPER)
		}
		else {
			tc = findchara(CREATURE_ID_YOUNGER_SISTER2)
		}
		gosub *chat
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 23 | _switch_sw ) {
		_switch_sw = 0
		if ( findchara(CREATURE_ID_ROGUE_BOSS) != 0 ) {
			tc = findchara(CREATURE_ID_ROGUE_BOSS)
		}
		else {
			if ( findchara(CREATURE_ID_SILVER_EYED_WITCH, 6) != 0 ) {
				tc = findchara(CREATURE_ID_SILVER_EYED_WITCH, 6)
			}
			else {
				tc = findchara(CREATURE_ID_YOUNGER_SISTER2)
			}
		}
		gosub *chat
		gMapEvent = 23
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 12 | _switch_sw ) {
		_switch_sw = 0
		gosub *screen_draw
		s = lang("ペットとの再会", "Reunion with your pet")
		file = "bg_re13"
		buff = lang("あなたは懐かしい鳴き声に気付いて、ふと歩みを止めた。なんと、船が難破した時に居なくなったあなたのペットが、嬉しそうに走ってくる！あなたのペットは…", "As you approach the mining town, you notice a familiar call and stop walking. Your old pet who got separated from you during the shipwreck is now running towards you joyfully! Your pet is...")
		listmax = 0
		list(0, listmax) = 1
		listn(0, listmax) = lang("犬だ！", "a dog!")
		listmax++
		list(0, listmax) = 2
		listn(0, listmax) = lang("猫だ！", "a cat!")
		listmax++
		list(0, listmax) = 3
		listn(0, listmax) = lang("クマだ！", "a bear!")
		listmax++
		list(0, listmax) = 4
		listn(0, listmax) = lang("少女だ！", "a little girl!")
		listmax++
		if ( ogbit(8) ) {
			list(0, listmax) = 5
			listn(0, listmax) = lang("妹だ！", "a younger sister!")
			listmax++
		}
		if ( gArea  == AREA_VERNIS & flagAlly == 0 ) {
			flagAlly = 1
			list(0, listmax) = 6
			listn(0, listmax) = lang("人違いだ...", "Just a wrong person...")
			listmax++
		}
		gosub *label_2485
		p = 3
		if ( rtval == 1 ) {
			p = 165
		}
		if ( rtval == 2 ) {
			p = 164
		}
		if ( rtval == 3 ) {
			p = 108
		}
		if ( rtval == 4 ) {
			p = 166
		}
		if ( rtval == 5 ) {
			p = 176
		}
		if ( rtval == 6 ) {
			goto *label_4254
		}
		flt
		initlv = cLevel(CHARA_PLAYER) * 2 / 3 + 1
		novoidlv = 1
		characreate -1, p, cX(cc), cY(cc)
		gosub *cm_race_loop_WHILE1
		ogbitmod 8, 0
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 13 | _switch_sw ) {
		_switch_sw = 0
		music = MUSICLIST_MCWEDDING
		gosub *music_play
		s = lang("結婚", "Marriage")
		file = "bg_re14"
		buff = lang("長い交際の末、遂にあなたと" + name(marry) + "は固い絆で結ばれた。婚儀の後、あなたの元に幾つか祝儀品が届けられた。", "At last, you and " + name(marry) + " are united in marriage! After the wedding ceremony, you receive some gifts.")
		listmax = 0
		list(0, listmax) = 1
		listn(0, listmax) = lang("生涯をあなたに捧げる", "Without you, life has no meaning.")
		listmax++
		gosub *label_2485
		repeat 5
			flt calcobjlv(cLevel(marry) + 5), calcfixlv(FIX_QUALITY_GREAT)
			flttypemajor = fsetchest(rnd(length(fsetchest)))
			itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		loop
		flt
		itemcreate -1, ITEM_ID_ENGAGEMENT_RING, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		iQuality(ci) = FIX_QUALITY_GODLY
		iLevel(ci) = 1
		iStatus(ci) = ITEM_STATUS_BLESSED
		ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
		ibitmod ITEM_BIT_HANDMADE, ci, TRUE
		ibitmod 21, ci, TRUE
		iParam2(ci) = cId(marry)
		if ( cId(marry) == CREATURE_ID_USER ) {
			iCNpcId(ci) = cUNID(marry)
			ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(marry)))
		}
		iSubName(ci) = 0
		repeat 15
			p = reinforcecheck(cnt, ci)
			if ( p == (-1) ) {
				break
			}
			if ( p ) {
				inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) = 0
				inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) = 0
			}
		loop
		flt
		itemcreate -1, ITEM_ID_ENGAGEMENT_RING, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		iQuality(ci) = FIX_QUALITY_GODLY
		iLevel(ci) = 1
		iStatus(ci) = ITEM_STATUS_BLESSED
		ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
		ibitmod ITEM_BIT_HANDMADE, ci, TRUE
		ibitmod 21, ci, TRUE
		iParam2(ci) = 999
		iSubName(ci) = 0
		repeat 15
			p = reinforcecheck(cnt, ci)
			if ( p == (-1) ) {
				break
			}
			if ( p ) {
				inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) = 0
				inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) = 0
			}
		loop
		itemcreate -1, ITEM_ID_POTION_CURE_CORRUPTION, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), rnd(3) + 2
		if ( trophycheck(TROPHY_ILLITERACY) == 2 ) {
			flt
			itemcreate -1, ITEM_ID_SMALL_MEDAL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3 + rnd(3)
			flt
			itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 5 + rnd(3)
		}
		txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		ogTimesMarried++
		gosub *label_2665
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 29 | _switch_sw ) {
		_switch_sw = 0
		boss = 1
		music = MUSICLIST_MCBOSS
		gosub *music_play
		dim voidboss, 0
		if ( gArea  == 210 ) {
			voidboss = 26, 27, 28, 29, 140, 34, 141, 143, 144, 145, 242, 25, 257, 230, 202, 37, 33, 80, 332, 306, 331, 338, 339, 342, 366, 367
		}
		else {
			voidboss = 26, 27, 28, 29, 140, 34, 141, 143, 144, 145, 242, 25, 257, 230, 202, 37, 33, 80, 332
		}
		if ( sqMinotaur == 1000 ) {
			voidboss(length(voidboss)) = 300
		}
		if ( flagMain >= 200 ) {
			voidboss(length(voidboss)) = 23
			voidboss(length(voidboss)) = 2
			voidboss(length(voidboss)) = 146
			voidboss(length(voidboss)) = 139
		}
		if ( sqMother == 1001 ) {
			voidboss(length(voidboss)) = 222
		}
		if ( ncgQuestAwaitOnesReturn >= 1000 ) {
			voidboss(length(voidboss)) = 390
		}
		if ( ncgQuestForMyFriends >= 1000 ) {
			voidboss(length(voidboss)) = 393
		}
		if ( npcmemory(0, CREATURE_ID_FRISIA_THE_CAT_QUEEN) >= 1 ) {
			voidboss(length(voidboss)) = 175
		}
		if ( npcmemory(0, CREATURE_ID_UTIMA_THE_DESTROYER_OF_XEREN) >= 1 ) {
			voidboss(length(voidboss)) = 177
		}
		if ( npcmemory(0, CREATURE_ID_AZZRSSIL_THE_IMPURE) >= 1 ) {
			voidboss(length(voidboss)) = 178
		}
		randomize gYear  + gLevel 
		c = voidboss(rnd(length(voidboss)))
		randomize
		flt
		fixlv = FIX_QUALITY_MIRACLE
		initlv = limit(gLevel  / 4, 50, 250)
		characreate -1, c, -3, 0
		cbitmod CHARA_BIT_PRECIOUS, rc, TRUE
		cRelation(rc) = RELATION_ENEMY
		cOrgRelation(rc) = RELATION_ENEMY
		boss = 0
		tc = rc
		areaBoss(gArea ) = tc
		txtef COLOR_RED
		txt -1, lang("気をつけろ！この階は" + mapname(gArea ) + "の守護者、" + cnName(tc) + "によって守られている。", "Be aware! This level is guarded by the lord of " + mapname(gArea ) + ", " + cnName(tc) + ".")
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 4 | _switch_sw ) {
		_switch_sw = 0
		boss = 1
		repeat
			gosub *label_2163
			fixlv = FIX_QUALITY_MIRACLE
			initlv = gLevel  + rnd(5)
			if ( oabit(7, gArea ) ) {
				if ( oabit(6, gArea ) ) {
					initlv = gLevel  * 3 + rnd(5)
				}
				else {
					npcrare = 1
				}
			}
			if ( oabit(0, gArea ) ) {
				initlv = initlv * 3 / 2
				dbid = 282
			}
			else {
				if ( oabit(8, gArea ) ) {
					initlv = initlv * 3 / 2
				}
				else {
					if ( oabit(3, gArea ) ) {
						olistmax = 0
						repeat length(csetquestboss)
							if ( npcmemory(0, csetquestboss(cnt) / 10000) == 0 ) {
								continue
							}
							if ( initlv < csetquestboss(cnt) \ 10000 ) {
								continue
							}
							olist(olistmax) = csetquestboss(cnt) / 10000
							olistmax++
						loop
						repeat usernpcmax
							if ( userdata(12, cnt) != 2 ) {
								continue
							}
							if ( getcnpcmemory(0, cnt) == 0 ) {
								continue
							}
							if ( initlv < userdata(2, cnt) ) {
								continue
							}
							olist(olistmax) = 343 + (cnt + 1) * 10000
							olistmax++
						loop
						p = olist(rnd(olistmax))
						dbid = p \ 10000
						initunid = p / 10000
						nospartifact = 1
						noenchant = 1
					}
					else {
						if ( oabit(6, gArea ) ) {
							charakind = 0
							dbid = -2
							initlv = objlv + rnd(5)
							nospartifact = 1
						}
						else {
							if ( oabit(10, gArea ) ) {
								gosub *label_4611
								if ( charakind < length(csetgodservant) ) {
									fixgod = godno2godid(charakind + 1)
								}
								else {
									fixgod = usergoddatan(2, charakind - length(csetgodservant))
								}
							}
						}
					}
				}
			}
			if ( oabit(17, gArea ) | oabit(18, gArea ) ) {
				initlv = 6666
				dbid = 336
			}
			characreate MAX_CHARA_NC, dbid, -3, 0
			if ( stat == 0 ) {
				continue
			}
			else {
				gosub *label_4551
				relocate_chara 56, -1, -3
				modnpcmemory 1, rc, 1
				cHP(rc) = cMHP(rc)
				cMP(rc) = cMMP(rc)
				cSP(rc) = cMSP(rc)
				cbitmod CHARA_BIT_PRECIOUS, rc, TRUE
				fixgod = ""
				if ( oabit(17, gArea ) | oabit(18, gArea ) ) {
					cbitmod CHARA_BIT_INVISIBLE, rc, TRUE
					cbitmod CHARA_BIT_METAL, rc, TRUE
					cbitmod 39, rc, TRUE
					addbuff rc, 60, 100, 10000
					addbuff rc, 61, 100, 10000
					addbuff rc, 63, 100, 10000
					cdata(STARTING_CDATA_ACT_MAIN, rc) = ACTION_MELEE
					cdata(STARTING_CDATA_ACT_SUB, rc) = 903, 904, 900
					cActIndex(rc) = 31
					cRole(rc) = ROLE_SHOP_CHALLENGER_YOUNGER_SISTER
					txtef COLOR_RED
					txt -1, lang("けたたましい警報が鳴り響いた！", "*beeeeeep!* An alarm sounds loudly!")
					repeat 188, 57
						if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
							cRelation(cnt) = RELATION_ENEMY
							lockon cnt, 0, 29
							cAiAggro(cnt) = 250
						}
					loop
				}
				break
			}
		loop
		boss = 0
		tc = rc
		areaBoss(gArea ) = tc
		cnName(rc) += " Lv" + cLevel(rc)
		txt -1, lang("どうやら最深層まで辿り着いたらしい…", "It seems you have reached the deepest level of this dungeon.")
		txtef COLOR_RED
		txt -1, lang("気をつけろ！この階は" + mapname(gArea ) + "の守護者、" + cnName(tc) + "によって守られている。", "Be aware! This level is guarded by the lord of " + mapname(gArea ) + ", " + cnName(tc) + ".")
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 5 | _switch_sw ) {
		_switch_sw = 0
		music = MUSICLIST_MCVICTORY
		gosub *music_play
		snd SOUNDLIST_COMPLETE1
		repeat 1 + oabit(9, gArea ) * 3
			flt
			flttypemajor = FILTER_ITEM_SPELLBOOK
			itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			flt
			itemcreate -1, ITEM_ID_SCROLL_RETURN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			nostack = 1
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			locvar_cnvjkey_gold = (rnd(cFame(CHARA_PLAYER) / 20 + 1) + rnd(cFame(CHARA_PLAYER) / 20 + 1) + 1) * 10
			iNum(ci) = 200 + iNum(ci) * 5 + locvar_cnvjkey_gold
			item_stack -1, ci
			flt
			oo_num = 1 + rnd(2)
			if ( gettrait(0, 170) ) {
				oo_num += limit(gLevel  / 25, 0, 10000 - oo_num)
			}
			oo_num += rnd(1 + limit(gLevel  / 5, 0, 10000 - oo_num))
			itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(CHARA_PLAYER), cY(CHARA_PLAYER), oo_num
			flt
			itemcreate -1, ITEM_ID_BEJEWELED_CHEST, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			iParam2(ci) = 0
			if ( oabit(2, gArea ) ) {
				repeat 10
					flt
					itemcreate -1, 422 + rnd(6), cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
				loop
			}
			if ( oabit(5, gArea ) ) {
				flt
				if ( finditemid("artifacts fusion license") ) {
					inititemid = stat
					itemcreate -1, ITEM_ID_CARNEADES_PLANK, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3
				}
			}
			if ( oabit(14, gArea ) ) {
				flt
				itemcreate -1, ITEM_ID_POTION_CURE_CORRUPTION, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
				iLevel(ci) = limitmax(gLevel  / 30, 2000)
				flt
				itemcreate -1, ITEM_ID_POTION_OF_GREATER_CURE_CORRUPTION, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3
			}
			if ( oabit(17, gArea ) ) {
				flt
				itemcreate -1, ITEM_ID_INFIEA, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
				iLevel(ci) = limitmax(gLevel  / 30, 2000)
				flt
				itemcreate -1, ITEM_ID_POTION_CURE_CORRUPTION, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3
				iLevel(ci) = limitmax(gLevel  / 30, 2000)
				flt
				if ( finditemid("artifacts fusion license") ) {
					inititemid = stat
					itemcreate -1, ITEM_ID_CARNEADES_PLANK, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 50
				}
				flt
				itemcreate -1, ITEM_ID_BEJEWELED_CHEST, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 10
				iParam2(ci) = 0
			}
			if ( oabit(18, gArea ) ) {
				flt
				itemcreate -1, ITEM_ID_SPELLBOOK_OF_ALL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
				iLevel(ci) = limitmax(gLevel  / 30, 2000)
				flt
				itemcreate -1, ITEM_ID_POTION_CURE_CORRUPTION, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3
				iLevel(ci) = limitmax(gLevel  / 30, 2000)
				flt
				if ( finditemid("artifacts fusion license") ) {
					inititemid = stat
					itemcreate -1, ITEM_ID_CARNEADES_PLANK, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 50
				}
				flt
				itemcreate -1, ITEM_ID_BEJEWELED_CHEST, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 10
				iParam2(ci) = 0
			}
		loop
		if ( areaParent(gArea ) == AREA_TEST_WORLD ) {
			flt
			itemcreate -1, ITEM_ID_FEAPPLE, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 1 + gLevel  / 20
		}
		if ( gArea  == AREA_VOID ) {
			flt
			itemcreate -1, ITEM_ID_MONSTER_BALL, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
			ibitmod ITEM_BIT_PRECIOUS, ci, TRUE
			iParam2(ci) = 10000
			iCol(ci) = 2
			iValue(ci) = 10000
		}
		else {
			if ( gArea  == 210 ) {
				flt
				if ( finditemid("artifacts fusion license") ) {
					inititemid = stat
					itemcreate -1, ITEM_ID_CARNEADES_PLANK, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 3 + gLevel  / 50
				}
			}
			else {
				if ( rndex(10000) < 250 ) {
					flt
					itemcreate -1, ITEM_ID_POTION_OF_GREATER_CURE_CORRUPTION, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
				}
			}
		}
		txtef COLOR_GREEN
		txt -1, lang("クエストを達成した！", "You have completed the quest!")
		snd SOUNDLIST_COMPLETE1
		txt -1, lang("何かが足元に転がってきた。", "Something is put on the ground.")
		modrank 2, 300, 8
		gQuestFame = calcfame(CHARA_PLAYER, gLevel  * 30 + 200)
		txtef COLOR_GREEN
		txt -1, lang("" + gQuestFame + "の名声値を手に入れた。", "You gain " + gQuestFame + " fame.")
		incfame 0, gQuestFame
		if ( gArea  == AREA_VOID ) {
			if ( gLevel  > 1050 ) {
				flt
				fixlv = FIX_QUALITY_GODLY
				flttypemajor = isetabyss(rnd(length(isetabyss)))
				itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
				repeat 15
					if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
						break
					}
					inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) = limitmax(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) * (rnd((gLevel  - 50) / 100 + 1) + 10), 2000000000)
				loop
			}
			areaBoss(gArea ) = 0
			if ( gVoidBoss - 49 > ncgDeepestVoidFloor ) {
				ncgDeepestVoidFloor = gVoidBoss - 49
			}
			gVoidBoss = gVoidBoss + 5
			txt -1, lang("この階の封印が解けたようだ！", "The seal of this level is now broken!")
		}
		else {
			if ( gArea  == 210 ) {
				flt
				fixlv = FIX_QUALITY_GODLY
				flttypemajor = isetabyss(rnd(length(isetabyss)))
				itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
				repeat 15
					if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
						break
					}
					inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) = limitmax(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) * (rnd((gLevel  - 50) / 5 + 1) + 100), 2100000000)
					if ( ncgAbyssPoints > 0 & inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) > 0 ) {
						inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) += inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) / 10 * rnd(ncgAbyssPoints) + 1
					}
				loop
				add_bigench 1
				if ( (gLevel  - 49) \ 50 == 0 ) {
					flt
					fixlv = FIX_QUALITY_GODLY
					flttypemajor = isetabyss(rnd(length(isetabyss)))
					itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
					repeat 15
						if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
							break
						}
						inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) = limitmax(inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) * (rnd((gLevel  - 50) / 5 + 1) + 100), 2100000000)
						if ( ncgAbyssPoints > 0 & inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) > 0 ) {
							inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) += inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) / 10 * rnd(ncgAbyssPoints) + 1
						}
					loop
					add_bigench 2
				}
				areaBoss(gArea ) = 0
				if ( gLevel  - 49 > ncgDeepestAbyssFloor ) {
					ncgDeepestAbyssFloor = gLevel  - 49
				}
				ncgDeepestAbyssFloorThisTime = gLevel 
				txt -1, lang("この階の封印が解けたようだ！", "The seal of this level is now broken!")
			}
			else {
				areaBoss(gArea ) = -1
			}
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 16 | _switch_sw ) {
		_switch_sw = 0
		txt -1, lang("あなたは無事に護衛の任務を終えた。", "You complete the escort.")
		tc = evdata2(evnum - (evnum != 0) * 1)
		gosub *chat
		rq = evdata1(evnum - (evnum != 0) * 1)
		gosub *label_3986
		chara_vanquish evdata2(evnum - (evnum != 0) * 1)
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 15 | _switch_sw ) {
		_switch_sw = 0
		repeat gClient
			if ( qExist(cnt) == QUEST_TYPE_ESCORT ) {
				if ( qStatus(cnt) == QUEST_STATE_ONGOING ) {
					if ( qParam2(cnt) == evdata1(evnum - (evnum != 0) * 1) ) {
						rq = cnt
						val = qExist(rq)
						gosub *quest_fail
						break
					}
				}
			}
		loop
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 6 | _switch_sw ) {
		_switch_sw = 0
		if ( nc_intb_nightmare ) {
			repeat 50 - 10, 10
				if ( cnt <= 17 ) {
					if ( sdata(cnt, CHARA_PLAYER) != 0 ) {
						if ( rnd(3) == 0 ) {
							skillexp2 cnt, CHARA_PLAYER, -500
						}
					}
				}
			loop
			cGold(CHARA_PLAYER) -= cGold(CHARA_PLAYER) / 2
		}
		else {
			if ( cFame(CHARA_PLAYER) > 1000 ) {
				repeat 50 - 10, 10
					if ( cnt <= 17 ) {
						if ( sdata(cnt, CHARA_PLAYER) != 0 ) {
							if ( rnd(3) == 0 ) {
								skillexp2 cnt, CHARA_PLAYER, limit(cFame(CHARA_PLAYER) / 100 * 5, 100, 500) * (-1)
							}
						}
					}
				loop
				if ( cKarma(CHARA_PLAYER) < (-30) ) {
					modkarma 0, 10
				}
			}
			else {
				txt -1, lang("名声が1000に達していないので能力値の減少はない。", "Death penalty won't be applied until you hit fame 1000.")
			}
			cGold(CHARA_PLAYER) -= cGold(CHARA_PLAYER) / 3
		}
		if ( gCorrupt >= 28000 ) {
			modcorrupt -2000
		}
		txt -1, lang("金貨を幾らか失った…", "You lost some money.")
		decfame CHARA_PLAYER, 10
		if ( eqfaction(0, "slime") ) {
			rmfaction 0, "slime"
		}
		if ( eqfaction(0, "dragon") ) {
			rmfaction 0, "dragon"
			ospact(782 - 661) = 0
		}
		if ( eqfaction(0, "golem") ) {
			rmfaction 0, "golem"
		}
		r1 = 0
		gosub *charaRefresh
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 20 | _switch_sw ) {
		_switch_sw = 0
		dmghp evdata1(evnum - (evnum != 0) * 1), 9999, DAMAGE_FROM_UNSEEN
		cRole(evdata1(evnum - (evnum != 0) * 1)) = ROLE_NONE
		cExist(evdata1(evnum - (evnum != 0) * 1)) = CHAR_STATE_DEAD
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cX(evdata1(evnum - (evnum != 0) * 1)), cY(evdata1(evnum - (evnum != 0) * 1)), 4
		sqMother = 1001
		tc = findchara(CREATURE_ID_LONELY_PAEL)
		if ( tc != CHARA_PLAYER ) {
			if ( cExist(tc) == CHAR_STATE_ALIVE ) {
				txtef COLOR_BLUE
				txt -1, lang("パエル「おかあさんーー！！」", cnvtalk("M-mom...!!"))
				cRelation(tc) = RELATION_ENEMY
				cAiAggro(tc) = 1000
				lockon tc, 0, 28
			}
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 7 | _switch_sw ) {
		_switch_sw = 0
		gosub *screen_drawEventFull
		press
		screenupdate = -1
		gosub *screen_refreshFull
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 10 | _switch_sw ) {
		_switch_sw = 0
		gosub *label_3965
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 19 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_BROWN
		txt -1, "" + usermsg
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 25 | _switch_sw ) {
		_switch_sw = 0
		gGuest--
		if ( get_freechara() == (-1) ) {
			txt -1, lang("ゲストは行方不明になった。", "The guest lost his way.")
			goto *label_4254
		}
		if ( rnd(3) ) {
			p = 0
			tc = CHARA_PLAYER
			repeat 100
				i = rnd(40 - 1) + 16
				if ( cExist(i) == CHAR_STATE_ADV ) {
					if ( cbit(CHARA_BIT_HIRED, i) == FALSE ) {
						cType(i) != gArea 
						if ( cRelation(i) >= RELATION_NEUTRAL ) {
							if ( rnd(25) < p ) {
								break
							}
							if ( tc == CHARA_PLAYER ) {
								tc = i
								p++
								if ( cImpression(tc) < 25 ) {
									if ( rnd(12) == 0 ) {
										break
									}
								}
								if ( cImpression(tc) < 0 ) {
									if ( rnd(4) ) {
										break
									}
								}
								continue
							}
							if ( cImpression(cnt) < cImpression(i) ) {
								tc = i
								p++
							}
						}
					}
				}
			loop
			if ( tc == CHARA_PLAYER ) {
				txt -1, lang("ゲストはすでに居なくなっていた。", "It seems the guest has already left your house.")
				goto *label_4254
			}
			cExist(tc) = CHAR_STATE_ALIVE
			rc = tc
			cxinit = cX(CHARA_PLAYER)
			cyinit = cY(CHARA_PLAYER)
			place_chara rc, cxinit, cyinit
		}
		else {
			flt 0, FIX_QUALITY_GOOD
			repeat 1
				if ( rnd(3) == 0 & guildcheck(0) == "prostitute" ) {
					flt
					initlv = rnd(5) + (50 - gRankGuild / 200)
					fixlv = FIX_QUALITY_UNIQUE
					characreate -1, CREATURE_ID_NOBLE, -3, 0
					cRelation(rc) = RELATION_NEUTRAL
					cOrgRelation(rc) = RELATION_NEUTRAL
					cRole(rc) = ROLE_SHOP_CHALLENGER_YOUNGER_SISTER
					cGold(rc) = 1000 * cLevel(rc)
					cnName(rc) = lang("『お金持ちのパパ』", "<Rich customers>")
					break
				}
				if ( rnd(10) == 0 & cGold(CHARA_PLAYER) >= 1000000 ) {
					initunid = findunid("eggplant putit")
					if ( initunid ) {
						flt
						initlv = 50
						fixlv = FIX_QUALITY_UNIQUE
						characreate -1, CREATURE_ID_USER, -3, 0
						cRole(rc) = ROLE_SPECIAL
						cRelation(rc) = RELATION_NEUTRAL
						cOrgRelation(rc) = RELATION_NEUTRAL
						cSex(rc) = 1
						cRole(rc) = ROLE_SHOP_THE_JUNK_SHOP_EGGPLANT_PUTIT
						cRoleFileId(rc) = 3003
						cRoleShopLv(rc) = limit(cGold(CHARA_PLAYER) / EXT_EQUIP_SLOTS + cFame(CHARA_PLAYER) / 100, 10, 10000)
						cnName(rc) = lang("『がらくた売りのプチナス』", "<The junk Shop eggplant putit>")
						break
					}
				}
				if ( rnd(10) == 0 & cMSP(CHARA_PLAYER) >= 300 ) {
					flt
					initlv = 50
					fixlv = FIX_QUALITY_UNIQUE
					characreate -1, CREATURE_ID_THIEF, -3, 0
					cRelation(rc) = RELATION_NEUTRAL
					cOrgRelation(rc) = RELATION_NEUTRAL
					cSex(rc) = 0
					cRole(rc) = ROLE_SHOP_SHUA
					cRoleFileId(rc) = 3002
					cRoleShopLv(rc) = limit(cMSP(CHARA_PLAYER) / 5, 10, 10000)
					cnName(rc) = lang("ラムネ売り『シュア』", "<Shua> the soda Shop")
					break
				}
				if ( rnd(10) == 0 & cFame(CHARA_PLAYER) >= 75000 ) {
					flt
					initlv = 50
					fixlv = FIX_QUALITY_UNIQUE
					characreate -1, CREATURE_ID_SHOPKEEPER, -3, 0
					cSex(rc) = 1
					cRole(rc) = ROLE_SHOP_ELLY
					cRoleFileId(rc) = 3001
					cRoleShopLv(rc) = limit(cFame(CHARA_PLAYER) / 500, 10, 10000)
					cnName(rc) = lang("宝石商人『エーリィ』", "<Elly> the jwely Shop")
					break
				}
				if ( rnd(10) == 0 & customitemfind(0, "blacksmith hammer") >= 0 ) {
					if ( iLevel(locvar_mapitemfind_citemno) >= 1 ) {
						flt
						initlv = 50
						fixlv = FIX_QUALITY_UNIQUE
						characreate -1, CREATURE_ID_FAIRY, -3, 0
						cRelation(rc) = RELATION_NEUTRAL
						cOrgRelation(rc) = RELATION_NEUTRAL
						cSex(rc) = 1
						cPic(rc) = xy2pic(5, 15)
						cnName(rc) = lang("妖精の鍛冶士『ルージィ』", "<lurgy> the metallurgy fairy")
						cRole(rc) = MAX_ROLE_GUEST
						cInterest(rc) = 0
						faction(rc) = ""
						addfaction rc, "family,man"
						addfaction rc, "align,neutral"
						addfaction rc, "god,eyth"
						addfaction rc, "lurgy"
						break
					}
				}
				if ( gGuildTrainer != gMonth  | rnd(5) == 0 ) {
					if ( rnd(3) ) {
						characreate -1, CREATURE_ID_GUILD_TRAINER, -3, 0
						cRole(rc) = ROLE_GUEST_TRAINER
						break
					}
				}
				if ( rnd(10) == 0 ) {
					characreate -1, CREATURE_ID_MYSTERIOUS_PRODUCER, -3, 0
					cRole(rc) = ROLE_GUEST_PRODUCER
					break
				}
				if ( rnd(10) == 0 ) {
					characreate -1, CREATURE_ID_SHOPKEEPER, -3, 0
					cRole(rc) = ROLE_GUEST_MERCHANT
					cRoleShopLv(rc) = limit(cFame(CHARA_PLAYER) / 100, 10, 1000)
					break
				}
				if ( rnd(4) == 0 ) {
					characreate -1, CREATURE_ID_BEGGAR, -3, 0
					cRole(rc) = (2000 /*!!!@[ROLE_GUEST_BEGGAR @@@ ROLE_GUEST_MIN]@!!! */)
					cPortrait(rc) = -1
					break
				}
				if ( rnd(4) == 0 ) {
					characreate -1, CREATURE_ID_YOUNGER_SISTER, -3, 0
					cRole(rc) = ROLE_GUEST_SEX
					break
				}
				characreate -1, CREATURE_ID_CITIZEN, -3, 0
				cRole(rc) = ROLE_GUEST_CITIZEN
				break
			loop
			tc = rc
			cRelation(tc) = RELATION_NEUTRAL
			cOrgRelation(tc) = RELATION_NEUTRAL
			cbitmod CHARA_BIT_SUMMONED, tc, TRUE
		}
		cbitmod CHARA_BIT_EVENT_TALK, tc, TRUE
		i = 0
		flag = 0
		repeat 16 + 1
			if ( cnt == 0 ) {
				c = tc
			}
			else {
				c = cnt - 1
			}
			if ( cExist(c) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( gRider != 0 ) {
				if ( c == gRider ) {
					continue
				}
			}
			if ( ocPetBeingRiddenIdx(c) != 0 ) {
				continue
			}
			inv_getheader -1
			p = 0, 6
			repeat invrange, invhead
				if ( iNum(cnt) == 0 ) {
					continue
				}
				if ( iEffect(cnt) != EFFECT_CHAIR ) {
					continue
				}
				if ( c == tc ) {
					if ( iParam1(cnt) == 2 ) {
						cell_swap c, -1, iX(cnt), iY(cnt)
						i = cnt
						p = cnt
						break
					}
					else {
						continue
					}
				}
				if ( i == 0 ) {
					break
				}
				else {
					if ( cnt == i ) {
						continue
					}
				}
				if ( c == 0 ) {
					if ( iParam1(cnt) == 1 ) {
						p = cnt
						flag = 1
						break
					}
				}
				else {
					if ( flag ) {
						p(2) = dist(iX(cnt), iY(cnt), iX(i), iY(i))
						if ( p(2) < p(1) ) {
							if ( mapChara(iX(cnt), iY(cnt)) == 0 ) {
								p = cnt, p(2)
							}
						}
					}
				}
			loop
			if ( p != 0 ) {
				cell_swap c, -1, iX(p), iY(p)
			}
			cDir(c) = direction(cX(c), cY(c), cX(tc), cY(tc))
			if ( c == 0 ) {
				gRunDir = cDir(c)
			}
		loop
		gosub *chat
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 17 | _switch_sw ) {
		_switch_sw = 0
		i = 0
		repeat 244, 1
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( welcome_f != 1 ) {
				if ( cRole(cnt) != ROLE_ADVENTURER ) {
					if ( cRole(cnt) != ROLE_SPECIAL ) {
						if ( cRole(cnt) != ROLE_NONE | cRelation(cnt) == RELATION_NEUTRAL | cType(cnt) == gArea  ) {
							tc = cnt
							cEmoIcon(cnt) = 6 + 100 * 20
							txtef COLOR_SKY_BLUE
							ctalk cnt, 104, cnt, cnt
							if ( stat == 0 ) {
								i++
							}
						}
					}
				}
			}
			if ( cnt <= 15 ) {
				if ( ocPetJobSkill(cnt) == 185 ) {
					if ( getgametime() <= cRoleRestock(cnt) ) {
						continue
					}
					inv_find ITEM_ID_FISHING_POLE, cnt
					if ( stat == (-1) ) {
						continue
					}
					pole = stat
					angler = cnt
					ccbk = cc
					repeat rnd(getgametime() - cRoleRestock(angler))
						if ( rnd(15) ) {
							continue
						}
						if ( inv_getspace(angler) == 0 | inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), pole) == 0 ) {
							break
						}
						inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), pole)--
						ci = pole
						cc = angler
						gosub *label_4452
						if ( fishdata(FISHDATA_POWER, fish) >= rnd(sFishing(angler) + 1) ) {
							continue
						}
						gosub *get_fish
						r1 = 0
						if ( iID(ci) == ITEM_ID_FISH ) {
							r1 = fishdata(FISHDATA_POWER, iSubName(ci))
						}
						gosub *label_1606
					loop
					cc = ccbk
					cRoleRestock(angler) = getgametime() + 1
				}
				else {
					if ( ocPetJobSkill(cnt) == 184 ) {
						if ( getgametime() <= cRoleRestock(cnt) ) {
							continue
						}
						cooktool = -1
						cook = cnt
						isetheader = cook, -1
						repeat 2
							inv_getheader isetheader(cnt)
							repeat invrange, invhead
								if ( cooktool != (-1) ) {
									break
								}
								if ( iNum(cnt) <= 0 ) {
									continue
								}
								if ( iEffect(cnt) == EFFECT_COOKING ) {
									cooktool = cnt
								}
							loop
						loop
						if ( cooktool == (-1) ) {
							continue
						}
						ccbk = cc
						cibk = ci
						repeat rnd(getgametime() - cRoleRestock(cook)) * 2
							if ( rnd(15) ) {
								continue
							}
							if ( inv_getspace(cook) == 0 ) {
								break
							}
							ci = -1
							inv_getheader cook
							repeat invrange, invhead
								if ( iNum(cnt) <= 0 ) {
									continue
								}
								if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) == FILTER_ITEM_FOOD ) {
									if ( iParam2(cnt) != 0 ) {
										continue
									}
									ci = cnt
									break
								}
							loop
							if ( ci == (-1) ) {
								break
							}
							if ( cbit(CHARA_BIT_MARRIED, cook) == TRUE & implevel(cImpression(cook)) >= 8 & rnd(5) == 0 ) {
								ciref = ci
								flt
								itemcreate cook, ITEM_ID_SISTERS_LOVE_FUELED_LUNCH, -1, -1, 0
								iSubName(ci) = cId(cook)
								iStatus(ci) = iStatus(ciref)
								ibitmod ITEM_BIT_REMAKE, ci, ibit(ITEM_BIT_REMAKE, ciref)
								iParam4(ci) = iParam4(ciref)
								if ( iSubName(ci) == 343 ) {
									iCNpcId(ci) = cUNID(cook)
									ICNpcSerialNo(ci) = createserialno(userdatan(0, cUNID(cook)))
								}
								iNum(ciref)--
							}
							else {
								cc = cook
								gosub *label_4525
							}
						loop
						cc = ccbk
						ci = cibk
						cRoleRestock(cook) = getgametime() + 1
					}
				}
			}
		loop
		if ( welcome_f != 1 ) {
			repeat limit(i, 0, 3)
				txtef COLOR_SKY_BLUE
				if ( jp ) {
					txt -1, "「おかえり」", "「よう戻ったか」", "「無事で何よりです」", "「おかか♪」", "「待ってたよ」", "「おかえりなさい！」"
				}
				if ( en ) {
					txt -1, cnvtalk("Welcome home!"), cnvtalk("Hey, dear."), cnvtalk("You're back!"), cnvtalk("I was waiting for you."), cnvtalk("Nice to see you again.")
				}
			loop
		}
		tc = CHARA_PLAYER
		repeat 245
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cRole(cnt) == ROLE_MAID ) {
				tc = cnt
				break
			}
		loop
		if ( tc != CHARA_PLAYER ) {
			if ( cRoleRestock(tc) != 0 ) {
				if ( getgametime() >= cRoleRestock(tc) ) {
					gGuest += rnd(4)
					cRoleRestock(tc) = 0
				}
			}
			if ( cfg_guest == 0 ) {
				if ( gGuest != 0 ) {
					gosub *chat
				}
			}
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 21 | _switch_sw ) {
		_switch_sw = 0
		if ( mType == MAP_TYPE_WORLD ) {
			goto *label_4254
		}
		throwsstpevent "NukeExploded", 0, "", 0
		txtef COLOR_RED
		txt -1, lang(" *ゴゴゴゴゴゴ* ", "* RRROOM-KABOOOOM*")
		msg_halt
		gsel BUFFER_PIC
		pos 0, 0
		picload_ exedir + "graphic\\bg22.bmp"
		gsel BUFFER_BUF
		pos windoww / 2 - 1, windowh / 2 - 1
		gmode 0, 640, 480
		grotate BUFFER_PIC, 0, 0, 0, windoww + 4, windowh + 4
		gsel BUFFER_PIC
		picload_ exedir + "graphic\\anime9.bmp"
		gsel BUFFER_SCREEN
		dx = windoww / 2
		dy = (windowh - inf_verh) / 2
		p = 0, 0, 0, 0, 0
		color 0, 0, 0
		repeat 40
			if ( cnt == 14 ) {
				snd SOUNDLIST_ATK_FIRE
			}
			redraw 0
			color 0, 0, 0
			if ( cnt < 16 ) {
				pos 0, 0
			}
			else {
				pos 5 - rnd(10), 5 - rnd(10)
			}
			gmode 0
			gcopy BUFFER_BUF, 0, 0, windoww, windowh
			if ( cnt > 8 ) {
				p--
			}
			else {
				p++
			}
			gmode 4, 192, 48, 255 - p * 5
			pos dx, dy
			grotate BUFFER_PIC, cnt / 2 \ 2 * 192, 408, 0, limit(p * 32, 0, 192), limit(p * 8, 0, 48)
			if ( cnt > 14 ) {
				p(1)++
			}
			else {
				if ( cnt < 12 ) {
					p(1) = cnt / 2 \ 2
				}
				else {
					if ( cnt >= 12 ) {
						p(1) = cnt \ 3
					}
				}
			}
			gmode 2, 96, 48
			pos dx, dy - limit(cnt * 3 / 2, 0, 18) - 16
			grotate BUFFER_PIC, p(1) * 96, 288, 0, limit(cnt * 12, 0, 144), limit(cnt * 6, 0, 72)
			if ( cnt > 4 ) {
				p(2)++
				p(3)++
			}
			gmode 4, 96, 96, limit(p(2) * 6, 0, 100)
			pos dx, dy - limit(p(2) * 2, 0, 40)
			grotate BUFFER_PIC, 0, 0, 0, limit(p(2) * 8, 0, 240), limit(p(2) * 5, 0, 96)
			gmode 4, 96, 96, p(3) * 10
			pos dx, dy - limit(p(3) * 2, 0, 160) - 6
			grotate BUFFER_PIC, 96, 0, 0, limit(p(3) * 10, 0, 96), limit(p(3) * 10, 0, 96)
			gmode 4, 192, 80, limit(p(3) * 5, 0, 100)
			pos dx, dy - 4
			grotate BUFFER_PIC, cnt / 4 \ 2 * 192, 96, 0, limit(p(2) * 8, 0, 400), limit(p(2), 0, 48)
			gmode 4, 192, 96, p(3) * 10
			pos dx, dy - 48 - limit(p(3) * 2, 0, 148)
			grotate BUFFER_PIC, cnt / 3 \ 2 * 192, 96, 0, 192, 96
			redraw 1
			await cfg_animewait + 50
		loop
		gmode 2
		gosub *screen_refreshFull
		tlocx = evdata1(evnum - (evnum != 0) * 1)
		tlocy = evdata2(evnum - (evnum != 0) * 1)
		if ( ogTitleFelixHoenikker == 2 ) {
			range = 51
		}
		else {
			range = 31
		}
		ele = SKILL_RES_CHAOS
		aniref = range
		animeid = ANIMATION_BALL_NUKE
		anix = tlocx
		aniy = tlocy
		gosub *anime
		gosub *screen_draw
		repeat range * 2 + 1
			dy = tlocy - range + cnt
			if ( dy < 0 | dy >= mHeight ) {
				continue
			}
			repeat range * 2 + 1
				dx = tlocx - range + cnt
				if ( dx < 0 | dx >= mWidth ) {
					continue
				}
				if ( dist(tlocx, tlocy, dx, dy) > range ) {
					continue
				}
				f = 0
				if ( chipm(CHIPM_ATTRIB, mapId(dx, dy)) & CHIPM_ATTRIB_CANT_PASS ) {
					f = 1
				}
				if ( rnd(4) | f == 1 ) {
					mapId(dx, dy) = xy2pic(4, 1)
				}
				if ( rnd(10) == 0 | f == 1 ) {
					addmef dx, dy, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50
				}
				if ( mapChara(dx, dy) != 0 ) {
					tc = mapChara(dx, dy) - 1
					dmg = 1000 + (ogTitleFelixHoenikker == 2) * ogTimesUsedNuke * 5
					dmghp tc, dmg, DAMAGE_FROM_NUKE
				}
				mapitem_fire dx, dy
			loop
		loop
		if ( evdata1(evnum - (evnum != 0) * 1) == 33 ) {
			if ( evdata2(evnum - (evnum != 0) * 1) == 16 ) {
				if ( gArea  == AREA_PALMIA ) {
					if ( sqNuke == 1 ) {
						sqNuke = 2
						snd SOUNDLIST_WRITE1
						txtef COLOR_GREEN
						txt -1, lang("ジャーナルが更新された。", "Your journal has been updated.")
					}
				}
			}
		}
		if ( mType == MAP_TYPE_TOWN | mType == MAP_TYPE_VILLAGE ) {
			modkarma 0, (-80) + gettrait(0, 162) * 60
		}
		else {
			modkarma 0, -10
		}
		ogTimesUsedNuke++
		gosub *label_2665
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 18 | _switch_sw ) {
		_switch_sw = 0
		if ( mType == MAP_TYPE_WORLD ) {
			goto *label_4254
		}
		if ( gMonth  \ 3 != 0 & gLastEther != gMonth  ) {
			gLastEther = gMonth 
		}
		gWeather = WEATHER_ETHER
		envonly = 1
		gosub *music_play
		txt -1, lang("終末の日が訪れた。", "Let's Ragnarok!")
		if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
			msg_halt
		}
		animeid = ANIMATION_RAGNA
		gosub *anime
		repeat 200
			repeat 2
				x = rnd(mWidth)
				y = rnd(mHeight)
				mapId(x, y) = xy2pic(4, 1)
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight | rnd(5) == 0 ) {
				x = rnd(mWidth)
				y = rnd(mHeight)
			}
			addmef x, y, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
			mapitem_fire x, y
			if ( cnt \ 4 == 0 ) {
				flt 100, calcfixlv(FIX_QUALITY_GREAT)
				if ( rnd(4) ) {
					fltnrace = "dragon"
				}
				else {
					fltnrace = "giant"
				}
				characreate -1, CREATURE_ID_BUG, x, y
				if ( stat != 0 ) {
					cbitmod CHARA_BIT_SUMMONED, rc, TRUE
				}
			}
			if ( cnt \ 7 == 0 ) {
				if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
					gosub *screen_draw
				}
				if ( rnd(7) ) {
					snd SOUNDLIST_FIRE1
				}
				else {
					snd SOUNDLIST_CRUSH1
				}
				if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
					await 25
				}
			}
		loop
		throwsstpevent "Ragnarok", evdata1(evnum - (evnum != 0) * 1), "", 0
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 22 | _switch_sw ) {
		_switch_sw = 0
		if ( evdata1(evnum - (evnum != 0) * 1) == 0 ) {
			txtef COLOR_RED
			txt -1, lang("けたたましい警報が鳴り響いた！", "*beeeeeep!* An alarm sounds loudly!")
			repeat 188, 57
				if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
					cRelation(cnt) = RELATION_ENEMY
					lockon cnt, 0, 29
					cAiAggro(cnt) = 250
				}
			loop
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 26 | _switch_sw ) {
		_switch_sw = 0
		if ( mType != MAP_TYPE_WORLD ) {
			txt -1, lang("強盗があなたに目をつけた！", "Blaggers pick on you!")
			repeat 3
				flt
				initlv = difficulty()
				characreate -1, CREATURE_ID_ROBBER, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
			loop
		}
		goto *label_4254
	}
	if ( _switch_val == 100 | _switch_sw ) {
		_switch_sw = 0
		gosub *screen_draw
		s = lang("妹との再会", "Reunion with your younger sister")
		file = "bg_re13"
		buff = lang("あなたは懐かしい声に気付いて、ふと歩みを止めた。なんと、生き別れたあなたの妹が、嬉しそうに走ってくる！あなたの妹は…", "You notice a familiar call and stop walking. Your younger sister who has separated from you since birth is now running towards you joyfully! Your sister is...")
		listmax = 0
		list(0, listmax) = 1
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		list(0, listmax) = 2
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		list(0, listmax) = 3
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		list(0, listmax) = 4
		listn(0, listmax) = lang("妹だ！", "a younger sister!")
		listmax++
		gosub *label_2485
		p = 176
		flt
		initlv = cLevel(CHARA_PLAYER) * 2 / 3 + 1
		novoidlv = 1
		characreate -1, p, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		gosub *cm_race_loop_WHILE1
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 101 | _switch_sw ) {
		_switch_sw = 0
		if ( mType == MAP_TYPE_WORLD ) {
			goto *label_4254
		}
		envonly = 1
		gosub *music_play
		txt -1, lang("妹の日が訪れた。", "Younger sisters are here! Let's party!")
		if ( evdata2(evnum - (evnum != 0) * 1) == 0 ) {
			if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
				msg_halt
			}
		}
		animeid = ANIMATION_RAGNA
		gosub *anime
		repeat 200
			repeat 2
				x = rnd(mWidth)
				y = rnd(mHeight)
				mapId(x, y) = xy2pic(4, 1)
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight | rnd(5) == 0 ) {
				x = rnd(mWidth)
				y = rnd(mHeight)
			}
			addmef x, y, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
			mapitem_fire x, y
			if ( cnt \ 4 == 0 ) {
				if ( rnd(3) != 0 ) {
					flt 100, calcfixlv(FIX_QUALITY_GREAT)
					characreate -1, CREATURE_ID_YOUNGER_SISTER, x, y
					if ( stat != 0 ) {
						cbitmod CHARA_BIT_SUMMONED, rc, TRUE
						if ( evdata2(evnum - (evnum != 0) * 1) == 1 ) {
							cRole(rc) = ROLE_SHOP_GUARD
						}
						if ( rnd(3) == 0 ) {
							p = rnd(18) + 2
							if ( p == 12 ) {
								ocbitmod 1, rc, 1
							}
							else {
								cPic(rc) += p * 1000
							}
						}
						if ( rnd(4) == 0 ) {
							repeat 10000
								p = rnd(19) + 1
								if ( lightdata(LIGHTDATA_Y, p) < 24 ) {
									ocLight(rc) = p
									break
								}
							loop
						}
						if ( rnd(20) == 0 ) {
							ocbitmod 1, rc, 1
						}
					}
				}
				else {
					flt 100, calcfixlv(FIX_QUALITY_GREAT)
					if ( gArea  != AREA_VOID ) {
						if ( evdata2(evnum - (evnum != 0) * 1) == 1 ) {
							initlv = difficulty() * 2
						}
						else {
							initlv = cLevel(evdata1(evnum - (evnum != 0) * 1)) * 2 / 3 + 1
						}
					}
					characreate -1, CREATURE_ID_YOUNGER_SISTER, x, y
					if ( stat != 0 ) {
						cbitmod CHARA_BIT_SUMMONED, rc, TRUE
						cPic(rc) = xy2pic(22, 8)
						if ( evdata2(evnum - (evnum != 0) * 1) == 1 ) {
							cRole(rc) = ROLE_SHOP_GUARD
						}
						if ( rnd(3) == 0 ) {
							p = rnd(18) + 2
							if ( p == 12 ) {
								ocbitmod 1, rc, 1
							}
							else {
								cPic(rc) += p * 1000
							}
						}
						if ( rnd(4) == 0 ) {
							repeat 10000
								p = rnd(19) + 1
								if ( lightdata(LIGHTDATA_Y, p) >= 24 & lightdata(LIGHTDATA_Y, p) < 48 ) {
									ocLight(rc) = p
									break
								}
							loop
						}
						if ( rnd(20) == 0 ) {
							ocbitmod 1, rc, 1
						}
					}
				}
			}
			if ( cnt \ 7 == 0 ) {
				if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
					gosub *screen_draw
				}
				if ( rnd(7) ) {
					snd SOUNDLIST_FIRE1
				}
				else {
					snd SOUNDLIST_CRUSH1
				}
				if ( (GetKeyState(145) | cfg_animewait == 0) == 0 ) {
					await 25
				}
			}
			repeat 2
				txtef COLOR_SKY_BLUE
				if ( jp ) {
					txt -1, "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃんー」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃん！」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃ〜ん」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃんっ」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃん？」", "「" + _onii(cSex(CHARA_PLAYER)) + "〜ちゃん」", "「" + _onii(cSex(CHARA_PLAYER)) + "ちゃん♪」"
				}
				else {
					txt -1, "\"" + _onii(cSex(CHARA_PLAYER)) + "chan-\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan!\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chaa~n\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan?\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "~chan\"", "\"" + _onii(cSex(CHARA_PLAYER)) + "chan♪\""
				}
			loop
		loop
		if ( evdata2(evnum - (evnum != 0) * 1) == 1 ) {
			gohostile
		}
		throwsstpevent "SisterRagnarok", evdata1(evnum - (evnum != 0) * 1), "", 0
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 102 | _switch_sw ) {
		_switch_sw = 0
		p(99) = 0
		flt calcobjlv(gLevel ), FIX_QUALITY_BAD
		initlv = evdata1(evnum - (evnum != 0) * 1)
		if ( rnd(15) == 0 ) {
			p(99) = rnd(2) + 3
			initlv = initlv * p(99) / 2
		}
		novoidlv = 1
		if ( rnd(30) == 0 ) {
			p = 176
		}
		else {
			p = 21
		}
		characreate -1, p, evdata2(evnum - (evnum != 0) * 1) \ 1000000 / 1000, evdata2(evnum - (evnum != 0) * 1) \ 1000
		if ( stat != 0 ) {
			cc = evdata2(evnum - (evnum != 0) * 1) / 1000000
			cOrgRelation(rc) = cRelation(cc)
			cRelation(rc) = cOrgRelation(rc)
			if ( p(99) ) {
				cPic(rc) += 3 * 1000
			}
			if ( getfactionvalue(cc, "pet") != "" ) {
				addfaction rc, "pet," + refstr
			}
			else {
				addfaction rc, "pet," + cc
			}
			repeat 245
				if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( ocHostileTargetTotal(cnt) == 0 ) {
					continue
				}
				unlockon cnt, rc
			loop
			txtef COLOR_BLUE
			if ( cId(rc) == CREATURE_ID_ZOMBIE ) {
				txt -1, lang("死者はゾンビになった。", "The dead reanimates as a zombie.")
			}
			else {
				txt -1, lang("死者は妹になった。", "The dead reanimates as a younger sister.")
			}
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 103 | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_LITTLE_GIRL, 6)
		gosub *chat
		gMapEvent = 23
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 104 | _switch_sw ) {
		_switch_sw = 0
		repeat 15
			item_find FILTER_CARGO_TRADE, ITEM_FIND_MODE_TYPE, ITEM_FIND_LOCATION_CHARAS
			if ( stat != (-1) ) {
				ci = stat
				txt -1, lang(itemname(ci) + "は破損して売り物にならなくなった。", itemname(ci) + " has been damaged beyond recognition and is nwo worthless.")
				removeitem ci, iNum(ci)
			}
			else {
				break
			}
		loop
		autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
		if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
			autosave = 0
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 105 | _switch_sw ) {
		_switch_sw = 0
		repeat 229, 16
			dup roopbuf, cExist(cnt)
			if ( roopbuf != 2 ) {
				if ( roopbuf != 1 ) {
					continue
				}
			}
			if ( cId(cnt) == CREATURE_ID_YOUNG_LADY ) {
				if ( cQuality(cnt) != FIX_QUALITY_UNIQUE ) {
					continue
				}
				tc = cnt
				break
			}
			if ( cId(cnt) == CREATURE_ID_YOUNGER_SISTER ) {
				cQuality(cnt) = FIX_QUALITY_GODLY
				tc = cnt
				break
			}
		loop
		gosub *chat
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 106 | _switch_sw ) {
		_switch_sw = 0
		cc = CHARA_PLAYER
		gosub *label_1670
		if ( stat == 1 ) {
			tc = cc
			efid = SKILL_SPELL_SENSE_OBJECT
			lint_efp = sDetection(cc) * 15 + 20 + sPER(cc)
			efp = limitmax(lint_efp, 2147483647)
			gosub *label_3383
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 107 | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_YOUNGER_CAT_SISTER, 6)
		gosub *chat
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 108 | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_RED
		txt -1, lang("襲撃だ！", "Ambush!")
		repeat 188, 57
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			s = getfactionvalue(cnt, "guild")
			if ( s == "" ) {
				continue
			}
			if ( getfactionvalue(0, "guild") == s ) {
				continue
			}
			cRelation(cnt) = RELATION_ENEMY
			cOrgRelation(cnt) = RELATION_ENEMY
			cAiAggro(cnt) = 250
		loop
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 109 | _switch_sw ) {
		_switch_sw = 0
		if ( mType == MAP_TYPE_WORLD ) {
			goto *label_4254
		}
		envonly = 1
		gosub *music_play
		txt -1, lang("あなたは神の怒りに触れた！", "Gods got furious!")
		if ( evdata2(evnum - (evnum != 0) * 1) == 0 ) {
			msg_halt
		}
		animeid = ANIMATION_RAGNA
		gosub *anime
		locvar_getnpctxt_ragnarokflag = 1
		repeat 200
			repeat 2
				x = rnd(mWidth)
				y = rnd(mHeight)
				mapId(x, y) = xy2pic(4, 1)
			loop
			x = rnd(inf_screenw) + scx
			y = rnd(inf_screenh) + scy
			if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight | rnd(5) == 0 ) {
				x = rnd(mWidth)
				y = rnd(mHeight)
			}
			addmef x, y, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50, evdata1(evnum - (evnum != 0) * 1)
			mapitem_fire x, y
			if ( cnt \ 4 == 0 ) {
				flt 100, calcfixlv(FIX_QUALITY_GREAT)
				gosub *label_4611
				initlv = 100
				characreate -1, dbid, x, y
				if ( stat != 0 ) {
					gosub *label_4551
					cbitmod CHARA_BIT_SUMMONED, rc, TRUE
					cbitmod CHARA_BIT_PRECIOUS, rc, TRUE
					if ( evdata2(evnum - (evnum != 0) * 1) == 1 ) {
						cRole(rc) = ROLE_SHOP_GUARD
					}
				}
			}
			if ( cnt \ 7 == 0 ) {
				gosub *screen_draw
				if ( rnd(7) ) {
					snd SOUNDLIST_FIRE1
				}
				else {
					snd SOUNDLIST_CRUSH1
				}
				await 25
			}
		loop
		locvar_getnpctxt_ragnarokflag = 0
		if ( evdata2(evnum - (evnum != 0) * 1) == 1 ) {
			gohostile
		}
		goto *label_4254
		_switch_sw++
	}
	if ( _switch_val == 110 | _switch_sw ) {
		_switch_sw = 0
		tc = findchara(CREATURE_ID_BLACK_ANGEL, 6)
		gosub *chat
		goto *label_4254
	}
	if ( _switch_val == 2402 | _switch_sw ) {
		_switch_sw = 0
		tc = evdata1(evnum - (evnum != 0) * 1)
		txtef COLOR_PURPLE
		txt -1, lang(godname(godcheck(tc)) + "は激怒した。", godname(godcheck(tc)) + " is enraged.")
		redraw 1
		efid = SKILL_SPACT_PUNISHMENT
		efp = 10000
		gosub *label_3383
		goto *label_4254
	}
	if ( _switch_val == 2403 | _switch_sw ) {
		_switch_sw = 0
		tc = evdata1(evnum - (evnum != 0) * 1)
		txtef COLOR_GREEN
		txt -1, lang(name(tc) + "は" + godname(godcheck(tc)) + "の暖かい眼差しを感じた。", name(tc) + " feel" + _s(tc) + " as if " + godname(godcheck(tc)) + " is watching you.")
		if ( isgodtxtfile ) {
			cPray(tc) += 1 * 7
			modpiety 1, tc
		}
		else {
			cPray(tc) += 500
			modpiety 75, tc
		}
		goto *label_4254
	}
	if ( _switch_val == 2404 | _switch_sw ) {
		_switch_sw = 0
		tc = evdata1(evnum - (evnum != 0) * 1)
		txt -1, lang("" + godname(godcheck(tc)) + "は" + name(tc) + "の信仰に疑問を抱いた。", cnven(godname(godcheck(tc))) + " doubts " + name(tc) + your(tc) + " faith.")
		cPiety(tc) = cPiety(tc) * 85 / 100
		cPray(tc) = 0
		goto *label_4254
	}

*label_4254
	return
	return
	return

*label_4255
	gosub *label_4257
	if ( stat == 0 ) {
		return
	}
	q = refstr
	gosub *label_4258
	inititemid = finditemid(q)
	txt -1, lang("カスタムアイテムを作成した！", "You created a custom item!")
	flt
	itemcreate -1, ITEM_ID_CARNEADES_PLANK, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	repeat 5480
		if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
			getitemid cnt
		}
	loop
	gosub *del_userTemp
	return

*label_4257
	fread = 0
	cun = useritemmax
	txt -1, lang("どのファイルからアイテムを作成する？", "Use which file to create item?")
	redraw 1
	fileext = "txt"
	filedsc = "Custom Item Text"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if ( stat == 0 ) {
		return 0
	}
	txtfile = refstr
	exist txtfile
	useritemdata(1, cun) = strsize
	sdim txtbuff, strsize + 1
	bload txtfile, txtbuff
	if ( instr(txtbuff, 0, "%Elona Custom Item") == (-1) ) {
		txt -1, "Invalid File. Aborting."
		return 0
	}
	txt -1, lang("どの画像を埋め込む？", "Embed which picture?")
	redraw 1
	fileext = "bmp"
	filedsc = "Bit Map File"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if ( stat == 0 ) {
		return 0
	}
	bmpfile = refstr
	exist bmpfile
	if ( strsize > 30000 ) {
		txt -1, "The file size must be lower than 30KB. Aborting."
		return 0
	}
	useritemdata(0, cun) = strsize
	dim bmpbuff, strsize
	bload bmpfile, bmpbuff
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\item1.t", 1, 3
		zWrite useritemdata(0, cun), hgz, 75 * 4
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\item1.t", 0
		zRead useritemdata(0, cun), hgz, 75 * 4
		zClose hgz
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\item2.t", 1, 3
		zWrite bmpbuff, hgz, useritemdata(0, cun)
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\item2.t", 0
		zRead bmpbuff, hgz, useritemdata(0, cun)
		zClose hgz
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\item3.t", 1, 3
		zWrite txtbuff, hgz, useritemdata(1, cun)
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\item3.t", 0
		zRead txtbuff, hgz, useritemdata(1, cun)
		zClose hgz
	}
	s = getnpctxt_nc("name.", "unknown,unknown")
	csvstr2 s, s
	cnv_filestr s
	if ( instr(s, 0, "_tmp_") != (-1) ) {
		dialog "The name contains an invalid word \"_tmp_\""
		return 0
	}
	if ( peek(s) >= 65 & peek(s) <= 90 | peek(s) == 95 | (peek(s) >= 97 & peek(s) <= 122) ) {
	}
	else {
		dialog "The first letter of the name must be alphabetic."
		return 0
	}
	if ( strlen(s) >= 64 | strlen(s(1)) >= 64 ) {
		dialog "The name is too long."
		return 0
	}
	zipinit2 exedir + "user\\", s + ".item"
	zipadd2 "item1.t"
	zipadd2 "item2.t"
	zipadd2 "item3.t"
	zipend2
	mref _refstr, 65
	_refstr = s
	return 1

*label_4258
	useritemmax = 0
	getuserfiledata "item", useritemmax
	getuserfiledata "ooitem", useritemmax
	procid = (procid + 1) \ 10
	proclist(procid) = "[Custom Item] " + useritemmax + " citems detected." + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( useritemmax > 3000 ) {
		useritemmax = 3000
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Item] The upper limit of the number of citems is " + useritemmax + ". The rest won't be loaded." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
	}
	dim useritemdata, 75, useritemmax + 1
	sdim useritemdatan, 40, 10, useritemmax + 1
	sdim useritemtxt, 80 * 50, 4, useritemmax + 1
	sdim untaglistitem
	dim useritemencprocref, 7, 10, useritemmax + 1
	dim useritemmatval, 5, useritemmaxbuffer
	dim useritemmatneed, 12, useritemmaxbuffer
	sdim useritemmatfaith, 40, useritemmaxbuffer
	ogCustomItemCount = 0
	buffer 30, 33 * 48, (useritemmax / 33 + 1) * 96
	boxf
	gmode 0
	tg = 0
	repeat useritemmax
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Item] Load: dir=" + userfilelist(1, cnt) + ", file=" + userfilelist(0, cnt) + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		cnt2 = tg
		unzip2 userfilelist(1, cnt), userfilelist(0, cnt)
		zOpen hgz, userfilelist(1, cnt) + "item1.t", 0
		zRead useritemdata(0, tg), hgz, 75 * 4
		zClose hgz
		dim bmpbuff, useritemdata(0, tg)
		zOpen hgz, userfilelist(1, cnt) + "item2.t", 0
		zRead bmpbuff, hgz, useritemdata(0, tg)
		zClose hgz
		sdim txtbuff, useritemdata(1, tg) + 1
		zOpen hgz, userfilelist(1, cnt) + "item3.t", 0
		zRead txtbuff, hgz, useritemdata(1, tg)
		zClose hgz
		cleanuserdir userfilelist(1, cnt)
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom Item] Load item definition." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		useritemdatan(0, tg) = s
		useritemdatan(1, tg) = s(jp)
		s = userfilelist(0, cnt)
		useritemdatan(6, tg) = s
		if ( instr(untaglistitem, 0, "/" + useritemdatan(0, tg) + "/") != (-1) ) {
			useritemmax--
			if ( instr(s, 0, "_tmp_") == (-1) ) {
				msgtemp += lang("同名アイテムは読み込まれない。", "An item of the same name has already been defined.") + "(skipped:" + useritemdatan(0, tg) + "," + s + ") "
			}
			continue
		}
		untaglistitem += "/" + useritemdatan(0, tg) + "/"
		if ( instr(s, 0, "_tmp_") != (-1) ) {
			ogCustomItemCount++
		}
		useritemdatan(2, tg) = getnpctxt_nc("ialphanameref.", "")
		useritemdatan(3, tg) = getnpctxt_nc("ifilterref.", "")
		useritemdatan(4, tg) = getnpctxt_nc("iknownnameref.", useritemdatan(1, tg))
		if ( en ) {
			useritemdatan(4, tg) = getnpctxt_nc("iknownnameref_en.", useritemdatan(4, tg))
		}
		useritemdatan(5, tg) = getnpctxt_nc("author.", lang("プレイヤー", "a player"))
		if ( en ) {
			useritemdatan(5, tg) = getnpctxt_nc("author_en.", useritemdatan(5, tg))
		}
		useritemdatan(7, tg) = getnpctxt_nc("isnd.", "")
		useritemdatan(8, tg) = getnpctxt_nc("icounterword.", "")
		useritemdata(2, tg) = int(getnpctxt_nc("iorgvalue.", "5000"))
		useritemdata(3, tg) = int(getnpctxt_nc("iorgweight.", "3000"))
		useritemdata(4, tg) = int(getnpctxt_nc("dicex.", "0"))
		useritemdata(5, tg) = int(getnpctxt_nc("dicey.", "0"))
		useritemdata(6, tg) = int(getnpctxt_nc("fixdamage.", "0"))
		useritemdata(7, tg) = int(getnpctxt_nc("fixhit.", "0"))
		useritemdata(8, tg) = int(getnpctxt_nc("dodgevalue.", "0"))
		useritemdata(9, tg) = int(getnpctxt_nc("protectvalue.", "0"))
		useritemdata(10, tg) = int(getnpctxt_nc("relaskill.", "0"))
		useritemdata(11, tg) = int(getnpctxt_nc("material.", "0"))
		useritemdata(12, tg) = int(getnpctxt_nc("identifydef.", "0"))
		useritemdata(13, tg) = int(getnpctxt_nc("ilight.", "0"))
		useritemdata(14, tg) = int(getnpctxt_nc("reftype.", "60000"))
		useritemdata(15, tg) = int(getnpctxt_nc("reftypeminor.", "0"))
		useritemdata(16, tg) = int(getnpctxt_nc("ibitvaluable.", "0"))
		useritemdata(17, tg) = int(getnpctxt_nc("objlv.", "10"))
		useritemdata(18, tg) = limit(int(getnpctxt_nc("fixlv.", "2")), 0, 6)
		useritemdata(19, tg) = int(getnpctxt_nc("givegod.", "-1"))
		repeat 9
			s = getnpctxt_nc("fixenc" + cnt + ".", "0,0")
			csvstr2 s, s
			useritemdata(20 + cnt * 2, tg) = int(s)
			useritemdata(20 + cnt * 2 + 1, tg) = int(s(1))
			s = getnpctxt_nc("fixenc" + cnt + "invoke.", "0,0,0,0,0,0")
			csvstr2 s, s
			sid = int(s)
			if ( sid < 400 ) {
				continue
			}
			useritemencprocref(0, cnt, tg) = useritemdata(20 + cnt * 2, tg), sid, int(s(1)), int(s(2)), int(s(3)), int(s(4)), limit(int(s(5)), 0, 90)
		loop
		useritemdata(38, tg) = int(getnpctxt_nc("icolref.", "0"))
		useritemdata(39, tg) = tg
		useritemdata(40, tg) = int(getnpctxt_nc("isetpos.", "0"))
		useritemdata(41, tg) = int(getnpctxt_nc("ipilepos.", "8"))
		useritemdata(42, tg) = int(getnpctxt_nc("idropshadow.", "40"))
		useritemdata(43, tg) = int(getnpctxt_nc("irare.", "1000"))
		useritemdata(44, tg) = int(getnpctxt_nc("ipierce.", "0"))
		s = getnpctxt_nc("irangepow.", "100, 20, 20, 20, 20, 20, 20, 20, 20, 20")
		csvstr2 s, s
		repeat 10
			useritemdata(45 + cnt, tg) = int(s(cnt))
		loop
		s = getnpctxt_nc("irangehit.", "100, 20, 20, 20, 20, 20, 20, 20, 20, 20")
		csvstr2 s, s
		repeat 10
			useritemdata(55 + cnt, tg) = int(s(cnt))
		loop
		useritemdata(65, tg) = int(getnpctxt_nc("inameonly.", "0"))
		useritemdata(66, tg) = int(getnpctxt_nc("ieffect.", "0"))
		useritemdata(67, tg) = int(getnpctxt_nc("cargoitem.", "0"))
		repeat 3, 1
			useritemdata(67 + cnt, tg) = int(getnpctxt_nc("isub" + cnt + ".", "0"))
		loop
		useritemdata(71, tg) = int(getnpctxt_nc("ispawnType.", "0"))
		useritemdata(72, tg) = int(getnpctxt_nc("drinkable.", "0"))
		useritemdata(73, tg) = int(getnpctxt_nc("drinkefid.", "0"))
		useritemdata(74, tg) = int(getnpctxt_nc("drinkefp.", "0"))
		s = getnpctxt_nc("matval.", "0,0,0,0,0")
		csvstr2 s, s
		repeat 5
			useritemmatval(cnt, tg) = int(s(cnt))
		loop
		s = getnpctxt_nc("matneed.", "-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1")
		csvstr2 s, s
		repeat 12
			useritemmatneed(cnt, tg) = int(s(cnt))
			if ( cnt \ 2 == 1 & useritemmatneed(cnt, tg) <= 0 ) {
				useritemmatneed(cnt - 1, tg) = -1
				useritemmatneed(cnt, tg) = -1
			}
		loop
		useritemmatfaith(tg) = getnpctxt_nc("matfaith.", "")
		p = instr(txtbuff, 0, "%txt")
		txtbuff = strmid(txtbuff, p, instr(txtbuff, 0, "%endTxt") - p + 7)
		repeat 4
			if ( jp ) {
				hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",JP")
				if ( hajime == (-1) ) {
					hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",EN")
				}
			}
			else {
				hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",EN")
				if ( hajime == (-1) ) {
					hajime = instr(txtbuff, 0, "%txtdescription" + cnt + ",JP")
				}
			}
			useritemtxt(cnt, tg) = strmid(txtbuff, hajime, instr(txtbuff, hajime + 1, "%"))
			notesel useritemtxt(cnt, tg)
			notedel 0
			if ( instr(useritemtxt(cnt, tg), 0, "nodescription") != (-1) ) {
				useritemtxt(cnt, tg) = ""
			}
		loop
		gsel BUFFER_PIC2
		file = exedir + "user\\graphic\\citem_" + useritemdatan(0, tg) + ".bmp"
		exist file
		if ( strsize != (-1) ) {
			picload_ file
		}
		else {
			memfile bmpbuff
			picload_ "MEM:temp.bmp"
		}
		if ( ginfo(13) > 50 ) {
			chipi(CHIPI_X, 33 * 25 * 2 + tg) = tg \ 33 * inf_tiles, tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles * 2, inf_tiles + useritemdata(40, tg), useritemdata(41, tg), useritemdata(42, tg)
		}
		else {
			chipi(CHIPI_X, 33 * 25 * 2 + tg) = tg \ 33 * inf_tiles, tg / 33 * inf_tiles * 2, inf_tiles, inf_tiles, useritemdata(40, tg), useritemdata(41, tg), useritemdata(42, tg)
		}
		gsel 30
		pos tg \ 33 * 48, tg / 33 * 96
		gcopy BUFFER_PIC2, 0, 0, 48, 96
		tg++
	loop
	gsel 30
	chipi(CHIPI_X, 33 * 25 * 2 + useritemmax) = useritemmax \ 33 * inf_tiles, useritemmax / 33 * inf_tiles * 2, inf_tiles, inf_tiles, 0, 0, 0
	color 250, 250, 250
	boxf useritemmax \ 33 * 48, useritemmax / 33 * 96, useritemmax \ 33 * 48 + 48, useritemmax / 33 * 96 + 48
	useritemdatan(0, useritemmax) = ""
	useritemdatan(1, useritemmax) = "残りカス"
	useritemdatan(2, useritemmax) = ""
	useritemdatan(3, useritemmax) = ""
	useritemdatan(4, useritemmax) = "残りカス"
	useritemdatan(5, useritemmax) = "プレイヤー"
	useritemdata(2, useritemmax) = 0
	useritemdata(3, useritemmax) = 0
	useritemdata(4, useritemmax) = 0
	useritemdata(5, useritemmax) = 0
	useritemdata(6, useritemmax) = 0
	useritemdata(7, useritemmax) = 0
	useritemdata(8, useritemmax) = 0
	useritemdata(9, useritemmax) = 0
	useritemdata(10, useritemmax) = 0
	useritemdata(11, useritemmax) = 0
	useritemdata(12, useritemmax) = 0
	useritemdata(13, useritemmax) = 0
	useritemdata(14, useritemmax) = 60000
	useritemdata(15, useritemmax) = 0
	useritemdata(16, useritemmax) = 0
	useritemdata(17, useritemmax) = 10
	useritemdata(18, useritemmax) = 2
	useritemdata(19, useritemmax) = -1
	repeat 9
		useritemdata(20 + cnt * 2, useritemmax) = 0
		useritemdata(20 + cnt * 2 + 1, useritemmax) = 0
	loop
	useritemdata(38, useritemmax) = 0
	useritemdata(39, useritemmax) = useritemmax
	useritemdata(40, useritemmax) = 0
	useritemdata(41, useritemmax) = 8
	useritemdata(42, useritemmax) = 40
	useritemdata(43, useritemmax) = 1000
	useritemdata(44, useritemmax) = 0
	s = "100, 20, 20, 20, 20, 20, 20, 20, 20, 20"
	csvstr2 s, s
	repeat 10
		useritemdata(45 + cnt, useritemmax) = int(s(cnt))
	loop
	s = "100, 20, 20, 20, 20, 20, 20, 20, 20, 20"
	csvstr2 s, s
	repeat 10
		useritemdata(55 + cnt, useritemmax) = int(s(cnt))
	loop
	useritemdata(65, useritemmax) = 0
	useritemdata(66, useritemmax) = 0
	useritemdata(67, useritemmax) = 0
	useritemdata(68, useritemmax) = 0
	useritemdata(69, useritemmax) = 0
	useritemdata(70, useritemmax) = 0
	useritemdata(71, useritemmax) = 0
	useritemdata(72, useritemmax) = 0
	useritemdata(73, useritemmax) = 0
	useritemdata(74, useritemmax) = 0
	repeat 4
		useritemtxt(cnt, useritemmax) = ""
	loop
	gosub *label_4271
	gsel BUFFER_SCREEN
	return

*label_4271
	dirlist buff, exedir + "user\\_tmp_*.item"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	dirlist buff, exedir + "user\\!tmp*.item"
	notesel buff
	repeat stat
		noteget file, cnt
		delete exedir + "user\\" + file
	loop
	return

#deffunc setitemid int setitemid_prm0, int setitemid_prm1
	iCItemIdx(setitemid_prm0) = setitemid_prm1
	useritemdata(39, setitemid_prm1) = setitemid_prm1
	return

#deffunc getitemid int getitemid_prm0
	if ( iCItemSerialNo(getitemid_prm0) == 0 ) {
		iCItemIdx(getitemid_prm0) = iParam1(getitemid_prm0)
		iCItemSerialNo(getitemid_prm0) = iParam2(getitemid_prm0)
		iParam1(getitemid_prm0) = 0
		iParam2(getitemid_prm0) = 0
	}
	p = getitemindex(iCItemSerialNo(getitemid_prm0))
	if ( p != (-1) ) {
		setitemid getitemid_prm0, p
	}
	else {
		p = getitemindex(iCItemSerialNo(getitemid_prm0) - 1)
		if ( p != (-1) ) {
			iCItemSerialNo(getitemid_prm0) = iCItemSerialNo(getitemid_prm0) - 1
			setitemid getitemid_prm0, p
		}
	}
	if ( p == (-1) ) {
		setitemid getitemid_prm0, useritemmax
	}
	return f

#defcfunc finditemid str finditemid_prm0
	locvar_cnvjkey_f = 0
	repeat useritemmax
		if ( finditemid_prm0 == useritemdatan(0, cnt) ) {
			locvar_cnvjkey_f = 1 + cnt
			break
		}
	loop
	return locvar_cnvjkey_f

*label_4278
	if ( inititemid ) {
		iCItemIdx(ci) = inititemid - 1
		inititemid = 0
	}
	cun = iCItemIdx(ci)
	iPic(ci) = xy2pic(30, 19)
	iID(ci) = ITEM_ID_CARNEADES_PLANK
	iNum(ci) = 1
	iValue(ci) = useritemdata(2, cun)
	iWeight(ci) = useritemdata(3, cun)
	iDice1(ci) = useritemdata(4, cun)
	iDice2(ci) = useritemdata(5, cun)
	iDmg(ci) = useritemdata(6, cun)
	iAtk(ci) = useritemdata(7, cun)
	iDV(ci) = useritemdata(8, cun)
	iPV(ci) = useritemdata(9, cun)
	iSkillRef(ci) = useritemdata(10, cun)
	iEffect(ci) = useritemdata(66, cun)
	iCol(ci) = useritemdata(38, cun)
	iMaterial(ci) = useritemdata(11, cun)
	iIdtLevel(ci) = useritemdata(12, cun)
	iParam1(ci) = useritemdata(68, cun)
	iParam2(ci) = useritemdata(69, cun)
	iParam3(ci) = useritemdata(70, cun)
	p = 0
	repeat strlen(useritemdatan(0, cun))
		p += peek(useritemdatan(0, cun), cnt)
	loop
	s = str(peek(useritemdatan(0, cun), 0)) + str(p) + str(peek(useritemdatan(0, cun), strlen(useritemdatan(0, cun)) - 1))
	ichargelevel = 0
	infilterref = useritemdatan(3, cun)
	iCItemSerialNo(ci) = int(s)
	reftype = useritemdata(14, cun)
	reftypeminor = useritemdata(15, cun)
	ibitmod ITEM_BIT_PRECIOUS, ci, useritemdata(16, cun)
	if ( useritemdata(66, cun) == 1000 ) {
		ibitmod ITEM_BIT_GUEST_USE, ci, TRUE
	}
	if ( useritemdata(66, cun) == 30 ) {
		ibitmod ITEM_BIT_PERIOD, ci, TRUE
	}
	if ( useritemdata(18, cun) ) {
		fixlv = useritemdata(18, cun)
	}
	fixeditemenc = useritemdata(20, cun), useritemdata(21, cun), useritemdata(22, cun), useritemdata(23, cun), useritemdata(24, cun), useritemdata(25, cun), useritemdata(26, cun), useritemdata(27, cun), useritemdata(28, cun), useritemdata(29, cun), useritemdata(30, cun), useritemdata(31, cun), useritemdata(32, cun), useritemdata(33, cun), useritemdata(34, cun), useritemdata(35, cun), useritemdata(36, cun), useritemdata(37, cun), 0
	setitemid ci, cun
	return

*label_4280
	folder = exedir + "user\\"
	ogCustomItemCount = 0
	sdim untaglistitem
	repeat 5480 - 200, 200
		if ( iNum(cnt) > 0 ) {
			if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
				exist folder + useritemdatan(6, iCItemIdx(cnt))
				if ( strsize != (-1) ) {
					if ( iCItemIdx(cnt) != useritemmax ) {
						if ( instr(untaglistitem, 0, "/" + useritemdatan(0, iCItemIdx(cnt)) + "/") == (-1) ) {
							if ( ogCustomItemCount < 100 ) {
								bcopy folder + useritemdatan(6, iCItemIdx(cnt)), folder + "_tmp_" + ogCustomItemCount + ".item"
								zipadd "_tmp_" + ogCustomItemCount + ".item"
								untaglistitem += "/" + useritemdatan(0, iCItemIdx(cnt)) + "/"
								ogCustomItemCount++
							}
						}
					}
				}
			}
		}
	loop
	return

#defcfunc ioriginalnamecnv int ioriginalnamecnv_prm0
	if ( iID(ioriginalnamecnv_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		return useritemdatan(1, iCItemIdx(ioriginalnamecnv_prm0))
	}
	return ioriginalnameref(iID(ioriginalnamecnv_prm0))

#defcfunc ioriginalname2cnv int ioriginalname2cnv_prm0
	if ( iID(ioriginalname2cnv_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		return useritemdatan(8, iCItemIdx(ioriginalname2cnv_prm0))
	}
	return ioriginalnameref2(iID(ioriginalname2cnv_prm0))

#defcfunc iknownnamecnv int iknownnamecnv_prm0
	if ( iID(iknownnamecnv_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		return useritemdatan(4, iCItemIdx(iknownnamecnv_prm0))
	}
	return iknownnameref(iID(iknownnamecnv_prm0))

#defcfunc ialphanamecnv int ialphanamecnv_prm0
	if ( iID(ialphanamecnv_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		return useritemdatan(2, iCItemIdx(ialphanamecnv_prm0))
	}
	return ialphanameref(iID(ialphanamecnv_prm0))

#defcfunc ifiltercnv int ifiltercnv_prm0
	if ( iID(ifiltercnv_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		return useritemdatan(3, iCItemIdx(ifiltercnv_prm0))
	}
	return filter_item(iID(ifiltercnv_prm0))

*label_4287
	inv_getheader -1
	repeat invrange, invhead
		notesel autopickbuff




		if ( iNum(cnt) > 0 ) {
			if ( iProperty(cnt) < PROP_NPC ) {
				if ( iX(cnt) == x & iY(cnt) == y ) {
					item_checkknown cnt
					cnt2 = cnt
					repeat noteinfo(0)
						p = 0
						p(1) = 0
						noteget buff, cnt
						if ( instr(buff, 0, "#") != (-1) ) {
							continue
						}
						s = buff
						if ( instr(s, 0, "!!") != (-1) ) {
							getstr s, s, 2
						}
						else {
							if ( instr(s, 0, "!") != (-1) | instr(s, 0, "~") != (-1) ) {
								getstr s, s, 1
							}
						}
						if ( instr(s, 0, "?") != (-1) ) {
							getstr s, s, 0, 63
						}
						s = strtrim(s, 0, 32)
*label_4288
						if ( instr(s, 0, "  ") != (-1) == 0 ) {
							goto *label_4290
						}
						sreplace s, s, "  ", " "
						goto *label_4288
*label_4290
						s = " " + s + " "
						if ( instr(s, 0, lang("すべての", " all ")) != (-1) ) {
							p(1) = 1
							delstr s, "すべての"
							sreplace s, s, lang("すべての", " all "), " "
						}
						if ( instr(s, 0, lang("名称不明の", " unknown ")) != (-1) ) {
							if ( iKnown(cnt2) != ITEM_KNOWN_NONE ) {
								continue
							}
							sreplace s, s, lang("名称不明の", " unknown "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("鑑定段階1の", " identify stage1 ")) != (-1) ) {
							if ( iKnown(cnt2) != ITEM_KNOWN_NAME ) {
								continue
							}
							sreplace s, s, lang("鑑定段階1の", " identify stage1 "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("鑑定段階2の", " identify stage2 ")) != (-1) ) {
							if ( iKnown(cnt2) != ITEM_KNOWN_QUALITY ) {
								continue
							}
							sreplace s, s, lang("鑑定段階2の", " identify stage2 "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("鑑定段階3の", " identify stage3 ")) != (-1) ) {
							if ( iKnown(cnt2) != ITEM_KNOWN_FULL ) {
								continue
							}
							sreplace s, s, lang("鑑定段階3の", " identify stage3 "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("無価値の", " worthless ")) != (-1) ) {
							if ( iValue(cnt2) > 10 ) {
								continue
							}
							sreplace s, s, lang("無価値の", " worthless "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("腐った", " rotten ")) != (-1) ) {
							if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_FOOD ) {
								continue
							}
							if ( iParam3(cnt2) >= 0 ) {
								continue
							}
							sreplace s, s, lang("腐った", " rotten "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("腐りきった", " zombie ")) != (-1) ) {
							if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_FOOD ) {
								continue
							}
							if ( iSubName(cnt2) != 21 & iSubName(cnt2) != 47 & iSubName(cnt2) != 48 & iSubName(cnt2) != 49 & iSubName(cnt2) != 99 & iSubName(cnt2) != 100 & iSubName(cnt2) != 101 & iSubName(cnt2) != 257 & iSubName(cnt2) != 254 ) {
								continue
							}
							sreplace s, s, lang("腐りきった", " zombie "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("ドラゴンの", " dragon's ")) != (-1) ) {
							if ( iID(cnt2) != ITEM_ID_CORPSE & refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_REMAINS ) {
								continue
							}
							if ( iSubName(cnt2) != 120 & iSubName(cnt2) != 121 & iSubName(cnt2) != 122 & iSubName(cnt2) != 123 & iSubName(cnt2) != 124 & iSubName(cnt2) != 125 ) {
								continue
							}
							sreplace s, s, lang("ドラゴンの", " dragon's "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("空っぽの", " empty ")) != (-1) ) {
							if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_CONTAINER ) {
								continue
							}
							if ( iParam1(cnt2) != 0 ) {
								continue
							}
							sreplace s, s, lang("空っぽの", " empty "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("粗悪な", " bad ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iQuality(cnt2) != FIX_QUALITY_BAD ) {
								continue
							}
							sreplace s, s, lang("粗悪な", " bad "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("良質な", " good ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iQuality(cnt2) != FIX_QUALITY_GOOD ) {
								continue
							}
							sreplace s, s, lang("良質な", " good "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("高品質な", " great ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iQuality(cnt2) != FIX_QUALITY_GREAT ) {
								continue
							}
							sreplace s, s, lang("高品質な", " great "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("奇跡の", " miracle ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iQuality(cnt2) != FIX_QUALITY_MIRACLE ) {
								continue
							}
							sreplace s, s, lang("奇跡の", " miracle "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("神器の", " godly ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iQuality(cnt2) != FIX_QUALITY_GODLY ) {
								continue
							}
							sreplace s, s, lang("神器の", " godly "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("特別な", " special ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iQuality(cnt2) != FIX_QUALITY_UNIQUE ) {
								continue
							}
							sreplace s, s, lang("特別な", " special "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("貴重な", " precious ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( ibit(ITEM_BIT_PRECIOUS, cnt2) != TRUE ) {
								continue
							}
							sreplace s, s, lang("貴重な", " precious "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("祝福された", " blessed ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iStatus(cnt2) != ITEM_STATUS_BLESSED ) {
								continue
							}
							sreplace s, s, lang("祝福された", " blessed "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("呪われた", " cursed ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iStatus(cnt2) != ITEM_STATUS_CURSED ) {
								continue
							}
							sreplace s, s, lang("呪われた", " cursed "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("堕落した", " doomed ")) != (-1) ) {
							if ( iKnown(cnt2) < ITEM_KNOWN_QUALITY ) {
								continue
							}
							if ( iStatus(cnt2) != ITEM_STATUS_DOOMED ) {
								continue
							}
							sreplace s, s, lang("堕落した", " doomed "), " "
							p(1) = 1
						}
						if ( instr(s, 0, lang("生きている", " alive ")) != (-1) ) {
							if ( ibit(ITEM_BIT_ALIVE, cnt2) != TRUE ) {
								continue
							}
							sreplace s, s, lang("生きている", " alive "), " "
							p(1) = 1
						}
						s = strtrim(s, 0, 32)
*label_4291
						if ( instr(s, 0, "  ") != (-1) == 0 ) {
							goto *label_4293
						}
						sreplace s, s, "  ", " "
						goto *label_4291
*label_4293
						s(1) = cnvitemname(iID(cnt2))
						if ( instr(s(1), 0, s) != (-1) & iKnown(cnt2) != ITEM_KNOWN_NONE ) {
							p = 1
						}
						else {
							if ( p(1) == 0 ) {
								continue
							}
							if ( instr(s, 0, lang("アイテム", "item")) != (-1) ) {
								p = 1
							}
							if ( instr(s, 0, lang("装備品", "equipment")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) >= FILTER_ITEM_MIN ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("近接武器", "melee weapon")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_WEAPON ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("兜", "helm")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_HELM ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("盾", "shield")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_SHIELD ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("鎧", "armor")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ARMOR ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("靴", "boots")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_BOOTS ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("腰当", "belt")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_GIRDLE ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("マント", "cloak")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_CLOAK ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("グローブ", "gloves")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_GLOVES ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("遠隔武器", "ranged weapon")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_RANGE ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("矢弾", "ammo")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_AMMO ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("指輪", "ring")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ACCESSORY_RING ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("首輪", "necklace")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ACCESSORY_AMULET ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("ポーション", "potion")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_POTION ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("巻物", "scroll")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_SCROLL ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("魔法書", "spellbook")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_SPELLBOOK ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("本", "book")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_BOOK ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("魔法の杖", "rod")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_ROD ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("食べ物", "foods")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_FOOD & (iID(cnt2) == ITEM_ID_BOTTLE_MILK & iParam2(cnt2) != 0) == 0 ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("道具", "tool")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ITEM_TOOL ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("家具", "furniture")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_FURNITURE ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("井戸", "well")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_FURNITURE_WELL ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("祭壇", "altar")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_FURNITURE_ALTAR ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("残骸", "bodyparts")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_REMAINS ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("ジャンク", "junk")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_JUNK ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("金貨", "gold piece")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_GOLD ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("プラチナ硬貨", "platinum coin")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_PLATINUM ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("宝箱", "chest")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_CONTAINER ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("鉱石", "ore")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ORE ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("樹木", "tree")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_ENVIRONMENT ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("旅糧", "traveler's food")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_CARGO_FOOD ) {
									continue
								}
								p = 1
							}
							if ( instr(s, 0, lang("交易品", "cargo")) != (-1) ) {
								if ( refitem(iID(cnt2), DBSPEC_TYPE, cnt2) != FILTER_CARGO_TRADE ) {
									continue
								}
								p = 1
							}
						}
						if ( p == 1 ) {
							if ( instr(buff, 0, "!!") != (-1) ) {
								if ( instr(buff, 0, "?") != (-1) ) {
									if ( cnt3 == 0 ) {
										txt -1, lang(itemname(cnt2) + "を破壊する？", "Destroy " + itemname(cnt2) + "?")
										promptl(0, 0) = stryes, "y", "0"
										promptl(0, 1) = strno, "n", "1"
										promptmax = 2
										val = promptx, prompty, 160, 1
										gosub *prompt_key
										if ( rtval != 0 ) {
											gosub *screen_draw
											break
										}
									}
									else {
										txt -1, lang(name(cnt3) + "に" + itemname(cnt2) + "を破壊してもらう？", "Destroy " + itemname(cnt2) + "?")
										promptl(0, 0) = stryes, "y", "0"
										promptl(0, 1) = strno, "n", "1"
										promptmax = 2
										val = promptx, prompty, 160, 1
										gosub *prompt_key
										if ( rtval != 0 ) {
											gosub *screen_draw
											break
										}
									}
								}
								if ( cfg_autodestroysound ) {
									snd SOUNDLIST_CRUSH1
								}
								iNum(cnt2) = 0
								if ( synccheck(cnt3, -1) ) {
									ctalk cnt3, 1107, cnt3, cnt3
									if ( stat == 0 ) {
										ctalk cnt3, 1106, cnt3, cnt3
									}
									txt -1, lang(name(cnt3) + "は" + itemname(cnt2) + "を破壊した。", itemname(cnt2) + " was destroyed. ")
								}
								cell_refresh x, y
								mapItemsMemory(x, y) = mapItems(x, y)
								break
							}
							if ( instr(buff, 0, "!") != (-1) ) {
								if ( ibit(ITEM_BIT_PRECIOUS, cnt2) == FALSE ) {
									if ( instr(buff, 0, "?") != (-1) ) {
										if ( cnt3 == 0 ) {
											txt -1, lang(itemname(cnt2) + "を破壊する？", "Destroy " + itemname(cnt2) + "?")
											promptl(0, 0) = stryes, "y", "0"
											promptl(0, 1) = strno, "n", "1"
											promptmax = 2
											val = promptx, prompty, 160, 1
											gosub *prompt_key
											if ( rtval != 0 ) {
												gosub *screen_draw
												break
											}
										}
										else {
											txt -1, lang(name(cnt3) + "に" + itemname(cnt2) + "を破壊してもらう？", "Destroy " + itemname(cnt2) + "?")
											promptl(0, 0) = stryes, "y", "0"
											promptl(0, 1) = strno, "n", "1"
											promptmax = 2
											val = promptx, prompty, 160, 1
											gosub *prompt_key
											if ( rtval != 0 ) {
												gosub *screen_draw
												break
											}
										}
									}
									if ( cfg_autodestroysound ) {
										snd SOUNDLIST_CRUSH1
									}
									iNum(cnt2) = 0
									if ( synccheck(cnt3, -1) ) {
										ctalk cnt3, 1107, cnt3, cnt3
										if ( stat == 0 ) {
											ctalk cnt3, 1106, cnt3, cnt3
										}
										txt -1, lang(name(cnt3) + "は" + itemname(cnt2) + "を破壊した。", itemname(cnt2) + " was destroyed. ")
									}
									cell_refresh x, y
									mapItemsMemory(x, y) = mapItems(x, y)
								}
								break
							}
							if ( instr(buff, 0, "~") != (-1) ) {
								break
							}
							if ( instr(buff, 0, "?") != (-1) ) {
								if ( cnt3 == 0 ) {
									txt -1, lang(itemname(cnt2) + "を拾う？", "Pick up " + itemname(cnt2) + "?")
									promptl(0, 0) = stryes, "y", "0"
									promptl(0, 1) = strno, "n", "1"
									promptmax = 2
									val = promptx, prompty, 160, 1
									gosub *prompt_key
									if ( rtval != 0 ) {
										gosub *screen_draw
										break
									}
								}
								else {
									txt -1, lang(name(cnt3) + "に" + itemname(cnt2) + "を拾ってもらう？", "Pick up " + itemname(cnt2) + "?")
									promptl(0, 0) = stryes, "y", "0"
									promptl(0, 1) = strno, "n", "1"
									promptmax = 2
									val = promptx, prompty, 160, 1
									gosub *prompt_key
									if ( rtval != 0 ) {
										gosub *screen_draw
										break
									}
								}
							}
							if ( instr(buff, 0, "%") != (-1) ) {
								autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
							}
							if ( instr(buff, 0, "=") != (-1) ) {
								txt -1, lang(itemname(cnt2) + "を大事なものに指定した。", "You set " + itemname(cnt2) + " as no-drop.")
								ibitmod ITEM_BIT_NO_DROP, cnt2, TRUE
							}
							if ( instr(buff, 0, ":sound") != (-1) ) {
								snd 200
							}
							in = iNum(cnt2)
							ci = cnt2
							cc = cnt3
							gosub *label_4298
							break
						}
					loop
				}
			}
		}
	loop
	noteunsel
	return

#deffunc loadpickitembuff int loadpickitembuff_prm0
	sdim autopickbuff, 256, 500
	if ( loadpickitembuff_prm0 == 0 ) {
		exist exedir + "save\\" + playerid + "\\" + "autopick.txt"
		if ( strsize != (-1) ) {
			notesel autopickbuff
			noteload exedir + "save\\" + playerid + "\\" + "autopick.txt"
			noteunsel
		}
	}
	else {
		exist exedir + "save\\" + playerid + "\\" + "autopick_" + loadpickitembuff_prm0 + ".txt"
		if ( strsize != (-1) ) {
			notesel autopickbuff
			noteload exedir + "save\\" + playerid + "\\" + "autopick_" + loadpickitembuff_prm0 + ".txt"
			noteunsel
		}
	}
	nowautopickfile = loadpickitembuff_prm0
	exist exedir + "save\\" + playerid + "\\" + "customname.txt"
	if ( strsize != (-1) ) {
		buff = ""
		notesel buff
		noteload exedir + "save\\" + playerid + "\\" + "customname.txt"
		repeat noteinfo(0)
			noteget s, cnt
			cnamelist(cnt) = s
		loop
	}
	return

*label_4298
	if ( cc != (-1) ) {
		if ( iID(ci) == ITEM_ID_GOLD_PIECE | iID(ci) == ITEM_ID_PLATINUM_COIN ) {
			if ( cfg_autopicksound ) {
				snd SOUNDLIST_GETGOLD1
			}
			ti = ci
			in = iNum(ci)
			iNum(ci) = 0
			msgkeep = 1
			ctalk cc, 10105, cc, cc
			if ( stat == 0 ) {
				txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
				ctalk cc, 1105, cc, cc
				if ( stat == 0 ) {
					ctalk cc, 1104, cc, cc
				}
			}
			if ( p == 1 ) {
				notesel autopickbuff
			}
			cell_refresh iX(ci), iY(ci)
			mapItemsMemory(iX(ci), iY(ci)) = mapItems(iX(ci), iY(ci))
			if ( iID(ci) == ITEM_ID_GOLD_PIECE ) {
				se_moneymod cc, in
			}
			else {
				addplat cc, in
			}
			return 1
		}
	}
	if ( cc == CHARA_PLAYER ) {
		if ( gRider != 0 ) {
			if ( cRowAct(gRider) != ACTION_NONE ) {
				if ( cItemUsing(gRider) == ci ) {
					txt -1, lang("それは" + name(gRider) + "が使用中だ。", name(gRider) + " " + is(gRider) + " using it.")
					return 1
				}
			}
		}
		if ( inv_getfreeid(cc) == (-1) ) {
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return 0
		}
	}
	inumbk = iNum(ci) - in
	iNum(ci) = in
	if ( cc == CHARA_PLAYER ) {
		if ( gettrait(0, 215) != 0 ) {
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_ROD ) {
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) > 0 ) {
					dbmode = DBMODE_ON_ZAP
					dbid = iID(ci)
					gosub *db_item
					txt -1, lang("あなたは" + itemname(ci) + "から魔力を吸い取った。", "You absorb magic from " + itemname(ci) + ".")
					if ( efid >= SKILL_SPELL_HEAL_LIGHT & efid < (600 /*!!!@[MAX_SKILL_RANGE @@@ STARTING_SKILL_SPACT]@!!! */) ) {
						spell(efid - 400) += inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) * 5 * iNum(ci)
					}
					else {
						healmp CHARA_PLAYER, inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) * 5 * iNum(ci)
					}
					inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
				}
			}
		}
		if ( gettrait(0, 216) != 0 ) {
			if ( refitem(iID(ci), DBSPEC_TYPE, ci) == FILTER_ITEM_POTION ) {
				if ( iID(ci) != ITEM_ID_POISON & iID(ci) != ITEM_ID_POTION_CURE_CORRUPTION & iID(ci) != ITEM_ID_POTION_OF_GREATER_CURE_CORRUPTION & (iID(ci) == ITEM_ID_BOTTLE_MILK & iParam2(ci) != 0) == 0 ) {
					if ( rnd(5) == 0 ) {
						txt -1, lang("あなたの手から毒が滴った。", "Poison drips from your hands.")
						iID(ti) = ITEM_ID_POISON
						iPic(ti) = xy2pic(24, 10)
						iCol(ti) = _randcolor((262 + gRandSeedA) \ 6)
						iValue(ti) = 120
						iLevel(ti) = 0
						ibitmod ITEM_BIT_PRECIOUS, ti, FALSE
					}
				}
			}
		}
	}
	if ( iProperty(ci) < PROP_NONE ) {
		iProperty(ci) = PROP_NONE
	}
	if ( ibit(ITEM_BIT_DROP, ci) ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
		ibitmod ITEM_BIT_DROP, ci, FALSE
	}
	inv(39, ci) = 0
	item_stack cc, ci
	if ( stat == 0 ) {
		ti = inv_getfreeid(cc)
		if ( ti == (-1) ) {
			iNum(ci) = inumbk + in
			txt -1, lang("バックパックには、もうアイテムを入れる余裕がない。", "Your inventory is full.")
			return 0
		}
		item_copy ci, ti
		iNum(ti) = in
	}
	iNum(ci) = inumbk
	cell_refresh iX(ci), iY(ci)
	mapItemsMemory(iX(ci), iY(ci)) = mapItems(iX(ci), iY(ci))
	if ( cfg_autopicksound ) {
		snd 14 + rnd(2)
	}
	msgkeep = 1
	ctalk cc, 10105, cc, cc
	if ( stat == 0 ) {
		txt -1, lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
		ctalk cc, 1105, cc, cc
		if ( stat == 0 ) {
			ctalk cc, 1104, cc, cc
		}
	}
	if ( p == 1 ) {
		notesel autopickbuff
	}
	if ( cc == CHARA_PLAYER ) {
		if ( iID(ti) == ITEM_ID_CAMPFIRE ) {
			inv_getheader -1
			if ( mFireSound == 1 ) {
				f = 0
				repeat invrange, invhead
					if ( iNum(cnt) == 0 ) {
						continue
					}
					if ( iID(cnt) == ITEM_ID_CAMPFIRE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					mFireSound = 0
					gosub *music_play
				}
			}
		}
		convertartifact ti
		ti = stat
		if ( areaId(gArea ) == AREA_MUSEUM ) {
			if ( mode == MODELIST_MAIN ) {
				gosub *museum_update
			}
		}
		if ( gArea  == AREA_HOME ) {
			if ( mode == MODELIST_MAIN ) {
				gosub *house_update
			}
		}
		gosub *label_1681
	}
	if ( cc == (-1) ) {
		gosub *label_1681
	}
	return 1

#deffunc delstr var delstr_prm0, str delstr_prm1
	repeat
		if ( instr(delstr_prm0, 0, delstr_prm1) == (-1) ) {
			break
		}
		else {
			memcpy delstr_prm0, delstr_prm0, strlen(delstr_prm0) - (instr(delstr_prm0, 0, delstr_prm1) + strlen(delstr_prm1)), instr(delstr_prm0, 0, delstr_prm1), instr(delstr_prm0, 0, delstr_prm1) + strlen(delstr_prm1)
			memset delstr_prm0, 0, strlen(delstr_prm1), strlen(delstr_prm0) - strlen(delstr_prm1)
		}
	loop
	return

*label_4302
	if ( cfg_showroomlog == 0 ) {
		return
	}
	buff = "\n##########この行より下のみ手動で編集可##########\n"
	notesel buff
	exist exedir + "user\\showroom_log.txt"
	if ( strsize != (-1) ) {
		noteload exedir + "user\\showroom_log.txt"
	}
	if ( peek(listn(0, p), 0) == 42 ) {
		getstr listn(0, p), listn(0, p), 1
	}
	if ( instr(buff, 0, listn(0, p)) == (-1) ) {
		noteadd listn(0, p), 2
	}
	noteadd listn(0, p), 0, 1
	if ( cfg_showroomlog != 6 ) {
		repeat
			if ( noteinfo(0) > cfg_showroomlog * 100 + 2 ) {
				notedel cfg_showroomlog * 100 + 2
			}
			else {
				break
			}
		loop
	}
	notesave exedir + "user\\showroom_log.txt"
	noteunsel
	return

#defcfunc bsearch int bsearch_prm0, int bsearch_prm1, int bsearch_prm2, var bsearch_prm3, int bsearch_prm4
	if ( locvar_cnvjkey_bm == 0 ) {
		dim locvar_cnvjkey_bm, 49
		VirtualProtect locvar_cnvjkey_bm, 49 * 4, 64, locvar_cnvjkey_azsd
		locvar_cnvjkey_pbm = varptr(locvar_cnvjkey_bm)
		locvar_cnvjkey_bm(0) = -2115204267, 262380, 274041600, 1972065875, 33456916, 843888143, 578115583
		locvar_cnvjkey_bm(7) = 1161412659, -1836183796, -1962934272, -1240528811, -784658412, 8815631, 994050048
		locvar_cnvjkey_bm(14) = -344191931, -963937301, 65721, 12422400, -201326596, -12153429, -1064974029
		locvar_cnvjkey_bm(21) = -125084034, 287094287, -1648588479, -1024, 2093497167, -1958089745, -1240528827
		locvar_cnvjkey_bm(28) = -1240530684, 1006580348, -1976863289, -1946282404, 1099761789, 941374207, -125100939
		locvar_cnvjkey_bm(35) = 2089679147, -7995593, 1569400436, -1974515704, 339351316, 274041624, 1166797940
		locvar_cnvjkey_bm(42) = 79040264, -2054421759, -1024, 2081180987, -3636302, -916758945, 195
	}
	locvar_cnvjkey_prm = bsearch_prm1 + bsearch_prm0, bsearch_prm2 - bsearch_prm0, varptr(bsearch_prm3), bsearch_prm4
	return callfunc(locvar_cnvjkey_prm, locvar_cnvjkey_pbm, 4)

#deffunc tmpload str tmpload_prm0
	writeloadedbuff "" + tmpload_prm0
	if ( stat == (-1) ) {
		return
	}
	word = tmpload_prm0
	exist exedir + "save\\" + playerid + "\\" + word
	if ( strsize != (-1) ) {
		if ( cfg_datacopy == 0 ) {
			bcopy exedir + "save\\" + playerid + "\\" + word, exedir + "tmp\\" + word
		}
		else {
			chdir exedir + "save\\" + playerid + "\\"
			fxcopy word, exedir + "tmp\\"
			chdir exedir
		}
	}
	return

#deffunc writeloadedbuff str writeloadedbuff_prm0
	if ( writeloadedbuff_prm0 == "" ) {
		return -1
	}
	word = writeloadedbuff_prm0
	lkey = strlen(word)
	pbuf = varptr(loadedbuff)
	if ( bsearch(0, pbuf, loadedbuffmax, word, lkey) != (-1) ) {
		return -1
	}
	poke loadedbuff, bufflast, word
	bufflast += strlen(word)
	poke loadedbuff, bufflast, "/"
	bufflast++
	if ( bufflast + 500 > loadedbuffmax ) {
		memexpand loadedbuff, loadedbuffmax + 2000
		memset loadedbuff, 0, 2000, loadedbuffmax
		loadedbuffmax += 2000
	}
	return 0

*label_4309
	listmax = 0
	page = 0
	pagesize = 9
	cs_bk = -1
	cs = cook_cs
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_inv.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1
	redraw 0
	repeat 9
		list(0, cnt) = cnt + 1
		p = cnt + 2
		if ( iParam1(ci) != 10000 ) {
			list(1, cnt) = limit(sCooking(CHARA_PLAYER) * 3 + iParam1(cooktool) / 15 - p * p, 5, 100 + iParam1(cooktool) / 2 - p * p)
		}
		else {
			list(1, cnt) = limit(sCooking(CHARA_PLAYER) / 2 + iParam1(cooktool) / 30 - p * p * (p / 3), 1, 100 + iParam1(cooktool) / 2 - p * p)
		}
		if ( list(1, cnt) > 100 ) {
			list(1, cnt) = 100
		}
		if ( iID(ci) == ITEM_ID_CARNEADES_PLANK ) {
			listn(0, cnt) = foodname(iParam1(ci) / 1000, "" + ioriginalnamecnv(ci), list(0, cnt), iSubName(ci), iCNpcId(ci)), "" + list(1, cnt) + "%"
		}
		else {
			if ( iID(ci) == ITEM_ID_FISH ) {
				listn(0, cnt) = foodname(iParam1(ci) / 1000, "" + fishdatan(iSubName(ci)), list(0, cnt), iSubName(ci), iCNpcId(ci)), "" + list(1, cnt) + "%"
			}
			else {
				if ( iID(ci) == ITEM_ID_BOTTLE_MILK ) {
					if ( ibit(ITEM_BIT_PRECIOUS, ci) ) {
						listn(0, cnt) = foodname(9, cnName(CHARA_PLAYER), list(0, cnt), iSubName(ci), iCNpcId(ci)), "" + list(1, cnt) + "%"
					}
					else {
						listn(0, cnt) = foodname(9, "", list(0, cnt), iSubName(ci), iCNpcId(ci)), "" + list(1, cnt) + "%"
					}
				}
				else {
					if ( ibit(ITEM_BIT_PRECIOUS, ci) ) {
						listn(0, cnt) = foodname(iParam1(ci) / 1000, cnName(CHARA_PLAYER), list(0, cnt), iSubName(ci), iCNpcId(ci)), "" + list(1, cnt) + "%"
					}
					else {
						listn(0, cnt) = foodname(iParam1(ci) / 1000, "", list(0, cnt), iSubName(ci), iCNpcId(ci)), "" + list(1, cnt) + "%"
					}
				}
			}
		}
		listmax++
	loop

*label_4311
	redraw 0
	s = lang("料理", "Cooking")
	display_window (windoww - 730) / 2 + inf_screenx, winposy(430, 0), 730, 430, 55, 40
	s = lang("料理名", "Recipe"), strhint3, lang("確率", "Success rate")
	display_topic s, wx + 46, wy + 36
	display_topic s(2), wx + 555, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 57, wy + 66 + cnt * 19
			gfini 640, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		cs_list listn(0, p), wx + 80, wy + 66 + cnt * 19 - 1, 19
		pos wx + 590, wy + 66 + cnt * 19 + 2
		mes listn(1, p)
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
		cook_cs = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	nc_intb_005 = 0
	repeat keyrange
		if ( key == key_select(cnt) ) {
			if ( key != key_cancel ) {
				p = pagesize * page + cnt
				txt -1, lang("いくつ料理する？(1~", "How meny?(1~") + iNum(ci) + ")"
				nc_intb_005 = iNum(ci)
				val = (windoww - 200) / 2 + inf_screenx, winposy(60), 8, 1, nc_intb_005
				inputlog = "1"
				locvar_dmghp_p = rtval
				gosub *prompt_word
				rtval = locvar_dmghp_p
				if ( rtval == (-1) ) {
					nc_intb_004 = 1
				}
				else {
					nc_intb_004 = int(inputlog)
				}
			}
			break
		}
	loop
	if ( nc_intb_004 == 1 ) {
		if ( p >= 0 ) {
			snd SOUNDLIST_COOK1
			item_separate ci
			nc_strb_001 = itemname(ci)
			if ( rnd(100) < list(1, p) ) {
				make_dish ci, list(0, p)
				if ( iID(ci) == ITEM_ID_API_NUT | iID(ci) == ITEM_ID_STRAWBERRY | refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_ITEM_FOOD_FRUIT ) {
					if ( gettrait(cc, 103) ) {
						iLevel(ci) = calctraitscore(stat)
					}
				}
				txt -1, lang(itemname(cooktool) + "で" + nc_strb_001 + "を料理して、" + itemname(ci, 1) + "を作った。", "You cook " + nc_strb_001 + " with " + itemname(cooktool, 1) + " and make " + itemname(ci, 1) + ".")
				ctalk cc, 1336, cc, cc
			}
			else {
				make_dish ci, rnd(2) + 1
				txt -1, lang(itemname(cooktool) + "で" + nc_strb_001 + "を料理したが失敗したため、" + itemname(ci, 1) + "ができた。", "You cooked " + nc_strb_001 + " with " + itemname(cooktool) + " but failed, so you made " + itemname(ci, 1) + ".")
				ctalk cc, 1103, cc, cc
			}
			throwsstpevent "Cooking", 0, itemname(ci), iID(ci), iParam1(ci) / 1000, iParam2(ci)
			r1 = iParam2(ci)
			item_autostack cc, ci
			if ( r1 > 2 ) {
				skillexp2 SKILL_NORMAL_COOKING, CHARA_PLAYER, 30 + r1 * 5
			}
			gosub *label_1681
			gosub *screen_draw
			return
		}
	}
	else {
		if ( nc_intb_004 > 1 ) {
			if ( p >= 0 ) {
				r1 = 0
				snd SOUNDLIST_COOK1
				nc_strb_001 = itemname(ci)
				nc_intb_102 = 0
				nc_intb_103 = 0
				repeat nc_intb_004
					item_separate ci
					nc_intb_001 = stat
					if ( rnd(100) < list(1, p) ) {
						make_dish ci, list(0, p)
						if ( iID(ci) == ITEM_ID_API_NUT | refitem(iID(ci), DBSPEC_TYPE_MINOR, ci) == FILTER_ITEM_FOOD_FRUIT ) {
							if ( gettrait(cc, 103) ) {
								iLevel(ci) = calctraitscore(stat)
							}
						}
						nc_intb_102++
					}
					else {
						make_dish ci, rnd(2) + 1
						nc_intb_103++
					}
					item_autostack cc, ci, 1
					r1 += iParam2(ci)
					ci = nc_intb_001
					nc_intb_005 = cnt + 1
					if ( cc == CHARA_PLAYER ) {
						if ( cSP(CHARA_PLAYER) < 50 ) {
							if ( cSP(CHARA_PLAYER) < rnd(75) ) {
								txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
								dmgsp CHARA_PLAYER, skillCost(efid) / 2 + 1
								break
							}
						}
						nc_intb_006 = rnd(skillCost(efid) / 2 + 1) + skillCost(efid) / 2 + 1
						if ( gettrait(0, 86) ) {
							nc_intb_006 -= nc_intb_006 * calctraitscore(stat) / 10
						}
						dmgsp CHARA_PLAYER, nc_intb_006
					}
				loop
				repeat nc_intb_005
					skillexp2 SKILL_NORMAL_COOKING, CHARA_PLAYER, 30 + r1 / nc_intb_005 * 5
				loop
				txt -1, lang(itemname(cooktool) + "で" + nc_strb_001 + "を" + nc_intb_005 + "回料理した。", "You cook " + nc_strb_001 + " with " + itemname(cooktool, 1) + " " + f + "time.")
				txt -1, lang(listn(0, p) + "を" + nc_intb_102 + "回作り、" + nc_intb_103 + "回失敗した。", "You cooked " + listn(0, p) + " " + nc_intb_102 + " times and " + nc_intb_103 + " failed.")
				gosub *label_1681
				gosub *screen_draw
				return
			}
		}
	}
	if ( key == key_cancel ) {
		gosub *screen_draw
		return
	}
	goto *label_4311

#defcfunc oabit int oabit_prm0, int oabit_prm1
	if ( oabit_prm1 >= 450 & oabit_prm1 < 500 ) {
		HMMBITCHECK oadata(oabit_prm1 - 450), oabit_prm0
		return abs(stat)
	}
	return 0

#deffunc oabitmod int oabitmod_prm0, int oabitmod_prm1, int oabitmod_prm2
	if ( oabitmod_prm2 == 0 ) {
		HMMBITOFF oadata(oabitmod_prm1 - 450), oabitmod_prm0
		return
	}
	HMMBITON oadata(oabitmod_prm1 - 450), oabitmod_prm0
	return

*label_4319
	exist exedir + "NGwords.txt"
	if ( strsize == (-1) ) {
		buff = "阻。\n棒。\n赤。\nﾋ｡｣\n仝"
		bsave exedir + "NGwords.txt", buff, 25
	}
	notesel ngwordsbuff
	noteload exedir + "NGwords.txt"
	noteunsel
	return

#defcfunc checkngwords str checkngwords_prm0
	flag = 0
	buff = checkngwords_prm0
	notesel ngwordsbuff
	repeat noteinfo(0)
		noteget s, cnt
		if ( instr(buff, 0, s) != (-1) ) {
			flag = 1
			break
		}
	loop
	noteunsel
	return flag

#defcfunc mbsbtypebyte int mbsbtypebyte_prm0
	return mbsbtypebyte_prm0 >= 129 & mbsbtypebyte_prm0 <= 159 | (mbsbtypebyte_prm0 >= 224 & mbsbtypebyte_prm0 <= 252)

#defcfunc mbsbtype var mbsbtype_prm0, int mbsbtype_prm1
	locvar_cnvjkey_bcnt = mbsbtype_prm1
	repeat mbsbtype_prm1
		if ( mbsbtypebyte(peek(mbsbtype_prm0, mbsbtype_prm1 - cnt - 1)) == 0 ) {
			locvar_cnvjkey_bcnt = cnt
			break
		}
	loop
	if ( locvar_cnvjkey_bcnt \ 2 ) {
		return 2
	}
	else {
		return mbsbtypebyte(peek(mbsbtype_prm0, mbsbtype_prm1))
	}

#deffunc rewriteai int rewriteai_prm0
	if ( ocbit(0, rewriteai_prm0) ) {
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_YOUNG_LADY ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_THROW_POTION_MAJOR
		}
		else {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_MELEE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_CACY_THE_CAT_TAMER ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = SKILL_SPACT_SUMMON_CATS
		}
		else {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_MELEE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_KAMIKAZE_YEEK | cId(rewriteai_prm0) == CREATURE_ID_KAMIKAZE_SAMURAI | cId(rewriteai_prm0) == CREATURE_ID_BOMB_ROCK | cId(rewriteai_prm0) == CREATURE_ID_HARD_GAY ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cbitmod CHARA_BIT_SUICIDE, rewriteai_prm0, TRUE
			cdata(STARTING_CDATA_ACT_MAIN, rewriteai_prm0) = SKILL_SPACT_SUICIDE_ATTACK
		}
		else {
			cbitmod CHARA_BIT_SUICIDE, rewriteai_prm0, FALSE
			cdata(STARTING_CDATA_ACT_MAIN, rewriteai_prm0) = ACTION_MELEE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_YOUNGER_SISTER2 ) {
		if ( ocAISpecialAction2(rewriteai_prm0) == 0 ) {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = SKILL_SPACT_SUMMON_SISTER
		}
		else {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_MELEE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_EXILE | cId(rewriteai_prm0) == CREATURE_ID_REVLUS_THE_MAGE_GUILDMASTER | cId(rewriteai_prm0) == CREATURE_ID_LEXUS_THE_MAGE_WATCHMAN ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cbitmod CHARA_BIT_RAPID_MAGIC, rewriteai_prm0, TRUE
		}
		else {
			cbitmod CHARA_BIT_RAPID_MAGIC, rewriteai_prm0, FALSE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_BLUE_BUBBLE | cId(rewriteai_prm0) == CREATURE_ID_BUBBLE | cId(rewriteai_prm0) == CREATURE_ID_MASS_MONSTER ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cbitmod CHARA_BIT_SPLIT_KEEP_EFFECT, rewriteai_prm0, TRUE
		}
		else {
			cbitmod CHARA_BIT_SPLIT_KEEP_EFFECT, rewriteai_prm0, FALSE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_CLEANER ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_THROW_POTION_SALT
		}
		else {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_MELEE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_CUBE ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cbitmod CHARA_BIT_SPLIT_NO_EFFECT, rewriteai_prm0, TRUE
		}
		else {
			cbitmod CHARA_BIT_SPLIT_NO_EFFECT, rewriteai_prm0, FALSE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_ALIEN ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = SKILL_SPACT_PREGNANT
		}
		else {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_MELEE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_EHEKATL ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = SKILL_SPACT_MEWMEWMEW
		}
		else {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = ACTION_MELEE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_GOD_INSIDE_EHEKATL ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(224, rewriteai_prm0) = 657
		}
		else {
			cdata(224, rewriteai_prm0) = -1
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_MINE_DOG ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = SKILL_SPELL_GRAVITY
		}
		else {
			cdata(STARTING_CDATA_ACT_SUB, rewriteai_prm0) = SKILL_SPACT_DROP_MINE
		}
		return
	}
	if ( cId(rewriteai_prm0) == CREATURE_ID_SILVER_EYED_WITCH ) {
		if ( ocAISpecialAction1(rewriteai_prm0) == 0 ) {
			cdata(224, rewriteai_prm0) = 454
		}
		else {
			cdata(224, rewriteai_prm0) = 648
		}
		return
	}
	return

*label_4327
	if ( gQuestStatus != QUEST_STATE_SUCCESS ) {
		txt -1, lang("あなたは少女騎士団を置き去りにした。", "You leave Knights of the Little Girls to their own devices and bravely run away.")
		gosub *label_4328
		msg_halt
	}
	ogQuestKnightsOfLittleGirls = 0
	gQuest = QUEST_TYPE_NONE, 0, 0, 0
	return

*label_4328
	gQuestStatus = QUEST_STATE_SUCCESS
	txtef COLOR_PURPLE
	txt -1, lang("あなたは少女騎士団を護れなかった。", "You have failed to protect the Knights of the Little Girls.")
	modkarma 0, -10
	decfame CHARA_PLAYER, 40
	p = stat
	txtef COLOR_RED
	txt -1, lang("名声値を" + p + "失った。", "You lose " + p + " fame.")
	return

#defcfunc exist_escorttarget int exist_escorttarget_prm0
	locvar_exist_questtarget_f = 0
	repeat 188, 57
		if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
			if ( cId(cnt) == exist_escorttarget_prm0 ) {
				locvar_exist_questtarget_f++
			}
		}
	loop
	return locvar_exist_questtarget_f

#deffunc mtencremove int mtencremove_prm0, int mtencremove_prm1, int mtencremove_prm2
	locvar_encadd_enc = mtenc(mtencremove_prm1 * 2, mtencremove_prm2)
	if ( locvar_encadd_enc == 0 ) {
		return
	}
	locvar_encadd_encp = mtenc(mtencremove_prm1 * 2 + 1, mtencremove_prm2)
	repeat 15
		if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, mtencremove_prm0) == locvar_encadd_enc ) {
			inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, mtencremove_prm0) -= locvar_encadd_encp
			if ( mtencremove_prm2 == 24 & inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, mtencremove_prm0) < 0 ) {
				inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, mtencremove_prm0) += 50
			}
			if ( mtencremove_prm2 == 7 & inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, mtencremove_prm0) < 0 ) {
				inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, mtencremove_prm0) += 50
			}
			if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, mtencremove_prm0) == 0 ) {
				inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, mtencremove_prm0) = 0
			}
			break
		}
	loop
	if ( locvar_encadd_enc < 10000 ) {
		locvar_encadd_p = locvar_encadd_enc
	}
	else {
		locvar_encadd_p = locvar_encadd_enc / 10000
	}
	iValue(mtencremove_prm0) = iValue(mtencremove_prm0) * 100 / encref(ENCREF_VALUE, locvar_encadd_p)
	sortenc mtencremove_prm0
	return

#defcfunc checkalpha str checkalpha_prm0
	namae = checkalpha_prm0
	locvar_itemname_alpha = 0
	repeat strlen(namae)
		if ( strmid(namae, cnt, 2) != "ー" & peek(namae, cnt) != 131 ) {
			locvar_itemname_alpha = 0
			break
		}
		locvar_itemname_alpha++
		continue cnt + 2
	loop
	return locvar_itemname_alpha == strlen(namae) / 2

*procMove
	movx = cX(cc)
	movy = cY(cc)
	if ( mapFeat(movx, movy) != 0 ) {
		cell_featread movx, movy
		if ( featId == CELL_FEATURE_TRAP ) {
			if ( featIdSub == CELL_SUB_FEATURE_TRAP_QUEST_MINE ) {
				if ( cbit(CHARA_BIT_FLOAT, cc) == TRUE & cGravity(cc) == 0 | cbit(CHARA_BIT_IMMUNE_MINE, cc) == TRUE ) {
					return
				}
			}
			if ( featPic != tile_trap & petcheck(cc) ) {
				gosub *label_1670
				if ( stat == 1 ) {
					revealtrap movx, movy
					featPic = tile_trap
				}
			}
			refdiff = 100 + gLevel  * 3
			if ( featPic == tile_trap ) {
				refdiff = refdiff / 3
				if ( cc < MAX_CHARA_FOLLOWER ) {
					if ( sDisarmTrap(cc) != 0 ) {
						val = gLevel 
						gosub *label_1673
						if ( stat == 1 ) {
							gosub *disarmTrap
							return
						}
						else {
							txt -1, lang(name(cc) + "は罠の解除に失敗した。", "You fail to disarm the trap.")
						}
					}
				}
			}
			gosub *label_1671
			if ( stat == 1 ) {
				if ( synccheck(cc, -1) ) {
					txt -1, lang(name(cc) + "は罠を避けた。", name(cc) + " evade" + _s(cc) + " a trap.")
				}
				if ( cc < MAX_CHARA_FOLLOWER ) {
					revealtrap movx, movy
				}
			}
			else {
				if ( cc < MAX_CHARA_FOLLOWER ) {
					revealtrap movx, movy
					snd SOUNDLIST_TRAP1
				}
				efsource = 5
				if ( synccheck(cc, -1) ) {
					txt -1, lang(aln(cc) + "罠にかかった！", name(cc) + " activate" + _s(cc) + " a trap!")
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_BLIND ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang("墨が噴き出した。", "Gallons of ink spreads.")
					}
					dmgcon cc, CONDITION_BLIND, 100 + gLevel  * 2
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_PARALYZE ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang("刺激的な匂いがただよう。", "Stimulative gas spreads.")
					}
					dmgcon cc, CONDITION_PARALYZE, 100 + gLevel  * 2
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_CONFUSION ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang("臭い匂いがたちこめた。", "Smelly gas spreads.")
					}
					dmgcon cc, CONDITION_CONFUSE, 100 + gLevel  * 2
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_TELEPORT ) {
					cell_featset movx, movy, 0
					if ( encfind(cc, ENCHANT_PREVENT_TELEPORT) != (-1) & (findbuff(cc, 62) == (-1) | have_bigench(cc, 3) == 1) | findfaction(cc, "regist", "teleport") ) {
						if ( synccheck(cc, -1) ) {
							txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
						}
						return
					}
					repeat 200
						cXnew(cc) = rnd(mWidth - 2) + 1
						cYnew(cc) = rnd(mHeight - 2) + 1
						cell_check cXnew(cc), cYnew(cc)
						if ( cellaccess == 1 ) {
							if ( synccheck(cc, -1) ) {
								snd SOUNDLIST_TELEPORT1
								txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
							}
							rowactend cc
							redraw 0
							gosub *screen_draw
							break
						}
					loop
					goto *label_3294
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_IMPALEMENT ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang("槍が地面から飛び出した。", "Several spears fly out from the ground.")
					}
					if ( cbit(CHARA_BIT_FLOAT, cc) == TRUE & cGravity(cc) == 0 ) {
						if ( synccheck(cc, -1) ) {
							txt -1, lang("しかし" + name(cc) + "には届かなかった。", "But they don't reach " + name(cc) + ".")
						}
					}
					else {
						dmghp cc, rnd(gLevel  * 2 + 10), DAMAGE_FROM_TRAP
					}
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_POISON ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang("毒ガスが噴き出した。", "Poisonous gas spreads.")
					}
					dmgcon cc, CONDITION_POISON, 100 + gLevel  * 2
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_SLEEP ) {
					if ( synccheck(cc, -1) ) {
						txt -1, lang("催眠ガスが噴き出した。", "Sleeping gas spreads.")
					}
					dmgcon cc, CONDITION_SLEEP, 100 + gLevel  * 2
				}
				if ( featIdSub == CELL_SUB_FEATURE_TRAP_QUEST_MINE ) {
					txtef COLOR_SKY_BLUE
					txt -1, lang(" *チュドーン！* ", "*kabooom*")
					aniref = 0
					animeid = ANIMATION_BALL
					anix = movx
					aniy = movy
					gosub *anime
					cell_featset movx, movy, 0
					if ( gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_7) ) {
						dmghp cc, 1000000 + gLevel  * 10000 + cHP(cc) / 2, DAMAGE_FROM_TRAP
					}
					else {
						dmghp cc, 100 + rnd(200), DAMAGE_FROM_TRAP
					}
				}
				efsource = 0
			}
		}
	}
	return

#defcfunc thousandsep str thousandsep_prm0
	if ( cfg_thousandsep == 0 ) {
		return thousandsep_prm0
	}
	dim locvar_cnvjkey_numberfmt, 6
	locvar_cnvjkey_lpdecimalsep = "."
	locvar_cnvjkey_lpthousandsep = ","
	locvar_cnvjkey_numberfmt = 0, 0, 3, varptr(locvar_cnvjkey_lpdecimalsep), varptr(locvar_cnvjkey_lpthousandsep), 1
	sdim locvar_cnvjkey_lpnumberstr
	GetNumberFormatA , , thousandsep_prm0, varptr(locvar_cnvjkey_numberfmt), varptr(locvar_cnvjkey_lpnumberstr), 64
	return locvar_cnvjkey_lpnumberstr

#deffunc searchrangeinit int searchrangeinit_prm0, int searchrangeinit_prm1, int searchrangeinit_prm2
	if ( searchrangeinit_prm2 < 1 ) {
		return 0
	}
	dim locvar_cnvjkey_checked, mWidth, mHeight
	searchrange searchrangeinit_prm0, searchrangeinit_prm1 - 1, searchrangeinit_prm2, 1
	searchrange searchrangeinit_prm0 + 1, searchrangeinit_prm1, searchrangeinit_prm2, 2
	searchrange searchrangeinit_prm0, searchrangeinit_prm1 + 1, searchrangeinit_prm2, 3
	searchrange searchrangeinit_prm0 - 1, searchrangeinit_prm1, searchrangeinit_prm2, 4
	return 1

#deffunc searchrange int searchrange_prm0, int searchrange_prm1, int searchrange_prm2, int searchrange_prm3
	if ( searchrange_prm0 < 0 | searchrange_prm1 < 0 | searchrange_prm0 >= mWidth | searchrange_prm1 >= mHeight ) {
		return
	}
	if ( searchrange_prm2 <= locvar_cnvjkey_checked(searchrange_prm0, searchrange_prm1) ) {
		return
	}
	if ( searchrange_prm2 - 1 < 0 ) {
		return
	}
	locvar_cnvjkey_checked(searchrange_prm0, searchrange_prm1) = searchrange_prm2
	inrange(searchrange_prm0, searchrange_prm1) = 1
	if ( searchrange_prm3 != 3 ) {
		searchrange searchrange_prm0, searchrange_prm1 - 1, searchrange_prm2 - 1, 1
	}
	if ( searchrange_prm3 != 4 ) {
		searchrange searchrange_prm0 + 1, searchrange_prm1, searchrange_prm2 - 1, 2
	}
	if ( searchrange_prm3 != 1 ) {
		searchrange searchrange_prm0, searchrange_prm1 + 1, searchrange_prm2 - 1, 3
	}
	if ( searchrange_prm3 != 2 ) {
		searchrange searchrange_prm0 - 1, searchrange_prm1, searchrange_prm2 - 1, 4
	}
	return

*label_4340
	csetquestboss = 2420014, 2570028, 1400025, 2300025, 3000031, 1430025, 1440024, 1450016, 1410028, 20055, 1750080, 1770080, 1780080, 250025, 260006, 270042, 320020
	csetguildmember = 289, 295, 293
	csetguildmaster = 288, 291, 292
	csetgodservant = 262, 263, 264, 260, 265, 266, 261
	return

*label_4341
	exist exedir + "data\\oo_class.csv"
	if ( strsize == (-1) ) {
		dialog lang("dataフォルダにoo_class.csvが存在しません。", "oo_class.csv is missing from data folder.")
		goto *exit_game
	}
	notesel buff
	noteload exedir + "data\\oo_class.csv"
	userline = noteinfo(0) - 2
	buff += userclass
	sdim classnamecsv, 64, noteinfo(0) - 2, 2
	sdim classdescriptioncsv, 300, noteinfo(0) - 2, 2
	dim classplayable, noteinfo(0) - 2
	dim classstr, noteinfo(0) - 2
	dim classend, noteinfo(0) - 2
	dim classdex, noteinfo(0) - 2
	dim classper, noteinfo(0) - 2
	dim classler, noteinfo(0) - 2
	dim classwil, noteinfo(0) - 2
	dim classmag, noteinfo(0) - 2
	dim classchr, noteinfo(0) - 2
	dim classspd, noteinfo(0) - 2
	dim classequip, noteinfo(0) - 2
	dim classskillcsv, noteinfo(0) - 2, 30
	dim classspact, noteinfo(0) - 2, 22
	dim classguild, noteinfo(0) - 2
	dim classtool, noteinfo(0) - 2
	dim classtrait, noteinfo(0) - 2, 10
	sdim splitcsv, 64, 20, 2
	noteget s, 0
	csvstr2d splitcsv, 0, s, 20
	repeat noteinfo(0) - 2
		cnt2 = cnt
		if ( cnt2 >= userline ) {
			notesel userclassfield
			noteget buff2, cnt2 - userline
			csvstr2d splitcsv, 0, buff2, 20
			noteunsel
		}
		noteget buff2, cnt2 + 2
		csvstr2d splitcsv, 1, buff2, 20
		classnamecsv(cnt2, 0) = getcsvfield(splitcsv, "name")
		classnamecsv(cnt2, 1) = getcsvfield(splitcsv, "id")
		if ( en ) {
			classnamecsv(cnt2, 0) = classnamecsv(cnt2, 1)
		}
		classplayable(cnt2) = int(getcsvfield(splitcsv, "playable"))
		classstr(cnt2) = int(getcsvfield(splitcsv, "str"))
		classend(cnt2) = int(getcsvfield(splitcsv, "end"))
		classdex(cnt2) = int(getcsvfield(splitcsv, "dex"))
		classper(cnt2) = int(getcsvfield(splitcsv, "per"))
		classler(cnt2) = int(getcsvfield(splitcsv, "ler"))
		classwil(cnt2) = int(getcsvfield(splitcsv, "wil"))
		classmag(cnt2) = int(getcsvfield(splitcsv, "mag"))
		classchr(cnt2) = int(getcsvfield(splitcsv, "chr"))
		classspd(cnt2) = int(getcsvfield(splitcsv, "spd"))
		classequip(cnt2) = int(getcsvfield(splitcsv, "equip"))
		classguild(cnt2) = int(getcsvfield(splitcsv, "guild"))
		classtool(cnt2) = int(getcsvfield(splitcsv, "tool"))
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "skill")
		split s, "|", s
		repeat 30
			if ( s(cnt) == "" ) {
				break
			}
			classskillcsv(cnt2, cnt) = int(s(cnt))
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "spact")
		split s, "|", s
		repeat 22
			if ( s(cnt) == "" ) {
				break
			}
			p = int(s(cnt))
			if ( p == 464 | p == 441 | p == 660 | p == 657 | p == 900 | p == 901 | p == 902 | p == 903 | p == 797 | p == 904 | p == 798 ) {
				p = -1
			}
			classspact(cnt2, cnt) = p
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "trait")
		split s, "|", s
		repeat 10
			if ( s(cnt) == "" ) {
				break
			}
			classtrait(cnt2, cnt) = int(s(cnt))
		loop
		classdescriptioncsv(cnt2, 0) = getcsvfield(splitcsv, "description")
		classdescriptioncsv(cnt2, 1) = getcsvfield(splitcsv, "desc-e")
	loop
	noteunsel
	return

*label_4346
	exist exedir + "data\\o_race.csv"
	if ( strsize == (-1) ) {
		dialog "dataフォルダにo_race.csvが存在しません。"
		goto *exit_game
	}
	exist exedir + "data\\nc_race.csv"
	if ( strsize == (-1) ) {
		dialog "dataフォルダにnc_race.csvが存在しません。"
		goto *exit_game
	}
	notesel buff
	noteload exedir + "data\\o_race.csv"
	notesel buff2
	noteload exedir + "data\\nc_race.csv"
	buff += buff2
	buff2 = ""
	notesel buff
	userline = noteinfo(0) - 2
	buff += userrace
	sdim racenamecsv, 64, noteinfo(0) - 2, 2
	sdim racefigurecsv, 64, noteinfo(0) - 2
	sdim racedescriptioncsv, 300, noteinfo(0) - 2, 2
	dim raceid2, noteinfo(0) - 2
	dim raceplayable, noteinfo(0) - 2
	dim racesex, noteinfo(0) - 2
	dim racepic, noteinfo(0) - 2
	dim racepic2, noteinfo(0) - 2
	dim racedv, noteinfo(0) - 2
	dim racepv, noteinfo(0) - 2
	dim racehp, noteinfo(0) - 2
	dim racemp, noteinfo(0) - 2
	dim racestr, noteinfo(0) - 2
	dim raceend, noteinfo(0) - 2
	dim racedex, noteinfo(0) - 2
	dim raceper, noteinfo(0) - 2
	dim raceler, noteinfo(0) - 2
	dim racewil, noteinfo(0) - 2
	dim racemag, noteinfo(0) - 2
	dim racechr, noteinfo(0) - 2
	dim racespd, noteinfo(0) - 2
	dim racemeleestyle, noteinfo(0) - 2
	dim racecaststyle, noteinfo(0) - 2
	dim raceresist, noteinfo(0) - 2
	dim raceagernd, noteinfo(0) - 2
	dim raceage, noteinfo(0) - 2
	dim raceblood, noteinfo(0) - 2
	dim racebreeder, noteinfo(0) - 2
	dim raceheight, noteinfo(0) - 2
	dim raceskillcsv, noteinfo(0) - 2, 30
	dim racespact, noteinfo(0) - 2, 22
	dim racetrait, noteinfo(0) - 2, 10
	sdim splitcsv, 64, 40, 2
	noteget s, 0
	csvstr2d splitcsv, 0, s, 40
	repeat noteinfo(0) - 2
		cnt2 = cnt
		if ( cnt2 >= userline ) {
			notesel userracefield
			noteget buff2, cnt2 - userline
			csvstr2d splitcsv, 0, buff2, 40
			noteunsel
		}
		noteget buff2, cnt2 + 2
		csvstr2d splitcsv, 1, buff2, 40
		racenamecsv(cnt2, 0) = getcsvfield(splitcsv, "name")
		racenamecsv(cnt2, 1) = getcsvfield(splitcsv, "id")
		if ( racenamecsv(cnt2, 1) == "kobold" ) {
			racenamecsv(cnt2, 1) = "kobolt"
		}
		if ( en ) {
			racenamecsv(cnt2, 0) = racenamecsv(cnt2, 1)
		}
		if ( racenamecsv(cnt2, 0) == "kobolt" ) {
			racenamecsv(cnt2, 0) = "kobold"
		}
		raceid2(cnt2) = int(getcsvfield(splitcsv, "id2"))
		raceplayable(cnt2) = int(getcsvfield(splitcsv, "playable"))
		racesex(cnt2) = int(getcsvfield(splitcsv, "sex"))
		racepic(cnt2) = int(getcsvfield(splitcsv, "pic"))
		racepic2(cnt2) = int(getcsvfield(splitcsv, "pic2"))
		racedv(cnt2) = int(getcsvfield(splitcsv, "dv"))
		if ( racedv(cnt2) == 0 ) {
			racedv(cnt2) = 100
		}
		racepv(cnt2) = int(getcsvfield(splitcsv, "pv"))
		if ( racepv(cnt2) == 0 ) {
			racepv(cnt2) = 100
		}
		racehp(cnt2) = int(getcsvfield(splitcsv, "hp"))
		racemp(cnt2) = int(getcsvfield(splitcsv, "mp"))
		racestr(cnt2) = int(getcsvfield(splitcsv, "str"))
		raceend(cnt2) = int(getcsvfield(splitcsv, "end"))
		racedex(cnt2) = int(getcsvfield(splitcsv, "dex"))
		raceper(cnt2) = int(getcsvfield(splitcsv, "per"))
		raceler(cnt2) = int(getcsvfield(splitcsv, "ler"))
		racewil(cnt2) = int(getcsvfield(splitcsv, "wil"))
		racemag(cnt2) = int(getcsvfield(splitcsv, "mag"))
		racechr(cnt2) = int(getcsvfield(splitcsv, "chr"))
		racespd(cnt2) = int(getcsvfield(splitcsv, "spd"))
		racemeleestyle(cnt2) = int(getcsvfield(splitcsv, "meleeStyle"))
		racecaststyle(cnt2) = int(getcsvfield(splitcsv, "castStyle"))
		raceresist(cnt2) = int(getcsvfield(splitcsv, "resist"))
		raceagernd(cnt2) = int(getcsvfield(splitcsv, "ageRnd"))
		raceage(cnt2) = int(getcsvfield(splitcsv, "age"))
		raceblood(cnt2) = int(getcsvfield(splitcsv, "blood"))
		racebreeder(cnt2) = int(getcsvfield(splitcsv, "breeder"))
		raceheight(cnt2) = int(getcsvfield(splitcsv, "height"))
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "skill")
		split s, "|", s
		repeat 30
			if ( s(cnt) == "" ) {
				break
			}
			raceskillcsv(cnt2, cnt) = int(s(cnt))
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "spact")
		split s, "|", s
		repeat 22
			if ( s(cnt) == "" ) {
				break
			}
			p = int(s(cnt))
			if ( p == 464 | p == 441 | p == 660 | p == 657 | p == 900 | p == 901 | p == 902 | p == 903 | p == 797 | p == 904 | p == 798 ) {
				p = -1
			}
			racespact(cnt2, cnt) = p
		loop
		sdim s, 160, 40
		s = getcsvfield(splitcsv, "trait")
		split s, "|", s
		repeat 10
			if ( s(cnt) == "" ) {
				break
			}
			racetrait(cnt2, cnt) = int(s(cnt))
		loop
		racefigurecsv(cnt2) = getcsvfield(splitcsv, "figure")
		racedescriptioncsv(cnt2, 0) = getcsvfield(splitcsv, "description")
		racedescriptioncsv(cnt2, 1) = getcsvfield(splitcsv, "desc-e")
	loop
	noteunsel
	return

*label_4351
	notesel buff
	noteload "o_creature.csv"
	maxcharaid = noteinfo(0) - 1
	dim creaturepic, maxcharaid, 2
	dim creaturecolor, maxcharaid
	sdim splitcsv, 64, 50, 2
	noteget s, 0
	csvstr2d splitcsv, 0, s, 50
	repeat maxcharaid
		cnt2 = cnt
		noteget buff2, cnt2 + 1
		csvstr2d splitcsv, 1, buff2, 50
		creaturepic(cnt2, 0) = int(getcsvfield(splitcsv, "pic"))
		creaturepic(cnt2, 1) = int(getcsvfield(splitcsv, "pic2"))
		if ( creaturepic(cnt2, 1) == 0 ) {
			creaturepic(cnt2, 1) = creaturepic(cnt2, 0)
		}
		creaturecolor(cnt2) = int(getcsvfield(splitcsv, "color"))
	loop
	noteunsel
	return

*label_4353
	snd SOUNDLIST_CHARA
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat useritemmax
		if ( instr(useritemdatan(6, cnt), 0, "_tmp_") == (-1) ) {
			continue
		}
		if ( instr(useritemdatan(3, cnt), 0, "/nodownload/") != (-1) ) {
			continue
		}
		list(0, listmax) = listmax
		listn(0, listmax) = lang(useritemdatan(1, cnt) + "(" + useritemdatan(0, cnt) + ")", useritemdatan(0, cnt)), useritemdatan(6, cnt)
		listmax++
	loop
	txt -1, lang("どのアイテムを召喚したいと願うか？", "Which one do you wish to summon?")
	windowshadow = 1
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4356
	redraw 0
	s = lang("カスタムアイテム一覧", "Custom Item"), lang("決定 [召喚]  ", "Enter [Summon] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("名前", "Name"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 85, wy + 66 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if ( p != (-1) ) {
		listmax = p
		snd SOUNDLIST_PRAY1
		txt -1, listn(0, listmax) + lang("は、あなたの世界に召喚された！", " has been summoned to your world!")
		file = "" + userfile
		gosub *unzip
		bcopy exedir + "user\\" + listn(1, listmax), exedir + "user\\" + listn(0, listmax) + ".item"
		gosub *label_4258
		repeat 5480
			if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
				getitemid cnt
			}
		loop
		gosub *del_userTemp
		gosub *del_userNpc
		gosub *label_4271
		return 1
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *com_userNpc_loop_pgchk
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *com_userNpc_loop_pgchk
		}
	}
	if ( key == key_cancel ) {
		return -1
	}
	goto *label_4356
	goto *label_4364

#defcfunc rndex int rndex_prm0
	exrand_rnd locvar_check_adddamage_rtval, limit(rndex_prm0, 1, 50000)
	return locvar_check_adddamage_rtval

#defcfunc rndex2 int rndex2_prm0
	exrand_rnd locvar_check_adddamage_rtval, limit(rndex2_prm0, 1, 2000000000)
	return locvar_check_adddamage_rtval

*label_4364

#defcfunc ogbit int ogbit_prm0
	HMMBITCHECK ogdata(432), ogbit_prm0
	return abs(stat)

#deffunc ogbitmod int ogbitmod_prm0, int ogbitmod_prm1
	if ( ogbitmod_prm1 == 0 ) {
		HMMBITOFF ogdata(432), ogbitmod_prm0
		return
	}
	HMMBITON ogdata(432), ogbitmod_prm0
	return

#deffunc getuserfiledata str getuserfiledata_prm0, var getuserfiledata_prm1
	chdir exedir + "user\\"
	dirlist2h 130
	dirlist2 p, "*." + getuserfiledata_prm0, 1, 0
	dirlist2r buff
	notesel buff
	p(77) = noteinfo(0)
	if ( p(77) > 0 ) {
		sortnote buff, 1
		repeat p(77)
			noteget s, cnt
			csvstr2 s, s
			userfilelist(0, getuserfiledata_prm1) = s(0)
			userfilelist(1, getuserfiledata_prm1) = exedir + "user\\" + s(1)
			getuserfiledata_prm1++
		loop
	}
	noteunsel
	chdir exedir
	return

#deffunc cleanuserdir str cleanuserdir_prm0
	procid = (procid + 1) \ 10
	proclist(procid) = "[Custom] Clean up temporary files: dir=" + cleanuserdir_prm0 + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	dirlist buff, cleanuserdir_prm0 + "*.t"
	notesel buff
	repeat stat
		noteget file, cnt
		delete cleanuserdir_prm0 + file
	loop
	return

#deffunc trash_reset
	dim trashinv, 70, 400
	trashcnt = 0
	return

#deffunc trash_push int trash_push_prm0, int trash_push_prm1
	if ( trash_push_prm0 < 0 | trashcnt < 0 | length2(trashinv) <= trashcnt ) {
		return
	}
	if ( iProperty(trash_push_prm0) > PROP_NONE ) {
		return
	}
	repeat 70
		trashinv(cnt, trashcnt) = inv(cnt, trash_push_prm0)
	loop
	trashinv(0, trashcnt) += trash_push_prm1
	trashinv(5, trashcnt) = 0
	trashinv(6, trashcnt) = 0
	trashcnt++
	return

#deffunc trash_pop int trash_pop_prm0
	if ( trash_pop_prm0 < 0 | trashcnt <= 0 | length2(trashinv) < trashcnt ) {
		return
	}
	trashcnt--
	repeat 70
		inv(cnt, trash_pop_prm0) = trashinv(cnt, trashcnt)
	loop
	trashinv(0, trashcnt) = 0
	return

#deffunc trash_throw
	if ( trashcnt <= 0 | mode == MODELIST_SHOP ) {
		return
	}
	locvar_cnvjkey_prep = locvar_item_exchange_p
	preinvrange = invrange
	preinvhead = invhead
	premode = mode
	preinvfile = invfile
	invfile = 17
	file = "shoptmp17.s2"
	ctrlfile 4
	file = "shop" + 17 + ".s2"
	tmpload "" + file
	exist exedir + "tmp\\" + file
	if ( strsize != (-1) ) {
		ctrlfile 3
	}
	else {
		inv_getheader -1
		repeat invrange, invhead
			iNum(cnt) = 0
		loop
	}
	mode = MODELIST_SHOP
	repeat length2(trashinv)
		if ( trashcnt <= 0 ) {
			break
		}
		trashid = inv_getfreeid(-1)
		if ( trashid == (-1) ) {
			item_compress 10
			trashid = inv_getfreeid(-1)
			if ( trashid == (-1) ) {
				break
			}
		}
		trash_pop trashid
		item_stack -1, trashid
	loop
	file = "shop" + 17 + ".s2"
	ctrlfile 4
	file = "shoptmp17.s2"
	ctrlfile 3
	mode = premode
	invfile = preinvfile
	invhead = preinvhead
	invrange = preinvrange
	locvar_item_exchange_p = locvar_cnvjkey_prep
	return

#deffunc trash_clear
	locvar_cnvjkey_prep = locvar_item_exchange_p
	preinvrange = invrange
	preinvhead = invhead
	premode = mode
	preinvfile = invfile
	invfile = 17
	file = "shoptmp17.s2"
	ctrlfile 4
	file = "shop" + 17 + ".s2"
	tmpload "" + file
	exist exedir + "tmp\\" + file
	if ( strsize != (-1) ) {
		ctrlfile 3
	}
	else {
		inv_getheader -1
		repeat invrange, invhead
			iNum(cnt) = 0
		loop
	}
	mode = MODELIST_SHOP
	trashremovecnt = 0
	inv_getheader -1
	repeat invrange, invhead
		if ( iNum(cnt) != 0 ) {
			iNum(cnt) = 0
			trashremovecnt++
		}
	loop
	if ( trashremovecnt > 0 ) {
		txt -1, lang("ゴミ箱の中身を捨てた。", "Garbage disposal from trash.")
	}
	file = "shop" + 17 + ".s2"
	ctrlfile 4
	file = "shoptmp17.s2"
	ctrlfile 3
	mode = premode
	invfile = preinvfile
	invhead = preinvhead
	invrange = preinvrange
	locvar_item_exchange_p = locvar_cnvjkey_prep
	return

*label_4382
	dmgdisplayflag = 0
	repeat 8 + 8
		if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) == 0 ) {
			break
		}
		if ( cExist(tc) != CHAR_STATE_ALIVE ) {
			break
		}
		if ( orgdmg <= 1 ) {
			break
		}
		if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) < 29 | ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) > 39 ) {
			continue
		}
		ele = ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3, cc) + 21
		dmgType = 1
		dmghp tc, rndex(int(double(orgdmg) * (100 + ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 1, cc)) / 1000 + 1)) + 5, cc, ele, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + cnt * 3 + 1, cc) / 2 + 100
		subdmg = 0
		ele = SKILL_NONE
		continue
	loop
	if ( gettrait(cc, 60) == 2 ) {
		s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
		if ( instr(s, 0, "/wild/") != (-1) ) {
			dmgType = 1
			dmghp tc, orgdmg / 2, cc
			subdmg = 0
		}
	}
	if ( gettrait(cc, 61) == 2 ) {
		s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
		if ( instr(s, 0, "/demon/") != (-1) ) {
			dmgType = 1
			dmghp tc, orgdmg / 2, cc
			subdmg = 0
		}
	}
	if ( gettrait(cc, 98) == 2 ) {
		s = refchara(cId(tc), DBSPEC_CHARA_FILTER, 1)
		if ( instr(s, 0, "/element/") != (-1) ) {
			dmgType = 1
			dmghp tc, orgdmg / 2, cc
			subdmg = 0
		}
	}
	return

#defcfunc getsql str getsql_prm0
	if ( lpeek(tmparr(sql_colid_(getsql_prm0, tmparr), locvar_randskill_n), strlen(tmparr(locvar_randskill_i, locvar_randskill_n)) + 4) == 1 ) {
		return int(tmparr(sql_colid_(getsql_prm0, tmparr), locvar_randskill_n))
	}
	return tmparr(sql_colid_(getsql_prm0, tmparr), locvar_randskill_n)

#deffunc outputmapimage int outputmapimage_prm0
	bkselcur = selcur
	selcur = 34
	buffer 34, mWidth * inf_tiles, mHeight * inf_tiles
	locvar_cell_draw_light = gLight
	if ( gLightSource == 1 ) {
		if ( mType >= (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) & mType <= (23 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_FORT]@!!! */) ) {
			locvar_cell_draw_light -= 50
		}
	}
	locvar_cell_draw_scrturn = scrturn / 5
	locvar_cell_draw_px = cX(CHARA_PLAYER) * inf_tiles
	locvar_cell_draw_py = cY(CHARA_PLAYER) * inf_tiles
	redraw 0
	repeat mHeight
		locvar_cell_draw_y = cnt
		locvar_cell_draw_dy = locvar_cell_draw_y * inf_tiles
		color 0, 0, 0
		repeat mWidth
			locvar_cell_draw_x = cnt
			locvar_cell_draw_dx = locvar_cell_draw_x * inf_tiles
			if ( cfg_camera == 0 | cfg_camera == 1 ) {
				if ( locvar_cell_draw_x == mWidth - 1 ) {
					if ( locvar_cell_draw_y == cY(CHARA_PLAYER) ) {
						if ( cExist(CHARA_PLAYER) == CHAR_STATE_ALIVE ) {
							locvar_cell_draw_ani = cTurn(CHARA_PLAYER) \ 4 * 32
							if ( mType == MAP_TYPE_WORLD ) {
								gmode 6, 32, 16, 85
								color 0, 0, 0
								pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 27
								grotate BUFFER_INF, 240, 384, 0, 20, 10
								gmode 2, 32, 48
								pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 14
								grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48, 0, 16, 24
							}
							else {
								if ( cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) ) {
									gmode 2, 48, 96, 80
									pos locvar_cell_draw_px + 26 - 11, locvar_cell_draw_py - 32 + 11
									func_2 1, 96, 816, -80, 48, 96
									pos locvar_cell_draw_px, locvar_cell_draw_py - 63
									gcopy BUFFER_ITEM, 96, 816, 48, 96
									locvar_cell_draw_py -= 24
								}
								if ( chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER & cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) == FALSE ) {
									gmode 4, 32, 20, 146
									color 0, 0, 0
									pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 36
									grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48 + 28, 0, 24 + cfg_graphicpc * 8, 16 + cfg_graphicpc * 4
									gmode 2, 32, 28
									pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 16
									grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48, 0, 24 + cfg_graphicpc * 8, 24 + cfg_graphicpc * 4
								}
								else {
									gmode 6, , , 110
									color 0, 0, 0
									pos locvar_cell_draw_px + 8, locvar_cell_draw_py + 20 + cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) * 24
									gcopy BUFFER_INF, 240, 384, 32, 16
									gmode 2, 32, 48
									pos locvar_cell_draw_px + 24, locvar_cell_draw_py + 8
									grotate BUFFER_PCC, locvar_cell_draw_ani, cDir(CHARA_PLAYER) * 48, 0, 24 + cfg_graphicpc * 8, 40 + cfg_graphicpc * 8
								}
								if ( cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER) ) {
									pos locvar_cell_draw_px, locvar_cell_draw_py
									gcopy BUFFER_ITEM, 96, 768, 48, 48
									locvar_cell_draw_py += 24
								}
							}
							gmode 2
							color 0, 0, 0
							if ( cAngry(CHARA_PLAYER) != 0 ) {
								pos locvar_cell_draw_px, locvar_cell_draw_py - 24 - 24 * cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER)
								gcopy BUFFER_INF, 32, 608, 16, 16
							}
							if ( cEmoIcon(CHARA_PLAYER) != 0 ) {
								draw_emo 0, locvar_cell_draw_px + 4, locvar_cell_draw_py - 32 - 24 * cbit(CHARA_BIT_SANDBAG, CHARA_PLAYER)
							}
						}
					}
				}
			}
			locvar_cell_draw_ground = mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y)
			locvar_cell_draw_sel = 2
			gmode 0, inf_tiles, inf_tiles
			pos locvar_cell_draw_dx, locvar_cell_draw_dy
			locvar_cell_draw_wall = 0
			if ( chipm(CHIPM_WALL, locvar_cell_draw_ground) == 2 ) {
				if ( locvar_cell_draw_y < mHeight - 1 ) {
					if ( chipm(CHIPM_WALL, mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y + 1)) != 2 ) {
						if ( mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y + 1) != tile_fog ) {
							locvar_cell_draw_ground += 33
						}
					}
				}
			}
			if ( chipm(CHIPM_WALL, locvar_cell_draw_ground) ) {
				locvar_cell_draw_wall = 1
			}
			if ( chipm(CHIPM_ANIM, locvar_cell_draw_ground) != 0 ) {
				gcopy locvar_cell_draw_sel, (locvar_cell_draw_ground \ 33 + (locvar_cell_draw_scrturn \ (chipm(CHIPM_ANIM, locvar_cell_draw_ground) + 1) - (locvar_cell_draw_scrturn \ (chipm(CHIPM_ANIM, locvar_cell_draw_ground) + 1) == chipm(CHIPM_ANIM, locvar_cell_draw_ground)) * 2 * (chipm(CHIPM_ANIM, locvar_cell_draw_ground) != 0))) * inf_tiles, locvar_cell_draw_ground / 33 * inf_tiles
			}
			else {
				gcopy locvar_cell_draw_sel, locvar_cell_draw_ground \ 33 * inf_tiles, locvar_cell_draw_ground / 33 * inf_tiles
			}
			gmode 2, inf_tiles, inf_tiles
			if ( mapFragment(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				locvar_cell_draw_p = mapFragment(locvar_cell_draw_x, locvar_cell_draw_y) \ 10, mapFragment(locvar_cell_draw_x, locvar_cell_draw_y) / 10
				if ( locvar_cell_draw_p(1) ) {
					gcopy BUFFER_CHR, locvar_cell_draw_p(1) * inf_tiles + 288, 1152
				}
				if ( locvar_cell_draw_p ) {
					if ( locvar_cell_draw_p > 6 ) {
						locvar_cell_draw_p = 6
					}
					gcopy BUFFER_CHR, locvar_cell_draw_p * inf_tiles, 1152
				}
			}
			if ( efmap(1, locvar_cell_draw_x, locvar_cell_draw_y) > 0 ) {
				locvar_cell_draw_p = efmap(0, locvar_cell_draw_x, locvar_cell_draw_y)
				if ( mefsubref(MEFSUBREF_TYPE, locvar_cell_draw_p) == 1 ) {
					gmode 4, 32, 32, efmap(1, locvar_cell_draw_x, locvar_cell_draw_y) * 12 + 30
					pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
					grotate BUFFER_INF, mefsubref(MEFSUBREF_X, locvar_cell_draw_p) + efmap(3, locvar_cell_draw_x, locvar_cell_draw_y) * 32, mefsubref(MEFSUBREF_Y, locvar_cell_draw_p), 0.785 * efmap(2, locvar_cell_draw_x, locvar_cell_draw_y), 32, 32
				}
				else {
					gmode 4, 32, 32, 150
					pos locvar_cell_draw_dx + 8, locvar_cell_draw_dy + 8
					gcopy BUFFER_INF, mefsubref(MEFSUBREF_X, locvar_cell_draw_p) + efmap(1, locvar_cell_draw_x, locvar_cell_draw_y) * 32, mefsubref(MEFSUBREF_Y, locvar_cell_draw_p)
				}
				gmode 2, inf_tiles, inf_tiles
			}
			if ( mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
				locvar_cell_draw_p = mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) \ 1000
				if ( locvar_cell_draw_p != 999 & locvar_cell_draw_p != 0 ) {
					pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipm(CHIPM_F, locvar_cell_draw_p)
					gcopy BUFFER_MAP, locvar_cell_draw_p \ 33 * inf_tiles, locvar_cell_draw_p / 33 * inf_tiles, inf_tiles, 48 + chipm(CHIPM_H, locvar_cell_draw_p)
				}
				if ( mType == MAP_TYPE_WORLD ) {
					locvar_cell_draw_p = mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) / 100000 \ 100 + mapFeat(locvar_cell_draw_x, locvar_cell_draw_y) / 10000000 * 100
					if ( areaId(locvar_cell_draw_p) == AREA_RANDOM_DUNGEON ) {
						if ( areaDeepest(locvar_cell_draw_p) == areaCanSave(locvar_cell_draw_p) ) {
							pos locvar_cell_draw_dx + 16, locvar_cell_draw_dy - 16
							gcopy BUFFER_INF, 32, 624, 16, 16
						}
						else {
							if ( areaDeepest(locvar_cell_draw_p) != 0 ) {
								pos locvar_cell_draw_dx + 16, locvar_cell_draw_dy - 16
								gcopy BUFFER_INF, 48, 624, 16, 16
							}
						}
					}
				}
			}
			if ( cfg_camera == 0 | cfg_camera == 2 ) {
				if ( areaId(gArea ) == AREA_HOME | areaId(gArea ) == AREA_DUNGEON | areaId(gArea ) > 100 ) {
					if ( oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0) != 0 ) {
						if ( cfg_useffhp == 1 ) {
							preparepicitemexoom
							locvar_cell_draw_p = stat
							if ( cfg_objectshadow ) {
								if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
									gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 80
									if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
										pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22
										if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
											func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										}
									}
									else {
										pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46
										func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
									gmode 2
								}
							}
							pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
							if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
								gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							}
							else {
								gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							}
						}
						else {
							locvar_cell_draw_p = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 1)
							locvar_cell_draw_i = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 3)
							gsel BUFFER_ITEM
							color 0
							boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
							pos 0, 960
							gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							gfdec2 c_col(0, locvar_cell_draw_i), c_col(1, locvar_cell_draw_i), c_col(2, locvar_cell_draw_i)
							gsel selcur
							if ( cfg_objectshadow ) {
								if ( chipi(CHIPI_SH, locvar_cell_draw_p) ) {
									gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p), 80
									if ( chipi(CHIPI_HEIGHT, locvar_cell_draw_p) == inf_tiles ) {
										pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 80 + 2, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22
										if ( chipi(CHIPI_F, locvar_cell_draw_p) < 24 ) {
											func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) / 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										}
									}
									else {
										pos locvar_cell_draw_dx + chipi(CHIPI_WIDTH, locvar_cell_draw_p) / 2 + chipi(CHIPI_SH, locvar_cell_draw_p) / 4, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 46
										func_1 1, 0, 960, chipi(CHIPI_SH, locvar_cell_draw_p) * 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
									gmode 2
								}
							}
							pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
							if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
								gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							}
							else {
								gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
							}
						}
					}
				}
				if ( mapMef(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
					locvar_cell_draw_p2 = mapMef(locvar_cell_draw_x, locvar_cell_draw_y) - 1
					locvar_cell_draw_p = mefPic(locvar_cell_draw_p2) \ 10000, mefPic(locvar_cell_draw_p2) / 10000
					pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
					if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) ) {
						locvar_cell_draw_p += (locvar_cell_draw_scrturn + locvar_cell_draw_p2) \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - ((locvar_cell_draw_scrturn + locvar_cell_draw_p2) \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)
					}
					if ( mefPic(locvar_cell_draw_p2) > 10000 ) {
						gsel BUFFER_ITEM
						color 0
						boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
						if ( locvar_cell_draw_p == 528 ) {
							gmode 2
							pos 0, 960
							gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
							pos 0, 1008
							gzoom 22, 20, 5 + 90 * (locvar_cell_draw_p(1) > 660 & locvar_cell_draw_p(1) < 825), chipc(CHIPC_X, locvar_cell_draw_p(1)) + 8, chipc(CHIPC_Y, locvar_cell_draw_p(1)) + 4 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 8, chipc(CHIPC_WIDTH, locvar_cell_draw_p(1)) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) - 8 - (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 10, 1
							pos 6, 974
							gcopy BUFFER_ITEM, 0, 1008, 22, 20
							gsel selcur
						}
						else {
							if ( locvar_cell_draw_p == 531 ) {
								pos 8, 1058 - chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1))
								gcopy 5 + 90 * (locvar_cell_draw_p(1) > 660 & locvar_cell_draw_p(1) < 825), chipc(CHIPC_X, locvar_cell_draw_p(1)) + 8, chipc(CHIPC_Y, locvar_cell_draw_p(1)) + 2, chipc(CHIPC_WIDTH, locvar_cell_draw_p(1)) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) - 8
								gmode 4, , , 150
								color 0, 0, 0
								pos 0, 960 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) == inf_tiles) * 48
								gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) + (chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1)) > inf_tiles) * 48
								gmode 2
								gsel selcur
							}
							else {
								if ( locvar_cell_draw_p == 529 ) {
									pos 0, 1056 - chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1))
									gcopy 5 + 90 * (locvar_cell_draw_p(1) > 660 & locvar_cell_draw_p(1) < 825), chipc(CHIPC_X, locvar_cell_draw_p(1)), chipc(CHIPC_Y, locvar_cell_draw_p(1)), chipc(CHIPC_WIDTH, locvar_cell_draw_p(1)), chipc(CHIPC_HEIGHT, locvar_cell_draw_p(1))
									gmode 2
									gsel selcur
								}
								else {
									pos 0, 960
									gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									gfdec2 c_col(0, locvar_cell_draw_p(1)), c_col(1, locvar_cell_draw_p(1)), c_col(2, locvar_cell_draw_p(1))
									gsel selcur
								}
							}
						}
						gcopy BUFFER_ITEM, 0, 960, inf_tiles, inf_tiles
					}
					else {
						gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), inf_tiles, inf_tiles
					}
				}
				if ( cfg_useffhp ) {
					if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
						if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) < 0 ) {
							locvar_cell_draw_p = -mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y)
							locvar_cell_draw_flooritem = locvar_cell_draw_p \ 1000 + 5080, locvar_cell_draw_p / 1000 \ 1000 + 5080, locvar_cell_draw_p / 1000000 \ 1000 + 5080
							locvar_cell_draw_stackh = 0
							repeat 3
								locvar_cell_draw_cnt2 = 2 - cnt
								if ( locvar_cell_draw_flooritem(locvar_cell_draw_cnt2) == 999 + 5080 ) {
									continue
								}
								preparepicitemex locvar_cell_draw_flooritem(locvar_cell_draw_cnt2)
								locvar_cell_draw_p = stat
								if ( mType == MAP_TYPE_WORLD ) {
									gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24 - locvar_cell_draw_stackh / 2
									grotate BUFFER_ITEM, 0, 960, 0, 24, 24
								}
								else {
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) - locvar_cell_draw_stackh
									if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
										gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
									else {
										gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
								}
								locvar_cell_draw_stackh += chipi(CHIPI_S, locvar_cell_draw_p)
								if ( locvar_cell_draw_p == 531 | locvar_cell_draw_p == 529 ) {
									if ( chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == 96 ) {
										locvar_cell_draw_stackh += 44
									}
								}
							loop
						}
						else {
							if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) == 363 ) {
								locvar_cell_draw_p = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 0)
								locvar_cell_draw_i = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 2)
								preparepicitem_func locvar_cell_draw_p, locvar_cell_draw_i
							}
							else {
								if ( mapinv(locvar_cell_draw_x, locvar_cell_draw_y) != (-1) & mapinv(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
									preparepicitemex mapinv(locvar_cell_draw_x, locvar_cell_draw_y) - 1
									locvar_cell_draw_p = stat
								}
								else {
									locvar_cell_draw_p = -1
								}
							}
							if ( locvar_cell_draw_p != (-1) ) {
								if ( mType == MAP_TYPE_WORLD ) {
									gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
									grotate BUFFER_ITEM, 0, 960, 0, 24, 24
								}
								else {
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
									if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
										gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
									else {
										gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
								}
							}
						}
					}
				}
				else {
					if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
						if ( mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y) < 0 ) {
							locvar_cell_draw_p = -mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y)
							locvar_cell_draw_flooritem = locvar_cell_draw_p \ 1000 + 5080, locvar_cell_draw_p / 1000 \ 1000 + 5080, locvar_cell_draw_p / 1000000 \ 1000 + 5080
							locvar_cell_draw_stackh = 0
							repeat 3
								locvar_cell_draw_cnt2 = 2 - cnt
								if ( locvar_cell_draw_flooritem(locvar_cell_draw_cnt2) == 999 + 5080 ) {
									continue
								}
								locvar_cell_draw_p = iPic(locvar_cell_draw_flooritem(locvar_cell_draw_cnt2))
								locvar_cell_draw_i = iCol(locvar_cell_draw_flooritem(locvar_cell_draw_cnt2))
								gsel BUFFER_ITEM
								color 0
								boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
								if ( locvar_cell_draw_p == 528 ) {
									gmode 2
									pos 0, 960
									gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
									pos 0, 1008
									gzoom 22, 20, 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 4 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 8, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8 - (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 10, 1
									pos 6, 974
									gcopy BUFFER_ITEM, 0, 1008, 22, 20
									gsel selcur
								}
								else {
									if ( locvar_cell_draw_p == 531 ) {
										pos 8, 1058 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
										gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 2, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8
										gmode 4, , , 150
										color 0, 0, 0
										pos 0, 960 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == inf_tiles) * 48
										gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48
										gmode 2
										gsel selcur
									}
									else {
										if ( locvar_cell_draw_p == 529 ) {
											pos 0, 1056 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
											gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i), chipc(CHIPC_Y, locvar_cell_draw_i), chipc(CHIPC_WIDTH, locvar_cell_draw_i), chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
											gmode 2
											gsel selcur
										}
										else {
											pos 0, 960
											gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
											gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
											gfdec2 c_col(0, locvar_cell_draw_i), c_col(1, locvar_cell_draw_i), c_col(2, locvar_cell_draw_i)
											gsel selcur
										}
									}
								}
								if ( mType == MAP_TYPE_WORLD ) {
									gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24 - locvar_cell_draw_stackh / 2
									grotate BUFFER_ITEM, 0, 960, 0, 24, 24
								}
								else {
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) - locvar_cell_draw_stackh
									if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
										gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
									else {
										gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
									}
								}
								locvar_cell_draw_stackh += chipi(CHIPI_S, locvar_cell_draw_p)
								if ( locvar_cell_draw_p == 531 | locvar_cell_draw_p == 529 ) {
									if ( chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == 96 ) {
										locvar_cell_draw_stackh += 44
									}
								}
							loop
						}
						else {
							locvar_cell_draw_i = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 2)
							locvar_cell_draw_p = wpeek(mapItemsMemory(locvar_cell_draw_x, locvar_cell_draw_y), 0)
							gsel BUFFER_ITEM
							color 0
							boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
							if ( locvar_cell_draw_p == 528 ) {
								gmode 2
								pos 0, 960
								gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
								pos 0, 1008
								gzoom 22, 20, 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 4 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 8, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8 - (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 10, 1
								pos 6, 974
								gcopy BUFFER_ITEM, 0, 1008, 22, 20
								gsel selcur
							}
							else {
								if ( locvar_cell_draw_p == 531 ) {
									pos 8, 1058 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
									gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i) + 8, chipc(CHIPC_Y, locvar_cell_draw_i) + 2, chipc(CHIPC_WIDTH, locvar_cell_draw_i) - 16, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) - 8
									gmode 4, , , 150
									color 0, 0, 0
									pos 0, 960 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == inf_tiles) * 48
									gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, locvar_cell_draw_i) + (chipc(CHIPC_HEIGHT, locvar_cell_draw_i) > inf_tiles) * 48
									gmode 2
									gsel selcur
								}
								else {
									if ( locvar_cell_draw_p == 529 ) {
										pos 0, 1056 - chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
										gcopy 5 + 90 * (locvar_cell_draw_i > 660 & locvar_cell_draw_i < 825), chipc(CHIPC_X, locvar_cell_draw_i), chipc(CHIPC_Y, locvar_cell_draw_i), chipc(CHIPC_WIDTH, locvar_cell_draw_i), chipc(CHIPC_HEIGHT, locvar_cell_draw_i)
										gmode 2
										gsel selcur
									}
									else {
										pos 0, 960
										gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p), chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										gfini chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
										gfdec2 c_col(0, locvar_cell_draw_i), c_col(1, locvar_cell_draw_i), c_col(2, locvar_cell_draw_i)
										gsel selcur
									}
								}
							}
							if ( mType == MAP_TYPE_WORLD ) {
								gmode 2, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24
								grotate BUFFER_ITEM, 0, 960, 0, 24, 24
							}
							else {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
								if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
									gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
								else {
									gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
								}
							}
						}
					}
				}
			}
			if ( cfg_camera == 0 | cfg_camera == 1 ) {
				if ( mapChara(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
					locvar_cell_draw_c = mapChara(locvar_cell_draw_x, locvar_cell_draw_y) - 1
					if ( locvar_cell_draw_c != 0 ) {
						if ( cbit(CHARA_BIT_PCC, locvar_cell_draw_c) == TRUE ) {
							if ( cfg_npcwalk == 1 ) {
								locvar_cell_draw_ani = cTurn(locvar_cell_draw_c) \ 4 * 32
							}
							if ( mType == MAP_TYPE_WORLD ) {
								gmode 6, 32, 16, 85
								color 0, 0, 0
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 27
								grotate BUFFER_INF, 240, 384, 0, 20, 10
								gmode 2, 32, 48
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 14
								grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48, 0, 16, 24
							}
							else {
								if ( chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER ) {
									gmode 4, 32, 20, 146
									color 0, 0, 0
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 36
									grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48 + 28, 0, 24 + cfg_graphicnpc * 8, 16 + cfg_graphicnpc * 4
									gmode 2, 32, 28
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 16
									grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48, 0, 24 + cfg_graphicnpc * 8, 24 + cfg_graphicnpc * 4
								}
								else {
									gmode 6, , , 110
									color 0, 0, 0
									pos locvar_cell_draw_dx + 8, locvar_cell_draw_dy + 20
									gcopy BUFFER_INF, 240, 384, 32, 16
									gmode 2, 32, 48
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 8
									grotate 10 + locvar_cell_draw_c, locvar_cell_draw_ani, cDir(locvar_cell_draw_c) * 48, 0, 24 + cfg_graphicnpc * 8, 40 + cfg_graphicnpc * 8
								}
							}
							gmode 2
							color 0, 0, 0
							if ( cAngry(locvar_cell_draw_c) != 0 ) {
								pos locvar_cell_draw_dx + 12, locvar_cell_draw_dy - 28
								gcopy BUFFER_INF, 32, 608, 16, 16
							}
							if ( cEmoIcon(locvar_cell_draw_c) != 0 ) {
								draw_emo locvar_cell_draw_c, locvar_cell_draw_dx + 4, locvar_cell_draw_dy - 32
							}
						}
						else {
							locvar_cell_draw_col = getcharacolor(locvar_cell_draw_c)
							locvar_cell_draw_p = getcharapic(locvar_cell_draw_c)
							if ( cbit(CHARA_BIT_SANDBAG, locvar_cell_draw_c) ) {
								gmode 2, 48, 96, 80
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - 63
								gcopy BUFFER_ITEM, 96, 816, 48, 96
								chipc(CHIPC_F, locvar_cell_draw_p) += 24
							}
							gsel BUFFER_CHR
							color 0
							boxf 0, 960, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p) + 960
							pos 0, 960
							if ( outputmapimage_prm0 == (-1) ) {
								gcopy BUFFER_CHR, 288, 144, 48, 48
							}
							else {
								if ( locvar_cell_draw_p < 33 * 25 + 900 ) {
									gcopy 5 + 90 * (locvar_cell_draw_p > 660 & locvar_cell_draw_p < 825), chipc(CHIPC_X, locvar_cell_draw_p), chipc(CHIPC_Y, locvar_cell_draw_p), chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
								}
								else {
									gcopy 35, chipc(CHIPC_X, locvar_cell_draw_p), chipc(CHIPC_Y, locvar_cell_draw_p), chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
								}
							}
							gfini chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
							gfdec2 c_col(0, locvar_cell_draw_col), c_col(1, locvar_cell_draw_col), c_col(2, locvar_cell_draw_col)
							gsel selcur
							transmissivity = 0
							dropshadowtype = 0
							if ( cId(locvar_cell_draw_c) == CREATURE_ID_USER ) {
								if ( userdata2(1, cUNID(locvar_cell_draw_c)) ) {
									transmissivity = userdata2(1, cUNID(locvar_cell_draw_c))
								}
								if ( userdata2(2, cUNID(locvar_cell_draw_c)) ) {
									dropshadowtype = userdata2(2, cUNID(locvar_cell_draw_c))
								}
							}
							if ( ocChipTransparency(locvar_cell_draw_c) ) {
								transmissivity = ocChipTransparency(locvar_cell_draw_c)
							}
							if ( ocShadowType(locvar_cell_draw_c) ) {
								dropshadowtype = ocShadowType(locvar_cell_draw_c)
							}
							if ( mType == MAP_TYPE_WORLD ) {
								if ( dropshadowtype == 0 ) {
									gmode 6, 32, 16, 85
									color 0, 0, 0
									pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 32
									grotate BUFFER_INF, 240, 384, 0, 20, 10
								}
								else {
									if ( dropshadowtype != (-1) ) {
										gmode 6, 32, 16, 85
										color 0, 0, 0
										pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 32
										grotate BUFFER_INF, 240, 384, 0, 20, 10
									}
								}
								gmode 4, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p), 256 - transmissivity
								pos locvar_cell_draw_dx + 24, locvar_cell_draw_dy + 24 - chipc(CHIPC_F, locvar_cell_draw_p) / 4
								grotate BUFFER_CHR, 0, 960, 0, 24, chipc(CHIPC_HEIGHT, locvar_cell_draw_p) / 2
								gmode 2
								if ( cEmoIcon(locvar_cell_draw_c) != 0 ) {
									draw_emo locvar_cell_draw_c, locvar_cell_draw_dx + 4, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) / 4 - 16
								}
							}
							else {
								if ( chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER ) {
									gmode 4, inf_tiles, inf_tiles, 100 - limit(transmissivity * 4 / 10, 0, 100)
									color 0, 0, 0
									pos locvar_cell_draw_dx, locvar_cell_draw_dy + 16 - chipc(CHIPC_F, locvar_cell_draw_p) - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
									gcopy BUFFER_CHR, 0, 976, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p) - 16
									gmode 4, inf_tiles, inf_tiles, 256 - transmissivity
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
									gcopy BUFFER_CHR, 0, 960, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p) - 16
									gmode 2
								}
								else {
									if ( dropshadowtype == 0 ) {
										gmode 6, , , 110
										color 0, 0, 0
										pos locvar_cell_draw_dx + 8, locvar_cell_draw_dy + 20
										gcopy BUFFER_INF, 240, 384, 32, 16
									}
									gmode 4, inf_tiles, inf_tiles, 256 - transmissivity
									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - (chipm(CHIPM_ROLE, locvar_cell_draw_ground) == MAP_CHIP_ROLE_WATER) * (-16)
									gcopy BUFFER_CHR, 0, 960, chipc(CHIPC_WIDTH, locvar_cell_draw_p), chipc(CHIPC_HEIGHT, locvar_cell_draw_p)
									gmode 2
								}
								if ( cAngry(locvar_cell_draw_c) != 0 ) {
									pos locvar_cell_draw_dx + 12, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - 12
									gcopy BUFFER_INF, 32, 608, 16, 16
								}
								if ( cEmoIcon(locvar_cell_draw_c) != 0 ) {
									draw_emo locvar_cell_draw_c, locvar_cell_draw_dx + 4, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - 16
								}
							}
							if ( cbit(CHARA_BIT_SANDBAG, locvar_cell_draw_c) ) {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - 26
								gcopy BUFFER_ITEM, 96, 768, 48, 48
								chipc(CHIPC_F, locvar_cell_draw_p) -= 24
							}
						}
					}
				}
			}
			if ( cfg_camera == 0 | cfg_camera == 2 ) {
				if ( areaId(gArea ) == AREA_HOME | areaId(gArea ) == AREA_DUNGEON | areaId(gArea ) > 100 ) {
					if ( oommap(locvar_cell_draw_x, locvar_cell_draw_y, 4) != 0 ) {
						locvar_cell_draw_p = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 4)
						if ( gHour  > 17 | gHour  < 6 | lightdata(LIGHTDATA_TIME, locvar_cell_draw_p) ) {
							if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
								locvar_cell_draw_light -= (6 - limit(dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), locvar_cell_draw_x, locvar_cell_draw_y), 0, 6)) * lightdata(LIGHTDATA_POWER, locvar_cell_draw_p)
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - lightdata(LIGHTDATA_Y, locvar_cell_draw_p)
								gmode 5, inf_tiles, inf_tiles, lightdata(LIGHTDATA_BRIGHT, locvar_cell_draw_p) + rnd(lightdata(LIGHTDATA_FLICK, locvar_cell_draw_p) + 1)
								gcopy BUFFER_INF, 192 + lightdata(LIGHTDATA_PIC, locvar_cell_draw_p) * 48 + rnd(lightdata(LIGHTDATA_ANIM, locvar_cell_draw_p) + 1) * inf_tiles, 704
							}
						}
					}
				}
				if ( mapLight(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
					locvar_cell_draw_p = mapLight(locvar_cell_draw_x, locvar_cell_draw_y)
					if ( gHour  > 17 | gHour  < 6 | lightdata(LIGHTDATA_TIME, locvar_cell_draw_p) ) {
						pos locvar_cell_draw_dx, locvar_cell_draw_dy - lightdata(LIGHTDATA_Y, locvar_cell_draw_p)
						gmode 5, inf_tiles, inf_tiles, lightdata(LIGHTDATA_BRIGHT, locvar_cell_draw_p) + rnd(lightdata(LIGHTDATA_FLICK, locvar_cell_draw_p) + 1)
						gcopy BUFFER_INF, 192 + lightdata(LIGHTDATA_PIC, locvar_cell_draw_p) * 48 + rnd(lightdata(LIGHTDATA_ANIM, locvar_cell_draw_p) + 1) * inf_tiles, 704
					}
				}
			}
			if ( cfg_camera == 0 | cfg_camera == 1 ) {
				if ( mapChara(locvar_cell_draw_x, locvar_cell_draw_y) != 0 ) {
					locvar_cell_draw_c = mapChara(locvar_cell_draw_x, locvar_cell_draw_y) - 1
					locvar_cell_draw_p = ocLight(locvar_cell_draw_c)
					if ( mapsync(locvar_cell_draw_x, locvar_cell_draw_y) == msync ) {
						locvar_cell_draw_light -= (6 - limit(dist(cX(CHARA_PLAYER), cY(CHARA_PLAYER), locvar_cell_draw_x, locvar_cell_draw_y), 0, 6)) * lightdata(LIGHTDATA_POWER, locvar_cell_draw_p)
						pos locvar_cell_draw_dx, locvar_cell_draw_dy - lightdata(LIGHTDATA_Y, locvar_cell_draw_p)
						gmode 5, inf_tiles, inf_tiles, lightdata(LIGHTDATA_BRIGHT, locvar_cell_draw_p) + rnd(lightdata(LIGHTDATA_FLICK, locvar_cell_draw_p) + 1)
						gcopy BUFFER_INF, 192 + lightdata(LIGHTDATA_PIC, locvar_cell_draw_p) * 48 + rnd(lightdata(LIGHTDATA_ANIM, locvar_cell_draw_p) + 1) * inf_tiles, 704
					}
				}
			}
			if ( locvar_cell_draw_wall == 0 ) {
				if ( locvar_cell_draw_ground != tile_fog ) {
					if ( locvar_cell_draw_y > 0 ) {
						if ( locvar_cell_draw_dy > 48 ) {
							locvar_cell_draw_ground = mapId(locvar_cell_draw_x, locvar_cell_draw_y - 1)
							if ( chipm(CHIPM_WALL, locvar_cell_draw_ground) ) {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy
								gfini inf_tiles, 24
								gfdec2 16, 16, 16
								pos locvar_cell_draw_dx, locvar_cell_draw_dy + 24
								gfini inf_tiles, 12
								gfdec2 12, 12, 12
							}
						}
					}
				}
			}
			else {
				gmode 0
				if ( locvar_cell_draw_y > 0 ) {
					locvar_cell_draw_p = mapIdMemory(locvar_cell_draw_x, locvar_cell_draw_y - 1)
					if ( chipm(CHIPM_WALL, locvar_cell_draw_p) != 2 ) {
						if ( locvar_cell_draw_p != tile_fog ) {
							if ( locvar_cell_draw_dy > 20 ) {
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - 12
								gcopy locvar_cell_draw_sel, locvar_cell_draw_ground \ 33 * inf_tiles, locvar_cell_draw_ground / 33 * inf_tiles, inf_tiles, 12
								pos locvar_cell_draw_dx, locvar_cell_draw_dy - 20
								gfini inf_tiles, 8
								gfdec2 25, 25, 25
							}
						}
					}
				}
			}
		loop
	loop
	redraw 1
	bmpsave exedir + "mapimage.bmp"
	alcreateimage_ 0, mWidth * inf_tiles, mHeight * inf_tiles
	alstretchscreentoimage 34, 0, 0, 0, 9999, 9999, 0, 0, 9999, 9999
	alsavefile_ exedir + "mapimage.png", "image/png", 0, 0, locvar_netload_imgwidth, locvar_netload_imgheight
	buffer 34, 1, 1
	selcur = bkselcur
	gsel selcur
	return

#defcfunc getcsvfield array getcsvfield_prm0, str getcsvfield_prm1
	locvar_cnvjkey_p = -1
	repeat length(getcsvfield_prm0)
		if ( getcsvfield_prm0(cnt, 0) == getcsvfield_prm1 ) {
			locvar_cnvjkey_p = cnt
			break
		}
	loop
	if ( locvar_cnvjkey_p != (-1) ) {
		return getcsvfield_prm0(locvar_cnvjkey_p, 1)
	}
	if ( getcsvfield_prm1 == "tool" ) {
		return 0
	}
	return "notFound"

#deffunc csvstr2d array csvstr2d_prm0, int csvstr2d_prm1, str csvstr2d_prm2, int csvstr2d_prm3
	locvar_cnvjkey_word = csvstr2d_prm2
	locvar_cnvjkey_p = 0
	locvar_cnvjkey_i = strlen(locvar_cnvjkey_word)
	repeat length(csvstr2d_prm0)
		csvstr2d_prm0(cnt, csvstr2d_prm1) = ""
	loop
	repeat csvstr2d_prm3
		getstr csvstr2d_prm0(cnt, csvstr2d_prm1), locvar_cnvjkey_word, limit(locvar_cnvjkey_p, 0, locvar_cnvjkey_i), 44
		if ( strsize > locvar_cnvjkey_i ) {
			break
		}
		locvar_cnvjkey_p += strsize
	loop
	return

#deffunc stopthetimebegin int stopthetimebegin_prm0
	snd SOUNDLIST_ATK_DARK
	gTimeStopTime = stopthetimebegin_prm0
	return

#deffunc grayscaletheworld
	if ( cfg_st_timestopeffect == 0 ) {
		return
	}
	if ( gTimeStopTime > 0 ) {
		gsel 36
		gmode 0
		pos 0, 0
		gcopy selcur, 0, 0, windoww, windowh - inf_verh
		gsel selcur
		gmode 0
		pos 0, 0
		gcopy 36, 0, 0, windoww, windowh - inf_verh
	}
	return

#defcfunc getcharapic int getcharapic_prm0
	if ( charaffhpflag ) {
		if ( cchipexchangetable(cId(getcharapic_prm0), cSex(getcharapic_prm0)) ) {
			if ( cPic(getcharapic_prm0) == creaturepic(cId(getcharapic_prm0), 1 - cSex(getcharapic_prm0)) + creaturecolor(cId(getcharapic_prm0)) * 1000 ) {
				return cchipexchangetable(cId(getcharapic_prm0), cSex(getcharapic_prm0)) \ 10000
			}
		}
	}
	if ( cId(getcharapic_prm0) == CREATURE_ID_USER ) {
		if ( cUNID(getcharapic_prm0) != usernpcmax ) {
			if ( cRowAct(getcharapic_prm0) != 20002 & userdata2(8, cUNID(getcharapic_prm0)) == 0 & ocbit(8, getcharapic_prm0) == 0 ) {
				return cPic(getcharapic_prm0)
			}
		}
	}
	return cPic(getcharapic_prm0) \ 1000

#defcfunc getcharacolor int getcharacolor_prm0
	if ( charaffhpflag ) {
		if ( cchipexchangetable(cId(getcharacolor_prm0), cSex(getcharacolor_prm0)) ) {
			if ( cPic(getcharacolor_prm0) == creaturepic(cId(getcharacolor_prm0), 1 - cSex(getcharacolor_prm0)) + creaturecolor(cId(getcharacolor_prm0)) * 1000 ) {
				if ( cchipexchangetable(cId(getcharacolor_prm0), cSex(getcharacolor_prm0)) / 10000 - 1 >= 0 ) {
					return cchipexchangetable(cId(getcharacolor_prm0), cSex(getcharacolor_prm0)) / 10000 - 1
				}
			}
		}
	}
	if ( cId(getcharacolor_prm0) == CREATURE_ID_USER ) {
		if ( cUNID(getcharacolor_prm0) != usernpcmax ) {
			if ( cRowAct(getcharacolor_prm0) != 20002 & userdata2(8, cUNID(getcharacolor_prm0)) == 0 & ocbit(8, getcharacolor_prm0) == 0 ) {
				return 0
			}
		}
	}
	return cPic(getcharacolor_prm0) / 1000

#deffunc addcrowd var addcrowd_prm0, int addcrowd_prm1
	addcrowd_prm0 += addcrowd_prm1
	if ( addcrowd_prm0 < 0 ) {
		addcrowd_prm0 = 0
	}
	return

#defcfunc twochoice int twochoice_prm0, int twochoice_prm1
	locvar_iequiploc_p = twochoice_prm0, twochoice_prm1
	return locvar_iequiploc_p(rnd(2))

#deffunc advdie array advdie_prm0, array advdie_prm1, array advdie_prm2, int advdie_prm3
	advdie_prm1(0, advdie_prm3) = 4
	advdie_prm1(5, advdie_prm3) = advdie_prm0(13) + advdie_prm0(12) * 24 + advdie_prm0(11) * 24 * 30 + advdie_prm0(10) * 24 * 30 * 12 + 24 + rnd(24 / 2)
	leaveparty advdie_prm2, advdie_prm3
	return

#deffunc leaveparty array leaveparty_prm0, int leaveparty_prm1
	if ( leaveparty_prm0(190, leaveparty_prm1) != 0 ) {
		if ( leaveparty_prm0(190, leaveparty_prm1) == leaveparty_prm1 ) {
			repeat 40 - 1, 16
				if ( leaveparty_prm0(190, cnt) == leaveparty_prm1 ) {
					leaveparty_prm0(190, cnt) = 0
				}
			loop
		}
		else {
			leaveparty_prm0(190, leaveparty_prm0(190, leaveparty_prm1)) = 0
			repeat 40 - 1, 16
				if ( leaveparty_prm0(190, cnt) == leaveparty_prm0(190, leaveparty_prm1) ) {
					if ( cnt != leaveparty_prm1 ) {
						leaveparty_prm0(190, leaveparty_prm0(190, leaveparty_prm1)) = leaveparty_prm0(190, leaveparty_prm1)
						break
					}
				}
			loop
			leaveparty_prm0(190, leaveparty_prm1) = 0
		}
	}
	return

#deffunc draw_drawadventurerleadername str draw_drawadventurerleadername_prm0, int draw_drawadventurerleadername_prm1
	font lang(cfg_font1, cfg_font2), 10
	pos locvar_cell_draw_dx + 22 - strlen(draw_drawadventurerleadername_prm0) * 7 / 3, locvar_cell_draw_dy - chipc(CHIPC_F, locvar_cell_draw_p) - 16
	if ( draw_drawadventurerleadername_prm1 == 2 ) {
		color 31, 31, 47
		bmes draw_drawadventurerleadername_prm0, 191, 191, 255
	}
	else {
		if ( draw_drawadventurerleadername_prm1 == 1 ) {
			color 63, 31, 31
			bmes draw_drawadventurerleadername_prm0, 255, 191, 191
		}
		else {
			color 31, 31, 31
			bmes draw_drawadventurerleadername_prm0, 255, 255, 255
		}
	}
	color
	return

#deffunc misakuraconvert var misakuraconvert_prm0, int misakuraconvert_prm1
	if ( cfg_talkconvert == 0 ) {
		return
	}
	if ( strmid(misakuraconvert_prm0, 0, 2) == "（" | strmid(misakuraconvert_prm0, 0, 1) == "(" & (strmid(misakuraconvert_prm0, -1, 2) == "）" | strmid(misakuraconvert_prm0, -1, 1) == ")") ) {
		return
	}
	if ( misakuraconvert_prm1 == 1 ) {
		locvar_cnvjkey_p = 0
		repeat 20
			await
			locvar_cnvjkey_splitpoint = instr(misakuraconvert_prm0, locvar_cnvjkey_p, "「"), instr(misakuraconvert_prm0, locvar_cnvjkey_splitpoint, "」"), strlen(misakuraconvert_prm0)
			if ( locvar_cnvjkey_splitpoint == (-1) ) {
				break
			}
			locvar_cnvjkey_splitword = strmid(misakuraconvert_prm0, locvar_cnvjkey_splitpoint, locvar_cnvjkey_splitpoint(1) + 2), strmid(misakuraconvert_prm0, 0, locvar_cnvjkey_splitpoint), strmid(misakuraconvert_prm0, locvar_cnvjkey_splitpoint + locvar_cnvjkey_splitpoint(1) + 2, locvar_cnvjkey_splitpoint(2) - locvar_cnvjkey_splitpoint(1) - locvar_cnvjkey_splitpoint)
			notesel locvar_cnvjkey_talkconvertbuff
			repeat noteinfo(0)
				noteget locvar_cnvjkey_temp, cnt
				split locvar_cnvjkey_temp, "->", locvar_cnvjkey_before, locvar_cnvjkey_after
				sreplace locvar_cnvjkey_splitword, locvar_cnvjkey_splitword, locvar_cnvjkey_before, locvar_cnvjkey_after
			loop
			noteunsel
			misakuraconvert_prm0 = locvar_cnvjkey_splitword(1) + locvar_cnvjkey_splitword + locvar_cnvjkey_splitword(2)
			locvar_cnvjkey_p = strlen(locvar_cnvjkey_splitword(1) + locvar_cnvjkey_splitword)
		loop
	}
	else {
		notesel locvar_cnvjkey_talkconvertbuff
		repeat noteinfo(0)
			noteget locvar_cnvjkey_temp, cnt
			split locvar_cnvjkey_temp, "->", locvar_cnvjkey_before, locvar_cnvjkey_after
			sreplace misakuraconvert_prm0, misakuraconvert_prm0, locvar_cnvjkey_before, locvar_cnvjkey_after
		loop
		noteunsel
	}
	convert_word misakuraconvert_prm0
	return

#deffunc loadtalkconvert
	sdim locvar_cnvjkey_talkconvertbuff, 1000
	exist exedir + "user\\talk\\talkconvert.txt"
	if ( strsize != (-1) ) {
		notesel locvar_cnvjkey_talkconvertbuff
		noteload exedir + "user\\talk\\talkconvert.txt"
		noteunsel
	}
	return

*label_4411
	allyctrl = 6
	gosub *label_2611
	if ( stat != (-1) ) {
		cc = stat
		snd SOUNDLIST_BOOK1
	}
	else {
		goto *chat_unique
	}
	buff = ""
	redraw 0
	cs = 0
	cs_bk = -1
	page = 0
	pagesize = 16
	listmax = 0
	repeat length(classnamecsv)
		if ( classplayable(cnt) ) {
			if ( classguild(cnt) != ccctrl ) {
				continue
			}
			if ( cnClass(cc) == classnamecsv(cnt, 1) ) {
				continue
			}
			listn(1, listmax) = classnamecsv(cnt, 1)
			listmax++
		}
	loop
	repeat listmax
		dbidn = listn(1, cnt)
		dbmode = DBMODE_REF
		gosub *cm_race_loop
		listn(0, cnt) = classname
	loop
	windowshadow = 1

*label_4414
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4415
	if ( cs != cs_bk ) {
		redraw 0
		s = lang("職業の選択", "Class Selection"), strhint3b
		display_window (windoww - 680) / 2 + inf_screenx, winposy(500, 1) + 20, 680, 450
		display_topic lang("選択できる職業", "Class"), wx + 28, wy + 30
		display_topic lang("職業の説明", "Detail"), wx + 188, wy + 30
		font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
		color 0, 0, 0
		repeat pagesize
			p = page * pagesize + cnt
			if ( p >= listmax ) {
				break
			}
			key_list(cnt) = key_select(cnt)
			keyrange = cnt + 1
			display_key wx + 38, wy + 66 + cnt * 19 - 2, cnt
			if ( jp ) {
				s = listn(0, p)
			}
			else {
				s = cnven(listn(1, p))
			}
			cs_list s, wx + 64, wy + 66 + cnt * 19 - 1, 19
		loop
		cs_bk = cs
		dbidn = listn(1, page * pagesize + cs)
		dbmode = DBMODE_REF_CM
		gosub *cm_race_loop
		val = 3
		gosub *cm_refer
		redraw 1
	}
	await cfg_wait1
	key_check
	cursor_check
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = page * pagesize + cnt
			break
		}
		else {
			p = -1
		}
	loop
	if ( p != (-1) ) {
		txt -1, lang(cnName(cc) + "を" + listn(0, p) + "に転職させる？", "Change " + cnName(cc) + "'s job to " + listn(0, p) + "?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval != 0 ) {
			snd SOUNDLIST_POP2
			goto *label_4414
		}
		snd SOUNDLIST_PRAY1
		txt -1, lang(cnName(cc) + "は" + listn(0, p) + "に転職した！", "Successfully changed " + cnName(cc) + "'s job to " + listn(0, p) + "!")
		cnClass(cc) = listn(1, p)
		snd SOUNDLIST_PAYGOLD1
		cGold(CHARA_PLAYER) -= calcactupgradevalue(cc)
		gosub *label_0422
		goto *chat_unique
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4414
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4414
		}
	}
	if ( key == key_cancel ) {
		goto *chat_unique
	}
	goto *label_4415

*label_4418
	if ( mType == MAP_TYPE_WORLD ) {
		if ( rnd(20) ) {
			return
		}
	}
	skillexp2 carmor(r1), r1, 3, 0, 5
	return

*label_4419
	initunid = 0
	repeat 50
		characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
		if ( cOrgRelation(rc) < RELATION_DISLIKE ) {
			chara_vanquish MAX_CHARA_NC
			dbid = 0
			continue
		}
		dbid = cId(rc)
		if ( dbid == 343 ) {
			initunid = cUNID(rc) + 1
		}
		chara_vanquish MAX_CHARA_NC
		break
	loop
	return

*label_4421
	copy_chara rc, charakind, 1
	if ( stat == 0 ) {
		return 0
	}
	addcrowd gCrowd, 1
	rc = locvar_copy_chara_c
	memset ocAIStrategy(rc), 0, 250 * 4
	cnName(rc) = lang("ドッペル", "Doppel ") + cnName(rc)
	cQuality(rc) = fixlv
	cAiSub(rc) = limitmax(cAiSub(rc), 100)
	if ( initlv != 0 ) {
		if ( fixlv == FIX_QUALITY_MIRACLE ) {
			cnName(rc) = strbracketleft + cnName(rc) + strbracketright
			initlv = initlv * 10 / 8
		}
		if ( fixlv == FIX_QUALITY_GODLY ) {
			cnName(rc) = lang("《", "{") + cnName(rc) + lang("》", "}")
			initlv = initlv * 10 / 6
		}
		lv = initlv - cLevel(rc)
		if ( lv < 0 ) {
			lv = abs(lv)
			if ( lv >= cLevel(rc) ) {
				lv = cLevel(rc) - 1
			}
			cLevel(rc) -= lv
			cExp(rc) = 0
			r1 = rc
			gosub *label_1592
			repeat 8, 10
				if ( sdata(cnt, rc) != 0 ) {
					skillexp2 cnt, rc, (-1000) * lv
				}
			loop
		}
		else {
			if ( lv > 0 ) {
				r1 = rc
				cExp(r1) = 0
				cLevel(r1) += lv
				if ( cLevelOrg(r1) < cLevel(r1) ) {
					cLevelOrg(r1) = cLevel(r1)
				}
				repeat 20 - 10, 10
					sdata(cnt + STARTING_SKILL_SPACT, r1) = 1000000 * limit(sdata(cnt + STARTING_SKILL_SPACT, r1) / 1000000 + lv, 1, 2000)
				loop
				repeat length(mainskill)
					sdata(mainskill(cnt) + STARTING_SKILL_SPACT, r1) = 1000000 * limit(sdata(mainskill(cnt) + STARTING_SKILL_SPACT, r1) / 1000000 + lv, 1, 2000)
				loop
				gosub *label_1592
			}
		}
	}
	cRelation(rc) = RELATION_ENEMY
	cOrgRelation(rc) = RELATION_ENEMY
	cbitmod CHARA_BIT_STETHOSCOPE, rc, FALSE
	cbitmod CHARA_BIT_LEASHED, rc, FALSE
	cbitmod CHARA_BIT_RIDE, rc, FALSE
	cbitmod CHARA_BIT_PRECIOUS, rc, TRUE
	ocbitmod 7, rc, 1
	ocChipTransparency(rc) = 128
	ocShadowType(rc) = -1
	if ( charakind == 0 ) {
		cAiCalm(rc) = 1
		p(99) = topattackskill(0)
		if ( p(99) == 105 | p(99) == 172 ) {
			cAiMoveFreq(rc) = 50
			cAiDistance(rc) = 3
			cequipment = 2
		}
		else {
			if ( p(99) >= 108 & p(99) <= 111 ) {
				cAiMoveFreq(rc) = 50
				cAiDistance(rc) = 2
				if ( p(99) == 110 ) {
					cequipment = 4
				}
				else {
					cequipment = 3
				}
			}
			else {
				cAiMoveFreq(rc) = 80
				cAiDistance(rc) = 1
				if ( p(99) == 101 ) {
					cequipment = 7
				}
				else {
					cequipment = 1
				}
			}
		}
		cAiSub(rc) = 50
		cActHeal(rc) = 0
		repeat 5
			p = rnd(5) + 400
			if ( sdata(p, CHARA_PLAYER) == 0 ) {
				continue
			}
			cActHeal(rc) = p
			break
		loop
		cActIndex(rc) = 55
		csetspelllistmax = 0
		if ( sCasting(CHARA_PLAYER) > 0 ) {
			p(1) = sCasting(CHARA_PLAYER) / 3
			repeat 66
				p = cnt + 400
				if ( p == 409 | p == 411 | p == 413 | p == 428 | p == 429 | p == 430 | p == 435 | p == 438 | p == 441 | p == 457 | p == 458 | p == 461 | p == 463 | p == 464 | p == 503 | p == 504 ) {
					continue
				}
				if ( ally ) {
					if ( p == 424 | p == 425 ) {
						continue
					}
				}
				if ( sdata(p, CHARA_PLAYER) < p(1) ) {
					continue
				}
				csetspelllist(csetspelllistmax) = p
				csetspelllistmax++
			loop
		}
		csetabilitylistmax = 0
		repeat 61
			if ( cnt == 29 | cnt == 30 ) {
				continue
			}
			if ( ally ) {
				if ( cnt == 42 | cnt == 41 | cnt == 39 | cnt == 40 | cnt == 43 ) {
					continue
				}
			}
			if ( spact(cnt) == 0 ) {
				continue
			}
			csetabilitylist(csetabilitylistmax) = cnt + 600
			csetabilitylistmax++
		loop
		repeat 10
			act = ACTION_MELEE
			if ( csetspelllistmax != 0 & (cequipment == 2 & rnd(3) != 0 | rnd(3) == 0) ) {
				act = csetspelllist(rnd(csetspelllistmax))
			}
			else {
				if ( csetabilitylistmax != 0 & rnd(3) == 0 ) {
					act = csetabilitylist(rnd(csetabilitylistmax))
				}
				else {
					if ( cequipment == 3 | cequipment == 4 ) {
						if ( rnd(3) ) {
							act = ACTION_RANGE
						}
						else {
							act = ACTION_WAIT_MELEE
						}
					}
				}
			}
			cdata(STARTING_CDATA_ACT_MAIN + cnt, rc) = act
		loop
	}
	else {
		cequipment = refclass(rc, DBSPEC_CLASS_EQUIP_TYPE)
	}
	charakind = 0
	creaturepack = FILTER_NOTHING
	gosub *label_1692
	gosub *charaRefresh
	cHP(rc) = cMHP(rc)
	cSP(rc) = cMSP(rc)
	cMP(rc) = cMMP(rc)
	return 1

*label_4429
	dim nrdataref, 1, 39
	sdim naturen, 20, 2, 39
	nrdataref(0, 0) = 1
	naturen(0, 0) = "adamant", "意地っ張り"
	nrdataref(0, 1) = 2
	naturen(0, 1) = "rash", "うっかりもの"
	nrdataref(0, 2) = 3
	naturen(0, 2) = "timid", "臆病"
	nrdataref(0, 3) = 4
	naturen(0, 3) = "calm", "穏やか"
	nrdataref(0, 4) = 4
	naturen(0, 4) = "mild", "おっとり"
	nrdataref(0, 5) = 4
	naturen(0, 5) = "gentle", "大人しい"
	nrdataref(0, 6) = 2
	naturen(0, 6) = "hardy", "頑張り屋"
	nrdataref(0, 7) = 2
	naturen(0, 7) = "quirky", "気まぐれ"
	nrdataref(0, 8) = 5
	naturen(0, 8) = "lonely", "寂しがり"
	nrdataref(0, 9) = 5
	naturen(0, 9) = "careful", "慎重"
	nrdataref(0, 10) = 2
	naturen(0, 10) = "docile", "素直"
	nrdataref(0, 11) = 4
	naturen(0, 11) = "bold", "図太い"
	nrdataref(0, 12) = 2
	naturen(0, 12) = "hasty", "せっかち"
	nrdataref(0, 13) = 4
	naturen(0, 13) = "bashful", "照れ屋"
	nrdataref(0, 14) = 1
	naturen(0, 14) = "sassy", "生意気"
	nrdataref(0, 15) = 4
	naturen(0, 15) = "lax", "能天気"
	nrdataref(0, 16) = 4
	naturen(0, 16) = "relaxed", "暢気"
	nrdataref(0, 17) = 4
	naturen(0, 17) = "modest", "控え目"
	nrdataref(0, 18) = 6
	naturen(0, 18) = "serious", "真面目"
	nrdataref(0, 19) = 4
	naturen(0, 19) = "naive", "無邪気"
	nrdataref(0, 20) = 4
	naturen(0, 20) = "naughty", "不真面目"
	nrdataref(0, 21) = 1
	naturen(0, 21) = "brave", "勇敢"
	nrdataref(0, 22) = 5
	naturen(0, 22) = "jolly", "陽気"
	nrdataref(0, 23) = 4
	naturen(0, 23) = "quiet", "冷静"
	nrdataref(0, 24) = 2
	naturen(0, 24) = "impish", "悪戯好き"
	nrdataref(0, 25) = 1
	naturen(0, 25) = "heat", "熱血"
	nrdataref(0, 26) = 1
	naturen(0, 26) = "honest", "実直"
	nrdataref(0, 27) = 6
	naturen(0, 27) = "foxy", "ずる賢い"
	nrdataref(0, 28) = 2
	naturen(0, 28) = "twisted", "天邪鬼"
	nrdataref(0, 29) = 4
	naturen(0, 29) = "coquettish", "甘えんぼ"
	nrdataref(0, 30) = 7
	naturen(0, 30) = "delusional", "思い込みが激しい"
	nrdataref(0, 31) = 4
	naturen(0, 31) = "idleness", "怠惰"
	nrdataref(0, 32) = 5
	naturen(0, 32) = "courteous", "礼儀正しい"
	nrdataref(0, 33) = 8
	naturen(0, 33) = "rough", "荒々しい"
	nrdataref(0, 34) = 1
	naturen(0, 34) = "stubborn", "頑固"
	nrdataref(0, 35) = 4
	naturen(0, 35) = "insensibility", "鈍感"
	nrdataref(0, 36) = 1
	naturen(0, 36) = "noble", "気高い"
	nrdataref(0, 37) = 9
	naturen(0, 37) = "masochist", "マゾヒスト"
	nrdataref(0, 38) = 10
	naturen(0, 38) = "sadist", "サディスト"
	dim csetnature, length2(naturen)
	repeat length2(naturen)
		csetnature(cnt) = cnt
	loop
	return

*label_4431
	tc -= 1
	txt -1, lang(name(cc) + "に何を任せる？ ", "Assign " + name(tc) + " to work on what?")
	repeat length2(csetwork)
		if ( areaId(gArea ) != csetwork(0, cnt) ) {
			continue
		}
		p = csetwork(1, cnt)
		if ( sdata(p, cc) == 0 ) {
			continue
		}
		s = skillname(p)
		if ( ocPetJobSkill(cc) == p ) {
			s += lang(" *請負中* ", " *Working* ")
		}
		promptl(0, promptmax) = s, "null", "" + cnt
		promptmax++
	loop
	val = promptx, prompty, 200, 1
	gosub *prompt_key
	if ( stat == 0 | rtval == (-1) ) {
		return
	}
	work = csetwork(1, rtval)
	if ( ocPetJobSkill(cc) == work ) {
		txt -1, lang(name(cc) + "を役目から外した。", "You remove " + name(cc) + " from " + his(cc) + " current work.")
		ocPetJobSkill(cc) = 0
		return
	}
	txt -1, lang(name(cc) + "に" + skillname(work) + "を任せた。", "You let " + name(cc) + " work on " + skillname(work) + ".")
	if ( work == 151 ) {
		cXorg(cc) = gWorldX
		cYorg(cc) = gWorldY
		cType(cc) = 4
	}
	else {
		cXorg(cc) = cX(cc)
		cYorg(cc) = cY(cc)
		cType(cc) = gArea 
	}
	ocdata(80, cc) = (gLevel  + 1) * (-1)
	ocPetJobSkill(cc) = work
	cRoleRestock(cc) = getgametime() + csetwork(2, rtval)
	snd SOUNDLIST_PRAY1
	return

*label_4433
	dim csetwork, 3, 12
	csetwork(0, 0) = 7, 177, 1
	csetwork(0, 1) = 7, 185, 1
	csetwork(0, 2) = 7, 178, 1
	csetwork(0, 3) = 7, 179, 1
	csetwork(0, 4) = 7, 176, 1
	csetwork(0, 5) = 7, 184, 1
	csetwork(0, 6) = 103, 180, 24
	csetwork(0, 7) = 5, 163, 24
	csetwork(0, 8) = 12, 160, 72
	csetwork(0, 9) = 14, 300, 24
	csetwork(0, 10) = 7, 159, 24
	csetwork(0, 11) = 39, 180, 24
	csetwork(0, 12) = 31, 151, 0
	return

*label_4434
	repeat 15, 1
		if ( cExist(cnt) != CHAR_STATE_ALIVE & cExist(cnt) != CHAR_STATE_ALLY_WORK ) {
			continue
		}
		if ( ocPetJobSkill(cnt) == 0 ) {
			continue
		}
		if ( getgametime() <= cRoleRestock(cnt) ) {
			continue
		}
		craftitem = 0
		if ( ocPetJobSkill(cnt) == 178 ) {
			craftitem = 127
		}
		else {
			if ( ocPetJobSkill(cnt) == 179 ) {
				craftitem = 393
			}
			else {
				if ( ocPetJobSkill(cnt) == 177 ) {
					craftitem = 160
				}
				else {
					if ( ocPetJobSkill(cnt) == 176 ) {
						craftitem = 161
					}
				}
			}
		}
		if ( craftitem ) {
			inv_find craftitem, cnt
			if ( stat == (-1) ) {
				continue
			}
			prodtype = iEffect(stat)
			listmax = 0
			creator = cnt
			cc = creator
			gosub *label_4439
			repeat getgametime() - cRoleRestock(creator)
				if ( inv_getspace(creator) == 0 ) {
					break
				}
				if ( rnd(15) ) {
					continue
				}
				olistmax = 0
				repeat listmax
					matid = list(0, cnt), list(1, cnt)
					gosub *recipe_ref
					if ( prodcheck(creator) == (-1) ) {
						continue
					}
					olist(olistmax) = matid
					olistmax++
				loop
				if ( olistmax == 0 ) {
					break
				}
				prodid = olist(rnd(olistmax))
				matid = prodid
				gosub *recipe_ref
				matexp = 0
				repeat 6
					j = matneed(cnt * 2), matneed(cnt * 2 + 1)
					if ( j == (-1) ) {
						break
					}
					mat(j) -= j(1)
					matexp += j(1) * matref(MATREF_RARITY, j)
				loop
				fixlv = FIX_QUALITY_GOOD
				if ( rnd(600 + matval(1) * 2) < sdata(matval, creator) + 20 ) {
					fixlv = FIX_QUALITY_MIRACLE
				}
				if ( rnd(300 + matval(1) * 2) < sdata(matval, creator) + 20 ) {
					fixlv = FIX_QUALITY_GREAT
				}
				flt calcobjlv(sdata(matval, creator)), calcfixlv(fixlv)
				itemcreate creator, prodid, -1, -1, 0
				item_stack creator, ci
				r1 = matval
				r2 = matexp
				cc = creator
				gosub *label_1608
			loop
			cRoleRestock(creator) = getgametime() + 1
		}
	loop
	return

*label_4439
	if ( prodtype != 5 ) {
		repeat maxitemid
			matid = cnt
			gosub *recipe_ref
			if ( stat == (-1) ) {
				continue
			}
			if ( prodtype == 2 ) {
				if ( matval != SKILL_NORMAL_ALCHEMY ) {
					continue
				}
			}
			if ( prodtype == 1 ) {
				if ( matval != SKILL_NORMAL_CARPENTRY ) {
					continue
				}
			}
			if ( prodtype == 3 ) {
				if ( matval != SKILL_NORMAL_JEWELER ) {
					continue
				}
			}
			if ( prodtype == 4 ) {
				if ( matval != SKILL_NORMAL_TAILORING ) {
					continue
				}
			}
			if ( sdata(matval, cc) + 3 < matval(1) ) {
				continue
			}
			listn(0, listmax) = "" + prodcheck(cc)
			list(0, listmax) = cnt, 0
			listmax++
		loop
		repeat 55, 10000
			matid = cnt
			gosub *recipe_ref
			if ( stat == (-1) ) {
				continue
			}
			if ( prodtype == 2 ) {
				if ( matval != SKILL_NORMAL_ALCHEMY ) {
					continue
				}
			}
			if ( prodtype == 1 ) {
				if ( matval != SKILL_NORMAL_CARPENTRY ) {
					continue
				}
			}
			if ( prodtype == 3 ) {
				if ( matval != SKILL_NORMAL_JEWELER ) {
					continue
				}
			}
			if ( prodtype == 4 ) {
				if ( matval != SKILL_NORMAL_TAILORING ) {
					continue
				}
			}
			if ( sdata(matval, cc) + 3 < matval(1) ) {
				continue
			}
			listn(0, listmax) = "" + prodcheck(cc)
			list(0, listmax) = cnt, 0
			listmax++
		loop
	}
	else {
		repeat 100, 100000
			matid = cnt
			gosub *label_1274
			if ( stat == (-1) ) {
				continue
			}
			listn(0, listmax) = ""
			list(0, listmax) = cnt, 0
			listmax++
		loop
		repeat usernpcmax, 1000000
			matid = cnt
			if ( usernpcmatval(0, matid - 1000000) == 0 | usernpcmatneed(0, matid - 1000000) == (-1) ) {
				continue
			}
			if ( usernpcmatfaith(matid - 1000000) != "" & godcheck(cc) != usernpcmatfaith(matid - 1000000) ) {
				continue
			}
			gosub *label_1275
			if ( stat == (-1) ) {
				continue
			}
			listn(0, listmax) = ""
			list(0, listmax) = cnt, 0
			listmax++
		loop
		repeat useritemmax, 2000000
			matid = cnt
			if ( useritemmatval(0, matid - 2000000) == 0 | useritemmatneed(0, matid - 2000000) == (-1) ) {
				continue
			}
			if ( useritemmatfaith(matid - 2000000) != "" & godcheck(cc) != useritemmatfaith(matid - 2000000) ) {
				continue
			}
			gosub *label_1276
			if ( stat == (-1) ) {
				continue
			}
			listn(0, listmax) = ""
			list(0, listmax) = cnt, 0
			listmax++
		loop
	}
	return

#deffunc resetfaction int resetfaction_prm0, int resetfaction_prm1
	if ( strlen(faction(resetfaction_prm0)) == 0 ) {
		if ( resetfaction_prm0 != 0 ) {
			dbid = cId(resetfaction_prm0)
			if ( cId(resetfaction_prm0) != CREATURE_ID_USER ) {
				dbmode = DBMODE_REF_SPEC
				dbspec = 8
				gosub *db_creature
				racefaction = refstr
			}
			else {
				racefaction = userdatan(4, cUNID(resetfaction_prm0))
			}
			notfound = 1
			repeat length2(csetfamily) - 1, 1
				if ( instr(racefaction, 0, "/" + csetfamily(0, cnt) + "/") != (-1) ) {
					sreplace racefaction, racefaction, "/" + csetfamily(0, cnt) + "/", "/family," + csetfamily(0, cnt) + "/"
					notfound = 0
				}
			loop
			if ( notfound ) {
				racefaction += "/family," + csetfamily(0, 0) + "/"
			}
			faction(resetfaction_prm0) = racefaction
			if ( findfaction(resetfaction_prm0, "family", "god") ) {
				addfaction resetfaction_prm0, "align,lawful"
			}
			else {
				if ( cId(resetfaction_prm0) == CREATURE_ID_CAT | cId(resetfaction_prm0) == CREATURE_ID_SILVER_CAT | cId(resetfaction_prm0) == CREATURE_ID_STRAY_CAT ) {
					addfaction resetfaction_prm0, "align,chaotic"
				}
				else {
					if ( resetfaction_prm1 == 0 ) {
						if ( cId(resetfaction_prm0) != CREATURE_ID_USER ) {
							characreate MAX_CHARA_NC, dbid, -3, 0
							relationinit = cRelation(MAX_CHARA_NC)
							chara_vanquish MAX_CHARA_NC
						}
						else {
							relationinit = userdata(4, cUNID(resetfaction_prm0))
						}
					}
					else {
						relationinit = cRelation(resetfaction_prm0)
					}
					if ( relationinit != (-3) ) {
						addfaction resetfaction_prm0, "align,neutral"
					}
					else {
						addfaction resetfaction_prm0, "align,chaotic"
					}
				}
			}
			if ( dbid >= 288 & dbid <= 290 ) {
				addfaction resetfaction_prm0, "guild,mage"
			}
			else {
				if ( dbid >= 292 & dbid <= 294 ) {
					addfaction resetfaction_prm0, "guild,thieve"
				}
				else {
					if ( dbid == 295 | dbid == 291 | dbid == 297 ) {
						addfaction resetfaction_prm0, "guild,fighter"
					}
				}
			}
			natureinit resetfaction_prm0
			refreshfaction resetfaction_prm0
			if ( dbid == 182 ) {
				addfaction resetfaction_prm0, "angel"
			}
			if ( dbid == 317 ) {
				addfaction resetfaction_prm0, "family,man"
			}
		}
		else {
			addfaction resetfaction_prm0, "align,neutral"
			if ( flagMageGuild != 0 ) {
				addfaction resetfaction_prm0, "guild,mage"
			}
			else {
				if ( flagFighterGuild != 0 ) {
					addfaction resetfaction_prm0, "guild,fighter"
				}
				else {
					if ( flagThiefGuild != 0 ) {
						addfaction resetfaction_prm0, "guild,thieve"
					}
				}
			}
		}
		if ( resetfaction_prm0 != 0 ) {
			if ( petcheck(resetfaction_prm0) ) {
				addfaction resetfaction_prm0, "pet,0"
			}
		}
		if ( cId(resetfaction_prm0) == CREATURE_ID_YOUNGER_SISTER2 | cId(resetfaction_prm0) == CREATURE_ID_YOUNGER_SISTER ) {
			addfaction resetfaction_prm0, "guild,little sister"
			addfaction resetfaction_prm0, "god,elder brother"
		}
		else {
			addfaction resetfaction_prm0, "god," + godno2godid(cGod(resetfaction_prm0))
		}
	}
	else {
		sreplace faction(resetfaction_prm0), faction(resetfaction_prm0), "/nature,proud/", "/nature,noble/"
		sreplace faction(resetfaction_prm0), faction(resetfaction_prm0), "/undead/", "/family,undead/"
		if ( cRole(resetfaction_prm0) == ROLE_GUARD ) {
			sreplace faction(resetfaction_prm0), faction(resetfaction_prm0), "/align,lawful/", "/align,neutral/"
		}
	}
	strrep faction(resetfaction_prm0), "//", "/"
	if ( resetfaction_prm0 > 15 & resetfaction_prm0 < 56 ) {
		rmfaction resetfaction_prm0, "align"
		addfaction resetfaction_prm0, "align,neutral"
	}
	return

#deffunc refreshfaction int refreshfaction_prm0
	procid = (procid + 1) \ 10
	proclist(procid) = "refreshfaction:Begin" + " unit_no:" + refreshfaction_prm0 + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( refreshfaction_prm0 != 0 ) {
		rmfaction refreshfaction_prm0, "medic"
		rmfaction refreshfaction_prm0, "directhealby"
		rmfaction refreshfaction_prm0, "areahealby"
		rmfaction refreshfaction_prm0, "holy"
		rmfaction refreshfaction_prm0, "removehexby"
		rmfaction refreshfaction_prm0, "buffer"
		rmfaction refreshfaction_prm0, "buffby"
		rmfaction refreshfaction_prm0, "debuffer"
		rmfaction refreshfaction_prm0, "debuffby"
		rmfaction refreshfaction_prm0, "spellattacker"
		rmfaction refreshfaction_prm0, "spellattackby"
		rmfaction refreshfaction_prm0, "decoy"
		rmfaction refreshfaction_prm0, "decoyby"
		p(58) = 0
		p(57) = 0
		p(53) = 0
		inv_getheader refreshfaction_prm0
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( sLiteracy(refreshfaction_prm0) != 0 & sMemorize(refreshfaction_prm0) != 0 ) {
				if ( iID(cnt) == ITEM_ID_SPELLBOOK_HEALING_HANDS ) {
					if ( readablecheck(refreshfaction_prm0, cnt) ) {
						if ( findfaction(refreshfaction_prm0, "directhealby", str(iID(cnt) + 7 * 10000)) == 0 ) {
							addfaction refreshfaction_prm0, "directhealby," + (iID(cnt) + 7 * 10000)
						}
						p(58) = 1
					}
					continue
				}
				else {
					if ( iID(cnt) == ITEM_ID_SPELLBOOK_CURE_JURE | iID(cnt) == ITEM_ID_SPELLBOOK_HEALING_RAIN ) {
						if ( readablecheck(refreshfaction_prm0, cnt) ) {
							if ( findfaction(refreshfaction_prm0, "areahealby", str(iID(cnt) + 7 * 10000)) == 0 ) {
								addfaction refreshfaction_prm0, "areahealby," + (iID(cnt) + 7 * 10000)
							}
							p(58) = 1
						}
						continue
					}
				}
			}
			if ( sMagicDevice(refreshfaction_prm0) != 0 ) {
				if ( iID(cnt) == ITEM_ID_ROD_HOLY_LIGHT ) {
					if ( eqfaction(refreshfaction_prm0, "holy") == 0 ) {
						addfaction refreshfaction_prm0, "removehexby," + (iID(cnt) + 9 * 10000)
						addfaction refreshfaction_prm0, "holy"
					}
					continue
				}
				if ( iID(cnt) == ITEM_ID_WHISTLE ) {
					if ( eqfaction(refreshfaction_prm0, "decoy") == 0 ) {
						addfaction refreshfaction_prm0, "decoyby," + (iID(cnt) + 14 * 10000)
						addfaction refreshfaction_prm0, "decoy"
					}
					continue
				}
				p(54) = refitem(iID(cnt), DBSPEC_TYPE_MINOR, cnt)
				if ( p(54) == 56001 ) {
					if ( findfaction(refreshfaction_prm0, "directhealby", str(iID(cnt) + 9 * 10000)) == 0 ) {
						addfaction refreshfaction_prm0, "directhealby," + (iID(cnt) + 9 * 10000)
						p(58) = 1
					}
					continue
				}
				if ( p(54) == 56002 ) {
					if ( findfaction(refreshfaction_prm0, "spellattackby", str(iID(cnt) + 9 * 10000)) == 0 ) {
						addfaction refreshfaction_prm0, "spellattackby," + (iID(cnt) + 9 * 10000)
						p(53) = 1
					}
					continue
				}
				if ( p(54) == 56004 ) {
					if ( findfaction(refreshfaction_prm0, "debuffby", str(iID(cnt) + 9 * 10000)) == 0 ) {
						addfaction refreshfaction_prm0, "debuffby," + (iID(cnt) + 9 * 10000)
						p(57) = 1
					}
					continue
				}
				if ( p(54) == 56005 ) {
					if ( eqfaction(refreshfaction_prm0, "buffer") == 0 ) {
						addfaction refreshfaction_prm0, "buffby," + (iID(cnt) + 9 * 10000)
						addfaction refreshfaction_prm0, "buffer"
					}
					continue
				}
			}
		loop
		if ( p(57) ) {
			addfaction refreshfaction_prm0, "debuffer"
		}
		if ( p(53) ) {
			addfaction refreshfaction_prm0, "spellattacker"
		}
		cdataref = 211
		gosub *label_4451
		repeat cActIndex(refreshfaction_prm0) \ 10
			cdataref = 215 + cnt
			gosub *label_4451
		loop
		if ( cAiSub(refreshfaction_prm0) != 0 ) {
			repeat cActIndex(refreshfaction_prm0) / 10
				cdataref = 220 + cnt
				gosub *label_4451
			loop
		}
		if ( p(58) ) {
			addfaction refreshfaction_prm0, "medic"
		}
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "refreshfaction:End"
	return

*label_4451
	if ( cdata(cdataref, refreshfaction_prm0) == 405 ) {
		if ( findfaction(refreshfaction_prm0, "directhealby", "405") == 0 ) {
			addfaction refreshfaction_prm0, "directhealby," + 405
		}
		p(58) = 1
	}
	if ( cdata(cdataref, refreshfaction_prm0) == 404 ) {
		if ( findfaction(refreshfaction_prm0, "areahealby", "404") == 0 ) {
			addfaction refreshfaction_prm0, "areahealby," + 404
		}
		p(58) = 1
	}
	if ( cdata(cdataref, refreshfaction_prm0) == 403 ) {
		if ( findfaction(refreshfaction_prm0, "areahealby", "403") == 0 ) {
			addfaction refreshfaction_prm0, "areahealby," + 403
		}
		p(58) = 1
	}
	return

*label_4452
	dbmax = 0
	dbsum = 0
	repeat 100
		if ( fishdata(FISHDATA_PIC, cnt) == xy2pic(0, 0) ) {
			continue
		}
		i = limit(iParam4(ci) + (rnd(5) == 0) - (rnd(5) == 0), 0, 5)
		if ( fishdata(FISHDATA_LEVEL, cnt) != i ) {
			continue
		}
		p(35) = fishdata(FISHDATA_RARE, cnt)
		if ( p(35) <= 50 ) {
			if ( gettrait(cc, 99) ) {
				p(35) *= stat * 2
			}
		}
		dblist(0, dbmax) = cnt, p(35) + dbsum
		dbsum += p(35)
		dbmax++
	loop
	fish = 1
	if ( dbsum != 0 ) {
		exrand_rnd dbtmp, dbsum
		repeat dbmax
			if ( dblist(1, cnt) > dbtmp ) {
				fish = dblist(0, cnt)
				break
			}
		loop
	}
	return

#deffunc joinguild int joinguild_prm0, str joinguild_prm1
	rmfaction joinguild_prm0, "guild"
	addfaction joinguild_prm0, "guild," + joinguild_prm1
	if ( joinguild_prm0 == 0 ) {
		flagMageGuild = 0
		flagFighterGuild = 0
		flagThiefGuild = 0
		_switch_val = joinguild_prm1
		if ( _switch_val == "mage" | _switch_sw ) {
			_switch_sw = 0
			flagMageGuild = 1
			goto *label_4456
			_switch_sw++
		}
		if ( _switch_val == "fighter" | _switch_sw ) {
			_switch_sw = 0
			flagFighterGuild = 1
			goto *label_4456
			_switch_sw++
		}
		if ( _switch_val == "thieve" | _switch_sw ) {
			_switch_sw = 0
			flagThiefGuild = 1
			goto *label_4456
		}
	}

*label_4456
	throwsstpevent "JoinGuild", joinguild_prm0, "", 0
	return

#deffunc believegod int believegod_prm0, str believegod_prm1
	beforefaith = godcheck(believegod_prm0)
	rmfaction believegod_prm0, "god"
	addfaction believegod_prm0, "god," + believegod_prm1
	_switch_val = believegod_prm1
	if ( _switch_val == "mani" | _switch_sw ) {
		_switch_sw = 0
		cGod(believegod_prm0) = GOD_MANI
		goto *label_4458
		_switch_sw++
	}
	if ( _switch_val == "lulwy" | _switch_sw ) {
		_switch_sw = 0
		cGod(believegod_prm0) = GOD_LULWY
		goto *label_4458
		_switch_sw++
	}
	if ( _switch_val == "itzpalt" | _switch_sw ) {
		_switch_sw = 0
		cGod(believegod_prm0) = GOD_ITZPALT
		goto *label_4458
		_switch_sw++
	}
	if ( _switch_val == "ehekatl" | _switch_sw ) {
		_switch_sw = 0
		cGod(believegod_prm0) = GOD_EHEKATL
		goto *label_4458
		_switch_sw++
	}
	if ( _switch_val == "opatos" | _switch_sw ) {
		_switch_sw = 0
		cGod(believegod_prm0) = GOD_OPATOS
		goto *label_4458
		_switch_sw++
	}
	if ( _switch_val == "jure" | _switch_sw ) {
		_switch_sw = 0
		cGod(believegod_prm0) = GOD_JURE
		goto *label_4458
		_switch_sw++
	}
	if ( _switch_val == "kumiromi" | _switch_sw ) {
		_switch_sw = 0
		cGod(believegod_prm0) = GOD_KUMIROMI
		goto *label_4458
	}
	cGod(believegod_prm0) = GOD_EYTH

*label_4458
	if ( believegod_prm0 == 0 ) {
		throwsstpevent "BelieveGod", 0, "", 0
	}
	return

*label_4459
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	sdim naturevalues, 3
	getfactionvalues tc, "nature", naturevalues
	repeat stat
		s = getfactionlabel(naturen, naturevalues(cnt))
		list(0, listmax) = listmax
		listn(0, listmax) = s
		listmax++
	loop
	windowshadow = 1

*label_4462
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4463
	redraw 0
	s = lang("現在の性格", "Nature"), lang("決定 [リロール]  ", "Enter [Reroll] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("性格", "Nature"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	if ( key == key_enter ) {
		snd SOUNDLIST_DICE
		rmfaction tc, "nature"
		natureinit tc
		goto *label_4459
	}
	cursor_check
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4462
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4462
		}
	}
	if ( key == key_cancel ) {
		return -1
	}
	goto *label_4463

*label_4466
	cPray(cc) = 0
	cPiety(cc) = cPiety(cc) * 55 / 100
	repeat 20
		ospact(100 + cnt) = 0
	loop
	ospact(272) = 0
	ospact(275) = 0
	autosave = 1 * (gArea  != AREA_SHOW_HOUSE)
	if ( cfg_noautosave > 2 & gettrait(0, 190) == 0 ) {
		autosave = 0
	}
	return

*label_4468
	cw2 = find_eq(cc, 10006)
	if ( cw2 != (-1) ) {
		if ( encfindspec(cw2, ENCHANT_ENHANCE_SPELL) == 0 ) {
			cw2 = -1
		}
	}
	return cw2

*label_4469
	cw2 = find_eq(cc, 10006)
	if ( cw2 != (-1) ) {
		f = 0
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw2) == 0 ) {
				break
			}
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw2) / 10000 == 7 ) {
				f = 1
				break
			}
		loop
		if ( f == 0 ) {
			cw2 = -1
		}
	}
	return cw2

*label_4471
	if ( cActionPeriod(cc) > 0 ) {
		actionsp cc, 5 + rnd(5)
		if ( stat == 0 ) {
			txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
			rowactend cc
			return
		}
		if ( rnd(5) == 0 ) {
			txtef COLOR_SKY_BLUE
			if ( jp ) {
				txt cc, "*シュッシュ*", "「くっ…」", "「あっ」", "「はぁはぁ！」", "「ふぅふぅ」"
			}
			else {
				txt cc, cnvtalk("Yes!"), cnvtalk("Ohhh"), "*gasp*", "*rumble*", cnvtalk("come on!")
			}
		}
		return
	}
	if ( jp ) {
		txt -1, "あなたは満足した。", "あなたは爽快な気分になった。", "あなたは自己嫌悪に陥った。", "あなたは最低だ。", "あなたは冷静さを取り戻した。"
	}
	else {
		txt -1, "You feel satisfied.", "You feel an exhilarating rush.", "You feel disgusted with yourself.", "You feel awful.", "You regain your composure."
	}
	iParam1(cItemUsing(cc)) += 1
	addbuff cc, BUFF_DIVINE_WISDOM, 2500, 120
	animeload 11, cc
	if ( ocbit(11, cc) ) {
		if ( gettrait(cc, 185) ) {
			modstress -150
		}
	}
	return

*label_4472
	invsubroutine = 1
	dim scraftref, 10
	dim craftref, 10
	invctrl = 30, 0
	hmrepeat = 0
	nc_dragonskin = 0
	step = 0
	cancel = 0
	cPerformScore(cc) = 0
	repeat
		if ( cPerformScore(cc) != 0 ) {
			if ( cPerformScore(cc) == 3 ) {
				gosub *label_4500
				if ( stat == 0 ) {
					cancel = 1
				}
			}
			break
		}
		if ( cancel ) {
			break
		}
		gosub *label_2974
		if ( stat == 1 ) {
			reftype = refitem(iID(ci), DBSPEC_TYPE, ci)
			reftypeminor = refitem(iID(ci), DBSPEC_TYPE_MINOR, ci)
			if ( step == 0 ) {
				if ( iID(ci) == ITEM_ID_BROKEN_SWORD ) {
					anvil = 0
					furnance = 0
					repeat 5480
						if ( anvil & furnance ) {
							break
						}
						if ( iNum(cnt) <= 0 ) {
							continue
						}
						if ( iID(cnt) == ITEM_ID_ANVIL ) {
							anvil = 1
						}
						else {
							if ( iID(cnt) == ITEM_ID_FURNANCE ) {
								furnance = 1
							}
						}
					loop
					if ( anvil == 0 | furnance == 0 ) {
						txt -1, lang("溶鉱炉と金床が必要だ。", "Requires a furnace and an anvil.")
						cancel = 1
						break
					}
					txtef COLOR_YELLOW
					txt -1, lang("何を作る？", "What will you create?")
					promptl(0, promptmax) = lang("大剣", "Claymore"), "a", "" + 1
					promptmax++
					promptl(0, promptmax) = lang("長剣", "Long sword"), "b", "" + 2
					promptmax++
					promptl(0, promptmax) = lang("短剣", "Dagger"), "c", "" + 3
					promptmax++
					promptl(0, promptmax) = lang("槍", "Spear"), "d", "" + 7
					promptmax++
					promptl(0, promptmax) = lang("鉾槍", "Halberd"), "e", "" + 8
					promptmax++
					promptl(0, promptmax) = lang("斧", "Axe"), "f", "" + 9
					promptmax++
					promptl(0, promptmax) = lang("大斧", "Bardish"), "g", "" + 10
					promptmax++
					promptl(0, promptmax) = lang("鎌", "Scythe"), "h", "" + 11
					promptmax++
					val = promptx, prompty, 220, 1
					gosub *prompt_key
					if ( rtval == (-1) ) {
						cancel = 1
						break
					}
					nc_dragonskin = 0
					craftref(step * 2) = -1, 10000 + rtval
					step++
					invctrl(1) = 1
				}
				else {
					if ( equalsitem(ci, "artifacts fusion license") ) {
						if ( iParam1(cw) <= 20 ) {
							txt -1, lang("鍛冶の技術が足りない。", "Your Smithing skill are not yet up to per.")
							cancel = 1
							break
						}
						anvil = 0
						furnance = 0
						repeat 5480
							if ( anvil & furnance ) {
								break
							}
							if ( iNum(cnt) <= 0 ) {
								continue
							}
							if ( iID(cnt) == ITEM_ID_ANVIL ) {
								anvil = 1
							}
							else {
								if ( iID(cnt) == ITEM_ID_SMELTER ) {
									furnance = 1
								}
							}
						loop
						if ( anvil == 0 | furnance == 0 ) {
							txt -1, lang("溶解炉と金床が必要だ。", "Requires a furnace and an anvil.")
							cancel = 1
							break
						}
						txtnew
						txt -1, lang("まずは土台となるアーティファクトを選ぶ必要がある。", "Choose an artifact that will act as the base.")
						invctrl(1) = 2
					}
					else {
						if ( iID(ci) == ITEM_ID_SKIN ) {
							anvil = 0
							furnance = 0
							repeat 5480
								if ( anvil & furnance ) {
									break
								}
								if ( iNum(cnt) <= 0 ) {
									continue
								}
								if ( iID(cnt) == ITEM_ID_ANVIL ) {
									anvil = 1
								}
								else {
									if ( iID(cnt) == ITEM_ID_SMELTER ) {
										furnance = 1
									}
								}
							loop
							if ( anvil == 0 | furnance == 0 ) {
								txt -1, lang("溶解炉と金床が必要だ。", "Requires a furnance and an anvil.")
								cancel = 1
								break
							}
							txtef COLOR_YELLOW
							txt -1, lang("何を作る？", "What will you create?")
							promptl(0, promptmax) = lang("鎧", "Armor"), "a", "" + 16001
							promptmax++
							promptl(0, promptmax) = lang("兜", "Helmet"), "b", "" + 12001
							promptmax++
							promptl(0, promptmax) = lang("盾", "Shield"), "c", "" + 14003
							promptmax++
							promptl(0, promptmax) = lang("重靴", "Heavy boots"), "d", "" + 18001
							promptmax++
							promptl(0, promptmax) = lang("ガントレット", "Gauntlets"), "e", "" + 22001
							promptmax++
							val = promptx, prompty, 220, 1
							gosub *prompt_key
							if ( rtval == (-1) ) {
								cancel = 1
								break
							}
							nc_dragonskin = 1
							craftref(step * 2) = -1, rtval
							step++
							cPerformScore(cc) = 4
						}
						else {
							if ( reftype == FILTER_FURNITURE ) {
								anvil = 0
								repeat 5480
									if ( anvil ) {
										break
									}
									if ( iNum(cnt) <= 0 ) {
										continue
									}
									if ( iID(cnt) == ITEM_ID_ANVIL ) {
										anvil = 1
									}
								loop
								if ( anvil == 0 ) {
									txt -1, lang("金床が必要だ。", "Requires an anvil.")
									cancel = 1
									break
								}
								txt -1, lang("何を素材にする？", "What will you create from?")
								invctrl(1) = 3
							}
							else {
								if ( equalsitem(ci, "blacksmith hammer") ) {
									notfound = 1
									if ( iParam1(cw) >= 2000 * (iLevel(cw) + 1) | iParam1(cw) < ncgHammerMaxLevel ) {
										notfound = 0
									}
									if ( notfound ) {
										txt -1, lang("鍛冶の必要はない。", "This hammer has not \"reached\".")
										cancel = 1
										break
									}
									cPerformScore(cc) = 6
								}
								else {
									if ( iID(ci) == ITEM_ID_ORE_PIECE ) {
										anvil = 0
										furnance = 0
										repeat 5480
											if ( anvil & furnance ) {
												break
											}
											if ( iNum(cnt) <= 0 ) {
												continue
											}
											if ( iID(cnt) == ITEM_ID_ANVIL ) {
												anvil = 1
											}
											else {
												if ( iID(cnt) == ITEM_ID_FURNANCE ) {
													furnance = 1
												}
											}
										loop
										if ( anvil == 0 | furnance == 0 ) {
											txt -1, lang("溶鉱炉と金床が必要だ。", "Requires a furnace and an anvil.")
											cancel = 1
											break
										}
										txtef COLOR_YELLOW
										txt -1, lang("何を作る？", "What will you create?")
										promptl(0, promptmax) = lang("機械弓", "Crossbow"), "b", "" + 24003
										promptmax++
										promptl(0, promptmax) = lang("銃", "Gun"), "c", "" + 24020
										promptmax++
										promptl(0, promptmax) = lang("光子銃", "Laser gun"), "d", "" + 24021
										promptmax++
										val = promptx, prompty, 220, 1
										gosub *prompt_key
										if ( rtval == (-1) ) {
											cancel = 1
											break
										}
										nc_dragonskin = 0
										craftref(step * 2) = -1, rtval
										step++
										invctrl(1) = 1
									}
									else {
										if ( iID(ci) == ITEM_ID_WOOD_CHIP ) {
											anvil = 0
											furnance = 0
											repeat 5480
												if ( anvil & furnance ) {
													break
												}
												if ( iNum(cnt) <= 0 ) {
													continue
												}
												if ( iID(cnt) == ITEM_ID_ANVIL ) {
													anvil = 1
												}
												else {
													if ( iID(cnt) == ITEM_ID_FURNANCE ) {
														furnance = 1
													}
												}
											loop
											if ( anvil == 0 | furnance == 0 ) {
												txt -1, lang("溶鉱炉と金床が必要だ。", "Requires a furnace and an anvil.")
												cancel = 1
												break
											}
											txtef COLOR_YELLOW
											txt -1, lang("何を作る？", "What will you create?")
											promptl(0, promptmax) = lang("弓", "Bow"), "a", "" + 24001
											promptmax++
											val = promptx, prompty, 220, 1
											gosub *prompt_key
											if ( rtval == (-1) ) {
												cancel = 1
												break
											}
											nc_dragonskin = 0
											craftref(step * 2) = -1, rtval
											step++
											invctrl(1) = 1
										}
										else {
											if ( iID(ci) == ITEM_ID_ANIMAL_BONE ) {
												anvil = 0
												furnance = 0
												repeat 5480
													if ( anvil & furnance ) {
														break
													}
													if ( iNum(cnt) <= 0 ) {
														continue
													}
													if ( iID(cnt) == ITEM_ID_ANVIL ) {
														anvil = 1
													}
													else {
														if ( iID(cnt) == ITEM_ID_FURNANCE ) {
															furnance = 1
														}
													}
												loop
												if ( anvil == 0 | furnance == 0 ) {
													txt -1, lang("溶鉱炉と金床が必要だ。", "Requires a furnace and an anvil.")
													cancel = 1
													break
												}
												txtef COLOR_YELLOW
												txt -1, lang("何を作る？", "What will you create?")
												promptl(0, promptmax) = lang("矢", "Arrow"), "a", "" + 25001
												promptmax++
												promptl(0, promptmax) = lang("クロスボウの矢束", "Bolt"), "b", "" + 25002
												promptmax++
												promptl(0, promptmax) = lang("弾丸", "Bullet"), "c", "" + 25020
												promptmax++
												promptl(0, promptmax) = lang("光子弾", "Energy cell"), "d", "" + 25030
												promptmax++
												val = promptx, prompty, 220, 1
												gosub *prompt_key
												if ( rtval == (-1) ) {
													cancel = 1
													break
												}
												nc_dragonskin = 0
												craftref(step * 2) = -1, rtval
												step++
												invctrl(1) = 1
											}
											else {
												if ( iID(ci) == ITEM_ID_GOLD_BAR ) {
													anvil = 0
													repeat 5480
														if ( anvil ) {
															break
														}
														if ( iNum(cnt) <= 0 ) {
															continue
														}
														if ( iID(cnt) == ITEM_ID_ANVIL ) {
															anvil = 1
														}
													loop
													if ( anvil == 0 ) {
														txt -1, lang("金床が必要だ。", "Requires an anvil.")
														cancel = 1
														break
													}
													txtef COLOR_YELLOW
													txt -1, lang("何を作る？", "What will you create?")
													promptl(0, promptmax) = lang("指輪", "Ring"), "a", "" + 32001
													promptmax++
													promptl(0, promptmax) = lang("首輪", "Amulet"), "b", "" + 34001
													promptmax++
													val = promptx, prompty, 220, 1
													gosub *prompt_key
													if ( rtval == (-1) ) {
														cancel = 1
														break
													}
													nc_dragonskin = 0
													craftref(step * 2) = -1, rtval
													step++
													cPerformScore(cc) = 4
												}
												else {
													notfound = 1
													if ( iLevel(ci) < 0 ) {
														notfound = 0
													}
													else {
														anvil = 0
														repeat 5480
															if ( iNum(cnt) <= 0 ) {
																continue
															}
															if ( iID(cnt) == ITEM_ID_ANVIL ) {
																anvil = 1
																break
															}
														loop
														if ( anvil == 0 ) {
															txt -1, lang("金床が必要だ。", "Requires an anvil.")
															cancel = 1
															break
														}
														locvar_dmghp_p = limitmax(int(iParam1(cw) * 6 / 20), 900)
														locvar_dmghp_p += (iParam1(cw) >= 2000) * 50
														if ( iLevel(cw) ) {
															locvar_dmghp_p += 50
															if ( iLevel(cw) >= 7 ) {
																locvar_dmghp_p += limitmax(iParam1(cw) / 1000, 8999)
															}
														}
														if ( iParam1(cw) >= 21 & iLevel(ci) < locvar_dmghp_p ) {
															notfound = 0
														}
													}
													if ( notfound ) {
														anvil = 0
														repeat 5480
															if ( anvil ) {
																break
															}
															if ( iNum(cnt) <= 0 ) {
																continue
															}
															if ( iID(cnt) == ITEM_ID_ANVIL ) {
																anvil = 1
															}
														loop
														if ( anvil == 0 ) {
															txt -1, lang("金床が必要だ。", "Requires an anvil.")
															cancel = 1
															break
														}
														if ( ibit(ITEM_BIT_ALIVE, ci) ) {
															txt -1, lang("これ以上打ち直せない。", "Can't reinforce it any further.")
															cancel = 1
															break
														}
														txt -1, lang("生物の素材を用いて名前を付与することが出来る。何を素材にする？", "What will you create from?")
														invctrl(1) = 3
													}
													else {
														cPerformScore(cc) = 2
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			else {
				if ( step == 1 ) {
					if ( refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_FURNITURE | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_WEAPON | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_HELM | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_SHIELD | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_ARMOR | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_BOOTS | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_GIRDLE | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_CLOAK | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_GLOVES | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_RANGE | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_AMMO | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_ACCESSORY_RING | refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_ACCESSORY_AMULET ) {
						if ( iID(ci) == ITEM_ID_SKIN | iID(ci) == ITEM_ID_BONE | iID(ci) == ITEM_ID_CORPSE ) {
							cPerformScore(cc) = 5
						}
					}
					else {
						if ( iQuality(ci) >= FIX_QUALITY_MIRACLE & iQuality(ci) <= FIX_QUALITY_GODLY & reftype >= FILTER_WEAPON & reftype <= FILTER_ITEM_MIN ) {
							txtnew
							txt -1, lang("エンチャントを継承するアーティファクトを選ぶ必要がある。このアーティファクトは合成後、永久に失われる。", "Choose an artifact to extract enchantments from. Once fused, the extracted artifact will be lost forever.")
							snd SOUNDLIST_INV
							invctrl(1) = 2
						}
					}
				}
				else {
					if ( step == 2 ) {
						if ( reftypeminor == FILTER_ORE_GEM | iID(ci) == ITEM_ID_SKIN | iID(ci) == ITEM_ID_VANILLA_ROCK | iID(ci) == ITEM_ID_EARTH_CRYSTAL | iID(ci) == ITEM_ID_MANA_CRYSTAL | iID(ci) == ITEM_ID_SUN_CRYSTAL | iID(ci) == ITEM_ID_CORPSE ) {
							cPerformScore(cc) = 1
						}
						else {
							if ( iQuality(ci) >= FIX_QUALITY_MIRACLE & iQuality(ci) <= FIX_QUALITY_GODLY & reftype >= FILTER_WEAPON & reftype <= FILTER_ITEM_MIN | iID(ci) == ITEM_ID_GAROKS_HAMMER ) {
								if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
									snd SOUNDLIST_FAIL1
									txt -1, lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
									continue
								}
								cPerformScore(cc) = 3
							}
						}
					}
				}
			}
			craftref(step * 2) = ci, iID(ci)
			step++
		}
		else {
			cancel = 1
		}
	loop
	if ( cancel ) {
		return 0
	}
	return 1

*label_4484
	if ( cActionPeriod(cc) \ 6 == 0 ) {
		if ( gettrait(cc, 70) < 4 | rnd(4) < gettrait(cc, 70) - 3 ) {
			actionsp cc, 2
			if ( stat == 0 ) {
				txt -1, lang("疲労し過ぎて失敗した！", "You are too exhausted!")
				rowactend cc
				nolog = 0
				return
			}
		}
	}
	if ( cActionPeriod(cc) > 0 ) {
		if ( hmrepeat == 0 ) {
			if ( rnd(3) == 0 ) {
				txtef COLOR_BLUE
				txt -1, lang(" *カキーン* ", "*clank*"), lang(" *カーン* ", "*clang*")
			}
		}
		if ( cPerformScore(cc) == 1 | cPerformScore(cc) == 4 ) {
			if ( extend == 0 ) {
				locvar_cnvjkey_feat1 = gettrait(cc, 70)
			}
			else {
				locvar_cnvjkey_feat1 = 0
			}
			if ( rnd(limitmin(200 + extend * 50 - iLevel(cw) * 100 - locvar_cnvjkey_feat1 * 30, 1)) == 0 ) {
				extend = extend + rnd(3 + locvar_cnvjkey_feat1)
			}
		}
		return
	}
	cw = cItemUsing(cc)


	if ( cPerformScore(cc) == 1 | cPerformScore(cc) == 4 ) {
		quality = 0
		repeat step - 1, 1
			ci = craftref(cnt * 2)
			quality += iValue(ci)
			iNum(ci)--
		loop
		randomize iParam1(cw) * 1000000 + iParam2(cw)
		exrand_randomize iParam1(cw) * 1000000 + iParam2(cw)
		if ( iParam1(cw) < 100 ) {
			if ( gettrait(cc, 70) == 0 ) {
				if ( powf(iParam1(cw), 3) + sEND(cc) * 5 < rndex(quality) ) {
					txtef COLOR_RED
					txt -1, lang("作成に失敗した……", "Failed to create an item...")
					if ( iLevel(cw) ) {
						modexpsmith cw, 1 + rnd(limitmin(10 / iParam1(cw), 1))
					}
					else {
						modexpsmith cw, 1 + rnd(limitmin(10 / iParam1(cw), 1)) + limitmax(iParam3(cw), quality / 1000)
					}
					iParam3(cw)++
					skillexp2 SKILL_ATTR_CON, cc, 10
					randomize
					exrand_randomize
					return
				}
			}
			else {
				if ( powf(iParam1(cw), 3) + sEND(cc) * 5 < quality / (gettrait(cc, 70) + 1) ) {
					if ( powf(iParam1(cw), 3) + sEND(cc) * 5 < rndex(quality) ) {
						txtef COLOR_RED
						txt -1, lang("作成に失敗した……", "Failed to create an item...")
						if ( iLevel(cw) ) {
							modexpsmith cw, 1 + rnd(limitmin(10 / iParam1(cw), 1))
						}
						else {
							modexpsmith cw, 1 + rnd(limitmin(10 / iParam1(cw), 1)) + limitmax(iParam3(cw), quality / 1000)
						}
						iParam3(cw)++
						skillexp2 SKILL_ATTR_CON, cc, 10
						randomize
						exrand_randomize
						return
					}
				}
			}
		}
		flt limitmin(iParam1(cw), 15)
		flttypeminor = craftref(1)
		if ( cPerformScore(cc) == 4 ) {
			ci = craftref(2)
		}
		else {
			ci = craftref(4)
		}
		reftypeminor = refitem(iID(ci), DBSPEC_TYPE_MINOR, ci)
		if ( iID(ci) == ITEM_ID_VANILLA_ROCK ) {
			fltmaterial = 31
			fixlv = calcfixlv(limit(iParam1(cw) * 2 / 25, 1, 4))
		}
		else {
			if ( reftypeminor == FILTER_ORE_GEM | iID(ci) == ITEM_ID_EARTH_CRYSTAL | iID(ci) == ITEM_ID_MANA_CRYSTAL | iID(ci) == ITEM_ID_SUN_CRYSTAL | iID(ci) == ITEM_ID_CORPSE ) {
				_switch_val = iID(ci)
				if ( 0 ) {
					_switch_sw++
				}
				if ( _switch_val == 35 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 5
					goto *label_4486
					_switch_sw++
				}
				if ( _switch_val == 36 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 5
					goto *label_4486
					_switch_sw++
				}
				if ( _switch_val == 37 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 5
					goto *label_4486
					_switch_sw++
				}
				if ( _switch_val == 39 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 15
					goto *label_4486
					_switch_sw++
				}
				if ( _switch_val == 40 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 21
					goto *label_4486
					_switch_sw++
				}
				if ( _switch_val == 41 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 23
					goto *label_4486
					_switch_sw++
				}
				if ( _switch_val == 42 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 13
					goto *label_4486
					_switch_sw++
				}
				if ( _switch_val == 204 | _switch_sw ) {
					_switch_sw = 0
					fltmaterial = 35
					goto *label_4486
				}
*label_4486
				refvalue = refitem(iID(ci), DBSPEC_VALUE_ORG, ci)
				if ( reftypeminor == FILTER_ORE_GEM ) {
					fixlv = calcfixlv(limit(quality / (refvalue * powf(11, 2) / limitmin(iParam1(cw) * 2 / 25, 1)), 1, 4))
				}
				else {
					if ( iID(ci) == ITEM_ID_EARTH_CRYSTAL | iID(ci) == ITEM_ID_MANA_CRYSTAL | iID(ci) == ITEM_ID_SUN_CRYSTAL | iID(ci) == ITEM_ID_CORPSE ) {
						fixlv = calcfixlv(limit(quality / limitmin(refvalue * 20 / limitmin(iParam1(cw) * 2 / 25, 1), 1), 1, 4))
					}
				}
			}
			else {
				if ( iID(ci) == ITEM_ID_GOLD_BAR ) {
					fltmaterial = 32
					refvalue = refitem(iID(ci), DBSPEC_VALUE_ORG, ci)
					fixlv = calcfixlv(limit(quality / (refvalue * powf(11, 2) / limitmin(iParam1(cw) * 2 / 25, 1)), 1, 4))
				}
				else {
					if ( iID(ci) == ITEM_ID_SKIN ) {
						s = refchara(iSubName(ci), DBSPEC_CHARA_FILTER, 1)
						if ( instr(s, 0, "/dragon/") != (-1) ) {
							fltmaterial = 24
						}
						else {
							_switch_val = iSubName(ci)
							if ( 0 ) {
								_switch_sw++
							}
							if ( _switch_val == 134 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 9
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 135 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 32
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 112 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 32
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 136 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 7
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 138 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 31
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 110 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 12
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 111 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 10
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 113 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 29
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 191 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 8
								goto *label_4487
								_switch_sw++
							}
							if ( _switch_val == 193 | _switch_sw ) {
								_switch_sw = 0
								fltmaterial = 8
								goto *label_4487
							}
							if ( 1 ) {
								fltmaterial = 4
								goto *label_4487
							}
						}
*label_4487
						refvalue = refitem(iID(ci), DBSPEC_VALUE_ORG, ci)
						fixlv = calcfixlv(limit(quality / limitmin(refvalue * 20 / limitmin(iParam1(cw) * 2 / 25, 1), 1), 1, 4))
					}
				}
			}
		}
		if ( fixlv > FIX_QUALITY_MIRACLE ) {
			fixlv = FIX_QUALITY_MIRACLE
		}
		if ( iStatus(cw) < ITEM_STATUS_NORMAL & fixlv == FIX_QUALITY_MIRACLE ) {
			fixlv = FIX_QUALITY_GREAT
		}
		if ( iStatus(cw) == ITEM_STATUS_DOOMED ) {
			fixlv = FIX_QUALITY_GOOD
		}
		nostack = 1
		mode = MODELIST_QUEST_CHAT
		itemcreate -1, ITEM_ID_DUMMY, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
		mode = MODELIST_MAIN
		iKnown(ci) = ITEM_KNOWN_FULL
		fixmaterial = fltmaterial
		fltmaterial = 0
		gosub *remake_material
		if ( iLevel(cw) ) {
			expsmith = limitmax(iParam3(cw), quality / 1000) + 1
		}
		else {
			expsmith = rnd(limit(quality - powf(iParam1(cw), 3), 1, 2147483647)) + limitmax(iParam3(cw), quality / 1000)
		}
		if ( iQuality(ci) == FIX_QUALITY_MIRACLE ) {
			iQuality(ci) = FIX_QUALITY_GREAT
			iSubName(ci) = rnd(10) + 20000
		}
		if ( iStatus(cw) >= ITEM_STATUS_NORMAL ) {
			if ( extend > 0 ) {
				if ( iQuality(ci) >= FIX_QUALITY_GREAT ) {
					if ( rnd(40 / limitmax(extend, 40)) == 0 ) {
						txt -1, lang("これは会心の出来だ！", "You created a masterpiece!")
						repeat 15
							p = reinforcecheck(cnt, ci)
							if ( p == (-1) ) {
								break
							}
							if ( p ) {
								if ( ogTitleDints == 2 ) {
									inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) += p * 3
								}
								else {
									inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) += p * 3 / 2
								}
							}
						loop
						iQuality(ci) = FIX_QUALITY_GODLY
					}
					else {
						if ( rnd(20 / limitmax(extend, 20)) == 0 ) {
							txt -1, lang("これは自信作だ！", "You created a superior equipment!")
							repeat 15
								p = reinforcecheck(cnt, ci)
								if ( p == (-1) ) {
									break
								}
								if ( p ) {
									inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, ci) += p / 2
								}
							loop
							iQuality(ci) = FIX_QUALITY_MIRACLE
						}
					}
				}
			}
		}
		randomize
		exrand_randomize
		f = 0
		if ( iQuality(ci) == FIX_QUALITY_MIRACLE | iQuality(ci) == FIX_QUALITY_GODLY ) {
			txtef COLOR_BLUE
			txt -1, lang("銘は？", "What do you want to name this artifact?")
			val = 3
			gosub *com_aka
			if ( stat ) {
				p = stat
				iSubName(ci) = list(1, p) + 40000
				randomize
			}
			else {
				obvious = 0
				randomize
			}
			ncgMakeGoodCount += 1
			if ( ogTitleDints == 0 ) {
				if ( ncgMakeGoodCount >= 1000 ) {
					f = 1
					ogTitleDints = 1
				}
			}
		}
		ibitmod ITEM_BIT_HANDMADE, ci, TRUE
		txtef COLOR_GREEN
		txt -1, lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
		snd SOUNDLIST_BUILD1
		if ( f == 1 ) {
			snd SOUNDLIST_WRITE1
			txtef COLOR_GREEN
			txt -1, lang("新しい称号を獲得した！", "Earned a new title!")
		}
		modexpsmith cw, expsmith
		ncgTotalItemsSmithed++
		iParam3(cw)++
		skillexp2 SKILL_ATTR_CON, cc, 50
		if ( cfg_st_displayhammerlevel >= 2 ) {
			spsintervals(spscounter) = timeGetTime() - previoustime
			previoustime = timeGetTime()
			spscounter = (spscounter + 1) \ 100
		}
		if ( stgdata(12) > 0 ) {
			stgdata(12)--
			if ( stgdata(12) < 0 ) {
				stgdata(12) = 0
			}
			txtef COLOR_GREEN
			txt -1, lang("鍛冶ギルドのノルマ達成まで、あと" + stgdata(12) + "回装備作成に成功する必要がある。", "" + stgdata(12) + " more times to reach the blacksmith guild quota.")
		}
		if ( hmrepeat != 2 ) {
			txt -1, lang("同じものをもう一度作成する？", "Create the same again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			if ( ogTitleDints == 2 ) {
				promptl(0, 2) = lang("何度も", "Infinity"), "h", "2"
				promptmax = 3
			}
			else {
				promptmax = 2
			}
			val = promptx, prompty, 240, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				hmrepeat = 1
				repeat step - 1, 1
					if ( iID(craftref(cnt * 2)) == ITEM_ID_CARNEADES_PLANK ) {
						scraftref(cnt * 2) = customitemfind(0, useritemdatan(0, iCItemIdx(craftref(cnt * 2))))
					}
					else {
						if ( nc_dragonskin == 0 & iID(craftref(cnt * 2)) == ITEM_ID_SKIN ) {
							scraftref(cnt * 2) = itemfind_dragonskin(0)
						}
						else {
							scraftref(cnt * 2) = itemfind(0, iID(craftref(cnt * 2)))
						}
					}
					if ( scraftref(cnt * 2) == (-1) ) {
						hmrepeat = 0
					}
					else {
						craftref(cnt * 2) = scraftref(cnt * 2)
					}
				loop
				if ( hmrepeat == 0 ) {
					nolog = 0
					txt -1, lang("素材が足りない。", "Insufficient material.")
				}
				else {
					cActionPeriod(cc) = 26 - gettrait(cc, 70) * 5 + rnd(11)
				}
			}
			if ( rtval == 2 ) {
				hmrepeat = 2
				if ( iStatus(cw) < ITEM_STATUS_NORMAL ) {
					nolog = 1
				}
				repeat step - 1, 1
					if ( nc_dragonskin == 0 & iID(craftref(cnt * 2)) == ITEM_ID_SKIN ) {
						scraftref(cnt * 2) = itemfind_dragonskin(0)
					}
					else {
						scraftref(cnt * 2) = itemfind(0, iID(craftref(cnt * 2)))
					}
					if ( scraftref(cnt * 2) == (-1) ) {
						hmrepeat = 0
					}
					else {
						craftref(cnt * 2) = scraftref(cnt * 2)
					}
				loop
				if ( hmrepeat == 0 ) {
					nolog = 0
					txt -1, lang("素材が足りない。", "Insufficient material.")
				}
				else {
					cActionPeriod(cc) = 26 - gettrait(cc, 70) * 5 + rnd(11)
				}
			}
		}
		else {
			if ( hmrepeat == 2 ) {
				repeat step - 1, 1
					if ( nc_dragonskin == 0 & iID(craftref(cnt * 2)) == ITEM_ID_SKIN ) {
						scraftref(cnt * 2) = itemfind_dragonskin(0)
					}
					else {
						scraftref(cnt * 2) = itemfind(0, iID(craftref(cnt * 2)))
					}
					if ( scraftref(cnt * 2) == (-1) ) {
						hmrepeat = 0
					}
					else {
						craftref(cnt * 2) = scraftref(cnt * 2)
					}
				loop
				if ( hmrepeat == 0 ) {
					nolog = 0
					txt -1, lang("素材が足りない。", "Insufficient material.")
				}
				else {
					cActionPeriod(cc) = 26 - gettrait(cc, 70) * 5 + rnd(11)
				}
			}
		}
	}
	else {
		if ( cPerformScore(cc) == 2 ) {
			ci = craftref(0)
			txtef COLOR_GREEN
			if ( iLevel(ci) < 0 ) {
				txt -1, lang(itemname(ci) + "の修理を終えた。", "Finished repairing " + itemname(ci) + ".")
			}
			else {
				txt -1, lang(itemname(ci) + "を打ち直した。", "Finishing upgrading " + itemname(ci) + ".")
			}
			snd SOUNDLIST_BUILD1
			if ( iLevel(cw) ) {
				iLevel(ci) = limitmax(iLevel(ci) + iLevel(cw) + 1, locvar_dmghp_p)
			}
			else {
				iLevel(ci)++
			}
			modexpsmith cw, 1 + rnd(limitmin(10 / iParam1(cw), 1))
			skillexp2 SKILL_ATTR_CON, cc, 50
			r1 = cc
			gosub *charaRefresh
			txt -1, lang("もう一度打ち直す？", "Repair the same again?")
			promptl(0, 0) = stryes, "y", "0"
			promptl(0, 1) = strno, "n", "1"
			promptmax = 2
			val = promptx, prompty, 240, 1
			gosub *prompt_key
			if ( rtval == 0 ) {
				locvar_dmghp_p = limitmax(int(iParam1(cw) * 6 / 20), 900)
				locvar_dmghp_p += (iParam1(cw) >= 2000) * 50
				if ( iLevel(cw) ) {
					locvar_dmghp_p += 50
					if ( iLevel(cw) >= 7 ) {
						locvar_dmghp_p += limitmax(iParam1(cw) / 1000, 8999)
					}
				}
				if ( iLevel(ci) < locvar_dmghp_p ) {
					cActionPeriod(cc) = 26 - gettrait(cc, 70) * 5 + rnd(11)
				}
				else {
					txt -1, lang("鍛冶の必要はない。", "This hammer has not \"reached\".")
				}
			}
		}
		else {
			if ( cPerformScore(cc) == 3 ) {
				olist = craftref(0), craftref(4)
				repeat 2
					iNum(olist(cnt))--
					chara_unequip olist(cnt)
					cell_refresh iX(olist(cnt)), iY(olist(cnt))
				loop
				ci = craftref(2)
				repeat fusionlistmax
					encadd ci, fusionlist(0, cnt), fusionlist(1, cnt), 0, 1, 0, 1
				loop
				txtef COLOR_GREEN
				txt -1, lang("合成完了！", "Successfully fused artifacts!")
				snd SOUNDLIST_BUILD1
				modexpsmith cw, 1 + rnd(limitmin(2000 / iParam1(cw), 1)) + limitmax(iParam3(cw), quality / 1000)
				iParam3(cw)++
				skillexp2 SKILL_ATTR_CON, cc, 250
				gosub *label_1681
				r1 = 0
				gosub *charaRefresh
			}
			else {
				if ( cPerformScore(cc) == 5 ) {
					ci = craftref(0)
					olist(0) = craftref(2)
					txtef COLOR_GREEN
					txt -1, lang(itemname(ci) + "の加工を終えた。", "Repair of " + itemname(ci) + " was finished.")
					snd SOUNDLIST_BUILD1
					iParam2(ci) = iSubName(olist(0))
					if ( iSubName(olist(0)) == 343 ) {
						iCNpcId(ci) = iCNpcId(olist(0))
						ICNpcSerialNo(ci) = ICNpcSerialNo(olist(0))
					}
					if ( ibit(ITEM_BIT_PRECIOUS, olist(0)) == TRUE ) {
						iParam2(ci) = 999
					}
					if ( refitem(iID(craftref(0)), DBSPEC_TYPE, craftref(0)) == FILTER_FURNITURE ) {
						fixmaterial = ITEM_MATERIAL_SAND
						if ( iID(olist(0)) == ITEM_ID_SKIN ) {
							s = refchara(iSubName(olist(0)), DBSPEC_CHARA_FILTER, 1)
							if ( instr(s, 0, "/dragon/") != (-1) ) {
								fixmaterial = ITEM_MATERIAL_DRAGON
							}
							else {
								_switch_val = iSubName(olist(0))
								if ( 0 ) {
									_switch_sw++
								}
								if ( _switch_val == 134 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_STEEL
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 135 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_GOLD
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 112 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_GOLD
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 136 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_MITHRIL
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 138 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_ADAMANTIUM
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 110 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_BRONZE
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 111 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_METAL
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 113 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_TITANIUM
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 191 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_ETHER
									goto *label_4495
									_switch_sw++
								}
								if ( _switch_val == 193 | _switch_sw ) {
									_switch_sw = 0
									fixmaterial = ITEM_MATERIAL_ETHER
									goto *label_4495
								}
								if ( 1 ) {
									fixmaterial = ITEM_MATERIAL_LEATHER
									goto *label_4495
								}
							}
						}
						else {
							if ( iID(olist(0)) == ITEM_ID_BONE ) {
								fixmaterial = ITEM_MATERIAL_BONE
							}
							else {
								if ( iID(olist(0)) == ITEM_ID_CORPSE ) {
									fixmaterial = ITEM_MATERIAL_RAW
								}
							}
						}
						ibitmod ITEM_BIT_HANDMADE, ci, TRUE
						gosub *remake_material
					}
					ibitmod 21, ci, TRUE
					iNum(olist(0))--
					modexpsmith cw, 1 + rnd(10)
					skillexp2 SKILL_ATTR_CON, cc, 50
					r1 = 0
					gosub *charaRefresh
				}
				else {
					if ( cPerformScore(cc) == 6 ) {
						ci = craftref(0)
						if ( iParam1(ci) < ncgHammerMaxLevel & iParam1(ci) != iLevel(ci) * 2000 + 2000 ) {
							txtef COLOR_GREEN
							txt -1, lang(itemname(ci) + "を復元した。", "Restoration of " + itemname(ci) + " was finished.")
							snd SOUNDLIST_BUILD1
							iLevel(ci) = limitmin(ncgHammerMaxLevel / 2000, ogSmithingTargetEnchantment)
							iParam1(ci) = ncgHammerMaxLevel
							iParam2(ci) = 0
							iParam3(ci) = 0
						}
						else {
							txtef COLOR_GREEN
							txt -1, lang(itemname(ci) + "は転生した。", "Upgrade of " + itemname(ci) + " was finished.")
							snd SOUNDLIST_BUILD1
							iLevel(ci)++
							iParam2(ci) = 0
							iParam3(ci) = 0
							ogSmithingTargetEnchantment = limitmin(iLevel(ci), ogSmithingTargetEnchantment)
						}
						skillexp2 SKILL_ATTR_CON, cc, 500
						r1 = cc
						gosub *charaRefresh
					}
				}
			}
		}
	}
	return

#deffunc modexpsmith int modexpsmith_prm0, int modexpsmith_prm1
	if ( iParam1(modexpsmith_prm0) >= 2000 * (iLevel(modexpsmith_prm0) + 1) ) {
		iParam2(modexpsmith_prm0) = (iParam2(modexpsmith_prm0) + modexpsmith_prm1) \ calcexpalive(iParam1(modexpsmith_prm0))
		return 0
	}
	locvar_dmghp_p = modexpsmith_prm1
	if ( iParam1(modexpsmith_prm0) <= 2000 * iLevel(modexpsmith_prm0) ) {
		locvar_dmghp_p *= 100 * iLevel(modexpsmith_prm0)
	}
	if ( iParam2(modexpsmith_prm0) < calcexpalive(iParam1(modexpsmith_prm0)) ) {
		if ( iParam2(modexpsmith_prm0) < 0 ) {
			iParam2(modexpsmith_prm0) = 0
		}
		if ( findbuff(CHARA_PLAYER, 67) != (-1) ) {
			locvar_dmghp_p *= ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + stat * 3 + 1, 0) / 500 + 1
		}
		iParam2(modexpsmith_prm0) += locvar_dmghp_p
		if ( gettrait(0, 251) > 0 ) {
			iParam2(modexpsmith_prm0) += locvar_dmghp_p / 100 * gettrait(0, 251)
		}
	}
	if ( iParam2(modexpsmith_prm0) >= calcexpalive(iParam1(modexpsmith_prm0)) ) {
		iParam1(modexpsmith_prm0)++
		iParam2(modexpsmith_prm0) = 0
		iParam3(modexpsmith_prm0) = 0
		txtef COLOR_GREEN
		snd SOUNDLIST_DING3
		txt -1, lang("あなたは鍛冶の技術の向上を感じた。", "Your Smithing skill increases.")
		if ( iParam1(modexpsmith_prm0) >= 2000 * (iLevel(modexpsmith_prm0) + 1) & cfg_nc_reincarnation != 0 ) {
			if ( cfg_nc_reincarnation == 2 ) {
				iLevel(modexpsmith_prm0)++
			}
			else {
				hmrepeat = 0
			}
		}
		if ( iParam1(modexpsmith_prm0) > ncgHammerMaxLevel ) {
			ncgHammerMaxLevel = iParam1(modexpsmith_prm0)
		}
	}
	txt -1, " (Lv:" + iParam1(modexpsmith_prm0) + " Exp:" + fixtxt("" + double(iParam2(modexpsmith_prm0) * 100) / double(calcexpalive(iParam1(modexpsmith_prm0))), 6) + "%) "
	return 1

#defcfunc smithcheck int smithcheck_prm0, int smithcheck_prm1
	if ( iProperty(smithcheck_prm0) == PROP_NPC | iProperty(smithcheck_prm0) == PROP_SPECIAL ) {
		return 1
	}
	locvar_cnvjkey_found = 0
	repeat step
		if ( craftref(cnt * 2) == smithcheck_prm0 ) {
			locvar_cnvjkey_found = 1
			break
		}
	loop
	if ( locvar_cnvjkey_found ) {
		return 1
	}
	locvar_cnvjkey_notsmith = 1
	if ( 0 <= smithcheck_prm0 & smithcheck_prm0 < 200 ) {
		locvar_cnvjkey__switch_val = smithcheck_prm1
		if ( locvar_cnvjkey__switch_val == 0 ) {
			locvar_cnvjkey_reftype = refitem(iID(smithcheck_prm0), DBSPEC_TYPE, smithcheck_prm0)
			if ( iID(smithcheck_prm0) == ITEM_ID_BROKEN_SWORD | iID(smithcheck_prm0) == ITEM_ID_ORE_PIECE | iID(smithcheck_prm0) == ITEM_ID_ANIMAL_BONE | iID(smithcheck_prm0) == ITEM_ID_WOOD_CHIP ) {
				locvar_cnvjkey_notsmith = 0
			}
			else {
				if ( locvar_cnvjkey_reftype >= 10000 & locvar_cnvjkey_reftype <= 50000 ) {
					locvar_cnvjkey_notsmith = 0
				}
				else {
					if ( iID(smithcheck_prm0) == ITEM_ID_SKIN | iID(smithcheck_prm0) == ITEM_ID_GOLD_BAR ) {
						locvar_cnvjkey_notsmith = 0
					}
					else {
						if ( equalsitem(smithcheck_prm0, "artifacts fusion license") ) {
							locvar_cnvjkey_notsmith = 0
						}
						else {
							if ( equalsitem(smithcheck_prm0, "blacksmith hammer") ) {
								if ( iParam1(cw) >= 2000 * (iLevel(cw) + 1) | iParam1(cw) < ncgHammerMaxLevel ) {
									if ( smithcheck_prm0 == cw ) {
										locvar_cnvjkey_notsmith = 0
									}
								}
							}
							else {
								if ( locvar_cnvjkey_reftype == 60000 ) {
									if ( ibit(ITEM_BIT_NO_DROP, smithcheck_prm0) != TRUE ) {
										locvar_cnvjkey_notsmith = 0
									}
								}
							}
						}
					}
				}
			}
			goto *label_4499
		}
		if ( locvar_cnvjkey__switch_val == 1 ) {
			locvar_cnvjkey_reftypeminor = refitem(iID(smithcheck_prm0), DBSPEC_TYPE_MINOR, smithcheck_prm0)
			if ( locvar_cnvjkey_reftypeminor == 77001 | iID(smithcheck_prm0) == ITEM_ID_EARTH_CRYSTAL | iID(smithcheck_prm0) == ITEM_ID_MANA_CRYSTAL | iID(smithcheck_prm0) == ITEM_ID_SUN_CRYSTAL | iID(smithcheck_prm0) == ITEM_ID_CORPSE ) {
				locvar_cnvjkey_notsmith = 0
			}
			else {
				if ( iID(smithcheck_prm0) == ITEM_ID_VANILLA_ROCK ) {
					locvar_cnvjkey_notsmith = 0
				}
				else {
					if ( iID(smithcheck_prm0) == ITEM_ID_SKIN ) {
						locvar_cnvjkey_s = refchara(iSubName(smithcheck_prm0), DBSPEC_CHARA_FILTER, 1)
						if ( instr(locvar_cnvjkey_s, 0, "/dragon/") != (-1) ) {
							locvar_cnvjkey_notsmith = 0
						}
					}
					else {
						if ( iID(smithcheck_prm0) == ITEM_ID_GOLD_BAR ) {
							locvar_cnvjkey_s = refchara(iSubName(smithcheck_prm0), DBSPEC_CHARA_FILTER, 1)
						}
					}
				}
			}
			goto *label_4499
		}
		if ( locvar_cnvjkey__switch_val == 2 ) {
			locvar_cnvjkey_reftype = refitem(iID(smithcheck_prm0), DBSPEC_TYPE, smithcheck_prm0)
			if ( locvar_cnvjkey_reftype >= 10000 & locvar_cnvjkey_reftype <= 50000 ) {
				if ( iQuality(smithcheck_prm0) == FIX_QUALITY_MIRACLE | iQuality(smithcheck_prm0) == FIX_QUALITY_GODLY ) {
					if ( ibit(ITEM_BIT_ALIVE, smithcheck_prm0) == FALSE & ibit(18, smithcheck_prm0) == FALSE ) {
						locvar_cnvjkey_notsmith = 0
					}
				}
			}
			else {
				if ( iID(smithcheck_prm0) == ITEM_ID_GAROKS_HAMMER ) {
					if ( step == 2 ) {
						if ( iLevel(cw) ) {
							locvar_cnvjkey_notsmith = 0
						}
					}
				}
			}
			goto *label_4499
		}
		if ( locvar_cnvjkey__switch_val == 3 ) {
			if ( iID(smithcheck_prm0) == ITEM_ID_SKIN | iID(smithcheck_prm0) == ITEM_ID_BONE | iID(smithcheck_prm0) == ITEM_ID_CORPSE ) {
				if ( iSubName(smithcheck_prm0) != 0 | ibit(ITEM_BIT_PRECIOUS, smithcheck_prm0) == TRUE ) {
					locvar_cnvjkey_notsmith = 0
				}
			}
			goto *label_4499
		}
	}

*label_4499
	return locvar_cnvjkey_notsmith

*label_4500
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	inhmax = 0
	inh_ci = craftref(4)
	getinheritance inh_ci, inhlist, inhmax
	if ( stat == 0 ) {
		txt -1, lang("部屋が一杯で出来ない。", "Your home is full.")
		return 0
	}
	base_ci = craftref(2)
	repeat inhmax
		encno = inhlist(cnt)
		val = inv(STARTING_INV_ITEM_ENCHANT + encno * 2, inh_ci)
		if ( iParam1(cw) <= 40 ) {
			p(65) = val / 10000
			if ( p(65) == 0 ) {
				p(65) = val
			}
			if ( p(65) == 53 | p(65) == 34 ) {
				continue
			}
			if ( encref(ENCREF_GENERATE_CHANCE, p(65)) > 2 + (iParam1(cw) > 30) ) {
				continue
			}
		}
		val(1) = limitmax(inv(STARTING_INV_ITEM_ENCHANT_POWER + encno * 2, inh_ci), limitmax(getencplimit(val(0)) * (iLevel(cw) * iLevel(cw) + 1), 10000000))
		p(59) = 0
		encpmax = iParam1(cw) / 10 * getencplimit(val(0))
		if ( iLevel(cw) ) {
			encpmax = int(limitf(double(encpmax) * (iLevel(cw) * iLevel(cw) + 1), 1, 2000000000))
		}
		if ( val / 10000 == 9 ) {
			encpmax = limitmax(encpmax, 999999)
			txt -1, lang("装填弾", "Your home has no empty spot.")
		}
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, base_ci) == 0 ) {
				break
			}
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, base_ci) == val(0) ) {
				if ( inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, base_ci) + val(1) > encpmax ) {
					p(59) = 1
					val(1) = encpmax - inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, base_ci)
					if ( val(1) <= 0 ) {
						p(59) = 2
					}
				}
				break
			}
		loop
		if ( p(59) == 2 ) {
			continue
		}
		val(2) = 0, refitem(iID(inh_ci), DBSPEC_TYPE, inh_ci)
		strict = 1
		gosub *item_encdetail
		strict = 0
		list(0, listmax) = val(0), val(1)
		listn(0, listmax) = cnven(s)
		if ( p(59) == 1 ) {
			listn(0, listmax) += lang("(上限オーバー)", "(Over limit)")
		}
		listmax++
	loop
	if ( listmax == 0 ) {
		list(0, listmax) = -1
		listn(0, listmax) = lang("継承効果なし", "No inherited effects.")
		listmax++
	}
	windowshadow = 1

*label_4504
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4505
	redraw 0
	s = lang("継承されるエンチャント", "Inherited enchantments"), lang("決定 [開始]  ", "Enter [Start] ") + strhint2 + strhint3b
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("継承効果", "Inherited effects"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	if ( key == key_enter ) {
		if ( i == (-1) ) {
			return 0
		}
		repeat listmax
			fusionlist(0, cnt) = list(0, cnt)
			fusionlist(1, cnt) = list(1, cnt)
		loop
		fusionlistmax = listmax
		return 1
	}
	cursor_check
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4504
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4504
		}
	}
	if ( key == key_cancel ) {
		return 0
	}
	goto *label_4505

*label_4509
	fread = 0
	usergodid = usergodmax
	txt -1, lang("どのファイルから神を作成する？", "Create custom god from which file?")
	redraw 1
	fileext = "txt"
	filedsc = "Custom God Text"
	_fdialog fileext, 16, filedsc, exedir + "user", ""
	if ( stat == 0 ) {
		return
	}
	txtfile = refstr
	exist txtfile
	usergoddata(1, usergodid) = strsize
	sdim txtbuff, strsize + 1
	bload txtfile, txtbuff
	if ( instr(txtbuff, 0, "%Elona Custom God") == (-1) ) {
		txt -1, "Invalid File. Aborting."
		return
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\god1.t", 1, 3
		zWrite usergoddata(0, usergodid), hgz, length(usergoddata) * 4
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\god1.t", 0
		zRead usergoddata(0, usergodid), hgz, length(usergoddata) * 4
		zClose hgz
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\god2.t", 1, 3
		zWrite txtbuff, hgz, usergoddata(1, usergodid)
		zClose hgz
	}
	else {
		zOpen hgz, exedir + "user\\god2.t", 0
		zRead txtbuff, hgz, usergoddata(1, usergodid)
		zClose hgz
	}
	if ( fread == 0 ) {
		zOpen hgz, exedir + "user\\god3.t", 1, 3
		if ( stat == 0 ) {
			zWrite usergodskilldata(0, usergodid), hgz, length(usergodskilldata) * 4
			zClose hgz
		}
	}
	else {
		zOpen hgz, exedir + "user\\god3.t", 0
		if ( stat == 0 ) {
			zRead usergodskilldata(0, usergodid), hgz, length(usergodskilldata) * 4
			zClose hgz
		}
	}
	s = getnpctxt_nc("name.", "unknown,unknown")
	csvstr2 s, s
	cnv_filestr s
	if ( instr(s, 0, "_tmp_") != (-1) ) {
		dialog "The name contains an invalid word \"_tmp_\""
		return
	}
	if ( peek(s) >= 65 & peek(s) <= 90 | peek(s) == 95 | (peek(s) >= 97 & peek(s) <= 122) ) {
	}
	else {
		dialog "The first letter of the name must be alphabetic."
		return
	}
	if ( strlen(s) >= 64 | strlen(s(1)) >= 64 ) {
		dialog "The name is too long."
		return
	}
	godnamet = s
	txt -1, lang("神より贈られるNPCは？", "Use which NPC as part fo god's gift?")
	comctrl = 0
	gosub *user_npc
	if ( stat == 0 ) {
		return
	}
	servantt = refstr
	txt -1, lang("神より贈られる宝物は？", "Use which secret treasure as part of god's gift?")
	gosub *label_4257
	if ( stat == 0 ) {
		return
	}
	gemt = refstr
	txt -1, lang("神より贈られるアーティファクトは？", "Use which artifact as part of god's gift?")
	gosub *label_4257
	if ( stat == 0 ) {
		return
	}
	artifactt = refstr
	brancht = ""
	dialog lang("願いで降臨させる？", "Allow god to be summoned va wish?"), 2
	if ( stat == 6 ) {
		txt -1, lang("降臨するNPCは？", "Use which NPC?")
		comctrl = 0
		gosub *user_npc
		if ( stat == 0 ) {
			return
		}
		brancht = refstr
	}
	groundt = ""
	dialog lang("聖地を同梱する？", "Include sacred ground?"), 2
	if ( stat == 6 ) {
		txt -1, lang("どのファイルを同梱する？", "Include which file?")
		redraw 1
		fileext = "eum"
		filedsc = "showroom file"
		_fdialog fileext, 16, filedsc, exedir + "user", ""
		if ( stat == 0 ) {
			return 0
		}
		groundt = refstr
	}
	zipinit2 exedir + "user\\", godnamet + ".god"
	zipadd2 "god1.t"
	zipadd2 "god2.t"
	zipadd2 "god3.t"
	bcopy exedir + "user\\" + servantt + ".npc", exedir + "user\\servant.t"
	zipadd2 "servant.t"
	bcopy exedir + "user\\" + gemt + ".item", exedir + "user\\gem.t"
	zipadd2 "gem.t"
	bcopy exedir + "user\\" + artifactt + ".item", exedir + "user\\artifact.t"
	zipadd2 "artifact.t"
	if ( brancht != "" ) {
		bcopy exedir + "user\\" + brancht + ".npc", exedir + "user\\branch.t"
		zipadd2 "branch.t"
	}
	if ( groundt != "" ) {
		bcopy groundt, exedir + "user\\ground.t"
		zipadd2 "ground.t"
	}
	zipend2
	q = godnamet
	gosub *label_4514
	gosub *label_3093
	repeat 5480
		if ( ICNpcSerialNo(cnt) ) {
			getunid4item cnt
		}
	loop
	repeat gClient
		if ( qClient(cnt) == 0 ) {
			continue
		}
		if ( qExist(cnt) == QUEST_TYPE_CONQUER | qExist(cnt) == QUEST_TYPE_HUNTEX & qParam1(cnt) == 343 ) {
			getunid4job cnt
		}
	loop
	gosub *label_4258
	repeat 5480
		if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
			getitemid cnt
		}
		checkalter cnt
	loop
	txt -1, lang("カスタムゴッドを作成した！", "Successfully created a custom god!")
	flt
	itemcreate -1, ITEM_ID_CEREMONY_ALTAR, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	iProperty(ci) = PROP_NPC
	iParam1(ci) = 0
	iParam2(ci) = findgodid(q)
	iParam3(ci) = creategoduid(iParam2(ci))
	repeat 5480
		if ( iID(cnt) == ITEM_ID_CARNEADES_PLANK ) {
			getitemid cnt
		}
		checkalter cnt
	loop
	gosub *del_userTemp
	gosub *del_userNpc
	gosub *label_4271
	return

*label_4514
	usergodmax = 0
	getuserfiledata "god", usergodmax
	procid = (procid + 1) \ 10
	proclist(procid) = "[Custom God] " + usergodmax + " cgods detected." + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	if ( usergodmax > 1000 ) {
		usergodmax = 1000
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom God] The upper limit of the number of cgods is " + usergodmax + ". The rest won't be loaded." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
	}
	dim usergoddata, 58, usergodmax + 1
	dim usergoddatam, 20, usergodmax + 1
	sdim usergoddatan, 40, 40, usergodmax + 1
	sdim usergodtxt, 80 * 1000, usergodmax + 1
	sdim usergoddatanm, 40, 10, usergodmax + 1
	dim usergodskilldata, 10, usergodmax + 1
	sdim usergodskilldatan, 40, 10, usergodmax + 1
	sdim untaglistgod
	ogdata(61) = 0
	tg = 0
	repeat usergodmax
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom God] Load: dir=" + userfilelist(1, cnt) + ", file=" + userfilelist(0, cnt) + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		cnt2 = cnt
		unzip2 userfilelist(1, cnt2), userfilelist(0, cnt2)
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom God] Load god definition." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		zOpen hgz, userfilelist(1, cnt2) + "god1.t", 0
		zRead usergoddata(0, tg), hgz, length(usergoddata) * 4
		zClose hgz
		zOpen hgz, userfilelist(1, cnt2) + "god3.t", 0
		if ( stat == 0 ) {
			zRead usergodskilldata(0, tg), hgz, length(usergodskilldata) * 4
			zClose hgz
		}
		sdim txtbuff, usergoddata(1, tg) + 1
		zOpen hgz, userfilelist(1, cnt2) + "god2.t", 0
		zRead txtbuff, hgz, usergoddata(1, tg)
		zClose hgz
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		usergoddatan(0, tg) = s
		usergoddatan(1, tg) = s(jp)
		s = userfilelist(0, cnt)
		usergoddatan(6, tg) = s
		if ( instr(untaglistgod, 0, "/" + usergoddatan(0, tg) + "/") != (-1) ) {
			usergodmax--
			if ( instr(s, 0, "_tmp_") == (-1) ) {
				msgtemp += lang("同名の神は読み込まれない。", "A god of the same name has already been defined.") + "(skipped:" + usergoddatan(0, tg) + "," + s + ") "
			}
			cleanuserdir userfilelist(1, cnt2)
			continue
		}
		untaglistgod += "/" + usergoddatan(0, tg) + "/"
		if ( instr(s, 0, "_tmp_") != (-1) ) {
			ogdata(61)++
		}
		s = getnpctxt_nc("shortname.", usergoddatan(0, tg) + "," + usergoddatan(1, tg))
		csvstr2 s, s
		usergoddatan(2, tg) = s
		usergoddatan(3, tg) = s(jp)
		usergoddatan(4, tg) = getnpctxt_nc("filter.", "")
		if ( jp ) {
			usergoddatan(5, tg) = getnpctxt_nc("author_en.", "プレイヤー")
			usergoddatan(5, tg) = getnpctxt_nc("author.", usergoddatan(5, tg))
		}
		else {
			usergoddatan(5, tg) = getnpctxt_nc("author.", "a player")
			usergoddatan(5, tg) = getnpctxt_nc("author_en.", usergoddatan(5, tg))
		}
		s = getnpctxt_nc("give.", "204")
		sdim godgivet, 6, 10
		csvstr2 godgivet, s
		repeat 10
			if ( godgivet(cnt) == "" ) {
				break
			}
			usergoddata(2 + cnt, tg) = int(godgivet(cnt))
		loop
		s = getnpctxt_nc("bonus.", "")
		sdim godbonust, 7, 10
		csvstr2 godbonust, s
		repeat 10
			if ( godbonust(cnt) == "" ) {
				break
			}
			p = int(godbonust(cnt))
			usergoddata(12 + cnt * 2, tg) = p / 10000
			usergoddata(13 + cnt * 2, tg) = p \ 10000
		loop
		s = getnpctxt_nc("specialpower.", "0,0")
		csvstr2 s, s
		sid = int(s)
		if ( sid == 2016 | sid == 2023 | sid == 2024 | sid == 2027 ) {
			sid = 0
		}
		usergoddata(32, tg) = sid
		usergoddatan(27, tg) = s(1)
		s = getnpctxt_nc("foodbonus.", "")
		sdim foodbonust, 4, 10
		csvstr2 foodbonust, s
		repeat 8
			if ( foodbonust(cnt) == "" ) {
				break
			}
			usergoddata(34 + cnt, tg) = int(foodbonust(cnt))
		loop
		s = getnpctxt_nc("specialfoodbonus.", "")
		sdim spfoodbonust, 6, 10
		csvstr2 spfoodbonust, s
		repeat 8
			if ( spfoodbonust(cnt) == "" ) {
				break
			}
			usergoddata(42 + cnt, tg) = int(spfoodbonust(cnt))
		loop
		repeat 2
			s = getnpctxt_nc("miracle" + cnt + ".", "")
			if ( s == "" ) {
				break
			}
			sdim godmiraclet, 40, 12
			csvstr2 godmiraclet, s
			usergoddatan(11 + cnt, tg) = godmiraclet(0)
			usergoddatan(13 + cnt, tg) = godmiraclet(1)
			usergoddata(50 + cnt, tg) = int(godmiraclet(2))
			usergoddata(52 + cnt, tg) = int(godmiraclet(3))
			usergoddata(54 + cnt, tg) = int(godmiraclet(4))
			usergoddata(56 + cnt, tg) = int(godmiraclet(5))
			usergoddatan(25 + cnt, tg) = godmiraclet(6)
			usergoddatan(15 + cnt, tg) = godmiraclet(7)
			usergoddatan(17 + cnt, tg) = godmiraclet(8)
			usergoddatan(19 + cnt, tg) = godmiraclet(9)
			usergoddatan(21 + cnt, tg) = godmiraclet(10)
			usergoddatan(23 + cnt, tg) = godmiraclet(11)
		loop
		s = getnpctxt_nc("skill.", "")
		if ( s != "" ) {
			sdim godskilllet, 12
			csvstr2 godskilllet, s
			usergodskilldatan(0, tg) = godskilllet(0)
			usergodskilldatan(1, tg) = godskilllet(1)
			usergodskilldata(0, tg) = int(godskilllet(2))
			usergodskilldata(1, tg) = int(godskilllet(3))
			usergodskilldata(2, tg) = int(godskilllet(4))
			usergodskilldata(3, tg) = int(godskilllet(5))
			usergodskilldatan(2, tg) = godskilllet(6)
			usergodskilldatan(3, tg) = godskilllet(7)
			usergodskilldatan(4, tg) = godskilllet(8)
			usergodskilldatan(5, tg) = godskilllet(9)
			usergodskilldatan(6, tg) = godskilllet(10)
			usergodskilldatan(7, tg) = godskilllet(11)
		}
		usergoddatanm(0, tg) = getnpctxt_nc("domain.", "eyth")
		s = getnpctxt_nc("specialpoweralias.", "")
		p = instr(s, 0, ",")
		if ( p == (-1) ) {
			usergoddatan(28, tg) = s
		}
		else {
			if ( jp ) {
				usergoddatan(28, tg) = strmid(s, 0, p)
			}
			else {
				usergoddatan(28, tg) = strmid(s, p + 1, 999)
			}
		}
		repeat 5
			s = getnpctxt_nc("flavorfeat" + cnt + ".", ""), "", "", ""
			if ( s == "" ) {
				continue
			}
			csvstr2 s, s
			usergoddatam(cnt + 10, tg) = int(s(0))
			usergoddatam(cnt + 15, tg) = int(s(1))
			usergoddatanm(cnt + 5, tg) = lang("" + s(2), cnven("" + s(3)))
		loop
		p = instr(txtbuff, 0, "%txt")
		txtbuff = strmid(txtbuff, p, instr(txtbuff, 0, "%endTxt") - p + 7)
		usergodtxt(tg) = strmid(txtbuff, 0, 80 * 400 - 2)
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom God] Load servant." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		dim userdatat, 70
		unzip2 userfilelist(1, cnt2), "servant.t"
		zOpen hgz, userfilelist(1, cnt2) + "npc1.t", 0
		zRead userdatat(0), hgz, 70 * 4
		zClose hgz
		sdim txtbuff, userdatat(1) + 1
		zOpen hgz, userfilelist(1, cnt2) + "npc3.t", 0
		zRead txtbuff, hgz, userdatat(1)
		zClose hgz
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		usergoddatan(7, tg) = s
		exist userfilelist(1, cnt2) + usergoddatan(7, tg) + ".npc"
		if ( strsize == (-1) ) {
			bcopy userfilelist(1, cnt2) + "servant.t", userfilelist(1, cnt2) + usergoddatan(7, tg) + ".npc"
		}
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom God] Load second reward item." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		dim useritemdatat, 70
		unzip2 userfilelist(1, cnt2), "gem.t"
		zOpen hgz, userfilelist(1, cnt2) + "item1.t", 0
		zRead useritemdatat(0), hgz, 70 * 4
		zClose hgz
		sdim txtbuff, useritemdatat(1) + 1
		zOpen hgz, userfilelist(1, cnt2) + "item3.t", 0
		zRead txtbuff, hgz, useritemdatat(1)
		zClose hgz
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		usergoddatan(8, tg) = s
		exist userfilelist(1, cnt2) + usergoddatan(8, tg) + ".item"
		if ( strsize == (-1) ) {
			bcopy userfilelist(1, cnt2) + "gem.t", userfilelist(1, cnt2) + usergoddatan(8, tg) + ".item"
		}
		procid = (procid + 1) \ 10
		proclist(procid) = "[Custom God] Load final reward item." + " ct:" + ct
		if ( dbg_outputdebuglog ) {
		}
		dim useritemdatat, 70
		unzip2 userfilelist(1, cnt2), "artifact.t"
		zOpen hgz, userfilelist(1, cnt2) + "item1.t", 0
		zRead useritemdatat(0), hgz, 70 * 4
		zClose hgz
		sdim txtbuff, useritemdatat(1) + 1
		zOpen hgz, userfilelist(1, cnt2) + "item3.t", 0
		zRead txtbuff, hgz, useritemdatat(1)
		zClose hgz
		s = getnpctxt_nc("name.", "unknown,unknown")
		csvstr2 s, s
		usergoddatan(9, tg) = s
		exist userfilelist(1, cnt2) + usergoddatan(9, tg) + ".item"
		if ( strsize == (-1) ) {
			bcopy userfilelist(1, cnt2) + "artifact.t", userfilelist(1, cnt2) + usergoddatan(9, tg) + ".item"
		}
		exist userfilelist(1, cnt2) + "branch.t"
		if ( strsize != (-1) ) {
			procid = (procid + 1) \ 10
			proclist(procid) = "[Custom God] Load god npc." + " ct:" + ct
			if ( dbg_outputdebuglog ) {
			}
			dim userdatat, 70
			unzip2 userfilelist(1, cnt2), "branch.t"
			zOpen hgz, userfilelist(1, cnt2) + "npc1.t", 0
			zRead userdatat(0), hgz, 70 * 4
			zClose hgz
			sdim txtbuff, userdatat(1) + 1
			zOpen hgz, userfilelist(1, cnt2) + "npc3.t", 0
			zRead txtbuff, hgz, userdatat(1)
			zClose hgz
			s = getnpctxt_nc("name.", "unknown,unknown")
			csvstr2 s, s
			usergoddatan(10, tg) = s
			exist userfilelist(1, cnt2) + usergoddatan(10, tg) + ".npc"
			if ( strsize == (-1) ) {
				bcopy userfilelist(1, cnt2) + "branch.t", userfilelist(1, cnt2) + usergoddatan(10, tg) + ".npc"
			}
		}
		else {
			usergoddatan(10, tg) = ""
		}
		exist userfilelist(1, cnt2) + "ground.t"
		if ( strsize != (-1) ) {
			procid = (procid + 1) \ 10
			proclist(procid) = "[Custom God] Load sacred ground." + " ct:" + ct
			if ( dbg_outputdebuglog ) {
			}
			sdim headtemp, 1024
			bload userfilelist(1, cnt2) + "ground.t", headtemp, 1024
			notesel headtemp
			noteget s, 0
			exist userfilelist(1, cnt2) + s + ".eum"
			if ( strsize == (-1) ) {
				bcopy userfilelist(1, cnt2) + "ground.t", userfilelist(1, cnt2) + s + ".eum"
			}
			noteunsel
		}
		cleanuserdir userfilelist(1, cnt2)
		tg++
		notesel buff
	loop
	usergoddatan(0, usergodmax) = ""
	usergoddatan(1, usergodmax) = lang("残りカス", "garbage")
	usergoddatan(2, usergodmax) = "eyth"
	usergoddatan(3, usergodmax) = ""
	usergoddatan(4, usergodmax) = ""
	gosub *del_userTemp
	return

#deffunc txtcgod int txtcgod_prm0, int txtcgod_prm1
	sstptalkn0 = sstptalkn
	sstptalkn = ""
	notesel buff
	buff = "" + usergodtxt(txtcgod_prm0)
	_switch_val = txtcgod_prm1
	if ( _switch_val == 5 ) {
		sline = "%txtBelieve"
		goto *label_4523
	}
	if ( _switch_val == 1 ) {
		sline = "%txtBetrayal"
		goto *label_4523
	}
	if ( _switch_val == 4 ) {
		sline = "%txtGive"
		goto *label_4523
	}
	if ( _switch_val == 2 ) {
		sline = "%txtMission"
		goto *label_4523
	}
	if ( _switch_val == 3 ) {
		sline = "%txtResist"
		goto *label_4523
	}
	if ( _switch_val == 6 ) {
		sline = "%txtPresent"
		goto *label_4523
	}
	if ( _switch_val == 7 ) {
		sline = "%txtLike"
		goto *label_4523
	}
	if ( _switch_val == 8 ) {
		sline = "%txtLove"
		goto *label_4523
	}
	if ( _switch_val == 12 ) {
		sline = "%txtWhisper"
		goto *label_4523
	}
	if ( _switch_val == 11 ) {
		sline = "%txtWelcome"
		goto *label_4523
	}
	if ( _switch_val == 10 ) {
		sline = "%txtNight"
		goto *label_4523
	}
	if ( _switch_val == 9 ) {
		sline = "%txtKilled"
		goto *label_4523
	}
	if ( _switch_val == 14 ) {
		sline = "%txtMiracle1"
		goto *label_4523
	}
	if ( _switch_val == 15 ) {
		sline = "%txtMiracle2"
		goto *label_4523
	}
	if ( _switch_val == 16 ) {
		sline = "%txtAdvent"
		goto *label_4523
	}
	if ( _switch_val == 17 ) {
		sline = "%txtServantDescription"
		goto *label_4523
	}
	if ( _switch_val == 20 ) {
		sline = "%txtSkill"
		goto *label_4523
	}
	if ( _switch_val == 22 ) {
		sline = "%txtRepatriate"
		goto *label_4523
	}
	if ( _switch_val == 2401 | _switch_sw ) {
		sline = "%txtAdventOther"
		goto *label_4523
	}
	if ( _switch_val == 2402 | _switch_sw ) {
		sline = "%txtAdventDomain"
		goto *label_4523
	}
	if ( _switch_val == 2403 | _switch_sw ) {
		sline = "%txtFaithDream"
		goto *label_4523
	}
	if ( _switch_val == 2404 | _switch_sw ) {
		sline = "%txtFaithScroll"
		goto *label_4523
	}
	if ( _switch_val == 2405 | _switch_sw ) {
		sline = "%txtBlessedFaithScroll"
		goto *label_4523
	}
	if ( _switch_val == 2406 | _switch_sw ) {
		sline = "%txtCursedFaithScroll"
		goto *label_4523
	}
	if ( _switch_val == 2407 | _switch_sw ) {
		sline = "%txtDead"
		goto *label_4523
	}
	if ( _switch_val == 2408 | _switch_sw ) {
		sline = "%txtPray"
		goto *label_4523
	}
	if ( _switch_val == 2409 | _switch_sw ) {
		sline = "%txtPrayFailed"
		goto *label_4523
	}
	if ( _switch_val == 2410 | _switch_sw ) {
		sline = "%txtOffer"
		goto *label_4523
	}
	if ( _switch_val == 2411 | _switch_sw ) {
		sline = "%txtOfferShine"
		goto *label_4523
	}
	if ( _switch_val == 2412 | _switch_sw ) {
		sline = "%txtOfferThreeLeaved"
		goto *label_4523
	}
	if ( _switch_val == 2413 | _switch_sw ) {
		sline = "%txtServantDescription"
		goto *label_4523
	}
	if ( _switch_val == 2414 | _switch_sw ) {
		sline = "%txtWish"
		goto *label_4523
	}
	if ( _switch_val == 2415 | _switch_sw ) {
		sline = "%txtWished"
		goto *label_4523
	}
	if ( _switch_val == 2416 | _switch_sw ) {
		sline = "%txtWishedGodinside"
		goto *label_4523
	}
	if ( _switch_val == 2417 | _switch_sw ) {
		sline = "%txtWishedManinside"
		goto *label_4523
	}
	if ( _switch_val == 2418 | _switch_sw ) {
		sline = "%txtWishedYouth"
		goto *label_4523
	}
	if ( _switch_val == 2419 | _switch_sw ) {
		sline = "%txtWishedAka"
		goto *label_4523
	}
	if ( _switch_val == 2420 | _switch_sw ) {
		sline = "%txtWishedAkaLaugh"
		goto *label_4523
	}
	if ( _switch_val == 2421 | _switch_sw ) {
		sline = "%txtWishedAkaWaste"
		goto *label_4523
	}
	if ( _switch_val == 2422 | _switch_sw ) {
		sline = "%txtWishedSex"
		goto *label_4523
	}
	if ( _switch_val == 2423 | _switch_sw ) {
		sline = "%txtWishedAtonement"
		goto *label_4523
	}
	if ( _switch_val == 2424 | _switch_sw ) {
		sline = "%txtWishedAtonementWaste"
		goto *label_4523
	}
	if ( _switch_val == 2425 | _switch_sw ) {
		sline = "%txtWishedDeath"
		goto *label_4523
	}
	if ( _switch_val == 2426 | _switch_sw ) {
		sline = "%txtWishedSoldout"
		goto *label_4523
	}
	if ( _switch_val == 2427 | _switch_sw ) {
		sline = "%txtWishedAbsence"
		goto *label_4523
	}
	if ( _switch_val == 2428 | _switch_sw ) {
		sline = "%txtPrayHungry"
		goto *label_4523
	}
	if ( _switch_val == 2429 | _switch_sw ) {
		sline = "%txtAreaChanged" + gArea 
		goto *label_4523
	}
	if ( _switch_val == 2430 | _switch_sw ) {
		sline = "%txtAreaChanged"
		goto *label_4523
	}
	if ( _switch_val == 2431 | _switch_sw ) {
		sline = "%txtMapChanged"
		goto *label_4523
	}
	if ( _switch_val == 2432 | _switch_sw ) {
		sline = "%txtHour"
		goto *label_4523
	}
	if ( _switch_val == 2433 | _switch_sw ) {
		sline = "%txtWeaversFestival"
		goto *label_4523
	}
	if ( _switch_val == 2434 | _switch_sw ) {
		sline = "%txtAwake"
		goto *label_4523
	}
	enemygod = ""
	faithitem = 0
	return 0

*label_4523
	hajime = -1
	if ( enemygod != "" ) {
		talktxt = iftxtsearch(buff, 0, sline + "_" + enemygod, 0, 0, 0)
		if ( talktxt != "" ) {
			hajime = instr(buff, 0, talktxt)
		}
	}
	if ( hajime == (-1) & faithitem > 0 ) {
		talktxt = iftxtsearch(buff, 0, sline + "_" + faithitem, 0, 0, 0)
		if ( talktxt != "" ) {
			hajime = instr(buff, 0, talktxt)
		}
	}
	if ( hajime == (-1) ) {
		talktxt = iftxtsearch(buff, 0, sline, 0, 0, 0)
		if ( talktxt != "" ) {
			hajime = instr(buff, 0, talktxt)
		}
	}
	enemygod = ""
	faithitem = 0
	if ( hajime != (-1) ) {
		buff = strmid(buff, hajime, instr(buff, hajime + 1, "%"))
		notedel 0
		if ( noteinfo(0) > 0 ) {
			noteget serifutxt, rnd(noteinfo(0))
			buff = serifutxt
			if ( buff != "" & buff != "default" ) {
				isgodtalk = 1
				convert_word buff, 0, 0
				isgodtalk = 0
				parsesstptalk buff, sstptalk, 0
				if ( cfg_nc_sstp_enabled != 0 & (cfg_nc_sstp_sakura == 1 | cfg_nc_sstp_unyu == 1) ) {
					throwsstptalk sstptalkn0, sstptalk, 1
				}
				if ( cfg_nc_sstp_enabled == 0 | (cfg_nc_sstp_sakura != 1 & cfg_nc_sstp_unyu != 1) | cfg_nc_sstp_suppresslog == 0 ) {
					tcolbk = locvar_randskill_tcol(0), locvar_randskill_tcol(1), locvar_randskill_tcol(2)
					tcolfixbk = locvar_randskill_tcolfix
					split buff, "|", splitbuff
					repeat stat
						locvar_randskill_tcol = tcolbk(0), tcolbk(1), tcolbk(2)
						locvar_randskill_tcolfix = tcolfixbk
						p = instr(splitbuff(cnt), 0, "["), instr(splitbuff(cnt), p, "]"), strlen(splitbuff(cnt))
						if ( p != (-1) ) {
							s = strmid(splitbuff(cnt), p + 1, p(1) - 1)
							csvstr2 s, s
							locvar_randskill_tcol = int(s(0)), int(s(1)), int(s(2))
							locvar_randskill_tcolfix = 1
							splitbuff(cnt) = strmid(splitbuff(cnt), p + p(1) + 1, p(2) - p(1) - p)
						}
						if ( txtcgod_prm1 == 17 ) {
							txt -1, splitbuff(cnt)
						}
						else {
							if ( txtcgod_prm0 == findcgodno("danalin") & txtcgod_prm1 == 16 ) {
								txtef COLOR_SKY_BLUE
								txt -1, splitbuff(cnt)
							}
							else {
								txt -1, lang("「", "\"") + splitbuff(cnt) + lang("」", "\"")
							}
						}
					loop
				}
				noteunsel
				return 1
			}
		}
	}
	if ( buff == "" ) {
		noteunsel
		return 1
	}
	noteunsel
	return 0

*label_4525
	if ( cc == CHARA_PLAYER ) {
		snd SOUNDLIST_COOK1
	}
	item_separate ci
	s = itemname(ci)
	if ( iParam1(ci) != 10000 ) {
		p = rnd(sCooking(cc) + 6) + rnd(iParam1(cooktool) / 50 + 1)
		if ( p > sCooking(cc) / 5 + 7 ) {
			p = sCooking(cc) / 5 + 7
		}
	}
	else {
		p = rnd(sCooking(cc) / 5 + 1) + rnd(iParam1(cooktool) / 100 + 1)
		if ( p > sCooking(cc) / 10 + 7 ) {
			p = sCooking(cc) / 10 + 7
		}
	}
	p = rnd(p + 1)
	if ( p > 3 ) {
		p = rnd(p)
	}
	if ( sCooking(cc) >= 5 ) {
		if ( p < 3 ) {
			if ( rnd(4) == 0 ) {
				p = 3
			}
		}
	}
	if ( sCooking(cc) >= 10 ) {
		if ( p < 3 ) {
			if ( rnd(3) == 0 ) {
				p = 3
			}
		}
	}
	p += iParam1(cooktool) / 100
	if ( p > 9 ) {
		p = 9
	}
	if ( p < 1 ) {
		p = 1
	}
	make_dish ci, p
	if ( cc == CHARA_PLAYER ) {
		txt -1, lang(itemname(cooktool) + "で" + s + "を料理して、" + itemname(ci, 1) + "を作った。", "You cook " + s + " with " + itemname(cooktool, 1) + " and make " + itemname(ci, 1) + ".")
	}
	throwsstpevent "Cooking", 0, itemname(ci), iID(ci), iParam1(ci) / 1000, iParam2(ci)
	ctalk cc, 1336, cc, cc
	r1 = iParam2(ci)
	item_autostack cc, ci
	if ( r1 > 2 ) {
		skillexp2 SKILL_NORMAL_COOKING, cc, 30 + r1 * 5
	}
	return

*label_4526
	animeload 8, cc
	cPic(cc) = cItemUsing(cc)
	cItemUsing(cc) = 0
	cun = cUNID(cc)
	cAiCalm(cc) = limit(userdata(7, cun), 1, 5)
	cAiMoveFreq(cc) = limit(userdata(8, cun), 0, 100)
	cAiDistance(cc) = limit(userdata(9, cun), 1, 100)
	cAiSub(cc) = unaiactsubfreq(cun)
	cActHeal(cc) = userdata(10, cun)
	repeat 5
		cdata(STARTING_CDATA_ACT_MAIN + cnt, cc) = userdata(15 + cnt, cun)
		cdata(STARTING_CDATA_ACT_SUB + cnt, cc) = userdata(20 + cnt, cun)
	loop
	cBarrier(cc) = 0
	cdata(CDATA_ELEMENT, cc) = limit(userdata(11, cun), SKILL_RES_FIRE * 100000, MAX_SKILL_RESDMG * 100000)
	memcpy cdata(STARTING_CDATA_CHARA_BIT, cc), userdata(40, cun), 30 * 4
	cActIndex(cc) = 55
	cRowAct(cc) = ACTION_NONE
	cActionPeriod(cc) = 0
	r1 = cc
	gosub *charaRefresh
	return

*label_4528
	txtnew
	txt -1, lang("あなたの神に力を借りる？", "Really ask for power from your God?")
	promptl(0, 0) = strno, "n", "0"
	promptl(0, 1) = stryes, "y", "1"
	promptmax = 2
	val = promptx, prompty, 160, 1
	gosub *prompt_key
	return rtval

#defcfunc medicalcheck int medicalcheck_prm0
	if ( eqfaction(medicalcheck_prm0, "medic") ) {
		p(58) = 0
		sdim medicalvalues, 8
		targetfaction = "directhealby"
		gosub *label_4530
		targetfaction = "areahealby"
		gosub *label_4530
		return p(58)
	}
	return 0

*label_4530
	if ( p(58) ) {
		return
	}
	getfactionvalues medicalcheck_prm0, targetfaction, medicalvalues
	repeat stat
		p(74) = int(medicalvalues(cnt))
		if ( p(74) >= 10000 ) {
			inv_find p(74) \ 10000, medicalcheck_prm0
			if ( stat != (-1) ) {
				p(73) = stat
				if ( ibit(ITEM_BIT_CHARGE_ITEM, p(73)) ) {
					if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), p(73)) > 0 ) {
						if ( p(74) / 10000 == 7 ) {
							if ( cMP(medicalcheck_prm0) >= cMMP(medicalcheck_prm0) / 4 ) {
								p(58) = 1
								break
							}
						}
						else {
							if ( p(74) / 10000 == 9 ) {
								p(58) = 1
								break
							}
						}
					}
				}
			}
		}
		else {
			if ( cMP(medicalcheck_prm0) >= cMMP(medicalcheck_prm0) / 4 ) {
				p(58) = 1
				break
			}
		}
	loop
	return

*label_4532
	sdim medicalvalues, 8
	p(58) = 0
	if ( ocWantCooperateTargetTotal(cc) >= 2 ) {
		goto *label_4535
	}
	goto *label_4534

*label_4533
	unwatcheson cc
	goto *label_4158

*label_4534
	getfactionvalues cc, "directhealby", medicalvalues
	if ( stat != 0 ) {
		p(74) = int(medicalvalues(rnd(stat)))
		efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
		if ( p(74) >= 10000 ) {
			inv_find p(74) \ 10000, cc
			if ( stat != (-1) ) {
				ci = stat
				if ( p(74) / 10000 == 9 ) {
					if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) > 0 ) {
						if ( distance > 1 ) {
							goto *label_4572
						}
						goto *label_3597
					}
				}
				if ( p(74) / 10000 == 7 ) {
					if ( readablecheck(cc, ci) ) {
						efid = stat
						bookmagic = ci
						item_separate ci
					}
				}
			}
		}
		else {
			efid = p(74)
		}
		if ( efid >= SKILL_SPELL_HEAL_LIGHT ) {
			if ( distance > 1 ) {
				goto *label_4572
			}
			gosub *readSpellbook
			if ( stat == 1 ) {
				goto *label_4158
			}
			else {
				if ( stat == 2 ) {
					goto *label_3597
				}
			}
		}
	}
	if ( p(58) == 0 ) {
		p(58) = 1
		goto *label_4535
	}
	goto *label_4533

*label_4535
	getfactionvalues cc, "areahealby", medicalvalues
	if ( stat != 0 ) {
		p(74) = int(medicalvalues(rnd(stat)))
		efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
		if ( p(74) >= 10000 ) {
			inv_find p(74) \ 10000, cc
			if ( stat != (-1) ) {
				ci = stat
				if ( p(74) / 10000 == 7 ) {
					if ( readablecheck(cc, ci) ) {
						efid = stat
						bookmagic = ci
						item_separate ci
					}
				}
			}
		}
		else {
			efid = p(74)
		}
		if ( efid >= SKILL_SPELL_HEAL_LIGHT ) {
			if ( distance > 2 ) {
				goto *label_4572
			}
			gosub *readSpellbook
			if ( stat == 1 ) {
				goto *label_4158
			}
			else {
				if ( stat == 2 ) {
					goto *label_3597
				}
			}
		}
	}
	if ( p(58) == 0 ) {
		p(58) = 1
		goto *label_4534
	}
	goto *label_4533

*label_4536
	sdim exsoundlist, 30, 10
	exsoundlist(0) = "machine"
	exsoundlist(1) = "shot"
	exsoundlist(2) = "long_sword"
	exsoundlist(3) = "short_sword"
	exsoundlist(4) = "axe"
	exsoundlist(5) = "blunt"
	exsoundlist(6) = "polearm"
	exsoundlist(7) = "stave"
	exsoundlist(8) = "scythe"
	exsoundlist(9) = "crossbow"
	return

*label_4537
	s(1) = ""
	income = 0
	repeat 15, 1
		cnt2 = cnt
		if ( cExist(cnt2) != CHAR_STATE_ALIVE & cExist(cnt2) != CHAR_STATE_ALLY_WORK ) {
			continue
		}
		if ( ocPetJobSkill(cnt2) != 0 ) {
			cc = cnt2
			gosub *label_4540
			gosub *label_4543
		}
		if ( getgametime() <= cRoleRestock(cnt2) ) {
			continue
		}
		if ( ocPetJobSkill(cnt2) == 163 ) {
			if ( itemfind(cnt2, 93) == (-1) ) {
				continue
			}
			s = lang("[炭鉱]" + cnName(cnt2) + "は", "[Mining]" + cnName(cnt2) + " struck and ")
			olist = 14
			olistmax = 1
			i = 1
			p(48) = 7
			gosub *label_4547
		}
		else {
			if ( ocPetJobSkill(cnt2) == 300 ) {
				if ( itemfind(cnt2, 636) == (-1) ) {
					continue
				}
				s = lang("[スリ]" + cnName(cnt2) + "は", "[Pickpocket]" + cnName(cnt2) + " stole and ")
				olist = 18
				olistmax = 1
				i = 0
				p(48) = 9
				gosub *label_4547
			}
			else {
				if ( ocPetJobSkill(cnt2) == 160 ) {
					p = day_trading(cnt2)
					se_moneymod cnt2, p / 2
					income += p / 2
					if ( s(1) != "" ) {
						s(1) += "と"
					}
					s(1) += cnName(cnt2)
					cRoleRestock(cnt2) = getgametime() + csetwork(2, 8)
				}
				else {
					if ( ocPetJobSkill(cnt2) == 159 ) {
						if ( areaId(cType(cnt2)) == AREA_HOME ) {
							continue
						}
						s = lang("[探索]" + cnName(cnt2) + "は", "[Searching]" + cnName(cnt2) + " found and ")
						olist = 13, 15, 16
						olistmax = 3
						i = 5
						p(48) = 10
						gosub *label_4547
					}
				}
			}
		}
	loop
	if ( income ) {
		invfile = 4
		file = "shoptmp.s2"
		ctrlfile 4
		file = "shop" + 4 + ".s2"
		tmpload "" + file
		exist exedir + "tmp\\" + file
		if ( strsize != (-1) ) {
			ctrlfile 3
		}
		else {
			inv_getheader -1
			repeat invrange, invhead
				iNum(cnt) = 0
			loop
		}
		mode = MODELIST_SHOP
		itemcreate -1, ITEM_ID_GOLD_PIECE, -1, -1, income
		snd SOUNDLIST_DING2
		txtef COLOR_YELLOW
		txt -1, lang("[蕪式]" + s(1) + "は蕪を売却した。" + income + "goldが売上として振り込まれた。", "[Investing]" + s(1) + " has sold turlips as part of day trading, depositing your share of " + income + " gold pieces to your house.")
		file = "shop" + invfile + ".s2"
		ctrlfile 4
		file = "shoptmp.s2"
		ctrlfile 3
		mode = MODELIST_MAIN
	}
	return

*label_4540
	inv_getheader cc
	sell = 0, 0
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		a = refitem(iID(cnt), DBSPEC_TYPE, cnt)
		if ( a == 77000 ) {
			p = iValue(cnt) * iNum(cnt)
			sell += iNum(cnt)
			sell(1) += p
			iNum(cnt) = 0
			se_moneymod cc, p
		}
	loop
	if ( sell != 0 ) {
		txtef COLOR_SKY_BLUE
		txt -1, lang(cnName(cc) + "は" + sell + "個のアイテムを売りさばき" + sell(1) + "goldを稼いだ。", cnName(cc) + " sells " + sell + " items and earns " + sell(1) + " gold pieces.")
		repeat
			skillexp2 SKILL_NORMAL_NEGOTIATION, cc, limit(int(sqrt(sell(1))), 10, 100)
			sell(1) -= 10000
			if ( sell(1) < 1 ) {
				break
			}
		loop
	}
	return

*label_4543
	if ( sorg(SKILL_NORMAL_NEGOTIATION, cc) == 0 ) {
		correctionvalue = 0
	}
	else {
		correctionvalue = 50 + sTrade(cc)
		if ( correctionvalue > 300 ) {
			correctionvalue = 300
		}
	}
	if ( cGold(cc) >= cLevel(cc) * 500 * 100 / (100 + correctionvalue) ) {
		snd SOUNDLIST_DING3
		txtef COLOR_SKY_BLUE
		if ( mType == MAP_TYPE_TOWN & cType(cc) == 0 | areaType(cType(cc)) == MAP_TYPE_TOWN ) {
			txt -1, lang(cnName(cc) + "は訓練所に通い潜在能力を伸ばした！", cnName(cc) + " visits a trainer and develops " + his(cc) + " potential!")
		}
		else {
			txt -1, lang(cnName(cc) + "は通信教育で潜在能力を伸ばした！", cnName(cc) + " takes lessons online and develops " + his(cc) + " potential!")
		}
		olistmax = 0
		inv_getheader cc
		repeat invrange, invhead
			if ( iNum(cnt) == 0 ) {
				continue
			}
			if ( iID(cnt) == ITEM_ID_SKILLBOOK ) {
				olist(olistmax) = iParam1(cnt)
				olistmax++
			}
		loop
		repeat 4
			f = 0
			if ( olistmax ) {
				p = olist(rnd(olistmax))
				if ( rnd(16) == 0 ) {
					f = 1
				}
				if ( sorg(p, cc) == 0 | sdata(600 + p, cc) \ 1000 == 400 ) {
					f = 0
				}
			}
			if ( f != 1 ) {
				repeat 2000
					if ( rnd(4) == 0 ) {
						p = rnd(18 - 10) + 10
					}
					else {
						p = rnd(400 - 100) + 100
					}
					if ( sorg(p, cc) == 0 | sdata(600 + p, cc) \ 1000 == 400 ) {
						p = 0
						continue
					}
					break
				loop
			}
			if ( p != 0 ) {
				p(40) = 15 * (100 + calctraitgrowthrate(cc, p)) / 100
				modgrowth cc, p, limit(p(40) - sorgex(p, cc) / 5, 4, p(40))
				cGold(cc) -= cLevel(cc) * 125 * 100 / (100 + correctionvalue)
				skillexp2 SKILL_NORMAL_NEGOTIATION, cc, 2
			}
		loop
		if ( p == 0 ) {
			txtef COLOR_SKY_BLUE
			txt -1, lang(cnName(cc) + "にはこれ以上伸ばせる潜在能力はないようだ", cnName(cc) + " can't develop " + his(cc) + " potential anymore.")
		}
		r1 = cc
		gosub *charaRefresh
	}
	else {
		if ( rnd(5) == 0 ) {
			if ( mType == MAP_TYPE_TOWN & cType(cc) == 0 | areaType(cType(cc)) == MAP_TYPE_TOWN ) {
				txtef COLOR_SKY_BLUE
				ctalk cc, 418, cc, cc
			}
		}
	}
	return

*label_4547
	snd SOUNDLIST_DING2
	txtef COLOR_BLUE
	txt -1, s
	wrokskillevel = sdata(csetwork(1, p(48)), cnt2)
	p(99) = limit(1 + rnd(wrokskillevel / 15 + 1), 1, 6) + (guildcheck(0) == "thieve") * (101 - gRankGuild / 100) / 20
	repeat p(99)
		atxspot = olist(rnd(olistmax))
		matgetmain random_material(atxspot, wrokskillevel / 5 + 1), limit(1 + rnd(wrokskillevel / 15 + 1), 1, 12), i
	loop
	skillexp2 csetwork(1, p(48)), cnt2, p(99) * 100
	cRoleRestock(cnt2) = getgametime() + csetwork(2, p(48))
	return

*label_4549
	olistmax = 0
	repeat 16
		if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
			olist(olistmax) = cnt
			olistmax++
		}
	loop
	charakind = olist(rnd(olistmax))
	dbid = -2
	initlv = objlv + rnd(5)
	nospartifact = 1
	return

*label_4551
	if ( cQuality(rc) != FIX_QUALITY_UNIQUE & areaId(gArea ) != AREA_LESIMAS & areaId(gArea ) != AREA_TEST_GROUND & areaId(gArea ) != AREA_TOWER_OF_FIRE & areaId(gArea ) != AREA_CRYPT_OF_THE_DAMNED & areaId(gArea ) != AREA_ANCIENT_CASTLE & areaId(gArea ) != AREA_DRAGON_NEST & areaId(gArea ) != AREA_PUPPY_CAVE & areaId(gArea ) != AREA_PYRAMID & gArea  != AREA_SHOW_HOUSE ) {
		if ( gettrait(0, 104) != 0 ) {
			if ( findfaction(rc, "family", "wild") ) {
				cRelation(rc) = RELATION_ALLY
				cOrgRelation(rc) = RELATION_ALLY
			}
		}
	}
	if ( oabit(10, gArea ) ) {
		cRelation(rc) = RELATION_DISLIKE
		cOrgRelation(rc) = RELATION_DISLIKE
		if ( godcheck(rc) == "eyth" ) {
			if ( fixgod != "" ) {
				believegod rc, fixgod
			}
			else {
				if ( cId(rc) == CREATURE_ID_JURE_FANATIC ) {
					believegod rc, "jure"
				}
				else {
					believegod rc, creategodid()
				}
			}
		}
		if ( godcheck(rc) != "eyth" ) {
			if ( boss ) {
				modpiety sPrayer(rc) * 100, rc
			}
			else {
				modpiety limitmax(200, sPrayer(rc) * 100), rc
				cnName(rc) = godshortname(godcheck(rc)) + lang("の狂信者", " fanatic")
			}
		}
	}
	else {
		if ( oabit(11, gArea ) ) {
			if ( boss ) {
				if ( jp ) {
					if ( getfactionvalue(gArea  - 450 + 245, "race") != "" ) {
						dbidn = cnRace(rc)
						dbmode = DBMODE_REF
						gosub *cm_race
						cnName(rc) = racename + "の首領『" + randomname() + "』"
					}
				}
			}
		}
		else {
			if ( oabit(3, gArea ) ) {
				if ( boss ) {
					cRelation(rc) = RELATION_ENEMY
					cOrgRelation(rc) = RELATION_ENEMY
				}
			}
		}
	}
	if ( oabit(17, gArea ) | oabit(18, gArea ) ) {
		ocChipTransparency(rc) = 128
		ocShadowType(rc) = -1
		cnName(rc) = "《" + cnName(rc) + "の幻影》"
	}
	return

*label_4552
	if ( cActionPeriod(cc) > 0 ) {
		if ( rnd(5) == 0 ) {
			snd SOUNDLIST_WATER
			txtef COLOR_BLUE
			txt -1, lang(" *ゴシゴシ* ", "*scrub*"), lang(" *ザー* ", "*splash*")
		}
		return
	}
	txt -1, lang(name(cc) + "の魅力は復活した。", name(cc) + your(cc) + " charisma is restored.")
	if ( cdata(247, cc) < 0 ) {
		cdata(247, cc) = 0
	}
	r1 = cc
	gosub *charaRefresh
	return

*label_4553
	p(1) = sGardening(CHARA_PLAYER)
	olistmax = 0
	repeat 15, 1
		if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
			continue
		}
		if ( ocPetJobSkill(cnt) == 180 ) {
			olist(olistmax) = cnt
			olistmax++
		}
	loop
	repeat olistmax
		p(1) += sGardening(olist(cnt)) / 2
	loop
	return

*label_4556
	allyctrl = 7
	gosub *label_2611
	if ( stat != (-1) ) {
		rc = stat
		noupgrade = 0
		if ( cId(rc) == CREATURE_ID_ANDROID ) {
			noupgrade = 1
		}
		else {
			if ( cbit(CHARA_BIT_INCOGNITO, rc) ) {
				repeat 10
					gosub *label_4568
					if ( stat ) {
						continue
					}
					if ( cdata(STARTING_CDATA_ACT_MAIN + cnt, rc) == 454 ) {
						noupgrade = 1
						break
					}
				loop
			}
		}
		if ( noupgrade ) {
			buff = lang("それは無理" + _da(), "It's impossible.")
			goto *label_3785
		}
		goto *label_4558
	}
	else {
		buff = lang("冷やかし" + _ka(1), "You kidding? ")
	}
	goto *label_3785

*label_4558
	tcbk = tc
	menucycle = 0
	olistmax = 0
	gosub *label_4560
	gosub *chat_refresh
	if ( olistmax != 1 ) {
		goto *label_4556
	}
	listmax = 0
	buff = lang(thousandsep(str(calcactupgradevalue(rc) * 2 / 3)) + strgold + "かかるけどいい" + _kana(1), "This will cost you " + thousandsep(str(calcactupgradevalue(rc))) + strgold + ". Is that okay?")
	if ( cGold(CHARA_PLAYER) >= calcactupgradevalue(rc) * 2 / 3 | ncgGoldOverflow > 0 ) {
		list(0, listmax) = 1
		listn(0, listmax) = lang("アップグレードする", "Upgrade.")
		listmax++
	}
	list(0, listmax) = 0
	listn(0, listmax) = lang("やめる", "Never mind.")
	listmax++
	chatesc = 1
	gosub *label_3836
	if ( chatval == 1 ) {
		snd SOUNDLIST_PAYGOLD1
		cGold(CHARA_PLAYER) -= calcactupgradevalue(rc) * 2 / 3
		gosub *label_0422
		if ( cActHeal(rc) == olist(0, 0) ) {
			cActHeal(rc) = olist(1, 0)
		}
		repeat 10
			gosub *label_4568
			if ( stat ) {
				continue
			}
			if ( cdata(STARTING_CDATA_ACT_MAIN + cnt, rc) == olist(0, 0) ) {
				cdata(STARTING_CDATA_ACT_MAIN + cnt, rc) = olist(1, 0)
			}
		loop
		if ( olist(0, 0) == (-1) & olist(1, 0) == (-2) ) {
			if ( cAiDistance(rc) == 1 ) {
				cAiDistance(rc) = 2
			}
		}
		else {
			if ( olist(0, 0) == (-2) & olist(1, 0) == (-1) ) {
				if ( cAiDistance(rc) >= 2 ) {
					cAiDistance(rc) = 1
				}
			}
		}
		ocbitmod 0, rc, 1
		buff = lang("アップグレードは完了し" + _ta(), "Upgrade complete.")
	}
	else {
		buff = lang("訓練が必要なときは、声をかけて" + _kure(), "Come see me again when you need more training.")
	}
	goto *label_3785

*label_4560
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	actupgradecheck guildcheck(0), 211, rc
	repeat 10
		gosub *label_4568
		if ( stat ) {
			continue
		}
		actupgradecheck guildcheck(0), 215 + cnt, rc
	loop
	windowshadow = 1

*label_4563
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4564
	redraw 0
	s = lang("アップグレード一覧", "Upgrade list"), lang("決定 [アップグレード]  ", "Enter [Upgrade] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("行動", "Actions"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = pagesize * page + cnt
			break
		}
	loop
	if ( p != (-1) ) {
		olist(0, 0) = list(0, p), list(1, p)
		olistmax = 1
		screenupdate = -1
		gosub *screen_draw
		tc = tcbk
		return
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4563
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4563
		}
	}
	if ( key == key_cancel ) {
		screenupdate = -1
		gosub *screen_draw
		tc = tcbk
		return
	}
	goto *label_4564

*label_4568
	if ( cnt < 5 ) {
		if ( cActIndex(rc) \ 10 <= cnt ) {
			return 1
		}
	}
	else {
		if ( cActIndex(rc) / 10 <= cnt - 5 ) {
			return 1
		}
	}
	return 0

#defcfunc calcactupgradevalue int calcactupgradevalue_prm0
	return int(powf(limit(cLevel(calcactupgradevalue_prm0), 1, 1000), 2)) * 10

#deffunc actupgradecheck str actupgradecheck_prm0, int actupgradecheck_prm1, int actupgradecheck_prm2
	actlistmax = 0
	if ( actupgradecheck_prm0 == "fighter" ) {
		if ( cdata(actupgradecheck_prm1, actupgradecheck_prm2) == (-1) ) {
			p(actlistmax) = -2
			actlistmax++
		}
		if ( cdata(actupgradecheck_prm1, actupgradecheck_prm2) == (-2) ) {
			p(actlistmax) = -1
			actlistmax++
		}
	}
	else {
		if ( actupgradecheck_prm0 == "mage" ) {
			actlistmax = 0
			if ( cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 414 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 415 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 416 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 417 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 418 ) {
				p(actlistmax) = 459
				actlistmax++
			}
			if ( cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 431 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 432 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 433 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 434 ) {
				p(actlistmax) = 460
				actlistmax++
			}
			if ( cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 404 ) {
				p(actlistmax) = 403
				actlistmax++
			}
			if ( cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 400 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 401 ) {
				p(actlistmax) = 402
				actlistmax++
			}
		}
		else {
			if ( actupgradecheck_prm0 == "thieve" ) {
				if ( cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 601 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == (-1) | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 615 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 618 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 635 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == (-2) | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == 602 | cdata(actupgradecheck_prm1, actupgradecheck_prm2) == (-9998) ) {
					p(actlistmax) = 601
					actlistmax++
					p(actlistmax) = 615
					actlistmax++
					p(actlistmax) = 618
					actlistmax++
					p(actlistmax) = 635
					actlistmax++
					p(actlistmax) = -9998
					actlistmax++
					p(actlistmax) = 602
					actlistmax++
				}
			}
		}
	}
	if ( actlistmax != 0 ) {
		p(50) = cdata(actupgradecheck_prm1, actupgradecheck_prm2)
		repeat actlistmax
			p(51) = p(cnt)
			if ( p(50) == p(51) ) {
				continue
			}
			if ( actupgradelistcheck(p(50), p(51)) ) {
				continue
			}
			list(0, listmax) = p(50), p(51)
			listn(0, listmax) = lang(skillnameref(p(50)) + "を" + skillnameref(p(51)) + "にアップグレード", "Upgraded " + skillnameref(p(50)) + " to " + skillnameref(p(51)) + ".")
			listmax++
		loop
	}
	return

*label_4572
	ahead = 1
	goto *ai_followMove

*label_4573
	if ( iParam2(cw) < calcexpalive(iParam1(cw)) ) {
		exp = rnd(exp / iParam1(cw) + 1)
		if ( ibit(18, cw) ) {
			if ( iStatus(cw) >= ITEM_STATUS_BLESSED ) {
				exp = 0
			}
			else {
				if ( iStatus(cw) <= ITEM_STATUS_DOOMED ) {
					exp = exp * (2 + (getrelation(cc) == (-3)))
				}
			}
		}
		iParam2(cw) += exp
		if ( iParam2(cw) >= calcexpalive(iParam1(cw)) ) {
			txtef COLOR_GREEN
			snd SOUNDLIST_DING3
			txt -1, lang(itemname(cw) + "は十分に血を味わった！", itemname(cw) + " has tasted enough blood!")
		}
	}
	return

*label_4574
	if ( ogYoungLadySeed == (-1) ) {
		rc = CHARA_PLAYER
		repeat 40 - 1, 16
			if ( ocFormerPet(cnt) != 20000 ) {
				continue
			}
			if ( cbit(CHARA_BIT_HIRED, cnt) ) {
				continue
			}
			if ( cExist(cnt) != CHAR_STATE_ADV ) {
				continue
			}
			rc = cnt
			break
		loop
		if ( rc ) {
			cExist(rc) = CHAR_STATE_ALIVE
			cType(rc) = gArea 
			cAreaLv(rc) = gLevel 
			cRelation(rc) = RELATION_NEUTRAL
			cOrgRelation(rc) = RELATION_NEUTRAL
			cAiAggro(rc) = 0
			cbitmod CHARA_BIT_TOKEN_FRIEND, rc, FALSE
			if ( x != (-3) ) {
				cxinit = x
				cyinit = y
				place_chara rc, cxinit, cyinit
			}
			else {
				cxinit = -1
				place_chara rc, cxinit, cyinit
			}
			cHP(rc) = cMHP(rc)
			cMP(rc) = cMMP(rc)
			r1 = rc
			gosub *charaRefresh
		}
	}
	else {
		randomize ogYoungLadySeed
		exrand_randomize ogYoungLadySeed
		rank = 0
		characreate -1, CREATURE_ID_YOUNG_LADY_2, x, y
		cRole(rc) = 20000
		randomize
		exrand_randomize
	}
	return

*readSpellbook
	if ( cMP(cc) < cMMP(cc) / 4 ) {
		if ( rnd(5) ) {
			if ( godcheck(cc) == "itzpalt" ) {
				if ( cPiety(cc) >= 200 ) {
					if ( rnd(20) == 0 ) {
						efid = SKILL_SPACT_ABSORB_MAGIC
						gosub *action
						if ( stat == 1 ) {
							return 1
						}
					}
				}
			}
			if ( itemfind(cc, 391) != (-1) ) {
				ci = stat
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) != 0 ) {
					tc = cc
					return 2
				}
			}
		}
	}
	caston = 1
	if ( cMP(cc) < cMMP(cc) / 7 ) {
		if ( cbit(CHARA_BIT_AI_SAVE_MANA, cc) ) {
			cMP(cc) += cLevel(cc) / 4 + 5
			return 1
		}
		if ( rnd(30) == 0 ) {
			efid = SKILL_SPACT_HARVEST_MANA
			gosub *action
			if ( stat == 1 ) {
				return 1
			}
		}
		if ( rnd(20) ) {
			caston = 0
		}
	}
	if ( findbuff(cc, BUFF_MIST_OF_SILENCE) != (-1) | oabit(0, gArea ) ) {
		if ( rnd(20) ) {
			caston = 0
		}
	}
	if ( caston ) {
		npccostmp = 1
		if ( bookmagic ) {
			r4 = 3
			gosub *label_1607
			r4 = 1
			gosub *label_1594
			r2 = skillDiff(efid)
			ci = bookmagic
			if ( iStatus(ci) >= ITEM_STATUS_BLESSED ) {
				r2 = r2 * 100 / 120
			}
			if ( iStatus(ci) <= ITEM_STATUS_CURSED ) {
				r2 = r2 * 150 / 100
			}
			if ( rndex(sMemorize(cc) * sdata(skillUse(efid), cc) * 4 + 250) < rndex(r2 + 1) ) {
				inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci)--
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) < 0 ) {
					inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
				}
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) == 0 ) {
					removeitem ci, 1
					if ( synccheck(cc, -1) ) {
						txt -1, lang(itemname(ci, 1) + "は塵となって崩れ落ちた。", itemname(ci, 1) + " falls apart.")
						ctalk cc, 1310, cc, cc
					}
				}
				else {
					item_autostack cc, ci
				}
			}
		}
		gosub *cast
		if ( stat == 1 ) {
			return 1
		}
	}
	return 0

*label_4577
	dim isetfamily, 3, 17
	sdim csetfamily, 20, 3, 17
	isetfamily(0, 0) = 0
	csetfamily(0, 0) = "empty", "", ""
	isetfamily(0, 1) = 100
	csetfamily(0, 1) = "god", "神", "邪神"
	isetfamily(0, 2) = 80
	csetfamily(0, 2) = "dragon", "竜", "ドラゴン"
	isetfamily(0, 3) = 60
	csetfamily(0, 3) = "undead", "不死", "アンデッド"
	isetfamily(0, 4) = 30
	csetfamily(0, 4) = "amorphs", "不定形", "不定形生物"
	isetfamily(0, 5) = 20
	csetfamily(0, 5) = "plantoid", "植物", "危険な植物"
	isetfamily(0, 6) = 30
	csetfamily(0, 6) = "arcana", "魔法生物", "魔法生物"
	isetfamily(0, 7) = 0
	csetfamily(0, 7) = "wild", "野生動物", "凶暴な動物"
	isetfamily(0, 8) = 20
	csetfamily(0, 8) = "demi", "亜人", "亜人"
	isetfamily(0, 9) = 10
	csetfamily(0, 9) = "yeek", "イーク", "イーク"
	isetfamily(0, 10) = 10
	csetfamily(0, 10) = "goblin", "ゴブリン", "ゴブリン"
	isetfamily(0, 11) = 60
	csetfamily(0, 11) = "demon", "悪魔", "悪魔"
	isetfamily(0, 11) = 40
	csetfamily(0, 12) = "element", "精霊", "精霊"
	isetfamily(0, 13) = 30
	csetfamily(0, 13) = "mino", "ミノタウロス", "ミノタウロス"
	isetfamily(0, 14) = 50
	csetfamily(0, 14) = "man", "人", "賊"
	isetfamily(0, 15) = 30
	csetfamily(0, 15) = "gear", "機械", "捨てられた機械"
	isetfamily(0, 16) = 20
	csetfamily(0, 16) = "orc", "オーク", "オーク"
	return

*label_4578
	if ( efid == SKILL_SPACT_HARVEST_MANA | efid == SKILL_SPACT_PUNISHMENT | efid == SKILL_SPACT_PRAYER_OF_JURE | efid == SKILL_SPACT_ABSORB_MAGIC | efid == SKILL_SPACT_LULWYS_TRICK | efid == SKILL_SPACT_PSYCHOANALYSIS | efid == SKILL_SPACT_DIMENSIONAL_MOVE | efid == SKILL_SPACT_DRAW_CHARGE | efid == SKILL_SPACT_FILL_CHARGE | efid == SKILL_SPACT_SWARM | efid == SKILL_SPACT_ETHER_GROUND | efid == SKILL_SPACT_RAIN_OF_SANITY | efid == SKILL_SPACT_SUMMON_CATS | efid == SKILL_SPACT_SUMMON_YEEK | efid == SKILL_SPACT_SUMMON_PAWN | efid == SKILL_SPACT_SUMMON_FIRE | efid == SKILL_SPACT_SUMMON_SISTER | efid == SKILL_SPACT_SUICIDE_ATTACK | efid == SKILL_SPACT_DEATH_WORD | efid == SKILL_SPACT_BOOST | efid == SKILL_SPACT_VANISH | efid == SKILL_SPACT_CHEER | efid == SKILL_SPACT_DROP_MINE | efid == 782 ) {
		return 1
	}
	if ( efid == 663 | efid == 664 | efid == 665 | efid == 666 | efid == 667 | efid == 668 | efid == 669 | efid == 670 | efid == 671 | efid == 672 | efid == 673 ) {
		return 1
	}
	if ( efid == 761 | efid == 762 | efid == 763 | efid == 764 | efid == 765 | efid == 766 | efid == 767 | efid == 768 | efid == 769 | efid == 770 | efid == 771 | efid == 772 | efid == 773 | efid == 774 | efid == 775 | efid == 776 | efid == 777 | efid == 778 ) {
		return 1
	}
	return 0

*label_4579
	comctrl = 1
	gosub *user_npc
	if ( stat == 0 ) {
		return
	}
	q = refstr
	gosub *label_3093
	initunid = findunid(q)
	txt -1, lang("ユニークモンスターを作成した！", "Successfully created a unique monster!")
	flt
	characreate -1, CREATURE_ID_USER, cX(CHARA_PLAYER), cY(CHARA_PLAYER)
	repeat 5480
		if ( ICNpcSerialNo(cnt) ) {
			getunid4item cnt
		}
	loop
	repeat gClient
		if ( qClient(cnt) == 0 ) {
			continue
		}
		if ( qExist(cnt) == QUEST_TYPE_CONQUER | qExist(cnt) == QUEST_TYPE_HUNTEX & qParam1(cnt) == 343 ) {
			getunid4job cnt
		}
	loop
	folder = exedir + "user\\"
	gosub *del_userTemp
	return

#deffunc collection_make int collection_make_prm0, int collection_make_prm1
	iSubName(collection_make_prm0) = cId(collection_make_prm1)
	if ( iSubName(collection_make_prm0) == 343 ) {
		iCol(collection_make_prm0) = 825 + cUNID(collection_make_prm1)
		iCNpcId(collection_make_prm0) = cUNID(collection_make_prm1)
		ICNpcSerialNo(collection_make_prm0) = createserialno(userdatan(0, cUNID(collection_make_prm1)))
	}
	else {
		iCol(collection_make_prm0) = cPic(collection_make_prm1) \ 1000
	}
	return

#defcfunc petcheck int petcheck_prm0
	if ( petcheck_prm0 > 0 & petcheck_prm0 < 245 ) {
		if ( petcheck_prm0 < 16 | cRole(petcheck_prm0) == ROLE_PET_SENTRY | cRole(petcheck_prm0) == ROLE_PET_MAID | eqfaction(petcheck_prm0, "petshop") ) {
			return 1
		}
	}
	return 0

*label_4584
	sdim guildclassn, 30, 9, 1
	if ( jp ) {
		guildclassn(0, 0) = "覇者", "守護神", "精鋭", "凄腕", "守衛", "剣士", "修行者", "見習い", "新入り"
	}
	else {
		guildclassn(0, 0) = "Champion", "Guardian", "Elite", "Veteran", "Defender", "Warrior", "Apprentice", "Novice", "Rookie"
	}
	return

*label_4585
	weaponjasei = 0
	weaponjus = 0
	weaponalive = 0
	return

*label_4586
	userspelloptions = 0, 1, 0, 0, 0, 0, 0
	listmax = 0
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	page_bk = 0
	cs_bk2 = 0
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	screenupdate = -1
	gosub *screen_draw
	windowshadow = 1

*label_4588
	listmax = 0
	q = lang("魔法の作成", "Create custom magic")
	if ( jp ) {
		s = "効果", "威力", "形状", "属性", "制約", "制約", "制約", ""
	}
	else {
		s = "Effect", "Power", "Type", "Element", "Limitation", "Limitation", "Limitation", ""
	}
	dx = 440
	dy = 400
	repeat 30
		if ( s(cnt) == "" ) {
			f = cnt
			break
		}
		list(0, listmax) = cnt
		listn(0, listmax) = s(cnt)
		listmax++
	loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4590
	redraw 0
	pagesize = 0
	s = q, lang("左右キー [変更]  ", "Right,left [Change]  ") + strhint3b + lang("決定ｷｰ [最終確認]  ", "Enter [Confirm]  ")
	display_window (windoww - dx) / 2 + inf_screenx, winposy(dy) - 12, dx, dy
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	keyrange = 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		x = 0
		cs_list s, wx + 56 + x, wy + 66 + cnt * 19 - 1, 19, 0
		pos wx + 200, wy + 66 + cnt * 19 - 5
		gcopy BUFFER_INF, 312, 336, 24, 24
		pos wx + 370, wy + 66 + cnt * 19 - 5
		gcopy BUFFER_INF, 336, 336, 24, 24
		pos wx + 230, wy + 66 + cnt * 19
		color 0, 0, 0
		if ( cnt == 0 ) {
			if ( jp ) {
				s = "-------------------", "破壊", "治癒", "知者の加護", "英雄", "聖なる盾", "加速", "元素保護", "リジェネレーション", "浄化", "ホーリーヴェイル", "元素の傷跡", "ナイトメア", "鈍足", "沈黙の霧", "脆弱の霧", "解呪"
			}
			else {
				s = "-------------------", "Destruction", "Healing", "Divine Wisdom", "Hero", "Holy Shield", "Speed", "Elemental Shiled", "Regeneration", "Holy Light", "Holy Veil", "Element Scar", "Nightmare", "Slow", "Mist of Silence", "Mist of Frailness", "Uncurse"
			}
			keyrange++
			mes s(userspelloptions(0))
		}
		if ( cnt == 1 ) {
			keyrange++
			mes userspelloptions(1)
		}
		if ( cnt == 2 ) {
			if ( jp ) {
				s = "-------------------", "アロー", "ボルト", "ボール", "メテオ", "自分", "任意の方向", "任意の対象", "範囲"
			}
			else {
				s = "-------------------", "Arrow", "Bolt", "Ball", "Meteor", "Self", "Adjacent target", "Choose target", "Area"
			}
			keyrange++
			mes s(userspelloptions(2))
		}
		if ( cnt == 3 ) {
			if ( jp ) {
				s = "-------------------", "火炎", "冷気", "電撃", "暗黒", "幻惑", "毒", "地獄", "音", "神経", "混沌", "魔法", "媚薬"
			}
			else {
				s = "-------------------", "Fire", "Cold", "Lightning", "Darkness", "Mind", "Poison", "Nether", "Sound", "Nerve", "Chaos", "Magic", "Love potion"
			}
			keyrange++
			mes s(userspelloptions(3))
		}
		if ( cnt == 4 ) {
			s = "-------------------"
			repeat length(spellconditionlistn)
				s(cnt + 1) = spellconditionlistn(cnt)
			loop
			keyrange++
			mes s(userspelloptions(4))
		}
		if ( cnt == 5 ) {
			s = "-------------------"
			repeat length(spellconditionlistn)
				s(cnt + 1) = spellconditionlistn(cnt)
			loop
			keyrange++
			mes s(userspelloptions(5))
		}
		if ( cnt == 6 ) {
			s = "-------------------"
			repeat length(spellconditionlistn)
				s(cnt + 1) = spellconditionlistn(cnt)
			loop
			keyrange++
			mes s(userspelloptions(6))
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop





	if ( p != (-1) ) {
		s = ""
		if ( userspelloptions(0) == 0 ) {
			goto *label_4590
		}
		if ( jp ) {
			s(1) = "破壊", "治癒", "知者の加護", "英雄", "聖なる盾", "加速", "元素保護", "リジェネレーション", "浄化", "ホーリーヴェイル", "元素の傷跡", "ナイトメア", "鈍足", "沈黙の霧", "脆弱の霧", "解呪"
		}
		else {
			s(1) = "Destruction", "Healing", "Divine Wisdom", "Hero", "Holy Shield", "Speed", "Elemental Shiled", "Regeneration", "Holy Light", "Holy Veil", "Element Scar", "Nightmare", "Slow", "Mist of Silence", "Mist of Frailness", "Uncurse"
		}
		s += lang("効果:", "Effect:") + s(userspelloptions(0)) + " "
		s += lang("威力:", "Power:") + userspelloptions(1) + " "
		if ( userspelloptions(2) == 0 ) {
			goto *label_4590
		}
		if ( jp ) {
			s(1) = "アロー", "ボルト", "ボール", "メテオ", "自分", "任意の方向", "任意の対象", "範囲"
		}
		else {
			s(1) = "Arrow", "Bolt", "Ball", "Meteor", "Self", "Adjacent target", "Choose target", "Area"
		}
		s += lang("形状:", "Type:") + s(userspelloptions(2)) + " "
		if ( userspelloptions(3) == 0 ) {
			if ( userspelloptions(0) == 1 ) {
				goto *label_4590
			}
		}
		if ( jp ) {
			s(1) = "火炎", "冷気", "電撃", "暗黒", "幻惑", "毒", "地獄", "音", "神経", "混沌", "魔法", "媚薬", "酒"
		}
		else {
			s(1) = "Fire", "Cold", "Lightning", "Darkness", "Mind", "Poison", "Nether", "Sound", "Nerve", "Chaos", "Magic", "Love potion", "Alcohol"
		}
		s += lang("属性:", "Element:") + s(userspelloptions(3)) + " "
		repeat length(spellconditionlistn)
			s(cnt + 1) = spellconditionlistn(cnt)
		loop
		repeat 3, 4
			if ( userspelloptions(cnt) != 0 ) {
				s += lang("制約:", "Limitation:") + s(userspelloptions(cnt)) + " "
			}
		loop
		mp = userspelloptions(1) * 12
		if ( userspelloptions(0) == 1 ) {
			_switch_val = userspelloptions(2)
			if ( _switch_val == 1 ) {
				mp = mp * skillCost(414)
				goto *label_4599
			}
			if ( _switch_val == 2 ) {
				mp = mp * skillCost(422) / 2
				goto *label_4599
			}
			if ( _switch_val == 3 ) {
				mp = mp * skillCost(433) / 2
				goto *label_4599
			}
			if ( _switch_val == 4 ) {
				mp = mp * skillCost(465) * 3 / 5
				goto *label_4599
			}
*label_4599
			_switch_val = userspelloptions(3)
			if ( _switch_val == 1 | _switch_val == 2 | _switch_val == 6 | _switch_val == 7 | _switch_val == 12 ) {
				mp = mp * 5 / 3
				goto *label_4600
			}
			if ( _switch_val == 4 | _switch_val == 5 | _switch_val == 9 | _switch_val == 10 ) {
				mp = mp * 2
				goto *label_4600
			}
			if ( _switch_val == 3 | _switch_val == 8 ) {
				mp = mp * 9 / 5
				goto *label_4600
			}
			if ( _switch_val == 11 ) {
				mp = mp * 24 / 5
				goto *label_4600
			}
		}
		else {
			_switch_val = userspelloptions(0)
			if ( _switch_val == 2 ) {
				mp = mp * skillCost(405) * 9 / 10
				goto *label_4601
			}
			if ( _switch_val == 3 ) {
				mp = mp * skillCost(453)
				goto *label_4601
			}
			if ( _switch_val == 4 ) {
				mp = mp * skillCost(448)
				goto *label_4601
			}
			if ( _switch_val == 5 ) {
				mp = mp * skillCost(442)
				goto *label_4601
			}
			if ( _switch_val == 6 ) {
				mp = mp * skillCost(446)
				goto *label_4601
			}
			if ( _switch_val == 7 ) {
				mp = mp * skillCost(445)
				goto *label_4601
			}
			if ( _switch_val == 8 ) {
				mp = mp * skillCost(444)
				goto *label_4601
			}
			if ( _switch_val == 9 ) {
				mp = mp * skillCost(407)
				goto *label_4601
			}
			if ( _switch_val == 10 ) {
				mp = mp * skillCost(451)
				goto *label_4601
			}
			if ( _switch_val == 11 ) {
				mp = mp * skillCost(450) * 5 / 6
				goto *label_4601
			}
			if ( _switch_val == 12 ) {
				mp = mp * skillCost(452) * 5 / 6
				goto *label_4601
			}
			if ( _switch_val == 13 ) {
				mp = mp * skillCost(447) * 5 / 6
				goto *label_4601
			}
			if ( _switch_val == 14 ) {
				mp = mp * skillCost(443) * 5 / 6
				goto *label_4601
			}
			if ( _switch_val == 15 ) {
				mp = mp * skillCost(449) * 5 / 6
				goto *label_4601
			}
			if ( _switch_val == 16 ) {
				mp = mp * skillCost(412)
				goto *label_4601
			}
*label_4601
			_switch_val = userspelloptions(2)
			if ( _switch_val == 6 ) {
				mp = mp * 10 / 9
				goto *label_4602
			}
			if ( _switch_val == 7 ) {
				mp = mp * 6 / 5
				goto *label_4602
			}
			if ( _switch_val == 8 ) {
				mp = mp * 2
				goto *label_4602
			}
		}
*label_4602
		mpnormal = mp
		repeat 3, 4
			if ( userspelloptions(cnt) != 0 ) {
				mp = mp * (100 - calcuserspellfixcost(userspelloptions(cnt) - 1)) / 100
			}
		loop
		s += lang("消費MP:", "MP Usage:") + mp * (100 + 1 * 3) / 100 + " "
		if ( userspelloptions(0) == 1 ) {
			_switch_val = userspelloptions(2)
			if ( _switch_val == 1 ) {
				p(81) = 414
				goto *label_4604
			}
			if ( _switch_val == 2 ) {
				p(81) = 422
				goto *label_4604
			}
			if ( _switch_val == 3 ) {
				p(81) = 433
				goto *label_4604
			}
			if ( _switch_val == 4 ) {
				p(81) = 465
				goto *label_4604
			}
		}
		else {
			_switch_val = userspelloptions(0)
			if ( _switch_val == 2 ) {
				p(81) = 405
				goto *label_4605
			}
			if ( _switch_val == 3 ) {
				p(81) = 453
				goto *label_4605
			}
			if ( _switch_val == 4 ) {
				p(81) = 448
				goto *label_4605
			}
			if ( _switch_val == 5 ) {
				p(81) = 442
				goto *label_4605
			}
			if ( _switch_val == 6 ) {
				p(81) = 446
				goto *label_4605
			}
			if ( _switch_val == 7 ) {
				p(81) = 445
				goto *label_4605
			}
			if ( _switch_val == 8 ) {
				p(81) = 444
				goto *label_4605
			}
			if ( _switch_val == 9 ) {
				p(81) = 407
				goto *label_4605
			}
			if ( _switch_val == 10 ) {
				p(81) = 451
				goto *label_4605
			}
			if ( _switch_val == 11 ) {
				p(81) = 450
				goto *label_4605
			}
			if ( _switch_val == 12 ) {
				p(81) = 452
				goto *label_4605
			}
			if ( _switch_val == 13 ) {
				p(81) = 447
				goto *label_4605
			}
			if ( _switch_val == 14 ) {
				p(81) = 443
				goto *label_4605
			}
			if ( _switch_val == 15 ) {
				p(81) = 449
				goto *label_4605
			}
			if ( _switch_val == 16 ) {
				p(81) = 412
				goto *label_4605
			}
		}
*label_4605
		locvar_cnvjkey_usp = userspelloptions(1) * skillDiff(p(81))
		repeat 3, 4
			if ( userspelloptions(cnt) != 0 ) {
				locvar_cnvjkey_usp = locvar_cnvjkey_usp * (100 + calcuserspellfixcost(userspelloptions(cnt) - 1)) / 100
			}
		loop
		s += lang("最低詠唱Lv:", "Least required Casting Lvl:") + calcuserspellsuccess(locvar_cnvjkey_usp) + " "
		s += lang("この定義で魔法を作る？", "Create custom spell with these settings?")
		txtnew
		txt -1, s
		promptl(0, 0) = lang("作成する", "Create"), "y", "0"
		promptl(0, 1) = lang("やめておく", "Cancel"), "n", "1"
		promptmax = 2
		val = promptx, prompty, 180, 1
		gosub *prompt_key
		if ( rtval == 0 ) {
			if ( mp * (100 + 1 * 3) / 100 > limitintmax(cMMP(CHARA_PLAYER) * 2) ) {
				txt -1, lang("マナが足りない。", "You don't have enough mana.")
				return
			}
			txt -1, lang("この魔法を何と呼ぶ？ ", "What do you want to call this spell? ")
			val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
			inputlog = ""
			input_mode = 1
			gosub *prompt_word
			if ( inputlog == "" ) {
				return
			}
			else {
				userspelldatan(0, userspellmax) = "" + inputlog
				if ( userspelloptions(0) == 1 ) {
					_switch_val = userspelloptions(2)
					if ( _switch_val == 1 ) {
						p(81) = 414
						gosub *label_4631
						goto *label_4607
					}
					if ( _switch_val == 2 ) {
						p(81) = 422
						gosub *label_4631
						goto *label_4607
					}
					if ( _switch_val == 3 ) {
						p(81) = 433
						gosub *label_4631
						goto *label_4607
					}
					if ( _switch_val == 4 ) {
						p(81) = 465
						gosub *label_4631
						goto *label_4607
					}
				}
				else {
					_switch_val = userspelloptions(0)
					if ( _switch_val == 2 ) {
						p(81) = 405
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 3 ) {
						p(81) = 453
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 4 ) {
						p(81) = 448
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 5 ) {
						p(81) = 442
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 6 ) {
						p(81) = 446
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 7 ) {
						p(81) = 445
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 8 ) {
						p(81) = 444
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 9 ) {
						p(81) = 407
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 10 ) {
						p(81) = 451
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 11 ) {
						p(81) = 450
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 12 ) {
						p(81) = 452
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 13 ) {
						p(81) = 447
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 14 ) {
						p(81) = 443
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 15 ) {
						p(81) = 449
						gosub *label_4631
						goto *label_4608
					}
					if ( _switch_val == 16 ) {
						p(81) = 412
						gosub *label_4631
						goto *label_4608
					}
				}
*label_4608
				userspelldata(2, userspellmax) = mpnormal
				userspelldata(5, userspellmax) = userspelloptions(1)
				userspelldata(12, userspellmax) = 1 * 1000000 + 100
				userspelldata(11, userspellmax) = 200 + calcuserspellcoststock(userspellmax) * 2
				olistmax = 6
				repeat 3, 4
					if ( userspelloptions(cnt) != 0 ) {
						userspelldata(olistmax, userspellmax) = userspelloptions(cnt)
						olistmax++
					}
				loop
				resetuserspell userspellmax
				userspellmax++
				txt -1, lang("魔法を作成した！", "Successfully created a custom spell!")
				ogdata(253)--
			}
			return
		}
	}
	if ( key == key_cancel ) {
		return
	}
	if ( key == key_pageup | key == key_pagedown ) {
		if ( key == key_pageup ) {
			p = 1
		}
		else {
			p = -1
		}
		if ( cs == 0 ) {
			userspelloptions(0) = limit(userspelloptions(0) + p, 0, 16)
			userspelloptions(2) = 0
			userspelloptions(3) = 0
			snd SOUNDLIST_OK1
			goto *label_4588
		}
		if ( cs == 1 ) {
			userspelloptions(1) = limit(userspelloptions(1) + p, 1, 100)
			snd SOUNDLIST_OK1
			goto *label_4588
		}
		if ( cs == 2 ) {
			if ( userspelloptions(0) != 0 ) {
				if ( userspelloptions(0) == 1 ) {
					userspelloptions(2) = limit(userspelloptions(2) + p, 0, 4)
				}
				else {
					if ( p > 0 ) {
						if ( userspelloptions(2) < 5 ) {
							userspelloptions(2) = 4
						}
					}
					userspelloptions(2) = limit(userspelloptions(2) + p, 4, 8)
					if ( p < 0 ) {
						if ( userspelloptions(2) < 5 ) {
							userspelloptions(2) = 0
						}
					}
				}
			}
			else {
				userspelloptions(2) = 0
			}
			snd SOUNDLIST_OK1
			goto *label_4588
		}
		if ( cs == 3 ) {
			if ( userspelloptions(0) == 1 ) {
				userspelloptions(3) = limit(userspelloptions(3) + p, 0, 12)
			}
			else {
				userspelloptions(3) = 0
			}
			snd SOUNDLIST_OK1
			goto *label_4588
		}
		if ( cs == 4 ) {
			gosub *label_4627
			snd SOUNDLIST_OK1
			goto *label_4588
		}
		if ( cs == 5 ) {
			gosub *label_4627
			snd SOUNDLIST_OK1
			goto *label_4588
		}
		if ( cs == 6 ) {
			gosub *label_4627
			snd SOUNDLIST_OK1
			goto *label_4588
		}
	}
	if ( key == key_southwest | key == key_southeast ) {
		if ( cs == 1 ) {
			if ( key == key_southeast ) {
				userspelloptions(1) += 10
			}
			else {
				userspelloptions(1) -= 10
			}
			if ( userspelloptions(1) > 100 ) {
				userspelloptions(1) = 100
			}
			else {
				if ( userspelloptions(1) < 1 ) {
					userspelloptions(1) = 1
				}
			}
			snd SOUNDLIST_OK1
			goto *label_4588
		}
	}
	if ( key == key_northwest | key == key_northeast ) {
		if ( cs == 1 ) {
			if ( key == key_northeast ) {
				userspelloptions(1) += 100
			}
			else {
				userspelloptions(1) -= 100
			}
			if ( userspelloptions(1) > 100 ) {
				userspelloptions(1) = 100
			}
			else {
				if ( userspelloptions(1) < 1 ) {
					userspelloptions(1) = 1
				}
			}
			snd SOUNDLIST_OK1
			goto *label_4588
		}
	}
	goto *label_4590

*label_4610
	if ( mode != MODELIST_SHOP ) {
		if ( gArea  != AREA_SHELTER & gArea  != AREA_SHOW_HOUSE ) {
			if ( cm | mode == MODELIST_CHARA_CREATION ) {
				if ( noencpfix == 0 ) {
					bonus_base = limitmax(limit(objlv, 0, 6000), 2000) / 16 + limitmin(limit(objlv, 0, 6000) - 2000, 0) / 32
					iLevel(ci) = bonus_base * 3 + rnd(1 + bonus_base)
				}
			}
			else {
				iLevel(ci) = limit(objlv, 0, 8000) / 16 + rnd(1 + limit(objlv, 0, 8000) / 16)
			}
		}
	}
	return

*label_4611
	p = length(csetgodservant)
	if ( usergodmax ) {
		p += usergodmax
	}
	charakind = rnd(p)
	if ( charakind < length(csetgodservant) ) {
		dbid = csetgodservant(charakind)
	}
	else {
		initunid = findunid(usergoddatan(7, charakind - length(csetgodservant)))
		dbid = 343
	}
	return

*label_4612
	tlocx = cX(tc)
	tlocy = cY(tc)
	if ( skillTg(efid) / 1000 == 3 ) {
		range = skillTg(efid) \ 1000
		if ( skillType(efid) == 4 ) {
			if ( range == 0 ) {
				if ( nc_gettrait(cc, 105) > 0 ) {
					range = 3
				}
			}
		}
		if ( skillType(efid) > 1000 & skillTg(efid) / 1000 == 3 ) {
			if ( range == 0 ) {
				if ( nc_gettrait(cc, 106) > 0 ) {
					range = 3
				}
			}
		}
	}
	else {
		range = 0
	}
	repeat range * 2 + 1
		dy = tlocy - range + cnt
		if ( dy < 0 | dy >= mHeight ) {
			continue
		}
		repeat range * 2 + 1
			dx = tlocx - range + cnt
			if ( dx < 0 | dx >= mWidth ) {
				continue
			}
			if ( dist(tlocx, tlocy, dx, dy) > range ) {
				continue
			}
			if ( fov_los(tlocx, tlocy, dx, dy) == 0 ) {
				continue
			}
			if ( mapChara(dx, dy) == 0 ) {
				continue
			}
			tc = mapChara(dx, dy) - 1
			gosub procbody
			if ( stat == 0 ) {
				continue
			}
		loop
	loop
	return

*label_4615
	if ( range != 0 ) {
		if ( relationbetween(cc, tc) < (-1) ) {
			return 0
		}
	}
	if ( synccheck(tc, -1) ) {
		if ( efid == SKILL_SPELL_HEAL_LIGHT ) {
			txt -1, lang(name(tc) + "の傷はふさがった。", name(tc) + " " + is(tc) + " slightly healed.")
		}
		else {
			if ( efid == SKILL_SPELL_CURE_OF_ERIS ) {
				txt -1, lang(name(tc) + "の身体に生命力がみなぎった。", name(tc) + " " + is(tc) + " greatly healed.")
			}
			else {
				if ( efid == SKILL_SPELL_CURE_OF_JURE | efid == 518 ) {
					txt -1, lang(name(tc) + "は完全に回復した。", name(tc) + " " + is(tc) + " completely healed.")
				}
				else {
					if ( efid == 900 ) {
						txt -1, lang(name(tc) + "は過剰に回復した。", name(tc) + " " + is(tc) + " completely healed.")
					}
					else {
						txt -1, lang(name(tc) + "は回復した。", name(tc) + " " + is(tc) + " healed.")
					}
				}
			}
		}
	}
	gosub *effect_heal
	if ( efstatus >= 1 ) {
		healcon tc, CONDITION_SICK, 5 + rnd(5)
	}
	sickifcursed efstatus, tc, 3
	if ( range == 0 ) {
		animeid = ANIMATION_HEAL
	}
	else {
		animeid = ANIMATION_HEAL_FAST
	}
	gosub *anime
	return 1

*label_4616
	if ( range != 0 ) {
		if ( efbad ) {
			if ( cc == CHARA_PLAYER | cRelation(cc) >= RELATION_NEUTRAL ) {
				if ( cRelation(tc) >= RELATION_NEUTRAL ) {
					return 0
				}
			}
			else {
				if ( cRelation(tc) < RELATION_NEUTRAL ) {
					return 0
				}
			}
		}
		else {
			if ( cc != CHARA_PLAYER | eqfaction(tc, "pcchild") == 0 & cRelation(cc) != cRelation(tc) ) {
				return 0
			}
		}
	}
	if ( synccheck(tc, -1) ) {
		if ( bdataref(BDATAREF_BUFF_TYPE, p) == BUFF_TYPE_BUFF ) {
			animeload 11, tc, p == 14
		}
		else {
			if ( bdataref(BDATAREF_BUFF_TYPE, p) == BUFF_TYPE_HEX ) {
				animeid = ANIMATION_CURSE
				gosub *anime
			}
		}
	}
	if ( efid == SKILL_SPACT_LULWYS_TRICK | p == 5 ) {
		if ( tc == CHARA_PLAYER | (tc == CHARA_PLAYER & cc == gRider) ) {
			if ( gRider != 0 ) {
				tc = gRider
			}
		}
		else {
			if ( ocPetRidingIdx(tc) != 0 ) {
				tc = ocPetRidingIdx(tc)
			}
			else {
				if ( ocPetBeingRiddenIdx(cc) != 0 ) {
					if ( tc == ocPetBeingRiddenIdx(cc) ) {
						tc = cc
					}
				}
			}
		}
	}
	calcbuff CALCBUFF_DURATION, p, efp
	addbuff tc, p, efp, dur
	if ( efid == SKILL_SPELL_SLOW ) {
		if ( efstatus >= 1 ) {
			cAge(tc) += rnd(3) + 1 + efp / 400
			if ( efp > 200 ) {
				if ( cAge(tc) > gYear  ) {
					cAge(tc) = gYear 
				}
			}
			else {
				if ( cAge(tc) + 12 > gYear  ) {
					cAge(tc) = gYear  - 12
				}
			}
			if ( synccheck(tc, -1) ) {
				txtef COLOR_GREEN
				txt -1, lang(name(tc) + "の老化は遅くなった。", name(tc) + your(tc) + " aging process slows down.")
			}
		}
	}
	if ( efid == SKILL_SPELL_SPEED ) {
		if ( efstatus <= (-1) ) {
			cAge(tc) -= rnd(3) + 1 + efp / 400
			if ( synccheck(tc, -1) ) {
				txtef COLOR_PURPLE
				txt -1, lang(name(tc) + "の老化は速くなった。", name(tc) + your(tc) + " aging process speeds up.")
			}
		}
	}
	if ( efid == SKILL_SPELL_INCOGNITO ) {
		if ( tc == CHARA_PLAYER ) {
			incognitobegin
		}
	}
	return

*label_4617
	if ( efstatus == 0 ) {
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "の装備品は白い光に包まれた。", name(tc) + " " + your(tc) + " equipment are surrounded by a white aura.")
		}
	}
	inv_getheader tc
	p(1) = 0, 0
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		if ( iStatus(cnt) >= ITEM_STATUS_NORMAL ) {
			continue
		}
		ci = cnt
		p = 0
		if ( iStatus(ci) == ITEM_STATUS_CURSED ) {
			p = rnd(200) + 1
		}
		if ( iStatus(ci) == ITEM_STATUS_DOOMED ) {
			p = rnd(1000) + 1
		}
		if ( efstatus >= 1 ) {
			p = p / 2 + 1
		}
		else {
			if ( iEquip(ci) == 0 ) {
				continue
			}
		}
		if ( p != 0 ) {
			if ( efp >= p ) {
				p(1)++
				if ( ibit(18, ci) & iStatus(ci) <= ITEM_STATUS_DOOMED ) {
					if ( iEquip(ci) != 0 ) {
						cdata(iEquip(ci), tc) = cdata(iEquip(ci), tc) / EXT_EQUIP_SLOTS * 10000
						iEquip(ci) = 0
					}
					iNum(ci)--
					txtef COLOR_RED
					txt -1, lang("" + itemname(ci) + "は白い光とともに消え去った……", "" + itemname(ci) + "disappear with a white aura.")
					snd SOUNDLIST_CRUSH2
				}
				iStatus(ci) = ITEM_STATUS_NORMAL
				item_stack tc, ci, 1
			}
			else {
				p(2)++
			}
		}
	loop
	if ( efstatus >= 1 ) {
		if ( p(1) != 0 ) {
			if ( synccheck(tc, -1) ) {
				txt -1, lang("幾つかのアイテムが浄化された。", "The aura uncurses some " + his(tc) + " stuff.")
			}
		}
	}
	else {
		if ( p(1) != 0 ) {
			if ( synccheck(tc, -1) ) {
				txt -1, lang("身に付けている装備の幾つかが浄化された。", "The aura uncurses some of " + his(tc) + " equipment.")
			}
		}
	}
	if ( p(2) != 0 ) {
		if ( synccheck(tc, -1) ) {
			txt -1, lang("幾つかのアイテムは抵抗した。", "Several items resist the aura and remain cursed.")
		}
	}
	if ( p(1) == 0 & p(2) == 0 ) {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		obvious = 0
	}
	else {
		animeload 10, tc
	}
	r1 = tc
	gosub *charaRefresh
	return

*label_4619
	p = 0
	repeat 8 + 8
		i = 8 + 8 - cnt - 1
		if ( efid == SKILL_SPELL_HOLY_LIGHT ) {
			if ( p >= 1 ) {
				break
			}
		}
		if ( bdataref(BDATAREF_BUFF_TYPE, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3, tc)) != BUFF_TYPE_HEX ) {
			continue
		}
		if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3, tc) == 13 ) {
			continue
		}
		if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3, tc) == 0 ) {
			continue
		}
		if ( rndex(efp * 2 + 1) > rndex(ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3 + 1, tc) + 1) ) {
			delbuff tc, i
			p++
			continue cnt
		}
	loop
	addbuff tc, BUFF_HOLY_VEIL, efp, 5 + efp / 30
	animeload 11, tc
	return

#defcfunc spellbookcheck int spellbookcheck_prm0
	if ( sLiteracy(spellbookcheck_prm0) == 0 | sMemorize(spellbookcheck_prm0) == 0 ) {
		return 0
	}
	inv_getheader spellbookcheck_prm0
	olistmax = 0
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		if ( refitem(iID(cnt), DBSPEC_TYPE, cnt) != FILTER_ITEM_SPELLBOOK ) {
			continue
		}
		olist(olistmax) = cnt
		olistmax++
	loop
	if ( olistmax == 0 ) {
		return 0
	}
	return 1

#deffunc skillexp2 int skillexp2_skillid, int skillexp2_charid, int skillexp2_amount, int skillexp2_arg4, int skillexp2_arg5
	skillexp skillexp2_skillid, skillexp2_charid, skillexp2_amount, skillexp2_arg4, skillexp2_arg5
	p(86) = stat
	if ( skillexp2_amount > 0 ) {
		if ( skillexp2_skillid >= SKILL_WEAPON_LONGSWORD ) {
			if ( skillexp2_arg5 != 1000 ) {
				if ( skillexp2_charid >= MAX_CHARA_NULL & skillexp2_charid <= 15 ) {
					repeat 15, 1
						if ( cExist(cnt) != CHAR_STATE_ALIVE & cExist(cnt) != CHAR_STATE_ALLY_WAIT ) {
							continue
						}
						if ( skillexp2_charid != cnt ) {
							p(85) = skillexp2_amount / (20 - sqrt(limit(sLER(cnt), 1, 225)))
							if ( p(85) > 0 ) {
								skillexp skillexp2_skillid, cnt, p(85), skillexp2_arg4, skillexp2_arg5
							}
						}
					loop
				}
			}
		}
	}
	return p(86)

#defcfunc readablecheck int readablecheck_prm0, int readablecheck_prm1
	if ( sLiteracy(readablecheck_prm0) == 0 ) {
		return 0
	}
	efidbk = efid
	efpbk = efp
	dbidbk = dbid
	efid = (0 /*!!!@[BUFF_NONE @@@ SKILL_NONE]@!!! */)
	dbmode = DBMODE_ON_READ
	dbid = iID(readablecheck_prm1)
	noread = 1
	gosub *db_item
	p(52) = efid
	dbid = dbidbk
	efp = efpbk
	efid = efidbk
	if ( p(52) == 0 ) {
		return 0
	}
	if ( p(52) == 435 | p(52) == 441 | p(52) == 464 | p(52) == 411 | p(52) == 428 | p(52) == 429 | p(52) == 430 | p(52) == 438 | p(52) == 457 | p(52) == 458 | p(52) == 463 ) {
		return 0
	}
	if ( sLiteracy(readablecheck_prm0) * 20 + 250 < skillDiff(p(52)) ) {
		return 0
	}
	return p(52)

*label_4626
	dim spellconditionlist, 2, 30
	sdim spellconditionlistn, 20, 30
	spellconditionlist(0, 0) = 1, 1
	spellconditionlistn(0) = lang("日中", "Daytime")
	spellconditionlist(0, 1) = 1, 1
	spellconditionlistn(1) = lang("夜間", "Nighttime")
	spellconditionlist(0, 2) = 1, 2
	spellconditionlistn(2) = lang("雨", "Rain")
	spellconditionlist(0, 3) = 1, 2
	spellconditionlistn(3) = lang("雷雨", "Hard rain")
	spellconditionlist(0, 4) = 1, 2
	spellconditionlistn(4) = lang("晴れ", "Sunny")
	spellconditionlist(0, 5) = 1, 2
	spellconditionlistn(5) = lang("雪", "Snow")
	spellconditionlist(0, 6) = 1, 3
	spellconditionlistn(6) = lang("1月", "January")
	spellconditionlist(0, 7) = 1, 3
	spellconditionlistn(7) = lang("2月", "February")
	spellconditionlist(0, 8) = 1, 3
	spellconditionlistn(8) = lang("3月", "March")
	spellconditionlist(0, 9) = 1, 3
	spellconditionlistn(9) = lang("4月", "April")
	spellconditionlist(0, 10) = 1, 3
	spellconditionlistn(10) = lang("5月", "May")
	spellconditionlist(0, 11) = 1, 3
	spellconditionlistn(11) = lang("6月", "June")
	spellconditionlist(0, 12) = 1, 3
	spellconditionlistn(12) = lang("7月", "July")
	spellconditionlist(0, 13) = 1, 3
	spellconditionlistn(13) = lang("8月", "August")
	spellconditionlist(0, 14) = 1, 3
	spellconditionlistn(14) = lang("9月", "Septempber")
	spellconditionlist(0, 15) = 1, 3
	spellconditionlistn(15) = lang("10月", "October")
	spellconditionlist(0, 16) = 1, 3
	spellconditionlistn(16) = lang("11月", "November")
	spellconditionlist(0, 17) = 1, 3
	spellconditionlistn(17) = lang("12月", "December")
	spellconditionlist(0, 18) = 2, 4
	spellconditionlistn(18) = lang("ペットのマナも消費", "Also consume pets MP")
	spellconditionlist(0, 19) = 2, 5
	spellconditionlistn(19) = lang("信仰の深さも消費", "Also consume piety")
	spellconditionlist(0, 20) = 2, 6
	spellconditionlistn(20) = lang("体力も消費", "Also consume HP")
	spellconditionlist(0, 21) = 2, 7
	spellconditionlistn(21) = lang("スタミナも消費", "Also consume SP")
	spellconditionlist(0, 22) = 2, 8
	spellconditionlistn(22) = lang("ターンも消費", "Also consume turns")
	spellconditionlist(0, 23) = 2, 9
	spellconditionlistn(23) = lang("使用後、出血", "Bleed after cast")
	spellconditionlist(0, 24) = 2, 10
	spellconditionlistn(24) = lang("使用後、沈黙", "Silence after cast")
	spellconditionlist(0, 25) = 2, 11
	spellconditionlistn(25) = lang("使用後、発狂", "Unsteady after cast")
	spellconditionlist(0, 26) = 1, 12
	spellconditionlistn(26) = lang("屋内", "Indoor")
	spellconditionlist(0, 27) = 1, 12
	spellconditionlistn(27) = lang("屋外", "Outdoor")
	spellconditionlist(0, 28) = 2, 13
	spellconditionlistn(28) = lang("使用後、麻痺", "Paralyze after cast")
	spellconditionlist(0, 29) = 2, 14
	spellconditionlistn(29) = lang("使用後、朦朧", "Dim after cast")
	return

*label_4627
	userspelloptions(cs) += p
	if ( userspelloptions(cs) > length(spellconditionlistn) ) {
		userspelloptions(cs) = length(spellconditionlistn)
	}
	else {
		if ( userspelloptions(cs) < 0 ) {
			userspelloptions(cs) = 0
		}
	}
	if ( userspelloptions(cs) == 0 ) {
		return
	}
	f = 0
	repeat 3, 4
		if ( cnt != cs ) {
			if ( userspelloptions(cnt) == 0 ) {
				continue
			}
			if ( spellconditionlist(1, userspelloptions(cs) - 1) == spellconditionlist(1, userspelloptions(cnt) - 1) ) {
				f = 1
				break
			}
		}
	loop
	if ( f ) {
		repeat length(spellconditionlistn)
			userspelloptions(cs) += p
			if ( userspelloptions(cs) > length(spellconditionlistn) ) {
				userspelloptions(cs) = length(spellconditionlistn)
				p = -1
			}
			else {
				if ( userspelloptions(cs) < 0 ) {
					userspelloptions(cs) = 0
				}
			}
			if ( userspelloptions(cs) == 0 ) {
				break
			}
			f = 1
			repeat 3, 4
				if ( cnt != cs ) {
					if ( userspelloptions(cnt) == 0 ) {
						continue
					}
					if ( spellconditionlist(1, userspelloptions(cs) - 1) == spellconditionlist(1, userspelloptions(cnt) - 1) ) {
						f = 0
						break
					}
				}
			loop
			if ( f ) {
				break
			}
		loop
	}
	return

*label_4631
	userspelldata(0, userspellmax) = skillUse(p(81))
	userspelldata(1, userspellmax) = skillType(p(81))
	userspelldata(3, userspellmax) = skillTg(p(81))
	userspelldata(4, userspellmax) = userspelloptions(1) * skillDiff(p(81))
	repeat 3, 4
		if ( userspelloptions(cnt) != 0 ) {
			userspelldata(4, userspellmax) = userspelldata(4, userspellmax) * (100 + calcuserspellfixcost(userspelloptions(cnt) - 1)) / 100
		}
	loop
	userspelldatan(1, userspellmax) = "0"
	userspelldatan(2, userspellmax) = "0"
	userspelldatan(3, userspellmax) = "0"
	userspelldatan(4, userspellmax) = "0"
	userspelldatan(5, userspellmax) = "0"
	if ( userspelloptions(0) == 1 ) {
		_switch_val = userspelloptions(3)
		repeat 1
			if ( _switch_val == 1 ) {
				userspelldatan(4, userspellmax) = "" + 50
				break
			}
			if ( _switch_val == 2 ) {
				userspelldatan(4, userspellmax) = "" + 51
				break
			}
			if ( _switch_val == 3 ) {
				userspelldatan(4, userspellmax) = "" + 52
				break
			}
			if ( _switch_val == 4 ) {
				userspelldatan(4, userspellmax) = "" + 53
				break
			}
			if ( _switch_val == 5 ) {
				userspelldatan(4, userspellmax) = "" + 54
				break
			}
			if ( _switch_val == 6 ) {
				userspelldatan(4, userspellmax) = "" + 55
				break
			}
			if ( _switch_val == 7 ) {
				userspelldatan(4, userspellmax) = "" + 56
				break
			}
			if ( _switch_val == 8 ) {
				userspelldatan(4, userspellmax) = "" + 57
				break
			}
			if ( _switch_val == 9 ) {
				userspelldatan(4, userspellmax) = "" + 58
				break
			}
			if ( _switch_val == 10 ) {
				userspelldatan(4, userspellmax) = "" + 59
				break
			}
			if ( _switch_val == 11 ) {
				userspelldatan(4, userspellmax) = "" + 60
				break
			}
			if ( _switch_val == 12 ) {
				userspelldatan(4, userspellmax) = "" + 70
				userspelldata(0, userspellmax) = 17
				break
			}
		loop
	}
	if ( p(81) == 414 ) {
		userspelldatan(1, userspellmax) = "{efp} / 125 + 2 + {attb} / 50"
		userspelldatan(2, userspellmax) = "{efp} / 60 + 9 + 1"
		userspelldatan(5, userspellmax) = "100 + {efp} / 4"
		return
	}
	if ( p(81) == 422 ) {
		userspelldatan(1, userspellmax) = "{efp} / 50 + 1 + {attb} / 20"
		userspelldatan(2, userspellmax) = "{efp} / 25 + 4 + 1"
		userspelldatan(5, userspellmax) = "180 + {efp} / 4"
		return
	}
	if ( p(81) == 433 ) {
		userspelldatan(1, userspellmax) = "{efp} / 80 + 1 + {attb} / 20"
		userspelldatan(2, userspellmax) = "{efp} / 12 + 2 + 1"
		userspelldatan(5, userspellmax) = "150 + {efp} / 5"
		return
	}
	if ( p(81) == 465 ) {
		userspelldatan(5, userspellmax) = "1000"
		return
	}
	if ( p(81) == 405 ) {
		userspelldatan(1, userspellmax) = "2 + {attb} / 22"
		userspelldatan(2, userspellmax) = "{efp} / 18 + 5 + 1"
		userspelldatan(3, userspellmax) = "{efp} / 10"
	}
	if ( p(81) == 407 ) {
		userspelldatan(3, userspellmax) = "{attb} * 5 + {efp} * 3 / 2"
	}
	if ( p(81) == 412 ) {
		userspelldatan(3, userspellmax) = "{attb} * {efp} * 5 / 100"
	}
	_switch_val = userspelloptions(2)
	repeat 1
		if ( _switch_val == 5 ) {
			userspelldata(3, userspellmax) = 3000
			break
		}
		if ( _switch_val == 6 ) {
			userspelldata(3, userspellmax) = 8000
			break
		}
		if ( _switch_val == 7 ) {
			userspelldata(3, userspellmax) = 2006
			break
		}
		if ( _switch_val == 8 ) {
			userspelldata(3, userspellmax) = 3002
			break
		}
	loop
	return

*label_4635
	if ( gArea  != AREA_SHOW_HOUSE ) {
		repeat userspellmax
			userspelldata(11, cnt) = limitmax(userspelldata(11, cnt) + calcuserspellcoststock(cnt) + sMeditation(CHARA_PLAYER) * 50, 2000000000)
			nc_intb_001 = userspelldata(12, cnt) \ 1000 + 5
			if ( ogTitleAthana == 2 ) {
				if ( nc_intb_001 < 51 ) {
					nc_intb_001 = 51
				}
				if ( trophycheck(22) == 2 & nc_intb_001 < 101 ) {
					nc_intb_001 = 101
				}
				if ( nc_intb_001 > 450 + nc_intb_gro1 ) {
					nc_intb_001 = 450 + nc_intb_gro1
				}
			}
			else {
				if ( nc_intb_001 < 1 ) {
					nc_intb_001 = 1
				}
				if ( trophycheck(22) == 2 & nc_intb_001 < 51 ) {
					nc_intb_001 = 51
				}
				if ( nc_intb_001 > 400 + nc_intb_gro1 ) {
					nc_intb_001 = 400 + nc_intb_gro1
				}
			}
			userspelldata(12, cnt) = userspelldata(12, cnt) / 1000000 * 1000000 + userspelldata(12, cnt) \ 1000000 / 1000 * 1000 + nc_intb_001
		loop
		if ( nc_gettrait(0, 109) > 0 ) {
			skillgain CHARA_PLAYER, 520, 1, 200
			skillgain CHARA_PLAYER, 521, 1, 200
			skillgain CHARA_PLAYER, 523, 1, 200
		}
		if ( nc_gettrait(0, 110) > 0 ) {
			skillgain CHARA_PLAYER, 528, 1, 200
			skillgain CHARA_PLAYER, 531, 1, 200
			skillgain CHARA_PLAYER, 538, 1, 200
		}
	}
	return

#defcfunc calcuserspellcostmp int calcuserspellcostmp_prm0
	cost = userspelldata(2, calcuserspellcostmp_prm0)
	repeat 3, 6
		if ( userspelldata(cnt, calcuserspellcostmp_prm0) == 0 ) {
			break
		}
		cost = cost * (100 - calcuserspellfixcost(userspelldata(cnt, calcuserspellcostmp_prm0) - 1)) / 100
	loop
	cost = cost * (100 + userspelldata(12, calcuserspellcostmp_prm0) / 1000000 * 3) / 100 + userspelldata(12, calcuserspellcostmp_prm0) / 1000000 / 8
	return cost

#defcfunc calcuserspellfail int calcuserspellfail_prm0, int calcuserspellfail_prm1
	fixfail = 1
	if ( godcheck(0) == "danalin" ) {
		if ( cSAN(CHARA_PLAYER) >= 100 ) {
			fixfail = 2
		}
	}
	i = 4
	f = carmor(calcuserspellfail_prm1)
	if ( f == 169 ) {
		i = 17 / fixfail - sHeavyArmor(calcuserspellfail_prm1) / 5
	}
	if ( f == 170 ) {
		i = 12 / fixfail - sMediumArmor(calcuserspellfail_prm1) / 5
	}
	if ( i < 4 ) {
		i = 4
	}
	if ( gRider != 0 ) {
		i += 4 / fixfail
	}
	p = 90 + userspelldata(12, calcuserspellfail_prm0) / 1000000 - userspelldata(4, calcuserspellfail_prm0) * i / (5 + sCasting(calcuserspellfail_prm1) * 4)
	if ( fixfail == 1 ) {
		if ( f == 169 ) {
			if ( p > 80 ) {
				p = 80
			}
		}
		else {
			if ( f == 170 ) {
				if ( p > 92 ) {
					p = 92
				}
			}
			else {
				if ( p > 100 ) {
					p = 100
				}
			}
		}
	}
	if ( cAttackStyle(calcuserspellfail_prm1) & 4 ) {
		p -= 6 / fixfail
	}
	if ( cAttackStyle(calcuserspellfail_prm1) & 1 ) {
		p -= 12 / fixfail
	}
	if ( p > 100 ) {
		p = 100
	}
	if ( ogTitleArchmage == 2 ) {
		p += 5
	}
	if ( ogTitleIsis == 2 ) {
		p += 5
	}
	if ( trophycheck(TROPHY_WEAKNESS) == 2 ) {
		p += 5
	}
	return limit(p, 0, 100)

#deffunc userspellexp int userspellexp_prm0, int userspellexp_prm1, int userspellexp_prm2, int userspellexp_prm3, int userspellexp_prm4
	if ( userspellexp_prm2 <= 0 ) {
		return
	}
	if ( userspelldata(0, userspellexp_prm0) != 0 ) {
		skillexp userspelldata(0, userspellexp_prm0), userspellexp_prm1, userspellexp_prm2 / (2 + userspellexp_prm3)
	}
	locvar_skillmod_lv = userspelldata(12, userspellexp_prm0) / 1000000
	locvar_skillmod_growth = userspelldata(12, userspellexp_prm0) \ 1000
	if ( locvar_skillmod_growth == 0 ) {
		return
	}
	locvar_skillmod_exp = userspellexp_prm2 * locvar_skillmod_growth / (100 + locvar_skillmod_lv * 15)
	if ( findbuff(userspellexp_prm1, 85) != (-1) ) {
		locvar_skillmod_exp = locvar_skillmod_exp * (100 + limitmax(ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + findbuff(userspellexp_prm1, 85) * 3 + 1, userspellexp_prm1) / 200, 500)) / 100
	}
	if ( locvar_skillmod_exp == 0 ) {
		if ( rnd(locvar_skillmod_lv / 10 + 1) == 0 ) {
			locvar_skillmod_exp = 1
		}
		else {
			return 0
		}
	}
	if ( gArea  == AREA_SHOW_HOUSE ) {
		locvar_skillmod_exp /= 5
	}
	locvar_skillexp_exp2 = rndex(limit(cExpToNext(userspellexp_prm1) * locvar_skillmod_exp / 1000 / (cLevel(userspellexp_prm1) + userspellexp_prm4) + 1, 1, 1000000)) + rnd(2)
	cExp(userspellexp_prm1) += locvar_skillexp_exp2
	if ( userspellexp_prm1 == 0 ) {
		gSleepExp += locvar_skillexp_exp2
	}
	locvar_skillmod_exp += userspelldata(12, userspellexp_prm0) \ 1000000 / 1000
	if ( locvar_skillmod_exp >= 1000 ) {
		locvar_skillmod_lvchange = locvar_skillmod_exp / 1000
		locvar_skillmod_exp = locvar_skillmod_exp \ 1000
		locvar_skillmod_lv += locvar_skillmod_lvchange
		repeat locvar_skillmod_lvchange
			locvar_skillmod_growth = int(double(locvar_skillmod_growth) * 0.9)
			if ( ogTitleAthana == 2 ) {
				if ( locvar_skillmod_growth < 51 ) {
					locvar_skillmod_growth = 51
				}
				if ( trophycheck(22) == 2 & locvar_skillmod_growth < 101 ) {
					locvar_skillmod_growth = 101
				}
			}
			else {
				if ( locvar_skillmod_growth < 1 ) {
					locvar_skillmod_growth = 1
				}
				if ( trophycheck(22) == 2 & locvar_skillmod_growth < 51 ) {
					locvar_skillmod_growth = 51
				}
			}
		loop
		userspelldata(12, userspellexp_prm0) = limit(locvar_skillmod_lv, 0, 2000) * 1000000 + locvar_skillmod_exp * 1000 + locvar_skillmod_growth
		snd SOUNDLIST_DING3
		txtef COLOR_GREEN
		msgalert = 1
		txt -1, lang(name(userspellexp_prm1) + "は" + userspelldatan(0, userspellexp_prm0) + "の技術の向上を感じた。", name(userspellexp_prm1) + your(userspellexp_prm1) + " " + userspelldatan(0, userspellexp_prm0) + " skill increases.")
		return 1
	}
	userspelldata(12, userspellexp_prm0) = limit(locvar_skillmod_lv, 0, 2000) * 1000000 + locvar_skillmod_exp * 1000 + locvar_skillmod_growth
	return 0

#defcfunc calcuserspellcoststock int calcuserspellcoststock_prm0
	p(75) = userspelldata(2, calcuserspellcoststock_prm0)
	repeat 3, 6
		if ( userspelldata(cnt, calcuserspellcoststock_prm0) == 0 ) {
			break
		}
		p(75) = p(75) * (100 - calcuserspellfixcost(userspelldata(cnt, calcuserspellcoststock_prm0) - 1)) / 100
	loop
	locvar_calcspellcoststock_cost = p(75) * (150 + magiccritical * 150) / (userspelldata(12, calcuserspellcoststock_prm0) / 1000000 * 3 / 2 + 100)
	if ( locvar_calcspellcoststock_cost < p(75) / 5 ) {
		locvar_calcspellcoststock_cost = p(75) / 5
	}
	locvar_calcspellcoststock_cost = rndex(locvar_calcspellcoststock_cost / 2 + 1) + locvar_calcspellcoststock_cost / 2
	if ( locvar_calcspellcoststock_cost < 1 ) {
		locvar_calcspellcoststock_cost = 1
	}
	return locvar_calcspellcoststock_cost

*label_4644
	snd SOUNDLIST_POP2
	page_save
	page = 0
	pagesize = 15
	listmax = 0
	p = 0
	s = ""
	olistmax = 0
	if ( userspelldata(1, title_pos) > 1000 ) {
		if ( jp ) {
			if ( userspelldata(3, title_pos) == 3000 ) {
				s = "自分対象の"
			}
			else {
				if ( userspelldata(3, title_pos) == 8000 ) {
					s = "任意の方向の"
				}
				else {
					if ( userspelldata(3, title_pos) == 2006 ) {
						s = "任意の対象の"
					}
					else {
						if ( userspelldata(3, title_pos) == 3002 ) {
							s = "範囲の"
						}
					}
				}
			}
			s += buffname(userspelldata(1, title_pos) \ 1000)
		}
		else {
			s = buffname(userspelldata(1, title_pos) \ 1000)
			if ( userspelldata(3, title_pos) == 3000 ) {
				s += " (yourself)"
			}
			else {
				if ( userspelldata(3, title_pos) == 8000 ) {
					s += " (direction)"
				}
				else {
					if ( userspelldata(3, title_pos) == 2006 ) {
						s += " (target)"
					}
					else {
						if ( userspelldata(3, title_pos) == 3002 ) {
							s += " (range)"
						}
					}
				}
			}
		}
	}
	else {
		if ( userspelldata(1, title_pos) == 4 ) {
			if ( userspelldata(3, title_pos) == 3000 ) {
				s = lang("自分対象の治癒", "Heal (yourself)")
			}
			else {
				if ( userspelldata(3, title_pos) == 8000 ) {
					s = lang("任意の方向の治癒", "Heal (direction)")
				}
				else {
					if ( userspelldata(3, title_pos) == 2006 ) {
						s = lang("任意の対象の治癒", "Heal (target)")
					}
					else {
						if ( userspelldata(3, title_pos) == 3002 ) {
							s = lang("範囲の治癒", "Heal (range)")
						}
					}
				}
			}
		}
		else {
			if ( userspelldata(1, title_pos) == 12 ) {
				if ( userspelldata(3, title_pos) == 3000 ) {
					s = lang("自分対象の全浄化", "Vanquish hex (yourself)")
				}
				else {
					if ( userspelldata(3, title_pos) == 8000 ) {
						s = lang("任意の方向の全浄化", "Vanquish hex (direction)")
					}
					else {
						if ( userspelldata(3, title_pos) == 2006 ) {
							s = lang("任意の対象の全浄化", "Vanquish hex (target)")
						}
						else {
							if ( userspelldata(3, title_pos) == 3002 ) {
								s = lang("範囲の全浄化", "Vanquish hex (range)")
							}
						}
					}
				}
			}
			else {
				if ( userspelldata(1, title_pos) == 13 ) {
					if ( userspelldata(3, title_pos) == 3000 ) {
						s = lang("自分対象のアイテム解呪", "Uncurse (yourself)")
					}
					else {
						if ( userspelldata(3, title_pos) == 8000 ) {
							s = lang("任意の方向のアイテム解呪", "Uncurse (direction)")
						}
						else {
							if ( userspelldata(3, title_pos) == 2006 ) {
								s = lang("任意の対象のアイテム解呪", "Uncurse (target)")
							}
							else {
								if ( userspelldata(3, title_pos) == 3002 ) {
									s = lang("範囲のアイテム解呪", "Uncurse (range)")
								}
							}
						}
					}
				}
				else {
					s = cnven(skillname(int(userspelldatan(4, title_pos)))) + lang("属性の", " ")
					if ( userspelldata(3, title_pos) == 2006 ) {
						s += lang("矢", "arrow")
					}
					else {
						if ( userspelldata(3, title_pos) == 3002 ) {
							s += lang("ボール", "ball")
						}
						else {
							if ( userspelldata(3, title_pos) == 9006 ) {
								s += lang("ボルト", "bolt")
							}
							else {
								if ( userspelldata(3, title_pos) == 10000 ) {
									s += lang("メテオ", "meteor")
								}
							}
						}
					}
				}
			}
		}
	}
	title_description(0) = lang("威力: ", "Power: ") + userspelldata(5, title_pos)
	title_description(1) = lang("効果: ", "Effect: ") + s
	title_description(2) = lang("制約:\n", "Limitation:\n")
	repeat 3
		if ( userspelldata(6 + cnt, title_pos) == 0 ) {
			if ( cnt == 0 ) {
				title_description(2) += lang("\tなし", "\tNo limitations")
			}
			break
		}
		title_description(2) += "\t" + spellconditionlistn(userspelldata(6 + cnt, title_pos) - 1) + "\n"
	loop
	repeat 3
		if ( title_description(cnt) == "" ) {
			continue
		}
		list(0, p) = 0
		listn(0, p) = ""
		p++
		buf = trimdesc(title_description(cnt), 2)
		notesel buf
		repeat noteinfo(0)
			noteget q, cnt
			p(1) = 66, 0
			if ( strlen(q) > p(1) ) {
				repeat strlen(q) / p(1) + 1
					if ( strmid(q, p(2) + p(1), 2) == "。" | strmid(q, p(2) + p(1), 2) == "、" ) {
						p(1) += 2
					}
					if ( strmid(q, p(2), p(1)) == "" ) {
						break
					}
					list(0, p) = -1
					listn(0, p) = strmid(q, p(2), p(1))
					p++
					p(2) += p(1)
				loop
			}
			else {
				list(0, p) = 0
				listn(0, p) = q
				if ( cnt == noteinfo(0) - 1 ) {
					list(0, p) = -1
				}
				p++
			}
		loop
	loop
	if ( p == 0 ) {
		list(0, p) = 0
		listn(0, p) = lang("特に情報はない", "There is no information about this spell.")
		p++
	}
	listmax = p
	pagemax = (listmax - 1) / pagesize
	windowshadow = 1
	key_list = key_enter
	keyrange = 0
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4649
	redraw 0
	s = lang("魔法の情報", "Spell info")
	s(1) = lang("ｷｬﾝｾﾙ [閉じる]  決定キー [名前を変える]", "Shift,Esc [Close]  Enter [Change Name]")
	display_window (windoww - 600) / 2 + inf_screenx, winposy(408), 600, 408
	display_topic userspelldatan(0, title_pos), wx + 28, wy + 34
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		color 0, 0, 0
		pos wx + 68, wy + 68 + cnt * 18
		if ( list(0, p) == (-1) ) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 0
		}
		if ( list(0, p) == (-2) ) {
			font lang(cfg_font1, cfg_font2), 13 - en * 2, 2
			pos wx + ww - strlen(listn(0, p)) * 6 - 80, wy + 68 + cnt * 18
		}
		mes listn(0, p)
	loop
	redraw 1
	await cfg_wait1
	key_check
	if ( key == key_enter ) {
		txt -1, lang("この魔法を何と呼ぶ？ ", "What do you want to call this spell? ")
		val = (windoww - 360) / 2 + inf_screenx, winposy(90), 20, 1, 0
		inputlog = ""
		input_mode = 1
		gosub *prompt_word
		if ( inputlog == "" ) {
			txt -1, lang("名前を変えるのは止めた。", "You changed your mind.")
		}
		else {
			userspelldatan(0, title_pos) = "" + inputlog
			txt -1, lang("" + inputlog + "という名前をつけた。", "You named the spell " + inputlog + ".")
		}
	}
	if ( key == key_cancel ) {
		return
	}
	goto *label_4649

*label_4651
	repeat 245
		if ( cId(cnt) == CREATURE_ID_USER ) {
			getunid cnt
		}
	loop
	return

*label_4653
	calcbuff CALCBUFF_DURATION, p, cPiety(r1)
	addbuff r1, p, cPiety(r1), dur
	return

*label_4654
	ammo = -1
	repeat 30
		body = 100 + cnt
		if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == 11 ) {
			ammo = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
			break
		}
	loop
	return

#defcfunc aliveweaponname
	p(73) = 0
	repeat 30, 100
		if ( cdata(cnt, CHARA_PLAYER) == 0 ) {
			continue
		}
		if ( cdata(cnt, CHARA_PLAYER) / EXT_EQUIP_SLOTS != 5 & cdata(cnt, CHARA_PLAYER) / EXT_EQUIP_SLOTS != 10 ) {
			continue
		}
		i = cdata(cnt, CHARA_PLAYER) \ EXT_EQUIP_SLOTS - 1
		if ( i <= 0 ) {
			continue
		}
		if ( ibit(ITEM_BIT_ALIVE, i) == FALSE ) {
			continue
		}
		p(73) = i
		break
	loop
	if ( p(73) ) {
		i = p(73)
		if ( iSubName(i) >= 40000 ) {
			randomize iSubName(i) - 40000
			s = random_title(1)
			randomize timeGetTime()
			return s
		}
	}
	return ""

*label_4658
	page = 0
	pagesize = 19
	cs = 0
	cs_bk = -1
	ww = 380
	wh = 340
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	snd SOUNDLIST_PORT
	windowanime wx, wy, ww, wh, 10, 7
	gsel BUFFER_BUF
	pos 0, 0
	exist exedir + "user\\graphic\\user_face1.bmp"
	if ( strsize != (-1) & cfg_userface1 ) {
		picload_ exedir + "user\\graphic\\user_face1.bmp", 1 * (windoww >= 1280)
		ex_userface = 1
	}
	else {
		picload_ exedir + "graphic\\face1.bmp", 1
		ex_userface = 0
	}
	buffer BUFFER_PIC, 1440, 1080
	color 0, 0, 0
	boxf
	repeat 128
		s = exedir + "user\\graphic\\face" + (cnt + 1) + ".bmp"
		exist s
		if ( strsize != (-1) ) {
			pos cnt \ 16 * 80, cnt / 16 * 112
			picload_ s, 1
		}
	loop
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_mirror.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1
	if ( cc != CHARA_PLAYER ) {
		if ( cId(cc) != CREATURE_ID_USER ) {
			if ( cPic(cc) \ 1000 <= 660 ) {
				cUNID(cc) = cPic(cc)
			}
		}
	}
	listmax = 0
	olist = 0, 1, 10
	if ( jp ) {
		s = "決定    ", "肖像　　", "ｷｬﾗﾁｯﾌﾟ "
	}
	if ( en ) {
		s = "Done    ", "Portrait", "Charachip "
	}
	p = 3
	repeat p
		list(0, cnt) = cnt, olist(cnt)
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop

*label_4662
	redraw 0
	pagesize = 0
	s = lang("肖像の変更", "Appearance"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 380) / 2 + inf_screenx, winposy(340) - 12, 380, 374
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	pos wx + ww - 40, wy
	gcopy BUFFER_INF, 960, 96, 48, 120
	i++
	if ( i \ 100 < 45 ) {
		f = i \ 16
	}
	else {
		f++
	}
	window2 wx + 234, wy + 71, 88, 120, 1, 1
	if ( cs == 1 ) {
		if ( cPortrait(cc) >= 0 ) {
			p = cSex(cc) * 64 + cPortrait(cc)
			pos wx + 238, wy + 75
			exist exedir + "user\\graphic\\user_npcface" + p + ".bmp"
			if ( strsize != (-1) ) {
				gsel 32
				pos 0, 0
				picload_ exedir + "user\\graphic\\user_npcface" + p + ".bmp", 1
				gsel BUFFER_SCREEN
				pos wx + 238, wy + 75
				gzoom 80, 112, 32, 0, 0, 80, 112
			}
			else {
				if ( ex_userface == 1 ) {
					gzoom 80, 112, 4, p \ 16 * 80, p / 16 * 112, 80, 112
				}
				else {
					gzoom 80, 112, 4, p \ 16 * 48, p / 16 * 72, 48, 72
				}
			}
		}
		else {
			if ( cPortrait(cc) != (-1) ) {
				pos wx + 238, wy + 75
				gzoom 80, 112, 7, abs(cPortrait(cc) + 2) \ 16 * 80, abs(cPortrait(cc) + 2) / 16 * 112, 80, 112
			}
			else {
				if ( cId(cc) == CREATURE_ID_USER ) {
					if ( userdata2(0, cUNID(cc)) ) {
						pos wx + 238, wy + 75
						gzoom 80, 112, 100, cUNID(cc) \ 16 * 80, cUNID(cc) / 16 * 112, 80, 112
					}
				}
			}
		}
	}
	else {
		if ( cbit(CHARA_BIT_PCC, cc) == TRUE ) {
			pos wx + 280, wy + 130
			gmode 2, 32, 48
			grotate 10 + cc, f / 4 \ 4 * 32, f / 16 \ 4 * 48, 0, 48, 80
		}
		else {
			transmissivity = 0
			if ( cId(cc) == CREATURE_ID_USER ) {
				if ( userdata2(1, cUNID(cc)) ) {
					transmissivity = userdata2(1, cUNID(cc))
				}
			}
			if ( ocChipTransparency(cc) ) {
				transmissivity = ocChipTransparency(cc)
			}
			i = getcharapic(cc)
			chara_preparepic i, getcharacolor(cc)
			pos wx + 280, wy + 130
			gmode 4, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i), 256 - transmissivity
			color 0, 0, 0
			grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i)
		}
	}
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if ( p >= listmax ) {
			break
		}
		val = list(1, p), 0
		gosub *portrait_item
		s = listn(0, p)
		if ( rtval >= 0 ) {
			if ( rtval(2) >= 0 ) {
				s += " " + rtval(2)
			}
			else {
				if ( rtval(2) == (-1) ) {
					s += " N/A"
				}
				else {
					s += " u" + (abs(rtval(2)) - 1)
				}
			}
		}
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
		if ( rtval != (-2) ) {
			pos wx + 30, wy + 66 + cnt * 21 - 5
			gcopy BUFFER_INF, 312, 336, 24, 24
			pos wx + 175, wy + 66 + cnt * 21 - 5
			gcopy BUFFER_INF, 336, 336, 24, 24
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	val = list(1, cs), 0
	gosub *portrait_item
	p = 0
	if ( rtval == (-2) ) {
		if ( key == key_enter ) {
			return 1
		}
		if ( key == key_pageup | key == key_pagedown ) {
			key = ""
		}
	}
	else {
		if ( key == key_enter ) {
			key = key_pageup
		}
	}
	if ( key == key_pageup ) {
		snd SOUNDLIST_CURSOR1
		if ( rtval == 100 ) {
			if ( cPortrait(cc) < 32 - 1 ) {
				cPortrait(cc)++
			}
			goto *label_4662
		}
		if ( rtval == 102 ) {
			if ( cPic(cc) \ 1000 < 692 | cPic(cc) \ 1000 >= 825 ) {
				if ( cPic(cc) \ 1000 <= 660 | cPic(cc) \ 1000 >= 825 ) {
					cPic(cc) = xy2pic(1, 20)
				}
				else {
					cPic(cc)++
				}
			}
			goto *label_4662
		}
	}
	if ( key == key_pagedown ) {
		snd SOUNDLIST_CURSOR1
		if ( rtval == 100 ) {
			if ( cPortrait(cc) > (-129) ) {
				cPortrait(cc)--
			}
			goto *label_4662
		}
		if ( rtval == 102 ) {
			if ( cPic(cc) \ 1000 > 660 & cPic(cc) \ 1000 < 825 ) {
				cPic(cc)--
				if ( cPic(cc) \ 1000 <= 660 ) {
					cPic(cc) = (cId(cc) == CREATURE_ID_USER) * 825 + cUNID(cc)
				}
			}
			goto *label_4662
		}
	}
	if ( key == key_cancel ) {
		return 0
	}
	if ( mode == MODELIST_CHARA_CREATION ) {
		getkey p, 112
		if ( p ) {
			return -1
		}
	}
	goto *label_4662

*label_4664
	gsel BUFFER_BUF
	repeat 8
		pos cnt \ 4 * 180, cnt / 4 * 300
		picload_ exedir + "\\graphic\\g" + (cnt + 1) + ".bmp", 1
	loop
	gsel BUFFER_SCREEN
	listmax = 0
	page = 0
	pagesize = 14
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat userspellmax
		if ( userspelldata(0, cnt) > 0 ) {
			list(0, listmax) = cnt
			listn(0, listmax) = userspelldatan(0, cnt)
			listmax++
		}
	loop
	windowshadow = 1

*label_4667
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4668
	redraw 0
	s = lang("独自魔法一覧", "Custom spells"), lang("決定 [封印]  ", "Enter [Seal] ") + strhint2 + strhint3
	display_window (windoww - 500) / 2 + inf_screenx, winposy(400), 500, 400
	x = ww / 5 * 3
	y = wh - 80
	gmode 4, 180, 300, 50
	pos wx + ww / 3 * 2, wy + wh / 2
	grotate BUFFER_BUF, cmbg / 4 \ 4 * 180, cmbg / 4 / 4 \ 2 * 300, 0, x, y
	gmode 2
	display_topic lang("独自魔法", "Custom spell"), wx + 28, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini ww - 100, 18
			gfdec2 12, 14, 16
		}
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = "" + listn(0, p)
		cs_list s, wx + 58, wy + 66 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = pagesize * page + cnt
			break
		}
	loop
	if ( p != (-1) ) {
		p = list(0, p)
		return 1
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4667
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4667
		}
	}
	if ( key == key_cancel ) {
		screenupdate = -1
		gosub *screen_draw
		return
	}
	goto *label_4668

*label_4672
	repeat 50
		if ( userspelldata(0, cnt) == 0 ) {
			userspellmax = cnt
			break
		}
		resetuserspell cnt
	loop
	return 1

*label_4674
	if ( getcgodno() != (-1) ) {
		god_no = stat
		repeat 2
			if ( usergoddatan(11 + cnt, god_no) != "" ) {
				skillUse(779 + cnt) = usergoddata(50 + cnt, god_no), usergoddata(52 + cnt, god_no), usergoddata(54 + cnt, god_no), usergoddata(56 + cnt, god_no), 110
				skillname(779 + cnt) = lang(usergoddatan(13 + cnt, god_no), usergoddatan(11 + cnt, god_no))
				skilldesc(779 + cnt) = ""
				if ( 779 + cnt < 600 ) {
					skillencdesc(779 + cnt) = ""
				}
			}
		loop
		if ( usergodskilldatan(0, god_no) != "" ) {
			skillUse(810) = usergodskilldata(0, god_no), usergodskilldata(1, god_no), usergodskilldata(2, god_no), usergodskilldata(3, god_no), 110
			skillname(810) = lang(usergodskilldatan(1, god_no), usergodskilldatan(0, god_no))
		}
	}
	return 1

*label_4676
	if ( getcgodno() != (-1) ) {
		god_no = stat
		if ( usergoddata(32, god_no) != 0 ) {
			if ( usergoddata(32, god_no) / 1000 == 0 ) {
				skillUse(781) = skillUse(usergoddata(32, god_no)), skillType(usergoddata(32, god_no)), skillCost(usergoddata(32, god_no)), skillTg(usergoddata(32, god_no)), skillDiff(usergoddata(32, god_no))
				if ( usergoddatan(28, god_no) != "" ) {
					skillname(781) = usergoddatan(28, god_no)
				}
				else {
					skillname(781) = skillname(usergoddata(32, god_no))
				}
				skilldesc(781) = skilldesc(usergoddata(32, god_no))
				skillencdesc(781) = skillencdesc(usergoddata(32, god_no))
			}
		}
	}
	return 1

*label_4677
	if ( train ) {
		buff = lang("訓練は完了し" + _ta() + "潜在能力が伸びているはずなので、後は自分で鍛えて" + _kure(), "Well done. You've got more room to develop than anyone else I've ever drilled. Keep training.")
	}
	else {
		buff = lang("訓練が必要なときは、声をかけて" + _kure(), "Come see me again when you need more training.")
	}
	goto *label_3785

*label_4678
	p(64) = iParam2(ri) \ 8
	efsource = 5
	if ( p(64) == 4 ) {
		txt -1, lang("魔力の渦が何かを召喚した！", "Several creatures are summoned from a vortex of magic.")
		repeat 2 + rnd(3)
			flt calcobjlv(iParam2(ri) * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
			characreate -1, CREATURE_ID_BUG, cX(cc), cY(cc)
		loop
	}
	if ( p(64) == 6 ) {
		if ( rnd(250) ) {
			txt -1, lang("終末の日が訪れた…ような気がしたが気のせいだった。", "Let's Ragnarok?! ...Nothing happens.")
		}
		else {
			evadd EVENT_RAGNAROK, cc
		}
	}
	if ( p(64) == 5 ) {
		txtef COLOR_RED
		txt -1, lang("けたたましい警報が鳴り響いた！", "*beeeeeep!* An alarm sounds loudly!")
		make_sound cX(cc), cY(cc), 10, 1, 1, cc
		repeat 229, 16
			if ( cExist(cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cSleep(cnt) != 0 ) {
				continue
			}
			if ( cRelation(cnt) != RELATION_ENEMY ) {
				continue
			}
			turn_aggro cnt, cc, 80
		loop
	}
	if ( p(64) == 3 ) {
		if ( encfind(cc, ENCHANT_PREVENT_TELEPORT) != (-1) & (findbuff(cc, 62) == (-1) | have_bigench(cc, 3) == 1) | findfaction(cc, "regist", "teleport") ) {
			if ( synccheck(cc, -1) ) {
				txt -1, lang("魔法の力がテレポートを防いだ。", "Magical field prevents teleportation.")
			}
		}
		else {
			repeat 200
				cXnew(cc) = rnd(mWidth - 2) + 1
				cYnew(cc) = rnd(mHeight - 2) + 1
				cell_check cXnew(cc), cYnew(cc)
				if ( cellaccess == 1 ) {
					if ( synccheck(cc, -1) ) {
						snd SOUNDLIST_TELEPORT1
						txt -1, lang(name(cc) + "は突然消えた。", "Suddenly, " + name(cc) + " disappear" + _s(cc) + ".")
					}
					rowactend cc
					redraw 0
					gosub *screen_draw
					break
				}
			loop
			iParam2(ri) = 0
			goto *label_3294
		}
	}
	if ( p(64) == 0 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang("宝箱は発火した。", "The chest ignites.")
		}
		repeat 6
			tlocx = cX(cc) + rnd(3) - rnd(3)
			tlocy = cY(cc) - rnd(3) + rnd(3)
			if ( tlocx < 0 | tlocx >= mWidth | tlocy < 0 | tlocy >= mHeight ) {
				continue
			}
			addmef tlocx, tlocy, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(15) + 20, 50, CHARA_PLAYER
			mapitem_fire tlocx, tlocy
		loop
	}
	if ( p(64) == 1 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang("毒ガスが噴き出した。", "Poisonous gas spreads.")
		}
		dmgcon cc, CONDITION_POISON, 100 + iParam2(ri) * 2
	}
	if ( p(64) == 2 ) {
		if ( synccheck(cc, -1) ) {
			txt -1, lang("催眠ガスが噴き出した。", "Sleeping gas spreads.")
		}
		dmgcon cc, CONDITION_SLEEP, 100 + iParam2(ri) * 2
	}
	if ( p(64) == 7 ) {
		txtef COLOR_SKY_BLUE
		txt -1, lang(" *チュドーン！* ", "*kabooom*")
		aniref = 0
		animeid = ANIMATION_BALL
		anix = cX(cc)
		aniy = cY(cc)
		gosub *anime
		cell_featset cX(cc), cY(cc), 0
		if ( gArea  == 210 & ncgdata(NCGDATA_ABYSS_TITLE_7) ) {
			dmghp cc, 1000000 + gLevel  * 10000 + cHP(cc) / 2, DAMAGE_FROM_TRAP
		}
		else {
			dmghp cc, 100 + rnd(200), DAMAGE_FROM_TRAP
		}
	}
	efsource = 0
	iParam2(ri) = 0
	return

*label_4683
	f = 1
	if ( x < 0 | y < 0 | x >= mWidth | y >= mHeight ) {
		f = 0
	}
	else {
		if ( chipm(CHIPM_ATTRIB, mapId(x, y)) & CHIPM_ATTRIB_CANT_PASS ) {
			f = 0
		}
	}
	if ( dist(tlocx, tlocy, x, y) >= p ) {
		f = 0
	}
	if ( f == 0 ) {
		if ( rnd(2) == 0 ) {
			return 0
		}
		else {
			return -1
		}
	}
	if ( efid == SKILL_SPACT_ETHER_GROUND ) {
		addmef x, y, MEF_TYPE_ETHER, xy2pic(20, 0), rnd(4) + 2, efp, cc
	}
	if ( efid == SKILL_SPELL_ACID_GROUND ) {
		addmef x, y, MEF_TYPE_ACID, xy2pic(19, 0), rnd(10) + 5, efp, cc
	}
	if ( efid == SKILL_SPELL_FIRE_WALL ) {
		addmef x, y, MEF_TYPE_FIRE, xy2pic(24, 0), rnd(10) + 5, efp, cc
		mapitem_fire x, y
	}
	if ( efid == SKILL_SPELL_WEB ) {
		addmef x, y, MEF_TYPE_WEB, xy2pic(11, 0), -1, efp * 2
	}
	if ( efid == SKILL_SPELL_MIST_OF_DARKNESS ) {
		addmef x, y, MEF_TYPE_MIST, xy2pic(30, 0), 8 + rnd(15 + efp / 25), efp
	}
	return 1

#defcfunc buffy int buffy_prm0
	if ( buffy_prm0 >= 50 ) {
		p(63) = (25 + (usernpcmax / 33 + 1) * 2) * 48 + (buffy_prm0 / 50 - 1) * 32
	}
	else {
		p(63) = 1120
	}
	return p(63)

*label_4685
	if ( s(4) == "" | s(4) == "empty" ) {
		return
	}
	if ( jp ) {
		sreplace buff, buff, "モンスター", s(4)
		sreplace buff, buff, "魔物", s(4)
	}
	else {
		sreplace buff, buff, "creature", s(4)
	}
	return

*label_4686
	ecount = 0
	memset searchene, 0, 15 * 4
	if ( eqfaction(cc, "angel") ) {
		return
	}
	procbody = *label_4692
	gosub *label_4687
	return

*label_4687
	ccsync = synccheck(cc, -1)
	repeat searchfov
		y = ypoint - searchdist + cnt
		if ( y < 0 | y >= mHeight ) {
			continue
		}
		repeat searchfov
			x = xpoint - searchdist + cnt
			if ( x < 0 | x >= mWidth ) {
				continue
			}
			c = mapChara(x, y) - 1
			if ( c < 0 ) {
				continue
			}
			if ( synccheck(c, -1) == 0 ) {
				if ( ccsync != 0 ) {
					continue
				}
			}
			if ( cbit(CHARA_BIT_NO_TARGET, c) == FALSE ) {
				gosub procbody
			}
		loop
	loop
	return

*label_4690
	if ( relationbetween(cc, c) == 10 ) {
		if ( cHP(c) <= cMHP(c) / (4 - (ocAIHealingBehavior(cc) == 1) * 2) ) {
			searchene(ecount) = c
			ecount++
		}
	}
	return

*label_4691
	if ( cHP(c) < cMHP(c) ) {
		searchene(ecount) = c
		ecount++
	}
	return

*label_4692
	if ( relationbetween(cc, c) == (-3) | factionbetween(cc, c) == (-3) ) {
		if ( c == 0 ) {
			if ( cRelation(cc) > RELATION_ENEMY ) {
				cRelation(cc) = RELATION_ENEMY
			}
		}
		if ( gettrait(c, 59) >= 2 ) {
			r1 = c
			gosub *label_4712
		}
		if ( gettrait(c, 132) ) {
			if ( rnd(10) < calctraitscore(stat) ) {
				addbuff c, BUFF_SPEED, sorgex(18, c) * 5 + 50, 5
			}
		}
		searchene(ecount) = c
		ecount++
	}
	return

*label_4693
	if ( relationbetween(cc, c) == 10 ) {
		if ( rnd(10) == 0 ) {
			dbmode = DBMODE_ON_ZAP
			dbid = iID(ci)
			gosub *db_item
			if ( efid == SKILL_SPACT_LULWYS_TRICK | efid == SKILL_SPELL_SPEED ) {
				if ( c == 0 ) {
					if ( gRider != 0 ) {
						return
					}
				}
				if ( ocPetRidingIdx(c) != 0 ) {
					return
				}
			}
			if ( findbuff(c, skillType(efid) \ 1000) == (-1) ) {
				searchene(ecount) = c
				ecount++
			}
		}
	}
	return

*label_4694
	if ( relationbetween(cc, c) == 10 ) {
		repeat 8 + 8
			i = 8 + 8 - cnt - 1
			if ( bdataref(BDATAREF_BUFF_TYPE, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3, c)) == BUFF_TYPE_HEX ) {
				dbmode = DBMODE_ON_ZAP
				dbid = iID(ci)
				gosub *db_item
				lint_efp = efp * (100 + sMagicDevice(cc) * 10 + sMAG(cc) / 2 + sPER(cc) / 2) / 100
				efp = limitmax(lint_efp, 2147483647)
				if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3 + 1, c) < efp * 2 ) {
					searchene(ecount) = c
					ecount++
					break
				}
			}
		loop
	}
	return

*label_4696
	ecount = 0
	memset searchene, 0, 15 * 4
	if ( eqfaction(cc, "angel") ) {
		procbody = *label_4691
		gosub *label_4687
	}
	else {
		if ( medicalcheck(cc) ) {
			procbody = *label_4690
			gosub *label_4687
		}
	}
	if ( ecount != 0 ) {
		return
	}
	if ( eqfaction(cc, "holy") ) {
		if ( getfactionvalue(cc, "removehexby") != "" ) {
			p(74) = int(refstr)
			if ( usablecheck(p(74), cc) ) {
				ci = stat
				procbody = *label_4694
				gosub *label_4687
			}
		}
	}
	if ( ocHostileTargetTotal(cc) ) {
		if ( eqfaction(cc, "buffer") ) {
			if ( getfactionvalue(cc, "buffby") != "" ) {
				p(74) = int(refstr)
				if ( usablecheck(p(74), cc) ) {
					ci = stat
					procbody = *label_4693
					gosub *label_4687
				}
			}
		}
	}
	return

*label_4697
	if ( cAiAggro(cc) > 0 | cRelation(cc) == RELATION_ALLY ) {
		distance = dist(cX(tc), cY(tc), cX(cc), cY(cc))
		if ( cFear(cc) != 0 ) {
			retreat = 1
			goto *ai_followMove
		}
		else {
			retreat = 0
		}
		if ( cBlind(cc) != 0 ) {
			if ( rnd(3) ) {
				goto *label_4024
			}
		}
		if ( eqfaction(cc, "angel") ) {
			if ( cHP(tc) < cMHP(tc) ) {
				goto *label_4532
			}
			unwatchon cc, tc
			goto *ai_turn
		}
		if ( medicalcheck(cc) ) {
			if ( cHP(tc) <= cMHP(tc) / (4 - (ocAIHealingBehavior(cc) == 1) * 2) ) {
				goto *label_4532
			}
		}
		if ( eqfaction(cc, "holy") ) {
			if ( getfactionvalue(cc, "removehexby") != "" ) {
				p(74) = int(refstr)
				if ( usablecheck(p(74), cc) ) {
					p(73) = stat
					if ( p(74) / 10000 == 9 ) {
						f = 0
						repeat 8 + 8
							i = 8 + 8 - cnt - 1
							if ( bdataref(BDATAREF_BUFF_TYPE, ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3, tc)) == BUFF_TYPE_HEX ) {
								dbmode = DBMODE_ON_ZAP
								dbid = p(74) \ 10000
								gosub *db_item
								lint_efp = efp * (100 + sMagicDevice(cc) * 10 + sMAG(cc) / 2 + sPER(cc) / 2) / 100
								efp = limitmax(lint_efp, 2147483647)
								if ( ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + i * 3 + 1, tc) / 2 < efp * 2 ) {
									f = 1
									break
								}
							}
						loop
						if ( f ) {
							if ( distance > 1 ) {
								goto *label_4572
							}
							ci = p(73)
							goto *label_3597
						}
					}
				}
			}
		}
		if ( ocHostileTargetTotal(cc) ) {
			if ( eqfaction(cc, "buffer") ) {
				if ( getfactionvalue(cc, "buffby") != "" ) {
					p(74) = int(refstr)
					if ( usablecheck(p(74), cc) ) {
						p(73) = stat
						if ( p(74) / 10000 == 9 ) {
							dbmode = DBMODE_ON_ZAP
							dbid = p(74) \ 10000
							gosub *db_item
							if ( findbuff(tc, skillType(efid) \ 1000) == (-1) ) {
								if ( distance > 1 ) {
									goto *label_4572
								}
								ci = p(73)
								goto *label_3597
							}
						}
					}
				}
			}
		}
		unwatchon cc, tc
		goto *ai_turn
	}
	goto *label_4021

#deffunc usersnd str usersnd_prm0
	if ( cfg_sound == 0 ) {
		return
	}
	locvar_snd_sound = 7
	locvar_snd_f = 0
	if ( locvar_snd_f == 0 ) {
		repeat 6, 7
			CHECKPLAY cnt
			if ( stat == 0 ) {
				locvar_snd_sound = cnt
				soundlist(cnt - 7) = locvar_snd_sound
			}
		loop
	}
	if ( cfg_sound == 1 ) {
		DSLOADFNAME usersnd_prm0, locvar_snd_sound
	}
	else {
		mmload usersnd_prm0, locvar_snd_sound
	}
	if ( cfg_sound == 1 ) {
		DSPLAY locvar_snd_sound, 0
	}
	else {
		mmplay locvar_snd_sound
	}
	return

#defcfunc hostileactioncheck int hostileactioncheck_prm0
	if ( skillType(hostileactioncheck_prm0) == 4 ) {
		return 0
	}
	if ( skillType(hostileactioncheck_prm0) == 12 ) {
		return 0
	}
	if ( skillType(hostileactioncheck_prm0) == 13 ) {
		return 0
	}
	if ( skillType(hostileactioncheck_prm0) / 1000 == 1 ) {
		if ( bdataref(BDATAREF_BUFF_TYPE, skillType(hostileactioncheck_prm0) \ 1000) == BUFF_TYPE_BUFF ) {
			return 0
		}
	}
	return 1

#deffunc resetuserspell int resetuserspell_prm0
	skillUse(550 + resetuserspell_prm0) = userspelldata(0, resetuserspell_prm0), userspelldata(1, resetuserspell_prm0), userspelldata(2, resetuserspell_prm0), userspelldata(3, resetuserspell_prm0), userspelldata(4, resetuserspell_prm0)
	skillname(550 + resetuserspell_prm0) = userspelldatan(0, resetuserspell_prm0)
	if ( userspelldata(1, resetuserspell_prm0) == 1 ) {
		skilldesc(550 + resetuserspell_prm0) = skillname(int(jseval(userspelldatan(4, resetuserspell_prm0)))) + lang("のボルト", " bolt")
	}
	else {
		if ( userspelldata(1, resetuserspell_prm0) == 2 ) {
			skilldesc(550 + resetuserspell_prm0) = skillname(int(jseval(userspelldatan(4, resetuserspell_prm0)))) + lang("の矢", " dart")
		}
		else {
			if ( userspelldata(1, resetuserspell_prm0) == 3 ) {
				skilldesc(550 + resetuserspell_prm0) = skillname(int(jseval(userspelldatan(4, resetuserspell_prm0)))) + lang("の球", " ball")
			}
			else {
				if ( userspelldata(1, resetuserspell_prm0) == 4 ) {
					if ( userspelldata(3, resetuserspell_prm0) / 1000 == 3 ) {
						skilldesc(550 + resetuserspell_prm0) = lang("体力回復の球", "Heal ball")
					}
					else {
						skilldesc(550 + resetuserspell_prm0) = lang("体力回復", "Heal self")
					}
				}
				else {
					if ( userspelldata(1, resetuserspell_prm0) == 11 ) {
						skilldesc(550 + resetuserspell_prm0) = lang("全域攻撃", "Massive attack")
					}
					else {
						if ( userspelldata(1, resetuserspell_prm0) == 12 ) {
							skilldesc(550 + resetuserspell_prm0) = lang("全ての呪い(hex)除去", "Removes all hexes")
						}
						else {
							if ( userspelldata(1, resetuserspell_prm0) == 13 ) {
								skilldesc(550 + resetuserspell_prm0) = lang("アイテム解呪", "Uncurse items")
							}
						}
					}
				}
			}
		}
	}
	return 1

*label_4703
	if ( areaType(p) == MAP_TYPE_TOWER ) {
		if ( incspawnrate(10) ) {
			oabitmod 10, p, 1
			return 1
		}
	}
	if ( cFame(CHARA_PLAYER) >= 1000000 & ogTitleJunkie == 2 ) {
		if ( areaMinLevel(p) >= 200 ) {
			if ( incspawnrate(30) ) {
				nogo = 0
				repeat 500 - 450, 450
					if ( oabit(18, cnt) ) {
						nogo = 1
						break
					}
				loop
				if ( nogo ) {
					return 0
				}
				oabitmod 18, p, 1
				areaType(p) = MAP_TYPE_TOWER
				areaIcon(p) = xy2pic(13, 4)
				areaMinLevel(p) = 666
				areaCanSave(p) = 765
				return 1
			}
		}
	}
	if ( cFame(CHARA_PLAYER) >= 1000000 & ogTitleJunkie == 2 ) {
		if ( areaMinLevel(p) >= 200 ) {
			if ( incspawnrate(30) ) {
				nogo = 0
				repeat 500 - 450, 450
					if ( oabit(17, cnt) | oabit(18, cnt) ) {
						nogo = 1
						break
					}
				loop
				if ( nogo ) {
					return 0
				}
				oabitmod 17, p, 1
				areaType(p) = MAP_TYPE_TOWER
				areaIcon(p) = xy2pic(13, 4)
				areaMinLevel(p) = 666
				areaCanSave(p) = 765
				return 1
			}
		}
	}
	if ( areaMinLevel(p) > 100 ) {
		if ( incspawnrate(30) ) {
			oabitmod 5, p, 1
			return 1
		}
	}
	if ( areaMinLevel(p) > 20 ) {
		if ( areaType(p) == MAP_TYPE_TOWER ) {
			if ( incspawnrate(10) ) {
				oabitmod 0, p, 1
				return 1
			}
			else {
				if ( incspawnrate(10) ) {
					oabitmod 8, p, 1
					return 1
				}
			}
		}
		if ( areaType(p) == MAP_TYPE_FOREST ) {
			if ( incspawnrate(30) ) {
				oabitmod 6, p, 1
				return 1
			}
		}
	}
	else {
		if ( rnd(10) == 0 ) {
			oabitmod 12, p, 1
			return 1
		}
	}
	if ( minbosslv <= 2000 ) {
		if ( areaCanSave(p) >= minbosslv ) {
			if ( areaType(p) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
				if ( incspawnrate(30) ) {
					oabitmod 3, p, 1
					return 1
				}
			}
		}
	}
	if ( areaMinLevel(p) >= 2 ) {
		if ( areaType(p) == (23 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_FORT]@!!! */) ) {
			if ( incspawnrate(10) ) {
				oabitmod 16, p, 1
				return 1
			}
		}
	}
	if ( rnd(5) ) {
		area_no = p
		minlevel = difficulty() / 2
		sdim factionref, 10, 3
		repeat 10
			flt areaMinLevel(area_no), FIX_QUALITY_GOOD
			characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
			if ( stat ) {
				if ( cRelation(rc) != RELATION_ENEMY | cOrgRelation(rc) != RELATION_ENEMY ) {
					continue
				}
				if ( cLevel(rc) < minlevel ) {
					if ( cnt != 9 ) {
						continue
					}
				}
				getfactionvalues rc, "family", factionref
				p(61) = stat
				if ( p(61) == 0 ) {
					continue
				}
				oabitmod 11, area_no, 1
				addfaction area_no - 450 + 245, "family," + factionref(rnd(p(61)))
				chara_vanquish MAX_CHARA_NC
				break
			}
		loop
		p = area_no
		return 1
	}
	return 0

*label_4707
	if ( contafurniturecheck(iID(ci)) != (-1) ) {
		if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) < 1000 ) {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 1000 - iID(ci)
		}
	}
	return

*label_4708
	dim isetcontafurniture, 3, 12
	isetcontafurniture(0, 0) = 773, 50, 8
	isetcontafurniture(0, 1) = 318, 16, 8
	isetcontafurniture(0, 2) = 151, 24, 8
	isetcontafurniture(0, 3) = 78, 16, 8
	isetcontafurniture(0, 4) = 645, 32, 9
	isetcontafurniture(0, 5) = 302, 16, 9
	isetcontafurniture(0, 6) = 150, 24, 9
	isetcontafurniture(0, 7) = 79, 24, 9
	isetcontafurniture(0, 8) = 124, 32, 10
	isetcontafurniture(0, 9) = 100, 16, 11
	isetcontafurniture(0, 10) = 296, 24, 12
	isetcontafurniture(0, 11) = 774, 32, 12
	return

#defcfunc contafurniturecheck int contafurniturecheck_prm0
	p(47) = -1
	repeat length2(isetcontafurniture)
		if ( contafurniturecheck_prm0 == isetcontafurniture(0, cnt) ) {
			p(47) = cnt
			break
		}
	loop
	return p(47)

*label_4711
	if ( synccheck(cc, -1) ) {
		txt -1, lang(name(cc) + "は盾で" + name(tc) + "を殴りつけた。", name(cc) + " bash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " shield.")
	}
	dmghp tc, rnd(sShield(cc)) + 1, cc
	dmgcon tc, CONDITION_DIM, 50 + int(sqrt(sShield(cc))) * 15
	if ( cParalyze(tc) < 1000 ) {
		cParalyze(tc) += rnd(3)
	}
	return

*label_4712
	if ( dmgType != 1 ) {
		if ( cAngry(r1) == 0 ) {
			if ( rnd(20) == 0 ) {
				if ( synccheck(r1, -1) ) {
					txtef COLOR_BLUE
					txt -1, lang(name(r1) + "は怒りに体を奮わせた！", name(r1) + " " + is(r1) + " engulfed in fury!")
				}
				cAngry(r1) += rnd(30) + 15
			}
		}
	}
	return

#deffunc funcend str funcend_prm0
	procid = (procid + 1) \ 10
	proclist(procid) = funcend_prm0 + ":End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return

*label_4714
	repeat counterattack
		locvar_skillexp2_ccbk = cc
		locvar_skillexp2_tcbk = tc
		cc = locvar_skillexp2_tcbk
		tc = locvar_skillexp2_ccbk
		gosub *label_3640
		cc = locvar_skillexp2_ccbk
		tc = locvar_skillexp2_tcbk
	loop
	counterattack = 0
	return

#deffunc modstress int modstress_prm0
	p(46) = 0
	if ( ocStress(0) < 6000 ) {
		if ( ocStress(0) / 2000 != (ocStress(0) + modstress_prm0) / 2000 ) {
			p(46) = 1
		}
	}
	if ( ocStress(0) < 0 ) {
		ocStress(0) = 0
	}
	ocStress(0) += modstress_prm0
	if ( ocStress(0) > 12000 ) {
		ocStress(0) = 12000
	}
	if ( p(46) ) {
		r1 = 0
		gosub *charaRefresh
	}
	return

#deffunc calcempower int calcempower_prm0
	if ( gettrait(cc, 165) != 0 ) {
		if ( ele == SKILL_RES_FIRE | ele == SKILL_RES_COLD | ele == SKILL_RES_LIGHTNING ) {
			dice2 = dice2 * 125 / 100
		}
	}
	if ( calcempower_prm0 < 400 ) {
		return
	}
	if ( calcempower_prm0 >= 600 ) {
		return
	}
	if ( ele != SKILL_RES_FIRE & ele != SKILL_RES_COLD & ele != SKILL_RES_LIGHTNING & ele != SKILL_RES_DARKNESS & ele != SKILL_RES_MIND & ele != SKILL_RES_SOUND ) {
		return
	}
	if ( gettrait(cc, ele + 38) != 0 ) {
		dice2 += calc3traitmulti(stat, dice2)
	}
	return

#defcfunc difficulty
	return limit(cFame(CHARA_PLAYER) / 600, 1, 65535)

#defcfunc incspawnrate int incspawnrate_prm0
	return rnd(limitmin(incspawnrate_prm0 - revisespawnrate, 5)) == 0

#defcfunc decspawnrate int decspawnrate_prm0
	return rnd(limitmax(decspawnrate_prm0 + revisespawnrate, 30)) == 0

#defcfunc usablecheck int usablecheck_prm0, int usablecheck_prm1
	if ( usablecheck_prm0 >= 10000 ) {
		inv_find usablecheck_prm0 \ 10000, usablecheck_prm1
		if ( stat != (-1) ) {
			p(72) = stat
			if ( ibit(ITEM_BIT_CHARGE_ITEM, p(72)) ) {
				if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), p(72)) > 0 ) {
					return p(72)
				}
			}
			else {
				return p(72)
			}
		}
	}
	return 0

#deffunc modgrowth2 int modgrowth2_prm0, int modgrowth2_prm1, int modgrowth2_prm2
	locvar_skillexp2_p = modgrowth2_prm2 * (100 + calctraitgrowthrate(modgrowth2_prm0, modgrowth2_prm1)) / 100
	if ( modgrowth2_prm1 >= 400 ) {
		if ( gettrait(modgrowth2_prm0, 80) ) {
			locvar_skillgain_lv = stat
			locvar_skillexp2_p += locvar_skillexp2_p * limit(calctraitscore(locvar_skillgain_lv) - sgrowth(modgrowth2_prm1, modgrowth2_prm0) / 15, 1, calctraitscore(locvar_skillgain_lv))
		}
	}
	modgrowth modgrowth2_prm0, modgrowth2_prm1, locvar_skillexp2_p
	return

*label_4723
	if ( tc > 15 ) {
		txt -1, lang("仲間にしか騎乗できない。", name(cc) + " can only ride an ally.")
		return
	}
	if ( cbit(CHARA_BIT_BODYGUARD, tc) == TRUE | cbit(CHARA_BIT_GUARD_TEMP, tc) == TRUE ) {
		txt -1, lang("護衛対象には騎乗できない。", name(cc) + " can't ride a client.")
		return
	}
	if ( tc == cc ) {
		txt -1, lang(name(cc) + "は自分に乗ろうとした。", name(cc) + " try to ride yourself.")
		return
	}
	if ( cType(tc) != 0 ) {
		txt -1, lang("その仲間はこの場所に滞在中だ。", "The ally currently stays in this area.")
		return
	}
	if ( tc == gRider ) {
		txt -1, lang("現在" + name(tc) + "は" + name(0) + "が騎乗している。", name(tc) + " is currently being ridden by " + name(0) + ".")
		return
	}
	if ( ocPetBeingRiddenIdx(tc) != 0 ) {
		txt -1, lang("現在" + name(tc) + "は" + name(ocPetBeingRiddenIdx(tc)) + "が騎乗している。", name(tc) + " is currently being ridden by " + name(ocPetBeingRiddenIdx(tc)) + ".")
		return
	}
	if ( ocPetRidingIdx(tc) != 0 ) {
		txt -1, lang("現在" + name(tc) + "は" + name(ocPetRidingIdx(tc)) + "に騎乗している。", name(tc) + " " + is(tc) + " currently riding " + name(ocPetRidingIdx(tc)) + ".")
		return
	}
	txt -1, lang(name(cc) + "は" + name(tc) + "に騎乗した。", name(cc) + " ride " + name(tc) + ".")
	ride_begin tc, cc
	return

*label_4724
	repeat 15, 1
		if ( cExist(cnt) == CHAR_STATE_ALIVE ) {
			if ( ocPetBeingRiddenIdx(cnt) != 0 ) {
				locvar_ride_end_p = cnt
				refreshspeed locvar_ride_end_p
			}
		}
	loop
	return

#deffunc setgodid int setgodid_prm0, int setgodid_prm1
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] setgodid: Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	iParam2(setgodid_prm0) = setgodid_prm1
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] setgodid: End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return

#deffunc getgodid int getgodid_prm0
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] getgodid: Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	locvar_map_barrel_p = getgodindex(iParam3(getgodid_prm0))
	if ( locvar_map_barrel_p != (-1) ) {
		setgodid getgodid_prm0, locvar_map_barrel_p
	}
	else {
		setgodid getgodid_prm0, usergodmax
	}
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] getgodid: End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return locvar_map_barrel_p != (-1)

#defcfunc findgodid str findgodid_prm0
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] findgodid: Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	locvar_skillexp2_f = 0
	repeat usergodmax
		if ( findgodid_prm0 == usergoddatan(0, cnt) ) {
			locvar_skillexp2_f = cnt
			break
		}
	loop
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] findgodid: End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return locvar_skillexp2_f

#defcfunc getgodindex int getgodindex_prm0
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] getgodindex: Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	locvar_skillexp2_godindex = -1
	repeat usergodmax
		if ( getgodindex_prm0 == creategoduid(cnt) ) {
			locvar_skillexp2_godindex = cnt
			break
		}
	loop
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] getgodindex: End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return locvar_skillexp2_godindex

#defcfunc godname str godname_prm0
	_switch_val = godname_prm0
	if ( _switch_val == "mani" ) {
		namet = lang("機械のマニ", "Mani of Machine")
	}
	else {
		if ( _switch_val == "lulwy" ) {
			namet = lang("風のルルウィ", "Lulwy of Wind")
		}
		else {
			if ( _switch_val == "itzpalt" ) {
				namet = lang("元素のイツパロトル", "Itzpalt of Element")
			}
			else {
				if ( _switch_val == "ehekatl" ) {
					namet = lang("幸運のエヘカトル", "Ehekatl of Luck")
				}
				else {
					if ( _switch_val == "opatos" ) {
						namet = lang("地のオパートス", "Opatos of Earth")
					}
					else {
						if ( _switch_val == "jure" ) {
							namet = lang("癒しのジュア", "Jure of Healing")
						}
						else {
							if ( _switch_val == "kumiromi" ) {
								namet = lang("収穫のクミロミ", "Kumiromi of Harvest")
							}
							else {
								if ( _switch_val == "elder brother" ) {
									namet = lang(_onii(cSex(CHARA_PLAYER)) + "ちゃん", cnven(_onii(cSex(CHARA_PLAYER))) + "chan")
								}
								else {
									namet = lang("無のエイス", "Eyth of Infidel")
								}
							}
						}
					}
				}
			}
		}
	}
	if ( findcgodno(godname_prm0) != (-1) ) {
		god_no = stat
		namet = usergoddatan(1, god_no)
	}
	return namet

#defcfunc godshortname str godshortname_prm0
	locvar_skillexp2__switch_val = godshortname_prm0
	if ( locvar_skillexp2__switch_val == "mani" ) {
		locvar_skillexp2_namet = lang("マニ", "Mani")
	}
	else {
		if ( locvar_skillexp2__switch_val == "lulwy" ) {
			locvar_skillexp2_namet = lang("ルルウィ", "Lulwy")
		}
		else {
			if ( locvar_skillexp2__switch_val == "itzpalt" ) {
				locvar_skillexp2_namet = lang("イツパロトル", "Itzpalt")
			}
			else {
				if ( locvar_skillexp2__switch_val == "ehekatl" ) {
					locvar_skillexp2_namet = lang("エヘカトル", "Ehekatl")
				}
				else {
					if ( locvar_skillexp2__switch_val == "opatos" ) {
						locvar_skillexp2_namet = lang("オパートス", "Opatos")
					}
					else {
						if ( locvar_skillexp2__switch_val == "jure" ) {
							locvar_skillexp2_namet = lang("ジュア", "Jure")
						}
						else {
							if ( locvar_skillexp2__switch_val == "kumiromi" ) {
								locvar_skillexp2_namet = lang("クミロミ", "Kumiromi")
							}
							else {
								if ( locvar_skillexp2__switch_val == "elder brother" ) {
									locvar_skillexp2_namet = _nii(cSex(CHARA_PLAYER))
								}
								else {
									locvar_skillexp2_namet = lang("エイス", "Eyth")
								}
							}
						}
					}
				}
			}
		}
	}
	if ( findcgodno(godshortname_prm0) != (-1) ) {
		locvar_skillexp2_god_no = stat
		locvar_skillexp2_namet = cnven(usergoddatan(3, locvar_skillexp2_god_no))
	}
	return locvar_skillexp2_namet

#defcfunc creategoduid int creategoduid_prm0
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] creategoduid: Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	locvar_cnven_s = usergoddatan(0, creategoduid_prm0)
	locvar_cnven_p = 0
	repeat strlen(locvar_cnven_s)
		locvar_cnven_p += peek(locvar_cnven_s, cnt)
	loop
	locvar_cnven_s = str(peek(locvar_cnven_s, 0)) + str(locvar_cnven_p) + str(peek(locvar_cnven_s, strlen(locvar_cnven_s) - 1))
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] creategoduid: End" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	return int(locvar_cnven_s)

#deffunc txtgod str txtgod_godid, int txtgod_flavor
	if ( txtgod_godid == "eyth" ) {
		return
	}
	f = 0
	txtef COLOR_YELLOW
	procid = (procid + 1) \ 10
	proclist(procid) = "[God] god text:" + txtgod_flavor + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	sstptalkn = godname(txtgod_godid)
	if ( findcgodno(txtgod_godid) != (-1) ) {
		txtcgod stat, txtgod_flavor
		f = stat
		txtef COLOR_DEFAULT
		return f
	}
	sstptalkc = 1
	sstptalkn = godname(txtgod_godid)
	locvar_txtgod__switch_val = txtgod_godid
	if ( txtgod_flavor == 15 ) {
		if ( locvar_txtgod__switch_val == "lulwy" ) {
			txt -1, lang("「ブタどもに思い知らせてやりなさい。私に刃向かう事がどういう事かをね」", cnvtalk("Show these rats who's in charge. Let them know what happens to those that dares to stand in my way."))
		}
		else {
			if ( locvar_txtgod__switch_val == "mani" ) {
				txt -1, lang("「やってしまえ。機械の偉大さ、見せてやるがいい」", cnvtalk("Fire. Show them the strength of the machines."))
			}
			else {
				if ( locvar_txtgod__switch_val == "opatos" ) {
					txt -1, lang("「フハハハハハハハハハハハハハッ！！耐えてみろぉ！！」", cnvtalk("Muhahahahahahahahahaha!! Take this!!"))
				}
				else {
					if ( locvar_txtgod__switch_val == "jure" ) {
						txt -1, lang("「し、仕方ないから手伝ってあげるわよっ。これで負けたりしたらゆるさないんだからっ！」", cnvtalk("I-I'm only doing this because you needed help. So I won't forgive you if you lose here!"))
					}
					else {
						if ( locvar_txtgod__switch_val == "itzpalt" ) {
							txt -1, lang("「証明してみせよう。我が元素を止める事など何者にもできない事を」", cnvtalk("Then allow me to show you. That no other living soul can stop the might of my elemental power."))
						}
						else {
							if ( locvar_txtgod__switch_val == "kumiromi" ) {
								txt -1, lang("「容赦しない…君の敵は…僕の敵だ」", cnvtalk("No mercy... your enemies... are my enemies."))
							}
							else {
								if ( locvar_txtgod__switch_val == "ehekatl" ) {
									txt -1, lang("「どきどきどき。当たりかな？かな？」", cnvtalk("Thump thump thump. Did you win? Did you?"))
								}
							}
						}
					}
				}
			}
		}
		f = 1
	}
	else {
		if ( txtgod_flavor == 14 ) {
			if ( locvar_txtgod__switch_val == "lulwy" ) {
				txt -1, lang("「いいわ、力を貸してあげる。好きなだけミンチを作りなさい」", cnvtalk("Alright, I'll lend you a taste of my power. Go and massacre to your heart's desires."))
			}
			else {
				if ( locvar_txtgod__switch_val == "kumiromi" ) {
					txt -1, lang("「自然の恵みと…命に…感謝を忘れずに」", cnvtalk("Nature's blessing... and life... show your gratitude."))
				}
				else {
					if ( locvar_txtgod__switch_val == "jure" ) {
						txt -1, lang("「べ、別にアンタに死んでほしくないなんて、全然思っていないんだからねっ」", cnvtalk("I-it's not like I want you to die or anything. And I certainly wasn't thinking about you!"))
					}
					else {
						if ( locvar_txtgod__switch_val == "opatos" ) {
							txt -1, lang("「フハハハ！フハハハハハ！！行けィ！！」", cnvtalk("Muwahaha! Muhahahahaha!! Show them your might!!"))
						}
						else {
							if ( locvar_txtgod__switch_val == "mani" ) {
								txt -1, lang("「人の手に余る力だ。だが使うがいい。お前ならば扱えよう。」", cnvtalk("This power is too much for a mortal to handle. But that is of little concern. I'm confident in your abilities."))
							}
							else {
								if ( locvar_txtgod__switch_val == "ehekatl" ) {
									txt -1, lang("「教えてあげるぅ…秘密だよ。だよ！」", cnvtalk("I can tell you... It's a secret. A secret!"))
								}
								else {
									if ( locvar_txtgod__switch_val == "itzpalt" ) {
										txt -1, lang("「汝の働きに報いよう。我が力、存分に振るうがよい」", cnvtalk("A reward for your labor. Use the powers bestowed upon you to its fullest."))
									}
								}
							}
						}
					}
				}
			}
			f = 1
		}
		else {
			if ( txtgod_flavor == GOD_TEXT_WIP ) {
				if ( locvar_txtgod__switch_val == "jure" ) {
					txt -1, lang("「ア、アンタの事なんか全然好きじゃないんだからっ！勘違いしないでよね！」", cnvtalk("I-I don't love you! I-I r-really am not! Silly!"))
				}
				f = 1
			}
			else {
				if ( txtgod_flavor == GOD_TEXT_RANDOM ) {
					if ( locvar_txtgod__switch_val == "mani" ) {
						txt -1, lang("「お前も体を機械化したらどうだ？」", cnvtalk("You should mechanize your body.")), lang("「常に、私の名に恥じぬよう振舞え」", cnvtalk("Always behave true to my name.")), lang("「焦るな。すぐに機械が全てを支配する時代が来る」", cnvtalk("No need to hurry. The day machines dominate the world is much closer than you think."))
					}
					else {
						if ( locvar_txtgod__switch_val == "lulwy" ) {
							txt -1, lang("「みじめなブタども」", cnvtalk("Pathetic pigs.")), lang("「マニ？その名を再び口にしたらミンチよ、子猫ちゃん」", cnvtalk("Mani? Say that name again and I'll mince you, kitty.")), lang("「前の下僕は、八つ裂きにしてシルフ達の餌にしたわ。髪型がちょっと気に食わなかったから。アハハ！」", cnvtalk("I've torn the former servant limb from limb to feed the sylphs. I just didn't like his hair style. Ahaha!")), lang("「私の子供達は風の声、何事にも縛られてはいけない。オマエもよ」", cnvtalk("My children are the voices of the wind, never tied to anything."))
						}
						else {
							if ( locvar_txtgod__switch_val == "itzpalt" ) {
								if ( rnd(3) ) {
									txt -1, lang("「汝油断することなかれ」", cnvtalk("Idleness is the devil's workshop.")), lang("「我々の抱える痛みを、定命の者が理解することはないであろう」", cnvtalk("You mortals will never understand the pain we hold.")), lang("「我が名はイツパロトル。元素の起源にて、最古の炎を従えし王、全ての神の主なり」", cnvtalk("My name is Itzpalt. I am the origin of elements, the king that bears the earliest flame and the master of all the Gods."))
								}
								else {
									txt -1, lang("「神々の戦いに終わりはない。来るべき時は、汝も我が軍門の元で働いてもらうであろう」", cnvtalk("The god's war never ends. In times to come, you shall be a warrior of my faction."))
								}
							}
							else {
								if ( locvar_txtgod__switch_val == "ehekatl" ) {
									txt -1, lang("「たらばがに！」", cnvtalk("Coconut crab!"))
								}
								else {
									if ( locvar_txtgod__switch_val == "opatos" ) {
										txt -1, lang("「フハハハハ」", cnvtalk("Muwahaha."))
									}
									else {
										if ( locvar_txtgod__switch_val == "jure" ) {
											txt -1, lang("「な、なによバカ！」", cnvtalk("W-What? Silly!")), lang("「私はこの仕事に向いているのかなあ」", cnvtalk("Am I really suitable for this job?"))
										}
										else {
											if ( locvar_txtgod__switch_val == "kumiromi" ) {
												txt -1, lang("「木々のさえずり…森の命が奏でる歌…耳をすませば…」", cnvtalk("Twitter of trees...song weaved by forests...if you strain your ears....")), lang("「争いごとは…醜い」", cnvtalk("This conflict between Gods...ugly.")), lang("「僕のエヘカトル…今はもう…かつての面影さえない」", cnvtalk("My Ehekatl...you are not what you used to be...")), lang("「僕は与えよう…君たちが奪う以上のものを」", cnvtalk("I will give...more than you spoil..."))
											}
										}
									}
								}
							}
						}
					}
					f = 1
				}
				else {
					if ( txtgod_flavor == GOD_TEXT_KILL ) {
						if ( locvar_txtgod__switch_val == "mani" ) {
							txt -1, lang("「いいぞ」", cnvtalk("Nice kill.")), lang("「分解してみたくならないか？」", cnvtalk("Don't you want to decompose it?")), lang("「その魂なら質の良い機械が組めそうだ」", cnvtalk("Ah, this soul could be a good component for a new machine."))
						}
						else {
							if ( locvar_txtgod__switch_val == "lulwy" ) {
								txt -1, lang("「不潔ね。血を拭いなさいよ」", cnvtalk("How dirty. Wipe the blood off your hands.")), lang("「アハハ！ミンチミンチィ！」", cnvtalk("Aha! Mince! Mince!.")), lang("「まあ、いけない子猫ちゃん」", cnvtalk("Bad kitty."))
							}
							else {
								if ( locvar_txtgod__switch_val == "itzpalt" ) {
									txt -1, lang("「なかなかのものだ」", cnvtalk("Impressive.")), lang("「そして魂は元素へと還る」", cnvtalk("And so the soul returns to the element.")), lang("「高らかに我が名を唱えよ。屍に炎と安息を」", cnvtalk("Chant my name proudly. Flame and eternal rest for the dead."))
								}
								else {
									if ( locvar_txtgod__switch_val == "ehekatl" ) {
										txt -1, lang("「もっと！もっと！」", cnvtalk("More! More!")), lang("「死んじゃったよ！たよ！」", cnvtalk("It's dead! Dead!")), lang("「うっみゅーうみゅうみゅ」", cnvtalk("Meoow mew mew."))
									}
									else {
										if ( locvar_txtgod__switch_val == "opatos" ) {
											txt -1, lang("「フハハハ！」", cnvtalk("Mwahaha!")), lang("「逝け！逝け！フハハハッ！」", cnvtalk("Die! Die! Mwahahaha!")), lang("「フハーン！」", cnvtalk("Muhan!"))
										}
										else {
											if ( locvar_txtgod__switch_val == "jure" ) {
												txt -1, lang("「や、やるじゃない」", cnvtalk("N-Not bad, for you")), lang("「や、やめてよ。気持ち悪い」", cnvtalk("S-Stop it. Disgusting...")), lang("「こっち来ないで！」", cnvtalk("Don't look at me!"))
											}
											else {
												if ( locvar_txtgod__switch_val == "kumiromi" ) {
													txt -1, lang("「汚れたね」", cnvtalk("You got dirty.")), lang("「ほどほどに」", cnvtalk("Don't kill too much.")), lang("「…これが…君の望んでいた結果？」", cnvtalk("...are you satisfied now?"))
												}
											}
										}
									}
								}
							}
						}
						f = 1
					}
					else {
						if ( txtgod_flavor == GOD_TEXT_SLEEP ) {
							if ( locvar_txtgod__switch_val == "mani" ) {
								txt -1, lang("「短い命の多くを無駄な眠りに費やすとは、生身の体とは不自由なものだ。だが今はそう、休むがいい。また私に仕えるために」", cnvtalk("Flesh and blood, how pathetic to waste much of your limited life sleeping. But rest well for now, for you will need to serve me again."))
							}
							else {
								if ( locvar_txtgod__switch_val == "lulwy" ) {
									txt -1, lang("「いいわ、少しの間だけ首枷を外してあげる。存分に休息を楽しみなさい」", cnvtalk("Fine, I'll unshackle you for a little while. Enjoy your sleep. But remember kitty, if you cheat on me in your dream, you'll never see a daylight again."))
								}
								else {
									if ( locvar_txtgod__switch_val == "itzpalt" ) {
										txt -1, lang("「旅の疲れを癒すがよい。我が費えることなき紅蓮の炎が、夜のとばりに紛れる邪なる者から汝を守るであろう」", cnvtalk("Relieve your fatigue. May the eternal flame protect you from filthy beings that crawl in the shroud of night."))
									}
									else {
										if ( locvar_txtgod__switch_val == "ehekatl" ) {
											txt -1, lang("「寝るの？本当に寝るの？おやつみ！」", cnvtalk("Are you going to sleep? Really sleepy? Good night!"))
										}
										else {
											if ( locvar_txtgod__switch_val == "opatos" ) {
												txt -1, lang("「フハハハハ。付いて行くぞぉ、夢の中までも」", cnvtalk("Muwahaha! I'll be following you, to your dream."))
											}
											else {
												if ( locvar_txtgod__switch_val == "jure" ) {
													txt -1, lang("「お、おやすみのキスなんて…絶対にやだからね！」", cnvtalk("I-I'll never give you a good night kiss...ever!"))
												}
												else {
													if ( locvar_txtgod__switch_val == "kumiromi" ) {
														txt -1, lang("「おやすみ…明日…また朗らかな芽を吹いておくれ」", cnvtalk("Good night...May a bright sprout bring forth tomorrow... "))
													}
												}
											}
										}
									}
								}
							}
							f = 1
						}
						else {
							if ( txtgod_flavor == GOD_TEXT_WELCOME ) {
								if ( locvar_txtgod__switch_val == "mani" ) {
									txt -1, lang("「戻ってきたか。案外ホネのある奴だな」", cnvtalk("Ah, you've returned. You're tougher than I thought."))
								}
								else {
									if ( locvar_txtgod__switch_val == "lulwy" ) {
										txt -1, lang("「どこホッツキ歩いてたのよ。もっと調教が必要ね」", cnvtalk("Where were you until now? You need more breaking, it seems."))
									}
									else {
										if ( locvar_txtgod__switch_val == "itzpalt" ) {
											txt -1, lang("「定命の者よ、よくぞ戻ってきた」", cnvtalk("And so the mortal returns. You shall serve me again."))
										}
										else {
											if ( locvar_txtgod__switch_val == "ehekatl" ) {
												txt -1, lang("「みゃみゃ？帰って来たの？来たの？たくさん待ってたよ！」", cnvtalk("Weeee♪ You are back? You are back!"))
											}
											else {
												if ( locvar_txtgod__switch_val == "opatos" ) {
													txt -1, lang("「フハハハハハ！！おかえり」", cnvtalk("Muwahahahahaha! Welcome back."))
												}
												else {
													if ( locvar_txtgod__switch_val == "jure" ) {
														txt -1, lang("「べ、別にアンタが帰ってくるのを待ってたんじゃないからね！」", cnvtalk("N-no...I-I wasn't looking for you! Silly!"))
													}
													else {
														if ( locvar_txtgod__switch_val == "kumiromi" ) {
															txt -1, lang("「おかえり…待っていた」", cnvtalk("Welcome back...I was...waiting for you."))
														}
													}
												}
											}
										}
									}
								}
								f = 1
							}
							else {
								if ( txtgod_flavor == GOD_TEXT_JOIN ) {
									if ( locvar_txtgod__switch_val == "mani" ) {
										txt -1, lang("「入信者か。私の名を貶めないよう励むがいい」", cnvtalk("Oh, someone comes to me finally. Devote yourself to my tasks, you'll be rewarded greatly, maybe."))
									}
									else {
										if ( locvar_txtgod__switch_val == "lulwy" ) {
											txt -1, lang("「私を選んだのは正解よ。たっぷり可愛がってあげるわ、子猫ちゃん」", cnvtalk("You know, you've made a right choice. I will treat you with great love, little kitty."))
										}
										else {
											if ( locvar_txtgod__switch_val == "itzpalt" ) {
												txt -1, lang("「我が期待に応えて見せよ」", cnvtalk("Do not fail me, servant."))
											}
											else {
												if ( locvar_txtgod__switch_val == "ehekatl" ) {
													txt -1, lang("「わ〜ほんとに信じてくれるの？くれるの？」", cnvtalk("Weee! You really have faith in me? Do you really?"))
												}
												else {
													if ( locvar_txtgod__switch_val == "opatos" ) {
														txt -1, lang("「フハッハハハハ。逃がさんぞ！」", cnvtalk("Muwahahahahaha. You're mine!"))
													}
													else {
														if ( locvar_txtgod__switch_val == "jure" ) {
															txt -1, lang("「べ、別にアンタの活躍なんて期待してないんだからねっ」", cnvtalk("I-I don't expect you to be my servant...I-I r-really don't, you silly!"))
														}
														else {
															if ( locvar_txtgod__switch_val == "kumiromi" ) {
																txt -1, lang("「よくきたね…期待…しているよ」", cnvtalk("Welcome...I have...expectations of you..."))
															}
														}
													}
												}
											}
										}
									}
								}
								else {
									if ( txtgod_flavor == GOD_TEXT_BETRAY ) {
										if ( locvar_txtgod__switch_val == "mani" ) {
											txt -1, lang("「やってくれたな。裏切り者め！」", cnvtalk("Great, a traitor."))
										}
										else {
											if ( locvar_txtgod__switch_val == "lulwy" ) {
												txt -1, lang("「アハハ。馬鹿ね。私なしで生きていくの？」", cnvtalk("Huh, fool. A life without me is all but empty."))
											}
											else {
												if ( locvar_txtgod__switch_val == "itzpalt" ) {
													txt -1, lang("「我を裏切ると？愚かなり」", cnvtalk("Remember mortal, a betrayal is not something I can forgive."))
												}
												else {
													if ( locvar_txtgod__switch_val == "ehekatl" ) {
														txt -1, lang("「うみみやゅっ！裏切っちゃうの？ちゃうの？」", cnvtalk("Mewmewmew! Really betray me? Really betray me?"))
													}
													else {
														if ( locvar_txtgod__switch_val == "opatos" ) {
															txt -1, lang("「フフッフフッフハハハハハ！」", cnvtalk("Muwahahahahahahaha!"))
														}
														else {
															if ( locvar_txtgod__switch_val == "jure" ) {
																txt -1, lang("「な、何よ。アンタなんか、いなくたって寂しくないんだからね！」", cnvtalk("I-I don't miss you. I-I really don't!"))
															}
															else {
																if ( locvar_txtgod__switch_val == "kumiromi" ) {
																	txt -1, lang("「裏切り…許さない…」", cnvtalk("A traitor...I can't...tolerate...."))
																}
															}
														}
													}
												}
											}
										}
										f = 1
									}
									else {
										if ( txtgod_flavor == GOD_TEXT_TAKE_OVER ) {
											if ( locvar_txtgod__switch_val == "mani" ) {
												txt -1, lang("「やるじゃないか。見直したよ」", cnvtalk("Well done. After all, you might be useful than I thought."))
											}
											else {
												if ( locvar_txtgod__switch_val == "lulwy" ) {
													txt -1, lang("「褒めてあげるわ。私の可愛い小さなお人形さん」", cnvtalk("Oh my little puppet, you serve me well."))
												}
												else {
													if ( locvar_txtgod__switch_val == "itzpalt" ) {
														txt -1, lang("「良し。汝の行いは覚えておこう」", cnvtalk("Impressive. Your action shall be remembered."))
													}
													else {
														if ( locvar_txtgod__switch_val == "ehekatl" ) {
															txt -1, lang("「わおっ♪嬉しい！好き！大好き！」", cnvtalk("Weeee! I'm so happy. I like you! I like you!"))
														}
														else {
															if ( locvar_txtgod__switch_val == "opatos" ) {
																txt -1, lang("「フハハッ、いいぞいいぞ」", cnvtalk("Muwahaha muwaha. Good. Good!"))
															}
															else {
																if ( locvar_txtgod__switch_val == "jure" ) {
																	txt -1, lang("「な、なによ。ほ、褒めてなんかあげないわよ！」", cnvtalk("W-What? I-I'm not gonna praise you. I'm not!"))
																}
																else {
																	if ( locvar_txtgod__switch_val == "kumiromi" ) {
																		txt -1, lang("「よくやった…ほんとに…」", cnvtalk("Good work...truly..."))
																	}
																}
															}
														}
													}
												}
											}
											f = 1
										}
										else {
											if ( txtgod_flavor == GOD_TEXT_TAKE_OVER_FAIL ) {
												if ( locvar_txtgod__switch_val == "mani" ) {
													txt -1, lang("「馬鹿にしてくれたじゃないか」", cnvtalk("Heh, Nice try."))
												}
												else {
													if ( locvar_txtgod__switch_val == "lulwy" ) {
														txt -1, lang("「やってくれたわね、ゴミの分際で。お仕置きよ」", cnvtalk("Bad bad puppy. I need to punish you."))
													}
													else {
														if ( locvar_txtgod__switch_val == "itzpalt" ) {
															txt -1, lang("「汝の愚かな試みの代償を味わうがよい」", cnvtalk("You shall pay a painful price for your foolish try."))
														}
														else {
															if ( locvar_txtgod__switch_val == "ehekatl" ) {
																txt -1, lang("「バカバカバカ！バカ！」", cnvtalk("Stupid stupid! Stupid!"))
															}
															else {
																if ( locvar_txtgod__switch_val == "opatos" ) {
																	txt -1, lang("「フハハハハッ、弱い弱い」", cnvtalk("Muwahahahaha! Weak! Weak!"))
																}
																else {
																	if ( locvar_txtgod__switch_val == "jure" ) {
																		txt -1, lang("「な、なにするのよ！」", cnvtalk("W-What have you done!"))
																	}
																	else {
																		if ( locvar_txtgod__switch_val == "kumiromi" ) {
																			txt -1, lang("「敵には…容赦しない…絶対」", cnvtalk("I...will have no mercy..for enemies...absolutely."))
																		}
																	}
																}
															}
														}
													}
												}
												f = 1
											}
											else {
												if ( txtgod_flavor == GOD_TEXT_OFFER_GREAT ) {
													if ( locvar_txtgod__switch_val == "mani" ) {
														txt -1, lang("「なかなかの贈り物だ」", cnvtalk("Cool. I like it."))
													}
													else {
														if ( locvar_txtgod__switch_val == "lulwy" ) {
															txt -1, lang("「あら、気の利いたものをくれるわね。下心でもあるの？」", cnvtalk("Oh, such a nice gift. Do you have a secret intention or something?"))
														}
														else {
															if ( locvar_txtgod__switch_val == "itzpalt" ) {
																txt -1, lang("「汝の贈り物に感謝しよう」", cnvtalk("I appreciate it, mortal."))
															}
															else {
																if ( locvar_txtgod__switch_val == "ehekatl" ) {
																	txt -1, lang("「うみみゃぁ！」", cnvtalk("Mew mew mew meow!"))
																}
																else {
																	if ( locvar_txtgod__switch_val == "opatos" ) {
																		txt -1, lang("「フッハッハハー！」", cnvtalk("Muwahahahahaha!"))
																	}
																	else {
																		if ( locvar_txtgod__switch_val == "jure" ) {
																			txt -1, lang("「べ、別に嬉しくなんかないんだからねっ！」", cnvtalk("I-I'm not that pleased. I-I'm not, you silly!"))
																		}
																		else {
																			if ( locvar_txtgod__switch_val == "kumiromi" ) {
																				txt -1, lang("「ありがたい…とてもいいよ…これ」", cnvtalk("This is...very good....Thank you."))
																			}
																		}
																	}
																}
															}
														}
													}
													f = 1
												}
												else {
													if ( txtgod_flavor == GOD_TEXT_GIFT ) {
														if ( locvar_txtgod__switch_val == "mani" ) {
															txt -1, lang("「お前は忠実なるシモベだ。これを有効に使うがいい」", cnvtalk("You've been a faithful servant of me. Here, use it wisely."))
														}
														else {
															if ( locvar_txtgod__switch_val == "lulwy" ) {
																txt -1, lang("「下僕のオマエにご褒美よ。大事に使いなさい。」", cnvtalk("My dear little kitty, you deserve a reward, don't you think?"))
															}
															else {
																if ( locvar_txtgod__switch_val == "itzpalt" ) {
																	txt -1, lang("「汝の忠誠に答え、贈り物を授けよう」", cnvtalk("To answer your loyalty, you shall have this reward."))
																}
																else {
																	if ( locvar_txtgod__switch_val == "ehekatl" ) {
																		txt -1, lang("「これあげるぅ…大切にしてね！…してね！」", cnvtalk("Here's a gift! For you! Mewmew!"))
																	}
																	else {
																		if ( locvar_txtgod__switch_val == "opatos" ) {
																			txt -1, lang("「フハハハァ！受け取れィ」", cnvtalk("Muwahahahaha, take it!"))
																		}
																		else {
																			if ( locvar_txtgod__switch_val == "jure" ) {
																				txt -1, lang("「ア、アンタのためにしてあげるんじゃないんだからっ」", cnvtalk("I-I'm not giving it to you as my gratitude! I-I r-really am not! Silly!"))
																			}
																			else {
																				if ( locvar_txtgod__switch_val == "kumiromi" ) {
																					txt -1, lang("「いいもの…あげる…」", cnvtalk("Here...there's something for...you..."))
																				}
																			}
																		}
																	}
																}
															}
														}
														f = 1
													}
													else {
														if ( txtgod_flavor == GOD_TEXT_LIKE ) {
															if ( locvar_txtgod__switch_val == "mani" ) {
																txt -1, lang("「お前はまさに信者の模範だな」", cnvtalk("Truly, you are an ideal believer. I'm impressed."))
															}
															else {
																if ( locvar_txtgod__switch_val == "lulwy" ) {
																	txt -1, lang("「どこまでも私のために尽くしなさい。オマエは私の一番の奴隷なんだから」", cnvtalk("Serve me to the end of this pathetic world, for you are my dearest slave."))
																}
																else {
																	if ( locvar_txtgod__switch_val == "itzpalt" ) {
																		txt -1, lang("「我が名を語るに相応しい者が絶えて久しい。汝ならば、あるいは…」", cnvtalk("Long gone those worthy to bear my name are. But perhaps..."))
																	}
																	else {
																		if ( locvar_txtgod__switch_val == "ehekatl" ) {
																			txt -1, lang("「どきどきどき。君のこと、好きだよ。だよ！」", cnvtalk("My heart aches! I think I like you...I guess!"))
																		}
																		else {
																			if ( locvar_txtgod__switch_val == "opatos" ) {
																				txt -1, lang("「フハァッハハハハハハ！愉快愉快！」", cnvtalk("Mwahaha haha! Fun! Fun!"))
																			}
																			else {
																				if ( locvar_txtgod__switch_val == "jure" ) {
																					txt -1, lang("「や、やめてよ。アンタのことなんか、大好きじゃないんだからねっ。バカ！」", cnvtalk("N-No! Cut it! I-I don't love you. Stupid!"))
																				}
																				else {
																					if ( locvar_txtgod__switch_val == "kumiromi" ) {
																						txt -1, lang("「君は…大切なしもべだ…」", cnvtalk("You are...my precious valet..."))
																					}
																				}
																			}
																		}
																	}
																}
															}
															f = 1
														}
														else {
															if ( txtgod_flavor == GOD_TEXT_LOVE ) {
																if ( locvar_txtgod__switch_val == "mani" ) {
																	txt -1, lang("「お前は最愛のシモベだ。その魂を私に捧げろ。お前を必ず守ってみせよう」", cnvtalk("Sacrifice your very soul to me and I shall protect you with my name."))
																}
																else {
																	if ( locvar_txtgod__switch_val == "lulwy" ) {
																		txt -1, lang("「私に従え。全てを委ねろ。オマエの綺麗な顔を傷つけるブタどもは、私がミンチにしてあげるわ」", cnvtalk("Obey me and surrender everything. I shall mince all the pigs that try to hurt your beautiful face, my kitty."))
																	}
																	else {
																		if ( locvar_txtgod__switch_val == "itzpalt" ) {
																			txt -1, lang("「見事なり、定命の者よ。汝を、我が信頼に値する唯一の存在として認めよう」", cnvtalk("Very impressive, mortal. You shall be the one worthy to carry my name."))
																		}
																		else {
																			if ( locvar_txtgod__switch_val == "ehekatl" ) {
																				txt -1, lang("「好き！好き好き好きっ！だいすき！君とは死ぬまでずっと一緒だよ。だよ！」", cnvtalk("I love you! Love you! You will be with me forever...promise!"))
																			}
																			else {
																				if ( locvar_txtgod__switch_val == "opatos" ) {
																					txt -1, lang("「ファハハハハハハハハハハハハハー！フワハァー！」", cnvtalk("Muwahahahaha! Mwaaaahahaha!"))
																				}
																				else {
																					if ( locvar_txtgod__switch_val == "jure" ) {
																						txt -1, lang("「べ、別にアンタのこと愛してなんかいないんだからっ。あたしの傍から離れたらしょうちしないからねっ！このバカぁ…！", cnvtalk("I-I'm not falling l-love with you! D-don't you never ever leave me...okay? You stupid...!"))
																					}
																					else {
																						if ( locvar_txtgod__switch_val == "kumiromi" ) {
																							txt -1, lang("「ずっと一緒…だよね？…もう離さない…君が死ぬまで」", cnvtalk("Together foreaver...right? I will not let you go...until you die."))
																						}
																					}
																				}
																			}
																		}
																	}
																}
																f = 1
															}
															else {
																if ( txtgod_flavor == 22 ) {
																	if ( locvar_txtgod__switch_val == "mani" ) {
																		txt -1, lang("「ふん、呼び出したかと思えば今度は還すか。無遠慮だな」", cnvtalk("Huh, you call me up, and now you want me to return, how impertinent."))
																	}
																	else {
																		if ( locvar_txtgod__switch_val == "lulwy" ) {
																			txt -1, lang("「それじゃあ私は還るわよ、子猫ちゃん。」", cnvtalk("Well, I'll be return then, kitten."))
																		}
																		else {
																			if ( locvar_txtgod__switch_val == "itzpalt" ) {
																				txt -1, lang("「さらばだ、定命の者よ」", cnvtalk("Farewell, mortal."))
																			}
																			else {
																				if ( locvar_txtgod__switch_val == "ehekatl" ) {
																					txt -1, lang("「うみみゃあ！！またね！またね！」", cnvtalk("Goodbye! bye!"))
																				}
																				else {
																					if ( locvar_txtgod__switch_val == "opatos" ) {
																						txt -1, lang("「フワハァー！さらばだ！」", cnvtalk("Muwahahahaha! Goodbye!"))
																					}
																					else {
																						if ( locvar_txtgod__switch_val == "jure" ) {
																							txt -1, lang("「じゃ、じゃあね…」", cnvtalk("S-See you..."))
																						}
																						else {
																							if ( locvar_txtgod__switch_val == "kumiromi" ) {
																								txt -1, lang("「…またね」", cnvtalk("...See you."))
																							}
																						}
																					}
																				}
																			}
																		}
																	}
																	f = 1
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	sstptalkc = 0
	sstptalkn = ""
	txtef COLOR_DEFAULT
	return f

#defcfunc godcheck int godcheck_prm0
	locvar_sgodname_s = godno2godid(cGod(godcheck_prm0))
	if ( locvar_sgodname_s == "eyth" ) {
		if ( getfactionvalue(godcheck_prm0, "god") != "" ) {
			if ( refstr == "elder brother" ) {
				locvar_sgodname_s = refstr
			}
			else {
				repeat usergodmax
					if ( refstr == usergoddatan(2, cnt) ) {
						locvar_sgodname_s = refstr
						break
					}
				loop
			}
		}
	}
	return locvar_sgodname_s

#deffunc god_applyblessedfoodeffect int god_applyblessedfoodeffect_prm0, int god_applyblessedfoodeffect_prm1, int god_applyblessedfoodeffect_prm2
	p = 0, 0, 0, 0, 0, 0, 0, 0
	godindext = getgodindex(iParam4(god_applyblessedfoodeffect_prm1))
	if ( iID(god_applyblessedfoodeffect_prm1) == ITEM_ID_SPECIAL_STEAMED_MEAT_BUN ) {
		if ( godindext != (-1) ) {
			repeat 8
				if ( usergoddata(42 + cnt, godindext) == 0 ) {
					break
				}
				p(cnt) = usergoddata(42 + cnt, godindext)
			loop
		}
		else {
			if ( iParam4(god_applyblessedfoodeffect_prm1) == 1 ) {
				p = 181600, 120150
			}
			else {
				if ( iParam4(god_applyblessedfoodeffect_prm1) == 2 ) {
					p = 181600, 130150
				}
				else {
					if ( iParam4(god_applyblessedfoodeffect_prm1) == 3 ) {
						p = 31600, 160150
					}
					else {
						if ( iParam4(god_applyblessedfoodeffect_prm1) == 4 ) {
							p = 31600, 170150, 190150
						}
						else {
							if ( iParam4(god_applyblessedfoodeffect_prm1) == 5 ) {
								p = 21600, 110150
							}
							else {
								if ( iParam4(god_applyblessedfoodeffect_prm1) == 6 ) {
									p = 21600, 150150
								}
								else {
									if ( iParam4(god_applyblessedfoodeffect_prm1) == 7 ) {
										p = 140150, 100050, 110050, 170050, 160050, 120050, 130050, 150050
									}
								}
							}
						}
					}
				}
			}
		}
		repeat 8
			if ( p(cnt) == 0 ) {
				break
			}
			skillexp2 p(cnt) / 10000, god_applyblessedfoodeffect_prm0, p(cnt) \ 10000 * 5 / 2 * god_applyblessedfoodeffect_prm2 / 100
		loop
	}
	else {
		if ( godindext != (-1) ) {
			repeat 8
				if ( usergoddata(34 + cnt, godindext) == 0 ) {
					break
				}
				p(cnt) = usergoddata(34 + cnt, godindext)
			loop
		}
		else {
			if ( iParam4(god_applyblessedfoodeffect_prm1) == 1 ) {
				p = 1803, 1203
			}
			else {
				if ( iParam4(god_applyblessedfoodeffect_prm1) == 2 ) {
					p = 1803, 1303
				}
				else {
					if ( iParam4(god_applyblessedfoodeffect_prm1) == 3 ) {
						p = 303, 1603
					}
					else {
						if ( iParam4(god_applyblessedfoodeffect_prm1) == 4 ) {
							p = 303, 1703, 1903
						}
						else {
							if ( iParam4(god_applyblessedfoodeffect_prm1) == 5 ) {
								p = 203, 1103
							}
							else {
								if ( iParam4(god_applyblessedfoodeffect_prm1) == 6 ) {
									p = 203, 1503
								}
								else {
									if ( iParam4(god_applyblessedfoodeffect_prm1) == 7 ) {
										p = 1403, 1001, 1101, 1701, 1601, 1201, 1301, 1501
									}
								}
							}
						}
					}
				}
			}
		}
		repeat 8
			if ( p(cnt) == 0 ) {
				break
			}
			nc_intb_001 = p(cnt) \ 100 * god_applyblessedfoodeffect_prm2 / 100
			if ( iID(god_applyblessedfoodeffect_prm1) == ITEM_ID_PUFF_PUFF_BREAD ) {
				if ( gettrait(0, 194) < 0 ) {
					nc_intb_001 /= 3
				}
			}
			if ( nc_intb_001 > 0 ) {
				txtef COLOR_GREEN
				txt -1, lang(name(god_applyblessedfoodeffect_prm0) + "の" + skillname(p(cnt) / 100) + "の潜在能力が上昇した。", "The potential of " + name(god_applyblessedfoodeffect_prm0) + your(god_applyblessedfoodeffect_prm0) + " " + skillname(p(cnt) / 100) + " attribute increases.")
			}
			modgrowth2 god_applyblessedfoodeffect_prm0, p(cnt) / 100, nc_intb_001
		loop
	}
	return

#defcfunc goddomaincheck str goddomaincheck_prm0, str goddomaincheck_prm1
	if ( goddomaincheck_prm0 == "eyth" | goddomaincheck_prm1 == "eyth" ) {
		return 0
	}
	if ( goddomaincheck_prm0 == goddomaincheck_prm1 ) {
		return -1
	}
	godno1 = findcgodno(goddomaincheck_prm0)
	godno2 = findcgodno(goddomaincheck_prm1)
	if ( godno1 == (-1) ) {
		if ( godno2 == (-1) ) {
			return 0
		}
		if ( usergoddatanm(0, godno2) == goddomaincheck_prm0 ) {
			return 1
		}
		return 0
	}
	if ( godno2 == (-1) ) {
		if ( usergoddatanm(0, godno1) == goddomaincheck_prm1 ) {
			return 1
		}
		return 0
	}
	if ( usergoddatanm(0, godno1) == goddomaincheck_prm1 ) {
		return 1
	}
	if ( usergoddatanm(0, godno2) == goddomaincheck_prm0 ) {
		return 1
	}
	if ( usergoddatanm(0, godno1) == "eyth" | usergoddatanm(0, godno2) == "eyth" ) {
		return 0
	}
	return 0

#defcfunc getsubfaith int getsubfaith_prm0, str getsubfaith_prm1
	subfaith = 0
	sdim locvar_txtgod_factionvaluest, 32
	getfactionvalues getsubfaith_prm0, "subfaith", locvar_txtgod_factionvaluest
	repeat stat
		if ( strmid(locvar_txtgod_factionvaluest(cnt), 0, strlen(getsubfaith_prm1) + 1) == getsubfaith_prm1 + "=" ) {
			subfaith = int(strmid(locvar_txtgod_factionvaluest(cnt), strlen(getsubfaith_prm1) + 1, 10))
			break
		}
	loop
	return subfaith

#defcfunc getsubfaithflag int getsubfaithflag_prm0, str getsubfaithflag_prm1
	subfaithflag = 0
	sdim locvar_txtgod_factionvaluest, 32
	getfactionvalues getsubfaithflag_prm0, "subfaithflag", locvar_txtgod_factionvaluest
	repeat stat
		if ( strmid(locvar_txtgod_factionvaluest(cnt), 0, strlen(getsubfaithflag_prm1) + 1) == getsubfaithflag_prm1 + "=" ) {
			subfaithflag = int(strmid(locvar_txtgod_factionvaluest(cnt), strlen(getsubfaithflag_prm1) + 1, 10))
			break
		}
	loop
	return subfaithflag

#deffunc setsubfaith int setsubfaith_prm0, str setsubfaith_prm1, int setsubfaith_prm2
	rmfactionat setsubfaith_prm0, "subfaith", setsubfaith_prm1
	addfaction setsubfaith_prm0, "subfaith," + setsubfaith_prm1 + "=" + setsubfaith_prm2
	return

#deffunc setsubfaithflag int setsubfaithflag_prm0, str setsubfaithflag_prm1, int setsubfaithflag_prm2
	rmfactionat setsubfaithflag_prm0, "subfaithflag", setsubfaithflag_prm1
	addfaction setsubfaithflag_prm0, "subfaithflag," + setsubfaithflag_prm1 + "=" + setsubfaithflag_prm2
	return

#deffunc clearsubfaith int clearsubfaith_prm0
	rmfaction clearsubfaith_prm0, "subfaith"
	rmfaction clearsubfaith_prm0, "subfaithflag"
	return

#deffunc natureinit int natureinit_prm0
	rndshuffle csetnature
	locvar_txtgod_i = 1 + rnd(rnd(3) + 1)
	if ( rnd(3) ) {
		if ( cId(natureinit_prm0) == CREATURE_ID_YOUNG_LADY ) {
			addfaction natureinit_prm0, "nature,noble"
			locvar_txtgod_i--
		}
	}
	repeat locvar_txtgod_i
		addfaction natureinit_prm0, "nature," + naturen(0, csetnature(cnt))
	loop
	return

#defcfunc guildcheck int guildcheck_prm0
	locvar_sgodname_s = ""
	if ( flagMageGuild != 0 ) {
		locvar_sgodname_s = "mage"
	}
	if ( flagFighterGuild != 0 ) {
		locvar_sgodname_s = "fighter"
	}
	if ( flagThiefGuild != 0 ) {
		locvar_sgodname_s = "thieve"
	}
	if ( locvar_sgodname_s != "" ) {
		if ( guildcheck_prm0 == 0 ) {
			return locvar_sgodname_s
		}
	}
	locvar_sgodname_s = getfactionvalue(guildcheck_prm0, "guild")
	return locvar_sgodname_s

#defcfunc filtercheck int filtercheck_prm0, str filtercheck_prm1
	if ( eqfaction(filtercheck_prm0, filtercheck_prm1) ) {
		return 1
	}
	if ( cId(filtercheck_prm0) == CREATURE_ID_USER ) {
		if ( cUNID(filtercheck_prm0) != usernpcmax ) {
			locvar_txtgod_filtert = userdatan(4, cUNID(filtercheck_prm0))
		}
		else {
			locvar_sgodname_s = ""
		}
	}
	else {
		locvar_txtgod_filtert = refchara(cId(filtercheck_prm0), DBSPEC_CHARA_FILTER, 1)
	}
	if ( instr(locvar_txtgod_filtert, 0, "/" + filtercheck_prm1 + "/") != (-1) ) {
		return 1
	}
	return 0

#defcfunc gettrait int gettrait_prm0, int gettrait_prm1
	procid = (procid + 1) \ 10
	proclist(procid) = "gettrait:Begin" + " unit_no:" + gettrait_prm0 + " trait_id:" + gettrait_prm1 + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	locvar_sgodname_s = getfactionvalue(gettrait_prm0, "trait" + gettrait_prm1)
	if ( locvar_sgodname_s != "" ) {
		locvar_sgodname_p = int(locvar_sgodname_s)
	}
	else {
		locvar_sgodname_p = 0
	}
	if ( locvar_sgodname_p == 0 ) {
		if ( gettrait_prm0 == 0 ) {
			locvar_sgodname_p = trait(gettrait_prm1)
		}
	}
	funcend "gettrait"
	return locvar_sgodname_p

#deffunc addtrait int addtrait_prm0, int addtrait_prm1, int addtrait_prm2
	if ( addtrait_prm0 == 0 ) {
		if ( vanillatraitcheck(addtrait_prm1, addtrait_prm2) ) {
			trait(addtrait_prm1) += addtrait_prm2
			return 1
		}
	}
	locvar_sgodname_p = gettrait(addtrait_prm0, addtrait_prm1)
	rmfaction addtrait_prm0, "trait" + addtrait_prm1 + "," + locvar_sgodname_p
	locvar_sgodname_p = locvar_sgodname_p + addtrait_prm2
	if ( locvar_sgodname_p != 0 ) {
		addfaction addtrait_prm0, "trait" + addtrait_prm1 + "," + locvar_sgodname_p
	}
	return 1

#deffunc settrait int settrait_prm0, int settrait_prm1, int settrait_prm2
	if ( settrait_prm0 == 0 ) {
		if ( vanillatraitcheck(settrait_prm1, settrait_prm2) ) {
			trait(settrait_prm1) = settrait_prm2
			return 1
		}
	}
	locvar_sgodname_p = gettrait(settrait_prm0, settrait_prm1)
	rmfaction settrait_prm0, "trait" + settrait_prm1 + "," + locvar_sgodname_p
	locvar_sgodname_p = settrait_prm2
	if ( locvar_sgodname_p != 0 ) {
		addfaction settrait_prm0, "trait" + settrait_prm1 + "," + locvar_sgodname_p
	}
	return 1

#defcfunc getperseverance int getperseverance_prm0
	if ( getperseverance_prm0 == 0 ) {
		return 100
	}
	locvar_sgodname_p = 0
	sdim locvar_txtgod_naturevalues, 3
	getfactionvalues getperseverance_prm0, "nature", locvar_txtgod_naturevalues
	if ( stat == 0 ) {
		natureinit getperseverance_prm0
		getfactionvalues getperseverance_prm0, "nature", locvar_txtgod_naturevalues
	}
	locvar_txtgod_i = stat
	repeat locvar_txtgod_i
		locvar_sgodname_s = locvar_txtgod_naturevalues(cnt)
		repeat length2(naturen)

			if ( naturen(0, cnt) == locvar_sgodname_s ) {
				locvar_txtgod__switch_val = nrdataref(0, cnt)
				if ( locvar_txtgod__switch_val == 1 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 40
					goto *label_4760
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 2 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 50
					goto *label_4760
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 3 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 200
					goto *label_4760
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 4 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 100
					goto *label_4760
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 5 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 80
					goto *label_4760
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 6 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 60
					goto *label_4760
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 7 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 20
					goto *label_4760
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 8 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 10
					goto *label_4760
				}
				if ( locvar_txtgod__switch_val == 9 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p += 1000
					goto *label_4760
				}
				if ( locvar_txtgod__switch_val == 10 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_sgodname_p = 10
					goto *label_4760
				}
*label_4760
				break
			}
		loop
	loop
	return locvar_sgodname_p / locvar_txtgod_i

#defcfunc vanillatraitcheck int vanillatraitcheck_prm0, int vanillatraitcheck_prm1
	if ( vanillatraitcheck_prm0 >= 200 ) {
		if ( vanillatraitcheck_prm0 >= 217 ) {
			return 0
		}
	}
	else {
		if ( vanillatraitcheck_prm0 >= 150 ) {
			if ( vanillatraitcheck_prm0 >= 170 ) {
				return 0
			}
		}
		else {
			if ( vanillatraitcheck_prm0 >= 0 ) {
				if ( vanillatraitcheck_prm0 >= 45 ) {
					return 0
				}
			}
		}
	}
	locvar_sgodname_p = gettrait(0, vanillatraitcheck_prm0)
	if ( vanillatraitcheck_prm0 == 20 ) {
		if ( locvar_sgodname_p + vanillatraitcheck_prm1 >= 3 ) {
			return 0
		}
	}
	if ( vanillatraitcheck_prm0 == 43 ) {
		if ( locvar_sgodname_p + vanillatraitcheck_prm1 >= 2 ) {
			return 0
		}
	}
	if ( vanillatraitcheck_prm0 == 19 ) {
		if ( locvar_sgodname_p + vanillatraitcheck_prm1 >= 3 ) {
			return 0
		}
	}
	return 1

#defcfunc calc5traitmulti int calc5traitmulti_prm0, double calc5traitmulti_prm1
	if ( calc5traitmulti_prm0 == 5 ) {
		return calc5traitmulti_prm1
	}
	else {
		if ( calc5traitmulti_prm0 == 4 ) {
			return calc5traitmulti_prm1 * 7 / 10
		}
		else {
			if ( calc5traitmulti_prm0 == 3 ) {
				return calc5traitmulti_prm1 * 7 / 20
			}
			else {
				if ( calc5traitmulti_prm0 == 2 ) {
					return calc5traitmulti_prm1 * 3 / 20
				}
				else {
					return calc5traitmulti_prm1 / 20
				}
			}
		}
	}

#deffunc setweapontrait int setweapontrait_prm0, int setweapontrait_prm1
	traitref = 0, 0, 5, 1, 0, 100, -1
	traitrefn2 = lang(skillname(setweapontrait_prm0) + "の見習い", skillname(setweapontrait_prm0) + " Novice"), lang(skillname(setweapontrait_prm0) + "の習熟", skillname(setweapontrait_prm0) + " Apprentice"), lang(skillname(setweapontrait_prm0) + "の使い手", skillname(setweapontrait_prm0) + " Journeyman"), lang(skillname(setweapontrait_prm0) + "の達人", skillname(setweapontrait_prm0) + " Expert"), lang(skillname(setweapontrait_prm0) + "の極み", skillname(setweapontrait_prm0) + " Master")
	if ( setweapontrait_prm1 >= 0 ) {
		traitrefn(2) = lang("実戦で" + skillname(setweapontrait_prm0) + "の扱いを学ぶ", "Combat experience teaches you to ably use " + skillname(setweapontrait_prm0) + "."), lang("あなたは" + skillname(setweapontrait_prm0) + "の扱いを知っている[" + skillname(setweapontrait_prm0) + "の攻撃倍率+5%]", "You know how to wield " + skillname(setweapontrait_prm0) + ". [" + skillname(setweapontrait_prm0) + " DMG +5%]"), lang("あなたは" + skillname(setweapontrait_prm0) + "の扱いに長けている[" + skillname(setweapontrait_prm0) + "の攻撃倍率+15%]", "You know your way around with " + skillname(setweapontrait_prm0) + ". [" + skillname(setweapontrait_prm0) + " DMG +15%]"), lang("あなたは" + skillname(setweapontrait_prm0) + "を巧みに操る[" + skillname(setweapontrait_prm0) + "の攻撃倍率+35%]", "You are skilled with " + skillname(setweapontrait_prm0) + ". [" + skillname(setweapontrait_prm0) + " DMG +35%]"), lang("あなたは" + skillname(setweapontrait_prm0) + "の達人だ[" + skillname(setweapontrait_prm0) + "の攻撃倍率+70%]", "You are an expert with " + skillname(setweapontrait_prm0) + ". [" + skillname(setweapontrait_prm0) + " DMG +70%]"), lang("あなたは" + skillname(setweapontrait_prm0) + "を極めている[" + skillname(setweapontrait_prm0) + "の攻撃倍率+100%]", "You have achieved mastery with " + skillname(setweapontrait_prm0) + ". [" + skillname(setweapontrait_prm0) + " DMG +100%]")
	}
	return

#defcfunc calc3traitmulti int calc3traitmulti_prm0, double calc3traitmulti_prm1
	if ( calc3traitmulti_prm0 == 3 ) {
		return calc3traitmulti_prm1 / 2
	}
	else {
		if ( calc3traitmulti_prm0 == 2 ) {
			return calc3traitmulti_prm1 * 3 / 10
		}
		else {
			return calc3traitmulti_prm1 / 10
		}
	}

#defcfunc calctraitscore int calctraitscore_prm0
	if ( calctraitscore_prm0 == 5 ) {
		return 10
	}
	else {
		if ( calctraitscore_prm0 == 4 ) {
			return 7
		}
		else {
			if ( calctraitscore_prm0 == 3 ) {
				return 5
			}
			else {
				if ( calctraitscore_prm0 == 2 ) {
					return 3
				}
				else {
					return 1
				}
			}
		}
	}

#defcfunc calcknucklepierce int calcknucklepierce_prm0
	if ( cAttackStyle(calcknucklepierce_prm0) == STYLE_NONE ) {
		if ( gettrait(calcknucklepierce_prm0, 69) ) {
			if ( stat == 5 ) {
				return 100
			}
			else {
				if ( stat == 4 ) {
					return 70
				}
				else {
					if ( stat == 3 ) {
						return 35
					}
					else {
						if ( stat == 2 ) {
							return 15
						}
						else {
							return 5
						}
					}
				}
			}
		}
	}
	return 0

#defcfunc calcweightmulti int calcweightmulti_prm0
	if ( gettrait(calcweightmulti_prm0, 76) ) {
		if ( stat == 5 ) {
			return 100
		}
		else {
			if ( stat == 4 ) {
				return 70
			}
			else {
				if ( stat == 3 ) {
					return 35
				}
				else {
					if ( stat == 2 ) {
						return 15
					}
					else {
						return 5
					}
				}
			}
		}
	}
	return 0

#defcfunc calctraitgrowthrate int calctraitgrowthrate_prm0, int calctraitgrowthrate_prm1
	if ( calctraitgrowthrate_prm1 == 187 ) {
		if ( gettrait(calctraitgrowthrate_prm0, 8) ) {
			return stat * 40
		}
	}
	else {
		if ( calctraitgrowthrate_prm1 == 159 ) {
			if ( gettrait(calctraitgrowthrate_prm0, 6) ) {
				return stat * 30
			}
		}
		else {
			if ( calctraitgrowthrate_prm1 == 173 ) {
				if ( gettrait(calctraitgrowthrate_prm0, 10) ) {
					return stat * 20
				}
			}
			else {
				if ( calctraitgrowthrate_prm1 == 172 ) {
					if ( gettrait(calctraitgrowthrate_prm0, 12) ) {
						return stat * 40
					}
				}
				else {
					if ( calctraitgrowthrate_prm1 == 156 ) {
						if ( gettrait(calctraitgrowthrate_prm0, 16) ) {
							return stat * 40
						}
					}
					else {
						if ( calctraitgrowthrate_prm1 == 181 ) {
							if ( gettrait(calctraitgrowthrate_prm0, 17) ) {
								return stat * 40
							}
						}
						else {
							if ( calctraitgrowthrate_prm1 == 152 ) {
								if ( gettrait(calctraitgrowthrate_prm0, 82) ) {
									return stat * 40
								}
							}
							else {
								if ( calctraitgrowthrate_prm1 == 160 ) {
									if ( gettrait(calctraitgrowthrate_prm0, 101) ) {
										return stat * 40
									}
								}
								else {
									if ( calctraitgrowthrate_prm1 == 182 ) {
										if ( gettrait(calctraitgrowthrate_prm0, 102) ) {
											return stat * 40
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	if ( nc_gettrait(calctraitgrowthrate_prm0, 108) ) {
		return 20
	}
	return 0

#defcfunc factionbetween int factionbetween_prm0, int factionbetween_prm1
	procid = (procid + 1) \ 10
	proclist(procid) = "factionbetween:Begin" + " ct:" + ct
	if ( dbg_outputdebuglog ) {
	}
	resetfaction factionbetween_prm0
	resetfaction factionbetween_prm1
	if ( getfactionvalue(factionbetween_prm0, "pet") != "" ) {
		if ( factionbetween_prm1 == int(refstr) ) {
			funcend "factionbetween"
			return 0
		}
		else {
			if ( findfaction(factionbetween_prm1, "pet", refstr) ) {
				funcend "factionbetween"
				return 0
			}
		}
	}
	if ( getfactionvalue(factionbetween_prm1, "pet") != "" ) {
		if ( factionbetween_prm0 == int(refstr) ) {
			funcend "factionbetween"
			return 0
		}
	}
	if ( areaId(gArea ) == AREA_LESIMAS | areaId(gArea ) == AREA_TEST_GROUND | areaId(gArea ) == AREA_TOWER_OF_FIRE | areaId(gArea ) == AREA_CRYPT_OF_THE_DAMNED | areaId(gArea ) == AREA_ANCIENT_CASTLE | areaId(gArea ) == AREA_DRAGON_NEST | areaId(gArea ) == AREA_PUPPY_CAVE | areaId(gArea ) == AREA_PYRAMID | gArea  == AREA_SHOW_HOUSE ) {
		return 0
	}
	if ( ogQuestGuildWars ) {
		if ( getrelation(factionbetween_prm0) == (-3) & getrelation(factionbetween_prm1) == (-3) ) {
			if ( getfactionvalue(factionbetween_prm0, "guild") != "" ) {
				if ( findfactionvalue(factionbetween_prm0, factionbetween_prm1, "guild") == 0 ) {
					funcend "factionbetween"
					return hatecheck(factionbetween_prm0, 300)
				}
			}
		}
	}
	if ( oabit(10, gArea ) ) {
		if ( godcheck(factionbetween_prm1) != godcheck(factionbetween_prm0) ) {
			funcend "factionbetween"
			return hatecheck(factionbetween_prm0, 300)
		}
	}
	if ( factionbetween_prm1 == 0 ) {
		if ( gettrait(factionbetween_prm1, 183) != 0 ) {
			if ( findfaction(factionbetween_prm0, "family", "wild") ) {
				return hatecheck(factionbetween_prm0, 300)
			}
		}
	}
	if ( findfaction(factionbetween_prm0, "align", "lawful") ) {
		if ( getrelation(factionbetween_prm0) >= 0 ) {
			if ( getrelation(factionbetween_prm1) == (-3) ) {
				if ( godcheck(factionbetween_prm1) != godcheck(factionbetween_prm0) ) {
					if ( cId(factionbetween_prm0) != CREATURE_ID_EHEKATL & cId(factionbetween_prm0) != CREATURE_ID_LULWY & cId(factionbetween_prm0) != CREATURE_ID_OPATOS & cId(factionbetween_prm0) != CREATURE_ID_KUMIROMI & cId(factionbetween_prm0) != CREATURE_ID_MANI & cId(factionbetween_prm0) != CREATURE_ID_JURE & cId(factionbetween_prm0) != CREATURE_ID_ITZPALT ) {
						funcend "factionbetween"
						locvar_txtgod_hc = hatecheck(factionbetween_prm0, 60)
						return locvar_txtgod_hc
					}
				}
			}
		}
		else {
			if ( getrelation(factionbetween_prm0) >= (-2) ) {
				if ( getrelation(factionbetween_prm1) == (-3) ) {
					if ( godcheck(factionbetween_prm1) != godcheck(factionbetween_prm0) ) {
						funcend "factionbetween"
						locvar_txtgod_hc = hatecheck(factionbetween_prm0, 10)
						return locvar_txtgod_hc
					}
				}
			}
			else {
				if ( godcheck(factionbetween_prm1) != godcheck(factionbetween_prm0) ) {
					funcend "factionbetween"
					locvar_txtgod_hc = hatecheck(factionbetween_prm0, 60)
					return locvar_txtgod_hc
				}
			}
		}
	}
	else {
		if ( findfaction(factionbetween_prm0, "align", "neutral") ) {
			if ( getrelation(factionbetween_prm0) >= 0 ) {
				if ( getrelation(factionbetween_prm1) == (-3) ) {
					if ( findfaction(factionbetween_prm1, "align", "chaotic") ) {
						funcend "factionbetween"
						locvar_txtgod_hc = hatecheck(factionbetween_prm0, 60)
						return locvar_txtgod_hc
					}
				}
			}
			else {
				if ( getrelation(factionbetween_prm0) >= (-2) ) {
					return 0
				}
				else {
					if ( getrelation(factionbetween_prm1) >= 0 ) {
						if ( findfaction(factionbetween_prm1, "align", "lawful") == 0 ) {
							funcend "factionbetween"
							locvar_txtgod_hc = hatecheck(factionbetween_prm0, 60)
							return locvar_txtgod_hc
						}
					}
				}
			}
		}
		else {
			if ( findfaction(factionbetween_prm0, "align", "chaotic") ) {
				if ( getrelation(factionbetween_prm0) >= 0 ) {
					if ( getrelation(factionbetween_prm1) == (-3) ) {
						if ( findfactionvalue(factionbetween_prm0, factionbetween_prm1, "family") == 0 ) {
							funcend "factionbetween"
							locvar_txtgod_hc = hatecheck(factionbetween_prm0, 60)
							return locvar_txtgod_hc
						}
					}
				}
				else {
					if ( getrelation(factionbetween_prm0) >= (-2) ) {
						if ( findfactionvalue(factionbetween_prm0, factionbetween_prm1, "family") == 0 ) {
							funcend "factionbetween"
							locvar_txtgod_hc = hatecheck(factionbetween_prm0, 10)
							return locvar_txtgod_hc
						}
					}
					else {
						if ( findfactionvalue(factionbetween_prm0, factionbetween_prm1, "family") == 0 ) {
							funcend "factionbetween"
							locvar_txtgod_hc = hatecheck(factionbetween_prm0, 60)
							return locvar_txtgod_hc
						}
					}
				}
			}
		}
	}
	funcend "factionbetween"
	return 0

#defcfunc hatecheck int hatecheck_prm0, int hatecheck_prm1
	if ( getperseverance(hatecheck_prm0) < rnd(1 + hatecheck_prm1) ) {
		return -3
	}
	return 0

#defcfunc getrelation int getrelation_prm0
	if ( getrelation_prm0 == 0 ) {
		if ( gettrait(getrelation_prm0, 169) ) {
			return 0
		}
		if ( gettrait(getrelation_prm0, 162) ) {
			return -3
		}
		return -1
	}
	return cOrgRelation(getrelation_prm0)

#defcfunc findfaction int findfaction_prm0, str findfaction_prm1, str findfaction_prm2
	if ( instr(faction(findfaction_prm0), 0, "/" + findfaction_prm1 + "," + findfaction_prm2 + "/") != (-1) ) {
		return 1
	}
	else {
		return 0
	}

#defcfunc findfactionvalue int findfactionvalue_prm0, int findfactionvalue_prm1, str findfactionvalue_prm2
	locvar_txtgod_found = 0
	dim locvar_txtgod_values, 32
	getfactionvalues findfactionvalue_prm0, findfactionvalue_prm2, locvar_txtgod_values
	repeat stat
		if ( findfaction(findfactionvalue_prm1, findfactionvalue_prm2, locvar_txtgod_values(cnt)) ) {
			locvar_txtgod_found = 1
			break
		}
	loop
	return locvar_txtgod_found

#defcfunc getfactionvalue int getfactionvalue_prm0, str getfactionvalue_prm1
	dim locvar_txtgod_factions, 32
	split faction(getfactionvalue_prm0), "/", locvar_txtgod_factions
	locvar_txtgod_factionvalue = ""
	repeat stat
		if ( locvar_txtgod_factions(cnt) == "" ) {
			continue
		}
		locvar_txtgod_e = locvar_txtgod_factions(cnt)
		if ( strmid(locvar_txtgod_e, 0, strlen(getfactionvalue_prm1 + ",")) == getfactionvalue_prm1 + "," ) {
			sdim locvar_txtgod_subfaction, 2
			split locvar_txtgod_e, ",", locvar_txtgod_subfaction
			locvar_txtgod_factionvalue = locvar_txtgod_subfaction(1)
			break
		}
	loop
	return locvar_txtgod_factionvalue

#deffunc getfactionvalues int getfactionvalues_prm0, str getfactionvalues_prm1, array getfactionvalues_prm2
	dim locvar_txtgod_factionst, 32
	split faction(getfactionvalues_prm0), "/", locvar_txtgod_factionst
	locvar_txtgod_lim = 0
	repeat stat
		if ( strlen(locvar_txtgod_factionst(cnt)) == 0 ) {
			continue
		}
		locvar_txtgod_e = locvar_txtgod_factionst(cnt)
		if ( strmid(locvar_txtgod_e, 0, strlen(getfactionvalues_prm1)) == getfactionvalues_prm1 ) {
			sdim locvar_txtgod_subfaction, 2
			split locvar_txtgod_e, ",", locvar_txtgod_subfaction
			if ( stat > 1 ) {
				getfactionvalues_prm2(locvar_txtgod_lim) = locvar_txtgod_subfaction(1)
				locvar_txtgod_lim++
			}
		}
	loop
	return locvar_txtgod_lim

#defcfunc getfactionlabel array getfactionlabel_prm0, str getfactionlabel_prm1
	if ( en ) {
		return getfactionlabel_prm1
	}
	locvar_txtgod_flabel = ""
	repeat length2(getfactionlabel_prm0)
		if ( getfactionlabel_prm0(0, cnt) == getfactionlabel_prm1 ) {
			locvar_txtgod_flabel = getfactionlabel_prm0(1, cnt)
			break
		}
	loop
	return locvar_txtgod_flabel

#deffunc addfaction int addfaction_prm0, str addfaction_prm1
	if ( eqfaction(addfaction_prm0, addfaction_prm1) ) {
		return
	}
	locvar_txtgod_s = faction(addfaction_prm0)
	if ( strlen(locvar_txtgod_s) == 0 ) {
		locvar_txtgod_s += "/"
	}
	faction(addfaction_prm0) = locvar_txtgod_s + addfaction_prm1 + "/"
	return

#deffunc rmfaction int rmfaction_prm0, str rmfaction_prm1
	sdim locvar_txtgod_factionvaluest, 32
	getfactionvalues rmfaction_prm0, rmfaction_prm1, locvar_txtgod_factionvaluest
	repeat stat
		sreplace faction(rmfaction_prm0), faction(rmfaction_prm0), "/" + rmfaction_prm1 + "," + locvar_txtgod_factionvaluest(cnt) + "/", "/"
	loop
	sreplace faction(rmfaction_prm0), faction(rmfaction_prm0), "/" + rmfaction_prm1 + "/", "/"
	if ( strlen(faction(rmfaction_prm0)) == 1 ) {
		faction(rmfaction_prm0) = ""
	}
	return 1

#deffunc rmfactionat int rmfactionat_prm0, str rmfactionat_prm1, str rmfactionat_prm2
	sdim locvar_txtgod_factionvaluest, 32
	getfactionvalues rmfactionat_prm0, rmfactionat_prm1, locvar_txtgod_factionvaluest
	repeat stat
		if ( strmid(locvar_txtgod_factionvaluest(cnt), 0, strlen(rmfactionat_prm2)) == rmfactionat_prm2 ) {
			sreplace faction(rmfactionat_prm0), faction(rmfactionat_prm0), rmfactionat_prm1 + "," + locvar_txtgod_factionvaluest(cnt) + "/", ""
		}
	loop
	if ( strlen(faction(rmfactionat_prm0)) == 1 ) {
		faction(rmfactionat_prm0) = ""
	}
	return 1

#defcfunc eqfaction int eqfaction_prm0, str eqfaction_prm1
	if ( instr(faction(eqfaction_prm0), 0, "/" + eqfaction_prm1 + "/") != (-1) ) {
		return 1
	}
	else {
		return 0
	}

#deffunc getencproc array getencproc_prm0, int getencproc_prm1, int getencproc_prm2
	getencproc_prm0 = 0
	if ( iID(getencproc_prm1) == ITEM_ID_CARNEADES_PLANK ) {
		locvar_txtgod_ci2 = iCItemIdx(getencproc_prm1)
		repeat 9
			if ( useritemencprocref(0, cnt, locvar_txtgod_ci2) ) {
				if ( getencproc_prm2 == useritemencprocref(0, cnt, locvar_txtgod_ci2) ) {
					getencproc_prm0 = useritemencprocref(1, cnt, locvar_txtgod_ci2), useritemencprocref(2, cnt, locvar_txtgod_ci2), useritemencprocref(3, cnt, locvar_txtgod_ci2), useritemencprocref(4, cnt, locvar_txtgod_ci2), useritemencprocref(5, cnt, locvar_txtgod_ci2), useritemencprocref(6, cnt, locvar_txtgod_ci2)
					break
				}
			}
		loop
	}
	return

#defcfunc getencplimit int getencplimit_prm0
	locvar_txtgod_val = getencplimit_prm0 / 10000
	if ( locvar_txtgod_val != 0 ) {
		if ( locvar_txtgod_val == 1 ) {
			return 50
		}
		if ( locvar_txtgod_val == 2 ) {
			return 100
		}
		if ( locvar_txtgod_val == 3 ) {
			return 200
		}
		if ( locvar_txtgod_val == 6 ) {
			return 100
		}
		if ( locvar_txtgod_val == 7 ) {
			return 100
		}
		if ( locvar_txtgod_val == 8 ) {
			return 50
		}
		if ( locvar_txtgod_val == 9 ) {
			return 1000
		}
	}
	if ( getencplimit_prm0 == 29 ) {
		return 100
	}
	if ( getencplimit_prm0 == 40 ) {
		return 100
	}
	return 50

#defcfunc ocbit int ocbit_prm0, int ocbit_prm1
	HMMBITCHECK ocdata(240 + ocbit_prm0 / 32, ocbit_prm1), ocbit_prm0 \ 32
	return abs(stat)

#deffunc ocbitmod int ocbitmod_prm0, int ocbitmod_prm1, int ocbitmod_prm2
	if ( ocbitmod_prm2 == 0 ) {
		HMMBITOFF ocdata(240 + ocbitmod_prm0 / 32, ocbitmod_prm1), ocbitmod_prm0 \ 32
		return
	}
	HMMBITON ocdata(240 + ocbitmod_prm0 / 32, ocbitmod_prm1), ocbitmod_prm0 \ 32
	return

#defcfunc calcread int calcread_prm0, int calcread_prm1, int calcread_prm2
	locvar_txtgod_f = 1
	tc = cc
	if ( cBlind(cc) != 0 ) {
		locvar_txtgod_f = 0
	}
	if ( cConfuse(cc) != 0 | cDim(cc) != 0 ) {
		if ( rnd(4) != 0 ) {
			locvar_txtgod_f = 0
		}
	}
	else {
		if ( calcread_prm1 == 0 ) {
			locvar_txtgod_r1 = sMAG(cc)
		}
		else {
			locvar_txtgod_r1 = sdata(skillUse(calcread_prm1), cc)
		}
		if ( calcread_prm2 != 0 ) {
			if ( (sLiteracy(cc) * locvar_txtgod_r1 * 4 + 250) / calcread_prm2 < calcread_prm0 ) {
				locvar_txtgod_f = 0
			}
		}
		else {
			if ( rndex(sLiteracy(cc) * locvar_txtgod_r1 * 4 + 250) < rndex(calcread_prm0 + 1) ) {
				if ( rnd(7) == 0 ) {
					locvar_txtgod_f = 0
				}
				if ( locvar_txtgod_r1 * 10 < calcread_prm0 ) {
					if ( rnd(locvar_txtgod_r1 * 10 + 1) < rnd(calcread_prm0 + 1) ) {
						locvar_txtgod_f = 0
					}
				}
				if ( locvar_txtgod_r1 * 20 < calcread_prm0 ) {
					if ( rnd(locvar_txtgod_r1 * 20 + 1) < rnd(calcread_prm0 + 1) ) {
						locvar_txtgod_f = 0
					}
				}
				if ( locvar_txtgod_r1 * 30 < calcread_prm0 ) {
					if ( rnd(locvar_txtgod_r1 * 30 + 1) < rnd(calcread_prm0 + 1) ) {
						locvar_txtgod_f = 0
					}
				}
			}
		}
	}
	return locvar_txtgod_f

#defcfunc calcfixexp int calcfixexp_prm0, int calcfixexp_prm1
	locvar_txtgod_i = 100
	if ( cHunger(calcfixexp_prm0) >= 5000 ) {
		locvar_calcbuff_p = (cHunger(calcfixexp_prm0) - 5000) / 25
		locvar_txtgod_i = locvar_txtgod_i * 100 / (100 + locvar_calcbuff_p)
	}
	if ( calcfixexp_prm0 != 0 ) {
		locvar_txtgod_i = 1500
		if ( iMaterial(calcfixexp_prm1) == ITEM_MATERIAL_RAW ) {
			if ( iParam3(calcfixexp_prm1) < 0 ) {
				if ( cbit(CHARA_BIT_EAT_ROTTEN, calcfixexp_prm0) == FALSE ) {
					locvar_txtgod_i = 500
				}
			}
		}
	}
	if ( findbuff(calcfixexp_prm0, 81) != (-1) ) {
		if ( godcheck(calcfixexp_prm0) == "kumiromi" ) {
			locvar_txtgod_i = locvar_txtgod_i * (100 + limit(ocdata(OCDATA_STARTING_CURSE_BUFF_TYPE + findbuff(calcfixexp_prm0, 81) * 3 + 1, calcfixexp_prm0) / 50, 0, 2000)) / 100
		}
	}
	return locvar_txtgod_i

#defcfunc creategodno
	locvar_txtgod_isetgodmax = length(isetgod)
	return rnd(locvar_txtgod_isetgodmax + usergodmax)

#defcfunc blessgod
	locvar_txtgod_i = creategodno()
	if ( locvar_txtgod_i < locvar_txtgod_isetgodmax ) {
		return isetgod(locvar_txtgod_i)
	}
	else {
		return creategoduid(locvar_txtgod_i - locvar_txtgod_isetgodmax)
	}

#defcfunc blesscgod int blesscgod_prm0
	locvar_txtgod_j = 0
	repeat usergodmax
		if ( godcheck(blesscgod_prm0) == usergoddatan(2, cnt) ) {
			locvar_txtgod_j = creategoduid(cnt)
			break
		}
	loop
	return locvar_txtgod_j

#deffunc setgod int setgod_prm0
	locvar_txtgod_isetgodmax = length(isetgod)
	locvar_txtgod_i = rnd(locvar_txtgod_isetgodmax + usergodmax)
	if ( locvar_txtgod_i < locvar_txtgod_isetgodmax ) {
		iParam1(setgod_prm0) = isetgod(locvar_txtgod_i)
	}
	else {
		iParam1(setgod_prm0) = 0
		iParam2(setgod_prm0) = locvar_txtgod_i - locvar_txtgod_isetgodmax
		iParam3(setgod_prm0) = creategoduid(iParam2(setgod_prm0))
	}
	return 1

#defcfunc creategodid
	locvar_txtgod_i = creategodno()
	if ( locvar_txtgod_i < locvar_txtgod_isetgodmax ) {
		locvar_txtgod_godidt = godno2godid(isetgod(locvar_txtgod_i))
	}
	else {
		locvar_txtgod_godidt = usergoddatan(2, locvar_txtgod_i - locvar_txtgod_isetgodmax)
	}
	return locvar_txtgod_godidt

#defcfunc getitemindex int getitemindex_prm0
	locvar_txtgod_itemid = -1
	repeat useritemmax
		locvar_txtgod_s = useritemdatan(0, cnt)
		locvar_cnvjkey_p = 0
		repeat strlen(locvar_txtgod_s)
			locvar_cnvjkey_p += peek(locvar_txtgod_s, cnt)
		loop
		locvar_txtgod_s = str(peek(locvar_txtgod_s, 0)) + str(locvar_cnvjkey_p) + str(peek(locvar_txtgod_s, strlen(locvar_txtgod_s) - 1))
		if ( getitemindex_prm0 == int(locvar_txtgod_s) ) {
			locvar_txtgod_itemid = cnt
			break
		}
	loop
	return locvar_txtgod_itemid

#defcfunc createserialno str createserialno_prm0
	locvar_txtgod_s = createserialno_prm0
	if ( strlen(locvar_txtgod_s) == 0 ) {
		return -1
	}
	locvar_cnvjkey_p = 0
	repeat strlen(locvar_txtgod_s)
		locvar_cnvjkey_p += peek(locvar_txtgod_s, cnt)
	loop
	locvar_txtgod_s = str(peek(locvar_txtgod_s, 0)) + str(locvar_cnvjkey_p) + str(peek(locvar_txtgod_s, strlen(locvar_txtgod_s) - 1))
	return int(locvar_txtgod_s)

#deffunc modnpcmemory int modnpcmemory_prm0, int modnpcmemory_prm1, int modnpcmemory_prm2
	npcmemory(modnpcmemory_prm0, cId(modnpcmemory_prm1)) += modnpcmemory_prm2
	if ( cId(modnpcmemory_prm1) == CREATURE_ID_USER ) {
		if ( cUNID(modnpcmemory_prm1) != usernpcmax ) {
			locvar_txtgod_i = -1
			locvar_cnvjkey_p = createserialno(userdatan(0, cUNID(modnpcmemory_prm1)))
			repeat cnpcmemorymax
				if ( cnpcmemory(0, cnt) == locvar_cnvjkey_p ) {
					locvar_txtgod_i = cnt
					break
				}
			loop
			if ( locvar_txtgod_i == (-1) ) {
				if ( cnpcmemorymax >= 3000 ) {
					return
				}
				locvar_txtgod_i = cnpcmemorymax
				cnpcmemory(0, locvar_txtgod_i) = locvar_cnvjkey_p
				cnpcmemorymax++
			}
			cnpcmemory(modnpcmemory_prm0 + 1, locvar_txtgod_i) += modnpcmemory_prm2
		}
	}
	return

#defcfunc getcnpcmemory int getcnpcmemory_prm0, int getcnpcmemory_prm1
	locvar_txtgod_i = -1
	locvar_cnvjkey_p = createserialno(userdatan(0, getcnpcmemory_prm1))
	repeat cnpcmemorymax
		if ( cnpcmemory(0, cnt) == locvar_cnvjkey_p ) {
			locvar_txtgod_i = cnt
			break
		}
	loop
	if ( locvar_txtgod_i == (-1) ) {
		return 0
	}
	return cnpcmemory(getcnpcmemory_prm0 + 1, locvar_txtgod_i)

#defcfunc getcnpcmemory4name int getcnpcmemory4name_prm0, str getcnpcmemory4name_prm1
	locvar_txtgod_i = -1
	locvar_cnvjkey_p = createserialno(getcnpcmemory4name_prm1)
	repeat cnpcmemorymax
		if ( cnpcmemory(0, cnt) == locvar_cnvjkey_p ) {
			locvar_txtgod_i = cnt
			break
		}
	loop
	if ( locvar_txtgod_i == (-1) ) {
		return 0
	}
	return cnpcmemory(getcnpcmemory4name_prm0 + 1, locvar_txtgod_i)

#deffunc getunid4item int getunid4item_prm0
	locvar_txtgod_f = 0
	repeat usernpcmax
		if ( ICNpcSerialNo(getunid4item_prm0) == createserialno(userdatan(0, cnt)) ) {
			iCNpcId(getunid4item_prm0) = cnt
			locvar_txtgod_f = 1
			break
		}
	loop
	if ( locvar_txtgod_f ) {
		if ( iID(getunid4item_prm0) == ITEM_ID_FIGURINE | iID(getunid4item_prm0) == ITEM_ID_CARD | iID(getunid4item_prm0) == ITEM_ID_OBJET_HEART ) {
			if ( iSubName(getunid4item_prm0) == 343 ) {
				if ( userdata2(8, iCNpcId(getunid4item_prm0)) != 0 ) {
					iCol(getunid4item_prm0) = limit(userdata2(8, iCNpcId(getunid4item_prm0)), 0, 33 * 25)
				}
				else {
					iCol(getunid4item_prm0) = 825 + iCNpcId(getunid4item_prm0)
				}
			}
		}
	}
	else {
		iCNpcId(getunid4item_prm0) = usernpcmax
	}
	return locvar_txtgod_f

#deffunc getunid4job int getunid4job_prm0
	locvar_txtgod_f = 0
	repeat usernpcmax
		if ( qQuestTarget(getunid4job_prm0) == createserialno(userdatan(0, cnt)) ) {
			qParam2(getunid4job_prm0) = cnt
			locvar_txtgod_f = 1
			break
		}
	loop
	if ( locvar_txtgod_f == 0 ) {
		qParam2(getunid4job_prm0) = usernpcmax
	}
	return locvar_txtgod_f

#defcfunc limitmin int limitmin_prm0, int limitmin_prm1
	if ( limitmin_prm0 > limitmin_prm1 ) {
		return limitmin_prm0
	}
	else {
		return limitmin_prm1
	}

#defcfunc godno2godid int godno2godid_prm0
	locvar_txtgod__switch_val = godno2godid_prm0
	repeat 1
		if ( locvar_txtgod__switch_val == 1 ) {
			locvar_txtgod_godid = "mani"
			break
		}
		if ( locvar_txtgod__switch_val == 2 ) {
			locvar_txtgod_godid = "lulwy"
			break
		}
		if ( locvar_txtgod__switch_val == 3 ) {
			locvar_txtgod_godid = "itzpalt"
			break
		}
		if ( locvar_txtgod__switch_val == 4 ) {
			locvar_txtgod_godid = "ehekatl"
			break
		}
		if ( locvar_txtgod__switch_val == 5 ) {
			locvar_txtgod_godid = "opatos"
			break
		}
		if ( locvar_txtgod__switch_val == 6 ) {
			locvar_txtgod_godid = "jure"
			break
		}
		if ( locvar_txtgod__switch_val == 7 ) {
			locvar_txtgod_godid = "kumiromi"
			break
		}
		locvar_txtgod_godid = "eyth"
	loop
	return locvar_txtgod_godid

#deffunc incfame int incfame_prm0, int incfame_prm1
	cFame(incfame_prm0) += incfame_prm1
	if ( incfame_prm1 <= 0 ) {
		return 1
	}
	dim locvar_txtgod_list, 30
	locvar_txtgod_listmax = 0
	repeat 30, 100
		if ( cdata(cnt, incfame_prm0) == 0 ) {
			continue
		}
		if ( cdata(cnt, incfame_prm0) / EXT_EQUIP_SLOTS != 5 & cdata(cnt, incfame_prm0) / EXT_EQUIP_SLOTS != 10 ) {
			continue
		}
		locvar_txtgod_i = cdata(cnt, incfame_prm0) \ EXT_EQUIP_SLOTS - 1
		if ( locvar_txtgod_i < 0 ) {
			continue
		}
		if ( ibit(18, locvar_txtgod_i) & iStatus(locvar_txtgod_i) >= ITEM_STATUS_BLESSED ) {
			locvar_txtgod_list(locvar_txtgod_listmax) = locvar_txtgod_i
			locvar_txtgod_listmax++
		}
	loop
	repeat locvar_txtgod_listmax
		locvar_txtgod_i = locvar_txtgod_list(cnt)
		if ( cLevel(incfame_prm0) < iParam1(locvar_txtgod_i) + 1 ) {
			continue
		}
		iParam2(locvar_txtgod_i) += incfame_prm1 / sqrt(iParam1(locvar_txtgod_i)) + rndex(incfame_prm1 / sqrt(iParam1(locvar_txtgod_i)) + 1)
		if ( cKarma(incfame_prm0) > 0 ) {
			iParam2(locvar_txtgod_i) += cFame(incfame_prm0) / (5 * sqrt(iParam1(locvar_txtgod_i))) + rndex(cFame(incfame_prm0) / (5 * sqrt(iParam1(locvar_txtgod_i))) + 1)
		}
		if ( iParam2(locvar_txtgod_i) >= calcexpalive(iParam1(locvar_txtgod_i)) ) {
			if ( synccheck(incfame_prm0, -1) ) {
				txtef COLOR_GREEN
				snd SOUNDLIST_DING3
				txt -1, lang(itemname(locvar_txtgod_i) + "は" + name(incfame_prm0) + "を認めた！", itemname(locvar_txtgod_i) + " approves of " + name(incfame_prm0) + "'s deeds!")
			}
		}
	loop
	return 1

#deffunc decjusticweapon int decjusticweapon_prm0
	dim locvar_txtgod_list, 30
	locvar_txtgod_listmax = 0
	repeat 30, 100
		if ( cdata(cnt, decjusticweapon_prm0) == 0 ) {
			continue
		}
		if ( cdata(cnt, decjusticweapon_prm0) / EXT_EQUIP_SLOTS != 5 & cdata(cnt, decjusticweapon_prm0) / EXT_EQUIP_SLOTS != 10 ) {
			continue
		}
		locvar_txtgod_i = cdata(cnt, decjusticweapon_prm0) \ EXT_EQUIP_SLOTS - 1
		if ( locvar_txtgod_i < 0 ) {
			continue
		}
		if ( ibit(18, locvar_txtgod_i) & iStatus(locvar_txtgod_i) >= ITEM_STATUS_BLESSED ) {
			locvar_txtgod_list(locvar_txtgod_listmax) = locvar_txtgod_i
			locvar_txtgod_listmax++
		}
	loop
	repeat locvar_txtgod_listmax
		locvar_txtgod_i = locvar_txtgod_list(cnt)
		safe_subtract iLevel(locvar_txtgod_i), 1
		repeat 15
			if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, locvar_txtgod_i) == 0 ) {
				break
			}
			locvar_txtgod_encid = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, locvar_txtgod_i)
			if ( encpassivecheck(locvar_txtgod_encid) ) {
				continue
			}
			locvar_txtgod_decp = 50
			locvar_txtgod_encsid = locvar_txtgod_encid / 10000
			if ( locvar_txtgod_encsid == 9 ) {
				locvar_txtgod_decp *= 1000
			}
			locvar_txtgod_encp = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, locvar_txtgod_i) - locvar_txtgod_decp
			if ( locvar_txtgod_encsid > 0 ) {
				locvar_txtgod__switch_val = locvar_txtgod_encsid
				if ( locvar_txtgod__switch_val == 1 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 2 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 3 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					if ( locvar_txtgod_encp < (-100000) ) {
						locvar_txtgod_encp = -100000
					}
					goto *label_4825
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 7 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 8 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					if ( locvar_txtgod_encp < 25 ) {
						locvar_txtgod_encp = 25
					}
					goto *label_4825
					locvar_txtgod__switch_sw++
				}
				if ( locvar_txtgod__switch_val == 9 | locvar_txtgod__switch_sw ) {
					locvar_txtgod__switch_sw = 0
					if ( locvar_txtgod_encp < 1000 ) {
						locvar_txtgod_encp = 1000
					}
					goto *label_4825
				}
			}
			else {
				if ( locvar_txtgod_encp < 25 ) {
					locvar_txtgod_encp = 25
				}
			}
			inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, locvar_txtgod_i) = locvar_txtgod_encp
		loop
		if ( getrelation(decjusticweapon_prm0) < 0 ) {
			iParam2(locvar_txtgod_i) = 0
		}
		txtef COLOR_RED
		txt -1, lang("あなたは" + itemname(locvar_txtgod_list(cnt)) + "からの信頼を失った……", itemname(locvar_txtgod_list(cnt)) + " has lost faith in you...")
	loop
	return 1

#defcfunc eqevilweapon int eqevilweapon_prm0
	locvar_txtgod_ci = -1
	repeat 30, 100
		if ( cdata(cnt, eqevilweapon_prm0) == 0 ) {
			continue
		}
		if ( cdata(cnt, eqevilweapon_prm0) / EXT_EQUIP_SLOTS != 5 & cdata(cnt, eqevilweapon_prm0) / EXT_EQUIP_SLOTS != 10 ) {
			continue
		}
		locvar_txtgod_i = cdata(cnt, eqevilweapon_prm0) \ EXT_EQUIP_SLOTS - 1
		if ( locvar_txtgod_i < 0 ) {
			continue
		}
		if ( ibit(ITEM_BIT_ALIVE, locvar_txtgod_i) == FALSE ) {
			continue
		}
		if ( ibit(18, locvar_txtgod_i) == FALSE ) {
			continue
		}
		if ( iStatus(locvar_txtgod_i) != ITEM_STATUS_DOOMED ) {
			continue
		}
		if ( iParam1(locvar_txtgod_i) <= 15 ) {
			continue
		}
		locvar_txtgod_ci = locvar_txtgod_i
		break
	loop
	return locvar_txtgod_ci

#defcfunc calcpiercefix int calcpiercefix_prm0, int calcpiercefix_prm1, int calcpiercefix_prm2, int calcpiercefix_prm3
	locvar_txtgod_spattack = 0
	locvar_txtgod__switch_val = calcpiercefix_prm0
	if ( locvar_txtgod__switch_val == 110 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		if ( filtercheck(calcpiercefix_prm2, "undead") ) {
			locvar_txtgod_spattack += -1
		}
		goto *label_4833
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 111 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		if ( cbit(CHARA_BIT_FLOAT, calcpiercefix_prm2) ) {
			locvar_txtgod_spattack += 1
		}
		goto *label_4833
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 104 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		if ( cSpeed(calcpiercefix_prm2) < cSpeed(calcpiercefix_prm1) ) {
			locvar_txtgod_spattack += 1
		}
		goto *label_4833
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 102 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_spattack += 1
		repeat 30, 100
			if ( cdata(cnt, calcpiercefix_prm2) \ EXT_EQUIP_SLOTS == 0 ) {
				continue
			}
			locvar_txtgod_rp = cdata(cnt, calcpiercefix_prm2) \ EXT_EQUIP_SLOTS - 1
			if ( iDice1(locvar_txtgod_rp) == 0 ) {
				locvar_txtgod_spattack += -1
				break
			}
		loop
		goto *label_4833
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 103 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		if ( carmor(calcpiercefix_prm2) == 169 | cnRace(calcpiercefix_prm2) == "shell" | filtercheck(calcpiercefix_prm2, "shell") | cnRace(calcpiercefix_prm2) == "golem" | filtercheck(calcpiercefix_prm2, "golem") | filtercheck(calcpiercefix_prm2, "slime") ) {
			locvar_txtgod_spattack += 1
		}
		if ( filtercheck(calcpiercefix_prm2, "slime") ) {
			locvar_txtgod_spattack += -1
		}
		goto *label_4833
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 106 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		if ( filtercheck(calcpiercefix_prm2, "slime") ) {
			locvar_txtgod_spattack += -1
		}
		goto *label_4833
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 108 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		repeat 30, 100
			if ( cdata(cnt, calcpiercefix_prm2) == 0 ) {
				continue
			}
			if ( cdata(cnt, calcpiercefix_prm2) / EXT_EQUIP_SLOTS != 10 ) {
				continue
			}
			if ( cdata(cnt, calcpiercefix_prm2) \ EXT_EQUIP_SLOTS == 0 ) {
				locvar_txtgod_spattack += 1
				break
			}
		loop
		goto *label_4833
	}

*label_4833
	return locvar_txtgod_spattack * 20

#defcfunc find_eq int find_eq_prm0, int find_eq_prm1
	locvar_txtgod_inv_no = -1
	repeat 30
		locvar_txtgod_body = 100 + cnt
		if ( cdata(locvar_txtgod_body, find_eq_prm0) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		locvar_txtgod_cw = cdata(locvar_txtgod_body, find_eq_prm0) \ EXT_EQUIP_SLOTS - 1
		if ( locvar_txtgod_cw == (-1) ) {
			continue
		}
		if ( find_eq_prm1 > 10000 ) {
			locvar_txtgod_reftypeminor = refitem(iID(locvar_txtgod_cw), DBSPEC_TYPE_MINOR, locvar_txtgod_cw)
			if ( locvar_txtgod_reftypeminor == find_eq_prm1 ) {
				locvar_txtgod_inv_no = locvar_txtgod_cw
				break
			}
		}
		else {
			if ( iID(locvar_txtgod_cw) == find_eq_prm1 ) {
				locvar_txtgod_inv_no = locvar_txtgod_cw
				break
			}
		}
	loop
	return locvar_txtgod_inv_no

#defcfunc get_ueq int get_ueq_prm0, int get_ueq_prm1
	locvar_txtgod_cw = -1
	repeat 30
		locvar_txtgod_body = 100 + cnt
		if ( cdata(locvar_txtgod_body, get_ueq_prm0) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		if ( cdata(locvar_txtgod_body, get_ueq_prm0) / EXT_EQUIP_SLOTS == get_ueq_prm1 ) {
			locvar_txtgod_cw = cdata(locvar_txtgod_body, get_ueq_prm0) \ EXT_EQUIP_SLOTS - 1
			break
		}
	loop
	return locvar_txtgod_cw

#defcfunc eqthrowcheck int eqthrowcheck_prm0
	locvar_txtgod_f = 0
	repeat 30
		locvar_txtgod_body = 100 + cnt
		if ( cdata(locvar_txtgod_body, eqthrowcheck_prm0) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		if ( cdata(locvar_txtgod_body, eqthrowcheck_prm0) / EXT_EQUIP_SLOTS == 10 ) {
			continue
		}
		if ( cdata(locvar_txtgod_body, eqthrowcheck_prm0) / EXT_EQUIP_SLOTS == 11 ) {
			continue
		}
		locvar_txtgod_cw = cdata(locvar_txtgod_body, eqthrowcheck_prm0) \ EXT_EQUIP_SLOTS - 1
		if ( iDice1(locvar_txtgod_cw) > 0 ) {
			if ( iequiploc(locvar_txtgod_cw) == 10 ) {
				if ( iSkillRef(locvar_txtgod_cw) == SKILL_WEAPON_THROWING ) {
					locvar_txtgod_f = 1
					break
				}
			}
		}
	loop
	return locvar_txtgod_f

#defcfunc givecheck int givecheck_prm0, int givecheck_prm1
	locvar_txtgod_found = 0
	repeat 10
		if ( usergoddata(2 + cnt, givecheck_prm1) == 0 ) {
			break
		}
		locvar_txtgod_givet = usergoddata(2 + cnt, givecheck_prm1)
		if ( locvar_txtgod_givet == reftype ) {
			locvar_txtgod_found = 1
			break
		}
		locvar_txtgod_reftypeminor = refitem(iID(givecheck_prm0), DBSPEC_TYPE_MINOR, givecheck_prm0)
		if ( locvar_txtgod_givet == locvar_txtgod_reftypeminor ) {
			locvar_txtgod_found = 1
			break
		}
		if ( locvar_txtgod_givet == iID(givecheck_prm0) ) {
			locvar_txtgod_found = 1
			break
		}
		if ( cfg_offercorpse ) {
			if ( iID(givecheck_prm0) == ITEM_ID_CORPSE ) {
				locvar_txtgod_found = 1
				break
			}
		}
	loop
	return locvar_txtgod_found

#defcfunc sppfind int sppfind_prm0, int sppfind_prm1
	locvar_txtgod_encp = -1
	if ( getcgodno(sppfind_prm0) != (-1) ) {
		locvar_txtgod_cgodno = stat
		if ( usergoddata(32, locvar_txtgod_cgodno) / 1000 == 1 ) {
			if ( usergoddata(32, locvar_txtgod_cgodno) \ 1000 == sppfind_prm1 ) {
				locvar_txtgod_encp = convert_var(usergoddatan(27, locvar_txtgod_cgodno), 0, 0, cPiety(sppfind_prm0))
			}
		}
	}
	return locvar_txtgod_encp

#defcfunc findcgodno str findcgodno_prm0
	locvar_txtgod_cgod_no = -1
	repeat usergodmax
		if ( findcgodno_prm0 == usergoddatan(2, cnt) ) {
			locvar_txtgod_cgod_no = cnt
			break
		}
	loop
	return locvar_txtgod_cgod_no

#defcfunc getcgodno int getcgodno_prm0
	if ( cGod(getcgodno_prm0) != GOD_EYTH ) {
		return -1
	}
	locvar_txtgod_s = godcheck(getcgodno_prm0)
	if ( locvar_txtgod_s == "eyth" ) {
		return -1
	}
	return findcgodno(locvar_txtgod_s)

#deffunc metamorphosis int metamorphosis_prm0
	locvar_txtgod_distance = dist(cX(cTarget(metamorphosis_prm0)), cY(cTarget(metamorphosis_prm0)), cX(metamorphosis_prm0), cY(metamorphosis_prm0))
	locvar_txtgod_objlv = cLevel(metamorphosis_prm0)
	dim locvar_txtgod_dblist, 50
	locvar_txtgod_dbmax = 0
	if ( locvar_txtgod_distance > 1 ) {
		if ( locvar_txtgod_distance > 2 | rnd(2) ) {
			if ( locvar_txtgod_objlv >= 65 ) {
				dbadd 220
			}
			if ( locvar_txtgod_objlv >= 45 ) {
				dbadd 49
			}
			if ( locvar_txtgod_objlv >= 30 ) {
				dbadd 48
			}
			if ( locvar_txtgod_objlv >= 20 ) {
				dbadd 47
			}
			if ( locvar_txtgod_objlv >= 5 ) {
				dbadd 24
			}
			dbadd 264
		}
		if ( locvar_txtgod_objlv >= 17 ) {
			dbadd 325
		}
		if ( locvar_txtgod_objlv >= 8 ) {
			dbadd 117
		}
		dbadd 261
	}
	else {
		if ( locvar_txtgod_objlv >= 50 ) {
			dbadd 216
		}
		if ( locvar_txtgod_objlv >= 30 ) {
			dbadd 198
		}
		if ( locvar_txtgod_objlv >= 30 ) {
			dbadd 188
		}
		if ( locvar_txtgod_objlv >= 25 ) {
			dbadd 258
		}
		if ( locvar_txtgod_objlv >= 15 ) {
			dbadd 78
		}
		if ( locvar_txtgod_objlv >= 13 ) {
			dbadd 92
		}
		if ( locvar_txtgod_objlv >= 10 ) {
			dbadd 43
		}
		if ( locvar_txtgod_objlv >= 8 ) {
			dbadd 312
		}
		dbadd 265
	}
	cAiSub(metamorphosis_prm0) = 0
	locvar_txtgod_dbid = locvar_txtgod_dblist(rnd(locvar_txtgod_dbmax))
	locvar_txtgod__switch_val = locvar_txtgod_dbid
	if ( locvar_txtgod__switch_val == 264 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPELL_MAGIC_DART, SKILL_SPELL_NETHER_ARROW, SKILL_SPELL_DARK_EYE
		cActIndex(metamorphosis_prm0) = 3
		cbitmod CHARA_BIT_RAPID_MAGIC, metamorphosis_prm0, TRUE
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 24 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPELL_NERVE_ARROW
		cActIndex(metamorphosis_prm0) = 1
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 47 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 49 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPELL_MAGIC_DART, SKILL_SPELL_ICE_BOLT, SKILL_SPELL_DARKNESS_BOLT
		cActIndex(metamorphosis_prm0) = 3
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 48 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPELL_MAGIC_DART, SKILL_SPELL_ICE_BOLT, SKILL_SPELL_DARKNESS_BOLT, SKILL_SPELL_ELEMENT_SCAR
		cActIndex(metamorphosis_prm0) = 4
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 220 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPELL_CHAOS_EYE, SKILL_SPELL_RAGING_ROAR, SKILL_SPELL_NETHER_ARROW
		cActIndex(metamorphosis_prm0) = 3
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 117 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = ACTION_RANGE, SKILL_SPELL_MIST_OF_SILENCE
		cActIndex(metamorphosis_prm0) = 2
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 325 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = ACTION_RANGE, SKILL_SPACT_INSULT
		cActIndex(metamorphosis_prm0) = 2
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 261 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPELL_MIST_OF_SILENCE, SKILL_SPELL_SLOW, SKILL_SPELL_NETHER_ARROW
		cActIndex(metamorphosis_prm0) = 3
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 265 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = ACTION_MELEE, SKILL_SPACT_INSULT, SKILL_SPELL_REGENERATION
		cActIndex(metamorphosis_prm0) = 3
		cbitmod CHARA_BIT_BREAK_WALLS, metamorphosis_prm0, TRUE
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 43 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPACT_DRAIN_BLOOD
		cActIndex(metamorphosis_prm0) = 1
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 312 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPACT_SCAVENGE
		cActIndex(metamorphosis_prm0) = 1
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 78 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPELL_MIST_OF_FRAILNESS, SKILL_SPELL_SLOW, SKILL_SPELL_ELEMENT_SCAR
		cActIndex(metamorphosis_prm0) = 3
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 188 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = ACTION_MELEE
		cActIndex(metamorphosis_prm0) = 1
		cdata(CDATA_ELEMENT, metamorphosis_prm0) = SKILL_RESDMG_CUT * 100000 + 150
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 216 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPACT_DRAIN_BLOOD, SKILL_SPACT_EYE_OF_INSANITY
		cActIndex(metamorphosis_prm0) = 2
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 198 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cAiSub(metamorphosis_prm0) = 50
		cActIndex(metamorphosis_prm0) = 11
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = ACTION_MELEE
		cdata(STARTING_CDATA_ACT_SUB, metamorphosis_prm0) = ACTION_THROW_POTION_GREATER
		cdata(CDATA_ELEMENT, metamorphosis_prm0) = SKILL_RES_MIND * 100000 + 250
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 92 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = SKILL_SPACT_TOUCH_OF_SLEEP, SKILL_SPACT_TOUCH_OF_SLEEP, SKILL_SPELL_ICE_BOLT, SKILL_SPACT_COLD_BREATH
		cActIndex(metamorphosis_prm0) = 4
		goto *label_4847
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 258 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		cdata(STARTING_CDATA_ACT_MAIN, metamorphosis_prm0) = ACTION_MELEE
		cActIndex(metamorphosis_prm0) = 1
		cdata(CDATA_ELEMENT, metamorphosis_prm0) = SKILL_RESDMG_CUT * 100000 + 150
		cBarrier(metamorphosis_prm0) = 61 + 250 * 1000
		goto *label_4847
	}

*label_4847
	cAiMoveFreq(metamorphosis_prm0) = 0
	cRowAct(metamorphosis_prm0) = 20002
	cActionPeriod(metamorphosis_prm0) = 1
	return locvar_txtgod_dbid

#deffunc dbadd int dbadd_prm0
	locvar_txtgod_dblist(locvar_txtgod_dbmax) = dbadd_prm0
	locvar_txtgod_dbmax++
	return

#defcfunc equalsitem int equalsitem_prm0, str equalsitem_prm1
	if ( iID(equalsitem_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		locvar_txtgod_citemid = finditemid(equalsitem_prm1)
		if ( locvar_txtgod_citemid ) {
			if ( iCItemIdx(equalsitem_prm0) == locvar_txtgod_citemid - 1 ) {
				return 1
			}
		}
	}
	return 0

#defcfunc reinforcecheck int reinforcecheck_prm0, int reinforcecheck_prm1
	if ( inv(STARTING_INV_ITEM_ENCHANT + reinforcecheck_prm0 * 2, reinforcecheck_prm1) == 0 ) {
		return -1
	}
	locvar_txtgod_encp = inv(STARTING_INV_ITEM_ENCHANT_POWER + reinforcecheck_prm0 * 2, reinforcecheck_prm1)
	repeat 8
		locvar_txtgod_mtenc_id = mtenc(cnt * 2, iMaterial(reinforcecheck_prm1))
		if ( locvar_txtgod_mtenc_id == 0 ) {
			break
		}
		if ( inv(STARTING_INV_ITEM_ENCHANT + reinforcecheck_prm0 * 2, reinforcecheck_prm1) == locvar_txtgod_mtenc_id ) {
			locvar_txtgod_encp -= mtenc(1 + cnt * 2, iMaterial(reinforcecheck_prm1))
			break
		}
	loop
	if ( locvar_txtgod_encp <= 0 ) {
		return 0
	}
	return locvar_txtgod_encp

#defcfunc skillnameref int skillnameref_prm0, int skillnameref_prm1
	locvar_txtgod__switch_val = skillnameref_prm0
	if ( locvar_txtgod__switch_val == (-1) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_name_s = lang("近接攻撃", "Melee Attack")
		goto *label_4853
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == (-2) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_name_s = lang("遠隔攻撃", "Ranged Attack")
		goto *label_4853
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == (-9995) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_name_s = lang("トマト投擲", "Throw Tomato")
		goto *label_4853
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == (-9994) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_name_s = lang("媚薬投擲", "Throw Love potion")
		goto *label_4853
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == (-9996) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_name_s = lang("塩投擲", "Throw Salt")
		goto *label_4853
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == (-9997) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == (-9998) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == (-9999) | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_name_s = lang("ポーション投擲", "Throw Potion")
		goto *label_4853
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 183 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_f = 1
		if ( cId(skillnameref_prm1) == CREATURE_ID_BARD ) {
			locvar_txtgod_f = 0
		}
		else {
			if ( cId(skillnameref_prm1) == CREATURE_ID_USER ) {
				if ( userdata2(5, cUNID(skillnameref_prm1)) == 1 ) {
					locvar_txtgod_f = 0
				}
			}
			else {
				if ( skillnameref_prm1 == 0 ) {
					if ( cRowAct(skillnameref_prm1) != 10006 ) {
						locvar_txtgod_f = 0
					}
				}
			}
		}
		if ( locvar_txtgod_f ) {
			locvar_name_s = lang("歌唱", "Singing")
			goto *label_4853
		}
	}
	locvar_name_s = skillname(skillnameref_prm0)

*label_4853
	return locvar_name_s

#defcfunc skilldescref int skilldescref_prm0, int skilldescref_prm1
	locvar_txtgod__switch_val = skilldescref_prm0
	if ( locvar_txtgod__switch_val == 183 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_f = 1
		if ( cId(skilldescref_prm1) == CREATURE_ID_BARD ) {
			locvar_txtgod_f = 0
		}
		else {
			if ( cId(skilldescref_prm1) == CREATURE_ID_USER ) {
				if ( userdata2(5, cUNID(skilldescref_prm1)) == 1 ) {
					locvar_txtgod_f = 0
				}
			}
			else {
				if ( skilldescref_prm1 == 0 ) {
					locvar_txtgod_f = 0
				}
			}
		}
		if ( locvar_txtgod_f ) {
			locvar_name_s = lang("質の高い歌唱を可能にする", "Shows how good of a singer you are.")
			goto *label_4855
		}
	}
	locvar_name_s = skilldesc(skilldescref_prm0)

*label_4855
	return locvar_name_s

#defcfunc encpfindspec int encpfindspec_prm0, int encpfindspec_prm1, array encpfindspec_prm2
	locvar_txtgod_f = -1
	repeat 15
		if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, encpfindspec_prm0) == 0 ) {
			break
		}
		if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, encpfindspec_prm0) == encpfindspec_prm1 ) {
			encpfindspec_prm2(0) = cnt
			encpfindspec_prm2(1) = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, encpfindspec_prm0)
			locvar_txtgod_f = 1
			break
		}
	loop
	return locvar_txtgod_f

#defcfunc loadedammo int loadedammo_prm0, int loadedammo_prm1
	locvar_txtgod_f = 0
	if ( inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), loadedammo_prm0) != (-1) ) {
		if ( inv(STARTING_INV_ITEM_ENCHANT + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), loadedammo_prm0) * 2, loadedammo_prm0) \ 10000 == loadedammo_prm1 ) {
			locvar_txtgod_f = 1
		}
	}
	return locvar_txtgod_f

#defcfunc encpassivecheck int encpassivecheck_prm0
	if ( encpassivecheck_prm0 == 22 | encpassivecheck_prm0 == 23 | encpassivecheck_prm0 == 24 | encpassivecheck_prm0 == 25 | encpassivecheck_prm0 == 26 | encpassivecheck_prm0 == 27 | encpassivecheck_prm0 == 28 | encpassivecheck_prm0 == 32 | encpassivecheck_prm0 == 33 | encpassivecheck_prm0 == 48 | encpassivecheck_prm0 == 56 | encpassivecheck_prm0 == 59 ) {
		return 1
	}
	locvar_txtgod_rp = encpassivecheck_prm0 / 10000
	if ( locvar_txtgod_rp == 6 ) {
		return 1
	}
	return 0

#defcfunc calcattackskil int calcattackskil_prm0, int calcattackskil_prm1
	locvar_txtgod_f = double(calcattackskil_prm0)
	if ( iLevel(calcattackskil_prm1) != 0 ) {
		if ( iLevel(calcattackskil_prm1) > 0 ) {
			locvar_txtgod_f *= 1.0 + double(iLevel(calcattackskil_prm1)) / 2.0
		}
		else {
			locvar_txtgod_f /= 1.0 + double(abs(iLevel(calcattackskil_prm1))) / 2.0
		}
	}
	return locvar_txtgod_f / 5

#defcfunc badstatuscheck int badstatuscheck_prm0
	locvar_txtgod_f = 0
	repeat 12
		if ( cdata(250 + cnt, badstatuscheck_prm0) != 0 ) {
			locvar_txtgod_f = 1
			break
		}
	loop
	return locvar_txtgod_f

#defcfunc itemsnd int itemsnd_prm0
	if ( iID(itemsnd_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		if ( iCItemIdx(itemsnd_prm0) > useritemmax ) {
			if ( jp ) {
				buf += "\n\n非公式バージョンです。バグ報告はDiscordまでお願いします。"
			}
			else {
				buf += "\n\nIt is an unofficial version. Please report an issue to Discord."
			}
		}
		locvar_txtgod_s = exedir + "sound\\" + useritemdatan(7, iCItemIdx(itemsnd_prm0)) + ".wav"
		if ( locvar_txtgod_s != "" ) {
			exist locvar_txtgod_s
			if ( strsize != (-1) ) {
				usersnd locvar_txtgod_s
				return 1
			}
		}
	}
	locvar_txtgod_p = -1
	locvar_txtgod__switch_val = iID(itemsnd_prm0)
	if ( locvar_txtgod__switch_val == 231 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_p = 122
		goto *label_4864
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 674 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 496 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_p = 123
		goto *label_4864
	}

*label_4864
	if ( locvar_txtgod_p == (-1) ) {
		locvar_txtgod_attackskill = iSkillRef(itemsnd_prm0)
		locvar_txtgod__switch_val = locvar_txtgod_attackskill
		if ( locvar_txtgod__switch_val == 100 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 124
			goto *label_4865
			locvar_txtgod__switch_sw++
		}
		if ( locvar_txtgod__switch_val == 101 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 125
			goto *label_4865
			locvar_txtgod__switch_sw++
		}
		if ( locvar_txtgod__switch_val == 102 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 126
			goto *label_4865
			locvar_txtgod__switch_sw++
		}
		if ( locvar_txtgod__switch_val == 103 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 127
			goto *label_4865
			locvar_txtgod__switch_sw++
		}
		if ( locvar_txtgod__switch_val == 104 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 128
			goto *label_4865
			locvar_txtgod__switch_sw++
		}
		if ( locvar_txtgod__switch_val == 105 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 129
			goto *label_4865
			locvar_txtgod__switch_sw++
		}
		if ( locvar_txtgod__switch_val == 107 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 130
			goto *label_4865
			locvar_txtgod__switch_sw++
		}
		if ( locvar_txtgod__switch_val == 109 | locvar_txtgod__switch_sw ) {
			locvar_txtgod__switch_sw = 0
			locvar_txtgod_p = 131
			goto *label_4865
		}
	}

*label_4865
	if ( locvar_txtgod_p != (-1) ) {
		if ( soundfile(locvar_txtgod_p) != "" ) {
			snd locvar_txtgod_p
			return 1
		}
	}
	return 0

#defcfunc actupgradelistcheck int actupgradelistcheck_prm0, int actupgradelistcheck_prm1
	locvar_txtgod_f = 0
	repeat listmax
		if ( list(0, cnt) == actupgradelistcheck_prm0 & list(1, cnt) == actupgradelistcheck_prm1 ) {
			locvar_txtgod_f = 1
			break
		}
	loop
	return locvar_txtgod_f

#defcfunc day_trading int day_trading_prm0
	if ( inv_getfreeid(-1) == (-1) | finditemid("wuqing") == 0 ) {
		return 0
	}
	mode = MODELIST_SHOP
	inititemid = finditemid("wuqing")
	itemcreate -1, ITEM_ID_CARNEADES_PLANK, -1, -1, 0
	locvar_txtgod_ti = ci
	if ( inv_getspace(day_trading_prm0) ) {
		locvar_txtgod_rate = calcitemvalue(locvar_txtgod_ti, 0)
		if ( locvar_txtgod_rate < 1500 ) {
			inititemid = finditemid("wuqing")
			itemcreate day_trading_prm0, ITEM_ID_CARNEADES_PLANK, -1, -1, 0
			if ( stat ) {
				iParam2(ci) = locvar_txtgod_rate
				iNum(ci) = limit(cGold(day_trading_prm0) / locvar_txtgod_rate, 0, 5 * (100 + sInvest(day_trading_prm0) * 2) / 100 + 1)
				cGold(day_trading_prm0) -= iNum(ci) * locvar_txtgod_rate
				skillexp2 SKILL_NORMAL_INVESTING, day_trading_prm0, 120
			}
		}
	}
	locvar_txtgod_rate = calcitemvalue(locvar_txtgod_ti, 1)
	inv_getheader day_trading_prm0
	locvar_txtgod_income = 0
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		if ( iID(cnt) != ITEM_ID_CARNEADES_PLANK ) {
			continue
		}
		if ( equalsitem(cnt, "wuqing") ) {
			if ( iParam2(cnt) < locvar_txtgod_rate ) {
				locvar_txtgod_income += locvar_txtgod_rate * iNum(cnt)
				iNum(cnt) = 0
				skillexp2 SKILL_NORMAL_INVESTING, day_trading_prm0, 120
			}
		}
	loop
	iNum(locvar_txtgod_ti) = 0
	mode = MODELIST_MAIN
	return locvar_txtgod_income

#defcfunc convert_var str convert_var_prm0, int convert_var_prm1, int convert_var_prm2, int convert_var_prm3
	locvar_txtbuilding_s = convert_var_prm0
	repeat 5
		sreplace locvar_txtbuilding_s, locvar_txtbuilding_s, "{efp}", "" + convert_var_prm1
		sreplace locvar_txtbuilding_s, locvar_txtbuilding_s, "{attb}", "" + convert_var_prm2
		sreplace locvar_txtbuilding_s, locvar_txtbuilding_s, "{faith}", "" + convert_var_prm3
	loop
	return int(jseval(locvar_txtbuilding_s))

#defcfunc elemeteor int elemeteor_prm0
	if ( elemeteor_prm0 == 50 ) {
		return lang("隕石", "meteorites")
	}
	if ( elemeteor_prm0 == 51 ) {
		return lang("氷塊", "ice shards")
	}
	if ( elemeteor_prm0 == 52 ) {
		return lang("帯電した隕鉄", "electrified meteorites")
	}
	if ( elemeteor_prm0 == 53 ) {
		return lang("暗黒物質", "dark matters")
	}
	if ( elemeteor_prm0 == 54 ) {
		return lang("狂気の塊", "mass insanity")
	}
	if ( elemeteor_prm0 == 55 ) {
		return lang("毒の隕石", "poisonous meteorite")
	}
	if ( elemeteor_prm0 == 56 ) {
		return lang("地獄の隕石", "nether meteorite")
	}
	if ( elemeteor_prm0 == 57 ) {
		return lang("轟音の隕石", "sound meteorite")
	}
	if ( elemeteor_prm0 == 58 ) {
		return lang("神経の隕石", "nerve meteorite")
	}
	if ( elemeteor_prm0 == 59 ) {
		return lang("混沌の隕石", "chaos meteorite")
	}
	if ( elemeteor_prm0 == 60 ) {
		return lang("魔力の塊", "crystals")
	}
	if ( elemeteor_prm0 == 70 ) {
		return lang("媚薬の塊", "love potion")
	}
	if ( elemeteor_prm0 == 71 ) {
		return lang("酒の塊", "Liquor")
	}
	return lang("何か", "objects")

#deffunc checkalter int checkalter_prm0
	locvar_txtgod_f = 0
	if ( iID(checkalter_prm0) == ITEM_ID_ALTAR | iID(checkalter_prm0) == ITEM_ID_CEREMONY_ALTAR ) {
		locvar_txtgod_f = 1
	}
	if ( iID(checkalter_prm0) == ITEM_ID_CARNEADES_PLANK ) {
		if ( iCItemIdx(checkalter_prm0) != locvar_txtgod_useritemmax ) {
			if ( useritemdata(14, iCItemIdx(checkalter_prm0)) == 60002 ) {
				locvar_txtgod_f = 1
			}
		}
	}
	if ( locvar_txtgod_f ) {
		if ( iParam3(checkalter_prm0) != 0 ) {
			getgodid checkalter_prm0
		}
	}
	return

#defcfunc calcuserspellfixcost int calcuserspellfixcost_prm0
	locvar_txtgod_fixcost = 0
	locvar_txtgod__switch_val = spellconditionlist(1, calcuserspellfixcost_prm0)
	if ( locvar_txtgod__switch_val == 1 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 20
		goto *label_4875
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 2 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 12 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 10
		goto *label_4875
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 3 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 30
		goto *label_4875
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 4 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 6 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 9 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 50
		goto *label_4875
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 5 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 7 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 10 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 11 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 40
		goto *label_4875
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 8 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 75
		goto *label_4875
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 13 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 60
		goto *label_4875
		locvar_txtgod__switch_sw++
	}
	if ( locvar_txtgod__switch_val == 14 | locvar_txtgod__switch_sw ) {
		locvar_txtgod__switch_sw = 0
		locvar_txtgod_fixcost = 45
		goto *label_4875
	}

*label_4875
	return locvar_txtgod_fixcost

#defcfunc topattackskill int topattackskill_prm0
	locvar_txtgod_id = 0
	locvar_txtgod_p = 0
	repeat 111 - 100, 100
		locvar_txtgod_i = sorgex(cnt, topattackskill_prm0)
		if ( locvar_txtgod_i == 0 ) {
			continue
		}
		if ( locvar_txtgod_i < locvar_txtgod_p ) {
			continue
		}
		locvar_txtgod_id = cnt
		locvar_txtgod_p = locvar_txtgod_i
	loop
	if ( locvar_txtgod_id != 105 ) {
		if ( locvar_txtgod_p < sorgex(172, topattackskill_prm0) ) {
			locvar_txtgod_id = 172
		}
	}
	return locvar_txtgod_id

#defcfunc refattackskill int refattackskill_prm0, int refattackskill_prm1
	locvar_txtgod_p = sdata(refattackskill_prm0, refattackskill_prm1)
	if ( refattackskill_prm0 != 106 ) {
		if ( cAttackStyle(refattackskill_prm1) & 2 ) {
			if ( gettrait(refattackskill_prm1, 68) ) {
				locvar_txtgod_p += int(calc5traitmulti(stat, sMartial(refattackskill_prm1)))
			}
		}
	}
	return locvar_txtgod_p

#deffunc lockson int lockson_prm0, int lockson_prm1, int lockson_prm2
	if ( lockson_prm1 < 0 ) {
		return 0
	}
	if ( lockson_prm0 == 0 ) {
		if ( ocHostileTargetTotal(0) != 0 ) {
			return 0
		}
		ocHostileTarget1(0) = lockson_prm1 + 1
		ocHostileTargetTotal(0) = 1
		return 1
	}
	if ( ocHostileTargetTotal(lockson_prm0) == 5 ) {
		return 0
	}
	locvar_txtgod_f = 0
	locvar_txtgod_p = lockson_prm1 + 1
	repeat ocHostileTargetTotal(lockson_prm0)
		if ( ocdata(150 + cnt, lockson_prm0) == locvar_txtgod_p ) {
			locvar_txtgod_found = 1
			break
		}
	loop
	if ( locvar_txtgod_f ) {
		return 0
	}
	ocdata(150 + ocHostileTargetTotal(lockson_prm0), lockson_prm0) = locvar_txtgod_p
	ocHostileTargetTotal(lockson_prm0)++
	return 1

#deffunc unlockson int unlockson_prm0
	repeat ocHostileTargetTotal(unlockson_prm0)
		ocdata(150 + cnt, unlockson_prm0) = 0
	loop
	ocHostileTargetTotal(unlockson_prm0) = 0
	return 1

#deffunc unlockon int unlockon_prm0, int unlockon_prm1
	if ( ocHostileTargetTotal(unlockon_prm0) == 0 ) {
		return 0
	}
	if ( unlockon_prm0 == 0 ) {
		if ( ocHostileTarget1(0) - 1 != unlockon_prm1 ) {
			return 0
		}
		ocHostileTarget1(0) = 0
		ocHostileTargetTotal(0) = 0
		return 1
	}
	locvar_txtgod_p = unlockon_prm1 + 1
	locvar_txtgod_f = 1
	repeat ocHostileTargetTotal(unlockon_prm0)
		if ( ocdata(150 + cnt, unlockon_prm0) == locvar_txtgod_p ) {
			ocdata(150 + cnt, unlockon_prm0) = 0
			ocHostileTargetTotal(unlockon_prm0)--
			locvar_txtgod_f = 0
			break
		}
	loop
	if ( locvar_txtgod_f ) {
		return 0
	}
	repeat 4
		if ( ocdata(150 + cnt, unlockon_prm0) == 0 ) {
			if ( ocdata(151 + cnt, unlockon_prm0) != 0 ) {
				ocdata(150 + cnt, unlockon_prm0) = ocdata(151 + cnt, unlockon_prm0)
				ocdata(151 + cnt, unlockon_prm0) = 0
			}
		}
	loop
	if ( ocHostileTargetTotal(unlockon_prm0) == 0 ) {
		cAiAggro(unlockon_prm0) = 0
	}
	return 1

#deffunc lockon int lockon_prm0, int lockon_prm1, int lockon_prm2
	unlockson lockon_prm0
	lockson lockon_prm0, lockon_prm1, 15
	return 1

#deffunc locksorder int locksorder_prm0
	repeat 5
		if ( ocdata(150 + cnt, locksorder_prm0) == 0 ) {
			break
		}
		locvar_txtgod_p = ocdata(150 + cnt, locksorder_prm0) - 1
		if ( cExist(locvar_txtgod_p) != CHAR_STATE_ALIVE ) {
			unlockon locksorder_prm0, locvar_txtgod_p
		}
	loop
	if ( ocHostileTargetTotal(locksorder_prm0) == 0 ) {
		return 0
	}
	repeat ocHostileTargetTotal(locksorder_prm0)
		locvar_txtgod_i = cnt
		locvar_txtgod_j = ocHostileTargetTotal(locksorder_prm0) - 1
		repeat
			if ( locvar_txtgod_j == locvar_txtgod_i ) {
				break
			}
			locvar_txtgod_p = ocdata(150 + locvar_txtgod_j, locksorder_prm0) - 1, ocdata(150 + locvar_txtgod_j - 1, locksorder_prm0) - 1
			if ( dist(cX(locksorder_prm0), cY(locksorder_prm0), cX(locvar_txtgod_p), cY(locvar_txtgod_p)) < dist(cX(locksorder_prm0), cY(locksorder_prm0), cX(locvar_txtgod_p(1)), cY(locvar_txtgod_p(1))) ) {
				locvar_txtgod_p = ocdata(150 + locvar_txtgod_j, locksorder_prm0)
				ocdata(150 + locvar_txtgod_j, locksorder_prm0) = ocdata(150 + locvar_txtgod_j - 1, locksorder_prm0)
				ocdata(150 + locvar_txtgod_j - 1, locksorder_prm0) = locvar_txtgod_p
			}
			locvar_txtgod_j--
		loop
	loop
	return 1

#deffunc watcheson int watcheson_prm0, int watcheson_prm1
	if ( watcheson_prm1 < 0 ) {
		return 0
	}
	if ( watcheson_prm0 == 0 ) {
		if ( ocWantCooperateTargetTotal(0) != 0 ) {
			return 0
		}
		ocWantCooperateTarget1(0) = watcheson_prm1 + 1
		ocWantCooperateTargetTotal(0) = 1
		return 1
	}
	if ( ocWantCooperateTargetTotal(watcheson_prm0) == 5 ) {
		return 0
	}
	locvar_txtgod_f = 0
	locvar_txtgod_p = watcheson_prm1 + 1
	repeat ocWantCooperateTargetTotal(watcheson_prm0)
		if ( ocdata(156 + cnt, watcheson_prm0) == locvar_txtgod_p ) {
			locvar_txtgod_found = 1
			break
		}
	loop
	if ( locvar_txtgod_f ) {
		return 0
	}
	ocdata(156 + ocWantCooperateTargetTotal(watcheson_prm0), watcheson_prm0) = locvar_txtgod_p
	ocWantCooperateTargetTotal(watcheson_prm0)++
	return 1

#deffunc unwatcheson int unwatcheson_prm0
	repeat ocWantCooperateTargetTotal(unwatcheson_prm0)
		ocdata(156 + cnt, unwatcheson_prm0) = 0
	loop
	ocWantCooperateTargetTotal(unwatcheson_prm0) = 0
	return 1

#deffunc unwatchon int unwatchon_prm0, int unwatchon_prm1
	if ( ocWantCooperateTargetTotal(unwatchon_prm0) == 0 ) {
		return 0
	}
	if ( unwatchon_prm0 == 0 ) {
		if ( ocWantCooperateTarget1(0) - 1 != unwatchon_prm1 ) {
			return 0
		}
		ocWantCooperateTarget1(0) = 0
		ocWantCooperateTargetTotal(0) = 0
		return 1
	}
	locvar_txtgod_p = unwatchon_prm1 + 1
	locvar_txtgod_f = 1
	repeat ocWantCooperateTargetTotal(unwatchon_prm0)
		if ( ocdata(156 + cnt, unwatchon_prm0) == locvar_txtgod_p ) {
			ocdata(156 + cnt, unwatchon_prm0) = 0
			ocWantCooperateTargetTotal(unwatchon_prm0)--
			locvar_txtgod_f = 0
			break
		}
	loop
	if ( locvar_txtgod_f ) {
		return 0
	}
	repeat 4
		if ( ocdata(156 + cnt, unwatchon_prm0) == 0 ) {
			if ( ocdata(157 + cnt, unwatchon_prm0) != 0 ) {
				ocdata(156 + cnt, unwatchon_prm0) = ocdata(157 + cnt, unwatchon_prm0)
				ocdata(157 + cnt, unwatchon_prm0) = 0
			}
		}
	loop
	if ( ocWantCooperateTargetTotal(unwatchon_prm0) == 0 ) {
		cAiAggro(unwatchon_prm0) = 0
	}
	return 1

#deffunc watchesorder int watchesorder_prm0
	repeat 5
		if ( ocdata(156 + cnt, watchesorder_prm0) == 0 ) {
			break
		}
		locvar_txtgod_p = ocdata(156 + cnt, watchesorder_prm0) - 1
		if ( cExist(locvar_txtgod_p) != CHAR_STATE_ALIVE ) {
			unwatchon watchesorder_prm0, locvar_txtgod_p
		}
	loop
	if ( ocWantCooperateTargetTotal(watchesorder_prm0) == 0 ) {
		return 0
	}
	repeat ocWantCooperateTargetTotal(watchesorder_prm0)
		locvar_txtgod_i = cnt
		locvar_txtgod_j = ocWantCooperateTargetTotal(watchesorder_prm0) - 1
		repeat
			if ( locvar_txtgod_j == locvar_txtgod_i ) {
				break
			}
			locvar_txtgod_p = ocdata(156 + locvar_txtgod_j, watchesorder_prm0) - 1, ocdata(156 + locvar_txtgod_j - 1, watchesorder_prm0) - 1
			if ( dist(cX(watchesorder_prm0), cY(watchesorder_prm0), cX(locvar_txtgod_p), cY(locvar_txtgod_p)) < dist(cX(watchesorder_prm0), cY(watchesorder_prm0), cX(locvar_txtgod_p(1)), cY(locvar_txtgod_p(1))) ) {
				locvar_txtgod_p = ocdata(156 + locvar_txtgod_j, watchesorder_prm0)
				ocdata(156 + locvar_txtgod_j, watchesorder_prm0) = ocdata(156 + locvar_txtgod_j - 1, watchesorder_prm0)
				ocdata(156 + locvar_txtgod_j - 1, watchesorder_prm0) = locvar_txtgod_p
			}
			locvar_txtgod_j--
		loop
	loop
	return 1

#deffunc sortskilltrack
	dim tmp_sort
	tmp_sort_count = 0
	repeat 20
		if ( gdatac(750 + cnt) != 0 ) {
			tmp_sort(tmp_sort_count) = gdatac(750 + cnt)
			tmp_sort_count++
		}
	loop
	sortval tmp_sort, 0
	repeat 20
		gdatac(750 + cnt) = 0
	loop
	repeat length(tmp_sort)
		gdatac(750 + cnt) = tmp_sort(cnt)
	loop
	return

#deffunc item_autostack int item_autostack_prm0, int item_autostack_prm1, int item_autostack_prm2
	if ( item_autostack_prm2 == 1 ) {
		if ( item_autostack_prm1 >= 5080 ) {
			item_stack -1, item_autostack_prm1, 0
		}
		else {
			item_stack item_autostack_prm0, item_autostack_prm1, 0
		}
	}
	else {
		if ( item_autostack_prm1 >= 5080 ) {
			item_stack -1, item_autostack_prm1, item_autostack_prm0 == 0
		}
		else {
			item_stack item_autostack_prm0, item_autostack_prm1, item_autostack_prm0 == 0
		}
	}
	return

#deffunc bmes2 str bmes2_prm0, int bmes2_prm1
	locvar_bmes_pos_x = ginfo(22)
	locvar_bmes_pos_y = ginfo(23)
	color oom_color(3, bmes2_prm1), oom_color(4, bmes2_prm1), oom_color(5, bmes2_prm1)
	if ( cfg_fontstyle == 0 ) {
		repeat 3
			locvar_bmes_mes_y = cnt + locvar_bmes_pos_y - 1
			repeat 3
				pos locvar_bmes_pos_x - 1 + cnt, locvar_bmes_mes_y
				mes bmes2_prm0
			loop
		loop
	}
	else {
		pos locvar_bmes_pos_x - 1, locvar_bmes_pos_y
		mes bmes2_prm0
		pos locvar_bmes_pos_x + 1, locvar_bmes_pos_y
		mes bmes2_prm0
		pos locvar_bmes_pos_x, locvar_bmes_pos_y - 1
		mes bmes2_prm0
		pos locvar_bmes_pos_x, locvar_bmes_pos_y + 1
		mes bmes2_prm0
	}
	color oom_color(0, bmes2_prm1), oom_color(1, bmes2_prm1), oom_color(2, bmes2_prm1)
	pos locvar_bmes_pos_x, locvar_bmes_pos_y
	mes bmes2_prm0
	return

#deffunc ccolor int ccolor_prm0
	exist exedir + "user\\ccolor.txt"
	if ( strsize != (-1) ) {
		notesel buff_color
		noteload exedir + "user\\ccolor.txt"
	}
	else {
		return 0
	}
	_switch_val = ccolor_prm0
	oom_tmpcolor = 255, 255, 255, 0, 0, 0
	if ( _switch_val == 100 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coladdhex"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 101 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coladdelem" + locvar_colorres_i
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 102 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coladdbuff"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 103 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldelhex"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 104 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldelbuff"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 105 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colallelemdmg"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 106 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colstrmiss"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 107 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colstrevade"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 108 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgnormal"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 109 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colelemdmg" + locvar_colorres_i
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 110 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealdmg"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 111 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colalldmg"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 112 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldelelem" + locvar_colorres_i
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 201 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconblind"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 202 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconconfuse"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 203 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconparalyze"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 204 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconpoison"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 205 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconsleep"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 206 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconfear"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 207 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgcondim"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 208 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconbleed"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 209 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgcondrunk"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 210 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconinsane"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 211 | _switch_sw ) {
		_switch_sw = 0
		sline = "%coldmgconsick"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 301 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconblind"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 302 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconconfuse"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 303 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconparalyze"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 304 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconpoison"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 305 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconsleep"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 306 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconfear"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 307 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealcondim"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 308 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconbleed"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 309 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealcondrunk"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 310 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconinsane"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 311 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colhealconsick"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 401 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colskilltrack"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 402 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colmagictrack"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 403 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colmagictrack2"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 404 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colpetskilltrack"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 405 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colfukidashidefault"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 406 | _switch_sw ) {
		_switch_sw = 0
		sline = "%colfukidashi" + cnName(oom_talkchara)
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 1000 | _switch_sw ) {
		_switch_sw = 0
		sline = "%ffontdefault"
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 1001 | _switch_sw ) {
		_switch_sw = 0
		sline = "%ffont" + cnName(oom_talkchara)
		goto *label_4911
		_switch_sw++
	}
	if ( _switch_val == 1200 | _switch_sw ) {
		_switch_sw = 0
		sline = "%ffontpos" + cnName(oom_talkchara)
		goto *label_4911
		_switch_sw++
	}
	return 0

*label_4911
	hajime_color = instr(buff_color, 0, sline + "," + lang("JP", "EN"))
	if ( hajime_color != (-1) ) {
		buff_color = strmid(buff_color, hajime_color, instr(buff_color, hajime_color + 1, "%"))
		notedel 0
		if ( noteinfo(0) > 0 ) {
			if ( buff_color != "" & buff_color != "default" ) {
				if ( ccolor_prm0 < 1000 ) {
					split buff_color, ",", oom_tmpcolorn
					if ( stat == 6 ) {
						repeat 6
							oom_tmpcolor(cnt) = limit(int(oom_tmpcolorn(cnt)), 0, 255)
							if ( ccolor_prm0 < 400 ) {
								mondmg(2 + cnt, mondmgcnt) = oom_tmpcolor(cnt)
							}
						loop
						return 1
					}
				}
				else {
					if ( ccolor_prm0 < 1200 ) {
						sdim oom_tmpfont, 10, 3
						split buff_color, ",", oom_tmpfont
						if ( stat == 3 ) {
							font oom_tmpfont(0), int(oom_tmpfont(1)), int(oom_tmpfont(2))
							if ( stat == 0 ) {
								return 1
							}
						}
					}
					else {
						split buff_color, ",", oom_tmppoppos
						if ( stat == 2 ) {
							txtpopup(4, txtpopupcnt) = int(oom_tmppoppos(0)), int(oom_tmppoppos(1))
							return 1
						}
					}
				}
			}
		}
	}
	return 0

#deffunc setconfig
	i = 0
	p = 0
	repeat
		p(2) = instr(s, p, "\"")
		if ( p(2) == (-1) ) {
			break
		}
		p += p(2)
		p(1) = instr(s, p + 1, "\"")
		if ( p(1) == (-1) ) {
			break
		}
		rtvaln(i) = strmid(s, p + 1, p(1))
		p += strlen(rtvaln(i)) + 2
		i++
	loop
	return

*label_4915
	list(0, 0) = 0, 0
	listmax = 0
	if ( auto_equip == 0 ) {
		list(0, listmax) = -enccategory(encselect), 0
		listmax++
		if ( enccategory(encselect) == 10000 | enccategory(encselect) == 60000 ) {
			repeat 18, 2
				if ( skillname(cnt) == "" ) {
					continue
				}
				list(0, listmax) = cnt, skillUse(cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if ( enccategory(encselect) == 20000 | enccategory(encselect) == 70000 ) {
			repeat 11, 50
				list(0, listmax) = cnt, skillUse(cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if ( enccategory(encselect) == 30000 ) {
			repeat 40, 150
				if ( skillname(cnt) == "" ) {
					continue
				}
				list(0, listmax) = cnt, skillUse(cnt) + enccategory(encselect)
				listmax++
			loop
			repeat 2, 300
				if ( skillname(cnt) == "" ) {
					continue
				}
				list(0, listmax) = cnt, skillUse(cnt) + enccategory(encselect)
				listmax++
			loop
			repeat 12, 100
				if ( skillname(cnt) == "" ) {
					continue
				}
				list(0, listmax) = cnt, skillUse(cnt) + enccategory(encselect) + 1000
				listmax++
			loop
		}
		if ( enccategory(encselect) == 80000 ) {
			repeat 30
				list(0, listmax) = cnt + 1, encprocref(ENCPROCREF_SKILL_ID, cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if ( enccategory(encselect) == 90000 ) {
			repeat 6
				list(0, listmax) = cnt + 1, skillUse(cnt) + enccategory(encselect)
				listmax++
			loop
		}
		if ( enccategory(encselect) == 100000 ) {
			repeat 43
				list(0, listmax) = encetc(cnt), skillUse(cnt) + enccategory(encselect)
				listmax++
			loop
		}
	}
	else {
		repeat 40, 150
			if ( skillname(cnt) == "" ) {
				continue
			}
			list(0, listmax) = cnt, skillUse(cnt) + 30000
			listmax++
		loop
		repeat 2, 300
			if ( skillname(cnt) == "" ) {
				continue
			}
			list(0, listmax) = cnt, skillUse(cnt) + 30000
			listmax++
		loop
	}
	gosub *sort_list
	page = 0
	cs = 0
	if ( equipfilter != 0 ) {
		repeat listmax
			if ( list(0, cnt) == equipfilter \ enccategory(encselect) ) {
				page = cnt / 16
				cs = cnt \ 16
			}
		loop
	}
	cs_bk = -1

*label_4927
	redraw 0
	pagesize = 16
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	if ( auto_equip == 0 ) {
		s = enccategoryn(encselect)
		if ( equipfilterpower != 0 ) {
			s = s + " - " + equipfilterpower
		}
		if ( oom_inheritance_search ) {
			s += lang(" - 継承on", " - only inherited")
		}
		if ( oomsest_livingweapon_search ) {
			s += lang(" - 生き武器on", " - only alive")
		}
	}
	else {
		s = lang("自動装備対象エンチャント", "Auto-equip enchantments")
	}
	s(1) = strhint2 + strhint3
	if ( auto_equip == 0 ) {
		s(1) += "\n" + oom_strhint3 + oom_strhint4 + "\n" + oom_strhint8
	}
	display_window (windoww - 400) / 2 + inf_screenx, winposy(432), 400, 432, , , 1
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70 - 30, wy + 60 + cnt * 19
			gfini 400 - 80, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		p = list(0, p)
		if ( auto_equip == 0 ) {
			if ( p == -enccategory(encselect) ) {
				s = enccategoryn(encselect)
			}
			else {
				if ( enccategory(encselect) < 80000 ) {
					s = skillname(p)
				}
				else {
					if ( enccategory(encselect) == 80000 ) {
						s = skillname(encprocref(ENCPROCREF_SKILL_ID, p - 1))
					}
					else {
						if ( enccategory(encselect) == 90000 ) {
							s = ammoname(p - 1)
						}
						else {
							s = strmid(encetcn(0, p - 21), 0, 42)
						}
					}
				}
			}
		}
		else {
			if ( p == 0 ) {
				s = ""
			}
			else {
				s = skillname(p)
			}
		}
		display_key wx + 28, wy + 60 + cnt * 19 - 2, cnt
		cs_list s, wx + 54, wy + 60 + cnt * 19 - 1, 19, 0, 0, p
	loop
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			value = pagesize * page + cnt
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		snd SOUNDLIST_POP2
		if ( p < 0 ) {
			showresist = 1
			showressub = 2
			return p
		}
		else {
			return p + enccategory(encselect) \ 100000
		}
	}
	if ( key == key_cancel ) {
		snd SOUNDLIST_POP2
		return 0
	}
	if ( auto_equip != 1 ) {
		if ( key == key_next ) {
			snd SOUNDLIST_POP1
			encselect++
			if ( encselect > 7 ) {
				encselect = 0
			}
			goto *label_4915
		}
		if ( key == key_prev ) {
			snd SOUNDLIST_POP1
			encselect--
			if ( encselect < 0 ) {
				encselect = 7
			}
			goto *label_4915
		}
		if ( key == key_southeast ) {
			snd SOUNDLIST_POP1
			equipfilterpower += 100
			if ( equipfilterpower > 500 ) {
				equipfilterpower = 0
			}
			goto *label_4927
		}
		if ( key == key_southwest ) {
			snd SOUNDLIST_POP1
			equipfilterpower -= 100
			if ( equipfilterpower < 0 ) {
				equipfilterpower = 500
			}
			goto *label_4927
		}
		if ( key == key_mode2 ) {
			snd SOUNDLIST_POP1
			oom_inheritance_search = 1 - oom_inheritance_search
			goto *label_4927
		}
		if ( key == key_msglog ) {
			snd SOUNDLIST_POP1
			oomsest_livingweapon_search = 1 - oomsest_livingweapon_search
			goto *label_4927
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4927
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4927
		}
	}
	goto *label_4927
	return

*label_4931
	gosub *prompt_direction
	if ( mapFeat(x, y) != 0 ) {
		oom_gdata_19 = mapFeat(x, y) \ 1000
		oom_gdata_20 = mapFeat(x, y) / 100000 \ 100 + mapFeat(x, y) / 10000000 * 100
		gosub *label_4933
		gosub *screen_draw
	}
	else {
		txt -1, lang("それは無理だ。", "It's impossible.")
		gosub *screen_draw
		return
	}
	return

*label_4933
	snd SOUNDLIST_POP2
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	windowshadow = 1
	listmax = 0
	if ( jp ) {
		s = "外観　", "色　　"
	}
	if ( en ) {
		s = "----", "----"
	}
	p = 2
	repeat p
		list(0, cnt) = cnt
		listn(0, cnt) = s(cnt)
		listmax++
	loop
	keyrange = 0
	repeat p
		p = cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_enter
		keyrange++
	loop

*label_4936
	redraw 0
	pagesize = 0
	s = lang("外観の変更", "Parts to hide"), lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]", "Right,left [Change]  Shift,Esc [Close]")
	display_window (windoww - 360) / 2 + inf_screenx, winposy(289) - 12, 360, 289
	s = lang("項目", "Part")
	pagesize = listmax
	display_topic s, wx + 34, wy + 36
	i++
	if ( i \ 100 < 45 ) {
		f = i \ 16
	}
	else {
		f++
	}
	window2 wx + 234, wy + 60, 96, 96, 1, 1
	mapchip_preparepic x, y
	pos wx + 234 + 24, wy + 60 + 24
	gmode 2, 32, 48
	gcopy 96, 0, 240, 48, 48
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = cnt
		if ( p >= listmax ) {
			break
		}
		s = listn(0, p)
		if ( p == 0 ) {
			s += adata(31, oom_gdata_20)
		}
		else {
			s += adata(32, oom_gdata_20)
		}
		pos wx + 30, wy + 66 + cnt * 21 - 5
		gcopy BUFFER_INF, 312, 336, 24, 24
		pos wx + 175, wy + 66 + cnt * 21 - 5
		gcopy BUFFER_INF, 336, 336, 24, 24
		cs_list s, wx + 60, wy + 66 + cnt * 21 - 1, 19, 0
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	if ( key == key_pageup ) {
		snd SOUNDLIST_CURSOR1
		if ( cs == 0 ) {
			if ( adata(31, oom_gdata_20) < 50 ) {
				adata(31, oom_gdata_20)++
			}
		}
		else {
			if ( adata(32, oom_gdata_20) < 21 ) {
				adata(32, oom_gdata_20)++
			}
		}
	}
	if ( key == key_pagedown ) {
		snd SOUNDLIST_CURSOR1
		if ( cs == 0 ) {
			if ( adata(31, oom_gdata_20) > 0 ) {
				adata(31, oom_gdata_20)--
			}
		}
		else {
			if ( adata(32, oom_gdata_20) > 0 ) {
				adata(32, oom_gdata_20)--
			}
		}
	}
	if ( key == key_enter | key == key_cancel ) {
		snd SOUNDLIST_OK1
		return 1
	}
	goto *label_4936

*label_4938
	page = 0
	pagesize = 16
	listmax = 32
	cs = prev_es_cs \ 100
	page = prev_es_cs / 100
	cs_bk = -1
	cc = CHARA_PLAYER
	mainweapon = -1
	countequip = 0
	showmoney = 0
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_inv.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1
	returnfromidentify = 0

*label_4939
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4940
	redraw 0
	if ( invctrl == 101 ) {
		s = lang("装備の保存", "Save equips"), strhint3 + oom_strhint6
	}
	if ( invctrl == 102 ) {
		s = lang("装備の読み込み", "Load equips"), strhint3 + oom_strhint5
	}
	display_window (windoww - 640) / 2 + inf_screenx, winposy(432), 640, 432
	display_topic lang("スロットの名前", "Name"), wx + 28, wy + 30
	pos wx + ww - 136, wy - 6
	gcopy BUFFER_INF, 960, 96, 144, 48
	pos wx + ww - 246, wy - 6
	gcopy BUFFER_INF, 1008, 144, 48, 72
	pos wx - 6, wy - 6
	gcopy BUFFER_INF, 960, 216, 48, 72
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		s = ""
		if ( p < 10 ) {
			s += "0"
		}
		s += "" + p + ":" + varesname(p)
		display_key wx + 28, wy + 60 + cnt * 19 - 2, cnt
		cs_list s, wx + 54, wy + 60 + cnt * 19 - 1, 19
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	prev_es_cs = page * 100 + cs
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = pagesize * page + cnt
			break
		}
	loop
	if ( p != (-1) ) {
		slot_no = p
		cc = CHARA_PLAYER
		if ( invctrl == 101 ) {
			txtef COLOR_DEFAULT
			txt_select -1, lang("スロットに名前を付ける事ができる。", "What do you call this equipment suite? "), "", "", "", "", "", "", "", ""
			locvar_randskill_tcol = 255, 255, 255
			val = (windoww - 540) / 2 + inf_screenx, winposy(90), 30, 1, 0
			inputlog = varesname(slot_no)
			gosub *prompt_word
			if ( ime_esc == 1 ) {
				txtef COLOR_DEFAULT
				txt_select -1, lang("やっぱり保存するのをやめた。", "You changed your mind."), "", "", "", "", "", "", "", ""
				locvar_randskill_tcol = 255, 255, 255
			}
			else {
				varesname(slot_no) = inputlog
				repeat 30
					varequipsave(0, cnt, slot_no) = 0
					varequipsave(1, cnt, slot_no) = 0
					varequipsave(2, cnt, slot_no) = 0
					varequipsave(3, cnt, slot_no) = 0
					if ( cdata(cnt + 100, cc) == 0 ) {
						continue
					}
					value = cdata(cnt + 100, cc) \ EXT_EQUIP_SLOTS - 1
					if ( value < 0 ) {
						continue
					}
					if ( iStatus(value) < ITEM_STATUS_NORMAL ) {
						continue
					}
					varequipsave(0, cnt, slot_no) = iID(value)
					varequipsave(1, cnt, slot_no) = iSubName(value)
					varequipsave(2, cnt, slot_no) = iMaterial(value)
					value2 = 0
					repeat 15
						encid = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, value)
						encpow = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, value)
						value2 += encid
						encid = encid / 10000
						if ( encid != 0 ) {
							if ( encid == 9 ) {
								value2 += encpow / 1000
							}
							else {
								value2 += encpow
							}
						}
					loop
					varequipsave(3, cnt, slot_no) = value2
				loop
				txtef COLOR_DEFAULT
				txt_select -1, lang("スロット" + slot_no + "に現在の装備を保存した。", "Current equipments is saved to the equipment suite No." + slot_no + "."), "", "", "", "", "", "", "", ""
				locvar_randskill_tcol = 255, 255, 255
			}
		}
		if ( invctrl == 102 ) {
			gosub *label_4948
		}
		return
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4939
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4939
		}
	}
	if ( invctrl == 102 & key == key_mode2 ) {
		snd SOUNDLIST_POP1
		invctrl = 101
		goto *label_4939
	}
	if ( invctrl == 101 & key == key_msglog ) {
		snd SOUNDLIST_POP1
		invctrl = 102
		goto *label_4939
	}
	if ( key == key_cancel ) {
		cc = CHARA_PLAYER
		efcancel = 1
		return
	}
	goto *label_4940

*label_4946
	repeat 30
		body = cnt + 100
		value = cdata(body, cc)
		if ( value == 0 ) {
			continue
		}
		value = value / 10000
		if ( gettrait(cc, 206) != 0 & value == 2 ) {
			continue
		}
		if ( gettrait(cc, 203) != 0 & value == 9 ) {
			continue
		}
		if ( gettrait(cc, 205) != 0 & value == 3 ) {
			continue
		}
		if ( gettrait(cc, 217) != 0 & value == 1 ) {
			continue
		}
		if ( gettrait(cc, 217) == (-2) & value == 8 ) {
			continue
		}
		if ( gettrait(cc, 218) != 0 & value == 5 ) {
			continue
		}
		ci = cdata(cnt + 100, cc) \ EXT_EQUIP_SLOTS - 1
		if ( ci >= 0 ) {
			if ( iStatus(ci) == ITEM_STATUS_CURSED | iStatus(ci) == ITEM_STATUS_DOOMED ) {
				txtef COLOR_DEFAULT
				txt_select -1, lang(itemname(ci) + "は外せない。", "" + itemname(ci) + " can't be taken off."), "", "", "", "", "", "", "", ""
				locvar_randskill_tcol = 255, 255, 255
				continue
			}
			r1 = cc
			gosub *label_3591
		}
	loop
	return

*label_4948
	repeat 30
		body = cnt + 100
		value = cdata(body, cc)
		if ( value == 0 ) {
			continue
		}
		value = value / 10000
		if ( gettrait(cc, 206) != 0 & value == 2 ) {
			continue
		}
		if ( gettrait(cc, 203) != 0 & value == 9 ) {
			continue
		}
		if ( gettrait(cc, 205) != 0 & value == 3 ) {
			continue
		}
		if ( gettrait(cc, 217) != 0 ) {
			if ( value == 1 ) {
				continue
			}
			if ( gettrait(cc, 217) == (-2) ) {
				if ( value == 8 ) {
					continue
				}
			}
		}
		if ( gettrait(cc, 218) != 0 & value == 5 ) {
			continue
		}
		ci = cdata(cnt + 100, cc) \ EXT_EQUIP_SLOTS - 1
		if ( ci >= 0 ) {
			if ( iStatus(ci) == ITEM_STATUS_CURSED | iStatus(ci) == ITEM_STATUS_DOOMED ) {
				txtef COLOR_DEFAULT
				txt_select -1, lang(itemname(ci) + "は外せない。", "" + itemname(ci) + " can't be taken off."), "", "", "", "", "", "", "", ""
				locvar_randskill_tcol = 255, 255, 255
				continue
			}
			r1 = cc
			gosub *label_3591
		}
		if ( varequipsave(0, cnt, slot_no) > 0 ) {
			invid = varequipsave(0, cnt, slot_no)
			invname = varequipsave(1, cnt, slot_no)
			invmate = varequipsave(2, cnt, slot_no)
			invencsum = varequipsave(3, cnt, slot_no)
			inv_getheader 0
			repeat invrange, invhead
				if ( iNum(cnt) != 1 ) {
					continue
				}
				if ( iID(cnt) != invid ) {
					continue
				}
				if ( iSubName(cnt) != invname ) {
					continue
				}
				if ( iMaterial(cnt) != invmate ) {
					continue
				}
				if ( iStatus(cnt) < ITEM_STATUS_NORMAL ) {
					continue
				}
				if ( funciscanequip(cnt, cdata(body, cc) / EXT_EQUIP_SLOTS, cc) == 0 ) {
					continue
				}
				value2 = 0
				value = cnt
				repeat 15
					encid = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, value)
					encpow = inv(STARTING_INV_ITEM_ENCHANT_POWER + cnt * 2, value)
					value2 += encid
					encid = encid / 10000
					if ( encid != 0 ) {
						if ( encid == 9 ) {
							value2 += encpow / 1000
						}
						else {
							value2 += encpow
						}
					}
				loop
				if ( value2 != invencsum ) {
					continue
				}
				if ( iEquip(cnt) != 0 ) {
					value = body
					r1 = cc
					body = iEquip(cnt)
					gosub *label_3591
					body = value
				}
				r1 = cc
				ci = cnt
				gosub *label_3590
				break
			loop
		}
	loop
	r1 = cc
	snd SOUNDLIST_EQUIP1
	gosub *charaRefresh
	gosub *show_weaponStat
	txtef COLOR_DEFAULT
	var_string1 = lang("スロット", "No.") + slot_no
	if ( varesname(slot_no) != "" ) {
		var_string1 += ":" + varesname(slot_no)
	}
	txt -1, lang("" + var_string1 + "の装備に変更した。", "You changed your equipments to the equipment suite " + var_string1 + ".")
	locvar_randskill_tcol = 255, 255, 255
	return
	list(0, 0) = 0, 0
	listmax = 1
	repeat 18, 2
		if ( skillname(cnt) == "" ) {
			continue
		}
		list(0, listmax) = cnt, skillUse(cnt) + 1000
		listmax++
	loop
	repeat 150, 150
		if ( skillname(cnt) == "" ) {
			continue
		}
		list(0, listmax) = cnt, skillUse(cnt) + 2000
		listmax++
	loop
	repeat 50, 100
		if ( skillname(cnt) == "" ) {
			continue
		}
		list(0, listmax) = cnt, skillUse(cnt) + 3000
		listmax++
	loop
	repeat 2, 300
		if ( skillname(cnt) == "" ) {
			continue
		}
		list(0, listmax) = cnt, skillUse(cnt) + 4000
		listmax++
	loop
	gosub *sort_list
	page = 0
	cs = 0
	if ( var_sort_type != 0 ) {
		value = abs(var_sort_type) \ 10000
		repeat listmax
			if ( list(0, cnt) == value ) {
				page = cnt / 16
				cs = cnt \ 16
			}
		loop
	}
	cs_bk = -1

*label_4957
	redraw 0
	pagesize = 16
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	s = lang("ソート対象の選択", "Skill Selection")
	s(1) = strhint2 + strhint3
	display_window (windoww - 320) / 2 + inf_screenx, winposy(432), 320, 432
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 60 + cnt * 19
			gfini 540 - 320, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		p = list(0, p)
		if ( p == 0 ) {
			s = "なし"
		}
		else {
			s = skillname(p)
			pos wx + 38, wy + 70 + cnt * 19
			gmode 2, inf_tiles, inf_tiles
			if ( p >= 2 & p <= 3 ) {
				p(1) = 10
			}
			else {
				if ( p <= 17 ) {
					p(1) = p - 10
				}
				else {
					if ( p <= 19 ) {
						p(1) = 10
					}
					else {
						p(1) = skillUse(p) - 10
					}
				}
			}
			grotate BUFFER_ITEM, p(1) * inf_tiles, 672, 0, inf_tiles, inf_tiles
		}
		display_key wx + 58, wy + 60 + cnt * 19 - 2, cnt
		cs_list s, wx + 84, wy + 60 + cnt * 19 - 1, 19, 0, 0, p
	loop
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			value = pagesize * page + cnt
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		snd SOUNDLIST_POP2
		if ( p == 0 ) {
			value = 0
		}
		if ( p >= 2 & p < 20 ) {
			value = 1 * 10000 + p
		}
		if ( p >= 100 & p < 300 ) {
			value = 3 * 10000 + p
		}
		if ( p >= 300 & p < 400 ) {
			value = 4 * 10000 + p
		}
		return value
	}
	if ( key == key_cancel ) {
		snd SOUNDLIST_FAIL1
		return -1
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4957
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4957
		}
	}
	goto *label_4957

#defcfunc funciscanequip int funciscanequip_prm0, int funciscanequip_prm1, int funciscanequip_prm2
	equiploc = iequiploc(funciscanequip_prm0, funciscanequip_prm1)
	if ( equiploc == funciscanequip_prm1 ) {
		return 1
	}
	if ( funciscanequip_prm1 == 5 & equiploc == 10 ) {
		if ( iSkillRef(funciscanequip_prm0) == SKILL_WEAPON_THROWING ) {
			if ( eqthrowcheck(funciscanequip_prm2) ) {
				return 0
			}
			else {
				return 1
			}
		}
		if ( iSkillRef(funciscanequip_prm0) == SKILL_WEAPON_CROSSBOW ) {
			return 1
		}
		if ( iSkillRef(funciscanequip_prm0) == SKILL_WEAPON_FIREARM ) {
			return 1
		}
	}
	return 0

#deffunc funcsaveequipsave str funcsaveequipsave_prm0
	version = 1
	value = 0
	bsave funcsaveequipsave_prm0, version, 4
	value += 4
	value2 = 32
	bsave funcsaveequipsave_prm0, value2, 4, value
	value += 4
	bsave funcsaveequipsave_prm0, varequipsave(0, 0, 0), 4 * 30 * 32 * 4, value
	value += 4 * 30 * 32 * 4
	value2 = 30
	bsave funcsaveequipsave_prm0, value2, 4, value
	value += 4
	sdim var_string1, value2, 1
	repeat 32
		memset var_string1, 0, value2, 0
		var_string1 = varesname(cnt)
		bsave funcsaveequipsave_prm0, var_string1, value2, value
		value += value2
	loop
	return

#deffunc funcloadequipsave str funcloadequipsave_prm0
	dim varequipsave, 4, 30, 32
	sdim varesname, 30, 32
	exist funcloadequipsave_prm0
	if ( strsize == (-1) ) {
		return
	}
	value = 4
	bload funcloadequipsave_prm0, value2, 4, value
	value += 4
	value3 = value2
	if ( 32 < value2 ) {
		value3 = 32
	}
	bload funcloadequipsave_prm0, varequipsave(0, 0, 0), 4 * 30 * value3 * 4, value
	value += 4 * 30 * value2 * 4
	bload funcloadequipsave_prm0, value2, 4, value
	value += 4
	sdim var_string1, value2, 1
	sdim varesname, value2, value3
	repeat value3
		bload funcloadequipsave_prm0, varesname(cnt), value2, value
		value += value2
	loop
	return

#deffunc mapchip_preparepic int mapchip_preparepic_prm0, int mapchip_preparepic_prm1
	oom_gdata_19 = mapFeat(mapchip_preparepic_prm0, mapchip_preparepic_prm1) \ 1000
	oom_gdata_20 = mapFeat(mapchip_preparepic_prm0, mapchip_preparepic_prm1) / 100000 \ 100 + mapFeat(mapchip_preparepic_prm0, mapchip_preparepic_prm1) / 10000000 * 100
	gsel 96
	color 0
	boxf 0, 240, 48, 248
	pos 0, 240
	if ( adata(31, oom_gdata_20) != 0 ) {
		gcopy 96, adata(31, oom_gdata_20) \ 10 * 48, adata(31, oom_gdata_20) / 10 * 48, 48, 48
	}
	else {
		gcopy BUFFER_MAP, oom_gdata_19 \ 33 * inf_tiles, oom_gdata_19 / 33 * inf_tiles, inf_tiles, 48 + chipm(CHIPM_H, oom_gdata_19)
	}
	gfini 48, 48
	gfdec2 c_col(0, adata(32, oom_gdata_20)), c_col(1, adata(32, oom_gdata_20)), c_col(2, adata(32, oom_gdata_20))
	gsel BUFFER_SCREEN
	return

#defcfunc direction2 int direction2_prm0, int direction2_prm1, int direction2_prm2
	if ( direction2_prm2 == 0 ) {
		dx = cX(direction2_prm1) - cX(direction2_prm0)
		dy = cY(direction2_prm1) - cY(direction2_prm0)
	}
	else {
		dx = areaX(direction2_prm1) - areaX(direction2_prm0)
		dy = areaY(direction2_prm1) - areaY(direction2_prm0)
	}
	deg = atan(dy, dx)
	if ( deg < 0.0 ) {
		deg += 3.14159265 * 2
	}
	deg = deg * 180.0 / 3.14159265
	if ( deg < 15.0 ) {
		return lang("東(右)", "east")
	}
	else {
		if ( deg < 75.0 ) {
			return lang("南東(右下)", "southeast")
		}
		else {
			if ( deg < 105.0 ) {
				return lang("南(下)", "south")
			}
			else {
				if ( deg < 165.0 ) {
					return lang("南西(左下)", "southwest")
				}
				else {
					if ( deg < 195.0 ) {
						return lang("西(左)", "west")
					}
					else {
						if ( deg < 255.0 ) {
							return lang("北西（左上)", "northwest")
						}
						else {
							if ( deg < 285.0 ) {
								return lang("北(上)", "north")
							}
							else {
								if ( deg < 345.0 ) {
									return lang("北東(右上)", "northeast")
								}
								else {
									return lang("東(右)", "east")
								}
							}
						}
					}
				}
			}
		}
	}

#defcfunc direction2_short int direction2_short_prm0, int direction2_short_prm1, int direction2_short_prm2
	locvar_lovemiracle_s = direction2(direction2_short_prm0, direction2_short_prm1, direction2_short_prm2)
	if ( jp ) {
		return locvar_lovemiracle_s
	}
	else {
		if ( locvar_lovemiracle_s == "north" ) {
			return "N"
		}
		else {
			if ( locvar_lovemiracle_s == "south" ) {
				return "S"
			}
			else {
				if ( locvar_lovemiracle_s == "east" ) {
					return "E"
				}
				else {
					if ( locvar_lovemiracle_s == "west" ) {
						return "W"
					}
					else {
						if ( locvar_lovemiracle_s == "northeast" ) {
							return "NE"
						}
						else {
							if ( locvar_lovemiracle_s == "northwest" ) {
								return "NW"
							}
							else {
								if ( locvar_lovemiracle_s == "southeast" ) {
									return "SE"
								}
								else {
									if ( locvar_lovemiracle_s == "southwest" ) {
										return "SW"
									}
									else {
										return "Error"
									}
								}
							}
						}
					}
				}
			}
		}
	}

#defcfunc splittime int splittime_prm0
	oom_y = splittime_prm0 / (24 * 30 * 12)
	oom_m = splittime_prm0 \ (24 * 30 * 12) / (24 * 30)
	if ( oom_m == 0 & oom_y > 0 ) {
		oom_m = 12
	}
	oom_d = splittime_prm0 \ (24 * 30 * 12) \ (24 * 30) / 24
	if ( oom_d == 0 & oom_m > 0 ) {
		oom_d = 30
	}
	oom_h = splittime_prm0 \ (24 * 30 * 12) \ (24 * 30) \ 24
	return "" + oom_y + "年" + oom_m + "月" + oom_d + "日" + oom_h + "時"

#defcfunc floorstr int floorstr_prm0
	if ( floorstr_prm0 == 0 ) {
		oom_s = "2階"
	}
	else {
		if ( floorstr_prm0 == 1 ) {
			oom_s = ""
		}
		else {
			oom_s = "B" + (floorstr_prm0 - 1) + "階"
		}
	}
	return oom_s

#deffunc burntoffering int burntoffering_prm0, int burntoffering_prm1
	if ( gArea  == AREA_SHOW_HOUSE ) {
		return
	}
	if ( rnd(5 - limit(int(sqrt(iNum(burntoffering_prm0))), 1, 4)) ) {
		return
	}
	olist = 13, 14, 15, 16
	olistmax = 4
	atxspot = olist(rnd(olistmax))
	axtcnt = 1
	if ( burntoffering_prm1 == 0 ) {
		axtcnt += limitmax(rnd(rnd(int(sqrt(cPiety(burntoffering_prm1) / 1000)) + 1) + 1), 5)
	}
	else {
		axtcnt += limitmax(rnd(rnd(int(sqrt(cPiety(burntoffering_prm1) / 1000)) + 1) + 1) / 4, 2)
	}
	repeat axtcnt
		burntatx = random_material(atxspot, 5 + cPiety(burntoffering_prm1) / 400)
		matgetmain burntatx, 1, 0
	loop
	return

#deffunc removeallfire
	removecnt = 0
	repeat 200
		if ( mefExist(200 - cnt - 1) == MEF_TYPE_FIRE ) {
			delmef 200 - cnt - 1
			removecnt++
		}
	loop
	if ( removecnt ) {
		txt -1, lang("火柱は消えた。", "Walls of fire disappears.")
	}
	return

#defcfunc mediafind str mediafind_prm0, str mediafind_prm1
	mediafile = exedir + "user\\cmap\\" + mediafind_prm1
	exist mediafile
	if ( strsize != (-1) ) {
		return 0
	}
	mediafile = exedir + "user\\" + mediafind_prm0 + mediafind_prm1
	exist mediafile
	if ( strsize != (-1) ) {
		return 0
	}
	else {
		mediafile = exedir + mediafind_prm0 + mediafind_prm1
		exist mediafile
		if ( strsize != (-1) ) {
			return 0
		}
	}
	mediafile = ""
	return -1

#deffunc playsound str playsound_prm0, int playsound_prm1
	if ( mediafind("sound\\", playsound_prm0) != (-1) ) {
		sndload mediafile, 200 + playsound_prm1
		snd 200 + playsound_prm1, FALSE, 2
	}
	return

#deffunc playbgm str playbgm_prm0
	if ( mediafind("sound\\", playbgm_prm0) != (-1) ) {
		musicfile(length(musicfile) - 1) = playbgm_prm0
		music = length(musicfile) - 1
		gosub *music_play
	}
	return

#deffunc se_moneymod int se_moneymod_prm0, int se_moneymod_prm1
	if ( se_moneymod_prm0 == 0 & ncgGoldOverflow < 2000000000 ) {
		if ( se_moneymod_prm1 > 0 ) {
			cGold(se_moneymod_prm0) += se_moneymod_prm1
			if ( cGold(se_moneymod_prm0) < 0 ) {
				ncgGoldOverflow = limitmax(ncgGoldOverflow + 1, 2000000000)
				cGold(se_moneymod_prm0) += 2147483647 + 2
			}
			return
		}
	}
	cGold(se_moneymod_prm0) = limitaddition(cGold(se_moneymod_prm0), se_moneymod_prm1)
	return

#defcfunc mapbit int mapbit_prm0, int mapbit_prm1, int mapbit_prm2
	HMMBITCHECK map(mapbit_prm1, mapbit_prm2, 3 + mapbit_prm0 / 32), mapbit_prm0 \ 32
	return abs(stat)

#deffunc mapbitmod int mapbitmod_prm0, int mapbitmod_prm1, int mapbitmod_prm2, int mapbitmod_prm3
	if ( mapbitmod_prm3 == 0 ) {
		HMMBITOFF map(mapbitmod_prm1, mapbitmod_prm2, 3 + mapbitmod_prm0 / 32), mapbitmod_prm0 \ 32
		return
	}
	HMMBITON map(mapbitmod_prm1, mapbitmod_prm2, 3 + mapbitmod_prm0 / 32), mapbitmod_prm0 \ 32
	return

*label_4981
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	if ( areaParent(gArea ) == AREA_TEST_WORLD ) {
		cposlist = 48
	}
	else {
		if ( areaParent(gArea ) == AREA_NORTH_TYRIS ) {
			cposlist = 3, 5, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 36, 38, 42
		}
		else {
			cposlist = 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60
		}
	}
	dim cpos, 2, length(cposlist)
	repeat length(cposlist)
		cpos(0, cnt) = areaX(cposlist(cnt)), areaY(cposlist(cnt))
	loop
	repeat 500 - 450, 450
		if ( areaType(cnt) == 0 ) {
			continue
		}
		if ( nefiaprefix \ 18 != 0 ) {
			if ( oabit(nefiaprefix \ 18 - 1, cnt) == 0 ) {
				continue
			}
		}
		if ( areaId(cnt) == AREA_RANDOM_DUNGEON ) {
			min = 1000
			cnt2 = cnt
			repeat length(cposlist)
				tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos(0, cnt), cpos(1, cnt))
				if ( min > tmpdist ) {
					min = tmpdist
					cposdist = cnt
				}
			loop
			list(0, listmax) = cnt, areaMinLevel(cnt), cposlist(cposdist)
			listmax++
		}
	loop
	gosub *sort_list
	windowshadow = 1

*label_4985
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_4986
	redraw 0
	s = lang("ネフィア一覧", "Nefia List"), strhint2 + strhint3 + oom_strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	if ( nefiaprefix \ 18 != 0 ) {
		display_topic lang("名前", "Name") + " - " + oadatastr(nefiaprefix \ 18 - 1), wx + 28, wy + 36
	}
	else {
		display_topic lang("名前", "Name"), wx + 28, wy + 36
	}
	display_topic lang("危険度", "Danger lv"), wx + 320 - en * 75, wy + 36
	display_topic lang("位置情報", "Location"), wx + 420 - en * 75, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 50, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		pos wx + 52 - 16, wy + 66 + cnt * 19 - 1
		if ( areaDeepest(list(0, p)) == areaCanSave(list(0, p)) ) {
			gcopy BUFFER_INF, 32, 624, 16, 16
		}
		else {
			if ( areaDeepest(list(0, p)) != 0 ) {
				gcopy BUFFER_INF, 48, 624, 16, 16
			}
		}
		s = "" + mapname(list(0, p))
		cs_list s, wx + 52, wy + 66 + cnt * 19 - 1, 19
		s = "" + list(1, p)
		pos wx + 402 - strlen(s) * 7 - en * 75, wy + 66 + cnt * 19 + 2
		mes s
		if ( jp ) {
			s = mapname(list(2, p)) + " " + direction2(list(2, p), list(0, p), 1)
		}
		else {
			s = "To the " + direction2_short(list(2, p), list(0, p), 1) + " of " + mapname(list(2, p))
		}
		pos wx + 435 - en * 75, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_4985
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_4985
		}
	}
	if ( key == key_southeast | key == key_next ) {
		snd SOUNDLIST_POP1
		nefiaprefix++
		if ( nefiaprefix > 17 ) {
			nefiaprefix = 0
		}
		goto *label_4981
	}
	if ( key == key_southwest | key == key_prev ) {
		snd SOUNDLIST_POP1
		nefiaprefix--
		if ( nefiaprefix < 0 ) {
			nefiaprefix = 17
		}
		goto *label_4981
	}
	if ( key == key_cancel ) {
		nefiaprefix = 0
		return
	}
	goto *label_4986

*label_4990
	if ( existfile_minimap == 1 ) {
		repeat mHeight
			sy = cnt
			repeat mWidth
				sx = cnt
				if ( mapIdMemory(sx, sy) == mapId(sx, sy) ) {
					gosub *screen_drawRader
				}
			loop
		loop
		sy = 84 * cY(i) / mHeight
		if ( sy < 2 ) {
			sy = 2
		}
		else {
			if ( sy > 84 - 8 ) {
				sy = 84 - 8
			}
		}
		sx = 120 * cX(i) / mWidth
		if ( sx < 2 ) {
			sx = 2
		}
		else {
			if ( sx > 120 - 8 ) {
				sx = 120 - 8
			}
		}
		pos inf_raderx + sx, inf_radery + sy
		gcopy 97, 24, 0, 6, 6
	}
	return

*label_4993
	page = 0
	cs = 0
	cs_bk = -1
	warplistmax = 0
	dim warplist, 3, 400
	inv_getheader -1
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		if ( ibit(20, cnt) == TRUE ) {
			locvar_randskill_p = cnt
			locvar_addnews_f = 0
			repeat warplistmax
				if ( iX(locvar_randskill_p) == iX(warplist(0, cnt)) ) {
					if ( iY(locvar_randskill_p) == iY(warplist(0, cnt)) ) {
						locvar_addnews_f = 1
						break
					}
				}
			loop
			if ( locvar_addnews_f == 0 ) {
				warplist(0, warplistmax) = cnt
				warplistmax++
			}
		}
	loop
	if ( warplistmax == 0 ) {
		return -1
	}
	gosub *label_5002

*label_4996
	redraw 0
	pagesize = 16
	pagemax = (warplistmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}
	s = lang("テレポート先の選択", "Go where?")
	s(1) = strhint2 + "Shift,Esc " + lang("[通常のテレポート]", "[Normal teleport]") + "  "
	display_window (windoww - 440) / 2 + inf_screenx, winposy(432), 440, 400
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= warplistmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	color 0, 0, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= warplistmax ) {
			break
		}
		i = warplist(0, p)
		if ( cs == cnt ) {
			gosub *label_5000
		}
		color 255, 0, 255
		gmode 4, , , 255
		pos wx + 28 - 12, wy + 40
		gcopy 94, 0, 0, 120 * 3 + 2 + 24, 84 * 3 + 2 + 18
	loop
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			value = pagesize * page + cnt
			p = warplist(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		snd SOUNDLIST_POP2
		return p
	}
	if ( key == key_cancel ) {
		return -1
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			gosub *label_5002
			goto *label_4996
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			gosub *label_5002
			goto *label_4996
		}
	}
	goto *label_4996

*label_5000
	gsel 94
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= warplistmax ) {
			break
		}
		if ( warplist(0, p) != (-1) ) {
			locvar_txtgod_sy = 84 * 3 * iY(warplist(0, p)) / mHeight + 18
			if ( locvar_txtgod_sy < 2 ) {
				locvar_txtgod_sy = 2
			}
			else {
				if ( locvar_txtgod_sy > 84 * 3 ) {
					locvar_txtgod_sy = 84 * 3
				}
			}
			locvar_txtgod_sx = 120 * 3 * iX(warplist(0, p)) / mWidth + 24
			if ( locvar_txtgod_sx < 2 ) {
				locvar_txtgod_sx = 2
			}
			else {
				if ( locvar_txtgod_sx > 120 * 3 ) {
					locvar_txtgod_sx = 120 * 3
				}
			}
			gmode 2
			display_key locvar_txtgod_sx - 24, locvar_txtgod_sy - 18, cnt
			if ( existfile_minimap == 1 ) {
				pos 0 + locvar_txtgod_sx, 0 + locvar_txtgod_sy
				gcopy 97, 30, 0, 6, 6
				if ( i != warplist(0, p) ) {
					gfini 6, 6
					gfdec2 100, 100, 100
				}
			}
		}
	loop
	gsel BUFFER_SCREEN
	return

*label_5002
	gsel 94
	color 255, 0, 255
	boxf
	pos 24, 18
	gzoom 120 * 3 + 2, 84 * 3 + 2, 3, 123, 508, 118, 81
	redraw 1
	repeat mHeight
		locvar_txtgod_sy = cnt
		repeat mWidth
			locvar_txtgod_sx = cnt
			locvar_txtgod_sx(1) = 120 * locvar_txtgod_sx * 3 / mWidth + 24
			locvar_txtgod_sy(1) = 84 * locvar_txtgod_sy * 3 / mHeight + 18
			pos locvar_txtgod_sx(1), locvar_txtgod_sy(1)
			locvar_txtgod_raderw = 120 * 3 / mWidth + 2
			locvar_txtgod_radery = 84 * 3 / mHeight + 2
			if ( mapIdMemory(locvar_txtgod_sx, locvar_txtgod_sy) == mapId(locvar_txtgod_sx, locvar_txtgod_sy) ) {
				gcopy BUFFER_MAP, mapId(locvar_txtgod_sx, locvar_txtgod_sy) \ 33 * inf_tiles + sx \ 16, mapId(locvar_txtgod_sx, locvar_txtgod_sy) / 33 * inf_tiles + locvar_txtgod_sy \ 12, locvar_txtgod_raderw, locvar_txtgod_radery
				pos 0 + locvar_txtgod_sx(1), 0 + locvar_txtgod_sy(1)
				gfini locvar_txtgod_raderw, locvar_txtgod_radery
				if ( chipm(CHIPM_ATTRIB, mapId(locvar_txtgod_sx, locvar_txtgod_sy)) & CHIPM_ATTRIB_CANT_PASS ) {
					gfdec2 100, 100, 100
				}
			}
		loop
	loop
	gsel BUFFER_SCREEN
	return

*label_5005
	locvar_addnews_setting = 1
	locvar_txtgod_default = 0
	listmax = 0
	page = 0
	pagesize = 18
	cs = 0
	cs_bk = -1
	page_bk = 0
	cs_bk2 = 0
	locvar_txt_conv_tmpcolor = 0, 0, 0
	locvar_txt_conv_tmpbgcolor = 255, 255, 255
	locvar_txt_conv_tmpfont = 0, cfg_txtpopfont, 0
	locvar_addnews_i = 0
	windowshadow = 1

*label_5006
	listmax = 0
	q = "個別設定"
	if ( tc == CHARA_PLAYER ) {
		if ( locvar_txtgod_default == 1 ) {
			q = "吹き出しデフォルト設定"
		}
	}
	if ( locvar_txtgod_default == 0 ) {
		s = "会話タイプ", "吹き出しオフでも表示", "位置ｘ", "位置ｙ", "文字R", "文字G", "文字B", "背景R", "背景G", "背景B", "フォント", "フォントサイズ", "フォント装飾", ""
	}
	else {
		s = "文字R", "文字G", "文字B", "背景R", "背景G", "背景B", "フォント", "フォントサイズ", "フォント装飾", ""
	}
	dx = 440 + inf_tiles * 3
	dy = 400
	buffer 220, 200, 100
	if ( locvar_txtgod_default == 1 ) {
		if ( gdatac(20) == 1 ) {
			split8bit gdatac(21), locvar_txt_conv_tmpcolor
			split8bit gdatac(22), locvar_txt_conv_tmpbgcolor
			split8bit gdatac(23), locvar_txt_conv_tmpfont
			locvar_txt_conv_tmpfont(1) = cfg_txtpopfont
		}
	}
	else {
		if ( ocFukidashiIndividual(tc) == 1 ) {
			split8bit ocFukidashiR(tc), locvar_txt_conv_tmpcolor
			split8bit ocFukidashiG(tc), locvar_txt_conv_tmpbgcolor
			split8bit ocFukidashiB(tc), locvar_txt_conv_tmpfont
		}
	}
	font locvar_txt_conv_fontlist(locvar_txt_conv_tmpfont(0)), 2 + locvar_txt_conv_tmpfont(1) - en * 2, locvar_txt_conv_tmpfont(2)
	locvar_txtgod_tmps = "吹き出しTEST"
	autoinsertlf locvar_txtgod_tmps, locvar_txtgod_tmp, 48 * 5
	dim locvar_net_dl_tmpsize, 2
	getstrrect hdc, locvar_txtgod_tmp, locvar_net_dl_tmpsize
	locvar_net_dl_tmpsize(0) += 10
	locvar_net_dl_tmpsize(1) += 20
	width locvar_net_dl_tmpsize(0), locvar_net_dl_tmpsize(1)
	color 255, 0, 255
	boxf
	color locvar_txt_conv_tmpcolor(0), locvar_txt_conv_tmpcolor(1), locvar_txt_conv_tmpcolor(2)
	bgcolor = locvar_txt_conv_tmpbgcolor(0), locvar_txt_conv_tmpbgcolor(1), locvar_txt_conv_tmpbgcolor(2)
	fukidashi 0, 0, locvar_net_dl_tmpsize(0), locvar_net_dl_tmpsize(1) - 10, 5, 1, bgcolor
	pos 5, 5
	mes locvar_txtgod_tmps
	gsel BUFFER_SCREEN
	repeat 30
		if ( s(cnt) == "" ) {
			break
		}
		list(0, listmax) = cnt
		listn(0, listmax) = s(cnt)
		listmax++
	loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_5008
	redraw 0
	screenupdate = -1
	gosub *screen_draw
	buffer 221, inf_tiles * 3, inf_tiles * 3
	locvar_txtgod_x = (cX(tc) - scx) * inf_tiles + inf_screenx - 48
	locvar_txtgod_y = (cY(tc) - scy) * inf_tiles + inf_screeny - 48 - 48
	gcopy BUFFER_SCREEN, locvar_txtgod_x, locvar_txtgod_y, inf_tiles * 3, inf_tiles * 3
	gsel BUFFER_SCREEN
	pagesize = 0
	s = q, lang("左右キー [変更]  ｷｬﾝｾﾙ [閉じる]  " + key_mode2 + " [設定初期化]", "Right,left [Change]  Shift,Esc [Close]  " + key_mode2 + " [Reset]")
	if ( tc == CHARA_PLAYER ) {
		if ( locvar_txtgod_default == 1 ) {
			s(1) += "  " + key_msglog + " [吹き出し個別設定]"
		}
		else {
			s(1) += "  " + key_msglog + " [吹き出しデフォルト設定]"
		}
	}
	display_window (windoww - dx) / 2 + inf_screenx, winposy(dy) - 12, dx, dy
	pagesize = listmax
	display_topic lang("項目", "Category"), wx + 34, wy + 36
	gmode 2
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_cancel
		keyrange++
	loop
	keyrange = 0
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		i = list(0, p)
		s = listn(0, p)
		x = 0
		cs_list s, wx + 56 + x, wy + 66 + cnt * 19 - 1, 19, 0
		pos wx + 200, wy + 66 + cnt * 19 - 5
		gcopy BUFFER_INF, 312, 336, 24, 24
		pos wx + 370, wy + 66 + cnt * 19 - 5
		gcopy BUFFER_INF, 336, 336, 24, 24
		pos wx + 230, wy + 66 + cnt * 19
		color 0, 0, 0
		if ( locvar_txtgod_default == 0 ) {
			if ( cnt == 0 ) {
				if ( cSex(tc) == 0 ) {
					s = "私：お願いします", "俺：頼む", "僕：頼むね", "自分：頼む…", "麻呂：頼むぞよ", "拙者：頼み申す", "あっし：頼むッス"
				}
				else {
					s = "私：お願いしますわ", "あたし：頼むよ", "わたし：頼むわ", "自分：頼むわ…", "わらわ：頼むぞよ", "手前：お頼み申し上げます", "みゅー：おねがいにゃ"
				}
				keyrange++
				mes s(cTone(tc))
			}
			if ( cnt == 1 ) {
				s = "しない", "一つ", "無制限", ""
				keyrange++
				mes s(ocFukidashiDisplayWhenOff(tc))
			}
			if ( cnt == 2 ) {
				keyrange++
				mes ocFukidashiOffsetX(tc)
			}
			if ( cnt == 3 ) {
				keyrange++
				mes ocFukidashiOffsetY(tc)
			}
			if ( cnt == 4 | cnt == 5 | cnt == 6 ) {
				keyrange++
				mes locvar_txt_conv_tmpcolor(cnt - 4)
			}
			if ( cnt == 7 | cnt == 8 | cnt == 9 ) {
				keyrange++
				mes locvar_txt_conv_tmpbgcolor(cnt - 7)
			}
			if ( cnt == 10 ) {
				keyrange++
				mes "" + locvar_txt_conv_tmpfont(0) + ":" + locvar_txt_conv_fontlist(locvar_txt_conv_tmpfont(0))
			}
			if ( cnt == 11 ) {
				keyrange++
				mes locvar_txt_conv_tmpfont(1)
			}
			if ( cnt == 12 ) {
				keyrange++
				locvar_addnews_s = "" + locvar_txt_conv_tmpfont(2) + ":"
				if ( locvar_txt_conv_tmpfont(2) == 0 ) {
					locvar_addnews_s += "N"
				}
				if ( locvar_txt_conv_tmpfont(2) & 1 ) {
					locvar_addnews_s += "B "
				}
				if ( locvar_txt_conv_tmpfont(2) & 2 ) {
					locvar_addnews_s += "I "
				}
				if ( locvar_txt_conv_tmpfont(2) & 4 ) {
					locvar_addnews_s += "U "
				}
				if ( locvar_txt_conv_tmpfont(2) & 8 ) {
					locvar_addnews_s += "S "
				}
				if ( locvar_txt_conv_tmpfont(2) & 16 ) {
					locvar_addnews_s += "AA"
				}
				mes locvar_addnews_s
			}
		}
		else {
			if ( cnt == 0 | cnt == 1 | cnt == 2 ) {
				keyrange++
				mes locvar_txt_conv_tmpcolor(cnt)
			}
			if ( cnt == 3 | cnt == 4 | cnt == 5 ) {
				keyrange++
				mes locvar_txt_conv_tmpbgcolor(cnt - 3)
			}
			if ( cnt == 6 ) {
				keyrange++
				mes "" + locvar_txt_conv_tmpfont(0) + ":" + locvar_txt_conv_fontlist(locvar_txt_conv_tmpfont(0))
			}
			if ( cnt == 7 ) {
				keyrange++
				mes locvar_txt_conv_tmpfont(1)
			}
			if ( cnt == 8 ) {
				keyrange++
				locvar_addnews_s = "" + locvar_txt_conv_tmpfont(2) + ":"
				if ( locvar_txt_conv_tmpfont(2) == 0 ) {
					locvar_addnews_s += "N"
				}
				if ( locvar_txt_conv_tmpfont(2) & 1 ) {
					locvar_addnews_s += "B "
				}
				if ( locvar_txt_conv_tmpfont(2) & 2 ) {
					locvar_addnews_s += "I "
				}
				if ( locvar_txt_conv_tmpfont(2) & 4 ) {
					locvar_addnews_s += "U "
				}
				if ( locvar_txt_conv_tmpfont(2) & 8 ) {
					locvar_addnews_s += "S "
				}
				if ( locvar_txt_conv_tmpfont(2) & 16 ) {
					locvar_addnews_s += "AA"
				}
				mes locvar_addnews_s
			}
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	window2 wx + 400, wy + 66 - 1, inf_tiles * 3 + 10, inf_tiles * 3 + 10, 1, 1
	pos wx + 400 + 5, wy + 66 - 1 + 5
	gmode 1
	gcopy 221, 0, 0, inf_tiles * 3, inf_tiles * 3
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	locvar_addnews_f = 0
	if ( key == key_southeast | key == key_next ) {
		p = 10
		locvar_addnews_f = 1
	}
	if ( key == key_southwest | key == key_prev ) {
		p = -10
		locvar_addnews_f = 1
	}
	if ( key == key_pageup ) {
		p = 1
		locvar_addnews_f = 1
	}
	if ( key == key_pagedown ) {
		p = -1
		locvar_addnews_f = 1
	}
	if ( locvar_addnews_f == 1 ) {
		if ( locvar_txtgod_default == 0 ) {
			if ( cs == 0 ) {
				cTone(tc) += p
				if ( cTone(tc) > 6 ) {
					cTone(tc) = 0
				}
				else {
					if ( cTone(tc) < 0 ) {
						cTone(tc) = 6
					}
				}
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( ocFukidashiIndividual(tc) == 0 ) {
				ocFukidashiR(tc) = join8bit(locvar_txt_conv_tmpcolor)
				ocFukidashiG(tc) = join8bit(locvar_txt_conv_tmpbgcolor)
				ocFukidashiB(tc) = join8bit(locvar_txt_conv_tmpfont)
				ocFukidashiIndividual(tc) = 1
			}
			if ( cs == 1 ) {
				ocFukidashiDisplayWhenOff(tc) += p
				if ( ocFukidashiDisplayWhenOff(tc) < 0 ) {
					ocFukidashiDisplayWhenOff(tc) = 2
				}
				if ( ocFukidashiDisplayWhenOff(tc) > 2 ) {
					ocFukidashiDisplayWhenOff(tc) = 0
				}
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( cs == 2 ) {
				ocFukidashiOffsetX(tc) += p
				if ( ocFukidashiOffsetX(tc) < (-24) ) {
					ocFukidashiOffsetX(tc) = 24
				}
				if ( ocFukidashiOffsetX(tc) > 24 ) {
					ocFukidashiOffsetX(tc) = -24
				}
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( cs == 3 ) {
				ocFukidashiOffsetY(tc) += p
				if ( ocFukidashiOffsetY(tc) < (-48) ) {
					ocFukidashiOffsetY(tc) = 48
				}
				if ( ocFukidashiOffsetY(tc) > 48 ) {
					ocFukidashiOffsetY(tc) = -48
				}
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( cs == 4 | cs == 5 | cs == 6 ) {
				locvar_txt_conv_tmpcolor(cs - 4) += p
				if ( locvar_txt_conv_tmpcolor(cs - 4) > 255 ) {
					locvar_txt_conv_tmpcolor(cs - 4) = 0
				}
				if ( locvar_txt_conv_tmpcolor(cs - 4) < 0 ) {
					locvar_txt_conv_tmpcolor(cs - 4) = 255
				}
				ocFukidashiR(tc) = join8bit(locvar_txt_conv_tmpcolor)
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( cs == 7 | cs == 8 | cs == 9 ) {
				locvar_txt_conv_tmpbgcolor(cs - 7) += p
				if ( locvar_txt_conv_tmpbgcolor(cs - 7) > 255 ) {
					locvar_txt_conv_tmpbgcolor(cs - 7) = 0
				}
				if ( locvar_txt_conv_tmpbgcolor(cs - 7) < 0 ) {
					locvar_txt_conv_tmpbgcolor(cs - 7) = 255
				}
				ocFukidashiG(tc) = join8bit(locvar_txt_conv_tmpbgcolor)
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( cs == 10 ) {
				locvar_txt_conv_tmpfont(0) += p
				if ( locvar_txt_conv_tmpfont(0) > length(locvar_txt_conv_fontlist) - 1 ) {
					locvar_txt_conv_tmpfont(0) = 0
				}
				if ( locvar_txt_conv_tmpfont(0) < 0 ) {
					locvar_txt_conv_tmpfont(0) = length(locvar_txt_conv_fontlist) - 1
				}
				ocFukidashiB(tc) = join8bit(locvar_txt_conv_tmpfont)
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( cs == 11 ) {
				locvar_txt_conv_tmpfont(cs - 10) += p
				if ( locvar_txt_conv_tmpfont(1) > 30 ) {
					locvar_txt_conv_tmpfont(1) = 8
				}
				if ( locvar_txt_conv_tmpfont(1) < 8 ) {
					locvar_txt_conv_tmpfont(1) = 30
				}
				ocFukidashiB(tc) = join8bit(locvar_txt_conv_tmpfont)
				snd SOUNDLIST_OK1
				goto *label_5006
			}
			if ( cs == 12 ) {
				locvar_txt_conv_tmpfont(2) += p
				if ( locvar_txt_conv_tmpfont(2) > 31 ) {
					locvar_txt_conv_tmpfont(2) = 0
				}
				if ( locvar_txt_conv_tmpfont(2) < 0 ) {
					locvar_txt_conv_tmpfont(2) = 31
				}
				ocFukidashiB(tc) = join8bit(locvar_txt_conv_tmpfont)
				snd SOUNDLIST_OK1
				goto *label_5006
			}
		}
		else {
			if ( gdatac(20) == 0 ) {
				gdatac(21) = join8bit(locvar_txt_conv_tmpcolor)
				gdatac(22) = join8bit(locvar_txt_conv_tmpbgcolor)
				gdatac(23) = join8bit(locvar_txt_conv_tmpfont)
				gdatac(20) = 1
			}
		}
		if ( cs == 0 | cs == 1 | cs == 2 ) {
			locvar_txt_conv_tmpcolor(cs) += p
			if ( locvar_txt_conv_tmpcolor(cs) > 255 ) {
				locvar_txt_conv_tmpcolor(cs) = 0
			}
			if ( locvar_txt_conv_tmpcolor(cs) < 0 ) {
				locvar_txt_conv_tmpcolor(cs) = 255
			}
			gdatac(21) = join8bit(locvar_txt_conv_tmpcolor)
			snd SOUNDLIST_OK1
			goto *label_5006
		}
		if ( cs == 3 | cs == 4 | cs == 5 ) {
			locvar_txt_conv_tmpbgcolor(cs - 3) += p
			if ( locvar_txt_conv_tmpbgcolor(cs - 3) > 255 ) {
				locvar_txt_conv_tmpbgcolor(cs - 3) = 0
			}
			if ( locvar_txt_conv_tmpbgcolor(cs - 3) < 0 ) {
				locvar_txt_conv_tmpbgcolor(cs - 3) = 255
			}
			gdatac(22) = join8bit(locvar_txt_conv_tmpbgcolor)
			snd SOUNDLIST_OK1
			goto *label_5006
		}
		if ( cs == 6 ) {
			locvar_txt_conv_tmpfont(0) += p
			if ( locvar_txt_conv_tmpfont(0) > length(locvar_txt_conv_fontlist) - 1 ) {
				locvar_txt_conv_tmpfont(0) = 0
			}
			if ( locvar_txt_conv_tmpfont(0) < 0 ) {
				locvar_txt_conv_tmpfont(0) = length(locvar_txt_conv_fontlist) - 1
			}
			gdatac(23) = join8bit(locvar_txt_conv_tmpfont)
			snd SOUNDLIST_OK1
			goto *label_5006
		}
		if ( cs == 7 ) {
			locvar_txt_conv_tmpfont(1) += p
			if ( locvar_txt_conv_tmpfont(1) > 30 ) {
				locvar_txt_conv_tmpfont(1) = 8
			}
			if ( locvar_txt_conv_tmpfont(1) < 8 ) {
				locvar_txt_conv_tmpfont(1) = 30
			}
			gdatac(23) = join8bit(locvar_txt_conv_tmpfont)
			cfg_txtpopfont = locvar_txt_conv_tmpfont(1)
			config_saveomakeoption "txtpopFont.", str(cfg_txtpopfont)
			snd SOUNDLIST_OK1
			goto *label_5006
		}
		if ( cs == 8 ) {
			locvar_txt_conv_tmpfont(2) += p
			if ( locvar_txt_conv_tmpfont(2) > 31 ) {
				locvar_txt_conv_tmpfont(2) = 0
			}
			if ( locvar_txt_conv_tmpfont(2) < 0 ) {
				locvar_txt_conv_tmpfont(2) = 31
			}
			gdatac(23) = join8bit(locvar_txt_conv_tmpfont)
			snd SOUNDLIST_OK1
			goto *label_5006
		}
	}
	if ( key == key_mode2 ) {
		snd SOUNDLIST_OK1
		promptl(0, promptmax) = lang("いいえ", "No"), "a", "" + promptmax
		promptmax++
		promptl(0, promptmax) = lang("はい", "Yes"), "b", "" + promptmax
		promptmax++
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval == 1 ) {
			if ( locvar_txtgod_default == 0 ) {
				ocFukidashiIndividual(tc) = 0
				ocFukidashiDisplayWhenOff(tc) = 0
				ocFukidashiOffsetX(tc) = 0
				ocFukidashiOffsetY(tc) = 0
				ocFukidashiR(tc) = 0
				ocFukidashiG(tc) = 0
				ocFukidashiB(tc) = 0
			}
			else {
				gdatac(20) = 0
				gdatac(21) = 0
				gdatac(22) = 0
				gdatac(23) = 0
			}
			locvar_txt_conv_tmpcolor = 0, 0, 0
			locvar_txt_conv_tmpbgcolor = 255, 255, 255
			locvar_txt_conv_tmpfont = 0, cfg_txtpopfont, 0
		}
		goto *label_5006
	}
	if ( tc == CHARA_PLAYER ) {
		if ( key == key_msglog ) {
			snd SOUNDLIST_OK1
			locvar_txtgod_default = 1 - locvar_txtgod_default
			locvar_txt_conv_tmpcolor = 0, 0, 0
			locvar_txt_conv_tmpbgcolor = 255, 255, 255
			locvar_txt_conv_tmpfont = 0, cfg_txtpopfont, 0
			goto *label_5006
		}
	}
	if ( key == key_cancel ) {
		locvar_addnews_setting = 0
		return
	}
	goto *label_5008

*label_5011
	if ( efstatus == 0 ) {
		if ( synccheck(tc, -1) ) {
			txt -1, lang(name(tc) + "の装備品は不気味な光に包まれた。", name(tc) + " " + your(tc) + " equipment are surrounded by a Black aura.")
		}
	}
	inv_getheader tc
	p(1) = 0, 0
	repeat invrange, invhead
		if ( iNum(cnt) == 0 ) {
			continue
		}
		ci = cnt
		p = 0
		if ( iStatus(ci) == ITEM_STATUS_NORMAL ) {
			p = rnd(200) + 1
		}
		if ( iStatus(ci) == ITEM_STATUS_BLESSED ) {
			p = rnd(10000) + 1
		}
		if ( iEquip(ci) == 0 ) {
			continue
		}
		if ( p != 0 ) {
			if ( efp >= p & iQuality(ci) != FIX_QUALITY_UNIQUE ) {
				p(1)++
				if ( iEquip(ci) != 0 ) {
					cdata(iEquip(ci), tc) = cdata(iEquip(ci), tc) / EXT_EQUIP_SLOTS * 10000
					iEquip(ci) = 0
				}
				iNum(ci)--
				txtef COLOR_RED
				txt -1, lang("" + itemname(ci) + "が破壊された。", "" + itemname(ci) + "disappear with a white aura.")
				snd SOUNDLIST_CRUSH2
				iStatus(ci) = ITEM_STATUS_NORMAL
				item_stack tc, ci, 1
			}
			else {
				p(2)++
			}
		}
	loop
	if ( p(2) != 0 ) {
		if ( synccheck(tc, -1) ) {
			txt -1, lang("幾つかのアイテムは抵抗した。", "Several items resist the aura and remain cursed.")
		}
	}
	if ( p(1) == 0 & p(2) == 0 ) {
		txt -1, lang("何もおきない… ", "Nothing happens...")
		obvious = 0
	}
	else {
		animeload 14, tc
	}
	r1 = tc
	gosub *charaRefresh
	return

*label_5013
	txtef COLOR_YELLOW
	txt -1, lang("どの魔法を望む？", "What do you wish magic for? ")
	val = (windoww - 514) / 2 + inf_screenx, winposy(90), 30, 0, 0
	inputlog = ""
	gosub *prompt_word
	msgtemp = ""
	tcopy = 1
	if ( en ) {
		inputlog = getpath(inputlog, 16)
	}
	snd SOUNDLIST_DING2
	gosub *wish_fix
	i = 0
	repeat 600
		f = 0
		if ( cnt >= 400 & cnt <= 466 & cnt != 441 & cnt != 464 & cnt != 426 & cnt != 427 ) {
			f = 1
		}
		if ( cnt >= 500 & cnt <= 549 ) {
			f = 1
		}
		if ( f == 0 ) {
			continue
		}
		p = 0
		cnt2 = cnt
		s = skillname(cnt2)
		if ( skillname(cnt2) == "" ) {
			continue
		}
		if ( en ) {
			s = getpath(s, 16)
		}
		if ( s == inputlog ) {
			p = 10000
		}
		repeat strlen(inputlog) / (1 + jp)
			if ( instr(s, 0, strmid(inputlog, cnt * (1 + jp), 1 + jp)) != (-1) ) {
				p += 50 + rnd(15)
			}
		loop
		if ( p != 0 ) {
			dblist(0, i) = cnt, p
			i++
		}
	loop
	if ( i != 0 ) {
		p = 0, 0
		repeat i
			if ( dblist(1, cnt) > p(1) ) {
				p = dblist(0, cnt), dblist(1, cnt)
			}
		loop
		if ( skillname(p) != "" ) {
			txtef COLOR_YELLOW
			txt -1, lang(skillname(p) + "を習得した！", "Your " + skillname(p) + " magic improves!")
			efid = p
		}
		else {
			p = 400
			txtef COLOR_YELLOW
			txt -1, lang(skillname(p) + "を習得した！", "Your " + skillname(p) + " magic improves!")
			efid = p
		}
		return
	}
	p = 400
	txtef COLOR_YELLOW
	txt -1, lang(skillname(p) + "を習得した！", "Your " + skillname(p) + " magic improves!")
	efid = p
	return

*label_5017
	if ( jp ) {
		titlename(0) = "無魔法制覇", "虚弱制覇", "優柔不断制覇", "一神教者制覇", "無神論者制覇"
		titlename(5) = "暴食制覇", "バッドコミュニケーション制覇", "純情制覇", "終生誓願制覇", "トリガーハッピー制覇"
		titlename(10) = "殺生忌避制覇", "文盲制覇", "動物敵対制覇", "孤独制覇", "性依存症制覇"
		titlename(15) = "アルコール依存症制覇", "ギャンブラー制覇", "清廉潔白制覇", "復活不可制覇", "一期一会制覇"
		titlename(20) = "食事不可制覇", "オワタ式制覇", "成長不可制覇", "ハードモード制覇", "Zen制覇"
		titlename2(0) = "詠唱成功率５％上昇", "主能力上昇フィートの効果が上昇", "混乱状態でも正しく歩ける", "信仰が深まりやすくなる", "信仰スキルの成長量上昇"
		titlename2(5) = "ハーブ以外の食事効果が上昇", "店主の好感度による割引強化", "気持ちいいことの消費スタミナが減少", "結婚時にいくつかのおまけを得る", "みだれうちがたまに連発する"
		titlename2(10) = "カルマ上限＋１０", "解読に失敗しても不利益を被らない", "動物に対して支配が確実に成功する", "ペット死亡時の好感度減少量を減らす", "気持ちいいことで得られる金額が上昇"
		titlename2(15) = "お酒でより長く酔っぱらう", "運勢の値に関係なく悪いカードを避ける事がある", "カルマの回復量が上昇", "復活の書を所持している自身とペットの死を回避できる", "ブラックマーケットで稀に特別なアイテムが販売される"
		titlename2(20) = "呪われた食事で吐かなくなる", "死亡時にアイテムを落とさなくなる", "潜在値の下限が５０％上昇", "プレイヤーが輝く", "====="
	}
	else {
		titlename(0) = "Conquer of Magic", "Conquer of Weakness", "Conquer of Indecisiveness", "Conquer of Monotheism", "Conquer of Atheism"
		titlename(5) = "Conquer of Gluttony", "Conquer of Bad Communication", "Conquer of Chaste", "Conquer of Lifelong Vow", "Conquer of Trigger Happy"
		titlename(10) = "Conquer of No Murder", "Conquer of Illiteracy", "Conquer of Animal Hostility", "Conquer of Loneliness", "Conquer of Sexual Addiction"
		titlename(15) = "Conquer of Alcoholism", "Conquer of Gambling", "Conquer of Pacifist", "Conquer of Deathless", "Conquer No Going Back"
		titlename(20) = "Conquer of No Meal", "Conquer of 1 Hit KO", "Conquer of No Growth", "Conquer of Hard Mode", "Conquer of Zen"
		titlename2(0) = "Casting success rate increased by 5%", "Increases Attribute Feat Effects", "Walk correctly even in a confused state", "Faith becomes easier to deepen", "Faith skill growth increased"
		titlename2(5) = "Increased dietary effects other than herbs", "Enhanced discounts due to shopkeeper's favorability", "Reduced consumption stamina of pleasant things", "Get some extras at marriage", "a chance to trigger rapid shot"
		titlename2(10) = "Karma upper limit +10", "No disadvantage if decoding fails", "Successful control over animals", "Reduces favorability reduction when pet dies", "Earn more money with prostitution"
		titlename2(15) = "Drunk longer with alcohol", "Sometimes avoid bad cards regardless of fortune value", "Increased karma recovery", "resurrect yourself with book of ressurection.", "Rarely special items are sold at the black market"
		titlename2(20) = "No longer vomits when eating cursed food", "No more dropping items on death", "50% increase in potential limit", "Player shines", "====="
	}
	listmax = 0
	page = 0
	pagesize = 15
	cs = 0
	tc = CHARA_PLAYER
	cs_bk = -1
	page_load
	curmenu = 2
	ww = 700
	wh = 400
	wx = (windoww - ww) / 2 + inf_screenx
	wy = winposy(wh)
	windowanime wx, wy, ww, wh, 10, 4
	redraw 0
	gsel BUFFER_INF
	pos 960, 96
	picload_ exedir + "graphic\\deco_feat.bmp", 1
	gsel BUFFER_SCREEN
	windowshadow = 1

*label_5018
	listmax = 0
	repeat length(titlename)
		if ( cnt < 25 ) {
			list(0, listmax) = cnt, cnt + 1
			listmax++
		}
	loop
	gosub *sort_list
	repeat listmax
		if ( trophy(cnt) > 0 ) {
			s = "＊" + titlename(cnt)
		}
		else {
			s = titlename(cnt)
		}
		pos wx + 30, wy + 61 + cnt * 19
		x = 84
		listn(0, cnt) = s
	loop
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_5021
	redraw 0
	s = lang("トロフィー", "Trophy")
	s(1) = lang("マイナスフィートを取得し偽りの預言者『ゼーム』を撃破することでトロフィーを獲得できる", "Earn titles after fulfilling their conditions")
	i = 0
	display_window (windoww - 730) / 2 + inf_screenx, winposy(430, i) + i * 15, 730, 430, 55, 40
	if ( jp ) {
		s = "トロフィー名(＊は獲得済み)", "報酬"
	}
	else {
		s = "Trophy Name", "Conditions"
	}
	display_topic s, wx + 46, wy + 36
	display_topic s(1), wx + 305, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 57, wy + 66 + cnt * 19
			gfini 640, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		if ( trophy(p) == 2 ) {
			cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, 1, p
		}
		else {
			cs_list listn(0, p), wx + x, wy + 66 + cnt * 19 - 1, 19, 0, 4, p
		}
		pos wx + 330, wy + 66 + cnt * 19 + 2
		mes titlename2(p)
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = pagesize * page + cnt
			break
		}
	loop
	if ( p >= 0 ) {
		if ( trophy(p) > 0 ) {
			snd SOUNDLIST_SPEND1
			if ( trophy(p) == 2 ) {
				trophy(p) = 1
			}
			else {
				trophy(p) = 2
			}
			goto *label_5018
		}
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_5018
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_5018
		}
	}
	if ( key == key_cancel ) {
		buff = ""
		notesel buff
		file = exedir + "save\\trophy"
		repeat 25
			noteadd "" + trophy(cnt)
		loop
		notesave file + ".txt"
		goto *game_title
	}
	goto *label_5021

*label_5026
	snd SOUNDLIST_POP2
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	repeat 245
		dup roopbuf, cExist(cnt)
		if ( roopbuf != 10 ) {
			continue
		}
		list(0, listmax) = cnt, -cLevel(cnt)
		listmax++
	loop
	gosub *sort_list
	windowshadow = 1

*label_5028
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_5029
	redraw 0
	s = lang("NPC一覧", "NPC List"), strhint2 + strhint3
	display_window (windoww - 700) / 2 + inf_screenx, winposy(448), 700, 448
	s = lang("価格", "Value")
	display_topic lang("NPCの名前", "Name"), wx + 28, wy + 36
	display_topic lang("情報", "Info"), wx + 350, wy + 36
	display_topic s, wx + 490, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 70, wy + 66 + cnt * 19
			gfini 600, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 58, wy + 66 + cnt * 19 - 2, cnt
	loop
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		transmissivity = 0
		if ( cId(list(0, p)) == CREATURE_ID_USER ) {
			if ( userdata2(1, cUNID(list(0, p))) ) {
				transmissivity = userdata2(1, cUNID(list(0, p)))
			}
		}
		if ( ocChipTransparency(list(0, p)) ) {
			transmissivity = ocChipTransparency(list(0, p))
		}
		i = getcharapic(list(0, p)), getcharacolor(list(0, p))
		chara_preparepic i, i(1)
		pos wx + 40, wy + 74 + cnt * 19 - 8
		gmode 4, chipc(CHIPC_WIDTH, i), chipc(CHIPC_HEIGHT, i), 256 - transmissivity
		color 0, 0, 0
		grotate BUFFER_CHR, 0, 960, 0, chipc(CHIPC_WIDTH, i) / (1 + (chipc(CHIPC_HEIGHT, i) > inf_tiles)), inf_tiles
		gmode 2
		i = list(0, p)
		s = cnName(i)
		cutname s, 36
		cs_list s, wx + 84, wy + 66 + cnt * 19 - 1, 19
		s = "Lv." + cLevel(i) + " "
		if ( cSex(i) == 0 ) {
			s += cnven(strmale)
		}
		else {
			s += cnven(strfemale)
		}
		s += lang(" ", "(") + calcage(i) + "" + lang("歳", ")")
		pos wx + 372, wy + 66 + cnt * 19 + 2
		mes s
		s = thousandsep(str(calcslavevalue(i)))
		pos wx + 512, wy + 66 + cnt * 19 + 2
		mes s + lang(" gold", "gp")
		if ( cs == cnt & oom_posinfo == 1 ) {
			gosub *label_4990
		}
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			break
		}
	loop
	if ( p != (-1) ) {
		return p
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_5028
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_5028
		}
	}
	if ( key == key_cancel ) {
		i = 0
		gosub *label_4990
		return -1
	}
	goto *label_5029

*label_5033
	gosub *wish_monster
	locvar_key_direction_meatid = dbid
	flt
	itemcreate -1, ITEM_ID_FISH_JUNK, cX(CHARA_PLAYER), cY(CHARA_PLAYER), 0
	iPic(ci) = xy2pic(0, 13)
	iCol(ci) = 0
	iParam1(ci) = locvar_key_direction_meatid
	iSubName(ci) = 30
	if ( inputlog == cnName(CHARA_PLAYER) + "のエロ本" ) {
		iParam1(ci) = 999
	}
	if ( iParam1(ci) == 343 ) {
		iCNpcId(ci) = initunid - 1
		ICNpcSerialNo(ci) = createserialno(userdatan(0, iCNpcId(ci)))
	}
	if ( iParam1(ci) == 37 & inputlog != "＠のエロ本" ) {
		repeat
			iParam1(ci) = rnd(368)
			if ( iParam1(ci) == 212 | iParam1(ci) == 340 ) {
				continue
			}
			if ( iParam1(ci) > 353 & iParam1(ci) < 366 ) {
				iParam1(ci) = 343
			}
			if ( iParam1(ci) == 343 ) {
				if ( usernpcmax == 0 ) {
					continue
				}
				iCNpcId(ci) = rnd(usernpcmax)
				ICNpcSerialNo(ci) = createserialno(userdatan(0, iCNpcId(ci)))
			}
			break
		loop
	}
	txt -1, lang("足元に" + itemname(ci) + "が転がってきた。", "" + itemname(ci) + " appear" + _s2(iNum(ci)) + " from nowhere.")
	goto *com_wish_end

*label_5035
	listmax = 0
	page = 0
	pagesize = 16
	cs = 0
	cc = CHARA_PLAYER
	cs_bk = -1
	cposlist = 3, 5, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 36, 38, 42
	cposlistst = 45, 46, 50, 51, 52, 53, 54, 57, 58, 59, 60
	dim cpos, 2, length(cposlist)
	repeat length(cposlist)
		cpos(0, cnt) = areaX(cposlist(cnt)), areaY(cposlist(cnt))
	loop
	dim cpos_st, 2, length(cposlistst)
	repeat length(cposlistst)
		cpos_st(0, cnt) = areaX(cposlistst(cnt)), areaY(cposlistst(cnt))
	loop
	min = 1000
	cnt2 = 7
	if ( areaParent(cnt2) == AREA_SOUTH_TYRIS ) {
		repeat length(cposlistst)
			tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos_st(0, cnt), cpos_st(1, cnt))
			if ( min > tmpdist ) {
				min = tmpdist
				cposdist = cnt
			}
		loop
		list(0, listmax) = 7, areaMinLevel(7), cposlistst(cposdist)
		listmax++
	}
	else {
		repeat length(cposlist)
			tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos(0, cnt), cpos(1, cnt))
			if ( min > tmpdist ) {
				min = tmpdist
				cposdist = cnt
			}
		loop
		list(0, listmax) = 7, areaMinLevel(7), cposlist(cposdist)
		listmax++
	}
	repeat 450 - 300, 300
		if ( areaId(cnt) == AREA_NONE ) {
			continue
		}
		if ( areaType(cnt) == MAP_TYPE_HOME ) {
			min = 1000
			cnt2 = cnt
			if ( areaParent(cnt2) == AREA_SOUTH_TYRIS ) {
				repeat length(cposlistst)
					tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos_st(0, cnt), cpos_st(1, cnt))
					if ( min > tmpdist ) {
						min = tmpdist
						cposdist = cnt
					}
				loop
				list(0, listmax) = cnt, areaMinLevel(cnt), cposlistst(cposdist)
				listmax++
			}
			else {
				repeat length(cposlist)
					tmpdist = dist(areaX(cnt2), areaY(cnt2), cpos(0, cnt), cpos(1, cnt))
					if ( min > tmpdist ) {
						min = tmpdist
						cposdist = cnt
					}
				loop
				list(0, listmax) = cnt, areaMinLevel(cnt), cposlist(cposdist)
				listmax++
			}
		}
	loop
	gosub *sort_list
	windowshadow = 1

*label_5043
	redraw 0
	cs_bk = -1
	pagemax = (listmax - 1) / pagesize
	if ( page < 0 ) {
		page = pagemax
	}
	else {
		if ( page > pagemax ) {
			page = 0
		}
	}

*label_5044
	redraw 0
	s = lang("自物件一覧", "Nefia List"), strhint2 + strhint3
	display_window (windoww - 640) / 2 + inf_screenx, winposy(448), 640, 448
	display_topic lang("名前", "Name"), wx + 28, wy + 36
	display_topic lang("位置情報", "Location"), wx + 320 - en * 75, wy + 36
	keyrange = 0
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		key_list(cnt) = key_select(cnt)
		keyrange++
		if ( cnt \ 2 == 0 ) {
			pos wx + 50, wy + 66 + cnt * 19
			gfini 540, 18
			gfdec2 12, 14, 16
		}
		display_key wx + 28, wy + 66 + cnt * 19 - 2, cnt
	loop
	gmode 2
	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
	cs_listbk
	repeat pagesize
		p = pagesize * page + cnt
		if ( p >= listmax ) {
			break
		}
		pos wx + 72 - 16, wy + 66 + cnt * 19 + 2
		s = "" + mapname(list(0, p))
		cs_list s, wx + 56, wy + 66 + cnt * 19 - 1, 19
		if ( jp ) {
			s = mapname(list(2, p)) + " " + direction2(list(2, p), list(0, p), 1)
		}
		else {
			s = "To the " + direction2_short(list(2, p), list(0, p), 1) + " of " + mapname(list(2, p))
		}
		pos wx + 340 - en * 75, wy + 66 + cnt * 19 + 2
		mes s
	loop
	if ( keyrange != 0 ) {
		cs_bk = cs
	}
	redraw 1
	await cfg_wait1
	key_check
	cursor_check
	p = -1
	repeat keyrange
		if ( key == key_select(cnt) ) {
			p = list(0, pagesize * page + cnt)
			cs = cnt
			break
		}
	loop
	if ( p != (-1) ) {
		txt -1, lang("" + mapname(p) + "をこの場所に移動させる？", "Really move your " + mapname(p) + " here?")
		promptl(0, 0) = stryes, "y", "0"
		promptl(0, 1) = strno, "n", "1"
		promptmax = 2
		val = promptx, prompty, 160, 1
		gosub *prompt_key
		if ( rtval != 0 ) {
			inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
			txt -1, lang("オパートス「フハーン！」", "A voice echoes, " + cnvtalk("Muhan!"))
			return
		}
		areaX(p) = cX(CHARA_PLAYER)
		areaY(p) = cY(CHARA_PLAYER)
		areaParent(p) = gWorld
		snd SOUNDLIST_BUILD1
		txtef COLOR_YELLOW
		txt -1, lang("オパートス「フハハハハハハ！まかせろ！」", "A voice echoes, " + cnvtalk("Muwahahahaha, I'll take care of it!"))
		gosub *label_2358
		cell_refresh cX(CHARA_PLAYER), cY(CHARA_PLAYER)
		return
	}
	if ( key == key_pageup ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page++
			goto *label_5043
		}
	}
	if ( key == key_pagedown ) {
		if ( pagemax != 0 ) {
			snd SOUNDLIST_POP1
			page--
			goto *label_5043
		}
	}
	if ( key == key_cancel ) {
		inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), ci) = 0
		txt -1, lang("オパートス「フハーン！」", "A voice echoes, " + cnvtalk("Muhan!"))
		return
	}
	goto *label_5044

#deffunc split8bit int split8bit_prm0, array split8bit_prm1
	split8bit_prm1(0) = split8bit_prm0 >> 16 & 255
	split8bit_prm1(1) = split8bit_prm0 >> 8 & 255
	split8bit_prm1(2) = split8bit_prm0 & 255
	return

#defcfunc join8bit array join8bit_prm0
	locvar_txtgod_t = 0
	locvar_txtgod_t = join8bit_prm0(0) << 16 | locvar_txtgod_t
	locvar_txtgod_t = join8bit_prm0(1) << 8 | locvar_txtgod_t
	locvar_txtgod_t = join8bit_prm0(2) | locvar_txtgod_t
	return locvar_txtgod_t

#deffunc preparepicitemexoom
	srcwid = 1
	picno = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 1)
	colno = oommap(locvar_cell_draw_x, locvar_cell_draw_y, 3)
	havedirection = 0
	if ( oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0) == 743 ) {
		picno = 1650 + useritemdata(39, oommap(locvar_cell_draw_x, locvar_cell_draw_y, 2))
		srcwid = 30
	}
	else {
		if ( use_exticon ) {
			repeat 1
				if ( ichipexchangetable(oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0)) ) {
					havedirection = ichipexchangetable(oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0)) / 1000000
					if ( ichipexchangetable(oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0)) \ 1000000 >= 10000 ) {
						colno = ichipexchangetable(oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0)) \ 1000000 / 10000 - 1
					}
					picno = ichipexchangetable(oommap(locvar_cell_draw_x, locvar_cell_draw_y, 0)) \ 10000
					if ( havedirection ) {
						srcwid = 33
					}
					else {
						srcwid = 31
					}
					break
				}
			loop
		}
	}
	gsel BUFFER_ITEM
	color 0
	boxf 0, 960, chipi(CHIPI_WIDTH, picno), chipi(CHIPI_HEIGHT, picno) + 960
	pos 0, 960
	gcopy srcwid, chipi(CHIPI_X, picno) + oommap(locvar_cell_draw_x, locvar_cell_draw_y, 5) * 48, chipi(CHIPI_Y, picno), chipi(CHIPI_WIDTH, picno), chipi(CHIPI_HEIGHT, picno)
	gfini chipi(CHIPI_WIDTH, picno), chipi(CHIPI_HEIGHT, picno)
	gfdec2 c_col(0, colno), c_col(1, colno), c_col(2, colno)
	gsel selcur
	return picno

#defcfunc isflower int isflower_prm0
	if ( iID(isflower_prm0) == ITEM_ID_BANKS_ROSE ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_SAGE ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_GAZANIA ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_NERINE ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_ANEMONE ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_CARNATION ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_FLOWER_ADORNED_PILLAR ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_GRAVE_ORNAMENTED_WITH_FLOWERS ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_LARGE_BOUQUET ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_FLOWER_ARCH ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_FLOWERBED ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_FESTIVAL_WREATH ) {
		return 1
	}
	if ( iID(isflower_prm0) == ITEM_ID_CORPSE | iID(isflower_prm0) == ITEM_ID_SKIN | iID(isflower_prm0) == ITEM_ID_BLOOD | iID(isflower_prm0) == ITEM_ID_EYE | iID(isflower_prm0) == ITEM_ID_HEART | iID(isflower_prm0) == ITEM_ID_BONE | iID(isflower_prm0) == ITEM_ID_FIGURINE | iID(isflower_prm0) == ITEM_ID_CARD | iID(isflower_prm0) == ITEM_ID_JERKY | iID(isflower_prm0) == ITEM_ID_EGG | iID(isflower_prm0) == ITEM_ID_SHIT | iID(isflower_prm0) == ITEM_ID_BOTTLE_MILK | iID(isflower_prm0) == ITEM_ID_MONSTER_BALL ) {
		if ( iSubName(isflower_prm0) == 93 | iSubName(isflower_prm0) == 94 ) {
			return 1
		}
	}
	return 0

#defcfunc calcuserspellsuccess int calcuserspellsuccess_prm0
	repeat
		if ( 90 + 1 / 1000000 - calcuserspellsuccess_prm0 * 4 / (5 + cnt * 4) >= 1 ) {
			locvar_randskill_p = cnt
			break
		}
	loop
	return locvar_randskill_p

#defcfunc getcontinentareaid int getcontinentareaid_prm0
	if ( getcontinentareaid_prm0 == 30 ) {
		insideareaid = gReturnArea
	}
	else {
		insideareaid = getcontinentareaid_prm0
	}
	outerareaid = areaParent(insideareaid)
	if ( outerareaid == insideareaid ) {
		return outerareaid
	}
	return getcontinentareaid(outerareaid)

















































































































































































































































































































































































































































































